// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./promiseList ./ArcadeExpression ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./arcadeProfiles/popupProfile ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),function(K,F,G,M,L,D,u,e,c,d,l,n,m,g,p,v,B,z,k,x,y,
A){K=K(null,{declaredClass:"esri.PopupInfo",_reNewline:/(\n)/ig,_reExprField:/^\s*expression\//i,_reExprFieldPattern:/\{expression\/([^\}]+)\}/ig,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",_aggregatedFeaturesVariable:"$aggregatedfeatures",initialize:function(a,f){if(a){F.mixin(this,f);this.info=a;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var r=this._fieldLabels={},q=this._fieldsMap={};this.info.fieldInfos&&
G.forEach(this.info.fieldInfos,function(b){var h=b.fieldName.toLowerCase(),t=this._isExpressionField(h)?this.getExpressionInfo(h):null;r[h]=t?t.title:b.label;q[h]=b},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix));this.titleHasAsyncExpressions=this._titleHasAsyncExpressions();this.contentHasAsyncExpressions=this._contentHasAyncExpressions()}},toJson:function(){return M.fromJson(M.toJson(this.info))},getTitle:function(){},getContent:function(){},
getFieldInfo:function(a){var f;G.some(this.info&&this.info.fieldInfos,function(r){r.fieldName===a&&(f=r);return!!f});return f},getExpressionInfo:function(a){if(a=this._getExprField(a)){a=a.toLowerCase();var f;G.some(this.info.expressionInfos,function(r){r.name.toLowerCase()===a&&(f=r);return!!f});return f}},getExpressionFieldsInTitle:function(){return this._getExprFieldsFromTemplatedString(this.info.title)},getExpressionFieldsInContent:function(){var a=this._collectExprFieldsFromTemplatedString(this.info.description,
[]);this.info.description||G.forEach(this.info.fieldInfos,function(f){f.visible&&this._collectExprField(f.fieldName,a)},this);G.forEach(this.info.mediaInfos,function(f){this._collectExprFieldsFromTemplatedString(f.title,a);this._collectExprFieldsFromTemplatedString(f.caption,a);if(f=f.value)this._collectExprFieldsFromTemplatedString(f.linkURL,a),this._collectExprFieldsFromTemplatedString(f.sourceURL,a),G.forEach(f.fields,function(r){this._collectExprField(r,a)},this),this._collectExprField(f.normalizeField,
a),this._collectExprField(f.tooltipField,a)},this);return a},getRequiredExpressionFields:function(){return this.getExpressionFieldsInTitle().concat(this.getExpressionFieldsInContent())},hasGeometryOperations:function(){return G.some(this._getArcadeExpressions(),function(a){return a.hasGeometryOperations()})},hasAsyncExpressions:function(){return G.some(this._getArcadeExpressions(),function(a){return a.async})},initializeArcadeEngine:function(){return x.initialize(this._getArcadeExpressions())},getComponents:function(a,
f){var r=this.info,q={initArcadeEngine:this.initializeArcadeEngine()};r.fieldInfos&&(r=G.filter(r.fieldInfos,function(b){return-1!==b.fieldName.indexOf(this._relatedFieldPrefix)},this))&&0<r.length&&(q.relatedInfo=this._getRelatedRecords({graphic:a,fieldsInfo:r}));this._needFullResolutionFeature(a)&&(q.fullResolutionFeature=this._getFullResolutionFeature(a));this._needAggregatedFeaturesLayer(a)&&(q.aggregatedFeaturesLayer=this._getAggregatedFeaturesLayer(a));return g(q).then(F.hitch(this,function(b){var h=
b.fullResolutionFeature,t=f&&f.evaluateAllExpressions,E=t?null:this.getRequiredExpressionFields();b=(t?this.hasAsyncExpressions():this._hasAsyncExpressions(E))?this._fetchAttributesAsync(a,h,E,b.aggregatedFeaturesLayer):this._fetchAttributes(a,h,E);return g([b]).then(F.hitch(this,function(C){return this._getPopupValues(a,C[0])}))}))},getAttachments:function(a){var f=a.getSourceLayer();a=a.attributes;if(this.info.showAttachments&&f&&f.hasAttachments&&f.objectIdField&&(a=a&&a[f.objectIdField]))return f.queryAttachmentInfos(a)},
_needAggregatedFeaturesLayer:function(a){return a.isAggregate()?G.some(this._getArcadeExpressions(),function(f){return f.hasVariable(this._aggregatedFeaturesVariable)},this):!1},_getAggregatedFeaturesLayer:function(a){return a.getAggregationSourceLayer().getFeatureCollectionLayer(a.getChildGraphics()).always(function(f){return f instanceof Error?null:f})},_needFullResolutionFeature:function(a){return(a=a.getSourceLayer())?"function"===typeof a.getMaxAllowableOffset&&0<a.getMaxAllowableOffset()&&this.hasGeometryOperations():
!1},_getFullResolutionFeature:function(a){var f=a.getSourceLayer(),r=f.objectIdField;a=(a=a.attributes)&&r&&a[r];if(null==a)return null;var q=new v;q.where=r+"\x3d"+a;q.maxAllowableOffset=0;q.outFields=[r];f._enableCacheHint(q);return f.queryFeatures(q).then(function(b){return b.features&&b.features[0]})},_isExpressionField:function(a){return this._reExprField.test(a)},_getExprField:function(a){return this._isExpressionField(a)?a.replace(this._reExprField,""):null},_collectExprField:function(a,f){(a=
this._getExprField(a))&&f.push(a);return f},_collectExprFieldsFromTemplatedString:function(a,f){a=this._getExprFieldsFromTemplatedString(a);a.length&&Array.prototype.push.apply(f,a);return f},_getExprFieldsFromTemplatedString:function(a){a=a?a.match(this._reExprFieldPattern):null;return G.map(a,function(f){return f.replace(this._reExprFieldPattern,"$1")},this)},_titleHasAsyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInTitle())},_contentHasAyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInContent())},
_hasAsyncExpressions:function(a){return G.some(a,function(f){f=this._exprCache[f];return!(!f||!f.async)},this)},_compileExpressions:function(a){var f={};G.forEach(a,function(r){var q=r.returnType&&r.returnType.toLowerCase();f[r.name]=new p({expression:r.expression,returnType:"number"===q?"number":"string",profile:x})});return f},_getArcadeExpressions:function(){var a=[],f;for(f in this._exprCache)a.push(this._exprCache[f]);return a},_fetchAttributesAsync:function(a,f,r,q){var b=this._fetchAttributes(a,
f,r,q);a={};for(var h in b)(f=b[h])&&f.then&&(a[h]=f);return g(a).then(F.hitch(this,function(t){for(var E in t){var C=t[E];b[E]=C instanceof Error?null:this._processArcadeResult(C)}return b}))},_processArcadeResult:function(a){"string"===typeof a&&(a=d.encode(a));return a},_fetchAttributes:function(a,f,r,q){var b=F.clone(a.attributes)||{},h=f&&f.geometry,t=this._exprPrefix,E=this._exprCache;r=r||G.map(this.info.expressionInfos,function(C){return C.name});G.forEach(r,function(C){var w=t+C;C=(C=E[C])?
a.evaluateExpression(C,this._getEvalOptions(C,a,h,q)):null;b[w]=this._processArcadeResult(C)},this);return b},_getEvalOptions:function(a,f,r,q){var b=a.hasGeometryOperations(),h=f.getSourceLayer(),t=h&&(h.getMap()||h.parentLayer&&h.parentLayer.getMap());q&&(q._map=t);a=x.getEvalOptions({expression:a,feature:f,layer:h,aggregatedFeaturesLayer:q,map:t,spatialReference:t&&t.spatialReference});f=a.context.vars.$feature;b=!(!b||!r);f&&b&&(f._geometry=r);a.skipCache=b;return a},_getPopupValues:function(a,
f,r){f=f||this._fetchAttributes(a);var q=this.info,b=a.getSourceLayer(),h=F.clone(f),t="",E="",C,w,I=b&&b._getDateOpts&&b._getDateOpts().properties;I=I&&I.slice(0);var J={dateFormat:{properties:I,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)},format:null};if(this._relatedInfo)for(O in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(O)){var H=this._relatedInfo[O],P=this._relatedLayersInfo[O];H&&(G.forEach(H.relatedFeatures,function(Q){for(w in Q.attributes)if(Q.attributes.hasOwnProperty(w)&&
"esriRelCardinalityOneToOne"===P.relation.cardinality){var R=this._toRelatedFieldName([P.relation.id,w]);f[R]=h[R]=Q.attributes[w]}},this),G.forEach(H.relatedStatsFeatures,function(Q){for(w in Q.attributes)if(Q.attributes.hasOwnProperty(w)){var R=this._toRelatedFieldName([P.relation.id,w]);f[R]=h[R]=Q.attributes[w]}},this))}for(C in h){var O=this._fieldsMap[C.toLowerCase()];H=this._getLayerFieldInfo(b,C);O&&H&&(O.fieldName=H.name);h[C]=this._formatValue(h[C],C,J);I&&O&&O.format&&O.format.dateFormat&&
(O=G.indexOf(I,C),-1<O&&I.splice(O,1))}if(b)for(C in I=b.typeIdField,f)if(f.hasOwnProperty(C)&&-1===C.indexOf(this._relatedFieldPrefix)){var N=f[C];l.isDefined(N)&&(O=this._getDomainName(b,a,C,N),l.isDefined(O)?h[C]=O:C===I&&(O=this._getTypeName(b,a,N),l.isDefined(O)&&(h[C]=O)))}q.title&&(t=this._processFieldsInLinks(this._fixTokens(q.title,b),f),t=F.trim(this._removeEmptyHref(l.substitute(h,t,J)||"")));if(r)return{title:t};q.description&&(E=this._processFieldsInLinks(this._fixTokens(q.description,
b),f),E=F.trim(this._removeEmptyHref(l.substitute(h,E,J)||"")));if(q.fieldInfos){var T=[];G.forEach(q.fieldInfos,function(Q){(C=Q.fieldName)&&Q.visible&&T.push([this._fieldLabels[C.toLowerCase()]||C,l.substitute(h,"${"+C+"}",J)||""])},this)}var U;if(q.mediaInfos){var V=[];G.forEach(q.mediaInfos,function(Q){U=0;N=Q.value;switch(Q.type){case "image":var R=N.sourceURL;R=R&&F.trim(this._removeEmptyHref(l.substitute(f,this._fixTokens(R,b))));U=!!R;break;case "piechart":case "linechart":case "columnchart":case "barchart":R=
N.normalizeField;N.fields=G.map(N.fields,function(S){return(X=this._getLayerFieldInfo(b,S))?X.name:S},this);if(R){var X=this._getLayerFieldInfo(b,R);N.normalizeField=X?X.name:R}U=G.some(N.fields,function(S){return l.isDefined(f[S])||-1!==S.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(U){Q=F.clone(Q);N=Q.value;R=Q.title?this._processFieldsInLinks(this._fixTokens(Q.title,b),f):"";var aa=Q.caption?this._processFieldsInLinks(this._fixTokens(Q.caption,b),f):"";Q.title=
R?F.trim(this._removeEmptyHref(l.substitute(h,R,J)||"")):"";Q.caption=aa?F.trim(this._removeEmptyHref(l.substitute(h,aa,J)||"")):"";if("image"===Q.type)N.sourceURL=l.substitute(f,this._fixTokens(N.sourceURL,b)),N.linkURL&&(N.linkURL=F.trim(l.substitute(f,this._fixTokens(N.linkURL,b))||""));else{var Y,Z;G.forEach(N.fields,function(S,ba){if(-1!==S.indexOf(this._relatedFieldPrefix))Z=this._getRelatedChartInfos(S,N,f,J),Z instanceof Array?N.fields=Z:N.fields[ba]=Z;else{var W=f[S];W=void 0===W?null:W;
Y=f[N.normalizeField]||0;W&&Y&&(W/=Y);N.fields[ba]={y:W,tooltip:(this._fieldLabels[S.toLowerCase()]||S)+":\x3cbr/\x3e"+this._formatValue(W,S,J,!!Y)}}},this)}V.push(Q)}},this)}return{title:t,description:E,hasDescription:!!q.description,fields:T&&T.length?T:null,mediaInfos:V&&V.length?V:null,formatted:h,editSummary:!1!==q.showLastEditInfo&&b&&b.getEditSummary?b.getEditSummary(a):""}},_getRelatedChartInfos:function(a,f,r,q){var b,h;var t=[];var E=this._fromRelatedFieldName(a);var C=E[0];var w=this._relatedInfo[C];
C=this._relatedLayersInfo[C];w&&G.forEach(w.relatedFeatures,function(I){I=I.attributes;var J;for(J in I)if(I.hasOwnProperty(J)&&J===E[1]){var H={};h=I[J];f.normalizeField&&(b=-1!==f.normalizeField.indexOf(this._relatedFieldPrefix)?I[this._fromRelatedFieldName(f.normalizeField)[1]]:r[f.normalizeField]);h&&b&&(h/=b);if(f.tooltipField)if(-1!==f.tooltipField.indexOf(this._relatedFieldPrefix)){var P=this._fromRelatedFieldName(f.tooltipField)[1],O=l.isDefined(I[P])?this._formatValue(I[P],f.tooltipField,
q,!!b):P;H.tooltip=O+":\x3cbr/\x3e"+this._formatValue(h,P,q,!!b)}else H.tooltip=(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(h,f.tooltipField,q,!!b);else H.tooltip=h;H.y=h;t.push(H)}},this);return"esriRelCardinalityOneToMany"===C.relation.cardinality||"esriRelCardinalityManyToMany"===C.relation.cardinality?t:t[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",
shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",
shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",longMonthDayYearShortTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longMonthDayYearShortTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longMonthDayYearLongTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",
longMonthDayYearLongTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",dayShortMonthYearShortTime:"(datePattern: 'd MMM y', timePattern: 'h:mm a', selector: 'date and time')",dayShortMonthYearShortTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm', selector: 'date and time')",dayShortMonthYearLongTime:"(datePattern: 'd MMM y', timePattern: 'h:mm:ss a', selector: 'date and time')",dayShortMonthYearLongTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm:ss', selector: 'date and time')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",longDateShortTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longDateShortTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longDateLongTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",longDateLongTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",
shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_dateFormatsJson:{shortDate:{datePattern:"M/d/y",selector:"date"},shortDateShortTime:{datePattern:"M/d/y",timePattern:"h:mm a",selector:"date and time"},shortDateShortTime24:{datePattern:"M/d/y",timePattern:"H:mm",selector:"date and time"},shortDateLongTime:{datePattern:"M/d/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLongTime24:{datePattern:"M/d/y",timePattern:"H:mm:ss",selector:"date and time"},
shortDateLE:{datePattern:"d/M/y",selector:"date"},shortDateLEShortTime:{datePattern:"d/M/y",timePattern:"h:mm a",selector:"date and time"},shortDateLEShortTime24:{datePattern:"d/M/y",timePattern:"H:mm",selector:"date and time"},shortDateLELongTime:{datePattern:"d/M/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLELongTime24:{datePattern:"d/M/y",timePattern:"H:mm:ss",selector:"date and time"},longMonthDayYear:{datePattern:"MMMM d, y",selector:"date"},longMonthDayYearShortTime:{datePattern:"MMMM d, y",
timePattern:"h:mm a",selector:"date and time"},longMonthDayYearShortTime24:{datePattern:"MMMM d, y",timePattern:"H:mm",selector:"date and time"},longMonthDayYearLongTime:{datePattern:"MMMM d, y",timePattern:"h:mm:ss a",selector:"date and time"},longMonthDayYearLongTime24:{datePattern:"MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},dayShortMonthYear:{datePattern:"d MMM y",selector:"date"},dayShortMonthYearShortTime:{datePattern:"d MMM y",timePattern:"h:mm a",selector:"date and time"},dayShortMonthYearShortTime24:{datePattern:"d MMM y",
timePattern:"H:mm",selector:"date and time"},dayShortMonthYearLongTime:{datePattern:"d MMM y",timePattern:"h:mm:ss a",selector:"date and time"},dayShortMonthYearLongTime24:{datePattern:"d MMM y",timePattern:"H:mm:ss",selector:"date and time"},longDate:{datePattern:"EEEE, MMMM d, y",selector:"date"},longDateShortTime:{datePattern:"EEEE, MMMM d, y",timePattern:"h:mm a",selector:"date and time"},longDateShortTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm",selector:"date and time"},longDateLongTime:{datePattern:"EEEE, MMMM d, y",
timePattern:"h:mm:ss a",selector:"date and time"},longDateLongTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},longMonthYear:{datePattern:"MMMM y",selector:"date"},shortMonthYear:{datePattern:"MMM y",selector:"date"},year:{datePattern:"y",selector:"date"}},_reHref:/href\s*=\s*(")([^"]+)"/ig,_reHrefApos:/href\s*=\s*(')([^']+)'/ig,_fixTokens:function(a,f){var r=this;return a.replace(/(\{([^\{\r\n]+)\})/g,function(q,b,h){q=r._getLayerFieldInfo(f,h);return"$"+(q?"{"+
q.name+"}":b)})},_encodeAttributes:function(a,f){a=F.clone(a)||{};var r,q;for(r in a)(q=a[r])&&"string"===typeof q&&(q=f?q:encodeURIComponent(q),q=q.replace(/'/g,"\x26apos;"),a[r]=q);return a},_processFieldsInLinks:function(a,f){var r=this._encodeAttributes(f),q=this._encodeAttributes(f,!0);f=F.hitch(this,this._addValuesToHref,f,r,q);a&&(a=a.replace(this._reHref,f).replace(this._reHrefApos,f));return a},_addValuesToHref:function(a,f,r,q,b,h){h=h&&F.trim(h);return q=l.substitute(h&&0===h.indexOf("${")?
"'"===b?r:a:f,q)},_getLayerFieldInfo:function(a,f){return a&&a.getField?a.getField(f):null},_formatValue:function(a,f,r,q){var b=this._fieldsMap[f.toLowerCase()],h=b&&b.format;f=-1!==G.indexOf(r.dateFormat.properties,f);var t="number"===typeof a&&!f&&(!h||!h.dateFormat);if(!l.isDefined(a)||!b||!l.isDefined(h))return this._applyFormatting(a,t);b=h.hasOwnProperty("places")||h.hasOwnProperty("digitSeparator");var E=h.hasOwnProperty("digitSeparator")?h.digitSeparator:!0;if(b&&!f)var C={formatType:"NumberFormat",
places:l.isDefined(h.places)&&(!q||0<h.places)?Number(h.places):Infinity};else if(h.dateFormat)C=F.mixin({formatType:"DateFormat",utcOffset:this.utcOffset},this._dateFormatsJson[h.dateFormat]||this._dateFormatsJson.shortDateShortTime);else return this._applyFormatting(a,t);var w=this._applyFormatFunctions(a,C,r);b&&-1<a.constructor.toString().indexOf("Array")&&(w="",G.forEach(a,F.hitch(this,function(I,J){J&&(w+=" ");w+=this._applyFormatFunctions(I,C,r)})));b&&!E&&A.group&&(w=w.replace(new RegExp("\\"+
A.group,"g"),""));f&&(w='\x3cspan class\x3d"esriDateValue"\x3e'+w+"\x3c/span\x3e");return this._applyFormatting(w,t)},_applyFormatFunctions:function(a,f,r){f&&r&&(r.format={myKey:f});a=l.substitute({myKey:a},"${myKey}",r)||"";f&&r&&(r.format=null);return a},_applyFormatting:function(a,f){return f?this._forceLTR(a):this._applyPreWrap(a)},_forceLTR:function(a){var f=e("ie");return f&&10>=f?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_applyPreWrap:function(a){return"string"===typeof a?
a.replace(this._reNewline,"\x3cspan class\x3d'charNewLine'\x3e$1\x3c/span\x3e"):a},_insertOffset:function(a){a&&(a=l.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,f,r,q){return(a=a.getDomain&&a.getDomain(r,{feature:f}))&&a.codedValues?a.getName(q):null},_getTypeName:function(a,f,r){return(a=a.getType&&a.getType(f))&&a.name},_getRelatedRecords:function(a){var f=a.graphic,r;this._relatedLayersInfoPromise||(this._relatedLayersInfoPromise=
this._getRelatedLayersInfo(a).then(F.hitch(this,function(q){for(r in q)q.hasOwnProperty(r)&&q[r]&&(this._relatedLayersInfo[r].relatedLayerInfo=q[r])})));return this._relatedLayersInfoPromise.then(F.hitch(this,function(){return this._queryRelatedLayers(f)})).then(F.hitch(this,function(q){this._setRelatedRecords(f,q);return q}))},_getRelatedLayersInfo:function(a){var f=a.fieldsInfo,r,q={};var b=a.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});G.forEach(f,function(h){var t;
var E=this._fromRelatedFieldName(h.fieldName);var C=E[0];E=E[1];if(C&&(!this._relatedLayersInfo[C]&&b&&b.relationships&&(G.some(b.relationships,function(I){if(I.id==C)return t=I,!0}),t&&(this._relatedLayersInfo[C]={relation:t,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[C]&&(this._relatedLayersInfo[C].relatedFields.push(E),h.statisticType))){var w=new k;w.statisticType=h.statisticType;w.onStatisticField=E;w.outStatisticFieldName=E;this._relatedLayersInfo[C].outStatistics.push(w)}},
this);for(r in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(r)&&this._relatedLayersInfo[r]&&(a=this._relatedLayersInfo[r].relation,a=b.url.replace(/[0-9]+$/,a.relatedTableId),this._relatedLayersInfo[r].relatedLayerUrl=a,q[r]=m({url:a,content:{f:"json"},callbackParamName:"callback"}));return c(q)},_queryRelatedLayers:function(a){var f={},r;for(r in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(r)&&(f[r]=this._queryRelatedLayer({graphic:a,relatedInfo:this._relatedLayersInfo[r]}));
return c(f)},_queryRelatedLayer:function(a){var f,r;var q=a.graphic;var b=q.getSourceLayer();var h=b.url.match(/[0-9]+$/g)[0];var t=a.relatedInfo;var E=t.relatedLayerInfo;var C=t.relatedLayerUrl;var w=t.relation;a=G.filter(E.relationships,function(N){return N.relatedTableId===parseInt(h,10)});1===a.length?f=a[0]:1<a.length&&G.some(a,function(N){N.id===w.id&&(f=N);return!!f});if(f){var I=new v;G.some(E.fields,function(N){if(N.name===f.keyField)return r=-1!==G.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger",
"esriFieldTypeSingle","esriFieldTypeDouble"],N.type)?"number":"string",!0});if(f.relationshipTableId&&f.keyFieldInRelationshipTable){var J=new u;this._queryRelatedRecords(q,f).then(F.hitch(this,function(N){var T;(T=N[q.attributes[b.objectIdField]])?(N=G.map(T.features,function(U){return U.attributes[E.objectIdField]},this),t.outStatistics&&0<t.outStatistics.length&&E.supportsStatistics&&(P=new v,P.where=this._chunkWhereInClause(E.objectIdField,N,1E3),P.outFields=I.outFields,P.outStatistics=t.outStatistics),
P&&(O=new B(C),O.execute(P).then(F.hitch(this,function(U){var V=[];V.push(T);V.push(U);J.resolve(V)})))):J.resolve()}))}else{var H="string"===r?f.keyField+"\x3d'"+q.attributes[w.keyField]+"'":f.keyField+"\x3d"+q.attributes[w.keyField];I.where=H;I.outFields=t.relatedFields;if(t.outStatistics&&0<t.outStatistics.length&&E.supportsStatistics){var P=new v;P.where=I.where;P.outFields=I.outFields;P.outStatistics=t.outStatistics}var O=new B(C);H=[];H.push(O.execute(I));P&&H.push(O.execute(P))}}return H?c(H):
J?J.promise:void 0},_setRelatedRecords:function(a,f){this._relatedInfo=[];for(var r in f)f.hasOwnProperty(r)&&f[r]&&(a=f[r],this._relatedInfo[r]={},this._relatedInfo[r].relatedFeatures=a[0].features,l.isDefined(a[1])&&(this._relatedInfo[r].relatedStatsFeatures=a[1].features))},_handlerErrorResponse:function(a,f){a.reject(f)},_fromRelatedFieldName:function(a){var f=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),f=a.slice(1));return f},_toRelatedFieldName:function(a){var f="";a&&0<a.length&&
(f=this._relatedFieldPrefix+a[0]+"/"+a[1]);return f},_queryRelatedRecords:function(a,f){var r=a.getSourceLayer(),q=new z;q.outFields=["*"];q.relationshipId=f.id;q.objectIds=[a.attributes[r.objectIdField]];return r.queryRelatedFeatures(q)},_removeEmptyHref:function(a){return a.replace(/href=(""|'')/gi,"")},_chunkWhereInClause:function(a,f,r){for(var q=0,b=[];q<f.length;)b.push(a+" IN ("+f.slice(q,r+q)+")"),q+=r;return b.join(" OR ")}});D("extend-esri")&&(n.PopupInfo=n.PopupInfoTemplate=K);return K})},
"dojox/html/entities":function(){define(["dojo/_base/lang"],function(K){var F=K.getObject("dojox.html.entities",!0),G=function(L,D){if(D._encCache&&D._encCache.regexp&&D._encCache.mapper&&D.length==D._encCache.length){var u=D._encCache.mapper;var e=D._encCache.regexp}else{u={};e=["["];var c;for(c=0;c<D.length;c++)u[D[c][0]]="\x26"+D[c][1]+";",e.push(D[c][0]);e.push("]");e=new RegExp(e.join(""),"g");D._encCache={mapper:u,regexp:e,length:D.length}}return L=L.replace(e,function(d){return u[d]})},M=function(L,
D){if(D._decCache&&D._decCache.regexp&&D._decCache.mapper&&D.length==D._decCache.length){var u=D._decCache.mapper;var e=D._decCache.regexp}else{u={};e=["("];var c;for(c=0;c<D.length;c++){var d="\x26"+D[c][1]+";";c&&e.push("|");u[d]=D[c][0];e.push(d)}e.push(")");e=new RegExp(e.join(""),"g");D._decCache={mapper:u,regexp:e,length:D.length}}return L=L.replace(e,function(l){return u[l]})};F.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];F.latin=[["\u00a1","iexcl"],["\u00a2",
"cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],
["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],
["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1",
"ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],
["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],
["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],
["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],
["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665",
"hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039",
"lsaquo"],["\u203a","rsaquo"]];F.encode=function(L,D){L&&(D?L=G(L,D):(L=G(L,F.html),L=G(L,F.latin)));return L};F.decode=function(L,D){L&&(D?L=M(L,D):(L=M(L,F.html),L=M(L,F.latin)));return L};return F})},"esri/ArcadeExpression":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./layers/support/attributeUtils ./support/expressionUtils".split(" "),function(K,F,G,M,L,D){K=K(null,{declaredClass:"esri.ArcadeExpression",expression:null,profile:null,returnType:null,async:null,id:null,
syntaxTree:null,_traits:null,_attributeDef:null,_attributeCache:null,_compiled:!1,constructor:function(u){F.mixin(this,u);this.returnType=this.returnType||"string";this.id=L.getAttributeId(this.expression);this._setSyntaxTree(this.profile.parse(this));this.async=this.async||this.profile.isAsync(this)},hasGeometryOperations:function(){var u=this._traits.geometryOperations;void 0===u&&(u=this._traits.geometryOperations=D.hasGeometryOperations(this.syntaxTree));return u},hasFeatureSetOperations:function(){var u=
this._traits.featureSetOperations;void 0===u&&(u=this._traits.featureSetOperations=D.hasFeatureSetOperations(this.syntaxTree));return u},hasVariable:function(u){var e=this._traits.variables;void 0===e[u]&&(e[u]=D.hasVariable(this.syntaxTree,u));return e[u]},hasFunction:function(u){var e=this._traits.functions;void 0===e[u]&&(e[u]=D.hasFunction(this.syntaxTree,u));return e[u]},evaluate:function(u){this._compile();var e=this._attributeCache.compiledFunc;return this.async?D.executeAsyncFunction(e,u):
D.executeFunction(e,u)},_setSyntaxTree:function(u){this.syntaxTree=u;this._compiled=!1;this._traits={variables:{},functions:{}};this._createLegacyValueObjects()},_createLegacyValueObjects:function(){this._attributeDef={valueExpression:this.expression};this._attributeCache={attributeInfo:this._attributeDef,isNumeric:"number"===this.returnType,idSource:this.expression,id:this.id,hasExpr:!0,compiledFunc:null,syntaxTree:this.syntaxTree,isScaleDriven:!1,dependsOnView:this.hasVariable("$view"),dependsOnGeometry:this.hasGeometryOperations(),
isJSFunc:!1}},_compile:function(){this._compiled||(this._attributeCache.compiledFunc=this.profile.compile(this),this._compiled=!0)}});G("extend-esri")&&(M.ArcadeExpression=K);return K})},"esri/tasks/QueryTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/DeferredList ../kernel ../sniff ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(K,F,G,M,L,D,u,e,c,d,l,n,
m,g,p){var v=c("esri-pbf"),B=F(null,{url:null,query:null,requestOptions:null,pagination:null,pageSize:null,_fetchDfd:null,_startPage:null,_result:null,constructor:function(k){this._handleSuccess=G.hitch(this,this._handleSuccess);this._handleError=G.hitch(this,this._handleError);G.mixin(this,k);null==this.pagination&&(this.pagination=!1);null==this.pageSize&&(this.pageSize=1E3)},execute:function(){var k=new L(this._canceler);this._fetchDfd=k;this._result=null;this._sendRequest();return k.promise},
_canceler:function(k){var x=k._pendingRequest;if(!k.isFulfilled()&&x&&!x.isFulfilled()){x.cancel();var y=x.results&&x.results[1]}k._pendingRequest=null;return y},_sendRequest:function(k){var x=this.query;this.pagination&&(this._startPage=x.resultOffset=null==k?0:k,x.resultRecordCount=this.pageSize);k=this.requestOptions;this._fetchDfd._pendingRequest=d({url:this.url,content:x,handleAs:"pbf"===x.f?"arraybuffer":"json",callbackParamName:"callback",timeout:k&&k.timeout},k);this._fetchDfd._pendingRequest.then(this._handleSuccess).otherwise(this._handleError)},
_handleSuccess:function(k){this.pagination?(k.exceededTransferLimit&&this._sendRequest(this._startPage+this.pageSize),this._result?this._result.features=this._result.features.concat(k.features):this._result=k,this._fetchDfd.progress(k),k.exceededTransferLimit||this._fetchDfd.resolve(this._result)):(this._fetchDfd.progress(k),this._fetchDfd.resolve(k))},_handleError:function(k){this._fetchDfd.reject(k)}}),z=F(g,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],
"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(k,x){this._handler=G.hitch(this,this._handler);this._relationshipQueryHandler=G.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=G.hitch(this,this._executeForIdsHandler);this._countHandler=G.hitch(this,this._countHandler);this._extentHandler=G.hitch(this,this._extentHandler);this.source=x&&x.source;this.gdbVersion=x&&x.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",
c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"rawExecute",c:2,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onRawExecuteComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(k,x,y,A,a){var f=
a.assembly;k=this._encode(G.mixin({},this._url.query,{f:A&&A.format||"json"},k.toJson(f&&f[0])));var r=this._handler,q=this._errorHandler;this.source&&(A={source:this.source.toJson()},k.layer=D.toJson(A));this.gdbVersion&&(k.gdbVersion=this.gdbVersion);var b="pbf"===k.f;if(b){var h;v||(h="QueryTask.execute: 'pbf' format is not supported in your browser.");if(h)return k=new L,k.addErrback(function(t){q(t,y,a.dfd)}),k.reject(Error(h)),k}h=this.requestOptions;h=d({url:this._url.path+"/query",content:k,
callbackParamName:"callback",handleAs:b?"arraybuffer":"json",timeout:h&&h.timeout},h);k=[h];b&&k.push(z.loadPBFReader());(new u(k)).then(function(t){a.dfd.isFulfilled()||(t=t[0],t[0]?r(t[1],b,x,y,a.dfd):q(t[1],y,a.dfd))});return h},rawExecute:function(k,x,y){x=x||{};k=this._encode(G.mixin({},this._url.query,{f:x.format||"json"},k.toJson(y.assembly&&y.assembly[0])));this.source&&(k.layer=D.toJson({source:this.source.toJson()}));this.gdbVersion&&(k.gdbVersion=this.gdbVersion);return(new B({url:this._url.path+
"/query",query:k,requestOptions:this.requestOptions,pagination:x.pagination,pageSize:x.pageSize})).execute().then(null,null,function(A){y.dfd.progress(A)}).then(G.hitch(this,function(A){this._successHandler([A],"onRawExecuteComplete",null,y.dfd)})).otherwise(G.hitch(this,function(A){this._errorHandler(A,null,y.dfd)}))},executeRelationshipQuery:function(k,x,y){k=this._encode(G.mixin({},this._url.query,{f:"json"},k.toJson()));var A=this._relationshipQueryHandler,a=this._errorHandler;this.gdbVersion&&
(k.gdbVersion=this.gdbVersion);var f=new L(l._dfdCanceller),r=this.requestOptions,q=this._url.path;this.source&&void 0!==this.source.mapLayerId&&null!==this.source.mapLayerId&&q.endsWith("/dynamicLayer")&&(q=q.slice(0,-13),q=q+"/"+this.source.mapLayerId);f._pendingDfd=d({url:q+"/queryRelatedRecords",content:k,callbackParamName:"callback",timeout:r&&r.timeout,load:function(b,h){A(b,h,x,y,f)},error:function(b){a(b,y,f)}},r);return f},executeForIds:function(k,x,y,A){var a=A.assembly;k=this._encode(G.mixin({},
this._url.query,{f:"json",returnIdsOnly:!0},k.toJson(a&&a[0])));var f=this._executeForIdsHandler,r=this._errorHandler;this.source&&(a={source:this.source.toJson()},k.layer=D.toJson(a));this.gdbVersion&&(k.gdbVersion=this.gdbVersion);a=this.requestOptions;return d({url:this._url.path+"/query",content:k,callbackParamName:"callback",timeout:a&&a.timeout,load:function(q,b){f(q,b,x,y,A.dfd)},error:function(q){r(q,y,A.dfd)}},a)},executeForCount:function(k,x,y,A){var a=A.assembly;k=this._encode(G.mixin({},
this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},k.toJson(a&&a[0])));var f=this._countHandler,r=this._errorHandler;this.source&&(a={source:this.source.toJson()},k.layer=D.toJson(a));this.gdbVersion&&(k.gdbVersion=this.gdbVersion);a=this.requestOptions;return d({url:this._url.path+"/query",content:k,callbackParamName:"callback",timeout:a&&a.timeout,load:function(q,b){f(q,b,x,y,A.dfd)},error:function(q){r(q,y,A.dfd)}},a)},executeForExtent:function(k,x,y,A){var a=A.assembly;k=this._encode(G.mixin({},
this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},k.toJson(a&&a[0])));var f=this._extentHandler,r=this._errorHandler;this.source&&(a={source:this.source.toJson()},k.layer=D.toJson(a));this.gdbVersion&&(k.gdbVersion=this.gdbVersion);a=this.requestOptions;return d({url:this._url.path+"/query",content:k,callbackParamName:"callback",timeout:a&&a.timeout,load:function(q,b){f(q,b,x,y,A.dfd)},error:function(q){r(q,y,A.dfd)}},a)},_handler:function(k,x,y,A,a){try{k&&x&&(k=z.pbfDeps.optimizedFeatures.convertToFeatureSet(z.pbfDeps.pbfQueryUtils.parsePBFFeatureQuery(k)));
var f=new p(k);this._successHandler([f],"onComplete",y,a)}catch(r){this._errorHandler(r,A,a)}},_relationshipQueryHandler:function(k,x,y,A,a){try{var f=k.geometryType,r=k.spatialReference,q={};M.forEach(k.relatedRecordGroups,function(b){var h={};h.geometryType=f;h.spatialReference=r;h.features=b.relatedRecords;h=new p(h);if(null!=b.objectId)q[b.objectId]=h;else for(var t in b)b.hasOwnProperty(t)&&"relatedRecords"!==t&&(q[b[t]]=h)});this._successHandler([q],"onExecuteRelationshipQueryComplete",y,a)}catch(b){this._errorHandler(b,
A,a)}},_executeForIdsHandler:function(k,x,y,A,a){try{this._successHandler([k.objectIds],"onExecuteForIdsComplete",y,a)}catch(f){this._errorHandler(f,A,a)}},_countHandler:function(k,x,y,A,a){try{var f=k.features,r=k.objectIds;if(r)var q=r.length;else{if(f)throw Error("Unable to perform query. Please check your parameters.");q=k.count}this._successHandler([q],"onExecuteForCountComplete",y,a)}catch(b){this._errorHandler(b,A,a)}},_extentHandler:function(k,x,y,A,a){try{k.extent&&(k.extent=new n(k.extent)),
this._successHandler([k],"onExecuteForExtentComplete",y,a)}catch(f){this._errorHandler(f,A,a)}}});z.loadPBFReader=function(){var k=new L;z.pbfDeps?k.resolve():K(["./support/pbfDeps"],function(x){z.pbfDeps=x;k.isFulfilled()||k.resolve()});return k.promise};m._createWrappers(z);c("extend-esri")&&G.setObject("tasks.QueryTask",z,e);return z})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(K,F,G){K.DeferredList=function(M,L,D,u,e){var c=[];F.call(this);
var d=this;0!==M.length||L||this.resolve([0,[]]);var l=0;G.forEach(M,function(n,m){function g(p,v){c[m]=[p,v];l++;l===M.length&&d.resolve(c)}n.then(function(p){L?d.resolve([m,p]):g(!0,p)},function(p){D?d.reject(p):g(!1,p);if(u)return null;throw p;})})};K.DeferredList.prototype=new F;K.DeferredList.prototype.gatherResults=function(M){M=new K.DeferredList(M,!1,!0,!1);M.addCallback(function(L){var D=[];G.forEach(L,function(u){D.push(u[1])});return D});return M};return K.DeferredList})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),
function(K,F,G,M,L,D,u,e){K=K(e,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(c,d){c&&F.isString(c)&&(this._url=u.urlToObject(this.url=c));d&&d.requestOptions&&(this.requestOptions=d.requestOptions);this.normalization=!0;this._errorHandler=F.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var c=this._url,d=/^http:/i;this.url&&(this.url=this.url.replace(d,"https:"));c&&c.path&&(c.path=c.path.replace(d,"https:"))},
_encode:function(c,d,l){var n={},m;for(m in c)if("declaredClass"!==m){var g=c[m];var p=typeof g;if(null!==g&&void 0!==g&&"function"!==p)if(F.isArray(g)){n[m]=[];var v=g.length;for(p=0;p<v;p++)n[m][p]=this._encode(g[p])}else"object"===p?g.toJson&&(p=g.toJson(l&&l[m]),"esri.tasks.FeatureSet"===g.declaredClass&&p.spatialReference&&(p.sr=p.spatialReference,delete p.spatialReference),n[m]=d?p:G.toJson(p)):n[m]=g}return n},_successHandler:function(c,d,l,n){d&&this[d].apply(this,c);l&&l.apply(null,c);n&&
D._resDfd(n,c)},_errorHandler:function(c,d,l){this.onError(c);d&&d(c);l&&l.errback(c)},setNormalization:function(c){this.normalization=c},onError:function(){}});M("extend-esri")&&(L.Task=K);return K})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(K,F,G,M,L,D,u,e,c,d,l,n){K=K(null,{declaredClass:"esri.tasks.FeatureSet",
constructor:function(m,g){if(m){F.mixin(this,m);var p=this.features=this.features||[],v=m.spatialReference;v=this.spatialReference=l.createInstance(e.simpleConstructor,v);var B=l.getGeometryType(m.geometryType);this.geometryType=m.geometryType;m.fields&&(this.fields=m.fields);m=l.supportsLazyUnquantization(this.geometryType);var z=l.unquantizeFunction(this.geometryType,this.transform),k=!!(g&&m&&z),x=B&&(k?B.accessorConstructor:B.simpleConstructor);G.forEach(p,function(y,A){var a=l.createInstance(u.simpleConstructor),
f=y.geometry;if(B&&f){var r=a.geometry=l.createInstance(x,k?null:f);r.setSpatialReference(f.spatialReference?l.createInstance(e.simpleConstructor,f.spatialReference):v);k&&r.setupLazyUnquantization(z,f)}a.symbol=y.symbol?n.fromJson(y.symbol):null;a.attributes=y.attributes;p[A]=a});k||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(m){var g={};this.displayFieldName&&(g.displayFieldName=this.displayFieldName);this.fields&&
(g.fields=this.fields);this.spatialReference?g.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(g.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(g.geometryType=l.getJsonType(this.features[0].geometry)),g.features=c._encodeGraphics(this.features,m));g.geometryType=g.geometryType||this.geometryType;g.exceededTransferLimit=this.exceededTransferLimit;g.transform=this.transform;return D.fixJson(g)},
_hydrate:function(){l.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(m){if(!this.geometryType)return this.transform=null,this;var g=m.translate[0],p=m.translate[1],v=m.scale[0],B=m.scale[1],z=this.features,k=function(a,f,r){var q,b=[];var h=0;for(q=a.length;h<q;h++){var t=a[h];if(0<h){var E=f(t[0]);t=r(t[1]);if(E!==C||t!==w){b.push([E-C,t-w]);var C=E;var w=t}}else C=f(t[0]),w=r(t[1]),b.push([C,w])}return 0<b.length?b:null},x=function(a,f,r){if("esriGeometryPoint"===
a)return function(q){q.x=f(q.x);q.y=r(q.y);return q};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(q){var b;var h=q.rings||q.paths;var t=[];var E=0;for(b=h.length;E<b;E++){var C=h[E];(C=k(C,f,r))&&t.push(C)}return 0<t.length?(q.rings?q.rings=t:q.paths=t,q):null};if("esriGeometryMultipoint"===a)return function(q){var b=k(q.points,f,r);return 0<b.length?(q.points=b,q):null};if("esriGeometryEnvelope"===a)return function(q){return q}}(this.geometryType,function(a){return Math.round((a-
g)/v)},function(a){return Math.round((p-a)/B)}),y;var A=0;for(y=z.length;A<y;A++)z[A].geometry&&(x(z[A].geometry)||z[A].setGeometry(null));this.transform=m;return this}});K.createGraphics=function(m){var g=m.geometryType,p=l.createInstance(e.simpleConstructor,m.spatialReference),v=l.getGeometryType(g).accessorConstructor,B=l.unquantizeFunction(g,m.transform);return G.map(m.features,function(z,k){k=l.createInstance(u.simpleConstructor);var x=z.geometry;if(x){var y=k.geometry=l.createInstance(v);y.setSpatialReference(p);
y.setupLazyUnquantization(B,x)}k.attributes=z.attributes;return k})};K.createPolygon=function(m,g,p){if(m){var v=l.createInstance(d.accessorConstructor);v.setSpatialReference(g);g=l.unquantizeFunction("esriGeometryPolygon",p);v.setupLazyUnquantization(g,m)}return v};M("extend-esri")&&F.setObject("tasks.FeatureSet",K,L);return K})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(K,F,G,M,L){K=K(null,{declaredClass:"esri.tasks.RelationshipQuery",
definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,orderByFields:null,toJson:function(){var D={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},u=this.objectIds,e=this.outFields,c=this.outSpatialReference,d=this.orderByFields;u&&(D.objectIds=u.join(","));e&&(D.outFields=e.join(","));
c&&(D.outSR=c.wkid||G.toJson(c.toJson()));d&&(D.orderByFields=d.join(","));D._ts=this._ts;return D}});M("extend-esri")&&F.setObject("tasks.RelationshipQuery",K,L);return K})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(K,F,G,M){K=K(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,
maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});G("extend-esri")&&F.setObject("tasks.StatisticDefinition",K,M);return K})},"esri/arcadeProfiles/popupProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(K,F,G,M,L,D,u,e){K=new (K(null,{declaredClass:"esri.arcadeProfiles.PopupProfile",defaults:{globals:{featureSet:["$layer","$datastore",
"$map","$aggregatedfeatures"],async:["$layer","$datastore","$map","$aggregatedfeatures"]},context:{vars:{$feature:"any",$layer:"any",$datastore:"any",$map:"any",$aggregatedfeatures:"any"}}},initialize:function(c){var d=[];e.hasGeometryOperations(c)&&d.push(u.enableGeometryOperations());(e.hasFeatureSetOperations(c)||e.hasVariables(c,this.defaults.globals.featureSet))&&d.push(u.enableFeatureSetOperations());e.isAsync(c)&&d.push(u.enableAsyncOperations());return L(d)},isAsync:function(c){c=[c];return e.hasFeatureSetOperations(c)||
e.hasVariables(c,this.defaults.globals.async)},parse:function(c){return u.createSyntaxTree(c.expression)},compile:function(c){var d=F.clone(this.defaults.context);d.useAsync=c.async;return c.syntaxTree?u.createFunction(c.syntaxTree,d):null},getEvalOptions:function(c){var d=c.expression,l=c.feature,n=c.layer,m=c.aggregatedFeaturesLayer,g=c.map;c=c.spatialReference;l=l&&d.hasVariable("$feature")?D.createFromGraphicLikeObject(l.geometry,l.attributes,n):null;var p,v;if(n){var B={spatialReference:c};d.hasVariable("$layer")&&
(p=n.getMap()?u.createFeatureSetFromLayer(n,B):u.createFeatureSetFromLayerUrl(n.url,B));if(d.hasVariable("$datastore"))var z=(z=e.getServiceUrl(n.url))?u.createFeatureSetCollectionFromServiceUrl(z,B):null;d.hasVariable("$aggregatedfeatures")&&m&&(v=m.getMap()?u.createFeatureSetFromLayer(m,B):null)}d=g&&d.hasVariable("$map")?u.createFeatureSetCollectionFromMap(g):null;return{context:{vars:{$feature:l,$layer:p,$datastore:z,$map:d,$aggregatedfeatures:v},spatialReference:c}}}}));G("extend-esri")&&F.setObject("arcadeProfiles.popupProfile",
K,M);return K})},"esri/core/timerUtils":function(){define([],function(){function K(D){var u,e=D.length;for(u=0;u<e;u++)D[u]()}var F={LOW:1,HIGH:2},G,M={};M[F.LOW]=[];M[F.HIGH]=[];var L=function(){clearTimeout(G);G=null;var D=M[F.HIGH];M[F.HIGH]=[];K(D);D=M[F.LOW];M[F.LOW]=[];K(D)};return{priority:F,callbackQueue:M,setTimeout:function(D,u){D=[u,M[u].push(D)-1];G||(G=setTimeout(L,0));return D},clearTimeout:function(D){D&&M[D[0]].splice(D[1],1)}}})},"esri/arcadeProfiles/labelingProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),
function(K,F,G,M,L,D,u,e){K=new (K(null,{declaredClass:"esri.arcadeProfiles.LabelingProfile",defaults:{context:{vars:{$feature:"any"}}},initialize:function(c){var d=[];e.hasGeometryOperations(c)&&d.push(u.enableGeometryOperations());return L(d)},isAsync:function(c){return!1},parse:function(c){return u.createSyntaxTree(c.expression)},compile:function(c){var d=F.clone(this.defaults.context);return c.syntaxTree?u.createFunction(c.syntaxTree,d):null},getEvalOptions:function(c){var d=c.feature;return{context:{vars:{$feature:d&&
c.expression.hasVariable("$feature")?D.createFromGraphicLikeObject(d.geometry,d.attributes,c.layer):null},spatialReference:c.spatialReference}}}}));G("extend-esri")&&F.setObject("arcadeProfiles.labelingProfile",K,M);return K})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),function(K,F,G,M,L,D){K=K(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",
constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(u,e){this._labelLayer=e;this._xmin=u.extent.xmin;this._xmax=u.extent.xmax;this._ymin=u.extent.ymin;this._ymax=u.extent.ymax;this._scale=(this._xmax-this._xmin)/u.width},_process:function(u){this._preparedLabels=u;this._placedLabels=[];var e;for(u=this._preparedLabels.length-1;0<=u;u--){var c=this._preparedLabels[u],
d=Math.min(c.labelWidth,c.labelHeight),l=c.labelWidth+0*d;d=c.labelHeight+0*d;var n=(e=c.options)&&void 0!==e.lineLabelPlacement?e.lineLabelPlacement:"PlaceAtCenter",m=e&&void 0!==e.lineLabelPosition?e.lineLabelPosition:"Above",g=e&&void 0!==e.pointPriorities?e.pointPriorities:"AboveRight",p=[2,2,1,3,0,2,3,3,2];"AboveLeft"==g?p=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==g?p=[2,1,2,2,0,2,3,3,3]:"AboveRight"==g?p=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==g?p=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==g?p=[0,0,0,0,1,0,0,0,
0]:"CenterRight"==g?p=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==g?p=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==g?p=[3,3,3,2,0,2,2,1,2]:"BelowRight"==g&&(p=[3,3,2,3,0,2,2,2,1]);var v=e&&void 0!==e.labelRotation?e.labelRotation:!0;g=Math.PI/180*c.angle;e=e&&void 0!==e.howManyLabels?e.howManyLabels:"OneLabel";if("point"==c.geometry.type)this._generatePointPositions(c,c.geometry.x,c.geometry.y,c.text,g,l,d,c.symbolWidth,c.symbolHeight,p);else if("multipoint"==c.geometry.type)for(n=c.geometry,m=0;m<n.points.length;m++)this._generatePointPositions(c,
n.points[m][0],n.points[m][1],c.text,g,l,d,c.symbolWidth,c.symbolHeight,p);else"polyline"==c.geometry.type?this._generateLinePositions(c,c.geometry,c.text,l,d,2*c.symbolHeight+d,n,m,v):"polygon"==c.geometry.type&&this._generatePolygonPositions(c,e,c.geometry,c.text,g,l,d)}return this._placedLabels},_generatePointPositions:function(u,e,c,d,l,n,m,g,p,v){g=(g+n)*this._scale;p=(p+m)*this._scale;var B,z;for(B=1;3>=B;B++)for(z=1;9>=z;z++)if(v[z-1]==B)switch(z){case 1:if(this._findPlace(u,d,e-g,c+p,l,n,
m))return;break;case 2:if(this._findPlace(u,d,e,c+p,l,n,m))return;break;case 3:if(this._findPlace(u,d,e+g,c+p,l,n,m))return;break;case 4:if(this._findPlace(u,d,e-g,c,l,n,m))return;break;case 5:if(this._findPlace(u,d,e,c,l,n,m))return;break;case 6:if(this._findPlace(u,d,e+g,c,l,n,m))return;break;case 7:if(this._findPlace(u,d,e-g,c-p,l,n,m))return;break;case 8:if(this._findPlace(u,d,e,c-p,l,n,m))return;break;case 9:if(this._findPlace(u,d,e+g,c-p,l,n,m))return}},_generateLinePositions:function(u,e,c,
d,l,n,m,g,p){var v=d*this._scale*d*this._scale,B,z;for(B=0;B<e.paths.length;B++){var k=e.paths[B],x=k.length,y=Math.floor((x-1)/2),A=0!==(x-1)%2?1:-1;"PlaceAtStart"==m&&(y=0,A=1);"PlaceAtEnd"==m&&(y=x-2,A=-1);for(;0<=y&&y<x-1;){for(z=y;z<x;z++){var a=k[y][0],f=k[y][1],r=k[z][0]-a,q=k[z][1]-f;if(r*r+q*q>v){for(var b=Math.atan2(q,r);b>Math.PI/2;)b-=Math.PI;for(;b<-(Math.PI/2);)b+=Math.PI;var h=Math.sin(b),t=Math.cos(b),E=0,C=0;"Above"==g&&(E=n*h*this._scale,C=n*t*this._scale);"Below"==g&&(E=-n*h*this._scale,
C=-n*t*this._scale);if(1==z-y){if(this._clipLine(a,f,k[z][0],k[z][1])){a=this._x1-this._x0;var w=this._y1-this._y0;if(a*a+w*w>v&&(z=Math.atan2(w,a),r=d/2+2*l,f=r*this._scale*Math.cos(z),r=r*this._scale*Math.sin(z),"PlaceAtStart"==m?(a=this._x0+f,w=this._y0+r):"PlaceAtEnd"==m?(a=this._x1-f,w=this._y1-r):(a=this._x0+a/2,w=this._y0+w/2),this._findPlace(u,c,a-E,w+C,p?-z:0,d,l)))return}}else{var I=0;for(w=y;w<=z;w++)I=Math.max(I,Math.abs((k[w][1]-f)*t-(k[w][0]-a)*h));if(I<l&&this._findPlace(u,c,a+r/2-
E,f+q/2+C,p?-b:0,d,l))return}break}}y+=A}}},_generatePolygonPositions:function(u,e,c,d,l,n,m){if("ManyLabels"==e)for(e=0;e<c.rings.length;e++){var g=c.rings[e];D.prototype.isClockwise(g)&&(g=this._findCentroid(g,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(u,d,g[0],g[1],l,n,m))}else{g=this._findCentroidForFeature(c,this._xmin,this._ymin,this._xmax,this._ymax);var p=g[1],v=0;for(e=0;10>e;e++){v+=m/4;g=this._findCentroidForFeature(c,this._xmin,p+(v-m/4),this._xmax,p+(v+m/4));if(this._findPlace(u,
d,g[0],g[1],l,n,m))break;g=this._findCentroidForFeature(c,this._xmin,p-(v+m/4),this._xmax,p-(v-m/4));if(this._findPlace(u,d,g[0],g[1],l,n,m))break}}},_findCentroid:function(u,e,c,d,l){var n=u.length,m=[0,0],g=0,p=u[0][0],v=u[0][1];p>d&&(p=d);p<e&&(p=e);v>l&&(v=l);v<c&&(v=c);for(var B=1;B<n-1;B++){var z=u[B][0],k=u[B][1],x=u[B+1][0],y=u[B+1][1];z>d&&(z=d);z<e&&(z=e);k>l&&(k=l);k<c&&(k=c);x>d&&(x=d);x<e&&(x=e);y>l&&(y=l);y<c&&(y=c);var A=(z-p)*(y-v)-(x-p)*(k-v);m[0]+=A*(p+z+x);m[1]+=A*(v+k+y);g+=A}m[0]/=
3*g;m[1]/=3*g;if(isNaN(m[0])||isNaN(m[1]))return m;c=[];this._fillBuffer(u,c,m);m[0]=this._sortBuffer(c,m[0],e,d);return m},_findCentroidForFeature:function(u,e,c,d,l){for(var n,m=0,g=[0,0],p=0;p<u.rings.length;p++){var v=u.rings[p],B=v.length,z=v[0][0],k=v[0][1];z>d&&(z=d);z<e&&(z=e);k>l&&(k=l);k<c&&(k=c);for(n=1;n<B-1;n++){var x=v[n][0],y=v[n][1],A=v[n+1][0],a=v[n+1][1];x>d&&(x=d);x<e&&(x=e);y>l&&(y=l);y<c&&(y=c);A>d&&(A=d);A<e&&(A=e);a>l&&(a=l);a<c&&(a=c);var f=(x-z)*(a-k)-(A-z)*(y-k);g[0]+=f*
(z+x+A);g[1]+=f*(k+y+a);m+=f}}g[0]/=3*m;g[1]/=3*m;if(isNaN(g[0])||isNaN(g[1]))return g;c=[];for(n=0;n<u.rings.length;n++)this._fillBuffer(u.rings[n],c,g);g[0]=this._sortBuffer(c,g[0],e,d);return g},_fillBuffer:function(u,e,c){for(var d=u.length-1,l=u[0][1]>=u[d][1]?1:-1,n=0;n<=d;n++){var m=n,g=n+1;n==d&&(g=0);var p=u[m][0];m=u[m][1];var v=u[g][0];g=u[g][1];var B=g>=m?1:-1;if(m<=c[1]&&c[1]<=g||g<=c[1]&&c[1]<=m)c[1]!=m&&c[1]!=g?(e.push((c[1]-m)*(v-p)/(g-m)+p),l=B):c[1]==m&&c[1]!=g?(l!=B&&e.push(p),
l=B):c[1]!=m&&c[1]==g?(e.push(v),l=B):c[1]==m&&c[1]==g&&(1==l&&e.push(p),e.push(v),l=B)}},_sortBuffer:function(u,e,c,d){var l=u.length;u.sort();if(0<l){for(var n=0,m=e=0;m<l-1;m+=2){var g=Math.abs(u[m+1]-u[m]);!(u[m]<=c&&u[m+1]<=c||u[m]>=d&&u[m+1]>=d)&&g>n&&(n=g,e=m)}l=u[e];u=u[e+1];l>d&&(l=d);l<c&&(l=c);u>d&&(u=d);u<c&&(u=c);e=(l+u)/2}return e},_findPlace:function(u,e,c,d,l,n,m){if(isNaN(c)||isNaN(d))return!1;for(var g=0;g<this._placedLabels.length;g++){var p=this._placedLabels[g].angle,v=this._placedLabels[g].width*
this._scale,B=this._placedLabels[g].height*this._scale,z=this._placedLabels[g].x-c,k=this._placedLabels[g].y-d;if(0===l&&0===p){if(this._findPlace2(-n*this._scale,-m*this._scale,n*this._scale,m*this._scale,z-v,k-B,z+v,k+B))return!1}else{var x=new L(-n*this._scale,-m*this._scale,n*this._scale,m*this._scale,null),y=0,A=1;0!==l&&(y=Math.sin(l),A=Math.cos(l));var a=z*A-k*y;z=z*y+k*A;p-=l;y=Math.sin(p);A=Math.cos(p);var f=-v*A- -B*y;k=-v*y+-B*A;p=+v*A- -B*y;var r=+v*y+-B*A;v=a+f;B=z-k;y=a+p;A=z-r;f=a-
f;k=z+k;a-=p;z+=r;p=new D;p.addRing([[v,B],[y,A],[f,k],[a,z],[v,B]]);if(x.intersects(p))return!1}}for(;l>Math.PI/2;)l-=Math.PI;for(;l<-(Math.PI/2);)l+=Math.PI;g={};g.layer=u;g.text=e;g.angle=l;g.x=c;g.y=d;g.width=n;g.height=m;this._placedLabels.push(g);return!0},_findPlace2:function(u,e,c,d,l,n,m,g){return(u>=l&&u<=m||c>=l&&c<=m||u<=l&&c>=m)&&(e>=n&&e<=g||d>=n&&d<=g||e<=n&&d>=g)?!0:!1},_clipLine:function(u,e,c,d){for(var l=this._code(u,e),n=this._code(c,d);0!==l||0!==n;){if(0!==(l&n))return!1;var m=
c-u,g=d-e;0!==l?(u<this._xmin?(e+=g*(this._xmin-u)/m,u=this._xmin):u>this._xmax?(e+=g*(this._xmax-u)/m,u=this._xmax):e<this._ymin?(u+=m*(this._ymin-e)/g,e=this._ymin):e>this._ymax&&(u+=m*(this._ymax-e)/g,e=this._ymax),l=this._code(u,e)):(c<this._xmin?(d+=g*(this._xmin-c)/m,c=this._xmin):c>this._xmax?(d+=g*(this._xmax-c)/m,c=this._xmax):d<this._ymin?(c+=m*(this._ymin-d)/g,d=this._ymin):d>this._ymax&&(c+=m*(this._ymax-d)/g,d=this._ymax),n=this._code(c,d))}this._x0=u;this._y0=e;this._x1=c;this._y1=d;
return!0},_code:function(u,e){var c=0;u<this._xmin&&(c+=8);u>this._xmax&&(c+=4);e<this._ymin&&(c+=2);e>this._ymax&&(c+=1);return c}});G("extend-esri")&&F.setObject("layers.labelLayerUtils.DynamicLabelClass",K,M);return K})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),function(K,F,G,M,L,D,u){return K(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",
constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(e,c){this._labelLayer=c;this._map=e;this._xmin=e.extent.xmin;this._xmax=e.extent.xmax;this._ymin=e.extent.ymin;this._ymax=e.extent.ymax;this._scale=(this._xmax-this._xmin)/e.width},_process:function(e){var c;this._preparedLabels=e;this._placedLabels=
[];for(e=this._preparedLabels.length-1;0<=e;e--){var d=this._preparedLabels[e];var l=d.labelWidth;var n=d.labelHeight;var m=(c=d.options)&&c.lineLabelPlacement?c.lineLabelPlacement:"PlaceAtCenter";var g=c&&c.lineLabelPosition?c.lineLabelPosition:"Above";var p=c&&c.labelRotation?c.labelRotation:!0;var v=Math.PI/180*d.angle;var B=c&&c.howManyLabels?c.howManyLabels:"OneLabel";var z=[];if("point"===d.geometry.type)this._generatePointPositions(d.geometry.x,d.geometry.y,d.text,v,l,n,d.symbolWidth,d.symbolHeight,
c,z);else if("multipoint"===d.geometry.type)for(p=0;p<d.geometry.points.length;p++)this._generatePointPositions(d.geometry.points[p][0],d.geometry.points[p][1],d.text,v,l,n,d.symbolWidth,d.symbolHeight,c,z);else if("polyline"===d.geometry.type)if("PlaceAtStart"===m)this._generateLinePositionsPlaceAtStart(d.geometry,!0,d.text,l,n,2*d.symbolHeight+n,m,g,p,z);else if("PlaceAtEnd"===m)this._generateLinePositionsPlaceAtEnd(d.geometry,!0,d.text,l,n,2*d.symbolHeight+n,m,g,p,z);else{c=[];var k=d.geometry.getExtent(),
x=this._map.extent;if(k.getWidth()<l*this._scale/this._OVERRUN&&k.getHeight()<l*this._scale/this._OVERRUN)continue;else.5*k.getWidth()<x.getWidth()&&.5*k.getHeight()<x.getHeight()?this._generateLinePositionsPlaceAtCenter(d.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,d.text,l,n,2*d.symbolHeight+n,m,g,p,c):this._generateLinePositionsPlaceAtCenter(d.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,d.text,l,n,2*d.symbolHeight+n,m,g,p,c);this._postSorting(x,
c,z)}else if("polygon"===d.geometry.type){m=[];for(p=0;p<d.geometry.rings.length;p++)g=d.geometry.rings[p],1<d.geometry.rings.length&&!u.prototype.isClockwise(g)||(c=this._calcRingExtent(g),c.xmax-c.xmin<4*l*this._scale/this._OVERRUN&&c.ymax-c.ymin<4*n*this._scale/this._OVERRUN||m.push(g));m.sort(function(y,A){return A.length-y.length});for(p=0;p<m.length;p++)this._generatePolygonPositionsForManyLabels(m[p],d.geometry.spatialReference,d.text,v,l,n,z)}for(p=0;p<z.length&&(m=z[p].x,g=z[p].y,void 0!==
z[p].angle&&(v=z[p].angle),c=this._findPlace(d,d.text,m,g,v,l,n),"OneLabel"!==B||!c||!this._labelLayer._isWithinScreenArea(new D(m,g,d.geometry.spatialReference)));p++);}return this._placedLabels},_generatePointPositions:function(e,c,d,l,n,m,g,p,v,B){d=v&&v.pointPriorities?v.pointPriorities:"AboveRight";n=(g+n)*this._scale;m=(p+m)*this._scale;switch(d.toLowerCase()){case "aboveleft":e-=n;c+=m;break;case "abovecenter":c+=m;break;case "aboveright":e+=n;c+=m;break;case "centerleft":e-=n;break;case "centercenter":break;
case "centerright":e+=n;break;case "belowleft":e-=n;c-=m;break;case "belowcenter":c-=m;break;case "belowright":e+=n;c-=m;break;default:return}B.push({x:e,y:c})},_generateLinePositionsPlaceAtStart:function(e,c,d,l,n,m,g,p,v,B){g=l*this._scale;var z=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,k,x;for(k=0;k<e.paths.length;k++){var y=e.paths[k],A=g,a=0;for(x=0;x<y.length-1;x++){var f=y[x][0];var r=y[x][1];var q=y[x+1][0];var b=y[x+1][1];var h=q-f;var t=b-r;h=Math.sqrt(h*
h+t*t);a+h>A?(a=this._generatePositionsOnLine(e.spatialReference,c,A,z,a,f,r,q,b,d,l,n,m,p,v,B),A=z):a+=h}}},_generateLinePositionsPlaceAtEnd:function(e,c,d,l,n,m,g,p,v,B){g=l*this._scale;var z=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,k,x;for(k=0;k<e.paths.length;k++){var y=e.paths[k],A=g,a=0;for(x=y.length-2;0<=x;x--){var f=y[x+1][0];var r=y[x+1][1];var q=y[x][0];var b=y[x][1];var h=q-f;var t=b-r;h=Math.sqrt(h*h+t*t);a+h>A?(a=this._generatePositionsOnLine(e.spatialReference,
c,A,z,a,f,r,q,b,d,l,n,m,p,v,B),A=z):a+=h}}},_generateLinePositionsPlaceAtCenter:function(e,c,d,l,n,m,g,p,v,B,z){var k;for(p=0;p<e.paths.length;p++){var x=e.paths[p];if(!(2>x.length)){if(2==x.length){var y=x[0];var A=x[1];var a=y[0];y=y[1];x=A[0];var f=A[1];var r=(x-a)*(x-a)+(f-y)*(f-y);var q=Math.atan2(f-y,x-a);f=Math.cos(q);q=Math.sin(q);x=[];var b=a;for(var h=y;(b-a)*(b-a)+(h-y)*(h-y)<r;)x.push([b,h]),b+=d/2*f,h+=d/2*q;x.push(A)}var t=0;for(A=0;A<x.length-1;A++)a=x[A][0],y=x[A][1],r=x[A+1][0],f=
x[A+1][1],q=r-a,b=f-y,t+=Math.sqrt(q*q+b*b);for(A=h=0;A<x.length-1;A++){a=x[A][0];y=x[A][1];r=x[A+1][0];f=x[A+1][1];q=r-a;b=f-y;q=Math.sqrt(q*q+b*b);if(h+q>t/2)break;h+=q}A==x.length-1&&A--;a=x[A][0];y=x[A][1];r=x[A+1][0];f=x[A+1][1];q=r-a;b=f-y;h=t/2-h;q=Math.atan2(b,q);b=a+h*Math.cos(q);q=y+h*Math.sin(q);a=this._angleAndShifts(a,y,r,f,g,v,B);z.push({x:b+a.shiftX,y:q+a.shiftY,angle:a.angle});t=b;var E=q;h=0;for(k=A;k<x.length-1;k++)k==A?(a=t,y=E):(a=x[k][0],y=x[k][1]),r=x[k+1][0],f=x[k+1][1],q=r-
a,b=f-y,q=Math.sqrt(q*q+b*b),h=h+q>d?this._generatePositionsOnLine(e.spatialReference,c,d,d,h,a,y,r,f,l,n,m,g,v,B,z):h+q;h=0;for(k=A;0<=k;k--)k==A?(a=t,y=E):(a=x[k+1][0],y=x[k+1][1]),r=x[k][0],f=x[k][1],q=r-a,b=f-y,q=Math.sqrt(q*q+b*b),h=h+q>d?this._generatePositionsOnLine(e.spatialReference,c,d,d,h,a,y,r,f,l,n,m,g,v,B,z):h+q}}},_generatePositionsOnLine:function(e,c,d,l,n,m,g,p,v,B,z,k,x,y,A,a){B=Math.atan2(v-g,p-m);z=m;k=g;var f=z,r=k;do if(n=d-n,z+=n*Math.cos(B),k+=n*Math.sin(B),this._belongs(z,
k,m,g,p,v))n=this._angleAndShifts(m,g,p,v,x,y,A),d=z+n.shiftX,r=k+n.shiftY,c?this._labelLayer._isWithinScreenArea(new L(d,r,d,r,e))&&a.push({x:d,y:r,angle:n.angle}):a.push({x:d,y:r,angle:n.angle}),f=z,r=k,n=0,d=l;else return e=p-f,v-=r,Math.sqrt(e*e+v*v);while(1)},_postSorting:function(e,c,d){if(e&&0<c.length){var l=.5*(e.xmin+e.xmax);e=.5*(e.ymin+e.ymax);for(var n=c[0].x,m=c[0].y,g=Math.sqrt((n-l)*(n-l)+(m-e)*(m-e)),p=c[0].angle,v=0;v<c.length;v++){var B=c[v].x,z=c[v].y,k=Math.sqrt((B-l)*(B-l)+(z-
e)*(z-e));k<g&&(n=B,m=z,g=k,p=c[v].angle)}d.push({x:n,y:m,angle:p})}},_belongs:function(e,c,d,l,n,m){if(n==d&&m==l)return!1;if(n>d){if(e>n||e<d)return!1}else if(e<n||e>d)return!1;if(m>l){if(c>m||c<l)return!1}else if(c<m||c>l)return!1;return!0},_angleAndShifts:function(e,c,d,l,n,m,g){for(e=Math.atan2(l-c,d-e);e>Math.PI/2;)e-=Math.PI;for(;e<-(Math.PI/2);)e+=Math.PI;l=Math.sin(e);var p=Math.cos(e);d=c=0;"Above"==m&&(c=n*l*this._scale,d=n*p*this._scale);"Below"==m&&(c=-n*l*this._scale,d=-n*p*this._scale);
n=[];n.angle=g?-e:0;n.shiftX=-c;n.shiftY=d;return n},_generatePolygonPositionsForManyLabels:function(e,c,d,l,n,m,g){n=this._findCentroidForRing(e);l=n[0];var p=n[1],v=this._calcRingExtent(e);n=v.xmin;m=v.ymin;var B=v.xmax;v=v.ymax;var z=(v-m)/(this._map.height*this._scale);if(!(10<(B-n)/(this._map.width*this._scale)&&10<z)){var k=!0;if(B-n>this._map.width*this._scale||v-m>this._map.height*this._scale)k=!1;z=this._map.width*this._scale*(k?.1875:.5);k=this._map.height*this._scale*(k?.1875:.5);var x=
!0,y=!0,A=0;do{p+=(A%2?-1:1)*A*k;if(this._scanRingByX(d,c,e,l,p,n,B,z,g))break;p<m&&(x=!1);p>v&&(y=!1);A++}while(x||y)}},_scanRingByX:function(e,c,d,l,n,m,g,p,v){var B=!0,z=!0,k=0,x=1E3;do{l+=(k%2?-1:1)*k*p;var y=this._movePointInsideRing(d,l,n),A=this._labelLayer._isWithinScreenArea(new L(y,n,y,n,c)),a=this._isPointWithinRing(e,d,y,n);if(A&&a)return v.push({x:y,y:n}),!0;l<m&&(B=!1);l>g&&(z=!1);k++;x--;if(0>=x)return!0}while(B||z);return!1},_movePointInsideRing:function(e,c,d){for(var l=[],n=e.length-
1,m=e[0][1]>=e[n][1]?1:-1,g=0;g<=n;g++){var p=g,v=g+1;g==n&&(v=0);var B=e[p][0];p=e[p][1];var z=e[v][0];v=e[v][1];var k=v>=p?1:-1;if(p<=d&&d<=v||v<=d&&d<=p)d!=p&&d!=v?(l.push((d-p)*(z-B)/(v-p)+B),m=k):d==p&&d!=v?(m!=k&&l.push(B),m=k):d!=p&&d==v?(l.push(z),m=k):d==p&&d==v&&(1==m&&l.push(B),l.push(z),m=k)}l.sort(function(x,y){return x-y});e=l.length;if(0<e){for(g=d=c=0;g<e-1;g+=2)n=Math.abs(l[g+1]-l[g]),n>c&&(c=n,d=g);c=(l[d]+l[d+1])/2}return c},_calcRingExtent:function(e){var c;var d=new L;for(c=0;c<
e.length-1;c++){var l=e[c][0],n=e[c][1];if(void 0===d.xmin||l<d.xmin)d.xmin=l;if(void 0===d.ymin||n<d.ymin)d.ymin=n;if(void 0===d.xmax||l>d.xmax)d.xmax=l;if(void 0===d.ymax||n>d.ymax)d.ymax=n}return d},_isPointWithinPolygon:function(e,c,d,l){var n;for(n=0;n<c.rings.length;n++)if(this._isPointWithinRing(e,c.rings[n],d,l))return!0;return!1},_isPointWithinRing:function(e,c,d,l){var n=[],m=c.length;for(e=0;e<m-1;e++){var g=c[e][0];var p=c[e][1];var v=c[e+1][0];var B=c[e+1][1];if(g!=v||p!=B){if(p==B)if(l==
p)n.push(g);else continue;g==v?(p<B&&l>=p&&l<B&&n.push(g),p>B&&l<=p&&l>B&&n.push(g)):(p=(v-g)/(B-p)*(l-p)+g,g<v&&p>=g&&p<v&&n.push(p),g>v&&p<=g&&p>v&&n.push(p))}}n.sort(function(z,k){return z-k});for(e=0;e<n.length-1;e++)if(g=n[e],v=n[e+1],d>=g&&d<v)if(e%2)break;else return!0;return!1},_findCentroidForRing:function(e){for(var c=e.length,d=[0,0],l=0,n=e[0][0],m=e[0][1],g=1;g<c-1;g++){var p=e[g][0],v=e[g][1],B=e[g+1][0],z=e[g+1][1],k=(p-n)*(z-m)-(B-n)*(v-m);d[0]+=k*(n+p+B);d[1]+=k*(m+v+z);l+=k}d[0]/=
3*l;d[1]/=3*l;return d},_findCentroidForFeature:function(e){for(var c=0,d=[0,0],l=0;l<e.rings.length;l++)for(var n=e.rings[l],m=n.length,g=n[0][0],p=n[0][1],v=1;v<m-1;v++){var B=n[v][0],z=n[v][1],k=n[v+1][0],x=n[v+1][1],y=(B-g)*(x-p)-(k-g)*(z-p);d[0]+=y*(g+B+k);d[1]+=y*(p+z+x);c+=y}d[0]/=3*c;d[1]/=3*c;return d},_findPlace:function(e,c,d,l,n,m,g){if(isNaN(d)||isNaN(l))return!1;for(var p=0;p<this._placedLabels.length;p++){var v=this._placedLabels[p].angle,B=this._placedLabels[p].width*this._scale,z=
this._placedLabels[p].height*this._scale,k=this._placedLabels[p].x-d,x=this._placedLabels[p].y-l;if(0===n&&0===v){if(this._findPlace2(-m*this._scale,-g*this._scale,m*this._scale,g*this._scale,k-B,x-z,k+B,x+z))return!1}else{var y=new L(-m*this._scale,-g*this._scale,m*this._scale,g*this._scale,null),A=0,a=1;0!==n&&(A=Math.sin(n),a=Math.cos(n));var f=k*a-x*A;k=k*A+x*a;v-=n;A=Math.sin(v);a=Math.cos(v);var r=-B*a- -z*A;x=-B*A+-z*a;v=+B*a- -z*A;var q=+B*A+-z*a;B=f+r;z=k-x;A=f+v;a=k-q;r=f-r;x=k+x;f-=v;k+=
q;v=new u;v.addRing([[B,z],[A,a],[r,x],[f,k],[B,z]]);if(y.intersects(v))return!1}}for(;n>Math.PI/2;)n-=Math.PI;for(;n<-(Math.PI/2);)n+=Math.PI;p={};p.layer=e;p.text=c;p.angle=n;p.x=d;p.y=l;p.width=m;p.height=g;this._placedLabels.push(p);return!0},_findPlace2:function(e,c,d,l,n,m,g,p){return(e>=n&&e<=g||d>=n&&d<=g||e<=n&&d>=g)&&(c>=m&&c<=p||l>=m&&l<=p||c<=m&&l>=p)?!0:!1}})})},"*noref":1}});
define("esri/layers/LabelLayer","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/i18n!dojo/cldr/nls/number dojo/number dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ../ArcadeExpression ../core/timerUtils ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ../renderers/SimpleRenderer ../arcadeProfiles/labelingProfile ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ./GraphicsLayer ./LabelClass".split(" "),function(K,
F,G,M,L,D,u,e,c,d,l,n,m,g,p,v,B,z,k,x,y,A,a,f,r){function q(b){return"sizeInfo"===b.type}K=K(f,{declaredClass:"esri.layers.LabelLayer",constructor:function(b){this._refreshLabels=F.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];b&&(b.id&&(this.id=b.id),b.mode&&(this._engineType="DYNAMIC"===b.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(b){this._mapEventHandlers.push(b.on("extent-change",
F.hitch(this,"_handleLevelChange")));var h=this.inherited(arguments);this.refresh();return h},_unsetMap:function(){var b;for(b=0;b<this._mapEventHandlers.length;b++)M.disconnect(this._mapEventHandlers[b]);this.refresh();g.clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(b){this._engineType=b&&"DYNAMIC"===b.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(b,h,t,E){if(!this.getFeatureLayer(b.layerId)){var C=[];C.push(b.on("update-end",
F.hitch(this,"refresh")));C.push(b.on("suspend",F.hitch(this,"refresh")));C.push(b.on("resume",F.hitch(this,"refresh")));C.push(b.on("edits-complete",F.hitch(this,"refresh")));C.push(b.on("labeling-info-change",F.hitch(this,"refresh")));C.push(b.on("time-extent-change",F.hitch(this,"refresh")));C.push(b.on("show-labels-change",F.hitch(this,"refresh")));C.push(b.on("feature-reduction-change",F.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:b,LabelExpressionInfo:t,LabelingOptions:E,
LabelRenderer:h,EventHandlers:C});this.featureLayers.push(b);this.refresh()}},getFeatureLayer:function(b){var h;for(h=0;h<this.featureLayers.length;h++){var t=this.featureLayers[h];if(void 0!==t&&t.id==b)return t}return null},removeFeatureLayer:function(b){b=this.getFeatureLayer(b);if(void 0!==b){var h=G.indexOf(this.featureLayers,b);if(-1<h){this.featureLayers.splice(h,1);for(b=0;b<this._featureLayerInfos[h].EventHandlers.length;b++)M.disconnect(this._featureLayerInfos[h].EventHandlers[b]);this._featureLayerInfos.splice(h,
1);this.refresh()}}},removeAllFeatureLayers:function(){var b;for(b=0;b<this.featureLayers.length;b++){for(var h=0;h<this._featureLayerInfos[b].EventHandlers.length;h++)M.disconnect(this._featureLayerInfos[b].EventHandlers[h]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(b){var h;for(h=0;h<this.featureLayers.length;h++){var t=this.featureLayers[h];if(void 0!==t&&t.id==b)return this._featureLayerInfos[h]}return null},
refresh:function(){null==this._refreshHandle&&(this._refreshHandle=g.setTimeout(this._refreshLabels,g.priority.LOW))},_handleLevelChange:function(b){b.levelChange&&this.clear();this.refresh()},_refreshLabels:function(b){this._refreshHandle=null;var h=[],t,E="DYNAMIC"===this._engineType?new A:new a;if(this._map){E.setMap(this._map,this);this._preparedLabels=[];for(b=0;b<this.featureLayers.length;b++){var C=this.featureLayers[b];if(C.visible&&C.showLabels&&C.visibleAtMapScale&&!C._suspended){var w=
this._featureLayerInfos[b];var I=this._convertOptions(null);if(w.LabelRenderer){if(h=C.labelingInfo)if(t=h[0]){var J=this._getLabelExpression(t);I=this._convertOptions(t)}var H=w.LabelRenderer;w.LabelExpressionInfo&&(J=w.LabelExpressionInfo);w.LabelingOptions&&(I=this._convertOptions(null),void 0!==w.LabelingOptions.pointPriorities&&(h=w.LabelingOptions.pointPriorities,I.pointPriorities="above-center"==h||"AboveCenter"==h||"esriServerPointLabelPlacementAboveCenter"==h?"AboveCenter":"above-left"==
h||"AboveLeft"==h||"esriServerPointLabelPlacementAboveLeft"==h?"AboveLeft":"above-right"==h||"AboveRight"==h||"esriServerPointLabelPlacementAboveRight"==h?"AboveRight":"below-center"==h||"BelowCenter"==h||"esriServerPointLabelPlacementBelowCenter"==h?"BelowCenter":"below-left"==h||"BelowLeft"==h||"esriServerPointLabelPlacementBelowLeft"==h?"BelowLeft":"below-right"==h||"BelowRight"==h||"esriServerPointLabelPlacementBelowRight"==h?"BelowRight":"center-center"==h||"CenterCenter"==h||"esriServerPointLabelPlacementCenterCenter"==
h?"CenterCenter":"center-left"==h||"CenterLeft"==h||"esriServerPointLabelPlacementCenterLeft"==h?"CenterLeft":"center-right"==h||"CenterRight"==h||"esriServerPointLabelPlacementCenterRight"==h?"CenterRight":"AboveRight"),void 0!==w.LabelingOptions.lineLabelPlacement&&(I.lineLabelPlacement=w.LabelingOptions.lineLabelPlacement),void 0!==w.LabelingOptions.lineLabelPosition&&(I.lineLabelPosition=w.LabelingOptions.lineLabelPosition),void 0!==w.LabelingOptions.labelRotation&&(I.labelRotation=w.LabelingOptions.labelRotation),
void 0!==w.LabelingOptions.howManyLabels&&(I.howManyLabels=w.LabelingOptions.howManyLabels));H instanceof r&&(J=this._getLabelExpression(H),H=new x(H.symbol),I=this._convertOptions(H));this._addLabels(C,H,J,I)}else if(h=C.labelingInfo)for(w=h.length-1;0<=w;w--)if(t=h[w])H=new r(t instanceof r?t.toJson():t),J=this._getLabelExpression(t),I=this._convertOptions(t),this._addLabels(C,H,J,I)}}J=E._process(this._preparedLabels);this.clear();this.drawLabels(this._map,J)}},drawLabels:function(b,h){this._scale=
(b.extent.xmax-b.extent.xmin)/b.width;var t;for(t=0;t<h.length;t++){var E=h[t],C=E.x,w=E.y,I=E.text,J=E.angle,H=E.layer.labelSymbol;"polyline"==E.layer.geometry.type&&E.layer.options.labelRotation&&H.setAngle(180/Math.PI*J);H.setText(I);H instanceof p&&(I=H.getHeight(),C-=.25*I*this._scale*Math.sin(J),w-=.33*I*this._scale);J=new l(new z(C,w,b.extent.spatialReference));J.setParentGraphic(E.layer.graphic);J.setSymbol(H);this.add(J)}},_addLabels:function(b,h,t,E){var C;if(this._isWithinScaleRange(h.minScale,
h.maxScale)&&t&&""!==t){var w=this._map,I=!b.url&&!w.spatialReference.equals(b.spatialReference);for(C=0;C<b.graphics.length;C++){var J=b.graphics[C];if(!1!==J.visible&&!J._suspended){var H=J.geometry;if(I){if(!k.canProject(H,w))continue;H=k.project(H,w)}if(H&&this._isWhere(h.where,J.attributes)&&this._isWithinScreenArea(H)){var P=this._buildLabelText(t,J,b.fields,E);this._addLabel(P,h,b.renderer,J,E,H,w)}}}}},_isWithinScreenArea:function(b){b="point"===b.type?new B(b.x,b.y,b.x,b.y,b.spatialReference):
b.getExtent();if(void 0===b)return!1;b=this._intersects(this._map,b);return null===b||0===b.length?!1:!0},_isWithinScaleRange:function(b,h){var t=this._map.getScale();return 0<b&&t>=b||0<h&&t<h?!1:!0},_isWhere:function(b,h){try{if(!b)return!0;if(b){var t=b.split(" ");if(3===t.length)return this._sqlEquation(h[this._removeQuotes(t[0])],t[1],this._removeQuotes(t[2]));if(7===t.length){var E=this._sqlEquation(h[this._removeQuotes(t[0])],t[1],this._removeQuotes(t[2])),C=t[3],w=this._sqlEquation(h[this._removeQuotes(t[4])],
t[5],this._removeQuotes(t[6]));switch(C){case "AND":return E&&w;case "OR":return E||w}}}return!1}catch(I){console.log("Error.: can't parse \x3d "+b)}},_sqlEquation:function(b,h,t){switch(h){case "\x3d":return b==t?!0:!1;case "\x3c\x3e":return b!=t?!0:!1;case "\x3e":return b>t?!0:!1;case "\x3e\x3d":return b>=t?!0:!1;case "\x3c":return b<t?!0:!1;case "\x3c\x3d":return b<=t?!0:!1}return!1},_removeQuotes:function(b){var h=b.indexOf('"'),t=b.lastIndexOf('"');if(-1!=h&&-1!=t)return b.substr(1,b.length-
2);h=b.indexOf("'");t=b.lastIndexOf("'");return-1!=h&&-1!=t?b.substr(1,b.length-2):b},_getSizeInfo:function(b){return b?b.sizeInfo||G.filter(b.visualVariables,q)[0]:null},_addLabel:function(b,h,t,E,C,w,I){var J;if(b&&""!==F.trim(b)&&h){b=b.replace(/[\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/g," ");var H=h.getSymbol(E);H instanceof p?(H=new p(H.toJson()),H.setVerticalAlignment("baseline"),H.setHorizontalAlignment("center")):H=H instanceof v?new v(H.toJson()):new p;H.setText(b);
h.symbol=H;if(J=this._getProportionalSize(h.sizeInfo,E.attributes))H instanceof p?H.setSize(J):H instanceof v&&(H.setWidth(J),H.setHeight(J));var P=J=0;if(t){var O=t.getSymbol(E);var N=this._getSizeInfo(t);if((t=N?t.getSize(E,{sizeInfo:N,resolution:I.getResolutionInMeters()}):E.size)&&null!==t)J=P=t;else if(O)if("simplemarkersymbol"==O.type)P=J=O.size;else if("picturemarkersymbol"==O.type)J=O.width,P=O.height;else if("simplelinesymbol"==O.type||"cartographiclinesymbol"==O.type)J=O.width}t={};t.graphic=
E;t.options=C;t.geometry=w;t.labelRenderer=h;t.labelSymbol=H;t.labelWidth=H.getWidth()/2;t.labelHeight=H.getHeight()/2;t.symbolWidth=e.normalizedLength(J)/2;t.symbolHeight=e.normalizedLength(P)/2;t.text=b;t.angle=H.angle;this._preparedLabels.push(t)}},_buildLabelText:function(b,h,t,E){if(E.hasExpression)return b=y.getEvalOptions({expression:E.arcadeExpr,feature:h,layer:h.getLayer(),spatialReference:this._map.spatialReference}),h=h.evaluateExpression(E.arcadeExpr,b),d.isDefined(h)?""+h:"";var C=h.attributes;
return b.replace(/{[^}]*}/g,function(w){var I,J=w;for(I=0;I<t.length;I++)if("{"+t[I].name+"}"==w){J=C[t[I].name];var H=t[I].domain;if(H&&F.isObject(H)){if("codedValue"==H.type&&E.useCodedValues)for(I=J,w=0;w<H.codedValues.length;w++)if(H.codedValues[w].code==I){J=H.codedValues[w].name;break}break}H=t[I].type;if(E.fieldInfos){var P=E.fieldInfos;for(I=0;I<P.length;I++)if("{"+P[I].fieldName+"}"==w){w=P[I].format;"esriFieldTypeDate"==H?J=d.substitute({myKey:J},"${myKey}",{format:{myKey:F.mixin({formatType:"DateFormat"},
n.prototype._dateFormatsJson[w&&w.dateFormat||"shortDate"])}}):"esriFieldTypeInteger"!=H&&"esriFieldTypeSingle"!=H&&"esriFieldTypeSmallInteger"!=H&&"esriFieldTypeLong"!=H&&"esriFieldTypeDouble"!=H||!w||(J=D.format(J,{places:w.places}),w.digitSeparator||L.group&&(J=J.replace(new RegExp("\\"+L.group,"g"),"")));break}}break}else J="";return null==J?"":J})},_getLabelExpression:function(b){var h="";b.labelExpressionInfo?h=b.labelExpressionInfo.value||b.labelExpressionInfo.expression:this._validSyntax(b.labelExpression)&&
(h=this._convertLabelExpression(b.labelExpression));return h},_validSyntax:function(b){return/^(\s*\[[^\]]+\]\s*)+$/i.test(b)},_convertLabelExpression:function(b){return b.replace(/\[/g,"{").replace(/\]/g,"}")},_getProportionalSize:function(b,h){if(!b)return null;h=d.substitute(h,"${"+b.field+"}",{first:!0});return!(b.minSize&&b.maxSize&&b.minDataValue&&b.maxDataValue&&h)||0>=b.maxDataValue-b.minDataValue?null:(b.maxSize-b.minSize)/(b.maxDataValue-b.minDataValue)*(h-b.minDataValue)+b.minSize},_convertOptions:function(b){var h=
!0,t="shortDate",E=null,C=null,w="",I=!0;if(b&&(b.format&&(t=b.format.dateFormat,E={places:b.format.places,digitSeparator:b.format.digitSeparator}),C=b.fieldInfos,w=b.labelPlacement,null!=b.useCodedValues&&(h=b.useCodedValues),b=b.labelExpressionInfo)){var J=b.expression;if(J&&!b.value){var H=!0;var P=new m({expression:J,returnType:"string",profile:y})}}if("always-horizontal"==w||"esriServerPolygonPlacementAlwaysHorizontal"==w)I=!1;return{useCodedValues:h,dateFormat:t,numberFormat:E,fieldInfos:C,
pointPriorities:"above-center"==w||"esriServerPointLabelPlacementAboveCenter"==w?"AboveCenter":"above-left"==w||"esriServerPointLabelPlacementAboveLeft"==w?"AboveLeft":"above-right"==w||"esriServerPointLabelPlacementAboveRight"==w?"AboveRight":"below-center"==w||"esriServerPointLabelPlacementBelowCenter"==w?"BelowCenter":"below-left"==w||"esriServerPointLabelPlacementBelowLeft"==w?"BelowLeft":"below-right"==w||"esriServerPointLabelPlacementBelowRight"==w?"BelowRight":"center-center"==w||"esriServerPointLabelPlacementCenterCenter"==
w?"CenterCenter":"center-left"==w||"esriServerPointLabelPlacementCenterLeft"==w?"CenterLeft":"center-right"==w||"esriServerPointLabelPlacementCenterRight"==w?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==w||"below-start"==w||"center-start"==w?"PlaceAtStart":"above-end"==w||"below-end"==w||"center-end"==w?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==w||"esriServerLinePlacementAboveAfter"==w||"above-along"==w||"esriServerLinePlacementAboveAlong"==w||"above-before"==w||
"esriServerLinePlacementAboveBefore"==w||"above-start"==w||"esriServerLinePlacementAboveStart"==w||"above-end"==w||"esriServerLinePlacementAboveEnd"==w?"Above":"below-after"==w||"esriServerLinePlacementBelowAfter"==w||"below-along"==w||"esriServerLinePlacementBelowAlong"==w||"below-before"==w||"esriServerLinePlacementBelowBefore"==w||"below-start"==w||"esriServerLinePlacementBelowStart"==w||"below-end"==w||"esriServerLinePlacementBelowEnd"==w?"Below":"center-after"==w||"esriServerLinePlacementCenterAfter"==
w||"center-along"==w||"esriServerLinePlacementCenterAlong"==w||"center-before"==w||"esriServerLinePlacementCenterBefore"==w||"center-start"==w||"esriServerLinePlacementCenterStart"==w||"center-end"==w||"esriServerLinePlacementCenterEnd"==w?"OnLine":"Above",labelRotation:I,howManyLabels:"OneLabel",hasExpression:H,arcadeExpr:P}}});u("extend-esri")&&F.setObject("layers.LabelLayer",K,c);return K});