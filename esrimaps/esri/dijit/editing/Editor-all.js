// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
/*
 @esri/arcgis-html-sanitizer - v2.7.0 - Wed Jul 14 2021 13:34:33 GMT-0400 (Eastern Daylight Time)
 Copyright (c) 2021 - Environmental Systems Research Institute, Inc.
 Apache-2.0

 js-xss
 Copyright (c) 2012-2017 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 http://ucdok.com
 MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details

 Lodash/isPlainObject
 Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
*/
require({cache:{"esri/layers/FeatureLayer":function(){define("require module dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/global dojo/promise/all ../sniff ../kernel ../lang ../request ../config ../deferredUtils ../promiseList ../SpatialReference ../urlUtils ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/jsonUtils ../support/expressionUtils ../arcadeProfiles/labelingProfile ../tasks/QueryTask ../tasks/query ../tasks/FeatureSet ../tasks/StatisticDefinition ../geometry/Extent ../geometry/jsonUtils ../geometry/normalizeUtils ../geometry/scaleUtils ./GraphicsLayer ./Field ./TimeInfo ./TimeReference ./FeatureType ./FeatureTemplate ./FeatureSubtype ./FeatureEditResult ./LabelClass ./support/domainUtils ./SnapshotMode ./OnDemandMode ./SelectionMode ./StreamMode ./GridLayout ./TrackManager ./HeatmapManager ./clustering/ClusterManager dojo/i18n!../nls/jsapi dojo/has!extend-esri?./agscommon".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e,r,w,H,x,q,C,F,u,E,D,M,I,z,K,L,N,P,T,S,Z,da,Q,W,aa,R,V,ba,ha,qa,va,sa,Ba,Aa,X,ea,ia,la,ma,ua,xa,ta,ya){var Ca=w.defaults,Fa=!!a("esri-pbf"),Ga=!!a("esri-featurelayer-pbf"),na=B(aa,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reSQLCurrentTimestamp:/current_timestamp|current_date|current_time/i,reHostedFS:/(https?:)?\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4E3,maxRecordCountForAuto:2E3,
maxVertexCountForAuto:25E4,generalizeForScale:4E3,_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error",
"info"]},constructor:function(y,J){this._preventInit||this._initFeatureLayer(y,J)},_initFeatureLayer:function(y,J){J=J||{};this._tileWidth=J.tileWidth||512;this._tileHeight=J.tileHeight||512;this.i18n=ya;this._featureReduction=this._featureReduction||J.featureReduction;this._featureReductionEnabled=null!=J.featureReductionEnabled?J.featureReductionEnabled:!0;this._featureUpdatesCheckEnabled=null!=J.featureUpdatesCheckEnabled?J.featureUpdatesCheckEnabled:!0;this.showLabels=null!=J.showLabels?J.showLabels:
!0;this._outFields=J.outFields;this._defnExpr=J.definitionExpression;this._loadCallback=J.loadCallback;this._trackIdField=J.trackIdField;this.objectIdField=J.objectIdField;var O=null!=J.resolution,U=null!=J.maxAllowableOffset;this._maxOffset=this._optMaxOffset=O||U?O?J.resolution:J.maxAllowableOffset:this.maxAllowableOffset;this.quantize=null!=J.quantize?J.quantize:!0;this._optEditable=J.editable;this._optAutoGen=J.autoGeneralize;this.editSummaryCallback=J.editSummaryCallback;this.userId=J.userId;
this.userIsAdmin=J.userIsAdmin;this.useMapTime=J.hasOwnProperty("useMapTime")?!!J.useMapTime:!0;this.source=J.source;this.gdbVersion=J.gdbVersion;this.orderByFields=J.orderByFields;this.maxPointCountForAuto=null!=J.maxPointCountForAuto?J.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=J.maxRecordCountForAuto?J.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=J.maxVertexCountForAuto?J.maxVertexCountForAuto:this.maxVertexCountForAuto;
this.generalizeForScale=null!=J.generalizeForScale?J.generalizeForScale:this.generalizeForScale;this.queryPagination=this._optQueryPagination=null!=J.queryPagination?J.queryPagination:!0;this.multipatchOption=J.multipatchOption;this.subtypeSublayerInfo=J.subtypeSublayerInfo;this._selectedFeatures={};this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();O=e.isDefined(J.mode)?J.mode:na.MODE_ONDEMAND;this._isStream&&(O=na.MODE_STREAM);this.mode=O;switch(O){case na.MODE_SNAPSHOT:this.currentMode=
na.MODE_SNAPSHOT;this._mode=new X(this);break;case na.MODE_ONDEMAND:case na.MODE_AUTO:this.currentMode=na.MODE_ONDEMAND;this._mode=new ea(this);this.latticeTiling=J.latticeTiling;break;case na.MODE_SELECTION:this.currentMode=na.MODE_SELECTION;this._mode=new ia(this);this._isSelOnly=!0;break;case na.MODE_STREAM:this.currentMode=na.MODE_STREAM,this._mode=new la(this),this._isStream=!0}this._initLayer=t.hitch(this,this._initLayer);this._selectHandler=t.hitch(this,this._selectHandler);this._editable=
!1;if(t.isObject(y)&&y.layerDefinition)return this._collection=!0,this.mode=this._isStream?na.MODE_STREAM:na.MODE_SNAPSHOT,this._isStream||this._outFields||(this._outFields=["*"]),this._initLayer(y),this;this.source&&(y={source:this.source.toJson()},this._url.query=t.mixin(this._url.query,{layer:p.toJson(y)}));this.gdbVersion&&(this._url.query=t.mixin(this._url.query,{gdbVersion:this.gdbVersion}));this._task=new N(this.url,{source:this.source,gdbVersion:this.gdbVersion});y=this._url.path;this._fserver=
!1;-1!==y.search(/\/FeatureServer\//i)&&(this._fserver=!0);this._checkFeatureLimit();(J=J.resourceInfo)?this._initLayer(J):r({url:y,content:t.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},_initLayer:function(y,J){if(y||J){this._json=y;J=this.subtypeSublayerInfo;this._findCredential();if(this.credential&&this.credential.ssl||y&&y._ssl)this._useSSL(),this._task._useSSL();this._collection&&(this._isStream||
(this.currentMode=na.MODE_SNAPSHOT,this._mode=new X(this)),this._featureSet=y.featureSet,this._nextId=y.nextObjectId,y=y.layerDefinition);this.version=y.currentVersion;this.version||(this.version="capabilities"in y||"drawingInfo"in y||"hasAttachments"in y||"htmlPopupType"in y||"relationships"in y||"timeInfo"in y||"typeIdField"in y||"types"in y?10:9.3);this.geometryType=y.geometryType;y.bandCount&&y.fields&&1<y.fields.length&&(this.geometryType="esriGeometryPolygon",this._isImageService=!0);"string"!==
typeof this.multipatchOption&&"esriGeometryMultiPatch"===this.geometryType&&(this.multipatchOption="xyFootprint");if(y.hasOwnProperty("capabilities")){var O=this.capabilities=y.capabilities;O&&-1!==O.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1}else this._collection||(this._editable=this._fserver);e.isDefined(this._optEditable)?(this._editable=this._optEditable,delete this._optEditable):"esriGeometryMultiPatch"===this.geometryType&&(this._editable=!1);this._isImageService&&
(this._editable=!1);this._json=p.toJson(this._json);this.isEditable()?this._setMaxOffset(null):this._canAutoGeneralize()&&(this._autoGeneralize=e.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===na.MODE_ONDEMAND||this.mode===na.MODE_AUTO,delete this._optAutoGen);O=y.effectiveMinScale||y.minScale;var U=y.effectiveMaxScale||y.maxScale;!this._hasMin&&O&&this.setMinScale(O);!this._hasMax&&U&&this.setMaxScale(U);this.layerId=y.id;this.name=J&&J.title||y.name;this.description=y.description;this.copyright=
y.copyrightText;this.type=y.type;this.displayField=y.displayField;this.defaultDefinitionExpression=y.definitionExpression||(y.isView?y.viewDefinitionQuery:y.definitionQuery);this.fullExtent=new Z(y.extent);this.initialExtent=new Z(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new q(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=y.defaultVisibility;this.editingInfo=y.editingInfo;this.supportsLastEditDate=!(!this.editingInfo||null==this.editingInfo.lastEditDate);
if("esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.hasM=y.hasM||!1;this.hasZ=y.hasZ||!1;this.indexedFields=y.indexedFields;this.indexes=y.indexes;this.maxRecordCount=y.maxRecordCount;this.canModifyLayer=y.canModifyLayer;this.supportsStatistics=y.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:y.supportsAdvancedQueries;this.supportsCalculate=y.supportsCalculate;this.supportsASyncCalculate=y.supportsASyncCalculate;
this.supportsAttachmentsByUploadId=y.supportsAttachmentsByUploadId;this.supportsCoordinatesQuantization=y.supportsCoordinatesQuantization;this.supportsQuantizationEditMode=y.supportsQuantizationEditMode;this.supportsFieldDescription=y.supportsFieldDescriptionProperty;this.supportsFormatPBF=y.supportedQueryFormats?-1!==l.map(y.supportedQueryFormats.toLowerCase().split(","),t.trim).indexOf("pbf"):!1;this.quantize=this.quantize&&this.supportsCoordinatesQuantization;this.hasLabels=y.hasLabels;this.canScaleSymbols=
y.canScaleSymbols;this.supportsRollbackOnFailureParameter=this.supportsRollbackOnFailure=y.supportsRollbackOnFailure;this.syncCanReturnChanges=y.syncCanReturnChanges;this.isDataVersioned=y.isDataVersioned;this.editFieldsInfo=y.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=y.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=y.relationships;this.allowGeometryUpdates=
e.isDefined(y.allowGeometryUpdates)?y.allowGeometryUpdates:!0;this.allowUpdateWithoutMValues=!!y.allowUpdateWithoutMValues;this.enableZDefaults=!!y.enableZDefaults;this.zDefault=e.isDefined(y.zDefault)?y.zDefault:null;this.advancedQueryCapabilities=y.advancedQueryCapabilities||{supportsStatistics:this.supportsStatistics,supportsOrderBy:this.supportsAdvancedQueries,supportsDistinct:this.supportsAdvancedQueries};this.geometryProperties=y.hasGeometryProperties&&y.geometryProperties||null;this.url&&(this.advancedQueryCapabilities.supportsPagination=
this.advancedQueryCapabilities.supportsPagination&&(this.reHostedFS.test(this.url)||10.3<this.version));this.queryPagination=this._optQueryPagination&&this.advancedQueryCapabilities.supportsPagination;this.useStandardizedQueries=y.useStandardizedQueries;this.tileMaxRecordCount=y.tileMaxRecordCount;this.standardMaxRecordCount=y.standardMaxRecordCount;if(O=y.dateFieldsTimeReference)this.dateFieldsTimeReference=new ba(O);this._setMaxOffset(this._maxOffset,!0);this._isTable="Table"===this.type;U=y.fields;
this._createFields(U);if(!this.objectIdField){this.objectIdField=y.objectIdField;if(!this.objectIdField)for(U=y.fields,O=0;O<U.length;O++){var Y=U[O];if("esriFieldTypeOID"===Y.type){this.objectIdField=Y.name;break}}this.objectIdField||this._isStream||console.debug("esri.layers.FeatureLayer: "+e.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!e.isDefined(this._nextId)){U=this.objectIdField;Y=-1;if(this._collection&&U){var ca=(O=this._featureSet)&&O.features,fa=ca?ca.length:
0;for(O=0;O<fa;O++){var ja=(ja=ca[O].attributes)&&ja[U];ja>Y&&(Y=ja)}}this._nextId=Y+1}this.globalIdField=y.globalIdField;if(O=this.typeIdField=y.typeIdField)if(O=!this._getField(O)&&this._getField(O,!0))this.typeIdField=O.name;this.visibilityField=y.visibilityField;if(U=y.defaultSymbol)this.defaultSymbol=D.fromJson(U);var pa=this.types=[],ka=y.types;Y=(O=this.editFieldsInfo)&&O.creatorField;ca=O&&O.editorField;ja=Y||ca;fa=[];if(ka)for(O=0;O<ka.length;O++){var wa=new ha(ka[O]);var ra=wa.templates;
ja&&ra&&ra.length&&(fa=fa.concat(ra));pa.push(wa)}ka=y.templates;wa=this.templates=[];if(ka)for(O=0;O<ka.length;O++)pa=new qa(ka[O]),ja&&fa.push(pa),wa.push(pa);for(O=0;O<fa.length;O++)if(ja=t.getObject("prototype.attributes",!1,fa[O]))Y&&delete ja[Y],ca&&delete ja[ca];if(O=y.subtypeField)this.subtypeField=(O=this.getField(O))?O.name:null;this.defaultSubtypeCode=y.defaultSubtypeCode;this.subtypes=l.map(y.subtypes,function(Ea){return new va(Ea)});this._applySTSublayerInfo(J);if(J=y.timeInfo)this.timeInfo=
new V(J),this._startTimeField=J.startTimeField,this._endTimeField=J.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?J.trackIdField=this._trackIdField:this._trackIdField=J.trackIdField;this.hasAttachments=!this._collection&&y.hasAttachments?!0:!1;this.htmlPopupType=y.htmlPopupType;J=y.drawingInfo;(O=J&&J.labelingInfo)&&!this.labelingInfo&&(this.labelingInfo=l.map(O,function(Ea){return new Ba(Ea)}),this._fixLabelExpr());if(!this.renderer)if(J&&J.renderer){var oa=
J.renderer;this.setRenderer(z.fromJson(oa,{geometryType:this.geometryType}));"classBreaks"===oa.type&&this.renderer.setMaxInclusive(!0);if(!this._collection){var za=oa.type;O=[];oa=this.renderer;switch(za){case "simple":O.push(oa.symbol);break;case "uniqueValue":case "classBreaks":O.push(oa.defaultSymbol),O=O.concat(l.map(oa.infos,function(Ea){return Ea.symbol}))}O=l.filter(O,e.isDefined);var Da=this._url.path+"/images/",Ha=this._getToken();l.forEach(O,function(Ea){var Ia=Ea.url;Ia&&(-1===Ia.search(/https?:/)&&
-1===Ia.indexOf("data:")&&(Ea.url=Da+Ia),Ha&&-1!==Ea.url.search(/https?:/)&&(Ea.url+="?token\x3d"+Ha))})}}else if(U)ka=this.types,0<ka.length?(oa=new I(this.defaultSymbol,this.typeIdField),l.forEach(ka,function(Ea){oa.addValue(Ea.id,Ea.symbol)})):oa=new M(this.defaultSymbol),this.setRenderer(oa);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":za=new F;break;case "esriGeometryPolyline":za=new u;break;case "esriGeometryPolygon":za=new E;break;
default:this.hasXYFootprint()&&(za=new E)}this.setRenderer(za?new M(za):null)}za=J&&J.transparency||0;!this.hasOwnProperty("opacity")&&0<za&&(this.opacity=1-za/100);(a("ie")||7<=a("trident")||a("safari"))&&this.isEditable()&&10.02>this.version&&(this._ts=!0);this.statistics=y.statistics;this._fixRendererFields();this._updateRequiredFieldsFromLabelingInfo();this._checkFields();this._updateCaps();var Ja=function(){null==this._maxOffset||this._isFractionalOffsetAllowed()||this._setMaxOffset(this._maxOffset);
this.loaded=!0;this.setFeatureReduction(this.getFeatureReduction());this.currentMode!==na.MODE_SNAPSHOT&&(this.queryPagination=!1);this.onLoad(this);var Ea=this._loadCallback;Ea&&(delete this._loadCallback,Ea(this))};y=[];this._collection?(za=this._featureSet,this._featureSet=null,this._mode._drawFeatures(new T(za)),this._fcAdded=!0):(y.push(this._forceIdentity()),this._limitPromise&&y.push(this._limitPromise));y.push(this._evalArcadeSupport());y.length?x(y).then(t.hitch(this,function(){Ja.call(this)})):
Ja.call(this)}},_applySTSublayerInfo:function(y){y&&this.subtypeField&&(this.subtypeCode=y.subtypeCode,this._applySTSublayerDefinitionExpression(y),this._filterSubtypes(y),this._applySTTemplates(y),this._applySTFieldOverrides(y))},_applySTSublayerDefinitionExpression:function(y){var J=[],O=this.getDefinitionExpression();O&&J.push(O);(y=y.layerDefinition&&y.layerDefinition.definitionExpression)&&J.push(y);1<J.length&&(J=l.map(J,function(U){return"("+U+")"}));this.setDefinitionExpression(J.length?J.join(" AND "):
null)},_applySTTemplates:function(y){if(y=y.layerDefinition&&y.layerDefinition.templates)this.templates=l.map(y,function(J){return new qa(J)})},_filterSubtypes:function(){this.subtypes&&(this.subtypes=l.filter(this.subtypes,function(y){return y.code===this.subtypeCode},this))},_applySTFieldOverrides:function(y){var J=y.layerDefinition&&y.layerDefinition.fieldOverrides;if(J){this.fields=l.filter(this.fields,function(U){return l.some(J,function(Y){return Y.name===U.name})});var O=this.getSubtypeByCode(this.subtypeCode).domains;
this.fields.forEach(function(U){var Y=l.filter(J,function(ca){return ca.name===U.name})[0];Y.alias&&(U.alias=Y.alias);if(!1===Y.editable||U.name===this.subtypeField)U.editable=!1;O&&(Y=O[U.name])&&"inherited"!==Y.type&&(U.domain=Aa.fromJson(Y.toJson()))},this)}},setShowLabels:function(y){var J=this.showLabels;this.showLabels=y;J!==this.showLabels&&(this._evalSurfaceType(),this.onShowLabelsChange())},onShowLabelsChange:function(){},onRendererChange:function(y){this.inherited(arguments);var J=this._map;
this._ager=!!(y&&y.observationAger&&y.observationRenderer);y&&"colors"in y&&"blurRadius"in y&&"maxPixelIntensity"in y?(this._evalSurfaceType(!0),"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&J&&(this._heatmapManager=new xa(this),this._heatmapManager.initialize(J))):this.renderer&&this.renderer.getRendererInfo?l.some(this.renderer.rendererInfos,function(Y){return Y.renderer&&"colors"in Y.renderer&&"blurRadius"in Y.renderer})||(this._heatmapManager=null):this._heatmapManager=null;this.timeInfo&&
J&&(y&&(y.latestObservationRenderer||y.trackRenderer)?this._trackManager||(this._trackManager=new ua(this),this._trackManager.initialize(J),this._childLayer=this._trackManager.container,this._mode._applyTimeFilter()):this._trackManager&&!this._isStream&&(this._trackManager.destroy(),this._trackManager=null));if(y){var O=[];J=l.filter([y,y.observationRenderer,y.latestObservationRenderer,y.trackRenderer],e.isDefined);var U=function(Y){return null!=Y&&"function"!=typeof Y&&Y};l.forEach(J,function(Y){var ca=
U(Y.attributeField),fa=U(Y.attributeField2);Y=U(Y.attributeField3);!1!==ca&&O.push(ca);!1!==fa&&O.push(fa);!1!==Y&&O.push(Y)});this._requiredFields=O}else this._requiredFields=[];this.loaded&&(this._fixRendererFields(),this._checkFields(this._requiredFields),this._collection&&(this._typesDirty=!0))},setFeatureReduction:function(y){y&&(y=t.mixin({},y),null!=y.clusterSize&&null==y.clusterRadius&&(y.clusterRadius=y.clusterSize),delete y.clusterSize);this.loaded?this._isFeatureReductionSupported(y)?this._featureReduction=
y:(this._featureReduction=null,y&&console.log("Clustering is not supported for this layer: "+this.url)):this._featureReduction=y;this._evalFeatureReduction(this._featureReduction)},hasFeatureReduction:function(){return!!this._featureReduction},getFeatureReduction:function(){var y=this._featureReduction;if(y){y=t.mixin({},y);var J=this._clusterManager;if(J=J&&J.aggregationInfo)y.clusterRadius=J.clusterRadius,y.infoTemplate=J.infoTemplate}return y},isFeatureReductionActive:function(){var y=this._clusterManager;
return!!(y&&y.isClusteringEnabled()&&y.isClusteringActive())},isFeatureReductionEnabled:function(){return this._featureReductionEnabled},enableFeatureReduction:function(){this._featureReductionEnabled||(this._featureReductionEnabled=!0,this._evalFeatureReduction(this._featureReduction))},disableFeatureReduction:function(){this._featureReductionEnabled&&(this._featureReductionEnabled=!1,this._evalFeatureReduction(this._featureReduction))},isFeatureReductionApplied:function(){return this.hasFeatureReduction()&&
this.isFeatureReductionEnabled()&&this._canCluster(this.getFeatureReduction())},getAggregateGraphics:function(){return this._clusterManager?this._clusterManager.getAggregateGraphics():[]},getChildGraphics:function(y){return this._clusterManager?this._clusterManager.getFeaturesInCluster(y):[]},getSingleGraphics:function(){return this._clusterManager?this._clusterManager.getSingleGraphics():[]},getFeatureReductionRenderer:function(){return this.isFeatureReductionActive()?this._clusterManager.getClusterRenderer():
null},getFeatureReductionLayer:function(){return this._clusterManager?this._clusterManager.container:null},getFeatureReductionField:function(y){var J,O=this._clusterManager?this._clusterManager.getClusterFields():null;y=y?y.toLowerCase():"";l.some(O,function(U){y===U.name.toLowerCase()&&(J=U);return!!J});return J},_isFeatureReductionSupported:function(y){return y&&"cluster"===y.type&&"esriGeometryPoint"===this.geometryType&&(this._collection||this._isStream||this._optQueryPagination&&this.advancedQueryCapabilities.supportsPagination)},
_isReductionCompatibleRenderer:function(y){y=y&&y.declaredClass||"";y=y.toLowerCase();return-1<y.indexOf("simplerenderer")||-1<y.indexOf("classbreaksrenderer")||-1<y.indexOf("uniquevaluerenderer")},_evalFeatureReduction:function(y){this.loaded&&this.getMap()&&(y=y||this.getFeatureReduction(),this._evalModeFromFReduction(y),y&&this.isFeatureReductionEnabled()?this._canCluster(y)?this._clusterManager?this._updateClusterManager(y):(this._clusterManager=this._createClusterManager(y),this.onFeatureReductionChange()):
(console.log("Clustering is supported only for point layers where map spatial reference is WGS84 or Web Mercator"),this._destroyClusterManager()):this._destroyClusterManager())},_canCluster:function(y){var J=this._map;if(!J)return!1;J=J.spatialReference;return this._isFeatureReductionSupported(y)&&this._isReductionCompatibleRenderer(this.renderer)&&(J.isWebMercator()||4326===J.wkid)},_createClusterManager:function(y){y=new ta({layer:this,aggregationInfo:y});this._clusterHandles=[y.on("renderer-change",
t.hitch(this,function(){this.onFeatureReductionRendererChange()}))];y.initialize(this._map);return y},_updateClusterManager:function(y){var J=this._clusterManager;J&&J.setAggregationInfo(y)},_destroyClusterManager:function(y){l.forEach(this._clusterHandles,function(J){J.remove()});this._clusterHandles=null;this._clusterManager&&(this._clusterManager.destroy(y),this._clusterManager=null,this.onFeatureReductionChange())},redraw:function(){this.inherited(arguments);this._clusterManager&&this._clusterManager.redraw();
this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(y){this.inherited(arguments);var J=this._getRenderer();this._ager=!!(J&&J.observationAger&&J.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(J&&J.trackRenderer);y&&this._evalFeatureReduction()},_graphicVisibilityChanged:function(y){this._clusterManager?this._clusterManager.toggleFeatureVisibility(y):this._heatmapManager&&
this._heatmapManager.redraw()},setWebGLFetchOptions:function(y){this._hasOnDemandDrillMode()&&(y=y||{},null!=y.maxDrillLevel&&(this._mode.maxDrillLevel=y.maxDrillLevel),null!=y.maxRecordCountFactor&&(this._mode.maxRecordCountFactor=y.maxRecordCountFactor),null!=y.enablePBFQuery&&(this._mode.enablePBFQuery=y.enablePBFQuery))},_isWebGLCompatible:function(){return this.loaded&&!this.isEditable()&&!this.isFeatureReductionApplied()&&(!this.labelingInfo||!1===this.showLabels)&&!this._isGeometryOperationsUsed()&&
this._isRendererSupportedInWebGL()&&this.supportsCoordinatesQuantization&&("esriGeometryPolygon"!==this.geometryType||this.advancedQueryCapabilities.supportsReturningGeometryCentroid)&&this.currentMode===na.MODE_ONDEMAND&&(!this._preSurfaceChangeState||this._preSurfaceChangeState.currentMode===na.MODE_ONDEMAND)},_isRendererSupportedInWebGL:function(){if(!this.renderer)return!1;var y=this.renderer,J=y.declaredClass?y.declaredClass.toLowerCase():"";return(-1<J.indexOf("simplerenderer")||-1<J.indexOf("classbreaksrenderer")||
-1<J.indexOf("uniquevaluerenderer"))&&this._hasWebGLCompatibleSymbols(y)&&this._hasWebGLCompatibleVVs(y)},_hasWebGLCompatibleSymbols:function(y){y=this._getAllSymbolsInRenderer(y);return!(this._hasSLSWithMarker(y)||this._hasIncompatibleSMSStyles(y)||this._hasGIFMarker(y))},_hasWebGLCompatibleVVs:function(y){return!l.some(y&&y.visualVariables,function(J){var O=J.type;return("colorInfo"===O||"opacityInfo"===O)&&J.stops&&8<J.stops.length||"sizeInfo"===O&&(J.field||J.valueExpression&&"$view.scale"!==
J.valueExpression||J.expression&&"view.scale"!==J.expression)&&J.stops&&6<J.stops.length?!0:!1})},_hasSLSWithMarker:function(y){return l.some(y,function(J){return J&&"simplelinesymbol"===J.type&&!!J.marker})},_hasIncompatibleSMSStyles:function(y){var J=void 0===a("ie")&&7==a("trident");return l.some(y,function(O){return O&&"simplemarkersymbol"===O.type&&("triangle"===O.style||"path"===O.style&&J)})},_hasGIFMarker:function(y){var J=/\.gif$/,O=/^image\/gif$/;return l.some(y,function(U){return U&&"picturemarkersymbol"===
U.type?J.test(U.url)||O.test(U.contentType):!1})},_getAllSymbolsInRenderer:function(y){var J=[];y&&(J.push(y.symbol),J.push(y.defaultSymbol),l.forEach(y.infos,function(O){J.push(O.symbol)}),J=l.filter(J,function(O){return!!O}));return J},_setMap:function(y){var J=this.inherited(arguments),O=this._mode,U=this;O&&y.loaded&&O.initialize(y);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());this._addHandle=this.on("graphic-node-add",function(Y){Y=
Y.graphic.attributes;(Y=U._selectedFeatures[Y&&Y[U.objectIdField]])&&Y.attr("data-selected","")});return J},_unsetMap:function(y){this._suspendImpl(!0);this._destroyClusterManager(!1);this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);v.disconnect(this._zoomConnect);v.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this.inherited("_unsetMap",arguments)},onAttach:function(){this._evalModeFromSurface()},onRefreshTick:function(){this.isFeatureUpdatesCheckActive()&&
this._evalFeatureUpdates()},refresh:function(y){!this._needsRefresh&&y&&y.scheduled&&this.isFeatureUpdatesCheckActive()||(this._needsRefresh=!1,(y=this._mode)&&y.refresh())},setFeatureUpdatesCheckEnabled:function(y){this._featureUpdatesCheckEnabled=y},isFeatureUpdatesCheckEnabled:function(){return!!this._featureUpdatesCheckEnabled},isFeatureUpdatesCheckActive:function(){return this.supportsLastEditDate&&this.isFeatureUpdatesCheckEnabled()&&!!this.refreshInterval&&!!t.getObject("onFeatureUpdatesResult.after",
!1,this)},hasFeatureUpdates:function(){var y=new d;if(!this.supportsLastEditDate)return y.reject(Error("FeatureLayer does not support supportsLastEditDate")),y.promise;if(!this._fetchMetadataPromise||this._fetchMetadataPromise.isFulfilled())this._fetchMetadataPromise=r({url:this._url.path,content:t.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(t.hitch(this,function(J){J=J.editingInfo.lastEditDate;var O=this.editingInfo.lastEditDate!==J;this.editingInfo.lastEditDate=J;return O}));
this._fetchMetadataPromise.then(function(J){y.isFulfilled()||y.resolve(J)}).otherwise(function(J){y.isFulfilled()||y.reject(J)});return y.promise},hasXYFootprint:function(){return"esriGeometryMultiPatch"===this.geometryType&&"xyFootprint"===this.multipatchOption},getOutFields:function(){return l.filter(this._getOutFields(),function(y){return"*"===y||!!this._getField(y)},this)},getField:function(y){return this._getField(y,!0)},isOutField:function(y){y=this.getField(y);if(!y)return!1;var J=this.getOutFields();
return-1<l.indexOf(J,"*")||-1<l.indexOf(J,y.name)},getFieldLabel:function(y){var J=this.infoTemplate;J=J&&J.getFieldInfo&&J.getFieldInfo(y);y=t.isFunction(y)?null:this.getField(y);var O=J||y,U="";O&&(U=J&&J.label||y&&y.alias||O.name||O.fieldName);return U},getDomain:function(y,J){var O,U,Y=(J=J&&J.feature)&&this.typeIdField&&J.attributes&&J.attributes[this.typeIdField];null!=Y&&l.some(this.types,function(ca){return ca.id==Y?((O=ca.domains&&ca.domains[y])&&"inherited"===O.type&&(O=this._getLayerDomain(y),
U=!0),!0):!1},this);U||O||(O=this._getLayerDomain(y));return O},_getLayerDomain:function(y){this._createFieldsIndex();var J=this._fieldsIndex;if(J)return J=J.caseSensitive,(J=J.get(y))?J.domain:null;var O;l.some(this.fields,function(U){U.name===y&&(O=U.domain);return!!O});return O},getType:function(y){return this.getTypeById(y&&this.typeIdField&&y.attributes&&y.attributes[this.typeIdField])},getTypeById:function(y){var J;l.some(this.types,function(O){O.id==y&&(J=O);return!!J});return J},getSubtypeByCode:function(y){var J;
l.some(this.subtypes,function(O){O.code==y&&(J=O);return!!J});return J},setEditable:function(y){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(this._isImageService)return this;if(!this.loaded)return this._optEditable=y,this;var J=this._editable;this._editable=y;this._updateCaps();if(J!==y)this.onCapabilitiesChange();return this},getEditCapabilities:function(y){var J={canCreate:!1,canUpdate:!1,canDelete:!1,
canUpdateGeometry:!1};if(!this.loaded||!this.isEditable())return J;var O=y&&y.feature;y=y&&y.userId||this.getUserId();var U=l.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],t.trim),Y=(J=-1<l.indexOf(U,"editing"))&&-1<l.indexOf(U,"create"),ca=J&&-1<l.indexOf(U,"update");U=J&&-1<l.indexOf(U,"delete");var fa=this.ownershipBasedAccessControlForFeatures,ja=this.editFieldsInfo,pa=ja&&ja.creatorField;ja=ja&&ja.realm;O=(O=O&&O.attributes)&&pa?O[pa]:void 0;var ka=!!this.userIsAdmin;pa=
!fa||ka||!(!fa.allowOthersToUpdate&&!fa.allowUpdateToOthers);var wa=!fa||ka||!(!fa.allowOthersToDelete&&!fa.allowDeleteToOthers),ra=!fa||ka||!fa.hasOwnProperty("allowAnonymousToUpdate")||fa.allowAnonymousToUpdate;fa=!fa||ka||!fa.hasOwnProperty("allowAnonymousToDelete")||fa.allowAnonymousToDelete;y&&ja&&(y=y+"@"+ja);if(ka||J&&!(Y||ca||U))Y=ca=U=!0;J={canCreate:Y,canUpdate:ca,canDelete:U,canUpdateGeometry:ka||this.allowGeometryUpdates};y||(J.canUpdate=J.canUpdate&&ra,J.canDelete=J.canDelete&&fa);null===
O?(J.canUpdate=J.canUpdate&&pa,J.canDelete=J.canDelete&&wa):""!==O&&O&&y.toLowerCase()!==O.toLowerCase()&&(J.canUpdate=J.canUpdate&&pa,J.canDelete=J.canDelete&&wa);return J},getUserId:function(){var y;this.loaded&&(y=this.credential&&this.credential.userId||this.userId||"");return y},setUserIsAdmin:function(y){this.userIsAdmin=y},setEditSummaryCallback:function(y){this.editSummaryCallback=y},getEditSummary:function(y,J,O){O=e.isDefined(O)?O:(new Date).getTime();var U="";O=this.getEditInfo(y,J,O);
(J=J&&J.callback||this.editSummaryCallback)&&(O=J(y,O)||"");if(t.isString(O))U=O;else{if(O){y=O.action;J=O.userId;var Y=O.timeValue,ca=0;y&&ca++;J&&ca++;e.isDefined(Y)&&ca++;1<ca&&(U=("edit"===y?"edit":"create")+(J?"User":"")+(e.isDefined(Y)?O.displayPattern:""))}U=U&&e.substitute(O,this.i18n.layers.FeatureLayer[U])}return U},getEditInfo:function(y,J,O){if(this.loaded){O=e.isDefined(O)?O:(new Date).getTime();J=J&&J.action||"last";var U=this.editFieldsInfo,Y=U&&U.creatorField,ca=U&&U.creationDateField,
fa=U&&U.editorField;U=U&&U.editDateField;fa=(y=y&&y.attributes)&&fa?y[fa]:void 0;U=y&&U?y[U]:null;Y=this._getEditData(y&&Y?y[Y]:void 0,y&&ca?y[ca]:null,O);O=this._getEditData(fa,U,O);switch(J){case "creation":var ja=Y;break;case "edit":ja=O;break;case "last":ja=O||Y}ja&&(ja.action=ja===O?"edit":"creation");return ja}},_getEditData:function(y,J,O){if(e.isDefined(J)){var U=O-J;var Y=0>U?"Full":6E4>U?"Seconds":12E4>U?"Minute":36E5>U?"Minutes":72E5>U?"Hour":864E5>U?"Hours":6048E5>U?"WeekDay":"Full"}if(void 0!==
y||Y){var ca=ca||{};ca.userId=y;Y&&(y=k.format,O=new Date(J),ca.minutes=Math.floor(U/6E4),ca.hours=Math.floor(U/36E5),ca.weekDay=y(O,{datePattern:"EEEE",selector:"date"}),ca.formattedDate=y(O,{selector:"date"}),ca.formattedTime=y(O,{selector:"time"}),ca.displayPattern=Y,ca.timeValue=J)}return ca},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},isQueryable:function(){var y=l.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],t.trim);return this._isStream||this.userIsAdmin||
this._collection||-1!==l.indexOf(y,"query")||-1!==l.indexOf(y,"catalog")},setResolution:function(y){return this.setMaxAllowableOffset(y)},setMaxAllowableOffset:function(y){this.isEditable()||(this._optMaxOffset=y,this._setMaxOffset(y,!0));return this},_resetMaxAllowableOffset:function(){this.setMaxAllowableOffset(this._optMaxOffset);this._prevScale=null;this._refreshMaxAllowableOffset()},_refreshMaxAllowableOffset:function(){this._calcMaxOffsetForAutoSnapshot();this._updateMaxOffset();this._needsRefresh=
!1},getResolution:function(){return this.getMaxAllowableOffset()},getMaxAllowableOffset:function(){var y=this._quantizationParameters?this._quantizationParameters.tolerance:void 0;return null!=this._maxOffset?this._maxOffset:y},_setMaxOffset:function(y,J){if(null==y)return delete this._maxOffset,delete this._quantizationParameters,this;this.quantize&&this.supportsCoordinatesQuantization?("esriGeometryPolyline"===this.geometryType?this._maxOffset=y:delete this._maxOffset,this._quantizationParameters=
y?{mode:"view",originPosition:"upperLeft",tolerance:y,extent:this.fullExtent}:null):(this._isFractionalOffsetAllowed()&&J||(y=Math.floor(y)),isNaN(y)||0===y?delete this._maxOffset:this._maxOffset=y,delete this._quantizationParameters);return this},_isFractionalOffsetAllowed:function(){return null==this.version||10.1<=this.version||navigator.languages&&this._isLangWithDot(navigator.languages[0])},_isLangWithDot:function(y){y=(y=y&&y.split("-"))&&y[0]&&y[0].toLowerCase();return-1!==l.indexOf(this._langsWithDot,
y)},_langsWithDot:"ar en et fr he ja ko th vi zh".split(" "),setAutoGeneralize:function(y){this.loaded?this._canAutoGeneralize()&&((this._autoGeneralize=y)?(this._isAutoSnapshotMode()&&(this._prevScale=null),this._updateMaxOffset()):this._setMaxOffset(null)):this._optAutoGen=y;return this},_canAutoGeneralize:function(){return!this.isEditable()&&this.mode!==na.MODE_SNAPSHOT},setGDBVersion:function(y){this._collection||y===this.gdbVersion||!y&&!this.gdbVersion||(this.gdbVersion=y,this._task.gdbVersion=
y,this._url.query=t.mixin(this._url.query,{gdbVersion:y}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange());return this},hasAllFeatures:function(){return this._mode?this._mode.hasAllFeatures():!0},hasUpdateError:function(){return this._mode?this._mode.hasUpdateError():!1},setDefinitionExpression:function(y){this._defnExpr=y;this._hasPendingLimitQuery()||((y=this._checkFeatureLimit())?this._evalModeAndApplyDefnExpr(y):this._applyDefnExpr());return this},_applyDefnExpr:function(){var y=
this._mode;y&&y.propertyChangeHandler(1)},_evalModeAndApplyDefnExpr:function(y){y.then(t.hitch(this,function(J){J&&(J instanceof Error||!J.modeChanged)&&this._applyDefnExpr()}))},getDefinitionExpression:function(){return this._defnExpr},hasDefinitionExpressionWithCurrentTimestamp:function(){return this.reSQLCurrentTimestamp.test(this.getDefinitionExpression())},setTimeDefinition:function(y){this._isSnapshotMode()?(this._timeDefn=y,(y=this._mode)&&y.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+
this.id+", Layer URL \x3d "+this.url);return this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(y,J){this._timeOffset=y;this._timeOffsetUnits=J;(y=this._mode)&&y.propertyChangeHandler(0);return this},setUseMapTime:function(y){this.useMapTime=y;this._toggleTime(!this.suspended);(y=this._mode)&&y.propertyChangeHandler(0)},selectFeatures:function(y,J,O,U){J=J||na.SELECTION_NEW;this._hasSelectionError=this._hasPartialSelectedFeatures=!1;y=this._getShallowClone(y);var Y=this._map,
ca=this,fa=H._fixDfd(new d(H._dfdCanceller));y.outFields=this.getOutFields();y.returnGeometry=!0;y.multipatchOption=this.multipatchOption;Y&&(y.outSpatialReference=new q(Y.spatialReference.toJson()));if(!this._applyQueryFilters(y,!0)){var ja={features:[]};this._selectHandler(ja,J,O,U,fa);return fa}if(Y=this._canDoClientSideQuery(y))fa._pendingDfd=n(this._doQuery(y,Y)),fa._pendingDfd.then(function(ka){ja={features:ka};ca._selectHandler(ja,J,O,U,fa)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+
this.invalidParams)],null,U,fa,!0),fa;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,U,fa,!0),fa;var pa=this;this._ts&&(y._ts=(new Date).getTime());Y=this._canFetchPBFForQuery(y);this._enableEditModeQuantization(y,Y);(fa._pendingDfd=this._task.execute(y,null,null,Y?{format:"pbf"}:null)).addCallbacks(function(ka){pa._selectHandler(ka,J,O,U,fa)},function(ka){pa._hasPartialSelectedFeatures=!0;pa._hasSelectionError=!0;pa._resolve([ka],
null,U,fa,!0)})}return fa},getSelectedFeatures:function(){var y=this._selectedFeatures,J=[],O;for(O in y)y.hasOwnProperty(O)&&J.push(y[O]);return J},clearSelection:function(y){var J=this._selectedFeatures,O=this._mode,U;for(U in J)J.hasOwnProperty(U)&&(this._unSelectFeatureIIf(U,O),O._removeFeatureIIf(U));this._selectedFeatures={};this._isSelOnly&&O._applyTimeFilter(!0);if(!y)this.onSelectionClear();return this},setSelectionSymbol:function(y){if(this._selectionSymbol=y){var J=this._selectedFeatures,
O;for(O in J)J.hasOwnProperty(O)&&J[O].setSymbol(y)}return this},getSelectionSymbol:function(){return this._selectionSymbol},setLabelingInfo:function(y){y?(this.labelingInfo=y,this._fixLabelExpr()):delete this.labelingInfo;this._collection&&(this._typesDirty=!0);this._evalSurfaceType();this.onLabelingInfoChange()},_fixLabelExpr:function(){var y=/\[([^\[\]]+)\]/ig,J,O=this,U=function(Y,ca){Y=O._getField(ca,!0);return"["+(Y&&Y.name||ca)+"]"};l.forEach(this.labelingInfo,function(Y){if(J=Y.labelExpression)Y.labelExpression=
J.replace(y,U)})},_updateRequiredFieldsFromLabelingInfo:function(){var y=[];l.forEach(this.labelingInfo,function(J){var O=J.labelExpressionInfo;if(J.labelExpression){var U=/[\[\]]/ig;J=J.labelExpression.match(/\[[^\[\]]+\]/ig);(J=l.map(J,function(ca){return ca.replace(U,"")}))&&(y=y.concat(J))}if(O){if(O.value){var Y=/[\{\}]/ig;J=O.value.match(/\{[^\{\}]+\}/ig);(J=l.map(J,function(ca){return ca.replace(Y,"")}))&&(y=y.concat(J))}O.expression&&(J=l.map(this.fields,function(ca){return ca.name},this),
y=y.concat(K.extractFieldNames(O.expression,J)))}},this);y=l.map(y,function(J){var O=this.getField(J);return O?O.name:J},this);this._requiredFields&&(this._requiredFields=this._requiredFields.concat(y))},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(y,J,O,U,Y,ca){var fa=ca.assembly,ja=ca.dfd;this._applyNormalized(y,fa&&fa[0]);this._applyNormalized(J,fa&&fa[1]);this.onBeforeApplyEdits(y,J,O);var pa={},ka=this.objectIdField;fa={f:"json"};var wa=!1;if(this._collection)ca=
{},ca.addResults=y?l.map(y,function(){wa=!0;return{objectId:this._nextId++,success:!0}},this):null,ca.updateResults=J?l.map(J,function(za){wa=!0;var Da=za.attributes[ka];pa[Da]=za;return{objectId:Da,success:!0}},this):null,ca.deleteResults=O?l.map(O,function(za){wa=!0;return{objectId:za.attributes[ka],success:!0}},this):null,wa?this._editHandler(ca,y,pa,U,Y,ja):this._resolve([ca.addResults,ca.updateResults,ca.deleteResults],null,U,ja);else{y&&0<y.length&&(fa.adds=this._convertFeaturesToJson(y,0,1),
wa=!0);if(J&&0<J.length){for(ca=0;ca<J.length;ca++){var ra=J[ca];pa[ra.attributes[ka]]=ra}fa.updates=this._convertFeaturesToJson(J,0,0,1);wa=!0}if(O&&0<O.length){J=[];for(ca=0;ca<O.length;ca++)J.push(O[ca].attributes[ka]);fa.deletes=J.join(",");wa=!0}if(wa){var oa=this;return r({url:this._url.path+"/applyEdits",content:t.mixin(fa,this._url.query),callbackParamName:"callback",load:function(za){oa._editHandler(za,y,pa,U,Y,ja)},error:function(za){oa._resolve([za],null,Y,ja,!0)}},{usePost:!0})}this._resolve([],
null,U,ja)}},queryFeatures:function(y,J,O,U){return this._query("execute","onQueryFeaturesComplete",y,J,O,U)},queryRelatedFeatures:function(y,J,O){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",y,J,O)},queryIds:function(y,J,O,U){return this._query("executeForIds","onQueryIdsComplete",y,J,O,U)},queryCount:function(y,J,O,U){return this._query("executeForCount","onQueryCountComplete",y,J,O,U)},queryExtent:function(y,J,O,U){return this._query("executeForExtent","onQueryExtentComplete",
y,J,O,U)},queryAttachmentInfos:function(y,J,O){var U=this._url.path+"/"+y+"/attachments",Y=new d(H._dfdCanceller),ca=this;U=C.normalize(U);Y._pendingDfd=r({url:U,content:t.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(fa){fa=fa.attachmentInfos;var ja;l.forEach(fa,function(pa){ja=c.objectToQuery({gdbVersion:ca._url.query&&ca._url.query.gdbVersion,layer:ca._url.query&&ca._url.query.layer,token:ca._getToken()});pa.url=U+"/"+pa.id+(ja?"?"+ja:"");pa.objectId=y});ca._resolve([fa],
"onQueryAttachmentInfosComplete",J,Y)},error:function(fa){ca._resolve([fa],null,O,Y,!0)}});return Y},addAttachment:function(y,J,O,U){return this._sendAttachment("add",y,J,O,U)},updateAttachment:function(y,J,O,U,Y){O.appendChild(b.create("input",{type:"hidden",name:"attachmentId",value:J}));return this._sendAttachment("update",y,O,U,Y)},deleteAttachments:function(y,J,O,U){var Y=this._url.path+"/"+y+"/deleteAttachments",ca=new d(H._dfdCanceller),fa=this;J={f:"json",attachmentIds:J.join(",")};ca._pendingDfd=
r({url:Y,content:t.mixin(J,this._url.query),callbackParamName:"callback",load:t.hitch(this,function(ja){ja=ja.deleteAttachmentResults;ja=l.map(ja,function(pa){pa=new sa(pa);pa.attachmentId=pa.objectId;pa.objectId=y;return pa});fa._resolve([ja],"onDeleteAttachmentsComplete",O,ca)}),error:function(ja){fa._resolve([ja],null,U,ca,!0)}},{usePost:!0});return ca},addType:function(y){var J=this.types;if(J){if(l.some(J,function(O){return O.id==y.id?!0:!1}))return!1;J.push(y)}else this.types=[y];return this._typesDirty=
!0},deleteType:function(y){if(this._collection){var J=this.types;if(J){var O=-1;l.some(J,function(U,Y){return U.id==y?(O=Y,!0):!1});if(-1<O)return this._typesDirty=!0,J.splice(O,1)[0]}}},toJson:function(){var y=this._cloneJson();if(y){y=y.layerDefinition?y:{layerDefinition:y};var J=y.layerDefinition,O=this._collection;this._updateLayerDefinition(J);var U=null;if(!O||this._fcAdded)U={geometryType:J.geometryType,features:this._convertFeaturesToJson(this.graphics,!0)};y.featureSet=t.mixin({},y.featureSet||
{},U);if(y.featureSet.transform){var Y=y.featureSet.transform;delete y.featureSet.transform;U=new T(y.featureSet);U.quantize(Y);y.featureSet=U.toJson()}O&&(y.nextObjectId=this._nextId,J.capabilities=this.capabilities);return y}},getLayerDefinition:function(){var y=this._cloneJson();(y=y?y.layerDefinition||y:null)&&this._updateLayerDefinition(y);return y},getFeatureCollectionLayer:function(y){var J=new d,O=this.getLayerDefinition();if(!O)return J.reject(Error("layerDefinition not available")),J.promise;
y=y||[];var U=new na({layerDefinition:O,featureSet:{geometryType:O.geometryType,features:l.map(y,function(fa){return fa.toJson()})}}),Y=U.on("load",function(){Y.remove();ca.remove();J.resolve(U)}),ca=U.on("error",function(){U.loaded||(Y.remove(),ca.remove(),J.reject(U.loadError))});return J.promise},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},
onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},onLabelingInfoChange:function(){},onFeatureReductionRendererChange:function(){},onFeatureReductionChange:function(){},onFeatureUpdatesResult:function(){},
_cloneJson:function(){var y=this._json;return t.isString(y)?p.fromJson(y):t.clone(y)},_updateLayerDefinition:function(y){if(this._collection&&this._typesDirty){y.types=l.map(this.types||[],function(Y){return Y.toJson()});var J=this.renderer,O=this.labelingInfo,U=y.drawingInfo;!J&&!O||U||(U=y.drawingInfo={});U&&J&&-1===J.declaredClass.indexOf("TemporalRenderer")&&(U.renderer=J.toJson());O&&(U.labelingInfo=l.map(O,function(Y){return Y.toJson()}))}},_evalFeatureUpdates:function(){if(!this._featureUpdatesPromise||
this._featureUpdatesPromise.isFulfilled())this._featureUpdatesPromise=this.hasFeatureUpdates().otherwise(function(y){return!(y&&"cancel"===y.dojoType)}).always(t.hitch(this,function(y){this._featureUpdatesPromise=null;this.onFeatureUpdatesResult({hasUpdates:y})}))},_evalRefresh:function(y){(y.hasUpdates||this.hasDefinitionExpressionWithCurrentTimestamp())&&this.refresh()},_evalArcadeSupport:function(){var y=new d;setTimeout(t.hitch(this,function(){this._initializeArcadeEngine().always(function(){y.resolve()})}),
0);return y.promise},_initializeArcadeEngine:function(){var y=[],J=this.infoTemplate;J&&J.initializeArcadeEngine&&y.push(J.initializeArcadeEngine());(J=this.renderer)&&J.initializeArcadeEngine&&y.push(J.initializeArcadeEngine());var O=[];l.forEach(this.labelingInfo,function(U){(U=U.labelExpressionInfo)&&U.expression&&O.push(U.expression)});y.push(L.initialize(O));return x(y)},_isGeometryOperationsUsed:function(){var y=this.infoTemplate,J=this.renderer,O=this.labelingInfo;return y&&y.hasGeometryOperations&&
y.hasGeometryOperations()||J&&J.hasGeometryOperations&&J.hasGeometryOperations()||l.some(O,function(U){return K.hasGeometryOperations(U.labelExpressionInfo&&U.labelExpressionInfo.expression)})?!0:!1},_forceIdentity:function(){var y=new d,J=this,O=this._url&&this._url.path;var U=O&&O.toLowerCase().indexOf("/rest/services");var Y=this.editFieldsInfo;Y=Y&&(Y.creatorField||Y.editorField);(this.userIsAdmin||Y)&&!this._getToken()&&-1<U&&f.id?(U=O.substring(0,U)+"/rest/info",r({url:U,content:{f:"json"},
handleAs:"json",callbackParamName:"callback"}).then(function(ca){if(ca.owningSystemUrl)return f.id.checkSignInStatus(ca.owningSystemUrl+"/sharing")}).then(function(ca){if(ca)return f.id.getCredential(O)}).then(function(ca){ca&&J._findCredential()}).always(function(){y.resolve()})):y.resolve();return y.promise},_isSnapshotMode:function(){return this._mode?this._mode.isInstanceOf(X):!1},_isOnDemandMode:function(){return this._mode?this._mode.isInstanceOf(ea):!1},_isAutoSnapshotMode:function(){return this._isAutoModeEnabled()&&
this.currentMode===na.MODE_SNAPSHOT},_getMaxFeaturesForAutoSnapshotMode:function(){var y=this.geometryType;if("esriGeometryPolyline"===y||"esriGeometryPolygon"===y||"esriGeometryMultipoint"===y||this.hasXYFootprint())var J=this.maxRecordCountForAuto;else"esriGeometryPoint"===y&&(J=this.maxPointCountForAuto);return J},getLastExceedsLimitResult:function(){return this._lastExceedsLimitResult},_canUseSnapshotMode:function(y){this._lastExceedsLimitResult=y=(y=y&&y.features&&y.features[0])&&y.attributes&&
y.attributes.exceedslimit;return!(this.mode!==na.MODE_AUTO||this.isEditable()||0!==y||!(this._isPaginationAllowed()||this.maxRecordCount>=this._getMaxFeaturesForAutoSnapshotMode()))},_evalModeFromFLimit:function(y){this._canUseSnapshotMode(y)?this._enableAutoSnapshotMode():this._enableAutoOnDemandMode()},_enableAutoSnapshotMode:function(){var y=na.MODE_SNAPSHOT;this.isFeatureReductionApplied()?this._updatePreFReductionState(y):this._preSurfaceChangeState?(this._updatePreSurfaceChangeState(y),this._evalSurfaceType(!0)):
this.currentMode!==y&&this._setFetchMode(na.MODE_AUTO,y)},_enableAutoOnDemandMode:function(){var y=na.MODE_ONDEMAND;this.isFeatureReductionApplied()?this._updatePreFReductionState(y):this._preSurfaceChangeState?this._updatePreSurfaceChangeState(y):this.currentMode!==y&&(this._setFetchMode(na.MODE_AUTO,y),this._evalSurfaceType())},_evalModeFromFReduction:function(y){this.loaded&&(y&&this.isFeatureReductionEnabled()&&this._canCluster(y)?this._enableFReductionMode():this._disableFReductionMode())},_enableFReductionMode:function(){this._evalSurfaceType(!0);
if(!this._preFReductionState){var y=this.currentMode;y!==na.MODE_SNAPSHOT&&y!==na.MODE_STREAM&&y!==na.MODE_SELECTION&&(this._preFReductionState={mode:this.mode,currentMode:this.currentMode},this._setFetchMode(this.mode===na.MODE_AUTO?na.MODE_AUTO:na.MODE_SNAPSHOT,na.MODE_SNAPSHOT))}},_disableFReductionMode:function(){var y=this._preFReductionState;this._preFReductionState=null;!y||y.mode===this.mode&&y.currentMode===this.currentMode||(this._setFetchMode(y.mode,y.currentMode),this._evalSurfaceType())},
_updatePreFReductionState:function(y){this._preFReductionState=this._preFReductionState||{};this._preFReductionState.mode=na.MODE_AUTO;this._preFReductionState.currentMode=y},_evalModeFromSurface:function(){this.hasWebGLSurface()?this._enableWebGLSurfaceMode():this._disableWebGLSurfaceMode()},_enableWebGLSurfaceMode:function(){this._preSurfaceChangeState||(this._preSurfaceChangeState={mode:this.mode,currentMode:this.currentMode},this._setFetchMode(this.mode===na.MODE_AUTO?na.MODE_AUTO:na.MODE_ONDEMAND,
na.MODE_ONDEMAND,this.webglDeps.OnDemandDrillMode))},_disableWebGLSurfaceMode:function(){var y=this._preSurfaceChangeState;y&&(this._preSurfaceChangeState=null,this._setFetchMode(y.mode,y.currentMode))},_updatePreSurfaceChangeState:function(y){this._preSurfaceChangeState=this._preSurfaceChangeState||{};this._preSurfaceChangeState.mode=na.MODE_AUTO;this._preSurfaceChangeState.currentMode=y},_setFetchMode:function(y,J,O){this.clearSelection();this._mode.suspend();this._mode.destroy();this.mode=y;this.currentMode=
J;O=O||this._getModeConstructor(J);this._mode=new O(this);this.queryPagination=J===na.MODE_ONDEMAND&&-1===O.prototype.declaredClass.toLowerCase().indexOf("ondemanddrillmode")?!1:this._isPaginationAllowed();(y=this.getMap())&&y.loaded&&(this._resetMaxAllowableOffset(),this._mode.initialize(y),this._mode.startup())},_isPaginationAllowed:function(){return!(!this._optQueryPagination||this.loaded&&!this.advancedQueryCapabilities.supportsPagination)},_getModeConstructor:function(y){var J;y===na.MODE_SNAPSHOT?
J=X:y===na.MODE_ONDEMAND&&(J=ea);return J},_hasOnDemandDrillMode:function(){var y=this._mode;y=y&&y.declaredClass;return!!(y&&-1<y.toLowerCase().indexOf("ondemanddrillmode"))},_checkFeatureLimit:function(){this._limitPromise&&(this._limitPromise.cancel(),this._limitPromise=null);var y=this._queryLimit();y&&(this._lastExceedsLimitResult=null,this._limitPromise=y.then(t.hitch(this,function(J){var O=this.currentMode;this._evalModeFromFLimit(J);return{modeChanged:this.currentMode!==O}})).always(t.hitch(this,
function(J){this._limitPromise=null;return J})));return this._limitPromise},_hasPendingLimitQuery:function(){return!!this._exceedsLimitTimer},_queryLimit:function(){if(this._isAutoModeEnabled()){var y,J,O=new d(function(){clearTimeout(y);y=null;J&&!J.isFulfilled()&&J.cancel();J=null});this._exceedsLimitTimer=y=setTimeout(t.hitch(this,function(){this._exceedsLimitTimer=null;var U=new P,Y=new S;Y.statisticType="exceedslimit";Y.maxPointCount=this.maxPointCountForAuto;Y.maxRecordCount=this.maxRecordCountForAuto;
Y.maxVertexCount=this.maxVertexCountForAuto;Y.outStatisticFieldName="exceedslimit";U.outStatistics=[Y];J=this.queryFeatures(U).promise.then(function(ca){O.resolve(ca)}).otherwise(function(ca){O.reject(ca)})}),0);return O.promise}},_isAutoModeEnabled:function(){return this.mode===na.MODE_AUTO&&this.reHostedFS.test(this.url)},_updateCaps:function(){var y=this._editable,J=t.trim(this.capabilities||""),O=l.map(J?J.split(","):[],t.trim),U=l.map(J?J.toLowerCase().split(","):[],t.trim);J=l.indexOf(U,"editing");
var Y;U={Create:l.indexOf(U,"create"),Update:l.indexOf(U,"update"),Delete:l.indexOf(U,"delete")};if(y&&-1===J)O.push("Editing");else if(!y&&-1<J){y=[J];for(Y in U)-1<U[Y]&&y.push(U[Y]);y.sort();for(Y=y.length-1;0<=Y;Y--)O.splice(y[Y],1)}this.capabilities=O.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._suspendImpl()},_suspendImpl:function(y){this._toggleTime(!1);this._refreshHandle&&(this._refreshHandle.remove(),
this._refreshHandle=null);var J=this._mode;J&&(J.suspend(),y&&J.destroy())},onResume:function(y){this.inherited(arguments);this._toggleTime(!0);this._refreshHandle=this.on("feature-updates-result",t.hitch(this,this._evalRefresh));var J=this._map,O=this._getRenderer();if(y.firstOccurrence){if(this._fixRendererFields(),this._updateRequiredFieldsFromLabelingInfo(),this._checkFields(),this.clearSelection(),this._evalFeatureReduction(),this.timeInfo&&!this._trackManager&&(this._trackIdField||O&&(O.latestObservationRenderer||
O.trackRenderer))&&(this._trackManager=new ua(this),this._trackManager.initialize(J),this._childLayer=this._trackManager.container),O&&"colors"in O&&"blurRadius"in O&&"maxPixelIntensity"in O&&"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&(this._heatmapManager=new xa(this),this._heatmapManager.initialize(J)),this._zoomConnect=v.connect(J,"onZoomEnd",this,this._zoomEndHandler),this._refreshMaxAllowableOffset(),O=this._mode)O._init||O.initialize(J),O.startup()}else this._zoomEndHandler(),
this._mode&&this._mode.resume()},_zoomEndHandler:function(){var y=this._map;this._updateMaxOffset();this._prevScale=y.getScale();!this.suspended&&this._needsRefresh&&this.refresh()},_updateMaxOffset:function(){var y=this._map;y&&y.loaded&&this._autoGeneralize&&(this._isAutoSnapshotMode()?(y=this.getMaxAllowableOffset(),this._setMaxOffset(this._getMaxOffsetForScale(),!0),this._needsRefresh||(this._needsRefresh=y!=this.getMaxAllowableOffset())):this._setMaxOffset(y.extent.getWidth()/y.width,!y.extent.spatialReference.isWebMercator()))},
_getMaxOffsetForScale:function(){if(this._map){var y=this._map.getScale(),J=this._calculatedScale,O=this._calcMaxOffset,U=this._prevScale;return y>=J&&(null==U||U<J)?O:y<J&&(null==U||U>=J)?null:this.getMaxAllowableOffset()}},_calcMaxOffsetForAutoSnapshot:function(){var y=this._map;if(y&&this._canAutoGeneralize()&&this._isAutoSnapshotMode()&&this._autoGeneralize&&null==this.getMaxAllowableOffset()){var J=this.generalizeForScale;this._calculatedScale=J=this.maxScale?this.maxScale:this.minScale?Math.min(J,
this.minScale):Math.min(J,W.getScale(y,this.initialExtent));this._calcMaxOffset=y.extent.getWidth()/y.width/y.getScale()*J}else this._calculatedScale=this._calcMaxOffset=void 0},_toggleTime:function(y){var J=this._map;y&&this.timeInfo&&this.useMapTime&&J?(this._mapTimeExtent=J.timeExtent,this._timeConnect||(this._timeConnect=v.connect(J,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,v.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(y){this._mapTimeExtent=
y;(y=this._mode)&&y.propertyChangeHandler(0)},_getOffsettedTE:function(y){var J=this._timeOffset,O=this._timeOffsetUnits;return y&&J&&O?y.offset(-1*J,O):y},_getTimeOverlap:function(y,J){return y&&J?y.intersection(J):y||J},_getTimeFilter:function(y){var J=this.getTimeDefinition();if(J){var O=this._getTimeOverlap(J,null);if(!O)return[!1]}if(y){if(y=O?this._getTimeOverlap(y,O):y,!y)return[!1]}else y=O;return[!0,y]},_getAttributeFilter:function(y){var J=[],O=this.getDefinitionExpression();O&&J.push(O);
y&&J.push(y);this.subtypeField&&this.subtypeCode&&J.push(this.subtypeField+" \x3d "+this.subtypeCode);1<J.length&&(J=l.map(J,function(U){return"("+U+")"}));return J.length?J.join(" AND "):null},_applyQueryFilters:function(y,J){y.where=this._getAttributeFilter(y.where);y.returnGeometry&&null==y.maxAllowableOffset&&!y.quantizationParameters&&(y.maxAllowableOffset=this._maxOffset,y.quantizationParameters=this._quantizationParameters);J&&this.supportsAdvancedQueries&&(y.orderByFields=y.orderByFields||
this.getOrderByFields());if(this.timeInfo)if(J=this._getTimeFilter(y.timeExtent),J[0])y.timeExtent=J[1];else return!1;return!0},_add:function(y){var J=this._selectionSymbol,O=y.attributes,U=this.visibilityField;J&&this._isSelOnly&&y.setSymbol(J);if(U&&O&&O.hasOwnProperty(U))y[O[U]?"show":"hide"]();return this.add.apply(this,arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(y,J){var O=[],U=this._map,Y;if((this._collection||!this._isTable&&U)&&!(y.text||
y.where&&y.where!==this.getDefinitionExpression()||y.orderByFields&&y.orderByFields.length&&(Y=this.getOrderByFields()||[])&&y.orderByFields.join()!==Y.join()||y.outStatistics||y.returnDistinctValues)){Y=this._isSnapshotMode();var ca=this._isSelOnly;J=Y?null:J?this._getExtentOfTiles(U.extent):U.extent;if(U=y.geometry){if(ca||y.spatialRelationship!==P.SPATIAL_REL_INTERSECTS||"extent"!==U.type||!Y&&!J.contains(U))return;O.push(1)}if(J=y.objectIds)if(Y)O.push(2);else{U=J.length;var fa=this._mode,ja=
0,pa;for(pa=0;pa<U;pa++)fa._getFeature(J[pa])&&ja++;if(ja===U)O.push(2);else return}if(this.timeInfo)if(y=y.timeExtent,J=this._mapTimeExtent,Y)y&&O.push(3);else if(ca){if(y)return}else if(J)if(-1!==l.indexOf(O,2))y&&O.push(3);else if(-1!==l.indexOf(O,1))y==J&&O.push(3);else return;else if(0<O.length)y&&O.push(3);else if(y)return;return 0<O.length?O:null}},_getAbsMid:function(y){return G.toAbsMid?G.toAbsMid(y):A.id.replace(/\/[^\/]*$/ig,"/")+y},_doQuery:function(y,J,O){var U=[],Y=this.objectIdField,
ca=this,fa=new d,ja=new d,pa=this.graphics;if(-1!==l.indexOf(J,1)){var ka=this.spatialIndex||this._map&&this._map.spatialIndex,wa,ra=y.geometry._normalize(null,!0);null==ka&&Ca.autoSpatialIndexing?wa=(this._map||this).addPlugin(this._getAbsMid("../plugins/spatialIndex")).then(t.hitch(this,t.partial(this._getFromIndex,ra,ka)),function(oa){ja.resolve(t.hitch(this,t.partial(this._filterByExtent,pa,ra)))}):ka&&(wa=this._getFromIndex(ra,ka));wa?wa.then(function(oa){for(var za=0;za<oa.length;za++)oa[za].results&&
(U=U.concat(oa[za].results));ja.resolve(U)}).otherwise(function(oa){ja.reject(oa)}):ja.resolve(this._filterByExtent(pa,ra))}else ja.resolve(pa);ja.then(function(oa){U=oa;if(-1!==l.indexOf(J,2)){var za=y.objectIds;U=l.filter(U,function(Da){return-1<l.indexOf(za,Da.attributes[Y])})}-1!==l.indexOf(J,3)&&ca.timeInfo&&(oa=y.timeExtent,U=ca._filterByTime(U,oa.startTime,oa.endTime).match);O&&(U=l.map(U,function(Da){return Da.attributes[Y]},this));fa.resolve(U)});return fa},_getFromIndex:function(y,J){J=
J||this.spatialIndex||this._map.spatialIndex;y instanceof Array||(y=[y]);var O=this.id;return g(l.map(y,function(U){return J.intersects(U,O)}))},_filterByExtent:function(y,J){for(var O=[],U=0,Y=y.length;U<Y;U++){var ca=y[U],fa=ca.geometry;fa&&(this.normalization&&J.length?(J[0].intersects(fa)||J[1].intersects(fa))&&O.push(ca):J.intersects(fa)&&O.push(ca))}return O},_filterByTime:function(y,J,O){var U=this._startTimeField,Y=this._endTimeField,ca;this._twoTimeFields||(ca=U||Y);var fa=e.isDefined,ja=
[],pa=[],ka,wa=y.length;J=J?J.getTime():-Infinity;O=O?O.getTime():Infinity;if(ca)for(ka=0;ka<wa;ka++){var ra=y[ka];var oa=ra.attributes;U=oa[ca];U>=J&&U<=O?ja.push(ra):pa.push(ra)}else for(ka=0;ka<wa;ka++)ra=y[ka],oa=ra.attributes,ca=oa[U],oa=oa[Y],ca=fa(ca)?ca:-Infinity,oa=fa(oa)?oa:Infinity,ca>=J&&ca<=O||oa>=J&&oa<=O||J>=ca&&O<=oa?ja.push(ra):pa.push(ra);return{match:ja,noMatch:pa}},_getSizeVariables:function(y){return y&&l.filter(y.getVisualVariablesForType("sizeInfo",!1),function(J){return!(!J.field&&
!J.valueExpression)})},_needClientSideSorting:function(y){return this._collection?!(!y||!y.length):l.some(y,function(J){return!!J.valueExpression})},_sortFeatures:function(y){var J=this.renderer,O=this._getSizeVariables(J);if(y&&1<y.length&&this._needClientSideSorting(O)){var U=O[0],Y=this;y.sort(function(ca,fa){ca._layer||(ca._layer=Y);fa._layer||(fa._layer=Y);ca=J._getDataValue(ca,U,"sizeInfo");fa=J._getDataValue(fa,U,"sizeInfo");return null==ca?-1:null==fa?1:fa-ca})}return y},_resolve:function(y,
J,O,U,Y){J&&this[J].apply(this,y);O&&O.apply(null,y);U&&H._resDfd(U,y,Y)},_getShallowClone:function(y){var J=new P,O;for(O in y)y.hasOwnProperty(O)&&(J[O]=y[O]);return J},_canFetchPBF:function(){return!!(Fa&&Ga&&this.supportsFormatPBF)},_canFetchPBFForQuery:function(y){return!(!this._canFetchPBF()||!this._isCacheHintEnabled(y)&&this._isAutoSnapshotMode()||!(y.quantizationParameters||!this.isEditable()&&this.supportsQuantizationEditMode)||y.outStatistics)},_enableEditModeQuantization:function(y,J){y&&
J&&!y.quantizationParameters&&(y.quantizationParameters={mode:"edit"})},_enableCacheHint:function(y,J){var O=this.advancedQueryCapabilities;O&&O.supportsQueryWithCacheHint?null==y.cacheHint&&(y.cacheHint=!0):O&&O.supportsQueryWithResultType&&this.reHostedFS.test(this.url)&&!y.resultType&&(y.resultType=J||"coherent")},_isCacheHintSupported:function(){var y=this.advancedQueryCapabilities;return y?!!(y.supportsQueryWithCacheHint||y.supportsQueryWithResultType&&this.reHostedFS.test(this.url)):!1},_isCacheHintEnabled:function(y){var J=
this.advancedQueryCapabilities;return y&&J?!!(J.supportsQueryWithCacheHint&&y.cacheHint||J.supportsQueryWithResultType&&this.reHostedFS.test(this.url)&&("coherent"===y.resultType||"tile"===y.resultType)):!1},_query:function(y,J,O,U,Y,ca){var fa=this,ja=this._map;ca=ca&&ca.snapToTiles;var pa=new d(H._dfdCanceller),ka=O,wa,ra,oa;if("executeRelationshipQuery"!==y){ka=this._getShallowClone(O);var za=this.getOutFields();ka.outFields||(ka.outFields=za);ka.outFields&&ka.outFields.length&&(ra=-1<l.indexOf(za,
"*")?!1:!l.every(ka.outFields,function(Ha){return-1<l.indexOf(za,Ha)}));ka.returnGeometry=O.hasOwnProperty("returnGeometry")?O.returnGeometry:!O.outStatistics;ka.returnGeometry&&(ka.multipatchOption=this.multipatchOption,null!=ka.maxAllowableOffset||ka.quantizationParameters)&&(O=null!=ka.maxAllowableOffset?ka.maxAllowableOffset:ka.quantizationParameters.tolerance,null!=O&&O!==this.getMaxAllowableOffset()&&(oa=!0));ja&&(ja=ja&&ja.spatialReference,(O=ka.outSpatialReference)?wa=!O.equals(ja):ka.outSpatialReference=
new q(ja.toJson()));ca&&(ja=ka.geometry)&&"extent"===ja.type&&(ka.geometry=this._getExtentOfTiles(ja),ja!==ka.geometry&&this._enableCacheHint(ka));if(!this._applyQueryFilters(ka,"execute"===y&&!ka.outStatistics)){switch(y){case "execute":var Da=new T({features:[]});break;case "executeForIds":Da=[];break;case "executeForCount":Da=0;break;case "executeForExtent":Da={}}this._resolve([Da],J,U,pa);return pa}if(ca="executeForExtent"!==y&&!wa&&!ra&&!oa&&this._canDoClientSideQuery(ka,ca))return pa._pendingDfd=
n(this._doQuery(ka,ca,"executeForIds"===y||"executeForCount"===y)),pa._pendingDfd.then(function(Ha){switch(y){case "execute":Da=new T;Da.features=Ha;break;case "executeForIds":Da=Ha;break;case "executeForCount":Da=Ha.length}fa._resolve([Da],J,U,pa)}),pa}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,Y,pa,!0),pa;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,Y,pa,!0),pa;this._ts&&
(ka._ts=(new Date).getTime());ca="execute"===y&&this._canFetchPBFForQuery(ka);this._enableEditModeQuantization(ka,ca);(pa._pendingDfd=this._task[y](ka,null,null,ca?{format:"pbf"}:null)).addCallbacks(function(Ha){var Ja=!!ka.outStatistics||wa||ra||oa;if("execute"===y||"executeRelationshipQuery"===y)if("execute"===y){var Ea=Ha.features;var Ia=Ea.length;for(--Ia;0<=Ia;Ia--)if(Ea[Ia]._layer=fa,!Ja&&!fa._isTable){var Ma=fa._mode._getFeature(Ea[Ia].attributes[fa.objectIdField]);Ma&&Ea.splice(Ia,1,Ma)}}else for(Ma in Ha)if(Ha.hasOwnProperty(Ma))for(Ea=
Ha[Ma].features,Ia=Ea.length,--Ia;0<=Ia;Ia--)Ea[Ia]._layer=fa;fa._resolve([Ha],J,U,pa)},function(Ha){fa._resolve([Ha],null,Y,pa,!0)});return pa},_getExtentOfTiles:function(y){var J=this._isOnDemandMode()&&this._mode._gridLayer||ma.createFromFeatureLayer({layer:this}),O=this.getMap();O=O&&O.getTargetExtent(y);return J&&O&&J.getExtentOfIntersectingCells(O)||y},_convertFeaturesToJson:function(y,J,O,U){var Y=[],ca=this._selectionSymbol,fa=this.visibilityField,ja,pa=this.objectIdField;this.loaded&&(O||
U)&&(ja=l.filter(this.fields,function(Da){return!1===Da.editable&&(!U||Da.name!==pa)}));for(O=0;O<y.length;O++){var ka=y[O],wa={},ra=ka.geometry,oa=ka.attributes,za=ka.symbol;!ra||U&&this.loaded&&!this.allowGeometryUpdates||(wa.geometry=ra.toJson());fa?(wa.attributes=oa=t.mixin({},oa),oa[fa]=ka.visible?1:0):oa&&(wa.attributes=t.mixin({},oa));wa.attributes&&ja&&ja.length&&l.forEach(ja,function(Da){delete wa.attributes[Da.name]});za&&za!==ca&&(wa.symbol=za.toJson());Y.push(wa)}return J?Y:p.toJson(Y)},
_selectHandler:function(y,J,O,U,Y){switch(J){case na.SELECTION_NEW:this.clearSelection(!0);var ca=!0;break;case na.SELECTION_ADD:ca=!0;break;case na.SELECTION_SUBTRACT:ca=!1}U=y.features;var fa=this._mode,ja=[],pa=this.objectIdField;if(ca)for(ca=0;ca<U.length;ca++){var ka=U[ca];var wa=ka.attributes[pa];ka=fa._addFeatureIIf(wa,ka);ja.push(ka);this._selectFeatureIIf(wa,ka,fa)}else for(ca=0;ca<U.length;ca++)ka=U[ca],wa=ka.attributes[pa],this._unSelectFeatureIIf(wa,fa),wa=fa._removeFeatureIIf(wa),ja.push(wa||
ka);this._isSelOnly&&fa._applyTimeFilter(!0);this._isImageService&&10.7>this.version&&void 0===y.exceededTransferLimit&&(y.exceededTransferLimit=U.length===this.maxRecordCount);this._hasPartialSelectedFeatures=!!y.exceededTransferLimit;this._resolve([ja,J,y.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",O,Y);if(y.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(y,J,O){var U=this._selectedFeatures,Y=U[y];Y||(O._incRefCount(y),U[y]=J,this._isTable||
(this._setSelectSymbol(J),J.attr("data-selected","")));return Y||J},_unSelectFeatureIIf:function(y,J){var O=this._selectedFeatures[y];O&&(J._decRefCount(y),delete this._selectedFeatures[y],this._isTable||(this._setUnSelectSymbol(O),O.attr("data-selected")));return O},_setSelectSymbol:function(y){var J=this._selectionSymbol;J&&!this._isSelOnly&&y.setSymbol(J)},_setUnSelectSymbol:function(y){var J=this._selectionSymbol;J&&!this._isSelOnly&&J===y.symbol&&y.setSymbol(null,!0)},_getOutFields:function(){var y=
[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._requiredFields).concat(this.dataAttributes);y=l.filter(y,function(O,U,Y){return!!O&&l.indexOf(Y,O)===U});var J=t.clone(this._outFields);if(J){if(-1!==l.indexOf(J,"*"))return J;l.forEach(y,function(O){-1===l.indexOf(J,O)&&J.push(O)});return J}return y},_checkFields:function(y){var J=y||this._getOutFields();l.forEach(J,function(O){"*"!==O&&(this._getField(O)||console.debug("esri.layers.FeatureLayer: "+
e.substitute({url:this.url,field:O},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);y||this._isTable||this._fserver||this._collection||this._isStream||l.some(this.fields,function(O){return O&&"esriFieldTypeGeometry"===O.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+e.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]"))},
_fixFieldCase:function(y,J,O){var U=y&&y[J],Y;if(U&&!t.isFunction(U)){if(Y=!this._getField(U)&&this._getField(U,!0))U=y[J]=Y.name;O&&O.push(U)}return U},_fixRendererFields:function(){var y=this.renderer;this._orderBy=null;this._requiredFields=[];if(y&&0<this.fields.length){var J=[],O;y=l.filter([y,y.observationRenderer,y.latestObservationRenderer,y.trackRenderer],e.isDefined);var U=[].concat(y);l.forEach(y,function(Y){l.forEach(Y.rendererInfos,function(ca){ca.renderer&&U.push(ca.renderer)})});l.forEach(U,
function(Y){this._fixFieldCase(Y,"attributeField",J);this._fixFieldCase(Y,"attributeField2",J);this._fixFieldCase(Y,"attributeField3",J);this._fixFieldCase(Y.rotationInfo,"field",J);(O=this._fixFieldCase(Y.sizeInfo,"field",J))&&!this._orderBy&&(this._orderBy=[O+" DESC"]);this._fixFieldCase(Y.sizeInfo,"normalizationField",J);this._fixFieldCase(Y.colorInfo,"field",J);this._fixFieldCase(Y.colorInfo,"normalizationField",J);this._fixFieldCase(Y.field,"field",J);this._fixFieldCase(Y.opacityInfo,"field",
J);this._fixFieldCase(Y.opacityInfo,"normalizationField",J);l.forEach(Y.visualVariables,function(fa){O=this._fixFieldCase(fa,"field",J);"sizeInfo"===fa.type&&O&&!this._orderBy&&(this._orderBy=[O+" DESC"]);this._fixFieldCase(fa,"normalizationField",J)},this);var ca=l.map(this.fields,function(fa){return fa.name},this);ca=l.map(Y.getFieldsUsedInExpressions(ca),function(fa){var ja=this.getField(fa);return ja?ja.name:fa},this);J=J.concat(ca);this._orderBy||!Y.addBreak||t.isFunction(Y.attributeField)||
!Y.backgroundFillSymbol&&!this._hasSizeDiff(Y)||(this._orderBy=[Y.attributeField+" DESC"])},this);this._requiredFields=l.filter(J,e.isDefined)}},_hasSizeDiff:function(y){var J=Number.MAX_VALUE,O=-Number.MAX_VALUE,U,Y;l.forEach(y.infos,function(ca){if(Y=ca.symbol){U=0;switch(Y.type){case "simplemarkersymbol":U=Y.size;break;case "picturemarkersymbol":U=(Y.width+Y.height)/2;break;case "simplelinesymbol":case "cartographiclinesymbol":U=Y.width;break;case "simplefillsymbol":case "picturefillsymbol":U=
Y.outline&&Y.outline.width}U&&(J=Math.min(J,U),O=Math.max(O,U))}});return J!==Number.MAX_VALUE&&O!==-Number.MAX_VALUE&&1<Math.abs(O-J)},getOrderByFields:function(){var y=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&y?l.filter(y,function(J){J=J.split(" ")[0];return!!this._getField(J,!0)},this):null},_createFields:function(y){var J=y?y.length:0,O,U=[];for(O=0;O<J;O++)U.push(new R(y[O]));this.fields=U},_createFieldsIndex:function(){if(this._fieldsIndexDirty){var y=this.fields,
J=y?y.length:0;if(50<J&&this._canUseFieldsIndex()){var O=new Map;for(var U=new Map,Y=0;Y<J;Y++){var ca=y[Y];O.set(ca.name,ca);U.set(ca.name.toLowerCase(),ca)}O={caseSensitive:O,caseInsensitive:U}}this._fieldsIndex=O;this._fieldsIndexDirty=!1}},_canUseFieldsIndex:function(){var y=m.Map;return!("function"!==typeof m.Proxy||"function"!==typeof m.Proxy.revocable||"function"!==typeof y||!y.prototype||"function"!==typeof y.prototype.set)},_getField:function(y,J){var O=this.fields;if(!O||0===O.length)return null;
J&&(y=y.toLowerCase());this._createFieldsIndex();var U=this._fieldsIndex;if(U)return U=J?U.caseInsensitive:U.caseSensitive,U.get(y);var Y;l.some(O,function(ca){var fa=!1;(fa=J?ca&&ca.name.toLowerCase()===y?!0:!1:ca&&ca.name===y?!0:!1)&&(Y=ca);return fa});return Y},_getDateOpts:function(){this._dtOpts||(this._dtOpts={properties:l.map(l.filter(this.fields,function(y){return!(!y||"esriFieldTypeDate"!==y.type)}),function(y){return y.name})});return this._dtOpts},_applyNormalized:function(y,J){y&&J&&l.forEach(y,
function(O,U){O&&J[U]&&O.setGeometry(J[U])})},_editHandler:function(y,J,O,U,Y,ca){Y=y.addResults;var fa=y.updateResults;y=y.deleteResults;var ja,pa=this.objectIdField,ka=this._mode,wa=this._isTable;var ra=this.editFieldsInfo;var oa=this.getOutFields()||[];var za=ra&&ra.creatorField,Da=ra&&ra.creationDateField,Ha=ra&&ra.editorField,Ja=ra&&ra.editDateField;ra=ra&&ra.realm;-1===l.indexOf(oa,"*")&&(za&&-1===l.indexOf(oa,za)&&(za=null),Da&&-1===l.indexOf(oa,Da)&&(Da=null),Ha&&-1===l.indexOf(oa,Ha)&&(Ha=
null),Ja&&-1===l.indexOf(oa,Ja)&&(Ja=null));var Ea=Da||Ja?(new Date).getTime():null,Ia=za||Ha?this.getUserId():void 0;Ia&&ra&&(Ia=Ia+"@"+ra);if(Y){var Ma=this.globalIdField;for(ra=0;ra<Y.length;ra++)if(Y[ra]=new sa(Y[ra]),!wa){var La=Y[ra];if(La.success){var Ka=La.objectId;oa=J[ra];(ja=oa._graphicsLayer)&&ja!==this&&ja.remove(oa);ja=oa.attributes||{};ja[pa]=Ka;Ka=La.globalId;Ma&&Ka&&(ja[Ma]=Ka);za&&(ja[za]=Ia);Ha&&(ja[Ha]=Ia);Da&&(ja[Da]=Ea);Ja&&(ja[Ja]=Ea);oa.setAttributes(ja);ka._init&&ka.drawFeature(oa)}}}if(fa)for(ra=
0;ra<fa.length;ra++)if(fa[ra]=new sa(fa[ra]),!wa&&(La=fa[ra],La.success)){Ka=La.objectId;oa=O[Ka];if(J=ka._getFeature(Ka))J.geometry!==oa.geometry&&oa.geometry&&J.setGeometry(da.fromJson(oa.geometry.toJson())),J.attributes!==oa.attributes&&oa.attributes&&J.setAttributes(t.mixin(J.attributes,oa.attributes)),this._repaint(J,Ka);oa=J||oa;ja=oa.attributes||{};Ha&&(ja[Ha]=Ia);Ja&&(ja[Ja]=Ea);oa.setAttributes(ja)}if(y){O=[];for(ra=0;ra<y.length;ra++)if(y[ra]=new sa(y[ra]),!wa&&(La=y[ra],La.success&&(Ka=
La.objectId,oa=ka._getFeature(Ka))))this._unSelectFeatureIIf(Ka,ka)&&O.push(oa),oa._count=0,ka._removeFeatureIIf(Ka);if(0<O.length)this.onSelectionComplete(O,na.SELECTION_SUBTRACT)}this._resolve([Y,fa,y],"onEditsComplete",U,ca)},_sendAttachment:function(y,J,O,U,Y){var ca=this;return r({url:this._url.path+"/"+J+"/"+("add"===y?"addAttachment":"updateAttachment"),form:O,content:t.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(fa){var ja=
"add"===y?"onAddAttachmentComplete":"onUpdateAttachmentComplete";fa=new sa(fa["add"===y?"addAttachmentResult":"updateAttachmentResult"]);fa.attachmentId=fa.objectId;fa.objectId=J;ca._resolve([fa],ja,U);return fa}).addErrback(function(fa){ca._resolve([fa],null,Y,null,!0)})},_repaint:function(y,J,O){J=e.isDefined(J)?J:y.attributes[this.objectIdField];J in this._selectedFeatures&&this._selectionSymbol||y.setSymbol(y.symbol,O)},_getKind:function(y){var J=this._trackManager;return J?J.isLatestObservation(y)?
1:0:0}});t.mixin(na,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,MODE_AUTO:6,MODE_STREAM:7,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});Q._createWrappers(na);Object.defineProperty(na.prototype,"graphics",{get:function(){return this._hasOnDemandDrillMode()?this._mode.graphics:this._graphicsVal},set:function(y){this._graphicsVal=y}});Object.defineProperty(na.prototype,
"name",{get:function(){return this.arcgisProps&&this.arcgisProps.title?this.arcgisProps.title:this._name},set:function(y){this._name=y;this.loaded&&this.arcgisProps&&(this.arcgisProps.title=null)}});Object.defineProperty(na.prototype,"fields",{get:function(){return this._fields},set:function(y){y&&this._canUseFieldsIndex()&&(y=new Proxy(y,{set:t.hitch(this,function(J,O,U){if(O)if("length"===O)this._fieldsIndexDirty=!0;else{var Y=Number(O);"number"!==typeof Y||isNaN(Y)||(this._fieldsIndexDirty=!0)}J[O]=
U;return!0})}));this._fields=y;this._fieldsIndexDirty=!0}});a("extend-esri")&&t.setObject("layers.FeatureLayer",na,f);return na})},"esri/arcadeProfiles/labelingProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(G,A,B,v,t,l,p,d){G=new (G(null,{declaredClass:"esri.arcadeProfiles.LabelingProfile",defaults:{context:{vars:{$feature:"any"}}},initialize:function(k){var c=[];d.hasGeometryOperations(k)&&
c.push(p.enableGeometryOperations());return t(c)},isAsync:function(k){return!1},parse:function(k){return p.createSyntaxTree(k.expression)},compile:function(k){var c=A.clone(this.defaults.context);return k.syntaxTree?p.createFunction(k.syntaxTree,c):null},getEvalOptions:function(k){var c=k.feature;return{context:{vars:{$feature:c&&k.expression.hasVariable("$feature")?l.createFromGraphicLikeObject(c.geometry,c.attributes,k.layer):null},spatialReference:k.spatialReference}}}}));B("extend-esri")&&A.setObject("arcadeProfiles.labelingProfile",
G,v);return G})},"esri/tasks/QueryTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/DeferredList ../kernel ../sniff ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g){var a=k("esri-pbf"),f=A(null,{url:null,query:null,requestOptions:null,pagination:null,pageSize:null,_fetchDfd:null,_startPage:null,_result:null,constructor:function(r){this._handleSuccess=
B.hitch(this,this._handleSuccess);this._handleError=B.hitch(this,this._handleError);B.mixin(this,r);null==this.pagination&&(this.pagination=!1);null==this.pageSize&&(this.pageSize=1E3)},execute:function(){var r=new t(this._canceler);this._fetchDfd=r;this._result=null;this._sendRequest();return r.promise},_canceler:function(r){var w=r._pendingRequest;if(!r.isFulfilled()&&w&&!w.isFulfilled()){w.cancel();var H=w.results&&w.results[1]}r._pendingRequest=null;return H},_sendRequest:function(r){var w=this.query;
this.pagination&&(this._startPage=w.resultOffset=null==r?0:r,w.resultRecordCount=this.pageSize);r=this.requestOptions;this._fetchDfd._pendingRequest=c({url:this.url,content:w,handleAs:"pbf"===w.f?"arraybuffer":"json",callbackParamName:"callback",timeout:r&&r.timeout},r);this._fetchDfd._pendingRequest.then(this._handleSuccess).otherwise(this._handleError)},_handleSuccess:function(r){this.pagination?(r.exceededTransferLimit&&this._sendRequest(this._startPage+this.pageSize),this._result?this._result.features=
this._result.features.concat(r.features):this._result=r,this._fetchDfd.progress(r),r.exceededTransferLimit||this._fetchDfd.resolve(this._result)):(this._fetchDfd.progress(r),this._fetchDfd.resolve(r))},_handleError:function(r){this._fetchDfd.reject(r)}}),e=A(m,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(r,w){this._handler=
B.hitch(this,this._handler);this._relationshipQueryHandler=B.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=B.hitch(this,this._executeForIdsHandler);this._countHandler=B.hitch(this,this._countHandler);this._extentHandler=B.hitch(this,this._extentHandler);this.source=w&&w.source;this.gdbVersion=w&&w.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"rawExecute",c:2,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,
p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onRawExecuteComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(r,w,H,x,q){var C=q.assembly;r=this._encode(B.mixin({},this._url.query,{f:x&&x.format||"json"},r.toJson(C&&C[0])));var F=this._handler,
u=this._errorHandler;this.source&&(x={source:this.source.toJson()},r.layer=l.toJson(x));this.gdbVersion&&(r.gdbVersion=this.gdbVersion);var E="pbf"===r.f;if(E){var D;a||(D="QueryTask.execute: 'pbf' format is not supported in your browser.");if(D)return r=new t,r.addErrback(function(M){u(M,H,q.dfd)}),r.reject(Error(D)),r}D=this.requestOptions;D=c({url:this._url.path+"/query",content:r,callbackParamName:"callback",handleAs:E?"arraybuffer":"json",timeout:D&&D.timeout},D);r=[D];E&&r.push(e.loadPBFReader());
(new p(r)).then(function(M){q.dfd.isFulfilled()||(M=M[0],M[0]?F(M[1],E,w,H,q.dfd):u(M[1],H,q.dfd))});return D},rawExecute:function(r,w,H){w=w||{};r=this._encode(B.mixin({},this._url.query,{f:w.format||"json"},r.toJson(H.assembly&&H.assembly[0])));this.source&&(r.layer=l.toJson({source:this.source.toJson()}));this.gdbVersion&&(r.gdbVersion=this.gdbVersion);return(new f({url:this._url.path+"/query",query:r,requestOptions:this.requestOptions,pagination:w.pagination,pageSize:w.pageSize})).execute().then(null,
null,function(x){H.dfd.progress(x)}).then(B.hitch(this,function(x){this._successHandler([x],"onRawExecuteComplete",null,H.dfd)})).otherwise(B.hitch(this,function(x){this._errorHandler(x,null,H.dfd)}))},executeRelationshipQuery:function(r,w,H){r=this._encode(B.mixin({},this._url.query,{f:"json"},r.toJson()));var x=this._relationshipQueryHandler,q=this._errorHandler;this.gdbVersion&&(r.gdbVersion=this.gdbVersion);var C=new t(b._dfdCanceller),F=this.requestOptions,u=this._url.path;this.source&&void 0!==
this.source.mapLayerId&&null!==this.source.mapLayerId&&u.endsWith("/dynamicLayer")&&(u=u.slice(0,-13),u=u+"/"+this.source.mapLayerId);C._pendingDfd=c({url:u+"/queryRelatedRecords",content:r,callbackParamName:"callback",timeout:F&&F.timeout,load:function(E,D){x(E,D,w,H,C)},error:function(E){q(E,H,C)}},F);return C},executeForIds:function(r,w,H,x){var q=x.assembly;r=this._encode(B.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},r.toJson(q&&q[0])));var C=this._executeForIdsHandler,F=this._errorHandler;
this.source&&(q={source:this.source.toJson()},r.layer=l.toJson(q));this.gdbVersion&&(r.gdbVersion=this.gdbVersion);q=this.requestOptions;return c({url:this._url.path+"/query",content:r,callbackParamName:"callback",timeout:q&&q.timeout,load:function(u,E){C(u,E,w,H,x.dfd)},error:function(u){F(u,H,x.dfd)}},q)},executeForCount:function(r,w,H,x){var q=x.assembly;r=this._encode(B.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},r.toJson(q&&q[0])));var C=this._countHandler,F=this._errorHandler;
this.source&&(q={source:this.source.toJson()},r.layer=l.toJson(q));this.gdbVersion&&(r.gdbVersion=this.gdbVersion);q=this.requestOptions;return c({url:this._url.path+"/query",content:r,callbackParamName:"callback",timeout:q&&q.timeout,load:function(u,E){C(u,E,w,H,x.dfd)},error:function(u){F(u,H,x.dfd)}},q)},executeForExtent:function(r,w,H,x){var q=x.assembly;r=this._encode(B.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},r.toJson(q&&q[0])));var C=this._extentHandler,F=
this._errorHandler;this.source&&(q={source:this.source.toJson()},r.layer=l.toJson(q));this.gdbVersion&&(r.gdbVersion=this.gdbVersion);q=this.requestOptions;return c({url:this._url.path+"/query",content:r,callbackParamName:"callback",timeout:q&&q.timeout,load:function(u,E){C(u,E,w,H,x.dfd)},error:function(u){F(u,H,x.dfd)}},q)},_handler:function(r,w,H,x,q){try{r&&w&&(r=e.pbfDeps.optimizedFeatures.convertToFeatureSet(e.pbfDeps.pbfQueryUtils.parsePBFFeatureQuery(r)));var C=new g(r);this._successHandler([C],
"onComplete",H,q)}catch(F){this._errorHandler(F,x,q)}},_relationshipQueryHandler:function(r,w,H,x,q){try{var C=r.geometryType,F=r.spatialReference,u={};v.forEach(r.relatedRecordGroups,function(E){var D={};D.geometryType=C;D.spatialReference=F;D.features=E.relatedRecords;D=new g(D);if(null!=E.objectId)u[E.objectId]=D;else for(var M in E)E.hasOwnProperty(M)&&"relatedRecords"!==M&&(u[E[M]]=D)});this._successHandler([u],"onExecuteRelationshipQueryComplete",H,q)}catch(E){this._errorHandler(E,x,q)}},_executeForIdsHandler:function(r,
w,H,x,q){try{this._successHandler([r.objectIds],"onExecuteForIdsComplete",H,q)}catch(C){this._errorHandler(C,x,q)}},_countHandler:function(r,w,H,x,q){try{var C=r.features,F=r.objectIds;if(F)var u=F.length;else{if(C)throw Error("Unable to perform query. Please check your parameters.");u=r.count}this._successHandler([u],"onExecuteForCountComplete",H,q)}catch(E){this._errorHandler(E,x,q)}},_extentHandler:function(r,w,H,x,q){try{r.extent&&(r.extent=new h(r.extent)),this._successHandler([r],"onExecuteForExtentComplete",
H,q)}catch(C){this._errorHandler(C,x,q)}}});e.loadPBFReader=function(){var r=new t;e.pbfDeps?r.resolve():G(["./support/pbfDeps"],function(w){e.pbfDeps=w;r.isFulfilled()||r.resolve()});return r.promise};n._createWrappers(e);k("extend-esri")&&B.setObject("tasks.QueryTask",e,d);return e})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(G,A,B){G.DeferredList=function(v,t,l,p,d){var k=[];A.call(this);var c=this;0!==v.length||t||this.resolve([0,[]]);
var b=0;B.forEach(v,function(h,n){function m(g,a){k[n]=[g,a];b++;b===v.length&&c.resolve(k)}h.then(function(g){t?c.resolve([n,g]):m(!0,g)},function(g){l?c.reject(g):m(!1,g);if(p)return null;throw g;})})};G.DeferredList.prototype=new A;G.DeferredList.prototype.gatherResults=function(v){v=new G.DeferredList(v,!1,!0,!1);v.addCallback(function(t){var l=[];B.forEach(t,function(p){l.push(p[1])});return l});return v};return G.DeferredList})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),
function(G,A,B,v,t,l,p,d){G=G(d,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(k,c){k&&A.isString(k)&&(this._url=p.urlToObject(this.url=k));c&&c.requestOptions&&(this.requestOptions=c.requestOptions);this.normalization=!0;this._errorHandler=A.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var k=this._url,c=/^http:/i;this.url&&(this.url=this.url.replace(c,"https:"));k&&k.path&&(k.path=k.path.replace(c,"https:"))},
_encode:function(k,c,b){var h={},n;for(n in k)if("declaredClass"!==n){var m=k[n];var g=typeof m;if(null!==m&&void 0!==m&&"function"!==g)if(A.isArray(m)){h[n]=[];var a=m.length;for(g=0;g<a;g++)h[n][g]=this._encode(m[g])}else"object"===g?m.toJson&&(g=m.toJson(b&&b[n]),"esri.tasks.FeatureSet"===m.declaredClass&&g.spatialReference&&(g.sr=g.spatialReference,delete g.spatialReference),h[n]=c?g:B.toJson(g)):h[n]=m}return h},_successHandler:function(k,c,b,h){c&&this[c].apply(this,k);b&&b.apply(null,k);h&&
l._resDfd(h,k)},_errorHandler:function(k,c,b){this.onError(k);c&&c(k);b&&b.errback(k)},setNormalization:function(k){this.normalization=k},onError:function(){}});v("extend-esri")&&(t.Task=G);return G})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h){G=G(null,{declaredClass:"esri.tasks.FeatureSet",
constructor:function(n,m){if(n){A.mixin(this,n);var g=this.features=this.features||[],a=n.spatialReference;a=this.spatialReference=b.createInstance(d.simpleConstructor,a);var f=b.getGeometryType(n.geometryType);this.geometryType=n.geometryType;n.fields&&(this.fields=n.fields);n=b.supportsLazyUnquantization(this.geometryType);var e=b.unquantizeFunction(this.geometryType,this.transform),r=!!(m&&n&&e),w=f&&(r?f.accessorConstructor:f.simpleConstructor);B.forEach(g,function(H,x){var q=b.createInstance(p.simpleConstructor),
C=H.geometry;if(f&&C){var F=q.geometry=b.createInstance(w,r?null:C);F.setSpatialReference(C.spatialReference?b.createInstance(d.simpleConstructor,C.spatialReference):a);r&&F.setupLazyUnquantization(e,C)}q.symbol=H.symbol?h.fromJson(H.symbol):null;q.attributes=H.attributes;g[x]=q});r||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(n){var m={};this.displayFieldName&&(m.displayFieldName=this.displayFieldName);this.fields&&
(m.fields=this.fields);this.spatialReference?m.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(m.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(m.geometryType=b.getJsonType(this.features[0].geometry)),m.features=k._encodeGraphics(this.features,n));m.geometryType=m.geometryType||this.geometryType;m.exceededTransferLimit=this.exceededTransferLimit;m.transform=this.transform;return l.fixJson(m)},
_hydrate:function(){b.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(n){if(!this.geometryType)return this.transform=null,this;var m=n.translate[0],g=n.translate[1],a=n.scale[0],f=n.scale[1],e=this.features,r=function(q,C,F){var u,E=[];var D=0;for(u=q.length;D<u;D++){var M=q[D];if(0<D){var I=C(M[0]);M=F(M[1]);if(I!==z||M!==K){E.push([I-z,M-K]);var z=I;var K=M}}else z=C(M[0]),K=F(M[1]),E.push([z,K])}return 0<E.length?E:null},w=function(q,C,F){if("esriGeometryPoint"===
q)return function(u){u.x=C(u.x);u.y=F(u.y);return u};if("esriGeometryPolyline"===q||"esriGeometryPolygon"===q)return function(u){var E;var D=u.rings||u.paths;var M=[];var I=0;for(E=D.length;I<E;I++){var z=D[I];(z=r(z,C,F))&&M.push(z)}return 0<M.length?(u.rings?u.rings=M:u.paths=M,u):null};if("esriGeometryMultipoint"===q)return function(u){var E=r(u.points,C,F);return 0<E.length?(u.points=E,u):null};if("esriGeometryEnvelope"===q)return function(u){return u}}(this.geometryType,function(q){return Math.round((q-
m)/a)},function(q){return Math.round((g-q)/f)}),H;var x=0;for(H=e.length;x<H;x++)e[x].geometry&&(w(e[x].geometry)||e[x].setGeometry(null));this.transform=n;return this}});G.createGraphics=function(n){var m=n.geometryType,g=b.createInstance(d.simpleConstructor,n.spatialReference),a=b.getGeometryType(m).accessorConstructor,f=b.unquantizeFunction(m,n.transform);return B.map(n.features,function(e,r){r=b.createInstance(p.simpleConstructor);var w=e.geometry;if(w){var H=r.geometry=b.createInstance(a);H.setSpatialReference(g);
H.setupLazyUnquantization(f,w)}r.attributes=e.attributes;return r})};G.createPolygon=function(n,m,g){if(n){var a=b.createInstance(c.accessorConstructor);a.setSpatialReference(m);m=b.unquantizeFunction("esriGeometryPolygon",g);a.setupLazyUnquantization(m,n)}return a};v("extend-esri")&&A.setObject("tasks.FeatureSet",G,t);return G})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(G,A,B,v){G=G(null,{declaredClass:"esri.tasks.StatisticDefinition",
toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});B("extend-esri")&&A.setObject("tasks.StatisticDefinition",G,v);return G})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../symbols/jsonUtils ./FeatureTemplate ./support/domainUtils".split(" "),
function(G,A,B,v,t,l,p,d,k){G=G(null,{declaredClass:"esri.layers.FeatureType",constructor:function(c){if(c&&A.isObject(c)){this.id=c.id;this.name=c.name;var b=c.symbol;b&&(this.symbol=p.fromJson(b));b=c.domains;var h=this.domains={};for(n in b)b.hasOwnProperty(n)&&(h[n]=k.fromJson(b[n]));if(c=c.templates){var n=this.templates=[];for(b=0;b<c.length;b++)n.push(new d(c[b]))}}},toJson:function(){var c={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},b,h=this.domains,n=this.templates,
m=l.fixJson;if(h){var g=c.domains={};for(b in h)h.hasOwnProperty(b)&&(g[b]=h[b]&&h[b].toJson());m(g)}n&&(c.templates=B.map(n,function(a){return a.toJson()}));return m(c)}});v("extend-esri")&&A.setObject("layers.FeatureType",G,t);return G})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../graphic".split(" "),function(G,A,B,v,t,l){G=G(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(p){p&&A.isObject(p)&&(this.name=
p.name,this.description=p.description,this.drawingTool=p.drawingTool,this.thumbnail=p.thumbnail,p=p.prototype,this.prototype=new l(p.geometry,null,p.attributes))},toJson:function(){return t.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,thumbnail:t.fixJson(A.clone(this.thumbnail)),prototype:this.prototype&&this.prototype.toJson()})}});A.mixin(G,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",
TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});
B("extend-esri")&&A.setObject("layers.FeatureTemplate",G,v);return G})},"esri/layers/support/domainUtils":function(){define("dojo/_base/lang dojo/has ../../kernel ../RangeDomain ../CodedValueDomain ../InheritedDomain".split(" "),function(G,A,B,v,t,l){var p={fromJson:function(d){if(d)switch(d.type){case "range":var k=new v(d);break;case "codedValue":k=new t(d);break;case "inherited":k=new l(d)}return k}};A("extend-esri")&&G.setObject("layers.support.domainUtils",p,B);return p})},"esri/layers/FeatureSubtype":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./support/domainUtils".split(" "),
function(G,A,B,v,t,l){G=G(null,{declaredClass:"esri.layers.FeatureSubtype",constructor:function(p){if(p&&A.isObject(p)){this.code=p.code;this.name=p.name;this.defaultValues=p.defaultValues;p=p.domains;var d=this.domains={},k;for(k in p)p.hasOwnProperty(k)&&(d[k]=l.fromJson(p[k]))}},toJson:function(){var p=t.fixJson,d={code:this.code,name:this.name,defaultValues:p(A.clone(this.defaultValues))},k=this.domains;if(k){var c=d.domains={},b;for(b in k)k.hasOwnProperty(b)&&(c[b]=k[b]&&k[b].toJson());p(c)}return p(d)}});
B("extend-esri")&&A.setObject("layers.FeatureSubtype",G,v);return G})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(G,A,B,v){G=G(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(t){t&&A.isObject(t)&&(this.objectId=t.objectId,this.globalId=t.globalId,this.success=t.success,t.success||(t=t.error,this.error=Error(),this.error.code=t.code,this.error.message=t.description))}});B("extend-esri")&&A.setObject("layers.FeatureEditResult",
G,v);return G})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ../srUtils ../tasks/query ./RenderMode ./support/ParallelSnapshot".split(" "),function(G,A,B,v,t,l,p,d,k){G=G([d],{declaredClass:"esri.layers._SnapshotMode",maxFeatures:5E4,maxRecordCountFactor:1,scaleToTileFactor:1,_isSuspendedAtStartup:!1,_pendingRefresh:!1,constructor:function(c){this.featureLayer=c;this._featureMap={};this._hasUpdateError=this._hasPartialFeatures=
!1;this._drawFeatures=A.hitch(this,this._drawFeatures);this._queryErrorHandler=A.hitch(this,this._queryErrorHandler);this._handleSuccess=A.hitch(this,this._handleSuccess);this._handleError=A.hitch(this,this._handleError);this._handleProgress=A.hitch(this,this._handleProgress)},startup:function(){if(!this._started||this._isSuspendedAtStartup){this.inherited(arguments);var c=this.featureLayer,b=c.reHostedFS.test(c.url);this.pagination=c.queryPagination&&null!=c.maxRecordCount;this._cacheHintSupported=
c._isCacheHintSupported();this.scaleToTileFactor=this._getScaleToTileFactor();b&&this.pagination&&(this._parallelSnapshot=new k({layer:c,mode:this,queryTask:c._task}));this._isSuspendedAtStartup=c.suspended;this._startup()}},propertyChangeHandler:function(c){this._init&&(c?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},
destroy:function(){this._isSuspendedAtStartup=this._pendingRefresh=!1;this._cancelPendingRequest(this._pendingRequest);this._parallelSnapshot&&this._parallelSnapshot.destroy();this.inherited(arguments)},drawFeature:function(c){var b=c.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(b,c);this._incRefCount(b)},resume:function(){this._isSuspendedAtStartup||this._pendingRefresh?(this._isSuspendedAtStartup=!1,this._startup()):this.propertyChangeHandler(0)},refresh:function(){var c=this.featureLayer;
c._collection?(c._fireUpdateStart(),c._refresh(!0),c._fireUpdateEnd()):this._fetchAll()},hasAllFeatures:function(){return!this._hasPartialFeatures},hasUpdateError:function(){return this._hasUpdateError},canFetchPBF:function(c){return this.inherited(arguments)&&this.featureLayer._canFetchPBFForQuery(c)},_startup:function(){this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},_fetchAll:function(){var c=this.featureLayer;c._collection||c.suspended||!c.isQueryable()?this._pendingRefresh=
c.suspended:(this._pendingRefresh=!1,c._fireUpdateStart(),this._clearIIf(),this._hasUpdateError=this._hasPartialFeatures=!1,this._parallelSnapshot?this._parallelSnapshot.fetch().then(this._handleSuccess,this._handleError,this._handleProgress):this._sendRequest())},_handleSuccess:function(c){this._hasPartialFeatures=c.hasPartialFeatures;this._hasUpdateError=c.hasUpdateError;this.featureLayer._fireUpdateEnd(null)},_handleError:function(c){this._queryErrorHandler(c)},_handleProgress:function(c){c.isError?
this.featureLayer._errorHandler(c.error):this._addFeatures(c.features)},_getScaleToTileFactor:function(){var c=this.featureLayer.tileMaxRecordCount,b=this.featureLayer.maxRecordCount,h=1;null!=c&&null!=b&&(h=Number((c/b).toFixed(2)));return h},_getPageSize:function(c){var b=this.featureLayer.tileMaxRecordCount;b="tile"===c.resultType&&b?b:this.featureLayer.maxRecordCount;c.maxRecordCountFactor&&(b=Math.floor(b*c.maxRecordCountFactor));return b},_sendRequest:function(c){var b=this.featureLayer,h=this._createQueryInfo(),
n=h.query;this.pagination&&(this._pageSize=this._getPageSize(n),this._start=n.start=null==c?0:c,n.num=this._pageSize);this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);this._pendingRequest=b._task.execute(n,this._drawFeatures,this._queryErrorHandler,h.pbf?{format:"pbf"}:null)},_drawFeatures:function(c){this._pendingRequest=null;this.featureLayer._isImageService&&10.7>this.featureLayer.version&&void 0===c.exceededTransferLimit&&(c.exceededTransferLimit=c.features.length===this.featureLayer.maxRecordCount);
var b=this.featureLayer,h=c.exceededTransferLimit,n=h&&!b._collection;c=this._checkMaxLimit(c.features);var m=c.maxLimitReached;this._addFeatures(c.features);this.pagination&&n&&!m||(this._hasPartialFeatures=!!h,b._fireUpdateEnd(null,h?{queryLimitExceeded:!0}:null));n&&(this.pagination&&!m&&this._sendRequest(this._start+this._pageSize),b.onQueryLimitExceeded())},_queryErrorHandler:function(c){this._pendingRequest=null;this._hasUpdateError=this._hasPartialFeatures=!0;var b=this.featureLayer;b._errorHandler(c);
b._fireUpdateEnd(c)},_checkMaxLimit:function(c){var b=c?c.length:0,h=this.featureLayer.graphics.length+b,n=h>=this.maxFeatures;if(n){var m=h-this.maxFeatures;m&&c.splice(b-m,m)}return{maxLimitReached:n,featuresDiscarded:h>this.maxFeatures,features:c}},_createQueryInfo:function(){var c=this.featureLayer,b=new p;b.outFields=c.getOutFields();b.where=c._getAttributeFilter()||"1\x3d1";b.returnGeometry=!0;b.outSpatialReference=l.createSpatialReference(this.map.spatialReference.toJson());b.timeExtent=c.getTimeDefinition();
b.maxAllowableOffset=c._maxOffset;b.quantizationParameters=c._quantizationParameters;b.orderByFields=c.supportsAdvancedQueries?c.getOrderByFields():null;b.multipatchOption=c.multipatchOption;c._ts&&(b._ts=(new Date).getTime());this._cacheHintSupported&&c._enableCacheHint(b);var h=this.canFetchPBF(b);c._enableEditModeQuantization(b,h);this._applyMaxRecordCountFactor(b,h);return{query:b,pbf:h}},_applyMaxRecordCountFactor:function(c,b){var h=this.featureLayer.advancedQueryCapabilities;this.featureLayer._isCacheHintEnabled(c)&&
h&&h.supportsMaxRecordCountFactor&&("tile"!==c.resultType&&1<this.scaleToTileFactor&&(c.maxRecordCountFactor=this.scaleToTileFactor),b&&1<this.maxRecordCountFactor&&(c.maxRecordCountFactor=this.maxRecordCountFactor),5<c.maxRecordCountFactor&&(c.maxRecordCountFactor=5))},_addFeatures:function(c){var b=this.featureLayer,h=b.objectIdField,n=c.length,m=b._selectedFeatures,g=b.mode===b.constructor.MODE_AUTO;b._fireUpdateStart();b._sortFeatures(c);for(b=0;b<n;b++){var a=c[b];var f=a.attributes[h];var e=
this._addFeatureIIf(f,a);this._incRefCount(f);g&&e!==a&&m[f]&&(e.setGeometry(a.geometry),e.setAttributes(a.attributes))}this._applyTimeFilter(!0)}});B("extend-esri")&&A.setObject("layers._SnapshotMode",G,v);return G})},"esri/layers/RenderMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","../sniff","../kernel"],function(G,A,B,v,t){var l=!!v("esri-pbf"),p=!!v("esri-featurelayer-pbf");G=G(null,{declaredClass:"esri.layers._RenderMode",enablePBFQuery:l&&p,initialize:function(d){this.map=
d;this._init=!0},startup:function(){this._started=!0},propertyChangeHandler:function(d){},destroy:function(){this._init=this._started=!1},drawFeature:function(d){},suspend:function(){},resume:function(){},refresh:function(){},hasAllFeatures:function(){return!0},hasUpdateError:function(){return!1},canFetchPBF:function(d){return!(!this.featureLayer._canFetchPBF()||!this.enablePBFQuery)},_incRefCount:function(d){(d=this._featureMap[d])&&d._count++},_decRefCount:function(d){(d=this._featureMap[d])&&d._count--},
_getFeature:function(d){return this._featureMap[d]},_addFeatureIIf:function(d,k){var c=this._featureMap,b=c[d],h=this.featureLayer;b||(c[d]=k,h._add(k),k._count=0);return b||k},_removeFeatureIIf:function(d){var k=this._featureMap[d],c=this.featureLayer;if(k){if(k._count)return;delete this._featureMap[d];c._remove(k)}return k},_registerFeature:function(d,k){var c=this._featureMap,b=c[d];b?(b.attributes=k.attributes,b.geometry=k.geometry):(c[d]=k,k._count=0,k._layer=k._graphicsLayer=k._sourceLayer=
this.featureLayer);return b||k},_unregisterFeature:function(d){var k=this._featureMap,c=k[d];c&&!c._count&&(delete k[d],c._graphicsLayer=null)},_clearIIf:function(){var d=this.featureLayer;var k=d.graphics,c=d._selectedFeatures,b=d.getSelectedFeatures().length,h=d.objectIdField;if(b)for(d=k.length-1;0<=d;d--){b=k[d];var n=b.attributes[h];n in c?b._count=1:(b._count=0,this._removeFeatureIIf(n))}else d.clear(),this._featureMap={}},_cancelPendingRequest:function(d){if(d)try{d.cancel()}catch(k){}},_toggleVisibility:function(d){var k=
this.featureLayer,c=k.graphics,b=d?"show":"hide",h,n=c.length;d=d&&k._ager;for(h=0;h<n;h++){var m=c[h];m[b]();d&&k._repaint(m)}},_applyTimeFilter:function(d){var k=this.featureLayer;if(k.timeInfo&&!k.suspended){d||k._fireUpdateStart();var c=k._trackManager;c&&c.clearTracks();var b=k.getTimeDefinition(),h=k._getOffsettedTE(k._mapTimeExtent);h?(h=k._getTimeOverlap(b,h))?(b=k._filterByTime(k.graphics,h.startTime,h.endTime),c&&c.addFeatures(b.match),B.forEach(b.match,function(n){var m=n._shape;n.visible||
(n.show(),(m=n._shape)&&m._moveToFront());k._ager&&m&&k._repaint(n)}),B.forEach(b.noMatch,function(n){n.visible&&n.hide()})):this._toggleVisibility(!1):(c&&c.addFeatures(k.graphics),this._toggleVisibility(!0));c&&(c.moveLatestToFront(),c.drawTracks());d||k._fireUpdateEnd()}}});v("extend-esri")&&A.setObject("layers._RenderMode",G,t);return G})},"esri/layers/support/ParallelSnapshot":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/Deferred ../../kernel".split(" "),
function(G,A,B,v,t,l){G=G(null,{declaredClass:"esri.layers.support.ParallelSnapshot",layer:null,mode:null,queryTask:null,batchSize:5,_queryInfo:null,_fetchDfd:null,_startPage:null,_lastPage:null,_pageSize:null,_maxPages:null,_requests:null,constructor:function(p){A.mixin(this,p);this._requests={}},destroy:function(){this.cancel()},fetch:function(){var p=new t;this.cancel(!0);this._queryInfo=this.mode._createQueryInfo();this._pageSize=this.mode._getPageSize(this._queryInfo.query);this._maxPages=Math.ceil(this._getFeatureCount()/
this._pageSize);this._fetchDfd=p;this._sendRequests();return p.promise},cancel:function(p){this._cancelPendingRequests(p);this._reset()},_reset:function(){this._startPage=this._lastPage=null;this._requests={}},_getFeatureCount:function(){return this.layer.mode===this.layer.constructor.MODE_AUTO&&0===this.layer.getLastExceedsLimitResult()?this.layer._getMaxFeaturesForAutoSnapshotMode():this.mode.maxFeatures},_sendRequests:function(p){var d=this._queryInfo.query,k=this.queryTask,c=this._requests;p=
null==p?1:p;var b=p+this.batchSize-1;b>this._maxPages&&(b=this._maxPages);if(!(p>b))for(this._startPage=p,this._lastPage=b;p<=b;p++)d.start=(p-1)*this._pageSize,d.num=this._pageSize,c[p]=k.execute(d,null,null,this._queryInfo.pbf?{format:"pbf"}:null),c[p].then(A.hitch(this,this._handleSuccess,p)).otherwise(A.hitch(this,this._handleError,p))},_evalNextBatch:function(p){p===this._lastPage&&this._sendRequests(this._lastPage+1)},_handleSuccess:function(p,d){d.exceededTransferLimit||this._cancelLaterRequests(p,
!0);var k=this.mode._checkMaxLimit(d.features);this._fetchDfd.progress({features:k.features,isError:!1});k.maxLimitReached?((p=k.featuresDiscarded||this._hasRejectedRequests())||(p=!!this._getResult(this._getLastSuccessfulRequest()).exceededTransferLimit),this._resolveFetch(p)):(d.exceededTransferLimit&&this._evalNextBatch(p),this._evalResolution())},_handleError:function(p,d){var k=this._requests;k&&k[p]&&(1===p?this._rejectFetch(d):(this._evalNextBatch(p),this._fetchDfd.progress({error:d,isError:!0}),
this._evalResolution()))},_evalResolution:function(){this._hasPendingRequests()||this._resolveFetch(this._hasRejectedRequests())},_resolveFetch:function(p){var d=this._hasRejectedRequests();this.cancel(!0);this._fetchDfd.resolve({hasPartialFeatures:p,hasUpdateError:d})},_rejectFetch:function(p){this.cancel(!0);this._fetchDfd.reject(p)},_getResult:function(p){return p&&p.dfd.results[0]},_hasPendingRequests:function(){return!!this._getPendingRequests().length},_getPendingRequests:function(){var p=this._requests,
d,k=[];for(d in p){var c=p[d];c.isFulfilled()||k.push({pageId:Number(d),dfd:c})}return k},_getLastSuccessfulRequest:function(){var p=this._getResolvedRequests(),d=-Infinity,k;p=B.filter(p,function(c){return!!this._getResult(c).features.length||1===c.pageId},this);B.forEach(p,function(c){c.pageId>d&&(d=c.pageId,k=c)});return k},_getResolvedRequests:function(){var p=this._requests,d,k=[];for(d in p){var c=p[d];c.isResolved()&&k.push({pageId:Number(d),dfd:c})}return k},_hasRejectedRequests:function(){var p=
this._getRejectedRequests(),d=this._getLastSuccessfulRequest(),k=this._getResult(d);k&&!k.exceededTransferLimit&&(p=B.filter(p,function(c){return c.pageId<=d.pageId}));return!!p.length},_getRejectedRequests:function(){var p=this._requests,d,k=[];for(d in p){var c=p[d];c.isRejected()&&k.push({pageId:Number(d),dfd:c})}return k},_cancelPendingRequests:function(p){this._cancelRequests(this._getPendingRequests(),p)},_cancelLaterRequests:function(p,d){var k=B.filter(this._getPendingRequests(),function(c){return c.pageId>
p});this._cancelRequests(k,d)},_cancelRequests:function(p,d){var k=this.mode,c=this._requests;B.forEach(p,function(b){d&&delete c[b.pageId];k._cancelPendingRequest(b.dfd)})}});v("extend-esri")&&A.setObject("layers.support.ParallelSnapshot",G,l);return G})},"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../tasks/query ./RenderMode ./GridLayout".split(" "),function(G,A,B,v,t,l,p,d,k,c){G=G([k],
{declaredClass:"esri.layers._OnDemandMode",constructor:function(b){this.featureLayer=b;this._featureMap={}},initialize:function(b){this.inherited(arguments);this._cellMap={};this._gridLayer=c.createFromFeatureLayer({layer:this.featureLayer,map:b})},startup:function(){if(!this._started||this._isSuspendedAtStartup)this.inherited(arguments),this._ioQueue=[],this._isSuspendedAtStartup=this.featureLayer.suspended,this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(b){this._init&&
(2>b?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this._processIOQueue(!0);this.inherited(arguments)},drawFeature:function(b){var h=b.geometry,n=[];if(h){n=this._gridLayer.getCellsInExtent("point"===h.type?{xmin:h.x,ymin:h.y,xmax:h.x,ymax:h.y}:h.getExtent(),!1).cells;h=this._cellMap;var m,g=b.attributes[this.featureLayer.objectIdField];
for(m=0;m<n.length;m++){var a=n[m];var f=a.latticeID;var e=a.row;var r=a.col;f?a=h[f]=h[f]||a:(h[e]=h[e]||{},a=h[e][r]=h[e][r]||a);a.features=a.features||[];a.features.push(b);this._addFeatureIIf(g,b);this._incRefCount(g)}}},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},hasAllFeatures:function(){var b=!1,h=this._getCurrentCells(),n;for(n=0;n<h.length;n++)if(h[n].hasPartialFeatures){b=
!0;break}return!b},hasUpdateError:function(){var b=!1,h=this._getCurrentCells(),n;for(n=0;n<h.length;n++)if(h[n].hasUpdateError){b=!0;break}return b},canFetchPBF:function(b){return this.inherited(arguments)&&this.featureLayer._canFetchPBFForQuery(b)},_enableConnectors:function(){var b=this.map;this._zoomConnect=A.connect(b,"onZoomEnd",this,this._zoomHandler);this._panConnect=A.connect(b,"onPanEnd",this,this._panHandler);this._resizeConnect=A.connect(b,"onResize",this,this._panHandler)},_disableConnectors:function(){A.disconnect(this._zoomConnect);
A.disconnect(this._panConnect);A.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var b=this.featureLayer,h=this.map;!b.suspended&&b.isQueryable()&&(b._fireUpdateStart(),this._clearIIf(),(b=b._trackManager)&&b.clearTracks(),this._cellMap={},this._gridLayer.setResolution(h.extent),this._sendRequest())},_panHandler:function(b){if(this.featureLayer.isQueryable()){this.featureLayer._fireUpdateStart();var h=this.featureLayer._resized;b=h?b:null;h&&this._gridLayer.setMapState(b,
this.map.width,this.map.height);this._sendRequest(b)}},_sendRequest:function(b){this._exceeds=!1;var h=this.featureLayer,n=this.map;b=b||n.extent;n=this._gridLayer.getCellsInExtent(b,h.latticeTiling).cells;if(!h.isEditable()){var m=this._cellMap;n=v.filter(n,function(e){if(e.lattice){if(m[e.latticeID])return!1}else if(m[e.row]&&m[e.row][e.col])return!1;return!0})}this._pending=this._pending||0;var g;for(g=0;g<n.length;g++){var a=n[g],f=this._createQueryInfo(a);this._pending++;this._ioQueue.push(h._task.execute(f.query,
B.hitch(this,this._drawFeatures,a),B.hitch(this,this._queryErrorHandler,a),f.pbf?{format:"pbf"}:null))}this._removeOldCells(b);this._endCheck()},_drawFeatures:function(b,h){this.featureLayer._isImageService&&10.7>this.featureLayer.version&&void 0===h.exceededTransferLimit&&(h.exceededTransferLimit=h.features.length===this.featureLayer.maxRecordCount);b.hasPartialFeatures=!!h.exceededTransferLimit;b.hasUpdateError=!1;this._exceeds=this._exceeds||h.exceededTransferLimit;this._finalizeIO();var n=this.featureLayer,
m=this.map.extent,g=b.extent,a=b.row,f=b.col,e=n.objectIdField;h=h.features;var r=this._gridLayer,w=this._cellMap,H=b.latticeID;w=H?w[H]:w[a]&&w[a][f];if(b.resolution==r.resolution&&(H?H===r.getLatticeID(m):r.intersects(g,m)))if(w)n._sortFeatures(h),this._updateCell(w,h);else for(n._sortFeatures(h),b.features=h,this._addCellToCellMap(b),n=h.length,b=0;b<n;b++)m=h[b],g=m.attributes[e],this._addFeatureIIf(g,m),this._incRefCount(g);else w&&this._removeCell(a,f,H);this._endCheck()},_queryErrorHandler:function(b,
h){this._finalizeIO();b.hasPartialFeatures=!0;b.hasUpdateError=!0;this._addCellToCellMap(b);this.featureLayer._errorHandler(h);this._endCheck(h)},_finalizeIO:function(){this._pending--},_endCheck:function(b){if(0===this._pending){this._processIOQueue();var h=this.featureLayer,n=h._trackManager;n&&(n.clearTracks(),n.addFeatures(h.graphics),h._ager&&v.forEach(h.graphics,function(m){m._shape&&h._repaint(m)}),n.moveLatestToFront(),n.drawTracks());this.featureLayer._fireUpdateEnd(!!b&&Error("FeatureLayer: "+
(b.message||"an error occurred while updating the layer.")),this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)h.onQueryLimitExceeded()}},_processIOQueue:function(b){this._ioQueue=v.filter(this._ioQueue,function(h){return-1<h.fired?!1:!0});b&&v.forEach(this._ioQueue,this._cancelPendingRequest)},_createQueryInfo:function(b){var h=this.featureLayer,n=new d;n.outFields=h.getOutFields();n.where=h._getAttributeFilter();n.returnGeometry=!0;n.geometry=b.extent||b.lattice;h.latticeTiling&&b.extent&&
(n.spatialRelationship=d.SPATIAL_REL_CONTAINS);n.timeExtent=h._getOffsettedTE(h._mapTimeExtent);n.maxAllowableOffset=h._maxOffset;n.quantizationParameters=h._quantizationParameters;n.orderByFields=h.supportsAdvancedQueries?h.getOrderByFields():null;n.multipatchOption=h.multipatchOption;h._ts&&(n._ts=(new Date).getTime());(b=h.advancedQueryCapabilities)&&b.supportsQueryWithResultType&&(n.resultType="tile");b=this.canFetchPBF(n);h._enableEditModeQuantization(n,b);return{query:n,pbf:b}},_getCurrentCells:function(b){var h=
[];b=b||this._cellMap;for(var n in b)if(b.hasOwnProperty(n)){var m=b[n];m&&(m.hasOwnProperty("row")||m.hasOwnProperty("latticeID")?h.push(m):"object"===typeof m&&h.push.apply(h,this._getCurrentCells(m)))}return h},_addCellToCellMap:function(b){var h=this._cellMap;if(b.latticeID)h[b.latticeID]=b;else{var n=b.row,m=b.col;h[n]=h[n]||{};h[n][m]=b}},_removeOldCells:function(b){var h=this._cellMap,n=this._gridLayer,m,g;for(m in h)if(h[m]){var a=h[m],f=a.latticeID,e=0,r=0;if(f)e++,f!==n.getLatticeID(b)&&
(this._removeCell(null,null,f),r++);else for(g in a)a[g]&&(e++,n.intersects(a[g].extent,b)||(this._removeCell(m,g),r++));r===e&&delete h[m]}},_updateCell:function(b,h){var n=this.featureLayer,m=n.objectIdField;n=n._selectedFeatures;var g,a=h.length;b.features=b.features||[];for(g=0;g<a;g++){var f=h[g],e=f.attributes[m],r=this._addFeatureIIf(e,f);r===f?(this._incRefCount(e),b.features.push(r)):e in n||(r.setGeometry(f.geometry),r.setAttributes(f.attributes))}},_removeCell:function(b,h,n){var m=this._cellMap,
g=this.featureLayer,a=g.objectIdField,f=n?m[n]:m[b]&&m[b][h];if(f&&(n?delete m[n]:delete m[b][h],b=f.features))for(h=0;h<b.length;h++)n=b[h].attributes[a],this._decRefCount(n),n in g._selectedFeatures||this._removeFeatureIIf(n)}});t("extend-esri")&&B.setObject("layers._OnDemandMode",G,l);return G})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/normalizeUtils ../srUtils".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b){var h=G(null,{declaredClass:"esri.layers._GridLayout",constructor:function(n,m,g,a){this.origin=n;this.cellWidth=m.width;this.cellHeight=m.height;this.mapWidth=g.width;this.mapHeight=g.height;this.srInfo=a},setResolution:function(n){this.resolution=(n.xmax-n.xmin)/this.mapWidth;this.srInfo&&(n=Math.round(Math.round(2*this.srInfo.valid[1]/this.resolution)/this.cellWidth),this._frameStats=[n,0,n-1])},setMapState:function(n,m,g){this.mapWidth=m;this.mapHeight=g;this.setResolution(n)},
getCellCoordinates:function(n){var m=this.resolution,g=this.origin;return{row:Math.floor((g.y-n.y)/(this.cellHeight*m)),col:Math.floor((n.x-g.x)/(this.cellWidth*m))}},normalize:function(n){var m=this._frameStats;if(m){var g=m[0],a=m[1];m=m[2];n<a?(n%=g,n=n<a?n+g:n):n>m&&(n%=g)}return n},intersects:function(n,m){var g=this.srInfo;return g?B.some(m._getParts(g),function(a){return n.intersects(a.extent)}):n.intersects(m)},getCellExtent:function(n,m){var g=this.resolution,a=this.origin,f=this.cellWidth,
e=this.cellHeight;return new p(m*f*g+a.x,a.y-(n+1)*e*g,(m+1)*f*g+a.x,a.y-n*e*g,b.createSpatialReference(a.spatialReference.toJson()))},getLatticeID:function(n){var m=this.getCellCoordinates({x:n.xmin,y:n.ymax}),g=this.getCellCoordinates({x:n.xmax,y:n.ymin});n=m.row;var a=g.row;m=this.normalize(m.col);g=this.normalize(g.col);return n+"_"+a+"_"+m+"_"+g},sorter:function(n,m){return n<m?-1:1},getCellsInExtent:function(n,m){var g=this.getCellCoordinates({x:n.xmin,y:n.ymax}),a=this.getCellCoordinates({x:n.xmax,
y:n.ymin}),f=g.row,e=a.row;g=g.col;a=a.col;var r=[],w,H,x=[],q=[],C=[];for(w=f;w<=e;w++)for(H=g;H<=a;H++){var F=this.normalize(H);n=this.getCellExtent(w,F);B.some(r,function(D){return D.row===w&&D.col===F})||r.push({row:w,col:F,extent:n,resolution:this.resolution});m&&(x.push(n.xmin,n.xmax),q.push(n.ymin,n.ymax))}g=this.normalize(g);a=this.normalize(a);x.sort(this.sorter);q.sort(this.sorter);m=x.length;for(w=m-1;0<=w;w--)w<m-1&&x[w]===x[w+1]&&x.splice(w,1);m=q.length;for(w=m-1;0<=w;w--)w<m-1&&q[w]===
q[w+1]&&q.splice(w,1);if(x.length&&q.length){n=x[0];H=x[x.length-1];var u=q[0];var E=q[q.length-1];m=x.length;for(w=0;w<m;w++)C.push([[x[w],E],[x[w],u]]);m=q.length;for(w=0;w<m;w++)C.push([[n,q[w]],[H,q[w]]]);x=new d({paths:C,spatialReference:this.origin.spatialReference.toJson()});r.push({latticeID:f+"_"+e+"_"+g+"_"+a,lattice:x,resolution:this.resolution})}return{minRow:f,maxRow:e,minCol:g,maxCol:a,topRow:f,bottomRow:e,leftCol:g,rightCol:a,cells:r}},_findCell:function(n,m,g){var a;B.some(n,function(f){f.row===
m&&f.col===g&&(a=f);return!!a});return a},getExtentOfIntersectingCells:function(n){var m=this.getCellsInExtent(n),g=m&&m.cells;if(g&&g.length){var a=m.topRow,f=m.leftCol,e=0;B.forEach(g,function(x){x.row===a&&e++});var r=this._findCell(g,a,f).extent,w=this.srInfo;if(!w||e!==this._frameStats[0]&&f!==m.rightCol){var H=r.xmin;w=H+e*r.getWidth()}else H=w.valid[0],w=w.valid[1];m=this._findCell(g,m.bottomRow,f).extent.ymin;(n=(new p(H,m,w,r.ymax,n.spatialReference))._normalize(!1,!1))&&n.rings&&(n=new k(n),
n=c.getDenormalizedExtent(n));return n}}});h.createFromFeatureLayer=function(n){var m=n.layer;n=m.getMap()||n.map;var g=m._srInfo;(m=n&&n.loaded?new h(new l(g?g.valid[0]:n.extent.xmin,g?g.valid[1]:n.extent.ymax,n.spatialReference),{width:m._tileWidth,height:m._tileHeight},{width:n.width,height:n.height},g):null)&&m.setResolution(n.extent);return m};v("extend-esri")&&A.setObject("layers._GridLayout",h,t);return h})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/has","../kernel","./RenderMode"],function(G,A,B,v,t){G=G([t],{declaredClass:"esri.layers._SelectionMode",constructor:function(l){this.featureLayer=l;this._featureMap={}},propertyChangeHandler:function(l){this._init&&0===l&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)},hasAllFeatures:function(){return!this.featureLayer._hasPartialSelectedFeatures},hasUpdateError:function(){return this.featureLayer._hasSelectionError}});B("extend-esri")&&A.setObject("layers._SelectionMode",
G,v);return G})},"esri/layers/StreamMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/has ../kernel ../SpatialReference ../tasks/query ../tasks/QueryTask ../geometry/jsonUtils ./RenderMode".split(" "),function(G,A,B,v,t,l,p,d,k,c,b){G=G([b],{declaredClass:"esri.layers._StreamMode",constructor:function(h,n){this.featureLayer=h;this._featureMap={};this._setRefreshRate();this._drawBuffer={adds:[],updates:[]};this._timeoutId=null;this._flushDrawBuffer=A.hitch(this,
this._flushDrawBuffer);this._featuresByTime={};this._lastEndTimeCheck=null;this._maxFeatureAge=0;h.purgeOptions&&h.purgeOptions.age&&"number"===typeof h.purgeOptions.age&&(this._maxFeatureAge=1E3*Math.ceil(60*h.purgeOptions.age));this._drawFeatures=A.hitch(this,this._drawFeatures);this._queryErrorHandler=A.hitch(this,this._queryErrorHandler)},startup:function(){this._started||this.inherited(arguments)},propertyChangeHandler:function(h){this._init&&(0===h?this._applyTimeFilter():3===h?this._redrawAllTracks():
console.debug("StreamLayer: Stream Layer only supports changing map time or maximumTrackPoints. Layer id \x3d "+this.featureLayer.id))},destroy:function(){this.inherited(arguments);clearTimeout(this._timeoutId);this._featuresByTime=this._drawBuffer=this._featureMap=null},drawFeature:function(h){var n=this.featureLayer,m=n.objectIdField;this._timeoutId||(this._timeoutId=setTimeout(this._flushDrawBuffer,this._refreshRate));n._joinField&&this._getFeature(h.attributes[m])?this._drawBuffer.updates.push({oid:h.attributes[m],
updates:h}):this._drawBuffer.adds.push(h)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);var h=this.featureLayer;h&&(h._relatedUrl||h._keepLatestUrl?(h._fireUpdateStart(),h._refreshing=!0,h.disconnect(),h.clear(),h._relatedQueried=!1,h._keepLatestQueried=!1,h.connect()):(h._fireUpdateStart(),h.clear(),h._fireUpdateEnd()))},_drawFeatures:function(h,n){var m=this.featureLayer;m._create(h.features||[]);m._fireUpdateEnd(null,
n)},_applyTimeFilter:function(h){this.inherited(arguments);this._redrawAllTracks()},_removeFeatures:function(h){var n=this.featureLayer,m=n.objectIdField;h&&B.forEach(h,function(g){g=g.attributes[m];n._unSelectFeatureIIf(g,this);this._decRefCount(g);this._removeFeatureIIf(g)},this)},_addFeatures:function(h){var n=this.featureLayer,m=n._endTimeField,g=n._startTimeField,a,f=[],e=[],r=[];var w=n._trackManager;var H=n.objectIdField;if(w)for(a in h=w.addFeatures(h),h)h.hasOwnProperty(a)&&(f.push(a),h[a].adds&&
(e=e.concat(h[a].adds)),h[a].deletes&&(r=r.concat(h[a].deletes)));else e=h;B.forEach(e,function(x){var q=x.attributes[H];var C=m&&x.attributes[m];!C&&this._maxFeatureAge&&(C=g&&x.attributes[g]?x.attributes[g]+this._maxFeatureAge:Date.now()+this._maxFeatureAge);C&&(C=1E3*Math.ceil(C/1E3),this._featuresByTime[C]?this._featuresByTime[C].push(q):this._featuresByTime[C]=[q]);this._addFeatureIIf(q,x);this._incRefCount(q)},this);r.length&&this._removeFeatures(r);w&&w.refreshTracks(f)},_updateFeatures:function(h){var n=
this.featureLayer,m=[];var g=n._trackManager;var a=n._trackIdField;B.forEach(h,function(f){var e=f.updates;f=this._getFeature(f.oid);var r;if(f){e.geometry&&f.setGeometry(e.geometry);e=e.attributes||{};for(r in e)e.hasOwnProperty(r)&&(f.attributes[r]=e[r]);f.setAttributes(f.attributes);f.visible=this._checkFeatureTimeIntersects(f);g&&f.attributes[a]?m.push(f.attributes[a]):n._repaint(f,null,!0)}},this);m.length&&g.refreshTracks(m)},_redrawAllTracks:function(){var h=this.featureLayer._trackManager,
n;h&&(n=h.trimTracks())&&0<n.length&&(this._removeFeatures(n),h.refreshTracks())},_flushDrawBuffer:function(){clearTimeout(this._timeoutId);var h=this._drawBuffer,n=h.adds.splice(0,h.adds.length),m=h.updates.splice(0,h.updates.length);h=this.featureLayer;if(!h)return!1;h.updating||h._fireUpdateStart();this._addFeatures(n);this._updateFeatures(m);(n=this._getExpiredFeatures())&&n.length&&(this._removeFeatures(n),h._trackManager&&h._trackManager.removeFeatures(n));h._purge();h._fireUpdateEnd();this._timeoutId=
null},_clearDrawBuffer:function(){var h=this._timeoutId,n=this._drawBuffer,m=n.adds;n=n.updates;h&&clearTimeout(h);m.splice(0,m.length);n.splice(0,n.length);this._timeoutId=null},_clearTimeBin:function(){this._featuresByTime={};this._lastEndTimeCheck=1E3*Math.ceil(Date.now()/1E3)},_clearFeatureMap:function(){this._featureMap={}},_setRefreshRate:function(h){h=h||0===h?h:200;0>h&&(h=200);this._refreshRate=h},_checkFeatureTimeIntersects:function(h){var n=this.featureLayer,m=n.getMap();return(m=m?m.timeExtent:
null)&&n.timeInfo&&(n.timeInfo.startTimeField||n.timeInfo.endTimeField)?0<n._filterByTime([h],m.startTime,m.endTime).match.length:!0},_fetchArchive:function(h){var n=new v,m=this.featureLayer;this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);m._fireUpdateStart();if(h&&this.map){h=new k(h);var g=new d;var a=this.map;var f=m.getFilter()||{};var e=f.where||"1\x3d1";var r=f.geometry?c.fromJson(f.geometry):null;f=f.outFields?f.outFields.split(","):["*"];g.geometry=r;g.where=e;g.outFields=
f;g.returnGeometry=!0;g.outSpatialReference=new p(a.spatialReference.toJson());this._pendingRequest=h.execute(g).then(function(w){this._pendingRequest=null;var H=this._fixFieldNameCasing(m,w);w.features=H;this._drawFeatures(w);m._fireUpdateEnd();n.resolve()}.bind(this)).otherwise(function(w){this._pendingRequest=null;m._errorHandler(w);m._fireUpdateEnd(w);n.reject(w)}.bind(this))}else n.resolve();return n.promise},_queryErrorHandler:function(h){var n=this.featureLayer;n._errorHandler(h);n._fireUpdateEnd(h)},
_fixFieldNameCasing:function(h,n){var m=n.features||[],g=n.fields;if(!g||!m.length)return m;h=this._mapFieldNameDifferences(h.fields,g);g=[];for(var a,f=0,e=n.features.length;f<e;f++)n=m[f],a=this._swizzleResponseAttributes(n.attributes,h),g.push({geometry:n.geometry,attributes:a});return g},_mapFieldNameDifferences:function(h,n){var m=[],g={},a;var f=0;for(a=n.length;f<a;f++)m.push(n[f].name);f=0;for(a=h.length;f<a;f++){n=h[f].name;var e=this._checkForStreamFieldName(n,m);e&&(g[e]=n)}return g},_checkForStreamFieldName:function(h,
n){h=h.toLowerCase();for(var m,g=0,a=n.length;g<a;g++)if(n[g].toLowerCase()===h){m=n[g];break}return m},_swizzleResponseAttributes:function(h,n){var m={},g;for(g in h)if(h.hasOwnProperty(g)){var a=h[g];n.hasOwnProperty(g)?m[n[g]]=a:m[g]=a}return m},_getExpiredFeatures:function(){var h,n,m=[],g=[];if(!this.featureLayer._endTimeField&&!this._maxFeatureAge)return g;var a=1E3*Math.floor(this._lastEndTimeCheck/1E3);this._lastEndTimeCheck=h=1E3*Math.ceil(Date.now()/1E3);if(a&&a!==h)for(n=this._featuresByTime;a<=
h;a+=1E3)n[a]&&(m=m.concat(n[a]),delete n[a]);B.forEach(m,function(f){(f=this._getFeature(f))&&g.push(f)},this);return g}});t("extend-esri")&&A.setObject("layers._StreamMode",G,l);return G})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/dom-construct dojox/gfx ../kernel ../graphic ../geometry/Polyline ./GraphicsLayer".split(" "),function(G,A,B,v,t,l,p,d,k,c){var b=-1!==l.renderer.toLowerCase().indexOf("canvas");G=G(null,{declaredClass:"esri.layers._TrackManager",
constructor:function(h){this.layer=h;this.trackMap={};this.trackLineMap={}},initialize:function(h){this.map=h;h=this.layer;this.createTracklineContainer()&&(this._handles=[h.on("visibility-change",A.hitch(this,function(n){this.container.setVisibility(n.visible);this.container.evaluateSuspension()})),h.on("scale-range-change",A.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)}))])},createTracklineContainer:function(){var h=this.layer;if("esriGeometryPoint"!==
h.geometryType)return null;var n=this.map,m=h._getRenderer();m=m&&m.trackRenderer;var g=this.container=new c._GraphicsLayer({id:h.id+"_tracks",_child:!0,visible:h.visible,minScale:h.minScale,maxScale:h.maxScale});g.loaded=!0;g.onLoad(g);g._setMap(n,h._div);b||(n=g._div.getNode(),h=h._div.getNode(),n&&h&&t.place(n,h,"first"));g.setRenderer(m);return g},addFeatures:function(h){var n=this.trackMap,m=this.layer,g=m._trackIdField,a=[];B.forEach(h,function(w){var H=w.attributes[g];(n[H]=n[H]||[]).push(w);
-1===B.indexOf(a,H)&&a.push(H)});var f=m._startTimeField,e=m.objectIdField,r=function(w,H){var x=w.attributes[f],q=H.attributes[f];return x===q?w.attributes[e]<H.attributes[e]?-1:1:x<q?-1:1};B.forEach(a,function(w){n[w].sort(r)})},trimTracks:function(h){function n(e){for(e=m[e]||[];e.length>g;)a.push(e.shift())}var m=this.trackMap,g=this.layer.maximumTrackPoints||0,a=[],f;if(!g)return a;if(h)B.forEach(h,function(e){n(e)});else for(f in m)m.hasOwnProperty(f)&&n(f);return a},drawTracks:function(h){function n(w){var H=
f[w],x,q;var C=m.trackLineMap[w];g.remove(C);delete m.trackLineMap[w];C=null;if(!H||2>H.length)return!1;C=[];for(x=H.length-1;0<=x;x--)(q=H[x].geometry)&&C.push([q.x,q.y]);H={};H[r]=w;1<C.length&&(C=new d(new k({paths:[C],spatialReference:e}),null,H),g.add(C),m.trackLineMap[w]=C)}var m=this,g=this.container,a;if(g){var f=this.trackMap;var e=this.map.spatialReference;var r=this.layer._trackIdField;if(h)B.forEach(h,function(w){n(w)});else for(a in f)f.hasOwnProperty(a)&&n(a)}},refreshTracks:function(h){function n(r){var w;
m.drawTracks([r]);if(f&&f.latestObservationRenderer){r=g[r]||[];var H=r.length;for(w=0;w<H;w++)a._repaint(r[w],null,!0)}}var m=this,g=this.trackMap,a=this.layer,f=a._getRenderer(),e;if(h)B.forEach(h,function(r){n(r)});else for(e in g)g.hasOwnProperty(e)&&n(e);this.moveLatestToFront()},moveLatestToFront:function(h){B.forEach(this.getLatestObservations(h),function(n){var m=n._shape;m&&m._moveToFront();this._repaint(n,null,!0)},this.layer)},getLatestObservations:function(h){function n(e){e=a[e];return e[e.length-
1]}var m=[],g=this.layer._getRenderer(),a=this.trackMap,f;if(!g.latestObservationRenderer)return m;if(h)B.forEach(h,function(e){m.push(n(e))});else for(f in a)a.hasOwnProperty(f)&&m.push(n(f));return m},clearTracks:function(h){var n=this.getLatestObservations(h),m=this.container,g=this.trackMap,a;if(h)B.forEach(h,function(e){delete this.trackMap[e];m&&(f=this.trackLineMap[e],m.remove(f),delete this.trackLineMap[e])},this);else{if(m)for(a in g){var f=this.trackLineMap[a];m.remove(f)}this.trackMap=
{};this.trackLineMap={}}B.forEach(n,function(e){this._repaint(e,null,!0)},this.layer)},isLatestObservation:function(h){var n=this.trackMap[h.attributes[this.layer._trackIdField]];return n?n[n.length-1]===h:!1},destroy:function(){B.forEach(this._handles,function(n){n.remove()});var h=this.container;h&&(h.clear(),h._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}});v("extend-esri")&&A.setObject("layers._TrackManager",G,p);return G})},"esri/layers/HeatmapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/_base/array require ../kernel ../sniff ../geometry/Point ../geometry/webMercatorUtils ./MapImage ../renderers/HeatmapRenderer ../tasks/query dojo/_base/fx".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n){function m(){}function g(a){var f=a.layer;return{geometry:a.geometry,attributes:a.attributes,getLayer:function(){return f}}}G=G(null,{declaredClass:"esri.layers.HeatmapManager",heatmapRenderer:null,sourceLayer:null,imageLayer:null,useTiles:!0,useWorker:!1,map:null,constructor:function(a){this.sourceLayer=a;this._hndls=[]},initialize:function(a){this.map=a;var f=this.sourceLayer,e=f.renderer;f.setDrawMode(!1);this.imageLayer=a._getMapImageLyr();var r=this;this.heatmapRenderer=
e instanceof b?e:(e.getRendererInfoByZoom(a.getZoom())||e.getRendererInfoByScale(a.getScale())).renderer;this.redraw=this.redraw.bind(this);this.recalculateHeatmap=this.recalculateHeatmap.bind(this);this._removeRenderer=this._removeRenderer.bind(this);this._handleRendererChange=this._handleRendererChange.bind(this);this._rendererChangeHandle=this.sourceLayer.on("renderer-change",this._handleRendererChange);this._handleOpacityChange=this._handleOpacityChange.bind(this);this._reprojectFeature=this._reprojectFeature.bind(this);
t(["../workers/heatmapCalculator"],function(w){r._calculator=new w(A.mixin({width:r.map.width,height:r.map.height},r._getOptions()));r._setupRenderer();r.heatmapRenderer.getStats=w.calculateStats;r.heatmapRenderer.getHistogramData=w.getHistogramData})},destroy:function(){this._removeHandlers();this._rendererChangeHandle&&this._rendererChangeHandle.remove();this._rendererChangeHandle=this.sourceLayer=this.imageLayer=this.map=this.heatmapRenderer=this._hndls=null},_handleRendererChange:function(a){var f=
a.renderer,e=f instanceof b;this.heatmapRenderer?e?this.heatmapRenderer=f:this._removeRenderer(a):e&&(this.heatmapRenderer=f,this.sourceLayer&&this.map&&this._setupRenderer())},_handleOpacityChange:function(a){a=a.opacity;var f=this._getImageBySourceId(this.sourceLayer.id);f&&f.setOpacity(a)},_setupRenderer:function(){var a=this._hndls,f=this.sourceLayer,e=this.map,r=this;f._originalDraw=f._draw;f._draw=m;f._div.clear();clearTimeout(this._resetTimer);this._resetTimer=setTimeout(this._resetGraphics.bind(this),
250);a.push(f.on("update-end",this.redraw));a.push(f.on("suspend",function(w){(w=r._getImageBySourceId(r.sourceLayer.id))&&w.hide()}));a.push(f.on("resume",function(w){(w=r._getImageBySourceId(r.sourceLayer.id))&&w.show()}));a.push(B.after(f,"redraw",this.redraw));a.push(e.on("layer-remove",function(w){w.layer==f&&((w=r._getImageBySourceId(r.sourceLayer.id))&&r.imageLayer.removeImage(w),r._removeRenderer({target:f}))}));f._collection&&a.push(f.on("graphic-add",function(w){r._reprojectFeature(w.graphic);
r.redraw()}));1!==f.mode&&(a.push(e.on("resize, pan-end",this.redraw)),a.push(e.on("zoom-end",this.redraw)));a.push(f.on("opacity-change",this._handleOpacityChange));this.imageLayer.suspended&&this.imageLayer.resume();f.graphics&&f.graphics.length&&(f.graphics[0].geometry&&!e.spatialReference.equals(f.graphics[0].geometry.spatialReference)&&v.forEach(f.graphics,function(w){this._reprojectFeature(w)}.bind(this)),this.redraw())},redraw:function(){if(!this._drawTimer){var a=this;this._drawTimer=setTimeout(function(){clearTimeout(a._drawTimer);
a._drawTimer=null;a.sourceLayer._getRenderer().isInstanceOf(b)&&a.recalculateHeatmap()},16)}},_removeRenderer:function(a){var f=a.target;f._draw=f._originalDraw;delete f._originalDraw;f.setDrawMode(!0);this._removeHandlers();this._hndls=[];var e=this._getImageBySourceId(this.sourceLayer.id);e&&this.imageLayer.removeImage(e);clearTimeout(this._drawTimer);clearTimeout(this._resetTimer);this._drawTimer=this._resetTimer=null;f.renderer!=a.renderer&&f.renderer.getRendererInfo?this.heatmapRenderer=null:
(this.destroy(),f.renderer&&f.renderer.getRendererInfo&&f.redraw())},recalculateHeatmap:function(){this._calculator?this._doMainCalculation():this._calculatorClient&&this._doWorkerCalculation()},_reprojectFeature:function(a){if(a&&a.geometry){var f=a.geometry,e=this.map.spatialReference;e.equals(f.spatialReference)||(f=k.project(f,e),null==f?console.log("Unable to reproject features to map's spatial reference. Please convert feature geometry before adding to layer"):a.geometry=f)}},_doWorkerCalculation:function(){},
_doMainCalculation:function(){var a=this.sourceLayer,f=this.map,e=this.heatmapRenderer,r=this.map.extent,w=this.map.width,H=this.map.height,x=this._calculator,q=this,C=function(u){u=q._getScreenPoints(u.features,f,a);u=x.calculateImageData(A.mixin({screenPoints:u,mapinfo:{extent:[r.xmin,r.ymin,r.xmax,r.ymax],resolution:f.getResolution()},width:w,height:H},q._getOptions()));u=e.getSymbol(g({geometry:f.extent,attributes:{size:[w,H],imageData:u},layer:a}));u=new c({extent:f.extent,href:u.url,opacity:0,
sourceId:a.id});q._swapMapImages(u,q._getImageBySourceId(a.id));a.suspended&&u.hide()},F={geometry:f.extent,timeExtent:a.useMapTime?f.timeExtent:void 0,spatialRelationship:h.SPATIAL_REL_INTERSECTS};null!=a._canDoClientSideQuery(F)?a.queryFeatures(F,C):C({features:a.graphics})},_getScreenPoints:function(a,f,e){var r=[],w=a.length,H=0,x=0,q=new d(f.extent.xmin,f.extent.ymax,f.spatialReference),C=f.toScreen(q),F=C.x;C=C.y;var u=f.getResolution(),E;for((x=f.extent.getCacheValue("_parts"))&&(E=v.map(x,
function(M){return e._intersects(f,M.extent)[0]}));w--;)if(x=a[w],x.geometry&&x.visible){var D={x:Math.ceil((x.geometry.x-q.x)/u+F),y:Math.floor((q.y-x.geometry.y)/u-C),attributes:x.attributes};E&&(x=1<E.length&&D.x<-E[0]?E[1]:E[0],D.x+=x);r[H++]=D}return r},_getImageBySourceId:function(a){var f=this.imageLayer.getImages();f=v.filter(f,function(e){return e.sourceId==a});if(f.length)return f[f.length-1]},_swapMapImages:function(a,f){function e(){r.removeImage(f)}var r=this.imageLayer,w=this.sourceLayer.opacity;
r.addImage(a);n.anim(a._node,{opacity:w},null,null,function(){a.opacity=w});null!=f&&n.anim(f._node,{opacity:0},null,null,e)},_removeHandlers:function(){if(null!=this._hndls)for(var a=this._hndls.length;a--;)this._hndls[a].remove()},_getOptions:function(){var a=this.heatmapRenderer;return{blurRadius:a.blurRadius,gradient:a.gradient,maxPixelIntensity:a.maxPixelIntensity,minPixelIntensity:a.minPixelIntensity,field:a.field,fieldOffset:a.fieldOffset}},_resetGraphics:function(){clearTimeout(this._resetTimer);
this._resetTimer=null;for(var a=this.sourceLayer.graphics,f=a.length,e;f--;)e=a[f],e._shape=e._offsets=void 0}});p("extend-esri")&&A.setObject("layers.HeatmapManager",G,l);return G})},"esri/layers/clustering/ClusterManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../kernel ../../Evented ../../graphic ../../lang ../../Color ../../graphicsUtils ../../dijit/PopupTemplate ../../dijit/Legend/utils ../../renderers/ClassBreaksRenderer ../../symbols/SimpleMarkerSymbol ../support/attributeUtils ../GraphicsLayer ../Field ./GeohashAggregation ./statUtils dojo/i18n!../../nls/jsapi".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e,r,w){var H=w.layers.clusters,x=w.widgets.popup,q=H.numFeatures,C=Math.pow(2,53)-1;G=G(l,{declaredClass:"esri.layers.clustering.ClusterManager",layer:null,aggregationInfo:null,container:null,defaults:{clusterRadius:80,markerSymbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",style:"esriSLSSolid"}}},_initialized:!1,_map:null,_eventHandles:null,_clusterRadius:null,
_renderer:null,_statisticInfos:null,_fields:null,_infoTemplate:null,_clusterGenerator:null,_singleGraphics:null,constructor:function(F){this._eventHandles=[];this.layer=F.layer;this.setAggregationInfo(F.aggregationInfo)},initialize:function(F){this._initialized=!0;this._map=F;this._removeFromPopup(this.layer);this.container=this._createContainer();this._clusterGenerator=this._createClusterGenerator();this._initClusterGenerator();this._createLayerEventListeners();this._createMapEventListeners();this._createPopupEventListeners()},
destroy:function(F){this._clearSingleGraphics();this._removeClusterBoundary();this._destroyEventListeners();this._removeFromPopup(this.container);this._removeFromPopup(this.layer);this._resetClusterNav();this._destroyClusterGenerator(F);this._destroyContainer();this.layer=this.aggregationInfo=this._map=null},setAggregationInfo:function(F){this.aggregationInfo=F?A.mixin({},F):null;this._applyAggregationInfo()},getClusterRenderer:function(){return this._renderer},getClusterFields:function(){return this._fields||
[]},getFeaturesInCluster:function(F){F=F&&F.getAggregationInfo();return this._clusterGenerator?this._clusterGenerator.getFeaturesInCluster(F):[]},getAggregateGraphics:function(){return this.container?this.container.graphics.slice(0):[]},getSingleGraphics:function(){return this._singleGraphics?this._singleGraphics.slice(0):[]},redraw:function(){this.container&&this.container.redraw()},isClusteringEnabled:function(){return!(!this._clusterGenerator||!this._clusterGenerator.clustersEnabled)},isClusteringActive:function(){return!!(this._clusterGenerator&&
0<this._clusterGenerator.getNumFeatures())},toggleFeatureVisibility:function(F){this._clusterGenerator&&this._clusterGenerator.toggleFeatureVisibility(F)},_createContainer:function(){var F=this.layer,u=new a._GraphicsLayer({_child:!0,id:F.id+"_clusters",visible:F.visible,minScale:F.minScale,maxScale:F.maxScale,infoTemplate:this._infoTemplate});u.fields=this._fields;u.setRenderer(this._renderer);u.loaded=!0;u.onLoad(u);u._setMap(this._map,F._div);return F._childLayer=u},_destroyContainer:function(){var F=
this.container;F&&(F.clear(),F._unsetMap(this._map,this.layer._div),this.layer._childLayer=null);this.container=null},_createClusterGenerator:function(){return new e({map:this._map,layer:this.layer,clusterRadius:this._clusterRadius,statisticInfos:this._statisticInfos})},_initClusterGenerator:function(){var F=this._clusterGenerator;F.loaded?this._awaitClusterGenerator():this._eventHandles.push(F.on("load",A.hitch(this,function(){this._awaitClusterGenerator()})),F.on("load-error",A.hitch(this,function(u){console.log(u.error)})))},
_destroyClusterGenerator:function(F){this._clusterGenerator&&this._clusterGenerator.destroy(F);this._clusterGenerator=null},_awaitClusterGenerator:function(){var F=this._clusterGenerator;F.started?(this._applyRenderer(),this._initClusterUpdates()):this._eventHandles.push(F.on("start",A.hitch(this,function(){this._applyRenderer();this._initClusterUpdates()})))},_applyAggregationInfo:function(){this._applyClusterRadius();this._applyRenderer();this._clusterGenerator&&!this._clusterGenerator.isUpdateScheduled()&&
this.redraw()},_applyClusterRadius:function(){var F=this.aggregationInfo;this._clusterRadius=F&&F.clusterRadius||this.defaults.clusterRadius;this._clusterGenerator&&this._clusterGenerator.setClusterRadius(this._clusterRadius);this._computeClusterRadius()},_computeClusterRadius:function(){var F=this.aggregationInfo||{};F.clusterRadius=this._clusterRadius;this.aggregationInfo=F},_applyRenderer:function(){var F=this.container,u=this._getClusterRendererInfo(),E=this._compareStatInfos(this._statisticInfos,
u.statisticInfos);E&&(this._statisticInfos=u.statisticInfos,this._clusterGenerator&&(this._clusterGenerator.setStatisticInfos(B.map(this._statisticInfos,function(D){return{attributeInfo:D.attributeInfo,statisticType:D.statisticType}})),F&&B.forEach(F.graphics,function(D){this._applyClusterAttributes(D,D.getAggregationInfo())},this)));this._renderer=u.renderer;this._applyFields();this._applyInfoTemplate(!!E&&this._initialized);F&&(F.setRenderer(this._renderer),this.emit("renderer-change"))},_applyFields:function(){this._fields=
this._getFields(this._statisticInfos);this.container&&(this.container.fields=this._fields)},_applyInfoTemplate:function(F){var u=this.aggregationInfo,E=u&&u.disablePopup;this.layer.infoTemplate&&!E?(u=u&&u.infoTemplate||this._infoTemplate,F=F||!u?this._createInfoTemplate():this._updateInfoTemplate(u)):F=null;this._infoTemplate=F;this.container&&this.container.setInfoTemplate(this._infoTemplate);this._computeInfoTemplate()},_computeInfoTemplate:function(){var F=this.aggregationInfo||{};F.infoTemplate=
this._infoTemplate;this.aggregationInfo=F},_getClusterRendererInfo:function(){var F=this.layer&&this.layer.renderer;return F?this._createClusterRenderer(F):this._getDefaultClusterRenderer()},_getDefaultClusterRenderer:function(){var F=this._createContinuousCountRenderer();this._addSizeByCountVariable(F);return{renderer:F,statisticInfos:[]}},_createContinuousCountRenderer:function(F){var u=new n(null,"cluster_count");u.addBreak({minValue:-C,maxValue:C,symbol:F?new F.constructor(F.toJson()):new m(A.clone(this.defaults.markerSymbol))});
return u},_createClusterRenderer:function(F){if(!this._isSupportedRenderer(F))return this._getDefaultClusterRenderer();var u=[];if(this._isSimpleRenderer(F))var E=this._createContinuousCountRenderer(F.symbol);else{E=new F.constructor(F.toJson());var D=this._getRendererAttributeInfo(F);if(this._isCBRenderer(E)){var M=r.getClusterField(D,"avg");u.push(this._getStatInfo(D,"avg"));E.normalizationType=null;E.normalizationField=null;E.normalizationTotal=null}else this._isUVRenderer(E)&&(M=r.getClusterField(D,
"type"),u.push(this._getStatInfo(D,"type")));E.attributeField=M;E.setValueExpression(null);E.valueExpressionTitle=null;E.setVisualVariables(null);this._setRendererTitle(E,F)}F=this._getSupportedVariables(F);D=this._createClusterVariables(F.allVars,u);E.setVisualVariables(D);F.sizeVars.length||this._isCBSizeRenderer(E)||this._addSizeByCountVariable(E);return{renderer:E,statisticInfos:u}},_isSupportedRenderer:function(F){if(this._isSimpleRenderer(F))return!0;if(this._isCBRenderer(F)){var u=F.normalizationType;
return"function"===typeof F.attributeField||u&&"field"!==u?!1:!0}return this._isUVRenderer(F)?"function"===typeof F.attributeField||F.attributeField2?!1:!0:!1},_isSimpleRenderer:function(F){return-1<F.declaredClass.toLowerCase().indexOf("simplerenderer")},_isCBRenderer:function(F){return-1<F.declaredClass.toLowerCase().indexOf("classbreaksrenderer")},_isUVRenderer:function(F){return-1<F.declaredClass.toLowerCase().indexOf("uniquevaluerenderer")},_isCBSizeRenderer:function(F){var u=F.infos;if(!this._isCBRenderer(F)||
!u||2>u.length)return!1;var E=Infinity,D=-Infinity;B.forEach(u,function(M){if(M=M.symbol){var I=0;switch(M.type){case "simplemarkersymbol":I=M.size;break;case "picturemarkersymbol":I=(M.width+M.height)/2}E=Math.min(E,I);D=Math.max(D,I)}});return Infinity!==E&&-Infinity!==D&&E!==D},_getRendererAttributeInfo:function(F){var u=F.attributeField,E=u?this.layer.getField(u):null;return{field:u,attributeType:E&&"esriFieldTypeDate"===E.type?"date":null,rotationType:null,valueExpression:F.valueExpression,valueExpressionTitle:F.valueExpressionTitle,
normalizationField:F.normalizationField}},_setRendererTitle:function(F,u){F.legendOptions=A.clone(u.legendOptions);F.legendOptions&&F.legendOptions.title||(F.legendOptions=F.legendOptions||{},F.legendOptions.title=h.getRendererTitle(u,this.layer))},_getSupportedVariables:function(F){var u=F.getVisualVariablesForType("colorInfo",!1)||[],E=F.getVisualVariablesForType("sizeInfo",!1)||[],D=F.getVisualVariablesForType("opacityInfo",!1)||[];F=F.getVisualVariablesForType("rotationInfo",!1)||[];u=B.filter(u,
this._variableFilter);E=B.filter(E,this._variableFilter);D=B.filter(D,this._variableFilter);F=B.filter(F,this._variableFilter);return{sizeVars:E,allVars:u.concat(E).concat(D).concat(F)}},_variableFilter:function(F){return"function"!==typeof F.field&&!g.viewScaleRE.test(F.valueExpression)},_createClusterVariables:function(F,u){return B.map(F,function(E){return this._createVarForAvg(E,u)},this)},_createVarForAvg:function(F,u){var E=A.clone(F),D=this._getVariableAttributeInfo(F);E.field=r.getClusterField(D,
"avg");E.normalizationField=null;E.valueExpression=null;E.valueExpressionTitle=null;D=this._getStatInfo(D,"avg");this._addStatInfo(u,D);this._setVariableTitle(E,F);return E},_getVariableAttributeInfo:function(F){var u="rotationInfo"===F.type,E=u?"angle":null;u=u?F.rotationType:null;var D=F.legendOptions&&F.legendOptions.title,M=F.field,I=M?this.layer.getField(M):null;I&&"esriFieldTypeDate"===I.type&&(E="date");return{field:M,attributeType:E,rotationType:u,valueExpression:F.valueExpression,valueExpressionTitle:F.valueExpressionTitle||
F.valueExpression&&D,normalizationField:F.normalizationField}},_setVariableTitle:function(F,u){F.legendOptions&&F.legendOptions.title||(F.legendOptions=F.legendOptions||{},F.legendOptions.title=h.getVisualVariableTitle(u,this.layer))},_getStatInfo:function(F,u){return{statisticHash:r.getStatisticHash(F,u),attributeInfo:F,statisticType:u}},_addStatInfo:function(F,u){var E=this._findStatInfo(F,u);E?E.attributeInfo.valueExpressionTitle||(E.attributeInfo.valueExpressionTitle=u.attributeInfo.valueExpressionTitle):
F.push(u)},_findStatInfo:function(F,u){var E;B.some(F,function(D){D.statisticHash===u.statisticHash&&(E=D);return!!E});return E},_compareStatInfos:function(F,u){var E=B.filter(F,function(M){return!this._findStatInfo(u,M)},this),D=B.filter(u,function(M){return!this._findStatInfo(F,M)},this);return D.length||E.length?{added:D,removed:E}:null},_addSizeByCountVariable:function(F){var u=this._createSizeByCountVariable();u&&this._addVariable(F,u)},_getSizeByCountVariable:function(F){F=F.getVisualVariablesForType("sizeInfo",
!1)||[];return B.filter(F,function(u){return"cluster_count"===u.field})[0]},_updateSizeByCountVariable:function(){var F=this._renderer,u=this._getSizeByCountVariable(F);if(u){var E=this._createSizeByCountVariable();E&&this._replaceVariable(F,u,E)}},_createSizeByCountVariable:function(){var F=this._clusterGenerator;if(F){var u=F.getCurrentLodStats();if(u){var E=F.getNumFeatures();F=F.clusters;var D=u.min,M=u.max;1===u.count&&D===E||1===F.length&&F[0].count===E?(D=1,M=E):D&&D===M&&(M=2*D);E={type:"sizeInfo",
field:"cluster_count",valueUnit:"unknown",minSize:12,maxSize:50,minDataValue:D,maxDataValue:M,legendOptions:{title:q}}}}return E},_addVariable:function(F,u){var E=F.visualVariables||[];E.push(u);F.setVisualVariables(E)},_replaceVariable:function(F,u,E){var D=F.visualVariables;u=B.indexOf(D,u);-1<u&&D.splice(u,1);D.push(E);F.setVisualVariables(D)},_getFields:function(F){var u=[new f({name:"cluster_count",type:"esriFieldTypeInteger"})];B.forEach(F,function(E){var D=E.statisticType;E=E.attributeInfo;
var M;"avg"===D?M="date"===E.attributeType?"esriFieldTypeDate":"esriFieldTypeDouble":"type"===D&&(M=E.field?this.layer.getField(E.field).type:"esriFieldTypeString");u.push(new f({name:r.getClusterField(E,D),type:M}))},this);return u},_createInfoTemplate:function(){var F=this._statisticInfos,u=this._renderer,E=[{fieldName:"cluster_count",label:q,visible:!0,format:{digitSeparator:!0,places:0}}],D=[],M=[d.substitute({count:"{cluster_count}"},H.countSummary)],I=this._isUVRenderer(u)?u.infos:[];B.forEach(F,
function(z){var K=z.statisticType,L=z.attributeInfo,N=r.getClusterField(L,K),P=this._getFieldLabel(z);if("avg"===K){var T={fieldName:N,label:P,visible:!0,format:"date"===L.attributeType?{dateFormat:"shortDateShortTime"}:{digitSeparator:!0,places:1}};var S=this._getFieldSummary(z,N)}else"type"===K&&(S="expression/"+N,T={fieldName:S,visible:!0},D.push({name:N,title:P,returnType:"string",expression:this._getExpression(I,N)}),S=this._getFieldSummary(z,S));T&&E.push(T);S&&M.push(S)},this);return this._createPopupTemplate({fieldInfos:E,
expressionInfos:D,description:M.join("\x3cbr/\x3e\x3cbr/\x3e")})},_updateInfoTemplate:function(F){var u=F.toJson(),E=this._isUVRenderer(this._renderer)?this._renderer.infos:[];B.forEach(this._statisticInfos,function(D){var M=D.statisticType;D=r.getClusterField(D.attributeInfo,M);"type"===M&&(M=this._findExpressionInfo(D,u))&&(M.expression=this._getExpression(E,D))},this);return this._createPopupTemplate(u)},_createPopupTemplate:function(F){var u=new b(F),E=u.title;u.setTitle(A.hitch(this,function(D){var M=
this._map&&this._map.infoWindow;if("esri.dijit.PopupMobile"!==(M&&M.declaredClass)||u.info.title)return E.call(u,D);D=(D=D.attributes)&&D.cluster_count;return null==D?"":d.substitute({count:D},H.countTitle)}));return u},_findExpressionInfo:function(F,u){var E;B.some(u.expressionInfos,function(D){D.name===F&&(E=D);return!!E});return E},_escapeDoubleQuotes:function(F){return F?F.replace(/"/g,'\\"'):""},_getExpression:function(F,u){return["var uvInfos \x3d ["+this._getObjects(F).join(", ")+"];",'var predominantType \x3d Text($feature["'+
u+'"]);','var label \x3d "'+this._escapeDoubleQuotes(H.predominantNoneValue)+'";',"for (var i \x3d 0; i \x3c Count(uvInfos); i++) {\nif (uvInfos[i].value \x3d\x3d predominantType) {\nlabel \x3d uvInfos[i].label;\nbreak;\n}\n}\nreturn label;"].join("\n")},_getObjects:function(F){return B.map(F,function(u){return'{"value": "'+String(u.value)+'","label": "'+this._escapeDoubleQuotes(String(u.label))+'"}'},this)},_getFieldLabel:function(F){var u=F.statisticType,E=F.attributeInfo,D=E.field;F=E.normalizationField;
var M="";if("avg"===u)var I=F?H.avgNormFieldLabel:H.avgFieldLabel;else"type"===u&&(I=H.predominantFieldLabel);I&&(u=E.valueExpression?E.valueExpressionTitle:this.layer.getFieldLabel(D),F=F&&this.layer.getFieldLabel(F),M=d.substitute({fieldLabel:u||"",normFieldLabel:F||""},I));return M},_getFieldSummary:function(F,u){var E=F.statisticType,D=F.attributeInfo,M=D.field;F=D.normalizationField;var I="";if("avg"===E)var z=F?H.avgNormFieldSummary:H.avgFieldSummary;else"type"===E&&(z=H.predominantFieldSummary);
z&&(E=D.valueExpression?D.valueExpressionTitle:this.layer.getFieldLabel(M),F=F&&this.layer.getFieldLabel(F),I=d.substitute({fieldLabel:E||"",normFieldLabel:F||"",fieldValue:"{"+u+"}"},z));return I},_removeFromPopup:function(F){var u=this._map.infoWindow,E=u.features;if(E&&E.length){var D=B.filter(E,function(M){return M.getLayer()!==F});D.length<E.length&&(D.length?u.setFeatures(D):(u.clearFeatures(),u.hide()))}},_resetClusterNav:function(){this._resetClusterNavPartial();this._popupClusterGraphic=
null},_resetClusterNavPartial:function(){this._map.infoWindow.removeActions&&this._map.infoWindow.removeActions(this._popupActions);this._hideSingleGraphic(this._popupSingleGraphic);this._popupSingleGraphic=null},_addClusterBoundary:function(F,u){(u=u.clusterFillSymbol)&&(u=new u.constructor(u.toJson()));F=new p(F,u);this._map.graphics.add(F);this._clusterBoundary=F},_removeClusterBoundary:function(){this._map.graphics.remove(this._clusterBoundary);this._clusterBoundary=null},_createBrowseFeaturesAction:function(){return this._map.infoWindow.addActions([{title:x.NLS_browseFeatures,
className:"browseFeatures",callback:A.hitch(this,function(F){F.preventDefault();F=this._map.infoWindow;var u=F.getSelectedFeature(),E=u.getChildGraphics(),D=F.getCurrentAnchor();F.setFeatures(E,{anchor:D});if(E=c.graphicsExtent(E))this._addClusterBoundary(E,F),F.show(this._getPopupLocation(E,D));this._popupClusterGraphic=u})}])[0]},_getPopupLocation:function(F,u){var E=F.getCenter();u=u.toLowerCase();-1<u.indexOf("top")?E.update(E.x,F.ymax):-1<u.indexOf("bottom")?E.update(E.x,F.ymin):-1<u.indexOf("left")?
E.update(F.xmin,E.y):E.update(F.xmax,E.y);return E},_createViewSummaryAction:function(){return this._map.infoWindow.addActions([{title:x.NLS_viewSummary,className:"viewSummary",callback:A.hitch(this,function(F){F.preventDefault();F=this._popupClusterGraphic;var u=this._map.infoWindow;u.setFeatures([F]);u.show(F.geometry);this._popupClusterGraphic=null})}])[0]},_initClusterUpdates:function(){this._updateSizeVariable();this._updateClusterGraphics();this._eventHandles.push(this._clusterGenerator.on("update-end",
A.hitch(this,function(F){(F.mapLevelChange||F.indexChange)&&this._updateSizeVariable();this._updateClusterGraphics()})),this._clusterGenerator.on("index-complete",A.hitch(this,function(){this._updateSizeVariable()})))},_updateClusterGraphics:function(){this._hideSingleGraphics();var F=[],u=[];B.forEach(this._clusterGenerator.clusters,function(E){var D=new p(E.centroid);D.setAggregationSourceLayer(this.layer);D.setAggregationInfo(E);this._applyClusterAttributes(D,E);1===E.count?(E=this._getSingleGraphic(D),
u.push(E)):F.push(D)},this);this._showSingleGraphics(u);this._addGraphics(F)},_addGraphics:function(F){var u=this.container;u.clear();B.forEach(F,function(E){u.add(E)})},_getSingleGraphic:function(F){var u=this._clusterGenerator.getCell(F.getAggregationInfo().primary).features[0],E=this.layer.renderer;E=E&&E.getSymbol(u);var D=this._getSizeByCountVariable(this._renderer);E&&D&&(F=D?this._renderer.getSize(F,{sizeInfo:D,shape:E.style,resolution:this._map.getResolutionInMeters(),scale:this._map.getScale()}):
null,u.setSize(F));return u},_showSingleGraphics:function(F){B.forEach(F,this._showSingleGraphic);this._singleGraphics=F},_hideSingleGraphics:function(){B.forEach(this._singleGraphics,function(F){F.setSize(null);this._hideSingleGraphic(F)},this);this._singleGraphics=null},_clearSingleGraphics:function(){B.forEach(this._singleGraphics,function(F){F.setSize(null)});this._singleGraphics=null},_showSingleGraphic:function(F){F&&F._resume()},_hideSingleGraphic:function(F){F&&F._suspend()},_updateSizeVariable:function(){this.isClusteringEnabled()&&
(this._updateSizeByCountVariable(),this.emit("renderer-change"))},_applyClusterAttributes:function(F,u){F.setAttributes(u.attributes)},_createLayerEventListeners:function(){var F=this.layer;this._eventHandles.push(F.on("visibility-change",A.hitch(this,function(u){this.container.setVisibility(u.visible)})),F.on("scale-range-change",A.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)})),F.on("renderer-change",A.hitch(this,function(){this._applyRenderer()})),
F.on("info-template-change",A.hitch(this,function(){this._applyInfoTemplate()})))},_createMapEventListeners:function(){this._eventHandles.push(this._map.on("zoom-start",A.hitch(this,function(){this._removeClusterBoundary();this._removeFromPopup(this.container);this._removeFromPopup(this.layer);this._resetClusterNav();this.container.clear();this._hideSingleGraphics()})))},_createPopupEventListeners:function(){var F=this._map.infoWindow;this._eventHandles.push(F.on("selection-change",A.hitch(this,function(){this._resetClusterNavPartial();
var u=this._map.infoWindow.getSelectedFeature(),E=u&&u.getLayer();if(E){var D;E===this.container?(this._removeClusterBoundary(),this._map.infoWindow.addActions&&(D=this._createBrowseFeaturesAction())):E===this.layer&&u._isSuspended()?(this._map.infoWindow.addActions&&(D=this._createViewSummaryAction()),this._popupSingleGraphic=u,this._showSingleGraphic(this._popupSingleGraphic)):this._removeClusterBoundary();this._popupActions=D?[D]:null}})),F.on("clear-features",A.hitch(this,function(u){this._resetClusterNav();
u.isIntermediate||this._removeClusterBoundary()})),F.on("hide",A.hitch(this,function(){this._popupSingleGraphic&&this._popupSingleGraphic._suspend();this._clusterBoundary&&this._clusterBoundary.hide()})),F.on("show",A.hitch(this,function(){this._popupSingleGraphic&&this._popupSingleGraphic._resume();this._clusterBoundary&&this._clusterBoundary.show()})))},_destroyEventListeners:function(){B.forEach(this._eventHandles,function(F){F.remove()})}});v("extend-esri")&&A.setObject("layers.clustering.ClusterManager",
G,t);return G})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(G,A,B,v,t,l,p,d){G=G([l,p],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(k,c){A.mixin(this,c);this.initialize(k,c)},getTitle:function(k){var c;this.info&&(c=this.titleHasRelatedFields||this.titleHasAsyncExpressions?"":this._getPopupValues(k,
this._fetchAttributes(k,null,this.getExpressionFieldsInTitle()),!0).title);return c||""},getContent:function(k){return this.info?(new d({template:this,graphic:k,chartTheme:this.chartTheme},v.create("div"))).domNode:""}});B("extend-esri")&&A.setObject("dijit.PopupTemplate",G,t);return G})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./promiseList ./ArcadeExpression ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./arcadeProfiles/popupProfile ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e,r,w,H,x){G=G(null,{declaredClass:"esri.PopupInfo",_reNewline:/(\n)/ig,_reExprField:/^\s*expression\//i,_reExprFieldPattern:/\{expression\/([^\}]+)\}/ig,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",_aggregatedFeaturesVariable:"$aggregatedfeatures",initialize:function(q,C){if(q){A.mixin(this,C);this.info=q;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var F=this._fieldLabels=
{},u=this._fieldsMap={};this.info.fieldInfos&&B.forEach(this.info.fieldInfos,function(E){var D=E.fieldName.toLowerCase(),M=this._isExpressionField(D)?this.getExpressionInfo(D):null;F[D]=M?M.title:E.label;u[D]=E},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix));this.titleHasAsyncExpressions=this._titleHasAsyncExpressions();this.contentHasAsyncExpressions=this._contentHasAyncExpressions()}},toJson:function(){return v.fromJson(v.toJson(this.info))},
getTitle:function(){},getContent:function(){},getFieldInfo:function(q){var C;B.some(this.info&&this.info.fieldInfos,function(F){F.fieldName===q&&(C=F);return!!C});return C},getExpressionInfo:function(q){if(q=this._getExprField(q)){q=q.toLowerCase();var C;B.some(this.info.expressionInfos,function(F){F.name.toLowerCase()===q&&(C=F);return!!C});return C}},getExpressionFieldsInTitle:function(){return this._getExprFieldsFromTemplatedString(this.info.title)},getExpressionFieldsInContent:function(){var q=
this._collectExprFieldsFromTemplatedString(this.info.description,[]);this.info.description||B.forEach(this.info.fieldInfos,function(C){C.visible&&this._collectExprField(C.fieldName,q)},this);B.forEach(this.info.mediaInfos,function(C){this._collectExprFieldsFromTemplatedString(C.title,q);this._collectExprFieldsFromTemplatedString(C.caption,q);if(C=C.value)this._collectExprFieldsFromTemplatedString(C.linkURL,q),this._collectExprFieldsFromTemplatedString(C.sourceURL,q),B.forEach(C.fields,function(F){this._collectExprField(F,
q)},this),this._collectExprField(C.normalizeField,q),this._collectExprField(C.tooltipField,q)},this);return q},getRequiredExpressionFields:function(){return this.getExpressionFieldsInTitle().concat(this.getExpressionFieldsInContent())},hasGeometryOperations:function(){return B.some(this._getArcadeExpressions(),function(q){return q.hasGeometryOperations()})},hasAsyncExpressions:function(){return B.some(this._getArcadeExpressions(),function(q){return q.async})},initializeArcadeEngine:function(){return w.initialize(this._getArcadeExpressions())},
getComponents:function(q,C){var F=this.info,u={initArcadeEngine:this.initializeArcadeEngine()};F.fieldInfos&&(F=B.filter(F.fieldInfos,function(E){return-1!==E.fieldName.indexOf(this._relatedFieldPrefix)},this))&&0<F.length&&(u.relatedInfo=this._getRelatedRecords({graphic:q,fieldsInfo:F}));this._needFullResolutionFeature(q)&&(u.fullResolutionFeature=this._getFullResolutionFeature(q));this._needAggregatedFeaturesLayer(q)&&(u.aggregatedFeaturesLayer=this._getAggregatedFeaturesLayer(q));return m(u).then(A.hitch(this,
function(E){var D=E.fullResolutionFeature,M=C&&C.evaluateAllExpressions,I=M?null:this.getRequiredExpressionFields();E=(M?this.hasAsyncExpressions():this._hasAsyncExpressions(I))?this._fetchAttributesAsync(q,D,I,E.aggregatedFeaturesLayer):this._fetchAttributes(q,D,I);return m([E]).then(A.hitch(this,function(z){return this._getPopupValues(q,z[0])}))}))},getAttachments:function(q){var C=q.getSourceLayer();q=q.attributes;if(this.info.showAttachments&&C&&C.hasAttachments&&C.objectIdField&&(q=q&&q[C.objectIdField]))return C.queryAttachmentInfos(q)},
_needAggregatedFeaturesLayer:function(q){return q.isAggregate()?B.some(this._getArcadeExpressions(),function(C){return C.hasVariable(this._aggregatedFeaturesVariable)},this):!1},_getAggregatedFeaturesLayer:function(q){return q.getAggregationSourceLayer().getFeatureCollectionLayer(q.getChildGraphics()).always(function(C){return C instanceof Error?null:C})},_needFullResolutionFeature:function(q){return(q=q.getSourceLayer())?"function"===typeof q.getMaxAllowableOffset&&0<q.getMaxAllowableOffset()&&this.hasGeometryOperations():
!1},_getFullResolutionFeature:function(q){var C=q.getSourceLayer(),F=C.objectIdField;q=(q=q.attributes)&&F&&q[F];if(null==q)return null;var u=new a;u.where=F+"\x3d"+q;u.maxAllowableOffset=0;u.outFields=[F];C._enableCacheHint(u);return C.queryFeatures(u).then(function(E){return E.features&&E.features[0]})},_isExpressionField:function(q){return this._reExprField.test(q)},_getExprField:function(q){return this._isExpressionField(q)?q.replace(this._reExprField,""):null},_collectExprField:function(q,C){(q=
this._getExprField(q))&&C.push(q);return C},_collectExprFieldsFromTemplatedString:function(q,C){q=this._getExprFieldsFromTemplatedString(q);q.length&&Array.prototype.push.apply(C,q);return C},_getExprFieldsFromTemplatedString:function(q){q=q?q.match(this._reExprFieldPattern):null;return B.map(q,function(C){return C.replace(this._reExprFieldPattern,"$1")},this)},_titleHasAsyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInTitle())},_contentHasAyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInContent())},
_hasAsyncExpressions:function(q){return B.some(q,function(C){C=this._exprCache[C];return!(!C||!C.async)},this)},_compileExpressions:function(q){var C={};B.forEach(q,function(F){var u=F.returnType&&F.returnType.toLowerCase();C[F.name]=new g({expression:F.expression,returnType:"number"===u?"number":"string",profile:w})});return C},_getArcadeExpressions:function(){var q=[],C;for(C in this._exprCache)q.push(this._exprCache[C]);return q},_fetchAttributesAsync:function(q,C,F,u){var E=this._fetchAttributes(q,
C,F,u);q={};for(var D in E)(C=E[D])&&C.then&&(q[D]=C);return m(q).then(A.hitch(this,function(M){for(var I in M){var z=M[I];E[I]=z instanceof Error?null:this._processArcadeResult(z)}return E}))},_processArcadeResult:function(q){"string"===typeof q&&(q=c.encode(q));return q},_fetchAttributes:function(q,C,F,u){var E=A.clone(q.attributes)||{},D=C&&C.geometry,M=this._exprPrefix,I=this._exprCache;F=F||B.map(this.info.expressionInfos,function(z){return z.name});B.forEach(F,function(z){var K=M+z;z=(z=I[z])?
q.evaluateExpression(z,this._getEvalOptions(z,q,D,u)):null;E[K]=this._processArcadeResult(z)},this);return E},_getEvalOptions:function(q,C,F,u){var E=q.hasGeometryOperations(),D=C.getSourceLayer(),M=D&&(D.getMap()||D.parentLayer&&D.parentLayer.getMap());u&&(u._map=M);q=w.getEvalOptions({expression:q,feature:C,layer:D,aggregatedFeaturesLayer:u,map:M,spatialReference:M&&M.spatialReference});C=q.context.vars.$feature;E=!(!E||!F);C&&E&&(C._geometry=F);q.skipCache=E;return q},_getPopupValues:function(q,
C,F){C=C||this._fetchAttributes(q);var u=this.info,E=q.getSourceLayer(),D=A.clone(C),M="",I="",z,K,L=E&&E._getDateOpts&&E._getDateOpts().properties;L=L&&L.slice(0);var N={dateFormat:{properties:L,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)},format:null};if(this._relatedInfo)for(S in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(S)){var P=this._relatedInfo[S],T=this._relatedLayersInfo[S];P&&(B.forEach(P.relatedFeatures,function(aa){for(K in aa.attributes)if(aa.attributes.hasOwnProperty(K)&&
"esriRelCardinalityOneToOne"===T.relation.cardinality){var R=this._toRelatedFieldName([T.relation.id,K]);C[R]=D[R]=aa.attributes[K]}},this),B.forEach(P.relatedStatsFeatures,function(aa){for(K in aa.attributes)if(aa.attributes.hasOwnProperty(K)){var R=this._toRelatedFieldName([T.relation.id,K]);C[R]=D[R]=aa.attributes[K]}},this))}for(z in D){var S=this._fieldsMap[z.toLowerCase()];P=this._getLayerFieldInfo(E,z);S&&P&&(S.fieldName=P.name);D[z]=this._formatValue(D[z],z,N);L&&S&&S.format&&S.format.dateFormat&&
(S=B.indexOf(L,z),-1<S&&L.splice(S,1))}if(E)for(z in L=E.typeIdField,C)if(C.hasOwnProperty(z)&&-1===z.indexOf(this._relatedFieldPrefix)){var Z=C[z];b.isDefined(Z)&&(S=this._getDomainName(E,q,z,Z),b.isDefined(S)?D[z]=S:z===L&&(S=this._getTypeName(E,q,Z),b.isDefined(S)&&(D[z]=S)))}u.title&&(M=this._processFieldsInLinks(this._fixTokens(u.title,E),C),M=A.trim(this._removeEmptyHref(b.substitute(D,M,N)||"")));if(F)return{title:M};u.description&&(I=this._processFieldsInLinks(this._fixTokens(u.description,
E),C),I=A.trim(this._removeEmptyHref(b.substitute(D,I,N)||"")));if(u.fieldInfos){var da=[];B.forEach(u.fieldInfos,function(aa){(z=aa.fieldName)&&aa.visible&&da.push([this._fieldLabels[z.toLowerCase()]||z,b.substitute(D,"${"+z+"}",N)||""])},this)}var Q;if(u.mediaInfos){var W=[];B.forEach(u.mediaInfos,function(aa){Q=0;Z=aa.value;switch(aa.type){case "image":var R=Z.sourceURL;R=R&&A.trim(this._removeEmptyHref(b.substitute(C,this._fixTokens(R,E))));Q=!!R;break;case "piechart":case "linechart":case "columnchart":case "barchart":R=
Z.normalizeField;Z.fields=B.map(Z.fields,function(va){return(V=this._getLayerFieldInfo(E,va))?V.name:va},this);if(R){var V=this._getLayerFieldInfo(E,R);Z.normalizeField=V?V.name:R}Q=B.some(Z.fields,function(va){return b.isDefined(C[va])||-1!==va.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(Q){aa=A.clone(aa);Z=aa.value;R=aa.title?this._processFieldsInLinks(this._fixTokens(aa.title,E),C):"";var ba=aa.caption?this._processFieldsInLinks(this._fixTokens(aa.caption,
E),C):"";aa.title=R?A.trim(this._removeEmptyHref(b.substitute(D,R,N)||"")):"";aa.caption=ba?A.trim(this._removeEmptyHref(b.substitute(D,ba,N)||"")):"";if("image"===aa.type)Z.sourceURL=b.substitute(C,this._fixTokens(Z.sourceURL,E)),Z.linkURL&&(Z.linkURL=A.trim(b.substitute(C,this._fixTokens(Z.linkURL,E))||""));else{var ha,qa;B.forEach(Z.fields,function(va,sa){if(-1!==va.indexOf(this._relatedFieldPrefix))qa=this._getRelatedChartInfos(va,Z,C,N),qa instanceof Array?Z.fields=qa:Z.fields[sa]=qa;else{var Ba=
C[va];Ba=void 0===Ba?null:Ba;ha=C[Z.normalizeField]||0;Ba&&ha&&(Ba/=ha);Z.fields[sa]={y:Ba,tooltip:(this._fieldLabels[va.toLowerCase()]||va)+":\x3cbr/\x3e"+this._formatValue(Ba,va,N,!!ha)}}},this)}W.push(aa)}},this)}return{title:M,description:I,hasDescription:!!u.description,fields:da&&da.length?da:null,mediaInfos:W&&W.length?W:null,formatted:D,editSummary:!1!==u.showLastEditInfo&&E&&E.getEditSummary?E.getEditSummary(q):""}},_getRelatedChartInfos:function(q,C,F,u){var E,D;var M=[];var I=this._fromRelatedFieldName(q);
var z=I[0];var K=this._relatedInfo[z];z=this._relatedLayersInfo[z];K&&B.forEach(K.relatedFeatures,function(L){L=L.attributes;var N;for(N in L)if(L.hasOwnProperty(N)&&N===I[1]){var P={};D=L[N];C.normalizeField&&(E=-1!==C.normalizeField.indexOf(this._relatedFieldPrefix)?L[this._fromRelatedFieldName(C.normalizeField)[1]]:F[C.normalizeField]);D&&E&&(D/=E);if(C.tooltipField)if(-1!==C.tooltipField.indexOf(this._relatedFieldPrefix)){var T=this._fromRelatedFieldName(C.tooltipField)[1],S=b.isDefined(L[T])?
this._formatValue(L[T],C.tooltipField,u,!!E):T;P.tooltip=S+":\x3cbr/\x3e"+this._formatValue(D,T,u,!!E)}else P.tooltip=(this._fieldLabels[q.toLowerCase()]||q)+":\x3cbr/\x3e"+this._formatValue(D,C.tooltipField,u,!!E);else P.tooltip=D;P.y=D;M.push(P)}},this);return"esriRelCardinalityOneToMany"===z.relation.cardinality||"esriRelCardinalityManyToMany"===z.relation.cardinality?M:M[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",
shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",
shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",longMonthDayYearShortTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longMonthDayYearShortTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longMonthDayYearLongTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",
longMonthDayYearLongTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",dayShortMonthYearShortTime:"(datePattern: 'd MMM y', timePattern: 'h:mm a', selector: 'date and time')",dayShortMonthYearShortTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm', selector: 'date and time')",dayShortMonthYearLongTime:"(datePattern: 'd MMM y', timePattern: 'h:mm:ss a', selector: 'date and time')",dayShortMonthYearLongTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm:ss', selector: 'date and time')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",longDateShortTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longDateShortTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longDateLongTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",longDateLongTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",
shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_dateFormatsJson:{shortDate:{datePattern:"M/d/y",selector:"date"},shortDateShortTime:{datePattern:"M/d/y",timePattern:"h:mm a",selector:"date and time"},shortDateShortTime24:{datePattern:"M/d/y",timePattern:"H:mm",selector:"date and time"},shortDateLongTime:{datePattern:"M/d/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLongTime24:{datePattern:"M/d/y",timePattern:"H:mm:ss",selector:"date and time"},
shortDateLE:{datePattern:"d/M/y",selector:"date"},shortDateLEShortTime:{datePattern:"d/M/y",timePattern:"h:mm a",selector:"date and time"},shortDateLEShortTime24:{datePattern:"d/M/y",timePattern:"H:mm",selector:"date and time"},shortDateLELongTime:{datePattern:"d/M/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLELongTime24:{datePattern:"d/M/y",timePattern:"H:mm:ss",selector:"date and time"},longMonthDayYear:{datePattern:"MMMM d, y",selector:"date"},longMonthDayYearShortTime:{datePattern:"MMMM d, y",
timePattern:"h:mm a",selector:"date and time"},longMonthDayYearShortTime24:{datePattern:"MMMM d, y",timePattern:"H:mm",selector:"date and time"},longMonthDayYearLongTime:{datePattern:"MMMM d, y",timePattern:"h:mm:ss a",selector:"date and time"},longMonthDayYearLongTime24:{datePattern:"MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},dayShortMonthYear:{datePattern:"d MMM y",selector:"date"},dayShortMonthYearShortTime:{datePattern:"d MMM y",timePattern:"h:mm a",selector:"date and time"},dayShortMonthYearShortTime24:{datePattern:"d MMM y",
timePattern:"H:mm",selector:"date and time"},dayShortMonthYearLongTime:{datePattern:"d MMM y",timePattern:"h:mm:ss a",selector:"date and time"},dayShortMonthYearLongTime24:{datePattern:"d MMM y",timePattern:"H:mm:ss",selector:"date and time"},longDate:{datePattern:"EEEE, MMMM d, y",selector:"date"},longDateShortTime:{datePattern:"EEEE, MMMM d, y",timePattern:"h:mm a",selector:"date and time"},longDateShortTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm",selector:"date and time"},longDateLongTime:{datePattern:"EEEE, MMMM d, y",
timePattern:"h:mm:ss a",selector:"date and time"},longDateLongTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},longMonthYear:{datePattern:"MMMM y",selector:"date"},shortMonthYear:{datePattern:"MMM y",selector:"date"},year:{datePattern:"y",selector:"date"}},_reHref:/href\s*=\s*(")([^"]+)"/ig,_reHrefApos:/href\s*=\s*(')([^']+)'/ig,_fixTokens:function(q,C){var F=this;return q.replace(/(\{([^\{\r\n]+)\})/g,function(u,E,D){u=F._getLayerFieldInfo(C,D);return"$"+(u?"{"+
u.name+"}":E)})},_encodeAttributes:function(q,C){q=A.clone(q)||{};var F,u;for(F in q)(u=q[F])&&"string"===typeof u&&(u=C?u:encodeURIComponent(u),u=u.replace(/'/g,"\x26apos;"),q[F]=u);return q},_processFieldsInLinks:function(q,C){var F=this._encodeAttributes(C),u=this._encodeAttributes(C,!0);C=A.hitch(this,this._addValuesToHref,C,F,u);q&&(q=q.replace(this._reHref,C).replace(this._reHrefApos,C));return q},_addValuesToHref:function(q,C,F,u,E,D){D=D&&A.trim(D);return u=b.substitute(D&&0===D.indexOf("${")?
"'"===E?F:q:C,u)},_getLayerFieldInfo:function(q,C){return q&&q.getField?q.getField(C):null},_formatValue:function(q,C,F,u){var E=this._fieldsMap[C.toLowerCase()],D=E&&E.format;C=-1!==B.indexOf(F.dateFormat.properties,C);var M="number"===typeof q&&!C&&(!D||!D.dateFormat);if(!b.isDefined(q)||!E||!b.isDefined(D))return this._applyFormatting(q,M);E=D.hasOwnProperty("places")||D.hasOwnProperty("digitSeparator");var I=D.hasOwnProperty("digitSeparator")?D.digitSeparator:!0;if(E&&!C)var z={formatType:"NumberFormat",
places:b.isDefined(D.places)&&(!u||0<D.places)?Number(D.places):Infinity};else if(D.dateFormat)z=A.mixin({formatType:"DateFormat",utcOffset:this.utcOffset},this._dateFormatsJson[D.dateFormat]||this._dateFormatsJson.shortDateShortTime);else return this._applyFormatting(q,M);var K=this._applyFormatFunctions(q,z,F);E&&-1<q.constructor.toString().indexOf("Array")&&(K="",B.forEach(q,A.hitch(this,function(L,N){N&&(K+=" ");K+=this._applyFormatFunctions(L,z,F)})));E&&!I&&x.group&&(K=K.replace(new RegExp("\\"+
x.group,"g"),""));C&&(K='\x3cspan class\x3d"esriDateValue"\x3e'+K+"\x3c/span\x3e");return this._applyFormatting(K,M)},_applyFormatFunctions:function(q,C,F){C&&F&&(F.format={myKey:C});q=b.substitute({myKey:q},"${myKey}",F)||"";C&&F&&(F.format=null);return q},_applyFormatting:function(q,C){return C?this._forceLTR(q):this._applyPreWrap(q)},_forceLTR:function(q){var C=d("ie");return C&&10>=C?q:"\x3cspan class\x3d'esriNumericValue'\x3e"+q+"\x3c/span\x3e"},_applyPreWrap:function(q){return"string"===typeof q?
q.replace(this._reNewline,"\x3cspan class\x3d'charNewLine'\x3e$1\x3c/span\x3e"):q},_insertOffset:function(q){q&&(q=b.isDefined(this.utcOffset)?q.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):q);return q},_getDomainName:function(q,C,F,u){return(q=q.getDomain&&q.getDomain(F,{feature:C}))&&q.codedValues?q.getName(u):null},_getTypeName:function(q,C,F){return(q=q.getType&&q.getType(C))&&q.name},_getRelatedRecords:function(q){var C=q.graphic,F;this._relatedLayersInfoPromise||(this._relatedLayersInfoPromise=
this._getRelatedLayersInfo(q).then(A.hitch(this,function(u){for(F in u)u.hasOwnProperty(F)&&u[F]&&(this._relatedLayersInfo[F].relatedLayerInfo=u[F])})));return this._relatedLayersInfoPromise.then(A.hitch(this,function(){return this._queryRelatedLayers(C)})).then(A.hitch(this,function(u){this._setRelatedRecords(C,u);return u}))},_getRelatedLayersInfo:function(q){var C=q.fieldsInfo,F,u={};var E=q.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});B.forEach(C,function(D){var M;
var I=this._fromRelatedFieldName(D.fieldName);var z=I[0];I=I[1];if(z&&(!this._relatedLayersInfo[z]&&E&&E.relationships&&(B.some(E.relationships,function(L){if(L.id==z)return M=L,!0}),M&&(this._relatedLayersInfo[z]={relation:M,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[z]&&(this._relatedLayersInfo[z].relatedFields.push(I),D.statisticType))){var K=new r;K.statisticType=D.statisticType;K.onStatisticField=I;K.outStatisticFieldName=I;this._relatedLayersInfo[z].outStatistics.push(K)}},
this);for(F in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(F)&&this._relatedLayersInfo[F]&&(q=this._relatedLayersInfo[F].relation,q=E.url.replace(/[0-9]+$/,q.relatedTableId),this._relatedLayersInfo[F].relatedLayerUrl=q,u[F]=n({url:q,content:{f:"json"},callbackParamName:"callback"}));return k(u)},_queryRelatedLayers:function(q){var C={},F;for(F in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(F)&&(C[F]=this._queryRelatedLayer({graphic:q,relatedInfo:this._relatedLayersInfo[F]}));
return k(C)},_queryRelatedLayer:function(q){var C,F;var u=q.graphic;var E=u.getSourceLayer();var D=E.url.match(/[0-9]+$/g)[0];var M=q.relatedInfo;var I=M.relatedLayerInfo;var z=M.relatedLayerUrl;var K=M.relation;q=B.filter(I.relationships,function(Z){return Z.relatedTableId===parseInt(D,10)});1===q.length?C=q[0]:1<q.length&&B.some(q,function(Z){Z.id===K.id&&(C=Z);return!!C});if(C){var L=new a;B.some(I.fields,function(Z){if(Z.name===C.keyField)return F=-1!==B.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger",
"esriFieldTypeSingle","esriFieldTypeDouble"],Z.type)?"number":"string",!0});if(C.relationshipTableId&&C.keyFieldInRelationshipTable){var N=new p;this._queryRelatedRecords(u,C).then(A.hitch(this,function(Z){var da;(da=Z[u.attributes[E.objectIdField]])?(Z=B.map(da.features,function(Q){return Q.attributes[I.objectIdField]},this),M.outStatistics&&0<M.outStatistics.length&&I.supportsStatistics&&(T=new a,T.where=this._chunkWhereInClause(I.objectIdField,Z,1E3),T.outFields=L.outFields,T.outStatistics=M.outStatistics),
T&&(S=new f(z),S.execute(T).then(A.hitch(this,function(Q){var W=[];W.push(da);W.push(Q);N.resolve(W)})))):N.resolve()}))}else{var P="string"===F?C.keyField+"\x3d'"+u.attributes[K.keyField]+"'":C.keyField+"\x3d"+u.attributes[K.keyField];L.where=P;L.outFields=M.relatedFields;if(M.outStatistics&&0<M.outStatistics.length&&I.supportsStatistics){var T=new a;T.where=L.where;T.outFields=L.outFields;T.outStatistics=M.outStatistics}var S=new f(z);P=[];P.push(S.execute(L));T&&P.push(S.execute(T))}}return P?
k(P):N?N.promise:void 0},_setRelatedRecords:function(q,C){this._relatedInfo=[];for(var F in C)C.hasOwnProperty(F)&&C[F]&&(q=C[F],this._relatedInfo[F]={},this._relatedInfo[F].relatedFeatures=q[0].features,b.isDefined(q[1])&&(this._relatedInfo[F].relatedStatsFeatures=q[1].features))},_handlerErrorResponse:function(q,C){q.reject(C)},_fromRelatedFieldName:function(q){var C=[];-1!==q.indexOf(this._relatedFieldPrefix)&&(q=q.split("/"),C=q.slice(1));return C},_toRelatedFieldName:function(q){var C="";q&&
0<q.length&&(C=this._relatedFieldPrefix+q[0]+"/"+q[1]);return C},_queryRelatedRecords:function(q,C){var F=q.getSourceLayer(),u=new e;u.outFields=["*"];u.relationshipId=C.id;u.objectIds=[q.attributes[F.objectIdField]];return F.queryRelatedFeatures(u)},_removeEmptyHref:function(q){return q.replace(/href=(""|'')/gi,"")},_chunkWhereInClause:function(q,C,F){for(var u=0,E=[];u<C.length;)E.push(q+" IN ("+C.slice(u,F+u)+")"),u+=F;return E.join(" OR ")}});l("extend-esri")&&(h.PopupInfo=h.PopupInfoTemplate=
G);return G})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(G){var A=G.getObject("dojox.html.entities",!0),B=function(t,l){if(l._encCache&&l._encCache.regexp&&l._encCache.mapper&&l.length==l._encCache.length){var p=l._encCache.mapper;var d=l._encCache.regexp}else{p={};d=["["];var k;for(k=0;k<l.length;k++)p[l[k][0]]="\x26"+l[k][1]+";",d.push(l[k][0]);d.push("]");d=new RegExp(d.join(""),"g");l._encCache={mapper:p,regexp:d,length:l.length}}return t=t.replace(d,function(c){return p[c]})},
v=function(t,l){if(l._decCache&&l._decCache.regexp&&l._decCache.mapper&&l.length==l._decCache.length){var p=l._decCache.mapper;var d=l._decCache.regexp}else{p={};d=["("];var k;for(k=0;k<l.length;k++){var c="\x26"+l[k][1]+";";k&&d.push("|");p[c]=l[k][0];d.push(c)}d.push(")");d=new RegExp(d.join(""),"g");l._decCache={mapper:p,regexp:d,length:l.length}}return t=t.replace(d,function(b){return p[b]})};A.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];A.latin=[["\u00a1",
"iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],
["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],
["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],
["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a",
"Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be",
"xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191",
"uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229",
"cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663",
"clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030",
"permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];A.encode=function(t,l){t&&(l?t=B(t,l):(t=B(t,A.html),t=B(t,A.latin)));return t};A.decode=function(t,l){t&&(l?t=v(t,l):(t=v(t,A.html),t=v(t,A.latin)));return t};return A})},"esri/ArcadeExpression":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./layers/support/attributeUtils ./support/expressionUtils".split(" "),function(G,A,B,v,t,l){G=G(null,{declaredClass:"esri.ArcadeExpression",expression:null,profile:null,returnType:null,
async:null,id:null,syntaxTree:null,_traits:null,_attributeDef:null,_attributeCache:null,_compiled:!1,constructor:function(p){A.mixin(this,p);this.returnType=this.returnType||"string";this.id=t.getAttributeId(this.expression);this._setSyntaxTree(this.profile.parse(this));this.async=this.async||this.profile.isAsync(this)},hasGeometryOperations:function(){var p=this._traits.geometryOperations;void 0===p&&(p=this._traits.geometryOperations=l.hasGeometryOperations(this.syntaxTree));return p},hasFeatureSetOperations:function(){var p=
this._traits.featureSetOperations;void 0===p&&(p=this._traits.featureSetOperations=l.hasFeatureSetOperations(this.syntaxTree));return p},hasVariable:function(p){var d=this._traits.variables;void 0===d[p]&&(d[p]=l.hasVariable(this.syntaxTree,p));return d[p]},hasFunction:function(p){var d=this._traits.functions;void 0===d[p]&&(d[p]=l.hasFunction(this.syntaxTree,p));return d[p]},evaluate:function(p){this._compile();var d=this._attributeCache.compiledFunc;return this.async?l.executeAsyncFunction(d,p):
l.executeFunction(d,p)},_setSyntaxTree:function(p){this.syntaxTree=p;this._compiled=!1;this._traits={variables:{},functions:{}};this._createLegacyValueObjects()},_createLegacyValueObjects:function(){this._attributeDef={valueExpression:this.expression};this._attributeCache={attributeInfo:this._attributeDef,isNumeric:"number"===this.returnType,idSource:this.expression,id:this.id,hasExpr:!0,compiledFunc:null,syntaxTree:this.syntaxTree,isScaleDriven:!1,dependsOnView:this.hasVariable("$view"),dependsOnGeometry:this.hasGeometryOperations(),
isJSFunc:!1}},_compile:function(){this._compiled||(this._attributeCache.compiledFunc=this.profile.compile(this),this._compiled=!0)}});B("extend-esri")&&(v.ArcadeExpression=G);return G})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(G,A,B,v,t){G=G(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,
orderByFields:null,toJson:function(){var l={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},p=this.objectIds,d=this.outFields,k=this.outSpatialReference,c=this.orderByFields;p&&(l.objectIds=p.join(","));d&&(l.outFields=d.join(","));k&&(l.outSR=k.wkid||B.toJson(k.toJson()));c&&(l.orderByFields=c.join(","));l._ts=this._ts;return l}});v("extend-esri")&&
A.setObject("tasks.RelationshipQuery",G,t);return G})},"esri/arcadeProfiles/popupProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(G,A,B,v,t,l,p,d){G=new (G(null,{declaredClass:"esri.arcadeProfiles.PopupProfile",defaults:{globals:{featureSet:["$layer","$datastore","$map","$aggregatedfeatures"],async:["$layer","$datastore","$map","$aggregatedfeatures"]},context:{vars:{$feature:"any",
$layer:"any",$datastore:"any",$map:"any",$aggregatedfeatures:"any"}}},initialize:function(k){var c=[];d.hasGeometryOperations(k)&&c.push(p.enableGeometryOperations());(d.hasFeatureSetOperations(k)||d.hasVariables(k,this.defaults.globals.featureSet))&&c.push(p.enableFeatureSetOperations());d.isAsync(k)&&c.push(p.enableAsyncOperations());return t(c)},isAsync:function(k){k=[k];return d.hasFeatureSetOperations(k)||d.hasVariables(k,this.defaults.globals.async)},parse:function(k){return p.createSyntaxTree(k.expression)},
compile:function(k){var c=A.clone(this.defaults.context);c.useAsync=k.async;return k.syntaxTree?p.createFunction(k.syntaxTree,c):null},getEvalOptions:function(k){var c=k.expression,b=k.feature,h=k.layer,n=k.aggregatedFeaturesLayer,m=k.map;k=k.spatialReference;b=b&&c.hasVariable("$feature")?l.createFromGraphicLikeObject(b.geometry,b.attributes,h):null;var g,a;if(h){var f={spatialReference:k};c.hasVariable("$layer")&&(g=h.getMap()?p.createFeatureSetFromLayer(h,f):p.createFeatureSetFromLayerUrl(h.url,
f));if(c.hasVariable("$datastore"))var e=(e=d.getServiceUrl(h.url))?p.createFeatureSetCollectionFromServiceUrl(e,f):null;c.hasVariable("$aggregatedfeatures")&&n&&(a=n.getMap()?p.createFeatureSetFromLayer(n,f):null)}c=m&&c.hasVariable("$map")?p.createFeatureSetCollectionFromMap(m):null;return{context:{vars:{$feature:b,$layer:g,$datastore:e,$map:c,$aggregatedfeatures:a},spatialReference:k}}}}));B("extend-esri")&&A.setObject("arcadeProfiles.popupProfile",G,v);return G})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style ../libs/sanitizer/Sanitizer dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e,r,w,H,x){var q=0,C=x.widgets.popup,F=x.widgets.templatePicker;A=A([H,a,f],{declaredClass:"esri.dijit._PopupRenderer",_sanitizer:new m({whiteList:{span:["class"],dd:[],dl:[],dt:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],sub:[],sup:[],animate:[],animatetransform:[],circle:[],clippath:[],defs:[],ellipse:[],g:[],image:[],line:[],lineargradient:[],marker:[],mask:[],path:[],pattern:[],polygon:[],polyline:[],radialgradient:[],rect:[],stop:[],svg:[],"switch":[],symbol:[],
text:[],textpath:[],tspan:[],use:[]}},!0),constructor:function(){this._nls=v.mixin({},C)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'statusSection hidden' dojoAttachPoint\x3d'_status'\x3e\x3c/div\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this._showStatus(F.loading);this._contentDfd=this.template.getComponents(this.graphic).then(v.hitch(this,this._handleComponentsSuccess)).otherwise(v.hitch(this,this._handleComponentsError))},destroy:function(){this._contentDfd&&this._contentDfd.cancel();this._attachmentsDfd&&this._attachmentsDfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._contentDfd=this._attachmentsDfd=null;this.inherited(arguments)},
_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var u=this._mediaInfos,E=u.length,D=this.domNode,M=this._prevMedia,I=this._nextMedia;if(1<E){var z=0,K=0;t.forEach(u,function(L){"image"===L.type?z++:-1!==L.type.indexOf("chart")&&K++});z&&(c.set(this._imageCount,"innerHTML",z),l.query(".summary .image",
D).removeClass("hidden"));K&&(c.set(this._chartCount,"innerHTML",K),l.query(".summary .chart",D).removeClass("hidden"))}else l.query(".summary",D).addClass("hidden"),b.add(M,"hidden"),b.add(I,"hidden");u=this._mediaPtr;0===u?b.add(M,"hidden"):b.remove(M,"hidden");u===E-1?b.add(I,"hidden"):b.remove(I,"hidden");this._destroyFrame()},_displayMedia:function(){var u=this._mediaInfos[this._mediaPtr],E=u.title,D=u.caption,M=l.query(".mediaSection .hzLine",this.domNode)[0];c.set(this._mediaTitle,"innerHTML",
this._sanitizer.sanitize(E));b[E?"remove":"add"](this._mediaTitle,"hidden");c.set(this._mediaCaption,"innerHTML",this._sanitizer.sanitize(D));b[D?"remove":"add"](this._mediaCaption,"hidden");b[E&&D?"remove":"add"](M,"hidden");this._rid=null;if("image"===u.type)this._showImage(u);else{var I=this;E=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"];D=u.value.theme||this.chartTheme;v.isString(D)&&(D=D.replace(/\./gi,"/"),-1===D.indexOf("/")&&(D="dojox/charting/themes/"+D));D||(D="./Rainbow");
E.push(D);try{var z=this._rid=q++;G(E,function(K,L,N){z===I._rid&&(I._rid=null,I._showChart(u.type,u.value,K,L,N))})}catch(K){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(u){return(u=u&&v.trim(u).toLowerCase())&&(0===u.indexOf("mailto:")||0===u.indexOf("tel:"))},_showImage:function(u){b.add(this._mediaFrame,"image");var E=n.get(this._gallery,"height"),D=u.value,M=g.decode(D.linkURL);D=g.decode(D.sourceURL);var I;M&&(I=h.create("a",{href:M,target:this._preventNewTab(M)?
"":"_blank"},this._mediaFrame));M=u.refreshInterval?this._addURLParameter(D,"timestamp",Date.now()):D;h.create("img",{className:"esriPopupMediaImage",src:M},I||this._mediaFrame);var z=l.query(".esriPopupMediaImage",this._mediaFrame)[0];this._imageLoadHandle=B.connect(z,"onload",this,function(){this._clearImageHandles();this._imageLoaded(z,E);this._initImageRefresh(u)})},_addURLParameter:function(u,E,D){var M=-1===u.indexOf("?")?"?":"\x26";return u+M+E+"\x3d"+D},_initImageRefresh:function(u){if(u.refreshInterval){var E=
6E4*u.refreshInterval;this._imageRefreshHandle=setTimeout(v.hitch(this,function(){this._destroyFrame();this._showImage(u)}),E)}},_clearImageHandles:function(){B.disconnect(this._imageLoadHandle);this._imageLoadHandle=null;clearTimeout(this._imageRefreshHandle);this._imageRefreshHandle=null},_showChart:function(u,E,D,M,I){b.remove(this._mediaFrame,"image");D=this._chart=new D(h.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});I&&D.setTheme(I);switch(u){case "piechart":D.addPlot("default",
{type:"Pie",labels:!1});D.addSeries("Series A",E.fields);break;case "linechart":D.addPlot("default",{type:"Markers"});D.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});D.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});t.forEach(E.fields,function(z,K){z.x=K+1});D.addSeries("Series A",E.fields);break;case "columnchart":D.addPlot("default",{type:"Columns",gap:3});D.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});D.addSeries("Series A",E.fields);break;
case "barchart":D.addPlot("default",{type:"Bars",gap:3}),D.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),D.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),D.addSeries("Series A",E.fields)}this._action=new M(D);D.render()},_destroyFrame:function(){this._rid=null;this._clearImageHandles();this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);c.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(u,
E){var D=u.height;D<E&&n.set(u,"marginTop",Math.round((E-D)/2)+"px")},_attListHandler:function(u,E){if(u===this._attachmentsDfd){this._attachmentsDfd=null;var D="";E instanceof Error||!E||!E.length||t.forEach(E,function(M){D+="\x3cli\x3e";D+="\x3ca href\x3d'"+w.addProxy(M.url)+"' target\x3d'_blank'\x3e"+(M.name||"[No name]")+"\x3c/a\x3e";D+="\x3c/li\x3e"});c.set(this._attachmentsList,"innerHTML",D||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_createLinkIfURI:function(u,E){var D=w.getURIInfo(u);
if(D){var M=u.match(D.pattern);u=M&&M[2];M=g.decode(M[1]);h.create("a",{target:"_blank",href:M,title:M,innerHTML:this._sanitizer.sanitize(r.substitute({appName:D.appName,hierPart:u},D.label))},E)}else c.set(E,"innerHTML",this._sanitizer.sanitize(u))},_showStatus:function(u){c.set(this._status,"innerHTML",u);b.remove(this._status,"hidden");l.query(".mainSection",this.domNode).addClass("hidden")},_hideStatus:function(){c.set(this._status,"innerHTML","");b.add(this._status,"hidden");l.query(".mainSection",
this.domNode).removeClass("hidden")},_handleComponentsSuccess:function(u){if(u){this._hideStatus();var E=this.showTitle?u.title:"",D=u.description,M=u.fields,I=u.mediaInfos,z=this.domNode,K=this._nls,L=this,N=this.template,P=this.graphic;this._prevMedia.title=K.NLS_prevMedia;this._nextMedia.title=K.NLS_nextMedia;c.set(this._title,"innerHTML",this._sanitizer.sanitize(E));E||b.add(this._title,"hidden");if(!u.hasDescription&&M&&(D="",M=t.map(M,function(S){var Z=h.create("tr",{vAlign:"top"});h.create("td",
{className:"attrName",innerHTML:this._sanitizer.sanitize(S[0])},Z);var da=h.create("td",{className:"attrValue"},Z);this._createLinkIfURI(S[1],da);return Z},this),M.length)){var T=h.create("table",{className:"attrTable",cellPadding:"0px",cellSpacing:"0px"});t.forEach(M,function(S){T.appendChild(S)})}T?(this._description.appendChild(T),D=!0):c.set(this._description,"innerHTML",this._sanitizer.sanitize(D));D||b.add(this._description,"hidden");l.query("a",this._description).forEach(function(S){L._preventNewTab(S.href)?
"_blank"===S.target&&c.remove(S,"target"):c.set(S,"target","_blank")});E&&D?l.query(".mainSection .hzLine",z).removeClass("hidden"):E||D?l.query(".mainSection .hzLine",z).addClass("hidden"):l.query(".mainSection",z).addClass("hidden");if(E=this._attachmentsDfd=N.getAttachments(P))E.addBoth(v.hitch(this,this._attListHandler,E)),c.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+K.NLS_searching+"...\x3c/li\x3e"),l.query(".attachmentsSection",z).removeClass("hidden");I&&I.length&&(l.query(".mediaSection",
z).removeClass("hidden"),k.setSelectable(this._mediaFrame,!1),this._mediaInfos=I,this._mediaPtr=0,this._updateUI(),this._displayMedia());u.editSummary&&(c.set(this._editSummary,"innerHTML",this._sanitizer.sanitize(u.editSummary)),I&&I.length&&b.remove(this._mediaBreak,"hidden"),b.remove(this._editSummarySection,"hidden"));this.emit("content-update")}else this._showStatus(C.NLS_noInfo)},_handleComponentsError:function(u){u&&"cancel"===u.dojoType||(console.log("PopupRenderer: error loading template",
u),this._showStatus(C.NLS_noInfo))}});p("extend-esri")&&v.setObject("dijit._PopupRenderer",A,e);return A})},"esri/libs/sanitizer/Sanitizer":function(){!function(G,A){"object"==typeof exports&&"undefined"!=typeof module?module.exports=A():"function"==typeof define&&define.amd?define(A):(G="undefined"!=typeof globalThis?globalThis:G||self).Sanitizer=A()}(this,function(){function G(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,
animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,
"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,
"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,
"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,
"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,
"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,
"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,
"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,
"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,
rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,
"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,
"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}}function A(X){var ea=X||{},ia={},la;for(la in ea)ia[la]=ea[la];(X=ia).whiteList=X.whiteList||M.whiteList;X.onAttr=X.onAttr||M.onAttr;
X.onIgnoreAttr=X.onIgnoreAttr||M.onIgnoreAttr;X.safeAttrValue=X.safeAttrValue||M.safeAttrValue;this.options=X}function B(X){return X.replace(P,"\x26lt;").replace(T,"\x26gt;")}function v(X){return X.replace(S,"\x26quot;")}function t(X){return X.replace(Z,'"')}function l(X){return X.replace(da,function(ea,ia){return"x"===ia[0]||"X"===ia[0]?String.fromCharCode(parseInt(ia.substr(1),16)):String.fromCharCode(parseInt(ia,10))})}function p(X){return X.replace(Q,":").replace(W," ")}function d(X){for(var ea=
"",ia=0,la=X.length;ia<la;ia++)ea+=32>X.charCodeAt(ia)?" ":X.charAt(ia);return L.trim(ea)}function k(X){return X=d(X=p(X=l(X=t(X))))}function c(X){return X=B(X=v(X))}function b(X,ea){for(;ea<X.length;ea++){var ia=X[ea];if(" "!==ia)return"\x3d"===ia?ea:-1}}function h(X,ea){for(;0<ea;ea--){var ia=X[ea];if(" "!==ia)return"\x3d"===ia?ea:-1}}function n(X){return'"'===X[0]&&'"'===X[X.length-1]||"'"===X[0]&&"'"===X[X.length-1]?X.substr(1,X.length-2):X}function m(X){var ea=X||{},ia={},la;for(la in ea)ia[la]=
ea[la];(X=ia).stripIgnoreTag&&(X.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),X.onIgnoreTag=sa.onIgnoreTagStripAll);X.whiteList=X.whiteList||sa.whiteList;X.onTag=X.onTag||sa.onTag;X.onTagAttr=X.onTagAttr||sa.onTagAttr;X.onIgnoreTag=X.onIgnoreTag||sa.onIgnoreTag;X.onIgnoreTagAttr=X.onIgnoreTagAttr||sa.onIgnoreTagAttr;X.safeAttrValue=X.safeAttrValue||sa.safeAttrValue;X.escapeHtml=X.escapeHtml||sa.escapeHtml;this.options=X;!1===
X.css?this.cssFilter=!1:(X.css=X.css||{},this.cssFilter=new va(X.css))}var g,a,f=Object.prototype,e=Function.prototype.toString,r=f.hasOwnProperty,w=e.call(Object),H=f.toString,x=(g=Object.getPrototypeOf,a=Object,function(X){return g(a(X))}),q=function(X){var ea;if(!(ea=!X||"object"!=typeof X||"[object Object]"!=H.call(X))&&(ea=!1,null!=X&&"function"!=typeof X.toString))try{ea=!!(X+"")}catch(ia){}if(ea)return!1;X=x(X);if(null===X)return!0;X=r.call(X,"constructor")&&X.constructor;return"function"==
typeof X&&X instanceof X&&e.call(X)==w},C={exports:{}},F={};f={exports:{}};var u={},E=/javascript\s*:/gim;u.whiteList=G();u.getDefaultWhiteList=G;u.onAttr=function(X,ea,ia){};u.onIgnoreAttr=function(X,ea,ia){};u.safeAttrValue=function(X,ea){return E.test(ea)?"":ea};var D={indexOf:function(X,ea){var ia;if(Array.prototype.indexOf)return X.indexOf(ea);var la=0;for(ia=X.length;la<ia;la++)if(X[la]===ea)return la;return-1},forEach:function(X,ea,ia){var la;if(Array.prototype.forEach)return X.forEach(ea,
ia);var ma=0;for(la=X.length;ma<la;ma++)ea.call(ia,X[ma],ma,X)},trim:function(X){return String.prototype.trim?X.trim():X.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(X){return String.prototype.trimRight?X.trimRight():X.replace(/(\s*$)/g,"")}},M=u,I=function(X,ea){function ia(){if(!ma){var Ca=D.trim(X.slice(ua,xa)),Fa=Ca.indexOf(":");if(-1!==Fa){var Ga=D.trim(Ca.slice(0,Fa));Fa=D.trim(Ca.slice(Fa+1));Ga&&(Ca=ea(ua,ta.length,Ga,Fa,Ca))&&(ta+=Ca+"; ")}}ua=xa+1}";"!==(X=D.trimRight(X))[X.length-1]&&
(X+=";");for(var la=X.length,ma=!1,ua=0,xa=0,ta="";xa<la;xa++){var ya=X[xa];if("/"===ya&&"*"===X[xa+1]){ya=X.indexOf("*/",xa+2);if(-1===ya)break;ua=(xa=ya+1)+1;ma=!1}else"("===ya?ma=!0:")"===ya?ma=!1:";"===ya?ma||ia():"\n"===ya&&ia()}return D.trim(ta)};A.prototype.process=function(X){if(!(X=(X=X||"").toString()))return"";var ea=this.options,ia=ea.whiteList,la=ea.onAttr,ma=ea.onIgnoreAttr,ua=ea.safeAttrValue;return I(X,function(xa,ta,ya,Ca,Fa){var Ga=ia[ya],na=!1;if(!0===Ga?na=Ga:"function"==typeof Ga?
na=Ga(Ca):Ga instanceof RegExp&&(na=Ga.test(Ca)),!0!==na&&(na=!1),Ca=ua(ya,Ca)){var y;xa={position:ta,sourcePosition:xa,source:Fa,isWhite:na};return na?null==(y=la(ya,Ca,xa))?ya+":"+Ca:y:null==(y=ma(ya,Ca,xa))?void 0:y}})};!function(X,ea){for(var ia in(ea=X.exports=function(la,ma){return(new A(ma)).process(la)}).FilterCSS=A,u)ea[ia]=u[ia]}(f,f.exports);var z={indexOf:function(X,ea){var ia;if(Array.prototype.indexOf)return X.indexOf(ea);var la=0;for(ia=X.length;la<ia;la++)if(X[la]===ea)return la;return-1},
forEach:function(X,ea,ia){var la;if(Array.prototype.forEach)return X.forEach(ea,ia);var ma=0;for(la=X.length;ma<la;ma++)ea.call(ia,X[ma],ma,X)},trim:function(X){return String.prototype.trim?X.trim():X.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(X){return(X=/\s|\n|\t/.exec(X))?X.index:-1}},K=f.exports.getDefaultWhiteList,L=z,N=new f.exports.FilterCSS,P=/</g,T=/>/g,S=/"/g,Z=/&quot;/g,da=/&#([a-zA-Z0-9]*);?/gim,Q=/&colon;?/gim,W=/&newline;?/gim,aa=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,
R=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,V=/u\s*r\s*l\s*\(.*/gi,ba=/\x3c!--[\s\S]*?--\x3e/g;F.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:"autoplay controls crossorigin loop muted preload src".split(" "),b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],
details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan",
"colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:"autoplay controls crossorigin loop muted playsinline poster preload src height width".split(" ")};F.getDefaultWhiteList=function(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:"autoplay controls crossorigin loop muted preload src".split(" "),b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],
center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align",
"valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:"autoplay controls crossorigin loop muted playsinline poster preload src height width".split(" ")}};F.onTag=function(X,ea,ia){};F.onIgnoreTag=function(X,ea,ia){};F.onTagAttr=function(X,ea,ia){};F.onIgnoreTagAttr=function(X,ea,ia){};F.safeAttrValue=function(X,ea,
ia,la){if(ia=k(ia),"href"===ea||"src"===ea){if("#"===(ia=L.trim(ia)))return"#";if("http://"!==ia.substr(0,7)&&"https://"!==ia.substr(0,8)&&"mailto:"!==ia.substr(0,7)&&"tel:"!==ia.substr(0,4)&&"data:image/"!==ia.substr(0,11)&&"ftp://"!==ia.substr(0,6)&&"./"!==ia.substr(0,2)&&"../"!==ia.substr(0,3)&&"#"!==ia[0]&&"/"!==ia[0])return""}else if("background"===ea){if(aa.lastIndex=0,aa.test(ia))return""}else if("style"===ea){if((R.lastIndex=0,R.test(ia))||(V.lastIndex=0,V.test(ia)&&(aa.lastIndex=0,aa.test(ia))))return"";
!1!==la&&(ia=(la=la||N).process(ia))}return ia=c(ia)};F.escapeHtml=B;F.escapeQuote=v;F.unescapeQuote=t;F.escapeHtmlEntities=l;F.escapeDangerHtml5Entities=p;F.clearNonPrintableCharacter=d;F.friendlyAttrValue=k;F.escapeAttrValue=c;F.onIgnoreTagStripAll=function(){return""};F.StripTagBody=function(X,ea){"function"!=typeof ea&&(ea=function(){});var ia=!Array.isArray(X),la=[],ma=!1;return{onIgnoreTag:function(ua,xa,ta){return ia||-1!==L.indexOf(X,ua)?ta.isClosing?(la.push([!1!==ma?ma:ta.position,ta.position+
10]),ma=!1,"[/removed]"):(ma||(ma=ta.position),"[removed]"):ea(ua,xa,ta)},remove:function(ua){var xa="",ta=0;return L.forEach(la,function(ya){xa+=ua.slice(ta,ya[0]);ta=ya[1]}),xa+=ua.slice(ta)}}};F.stripCommentTag=function(X){return X.replace(ba,"")};F.stripBlankChar=function(X){X=X.split("");return(X=X.filter(function(ea){ea=ea.charCodeAt(0);return 127!==ea&&(!(31>=ea)||10===ea||13===ea)})).join("")};F.cssFilter=N;F.getDefaultCSSWhiteList=K;var ha={},qa=/[^a-zA-Z0-9_:\.\-]/gim;ha.parseTag=function(X,
ea,ia){var la="",ma=0,ua=!1,xa=!1,ta=0,ya=X.length,Ca="",Fa="";ta=0;a:for(;ta<ya;ta++)if(Fa=X.charAt(ta),!1===ua)"\x3c"===Fa&&(ua=ta);else if(!1===xa)if("\x3c"===Fa)la+=ia(X.slice(ma,ta)),ma=ua=ta;else if("\x3e"===Fa)la+=ia(X.slice(ma,ua)),ma=Fa=X.slice(ua,ta+1),Ca=z.spaceIndex(ma),ma=-1===Ca?ma.slice(1,-1):ma.slice(1,Ca+1),Ca=("/"===(ma=z.trim(ma).toLowerCase()).slice(0,1)&&(ma=ma.slice(1)),"/"===ma.slice(-1)&&(ma=ma.slice(0,-1)),ma),la+=ea(ua,la.length,Ca,Fa,"\x3c/"===Fa.slice(0,2)),ma=ta+1,ua=
!1;else{if('"'===Fa||"'"===Fa){Ca=1;for(var Ga=X.charAt(ta-Ca);""===Ga.trim()||"\x3d"===Ga;){if("\x3d"===Ga){xa=Fa;continue a}Ga=X.charAt(ta-++Ca)}}}else Fa===xa&&(xa=!1);return ma<X.length&&(la+=ia(X.substr(ma))),la};ha.parseAttr=function(X,ea){function ia(Ca,Fa){1>(Ca=(Ca=z.trim(Ca)).replace(qa,"").toLowerCase()).length||(Ca=ea(Ca,Fa||""))&&ma.push(Ca)}for(var la=0,ma=[],ua=!1,xa=X.length,ta=0;ta<xa;ta++){var ya=X.charAt(ta);if(!1!==ua||"\x3d"!==ya)if(!1===ua||ta!==la||'"'!==ya&&"'"!==ya||"\x3d"!==
X.charAt(ta-1))/\s|\n|\t/.test(ya)&&((X=X.replace(/\s|\n|\t/g," "),!1===ua)?-1===(ya=b(X,ta))?(ia(z.trim(X.slice(la,ta))),ua=!1,la=ta+1):ta=ya-1:-1===(ya=h(X,ta-1))&&(ia(ua,n(z.trim(X.slice(la,ta)))),ua=!1,la=ta+1));else{if(-1===(ya=X.indexOf(ya,ta+1)))break;ia(ua,z.trim(X.slice(la+1,ya)));ua=!1;la=(ta=ya)+1}else ua=X.slice(la,ta),la=ta+1}return la<X.length&&(!1===ua?ia(X.slice(la)):ia(ua,n(z.trim(X.slice(la))))),z.trim(ma.join(" "))};var va=f.exports.FilterCSS,sa=F,Ba=ha.parseTag,Aa=ha.parseAttr;
m.prototype.process=function(X){if(!(X=(X=X||"").toString()))return"";var ea=this.options,ia=ea.whiteList,la=ea.onTag,ma=ea.onIgnoreTag,ua=ea.onTagAttr,xa=ea.onIgnoreTagAttr,ta=ea.safeAttrValue,ya=ea.escapeHtml,Ca=this.cssFilter;ea.stripBlankChar&&(X=sa.stripBlankChar(X));ea.allowCommentTag||(X=sa.stripCommentTag(X));var Fa=!1;ea.stripIgnoreTagBody&&(Fa=sa.StripTagBody(ea.stripIgnoreTagBody,ma),ma=Fa.onIgnoreTag);X=Ba(X,function(Ga,na,y,J,O){na={sourcePosition:Ga,position:na,isClosing:O,isWhite:ia.hasOwnProperty(y)};
if(null!=(Ga=la(y,J,na)))return Ga;if(na.isWhite){if(na.isClosing)return"\x3c/"+y+"\x3e";Ga=function(Y){var ca=z.spaceIndex(Y);if(-1===ca)return{html:"",closing:"/"===Y[Y.length-2]};ca="/"===(Y=z.trim(Y.slice(ca+1,-1)))[Y.length-1];return ca&&(Y=z.trim(Y.slice(0,-1))),{html:Y,closing:ca}}(J);var U=ia[y];na=Aa(Ga.html,function(Y,ca){var fa,ja=-1!==z.indexOf(U,Y);return null==(fa=ua(y,Y,ca,ja))?ja?(ca=ta(y,Y,ca,Ca))?Y+'\x3d"'+ca+'"':Y:null==(fa=xa(y,Y,ca,ja))?void 0:fa:fa});J="\x3c"+y;return na&&(J+=
" "+na),Ga.closing&&(J+=" /"),J+="\x3e"}return null==(Ga=ma(y,J,na))?ya(J):Ga},ya);return Fa&&(X=Fa.remove(X)),X};return function(X,ea){function ia(ua,xa){return(new la(xa)).process(ua)}var la=m,ma;for(ma in(ea=X.exports=ia).filterXSS=ia,ea.FilterXSS=la,F)ea[ma]=F[ma];for(ma in ha)ea[ma]=ha[ma];"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=X.exports)}(C,C.exports),function(){function X(ea,ia){var la,ma=this;this.arcgisWhiteList=
{a:["href","target","style"],abbr:["title"],img:"src width height border alt style".split(" "),video:"autoplay controls height loop muted poster preload width".split(" "),audio:["autoplay","controls","loop","muted","preload"],source:["media","src","type"],span:["style"],table:"width height cellpadding cellspacing border style".split(" "),div:["style","align"],font:["size","color","style","face"],tr:["height","valign","align","style"],td:"height width valign align colspan rowspan nowrap style".split(" "),
th:"height width valign align colspan rowspan nowrap style".split(" "),p:["style"],b:[],strong:[],i:[],em:[],u:[],br:[],li:[],ul:[],ol:[],hr:[],tbody:[]};this.allowedProtocols="http https mailto iform tel flow lfmobile arcgis-navigator arcgis-appstudio-player arcgis-survey123 arcgis-collector arcgis-workforce arcgis-explorer arcgis-trek2there mspbi comgooglemaps pdfefile pdfehttp pdfehttps boxapp boxemm awb awbs gropen radarscope".split(" ");this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(ua,
xa,ta,ya){return"a"===ua&&"href"===xa||("img"===ua||"source"===ua)&&"src"===xa?ma.sanitizeUrl(ta):C.exports.safeAttrValue(ua,xa,ta,ya)}};ea&&!ia?la=ea:ea&&ia?(la=Object.create(this.arcgisFilterOptions),Object.keys(ea).forEach(function(ua){"whiteList"===ua?la.whiteList=ma._extendObjectOfArrays([ma.arcgisWhiteList,ea.whiteList||{}]):la[ua]=ea[ua]})):(la=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList;this.xssFilterOptions=la;this._xssFilter=new C.exports.FilterXSS(la)}return X.prototype.sanitize=
function(ea,ia){switch(void 0===ia&&(ia={}),typeof ea){case "number":return isNaN(ea)||!isFinite(ea)?null:ea;case "boolean":return ea;case "string":return this._xssFilter.process(ea);case "object":return this._iterateOverObject(ea,ia);default:if(!ia.allowUndefined||void 0!==ea)return null}},X.prototype.sanitizeUrl=function(ea){var ia=this._trim(ea.substring(0,ea.indexOf(":")));return"/"===ea||"#"===ea||"#"===ea[0]||-1<this.allowedProtocols.indexOf(ia.toLowerCase())?C.exports.escapeAttrValue(ea):""},
X.prototype.sanitizeHTMLAttribute=function(ea,ia,la,ma){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(ea,ia,la,ma):C.exports.safeAttrValue(ea,ia,la,ma)},X.prototype.validate=function(ea,ia){void 0===ia&&(ia={});ia=this.sanitize(ea,ia);return{isValid:ea===ia,sanitized:ia}},X.prototype._extendObjectOfArrays=function(ea){var ia={};return ea.forEach(function(la){Object.keys(la).forEach(function(ma){Array.isArray(la[ma])&&Array.isArray(ia[ma])?ia[ma]=
ia[ma].concat(la[ma]):ia[ma]=la[ma]})}),ia},X.prototype._iterateOverObject=function(ea,ia){var la=this;void 0===ia&&(ia={});try{var ma=!1,ua=void 0;if(Array.isArray(ea))ua=ea.reduce(function(xa,ta){var ya=la.validate(ta,ia);return ya.isValid?xa.concat([ta]):(ma=!0,xa.concat([ya.sanitized]))},[]);else{if(!q(ea))return ia.allowUndefined&&void 0===ea?void 0:null;ua=Object.keys(ea).reduce(function(xa,ta){var ya=ea[ta],Ca=la.validate(ya,ia);return Ca.isValid?xa[ta]=ya:(ma=!0,xa[ta]=Ca.sanitized),xa},{})}return ma?
ua:ea}catch(xa){return null}},X.prototype._trim=function(ea){return String.prototype.trim?ea.trim():ea.replace(/(^\s*)|(\s*$)/g,"")},X}()})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,n){function m(){}function g(a){return function(f,e,r,w){return f&&"string"==
typeof e&&f[e]==m?f.on(e.substring(2).toLowerCase(),p.hitch(r,w)):a.apply(B,arguments)}}G.around(B,"connect",g);l.connect&&G.around(l,"connect",g);G=v("dijit._Widget",[b,h,n],{onClick:m,onDblClick:m,onKeyDown:m,onKeyPress:m,onKeyUp:m,onMouseDown:m,onMouseMove:m,onMouseOut:m,onMouseOver:m,onMouseLeave:m,onMouseEnter:m,onMouseUp:m,constructor:function(a){this._toConnect={};for(var f in a)this[f]===m&&(this._toConnect[f.replace(/^on/,"").toLowerCase()]=a[f],delete a[f])},postCreate:function(){this.inherited(arguments);
for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,f){return this[this._onMap(a)]===m?B.connect(this.domNode,a.toLowerCase(),this,f):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,f){l.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(a,f)},attr:function(a,f){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,
arguments):this.get(a)},getDescendants:function(){l.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?d("[widgetId]",this.containerNode).map(c.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});t("dijit-legacy-requires")&&k(0,function(){require(["dijit/_base"])});return G})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e,r,w,H,x,q){function C(u){return function(E){d[E?"set":"remove"](this.domNode,u,E);this._set(u,E)}}n.add("dijit-legacy-requires",!m.isAsync);n.add("dojo-bidi",!1);n("dijit-legacy-requires")&&f(0,function(){G(["dijit/_base/manager"])});var F={};v=l("dijit._WidgetBase",[e,H],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:C("lang"),dir:"",_setDirAttr:C("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(u){this._set("ownerDocument",u)},attributeMap:{},_blankGif:v.blankGif||G.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var u=this.constructor;if(!u._setterAttrs){var E=u.prototype,D=u._setterAttrs=[];u=u._onMap={};for(var M in E.attributeMap)D.push(M);for(M in E)/^on/.test(M)&&(u[M.substring(2).toLowerCase()]=M),/^_set[A-Z](.*)Attr$/.test(M)&&(M=M.charAt(4).toLowerCase()+
M.substr(5,M.length-9),E.attributeMap&&M in E.attributeMap||D.push(M))}},postscript:function(u,E){this.create(u,E)},create:function(u,E){this._introspect();this.srcNodeRef=p.byId(E);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);u&&(this.params=u,g.mixin(this,u));this.postMixInProperties();this.id||(this.id=q.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=
this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=w.body(this.ownerDocument);q.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();if((u=this.srcNodeRef)&&u.parentNode&&this.domNode!==u){u.parentNode.replaceChild(this.domNode,u);var D=!0}this.domNode.setAttribute("widgetId",this.id)}this.postCreate();D&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var u={},E;for(E in this.params||{})u[E]=this._get(E);A.forEach(this.constructor._setterAttrs,
function(D){if(!(D in u)){var M=this._get(D);M&&this.set(D,M)}},this);for(E in u)this.set(E,u[E])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var u=this.baseClass.split(" ");this.isLeftToRight()||(u=u.concat(A.map(u,function(E){return E+"Rtl"})));k.add(this.domNode,u)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,A.forEach(this.getChildren(),function(u){u._started||
u._destroyed||!g.isFunction(u.startup)||(u.startup(),u._started=!0)}))},destroyRecursive:function(u){this._beingDestroyed=!0;this.destroyDescendants(u);this.destroy(u)},destroy:function(u){function E(D){D.destroyRecursive?D.destroyRecursive(u):D.destroy&&D.destroy(u)}this._beingDestroyed=!0;this.uninitialize();A.forEach(this._connects,g.hitch(this,"disconnect"));A.forEach(this._supportingWidgets,E);this.domNode&&A.forEach(q.findWidgets(this.domNode,this.containerNode),E);this.destroyRendering(u);
q.remove(this.id);this._destroyed=!0},destroyRendering:function(u){this.bgIframe&&(this.bgIframe.destroy(u),delete this.bgIframe);this.domNode&&(u?d.remove(this.domNode,"widgetId"):c.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(u||c.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(u){A.forEach(this.getChildren(),function(E){E.destroyRecursive&&E.destroyRecursive(u)})},uninitialize:function(){return!1},_setStyleAttr:function(u){var E=this.domNode;g.isObject(u)?
h.set(E,u):E.style.cssText=E.style.cssText?E.style.cssText+("; "+u):u;this._set("style",u)},_attrToDom:function(u,E,D){D=3<=arguments.length?D:this.attributeMap[u];A.forEach(g.isArray(D)?D:[D],function(M){var I=this[M.node||M||"domNode"];switch(M.type||"attribute"){case "attribute":g.isFunction(E)&&(E=g.hitch(this,E));M=M.attribute?M.attribute:/^on[A-Z][a-zA-Z]*$/.test(u)?u.toLowerCase():u;I.tagName?d.set(I,M,E):I.set(M,E);break;case "innerText":I.innerHTML="";I.appendChild(this.ownerDocument.createTextNode(E));
break;case "textContent":I.textContent=E;break;case "innerHTML":I.innerHTML=E;break;case "class":k.replace(I,E,this[u]);break;case "toggleClass":k.toggle(I,M.className||u,E)}},this)},get:function(u){var E=this._getAttrNames(u);return this[E.g]?this[E.g]():this._get(u)},set:function(u,E){if("object"===typeof u){for(var D in u)this.set(D,u[D]);return this}D=this._getAttrNames(u);var M=this[D.s];if(g.isFunction(M))var I=M.apply(this,Array.prototype.slice.call(arguments,1));else{M=this.focusNode&&!g.isFunction(this.focusNode)?
"focusNode":"domNode";var z=this[M]&&this[M].tagName,K;if((K=z)&&!(K=F[z])){K=this[M];var L={};for(N in K)L[N.toLowerCase()]=!0;K=F[z]=L}var N=K;D=u in this.attributeMap?this.attributeMap[u]:D.s in this?this[D.s]:N&&D.l in N&&"function"!=typeof E||/^aria-|^data-|^role$/.test(u)?M:null;null!=D&&this._attrToDom(u,E,D);this._set(u,E)}return I||this},_attrPairNames:{},_getAttrNames:function(u){var E=this._attrPairNames;if(E[u])return E[u];var D=u.replace(/^[a-z]|-[a-zA-Z]/g,function(M){return M.charAt(M.length-
1).toUpperCase()});return E[u]={n:u+"Node",s:"_set"+D+"Attr",g:"_get"+D+"Attr",l:D.toLowerCase()}},_set:function(u,E){var D=this[u];this[u]=E;!this._created||D===E||D!==D&&E!==E||(this._watchCallbacks&&this._watchCallbacks(u,D,E),this.emit("attrmodified-"+u,{detail:{prevValue:D,newValue:E}}))},_get:function(u){return this[u]},emit:function(u,E,D){E=E||{};void 0===E.bubbles&&(E.bubbles=!0);void 0===E.cancelable&&(E.cancelable=!0);E.detail||(E.detail={});E.detail.widget=this;var M,I=this["on"+u];I&&
(M=I.apply(this,D?D:[E]));this._started&&!this._beingDestroyed&&a.emit(this.domNode,u.toLowerCase(),E);return M},on:function(u,E){var D=this._onMap(u);return D?B.after(this,D,E,!0):this.own(a(this.domNode,u,E))[0]},_onMap:function(u){var E=this.constructor,D=E._onMap;if(!D){D=E._onMap={};for(var M in E.prototype)/^on/.test(M)&&(D[M.replace(/^on/,"").toLowerCase()]=M)}return D["string"==typeof u&&u.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},
getChildren:function(){return this.containerNode?q.findWidgets(this.containerNode):[]},getParent:function(){return q.getEnclosingWidget(this.domNode.parentNode)},connect:function(u,E,D){return this.own(t.connect(u,E,this,D))[0]},disconnect:function(u){u.remove()},subscribe:function(u,E){return this.own(r.subscribe(u,g.hitch(this,E)))[0]},unsubscribe:function(u){u.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():b.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&
"none"!=h.get(this.domNode,"display")},placeAt:function(u,E){var D=!u.tagName&&q.byId(u);!D||!D.addChild||E&&"number"!==typeof E?(u=D&&"domNode"in D?D.containerNode&&!/after|before|replace/.test(E||"")?D.containerNode:D.domNode:p.byId(u,this.ownerDocument),c.place(this.domNode,u,E),!this._started&&(this.getParent()||{})._started&&this.startup()):D.addChild(this,E);return this},defer:function(u,E){var D=setTimeout(g.hitch(this,function(){D&&(D=null,this._destroyed||g.hitch(this,u)())}),E||0);return{remove:function(){D&&
(clearTimeout(D),D=null);return null}}}});n("dojo-bidi")&&v.extend(x);return v})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(G,A,B){return B("dijit.Destroyable",null,{destroy:function(v){this._destroyed=!0},own:function(){var v=["destroyRecursive","destroy","remove"];G.forEach(arguments,function(t){function l(){p.remove();G.forEach(d,function(c){c.remove()})}var p=A.before(this,"destroy",function(c){t[k](c)}),d=[];if(t.then){var k="cancel";
t.then(l,l)}else G.forEach(v,function(c){"function"===typeof t[c]&&(k||(k=c),d.push(A.after(t,c,l,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(G,A,B,v,t,l){G=v("dijit._OnDijitClickMixin",null,{connect:function(p,d,k){return this.inherited(arguments,[p,"ondijitclick"==d?l:d,k])}});G.a11yclick=l;return G})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase",
"dojo/_base/declare","dojo/_base/lang"],function(G,A,B,v){v.extend(A,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return B("dijit._FocusMixin",null,{_focusManager:G})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(G,A,B,v){B(function(){A("highcontrast")&&G.add(v.body(),"dijit_a11y")});return A})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(G,A,B,v,t,l,p){t.add("highcontrast",function(){var d=p.doc.createElement("div");try{d.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(A.blankGif||G.toUrl("./resources/blank.gif"))+'");';p.body().appendChild(d);var k=v.getComputedStyle(d),c=k.backgroundImage;return k.borderTopColor==k.borderRightColor||c&&("none"==c||"url(invalid-url:)"==c)}catch(b){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
b.toString()),!1}finally{8>=t("ie")?d.outerHTML="":p.body().removeChild(d)}});l(function(){t("highcontrast")&&B.add(p.body(),"dj_a11y")});return t})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(G,A,B,v,t,l,p){l.extend(G,{waiRole:"",waiState:""});return t("dijit._Templated",[A,B],{constructor:function(){p.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(d,k){var c=this.inherited(arguments),b=k(d,"waiRole");b&&d.setAttribute("role",b);(b=k(d,"waiState"))&&v.forEach(b.split(/\s*,\s*/),function(h){-1!=h.indexOf("-")&&(h=h.split("-"),d.setAttribute("aria-"+h[0],h[1]))});return c}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(G,A,B,v,t,l,p,d){var k=A("dijit._TemplatedMixin",d,{templateString:null,
templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(c){var b=this.declaredClass,h=this;return p.substitute(c,this,function(n,m){"!"==m.charAt(0)&&(n=v.getObject(m.substr(1),!1,h));if("undefined"==typeof n)throw Error(b+" template:"+m);return null==n?"":"!"==m.charAt(0)?n:this._escapeValue(""+n)},this)},_escapeValue:function(c){return c.replace(/["'<>&]/g,function(b){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[b]})},buildRendering:function(){if(!this._rendered){this.templateString||
(this.templateString=G(this.templatePath,{sanitize:!0}));var c=k.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument);if(v.isString(c)){var b=B.toDom(this._stringRepl(c),this.ownerDocument);if(1!=b.nodeType)throw Error("Invalid template: "+c);}else b=c.cloneNode(!0);this.domNode=b}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(c){var b=this.containerNode;if(c&&b)for(;c.hasChildNodes();)b.appendChild(c.firstChild)}});
k._templateCache={};k.getCachedTemplate=function(c,b,h){var n=k._templateCache,m=c,g=n[m];if(g){try{if(!g.ownerDocument||g.ownerDocument==(h||document))return g}catch(a){}B.destroy(g)}c=p.trim(c);if(b||c.match(/\$\{([^\}]+)\}/g))return n[m]=c;b=B.toDom(c,h);if(1!=b.nodeType)throw Error("Invalid template: "+c);return n[m]=b};l("ie")&&t(window,"unload",function(){var c=k._templateCache,b;for(b in c){var h=c[b];"object"==typeof h&&B.destroy(h);delete c[b]}});return k})},"dojo/cache":function(){define(["./_base/kernel",
"./text"],function(G){return G.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(G,A,B,v,t,l,p,d,k){var c=t.delegate(d,{mouseenter:l.enter,mouseleave:l.leave,keypress:B._keypress}),b;B=v("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);
this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(h){for(var n=h;;)if(1==n.nodeType&&(this._processTemplateNode(n,function(m,g){return m.getAttribute(g)},this._attach)||this.searchContainerNode)&&n.firstChild)n=n.firstChild;else{if(n==h)break;for(;!n.nextSibling;)if(n=n.parentNode,n==h)return;n=n.nextSibling}},_processTemplateNode:function(h,n,m){var g=!0,a=this.attachScope||this,f=n(h,"dojoAttachPoint")||n(h,"data-dojo-attach-point");if(f)for(var e=f.split(/\s*,\s*/);f=
e.shift();)t.isArray(a[f])?a[f].push(h):a[f]=h,g="containerNode"!=f,this._attachPoints.push(f);if(n=n(h,"dojoAttachEvent")||n(h,"data-dojo-attach-event"))for(f=n.split(/\s*,\s*/),e=t.trim;n=f.shift();)if(n){var r=null;-1!=n.indexOf(":")?(r=n.split(":"),n=e(r[0]),r=e(r[1])):n=e(n);r||(r=n);this._attachEvents.push(m(h,n,t.hitch(a,r)))}return g},_attach:function(h,n,m){n=n.replace(/^on/,"").toLowerCase();n="dijitclick"==n?b||(b=G("./a11yclick")):c[n]||n;return p(h,n,m)},_detachTemplateNodes:function(){var h=
this.attachScope||this;A.forEach(this._attachPoints,function(n){delete h[n]});this._attachPoints=[];A.forEach(this._attachEvents,function(n){n.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});t.extend(k,{dojoAttachEvent:"",dojoAttachPoint:""});return B})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(G,A,B,v,t){return B("dijit._WidgetsInTemplateMixin",
null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var l=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);t.parse(l,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(v.hitch(this,function(p){this._startupWidgets=p;for(var d=0;d<p.length;d++)this._processTemplateNode(p[d],
function(k,c){return k[c]},function(k,c,b){return c in k?k.connect(k,c,b):k.on(c,b,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(l,p,d){return p(l,"dojoType")||p(l,"data-dojo-type")?
!0:this.inherited(arguments)},startup:function(){G.forEach(this._startupWidgets,function(l){l&&!l._started&&l.startup&&l.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a){function f(x){return eval("("+x+")")}function e(x){var q=
x._nameCaseMap,C=x.prototype;if(!q||q._extendCnt<w){q=x._nameCaseMap={};for(var F in C)"_"!==F.charAt(0)&&(q[F.toLowerCase()]=F);q._extendCnt=w}return q}function r(x,q){q||(q=G);var C=q._dojoParserCtorMap||(q._dojoParserCtorMap={}),F=x.join();if(!C[F]){for(var u=[],E=0,D=x.length;E<D;E++){var M=x[E];u[u.length]=C[M]=C[M]||B.getObject(M)||~M.indexOf("/")&&q(M)}x=u.shift();C[F]=u.length?x.createSubclass?x.createSubclass(u):x.extend.apply(x,u):x}return C[F]}new Date("X");var w=0;k.after(B,"extend",function(){w++},
!0);var H={_clearCache:function(){w++;_ctorMap={}},_functionFromScript:function(x,q){var C="",F="",u=x.getAttribute(q+"args")||x.getAttribute("args");q=x.getAttribute("with");u=(u||"").split(/\s*,\s*/);q&&q.length&&v.forEach(q.split(/\s*,\s*/),function(E){C+="with("+E+"){";F+="}"});return new Function(u,C+x.innerHTML+F)},instantiate:function(x,q,C){q=q||{};C=C||{};var F=(C.scope||A._scopeName)+"Type",u="data-"+(C.scope||A._scopeName)+"-",E=u+"type",D=u+"mixins",M=[];v.forEach(x,function(I){var z=
F in q?q[F]:I.getAttribute(E)||I.getAttribute(F);if(z){var K=I.getAttribute(D);z=K?[z].concat(K.split(/\s*,\s*/)):[z];M.push({node:I,types:z})}});return this._instantiate(M,q,C)},_instantiate:function(x,q,C,F){function u(E){q._started||C.noStart||v.forEach(E,function(D){"function"!==typeof D.startup||D._started||D.startup()});return E}x=v.map(x,function(E){var D=E.ctor||r(E.types,C.contextRequire);if(!D)throw Error("Unable to resolve constructor for: '"+E.types.join()+"'");return this.construct(D,
E.node,q,C,E.scripts,E.inherited)},this);return F?c(x).then(u):u(x)},construct:function(x,q,C,F,u,E){function D(V){T&&B.setObject(T,V);for(N=0;N<Q.length;N++)k[Q[N].advice||"after"](V,Q[N].method,B.hitch(V,Q[N].func),!0);for(N=0;N<W.length;N++)W[N].call(V);for(N=0;N<aa.length;N++)V.watch(aa[N].prop,aa[N].func);for(N=0;N<R.length;N++)g(V,R[N].event,R[N].func);return V}var M=x&&x.prototype;F=F||{};var I={};F.defaults&&B.mixin(I,F.defaults);E&&B.mixin(I,E);if(n("dom-attributes-explicit"))var z=q.attributes;
else n("dom-attributes-specified-flag")?z=v.filter(q.attributes,function(V){return V.specified}):(E=(/^input$|^img$/i.test(q.nodeName)?q:q.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),z=v.map(E.split(/\s+/),function(V){var ba=V.toLowerCase();return{name:V,value:"LI"==q.nodeName&&"value"==V||"enctype"==ba?q.getAttribute(ba):q.getAttributeNode(ba).value}}));var K=F.scope||A._scopeName;E="data-"+K+"-";var L={};"dojo"!==K&&
(L[E+"props"]="data-dojo-props",L[E+"type"]="data-dojo-type",L[E+"mixins"]="data-dojo-mixins",L[K+"type"]="dojotype",L[E+"id"]="data-dojo-id");var N=0,P;K=[];for(var T,S;P=z[N++];){var Z=P.name,da=Z.toLowerCase();P=P.value;switch(L[da]||da){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":S=P;break;case "data-dojo-id":case "jsid":T=P;break;case "data-dojo-attach-point":case "dojoattachpoint":I.dojoAttachPoint=P;break;case "data-dojo-attach-event":case "dojoattachevent":I.dojoAttachEvent=
P;break;case "class":I["class"]=q.className;break;case "style":I.style=q.style&&q.style.cssText;break;default:if(Z in M||(Z=e(x)[da]||Z),Z in M)switch(typeof M[Z]){case "string":I[Z]=P;break;case "number":I[Z]=P.length?Number(P):NaN;break;case "boolean":I[Z]="false"!=P.toLowerCase();break;case "function":""===P||-1!=P.search(/[^\w\.]+/i)?I[Z]=new Function(P):I[Z]=B.getObject(P,!1)||new Function(P);K.push(Z);break;default:da=M[Z],I[Z]=da&&"length"in da?P?P.split(/\s*,\s*/):[]:da instanceof Date?""==
P?new Date(""):"now"==P?new Date:b.fromISOString(P):da instanceof d?A.baseUrl+P:f(P)}else I[Z]=P}}for(z=0;z<K.length;z++)L=K[z].toLowerCase(),q.removeAttribute(L),q[L]=null;if(S)try{S=f.call(F.propsThis,"{"+S+"}"),B.mixin(I,S)}catch(V){throw Error(V.toString()+" in data-dojo-props\x3d'"+S+"'");}B.mixin(I,C);u||(u=x&&(x._noScript||M._noScript)?[]:m("\x3e script[type^\x3d'dojo/']",q));var Q=[],W=[],aa=[],R=[];if(u)for(N=0;N<u.length;N++)L=u[N],q.removeChild(L),C=L.getAttribute(E+"event")||L.getAttribute("event"),
F=L.getAttribute(E+"prop"),S=L.getAttribute(E+"method"),K=L.getAttribute(E+"advice"),z=L.getAttribute("type"),L=this._functionFromScript(L,E),C?"dojo/connect"==z?Q.push({method:C,func:L}):"dojo/on"==z?R.push({event:C,func:L}):I[C]=L:"dojo/aspect"==z?Q.push({method:S,advice:K,func:L}):"dojo/watch"==z?aa.push({prop:F,func:L}):W.push(L);x=(u=x.markupFactory||M.markupFactory)?u(I,q,x):new x(I,q);return x.then?x.then(D):D(x)},scan:function(x,q){function C(da){if(!da.inherited){da.inherited={};var Q=da.node,
W=C(da.parent);Q={dir:Q.getAttribute("dir")||W.dir,lang:Q.getAttribute("lang")||W.lang,textDir:Q.getAttribute(z)||W.textDir};for(var aa in Q)Q[aa]&&(da.inherited[aa]=Q[aa])}return da.inherited}var F=[],u=[],E={},D=(q.scope||A._scopeName)+"Type",M="data-"+(q.scope||A._scopeName)+"-",I=M+"type",z=M+"textdir";M+="mixins";var K=x.firstChild,L=q.inherited;if(!L){L=function aa(Q,W){return Q.getAttribute&&Q.getAttribute(W)||Q.parentNode&&aa(Q.parentNode,W)};L={dir:L(x,"dir"),lang:L(x,"lang"),textDir:L(x,
z)};for(var N in L)L[N]||delete L[N]}N={inherited:L};for(var P,T;;)if(K)if(1!=K.nodeType)K=K.nextSibling;else if(P&&"script"==K.nodeName.toLowerCase())(L=K.getAttribute("type"))&&/^dojo\/\w/i.test(L)&&P.push(K),K=K.nextSibling;else if(T)K=K.nextSibling;else if(L=K.getAttribute(I)||K.getAttribute(D),x=K.firstChild,L||x&&(3!=x.nodeType||x.nextSibling)){T=null;if(L){var S=K.getAttribute(M);P=S?[L].concat(S.split(/\s*,\s*/)):[L];try{T=r(P,q.contextRequire)}catch(da){}T||v.forEach(P,function(da){~da.indexOf("/")&&
!E[da]&&(E[da]=!0,u[u.length]=da)});S=T&&!T.prototype._noScript?[]:null;N={types:P,ctor:T,parent:N,node:K,scripts:S};N.inherited=C(N);F.push(N)}else N={node:K,scripts:P,parent:N};P=S;T=K.stopParser||T&&T.prototype.stopParser&&!q.template;K=x}else K=K.nextSibling;else{if(!N||!N.node)break;K=N.node.nextSibling;T=!1;N=N.parent;P=N.scripts}var Z=new h;u.length?(n("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+u.join(", ")),(q.contextRequire||G)(u,function(){Z.resolve(v.filter(F,
function(da){if(!da.ctor)try{da.ctor=r(da.types,q.contextRequire)}catch(aa){}for(var Q=da.parent;Q&&!Q.types;)Q=Q.parent;var W=da.ctor&&da.ctor.prototype;da.instantiateChildren=!(W&&W.stopParser&&!q.template);da.instantiate=!Q||Q.instantiate&&Q.instantiateChildren;return da.instantiate}))})):Z.resolve(F);return Z.promise},_require:function(x,q){x=f("{"+x.innerHTML+"}");var C=[],F=[],u=new h;q=q&&q.contextRequire||G;for(var E in x)C.push(E),F.push(x[E]);q(F,function(){for(var D=0;D<C.length;D++)B.setObject(C[D],
arguments[D]);u.resolve(arguments)});return u.promise},_scanAmd:function(x,q){var C=new h,F=C.promise;C.resolve(!0);var u=this;m("script[type\x3d'dojo/require']",x).forEach(function(E){F=F.then(function(){return u._require(E,q)});E.parentNode.removeChild(E)});return F},parse:function(x,q){!x||"string"==typeof x||"nodeType"in x||(q=x,x=q.rootNode);var C=x?l.byId(x):p.body();q=q||{};var F=q.template?{template:!0}:{},u=[],E=this;x=this._scanAmd(C,q).then(function(){return E.scan(C,q)}).then(function(D){return E._instantiate(D,
F,q,!0)}).then(function(D){return u=u.concat(D)}).otherwise(function(D){console.error("dojo/parser::parse() error",D);throw D;});B.mixin(u,x);return u}};A.parser=H;t.parseOnLoad&&a(100,H,"parse");return H})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(G,A){var B={};G.setObject("dojo.date.stamp",B);B.fromISOString=function(v,t){B._isoRegExp||(B._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);
var l=B._isoRegExp.exec(v);v=null;if(l){l.shift();l[1]&&l[1]--;l[6]&&(l[6]*=1E3);t&&(t=new Date(t),A.forEach(A.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(k){return t["get"+k]()}),function(k,c){l[c]=l[c]||k}));v=new Date(l[0]||1970,l[1]||0,l[2]||1,l[3]||0,l[4]||0,l[5]||0,l[6]||0);100>l[0]&&v.setFullYear(l[0]||1970);var p=0,d=l[7]&&l[7].charAt(0);"Z"!=d&&(p=60*(l[8]||0)+(Number(l[9])||0),"-"!=d&&(p*=-1));d&&(p-=v.getTimezoneOffset());p&&v.setTime(v.getTime()+6E4*
p)}return v};B.toISOString=function(v,t){var l=function(c){return 10>c?"0"+c:c};t=t||{};var p=[],d=t.zulu?"getUTC":"get",k="";"time"!=t.selector&&(k=v[d+"FullYear"](),k=["0000".substr((k+"").length)+k,l(v[d+"Month"]()+1),l(v[d+"Date"]())].join("-"));p.push(k);"date"!=t.selector&&(k=[l(v[d+"Hours"]()),l(v[d+"Minutes"]()),l(v[d+"Seconds"]())].join(":"),d=v[d+"Milliseconds"](),t.milliseconds&&(k+="."+(100>d?"0":"")+l(d)),t.zulu?k+="Z":"time"!=t.selector&&(v=v.getTimezoneOffset(),t=Math.abs(v),k+=(0<
v?"-":"+")+l(Math.floor(t/60))+":"+l(t%60)),p.push(k));return p.join("T")};return B})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(G,A,B,v,t,l){return G([l,t],{_onMap:function(p){var d=this.constructor._onMap;d&&d.FINAL||(delete this.constructor._onMap,d=this.registerConnectEvents(),d.FINAL=!0);p=p.toLowerCase();if(d[p])var k=this[d[p].method];else p=this._onCamelCase(p),this[p]&&(k=p);return k},
on:function(p,d){var k=this._onMap(p),c=p.replace(/\-/g,""),b="on"+c in this.domNode;return k||!b?this.inherited(arguments):this.own(v(this.domNode,c,d))[0]},emit:function(p,d,k){var c,b=p.toLowerCase(),h=this.constructor._onMap||this.registerConnectEvents();var n=this[this._onMap(b)];d=d||{};d.target||(d.target=this);if(n&&h&&h[b]){this._onObj2Arr(function(){c=Array.prototype.slice.call(arguments)},h[b].argKeys)(d);var m=A.mixin({},arguments);m[2]=c;m[0]=h[b].name.replace(/^on/,"")}return this.inherited(m||
arguments)}})})},"esri/dijit/Legend/utils":function(){define(["dojo/_base/lang","../../lang","dojo/i18n!../../nls/jsapi"],function(G,A,B){var v=B.widgets.legend;return{getVisualVariableTitle:function(t,l){var p=t.field,d=t.normalizationField,k=!1,c=!1,b=!1;p=G.isFunction(p)?null:p;d=G.isFunction(d)?null:d;if(t.legendOptions&&t.legendOptions.title)var h=t.legendOptions.title;else if(t.valueExpressionTitle)h=t.valueExpressionTitle;else{if(l.renderer&&l.renderer.authoringInfo&&l.renderer.authoringInfo.visualVariables){var n=
l.renderer.authoringInfo.visualVariables;for(t=0;t<n.length;t++){var m=n[t];if("colorInfo"===m.type&&"ratio"===m.style){k=!0;break}else if("colorInfo"===m.type&&"percent"===m.style){c=!0;break}else if("colorInfo"===m.type&&"percentTotal"===m.style){b=!0;break}}}(k=b&&"showRatioPercentTotal"||c&&"showRatioPercent"||k&&"showRatio"||d&&"showNormField"||p&&"showField"||null)&&(h=A.substitute({field:p&&l.getFieldLabel(p),normField:d&&l.getFieldLabel(d)},"showField"===k?"${field}":v[k]))}return h},getRendererTitle:function(t,
l){if(t){if("esri.renderer.ClassBreaksRenderer"===t.declaredClass){var p=t.attributeField;var d=t.normalizationField;var k="percent-of-total"===t.normalizationType}p=G.isFunction(p)?null:p;d=G.isFunction(d)?null:d;if(t.legendOptions&&t.legendOptions.title)var c=t.legendOptions.title;else t.valueExpressionTitle?c=t.valueExpressionTitle:(t=d&&"showNormField"||(k?"showNormPct":null)||p&&"showField"||null)&&(c=A.substitute({field:p&&l.getFieldLabel(p),normField:d&&l.getFieldLabel(d)},"showField"===t?
"${field}":v[t]))}return c}}})},"esri/layers/clustering/GeohashAggregation":function(){define("dojo/has dojo/_base/declare dojo/_base/lang dojo/_base/array ../../kernel ../../Evented ../../geometry/Point ../../geometry/Extent ../../geometry/mathUtils ../../support/expressionUtils ../../core/timerUtils ../support/attributeUtils ./geohashUtils ./statUtils".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,n,m){A=A(l,{loaded:!1,started:!1,map:null,layer:null,lod:null,tolerance:null,clusterMode:null,clusterRadius:null,
sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0,clusters:null,clustersEnabled:!0,statisticInfos:null,defaults:{lod:1,tolerance:0,clusterMode:"auto",clusterRadius:80,sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0},_eventHandles:null,_updateHandle:null,_indexHandle:null,_cellIndex:null,_globalIndex:null,_perfProfile:null,_indexUpdated:!1,_cellSizeScaleFactor:1.5,_extentScaleFactor:1.25,_maxGeohashLength:12,_minClusterRadius:15,_levelChange:!0,_clusterFieldPrefix:"cluster_",
_mapLevelChange:!1,constructor:function(g){this._update=B.hitch(this,this._update);this._indexFeatures=B.hitch(this,this._indexFeatures);this._eventHandles=[];this._globalIndex={numFeatures:null,fullExtent:null,lodStats:null};this._perfProfile={lastIndex:{total:null,numFeatures:0},lastUpdate:{cells:null,clusters:null,total:null}};this.clusters=[];this.map=g.map;this.layer=g.layer;this.setLod(g.lod);this.setTolerance(g.tolerance);this.setClusterMode(g.clusterMode);this.setClusterRadius(g.clusterRadius);
this.setSortEnabled(g.sortEnabled);this.setFilterEnabled(g.filterEnabled);this.setBufferEnabled(g.bufferEnabled);this.setUpdateEnabled(g.updateEnabled);this.setStatisticInfos(g.statisticInfos);this._load();this.loaded?this._startup():this._eventHandles.push(this.on("load",B.hitch(this,this._startup)))},destroy:function(g){this._displayFeatures(!0,g);v.forEach(this._eventHandles,function(a){a.remove()});b.clearTimeout(this._updateHandle);b.clearTimeout(this._indexHandle);this._cellIndex=this._globalIndex=
this._eventHandles=this._updateHandle=this._indexHandle=this.map=this.layer=this.clusters=null},setLod:function(g){var a=this.lod;this.lod=g||this.defaults.lod;a!==this.lod&&this.update()},setTolerance:function(g){var a=this.tolerance;this.tolerance=g||this.defaults.tolerance;a!==this.tolerance&&this.update()},setClusterMode:function(g){var a=this.clusterMode;this.clusterMode=g||this.defaults.clusterMode;this._evalClusterParams();a!==this.clusterMode&&this.update()},setClusterRadius:function(g){var a=
this.clusterRadius;this.clusterRadius=null!=g?g:this.defaults.clusterRadius;this._evalClusterParams();a!==this.clusterRadius&&this.update()},setSortEnabled:function(g){var a=this.sortEnabled;this.sortEnabled=null!=g?!!g:this.defaults.sortEnabled;a!==this.sortEnabled&&this.update()},setFilterEnabled:function(g){var a=this.filterEnabled;this.filterEnabled=null!=g?!!g:this.defaults.filterEnabled;a!==this.filterEnabled&&this.update()},setBufferEnabled:function(g){var a=this.bufferEnabled;this.bufferEnabled=
null!=g?!!g:this.defaults.bufferEnabled;a!==this.bufferEnabled&&this.update()},setUpdateEnabled:function(g){var a=this.updateEnabled;(this.updateEnabled=null!=g?!!g:this.defaults.updateEnabled)&&a!==this.updateEnabled&&(this._mapLevelChange=!0,this.update())},setStatisticInfos:function(g){this.statisticInfos=g||[];this.loaded&&this._applyStatInfos(this.statisticInfos)},update:function(){this.loaded&&null==this._updateHandle&&(this._updateHandle=b.setTimeout(this._update,b.priority.HIGH))},isUpdateScheduled:function(){return null!=
this._updateHandle},index:function(){this.loaded&&null==this._indexHandle&&(this._indexHandle=b.setTimeout(this._indexFeatures,b.priority.HIGH))},getCell:function(g){return this._cellIndex[g.length][g]},getCluster:function(g){var a;v.some(this.clusters,function(f){-1<v.indexOf(f.geohashes,g)&&(a=f);return!!a});return a},getCellsInCluster:function(g){var a=[];v.forEach(g&&g.geohashes,function(f){(f=this.getCell(f))&&a.push(f)},this);return a},getFeaturesInCluster:function(g){var a=[];g=this.getCellsInCluster(g);
v.forEach(g,function(f){Array.prototype.push.apply(a,f.features)});return a},toggleFeatureVisibility:function(g){this.index()},getCurrentLodStats:function(){var g=this._globalIndex.lodStats;return g&&g[this.lod]},getNumFeatures:function(){return this._globalIndex.numFeatures},getFullExtent:function(){var g=this._globalIndex.fullExtent;return g&&Infinity!==g.xmin?new d(g):null},_load:function(){this._displayFeatures(!1);this._checkLoadStatus();this.map.loaded||this._eventHandles.push(this.map.on("load",
B.hitch(this,this._checkLoadStatus)));this.layer.loaded||this._eventHandles.push(this.layer.on("load",B.hitch(this,this._checkLoadStatus)))},_checkLoadStatus:function(){if(this.map.loaded&&this.layer.loaded){if("esriGeometryPoint"!==this.layer.geometryType)var g=Error("GeohashAggregation is supported only for points");else{var a=this.map.spatialReference;a.isWebMercator()||4326===a.wkid||(g=Error("GeohashAggregation is supported only when map spatial reference is WGS84 or WebMercator"))}g?(this.loadError=
g,this.emit("load-error",{error:g})):(this.loaded=!0,this.emit("load"))}},_startup:function(){this._evalUpdateStatus();this.index();this._processExtentChange();this._eventHandles.push(this.layer.on("update-end",B.hitch(this,this.index)),this.layer.on("edits-complete",B.hitch(this,this.index)),this.layer.on("graphics-clear",B.hitch(this,this.index)),this.layer.on("suspend",B.hitch(this,this._evalUpdateStatus)),this.layer.on("resume",B.hitch(this,this._evalUpdateStatus)),this.map.on("extent-change",
B.hitch(this,this._processExtentChange)))},_evalUpdateStatus:function(){this.setUpdateEnabled(!this.layer.suspended)},_processExtentChange:function(g){this._mapLevelChange=!(!g||!g.levelChange);this._evalClusterParams();this.update()},_update:function(){this._updateHandle=null;if(this.updateEnabled){this.emit("update-start");if(this.clustersEnabled){var g=this.map.geographicExtent;if(g){var a=this._getIntersectingCells(g);g=this._getClusters(a.cells,g);this.clusters=g.clusters;this._applyStatInfosToClusters();
a=a.profile;g=g.profile;var f=a.total+g.total;a.total=this._getElapsedTime(a.total);g.total=this._getElapsedTime(g.total);var e=this._perfProfile.lastUpdate={};e.cells=a;e.clusters=g;e.total=this._getElapsedTime(f)}}else this.clusters=[],this._perfProfile.lastUpdate=null;a=this._indexUpdated;this._indexUpdated=!1;g=this._mapLevelChange;this._mapLevelChange=!1;this.emit("update-end",{levelChange:this._levelChange,mapLevelChange:g,indexChange:a})}},_displayFeatures:function(g,a){var f=this.layer;g=
!g;f.suspendGraphics(g);!1!==a&&(g?f.clearNodes():f.redraw())},_indexFeatures:function(){this._indexHandle=null;var g=this._getTime();this._initializeIndexing();var a=0,f=this._globalIndex.fullExtent;v.forEach(this.layer.graphics,function(w){if(w.visible){var H=w.geometry,x=this._getLngLat(H);if(x){var q=H.getCacheValue("_geohash");void 0===q&&(q=n.pointToGeohash(x),H.setCacheValue("_geohash",q||null))}q&&(this._addGeohashToIndex(q,w,x),a++,this._updateExtent(f,x))}},this);this._applyStatInfosToIndex();
this._globalIndex.numFeatures=a;for(var e=this._globalIndex.lodStats,r=1;r<=this._maxGeohashLength;r++)e[r]=this._getLODStats(r,a);this._perfProfile.lastIndex.total=this._getElapsedTime(g,this._getTime());this._perfProfile.lastIndex.numFeatures=a;this._indexUpdated=!0;this.emit("index-complete");this.started||(this.started=!0,this.emit("start"));this.update()},_initializeIndexing:function(){this._globalIndex={numFeatures:0,fullExtent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},lodStats:{}};
for(var g=this._cellIndex=[],a=1;a<=this._maxGeohashLength;a++)g[a]={}},_getLngLat:function(g){if(g){var a=g.getLongitude();g=g.getLatitude();g=null!=a&&null!=g?{x:a,y:g}:null}return g},_addGeohashToIndex:function(g,a,f){for(var e=this._cellIndex,r="",w=0;w<this._maxGeohashLength;w++){r+=g[w];var H=e[r.length],x=H[r];x||(x=H[r]={count:0,centroid:{x:null,y:null},extent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},features:[],geohash:r,statistics:null});this._updateItem(x,1,f,!0);x.features.push(a)}},
_getLODStats:function(g,a){var f=this._cellIndex[g],e=0,r=Infinity,w=-Infinity,H=null,x;for(x in f){var q=f[x];e++;q.count<r&&(r=q.count);q.count>w&&(w=q.count)}0<e&&(H=Number((a/e).toFixed(2)));return{lod:g,count:e,min:Infinity===r?null:r,max:-Infinity===w?null:w,avg:H}},_evalClusterParams:function(){if(this.loaded&&"auto"===this.clusterMode){var g=this._getClusterParams(this.map.getResolutionInMeters(),this.clusterRadius,this._minClusterRadius);this._levelChange=this.lod!==g.lod;this.lod=g.lod;
this.tolerance=g.tolerance}},_getClusterParams:function(g,a,f){a<f&&(a=f);g=Math.ceil(g*a);a=this._getClosestLODRange(g).max;do f=this._getCellSize(a),(f=g>=this._cellSizeScaleFactor*f||1===f)||(a+=1);while(!f);f=g/this._getCellSize(a);return{lod:a,tolerance:g,multiplier:Number(f.toFixed(2))}},_getClosestLODRange:function(g){for(var a,f=this._maxGeohashLength;1<=f;f--)if(this._getCellSize(f)>=g){a=f;break}null==a&&(a=1);g=a+1;g>this._maxGeohashLength&&(g=this._maxGeohashLength);return{min:a,max:g}},
_getCellSize:function(g){g=n.getCellSizeInMeters(g);return Math.ceil(Math.min(g.width,g.height))},_sorter:function(g,a){var f=g.centroid,e=a.centroid;return g.count>a.count?-1:g.count<a.count?1:f.x>e.x?-1:f.x<e.x?1:0},_getIntersectingCells:function(g){var a=this._getTime();this.bufferEnabled&&(g=g.expand(this._extentScaleFactor));var f=n.getIntersecting(g,this.lod,this.bufferEnabled?this.tolerance:0);g=this._getTime();var e=[],r=this.tolerance,w=this.sortEnabled;v.forEach(f,function(H){(H=this.getCell(H))&&
e.push(H)},this);r&&w&&e.sort(this._sorter);f=this._getTime();return{cells:e,profile:{findCells:this._getElapsedTime(a,g),scanAndSortCells:this._getElapsedTime(g,f),total:f-a}}},_getClusters:function(g,a){var f=this._getTime(),e=[],r={},w={findCells:0};v.forEach(g,function(H,x){(H=this._createCluster(H,r,w))&&e.push(H)},this);this._markIntersecting(e,a);this.filterEnabled&&(e=this._getIntersectingClusters(e));g=this._getTime();return{clusters:e,profile:{findCellsInCluster:this._getElapsedTime(w.findCells),
total:g-f}}},_markIntersecting:function(g,a){var f=a.normalize();v.forEach(g,function(e){var r=e.centroid.x,w=e.centroid.y;e.isIntersecting=v.some(f,function(H){return r>=H.xmin&&r<=H.xmax&&w>=H.ymin&&w<=H.ymax})})},_getIntersectingClusters:function(g){return v.filter(g,function(a){return a.isIntersecting})},_createCluster:function(g,a,f){if(!a[g.geohash]){var e=[{cell:g,distance:0}];if(this.tolerance){var r=this._getTime(),w=n.getNeighborsWithinDistance(g.centroid,this.lod,this.tolerance);f.findCells+=
this._getTime()-r;v.forEach(w,function(H){if(H!==g.geohash&&(H=this.getCell(H))){var x=this._calculateDistance(g.centroid,H.centroid);x<=this.tolerance&&e.push({cell:H,distance:x})}},this)}return this._mergeCells(e,a)}},_calculateDistance:function(g,a){return k.getLength(n.geographicToWebMercator(g),n.geographicToWebMercator(a))},_mergeCells:function(g,a){var f=this._initializeCluster({},g[0].cell.geohash);v.forEach(g,function(e){var r=e.cell,w=r.geohash;e=e.distance;var H=a[w];if(H)if(e<H.distance)this._removeCellFromCluster(w,
a);else return;a[w]={cluster:f,distance:e};this._updateItem(f,r.count,r.centroid);f.geohashes.push(w)},this);return f},_removeCellFromCluster:function(g,a){var f=a[g].cluster;delete a[g];g=v.indexOf(f.geohashes,g);-1<g&&f.geohashes.splice(g,1);this._reevaluateCluster(f)},_reevaluateCluster:function(g){var a=g.geohashes;g=this._initializeCluster(g,g.primary);v.forEach(a,function(f){var e=this.getCell(f);e&&(this._updateItem(g,e.count,e.centroid),g.geohashes.push(f))},this)},_initializeCluster:function(g,
a){g.count=0;g.centroid=new p(null,null);g.geohashes=[];g.primary=a;g.statistics=null;return g},_applyStatInfos:function(g){g=this._getValidStatInfos(g);this._applyStatInfosToIndex(g);this._applyStatInfosToClusters(g)},_getValidStatInfos:function(g){var a=[];v.forEach(g,function(f){var e=f.attributeInfo;f=f.statisticType;var r="angle"===e.attributeType;if(m.isSupportedStatisticType(f)&&(!r||"avg"===f)){var w="arithmetic"===e.rotationType;a.push({attributeCache:h.createAttributeCache(e,"type"===f),
identifier:m.getStatisticId(e,f),statFunctions:m.getStatisticFunctions(f),isAngular:r,isDate:"date"===e.attributeType,isArithmetic:w})}});return a},_applyStatInfosToIndex:function(g){g=g||this._getValidStatInfos(this.statisticInfos);var a=this._cellIndex;if(a)for(var f=1;f<=this._maxGeohashLength;f++){var e=a[f],r;for(r in e)this._applyStatInfosToCell(e[r],g)}},_applyStatInfosToCell:function(g,a){var f=this._initializeStats(g,a);v.forEach(g.features,function(e){this._calcFeatureStats(e,a,f)},this);
this._summarizeStats(g,f,a)},_calcFeatureStats:function(g,a,f){g.attributes&&v.forEach(a,function(e){var r=f[e.identifier],w=e.attributeCache;w=w?g._getDataValue(w.attributeInfo,w,c):null;e.statFunctions.updateCellStat(r,w,e)})},_applyStatInfosToClusters:function(g){g=g||this._getValidStatInfos(this.statisticInfos);var a=this._clusterFieldPrefix;v.forEach(this.clusters,function(f){var e=this._initializeStats(f,g);v.forEach(this.getCellsInCluster(f),function(r){this._calcCellStats(r,g,e)},this);this._summarizeStats(f,
e,g,a);f.attributes[a+"id"]=f.primary},this)},_calcCellStats:function(g,a,f){var e=g.statistics;v.forEach(a,function(r){var w=r.identifier;r.statFunctions.updateClusterStat(f[w],e[w],r)})},_initializeStats:function(g,a){var f=g.statistics={};v.forEach(a,function(e){f[e.identifier]=e.statFunctions.initialize(e)});return f},_summarizeStats:function(g,a,f,e){var r=g.attributes={};e=e||"";r[e+"count"]=g.count;v.forEach(f,function(w){var H=this._getStatFieldName(w,e);r[H]=w.statFunctions.summarize(a[w.identifier],
w)},this)},_getStatFieldName:function(g,a){return(a||"")+g.identifier},_updateItem:function(g,a,f,e){var r=f.y,w=g.centroid,H=g.count;w.x=(H*w.x+a*f.x)/(H+a);w.y=(H*w.y+a*r)/(H+a);g.count+=a;e&&this._updateExtent(g.extent,f)},_updateExtent:function(g,a){var f=a.x;a=a.y;f<g.xmin&&(g.xmin=f);f>g.xmax&&(g.xmax=f);a<g.ymin&&(g.ymin=a);a>g.ymax&&(g.ymax=a)},_getTime:function(){return window.performance?window.performance.now():(new Date).getTime()},_getElapsedTime:function(g,a){g=null!=g&&null!=a?a-g:
g;if(null!=g){var f="millisecond";1E3<=g&&(g/=1E3,f="second",60<=g&&(g/=60,f="minute"));f={value:Number(g.toFixed(2)),unit:f}}return f}});G("extend-esri")&&B.setObject("layers.clustering.GeohashAggregation",A,t);return A})},"esri/core/timerUtils":function(){define([],function(){function G(l){var p,d=l.length;for(p=0;p<d;p++)l[p]()}var A={LOW:1,HIGH:2},B,v={};v[A.LOW]=[];v[A.HIGH]=[];var t=function(){clearTimeout(B);B=null;var l=v[A.HIGH];v[A.HIGH]=[];G(l);l=v[A.LOW];v[A.LOW]=[];G(l)};return{priority:A,
callbackQueue:v,setTimeout:function(l,p){l=[p,v[p].push(l)-1];B||(B=setTimeout(t,0));return l},clearTimeout:function(l){l&&v[l[0]].splice(l[1],1)}}})},"esri/layers/clustering/geohashUtils":function(){define("dojo/has dojo/string dojo/_base/lang dojo/_base/array ../../kernel ../../geometry/Point ../../geometry/Extent ../../SpatialReference ../../geometry/webMercatorUtils".split(" "),function(G,A,B,v,t,l,p,d,k){function c(I){var z=I.spatialReference;if(!z)return{x:I.x,y:I.y};var K=z.isWebMercator(),
L;4326===z.wkid?L={x:I.x,y:I.y}:K&&(L={x:I.getLongitude(),y:I.getLatitude()});return L}function b(I){var z=I.spatialReference,K=!(!z||!z.isWebMercator()),L;z&&4326===z.wkid?L=new p(I.toJson()):K&&(L=k.webMercatorToGeographic(I,!0));return L}function h(I,z){z.x=l.prototype._normalizeX(I.x,d.prototype._info[4326]);z.y=I.y;return z}function n(I){I=D.decimals[I].toString(2);return A.pad(I,D.bitsPerBase32Char,"0")}function m(I,z){z=z.slice();z.splice(1,0,0);for(var K=z[0],L=z[2],N=0;N<I.length;N++){Number(I[N])?
z[0]=z[1]:z[2]=z[1];var P=z[1]=(z[0]+z[2])/2;K=z[0];L=z[2]}return{value:P,min:K,max:L}}function g(I,z,K){var L=[];z=z.slice();z.splice(1,0,0);for(var N=z[0],P=z[2],T=0;T<K;T++)I>=z[1]?(z[0]=z[1],N=1):(z[2]=z[1],N=0),z[1]=(z[0]+z[2])/2,L.push(N),N=z[0],P=z[2];return{value:L.join(""),min:N,max:P}}function a(I){var z=I*D.bitsPerBase32Char;0===z%2?I=z/=2:(I=(z+1)/2,z-=I);return{lon:I,lat:z}}function f(I){var z=0;I=I.split("").reverse().join("");for(var K=0;K<I.length;K++)z+=Number(I[K])*Math.pow(2,K);
return D.base32[z]}function e(I,z){var K={x:I.xmin,y:I.ymax},L={x:I.xmax,y:I.ymin},N={x:I.xmax,y:I.ymax};return{sw:M.pointToGeohash({x:I.xmin,y:I.ymin},z),nw:M.pointToGeohash(K,z),se:M.pointToGeohash(L,z),ne:M.pointToGeohash(N,z)}}function r(I,z,K,L,N){var P=I;do N[P]||(N[P]=!0,L.push(P)),(I=P===z)||(P=E(P,K));while(!I)}function w(I,z,K,L){var N=e(I,z);I=[];r(N.sw,N.nw,"n",I,{});z=[];r(N.se,N.ne,"n",z,{});for(N=0;N<I.length;N++)r(I[N],z[N],"e",K,L)}function H(I){return v.filter(I,function(z){return 180===
z.xmax?!0:!1})[0]}function x(I){return v.filter(I,function(z){return-180===z.xmin?!0:!1})[0]}function q(I,z,K,L){var N=M.geographicToWebMercator(I);I={x:N.x-z,y:N.y-z};z=M.webMercatorToGeographic({x:N.x+z,y:N.y+z},!0);I=M.webMercatorToGeographic(I,!0);return new p(null!=K?K:I.x,I.y,null!=L?L:z.x,z.y)}function C(I,z,K,L){I=e(I,z);var N,P;"min"===L?P=180:"max"===L&&(N=-180);var T=N;L=P;var S=M.geohashToCell(I.sw).extent;z=M.geohashToCell(I.ne).extent;I=null!=T?T:S.xmin;S=S.ymin;L=null!=L?L:z.xmax;z=
z.ymax;I=q({x:I,y:S},K,N,P);K=q({x:L,y:z},K,N,P);return new p(I.xmin,I.ymin,K.xmax,K.ymax)}function F(I,z,K){var L=I,N=0;do N++,(I=L===z)||(L=E(L,K));while(!I);return N}function u(I,z){I=e(I,z);z=F(I.nw,I.ne,"e");return{rows:F(I.nw,I.sw,"s"),cols:z}}function E(I,z){var K=I.length%2,L=I.slice(-1),N=D.decimals[L];I=I.slice(0,-1);-1!=D.borders[z][K].indexOf(L)&&I&&(I=E(I,z));return I+D.neighbors[z][K][N]}var D={base32:"0123456789bcdefghjkmnpqrstuvwxyz",decimals:function(){for(var I={},z=0;32>z;z++)I["0123456789bcdefghjkmnpqrstuvwxyz"[z]]=
z;return I}(),neighbors:{n:[null,"238967debc01fg45kmstqrwxuvhjyznp"],s:[null,"bc01fg45238967deuvhjyznpkmstqrwx"],e:[null,"14365h7k9dcfesgujnmqp0r2twvyx8zb"],w:[null,"p0r21436x8zb9dcf5h7kjnmqesgutwvy"]},borders:{n:[null,"bcfguvyz"],s:[null,"0145hjnp"],e:[null,"prxz"],w:[null,"028b"]},bitsPerBase32Char:5,maxGeohashLength:12,longitudeRange:[-180,180],latitudeRange:[-90,90]};D.neighbors.n[0]="14365h7k9dcfesgujnmqp0r2twvyx8zb";D.neighbors.s[0]="p0r21436x8zb9dcf5h7kjnmqesgutwvy";D.neighbors.e[0]="238967debc01fg45kmstqrwxuvhjyznp";
D.neighbors.w[0]="bc01fg45238967deuvhjyznpkmstqrwx";D.borders.n[0]="prxz";D.borders.s[0]="028b";D.borders.e[0]="bcfguvyz";D.borders.w[0]="0145hjnp";var M={geographicToWebMercator:function(I){I=l.lngLatToXY(I.x,I.y);return{x:I[0],y:I[1]}},webMercatorToGeographic:function(I,z){I=l.xyToLngLat(I.x,I.y,z);return{x:I[0],y:I[1]}},geohashToCell:function(I){var z;var K=[];for(z=0;z<I.length;z++)K.push(n(I[z]));K=K.join("");z=[];var L=[];for(var N=0;N<K.length;N++)0===N%2?z.push(K[N]):L.push(K[N]);z=z.join("");
L=L.join("");z=[z,L];K=m(z[0],D.longitudeRange);N=m(z[1],D.latitudeRange);z=K.value;L=N.value;return{point:{x:z,y:L},extent:{xmin:K.min,xmax:K.max,ymin:N.min,ymax:N.max},geohash:I}},pointToCell:function(I,z){z=z||D.maxGeohashLength;if(I=c(I)){I=h(I,I);var K=a(z);z=g(I.x,D.longitudeRange,K.lon);var L=g(I.y,D.latitudeRange,K.lat);K=z.value;var N=L.value;z={xmin:z.min,xmax:z.max,ymin:L.min,ymax:L.max};L=[];for(var P=Math.ceil((K.length+N.length)/D.bitsPerBase32Char),T=0,S=0,Z=0;Z<P*D.bitsPerBase32Char;Z++){var da=
0===Z%2?K[T++]:N[S++];null==da&&(da=0);L.push(da)}K=L.join("");N=D.bitsPerBase32Char;L=K.length/N;P=[];for(T=0;T<L;T++)S=K.substr(T*N,N),P.push(f(S));K=P.join("");return{point:I,extent:z,geohash:K}}},geohashToPoint:function(I){return M.geohashToCell(I).point},pointToGeohash:function(I,z){return(I=M.pointToCell(I,z))&&I.geohash},getCells:function(I){return v.map(I,function(z){return M.geohashToCell(z)})},getCellSize:function(I){var z=D.longitudeRange,K=D.latitudeRange;z=Math.abs(z[1]-z[0]);K=Math.abs(K[1]-
K[0]);I=a(I||1);return{width:z/Math.pow(2,I.lon),height:K/Math.pow(2,I.lat)}},getCellSizeInMeters:function(I){I=M.getCellSize(I);var z=k.metersPerDegree;I.width*=z;I.height*=z;return I},getIntersecting:function(I,z,K){z=z||1;K=K||0;var L=[],N=b(I);if(N){K&&(N=M.expandExtent(I,z,K));I=N.normalize();var P={};v.forEach(I,function(T){w(T,z,L,P)})}return L},countIntersecting:function(I,z,K){z=z||1;K=K||0;var L=0,N=b(I);if(N){K&&(N=M.expandExtent(I,z,K));I=N.normalize();if(2===I.length){L=H(I);N=x(I);K=
u(L,z);var P=u(N,z);I=K.rows;K=K.cols+P.cols;L={x:L.xmin,y:L.ymax};N={x:N.xmax,y:N.ymax};L=h(L,{});N=h(N,{});L=M.pointToGeohash(L,z);z=M.pointToGeohash(N,z);L===z&&K--;z={rows:I,cols:K}}else z=u(I[0],z);L=z.cols*z.rows}return L},getChildren:function(I){I=I||"";var z=[],K;for(K in D.decimals)z.push(I+K);return z},getNeighbors:function(I){var z=E(I,"n"),K=E(I,"s");return[z,E(z,"e"),E(z,"w"),K,E(K,"e"),E(K,"w"),E(I,"e"),E(I,"w")]},getExtentFromDistance:function(I,z){z=z||1E3;var K;(I=c(I))&&(K=q(I,z));
return K},expandExtent:function(I,z,K){z=z||1;K=K||0;if(I=b(I)){if(K){I=I.normalize();if(2===I.length){var L=K;K=H(I);I=x(I);K=C(K,z,L,"min");I=C(I,z,L,"max");360<=K.getWidth()+I.getWidth()?(z=-180,I=180):(z=K.xmin,I=I.xmax);return new p(z,K.ymin,I,K.ymax)}return C(I[0],z,K)}return I}},getNeighborsWithinDistance:function(I,z,K){K=K||1E3;z=z||1;var L=[];if(I=c(I)){K=q(I,K).normalize();var N={};v.forEach(K,function(P){w(P,z,L,N)})}return L}};G("extend-esri")&&B.setObject("layers.clustering.geohashUtils",
M,t);return M})},"esri/layers/clustering/statUtils":function(){define(["dojo/_base/lang","../support/attributeUtils"],function(G,A){function B(l){return"number"===typeof l&&!isNaN(l)&&Infinity!==l&&-Infinity!==l}var v={sum:{initialize:function(){return{count:0,sum:null}},updateCellStat:function(l,p){B(p)&&(l.count++,l.sum+=p)},updateClusterStat:function(l,p){p.count&&(l.count+=p.count,l.sum+=p.sum)},summarize:function(l){return l.sum}},avg:{initialize:function(l){return{count:0,sum:null,avg:null,
sum_cosine:null,sum_sine:null}},updateCellStat:function(l,p,d){B(p)&&(l.count++,d.isAngular?(d.isArithmetic||(p=-1*p+90),l.sum_cosine+=Math.cos(p*Math.PI/180),l.sum_sine+=Math.sin(p*Math.PI/180)):l.sum+=p)},updateClusterStat:function(l,p,d){p.count&&(l.count+=p.count,d.isAngular?(l.sum_cosine+=p.sum_cosine,l.sum_sine+=p.sum_sine):l.sum+=p.sum)},summarize:function(l,p){if(0<l.count){var d=l.count;p.isAngular?(d=180*Math.atan2(l.sum_sine/d,l.sum_cosine/d)/Math.PI,p.isArithmetic||(d=-1*(d-90)),l.avg=
0>d?d+360:d):(l.avg=l.sum/d,p.isDate&&(l.avg=Math.ceil(l.avg)))}return l.avg}},type:{initialize:function(){return{uvInfos:{}}},updateCellStat:function(l,p){if(null==p||""===p||"string"===typeof p&&""===G.trim(p))p=null;l=l.uvInfos;null==l[p]?l[p]={count:1,value:p}:l[p].count++},updateClusterStat:function(l,p){l=l.uvInfos;p=p.uvInfos;for(var d in p){var k=p[d];null==l[d]?l[d]={count:k.count,value:k.value}:l[d].count+=k.count}},summarize:function(l){l=l.uvInfos;var p,d=-Infinity;for(p in l){var k=l[p];
if(k.count>d){d=k.count;var c=k.value}else k.count===d&&(c=null)}return c}}},t={isSupportedStatisticType:function(l){return v.hasOwnProperty(l)},getStatisticFunctions:function(l){return v[l]},getStatisticId:function(l,p){var d=A.getAttributeIdSource(l);l=d&&A.getAttributeId(d)||l.field;return p+"_"+l},getClusterField:function(l,p){return"cluster_"+t.getStatisticId(l,p)},getStatisticHash:function(l,p){p=[t.getStatisticId(l,p)];l.attributeType&&p.push(l.attributeType.toLowerCase());l.rotationType&&
p.push(l.rotationType.toLowerCase());return p.join("_")}};return t})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(G,A,B,v,t){G=G([t],{declaredClass:"esri.toolbars._Toolbar",constructor:function(l){this.map=l},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},
_deactivateMapTools:function(l,p,d,k){var c=this.map;l&&(this._mapNavState={isDoubleClickZoom:c.isDoubleClickZoom,isClickRecenter:c.isClickRecenter,isPan:c.isPan,isRubberBandZoom:c.isRubberBandZoom,isKeyboardNavigation:c.isKeyboardNavigation,isScrollWheelZoom:c.isScrollWheelZoom},c.disableDoubleClickZoom(),c.disableClickRecenter(),c.disablePan(),c.disableRubberBandZoom(),c.disableKeyboardNavigation());p&&c.hideZoomSlider();d&&c.hidePanArrows();k&&c.graphics.disableMouseEvents()},_activateMapTools:function(l,
p,d,k){var c=this.map,b=this._mapNavState;l&&b&&(b.isDoubleClickZoom&&c.enableDoubleClickZoom(),b.isClickRecenter&&c.enableClickRecenter(),b.isPan&&c.enablePan(),b.isRubberBandZoom&&c.enableRubberBandZoom(),b.isKeyboardNavigation&&c.enableKeyboardNavigation(),b.isScrollWheelZoom&&c.enableScrollWheelZoom());p&&c.showZoomSlider();d&&c.showPanArrows();k&&c.graphics.enableMouseEvents()},_deactivateScrollWheel:function(){var l=this.map;this._scrollWheelState={isScrollWheelZoom:l.isScrollWheelZoom,isScrollWheelPan:l.isScrollWheelPan};
l.disableScrollWheelZoom();l.disableScrollWheelPan()},_activateScrollWheel:function(){var l=this.map,p=this._scrollWheelState;p&&(p.isScrollWheelZoom&&l.enableScrollWheelZoom(),p.isScrollWheelPan&&l.enableScrollWheelPan())}});B("extend-esri")&&A.setObject("toolbars._Toolbar",G,v);return G})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e,r,w,H,x,q,C,F,u){var E=G(g,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(D,M){this.markerSymbol=new a(a.STYLE_SOLID,10,new f(f.STYLE_SOLID,new t([255,0,0]),2),new t([0,0,0,.25]));this.lineSymbol=new f(f.STYLE_SOLID,new t([255,0,0]),2);this.fillSymbol=new e(e.STYLE_SOLID,new f(f.STYLE_SOLID,new t([255,0,0]),2),new t([0,0,0,.25]));this._points=[];this._mouse=!p("esri-touch")&&!p("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=A.mixin(A.mixin({},this._defaultOptions),M||{});if(d("ios")||d("android"))this._options.showTooltips=!1;this._onKeyDownHandler=A.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=A.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=A.hitch(this,this._onMouseUpHandler);this._onClickHandler=A.hitch(this,this._onClickHandler);this._onMouseMoveHandler=A.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=A.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=A.hitch(this,this._onDblClickHandler);this._updateTooltip=A.hitch(this,this._updateTooltip);this._hideTooltip=A.hitch(this,this._hideTooltip);this._redrawGraphic=A.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(D){this.respectDrawingVertexOrder=D},setMarkerSymbol:function(D){this.markerSymbol=D},setLineSymbol:function(D){this.lineSymbol=D},
setFillSymbol:function(D){this.fillSymbol=D},activate:function(D,M){this._geometryType&&this.deactivate();var I=this.map,z=v.connect,K=E;this._options=A.mixin(A.mixin({},this._options),M||{});I.navigationManager.setImmediateClick(!1);switch(D){case K.ARROW:case K.LEFT_ARROW:case K.RIGHT_ARROW:case K.UP_ARROW:case K.DOWN_ARROW:case K.TRIANGLE:case K.CIRCLE:case K.ELLIPSE:case K.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=z(I,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=z(I,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=z(I,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=z(I,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=z(I,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=z(I,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=z(I,"onMouseDragEnd",this._onMouseUpHandler));p("esri-touch")&&(this._onMouseDownHandler2_connect=
z(I,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=z(I,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=z(I,"onSwipeEnd",this._onMouseUpHandler));break;case K.POINT:this._onClickHandler_connect=z(I,"onClick",this._onClickHandler);break;case K.LINE:case K.EXTENT:case K.FREEHAND_POLYLINE:case K.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=z(I,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=
z(I,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=z(I,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=z(I,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=z(I,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=z(I,"onMouseDragEnd",this._onMouseUpHandler));p("esri-touch")&&(this._onMouseDownHandler2_connect=z(I,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=z(I,"onSwipeMove",
this._onMouseDragHandler),this._onMouseUpHandler2_connect=z(I,"onSwipeEnd",this._onMouseUpHandler));break;case K.POLYLINE:case K.POLYGON:case K.MULTI_POINT:I.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=z(I,"onClick",this._onClickHandler);this._onDblClickHandler_connect=z(I,"onDblClick",this._onDblClickHandler);this._dblClickZoom=I.isDoubleClickZoom;I.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+D);return}this._onKeyDown_connect=z(I,"onKeyDown",
this._onKeyDownHandler);this._redrawConnect=z(I,"onExtentChange",this._redrawGraphic);this._geometryType=D;this._toggleTooltip(!0);I.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(I.snappingManager._startSelectionLayerQuery(),I.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var D=this.map;this._clear();var M=v.disconnect;M(this._onMouseMoveHandler_connect);M(this._onMouseDownHandler_connect);M(this._onMouseDragHandler_connect);
M(this._onMouseUpHandler_connect);M(this._onMouseDownHandler2_connect);M(this._onMouseDragHandler2_connect);M(this._onMouseUpHandler2_connect);M(this._onClickHandler_connect);M(this._onDblClickHandler_connect);M(this._onKeyDown_connect);M(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=this._onMouseUpHandler2_connect=this._onClickHandler_connect=
this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;D.snappingManager&&(D.snappingManager._stopSelectionLayerQuery(),D.snappingManager._killOffSnapping());switch(this._geometryType){case E.CIRCLE:case E.ELLIPSE:case E.TRIANGLE:case E.ARROW:case E.LEFT_ARROW:case E.RIGHT_ARROW:case E.UP_ARROW:case E.DOWN_ARROW:case E.RECTANGLE:case E.LINE:case E.EXTENT:case E.FREEHAND_POLYLINE:case E.FREEHAND_POLYGON:this._activateMapTools(!0,!1,!1,!0);break;case E.POLYLINE:case E.POLYGON:case E.MULTI_POINT:this._dblClickZoom&&
D.enableDoubleClickZoom()}M=this._geometryType;this._geometryType=null;D.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(M)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._graphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},finishDrawing:function(){var D=this._points,M=this.map.spatialReference,I=E;D=D.slice(0,D.length);switch(this._geometryType){case I.POLYLINE:if(!this._graphic||2>
D.length)return;var z=new x(M);z.addPath([].concat(D));break;case I.POLYGON:if(!this._graphic||3>D.length)return;z=new q(M);D=[].concat(D,[D[0].offset(0,0)]);q.prototype.isClockwise(D)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),D.reverse());z.addRing(D);break;case I.MULTI_POINT:z=new C(M),B.forEach(D,function(K){z.addPoint(K)})}v.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);
this._drawEnd(z)},_drawEnd:function(D){if(D){var M=this.map.spatialReference,I;this.onDrawEnd(D);M&&(M.isWebMercator()?I=H.webMercatorToGeographic(D,!0):4326===M.wkid&&(I=w.fromJson(D.toJson())));this.onDrawComplete({geometry:D,geographicGeometry:I})}},_normalizeRect:function(D,M,I){var z=D.x;D=D.y;var K=M.x;M=M.y;return{x:Math.min(z,K),y:Math.max(D,M),width:Math.abs(z-K),height:Math.abs(D-M),spatialReference:I}},_onMouseDownHandler:function(D){this._dragged=!1;if(this.map.snappingManager)var M=this.map.snappingManager._snappingPoint;
var I=M||D.mapPoint,z=E;M=this.map;var K=M.spatialReference;this._points.push(I.offset(0,0));switch(this._geometryType){case z.LINE:this._graphic=M.graphics.add(new r(new x({paths:[[[I.x,I.y],[I.x,I.y]]],spatialReference:K}),this.lineSymbol),!0);M.snappingManager&&M.snappingManager._setGraphic(this._graphic);break;case z.FREEHAND_POLYLINE:this._oldPoint=D.screenPoint;I=new x(K);I.addPath(this._points);this._graphic=M.graphics.add(new r(I,this.lineSymbol),!0);M.snappingManager&&M.snappingManager._setGraphic(this._graphic);
break;case z.CIRCLE:case z.ELLIPSE:case z.TRIANGLE:case z.ARROW:case z.LEFT_ARROW:case z.RIGHT_ARROW:case z.UP_ARROW:case z.DOWN_ARROW:case z.RECTANGLE:case z.FREEHAND_POLYGON:this._oldPoint=D.screenPoint,I=new q(K),I.addRing(this._points),this._graphic=M.graphics.add(new r(I,this.fillSymbol),!0),M.snappingManager&&M.snappingManager._setGraphic(this._graphic)}p("esri-touch")&&D.preventDefault();if(1===this._points.length)this.onDrawStart()},_onMouseMoveHandler:function(D){if(this.map.snappingManager)var M=
this.map.snappingManager._snappingPoint;D=M||D.mapPoint;M=this._graphic.geometry;switch(this._geometryType){case E.POLYLINE:case E.POLYGON:var I=this._points.length,z=!!M.getPoint(0,I);D=D.offset(0,0);z?M.setPoint(0,I,D):M.insertPoint(0,I,D);this._graphic.setGeometry(M)}},_onMouseDragHandler:function(D){if(this._graphic||this._points.length)if(p("esri-touch")&&!this._points.length)D.preventDefault();else{this._dragged=!0;if(this.map.snappingManager)var M=this.map.snappingManager._snappingPoint;var I=
this._points[0],z=M||D.mapPoint,K=this.map,L=K.spatialReference;M=this._graphic;var N=E,P=K.toScreen(I),T=K.toScreen(z),S=[];S=T.x-P.x;T=T.y-P.y;var Z=Math.sqrt(S*S+T*T);switch(this._geometryType){case N.CIRCLE:this._hideTooltip();M.geometry=q.createCircle({center:P,r:Z,numberOfPoints:60,map:K});M.setGeometry(M.geometry);break;case N.ELLIPSE:this._hideTooltip();M.geometry=q.createEllipse({center:P,longAxis:S,shortAxis:T,numberOfPoints:60,map:K});M.setGeometry(M.geometry);break;case N.TRIANGLE:this._hideTooltip();
S=[[0,-Z],[.8660254037844386*Z,.5*Z],[-.8660254037844386*Z,.5*Z],[0,-Z]];M.geometry=this._toPolygon(S,P.x,P.y);M.setGeometry(M.geometry);break;case N.ARROW:this._hideTooltip();I=T/Z;K=S/Z;z=.25*K*Z;L=.25*Z/(T/S);Z*=.25*I;S=[[S,T],[S-z*(1+24/L),T+24*K-Z],[S-z*(1+12/L),T+12*K-Z],[-12*I,12*K],[12*I,-12*K],[S-z*(1-12/L),T-12*K-Z],[S-z*(1-24/L),T-24*K-Z],[S,T]];M.geometry=this._toPolygon(S,P.x,P.y);M.setGeometry(M.geometry);break;case N.LEFT_ARROW:this._hideTooltip();S=0>=S?[[S,0],[.75*S,T],[.75*S,.5*
T],[0,.5*T],[0,-.5*T],[.75*S,-.5*T],[.75*S,-T],[S,0]]:[[0,0],[.25*S,T],[.25*S,.5*T],[S,.5*T],[S,-.5*T],[.25*S,-.5*T],[.25*S,-T],[0,0]];M.geometry=this._toPolygon(S,P.x,P.y);M.setGeometry(M.geometry);break;case N.RIGHT_ARROW:this._hideTooltip();S=0<=S?[[S,0],[.75*S,T],[.75*S,.5*T],[0,.5*T],[0,-.5*T],[.75*S,-.5*T],[.75*S,-T],[S,0]]:[[0,0],[.25*S,T],[.25*S,.5*T],[S,.5*T],[S,-.5*T],[.25*S,-.5*T],[.25*S,-T],[0,0]];M.geometry=this._toPolygon(S,P.x,P.y);M.setGeometry(M.geometry);break;case N.UP_ARROW:this._hideTooltip();
S=0>=T?[[0,T],[-S,.75*T],[-.5*S,.75*T],[-.5*S,0],[.5*S,0],[.5*S,.75*T],[S,.75*T],[0,T]]:[[0,0],[-S,.25*T],[-.5*S,.25*T],[-.5*S,T],[.5*S,T],[.5*S,.25*T],[S,.25*T],[0,0]];M.geometry=this._toPolygon(S,P.x,P.y);M.setGeometry(M.geometry);break;case N.DOWN_ARROW:this._hideTooltip();S=0<=T?[[0,T],[-S,.75*T],[-.5*S,.75*T],[-.5*S,0],[.5*S,0],[.5*S,.75*T],[S,.75*T],[0,T]]:[[0,0],[-S,.25*T],[-.5*S,.25*T],[-.5*S,T],[.5*S,T],[.5*S,.25*T],[S,.25*T],[0,0]];M.geometry=this._toPolygon(S,P.x,P.y);M.setGeometry(M.geometry);
break;case N.RECTANGLE:this._hideTooltip();S=[[0,0],[S,0],[S,T],[0,T],[0,0]];M.geometry=this._toPolygon(S,P.x,P.y);M.setGeometry(M.geometry);break;case N.LINE:M.setGeometry(A.mixin(M.geometry,{paths:[[[I.x,I.y],[z.x,z.y]]]}));break;case N.EXTENT:M&&K.graphics.remove(M,!0);M=new F(this._normalizeRect(I,z,L));M._originOnly=!0;this._graphic=K.graphics.add(new r(M,this.fillSymbol),!0);K.snappingManager&&K.snappingManager._setGraphic(this._graphic);break;case N.FREEHAND_POLYLINE:this._hideTooltip();if(!1===
this._canDrawFreehandPoint(D)){p("esri-touch")&&D.preventDefault();return}this._points.push(D.mapPoint.offset(0,0));M.geometry._insertPoints([z.offset(0,0)],0);M.setGeometry(M.geometry);break;case N.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(D)){p("esri-touch")&&D.preventDefault();return}this._points.push(D.mapPoint.offset(0,0));M.geometry._insertPoints([z.offset(0,0)],0);M.setGeometry(M.geometry)}p("esri-touch")&&D.preventDefault()}},_canDrawFreehandPoint:function(D){if(!this._oldPoint)return!1;
var M=this._oldPoint.x-D.screenPoint.x,I=this._oldPoint.y-D.screenPoint.y,z=this._options.tolerance;if((0>M?-1*M:M)<z&&(0>I?-1*I:I)<z)return!1;M=new Date;if(M-this._startTime<this._options.drawTime)return!1;this._startTime=M;this._oldPoint=D.screenPoint;return!0},_onMouseUpHandler:function(D){if(this._dragged&&this._graphic){0===this._points.length&&this._points.push(D.mapPoint.offset(0,0));if(this.map.snappingManager)var M=this.map.snappingManager._snappingPoint;var I=this._points[0];M=M||D.mapPoint;
var z=this.map.spatialReference,K=E;switch(this._geometryType){case K.CIRCLE:case K.ELLIPSE:case K.TRIANGLE:case K.ARROW:case K.LEFT_ARROW:case K.RIGHT_ARROW:case K.UP_ARROW:case K.DOWN_ARROW:case K.RECTANGLE:var L=this._graphic.geometry;break;case K.LINE:L=new x({paths:[[[I.x,I.y],[M.x,M.y]]],spatialReference:z});break;case K.EXTENT:L=(new F(this._normalizeRect(I,M,z))).getExtent();break;case K.FREEHAND_POLYLINE:L=new x(z);L.addPath([].concat(this._points,[M.offset(0,0)]));break;case K.FREEHAND_POLYGON:L=
new q(z),I=[].concat(this._points,[M.offset(0,0),this._points[0].offset(0,0)]),q.prototype.isClockwise(I)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),I.reverse()),L.addRing(I)}p("esri-touch")&&D.preventDefault();this._clear();this._drawEnd(L)}else this._clear()},_isPointToPointTool:function(D){switch(D){case E.POLYLINE:case E.POLYGON:case E.MULTI_POINT:return!0;default:return!1}},_onClickHandler:function(D){if(this.map.snappingManager)var M=
this.map.snappingManager._snappingPoint;M=M||D.mapPoint;D=this.map;var I=D.toScreen(M),z=E;if(this._isPointToPointTool(this._geometryType)){var K=this._points[this._points.length-1];if(M&&K&&M.x===K.x&&M.y===K.y)return;this._points.push(M.offset(0,0))}switch(this._geometryType){case z.POINT:this.onDrawStart();this._drawEnd(M.offset(0,0));this._setTooltipMessage(0);break;case z.POLYLINE:1===this._points.length?(M=new x(D.spatialReference),M.addPath(this._points),this._graphic=D.graphics.add(new r(M,
this.lineSymbol),!0),D.snappingManager&&D.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=v.connect(D,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,M.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol));break;case z.POLYGON:1===this._points.length?(M=new q(D.spatialReference),M.addRing(this._points),this._graphic=D.graphics.add(new r(M,this.fillSymbol),
!0),D.snappingManager&&D.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=v.connect(D,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,M.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol));break;case z.MULTI_POINT:M=this._points;1===M.length?(I=new C(D.spatialReference),I.addPoint(M[M.length-1]),this._graphic=D.graphics.add(new r(I,this.markerSymbol),
!0),D.snappingManager&&D.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(M[M.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case z.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],I.x,I.y);break;case z.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],I.x,I.y);break;case z.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,
12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],I.x,I.y);break;case z.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],I.x,I.y);break;case z.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],I.x,I.y);break;case z.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],I.x,I.y);break;case z.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],I.x-48,I.y+48);break;case z.CIRCLE:this._clear();
this.onDrawStart();this._drawEnd(q.createCircle({center:I,r:48,numberOfPoints:60,map:D}));break;case z.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(q.createEllipse({center:I,longAxis:48,shortAxis:24,numberOfPoints:60,map:D}))}this._setTooltipMessage(this._points.length)},_addShape:function(D,M,I){this._setTooltipMessage(0);this._clear();this.onDrawStart();this._drawEnd(this._toPolygon(D,M,I))},_toPolygon:function(D,M,I){var z=this.map,K=new q(z.spatialReference);K.addRing(B.map(D,function(L){return z.toMap({x:L[0]+
M,y:L[1]+I})}));return K},_onDblClickHandler:function(D){var M=this._points,I=this.map.spatialReference,z=E;p("esri-touch")&&M.push(D.mapPoint);var K=M[M.length-1],L=M[M.length-2];M=K&&L&&K.x===L.x&&K.y===L.y?M.slice(0,M.length-1):M.slice(0,M.length);switch(this._geometryType){case z.POLYLINE:if(!this._graphic||2>M.length){v.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(D);return}var N=new x(I);N.addPath([].concat(M));break;case z.POLYGON:if(!this._graphic||3>M.length)return;
N=new q(I);D=[].concat(M,[M[0].offset(0,0)]);q.prototype.isClockwise(D)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),D.reverse());N.addRing(D);break;case z.MULTI_POINT:N=new C(I),B.forEach(M,function(P){N.addPoint(P)})}v.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(N)},_onKeyDownHandler:function(D){D.keyCode===k.ESCAPE&&(v.disconnect(this._onMouseMoveHandler_connect),
this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(D){this._options.showTooltips&&(D?this._tooltip||(this._tooltip=c.create("div",{"class":"esriMapTooltip"},this.map.container),h.isBodyLtr()||b.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=v.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=v.connect(this.map,
"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=v.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(v.disconnect(this._onTooltipMouseEnterHandler_connect),v.disconnect(this._onTooltipMouseLeaveHandler_connect),v.disconnect(this._onTooltipMouseMoveHandler_connect),c.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var D=this._tooltip;D&&(D.style.display="none")},_setTooltipMessage:function(D){var M=this._tooltip;if(M){var I="";switch(this._geometryType){case E.POINT:I=
u.toolbars.draw.addPoint;break;case E.ARROW:case E.LEFT_ARROW:case E.RIGHT_ARROW:case E.UP_ARROW:case E.DOWN_ARROW:case E.TRIANGLE:case E.RECTANGLE:case E.CIRCLE:case E.ELLIPSE:I=u.toolbars.draw.addShape;break;case E.LINE:case E.EXTENT:case E.FREEHAND_POLYLINE:case E.FREEHAND_POLYGON:I=u.toolbars.draw.freehand;break;case E.POLYLINE:case E.POLYGON:I=u.toolbars.draw.start;1===D?I=u.toolbars.draw.resume:2<=D&&(I=u.toolbars.draw.complete);break;case E.MULTI_POINT:I=u.toolbars.draw.addMultipoint,1<=D&&
(I=u.toolbars.draw.finish)}M.innerHTML=I}},_updateTooltip:function(D){var M=this._tooltip;if(M){if(D.clientX||D.pageY){var I=D.clientX;D=D.clientY}else I=D.clientX+l.body().scrollLeft-l.body().clientLeft,D=D.clientY+l.body().scrollTop-l.body().clientTop;M.style.display="none";b.set(M,{left:I+this._options.tooltipOffset+"px",top:D+"px"});M.style.display=""}},_redrawGraphic:function(D,M,I,z){(I||this.map.wrapAround180)&&(D=this._graphic)&&D.setGeometry(D.geometry)},onActivate:function(){},onDeactivate:function(){},
onDrawComplete:function(){},onDrawStart:function(){},onDrawEnd:function(){}});A.mixin(E,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});p("extend-esri")&&A.setObject("toolbars.Draw",E,n);return E})},
"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e,r,w,H){var x=A(n,{declaredClass:"esri.toolbars.Edit",constructor:function(q,C){this._map=
q;this._tool=0;if(this._map.loaded)this._scratchGL=q.graphics;else var F=v.connect(this._map,"onLoad",this,function(){v.disconnect(F);F=null;this._scratchGL=this._map.graphics});q=p("esri-mobile");this._defaultOptions=B.mixin({vertexSymbol:new e(e.STYLE_CIRCLE,q?20:12,new r(r.STYLE_SOLID,new l([0,0,0,.5]),1),new l([128,128,128])),ghostVertexSymbol:new e(e.STYLE_CIRCLE,q?18:10,new r(r.STYLE_SOLID,new l([0,0,0,.5]),1),new l([255,255,255,.75])),ghostLineSymbol:new r(r.STYLE_DOT,new l([128,128,128]),
2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:q?24:16,boxLineSymbol:new r(r.STYLE_DASH,new l([64,64,64]),1),boxHandleSymbol:new e(e.STYLE_SQUARE,q?16:9,new r(r.STYLE_SOLID,new l([0,0,0,.5]),1),new l([255,255,255,.75])),textAnchorSymbol:new e(e.STYLE_CIRCLE,10,null,new l([255,0,0]))},C||{})},activate:function(q,C,F){this.deactivate();this._graphic=C;this._options=B.mixin(B.mixin({},this._defaultOptions),F||{});var u=x.MOVE;F=x.EDIT_VERTICES;var E=x.SCALE,D=x.ROTATE,M=x.EDIT_TEXT,
I=!1,z=!1,K=!1,L=this._map,N=L.spatialReference,P=C.geometry.spatialReference;this._geo=!(!N||!P||N.equals(P)||!N.isWebMercator()||4326!==P.wkid);this._isTextPoint=this._prepareTextSymbolEditing(C,q);(q&u)===u&&(I=this._enableMove(C));u=(q&E)===E;D=(q&D)===D;if(u||D)K=this._enableBoxEditing(C,u,D);(q&F)===F&&(z=this._enableVertexEditing(C));(q&M)===M&&this._enableTextEditing(C);if(!(I||z||K))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");
if(this._tool=q)this._mapPanEndHandle=v.connect(L,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=v.connect(L,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,C);L.snappingManager&&(I||z)&&L.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var q=this._tool,C=this._graphic;if(q){var F=!!this._modified;this._clear();v.disconnect(this._mapPanEndHandle);v.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=
this._mapExtChgHandle=null;this.onDeactivate(q,C,{isModified:F});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(q,C){},onDeactivate:function(q,C,F){},onGraphicMoveStart:function(q){},onGraphicFirstMove:function(q){this._modified=!0},onGraphicMove:function(q,C){},onGraphicMoveStop:function(q,C){},
onGraphicClick:function(q,C){},onVertexMoveStart:function(q,C){},onVertexFirstMove:function(q,C){this._modified=!0},onVertexMove:function(q,C,F){},onVertexMoveStop:function(q,C,F){},onVertexAdd:function(q,C){this._modified=!0},onVertexClick:function(q,C){},onVertexMouseOver:function(q,C){},onVertexMouseOut:function(q,C){},onVertexDelete:function(q,C){this._modified=!0},onTextEditStart:function(q,C){},onTextEditEnd:function(q){},onScaleStart:function(q){},onScaleFirstMove:function(q){this._modified=
!0},onScale:function(q,C){},onScaleStop:function(q,C){},onRotateStart:function(q){},onRotateFirstMove:function(q){this._modified=!0},onRotate:function(q,C){},onRotateStop:function(q,C){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic",
"vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],
rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(q,C){if("point"===q.geometry.type||"multipoint"===q.geometry.type){var F=q.getLayer(),u=F.renderer;F=q.symbol||F._getSymbol(q);!F&&(u.hasVisualVariables("sizeInfo",!1)||u.hasVisualVariables("colorInfo",!1)||u.hasVisualVariables("opacityInfo",!1))&&u.addBreak&&u.infos&&1===u.infos.length&&(F=u.infos[0].symbol||u.defaultSymbol);if(F&&"textsymbol"===F.type){if((C&x.SCALE)===x.SCALE||(C&x.ROTATE)===x.ROTATE||
(C&x.EDIT_TEXT)===x.EDIT_TEXT){q.setSymbol(new w(F.toJson()));var E=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(q),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){E._boxEditor&&E._boxEditor.refresh()})):G(["../dijit/SymbolEditor"],function(D){if(!E._textSymbolEditor){var M=E._options.textSymbolEditorHolder?d.create("div",null,E._options.textSymbolEditorHolder):
d.create("div",null,E._map.root);E._textSymbolEditor=new D({graphic:q},M);D=E._textSymbolEditor.domNode.parentNode.id;k.set(E._textSymbolEditor.domNode,{position:"map_root"===D?"absolute":"relative",left:"map_root"===D?E._map.width/2-100+"px":"5px",top:"20px","z-index":50});E._textSymbolEditor.startup();E._textSymbolEditor.createForm(q);E._textSymbolEditor.show();E._textSymbolEditor.on("symbol-change",function(){E._boxEditor&&E._boxEditor.refresh()})}})}if((C&x.MOVE)===x.MOVE||(C&x.ROTATE)===x.ROTATE||
(C&x.SCALE)===x.SCALE)this._textAnchor=new H(q.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(q){var C=this._map;switch(q.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new g(q,C,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(q){var C=this._map;switch(q.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=a.create(q,C,this),!0}return!1},
_enableBoxEditing:function(q,C,F){var u=this._map,E=q.geometry.type;return"polyline"===E||"polygon"===E||this._isTextPoint?(this._boxEditor=new m(q,u,this,C,F,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(q){return this._isTextPoint?(this._textEditor=new f(q,this._map,this),v.connect(this._textEditor,"onEditStart",B.hitch(this,function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();
this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var q=this._graphicMover;q&&(q.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var q=this._vertexEditor;q&&(q.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var q=this._boxEditor;q&&(q.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&
this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},_mapExtentChangeHandler:function(q,C,F){F&&this._refreshMoveables()},_refreshMoveables:function(q){var C=t.filter([this._graphicMover,this._vertexEditor,
this._boxEditor],b.isDefined);t.forEach(C,function(F){F.refresh(q)})},_beginOperation:function(q){t.forEach(this._getAffectedTools(q),function(C){C.suspend()})},_endOperation:function(q){t.forEach(this._getAffectedTools(q),function(C){C.resume()})},_getAffectedTools:function(q){var C=[];switch(q){case "MOVE":C=[this._vertexEditor,this._boxEditor];break;case "VERTICES":C=[this._boxEditor];break;case "BOX":C=[this._vertexEditor]}return C=t.filter(C,b.isDefined)}});B.mixin(x,{MOVE:1,EDIT_VERTICES:2,
SCALE:4,ROTATE:8,EDIT_TEXT:16});p("extend-esri")&&B.setObject("toolbars.Edit",x,c);return x})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f){G=G(null,{declaredClass:"esri.toolbars._Box",
constructor:function(e,r,w,H,x,q,C){this._graphic=e;this._map=r;this._toolbar=w;this._scale=H;this._rotate=x;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=q;e=w._options;this._markerSymbol=e.boxHandleSymbol;this._lineSymbol=e.boxLineSymbol;this._moveStartHandler=A.hitch(this,this._moveStartHandler);this._firstMoveHandler=A.hitch(this,this._firstMoveHandler);this._moveStopHandler=A.hitch(this,this._moveStopHandler);this._moveHandler=A.hitch(this,
this._moveHandler);this._isTextPoint=C;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){B.forEach(this._getAllGraphics(),function(e){e.hide()})},resume:function(){B.forEach(this._getAllGraphics(),function(e){e.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&B.forEach(this._connects,v.disconnect);var e=this._toolbar._scratchGL;
this._anchors&&B.forEach(this._anchors,function(r){e.remove(r.graphic);(r=r.moveable)&&r.destroy()});this._box&&e.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var e=this._map,r=this._toolbar._scratchGL,w=this._getBoxCoords(),H=new n(e.spatialReference),x=A.clone(B.filter(w,function(q,C){return 8!==C&&0===C%2}));x[0]&&x.push([x[0][0],x[0][1]]);H.addPath(x);this._rotate&&H.addPath([w[1],w[8]]);this._box?this._box.setGeometry(H):(this._box=
new f(H,this._lineSymbol),r.add(this._box));this._anchors?B.forEach(this._anchors,function(q,C){this._scale||(C=8);var F=new h(w[C],e.spatialReference);q.graphic.setGeometry(F);F=q.moveable;var u=q.graphic.getDojoShape();u&&(F?u!==F.shape&&(F.destroy(),q.moveable=this._getMoveable(q.graphic,C)):q.moveable=this._getMoveable(q.graphic,C))},this):(this._anchors=[],this._connects=[],B.forEach(w,function(q,C){!this._scale&&8>C||(q=new h(q,e.spatialReference),q=new f(q,this._markerSymbol),this._isTextPoint&&
1===C%2&&q.hide(),r.add(q),this._anchors.push({graphic:q,moveable:this._getMoveable(q,C)}))},this))}else this._cleanUp()},_getBoxCoords:function(e){var r=this._map,w=[],H,x,q;if(this._isTextPoint){var C=this._graphic.getNode().getBoundingClientRect();var F=r.__container.getBoundingClientRect();C=[{x:C.left-F.left,y:C.top-F.top},{x:C.right-F.left,y:C.top-F.top},{x:C.right-F.left,y:C.bottom-F.top},{x:C.left-F.left,y:C.bottom-F.top}]}else C=this._getTransformedBoundingBox(this._graphic);B.forEach(C,
function(u,E,D){H=u;(x=D[E+1])||(x=D[0]);q={x:(H.x+x.x)/2,y:(H.y+x.y)/2};e||(H=r.toMap(H),q=r.toMap(q));w.push([H.x,H.y]);w.push([q.x,q.y])});this._rotate&&(C=A.clone(w[1]),C=e?{x:C[0],y:C[1]}:r.toScreen({x:C[0],y:C[1],spatialReference:r.spatialReference}),C.y-=this._toolbar._options.rotateHandleOffset,e||(C=r.toMap(C)),w.push([C.x,C.y]));return w},_getTransformedBoundingBox:function(e){var r=this._map,w=e.geometry.getExtent(),H=e.geometry.spatialReference;e=new h(w.xmin,w.ymax,H);w=new h(w.xmax,
w.ymin,H);e=r.toScreen(e);w=r.toScreen(w);return[{x:e.x,y:e.y},{x:w.x,y:e.y},{x:w.x,y:w.y},{x:e.x,y:w.y}]},_getAllGraphics:function(){var e=[this._box];this._anchors&&B.forEach(this._anchors,function(r){e.push(r.graphic)});return e=B.filter(e,b.isDefined)},_getMoveable:function(e,r){var w=e.getDojoShape();if(w)return e=new d(w),e._index=r,this._connects.push(v.connect(e,"onMoveStart",this._moveStartHandler)),this._connects.push(v.connect(e,"onFirstMove",this._firstMoveHandler)),this._connects.push(v.connect(e,
"onMoveStop",this._moveStopHandler)),e.onMove=this._moveHandler,(w=w.getEventSource())&&p.set(w,"cursor",this._toolbar._cursors["box"+r]),e},_moveStartHandler:function(e){this._toolbar["on"+(8===e.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(e){this._toolbar._deactivateScrollWheel();var r=e.host._index,w=this._wrapOffset=e.host.shape._wrapOffsets[0]||0,H=this._graphic.getLayer().getNavigationTransform();e=B.map(this._getBoxCoords(!0),function(q){return{x:q[0]+
w,y:q[1]}});var x=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:e[1].x,y:e[3].y};this._centerCoord=k.multiplyPoint(k.invert(H),x);if(8===r)x=k.multiplyPoint(k.invert(H),e[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,x)),this._startLine=[this._centerCoord,x],this._moveLine=A.clone(this._startLine);else if(x=k.multiplyPoint(k.invert(H),e[r]),H=k.multiplyPoint(k.invert(H),e[(r+4)%8]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,
x)),this._firstMoverToAnchor=Math.sqrt((x.x-this._centerCoord.x)*(x.x-this._centerCoord.x)+(x.y-this._centerCoord.y)*(x.y-this._centerCoord.y)),this._startBox=H,this._startBox.width=e[4].x-e[0].x,this._startBox.height=e[4].y-e[0].y,this._moveBox=A.clone(this._startBox),this._xfactor=x.x>H.x?1:-1,this._yfactor=x.y>H.y?1:-1,1===r||5===r)this._xfactor=0;else if(3===r||7===r)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===r?this._rotateEvent:this._scaleEvent)+"FirstMove"](this._graphic)},
_moveHandler:function(e,r){e=e.host._index;var w=this._defaultEventArgs;w.angle=0;w.scaleX=1;w.scaleY=1;if(8===e){var H=this._startLine;var x=this._moveLine;var q=x[1];q.x+=r.dx;q.y+=r.dy;r=this._getAngle(H,x);this._isTextPoint&&(r+=this._graphic.symbol.angle);x=k.rotategAt(r,H[0]);this._graphic.getDojoShape().setTransform(x);w.transform=x;w.angle=r;w.around=H[0]}else{H=this._startBox;x=this._moveBox;x.width+=r.dx*this._xfactor;x.height+=r.dy*this._yfactor;this._uniformScaling||this._isTextPoint?
(H=x.x+this._xfactor*x.width,x=x.y+this._yfactor*x.height,H=Math.sqrt((H-this._centerCoord.x)*(H-this._centerCoord.x)+(x-this._centerCoord.y)*(x-this._centerCoord.y)),this._scaleRatio=r=q=H/this._firstMoverToAnchor,H=this._centerCoord):(r=x.width/H.width,q=x.height/H.height,H={x:H.x,y:H.y});if(isNaN(r)||Infinity===r||-Infinity===r)r=1;if(isNaN(q)||Infinity===q||-Infinity===q)q=1;x=k.scaleAt(r,q,H);if(this._isTextPoint){var C=k.rotategAt(this._graphic.symbol.angle,H);this._graphic.getDojoShape().setTransform([C,
x])}else this._graphic.getDojoShape().setTransform(x);w.transform=x;w.scaleX=r;w.scaleY=q;w.around=H}this._toolbar["on"+(8===e?this._rotateEvent:this._scaleEvent)](this._graphic,w)},_moveStopHandler:function(e){this._toolbar._activateScrollWheel();var r=this._graphic,w=this._toolbar,H=w._geo?g.geographicToWebMercator(r.geometry):r.geometry,x=H.spatialReference,q=r.getDojoShape(),C=q.getTransform(),F=r.getLayer().getNavigationTransform();this._isTextPoint?(r=this._graphic.symbol,8===e.host._index?
r.angle+=this._getAngle(this._startLine,this._moveLine):r.font.setSize(Math.round(r.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(r)):(H=H.toJson(),this._updateSegments(H.paths||H.rings,C,F,x),q.setTransform(null),H=a.fromJson(H),r.setGeometry(w._geo?g.webMercatorToGeographic(H,!0):H));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;w._endOperation("BOX");this._defaultEventArgs.transform=C;w["on"+(8===e.host._index?this._rotateEvent:
this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(e,r,w,H){var x=this._map,q=this._wrapOffset||0;B.forEach(e,function(C){B.forEach(C,function(F){this._updatePoint(F,H,q,k,x,w,r)},this)},this)},_updatePoint:function(e,r,w,H,x,q,C){r=x.toScreen({x:e[0],y:e[1],spatialReference:r},!0);r.x+=w;r=H.multiplyPoint([q,C,H.invert(q)],r);r.x-=w;w=x.toMap(r);e[0]=w.x;e[1]=w.y},_getAngle:function(e,r){return 180*Math.atan2(r[0].y-r[1].y,r[0].x-r[1].x)/Math.PI-180*Math.atan2(e[0].y-
e[1].y,e[0].x-e[1].x)/Math.PI},_deNormalizePoint:function(e,r){var w=this._map._getFrameWidth();if(-1===w)return e;for(e={x:e.x,y:e.y};Math.abs(e.x-r.x)>=w;)e.x=e.x<r.x?e.x+w:e.x-w;var H=Math.abs(e.x-r.x);Math.abs(e.x-r.x+w)<H?e.x+=w:Math.abs(e.x-r.x-w)<H&&(e.x-=w);return e}});l("extend-esri")&&A.setObject("toolbars._Box",G,c);return G})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(G,A,B,v,t,l,p,d,k,c){return A("dojox.gfx.Moveable",null,{constructor:function(b,h){this.shape=b;this.delay=h&&0<h.delay?h.delay:0;this.mover=h&&h.mover?h.mover:k;this.leftButtonOnly=h&&h.leftButtonOnly;this.events=[this.shape.on(l.press,G.hitch(this,"onMouseDown"))]},destroy:function(){B.forEach(this.events,function(b){b.remove()});this.events=this.shape=null},onMouseDown:function(b){this.delay?(this.events.push(this.shape.on(l.move,G.hitch(this,"onMouseMove")),this.shape.on(l.release,G.hitch(this,
"onMouseUp"))),this._lastX=b.clientX,this._lastY=b.clientY):this.leftButtonOnly&&!c.isLeft(b)||new this.mover(this.shape,b,this);v.stop(b)},onMouseMove:function(b){var h=b.clientY;if(Math.abs(b.clientX-this._lastX)>this.delay||Math.abs(h-this._lastY)>this.delay)this.onMouseUp(b),new this.mover(this.shape,b,this);v.stop(b)},onMouseUp:function(b){this.events.pop().remove()},onMoveStart:function(b){t.publish("/gfx/move/start",b);p.add(d.body(),"dojoMove")},onMoveStop:function(b){t.publish("/gfx/move/stop",
b);p.remove(d.body(),"dojoMove")},onFirstMove:function(b){},onMove:function(b,h,n){this.onMoving(b,h,n);this.shape.applyLeftTransform(h);this.onMoved(b,h)},onMoving:function(b,h){},onMoved:function(b,h){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(G,A,B,v,t,l){return B("dojox.gfx.Mover",null,{constructor:function(p,d,k){this.shape=p;this.lastX=d.clientX;this.lastY=d.clientY;p=this.host=k;d=
document;k=v(d,t.move,G.hitch(this,"onFirstMove"));this.events=[v(d,t.move,G.hitch(this,"onMouseMove")),v(d,t.release,G.hitch(this,"destroy")),v(d,"dragstart",G.hitch(l,"stop")),v(d,"selectstart",G.hitch(l,"stop")),k];if(p&&p.onMoveStart)p.onMoveStart(this)},onMouseMove:function(p){var d=p.clientX,k=p.clientY;this.host.onMove(this,{dx:d-this.lastX,dy:k-this.lastY},p);this.lastX=d;this.lastY=k;l.stop(p)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){A.forEach(this.events,
function(d){d.remove()});var p=this.host;if(p&&p.onMoveStop)p.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,n,m){var g=G(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(a,f,e,r){this.graphic=a;this.map=f;this.toolbar=e;this.tempPt=r;this._enableGraphicMover();this._moved=!1},refresh:function(a){var f=this.graphic.getDojoShape();!f||!a&&f._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var a=this.graphic,f=a.getDojoShape();f&&(f._hostGraphic=a,this._moveable=new l(f,{mover:g.Mover}),this._moveStartHandle=
B.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=B.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=B.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=B.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(a=f.getEventSource())&&t.set(a,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var a=this._moveable;if(a){B.disconnect(this._moveStartHandle);B.disconnect(this._firstMoveHandle);
B.disconnect(this._movingHandle);B.disconnect(this._moveStopHandle);var f=a.shape;f&&(f._hostGraphic=null,(f=f.getEventSource())&&t.set(f,"cursor","inherit"));a.destroy()}this._moveable=null},_moveStartHandler:function(){var a=this.graphic,f=this.map;this._startTx=a.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&f.snappingManager&&f.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(a)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(a,f,e){a=a.shape.getTransform();f=this.map;var r;b("esri-pointer")?r=f.navigationManager.pointerEvents._processTouchEvent(e,e):e&&"pointermove"===e.type&&(r=c.prototype._processTouchEvent.call({map:f},e,e));r&&f.snappingManager&&f.snappingManager._onSnappingMouseMoveHandler(r);this.tempPt&&this.tempPt.getDojoShape().setTransform(a);this.toolbar.onGraphicMove(this.graphic,a)},_moveStopHandler:function(a){var f=this.graphic,e=this.toolbar,r=this.map,w=e._geo?h.geographicToWebMercator(f.geometry):
f.geometry,H=w.type,x=f.getDojoShape(),q=x.getTransform();if(v.toJson(q)!==v.toJson(this._startTx)){this._moved=!0;switch(H){case "point":H=[q,d.invert(this._startTx)];if(r.snappingManager)var C=r.snappingManager._snappingPoint;w=C||r.toMap(d.multiplyPoint(H,r.toScreen(w,!0)));r.snappingManager&&r.snappingManager._killOffSnapping();break;case "polyline":w=this._updatePolyGeometry(w,w.paths,q);break;case "polygon":w=this._updatePolyGeometry(w,w.rings,q)}x.setTransform(null);f.setGeometry(e._geo?h.webMercatorToGeographic(w,
!0):w);this.tempPt&&this.tempPt.setGeometry(new m(f.geometry.toJson()))}else this._moved=!1;e._endOperation("MOVE");e.onGraphicMoveStop(f,q);this._moved||(a=a.__e,r=this.map.position,a=new n(a.pageX-r.x,a.pageY-r.y),e.onGraphicClick(f,{screenPoint:a,mapPoint:this.map.toMap(a)}))},_updatePolyGeometry:function(a,f,e){var r=this.map,w=a.getPoint(0,0);r=r.toMap(r.toScreen(w).offset(e.dx,e.dy));e=r.x-w.x;w=r.y-w.y;var H;for(r=0;r<f.length;r++){var x=f[r];for(H=0;H<x.length;H++){var q=a.getPoint(r,H);a.setPoint(r,
H,q.offset(e,w))}}return a}});g.Mover=G(p,{declaredClass:"esri.toolbars._Mover",constructor:function(a,f,e){this.__e=f}});b("extend-esri")&&(A.setObject("toolbars._GraphicMover",g,k),A.setObject("toolbars._Mover",g.Mover,k));return g})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(G,
A,B,v,t,l,p,d,k,c,b,h){var n=G(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(m,g,a){this.graphic=m;this.map=g;this.toolbar=a;m=a._options;this._symbol1=m.vertexSymbol;this._symbol2=m.ghostVertexSymbol;g=m.ghostLineSymbol;this._lineStroke={style:g.style,width:g.width,color:g.color};this._canDel=m.allowDeleteVertices;this._canAdd=m.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(m){m?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=B.connect(k,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=B.connect(k,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var m=this._getGraphicsLayer();this._mouseOverHandle=B.connect(m,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=B.connect(m,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new l({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),m=this._ctxDelete=new p({label:h.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
B.connect(m,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(m),this._ctxMenu.startup())},_removeControllers:function(){B.disconnect(this._firstMoveHandle);B.disconnect(this._moveStopHandle);B.disconnect(this._mouseOverHandle);B.disconnect(this._mouseOutHandle);B.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(m,g,a){var f,e,r=this.graphic,w=[];for(f=0;f<m.length;f++){var H=m[f],x=[];for(e=0;e<H.length;e++)x.push(new k(H[e],g,r,f,e,H.length,this,a));w.push(x)}return w},_remove:function(m){m&&v.forEach(m,function(g){v.forEach(g,function(a){a.destroy()})})},_refresh:function(m){m&&v.forEach(m,function(g){v.forEach(g,function(a){a.refresh()})})},_isNew:function(m){return-1===v.indexOf(this._vertexMovers[m.segIndex],m)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(m){m=this._selectedMover;this._updateRelatedGraphic(m,m.relatedGraphic,m.graphic.geometry,m.segIndex,m.ptIndex,m.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(m);this._deleteVertex(m);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(m){m=m.graphic;var g=this._findMover(m);g&&(this.toolbar.onVertexMouseOver(this.graphic,g._getInfo()),g._placeholder||(this._selectedMover=g,this._canDel&&this._bindCtxNode(m.getDojoShape().getNode())))},_mouseOutHandler:function(m){if(m=
this._findMover(m.graphic))this.toolbar.onVertexMouseOut(this.graphic,m._getInfo())},_bindCtxNode:function(m){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(m);this._bindNode=m},_unbindCtxNode:function(){var m=this._bindNode;m&&this._ctxMenu.unBindDomNode(m)},_findMover:function(m){var g=[];var a=this._mpVertexMovers;v.forEach(this._vertexMovers,function(e){g=g.concat(e)});a&&v.forEach(a,function(e){g=g.concat(e)});
for(a=0;a<g.length;a++){var f=g[a];if(f.graphic===m)return f}},_firstMoveHandler:function(m){!this._isNew(m)&&this._canAdd&&this._hideRelatedMidpoints(m);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(m,g){var a=this._isNew(m);g&&(g.dx||g.dy)?(this._updateRelatedGraphic(m,m.relatedGraphic,m.graphic.geometry,m.segIndex,m.ptIndex,m.segLength,a),this._canAdd&&(a?this._addMidpoints(m):(this._repositionRelatedMidpoints(m),this._showRelatedMidpoints(m))),this.toolbar._endOperation("VERTICES")):
!a&&this._canAdd&&this._showRelatedMidpoints(m)},_showRelatedMidpoints:function(m){var g=this._getAdjacentMidpoints(m.ptIndex,m.segLength),a=this._mpVertexMovers[m.segIndex];for(m=0;m<g.length;m++){var f=a[g[m]];f.graphic.show();f.refresh()}},_hideRelatedMidpoints:function(m){var g=this._getAdjacentMidpoints(m.ptIndex,m.segLength),a=this._mpVertexMovers[m.segIndex];for(m=0;m<g.length;m++)a[g[m]].graphic.hide()},_repositionRelatedMidpoints:function(m){var g,a=this._getAdjacentMidpoints(m.ptIndex,m.segLength),
f=this._mpVertexMovers[m.segIndex];for(g=0;g<a.length;g++){var e=this._getAdjacentVertices(a[g],m.segLength),r=m.relatedGraphic.geometry.getPoint(m.segIndex,e[0]);e=m.relatedGraphic.geometry.getPoint(m.segIndex,e[1]);r=new c({x:(r.x+e.x)/2,y:(r.y+e.y)/2,spatialReference:r.spatialReference.toJson()});f[a[g]].graphic.setGeometry(r)}},_addMidpoints:function(m){var g=m.segIndex,a=m.ptIndex,f=m.segLength,e=a+1,r,w=f+1;this._mpVertexMovers[g].splice(a,1);var H=this._vertexMovers[g];for(r=0;r<e;r++)H[r].segLength+=
1;for(r=e;r<H.length;r++)H[r].ptIndex+=1,H[r].segLength+=1;m.ptIndex=e;m.segLength=H.length+1;H.splice(e,0,m);m.graphic.setSymbol(this._symbol1);H=this._mpVertexMovers[g];for(r=0;r<a;r++)H[r].segLength+=1;for(r=a;r<f-1;r++)H[r].ptIndex+=1,H[r].segLength+=1;e=this._getAdjacentVertices(a,w);g=this._getAdjacentVertices(a+1,w);f=m.relatedGraphic.geometry.getPoint(m.segIndex,e[0]);r=m.relatedGraphic.geometry.getPoint(m.segIndex,e[1]);e=new c({x:(f.x+r.x)/2,y:(f.y+r.y)/2,spatialReference:f.spatialReference.toJson()});
f=m.relatedGraphic.geometry.getPoint(m.segIndex,g[0]);r=m.relatedGraphic.geometry.getPoint(m.segIndex,g[1]);g=new c({x:(f.x+r.x)/2,y:(f.y+r.y)/2,spatialReference:f.spatialReference.toJson()});f=new k(e,this._symbol2,this.graphic,m.segIndex,a,w,this,!0);m=new k(g,this._symbol2,this.graphic,m.segIndex,a+1,w,this,!0);H.splice(a,0,f,m)},_deleteVertex:function(m){var g,a=m.ptIndex,f=this._vertexMovers[m.segIndex];for(g=0;g<a;g++)--f[g].segLength;for(g=a+1;g<f.length;g++){var e=f[g];--e.ptIndex;--e.segLength}f.splice(a,
1);g=m._getInfo();m.destroy();this.toolbar.onVertexDelete(this.graphic,g)}});A.mixin(n,{create:function(m,g,a){switch(m.geometry.type){case "multipoint":return new n.MultipointVertexEditor(m,g,a);case "polyline":return new n.PolylineVertexEditor(m,g,a);case "polygon":return new n.PolygonVertexEditor(m,g,a)}}});n.MultipointVertexEditor=G(n,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=B.connect(k,"onMoveStart",this,this._moveStartHandler);
B.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);B.disconnect(this._moveStartHandle)},_getSegments:function(m){var g=m.points,a=[],f=m.spatialReference;for(m=0;m<g.length;m++){var e=g[m];a.push(new c({x:e[0],y:e[1],spatialReference:f.toJson()}))}return[a]},_getMidpointSegments:function(m){return[]},_getControlPoints:function(m,g,a,f,e){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(m){var g=m.graphic;if(m=this._findMover(m))this.toolbar.onVertexMouseOver(g,
m._getInfo()),this._selectedMover=m,this._canDel&&this._bindCtxNode(m.graphic.getDojoShape().getNode())},_mouseOutHandler:function(m){var g=m.graphic;if(m=this._findMover(m))this.toolbar.onVertexMouseOut(g,m._getInfo())},_findMover:function(m){var g=[].concat(this._vertexMovers[0]),a=m.target;for(m=0;m<g.length;m++){var f=g[m];if(f.graphic.getDojoShape().getNode()===a)return f}},_moveStartHandler:function(m){var g=m.ptIndex,a=m.segLength-1,f=m.relatedGraphic.geometry.points;m=f.splice(g,1);f.push(m[0]);
f=this._vertexMovers[0];for(m=a;m>g;m--)--f[m].ptIndex;m=f.splice(g,1);f.push(m[0]);m[0].ptIndex=a},_moveStopHandler:function(m){this._updateRelatedGraphic(m,m.relatedGraphic,m.graphic.geometry,m.segIndex,m.ptIndex,m.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(m,g,a,f,e,r,w,H){m=g.geometry;H?m.removePoint(e):m.setPoint(e,a);g.setGeometry(m)},_deleteMidpoints:function(m){}});n.PolylineVertexEditor=G(n,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(m){var g,a,f=m.paths,e=[];for(g=0;g<f.length;g++){var r=f[g],w=[];for(a=0;a<r.length;a++)w.push(m.getPoint(g,a));e.push(w)}return e},_getMidpointSegments:function(m){var g,a,f=m.paths,e=[],r=m.spatialReference;for(g=0;g<f.length;g++){var w=f[g],H=[];for(a=0;a<w.length-1;a++){var x=m.getPoint(g,a),q=m.getPoint(g,a+1);x=new c({x:(x.x+q.x)/2,y:(x.y+q.y)/2,spatialReference:r.toJson()});H.push(x)}e.push(H)}return e},_getControlPoints:function(m,g,a,f,e){var r=this.map,w,H;this._isNew(m)?
(m=f,f+=1,0<=m&&(w=r.toScreen(g.getPoint(a,m))),f<=e&&(H=r.toScreen(g.getPoint(a,f)))):(m=f-1,f+=1,0<=m&&(w=r.toScreen(g.getPoint(a,m))),f<e&&(H=r.toScreen(g.getPoint(a,f))));return[w,H]},_getAdjacentMidpoints:function(m,g){var a=[],f=m-1;0<=f&&a.push(f);m<g-1&&a.push(m);return a},_getAdjacentVertices:function(m,g){return[m,m+1]},_deleteMidpoints:function(m){var g=this._mpVertexMovers[m.segIndex],a=g.length-1,f=this._getAdjacentMidpoints(m.ptIndex,m.segLength).sort(),e,r=f[0];for(e=0;e<r;e++)--g[e].segLength;
for(e=r+1;e<g.length;e++){var w=g[e];--w.ptIndex;--w.segLength}if(1===f.length)g.splice(r,1)[0].destroy();else for(w=this._getAdjacentVertices(r,a),e=m.relatedGraphic.geometry.getPoint(m.segIndex,w[0]),w=m.relatedGraphic.geometry.getPoint(m.segIndex,w[1]),e=new c({x:(e.x+w.x)/2,y:(e.y+w.y)/2,spatialReference:e.spatialReference.toJson()}),m=new k(e,this._symbol2,this.graphic,m.segIndex,r,a,this,!0),g=g.splice(r,f.length,m),e=0;e<g.length;e++)g[e].destroy()},_updateRelatedGraphic:function(m,g,a,f,e,
r,w,H){m=g.geometry;w?m.insertPoint(f,e+1,b.fromJson(a.toJson())):H?m.removePoint(f,e):m.setPoint(f,e,b.fromJson(a.toJson()));g.setGeometry(m)}});n.PolygonVertexEditor=G(n,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(m){var g,a,f=m.rings,e=[];for(g=0;g<f.length;g++){var r=f[g],w=[];for(a=0;a<r.length-1;a++)w.push(m.getPoint(g,a));e.push(w)}return e},_getMidpointSegments:function(m){var g,a,f=m.rings,e=[],r=m.spatialReference;for(g=0;g<f.length;g++){var w=f[g],
H=[];for(a=0;a<w.length-1;a++){var x=m.getPoint(g,a),q=m.getPoint(g,a+1);x=new c({x:(x.x+q.x)/2,y:(x.y+q.y)/2,spatialReference:r.toJson()});H.push(x)}e.push(H)}return e},_getControlPoints:function(m,g,a,f,e){var r=this.map;this._isNew(m)?m=f:(m=f-1,m=0>m?(e+m)%e:m);f=(f+1)%e;e=r.toScreen(g.getPoint(a,m));g=r.toScreen(g.getPoint(a,f));return[e,g]},_getAdjacentMidpoints:function(m,g){var a=m-1;return[0>a?(g+a)%g:a,m]},_getAdjacentVertices:function(m,g){return[m,(m+1)%g]},_deleteMidpoints:function(m){var g=
m.ptIndex,a=this._mpVertexMovers[m.segIndex],f=a.length-1,e=this._getAdjacentMidpoints(g,m.segLength).sort();var r=e[0];var w=e[e.length-1];if(0===g){var H=this._getAdjacentVertices(f-1,f);g=m.relatedGraphic.geometry.getPoint(m.segIndex,H[0]);H=m.relatedGraphic.geometry.getPoint(m.segIndex,H[1]);g=new c({x:(g.x+H.x)/2,y:(g.y+H.y)/2,spatialReference:g.spatialReference.toJson()});m=new k(g,this._symbol2,this.graphic,m.segIndex,f-1,f,this,!0);a.splice(w,1,m)[0].destroy();a.splice(r,1)[0].destroy();for(e=
0;e<a.length-1;e++)r=a[e],--r.ptIndex,--r.segLength}else{H=this._getAdjacentVertices(r,f);g=m.relatedGraphic.geometry.getPoint(m.segIndex,H[0]);H=m.relatedGraphic.geometry.getPoint(m.segIndex,H[1]);g=new c({x:(g.x+H.x)/2,y:(g.y+H.y)/2,spatialReference:g.spatialReference.toJson()});m=new k(g,this._symbol2,this.graphic,m.segIndex,r,f,this,!0);w=a.splice(r,e.length,m);for(e=0;e<w.length;e++)w[e].destroy();for(e=0;e<r;e++)--a[e].segLength;for(e=r+1;e<a.length;e++)r=a[e],--r.ptIndex,--r.segLength}},_updateRelatedGraphic:function(m,
g,a,f,e,r,w,H){m=g.geometry;w?m.insertPoint(f,e+1,b.fromJson(a.toJson())):H?(m.removePoint(f,e),0===e&&m.setPoint(f,r-1,b.fromJson(m.getPoint(f,0).toJson()))):(m.setPoint(f,e,b.fromJson(a.toJson())),0===e&&m.setPoint(f,r,b.fromJson(a.toJson())));g.setGeometry(m)}});t("extend-esri")&&(A.setObject("toolbars._GraphicVertexEditor",n,d),A.setObject("toolbars._MultipointVertexEditor",n.MultipointVertexEditor,d),A.setObject("toolbars._PolylineVertexEditor",n.PolylineVertexEditor,d),A.setObject("toolbars._PolygonVertexEditor",
n.PolygonVertexEditor,d));return n})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a){b("dijit-legacy-requires")&&a(0,function(){G(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return B("dijit.Menu",g,{constructor:function(){this._bindings=
[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):A.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(f){return n.get(this._iframeContentDocument(f))||this._iframeContentDocument(f).__parent__||f.name&&document.frames[f.name]||null},_iframeContentDocument:function(f){return f.contentDocument||f.contentWindow&&f.contentWindow.document||
f.name&&document.frames[f.name]&&document.frames[f.name].document||null},bindDomNode:function(f){f=v.byId(f,this.ownerDocument);if("iframe"==f.tagName.toLowerCase()){var e=f;var r=this._iframeContentWindow(e);r=h.body(r.document)}else r=f==h.body(this.ownerDocument)?this.ownerDocument.documentElement:f;var w={node:f,iframe:e};t.set(f,"_dijitMenu"+this.id,this._bindings.push(w));var H=k.hitch(this,function(x){var q=this.selector,C=q?function(u){return c.selector(q,u)}:function(u){return u},F=this;
return[c(x,C(this.leftClickToOpen?"click":"contextmenu"),function(u){u.stopPropagation();u.preventDefault();(new Date).getTime()<F._lastKeyDown+500||F._scheduleOpen(this,e,{x:u.pageX,y:u.pageY},u.target)}),c(x,C("keydown"),function(u){if(93==u.keyCode||u.shiftKey&&u.keyCode==d.F10||F.leftClickToOpen&&u.keyCode==d.SPACE)u.stopPropagation(),u.preventDefault(),F._scheduleOpen(this,e,null,u.target),F._lastKeyDown=(new Date).getTime()})]});w.connects=r?H(r):[];e&&(w.onloadHandler=k.hitch(this,function(){var x=
this._iframeContentWindow(e);x=h.body(x.document);w.connects=H(x)}),e.addEventListener?e.addEventListener("load",w.onloadHandler,!1):e.attachEvent("onload",w.onloadHandler))},unBindDomNode:function(f){try{var e=v.byId(f,this.ownerDocument)}catch(x){return}f="_dijitMenu"+this.id;if(e&&t.has(e,f)){for(var r=t.get(e,f)-1,w=this._bindings[r],H;H=w.connects.pop();)H.remove();(H=w.iframe)&&(H.removeEventListener?H.removeEventListener("load",w.onloadHandler,!1):H.detachEvent("onload",w.onloadHandler));t.remove(e,
f);delete this._bindings[r]}},_scheduleOpen:function(f,e,r,w){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:w,delegatedTarget:f,iframe:e,coords:r})},1))},_openMyself:function(f){function e(){u.refocus&&E&&E.focus();m.close(u)}var r=f.target,w=f.iframe,H=f.coords,x=!H;this.currentTarget=f.delegatedTarget;if(H){if(w){f=l.position(w,!0);r=this._iframeContentWindow(w);r=l.docScroll(r.document);var q=p.getComputedStyle(w),C=p.toPixelValue,F=(b("ie")&&
b("quirks")?0:C(w,q.paddingLeft))+(b("ie")&&b("quirks")?C(w,q.borderLeftWidth):0);w=(b("ie")&&b("quirks")?0:C(w,q.paddingTop))+(b("ie")&&b("quirks")?C(w,q.borderTopWidth):0);H.x+=f.x+F-r.x;H.y+=f.y+w-r.y}}else H=l.position(r,!0),H.x+=10,H.y+=10;var u=this;w=this._focusManager.get("prevNode");f=this._focusManager.get("curNode");var E=!f||v.isDescendant(f,this.domNode)?w:f;m.open({popup:this,x:H.x,y:H.y,onExecute:e,onCancel:e,orient:this.isLeftToRight()?"L":"R"});this.focus();x||this.defer(function(){this._cleanUp(!0)});
this._onBlur=function(){this.inherited("_onBlur",arguments);m.close(this)}},destroy:function(){A.forEach(this._bindings,function(f){f&&this.unBindDomNode(f.node)},this);this.inherited(arguments)}})})},"dijit/popup":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main dojo/touch".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,
n,m,g,a){function f(){this._popupWrapper&&(l.destroy(this._popupWrapper),delete this._popupWrapper)}B=B(null,{_stack:[],_beginZIndex:1E3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var e=this._firstAroundPosition,r=p.position(this._firstAroundNode,!0),w=r.x-e.x;e=r.y-e.y;if(w||e)for(this._firstAroundPosition=r,r=0;r<this._stack.length;r++){var H=this._stack[r].wrapper.style;H.top=parseFloat(H.top)+e+"px";"auto"==H.right?H.left=parseFloat(H.left)+w+"px":H.right=parseFloat(H.right)-
w+"px"}this._aroundMoveListener=setTimeout(b.hitch(this,"_repositionAll"),w||e?10:50)}},_createWrapper:function(e){var r=e._popupWrapper,w=e.domNode;r||(r=l.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":e["aria-label"]||e.label||e.name||e.id},e.ownerDocumentBody),r.appendChild(w),w=w.style,w.display="",w.visibility="",w.position="",w.top="0px",e._popupWrapper=r,A.after(e,"destroy",f,!0),"ontouchend"in document&&h(r,"touchend",function(H){/^(input|button|textarea)$/i.test(H.target.tagName)||
H.preventDefault()}),r.dojoClick=!0);return r},moveOffScreen:function(e){var r=this._createWrapper(e);e=p.isBodyLtr(e.ownerDocument);var w={visibility:"hidden",top:"-9999px",display:""};w[e?"left":"right"]="-9999px";w[e?"right":"left"]="auto";d.set(r,w);return r},hide:function(e){var r=this._createWrapper(e);d.set(r,{display:"none",height:"auto",overflowY:"visible",border:""});e=e.domNode;"_originalStyle"in e&&(e.style.cssText=e._originalStyle)},getTopPopup:function(){for(var e=this._stack,r=e.length-
1;0<r&&e[r].parent===e[r-1].widget;r--);return e[r]},open:function(e){for(var r=this._stack,w=e.popup,H=w.domNode,x=e.orient||["below","below-alt","above","above-alt"],q=e.parent?e.parent.isLeftToRight():p.isBodyLtr(w.ownerDocument),C=e.around,F=e.around&&e.around.id?e.around.id+"_dropdown":"popup_"+this._idGen++;r.length&&(!e.parent||!v.isDescendant(e.parent.domNode,r[r.length-1].widget.domNode));)this.close(r[r.length-1].widget);var u=this.moveOffScreen(w);w.startup&&!w._started&&w.startup();var E=
p.position(H);if("maxHeight"in e&&-1!=e.maxHeight)var D=e.maxHeight||Infinity;else{D=g.getEffectiveBox(this.ownerDocument);var M=C?p.position(C,!1):{y:e.y-(e.padding||0),h:2*(e.padding||0)};D=Math.floor(Math.max(M.y,D.h-(M.y+M.h)))}E.h>D&&(E=d.getComputedStyle(H),d.set(u,{overflowY:"scroll",height:D+"px",border:E.borderLeftWidth+" "+E.borderLeftStyle+" "+E.borderLeftColor}),H._originalStyle=H.style.cssText,H.style.border="none");t.set(u,{id:F,style:{zIndex:this._beginZIndex+r.length},"class":"dijitPopup "+
(w.baseClass||w["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:e.parent?e.parent.id:""});0==r.length&&C&&(this._firstAroundNode=C,this._firstAroundPosition=p.position(C,!0),this._aroundMoveListener=setTimeout(b.hitch(this,"_repositionAll"),50));k("config-bgIframe")&&!w.bgIframe&&(w.bgIframe=new m(u));F=w.orient?b.hitch(w,"orient"):null;x=C?n.around(u,C,x,q,F):n.at(u,e,"R"==x?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],e.padding,F);u.style.visibility="visible";H.style.visibility="visible";H=
[];H.push(h(u,"keydown",b.hitch(this,function(I){if(I.keyCode==c.ESCAPE&&e.onCancel)I.stopPropagation(),I.preventDefault(),e.onCancel();else if(I.keyCode==c.TAB&&(I.stopPropagation(),I.preventDefault(),(I=this.getTopPopup())&&I.onCancel))I.onCancel()})));w.onCancel&&e.onCancel&&H.push(w.on("cancel",e.onCancel));H.push(w.on(w.onExecute?"execute":"change",b.hitch(this,function(){var I=this.getTopPopup();if(I&&I.onExecute)I.onExecute()})));r.push({widget:w,wrapper:u,parent:e.parent,onExecute:e.onExecute,
onCancel:e.onCancel,onClose:e.onClose,handlers:H});if(w.onOpen)w.onOpen(x);return x},close:function(e){for(var r=this._stack;e&&G.some(r,function(C){return C.widget==e})||!e&&r.length;){var w=r.pop(),H=w.widget,x=w.onClose;H.bgIframe&&(H.bgIframe.destroy(),delete H.bgIframe);if(H.onClose)H.onClose();for(var q;q=w.handlers.pop();)q.remove();H&&H.domNode&&this.hide(H);x&&x()}0==r.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=
this._aroundMoveListener=null)}});return a.popup=new B})},"dijit/place":function(){define("dojo/_base/array dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/_base/window ./Viewport ./main".split(" "),function(G,A,B,v,t,l,p){function d(c,b,h,n){var m=l.getEffectiveBox(c.ownerDocument);c.parentNode&&"body"==String(c.parentNode.tagName).toLowerCase()||t.body(c.ownerDocument).appendChild(c);var g=null;G.some(b,function(e){var r=e.corner,w=e.pos,H=0,x={w:{L:m.l+m.w-w.x,R:w.x-m.l,M:m.w}[r.charAt(1)],
h:{T:m.t+m.h-w.y,B:w.y-m.t,M:m.h}[r.charAt(0)]},q=c.style;q.left=q.right="auto";h&&(H=h(c,e.aroundCorner,r,x,n),H="undefined"==typeof H?0:H);var C=c.style,F=C.display,u=C.visibility;"none"==C.display&&(C.visibility="hidden",C.display="");q=A.position(c);C.display=F;C.visibility=u;F={L:w.x,R:w.x-q.w,M:Math.max(m.l,Math.min(m.l+m.w,w.x+(q.w>>1))-q.w)}[r.charAt(1)];u={T:w.y,B:w.y-q.h,M:Math.max(m.t,Math.min(m.t+m.h,w.y+(q.h>>1))-q.h)}[r.charAt(0)];w=Math.max(m.l,F);C=Math.max(m.t,u);F=Math.min(m.l+m.w,
F+q.w)-w;u=Math.min(m.t+m.h,u+q.h)-C;H+=q.w-F+(q.h-u);if(null==g||H<g.overflow)g={corner:r,aroundCorner:e.aroundCorner,x:w,y:C,w:F,h:u,overflow:H,spaceAvailable:x};return!H});g.overflow&&h&&h(c,g.aroundCorner,g.corner,g.spaceAvailable,n);b=g.y;var a=g.x,f=t.body(c.ownerDocument);/relative|absolute/.test(B.get(f,"position"))&&(b-=B.get(f,"marginTop"),a-=B.get(f,"marginLeft"));f=c.style;f.top=b+"px";f.left=a+"px";f.right="auto";return g}var k={TL:"BR",TR:"BL",BL:"TR",BR:"TL"};return p.place={at:function(c,
b,h,n,m){h=G.map(h,function(g){var a={corner:g,aroundCorner:k[g],pos:{x:b.x,y:b.y}};n&&(a.pos.x+="L"==g.charAt(1)?n.x:-n.x,a.pos.y+="T"==g.charAt(0)?n.y:-n.y);return a});return d(c,h,m)},around:function(c,b,h,n,m){function g(E,D){u.push({aroundCorner:E,corner:D,pos:{x:{L:x,R:x+C,M:x+(C>>1)}[E.charAt(1)],y:{T:q,B:q+F,M:q+(F>>1)}[E.charAt(0)]}})}if("string"==typeof b||"offsetWidth"in b||"ownerSVGElement"in b){var a=A.position(b,!0);if(/^(above|below)/.test(h[0])){var f=A.getBorderExtents(b),e=b.firstChild?
A.getBorderExtents(b.firstChild):{t:0,l:0,b:0,r:0},r=A.getBorderExtents(c),w=c.firstChild?A.getBorderExtents(c.firstChild):{t:0,l:0,b:0,r:0};a.y+=Math.min(f.t+e.t,r.t+w.t);a.h-=Math.min(f.t+e.t,r.t+w.t)+Math.min(f.b+e.b,r.b+w.b)}}else a=b;if(b.parentNode)for(f="absolute"==B.getComputedStyle(b).position,b=b.parentNode;b&&1==b.nodeType&&"BODY"!=b.nodeName;){e=A.position(b,!0);r=B.getComputedStyle(b);/relative|absolute/.test(r.position)&&(f=!1);if(!f&&/hidden|auto|scroll/.test(r.overflow)){w=Math.min(a.y+
a.h,e.y+e.h);var H=Math.min(a.x+a.w,e.x+e.w);a.x=Math.max(a.x,e.x);a.y=Math.max(a.y,e.y);a.h=w-a.y;a.w=H-a.x}"absolute"==r.position&&(f=!0);b=b.parentNode}var x=a.x,q=a.y,C="w"in a?a.w:a.w=a.width,F="h"in a?a.h:(v.deprecated("place.around: dijit/place.__Rectangle: { x:"+x+", y:"+q+", height:"+a.height+", width:"+C+" } has been deprecated.  Please use { x:"+x+", y:"+q+", h:"+a.height+", w:"+C+" }","","2.0"),a.h=a.height),u=[];G.forEach(h,function(E){var D=n;switch(E){case "above-centered":g("TM","BM");
break;case "below-centered":g("BM","TM");break;case "after-centered":D=!D;case "before-centered":g(D?"ML":"MR",D?"MR":"ML");break;case "after":D=!D;case "before":g(D?"TL":"TR",D?"TR":"TL");g(D?"BL":"BR",D?"BR":"BL");break;case "below-alt":D=!D;case "below":g(D?"BL":"BR",D?"TL":"TR");g(D?"BR":"BL",D?"TR":"TL");break;case "above-alt":D=!D;case "above":g(D?"TL":"TR",D?"BL":"BR");g(D?"TR":"TL",D?"BR":"BL");break;default:g(E.aroundCorner,E.corner)}});c=d(c,u,m,{w:C,h:F});c.aroundNodePos=a;return c}}})},
"dijit/Viewport":function(){define(["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],function(G,A,B,v,t){var l=new G,p;B(function(){var d=t.getBox();l._rlh=A(window,"resize",function(){var c=t.getBox();if(d.h!=c.h||d.w!=c.w)d=c,l.emit("resize")});if(8==v("ie")){var k=screen.deviceXDPI;setInterval(function(){screen.deviceXDPI!=k&&(k=screen.deviceXDPI,l.emit("resize"))},500)}v("ios")&&(A(document,"focusin",function(c){p=c.target}),A(document,"focusout",function(c){p=null}))});l.getEffectiveBox=
function(d){d=t.getBox(d);var k=p&&p.tagName&&p.tagName.toLowerCase();v("ios")&&p&&!p.readOnly&&("textarea"==k||"input"==k&&/^(color|email|number|password|search|tel|text|url)$/.test(p.type))&&(d.h*=0==orientation||180==orientation?.66:.4,k=p.getBoundingClientRect(),d.h=Math.max(d.h,k.top+k.height));return d};return l})},"dijit/BackgroundIframe":function(){define("require ./main dojo/_base/config dojo/dom-construct dojo/dom-style dojo/_base/lang dojo/on dojo/sniff".split(" "),function(G,A,B,v,t,l,
p,d){d.add("config-bgIframe",(d("ie")||d("trident"))&&!/IEMobile\/10\.0/.test(navigator.userAgent));var k=new function(){var c=[];this.pop=function(){if(c.length){var b=c.pop();b.style.display=""}else 9>d("ie")?(b=B.dojoBlankHtmlUrl||G.toUrl("dojo/resources/blank.html")||'javascript:""',b=document.createElement("\x3ciframe src\x3d'"+b+"' role\x3d'presentation' style\x3d'position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity\x3d\"0\");'\x3e")):(b=v.create("iframe"),b.src='javascript:""',
b.className="dijitBackgroundIframe",b.setAttribute("role","presentation"),t.set(b,"opacity",.1)),b.tabIndex=-1;return b};this.push=function(b){b.style.display="none";c.push(b)}};A.BackgroundIframe=function(c){if(!c.id)throw Error("no id");if(d("config-bgIframe")){var b=this.iframe=k.pop();c.appendChild(b);7>d("ie")||d("quirks")?(this.resize(c),this._conn=p(c,"resize",l.hitch(this,"resize",c))):t.set(b,{width:"100%",height:"100%"})}};l.extend(A.BackgroundIframe,{resize:function(c){this.iframe&&t.set(this.iframe,
{width:c.offsetWidth+"px",height:c.offsetHeight+"px"})},destroy:function(){this._conn&&(this._conn.remove(),this._conn=null);this.iframe&&(this.iframe.parentNode.removeChild(this.iframe),k.push(this.iframe),delete this.iframe)}});return A.BackgroundIframe})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(G,A,B,v){return G("dijit.DropDownMenu",v,{templateString:B,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},
_onDownArrow:function(){this.focusNext()},_onRightArrow:function(t){this._moveToPopup(t);t.stopPropagation();t.preventDefault()},_onLeftArrow:function(t){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else t.stopPropagation(),t.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g){return A("dijit._MenuBase",[h,g,m,n],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){t.toggle(this.domNode,"dijitMenuActive",a);t.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(a){var f=b.byNode(a);return a.parentNode==this.containerNode&&f&&f.focus},postCreate:function(){var a=this,f="string"==typeof this.childSelector?this.childSelector:l.hitch(this,"childSelector");this.own(d(this.containerNode,d.selector(f,p.enter),function(){a.onItemHover(b.byNode(this))}),d(this.containerNode,d.selector(f,p.leave),function(){a.onItemUnhover(b.byNode(this))}),d(this.containerNode,d.selector(f,c),function(e){a.onItemClick(b.byNode(this),e);e.stopPropagation()}),
d(this.containerNode,d.selector(f,"focusin"),function(){a._onItemFocus(b.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,f,e,r){this.inherited(arguments);if(a&&(-1==r||a.popup&&1==r))this.onItemClick(a,f)},_keyboardSearchCompare:function(a,f){return a.shortcutKey?f==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,f){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),f=/^key/.test(f._origType||
f.type)||0==f.clientX&&0==f.clientY,this._openItemPopup(a,f)):(this.onExecute(),a._onClick?a._onClick(f):a.onClick(f))},_openItemPopup:function(a,f){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var e=a.popup;e.parentMenu=this;this.own(this._mouseoverHandle=d.once(e.domNode,"mouseover",l.hitch(this,"_onPopupHover")));var r=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){f&&
r.focusChild(a);r._cleanUp()},onExecute:l.hitch(this,"_cleanUp",!0),onClose:function(){r._mouseoverHandle&&(r._mouseoverHandle.remove(),delete r._mouseoverHandle)}},f);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(v.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_CssStateMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-class dojo/has dojo/_base/lang dojo/on dojo/domReady dojo/touch dojo/_base/window ./a11yclick ./registry".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h){A=A("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);G.forEach("disabled readOnly checked selected focused state hovering active _opened".split(" "),function(m){this.watch(m,l.hitch(this,"_setStateClass"))},this);for(var n in this.cssStateNodes||{})this._trackMouseState(this[n],this.cssStateNodes[n]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(n){if(!this.disabled)switch(n.type){case "mouseover":case "MSPointerOver":case "pointerover":this._set("hovering",
!0);this._set("active",this._mouseDown);break;case "mouseout":case "MSPointerOut":case "pointerout":this._set("hovering",!1);this._set("active",!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":this._set("active",!0);break;case "mouseup":case "dojotouchend":case "MSPointerUp":case "pointerup":case "keyup":this._set("active",!1)}},_setStateClass:function(){function n(r){m=m.concat(G.map(m,function(w){return w+r}),"dijit"+r)}var m=this.baseClass.split(" ");
this.isLeftToRight()||n("Rtl");var g="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&n(g);this.state&&n(this.state);this.selected&&n("Selected");this._opened&&n("Opened");this.disabled?n("Disabled"):this.readOnly?n("ReadOnly"):this.active?n("Active"):this.hovering&&n("Hover");this.focused&&n("Focused");g=this.stateNode||this.domNode;var a={};G.forEach(g.className.split(" "),function(r){a[r]=!0});"_stateClasses"in this&&G.forEach(this._stateClasses,function(r){delete a[r]});G.forEach(m,
function(r){a[r]=!0});var f=[],e;for(e in a)f.push(e);g.className=f.join(" ");this._stateClasses=m},_subnodeCssMouseEvent:function(n,m,g){function a(f){v.toggle(n,m+"Active",f)}if(!this.disabled&&!this.readOnly)switch(g.type){case "mouseover":case "MSPointerOver":case "pointerover":v.toggle(n,m+"Hover",!0);break;case "mouseout":case "MSPointerOut":case "pointerout":v.toggle(n,m+"Hover",!1);a(!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":a(!0);
break;case "mouseup":case "MSPointerUp":case "pointerup":case "dojotouchend":case "keyup":a(!1);break;case "focus":case "focusin":v.toggle(n,m+"Focused",!0);break;case "blur":case "focusout":v.toggle(n,m+"Focused",!1)}},_trackMouseState:function(n,m){n._cssState=m}});d(function(){function n(a,f,e){if(!e||!B.isDescendant(e,f))for(;f&&f!=e;f=f.parentNode)if(f._cssState){var r=h.getEnclosingWidget(f);r&&(f==r.domNode?r._cssMouseEvent(a):r._subnodeCssMouseEvent(f,f._cssState,a))}}var m=c.body(),g;p(m,
k.over,function(a){n(a,a.target,a.relatedTarget)});p(m,k.out,function(a){n(a,a.target,a.relatedTarget)});p(m,b.press,function(a){g=a.target;n(a,g)});p(m,b.release,function(a){n(a,g);g=null});p(m,"focusin, focusout",function(a){var f=a.target;if(f._cssState&&!f.getAttribute("widgetId")){var e=h.getEnclosingWidget(f);e&&e._subnodeCssMouseEvent(f,f._cssState,a)}})});return A})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(G,A,B,v,t,l,p,d,k,c){return A("dijit._KeyNavContainer",[k,c,d],{connectKeyNavHandlers:function(b,h){var n=this._keyNavCodes={},m=l.hitch(this,"focusPrev"),g=l.hitch(this,"focusNext");G.forEach(b,function(a){n[a]=m});G.forEach(h,function(a){n[a]=g});n[t.HOME]=l.hitch(this,"focusFirstChild");n[t.END]=l.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){v.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);G.forEach(this.getChildren(),
l.hitch(this,"_startupChild"))},addChild:function(b,h){this.inherited(arguments);this._startupChild(b)},_startupChild:function(b){b.set("tabIndex","-1")},_getFirst:function(){var b=this.getChildren();return b.length?b[0]:null},_getLast:function(){var b=this.getChildren();return b.length?b[b.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(b){return(b=
p.byNode(b))&&b.getParent()==this}})})},"dijit/_Container":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/_base/kernel"],function(G,A,B,v){return A("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode)},addChild:function(t,l){var p=this.containerNode;if(0<l){for(p=p.firstChild;0<l;)1==p.nodeType&&l--,p=p.nextSibling;p?l="before":(p=this.containerNode,l="last")}B.place(t.domNode,p,l);
this._started&&!t._started&&t.startup()},removeChild:function(t){"number"==typeof t&&(t=this.getChildren()[t]);t&&(t=t.domNode)&&t.parentNode&&t.parentNode.removeChild(t)},hasChildren:function(){return 0<this.getChildren().length},_getSiblingOfChild:function(t,l){var p=this.getChildren();t=G.indexOf(p,t);return p[t+l]},getIndexOfChild:function(t){return G.indexOf(this.getChildren(),t)}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),
function(G,A,B,v,t,l,p,d){return A("dijit._KeyNavMixin",d,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);B.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var k=this._keyNavCodes={};k[v.HOME]=t.hitch(this,"focusFirstChild");k[v.END]=t.hitch(this,"focusLastChild");k[this.isLeftToRight()?v.LEFT_ARROW:v.RIGHT_ARROW]=t.hitch(this,"_onLeftArrow");k[this.isLeftToRight()?v.RIGHT_ARROW:v.LEFT_ARROW]=t.hitch(this,"_onRightArrow");k[v.UP_ARROW]=t.hitch(this,
"_onUpArrow");k[v.DOWN_ARROW]=t.hitch(this,"_onDownArrow")}var c=this;k="string"==typeof this.childSelector?this.childSelector:t.hitch(this,"childSelector");this.own(l(this.domNode,"keypress",t.hitch(this,"_onContainerKeypress")),l(this.domNode,"keydown",t.hitch(this,"_onContainerKeydown")),l(this.domNode,"focus",t.hitch(this,"_onContainerFocus")),l(this.containerNode,l.selector(k,"focusin"),function(b){c._onChildFocus(p.getEnclosingWidget(this),b)}))},_onLeftArrow:function(){},_onRightArrow:function(){},
_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(k,c){k&&(this.focusedChild&&k!==this.focusedChild&&this._onChildBlur(this.focusedChild),
k.set("tabIndex",this.tabIndex),k.focus(c?"end":"start"))},_onContainerFocus:function(k){k.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){B.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(k){B.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(k){k&&k!=this.focusedChild&&
(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),k.set("tabIndex",this.tabIndex),this.lastFocused=k,this._set("focusedChild",k))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(k,c,b,h){k&&this.focusChild(k)},_keyboardSearchCompare:function(k,c){var b=k.domNode;k=(k.label||(b.focusNode?b.focusNode.label:"")||b.innerText||b.textContent||"").replace(/^\s+/,"").substr(0,c.length).toLowerCase();return c.length&&k==c?-1:0},_isFormElement:function(k){return"INPUT"===
k.tagName||"TEXTAREA"===k.tagName||"SELECT"===k.tagName||"BUTTON"===k.tagName},_onContainerKeydown:function(k){if(!this._isFormElement(document.activeElement)){var c=this._keyNavCodes[k.keyCode];c?(c(k,this.focusedChild),k.stopPropagation(),k.preventDefault(),this._searchString=""):k.keyCode!=v.SPACE||!this._searchTimer||k.ctrlKey||k.altKey||k.metaKey||(k.stopImmediatePropagation(),k.preventDefault(),this._keyboardSearch(k," "))}},_onContainerKeypress:function(k){this._isFormElement(document.activeElement)||
k.charCode<=v.SPACE||k.ctrlKey||k.altKey||k.metaKey||(k.preventDefault(),k.stopPropagation(),this._keyboardSearch(k,String.fromCharCode(k.charCode).toLowerCase()))},_keyboardSearch:function(k,c){var b=null,h,n=0;t.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=c;var m=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;h=this._searchString.substr(0,m);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);
var g=this.focusedChild||null;if(1==m||!g)if(g=this._getNextFocusableChild(g,1),!g)return;m=g;do{var a=this._keyboardSearchCompare(g,h);a&&0==n++&&(b=g);if(-1==a){n=-1;break}g=this._getNextFocusableChild(g,1)}while(g&&g!=m)})();this.onKeyboardSearch(b,k,h,n)},_onChildBlur:function(){},_getNextFocusableChild:function(k,c){var b=k;do{if(k)k=this._getNext(k,c);else if(k=this[0<c?"_getFirst":"_getLast"](),!k)break;if(null!=k&&k!=b&&k.isFocusable())return k}while(k!=b);return null},_getFirst:function(){return null},
_getLast:function(){return null},_getNext:function(k,c){if(k)for(k=k.domNode;k;)if((k=k[0>c?"previousSibling":"nextSibling"])&&"getAttribute"in k){var b=p.byNode(k);if(b)return b}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h){p=G("dijit.MenuItem"+(l("dojo-bidi")?
"_NoBidi":""),[d,k,c,b],{templateString:h,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(n){this._set("label",n);var m="";var g=n.search(/{\S}/);if(0<=g){m=n.charAt(g+1);var a=n.substr(0,g);n=n.substr(g+3);g=a+m+n;n=a+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+m+"\x3c/span\x3e"+n}else g=n;this.domNode.setAttribute("aria-label",g+" "+this.accelKey);this.containerNode.innerHTML=n;this._set("shortcutKey",m)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},
accelKey:"",disabled:!1,_fillContent:function(n){!n||"label"in this.params||this._set("label",n.innerHTML)},buildRendering:function(){this.inherited(arguments);B.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&B.set(this.accelKeyNode,"id",this.id+"_accel");A.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==l("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(n){}},_setSelected:function(n){v.toggle(this.domNode,"dijitMenuItemSelected",n)},setLabel:function(n){t.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.",
"","2.0");this.set("label",n)},setDisabled:function(n){t.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",n)},_setDisabledAttr:function(n){this.focusNode.setAttribute("aria-disabled",n?"true":"false");this._set("disabled",n)},_setAccelKeyAttr:function(n){this.accelKeyNode&&(this.accelKeyNode.style.display=n?"":"none",this.accelKeyNode.innerHTML=n,B.set(this.containerNode,"colSpan",n?"1":"2"));this._set("accelKey",n)}});l("dojo-bidi")&&
(p=G("dijit.MenuItem",p,{_setLabelAttr:function(n){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return p})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(G,A){return G("dijit._Contained",null,{_getSibling:function(B){var v=this.getParent();return v&&v._getSiblingOfChild&&v._getSiblingOfChild(this,"previous"==B?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},
getIndexInParent:function(){var B=this.getParent();return B&&B.getIndexOfChild?B.getIndexOfChild(this):-1}})})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,n){G=G(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(m,g,a,f,e,
r,w,H){this.point=m;this.symbol=g;this.relatedGraphic=a;this.segIndex=f;this.ptIndex=e;this.segLength=r;this.editor=w;this.map=w.map;this._scratchGL=w.toolbar._scratchGL;this._placeholder=H||!1;this._type=a.geometry.type;this._init();this._enable()},refresh:function(m){if(m||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=
this.editor=this.map=this._scratchGL=null},_init:function(){var m=new b(this.point.toJson());m=new h(m,this.symbol);switch(this._type){case "multipoint":m._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(m)}this.graphic=m},_enable:function(){var m=this.graphic.getDojoShape();m&&(m._hasMover=!0,this._moveable=this._getMoveable(m),(m=m.getEventSource())&&t.set(m,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":
"move-v"]))},_disable:function(){var m=this._moveable;if(m){B.disconnect(this._startHandle);B.disconnect(this._firstHandle);B.disconnect(this._movingHandle);B.disconnect(this._stopHandle);var g=m.shape;g&&(g=g.getEventSource())&&t.set(g,"cursor","inherit");m.destroy();this._moveable=null}},_needRefresh:function(){var m=this.graphic.getDojoShape(),g=!1;if(m)switch(this._type){case "multipoint":var a=this.relatedGraphic.getDojoShape();a&&(a=a.children[this.ptIndex],m!==a&&(this.graphic._shape=a,g=!0));
break;case "polyline":case "polygon":g=!m._hasMover}return g},_getMoveable:function(m){m=new l(m,v("mac")&&v("ff")&&!c("esri-touch")&&{leftButtonOnly:!0});this._startHandle=B.connect(m,"onMoveStart",this,this._moveStartHandler);this._firstHandle=B.connect(m,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=B.connect(m,"onMoving",this,this._movingHandler);this._stopHandle=B.connect(m,"onMoveStop",this,this._moveStopHandler);return m},_getPtIndex:function(){return this.ptIndex+(this._placeholder?
1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(m){var g=this.map;g.snappingManager&&g.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();m.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(m){var g=
m.shape,a=this._getControlEdges(),f=this._scratchGL._div,e,r=[],w=m.host.shape._wrapOffsets[0]||0;for(e=0;e<a.length;e++){var H=a[e];H.x1+=w;H.x2+=w;r.push([f.createLine({x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2}).setStroke(this.editor._lineStroke),H.x1,H.y1,H.x2,H.y2])}g._lines=r;m.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(m,g,a){g=this.map;var f;c("esri-pointer")?f=g.navigationManager.pointerEvents._processTouchEvent(a,
a):a&&"pointermove"===a.type&&(f=k.prototype._processTouchEvent.call({map:g},a,a));f&&g.snappingManager&&g.snappingManager._onSnappingMouseMoveHandler(f);a=m.shape;m=a.getTransform();a=a._lines;for(f=0;f<a.length;f++)g=a[f],g[0].setShape({x1:g[1]+m.dx,y1:g[2]+m.dy,x2:g[3],y2:g[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),m)},_moveStopHandler:function(m){m=m.shape;var g=this.editor.toolbar,a=m.getTransform(),f=this.map,e=this.graphic,r=g._geo?n.geographicToWebMercator(e.geometry):
e.geometry;g._activateScrollWheel();var w,H=m._lines;if(H){for(w=0;w<H.length;w++)H[w][0].removeShape();m._lines=null}w=!1;H=!0;var x=this._getInfo();a&&(a.dx||a.dy)?this._placeholder&&(this._placeholder=!1,w=!0):H=!1;if(f.snappingManager)var q=f.snappingManager._snappingPoint;var C=[a,p.invert(this._startTx)];q=q||f.toMap(p.multiplyPoint(C,f.toScreen(r,!0)));f.snappingManager&&f.snappingManager._killOffSnapping();m.setTransform(null);e.setGeometry(g._geo?n.webMercatorToGeographic(q,!0):q);this.constructor.onMoveStop(this,
a);g.onVertexMoveStop(this.relatedGraphic,x,a);if(!H)g.onVertexClick(this.relatedGraphic,x);if(w)g.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var m=this.map,g=this.relatedGraphic.geometry,a=this.segIndex,f=this.ptIndex,e=this.segLength,r=this._scratchGL.getNavigationTransform(),w=r.dx;r=r.dy;var H=m.toScreen(this.graphic.geometry);m=H.x-w;H=H.y-r;var x=[];g=this.editor._getControlPoints(this,g,a,f,e);g[0]&&x.push({x1:m,y1:H,x2:g[0].x-w,y2:g[0].y-r});g[1]&&x.push({x1:m,
y1:H,x2:g[1].x-w,y2:g[1].y-r});return x}});c("extend-esri")&&A.setObject("toolbars.VertexMover",G,d);A.mixin(G,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return G})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(G,A,B,v,t,l,p,d,k,c){G=G(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(b,
h,n){this._graphic=b;this._map=h;this._toolbar=n;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(b){this._editBox?(B.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=B.connect(b.getLayer(),"onDblClick",this,function(h){this._map.navigationManager.setImmediateClick(!1);h.graphic==b&&(v.stop(h),B.disconnect(this._addEditBoxHandler),
this._addEditBoxHandler=null,this._addTextBox(b))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(B.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(b,h){if(!this._editBox){if(!b.symbol.text){b.symbol.text="Tempt text";b.setSymbol(b.symbol);var n=""}var m=this._createInputTextStyle(b,this._map);""!==n&&(n=h||b.symbol.text);this._editBox=l.create("input",
{type:"text",value:n});d.set(this._editBox,m);p.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=B.connect(this._editBox,"onkeyup",A.hitch(this,function(a){a.keyCode!=k.ENTER&&a.keyCode!==k.TAB||this._disable()}));this._editBoxBlurHandler=B.connect(this._editBox,"onblur",A.hitch(this,function(a){this._disable()}));b.symbol.text="";b.setSymbol(b.symbol);b.hide();var g=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=
this._map.on("zoom-start",A.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(a){d.set(g,{left:this._editBoxLeft+a.delta.x+"px",top:this._editBoxTop+a.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(d.get(g,"left"));this._editBoxTop=parseFloat(d.get(g,"top"))});this.onEditStart(b,this._editBox);this._toolbar.onTextEditStart(b,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(B.disconnect(this._editBoxBlurHandler),
this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(B.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(b,
h){h=b.getDojoShape().getTransformedBoundingBox();var n=b.getLayer();n=n.hasLocalNavigationTransform()?{dx:0,dy:0}:n.getNavigationTransform();var m=b.symbol.font;return{"font-family":m.family,"font-size":m.size+"px","font-style":m.style,"font-variant":m.variant,"font-weight":m.weight,left:h[0].x+n.dx+"px",top:h[0].y+n.dy+"px",width:Math.abs(h[0].x-h[1].x)/Math.cos(b.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var b=this._graphic.symbol;
b.text=this._editBox.value;this._graphic.setSymbol(b)}else this._graphic.getLayer().remove(this._graphic)}});t("extend-esri")&&A.setObject("toolbars.TextEditor",G,c);return G})},"esri/tasks/geometry":function(){define("./GeometryService ./TrimExtendParameters ./BufferParameters ./AreasAndLengthsParameters ./LengthsParameters ./RelationParameters ./DensifyParameters ./GeneralizeParameters ./OffsetParameters ./DistanceParameters ./ProjectParameters".split(" "),function(){return{}})},"esri/tasks/GeometryService":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ./Task ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/jsonUtils".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g){G=G(c,{declaredClass:"esri.tasks.GeometryService",_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"densify-complete":["geometries"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],
"offset-complete":["geometries"],"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]},constructor:function(a){a=A.hitch;this._projectHandler=a(this,this._projectHandler);this._simplifyHandler=a(this,this._simplifyHandler);this._bufferHandler=a(this,this._bufferHandler);this._areasAndLengthsHandler=a(this,this._areasAndLengthsHandler);this._lengthsHandler=
a(this,this._lengthsHandler);this._labelPointsHandler=a(this,this._labelPointsHandler);this._relationHandler=a(this,this._relationHandler);this._convexHullHandler=a(this,this._convexHullHandler);this._unionHandler=a(this,this._unionHandler);this._autoCompleteHandler=a(this,this._autoCompleteHandler);this._reshapeHandler=a(this,this._reshapeHandler);this._cutHandler=a(this,this._cutHandler);this._intersectHandler=a(this,this._intersectHandler);this._differenceHandler=a(this,this._differenceHandler);
this._trimExtendHandler=a(this,this._trimExtendHandler);this._densifyHandler=a(this,this._densifyHandler);this._generalizeHandler=a(this,this._densifyHandler);this._offsetHandler=a(this,this._offsetHandler);this._distanceHandler=a(this,this._distanceHandler);this._toGeoCoordinateHandler=a(this,this._toGeoCoordinateHandler);this._fromGeoCoordinateHandler=a(this,this._fromGeoCoordinateHandler);this.registerConnectEvents()},_encodeGeometries:function(a){var f=[],e,r=a.length;for(e=0;e<r;e++)f.push(a[e].toJson());
return{geometryType:g.getJsonType(a[0]),geometries:f}},_decodeGeometries:function(a,f,e){var r=g.getGeometryType(f);a=a.geometries;var w=[],H={spatialReference:e.toJson()},x=A.mixin;B.forEach(a,function(q,C){w[C]=new r(x(q,H))});return w},_toProjectGeometry:function(a){var f=a.spatialReference.toJson();return a instanceof b?new n({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:f}):new h({paths:[[].concat(a.points)],spatialReference:f})},
_fromProjectedGeometry:function(a,f,e){return"esriGeometryEnvelope"===f?(a=a.rings[0],new b(a[0][0],a[0][1],a[2][0],a[2][1],e)):new m({points:a.paths[0],spatialReference:e.toJson()})},project:function(a,f,e,r){var w=A.mixin({},this._url.query,{f:"json"});if(a.geometries){r=e;e=f;f=a.outSR;var H=a.geometries[0];w=A.mixin(w,a.toJson())}else H=a[0],w=A.mixin(w,{outSR:f.wkid||v.toJson(f.toJson()),inSR:H.spatialReference.wkid||v.toJson(H.spatialReference.toJson()),geometries:v.toJson(this._encodeGeometries(a))});
var x=g.getJsonType(H),q=this._projectHandler,C=this._errorHandler,F=new t(k._dfdCanceller);F._pendingDfd=d({url:this._url.path+"/project",content:w,callbackParamName:"callback",load:function(u,E){q(u,E,x,f,e,r,F)},error:function(u){C(u,r,F)}});return F},_projectHandler:function(a,f,e,r,w,H,x){try{var q=this._decodeGeometries(a,e,r);this._successHandler([q],"onProjectComplete",w,x)}catch(C){this._errorHandler(C,H,x)}},onProjectComplete:function(){},simplify:function(a,f,e){var r=a[0].spatialReference,
w=A.mixin({},this._url.query,{f:"json",sr:r.wkid?r.wkid:v.toJson(r.toJson()),geometries:v.toJson(this._encodeGeometries(a))}),H=g.getJsonType(a[0]),x=this._simplifyHandler,q=this._errorHandler,C=new t(k._dfdCanceller);C._pendingDfd=d({url:this._url.path+"/simplify",content:w,callbackParamName:"callback",load:function(F,u){x(F,u,H,r,f,e,C)},error:function(F){q(F,e,C)}});return C},_simplifyHandler:function(a,f,e,r,w,H,x){try{var q=this._decodeGeometries(a,e,r);this._successHandler([q],"onSimplifyComplete",
w,x)}catch(C){this._errorHandler(C,H,x)}},onSimplifyComplete:function(){},convexHull:function(a,f,e){var r=a[0].spatialReference;a=A.mixin({},this._url.query,{f:"json",sr:v.toJson(r.toJson()),geometries:v.toJson(this._encodeGeometries(a))});var w=this._convexHullHandler,H=this._errorHandler,x=new t(k._dfdCanceller);x._pendingDfd=d({url:this._url.path+"/convexHull",content:a,callbackParamName:"callback",load:function(q,C){w(q,C,r,f,e,x)},error:function(q){H(q,e,x)}});return x},_convexHullHandler:function(a,
f,e,r,w,H){try{var x=g.fromJson(a.geometry).setSpatialReference(e);this._successHandler([x],"onConvexHullComplete",r,H)}catch(q){this._errorHandler(q,w,H)}},onConvexHullComplete:function(){},union:function(a,f,e){var r=a[0].spatialReference;a=A.mixin({},this._url.query,{f:"json",sr:v.toJson(r.toJson()),geometries:v.toJson(this._encodeGeometries(a))});var w=this._unionHandler,H=this._errorHandler,x=new t(k._dfdCanceller);x._pendingDfd=d({url:this._url.path+"/union",content:a,callbackParamName:"callback",
load:function(q,C){w(q,C,r,f,e,x)},error:function(q){H(q,e,x)}});return x},_unionHandler:function(a,f,e,r,w,H){try{var x=g.fromJson(a.geometry).setSpatialReference(e);this._successHandler([x],"onUnionComplete",r,H)}catch(q){this._errorHandler(q,w,H)}},onUnionComplete:function(){},autoComplete:function(a,f,e,r){var w=a[0].spatialReference;a=A.mixin({},this._url.query,{f:"json",sr:v.toJson(w.toJson()),polygons:v.toJson(this._encodeGeometries(a).geometries),polylines:v.toJson(this._encodeGeometries(f).geometries)});
var H=this._autoCompleteHandler,x=this._errorHandler,q=new t(k._dfdCanceller);q._pendingDfd=d({url:this._url.path+"/autoComplete",content:a,callbackParamName:"callback",load:function(C,F){H(C,F,w,e,r,q)},error:function(C){x(C,r,q)}});return q},_autoCompleteHandler:function(a,f,e,r,w,H){try{var x=a.geometries;a=[];var q,C=x.length;for(q=0;q<C;q++)a[q]=new n({spatialReference:e,rings:x[q].rings});this._successHandler([a],"onAutoCompleteComplete",r,H)}catch(F){this._errorHandler(F,w,H)}},onAutoCompleteComplete:function(){},
reshape:function(a,f,e,r){var w=a.spatialReference;a=A.mixin({},this._url.query,{f:"json",sr:v.toJson(w.toJson()),target:v.toJson({geometryType:g.getJsonType(a),geometry:a.toJson()}),reshaper:v.toJson(f.toJson())});var H=this._reshapeHandler,x=this._errorHandler,q=new t(k._dfdCanceller);q._pendingDfd=d({url:this._url.path+"/reshape",content:a,callbackParamName:"callback",load:function(C,F){H(C,F,w,e,r,q)},error:function(C){x(C,r,q)}});return q},_reshapeHandler:function(a,f,e,r,w,H){try{var x=g.fromJson(a.geometry).setSpatialReference(e);
this._successHandler([x],"onReshapeComplete",r,H)}catch(q){this._errorHandler(q,w,H)}},onReshapeComplete:function(){},cut:function(a,f,e,r){var w=a[0].spatialReference,H=B.map(a,function(F){return F.toJson()});a=A.mixin({},this._url.query,{f:"json",sr:v.toJson(w.toJson()),target:v.toJson({geometryType:g.getJsonType(a[0]),geometries:H}),cutter:v.toJson(f.toJson())});var x=this._cutHandler,q=this._errorHandler,C=new t(k._dfdCanceller);C._pendingDfd=d({url:this._url.path+"/cut",content:a,callbackParamName:"callback",
load:function(F,u){x(F,u,w,e,r,C)},error:function(F){q(F,r,C)}});return C},_cutHandler:function(a,f,e,r,w,H){try{var x=a.geometries,q={};q.cutIndexes=a.cutIndexes;q.geometries=[];B.forEach(x,function(C){q.geometries.push(g.fromJson(C).setSpatialReference(e))});this._successHandler([q],"onCutComplete",r,H)}catch(C){this._errorHandler(C,w,H)}},onCutComplete:function(){},intersect:function(a,f,e,r){var w=a[0].spatialReference;a=A.mixin({},this._url.query,{f:"json",sr:v.toJson(w.toJson()),geometries:v.toJson(this._encodeGeometries(a)),
geometry:v.toJson({geometryType:g.getJsonType(f),geometry:f.toJson()})});var H=this._intersectHandler,x=this._errorHandler,q=new t(k._dfdCanceller);q._pendingDfd=d({url:this._url.path+"/intersect",content:a,callbackParamName:"callback",load:function(C,F){H(C,F,w,e,r,q)},error:function(C){x(C,r,q)}});return q},_intersectHandler:function(a,f,e,r,w,H){try{var x=[];B.forEach(a.geometries,function(q){x.push(g.fromJson(q).setSpatialReference(e))});this._successHandler([x],"onIntersectComplete",r,H)}catch(q){this._errorHandler(q,
w,H)}},onIntersectComplete:function(){},difference:function(a,f,e,r){var w=a[0].spatialReference;a=A.mixin({},this._url.query,{f:"json",sr:v.toJson(w.toJson()),geometries:v.toJson(this._encodeGeometries(a)),geometry:v.toJson({geometryType:g.getJsonType(f),geometry:f.toJson()})});var H=this._differenceHandler,x=this._errorHandler,q=new t(k._dfdCanceller);q._pendingDfd=d({url:this._url.path+"/difference",content:a,callbackParamName:"callback",load:function(C,F){H(C,F,w,e,r,q)},error:function(C){x(C,
r,q)}});return q},_differenceHandler:function(a,f,e,r,w,H){try{var x=[];B.forEach(a.geometries,function(q){x.push(g.fromJson(q).setSpatialReference(e))});this._successHandler([x],"onDifferenceComplete",r,H)}catch(q){this._errorHandler(q,w,H)}},onDifferenceComplete:function(){},buffer:function(a,f,e){var r=A.mixin({},this._url.query,{f:"json"},a.toJson()),w=a.outSpatialReference||a.geometries[0].spatialReference,H=this._bufferHandler,x=this._errorHandler,q=new t(k._dfdCanceller);q._pendingDfd=d({url:this._url.path+
"/buffer",content:r,callbackParamName:"callback",load:function(C,F){H(C,F,w,f,e,q)},error:function(C){x(C,e,q)}});return q},_bufferHandler:function(a,f,e,r,w,H){try{var x=a.geometries;a=[];var q,C=x.length;for(q=0;q<C;q++)a[q]=new n({spatialReference:e,rings:x[q].rings});this._successHandler([a],"onBufferComplete",r,H)}catch(F){this._errorHandler(F,w,H)}},onBufferComplete:function(){},areasAndLengths:function(a,f,e){a=A.mixin({},this._url.query,{f:"json"},a.toJson());var r=this._areasAndLengthsHandler,
w=this._errorHandler,H=new t(k._dfdCanceller);H._pendingDfd=d({url:this._url.path+"/areasAndLengths",content:a,callbackParamName:"callback",load:function(x,q){r(x,q,f,e,H)},error:function(x){w(x,e,H)}});return H},_areasAndLengthsHandler:function(a,f,e,r,w){try{this._successHandler([a],"onAreasAndLengthsComplete",e,w)}catch(H){this._errorHandler(H,r,w)}},onAreasAndLengthsComplete:function(){},lengths:function(a,f,e){a=A.mixin({},this._url.query,{f:"json"},a.toJson());var r=this._lengthsHandler,w=this._errorHandler,
H=new t(k._dfdCanceller);H._pendingDfd=d({url:this._url.path+"/lengths",content:a,callbackParamName:"callback",load:function(x,q){r(x,q,f,e,H)},error:function(x){w(x,e,H)}});return H},_lengthsHandler:function(a,f,e,r,w){try{this._successHandler([a],"onLengthsComplete",e,w)}catch(H){this._errorHandler(H,r,w)}},onLengthsComplete:function(){},labelPoints:function(a,f,e){var r=B.map(a,function(C){return C.toJson()}),w=a[0].spatialReference;r=A.mixin({},this._url.query,{f:"json",sr:w.wkid?w.wkid:v.toJson(w.toJson()),
polygons:v.toJson(r)});var H=this._labelPointsHandler,x=this._errorHandler,q=new t(k._dfdCanceller);q._pendingDfd=d({url:this._url.path+"/labelPoints",content:r,callbackParamName:"callback",load:function(C,F){H(C,F,a,w,f,e,q)},error:function(C){x(C,e,q)}});return q},_labelPointsHandler:function(a,f,e,r,w,H,x){try{var q=[];B.forEach(a.labelPoints,function(C){q.push(g.fromJson(C).setSpatialReference(r))});this._successHandler([q],"onLabelPointsComplete",w,x)}catch(C){this._errorHandler(C,H,x)}},onLabelPointsComplete:function(){},
relation:function(a,f,e){a=A.mixin({},this._url.query,{f:"json"},a.toJson());var r=this._relationHandler,w=this._errorHandler,H=new t(k._dfdCanceller);H._pendingDfd=d({url:this._url.path+"/relation",content:a,callbackParamName:"callback",load:function(x,q){r(x,q,f,e,H)},error:function(x){w(x,e,H)}});return H},_relationHandler:function(a,f,e,r,w){try{this._successHandler([a.relations],"onRelationComplete",e,w)}catch(H){this._errorHandler(H,r,w)}},onRelationComplete:function(){},trimExtend:function(a,
f,e){var r=A.mixin({},this._url.query,{f:"json"},a.toJson()),w=a.sr,H=this._trimExtendHandler,x=this._errorHandler,q=new t(k._dfdCanceller);q._pendingDfd=d({url:this._url.path+"/trimExtend",content:r,callbackParamName:"callback",load:function(C,F){H(C,F,w,f,e,q)},error:function(C){x(C,e,q)}});return q},_trimExtendHandler:function(a,f,e,r,w,H){try{var x=a.geometries;a=[];var q,C=x.length;for(q=0;q<C;q++)a[q]=new h({spatialReference:e,paths:x[q].paths});this._successHandler([a],"onTrimExtendComplete",
r,H)}catch(F){this._errorHandler(F,w,H)}},onTrimExtendComplete:function(){},densify:function(a,f,e){var r=A.mixin({},this._url.query,{f:"json"},a.toJson()),w=a.geometries[0].spatialReference,H=this._densifyHandler,x=this._errorHandler,q=new t(k._dfdCanceller);q._pendingDfd=d({url:this._url.path+"/densify",content:r,callbackParamName:"callback",load:function(C,F){H(C,F,w,f,e,q)},error:function(C){x(C,e,q)}});return q},_densifyHandler:function(a,f,e,r,w,H){try{var x=[];B.forEach(a.geometries,function(q){x.push(g.fromJson(q).setSpatialReference(e))});
this._successHandler([x],"onDensifyComplete",r,H)}catch(q){this._errorHandler(q,w,H)}},onDensifyComplete:function(){},generalize:function(a,f,e){var r=A.mixin({},this._url.query,{f:"json"},a.toJson()),w=a.geometries[0].spatialReference,H=this._generalizeHandler,x=this._errorHandler,q=new t(k._dfdCanceller);q._pendingDfd=d({url:this._url.path+"/generalize",content:r,callbackParamName:"callback",load:function(C,F){H(C,F,w,f,e,q)},error:function(C){x(C,e,q)}});return q},_generalizeHandler:function(a,
f,e,r,w,H){try{var x=[];B.forEach(a.geometries,function(q){x.push(g.fromJson(q).setSpatialReference(e))});this._successHandler([x],"onGeneralizeComplete",r,H)}catch(q){this._errorHandler(q,w,H)}},onGeneralizeComplete:function(){},offset:function(a,f,e){var r=A.mixin({},this._url.query,{f:"json"},a.toJson()),w=a.geometries[0].spatialReference,H=this._offsetHandler,x=this._errorHandler,q=new t(k._dfdCanceller);q._pendingDfd=d({url:this._url.path+"/offset",content:r,callbackParamName:"callback",load:function(C,
F){H(C,F,w,f,e,q)},error:function(C){x(C,e,q)}});return q},_offsetHandler:function(a,f,e,r,w,H){try{var x=[];B.forEach(a.geometries,function(q){x.push(g.fromJson(q).setSpatialReference(e))});this._successHandler([x],"onOffsetComplete",r,H)}catch(q){this._errorHandler(q,w,H)}},onOffsetComplete:function(){},distance:function(a,f,e){var r=A.mixin({},this._url.query,{f:"json"},a.toJson()),w=a.geometry1.spatialReference,H=this._distanceHandler,x=this._errorHandler,q=new t(k._dfdCanceller);q._pendingDfd=
d({url:this._url.path+"/distance",content:r,callbackParamName:"callback",load:function(C,F){H(C,F,w,f,e,q)},error:function(C){x(C,e,q)}});return q},_distanceHandler:function(a,f,e,r,w,H){try{a=a&&a.distance,this._successHandler([a],"onDistanceComplete",r,H)}catch(x){this._errorHandler(x,w,H)}},onDistanceComplete:function(){},toGeoCoordinateString:function(a,f,e){var r={};A.isObject(a.sr)?r.sr=a.sr.wkid||v.toJson(a.sr.toJson()):r.sr=a.sr;r.coordinates=v.toJson(a.coordinates);r.conversionType=a.conversionType||
"MGRS";r.conversionMode=a.conversionMode;r.numOfDigits=a.numOfDigits;r.rounding=a.rounding;r.addSpaces=a.addSpaces;a=A.mixin({},this._url.query,{f:"json"},r);var w=this._toGeoCoordinateHandler,H=this._errorHandler,x=new t(k._dfdCanceller);x._pendingDfd=d({url:this._url.path+"/toGeoCoordinateString",content:a,callbackParamName:"callback",load:function(q,C){w(q,C,f,e,x)},error:function(q){H(q,e,x)}});return x},_toGeoCoordinateHandler:function(a,f,e,r,w){try{this._successHandler([a.strings],"onToGeoCoordinateStringComplete",
e,w)}catch(H){this._errorHandler(H,r,w)}},onToGeoCoordinateStringComplete:function(){},fromGeoCoordinateString:function(a,f,e){var r={};A.isObject(a.sr)?r.sr=a.sr.wkid||v.toJson(a.sr.toJson()):r.sr=a.sr;r.strings=v.toJson(a.strings);r.conversionType=a.conversionType||"MGRS";r.conversionMode=a.conversionMode;a=A.mixin({},this._url.query,{f:"json"},r);var w=this._fromGeoCoordinateHandler,H=this._errorHandler,x=new t(k._dfdCanceller);x._pendingDfd=d({url:this._url.path+"/fromGeoCoordinateString",content:a,
callbackParamName:"callback",load:function(q,C){w(q,C,f,e,x)},error:function(q){H(q,e,x)}});return x},_fromGeoCoordinateHandler:function(a,f,e,r,w){try{this._successHandler([a.coordinates],"onToGeoCoordinateStringComplete",e,w)}catch(H){this._errorHandler(H,r,w)}},onFromGeoCoordinateStringComplete:function(){}});A.mixin(G,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,
UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,
UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,
UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",
UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});l("extend-esri")&&A.setObject("tasks.GeometryService",G,p);return G})},"esri/tasks/TrimExtendParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel".split(" "),function(G,A,B,v,t,l){G=G(null,{declaredClass:"esri.tasks.TrimExtendParameters",
polylines:null,trimExtendTo:null,extendHow:null,toJson:function(){var p=B.map(this.polylines,function(k){return k.toJson()}),d={};d.polylines=v.toJson(p);d.trimExtendTo=v.toJson(this.trimExtendTo.toJson());d.sr=v.toJson(this.polylines[0].spatialReference.toJson());d.extendHow=this.extendHow||0;return d}});A.mixin(G,{DEFAULT_CURVE_EXTENSION:0,RELOCATE_ENDS:1,KEEP_END_ATTRIBUTES:2,NO_END_ATTRIBUTES:4,NO_EXTEND_AT_FROM:8,NO_EXTEND_AT_TO:16});t("extend-esri")&&A.setObject("tasks.TrimExtendParameters",
G,l);return G})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(G,A,B,v,t,l,p,d){G=G(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var k={unit:this.unit,unionResults:this.unionResults,geodesic:this.geodesic},
c=this.distances,b=this.outSpatialReference,h=this.bufferSpatialReference,n=B.map(this.geometries,function(a){a="extent"===a.type?p.fromExtent(a):a;return a.toJson()},this),m=this.geometries;if(m&&0<m.length){var g="extent"===m[0].type?"esriGeometryPolygon":d.getJsonType(m[0]);k.geometries=v.toJson({geometryType:g,geometries:n});k.inSR=m[0].spatialReference.wkid?m[0].spatialReference.wkid:v.toJson(m[0].spatialReference.toJson())}c&&(k.distances=c.join(","));b&&(k.outSR=b.wkid?b.wkid:v.toJson(b.toJson()));
h&&(k.bufferSR=h.wkid?h.wkid:v.toJson(h.toJson()));return k}});t("extend-esri")&&A.setObject("tasks.BufferParameters",G,l);return G})},"esri/tasks/AreasAndLengthsParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel".split(" "),function(G,A,B,v,t,l){G=G(null,{declaredClass:"esri.tasks.AreasAndLengthsParameters",polygons:null,lengthUnit:null,areaUnit:null,calculationType:null,toJson:function(){var p=B.map(this.polygons,function(k){return k.toJson()}),
d={};d.polygons=v.toJson(p);p=this.polygons[0].spatialReference;d.sr=p.wkid?p.wkid:v.toJson(p.toJson());this.lengthUnit&&(d.lengthUnit=this.lengthUnit);this.areaUnit&&(A.isString(this.areaUnit)?d.areaUnit=v.toJson({areaUnit:this.areaUnit}):d.areaUnit=this.areaUnit);this.calculationType&&(d.calculationType=this.calculationType);return d}});t("extend-esri")&&A.setObject("tasks.AreasAndLengthsParameters",G,l);return G})},"esri/tasks/LengthsParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel".split(" "),
function(G,A,B,v,t,l){G=G(null,{declaredClass:"esri.tasks.LengthsParameters",polylines:null,lengthUnit:null,geodesic:null,calculationType:null,toJson:function(){var p=B.map(this.polylines,function(k){return k.toJson()}),d={};d.polylines=v.toJson(p);p=this.polylines[0].spatialReference;d.sr=p.wkid?p.wkid:v.toJson(p.toJson());this.lengthUnit&&(d.lengthUnit=this.lengthUnit);this.geodesic&&(d.geodesic=this.geodesic);this.calculationType&&(d.calculationType=this.calculationType);return d}});t("extend-esri")&&
A.setObject("tasks.LengthsParameters",G,l);return G})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(G,A,B,v,t,l,p){G=G(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var d=B.map(this.geometries1,function(h){return h.toJson()}),k=B.map(this.geometries2,function(h){return h.toJson()}),
c={},b=this.geometries1;b&&0<b.length&&(c.geometries1=v.toJson({geometryType:p.getJsonType(b[0]),geometries:d}),d=this.geometries1[0].spatialReference,c.sr=d.wkid?d.wkid:v.toJson(d.toJson()));(d=this.geometries2)&&0<d.length&&(c.geometries2=v.toJson({geometryType:p.getJsonType(d[0]),geometries:k}));this.relation&&(c.relation=this.relation);this.relationParam&&(c.relationParam=this.relationParam);return c}});A.mixin(G,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",
SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});
t("extend-esri")&&A.setObject("tasks.RelationParameters",G,l);return G})},"esri/tasks/DensifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(G,A,B,v,t,l,p){G=G(null,{declaredClass:"esri.tasks.DensifyParameters",geometries:null,geodesic:null,lengthUnit:null,maxSegmentLength:null,toJson:function(){var d=B.map(this.geometries,function(c){return c.toJson()}),k={};this.geometries&&0<this.geometries.length&&
(k.geometries=v.toJson({geometryType:p.getJsonType(this.geometries[0]),geometries:d}),k.sr=v.toJson(this.geometries[0].spatialReference.toJson()));this.geodesic&&(k.geodesic=this.geodesic);this.lengthUnit&&(k.lengthUnit=this.lengthUnit);this.maxSegmentLength&&(k.maxSegmentLength=this.maxSegmentLength);return k}});t("extend-esri")&&A.setObject("tasks.DensifyParameters",G,l);return G})},"esri/tasks/GeneralizeParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(G,A,B,v,t,l,p){G=G(null,{declaredClass:"esri.tasks.GeneralizeParameters",geometries:null,deviationUnit:null,maxDeviation:null,toJson:function(){var d=B.map(this.geometries,function(c){return c.toJson()}),k={};this.geometries&&0<this.geometries.length&&(k.geometries=v.toJson({geometryType:p.getJsonType(this.geometries[0]),geometries:d}),k.sr=v.toJson(this.geometries[0].spatialReference.toJson()));this.deviationUnit&&(k.deviationUnit=this.deviationUnit);this.maxDeviation&&(k.maxDeviation=this.maxDeviation);
return k}});t("extend-esri")&&A.setObject("tasks.GeneralizeParameters",G,l);return G})},"esri/tasks/OffsetParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(G,A,B,v,t,l,p){G=G(null,{declaredClass:"esri.tasks.OffsetParameters",geometries:null,bevelRatio:null,offsetDistance:null,offsetHow:null,offsetUnit:null,toJson:function(){var d=B.map(this.geometries,function(c){return c.toJson()}),k={};
this.geometries&&0<this.geometries.length&&(k.geometries=v.toJson({geometryType:p.getJsonType(this.geometries[0]),geometries:d}),k.sr=v.toJson(this.geometries[0].spatialReference.toJson()));this.bevelRatio&&(k.bevelRatio=this.bevelRatio);this.offsetDistance&&(k.offsetDistance=this.offsetDistance);this.offsetHow&&(k.offsetHow=this.offsetHow);this.offsetUnit&&(k.offsetUnit=this.offsetUnit);return k}});A.mixin(G,{OFFSET_BEVELLED:"esriGeometryOffsetBevelled",OFFSET_MITERED:"esriGeometryOffsetMitered",
OFFSET_ROUNDED:"esriGeometryOffsetRounded"});t("extend-esri")&&A.setObject("tasks.OffsetParameters",G,l);return G})},"esri/tasks/DistanceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(G,A,B,v,t,l){G=G(null,{declaredClass:"esri.tasks.DistanceParameters",geometry1:null,geometry2:null,distanceUnit:null,geodesic:null,toJson:function(){var p={},d=this.geometry1;d&&(p.geometry1=B.toJson({geometryType:l.getJsonType(d),
geometry:d}));if(d=this.geometry2)p.geometry2=B.toJson({geometryType:l.getJsonType(d),geometry:d});p.sr=B.toJson(this.geometry1.spatialReference.toJson());this.distanceUnit&&(p.distanceUnit=this.distanceUnit);this.geodesic&&(p.geodesic=this.geodesic);return p}});v("extend-esri")&&A.setObject("tasks.DistanceParameters",G,t);return G})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),
function(G,A,B,v,t,l,p,d){G=G(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var k=B.map(this.geometries,function(b){return b.toJson()}),c={};c.outSR=this.outSR.wkid||v.toJson(this.outSR.toJson());c.inSR=this.geometries[0].spatialReference.wkid||v.toJson(this.geometries[0].spatialReference.toJson());c.geometries=v.toJson({geometryType:d.getJsonType(this.geometries[0]),geometries:k});this.transformation&&(c.transformation=
this.transformation.wkid||v.toJson(this.transformation));p.isDefined(this.transformForward)&&(c.transformForward=this.transformForward);return c}});t("extend-esri")&&A.setObject("tasks.ProjectParameters",G,l);return G})},"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e,r,w,H,x,q,C,F,u,E,D,M,I,z,K,L,N,P,T,S,Z,da,Q,W){var aa=G([q,e,r],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:W,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,
_currentFeature:null,_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},_defaultRichTextPlugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),css:{label:"atiLabel",field:"atiField",textArea:"atiTextAreaField",richText:"atiRichTextField",attachmentEditor:"atiAttachmentEditor",
red:"atiRequiredField"},constructor:function(R,V){A.mixin(this,g.widgets.attributeInspector);R=R||{};R.featureLayer||R.layerInfos||console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(R);this._layerInfos=R.layerInfos||[{featureLayer:R.featureLayer,options:R.options||[]}];this._layerInfos=B.filter(this._layerInfos,function(ba){return!ba.disableAttributeUpdate});this._hideNavButtons=R.hideNavButtons||!1},postCreate:function(){if(B.every(this._layerInfos,
function(V){return V.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var R=this._layerInfos.length;B.forEach(this._layerInfos,function(V){V=V.featureLayer;if(V.loaded)R--;else var ba=v.connect(V,"onLoad",this,function(ha){v.disconnect(ba);ba=null;R--;R||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();B.forEach(this._aiConnects,v.disconnect);delete this._aiConnects;
this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(R,V){V&&(this._createOnlyFirstTime=!0);
this._updateSelection([R],V);this._updateUI()},onLayerSelectionChange:function(R,V,ba){this._createOnlyFirstTime=!1;this._featureIdx=ba===m.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){!this._selection||0>=this._selection.length||(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(R,V,ba,ha){},onLayerError:function(R,V,ba,ha){},onLayerEditsError:function(R,
V,ba,ha){},onLayerEditsComplete:function(R,V,ba,ha){ha=ha||[];if(ha.length){var qa=this._selection,va=R.featureLayer.objectIdField;B.forEach(ha,A.hitch(this,function(Ba){B.some(qa,A.hitch(this,function(Aa,X){if(Aa.attributes[va]!==Ba.objectId)return!1;this._selection.splice(X,1);return!0}))}))}V=V||[];V.length&&(this._selection=F.findFeatures(V,R.featureLayer),this._featureIdx=0);ha=this._numFeatures=(this._selection=F.sortFeaturesById(this._layerInfos,this._selection))?this._selection.length:0;if(V.length){if(V=
ha?this._selection[this._featureIdx]:null)ha=V.getLayer().getEditCapabilities(),ha.canCreate&&!ha.canUpdate||this._showFeature(V);this._updateUI()}ba=ba||[];if(ba.length){var sa=this._rollbackInfo;B.forEach(ba,function(Ba){var Aa=F.findFeatures(ba,R.featureLayer)[0];if(!Ba.success&&Aa.attributes[R.featureLayer.objectIdField]===Ba.objectId&&sa){var X=sa.field;Ba=sa.graphic.attributes[X.name];var ea=B.filter(this._currentLInfo.fieldInfos,function(ia){return ia.fieldName===X.name},this)[0].dijit;Aa.attributes[X.name]=
Ba;"esriFieldTypeDate"===X.type&&(Ba=new Date(Ba));this._setValue(ea,Ba)}},this)}this._rollbackInfo=null},onFieldValueChange:function(R,V){var ba=R.field,ha=R.dijit,qa=this._currentFeature,va=this._currentLInfo,sa=ba.name;R=this._isFieldRequired(ba,R);if(""===ha.displayedValue||"dijit.form.ValidationTextBox"!==ha.declaredClass||ha.isValid())if(""!==ha.displayedValue&&ha.displayedValue!==V&&ha.isValid&&!ha.isValid())this._setValue(ha,qa.attributes[ba.name]);else{var Ba=!("esriFieldTypeInteger"!==ba.type&&
"esriFieldTypeSmallInteger"!==ba.type&&"esriFieldTypeSingle"!==ba.type&&"esriFieldTypeDouble"!==ba.type);if(R&&(null===V||""===V||"undefined"===typeof V||Ba&&isNaN(V))){sa=qa.attributes[ba.name];if("esriFieldTypeDate"===ba.type&&(sa=new Date(sa),ha instanceof Array)){this._setValue(ha[0],sa);this._setValue(ha[1],sa);return}this._setValue(ha,sa)}else{if(Ba){if(isNaN(V)||""===V)V=null;Ba&&null!==V&&(V=Number(V))}"esriFieldTypeDate"===ba.type&&(ha instanceof Array?(V=ha[0].getValue(),ha=ha[1].getValue(),
V=V&&ha?new Date(V.getFullYear(),V.getMonth(),V.getDate(),ha.getHours(),ha.getMinutes(),ha.getSeconds(),ha.getMilliseconds()):V||ha||null):(V=ha.getValue(),ba.domain&&(V=Number(V))),V=V&&V.getTime?V.getTime():V&&V.toGregorian?V.toGregorian().getTime():V);if(this._currentFeature.attributes[ba.name]!==V){if(sa===va.typeIdField){var Aa=this._findFirst(va.types,"id",V);B.forEach(va.fieldInfos,function(X){(ba=X.field)&&ba.name!==va.typeIdField&&(X=X.dijit,this._setFieldDomain(X,Aa,ba)&&X&&(this._setValue(X,
qa.attributes[ba.name]+""),!1===X.isValid()&&this._setValue(X,null)))},this)}this.onAttributeChange(qa,sa,V)}}}else this._setValue(ha,qa.attributes[ba.name])},onDeleteBtn:function(R){this._deleteFeature()},onNextFeature:function(R){this._onNextFeature(1)},onPreviousFeature:function(R){this._onNextFeature(-1)},onFirstFeature:function(R){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(R){this._onNextFeature(this._numFeatures-1-this._featureIdx)},_initLayerInfos:function(){var R=this._layerInfos;
this._editorTrackingInfos={};B.forEach(R,this._initLayerInfo,this)},_initLayerInfo:function(R){var V=R.featureLayer,ba;this._userIds={};var ha=V.id;V.credential&&(this._userIds[ha]=V.credential.userId);R.userId&&(this._userIds[ha]=R.userId);this._connect(V,"onSelectionComplete",A.hitch(this,"onLayerSelectionChange",R));this._connect(V,"onSelectionClear",A.hitch(this,"onLayerSelectionClear",R));this._connect(V,"onEditsComplete",A.hitch(this,"onLayerEditsComplete",R));this._connect(V,"error",A.hitch(this,
"onLayerError",R));this._connect(V,"onUpdateEnd",A.hitch(this,"onLayerUpdateEnd",R));R.showAttachments=V.hasAttachments?b.isDefined(R.showAttachments)?R.showAttachments:!0:!1;R.hideFields=R.hideFields||[];R.htmlFields=R.htmlFields||[];R.isEditable=V.isEditable()?b.isDefined(R.isEditable)?R.isEditable:!0:!1;R.typeIdField=V.typeIdField;R.layerId=V.id;R.types=V.types;V.globalIdField&&((ba=this._findFirst(R.fieldInfos,"fieldName",V.globalIdField))||R.showGlobalID||R.hideFields.push(V.globalIdField));
(ha=this._findFirst(R.fieldInfos,"fieldName",V.objectIdField))||R.showObjectID||R.hideFields.push(V.objectIdField);var qa=this._getFields(R.featureLayer);if(qa){var va=R.fieldInfos||[];va=B.map(va,function(sa){return A.mixin({},sa)});va.length?R.fieldInfos=B.filter(B.map(va,A.hitch(this,function(sa){var Ba=sa.stringFieldOption||(this._isInFields(sa.fieldName,R.htmlFields)?aa.STRING_FIELD_OPTION_RICHTEXT:aa.STRING_FIELD_OPTION_TEXTBOX);return A.mixin(sa,{field:this._findFirst(qa,"name",sa.fieldName),
stringFieldOption:Ba})})),"return item.field;"):(qa=B.filter(qa,A.hitch(this,function(sa){return!this._isInFields(sa.name,R.hideFields)})),R.fieldInfos=B.map(qa,A.hitch(this,function(sa){var Ba=this._isInFields(sa.name,R.htmlFields)?aa.STRING_FIELD_OPTION_RICHTEXT:aa.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:sa.name,field:sa,stringFieldOption:Ba}})));R.showGlobalID&&!ba&&va.push(this._findFirst(qa,"name",V.globalIdField));R.showObjectID&&!ha&&va.push(this._findFirst(qa,"name",V.objectIdField));
ba=[];V.editFieldsInfo&&(V.editFieldsInfo.creatorField&&ba.push(V.editFieldsInfo.creatorField),V.editFieldsInfo.creationDateField&&ba.push(V.editFieldsInfo.creationDateField),V.editFieldsInfo.editorField&&ba.push(V.editFieldsInfo.editorField),V.editFieldsInfo.editDateField&&ba.push(V.editFieldsInfo.editDateField));this._editorTrackingInfos[V.id]=ba}},_createAttachmentEditor:function(){this._attachmentEditor=null;var R=B.filter(this._layerInfos,function(V){return V.showAttachments});R&&R.length&&(this._attachmentEditor=
new C({"class":this.css.attachmentEditor},this.attachmentEditor),this._attachmentEditor.startup())},_setCurrentLInfo:function(R){var V=this._currentLInfo?this._currentLInfo.featureLayer:null,ba=R.featureLayer;if(V&&V.id===ba.id&&!V.ownershipBasedAccessControlForFeatures&&(V=ba.getEditCapabilities(),!V.canCreate||V.canUpdate))return;this._currentLInfo=R;this._createTable()},_updateSelection:function(R,V){this._selection=R||[];B.forEach(this._layerInfos,this._getSelection,this);this._selection=F.sortFeaturesById(this._layerInfos,
this._selection);this._numFeatures=this._selection.length;this._showFeature(this._numFeatures?this._selection[this._featureIdx]:null,V)},_getSelection:function(R){R=R.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(R)},_updateUI:function(){var R=this._numFeatures,V=this._currentLInfo;this.layerName.innerHTML=V&&0!==R?V.featureLayer?V.featureLayer.name:"":this.NLS_noFeaturesSelected;d.set(this.attributeTable,"display",R?"":"none");d.set(this.editButtons,"display",R?"":"none");
d.set(this.navButtons,"display",!this._hideNavButtons&&1<R?"":"none");this.navMessage.innerHTML=b.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&d.set(this._attachmentEditor.domNode,"display",V&&V.showAttachments&&R?"":"none");d.set(this.deleteBtn.domNode,"display",V&&!1===V.showDeleteButton||!this._canDelete?"none":"");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(R){this._featureIdx+=
R;0>this._featureIdx?this._featureIdx=this._numFeatures-1:this._featureIdx>=this._numFeatures&&(this._featureIdx=0);R=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(R);this._updateUI();this.onNext(R)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(R,V){if(R){this._currentFeature=R;V=V?V:R.getLayer();var ba=V.getEditCapabilities({feature:R,userId:this._userIds[V.id]});this._canUpdate=ba.canUpdate;this._canDelete=ba.canDelete;if(ba=
this._getLInfoFromFeatureLayer(V)){this._setCurrentLInfo(ba);var ha=R.attributes,qa=this._findFirst(ba.types,"id",ha[ba.typeIdField]),va=null;B.forEach(ba.fieldInfos,function(sa){va=sa.field;var Ba=[];sa.dijit&&1<sa.dijit.length?B.forEach(sa.dijit,function(Aa){Ba.push(Aa)}):Ba.push(sa.dijit);B.forEach(Ba,A.hitch(this,function(Aa){if(Aa){var X=this._setFieldDomain(Aa,qa,va),ea=ha[va.name];ea=ea&&X&&X.codedValues&&X.codedValues.length?X.codedValues[ea]?X.codedValues[ea].name:ea:ea;b.isDefined(ea)||
(ea="");"dijit.form.DateTextBox"===Aa.declaredClass||"dijit.form.TimeTextBox"===Aa.declaredClass?ea=""===ea?null:new Date(ea):"dijit.form.FilteringSelect"===Aa.declaredClass&&(Aa._lastValueReported=null,ea=ha[va.name]+"");try{this._setValue(Aa,ea),"dijit.form.FilteringSelect"===Aa.declaredClass&&!1===Aa.isValid()&&this._setValue(Aa,null)}catch(ia){Aa.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&ba.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,
V);(R=V.getEditSummary(R))?(this.editorTrackingInfoDiv.innerHTML=R,h.show(this.editorTrackingInfoDiv)):h.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(R,V,ba){if(!R)return null;var ha=ba.domain;V&&V.domains&&V.domains[ba.name]&&!1===V.domains[ba.name]instanceof n&&(ha=V.domains[ba.name]);if(!ha)return null;ha.codedValues&&0<ha.codedValues.length?(R.set("store",this._toStore(B.map(ha.codedValues,function(qa){return{id:qa.code+"",name:qa.name}}))),this._setValue(R,ha.codedValues[0].code+
"")):(R.constraints={min:b.isDefined(ha.minValue)?ha.minValue:Number.MIN_VALUE,max:b.isDefined(ha.maxValue)?ha.maxValue:Number.MAX_VALUE},this._setValue(R,R.constraints.min));return ha},_setValue:function(R,V){R.set&&(R._onChangeActive=!1,R.set("value",V,!0),R._onChangeActive=!0)},_getFields:function(R){var V=R._getOutFields();if(!V)return null;R=R.fields;return"*"==V?R:B.filter(B.map(V,A.hitch(this,"_findFirst",R,"name")),b.isDefined)},_isInFields:function(R,V){return R&&(V||V.length)?B.some(V,function(ba){return ba.toLowerCase()===
R.toLowerCase()}):!1},_isFieldNullable:function(R,V){return!(!1===R.nullable||V.field&&!1===V.field.nullable)},_isFieldRequired:function(R,V){return!1!==R.editable&&!1!==V.isEditable&&!this._isFieldNullable(R,V)},_findFirst:function(R,V,ba){return(R=B.filter(R,function(ha){return ha.hasOwnProperty(V)&&ha[V]===ba}))&&R.length?R[0]:null},_getLInfoFromFeatureLayer:function(R){return this._findFirst(this._layerInfos,"layerId",R?R.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML=
"";this._attributes=k.create("table",{cellspacing:"0",cellpadding:"0"},this.attributeTable);var R=k.create("tbody",null,this._attributes),V=this._currentLInfo,ba=this._findFirst(V.types,"id",this._currentFeature.attributes[V.typeIdField]);B.forEach(V.fieldInfos,A.hitch(this,"_createField",ba,R),this);this._createOnlyFirstTime=!1},_createField:function(R,V,ba){var ha=this._currentLInfo,qa=ba.field;if(!this._isInFields(qa.name,ha.hideFields)&&!this._isInFields(qa.name,this._editorTrackingInfos[ha.featureLayer.id])){var va=
!1,sa;V=k.create("tr",null,V);var Ba=k.create("td",{innerHTML:ba.label||qa.alias||qa.name,"class":this.css.label,"data-fieldname":qa.name},V);this._isFieldRequired(qa,ba)&&k.create("span",{"class":this.css.red,innerHTML:" *"},Ba);V=k.create("td",null,V);if(ba.customField){k.place(ba.customField.domNode||ba.customField,k.create("div",null,V),"first");var Aa=ba.customField}else if(!1===ha.isEditable||!1===qa.editable||!1===ba.isEditable||"esriFieldTypeOID"===qa.type||"esriFieldTypeGlobalID"===qa.type||
!this._canUpdate&&!this._createOnlyFirstTime)va=!0;ha=ha.typeIdField&&qa.name.toLowerCase()==ha.typeIdField.toLowerCase();Ba=!!this._getDomainForField(qa,R);!Aa&&ha?Aa=this._createTypeField(qa,ba,V):!Aa&&Ba&&(Aa=this._createDomainField(qa,ba,R,V));if(!Aa)switch(qa.type){case "esriFieldTypeString":Aa=this._createStringField(qa,ba,V);break;case "esriFieldTypeDate":Aa=this._createDateField(qa,ba,V);ba.format&&ba.format.time&&(sa=this._createTimeField(qa,ba,V));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":Aa=
this._createIntField(qa,ba,V);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":Aa=this._createFltField(qa,ba,V);break;default:Aa=this._createStringField(qa,ba,V)}ba.tooltip&&ba.tooltip.length&&this._toolTips.push(new T({connectId:[Aa.id],label:ba.tooltip}));Aa.onChange=A.hitch(this,"onFieldValueChange",ba);Aa.set("disabled",va);sa?(ba.dijit=[Aa,sa],sa.onChange=A.hitch(this,"onFieldValueChange",ba),sa.set("disabled",va)):ba.dijit=Aa}},_createTypeField:function(R,V,ba){ba=k.create("div",
null,ba);var ha=R.domain;return ha&&"range"===ha.type&&ha.minValue===ha.maxValue?new N({"class":this.css.field,trim:!0,maxLength:R.length,name:R.alias||R.name,required:this._isFieldRequired(R,V)},ba):new I({"class":this.css.field,name:R.alias||R.name,required:this._isFieldRequired(R,V),store:this._toStore(B.map(this._currentLInfo.types,function(qa){return{id:qa.id,name:qa.name}})),searchAttr:"name"},ba)},_getDomainForField:function(R,V){var ba=R.domain;(R=R.name)&&V&&V.domains&&V.domains[R]&&!1===
V.domains[R]instanceof n&&(ba=V.domains[R]);return ba||null},_createDomainField:function(R,V,ba,ha){ba=this._getDomainForField(R,ba);ha=k.create("div",null,ha);return ba.codedValues?new I({"class":this.css.field,name:R.alias||R.name,searchAttr:"name",required:this._isFieldRequired(R,V)},ha):new z({"class":this.css.field},ha)},_createStringField:function(R,V,ba){ba=k.create("div",null,ba);var ha={trim:!0,maxLength:R.length,required:this._isFieldRequired(R,V)};if(V.stringFieldOption===aa.STRING_FIELD_OPTION_TEXTAREA)return ha["class"]=
this.css.field+" "+this.css.textArea,new L(ha,ba);if(V.stringFieldOption===aa.STRING_FIELD_OPTION_RICHTEXT)return ha["class"]=this.css.field+" "+this.css.richText,ha.height="100%",ha.width="100%",ha.plugins=V.richTextPlugins||this._defaultRichTextPlugins,ba=new w(ha,ba),ba.startup(),ba;var qa=this;ha.validator=function(va,sa){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return qa._isFieldNullable(R,V)||!(""===va||null===va)};return new N(ha,ba)},_createTimeField:function(R,V,ba){ba=k.create("div",
null,ba);R={"class":this.css.field,trim:!0,required:this._isFieldRequired(R,V),constraints:{formatLength:"medium"}};this._datePackage&&(R.datePackage=this._datePackage);return new P(R,ba)},_createDateField:function(R,V,ba){ba=k.create("div",null,ba);R={"class":this.css.field,trim:!0,required:this._isFieldRequired(R,V)};this._datePackage&&(R.datePackage=this._datePackage);return new E(R,ba)},_createIntField:function(R,V,ba){ba=k.create("div",null,ba);return new M({"class":this.css.field,constraints:"esriFieldTypeSmallInteger"===
R.type?{min:-32768,max:32767,places:0}:{places:0},trim:!0,invalidMessage:this.NLS_validationInt,required:this._isFieldRequired(R,V)},ba)},_createFltField:function(R,V,ba){ba=k.create("div",null,ba);return new M({"class":this.css.field,constraints:{max:Infinity,min:-Infinity,places:"0,20"},trim:!0,invalidMessage:this.NLS_validationFlt,required:this._isFieldRequired(R,V)},ba)},_toStore:function(R){return new S({data:{identifier:"id",label:"name",items:R}})},_connect:function(R,V,ba){this._aiConnects.push(v.connect(R,
V,ba))},_getDatePackage:function(R){return null===R.datePackage?null:R.datePackage?R.datePackage:"ar"===l.locale?"dojox.date.islamic":null},_destroyAttributeTable:function(){B.forEach(this._layerInfos,function(R){B.forEach(R.fieldInfos,function(V){var ba=V.dijit;if(ba){ba._onChangeHandle=null;if(V.customField)return;ba instanceof Array?B.forEach(ba,A.hitch(this,function(ha){ha.destroyRecursive?ha.destroyRecursive():ha.destroy&&ha.destroy();ha._onChangeHandle=null})):ba.destroyRecursive?ba.destroyRecursive():
ba.destroy&&ba.destroy()}V.dijit=null},this)},this);B.forEach(this._toolTips,function(R){R.destroy()});this._toolTips=[];this._attributes&&k.destroy(this._attributes)}});A.mixin(aa,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});p("extend-esri")&&A.setObject("dijit.AttributeInspector",aa,c);return aa})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e,r,w,H,x,q,C,F){function u(D){return new w({command:D.name})}function E(D){return new w({buttonClass:r,command:D.name})}B=B("dijit.Editor",C,{plugins:null,extraPlugins:null,constructor:function(){b.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",H]);this._plugins=
[];this._editInterval=1E3*this.editActionInterval;if(h("ie")||h("trident")||h("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new v;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);b.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=t.getLocalization("dijit._editor",
"commands",this.lang);h("webkit")&&k.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new a({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));A.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);p.add(this.iframe.parentNode,"dijitEditorIFrameContainer");p.add(this.iframe,"dijitEditorIFrame");l.set(this.iframe,"allowTransparency",
!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){A.forEach(this._plugins,function(D){D&&D.destroy&&D.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(D,M){var I=b.isString(D)?{name:D}:b.isFunction(D)?{ctor:D}:D;if(!I.setEditor){var z={args:I,plugin:null,editor:this};I.name&&(w.registry[I.name]?z.plugin=w.registry[I.name](I):m.publish(F._scopeName+".Editor.getPlugin",z));if(!z.plugin)try{var K=
I.ctor||b.getObject(I.name)||G(I.name);K&&(z.plugin=new K(I))}catch(L){throw Error(this.id+": cannot find plugin ["+I.name+"]");}if(!z.plugin)throw Error(this.id+": cannot find plugin ["+I.name+"]");D=z.plugin}1<arguments.length?this._plugins[M]=D:this._plugins.push(D);D.setEditor(this);b.isFunction(D.setToolbar)&&D.setToolbar(this.toolbar)},resize:function(D){D&&e.prototype.resize.apply(this,arguments)},layout:function(){var D=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+d.getPadBorderExtents(this.iframe.parentNode).h+
d.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=D+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(D){var M,I=this.document.body,z=I.clientWidth,K=I.clientHeight,L=I.clientLeft,N=I.offsetWidth,P=I.offsetHeight,T=I.offsetLeft;/^rtl$/i.test(I.dir||"")?z<N&&D.x>z&&D.x<N&&(M=!0):D.x<L&&D.x>T&&(M=!0);M||K<P&&D.y>K&&D.y<P&&(M=!0);M||(delete this._cursorToStart,delete this._savedSelection,"BODY"==D.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(D){this.customUndo&&this.endEditing(!0);"BODY"!=D.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(D){this._inEditing||(this._inEditing=!0,this._beginEditing(D));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(D){if(!this.customUndo||
"undo"!=D&&"redo"!=D){this.customUndo&&(this.endEditing(),this._beginEditing());var M=this.inherited(arguments);this.customUndo&&this._endEditing();return M}return this[D]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(D){try{var M=this.document.execCommand(D,!1,null);if(h("webkit")&&!M)throw{};}catch(I){M=n.substitute,alert(M(this.commands.systemShortcut,
[this.commands[D],M(this.commands[h("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[D]])])),M=!1}return M},queryCommandEnabled:function(D){return!this.customUndo||"undo"!=D&&"redo"!=D?this.inherited(arguments):"undo"==D?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(D){var M=D.mark,I=D.mark;D=D.isCollapsed;var z;if(I)if(9>h("ie")||9===h("ie")&&h("quirks"))if(b.isArray(I))M=[],A.forEach(I,function(N){M.push(q.getNode(N,this.editNode))},this),this.selection.moveToBookmark({mark:M,
isCollapsed:D});else{if(I.startContainer&&I.endContainer&&(z=q.getSelection(this.window))&&z.removeAllRanges){z.removeAllRanges();D=q.create(this.window);var K=q.getNode(I.startContainer,this.editNode);var L=q.getNode(I.endContainer,this.editNode);K&&L&&(D.setStart(K,I.startOffset),D.setEnd(L,I.endOffset),z.addRange(D))}}else(z=q.getSelection(this.window))&&z.removeAllRanges&&(z.removeAllRanges(),D=q.create(this.window),K=q.getNode(I.startContainer,this.editNode),L=q.getNode(I.endContainer,this.editNode),
K&&L&&(D.setStart(K,I.startOffset),D.setEnd(L,I.endOffset),z.addRange(D)))},_changeToStep:function(D,M){this.setValue(M.text);(D=M.bookmark)&&this._moveToBookmark(D)},undo:function(){var D=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var M=this._steps.pop();M&&0<this._steps.length&&(this.focus(),this._changeToStep(M,this._steps[this._steps.length-1]),this._undoedSteps.push(M),this.onDisplayChanged(),delete this._undoRedoActive,D=!0);delete this._undoRedoActive}return D},
redo:function(){var D=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var M=this._undoedSteps.pop();M&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],M),this._steps.push(M),this.onDisplayChanged(),D=!0);delete this._undoRedoActive}return D},endEditing:function(D){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(D),this._inEditing=!1)},_getBookmark:function(){var D=this.selection.getBookmark(),
M=[];if(D&&D.mark){var I=D.mark;if(9>h("ie")||9===h("ie")&&h("quirks")){var z=q.getSelection(this.window);if(b.isArray(I))A.forEach(D.mark,function(L){M.push(q.getIndex(L,this.editNode).o)},this),D.mark=M;else if(z){var K;z.rangeCount&&(K=z.getRangeAt(0));D.mark=K?K.cloneRange():this.selection.getBookmark()}}try{D.mark&&D.mark.startContainer&&(M=q.getIndex(D.mark.startContainer,this.editNode).o,D.mark={startContainer:M,startOffset:D.mark.startOffset,endContainer:D.mark.endContainer===D.mark.startContainer?
M:q.getIndex(D.mark.endContainer,this.editNode).o,endOffset:D.mark.endOffset})}catch(L){D.mark=null}}return D},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:x.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var D=x.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:D,bookmark:this._getBookmark()})},onKeyDown:function(D){h("ie")||this.iframe||D.keyCode!=c.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var M=
D.keyCode;if(D.ctrlKey&&!D.shiftKey&&!D.altKey){if(90==M||122==M){D.stopPropagation();D.preventDefault();this.undo();return}if(89==M||121==M){D.stopPropagation();D.preventDefault();this.redo();return}}this.inherited(arguments);switch(M){case c.ENTER:case c.BACKSPACE:case c.DELETE:this.beginEditing();break;case 88:case 86:if(D.ctrlKey&&!D.altKey&&!D.metaKey){this.endEditing();88==D.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!D.ctrlKey&&!D.altKey&&
!D.metaKey&&(D.keyCode<c.F1||D.keyCode>c.F15)){this.beginEditing();break}case c.ALT:this.endEditing();break;case c.UP_ARROW:case c.DOWN_ARROW:case c.LEFT_ARROW:case c.RIGHT_ARROW:case c.HOME:case c.END:case c.PAGE_UP:case c.PAGE_DOWN:this.endEditing(!0);case c.CTRL:case c.SHIFT:case c.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(D){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(D){this.customUndo?this.isClosed?this.setValue(D):(this.beginEditing(),D||(D="\x26#160;"),this.setValue(D),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(D){this.setValueDeferred.then(b.hitch(this,function(){!this.disabled&&D||!this._buttonEnabledPlugins&&D?
A.forEach(this._plugins,function(M){M.set("disabled",!0)}):this.disabled&&!D&&A.forEach(this._plugins,function(M){M.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&(k.set(this.document.body,"color",k.get(this.iframe,"color")),k.set(this.document.body,"background-color",k.get(this.iframe,"background-color")))}catch(D){}}});b.mixin(w.registry,{undo:u,redo:u,cut:u,copy:u,paste:u,insertOrderedList:u,insertUnorderedList:u,
indent:u,outdent:u,justifyCenter:u,justifyFull:u,justifyLeft:u,justifyRight:u,"delete":u,selectAll:u,removeFormat:u,unlink:u,insertHorizontalRule:u,bold:E,italic:E,underline:E,strikethrough:E,subscript:E,superscript:E,"|":function(){return new w({setEditor:function(D){this.editor=D;this.button=new f({ownerDocument:D.ownerDocument})}})}});return B})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(G,A,B,v,t,l,p,d){B("dijit-legacy-requires")&&t(0,function(){G(["dijit/ToolbarSeparator"])});return A("dijit.Toolbar",[l,d,p],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],
function(G,A,B,v){return G("dijit.ToolbarSeparator",[B,v],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',buildRendering:function(){this.inherited(arguments);A.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(G,A,B,
v,t,l,p,d,k){return l("dijit.layout._LayoutWidget",[A,B,v],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);p.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var c=this.getParent&&this.getParent();c&&c.isLayoutContainer||(this.resize(),this.own(t.on("resize",G.hitch(this,"resize"))))}},resize:function(c,b){var h=this.domNode;c&&d.setMarginBox(h,c);b=b||{};G.mixin(b,c||{});
"h"in b&&"w"in b||(b=G.mixin(d.getMarginBox(h),b));c=k.getComputedStyle(h);var n=d.getMarginExtents(h,c),m=d.getBorderExtents(h,c);b=this._borderBox={w:b.w-(n.w+m.w),h:b.h-(n.h+m.h)};n=d.getPadExtents(h,c);this._contentBox={l:k.toPixelValue(h,c.paddingLeft),t:k.toPixelValue(h,c.paddingTop),w:b.w-n.w,h:b.h-n.h};this.layout()},layout:function(){},_setupChild:function(c){p.add(c.domNode,this.baseClass+"-child "+(c.baseClass?this.baseClass+"-"+c.baseClass:""))},addChild:function(c,b){this.inherited(arguments);
this._started&&this._setupChild(c)},removeChild:function(c){p.remove(c.domNode,this.baseClass+"-child"+(c.baseClass?" "+this.baseClass+"-"+c.baseClass:""));this.inherited(arguments)}})})},"dijit/form/ToggleButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(G,A,B,v){return G("dijit.form.ToggleButton",[B,v],{baseClass:"dijitToggleButton",setChecked:function(t){A.deprecated("setChecked("+t+") is deprecated. Use set('checked',"+t+") instead.",
"","2.0");this.set("checked",t)}})})},"dijit/form/Button":function(){define("require dojo/_base/declare dojo/dom-class dojo/has dojo/_base/kernel dojo/_base/lang dojo/ready ./_FormWidget ./_ButtonMixin dojo/text!./templates/Button.html ../a11yclick".split(" "),function(G,A,B,v,t,l,p,d,k,c){v("dijit-legacy-requires")&&p(0,function(){G(["dijit/form/DropDownButton","dijit/form/ComboButton","dijit/form/ToggleButton"])});p=A("dijit.form.Button"+(v("dojo-bidi")?"_NoBidi":""),[d,k],{showLabel:!0,iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},baseClass:"dijitButton",templateString:c,_setValueAttr:"valueNode",_setNameAttr:function(b){this.valueNode&&this.valueNode.setAttribute("name",b)},postCreate:function(){this.inherited(arguments);this._setLabelFromContainer()},_setLabelFromContainer:function(){this.containerNode&&!this.label&&(this.label=l.trim(this.containerNode.innerHTML),this.onLabelSet())},_setShowLabelAttr:function(b){this.containerNode&&B.toggle(this.containerNode,"dijitDisplayNone",
!b);this._set("showLabel",b)},setLabel:function(b){t.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",b)},onLabelSet:function(){this.inherited(arguments);this.showLabel||"title"in this.params||(this.titleNode.title=l.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});v("dojo-bidi")&&(p=A("dijit.form.Button",p,{onLabelSet:function(){this.inherited(arguments);this.titleNode.title&&this.applyTextDir(this.titleNode,
this.titleNode.title)},_setTextDirAttr:function(b){this._created&&this.textDir!=b&&(this._set("textDir",b),this._setLabelAttr(this.label))}}));return p})},"dijit/form/_FormWidget":function(){define("dojo/_base/declare dojo/sniff dojo/_base/kernel dojo/ready ../_Widget ../_CssStateMixin ../_TemplatedMixin ./_FormWidgetMixin".split(" "),function(G,A,B,v,t,l,p,d){A("dijit-legacy-requires")&&v(0,function(){require(["dijit/form/_FormValueWidget"])});return G("dijit.form._FormWidget",[t,p,l,d],{setDisabled:function(k){B.deprecated("setDisabled("+
k+") is deprecated. Use set('disabled',"+k+") instead.","","2.0");this.set("disabled",k)},setValue:function(k){B.deprecated("dijit.form._FormWidget:setValue("+k+") is deprecated.  Use set('value',"+k+") instead.","","2.0");this.set("value",k)},getValue:function(){B.deprecated(this.declaredClass+"::getValue() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},postMixInProperties:function(){this.nameAttrSetting=this.name&&!A("msapp")?'name\x3d"'+this.name.replace(/"/g,"\x26quot;")+
'"':"";this.inherited(arguments)}})})},"dijit/form/_FormWidgetMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff dojo/window ../a11y".split(" "),function(G,A,B,v,t,l,p,d,k,c){return A("dijit.form._FormWidgetMixin",null,{name:"",alt:"",value:"",type:"text","aria-label":"focusNode",tabIndex:"0",_setTabIndexAttr:"focusNode",disabled:!1,intermediateChanges:!1,scrollOnFocus:!0,_setIdAttr:"focusNode",_setDisabledAttr:function(b){this._set("disabled",
b);/^(button|input|select|textarea|optgroup|option|fieldset)$/i.test(this.focusNode.tagName)?(B.set(this.focusNode,"disabled",b),d("trident")&&"readOnly"in this&&B.set(this.focusNode,"readonly",b||this.readOnly)):this.focusNode.setAttribute("aria-disabled",b?"true":"false");this.valueNode&&B.set(this.valueNode,"disabled",b);b?(this._set("hovering",!1),this._set("active",!1),b="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"_setTabIndexAttr"in this?this._setTabIndexAttr:"focusNode",G.forEach(t.isArray(b)?
b:[b],function(h){h=this[h];d("webkit")||c.hasDefaultTabStop(h)?h.setAttribute("tabIndex","-1"):h.removeAttribute("tabIndex")},this)):""!=this.tabIndex&&this.set("tabIndex",this.tabIndex)},_onFocus:function(b){if("mouse"==b&&this.isFocusable())var h=this.own(p(this.focusNode,"focus",function(){m.remove();h.remove()}))[0],n=d("pointer-events")?"pointerup":d("MSPointer")?"MSPointerUp":d("touch-events")?"touchend, mouseup":"mouseup",m=this.own(p(this.ownerDocumentBody,n,t.hitch(this,function(g){m.remove();
h.remove();this.focused&&("touchend"==g.type?this.defer("focus"):this.focus())})))[0];this.scrollOnFocus&&this.defer(function(){k.scrollIntoView(this.domNode)});this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&"none"!=v.get(this.domNode,"display")},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(b){}},compare:function(b,h){return"number"==typeof b&&"number"==typeof h?isNaN(b)&&isNaN(h)?0:b-h:b>h?1:b<h?-1:0},onChange:function(){},
_onChangeActive:!1,_handleOnChange:function(b,h){void 0!=this._lastValueReported||null!==h&&this._onChangeActive||(this._resetValue=this._lastValueReported=b);this._pendingOnChange=this._pendingOnChange||typeof b!=typeof this._lastValueReported||0!=this.compare(b,this._lastValueReported);(this.intermediateChanges||h||void 0===h)&&this._pendingOnChange&&(this._lastValueReported=b,this._pendingOnChange=!1,this._onChangeActive&&(this._onChangeHandle&&this._onChangeHandle.remove(),this._onChangeHandle=
this.defer(function(){this._onChangeHandle=null;this.onChange(b)})))},create:function(){this.inherited(arguments);this._onChangeActive=!0},destroy:function(){this._onChangeHandle&&(this._onChangeHandle.remove(),this.onChange(this._lastValueReported));this.inherited(arguments)}})})},"dijit/form/_ButtonMixin":function(){define(["dojo/_base/declare","dojo/dom","dojo/has","../registry"],function(G,A,B,v){var t=G("dijit.form._ButtonMixin"+(B("dojo-bidi")?"_NoBidi":""),null,{label:"",type:"button",__onClick:function(l){l.stopPropagation();
l.preventDefault();this.disabled||this.valueNode.click(l);return!1},_onClick:function(l){if(this.disabled)return l.stopPropagation(),l.preventDefault(),!1;!1===this.onClick(l)&&l.preventDefault();var p=l.defaultPrevented;if(!p&&"submit"==this.type&&!(this.valueNode||this.focusNode).form)for(var d=this.domNode;d.parentNode;d=d.parentNode){var k=v.byNode(d);if(k&&"function"==typeof k._onSubmit){k._onSubmit(l);l.preventDefault();p=!0;break}}return!p},postCreate:function(){this.inherited(arguments);A.setSelectable(this.focusNode,
!1)},onClick:function(){return!0},_setLabelAttr:function(l){this._set("label",l);(this.containerNode||this.focusNode).innerHTML=l;this.onLabelSet()},onLabelSet:function(){}});B("dojo-bidi")&&(t=G("dijit.form._ButtonMixin",t,{onLabelSet:function(){this.inherited(arguments);this.applyTextDir(this.containerNode||this.focusNode)}}));return t})},"dijit/form/_ToggleButtonMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(G,A){return G("dijit.form._ToggleButtonMixin",null,{checked:!1,
_aria_attr:"aria-pressed",_onClick:function(B){var v=this.checked;this._set("checked",!v);var t=this.inherited(arguments);this.set("checked",t?this.checked:v);return t},_setCheckedAttr:function(B,v){this._set("checked",B);var t=this.focusNode||this.domNode;this._created&&A.get(t,"checked")!=!!B&&A.set(t,"checked",!!B);t.setAttribute(this._aria_attr,String(B));this._handleOnChange(B,v)},postCreate:function(){this.inherited(arguments);var B=this.focusNode||this.domNode;this.checked&&B.setAttribute("checked",
"checked");void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.checked)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(G,A,B,v,t){A=A("dijit._editor._Plugin",v,{constructor:function(l){this.params=l||{};B.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",
button:null,command:"",useDefaultCommand:!0,buttonClass:t,disabled:!1,getLabel:function(l){return this.editor.commands[l]},_initButton:function(){if(this.command.length){var l=this.getLabel(this.command),p=this.editor,d=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(l=B.mixin({label:l,ownerDocument:p.ownerDocument,dir:p.dir,lang:p.lang,showLabel:!1,iconClass:d,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete l.name,
this.button=new this.buttonClass(l))}this.get("disabled")&&this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(l,p,d){this.own(G.connect(l,p,this,d))},updateState:function(){var l=this.editor,p=this.command;if(l&&l.isLoaded&&p.length){var d=this.get("disabled");if(this.button)try{var k=l._implCommand(p);var c=!d&&(this[k]?this[k](p):l.queryCommandEnabled(p));this.enabled!==c&&
(this.enabled=c,this.button.set("disabled",!c));if(c&&"boolean"==typeof this.button.checked){var b=l.queryCommandState(p);this.checked!==b&&(this.checked=b,this.button.set("checked",l.queryCommandState(p)))}}catch(h){console.log(h)}}},setEditor:function(l){this.editor=l;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",B.hitch(this.editor,"execCommand",this.command,this.commandArg))):this.button.domNode.style.display=
"none");this.own(this.editor.on("NormalizedDisplayChanged",B.hitch(this,"updateState")))},setToolbar:function(l){this.button&&l.addChild(this.button)},set:function(l,p){if("object"===typeof l){for(var d in l)this.set(d,l[d]);return this}d=this._getAttrNames(l);if(this[d.s])var k=this[d.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(l,p);return k||this},get:function(l){var p=this._getAttrNames(l);return this[p.g]?this[p.g]():this[l]},_setDisabledAttr:function(l){this._set("disabled",
l);this.updateState()},_getAttrNames:function(l){var p=this._attrPairNames;if(p[l])return p[l];var d=l.charAt(0).toUpperCase()+l.substr(1);return p[l]={s:"_set"+d+"Attr",g:"_get"+d+"Attr"}},_set:function(l,p){this[l]=p}});A.registry={};return A})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),function(G,A,B,v,t,l,p,d,k,c,b){return G("dijit._editor.plugins.EnterKeyHandling",
k,{blockNodeForEnter:"BR",constructor:function(h){h&&("blockNodeForEnter"in h&&(h.blockNodeForEnter=h.blockNodeForEnter.toUpperCase()),v.mixin(this,h))},setEditor:function(h){if(this.editor!==h)if(this.editor=h,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,h.onLoadDeferred.then(v.hitch(this,function(m){this.own(t(h.document,"keydown",v.hitch(this,function(g){if(g.keyCode==B.ENTER){var a=v.mixin({},g);a.shiftKey=!0;this.handleEnterKey(a)||(g.stopPropagation(),g.preventDefault())}})));9<=l("ie")&&
10>=l("ie")&&this.own(t(h.document,"paste",v.hitch(this,function(g){setTimeout(v.hitch(this,function(){var a=this.editor.document.selection.createRange();a.move("character",-1);a.select();a.move("character",1);a.select()}),0)})));return m}));else if(this.blockNodeForEnter){var n=v.hitch(this,"handleEnterKey");h.addKeyHandler(13,0,0,n);h.addKeyHandler(13,0,1,n);this.own(this.editor.on("KeyPressed",v.hitch(this,"onKeyPressed")))}},onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var h=
this.editor.selection.getAncestorElement("LI");if(h){l("mozilla")&&"LI"==h.parentNode.parentNode.nodeName&&(h=h.parentNode.parentNode);var n=h.firstChild;!n||1!=n.nodeType||"UL"!=n.nodeName&&"OL"!=n.nodeName||(h.insertBefore(n.ownerDocument.createTextNode("\u00a0"),n),n=b.create(this.editor.window),n.setStart(h.firstChild,0),h=b.getSelection(this.editor.window,!0),h.removeAllRanges(),h.addRange(n))}else c.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter),(h=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?
(h.innerHTML=this.bogusHtmlContent,9>=l("ie")&&(h=this.editor.document.selection.createRange(),h.move("character",-1),h.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(h){var n,m=this.editor.document,
g;if(h.shiftKey){h=this.editor.selection.getParentElement();if(n=b.getAncestor(h,this.blockNodes)){if("LI"==n.tagName)return!0;h=b.getSelection(this.editor.window);var a=h.getRangeAt(0);a.collapsed||(a.deleteContents(),h=b.getSelection(this.editor.window),a=h.getRangeAt(0));if(b.atBeginningOfContainer(n,a.startContainer,a.startOffset)){var f=m.createElement("br");a=b.create(this.editor.window);n.insertBefore(f,n.firstChild);a.setStartAfter(f);h.removeAllRanges();h.addRange(a)}else if(b.atEndOfContainer(n,
a.startContainer,a.startOffset))a=b.create(this.editor.window),f=m.createElement("br"),n.appendChild(f),n.appendChild(m.createTextNode("\u00a0")),a.setStart(n.lastChild,0),h.removeAllRanges(),h.addRange(a);else{if((g=a.startContainer)&&3==g.nodeType){var e=g.nodeValue;var r=m.createTextNode(e.substring(0,a.startOffset));var w=m.createTextNode(e.substring(a.startOffset));n=m.createElement("br");""==w.nodeValue&&l("webkit")&&(w=m.createTextNode("\u00a0"));A.place(r,g,"after");A.place(n,r,"after");A.place(w,
n,"after");A.destroy(g);a=b.create(this.editor.window);a.setStart(w,0);h.removeAllRanges();h.addRange(a);return!1}return!0}}else h=b.getSelection(this.editor.window),h.rangeCount?(a=h.getRangeAt(0))&&a.startContainer&&(a.collapsed||(a.deleteContents(),h=b.getSelection(this.editor.window),a=h.getRangeAt(0)),(g=a.startContainer)&&3==g.nodeType?(n=a.startOffset,g.length<n&&(w=this._adjustNodeAndOffset(g,n),g=w.node,n=w.offset),e=g.nodeValue,r=m.createTextNode(e.substring(0,n)),w=m.createTextNode(e.substring(n)),
n=m.createElement("br"),w.length||(w=m.createTextNode("\u00a0")),r.length?A.place(r,g,"after"):r=g,A.place(n,r,"after"),A.place(w,n,"after"),A.destroy(g)):(0<=a.startOffset&&(f=g.childNodes[a.startOffset]),n=m.createElement("br"),w=m.createTextNode("\u00a0"),f?(A.place(n,f,"before"),A.place(w,n,"after")):(g.appendChild(n),g.appendChild(w))),a=b.create(this.editor.window),a.setStart(w,0),a.setEnd(w,w.length),h.removeAllRanges(),h.addRange(a),this.editor.selection.collapse(!0)):c.prototype.execCommand.call(this.editor,
"inserthtml","\x3cbr\x3e");return!1}var H=!0;h=b.getSelection(this.editor.window);a=h.getRangeAt(0);a.collapsed||(a.deleteContents(),h=b.getSelection(this.editor.window),a=h.getRangeAt(0));f=b.getBlockAncestor(a.endContainer,null,this.editor.editNode);var x=f.blockNode;if(this._checkListLater=x&&("LI"==x.nodeName||"LI"==x.parentNode.nodeName))return l("mozilla")&&(this._pressedEnterInBlock=x),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(x.innerHTML)&&
(x.innerHTML="",l("webkit")&&(a=b.create(this.editor.window),a.setStart(x,0),h.removeAllRanges(),h.addRange(a)),this._checkListLater=!1),!0;if(!f.blockNode||f.blockNode===this.editor.editNode){try{c.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(q){}f={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),blockContainer:this.editor.editNode};if(f.blockNode){if(f.blockNode!=this.editor.editNode&&!(f.blockNode.textContent||f.blockNode.innerHTML).replace(/^\s+|\s+$/g,
"").length)return this.removeTrailingBr(f.blockNode),!1}else f.blockNode=this.editor.editNode;h=b.getSelection(this.editor.window);a=h.getRangeAt(0)}x=m.createElement(this.blockNodeForEnter);x.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(f.blockNode);w=a.endOffset;H=a.endContainer;H.length<w&&(w=this._adjustNodeAndOffset(H,w),H=w.node,w=w.offset);if(b.atEndOfContainer(f.blockNode,H,w))f.blockNode===f.blockContainer?f.blockNode.appendChild(x):A.place(x,f.blockNode,"after"),H=!1,a=b.create(this.editor.window),
a.setStart(x,0),h.removeAllRanges(),h.addRange(a),this.editor.height&&d.scrollIntoView(x);else if(b.atBeginningOfContainer(f.blockNode,a.startContainer,a.startOffset))A.place(x,f.blockNode,f.blockNode===f.blockContainer?"first":"before"),x.nextSibling&&this.editor.height&&(a=b.create(this.editor.window),a.setStart(x.nextSibling,0),h.removeAllRanges(),h.addRange(a),d.scrollIntoView(x.nextSibling)),H=!1;else{f.blockNode===f.blockContainer?f.blockNode.appendChild(x):A.place(x,f.blockNode,"after");H=
!1;f.blockNode.style&&x.style&&f.blockNode.style.cssText&&(x.style.cssText=f.blockNode.style.cssText);if((g=a.startContainer)&&3==g.nodeType){w=a.endOffset;g.length<w&&(w=this._adjustNodeAndOffset(g,w),g=w.node,w=w.offset);e=g.nodeValue;r=m.createTextNode(e.substring(0,w));w=m.createTextNode(e.substring(w,e.length));A.place(r,g,"before");A.place(w,g,"after");A.destroy(g);for(a=r.parentNode;a!==f.blockNode;){e=m.createElement(a.tagName);a.style&&e.style&&a.style.cssText&&(e.style.cssText=a.style.cssText);
"FONT"===a.tagName&&(a.color&&(e.color=a.color),a.face&&(e.face=a.face),a.size&&(e.size=a.size));for(;w;)g=w.nextSibling,e.appendChild(w),w=g;A.place(e,a,"after");r=a;w=e;a=a.parentNode}if(1==w.nodeType||3==w.nodeType&&w.nodeValue)x.innerHTML="";for(r=w;w;)g=w.nextSibling,x.appendChild(w),w=g}a=b.create(this.editor.window);m=r;if("BR"!==this.blockNodeForEnter){for(;m;)n=m,m=g=m.firstChild;n&&n.parentNode?(x=n.parentNode,a.setStart(x,0),h.removeAllRanges(),h.addRange(a),this.editor.height&&d.scrollIntoView(x),
l("mozilla")&&(this._pressedEnterInBlock=f.blockNode)):H=!0}else a.setStart(x,0),h.removeAllRanges(),h.addRange(a),this.editor.height&&d.scrollIntoView(x),l("mozilla")&&(this._pressedEnterInBlock=f.blockNode)}return H},_adjustNodeAndOffset:function(h,n){for(;h.length<n&&h.nextSibling&&3==h.nextSibling.nodeType;)n-=h.length,h=h.nextSibling;return{node:h,offset:n}},removeTrailingBr:function(h){if(h=/P|DIV|LI/i.test(h.tagName)?h:this.editor.selection.getParentOfType(h,["P","DIV","LI"]))h.lastChild&&
(1<h.childNodes.length&&3==h.lastChild.nodeType&&/^[\s\xAD]*$/.test(h.lastChild.nodeValue)||"BR"==h.lastChild.tagName)&&A.destroy(h.lastChild),h.childNodes.length||(h.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e,r,w,H,x,q,C,F,u,E,D,M){var I=B("dijit._editor.RichText",[q,C],{constructor:function(z){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};z&&n.isString(z.value)&&(this.value=z.value);this.onLoadDeferred=new v},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[n.trim,n.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);f("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));f("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(f("ie")||f("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[n.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[n.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);r.publish(M._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var z=n.hitch(this,function(N,P){return function(){return!this.execCommand(N,P)}}),K={b:z("bold"),i:z("italic"),u:z("underline"),a:z("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:z("formatblock",
"h1"),2:z("formatblock","h2"),3:z("formatblock","h3"),4:z("formatblock","h4"),"\\":z("insertunorderedlist")};f("ie")||(K.Z=z("redo"));for(var L in K)this.addKeyHandler(L,!0,!1,K[L])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(I._editorCommandsLocalized)this._local2NativeFormatNames=I._local2NativeFormatNames,this._native2LocalFormatNames=I._native2LocalFormatNames;else{I._editorCommandsLocalized=!0;I._local2NativeFormatNames={};
I._native2LocalFormatNames={};this._local2NativeFormatNames=I._local2NativeFormatNames;this._native2LocalFormatNames=I._native2LocalFormatNames;for(var z="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),K="",L,N=0;L=z[N++];)K="l"!==L.charAt(1)?K+("\x3c"+L+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+L+"\x3e\x3cbr/\x3e"):K+("\x3c"+L+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+L+"\x3e\x3cbr/\x3e");var P=d.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:K});this.ownerDocumentBody.appendChild(P);
z=n.hitch(this,function(){for(var T=P.firstChild;T;)try{this.selection.selectElement(T.firstChild);var S=T.tagName.toLowerCase();this._local2NativeFormatNames[S]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[S]]=S;T=T.nextSibling.nextSibling}catch(Z){}d.destroy(P)});this.defer(z)}},open:function(z){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new v;this.isClosed||this.close();r.publish(M._scopeName+"._editor.RichText::open",
this);1===arguments.length&&z.nodeName&&(this.domNode=z);var K=this.domNode;if(n.isString(this.value)){var L=this.value;K.innerHTML=""}else if(K.nodeName&&"textarea"==K.nodeName.toLowerCase()){var N=this.textarea=K;this.name=N.name;L=N.value;K=this.domNode=this.ownerDocument.createElement("div");K.setAttribute("widgetId",this.id);N.removeAttribute("widgetId");K.cssText=N.cssText;K.className+=" "+N.className;d.place(K,N,"before");var P=n.hitch(this,function(){c.set(N,{display:"block",position:"absolute",
top:"-1000px"});if(f("ie")){var da=N.style;this.__overflow=da.overflow;da.overflow="hidden"}});f("ie")?this.defer(P,10):P();if(N.form){var T=N.value;this.reset=function(){this.getValue()!==T&&this.replaceValue(T)};m(N.form,"submit",n.hitch(this,function(){l.set(N,"disabled",this.disabled);N.value=this.getValue()}))}}else L=E.getChildrenHtml(K),K.innerHTML="";this.value=L;K.nodeName&&"LI"===K.nodeName&&(K.innerHTML=" \x3cbr\x3e");this.header=K.ownerDocument.createElement("div");K.appendChild(this.header);
this.editingArea=K.ownerDocument.createElement("div");K.appendChild(this.editingArea);this.footer=K.ownerDocument.createElement("div");K.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!A.useXDomain||A.allowXdRichTextSave)){if((L=t.byId(M._scopeName+"._editor.RichText.value"))&&""!==L.value){P=L.value.split(this._SEPARATOR);for(var S=0,Z;Z=P[S++];)if(Z=Z.split(this._NAME_CONTENT_SEP),Z[0]===this.name){this.value=Z[1];P=P.splice(S,1);L.value=P.join(this._SEPARATOR);
break}}I._globalSaveHandler||(I._globalSaveHandler={},w.addOnUnload(function(){for(var da in I._globalSaveHandler){var Q=I._globalSaveHandler[da];n.isFunction(Q)&&Q()}}));I._globalSaveHandler[this.id]=n.hitch(this,"_saveContent")}this.isClosed=!1;L=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");L.id=this.id+"_iframe";L.style.border="none";L.style.width="100%";this._layoutMode?L.style.height="100%":7<=f("ie")?(this.height&&(L.style.height=this.height),this.minHeight&&(L.style.minHeight=
this.minHeight)):L.style.height=this.height?this.height:this.minHeight;L.frameBorder=0;L._loadFunc=n.hitch(this,function(da){this.window=da;this.document=da.document;this.selection=new F.SelectionManager(da);f("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});P=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");P=11>f("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+P+"');document.close()":
"javascript: '"+P+"'";this.editingArea.appendChild(L);L.src=P;"LI"===K.nodeName&&(K.lastChild.style.marginTop="-1.2em");p.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var z=c.getComputedStyle(this.domNode);if(this["aria-label"])var K=this["aria-label"];else{var L=g('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||t.byId(this["aria-labelledby"],this.ownerDocument);L&&(K=L.textContent||L.innerHTML||"")}L="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(K?" aria-label\x3d'"+e.escape(K)+"'":"")+"\x3e\x3c/div\x3e";var N=[z.fontWeight,z.fontSize,z.fontFamily].join(" "),P=z.lineHeight;P=0<=P.indexOf("px")?parseFloat(P)/parseFloat(z.fontSize):0<=P.indexOf("em")?parseFloat(P):"normal";var T="",S=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(Z){Z=Z.replace(/^;/ig,"")+";";var da=Z.split(":")[0];if(da){da=n.trim(da);da=da.toLowerCase();var Q,W="";for(Q=0;Q<da.length;Q++){var aa=da.charAt(Q);switch(aa){case "-":Q++,aa=da.charAt(Q).toUpperCase();
default:W+=aa}}c.set(S.domNode,W,"")}T+=Z+";"});this.iframe.setAttribute("title",K);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||b.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",K?"\x3ctitle\x3e"+e.escape(K)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",N,";\n",this.height||f("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",P,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",f("ie")||f("trident")||f("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",K?" aria-label\x3d'"+e.escape(K)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+T+"'\x3e",L,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var z=[];this.styleSheets&&(z=this.styleSheets.split(";"),this.styleSheets=
"");z=z.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var K="",L=0,N,P=x.get(this.ownerDocument);N=z[L++];)N=(new H(P.location,N)).toString(),this.editingAreaStyleSheets.push(N),K+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+N+'"/\x3e';return K},addStyleSheet:function(z){var K=z.toString(),L=x.get(this.ownerDocument);if("."===K.charAt(0)||"/"!==K.charAt(0)&&!z.host)K=(new H(L.location,K)).toString();-1<G.indexOf(this.editingAreaStyleSheets,K)||(this.editingAreaStyleSheets.push(K),
this.onLoadDeferred.then(n.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(K);else{var N=this.document.getElementsByTagName("head")[0],P=this.document.createElement("link");P.rel="stylesheet";P.type="text/css";P.href=K;N.appendChild(P)}})))},removeStyleSheet:function(z){var K=z.toString(),L=x.get(this.ownerDocument);if("."===K.charAt(0)||"/"!==K.charAt(0)&&!z.host)K=(new H(L.location,K)).toString();z=G.indexOf(this.editingAreaStyleSheets,K);-1!==z&&(delete this.editingAreaStyleSheets[z],
g('link[href\x3d"'+K+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(z){z=!!z;this._set("disabled",z);if(this.isLoaded){var K=f("ie")&&(this.isLoaded||!this.focusOnLoad);K&&(this.editNode.unselectable="on");this.editNode.contentEditable=!z;this.editNode.tabIndex=z?"-1":this.tabIndex;K&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(f("mozilla")&&!z&&this._mozSettingProps){z=this._mozSettingProps;for(var L in z)if(z.hasOwnProperty(L))try{this.document.execCommand(L,
!1,z[L])}catch(N){}}this._disabledOK=!0}},onLoad:function(z){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=D.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var K=this;this.beforeIframeNode=d.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=d.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){K.editNode.focus()};this.focusNode=
this.editNode;var L=this.events.concat(this.captureEvents),N=this.iframe?this.document:this.editNode;this.own.apply(this,G.map(L,function(P){var T=P.toLowerCase().replace(/^on/,"");return m(N,T,n.hitch(this,P))},this));this.own(m(N,"mouseup",n.hitch(this,"onClick")));f("ie")&&(this.own(m(this.document,"mousedown",n.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);f("webkit")&&(this._webkitListener=this.own(m(this.document,"mouseup",n.hitch(this,"onDisplayChanged")))[0],this.own(m(this.document,
"mousedown",n.hitch(this,function(P){P=P.target;!P||P!==this.document.body&&P!==this.document||this.defer("placeCursorAtEnd")}))));if(f("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(P){}this.isLoaded=!0;this.set("disabled",this.disabled);L=n.hitch(this,function(){this.setValue(z);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&a(n.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(L):L()},onKeyDown:function(z){if(z.keyCode===h.SHIFT||z.keyCode===h.ALT||z.keyCode===h.META||z.keyCode===h.CTRL)return!0;z.keyCode===h.TAB&&this.isTabIndent&&(z.stopPropagation(),z.preventDefault(),this.queryCommandEnabled(z.shiftKey?"outdent":"indent")&&this.execCommand(z.shiftKey?"outdent":"indent"));if(z.keyCode==h.TAB&&!this.isTabIndent&&!z.ctrlKey&&!z.altKey)return z.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>f("ie")&&z.keyCode===h.BACKSPACE&&"Control"===this.document.selection.type&&(z.stopPropagation(),z.preventDefault(),this.execCommand("delete"));f("ff")&&(z.keyCode===h.PAGE_UP||z.keyCode===h.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&z.preventDefault();var K=this._keyHandlers[z.keyCode],L=arguments;K&&!z.altKey&&G.some(K,function(N){if(!(N.shift^z.shiftKey||N.ctrl^(z.ctrlKey||z.metaKey)))return N.handler.apply(this,L)||z.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(z){b.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",z)},_setValueAttr:function(z){this.setValue(z)},_setDisableSpellCheckAttr:function(z){this.document?l.set(this.document.body,"spellcheck",!z):this.onLoadDeferred.then(n.hitch(this,function(){l.set(this.document.body,"spellcheck",!z)}));this._set("disableSpellCheck",z)},addKeyHandler:function(z,K,L,N){"string"==
typeof z&&(z=z.toUpperCase().charCodeAt(0));n.isArray(this._keyHandlers[z])||(this._keyHandlers[z]=[]);this._keyHandlers[z].push({shift:L||!1,ctrl:K||!1,handler:N})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(z){this.onDisplayChanged(z)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(z){(f("ie")||f("trident"))&&this.defer(function(){D.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var K=this.getValue(!0);if(K!==this.value)this.onChange(K);
this._set("value",K)},_onFocus:function(z){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!f("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>f("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(z,K){z=z.toLowerCase();"formatblock"===z?f("safari")&&void 0===K&&(z="heading"):"hilitecolor"!==z||f("mozilla")||(z="backcolor");return z},_implCommand:function(z){return"_"+this._normalizeCommand(z)+"EnabledImpl"},_qcaCache:{},
queryCommandAvailable:function(z){var K=this._qcaCache[z];return void 0!==K?K:this._qcaCache[z]=this._queryCommandAvailable(z)},_queryCommandAvailable:function(z){switch(z.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return f("ie")||f("trident")||f("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!f("webkit");default:return!1}},execCommand:function(z,K){this.focused&&this.focus();z=this._normalizeCommand(z,K);if(void 0!==K){if("heading"===z)throw Error("unimplemented");"formatblock"===
z&&(f("ie")||f("trident"))&&(K="\x3c"+K+"\x3e")}var L="_"+z+"Impl";if(this[L])var N=this[L](K);else if((K=1<arguments.length?K:null)||"createlink"!==z)N=this.document.execCommand(z,!1,K);this.onDisplayChanged();return N},queryCommandEnabled:function(z){if(this.disabled||!this._disabledOK)return!1;z=this._normalizeCommand(z);var K=this._implCommand(z);return this[K]?this[K](z):this._browserQueryCommandEnabled(z)},queryCommandState:function(z){if(this.disabled||!this._disabledOK)return!1;z=this._normalizeCommand(z);
try{return this.document.queryCommandState(z)}catch(K){return!1}},queryCommandValue:function(z){if(this.disabled||!this._disabledOK)return!1;z=this._normalizeCommand(z);if(f("ie")&&"formatblock"===z)z=this._native2LocalFormatNames[this.document.queryCommandValue(z)];else if(f("mozilla")&&"hilitecolor"===z){try{var K=this.document.queryCommandValue("styleWithCSS")}catch(L){K=!1}this.document.execCommand("styleWithCSS",!1,!0);z=this.document.queryCommandValue(z);this.document.execCommand("styleWithCSS",
!1,K)}else z=this.document.queryCommandValue(z);return z},_sCall:function(z,K){return this.selection[z].apply(this.selection,K)},placeCursorAtStart:function(){this.focus();var z=!1;if(f("mozilla"))for(var K=this.editNode.firstChild;K;){if(3===K.nodeType){if(0<K.nodeValue.replace(/^\s+|\s+$/g,"").length){z=!0;this.selection.selectElement(K);break}}else if(1===K.nodeType){z=!0;var L=K.tagName?K.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(L)?this.selection.selectElement(K):
this.selection.selectElementChildren(K);break}K=K.nextSibling}else z=!0,this.selection.selectElementChildren(this.editNode);z&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var z=!1;if(f("mozilla"))for(var K=this.editNode.lastChild;K;){if(3===K.nodeType){if(0<K.nodeValue.replace(/^\s+|\s+$/g,"").length){z=!0;this.selection.selectElement(K);break}}else if(1===K.nodeType){z=!0;this.selection.selectElement(K.lastChild||K);break}K=K.previousSibling}else z=!0,this.selection.selectElementChildren(this.editNode);
z&&this.selection.collapse(!1)},getValue:function(z){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,z):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(z){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){z=this._preFilterContent(z);var K=this.isClosed?this.domNode:this.editNode;K.innerHTML=z;this._preDomFilterContent(K)}else this.textarea.value=z;this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(n.hitch(this,function(){this.setValue(z)}))},replaceValue:function(z){this.isClosed?this.setValue(z):this.window&&this.window.getSelection&&!f("mozilla")?this.setValue(z):this.window&&this.window.getSelection?(z=this._preFilterContent(z),this.execCommand("selectall"),this.execCommand("inserthtml",z),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(z);this._set("value",this.getValue(!0))},_preFilterContent:function(z){var K=
z;G.forEach(this.contentPreFilters,function(L){L&&(K=L(K))});return K},_preDomFilterContent:function(z){z=z||this.editNode;G.forEach(this.contentDomPreFilters,function(K){K&&n.isFunction(K)&&K(z)},this)},_postFilterContent:function(z,K){if(n.isString(z))var L=z;else z=z||this.editNode,this.contentDomPostFilters.length&&(K&&(z=n.clone(z)),G.forEach(this.contentDomPostFilters,function(N){z=N(z)})),L=E.getChildrenHtml(z);n.trim(L.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(L="");G.forEach(this.contentPostFilters,
function(N){L=N(L)});return L},_saveContent:function(){var z=t.byId(M._scopeName+"._editor.RichText.value");z&&(z.value&&(z.value+=this._SEPARATOR),z.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(z,K){z=z.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");K||(z=z.replace(/'/gm,"\x26#39;"));return z},getNodeHtml:function(z){b.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return E.getNodeHtml(z)},getNodeChildrenHtml:function(z){b.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return E.getChildrenHtml(z)},close:function(z){if(!this.isClosed){arguments.length||(z=!0);z&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);f("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var K=this.textarea.style;K.position="";K.left=K.top="";f("ie")&&(K.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;d.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;p.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);I._globalSaveHandler&&delete I._globalSaveHandler[this.id]},_removeMozBogus:function(z){return z.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(z){z=z.replace(/\sclass="webkit-block-placeholder"/gi,"");z=z.replace(/\sclass="apple-style-span"/gi,
"");return z=z.replace(/<meta charset="utf-8" \/>/gi,"")},_normalizeFontStyle:function(z){return z.replace(/<(\/)?strong([ >])/gi,"\x3c$1b$2").replace(/<(\/)?em([ >])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(z){return z.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(z){if(!z)return!1;
if(f("ie")||f("trident")||f("edge"))return this.focused&&!this.disabled;var K=9>f("ie")?this.document.selection.createRange():this.document;try{return K.queryCommandEnabled(z)}catch(L){return!1}},_createlinkEnabledImpl:function(){var z=!0;return z=f("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var z=!0;return z=f("mozilla")||f("webkit")||f("ie")||f("trident")||f("edge")?
this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var z=!0;return z=f("mozilla")||f("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var z=!0;f("webkit")?((z=this.window.getSelection())&&(z=z.toString()),z=!!z):z=this._browserQueryCommandEnabled("cut");return z},_copyEnabledImpl:function(){var z=!0;f("webkit")?((z=this.window.getSelection())&&(z=z.toString()),z=!!z):z=this._browserQueryCommandEnabled("copy");
return z},_pasteEnabledImpl:function(){var z=!0;return f("webkit")?!0:z=this._browserQueryCommandEnabled("paste")},_inserthorizontalruleImpl:function(z){return f("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,z)},_unlinkImpl:function(z){return this.queryCommandEnabled("unlink")&&(f("mozilla")||f("webkit"))?(z=this.selection.getAncestorElement("a"),this.selection.selectElement(z),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",
!1,z)},_hilitecolorImpl:function(z){if(!this._handleTextColorOrProperties("hilitecolor",z))if(f("mozilla")){this.document.execCommand("styleWithCSS",!1,!0);console.log("Executing color command.");var K=this.document.execCommand("hilitecolor",!1,z);this.document.execCommand("styleWithCSS",!1,!1)}else K=this.document.execCommand("hilitecolor",!1,z);return K},_backcolorImpl:function(z){f("ie")&&(z=z?z:null);var K=this._handleTextColorOrProperties("backcolor",z);K||(K=this.document.execCommand("backcolor",
!1,z));return K},_forecolorImpl:function(z){f("ie")&&(z=z?z:null);var K=!1;(K=this._handleTextColorOrProperties("forecolor",z))||(K=this.document.execCommand("forecolor",!1,z));return K},_inserthtmlImpl:function(z){z=this._preFilterContent(z);var K=!0;if(9>f("ie")){var L=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var N=L.item(0);L.length;)L.remove(L.item(0));N.outerHTML=z}else L.pasteHTML(z);L.select()}else if(8>f("trident")){var P=u.getSelection(this.window);
if(P&&P.rangeCount&&P.getRangeAt){L=P.getRangeAt(0);L.deleteContents();var T=d.create("div");T.innerHTML=z;for(N=this.document.createDocumentFragment();z=T.firstChild;)var S=N.appendChild(z);L.insertNode(N);S&&(L=L.cloneRange(),L.setStartAfter(S),L.collapse(!1),P.removeAllRanges(),P.addRange(L))}}else f("mozilla")&&!z.length?this.selection.remove():K=this.document.execCommand("inserthtml",!1,z);return K},_boldImpl:function(z){var K=!1;if(f("ie")||f("trident"))this._adaptIESelection(),K=this._adaptIEFormatAreaAndExec("bold");
K||(K=this.document.execCommand("bold",!1,z));return K},_italicImpl:function(z){var K=!1;if(f("ie")||f("trident"))this._adaptIESelection(),K=this._adaptIEFormatAreaAndExec("italic");K||(K=this.document.execCommand("italic",!1,z));return K},_underlineImpl:function(z){var K=!1;if(f("ie")||f("trident"))this._adaptIESelection(),K=this._adaptIEFormatAreaAndExec("underline");K||(K=this.document.execCommand("underline",!1,z));return K},_strikethroughImpl:function(z){var K=!1;if(f("ie")||f("trident"))this._adaptIESelection(),
K=this._adaptIEFormatAreaAndExec("strikethrough");K||(K=this.document.execCommand("strikethrough",!1,z));return K},_superscriptImpl:function(z){var K=!1;if(f("ie")||f("trident"))this._adaptIESelection(),K=this._adaptIEFormatAreaAndExec("superscript");K||(K=this.document.execCommand("superscript",!1,z));return K},_subscriptImpl:function(z){var K=!1;if(f("ie")||f("trident"))this._adaptIESelection(),K=this._adaptIEFormatAreaAndExec("subscript");K||(K=this.document.execCommand("subscript",!1,z));return K},
_fontnameImpl:function(z){if(f("ie")||f("trident"))var K=this._handleTextColorOrProperties("fontname",z);K||(K=this.document.execCommand("fontname",!1,z));return K},_fontsizeImpl:function(z){if(f("ie")||f("trident"))var K=this._handleTextColorOrProperties("fontsize",z);K||(K=this.document.execCommand("fontsize",!1,z));return K},_insertorderedlistImpl:function(z){var K=!1;if(f("ie")||f("trident")||f("edge"))K=this._adaptIEList("insertorderedlist",z);K||(K=this.document.execCommand("insertorderedlist",
!1,z));return K},_insertunorderedlistImpl:function(z){var K=!1;if(f("ie")||f("trident")||f("edge"))K=this._adaptIEList("insertunorderedlist",z);K||(K=this.document.execCommand("insertunorderedlist",!1,z));return K},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(z){var K=0;if(z&&z.childNodes){var L;for(L=0;L<z.childNodes.length;L++){var N=k.position(z.childNodes[L]);
K+=N.h}}return K},_isNodeEmpty:function(z,K){return 1===z.nodeType?0<z.childNodes.length?this._isNodeEmpty(z.childNodes[0],K):!0:3===z.nodeType?""===z.nodeValue.substring(K):!1},_removeStartingRangeFromRange:function(z,K){if(z.nextSibling)K.setStart(z.nextSibling,0);else{for(z=z.parentNode;z&&null==z.nextSibling;)z=z.parentNode;z&&K.setStart(z.nextSibling,0)}return K},_adaptIESelection:function(){var z=u.getSelection(this.window);if(z&&z.rangeCount&&!z.isCollapsed){for(var K=z.getRangeAt(0),L=K.startContainer,
N=K.startOffset;3===L.nodeType&&N>=L.length&&L.nextSibling;)N-=L.length,L=L.nextSibling;for(var P=null;this._isNodeEmpty(L,N)&&L!==P;)P=L,K=this._removeStartingRangeFromRange(L,K),L=K.startContainer,N=0;z.removeAllRanges();z.addRange(K)}},_adaptIEFormatAreaAndExec:function(z){var K=u.getSelection(this.window),L=this.document,N;if(z&&K&&K.isCollapsed){if(this.queryCommandValue(z)){z=this._tagNamesForCommand(z);var P=K.getRangeAt(0);var T=P.startContainer;if(3===T.nodeType){var S=P.endOffset;T.length<
S&&(S=this._adjustNodeAndOffset(Z,S),T=S.node,S=S.offset)}for(;T&&T!==this.editNode;){var Z=T.tagName?T.tagName.toLowerCase():"";if(-1<G.indexOf(z,Z)){var da=T;break}T=T.parentNode}if(da&&(Z=P.startContainer,z=L.createElement(da.tagName),d.place(z,da,"after"),Z&&3===Z.nodeType)){S=P.endOffset;Z.length<S&&(S=this._adjustNodeAndOffset(Z,S),Z=S.node,S=S.offset);T=Z.nodeValue;P=L.createTextNode(T.substring(0,S));var Q=T.substring(S,T.length);Q&&(N=L.createTextNode(Q));d.place(P,Z,"before");if(N){var W=
L.createElement("span");W.className="ieFormatBreakerSpan";d.place(W,Z,"after");d.place(N,W,"after");N=W}d.destroy(Z);S=P.parentNode;for(Z=[];S!==da;){T=S.tagName;P={tagName:T};Z.push(P);T=L.createElement(T);S.style&&T.style&&S.style.cssText&&(T.style.cssText=S.style.cssText,P.cssText=S.style.cssText);"FONT"===S.tagName&&(S.color&&(T.color=S.color,P.color=S.color),S.face&&(T.face=S.face,P.face=S.face),S.size&&(T.size=S.size,P.size=S.size));S.className&&(T.className=S.className,P.className=S.className);
if(N)for(;N;)P=N.nextSibling,T.appendChild(N),N=P;T.tagName==S.tagName?(W=L.createElement("span"),W.className="ieFormatBreakerSpan",d.place(W,S,"after"),d.place(T,W,"after")):d.place(T,S,"after");P=S;N=T;S=S.parentNode}if(N){if(1===N.nodeType||3===N.nodeType&&N.nodeValue)z.innerHTML="";for(;N;)P=N.nextSibling,z.appendChild(N),N=P}if(Z.length){P=Z.pop();N=L.createElement(P.tagName);P.cssText&&N.style&&(N.style.cssText=P.cssText);P.className&&(N.className=P.className);"FONT"===P.tagName&&(P.color&&
(N.color=P.color),P.face&&(N.face=P.face),P.size&&(N.size=P.size));for(d.place(N,z,"before");Z.length;)P=Z.pop(),da=L.createElement(P.tagName),P.cssText&&da.style&&(da.style.cssText=P.cssText),P.className&&(da.className=P.className),"FONT"===P.tagName&&(P.color&&(da.color=P.color),P.face&&(da.face=P.face),P.size&&(da.size=P.size)),N.appendChild(da),N=da;da=L.createTextNode(".");W.appendChild(da);N.appendChild(da)}else W=L.createElement("span"),W.className="ieFormatBreakerSpan",da=L.createTextNode("."),
W.appendChild(da),d.place(W,z,"before");N=u.create(this.window);N.setStart(da,0);N.setEnd(da,da.length);K.removeAllRanges();K.addRange(N);this.selection.collapse(!1);da.parentNode.innerHTML="";z.firstChild||d.destroy(z);return!0}return!1}P=K.getRangeAt(0);if((Z=P.startContainer)&&3===Z.nodeType)return S=P.startOffset,Z.length<S&&(S=this._adjustNodeAndOffset(Z,S),Z=S.node,S=S.offset),T=Z.nodeValue,P=L.createTextNode(T.substring(0,S)),Q=T.substring(S),""!==Q&&(N=L.createTextNode(T.substring(S))),W=
L.createElement("span"),da=L.createTextNode("."),W.appendChild(da),P.length?d.place(P,Z,"after"):P=Z,d.place(W,P,"after"),N&&d.place(N,W,"after"),d.destroy(Z),N=u.create(this.window),N.setStart(da,0),N.setEnd(da,da.length),K.removeAllRanges(),K.addRange(N),L.execCommand(z),d.place(W.firstChild,W,"before"),d.destroy(W),N.setStart(da,0),N.setEnd(da,da.length),K.removeAllRanges(),K.addRange(N),this.selection.collapse(!1),da.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(z){var K=u.getSelection(this.window);
if(K.isCollapsed&&K.rangeCount&&!this.queryCommandValue(z)){var L=K.getRangeAt(0),N=L.startContainer;if(N&&3==N.nodeType&&!L.startOffset)return L="ul","insertorderedlist"===z&&(L="ol"),z=this.document.createElement(L),L=d.create("li",null,z),d.place(z,N,"before"),L.appendChild(N),d.create("br",null,z,"after"),z=u.create(this.window),z.setStart(N,0),z.setEnd(N,N.length),K.removeAllRanges(),K.addRange(z),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(z,K){var L=u.getSelection(this.window),
N=this.document,P,T;K=K||null;if(z&&L&&L.isCollapsed&&L.rangeCount){var S=L.getRangeAt(0);if((P=S.startContainer)&&3===P.nodeType){var Z=S.startOffset;P.length<Z&&(S=this._adjustNodeAndOffset(P,Z),P=S.node,Z=S.offset);var da=P.nodeValue;S=N.createTextNode(da.substring(0,Z));""!==da.substring(Z)&&(T=N.createTextNode(da.substring(Z)));da=N.createElement("span");Z=N.createTextNode(".");da.appendChild(Z);N=N.createElement("span");da.appendChild(N);S.length?d.place(S,P,"after"):S=P;d.place(da,S,"after");
T&&d.place(T,da,"after");d.destroy(P);P=u.create(this.window);P.setStart(Z,0);P.setEnd(Z,Z.length);L.removeAllRanges();L.addRange(P);if(f("webkit")){L="color";if("hilitecolor"===z||"backcolor"===z)L="backgroundColor";c.set(da,L,K);this.selection.remove();d.destroy(N);da.innerHTML="\x26#160;";this.selection.selectElement(da);this.focus()}else this.execCommand(z,K),d.place(da.firstChild,da,"before"),d.destroy(da),P.setStart(Z,0),P.setEnd(Z,Z.length),L.removeAllRanges(),L.addRange(P),this.selection.collapse(!1),
Z.parentNode.removeChild(Z);return!0}}return!1},_adjustNodeAndOffset:function(z,K){for(;z.length<K&&z.nextSibling&&3===z.nextSibling.nodeType;)K-=z.length,z=z.nextSibling;return{node:z,offset:K}},_tagNamesForCommand:function(z){return"bold"===z?["b","strong"]:"italic"===z?["i","em"]:"strikethrough"===z?["s","strike"]:"superscript"===z?["sup"]:"subscript"===z?["sub"]:"underline"===z?["u"]:[]},_stripBreakerNodes:function(z){if(this.isLoaded)return g(".ieFormatBreakerSpan",z).forEach(function(K){for(;K.firstChild;)d.place(K.firstChild,
K,"before");d.destroy(K)}),z},_stripTrailingEmptyNodes:function(z){function K(L){return/^(p|div|br)$/i.test(L.nodeName)&&0==L.children.length&&/^[\s\xA0]*$/.test(L.textContent||L.innerText||"")||3===L.nodeType&&/^[\s\xA0]*$/.test(L.nodeValue)}for(;z.lastChild&&K(z.lastChild);)d.destroy(z.lastChild);return z},_setTextDirAttr:function(z){this._set("textDir",z);this.onLoadDeferred.then(n.hitch(this,function(){this.editNode.dir=z}))}});return I})},"dijit/selection":function(){define("dojo/_base/array dojo/dom dojo/_base/lang dojo/sniff dojo/_base/window dijit/focus".split(" "),
function(G,A,B,v,t,l){var p=function(k){var c=k.document;this.getType=function(){if(c.getSelection){var b="text";try{var h=k.getSelection()}catch(n){}h&&1==h.rangeCount&&(h=h.getRangeAt(0),h.startContainer==h.endContainer&&1==h.endOffset-h.startOffset&&3!=h.startContainer.nodeType&&(b="control"));return b}return c.selection.type.toLowerCase()};this.getSelectedText=function(){if(c.getSelection){var b=k.getSelection();return b?b.toString():""}return"control"==this.getType()?null:c.selection.createRange().text};
this.getSelectedHtml=function(){if(c.getSelection){var b=k.getSelection();if(b&&b.rangeCount){var h,n="";for(h=0;h<b.rangeCount;h++){var m=b.getRangeAt(h).cloneContents(),g=c.createElement("div");g.appendChild(m);n+=g.innerHTML}return n}return null}return"control"==this.getType()?null:c.selection.createRange().htmlText};this.getSelectedElement=function(){if("control"==this.getType()){if(c.getSelection){var b=k.getSelection();return b.anchorNode.childNodes[b.anchorOffset]}if((b=c.selection.createRange())&&
b.item)return c.selection.createRange().item(0)}return null};this.getParentElement=function(){if("control"==this.getType()){var b=this.getSelectedElement();if(b)return b.parentNode}else if(c.getSelection){if(b=c.getSelection()){for(b=b.anchorNode;b&&1!=b.nodeType;)b=b.parentNode;return b}}else return b=c.selection.createRange(),b.collapse(!0),b.parentElement();return null};this.hasAncestorElement=function(b){return null!=this.getAncestorElement.apply(this,arguments)};this.getAncestorElement=function(b){var h=
this.getSelectedElement()||this.getParentElement();return this.getParentOfType(h,arguments)};this.isTag=function(b,h){if(b&&b.tagName){b=b.tagName.toLowerCase();for(var n=0;n<h.length;n++){var m=String(h[n]).toLowerCase();if(b==m)return m}}return""};this.getParentOfType=function(b,h){for(;b;){if(this.isTag(b,h).length)return b;b=b.parentNode}return null};this.collapse=function(b){if(c.getSelection){var h=k.getSelection();h.removeAllRanges?b?h.collapseToStart():h.collapseToEnd():h.collapse(b)}else h=
c.selection.createRange(),h.collapse(b),h.select()};this.remove=function(){var b=c.selection;c.getSelection?(b=k.getSelection(),b.deleteFromDocument()):"none"!=b.type.toLowerCase()&&b.clear();return b};this.selectElementChildren=function(b,h){b=A.byId(b);if(c.getSelection)if(h=k.getSelection(),v("opera")){var n=h.rangeCount?h.getRangeAt(0):c.createRange();n.setStart(b,0);n.setEnd(b,3==b.nodeType?b.length:b.childNodes.length);h.addRange(n)}else h.selectAllChildren(b);else if(n=b.ownerDocument.body.createTextRange(),
n.moveToElementText(b),!h)try{n.select()}catch(m){}};this.selectElement=function(b,h){b=A.byId(b);if(c.getSelection){h=c.getSelection();var n=c.createRange();h.removeAllRanges&&(v("opera")&&h.getRangeAt(0)&&(n=h.getRangeAt(0)),n.selectNode(b),h.removeAllRanges(),h.addRange(n))}else try{var m=b.tagName?b.tagName.toLowerCase():"";n="img"===m||"table"===m?t.body(c).createControlRange():t.body(c).createRange();n.addElement(b);h||n.select()}catch(g){this.selectElementChildren(b,h)}};this.inSelection=function(b){if(b){var h;
if(c.getSelection){var n=k.getSelection();n&&0<n.rangeCount&&(h=n.getRangeAt(0));if(h&&h.compareBoundaryPoints&&c.createRange)try{var m=c.createRange();m.setStart(b,0);if(1===h.compareBoundaryPoints(h.START_TO_END,m))return!0}catch(g){}}else{h=c.selection.createRange();try{m=b.ownerDocument.body.createTextRange(),m.moveToElementText(b)}catch(g){}if(h&&m&&1===h.compareEndPoints("EndToStart",m))return!0}}return!1};this.getBookmark=function(){var b,h=c.selection,n=l.curNode;if(c.getSelection){if(h=k.getSelection())if(h.isCollapsed){if(b=
n?n.tagName:"")if(b=b.toLowerCase(),"textarea"==b||"input"==b&&(!n.type||"text"==n.type.toLowerCase()))return h={start:n.selectionStart,end:n.selectionEnd,node:n,pRange:!0},{isCollapsed:h.end<=h.start,mark:h};b={isCollapsed:!0};h.rangeCount&&(b.mark=h.getRangeAt(0).cloneRange())}else{var m=h.getRangeAt(0);b={isCollapsed:!1,mark:m.cloneRange()}}}else if(h){b=n?n.tagName:"";b=b.toLowerCase();if(n&&b&&("button"==b||"textarea"==b||"input"==b)){if(h.type&&"none"==h.type.toLowerCase())return{isCollapsed:!0,
mark:null};m=h.createRange();return{isCollapsed:m.text&&m.text.length?!1:!0,mark:{range:m,pRange:!0}}}b={};try{m=h.createRange(),b.isCollapsed=!("Text"==h.type?m.htmlText.length:m.length)}catch(g){return b.isCollapsed=!0,b}if("CONTROL"==h.type.toUpperCase())if(m.length)for(b.mark=[],h=0,n=m.length;h<n;)b.mark.push(m.item(h++));else b.isCollapsed=!0,b.mark=null;else b.mark=m.getBookmark()}else console.warn("No idea how to store the current selection for this browser!");return b};this.moveToBookmark=
function(b){if(b=b.mark)if(c.getSelection){var h=k.getSelection();h&&h.removeAllRanges?b.pRange?(h=b.node,h.selectionStart=b.start,h.selectionEnd=b.end):(h.removeAllRanges(),h.addRange(b)):console.warn("No idea how to restore selection for this browser!")}else if(c.selection&&b){if(b.pRange)var n=b.range;else B.isArray(b)?(n=c.body.createControlRange(),G.forEach(b,function(m){n.addElement(m)})):(n=c.body.createTextRange(),n.moveToBookmark(b));n.select()}};this.isCollapsed=function(){return this.getBookmark().isCollapsed}},
d=new p(window);d.SelectionManager=p;return d})},"dijit/_editor/range":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(G,A,B){var v={getIndex:function(p,d){for(var k=[],c=[],b=p,h,n;p!=d;){var m=0;for(h=p.parentNode;n=h.childNodes[m++];)if(n===p){--m;break}k.unshift(m);c.unshift(m-h.childNodes.length);p=h}if(0<k.length&&3==b.nodeType){for(n=b.previousSibling;n&&3==n.nodeType;)k[k.length-1]--,n=n.previousSibling;for(n=b.nextSibling;n&&3==n.nodeType;)c[c.length-
1]++,n=n.nextSibling}return{o:k,r:c}},getNode:function(p,d){if(!B.isArray(p)||0==p.length)return d;var k=d;G.every(p,function(c){if(0<=c&&c<k.childNodes.length)k=k.childNodes[c];else return k=null,!1;return!0});return k},getCommonAncestor:function(p,d,k){k=k||p.ownerDocument.body;var c=function(n){for(var m=[];n;)if(m.unshift(n),n!==k)n=n.parentNode;else break;return m};p=c(p);d=c(d);c=Math.min(p.length,d.length);for(var b=p[0],h=1;h<c;h++)if(p[h]===d[h])b=p[h];else break;return b},getAncestor:function(p,
d,k){for(k=k||p.ownerDocument.body;p&&p!==k;){var c=p.nodeName.toUpperCase();if(d.test(c))return p;p=p.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(p,d,k){k=k||p.ownerDocument.body;d=d||v.BlockTagNames;for(var c=null,b;p&&p!==k;){var h=p.nodeName.toUpperCase();!c&&d.test(h)&&(c=p);!b&&/^(?:BODY|TD|TH|CAPTION)$/.test(h)&&(b=p);p=p.parentNode}return{blockNode:c,blockContainer:b||p.ownerDocument.body}},atBeginningOfContainer:function(p,
d,k){var c=!1,b=0==k;b||3!=d.nodeType||/^[\s\xA0]+$/.test(d.nodeValue.substr(0,k))&&(b=!0);if(b)for(c=!0;d&&d!==p;){if(d.previousSibling){c=!1;break}d=d.parentNode}return c},atEndOfContainer:function(p,d,k){var c=!1,b=k==(d.length||d.childNodes.length);b||3!=d.nodeType||/^[\s\xA0]+$/.test(d.nodeValue.substr(k))&&(b=!0);if(b)for(c=!0;d&&d!==p;){if(d.nextSibling){c=!1;break}d=d.parentNode}return c},adjacentNoneTextNode:function(p,d){var k=p;p=0-p.length||0;for(d=d?"nextSibling":"previousSibling";k&&
3==k.nodeType;)p+=k.length,k=k[d];return[k,p]},create:function(p){p=p||window;return p.getSelection?p.document.createRange():new l},getSelection:function(p,d){if(p.getSelection)return p.getSelection();p=new t.selection(p);d||p._getCurrentSelection();return p}};if(!window.getSelection)var t=v.ie={cachedSelection:{},selection:function(p){this._ranges=[];this.addRange=function(d,k){this._ranges.push(d);k||d._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];
this.rangeCount=0};this.getRangeAt=function(d){return this._ranges[d]};this._getCurrentSelection=function(){this.removeAllRanges();var d=p.document.selection.createRange();d="CONTROL"==p.document.selection.type.toUpperCase()?new l(t.decomposeControlRange(d)):new l(t.decomposeTextRange(d));this.addRange(d,!0),this.isCollapsed=d.collapsed}},decomposeControlRange:function(p){var d=p.item(0),k=p.item(p.length-1);p=d.parentNode;var c=k.parentNode;d=v.getIndex(d,p).o[0];k=v.getIndex(k,c).o[0]+1;return[p,
d,c,k]},getEndPoint:function(p,d){var k=p.duplicate();k.collapse(!d);var c="EndTo"+(d?"End":"Start"),b=k.parentElement(),h;if(0<b.childNodes.length)G.every(b.childNodes,function(g,a){if(3!=g.nodeType)if(k.moveToElementText(g),0<k.compareEndPoints(c,p))if(h&&3==h.nodeType){n=h;var f=!0}else return n=b,m=a,!1;else{if(a==b.childNodes.length-1)return n=b,m=b.childNodes.length,!1}else a==b.childNodes.length-1&&(n=g,f=!0);if(f&&n)return n=(g=v.adjacentNoneTextNode(n)[0])?g.nextSibling:b.firstChild,a=v.adjacentNoneTextNode(n),
g=a[0],a=a[1],g?(k.moveToElementText(g),k.collapse(!1)):k.moveToElementText(b),k.setEndPoint(c,p),m=k.text.length-a,!1;h=g;return!0});else{var n=b;var m=0}d||1!=n.nodeType||m!=n.childNodes.length||(d=n.nextSibling)&&3==d.nodeType&&(n=d,m=0);return[n,m]},setEndPoint:function(p,d,k){p=p.duplicate();var c;if(3!=d.nodeType)if(0<k){if(c=d.childNodes[k-1])if(3==c.nodeType)d=c,k=c.length;else if(c.nextSibling&&3==c.nextSibling.nodeType)d=c.nextSibling,k=0;else{p.moveToElementText(c.nextSibling?c:d);var b=
c.parentNode;c=b.insertBefore(c.ownerDocument.createTextNode(" "),c.nextSibling);p.collapse(!1);b.removeChild(c)}}else p.moveToElementText(d),p.collapse(!0);3==d.nodeType&&(c=v.adjacentNoneTextNode(d),b=c[0],c=c[1],b?(p.moveToElementText(b),p.collapse(!1),"inherit"!=b.contentEditable&&c++):(p.moveToElementText(d.parentNode),p.collapse(!0),p.move("character",1),p.move("character",-1)),k+=c,0<k&&p.move("character",k)!=k&&console.error("Error when moving!"));return p},decomposeTextRange:function(p){var d=
t.getEndPoint(p),k=d[0],c=d[1],b=d[0];d=d[1];p.htmlText.length&&(p.htmlText==p.text?d=c+p.text.length:(d=t.getEndPoint(p,!0),b=d[0],d=d[1]));return[k,c,b,d]},setRange:function(p,d,k,c,b,h){d=t.setEndPoint(p,d,k);p.setEndPoint("StartToStart",d);if(!h)var n=t.setEndPoint(p,c,b);p.setEndPoint("EndToEnd",n||d);return p}},l=v.W3CRange=A(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=
null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=this.startContainer!==this.endContainer?v.getCommonAncestor(this.startContainer,this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(p,d){d=parseInt(d);if(this.startContainer!==p||this.startOffset!=d)delete this._cachedBookmark,this.startContainer=p,this.startOffset=
d,this.endContainer?this._updateInternal():this.setEnd(p,d)},setEnd:function(p,d){d=parseInt(d);if(this.endContainer!==p||this.endOffset!=d)delete this._cachedBookmark,this.endContainer=p,this.endOffset=d,this.startContainer?this._updateInternal():this.setStart(p,d)},setStartAfter:function(p,d){this._setPoint("setStart",p,d,1)},setStartBefore:function(p,d){this._setPoint("setStart",p,d,0)},setEndAfter:function(p,d){this._setPoint("setEnd",p,d,1)},setEndBefore:function(p,d){this._setPoint("setEnd",
p,d,0)},_setPoint:function(p,d,k,c){k=v.getIndex(d,d.parentNode).o;this[p](d.parentNode,k.pop()+c)},_getIERange:function(){var p=(this._body||this.endContainer.ownerDocument.body).createTextRange();t.setRange(p,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed);return p},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var p=this.startContainer,d=this._getIERange();3!==
p.nodeType||this.startOffset||this.setStartBefore(p);d.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var p=new l([this.startContainer,this.startOffset,this.endContainer,this.endOffset]);p._body=this._body;return p},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});B.setObject("dijit.range",v);return v})},"dijit/_editor/html":function(){define(["dojo/_base/array",
"dojo/_base/lang","dojo/sniff"],function(G,A,B){var v={};A.setObject("dijit._editor.html",v);var t=v.escapeXml=function(l,p){l=l.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");p||(l=l.replace(/'/gm,"\x26#39;"));return l};v.getNodeHtml=function(l){var p=[];v.getNodeHtmlHelper(l,p);return p.join("")};v.getNodeHtmlHelper=function(l,p){switch(l.nodeType){case 1:var d=l.nodeName.toLowerCase();if(!d||"/"==d.charAt(0))return"";p.push("\x3c",d);var k=
[],c={},b;if(B("dom-attributes-explicit")||B("dom-attributes-specified-flag"))for(var h=0;b=l.attributes[h++];){var n=b.name;"_dj"===n.substr(0,3)||B("dom-attributes-specified-flag")&&!b.specified||n in c||(b=b.value,("src"==n||"href"==n)&&l.getAttribute("_djrealurl")&&(b=l.getAttribute("_djrealurl")),8===B("ie")&&"style"===n&&(b=b.replace("HEIGHT:","height:").replace("WIDTH:","width:")),k.push([n,b]),c[n]=b)}else{var m=(/^input$|^img$/i.test(l.nodeName)?l:l.cloneNode(!1)).outerHTML;c=m.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi);
m=m.substr(0,m.indexOf("\x3e"));G.forEach(c,function(g){if(g){var a=g.indexOf("\x3d");if(0<a&&(g=g.substring(0,a),"_dj"!=g.substr(0,3)))if("src"!=g&&"href"!=g||!l.getAttribute("_djrealurl")){switch(g){case "style":var f=l.style.cssText.toLowerCase();break;case "class":f=l.className;break;case "width":if("img"===d){(a=/width=(\S+)/i.exec(m))&&(f=a[1]);break}case "height":if("img"===d){(a=/height=(\S+)/i.exec(m))&&(f=a[1]);break}default:f=l.getAttribute(g)}null!=f&&k.push([g,f.toString()])}else k.push([g,
l.getAttribute("_djrealurl")])}},this)}k.sort(function(g,a){return g[0]<a[0]?-1:g[0]==a[0]?0:1});for(c=0;b=k[c++];)p.push(" ",b[0],'\x3d"',"string"===typeof b[1]?t(b[1],!0):b[1],'"');switch(d){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":p.push(" /\x3e");break;case "script":p.push("\x3e",l.innerHTML,"\x3c/",d,"\x3e");break;default:p.push("\x3e"),l.hasChildNodes()&&v.getChildrenHtmlHelper(l,p),p.push("\x3c/",d,"\x3e")}break;case 4:case 3:p.push(t(l.nodeValue,
!0));break;case 8:p.push("\x3c!--",t(l.nodeValue,!0),"--\x3e");break;default:p.push("\x3c!-- Element not recognized - Type: ",l.nodeType," Name: ",l.nodeName,"--\x3e")}};v.getChildrenHtml=function(l){var p=[];v.getChildrenHtmlHelper(l,p);return p.join("")};v.getChildrenHtmlHelper=function(l,p){if(l)for(var d=l.childNodes||l,k=!B("ie")||d!==l,c,b=0;c=d[b++];)k&&c.parentNode!=l||v.getNodeHtmlHelper(c,p)};return v})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n){var m=B("dijit._editor.plugins.LinkDialog",b,{allowUnsafeHtml:!1,linkFilter:[[/</g,"\x26lt;"]],buttonClass:h,useDefaultCommand:!1,urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=l.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(a){G("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),l.hitch(this,function(f,e,r){var w=this;this.tag="insertImage"==this.command?"img":"a";f=l.delegate(f.getLocalization("dijit","common",this.lang),f.getLocalization("dijit._editor",
"LinkDialog",this.lang));var H=this.dropDown=this.button.dropDown=new e({title:f[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:l.hitch(this,"setValue"),onOpen:function(){w._onOpenDialog();e.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(l.hitch(w,"_onCloseDialog"),0)}});f.urlRegExp=this.urlRegExp;f.id=r.getUniqueId(this.editor.id);this._uniqueId=f.id;this._setContent(H.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
c.substitute(this.linkDialogTemplate,f));H.startup();this._urlInput=r.byId(this._uniqueId+"_urlInput");this._textInput=r.byId(this._uniqueId+"_textInput");this._setButton=r.byId(this._uniqueId+"_setButton");this.own(r.byId(this._uniqueId+"_cancelButton").on("click",l.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",l.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",l.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=l.hitch(this,function(){var x=this._urlInput.get("value");return this._urlRegExp.test(x)||this._emailRegExp.test(x)});this.own(p(H.domNode,"keydown",l.hitch(this,l.hitch(this,function(x){!x||x.keyCode!=t.ENTER||x.shiftKey||x.metaKey||x.ctrlKey||x.altKey||this._setButton.get("disabled")||(H.onExecute(),H.execute(H.get("value")))}))));a()}))},_checkAndFixInput:function(){var a=this,f=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var e=f,r=!1,w=!1;e&&1<e.length&&(e=l.trim(e),0!==e.indexOf("mailto:")&&(0<e.indexOf("/")?-1===e.indexOf("://")&&"/"!==e.charAt(0)&&e.indexOf("./")&&0!==e.indexOf("../")&&a._hostRxp.test(e)&&(r=!0):a._userAtRxp.test(e)&&(w=!0)));r&&a._urlInput.set("value","http://"+e);w&&a._urlInput.set("value","mailto:"+e);a._setButton.set("disabled",!a._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(l.hitch(this,
function(){this.own(p(this.editor.editNode,"mouseup",l.hitch(this,"_onMouseUp")));this.own(p(this.editor.editNode,"dblclick",l.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(a){this.dropDown.set({parserScope:"dojo",content:a})},_checkValues:function(a){a&&a.urlInput&&(a.urlInput=a.urlInput.replace(/"/g,"\x26quot;"));!this.allowUnsafeHtml&&a&&a.textInput&&("function"===typeof this.linkFilter?a.textInput=this.linkFilter(a.textInput):
A.forEach(this.linkFilter,function(f){a.textInput=a.textInput.replace(f[0],f[1])}));return a},_createlinkEnabledImpl:function(){return!0},setValue:function(a){this._onCloseDialog();if(9>d("ie")){var f=n.getSelection(this.editor.window).getRangeAt(0).endContainer;3===f.nodeType&&(f=f.parentNode);f&&f.nodeName&&f.nodeName.toLowerCase()!==this.tag&&(f=this.editor.selection.getSelectedElement(this.tag));f&&f.nodeName&&f.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(f),
this.editor.execCommand("unlink"))}a=this._checkValues(a);this.editor.execCommand("inserthtml",c.substitute(this.htmlTemplate,a));k("a",this.editor.document).forEach(function(e){e.innerHTML||v.has(e,"name")||e.parentNode.removeChild(e)},this)},_onCloseDialog:function(){this.editor.focused&&this.editor.focus()},_getCurrentValues:function(a){if(a&&a.tagName.toLowerCase()===this.tag){var f=a.getAttribute("_djrealurl")||a.getAttribute("href");var e=a.getAttribute("target")||"_self";var r=a.textContent||
a.innerText;this.editor.selection.selectElement(a,!0)}else r=this.editor.selection.getSelectedText();return{urlInput:f||"",textInput:r||"",targetSelect:e||""}},_onOpenDialog:function(){if(d("ie")){var a=n.getSelection(this.editor.window);if(a.rangeCount){var f=a.getRangeAt(0);var e=f.endContainer;3===e.nodeType&&(e=e.parentNode);e&&e.nodeName&&e.nodeName.toLowerCase()!==this.tag&&(e=this.editor.selection.getSelectedElement(this.tag));if(!e||e.nodeName&&e.nodeName.toLowerCase()!==this.tag)(a=this.editor.selection.getAncestorElement(this.tag))&&
a.nodeName&&a.nodeName.toLowerCase()==this.tag?(e=a,this.editor.selection.selectElement(e)):f.startContainer===f.endContainer&&(a=f.startContainer.firstChild)&&a.nodeName&&a.nodeName.toLowerCase()==this.tag&&(e=a,this.editor.selection.selectElement(e))}}else e=this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(e))},_onDblClick:function(a){if(a&&a.target&&(a=a.target,(a.tagName?a.tagName.toLowerCase():
"")===this.tag&&v.get(a,"href"))){var f=this.editor;this.editor.selection.selectElement(a);f.onDisplayChanged();f._updateTimer&&(f._updateTimer.remove(),delete f._updateTimer);f.onNormalizedDisplayChanged();var e=this.button;setTimeout(function(){e.set("disabled",!1);e.loadAndOpenDropDown().then(function(){e.dropDown.focus&&e.dropDown.focus()})},10)}},_onMouseUp:function(){if(d("ff")){var a=this.editor.selection.getAncestorElement(this.tag);if(a){var f=n.getSelection(this.editor.window).getRangeAt(0);
if(f.collapsed&&a.childNodes.length){var e=f.cloneRange();e.selectNodeContents(a.childNodes[a.childNodes.length-1]);e.setStart(a.childNodes[0],0);1!==f.compareBoundaryPoints(e.START_TO_START,e)?f.setStartBefore(a):-1!==f.compareBoundaryPoints(e.END_TO_START,e)&&f.setStartAfter(a)}}}}}),g=B("dijit._editor.plugins.ImgLinkDialog",[m],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(a){if(a&&a.tagName.toLowerCase()===this.tag){var f=a.getAttribute("_djrealurl")||a.getAttribute("src");var e=a.getAttribute("alt");this.editor.selection.selectElement(a,!0)}else e=this.editor.selection.getSelectedText();return{urlInput:f||"",textInput:e||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);
this.editor.onLoadDeferred.then(l.hitch(this,function(){this.own(p(this.editor.editNode,"mousedown",l.hitch(this,"_selectTag")))}))},_selectTag:function(a){a&&a.target&&(a=a.target,(a.tagName?a.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(a))},_checkValues:function(a){a&&a.urlInput&&(a.urlInput=a.urlInput.replace(/"/g,"\x26quot;"));a&&a.textInput&&(a.textInput=a.textInput.replace(/"/g,"\x26quot;"));return a},_onDblClick:function(a){if(a&&a.target&&(a=a.target,(a.tagName?
a.tagName.toLowerCase():"")===this.tag&&v.get(a,"src"))){var f=this.editor;this.editor.selection.selectElement(a);f.onDisplayChanged();f._updateTimer&&(f._updateTimer.remove(),delete f._updateTimer);f.onNormalizedDisplayChanged();var e=this.button;setTimeout(function(){e.set("disabled",!1);e.loadAndOpenDropDown().then(function(){e.dropDown.focus&&e.dropDown.focus()})},10)}}});b.registry.createLink=function(a){var f={command:"createLink",allowUnsafeHtml:"allowUnsafeHtml"in a?a.allowUnsafeHtml:!1};
"linkFilter"in a&&(f.linkFilter=a.linkFilter);return new m(f)};b.registry.insertImage=function(){return new g({command:"insertImage"})};m.ImgLinkDialog=g;return m})},"dijit/form/DropDownButton":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/query ../registry ../popup ./Button ../_Container ../_HasDropDown dojo/text!./templates/DropDownButton.html ../a11yclick".split(" "),function(G,A,B,v,t,l,p,d,k,c){return G("dijit.form.DropDownButton",[p,d,k],{baseClass:"dijitDropDownButton",
templateString:c,_fillContent:function(){var b=this.srcNodeRef,h=this.containerNode;if(b&&h)for(;b.hasChildNodes();){var n=b.firstChild;n.hasAttribute&&(n.hasAttribute("data-dojo-type")||n.hasAttribute("dojoType")||n.hasAttribute("data-"+A._scopeName+"-type")||n.hasAttribute(A._scopeName+"Type"))?(this.dropDownContainer=this.ownerDocument.createElement("div"),this.dropDownContainer.appendChild(n)):h.appendChild(n)}},startup:function(){this._started||(!this.dropDown&&this.dropDownContainer&&(this.dropDown=
t.byNode(this.dropDownContainer.firstChild),delete this.dropDownContainer),this.dropDown&&l.hide(this.dropDown),this.inherited(arguments))},isLoaded:function(){var b=this.dropDown;return!!b&&(!b.href||b.isLoaded)},loadDropDown:function(b){var h=this.dropDown,n=h.on("load",B.hitch(this,function(){n.remove();b()}));h.refresh()},isFocusable:function(){return this.inherited(arguments)&&!this._mouseDown}})})},"dijit/_HasDropDown":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on dojo/touch ./registry ./focus ./popup ./_FocusMixin".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a){return G("dijit._HasDropDown",a,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(f){this.disabled||this.readOnly||("MSPointerDown"!=f.type&&f.preventDefault(),this.own(b.once(this.ownerDocument,h.release,c.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(f){var e=
this.dropDown,r=!1;if(f&&this._opened){var w=l.position(this._buttonNode,!0);if(!(f.pageX>=w.x&&f.pageX<=w.x+w.w&&f.pageY>=w.y&&f.pageY<=w.y+w.h)){for(w=f.target;w&&!r;)t.contains(w,"dijitPopup")?r=!0:w=w.parentNode;if(r){w=f.target;if(e.onItemClick){for(var H;w&&!(H=n.byNode(w));)w=w.parentNode;if(H&&H.onClick&&H.getParent)H.getParent().onItemClick(H,f)}return}}}this._opened?e.focus&&(!1!==e.autoFocus||"mouseup"==f.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){e.focus();
delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(f){this._stopClickEvents&&(f.stopPropagation(),f.preventDefault())},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var f={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||
this.dropDownPosition[0]||"Down";t.add(this._arrowWrapperNode||this._buttonNode,"dijit"+f+"ArrowButton")},postCreate:function(){this.inherited(arguments);var f=this.focusNode||this.domNode;this.own(b(this._buttonNode,h.press,c.hitch(this,"_onDropDownMouseDown")),b(this._buttonNode,"click",c.hitch(this,"_onDropDownClick")),b(f,"keydown",c.hitch(this,"_onKey")),b(f,"keyup",c.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),
delete this.dropDown);this.inherited(arguments)},_onKey:function(f){if(!this.disabled&&!this.readOnly){var e=this.dropDown,r=f.target;e&&this._opened&&e.handleKey&&!1===e.handleKey(f)?(f.stopPropagation(),f.preventDefault()):e&&this._opened&&f.keyCode==k.ESCAPE?(this.closeDropDown(),f.stopPropagation(),f.preventDefault()):!this._opened&&(f.keyCode==k.DOWN_ARROW||(f.keyCode==k.ENTER||f.keyCode==k.SPACE&&(!this._searchTimer||f.ctrlKey||f.altKey||f.metaKey))&&("input"!==(r.tagName||"").toLowerCase()||
r.type&&"text"!==r.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,f.stopPropagation(),f.preventDefault())}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var f=this.dropDown;f&&f.focus&&this.defer(c.hitch(f,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(f){f()},loadAndOpenDropDown:function(){var f=new A,e=c.hitch(this,function(){this.openDropDown();f.resolve(this.dropDown)});
this.isLoaded()?e():this.loadDropDown(e);return f},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var f=this.dropDown,e=f.domNode,r=this._aroundNode||this.domNode,w=this,H=g.open({parent:this,popup:f,around:r,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){w.closeDropDown(!0)},onCancel:function(){w.closeDropDown(!0)},onClose:function(){v.set(w._popupStateNode,"popupActive",
!1);t.remove(w._popupStateNode,"dijitHasDropDownOpen");w._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&r.offsetWidth>f._popupWrapper.offsetWidth){r=r.offsetWidth-f._popupWrapper.offsetWidth;var x={w:f.domNode.offsetWidth+r};this._origStyle=e.style.cssText;c.isFunction(f.resize)?f.resize(x):l.setMarginBox(e,x);"R"==H.corner[1]&&(f._popupWrapper.style.left=f._popupWrapper.style.left.replace("px","")-r+"px")}v.set(this._popupStateNode,"popupActive","true");t.add(this._popupStateNode,"dijitHasDropDownOpen");
this._set("_opened",!0);this._popupStateNode.setAttribute("aria-expanded","true");this._popupStateNode.setAttribute("aria-owns",f.id);"presentation"===e.getAttribute("role")||e.getAttribute("aria-labelledby")||e.setAttribute("aria-labelledby",this.id);return H},closeDropDown:function(f){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer);this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),f&&this.focus&&this.focus(),g.close(this.dropDown),
this._opened=!1);this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})})},"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(G,A,B,v,t,l){var p=B("dijit._editor.plugins.TextColor",t,{buttonClass:l,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;this.inherited(arguments);var d=this;this.button.loadDropDown=
function(k){function c(b){d.button.dropDown=new b({dir:d.editor.dir,ownerDocument:d.editor.ownerDocument,value:d.value,onChange:function(h){d.editor.execCommand(d.command,h)},onExecute:function(){d.editor.execCommand(d.command,this.get("value"))}});k()}"string"==typeof d.colorPicker?G([d.colorPicker],c):c(d.colorPicker)}},updateState:function(){var d=this.editor,k=this.command;if(d&&d.isLoaded&&k.length){if(this.button){var c=this.get("disabled");this.button.set("disabled",c);if(c)return;try{var b=
d.queryCommandValue(k)||""}catch(h){b=""}}""==b&&(b="#000000");"transparent"==b&&(b="#ffffff");"string"==typeof b?-1<b.indexOf("rgb")&&(b=A.fromRgb(b).toHex()):(b=((b&255)<<16|b&65280|(b&16711680)>>>16).toString(16),b="#000000".slice(0,7-b.length)+b);this.value=b;(d=this.button.dropDown)&&d.get&&b!==d.get("value")&&d.set("value",b,!1)}}});t.registry.foreColor=function(d){return new p(d)};t.registry.hiliteColor=function(d){return new p(d)};return p})},"dojo/colors":function(){define(["./_base/kernel",
"./_base/lang","./_base/Color","./_base/array"],function(G,A,B,v){var t={};A.setObject("dojo.colors",t);var l=function(d,k,c){0>c&&++c;1<c&&--c;var b=6*c;return 1>b?d+(k-d)*b:1>2*c?k:2>3*c?d+(k-d)*(2/3-c)*6:d};G.colorFromRgb=B.fromRgb=function(d,k){var c=d.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(c){d=c[2].split(/\s*,\s*/);var b=d.length;c=c[1];if("rgb"==c&&3==b||"rgba"==c&&4==b)return c=d[0],"%"==c.charAt(c.length-1)?(c=v.map(d,function(m){return 2.56*parseFloat(m)}),4==b&&(c[3]=
d[3]),B.fromArray(c,k)):B.fromArray(d,k);if("hsl"==c&&3==b||"hsla"==c&&4==b){c=(parseFloat(d[0])%360+360)%360/360;var h=parseFloat(d[1])/100,n=parseFloat(d[2])/100;h=.5>=n?n*(h+1):n+h-n*h;n=2*n-h;c=[256*l(n,h,c+1/3),256*l(n,h,c),256*l(n,h,c-1/3),1];4==b&&(c[3]=d[3]);return B.fromArray(c,k)}}return null};var p=function(d,k,c){d=Number(d);return isNaN(d)?c:d<k?k:d>c?c:d};B.prototype.sanitize=function(){this.r=Math.round(p(this.r,0,255));this.g=Math.round(p(this.g,0,255));this.b=Math.round(p(this.b,
0,255));this.a=p(this.a,0,1);return this};t.makeGrey=B.makeGrey=function(d,k){return B.fromArray([d,d,d,k])};A.mixin(B.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,
20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,
191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,
205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,
0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,
238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],
tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return B})},"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f){G=G([c,b],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,templateString:a,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}' style\x3d'display: flex;'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;padding:0 2px;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},
_layerEditingCap:{},constructor:function(e,r){A.mixin(this,f.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);this._uploadField_connect=B.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=B.connect(this._uploadField,"onfocus",A.hitch(this,function(e){g.hide(this._attachmentError)}))},destroy:function(){v.forEach(this._aeConnects,B.disconnect);B.disconnect(this._uploadField_connect);B.disconnect(this._uploadFieldFocus_connect);
this.inherited(arguments)},showAttachments:function(e,r){this._attachmentList.innerHTML=this.NLS_none;this._uploadField.value="";v.forEach(this.domNode.children,function(w,H){g.show(w)});g.hide(this._attachmentError);e&&(this._featureLayer=e.getLayer()||r)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=
this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=this._featureLayer.getEditCapabilities({feature:e}).canUpdate,this._oid=e.attributes[this._featureLayer.objectIdField],this._getAttachments(e)):r&&r.getEditCapabilities()||(g.hide(this._uploadForm),v.forEach(this.domNode.children,function(w,H){g.hide(w)})))},_getAttachments:function(e){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,
A.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){g.hide(this._attachmentError);this._featureLayer&&this._featureLayer.addAttachment?(g.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,A.hitch(this,"_onAddAttachmentComplete"),A.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(e,r){this._tempUpload&&(g.show(this._attachmentProgress),r.addAttachment(e,this._tempUpload,A.hitch(this,"_onAddAttachmentComplete"),
A.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(e,r){g.show(this._attachmentProgress);this._featureLayer.deleteAttachments(e,[r],A.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(e){var r=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?
(r=this._listHtml+this._endHtml,this._uploadForm.style.display="none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(r=this._listHtml+this._endHtml);var w=this._attachmentList;e=v.map(e,A.hitch(this,function(H){return m.substitute({href:H.url,name:H.name,oid:H.objectId,attid:H.id},r)}));w.innerHTML=e.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(e){g.hide(this._attachmentProgress.domNode);var r=this._attachmentList,
w=this._uploadField,H=w.value,x=H.lastIndexOf("\\");-1<x&&(H=H.substring(x+1,H.length));H=H.replace(/ /g,"_");x=d.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()});var q=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(q=this._listHtml+this._endHtml);e=m.substitute({href:this._featureLayer._url.path+"/"+e.objectId+"/attachments/"+e.attachmentId+
(x?"?"+x:""),name:H,oid:e.objectId,attid:e.attachmentId},q);r.innerHTML=r.innerHTML==this.NLS_none?e:r.innerHTML+e;this._updateConnects();w.value=""},_onAddAttachmentError:function(e){g.hide(this._attachmentProgress.domNode);if(e){var r=this.NLS_error,w=this._attachmentError;m.isDefined(e.code)&&400===e.code&&(r=this.NLS_fileNotSupported);k.set(w,"innerHTML",r);g.show(w)}},_onDeleteAttachmentComplete:function(e){g.hide(this._attachmentProgress.domNode);var r=this._attachmentList;v.every(e,function(w){return w.success})&&
(t.query("#node_"+e[0].objectId+"_"+e[0].attachmentId).orphan(),r.children&&r.children.length||(r.innerHTML=this.NLS_none))},_updateConnects:function(){v.forEach(this._aeConnects,B.disconnect);t.query(".deleteAttachment").forEach(function(e){this._aeConnects.push(B.connect(e,"onclick",A.hitch(this,"_deleteAttachment",this._oid,e.id)))},this)}});l("extend-esri")&&A.setObject("dijit.editing.AttachmentEditor",G,n);return G})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(G,A,B,v,t,l,p,d){return A("dijit.ProgressBar",[l,p],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:d,_indeterminateHighContrastImagePath:G.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(k){var c="rtl"==k.toLowerCase();B.toggle(this.domNode,"dijitProgressBarRtl",c);B.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&c);this.inherited(arguments)},update:function(k){v.mixin(this,k||{});k=this.internalProgress;var c=this.domNode,b=1;this.indeterminate?c.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(b=Math.min(parseFloat(this.progress)/100,1),this.progress=b*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),b=this.maximum?this.progress/this.maximum:0),c.setAttribute("aria-valuenow",this.progress));c.setAttribute("aria-labelledby",this.labelNode.id);c.setAttribute("aria-valuemin",0);c.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(b);B.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);B.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());k.style.width=100*b+"%";this.onChange()},_setValueAttr:function(k){this._set("value",
k);Infinity==k?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:k})},_setLabelAttr:function(k){this._set("label",k);this.update()},_setIndeterminateAttr:function(k){this._set("indeterminate",k);this.update()},report:function(k){return this.label?this.label:this.indeterminate?"\x26#160;":t.format(k,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(G,A,B,v){var t={};t={findFeatures:function(l,p,d){var k=p.objectIdField;p=A.filter(p.graphics,function(c){return A.some(l,function(b){return c.attributes[k]===b.objectId})});if(d)d(p);else return p},getSelection:function(l){var p=[];A.forEach(l,function(d){d=d.getSelectedFeatures();A.forEach(d,function(k){p.push(k)})});return p},sortFeaturesById:function(l,p){var d=A.map(l,function(k){return k.featureLayer});p.sort(function(k,c){var b=k.getLayer(),h=c.getLayer();if(!b)return-1;if(!h)return 1;
var n=A.indexOf(d,b);h=A.indexOf(d,h);n-=h;n||(b=b.objectIdField,n=k.attributes[b]-c.attributes[b]);return n});return p}};B("extend-esri")&&G.setObject("dijit.editing.Util.LayerHelper",t,v);return t})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(G,A,B){return G("dijit.form.DateTextBox",B,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",popupClass:A,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f){var e=v("dijit.Calendar",[n,m,g],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(r){d.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",r)},_createMonthWidget:function(){return new e._MonthDropDownButton({id:this.id+"_mddb",
tabIndex:-1,onMonthSelect:c.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(b(this.domNode,"keydown",c.hitch(this,"_onKeyDown")),b(this.dateRowsNode,"mouseover",c.hitch(this,"_onDayMouseOver")),b(this.dateRowsNode,"mouseout",c.hitch(this,"_onDayMouseOut")),b(this.dateRowsNode,"mousedown",c.hitch(this,"_onDayMouseDown")),b(this.dateRowsNode,"mouseup",c.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(r){var w=
new this.dateClassObj(this.currentFocus);w.setDate(1);w.setMonth(r);r=this.dateModule.getDaysInMonth(w);var H=this.currentFocus.getDate();w.setDate(Math.min(H,r));this._setCurrentFocusAttr(w)},_onDayMouseOver:function(r){(r=l.contains(r.target,"dijitCalendarDateLabel")?r.target.parentNode:r.target)&&(r.dijitDateValue&&!l.contains(r,"dijitCalendarDisabledDate")||r==this.previousYearLabelNode||r==this.nextYearLabelNode)&&(l.add(r,"dijitCalendarHoveredDate"),this._currentNode=r)},_onDayMouseOut:function(r){!this._currentNode||
r.relatedTarget&&r.relatedTarget.parentNode==this._currentNode||(r="dijitCalendarHoveredDate",l.contains(this._currentNode,"dijitCalendarActiveDate")&&(r+=" dijitCalendarActiveDate"),l.remove(this._currentNode,r),this._currentNode=null)},_onDayMouseDown:function(r){(r=r.target.parentNode)&&r.dijitDateValue&&!l.contains(r,"dijitCalendarDisabledDate")&&(l.add(r,"dijitCalendarActiveDate"),this._currentNode=r)},_onDayMouseUp:function(r){(r=r.target.parentNode)&&r.dijitDateValue&&l.remove(r,"dijitCalendarActiveDate")},
handleKey:function(r){var w=-1,H=this.currentFocus;switch(r.keyCode){case k.RIGHT_ARROW:w=1;case k.LEFT_ARROW:var x="day";this.isLeftToRight()||(w*=-1);break;case k.DOWN_ARROW:w=1;case k.UP_ARROW:x="week";break;case k.PAGE_DOWN:w=1;case k.PAGE_UP:x=r.ctrlKey||r.altKey?"year":"month";break;case k.END:H=this.dateModule.add(H,"month",1),x="day";case k.HOME:H=new this.dateClassObj(H);H.setDate(1);break;default:return!0}x&&(H=this.dateModule.add(H,x,w));this._setCurrentFocusAttr(H);return!1},_onKeyDown:function(r){this.handleKey(r)||
(r.stopPropagation(),r.preventDefault())},onValueSelected:function(){},onChange:function(r){this.onValueSelected(r)},getClassForDate:function(){}});e._MonthDropDownButton=v("dijit.Calendar._MonthDropDownButton",f,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new e._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(r){var w=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,r);this.dropDown.set("months",
w);this.containerNode.innerHTML=(6==h("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+w[r.getMonth()]+"\x3c/div\x3e"}});e._MonthDropDown=v("dijit.Calendar._MonthDropDown",[m,a,g],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(r){this.domNode.innerHTML=
"";G.forEach(r,function(w,H){p.create("div",{className:"dijitCalendarMonthLabel",month:H,innerHTML:w},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(r){this.onChange(t.get(r.target,"month"))},onChange:function(){}});return e})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a){var f=A("dijit.CalendarLite",[m,g],{templateString:a,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(e){return e&&!isNaN(e)&&"object"==typeof e&&e.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var e=this._get("value");if(e&&!isNaN(e)){var r=
new this.dateClassObj(e);r.setHours(0,0,0,0);r.getDate()<e.getDate()&&(r=this.dateModule.add(r,"hour",1));return r}return null},_setValueAttr:function(e,r){"string"==typeof e&&(e=l.fromISOString(e));e=this._patchDate(e);if(this._isValidDate(e)&&!this.isDisabledDate(e,this.lang)){if(this._set("value",e),this.set("currentFocus",e),this._markSelectedDates([e]),this._created&&(r||"undefined"==typeof r))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(e){if(e||
0===e)e=new this.dateClassObj(e),e.setHours(1,0,0,0);return e},_setText:function(e,r){for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(e.ownerDocument.createTextNode(r))},_populateGrid:function(){var e=new this.dateClassObj(this.currentFocus);e.setDate(1);e=this._patchDate(e);var r=e.getDay(),w=this.dateModule.getDaysInMonth(e),H=this.dateModule.getDaysInMonth(this.dateModule.add(e,"month",-1)),x=new this.dateClassObj,q=0<=this.dayOffset?this.dayOffset:B.getFirstDayOfWeek(this.lang);q>
r&&(q-=7);if(!this.summary){var C=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,e);this.gridNode.setAttribute("summary",C[e.getMonth()])}this._date2cell={};G.forEach(this.dateCells,function(F,u){var E=u+q,D=new this.dateClassObj(e),M="dijitCalendar",I=0;E<r?(E=H-r+E+1,I=-1,M+="Previous"):E>=r+w?(E=E-r-w+1,I=1,M+="Next"):(E=E-r+1,M+="Current");I&&(D=this.dateModule.add(D,"month",I));D.setDate(E);this.dateModule.compare(D,x,"date")||(M="dijitCalendarCurrentDate "+M);this.isDisabledDate(D,
this.lang)?(M="dijitCalendarDisabledDate "+M,F.setAttribute("aria-disabled","true")):(M="dijitCalendarEnabledDate "+M,F.removeAttribute("aria-disabled"),F.setAttribute("aria-selected","false"));(I=this.getClassForDate(D,this.lang))&&(M=I+" "+M);F.className=M+"Month dijitCalendarDateTemplate";M=D.valueOf();this._date2cell[M]=F;F.dijitDateValue=M;M=D.getDateLocalized?D.getDateLocalized(this.lang):D.getDate();this._setText(this.dateLabels[u],M);k.set(F,"aria-label",t.format(D,{selector:"date",formatLength:"long"}))},
this)},_populateControls:function(){var e=new this.dateClassObj(this.currentFocus);e.setDate(1);this.monthWidget.set("month",e);var r=e.getFullYear()-1,w=new this.dateClassObj;G.forEach(["previous","current","next"],function(H){w.setFullYear(r++);this._setText(this[H+"YearLabelNode"],this.dateLocaleModule.format(w,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(e){this.dateModule=e.datePackage?c.getObject(e.datePackage,
!1):v;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=e.datePackage?c.getObject(e.datePackage+".locale",!1):t},_createMonthWidget:function(){return f._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var e=this.dowTemplateString,r=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),w=0<=this.dayOffset?this.dayOffset:B.getFirstDayOfWeek(this.lang);this.dayCellsHtml=n.substitute([e,
e,e,e,e,e,e].join(""),{d:""},function(){return r[w++%7]});e=n.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[e,e,e,e,e,e].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);p.setSelectable(this.domNode,!1);e=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",e,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var e=c.hitch(this,function(r,
w,H){this[r].dojoClick=!0;return b(this[r],"click",c.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,w,H))}))});this.own(e("incrementMonth","month",1),e("decrementMonth","month",-1),e("nextYearLabelNode","year",1),e("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(e,r){var w=this.currentFocus,H=this._getNodeByDate(w);e=this._patchDate(e);this._set("currentFocus",e);this._date2cell&&0==this.dateModule.difference(w,e,"month")||(this._populateGrid(),
this._populateControls(),this._markSelectedDates([this.value]));e=this._getNodeByDate(e);e.setAttribute("tabIndex",this.tabIndex);(this.focused||r)&&e.focus();H&&H!=e&&(h("webkit")?H.setAttribute("tabIndex","-1"):H.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(e){e.stopPropagation();e.preventDefault();for(e=e.target;e&&!e.dijitDateValue&&0!==e.dijitDateValue;e=e.parentNode);e&&!d.contains(e,"dijitCalendarDisabledDate")&&this.set("value",
e.dijitDateValue)},_getNodeByDate:function(e){return(e=this._patchDate(e))&&this._date2cell?this._date2cell[e.valueOf()]:null},_markSelectedDates:function(e){function r(w,H){d.toggle(H,"dijitCalendarSelectedDate",w);H.setAttribute("aria-selected",w?"true":"false")}G.forEach(this._selectedCells||[],c.partial(r,!1));this._selectedCells=G.filter(G.map(e,this._getNodeByDate,this),function(w){return w});G.forEach(this._selectedCells,c.partial(r,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});
f._MonthWidget=A("dijit.CalendarLite._MonthWidget",m,{_setMonthAttr:function(e){var r=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,e),w=6==h("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+G.map(r,function(H){return"\x3cdiv\x3e"+H+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=w+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+r[e.getMonth()]+"\x3c/div\x3e"}});return f})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(G,A,B,v,t,l,p,d){new Date("X");return v("dijit.form._DateTimeTextBox",[l,p],{templateString:d,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:A.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(k,c){var b=this._isInvalidDate(k),h=this._isInvalidDate(c);if(b||h)return b&&h?0:b?-1:1;k=this.format(k,this._unboundedConstraints);c=this.format(c,this._unboundedConstraints);
b=this.parse(k,this._unboundedConstraints);h=this.parse(c,this._unboundedConstraints);return k==c?0:G.compare(b,h,this._selector)},autoWidth:!0,format:function(k,c){return k?this.dateLocaleModule.format(k,c):""},parse:function(k,c){return this.dateLocaleModule.parse(k,c)||(this._isEmpty(k)?null:void 0)},serialize:function(k,c){k.toGregorian&&(k=k.toGregorian());return B.toISOString(k,c)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(k){k=
k||{};this.dateModule=k.datePackage?t.getObject(k.datePackage,!1):G;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=k.datePackage?t.getObject(k.datePackage+".locale",!1):A;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(k){k.selector=this._selector;k.fullYear=!0;var c=B.fromISOString;"string"==typeof k.min&&(k.min=c(k.min),this.dateClassObj instanceof Date||(k.min=new this.dateClassObj(k.min)));"string"==typeof k.max&&(k.max=c(k.max),this.dateClassObj instanceof Date||(k.max=new this.dateClassObj(k.max)));this.inherited(arguments);this._unboundedConstraints=t.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(k){return!k||
isNaN(k)||"object"!=typeof k||k.toString()==this._invalidDate},_setValueAttr:function(k,c,b){void 0!==k&&("string"==typeof k&&(k=B.fromISOString(k)),this._isInvalidDate(k)&&(k=null),k instanceof Date&&!(this.dateClassObj instanceof Date)&&(k=new this.dateClassObj(k)));this.inherited(arguments,[k,c,b]);this.value instanceof Date&&(this.filterString="");!1!==c&&this.dropDown&&this.dropDown.set("value",k,!1)},_set:function(k,c){if("value"==k){c instanceof Date&&!(this.dateClassObj instanceof Date)&&
(c=new this.dateClassObj(c));var b=this._get("value");if(b instanceof this.dateClassObj&&0==this.compare(c,b))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(k){this._isInvalidDate(k)&&(k=new this.dateClassObj);this._set("dropDownDefaultValue",k)},openDropDown:function(k){this.dropDown&&this.dropDown.destroy();var c=t.isString(this.popupClass)?t.getObject(this.popupClass,!1):this.popupClass,b=this,h=this.get("value");this.dropDown=new c({onChange:function(n){b.set("value",
n,!0)},id:this.id+"_popup",dir:b.dir,lang:b.lang,value:h,textDir:b.textDir,currentFocus:this._isInvalidDate(h)?this.dropDownDefaultValue:h,constraints:b.constraints,filterString:b.filterString,datePackage:b.datePackage,isDisabledDate:function(n){return!b.rangeCheck(n,b.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(k,c){this._setValueAttr(this.parse(k,this.constraints),c,k)}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare",
"dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(G,A,B){return G("dijit.form.RangeBoundTextBox",B,{rangeMessage:"",rangeCheck:function(v,t){return("min"in t?0<=this.compare(v,t.min):!0)&&("max"in t?0>=this.compare(v,t.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var v=this.get("value");if(null==v)return!1;var t=!1;"min"in this.constraints&&(t=this.constraints.min,t=0>this.compare(v,"number"==typeof t&&
0<=t&&0!=v?0:t));!t&&"max"in this.constraints&&(t=this.constraints.max,t=0<this.compare(v,"number"!=typeof t||0<t?t:0));return t},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(v){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(v))},getErrorMessage:function(v){var t=this.get("value");return null==t||""===t||"number"==typeof t&&isNaN(t)||this.isInRange(v)?this.inherited(arguments):this.rangeMessage},
postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=A.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(G,A,B,v){return G("dijit.form.MappedTextBox",v,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(t){return t.toString?
t.toString():""},toString:function(){var t=this.filter(this.get("value"));return null!=t?"string"==typeof t?t:this.serialize(t,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=B.place("\x3cinput type\x3d'hidden'"+(this.name&&!A("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},
"dijit/form/ValidationTextBox":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/i18n ./TextBox ../Tooltip dojo/text!./templates/ValidationTextBox.html dojo/i18n!./nls/validate".split(" "),function(G,A,B,v,t,l,p){var d=G("dijit.form.ValidationTextBox",t,{templateString:p,required:!1,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},pattern:".*",regExp:"",regExpGen:function(){},state:"",tooltipPosition:[],_deprecateRegExp:function(k,
c){c!=d.prototype[k]&&(A.deprecated("ValidationTextBox id\x3d"+this.id+", set('"+k+"', ...) is deprecated.  Use set('pattern', ...) instead.","","2.0"),this.set("pattern",c))},_setRegExpGenAttr:function(k){this._deprecateRegExp("regExpGen",k);this._set("regExpGen",this._computeRegexp)},_setRegExpAttr:function(k){this._deprecateRegExp("regExp",k)},_setValueAttr:function(){this.inherited(arguments);this._refreshState()},validator:function(k,c){return(new RegExp("^(?:"+this._computeRegexp(c)+")"+(this.required?
"":"?")+"$")).test(k)&&(!this.required||!this._isEmpty(k))&&(this._isEmpty(k)||void 0!==this.parse(k,c))},_isValidSubset:function(){return 0==this.textbox.value.search(this._partialre)},isValid:function(){return this.validator(this.textbox.value,this.get("constraints"))},_isEmpty:function(k){return(this.trim?/^\s*$/:/^$/).test(k)},getErrorMessage:function(){var k="$_unset_$"==this.invalidMessage?this.messages.invalidMessage:this.invalidMessage?this.invalidMessage:this.promptMessage,c="$_unset_$"==
this.missingMessage?this.messages.missingMessage:this.missingMessage?this.missingMessage:k;return this.required&&this._isEmpty(this.textbox.value)?c:k},getPromptMessage:function(){return this.promptMessage},_maskValidSubsetError:!0,validate:function(k){var c="",b=this.disabled||this.isValid(k);b&&(this._maskValidSubsetError=!0);var h=this._isEmpty(this.textbox.value),n=!b&&k&&this._isValidSubset();this._set("state",b?"":((!this._hasBeenBlurred||k)&&h||n)&&(this._maskValidSubsetError||n&&!this._hasBeenBlurred&&
k)?"Incomplete":"Error");this.focusNode.setAttribute("aria-invalid","Error"==this.state?"true":"false");"Error"==this.state?(this._maskValidSubsetError=k&&n,c=this.getErrorMessage(k)):"Incomplete"==this.state?(c=this.getPromptMessage(k),this._maskValidSubsetError=!this._hasBeenBlurred||k):h&&(c=this.getPromptMessage(k));this.set("message",c);return b},displayMessage:function(k){k&&this.focused?l.show(k,this.domNode,this.tooltipPosition,!this.isLeftToRight()):l.hide(this.domNode)},_refreshState:function(){this._created&&
this.validate(this.focused);this.inherited(arguments)},constructor:function(k){this.constraints=B.clone(this.constraints);this.baseClass+=" dijitValidationTextBox"},startup:function(){this.inherited(arguments);this._refreshState()},_setConstraintsAttr:function(k){!k.locale&&this.lang&&(k.locale=this.lang);this._set("constraints",k);this._refreshState()},_setPatternAttr:function(k){this._set("pattern",k);this._refreshState()},_computeRegexp:function(k){var c=this.pattern;"function"==typeof c&&(c=c.call(this,
k));if(c!=this._lastRegExp){var b="";this._lastRegExp=c;".*"!=c&&c.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(h){switch(h.charAt(0)){case "{":case "+":case "?":case "*":case "^":case "$":case "|":case "(":b+=h;break;case ")":b+="|$)";break;default:b+="(?:"+h+"|$)"}});try{"".search(b)}catch(h){b=this.pattern,console.warn("RegExp error in "+this.declaredClass+": "+this.pattern)}this._partialre="^(?:"+b+")$"}return c},postMixInProperties:function(){this.inherited(arguments);this.messages=
v.getLocalization("dijit.form","validate",this.lang);this._setConstraintsAttr(this.constraints)},_setDisabledAttr:function(k){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(k){this._set("required",k);this.focusNode.setAttribute("aria-required",k);this._refreshState()},_setMessageAttr:function(k){this._set("message",k);this.displayMessage(k)},reset:function(){this._maskValidSubsetError=!0;this.inherited(arguments)},_onBlur:function(){this.displayMessage("");this.inherited(arguments)},
destroy:function(){l.hide(this.domNode);this.inherited(arguments)}});return d})},"dijit/form/TextBox":function(){define("dojo/_base/declare dojo/dom-construct dojo/dom-style dojo/_base/kernel dojo/_base/lang dojo/on dojo/sniff ./_FormValueWidget ./_TextBoxMixin dojo/text!./templates/TextBox.html ../main".split(" "),function(G,A,B,v,t,l,p,d,k,c,b){d=G("dijit.form.TextBox"+(p("dojo-bidi")?"_NoBidi":""),[d,k],{templateString:c,_singleNodeTemplate:'\x3cinput class\x3d"dijit dijitReset dijitLeft dijitInputField" data-dojo-attach-point\x3d"textbox,focusNode" autocomplete\x3d"off" type\x3d"${type}" ${!nameAttrSetting} /\x3e',
_buttonInputDisabled:p("ie")?"disabled":"",baseClass:"dijitTextBox",postMixInProperties:function(){var h=this.type.toLowerCase();if(this.templateString&&"input"==this.templateString.toLowerCase()||("hidden"==h||"file"==h)&&this.templateString==this.constructor.prototype.templateString)this.templateString=this._singleNodeTemplate;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);9>p("ie")&&this.defer(function(){try{var h=B.getComputedStyle(this.domNode);if(h){var n=h.fontFamily;
if(n){var m=this.domNode.getElementsByTagName("INPUT");if(m)for(h=0;h<m.length;h++)m[h].style.fontFamily=n}}}catch(g){}})},_setPlaceHolderAttr:function(h){this._set("placeHolder",h);this._phspan||(this._attachPoints.push("_phspan"),this._phspan=A.create("span",{className:"dijitPlaceHolder dijitInputField"},this.textbox,"after"),this.own(l(this._phspan,"mousedown",function(n){n.preventDefault()}),l(this._phspan,"touchend, pointerup, MSPointerUp",t.hitch(this,function(){this.focus()}))));this._phspan.innerHTML=
"";this._phspan.appendChild(this._phspan.ownerDocument.createTextNode(h));this._updatePlaceHolder()},_onInput:function(h){this.inherited(arguments);this._updatePlaceHolder()},_updatePlaceHolder:function(){this._phspan&&(this._phspan.style.display=this.placeHolder&&!this.textbox.value?"":"none")},_setValueAttr:function(h,n,m){this.inherited(arguments);this._updatePlaceHolder()},getDisplayedValue:function(){v.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use get('displayedValue') instead.",
"","2.0");return this.get("displayedValue")},setDisplayedValue:function(h){v.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");this.set("displayedValue",h)},_onBlur:function(h){this.disabled||(this.inherited(arguments),this._updatePlaceHolder(),p("mozilla")&&this.selectOnClick&&(this.textbox.selectionStart=this.textbox.selectionEnd=void 0))},_onFocus:function(h){this.disabled||this.readOnly||(this.inherited(arguments),this._updatePlaceHolder())}});
9>p("ie")&&(d.prototype._isTextSelected=function(){var h=this.ownerDocument.selection.createRange();return h.parentElement()==this.textbox&&0<h.text.length},b._setSelectionRange=k._setSelectionRange=function(h,n,m){h.createTextRange&&(h=h.createTextRange(),h.collapse(!0),h.moveStart("character",-99999),h.moveStart("character",n),h.moveEnd("character",m-n),h.select())});p("dojo-bidi")&&(d=G("dijit.form.TextBox",d,{_setPlaceHolderAttr:function(h){this.inherited(arguments);this.applyTextDir(this._phspan)}}));
return d})},"dijit/form/_FormValueWidget":function(){define(["dojo/_base/declare","dojo/sniff","./_FormWidget","./_FormValueMixin"],function(G,A,B,v){return G("dijit.form._FormValueWidget",[B,v],{_layoutHackIE7:function(){if(7==A("ie"))for(var t=this.domNode,l=t.parentNode,p=t.firstChild||t,d=p.style.filter,k=this;l&&0==l.clientHeight;)(function(){var c=k.connect(l,"onscroll",function(){k.disconnect(c);p.style.filter=(new Date).getMilliseconds();k.defer(function(){p.style.filter=d})})})(),l=l.parentNode}})})},
"dijit/form/_FormValueMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormWidgetMixin".split(" "),function(G,A,B,v,t,l,p){return G("dijit.form._FormValueMixin",p,{readOnly:!1,_setReadOnlyAttr:function(d){l("trident")&&"disabled"in this?A.set(this.focusNode,"readOnly",d||this.disabled):A.set(this.focusNode,"readOnly",d);this._set("readOnly",d)},postCreate:function(){this.inherited(arguments);void 0===this._resetValue&&(this._lastValueReported=
this._resetValue=this.value)},_setValueAttr:function(d,k){this._handleOnChange(d,k)},_handleOnChange:function(d,k){this._set("value",d);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,!1)},reset:function(){this._hasBeenBlurred=!1;this._setValueAttr(this._resetValue,!0)}})})},"dijit/form/_TextBoxMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/sniff dojo/keys dojo/_base/lang dojo/on ../main".split(" "),function(G,A,B,v,t,l,p,d){var k=
A("dijit.form._TextBoxMixin"+(v("dojo-bidi")?"_NoBidi":""),null,{trim:!1,uppercase:!1,lowercase:!1,propercase:!1,maxLength:"",selectOnClick:!1,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(c,b,h){if(void 0!==c){var n=this.filter(c);"string"!=typeof h&&(h=null===n||"number"==typeof n&&isNaN(n)?"":this.filter(this.format(n,this.constraints)),0!=this.compare(n,this.filter(this.parse(h,this.constraints)))&&(h=null))}null==
h||"number"==typeof h&&isNaN(h)||this.textbox.value==h||(this.textbox.value=h,this._set("displayedValue",this.get("displayedValue")));this.inherited(arguments,[n,b])},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},_setDisplayedValueAttr:function(c){null==c?c="":"string"!=typeof c&&(c=String(c));this.textbox.value=c;this._setValueAttr(this.get("value"),void 0);this._set("displayedValue",this.get("displayedValue"))},format:function(c){return null==c?"":c.toString?
c.toString():c},parse:function(c){return c},_refreshState:function(){},onInput:function(){},_onInput:function(c){this._lastInputEventValue=this.textbox.value;this._processInput(this._lastInputProducingEvent||c);delete this._lastInputProducingEvent;this.intermediateChanges&&this._handleOnChange(this.get("value"),!1)},_processInput:function(){this._refreshState();this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);
this.own(p(this.textbox,"keydown, keypress, paste, cut, compositionend",l.hitch(this,function(c){if("keydown"==c.type&&229!=c.keyCode){var b=c.keyCode;switch(b){case t.SHIFT:case t.ALT:case t.CTRL:case t.META:case t.CAPS_LOCK:case t.NUM_LOCK:case t.SCROLL_LOCK:return}if(!c.ctrlKey&&!c.metaKey&&!c.altKey){switch(b){case t.NUMPAD_0:case t.NUMPAD_1:case t.NUMPAD_2:case t.NUMPAD_3:case t.NUMPAD_4:case t.NUMPAD_5:case t.NUMPAD_6:case t.NUMPAD_7:case t.NUMPAD_8:case t.NUMPAD_9:case t.NUMPAD_MULTIPLY:case t.NUMPAD_PLUS:case t.NUMPAD_ENTER:case t.NUMPAD_MINUS:case t.NUMPAD_PERIOD:case t.NUMPAD_DIVIDE:return}if(65<=
b&&90>=b||48<=b&&57>=b||b==t.SPACE)return;b=!1;for(var h in t)if(t[h]===c.keyCode){b=!0;break}if(!b)return}}(b=32<=c.charCode?String.fromCharCode(c.charCode):c.charCode)||(b=65<=c.keyCode&&90>=c.keyCode||48<=c.keyCode&&57>=c.keyCode||c.keyCode==t.SPACE?String.fromCharCode(c.keyCode):c.keyCode);b||(b=229);if("keypress"==c.type){if("string"!=typeof b)return;if("a"<=b&&"z">=b||"A"<=b&&"Z">=b||"0"<=b&&"9">=b||" "===b)if(c.ctrlKey||c.metaKey||c.altKey)return}var n={faux:!0},m;for(m in c)/^(layer[XY]|returnValue|keyLocation)$/.test(m)||
(h=c[m],"function"!=typeof h&&"undefined"!=typeof h&&(n[m]=h));l.mixin(n,{charOrCode:b,_wasConsumed:!1,preventDefault:function(){n._wasConsumed=!0;c.preventDefault()},stopPropagation:function(){c.stopPropagation()}});this._lastInputProducingEvent=n;!1===this.onInput(n)&&(n.preventDefault(),n.stopPropagation());if(!n._wasConsumed&&9>=v("ie"))switch(c.keyCode){case t.TAB:case t.ESCAPE:case t.DOWN_ARROW:case t.UP_ARROW:case t.LEFT_ARROW:case t.RIGHT_ARROW:break;default:c.keyCode==t.ENTER&&"textarea"!=
this.textbox.tagName.toLowerCase()||this.defer(function(){this.textbox.value!==this._lastInputEventValue&&p.emit(this.textbox,"input",{bubbles:!0})})}})),p(this.textbox,"input",l.hitch(this,"_onInput")),p(this.domNode,"keypress",function(c){c.stopPropagation()}))},_blankValue:"",filter:function(c){if(null===c)return this._blankValue;if("string"!=typeof c)return c;this.trim&&(c=l.trim(c));this.uppercase&&(c=c.toUpperCase());this.lowercase&&(c=c.toLowerCase());this.propercase&&(c=c.replace(/[^\s]+/g,
function(b){return b.substring(0,1).toUpperCase()+b.substring(1)}));return c},_setBlurValue:function(){this._setValueAttr(this.get("value"),!0)},_onBlur:function(c){this.disabled||(this._setBlurValue(),this.inherited(arguments))},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd},_onFocus:function(c){this.disabled||this.readOnly||(this.selectOnClick&&"mouse"==c&&(this._selectOnClickHandle=p.once(this.domNode,"mouseup, touchend",l.hitch(this,function(b){this._isTextSelected()||
k.selectInputText(this.textbox)})),this.own(this._selectOnClickHandle),this.defer(function(){this._selectOnClickHandle&&(this._selectOnClickHandle.remove(),this._selectOnClickHandle=null)},500)),this.inherited(arguments),this._refreshState())},reset:function(){this.textbox.value="";this.inherited(arguments)}});v("dojo-bidi")&&(k=A("dijit.form._TextBoxMixin",k,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_setDisplayedValueAttr:function(){this.inherited(arguments);
this.applyTextDir(this.focusNode)},_onInput:function(){this.applyTextDir(this.focusNode);this.inherited(arguments)}}));k._setSelectionRange=d._setSelectionRange=function(c,b,h){c.setSelectionRange&&c.setSelectionRange(b,h)};k.selectInputText=d.selectInputText=function(c,b,h){c=B.byId(c);isNaN(b)&&(b=0);isNaN(h)&&(h=c.value?c.value.length:0);try{c.focus(),k._setSelectionRange(c,b,h)}catch(n){}};return k})},"dijit/Tooltip":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff ./_base/manager ./place ./_Widget ./_TemplatedMixin ./BackgroundIframe dojo/text!./templates/Tooltip.html ./main".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e){function r(){}var w=A("dijit._MasterTooltip",[m,g],{duration:h.defaultDuration,templateString:f,postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.bgIframe=new a(this.domNode);this.fadeIn=B.fadeIn({node:this.domNode,duration:this.duration,onEnd:d.hitch(this,"_onShow")});this.fadeOut=B.fadeOut({node:this.domNode,duration:this.duration,onEnd:d.hitch(this,"_onHide")})},show:function(x,q,C,F,u,E,D){if(!this.aroundNode||this.aroundNode!==
q||this.containerNode.innerHTML!=x)if("playing"==this.fadeOut.status())this._onDeck=arguments;else{this.containerNode.innerHTML=x;u&&this.set("textDir",u);this.containerNode.align=F?"right":"left";var M=n.around(this.domNode,q,C&&C.length?C:H.defaultPosition,!F,d.hitch(this,"orient")),I=M.aroundNodePos;"M"==M.corner.charAt(0)&&"M"==M.aroundCorner.charAt(0)?(this.connectorNode.style.top=I.y+(I.h-this.connectorNode.offsetHeight>>1)-M.y+"px",this.connectorNode.style.left=""):"M"==M.corner.charAt(1)&&
"M"==M.aroundCorner.charAt(1)?this.connectorNode.style.left=I.x+(I.w-this.connectorNode.offsetWidth>>1)-M.x+"px":(this.connectorNode.style.left="",this.connectorNode.style.top="");p.set(this.domNode,"opacity",0);this.fadeIn.play();this.isShowingNow=!0;this.aroundNode=q;this.onMouseEnter=E||r;this.onMouseLeave=D||r}},orient:function(x,q,C,F,u){this.connectorNode.style.top="";var E=F.h;F=F.w;x.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove",
"BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[q+"-"+C];this.domNode.style.width="auto";var D=l.position(this.domNode);if(b("ie")||b("trident"))D.w+=2;l.setMarginBox(this.domNode,{w:Math.min(Math.max(F,1),D.w)});"B"==C.charAt(0)&&"B"==q.charAt(0)?(x=l.position(x),q=this.connectorNode.offsetHeight,
x.h>E?(this.connectorNode.style.top=E-(u.h+q>>1)+"px",this.connectorNode.style.bottom=""):(this.connectorNode.style.bottom=Math.min(Math.max(u.h/2-q/2,0),x.h-q)+"px",this.connectorNode.style.top="")):(this.connectorNode.style.top="",this.connectorNode.style.bottom="");return Math.max(0,D.w-F)},_onShow:function(){b("ie")&&(this.domNode.style.filter="")},hide:function(x){this._onDeck&&this._onDeck[1]==x?this._onDeck=null:this.aroundNode===x&&(this.fadeIn.stop(),this.isShowingNow=!1,this.aroundNode=
null,this.fadeOut.play());this.onMouseEnter=this.onMouseLeave=r},_onHide:function(){this.domNode.style.cssText="";this.containerNode.innerHTML="";this._onDeck&&(this.show.apply(this,this._onDeck),this._onDeck=null)}});b("dojo-bidi")&&w.extend({_setAutoTextDir:function(x){this.applyTextDir(x);G.forEach(x.children,function(q){this._setAutoTextDir(q)},this)},_setTextDirAttr:function(x){this._set("textDir",x);"auto"==x?this._setAutoTextDir(this.containerNode):this.containerNode.dir=this.textDir}});e.showTooltip=
function(x,q,C,F,u,E,D){C&&(C=G.map(C,function(M){return{after:"after-centered",before:"before-centered"}[M]||M}));H._masterTT||(e._masterTT=H._masterTT=new w);return H._masterTT.show(x,q,C,F,u,E,D)};e.hideTooltip=function(x){return H._masterTT&&H._masterTT.hide(x)};var H=A("dijit.Tooltip",m,{label:"",showDelay:400,hideDelay:400,connectId:[],position:[],selector:"",_setConnectIdAttr:function(x){G.forEach(this._connections||[],function(q){G.forEach(q,function(C){C.remove()})},this);this._connectIds=
G.filter(d.isArrayLike(x)?x:x?[x]:[],function(q){return v.byId(q,this.ownerDocument)},this);this._connections=G.map(this._connectIds,function(q){q=v.byId(q,this.ownerDocument);var C=this.selector,F=C?function(E){return c.selector(C,E)}:function(E){return E},u=this;return[c(q,F(k.enter),function(){u._onHover(this)}),c(q,F("focusin"),function(){u._onHover(this)}),c(q,F(k.leave),d.hitch(u,"_onUnHover")),c(q,F("focusout"),d.hitch(u,"set","state","DORMANT"))]},this);this._set("connectId",x)},addTarget:function(x){x=
x.id||x;-1==G.indexOf(this._connectIds,x)&&this.set("connectId",this._connectIds.concat(x))},removeTarget:function(x){x=G.indexOf(this._connectIds,x.id||x);0<=x&&(this._connectIds.splice(x,1),this.set("connectId",this._connectIds))},buildRendering:function(){this.inherited(arguments);t.add(this.domNode,"dijitTooltipData")},startup:function(){this.inherited(arguments);var x=this.connectId;G.forEach(d.isArrayLike(x)?x:[x],this.addTarget,this)},getContent:function(x){return this.label||this.domNode.innerHTML},
state:"DORMANT",_setStateAttr:function(x){if(!(this.state==x||"SHOW TIMER"==x&&"SHOWING"==this.state||"HIDE TIMER"==x&&"DORMANT"==this.state)){this._hideTimer&&(this._hideTimer.remove(),delete this._hideTimer);this._showTimer&&(this._showTimer.remove(),delete this._showTimer);switch(x){case "DORMANT":this._connectNode&&(H.hide(this._connectNode),delete this._connectNode,this.onHide());break;case "SHOW TIMER":"SHOWING"!=this.state&&(this._showTimer=this.defer(function(){this.set("state","SHOWING")},
this.showDelay));break;case "SHOWING":var q=this.getContent(this._connectNode);if(!q){this.set("state","DORMANT");return}H.show(q,this._connectNode,this.position,!this.isLeftToRight(),this.textDir,d.hitch(this,"set","state","SHOWING"),d.hitch(this,"set","state","HIDE TIMER"));this.onShow(this._connectNode,this.position);break;case "HIDE TIMER":this._hideTimer=this.defer(function(){this.set("state","DORMANT")},this.hideDelay)}this._set("state",x)}},_onHover:function(x){this._connectNode&&x!=this._connectNode&&
this.set("state","DORMANT");this._connectNode=x;this.set("state","SHOW TIMER")},_onUnHover:function(x){this.set("state","HIDE TIMER")},open:function(x){this.set("state","DORMANT");this._connectNode=x;this.set("state","SHOWING")},close:function(){this.set("state","DORMANT")},onShow:function(){},onHide:function(){},destroy:function(){this.set("state","DORMANT");G.forEach(this._connections||[],function(x){G.forEach(x,function(q){q.remove()})},this);this.inherited(arguments)}});H._MasterTooltip=w;H.show=
e.showTooltip;H.hide=e.hideTooltip;H.defaultPosition=["after-centered","before-centered"];return H})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(G,A,B,v,t,l){var p=function(k){k=k||{};var c=B.getLocalization("dojo.cldr","number",B.normalizeLocale(k.locale)),b=k.pattern?k.pattern:c[(k.type||"decimal")+"Format"];k="number"==typeof k.places?k.places:"string"===typeof k.places&&0<k.places.length?
k.places.replace(/.*,/,""):-1!=b.indexOf(".")?b.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:c.decimal,places:k}},d=G("dijit.form.NumberTextBoxMixin",null,{pattern:function(k){return"("+(this.focused&&this.editOptions?this._regExpGenerator(A.delegate(k,this.editOptions))+"|":"")+this._regExpGenerator(k)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:t.format,_regExpGenerator:t.regexp,_decimalInfo:p(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},
_setConstraintsAttr:function(k){var c="number"==typeof k.places?k.places:0;c&&c++;"number"!=typeof k.max&&(k.max=9*Math.pow(10,15-c));"number"!=typeof k.min&&(k.min=-9*Math.pow(10,15-c));this.inherited(arguments,[k]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=p(k)},_onFocus:function(k){if(!this.disabled&&!this.readOnly){var c=this.get("value");"number"!=typeof c||isNaN(c)||(c=this.format(c,this.constraints),void 0!==c&&(this.textbox.value=
c,"mouse"!==k&&this.textbox.select()));this.inherited(arguments)}},format:function(k,c){var b=String(k);if("number"!=typeof k)return b;if(isNaN(k))return"";if(!("rangeCheck"in this&&this.rangeCheck(k,c))&&!1!==c.exponent&&/\de[-+]?\d/i.test(b))return b;this.editOptions&&this.focused&&(c=A.mixin({},c,this.editOptions));return this._formatter(k,c)},_parser:t.parse,parse:function(k,c){var b=A.mixin({},c,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=b.places){var h=b.places;
h="number"===typeof h?h:Number(h.split(",").pop());b.places="0,"+h}b=this._parser(k,b);this.editOptions&&this.focused&&isNaN(b)&&(b=this._parser(k,c));return b},_getDisplayedValueAttr:function(){var k=this.inherited(arguments);return isNaN(k)?this.textbox.value:k},filter:function(k){if(null==k||"string"==typeof k&&""==k)return NaN;"number"!=typeof k||isNaN(k)||0==k||(k=t.round(k,this._decimalInfo.places));return this.inherited(arguments,[k])},serialize:function(k,c){return"number"!=typeof k||isNaN(k)?
"":this.inherited(arguments)},_setBlurValue:function(){var k=A.hitch(A.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(k,!0)},_setValueAttr:function(k,c,b){if(void 0!==k&&void 0===b)if(b=String(k),"number"==typeof k)if(isNaN(k))b="";else{if("rangeCheck"in this&&this.rangeCheck(k,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(b))b=void 0}else k?k=void 0:(b="",k=NaN);this.inherited(arguments,[k,c,b])},_getValueAttr:function(){var k=this.inherited(arguments);if(isNaN(k)&&
""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+t._realNumberRegexp(A.delegate(this.constraints))+"$")).test(this.textbox.value))return k=Number(this.textbox.value),isNaN(k)?void 0:k}else return k},isValid:function(k){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var c=this.get("value");return!isNaN(c)&&this.rangeCheck(c,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?
!0:this.inherited(arguments):!1},_isValidSubset:function(){var k="number"==typeof this.constraints.min,c="number"==typeof this.constraints.max,b=this.get("value");if(isNaN(b)||!k&&!c)return this.inherited(arguments);var h=b|0,n=0>b,m=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),g=(this.maxLength||20)-this.textbox.value.length,a=m?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"";h=m?h+"."+a:h+"";g=v.rep("9",g);m=b;n?m=Number(h+g):b=Number(h+g);return!(k&&b<this.constraints.min||
c&&m>this.constraints.max)}});G=G("dijit.form.NumberTextBox",[l,d],{baseClass:"dijitTextBox dijitNumberTextBox"});G.Mixin=d;return G})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox","./ComboBoxMixin"],function(G,A,B,v,t){return G("dijit.form.FilteringSelect",[v,t],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},
_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(l,p,d,k){p&&p[this.searchAttr]!==this._lastQuery||!p&&l.length&&this.store.getIdentity(l[0])!=this._lastQuery||(l.length?this.set("item",l[0],k):this.set("value","",k||void 0===k&&!this.focused,this.textbox.value,null))},_openResultList:function(l,p,d){p[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},
_getValueField:function(){return"value"},_setValueAttr:function(l,p,d,k){this._onChangeActive||(p=null);if(void 0===k){if(null===l||""===l)if(l="",!A.isString(d)){this._setDisplayedValueAttr(d||"",p);return}var c=this;this._lastQuery=l;B(this.store.get(l),function(b){c._callbackSetLabel(b?[b]:[],void 0,void 0,p)})}else this.valueNode.value=l,this.inherited(arguments,[l,p,d,k])},_setItemAttr:function(l,p,d){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(l){return l.replace(/([\\\*\?])/g,
"\\$1")},_setDisplayedValueAttr:function(l,p){null==l&&(l="");if(!this._created){if(!("displayedValue"in this.params))return;p=!1}if(this.store){this.closeDropDown();var d=A.clone(this.query),k=this._getDisplayQueryString(l);if(this.store._oldAPI)var c=k;else c=this._patternToRegExp(k),c.toString=function(){return k};this._lastQuery=d[this.searchAttr]=c;this._lastDisplayedValue=this.textbox.value=l;this._set("displayedValue",l);var b=this,h={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};A.mixin(h,
this.fetchProperties);this._fetchHandle=this.store.query(d,h);B(this._fetchHandle,function(n){b._fetchHandle=null;b._callbackSetLabel(n||[],d,h,p)},function(n){b._fetchHandle=null;b._cancelingQuery||console.error("dijit.form.FilteringSelect: "+n.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(G,A,B,v,t,l,p,d,k){return G("dijit.form.ComboBoxMixin",[d,l],{dropDownClass:p,hasDownArrow:!0,templateString:k,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(c){this._set("hasDownArrow",c);this._buttonNode.style.display=c?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(c){c.get||v.mixin(c,{_oldAPI:!0,get:function(b){var h=new A;this.fetchItemByIdentity({identity:b,
onItem:function(n){h.resolve(n)},onError:function(n){h.reject(n)}});return h.promise},query:function(b,h){var n=new A(function(){m.abort&&m.abort()});n.total=new A;var m=this.fetch(v.mixin({query:b,onBegin:function(g){n.total.resolve(g)},onComplete:function(g){n.resolve(g)},onError:function(g){n.reject(g)}},h));return t(n)}});this._set("store",c)},postMixInProperties:function(){var c=this.params.store||this.store;c&&this._setStoreAttr(c);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var b=this.declaredClass;v.mixin(this.store,{getValue:function(h,n){B.deprecated(b+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return h[n]},getLabel:function(h){B.deprecated(b+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return h.name},fetch:function(h){B.deprecated(b+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
v.hitch(this,function(n){(new n({objectStore:this})).fetch(h)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(G,A,B,v,t,l,p,d,k,c,b){A=A("dijit.form._AutoCompleterMixin",b,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(h){var n=0;if("number"==typeof h.selectionStart)n=h.selectionStart;else if(d("ie")){var m=h.ownerDocument.selection.createRange().duplicate();h=h.createTextRange();m.move("character",0);h.move("character",0);try{h.setEndPoint("EndToEnd",m),n=String(h.text).replace(/\r/g,"").length}catch(g){}}return n},_setCaretPos:function(h,n){n=parseInt(n);c.selectInputText(h,n,n)},_setDisabledAttr:function(h){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",h?"true":"false")},_onKey:function(h){if(!(32<=h.charCode)){var n=h.charCode||h.keyCode;if(n!=v.ALT&&n!=v.CTRL&&n!=v.META&&n!=v.SHIFT){var m=this.dropDown,g=null;this._abortQuery();this.inherited(arguments);if(!(h.altKey||h.ctrlKey||h.metaKey))switch(this._opened&&(g=m.getHighlightedOption()),n){case v.PAGE_DOWN:case v.DOWN_ARROW:case v.PAGE_UP:case v.UP_ARROW:this._opened&&this._announceOption(g);h.stopPropagation();h.preventDefault();break;case v.ENTER:if(g){if(g==
m.nextButton){this._nextSearch(1);h.stopPropagation();h.preventDefault();break}else if(g==m.previousButton){this._nextSearch(-1);h.stopPropagation();h.preventDefault();break}h.stopPropagation();h.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case v.TAB:n=this.get("displayedValue");if(m&&(n==m._messages.previousMessage||n==m._messages.nextMessage))break;g&&this._selectOption(g);case v.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(h){var n=this.focusNode;c.selectInputText(n,n.value.length);var m=this.ignoreCase?"toLowerCase":"substr";0==h[m](0).indexOf(this.focusNode.value[m](0))?(m=this.autoComplete?this._getCaretPos(n):n.value.length,m+1>n.value.length&&(n.value=h,c.selectInputText(n,m))):(n.value=h,c.selectInputText(n))},_openResultList:function(h,n,m){var g=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();h.length||0!=m.start?(this._nextSearch=this.dropDown.onPage=t.hitch(this,
function(a){h.nextPage(-1!==a);this.focus()}),this.dropDown.createOptions(h,m,t.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in m?(m.direction?this.dropDown.highlightFirstOption():m.direction||this.dropDown.highlightLastOption(),g&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(n[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var h=this.get("displayedValue"),n=this.dropDown;!n||h!=n._messages.previousMessage&&h!=n._messages.nextMessage?"undefined"==typeof this.item?
(this.item=null,this.set("displayedValue",h)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(h,n,m){var g="";h&&(m||(m=this.store._oldAPI?this.store.getValue(h,this.searchAttr):h[this.searchAttr]),g=this._getValueField()!=this.searchAttr?this.store.getIdentity(h):m);this.set("value",g,n,m,h)},_announceOption:function(h){if(h){if(h==
this.dropDown.nextButton||h==this.dropDown.previousButton){var n=h.innerHTML;this.item=void 0;this.value=""}else{var m=this.dropDown.items[h.getAttribute("item")];n=(this.store._oldAPI?this.store.getValue(m,this.searchAttr):m[this.searchAttr]).toString();this.set("item",m,!1,n)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",B.get(h,"id"));this._autoCompleteText(n)}},_selectOption:function(h){this.closeDropDown();h&&
this._announceOption(h);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(h){if(!this.dropDown){var n=this.id+"_popup";this.dropDown=new (t.isString(this.dropDownClass)?t.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:t.hitch(this,
this._selectOption),id:n,dir:this.dir,textDir:this.textDir})}this._lastInput=h;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new k({},this.srcNodeRef),!("value"in this.params))){var h=this.item=this.store.fetchSelectedItem();if(h){var n=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(h,n):h[n]}}},postCreate:function(){var h=l('label[for\x3d"'+
this.id+'"]');h.length&&(h[0].id||(h[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",h[0].id));this.inherited(arguments);G.after(this,"onSearch",t.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(h){h=this.labelFunc(h,this.store);var n=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(h=this.doHighlight(h,this._lastInput),n="html");return{html:"html"==n,label:h}},doHighlight:function(h,n){var m=(this.ignoreCase?"i":"")+("all"==
this.highlightMatch?"g":""),g=this.queryExpr.indexOf("${0}");n=p.escapeString(n);return this._escapeHtml(h.replace(new RegExp((0==g?"^":"")+"("+n+")"+(g==this.queryExpr.length-4?"$":""),m),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(h){return h=String(h).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},
labelFunc:function(h,n){return(n._oldAPI?n.getValue(h,this.labelAttr||this.searchAttr):h[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(h,n,m,g){this._set("item",g||null);null==h&&(h="");this.inherited(arguments)}});d("dojo-bidi")&&A.extend({_setTextDirAttr:function(h){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",h)}});return A})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),
function(G,A,B,v,t,l){function p(d){return{id:d.value,value:d.value,name:B.trim(d.innerText||d.textContent||"")}}return G("dijit.form.DataList",t,{constructor:function(d,k){this.domNode=A.byId(k);B.mixin(this,d);this.id&&l.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:v("option",this.domNode).map(p)}])},destroy:function(){l.remove(this.id)},fetchSelectedItem:function(){var d=v("\x3e option[selected]",this.domNode)[0]||v("\x3e option",this.domNode)[0];return d&&p(d)}})})},
"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(G,A,B,v,t,l,p){return G("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(d){this._set("list",d)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(d){return new RegExp("^"+d.replace(/(\\.)|(\*)|(\?)|\W/g,function(k,c,b,h){return b?".*":
h?".":c?c:"\\"+k})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(d){if(!this.disabled&&
!this.readOnly){d=d.charOrCode;this._prev_key_backspace=!1;if(d===A.DELETE||d===A.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(d){this._abortQuery();var k=this,c=B.clone(this.query),b={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},h=t.substitute(this.queryExpr,
[d.replace(/([\\\*\?])/g,"\\$1")]),n=function(){var g=k._fetchHandle=k.store.query(c,b);k.disabled||k.readOnly||m!==k._lastQuery||l(g,function(a){k._fetchHandle=null;k.disabled||k.readOnly||m!==k._lastQuery||l(g.total,function(f){a.total=f;var e=k.pageSize;if(isNaN(e)||e>a.total)e=a.total;a.nextPage=function(r){b.direction=r=!1!==r;b.count=e;r?(b.start+=a.length,b.start>=a.total&&(b.count=0)):(b.start-=e,0>b.start&&(b.count=Math.max(e+b.start,0),b.start=0));0>=b.count?(a.length=0,k.onSearch(a,c,b)):
n()};k.onSearch(a,c,b)})},function(a){k._fetchHandle=null;k._cancelingQuery||console.error(k.declaredClass+" "+a.toString())})};B.mixin(b,this.fetchProperties);if(this.store._oldAPI)var m=h;else m=this._patternToRegExp(h),m.toString=function(){return h};this._lastQuery=c[this.searchAttr]=m;this._queryDeferHandle=this.defer(n,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var d=this.list;d&&(this.store=p.byId(d))}this.inherited(arguments)}})})},
"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(G,A,B,v,t,l,p,d){return G("dijit.form._ComboBoxMenu",[t,l,d,p],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(A.add(this.previousButton,"dijitMenuItemRtl"),A.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var k=this.ownerDocument.createElement("div");k.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");k.setAttribute("role","option");return k},onHover:function(k){A.add(k,"dijitMenuItemHover")},onUnhover:function(k){A.remove(k,
"dijitMenuItemHover")},onSelect:function(k){A.add(k,"dijitMenuItemSelected")},onDeselect:function(k){A.remove(k,"dijitMenuItemSelected")},_page:function(k){var c=0,b=this.domNode.scrollTop,h=B.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();c<h;){var n=this.getHighlightedOption();if(k){if(!n.previousSibling||"none"==n.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!n.nextSibling||"none"==n.nextSibling.style.display)break;this.selectNextNode()}n=
this.domNode.scrollTop;c+=(n-b)*(k?-1:1);b=n}},handleKey:function(k){switch(k.keyCode){case v.DOWN_ARROW:return this.selectNextNode(),!1;case v.PAGE_DOWN:return this._page(!1),!1;case v.UP_ARROW:return this.selectPreviousNode(),!1;case v.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(G,A,B,v,t){var l=A("dijit.form._ComboBoxMenuMixin"+
(v("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=t.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(p){this._set("value",p);this.onChange(p)},onClick:function(p){if(p==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(p==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(p)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(p,d){var k=this._createMenuItem();p=d(p);p.html?k.innerHTML=p.label:k.appendChild(k.ownerDocument.createTextNode(p.label));""==k.innerHTML&&(k.innerHTML="\x26#160;");return k},createOptions:function(p,d,k){this.items=p;this.previousButton.style.display=0==d.start?"none":"";B.set(this.previousButton,"id",this.id+
"_prev");G.forEach(p,function(b,h){b=this._createOption(b,k);b.setAttribute("item",h);B.set(b,"id",this.id+h);this.nextButton.parentNode.insertBefore(b,this.nextButton)},this);var c=!1;p.total&&!p.total.then&&-1!=p.total?d.start+d.count<p.total?c=!0:d.start+d.count>p.total&&d.count==p.length&&(c=!0):d.count==p.length&&(c=!0);this.nextButton.style.display=c?"":"none";B.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var p=this.containerNode;2<p.childNodes.length;)p.removeChild(p.childNodes[p.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});v("dojo-bidi")&&(l=A("dijit.form._ComboBoxMenuMixin",
l,{_createOption:function(){var p=this.inherited(arguments);this.applyTextDir(p);return p}}));return l})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(G,A,B,v){return G("dijit.form._ListMouseMixin",v,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(t,l){this._setSelectedAttr(l,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(l)})},_onMouseDown:function(t,l){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(l,!1)},_onMouseUp:function(t,l){this._isDragging=!1;var p=this.selected,d=this._hoveredNode;p&&l==p?this.defer(function(){this._onClick(t,
p)}):d&&this.defer(function(){this._onClick(t,d)})},_onMouseOut:function(t,l){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(t,l){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=l;this.onHover(l);this._isDragging&&this._setSelectedAttr(l,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(G,A,B){return G("dijit.form._ListBase",null,{selected:null,_listConnect:function(v,t){var l=this;return l.own(A(l.containerNode,A.selector(function(p,d,k){return p.parentNode==k},v),function(p){l[t](p,this)}))},selectFirstNode:function(){for(var v=this.containerNode.firstChild;v&&"none"==v.style.display;)v=v.nextSibling;this._setSelectedAttr(v,!0)},selectLastNode:function(){for(var v=this.containerNode.lastChild;v&&"none"==v.style.display;)v=v.previousSibling;this._setSelectedAttr(v,
!0)},selectNextNode:function(){var v=this.selected;if(v){for(v=v.nextSibling;v&&"none"==v.style.display;)v=v.nextSibling;v?this._setSelectedAttr(v,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var v=this.selected;if(v){for(v=v.previousSibling;v&&"none"==v.style.display;)v=v.previousSibling;v?this._setSelectedAttr(v,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(v,t){if(this.selected!=v){var l=this.selected;if(l)this.onDeselect(l);
v&&(t&&B.scrollIntoView(v),this.onSelect(v));this._set("selected",v)}else if(v)this.onSelect(v)}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(G,A,B,v){return G("dijit.form.NumberSpinner",[B,v.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(t,l){var p=this.constraints,d=isNaN(t),k=!isNaN(p.max),c=!isNaN(p.min);d&&0!=l&&(t=0<l?c?p.min:k?p.max:0:k?this.constraints.max:c?p.min:0);l=t+l;if(d||
isNaN(l))return t;k&&l>p.max&&(l=p.max);c&&l<p.min&&(l=p.min);return l},_onKeyDown:function(t){if(!(this.disabled||this.readOnly||t.keyCode!=A.HOME&&t.keyCode!=A.END||t.ctrlKey||t.altKey||t.metaKey||"undefined"==typeof this.get("value"))){var l=this.constraints[t.keyCode==A.HOME?"min":"max"];"number"==typeof l&&this._setValueAttr(l,!1);t.stopPropagation();t.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),
function(G,A,B,v,t,l,p,d,k,c){return G("dijit.form._Spinner",d,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:k,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(b){return b},_arrowPressed:function(b,h,n){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),h*n),!1),c.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=
null},_typematicCallback:function(b,h,n){var m=this.smallDelta;h==this.textbox&&(h=n.keyCode,m=h==A.PAGE_UP||h==A.PAGE_DOWN?this.largeDelta:this.smallDelta,h=h==A.UP_ARROW||h==A.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==b?this._arrowReleased(h):this._arrowPressed(h,h==this.upArrowNode?1:-1,m)},_wheelTimer:null,_mouseWheeled:function(b){if(this.focused){b.stopPropagation();b.preventDefault();var h=b.wheelDelta/120;Math.floor(h)!=h&&(h=0<b.wheelDelta?1:-1);b=b.detail?-1*b.detail:h;if(0!==b){var n=
this[0<b?"upArrowNode":"downArrowNode"];this._arrowPressed(n,b,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(n)},50)}}},_setConstraintsAttr:function(b){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):
this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(b,h){this.focusNode.setAttribute("aria-valuenow",b);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(l(this.domNode,t.wheel,B.hitch(this,"_mouseWheeled")),p.addListener(this.upArrowNode,this.textbox,{keyCode:A.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),p.addListener(this.downArrowNode,this.textbox,
{keyCode:A.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),p.addListener(this.upArrowNode,this.textbox,{keyCode:A.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),p.addListener(this.downArrowNode,this.textbox,{keyCode:A.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,
this.defaultTimeout,this.minimumTimeout))}})})},"dijit/typematic":function(){define("dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/on dojo/sniff ./main".split(" "),function(G,A,B,v,t,l){var p=l.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(0>this._currentTimeout?this._initialDelay:1<this._subsequentDelay?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);
this._timer=setTimeout(B.hitch(this,"_fireEventAndReload"),this._currentTimeout)},trigger:function(d,k,c,b,h,n,m,g){if(h!=this._obj){this.stop();this._initialDelay=m||500;this._subsequentDelay=n||.9;this._minDelay=g||10;this._obj=h;this._node=c;this._count=this._currentTimeout=-1;this._callback=B.hitch(k,b);this._evt={faux:!0};for(var a in d)"layerX"!=a&&"layerY"!=a&&(k=d[a],"function"!=typeof k&&"undefined"!=typeof k&&(this._evt[a]=k));this._fireEventAndReload()}},stop:function(){this._timer&&(clearTimeout(this._timer),
this._timer=null);this._obj&&(this._callback(-1,this._node,this._evt),this._obj=null)},addKeyListener:function(d,k,c,b,h,n,m){var g="keyCode"in k?"keyCode":"charCode"in k?"charCode":"charOrCode",a=[v(d,"keyCode"in k?"keydown":"charCode"in k?"keypress":A._keypress,B.hitch(this,function(f){f[g]!=k[g]||void 0!==k.ctrlKey&&k.ctrlKey!=f.ctrlKey||void 0!==k.altKey&&k.altKey!=f.altKey||void 0!==k.metaKey&&k.metaKey!=(f.metaKey||!1)||void 0!==k.shiftKey&&k.shiftKey!=f.shiftKey?p._obj==k&&p.stop():(f.stopPropagation(),
f.preventDefault(),p.trigger(f,c,d,b,k,h,n,m))})),v(d,"keyup",B.hitch(this,function(){p._obj==k&&p.stop()}))];return{remove:function(){G.forEach(a,function(f){f.remove()})}}},addMouseListener:function(d,k,c,b,h,n){var m=[v(d,"mousedown",B.hitch(this,function(g){g.preventDefault();p.trigger(g,k,d,c,d,b,h,n)})),v(d,"mouseup",B.hitch(this,function(g){this._obj&&g.preventDefault();p.stop()})),v(d,"mouseout",B.hitch(this,function(g){this._obj&&g.preventDefault();p.stop()})),v(d,"dblclick",B.hitch(this,
function(g){g.preventDefault();9>t("ie")&&(p.trigger(g,k,d,c,d,b,h,n),setTimeout(B.hitch(this,p.stop),50))}))];return{remove:function(){G.forEach(m,function(g){g.remove()})}}},addListener:function(d,k,c,b,h,n,m,g){var a=[this.addKeyListener(k,c,b,h,n,m,g),this.addMouseListener(d,b,h,n,m,g)];return{remove:function(){G.forEach(a,function(f){f.remove()})}}}};return p})},"dijit/form/SimpleTextarea":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/sniff","./TextBox"],function(G,A,B,v){return G("dijit.form.SimpleTextarea",
v,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"\x3ctextarea ${!nameAttrSetting} data-dojo-attach-point\x3d'focusNode,containerNode,textbox' autocomplete\x3d'off'\x3e\x3c/textarea\x3e",postMixInProperties:function(){!this.value&&this.srcNodeRef&&(this.value=this.srcNodeRef.value);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);B("ie")&&this.cols&&A.add(this.textbox,"dijitTextAreaCols")},filter:function(t){t&&(t=t.replace(/\r/g,""));return this.inherited(arguments)},
_onInput:function(t){if(this.maxLength){var l=parseInt(this.maxLength),p=this.textbox.value.replace(/\r/g,"");l=p.length-l;if(0<l){var d=this.textbox;if(d.selectionStart){var k=d.selectionStart,c=0;B("opera")&&(c=(this.textbox.value.substring(0,k).match(/\r/g)||[]).length);this.textbox.value=p.substring(0,k-l-c)+p.substring(k-c);d.setSelectionRange(k-l,k-l)}else this.ownerDocument.selection&&(d.focus(),p=this.ownerDocument.selection.createRange(),p.moveStart("character",-l),p.text="",p.select())}}this.inherited(arguments)}})})},
"dijit/form/TimeTextBox":function(){define("dojo/_base/declare dojo/keys dojo/query dojo/_base/lang ../_TimePicker ./_DateTimeTextBox".split(" "),function(G,A,B,v,t,l){return G("dijit.form.TimeTextBox",l,{baseClass:"dijitTextBox dijitComboBox dijitTimeTextBox",popupClass:t,_selector:"time",value:new Date(""),maxHeight:-1,openDropDown:function(p){this.inherited(arguments);var d=B(".dijitTimePickerItemSelected",this.dropDown.domNode),k=this.dropDown.domNode.parentNode;k.scrollTop=d[0]?d[0].offsetTop-
(k.clientHeight-d[0].clientHeight)/2:(k.scrollHeight-k.clientHeight)/2;this.dropDown.on("input",v.hitch(this,function(){this.set("value",this.dropDown.get("value"),!1)}))},_onInput:function(){this.inherited(arguments);var p=this.get("displayedValue");this.filterString=p&&!this.parse(p,this.constraints)?p.toLowerCase():"";this._opened&&this.closeDropDown();this.openDropDown()}})})},"dijit/_TimePicker":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/sniff dojo/query dojo/mouse dojo/on ./_WidgetBase ./form/_ListMouseMixin".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a){return t("dijit._TimePicker",[g,a],{baseClass:"dijitTimePicker",pickerMin:"T00:00:00",pickerMax:"T23:59:59",clickableIncrement:"T00:15:00",visibleIncrement:"T01:00:00",value:new Date,_visibleIncrement:2,_clickableIncrement:1,_totalIncrements:10,constraints:{},serialize:v.toISOString,buildRendering:function(){this.inherited(arguments);this.timeMenu=this.containerNode=this.domNode},setValue:function(f){d.deprecated("dijit._TimePicker:setValue() is deprecated.  Use set('value', ...) instead.",
"","2.0");this.set("value",f)},_setValueAttr:function(f){this._set("value",f);this._showText()},_setFilterStringAttr:function(f){this._set("filterString",f);this._showText()},isDisabledDate:function(){return!1},_getFilteredNodes:function(f,e,r,w){f=this.ownerDocument.createDocumentFragment();for(e=0;e<this._maxIncrement;e++)(r=this._createOption(e))&&f.appendChild(r);return f},_showText:function(){var f=v.fromISOString;this.domNode.innerHTML="";this._clickableIncrementDate=f(this.clickableIncrement);
this._visibleIncrementDate=f(this.visibleIncrement);var e=function(w){return 3600*w.getHours()+60*w.getMinutes()+w.getSeconds()},r=e(this._clickableIncrementDate);e=e(this._visibleIncrementDate);(this.value||this.currentFocus).getTime();this._refDate=f(this.pickerMin);this._refDate.setFullYear(1970,0,1);this._clickableIncrement=1;this._visibleIncrement=e/r;f=f(this.pickerMax);f.setFullYear(1970,0,1);f=.001*(f.getTime()-this._refDate.getTime());this._maxIncrement=Math.ceil((f+1)/r);r=this._getFilteredNodes();
!r.firstChild&&this.filterString?(this.filterString="",this._showText()):this.domNode.appendChild(r)},constructor:function(){this.constraints={}},postMixInProperties:function(){this.inherited(arguments);this._setConstraintsAttr(this.constraints)},_setConstraintsAttr:function(f){for(var e in{clickableIncrement:1,visibleIncrement:1,pickerMin:1,pickerMax:1})e in f&&(this[e]=f[e]);f.locale||(f.locale=this.lang)},_createOption:function(f){var e=new Date(this._refDate),r=this._clickableIncrementDate;e.setHours(e.getHours()+
r.getHours()*f,e.getMinutes()+r.getMinutes()*f,e.getSeconds()+r.getSeconds()*f);"time"==this.constraints.selector&&e.setFullYear(1970,0,1);var w=B.format(e,this.constraints);if(this.filterString&&0!==w.toLowerCase().indexOf(this.filterString))return null;r=this.ownerDocument.createElement("div");r.className=this.baseClass+"Item";r.date=e;r.idx=f;p.create("div",{"class":this.baseClass+"ItemInner",innerHTML:w},r);w=1>f%this._visibleIncrement&&-1<f%this._visibleIncrement;f=!w&&!(f%this._clickableIncrement);
w?r.className+=" "+this.baseClass+"Marker":f&&(r.className+=" "+this.baseClass+"Tick");this.isDisabledDate(e)&&(r.className+=" "+this.baseClass+"ItemDisabled");this.value&&!A.compare(this.value,e,this.constraints.selector)&&(r.selected=!0,r.className+=" "+this.baseClass+"ItemSelected",this._selectedDiv=r,w?r.className+=" "+this.baseClass+"MarkerSelected":f&&(r.className+=" "+this.baseClass+"TickSelected"),this._highlightOption(r,!0));return r},onOpen:function(){this.inherited(arguments);this.set("selected",
this._selectedDiv)},_onOptionSelected:function(f,e){(f=f.target.date||f.target.parentNode.date)&&!this.isDisabledDate(f)&&(this._set("value",f),this.emit("input"),e&&(this._highlighted_option=null,this.set("value",f),this.onChange(f)))},onChange:function(){},_highlightOption:function(f,e){if(f){if(e)this._highlighted_option&&this._highlightOption(this._highlighted_option,!1),this._highlighted_option=f;else{if(this._highlighted_option!==f)return;this._highlighted_option=null}l.toggle(f,this.baseClass+
"ItemHover",e);l.contains(f,this.baseClass+"Marker")?l.toggle(f,this.baseClass+"MarkerHover",e):l.toggle(f,this.baseClass+"TickHover",e)}},handleKey:function(f){if(f.keyCode==k.DOWN_ARROW)return this.selectNextNode(),this._onOptionSelected({target:this._highlighted_option},!1),f.stopPropagation(),f.preventDefault(),!1;if(f.keyCode==k.UP_ARROW)return this.selectPreviousNode(),this._onOptionSelected({target:this._highlighted_option},!1),f.stopPropagation(),f.preventDefault(),!1;if(f.keyCode==k.ENTER||
f.keyCode===k.TAB){if(!this._keyboardSelected&&f.keyCode===k.TAB)return!0;this._highlighted_option&&this._onOptionSelected({target:this._highlighted_option},!0);return f.keyCode===k.TAB}},onHover:function(f){this._highlightOption(f,!0)},onUnhover:function(f){this._highlightOption(f,!1)},onSelect:function(f){this._highlightOption(f,!0)},onDeselect:function(f){this._highlightOption(f,!1)},onClick:function(f){this._onOptionSelected({target:f},!0)}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),
function(G,A,B,v,t,l,p,d,k){B=B("dojo.data.ItemFileReadStore",[l],{constructor:function(c){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=c.url;this._jsonData=c.data;this.data=null;this._datatypeMap=c.typeMap||{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(b){return k.fromISOString(b)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName=
"_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==c.urlPreventCache&&(this.urlPreventCache=c.urlPreventCache?!0:!1);void 0!==c.hierarchical&&(this.hierarchical=c.hierarchical?!0:!1);c.clearOnClose&&(this.clearOnClose=!0);"failOk"in c&&(this.failOk=c.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(c){if(!this.isItem(c))throw Error(this.declaredClass+
": Invalid item argument.");},_assertIsAttribute:function(c){if("string"!==typeof c)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(c,b,h){c=this.getValues(c,b);return 0<c.length?c[0]:h},getValues:function(c,b){this._assertIsItem(c);this._assertIsAttribute(b);return(c[b]||[]).slice(0)},getAttributes:function(c){this._assertIsItem(c);var b=[],h;for(h in c)h!==this._storeRefPropName&&h!==this._itemNumPropName&&h!==this._rootItemPropName&&h!==this._reverseRefMap&&
b.push(h);return b},hasAttribute:function(c,b){this._assertIsItem(c);this._assertIsAttribute(b);return b in c},containsValue:function(c,b,h){var n=void 0;"string"===typeof h&&(n=p.patternToRegExp(h,!1));return this._containsValue(c,b,h,n)},_containsValue:function(c,b,h,n){return v.some(this.getValues(c,b),function(m){if(null!==m&&!A.isObject(m)&&n){if(m.toString().match(n))return!0}else if(h===m)return!0})},isItem:function(c){return c&&c[this._storeRefPropName]===this&&this._arrayOfAllItems[c[this._itemNumPropName]]===
c?!0:!1},isItemLoaded:function(c){return this.isItem(c)},loadItem:function(c){this._assertIsItem(c.item)},getFeatures:function(){return this._features},getLabel:function(c){if(this._labelAttr&&this.isItem(c))return this.getValue(c,this._labelAttr)},getLabelAttributes:function(c){return this._labelAttr?[this._labelAttr]:null},filter:function(c,b,h){var n=[];if(c.query){var m=c.queryOptions?c.queryOptions.ignoreCase:!1;var g={};for(r in c.query){var a=c.query[r];"string"===typeof a?g[r]=p.patternToRegExp(a,
m):a instanceof RegExp&&(g[r]=a)}for(m=0;m<b.length;++m){var f=!0,e=b[m];if(null===e)f=!1;else for(r in c.query)a=c.query[r],this._containsValue(e,r,a,g[r])||(f=!1);f&&n.push(e)}}else for(m=0;m<b.length;++m){var r=b[m];null!==r&&n.push(r)}h(n,c)},_fetchItems:function(c,b,h){var n=this;if(this._loadFinished)this.filter(c,this._getItemsArray(c.queryOptions),b);else if(this._jsonFileUrl!==this._ccUrl?(G.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),
this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:c,filter:A.hitch(n,"filter"),findCallback:A.hitch(n,b)});else{this._loadInProgress=!0;var m=t.get({url:n._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});m.addCallback(function(a){try{n._getItemsFromLoadedData(a),
n._loadFinished=!0,n._loadInProgress=!1,n.filter(c,n._getItemsArray(c.queryOptions),b),n._handleQueuedFetches()}catch(f){n._loadFinished=!0,n._loadInProgress=!1,h(f,c)}});m.addErrback(function(a){n._loadInProgress=!1;h(a,c)});var g=null;c.abort&&(g=c.abort);c.abort=function(){var a=m;a&&-1===a.fired&&(a.cancel(),a=null);g&&g.call(c)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,n.filter(c,this._getItemsArray(c.queryOptions),b)}catch(a){h(a,
c)}else h(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),c)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var c=0;c<this._queuedFetches.length;c++){var b=this._queuedFetches[c],h=b.args,n=b.filter;b=b.findCallback;n?n(h,this._getItemsArray(h.queryOptions),b):this.fetchItemByIdentity(h)}this._queuedFetches=[]}},_getItemsArray:function(c){return c&&c.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(c){this.clearOnClose&&
this._loadFinished&&!this._loadInProgress&&(""!=this._jsonFileUrl&&null!=this._jsonFileUrl||""!=this.url&&null!=this.url||null!=this.data||console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(c){function b(C){return null!==
C&&"object"===typeof C&&(!A.isArray(C)||n)&&!A.isFunction(C)&&(C.constructor==Object||A.isArray(C))&&"undefined"===typeof C._reference&&"undefined"===typeof C._type&&"undefined"===typeof C._value&&m.hierarchical}function h(C){m._arrayOfAllItems.push(C);for(var F in C){var u=C[F];if(u)if(A.isArray(u))for(var E=0;E<u.length;++E){var D=u[E];b(D)&&h(D)}else b(u)&&h(u)}}var n=!1,m=this;this._labelAttr=c.label;var g;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=c.items;for(g=0;g<this._arrayOfTopLevelItems.length;++g){var a=
this._arrayOfTopLevelItems[g];A.isArray(a)&&(n=!0);h(a);a[this._rootItemPropName]=!0}var f={},e;for(g=0;g<this._arrayOfAllItems.length;++g)for(e in a=this._arrayOfAllItems[g],a){if(e!==this._rootItemPropName){var r=a[e];null!==r?A.isArray(r)||(a[e]=[r]):a[e]=[null]}f[e]=e}for(;f[this._storeRefPropName];)this._storeRefPropName+="_";for(;f[this._itemNumPropName];)this._itemNumPropName+="_";for(;f[this._reverseRefMap];)this._reverseRefMap+="_";if(f=c.identifier)for(this._itemsByIdentity={},this._features["dojo.data.api.Identity"]=
f,g=0;g<this._arrayOfAllItems.length;++g)if(a=this._arrayOfAllItems[g],c=a[f],c=c[0],Object.hasOwnProperty.call(this._itemsByIdentity,c)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+f+"].  Value collided: ["+c+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+f+"].  Value collided: ["+
c+"]");}else this._itemsByIdentity[c]=a;else this._features["dojo.data.api.Identity"]=Number;for(g=0;g<this._arrayOfAllItems.length;++g)a=this._arrayOfAllItems[g],a[this._storeRefPropName]=this,a[this._itemNumPropName]=g;for(g=0;g<this._arrayOfAllItems.length;++g)for(e in a=this._arrayOfAllItems[g],a)for(c=a[e],f=0;f<c.length;++f)if(r=c[f],null!==r&&"object"==typeof r){if("_type"in r&&"_value"in r){var w=r._type,H=this._datatypeMap[w];if(H)if(A.isFunction(H))c[f]=new H(r._value);else if(A.isFunction(H.deserialize))c[f]=
H.deserialize(r._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+w+"'");}if(r._reference){r=r._reference;if(A.isObject(r))for(w=0;w<this._arrayOfAllItems.length;++w){H=this._arrayOfAllItems[w];var x=!0,q;for(q in r)H[q]!=r[q]&&(x=!1);x&&(c[f]=H)}else c[f]=this._getItemByIdentity(r);
this.referenceIntegrity&&(r=c[f],this.isItem(r)&&this._addReferenceToMap(r,a,e))}else this.isItem(r)&&this.referenceIntegrity&&this._addReferenceToMap(r,a,e)}},_addReferenceToMap:function(c,b,h){},getIdentity:function(c){var b=this._features["dojo.data.api.Identity"];return b===Number?c[this._itemNumPropName]:(c=c[b])?c[0]:null},fetchItemByIdentity:function(c){if(this._loadFinished){var b=this._getItemByIdentity(c.identity);if(c.onItem){var h=c.scope?c.scope:G.global;c.onItem.call(h,b)}}else{var n=
this;this._jsonFileUrl!==this._ccUrl?(G.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:c}):(this._loadInProgress=!0,h=t.get({url:n._jsonFileUrl,
handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),h.addCallback(function(m){var g=c.scope?c.scope:G.global;try{n._getItemsFromLoadedData(m),n._loadFinished=!0,n._loadInProgress=!1,b=n._getItemByIdentity(c.identity),c.onItem&&c.onItem.call(g,b),n._handleQueuedFetches()}catch(a){n._loadInProgress=!1,c.onError&&c.onError.call(g,a)}}),h.addErrback(function(m){n._loadInProgress=!1;c.onError&&c.onError.call(c.scope?c.scope:G.global,m)})):this._jsonData&&(n._getItemsFromLoadedData(n._jsonData),
n._jsonData=null,n._loadFinished=!0,b=n._getItemByIdentity(c.identity),c.onItem&&(h=c.scope?c.scope:G.global,c.onItem.call(h,b)))}},_getItemByIdentity:function(c){var b=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,c)&&(b=this._itemsByIdentity[c]):Object.hasOwnProperty.call(this._arrayOfAllItems,c)&&(b=this._arrayOfAllItems[c]);void 0===b&&(b=null);return b},getIdentityAttributes:function(c){c=this._features["dojo.data.api.Identity"];return c===Number?null:[c]},_forceLoad:function(){var c=
this;this._jsonFileUrl!==this._ccUrl?(G.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var b=t.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,
sync:!0});b.addCallback(function(h){try{if(!0!==c._loadInProgress&&!c._loadFinished)c._getItemsFromLoadedData(h),c._loadFinished=!0;else if(c._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(n){throw console.log(n),n;}});b.addErrback(function(h){throw h;})}else this._jsonData&&(c._getItemsFromLoadedData(c._jsonData),c._jsonData=null,c._loadFinished=!0)}});A.extend(B,d);return B})},"dojo/data/util/filter":function(){define(["../../_base/lang"],
function(G){var A={};G.setObject("dojo.data.util.filter",A);A.patternToRegExp=function(B,v){for(var t="^",l=null,p=0;p<B.length;p++)switch(l=B.charAt(p),l){case "\\":t+=l;p++;t+=B.charAt(p);break;case "*":t+=".*";break;case "?":t+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":t+="\\";default:t+=l}t+="$";return v?new RegExp(t,"mi"):new RegExp(t,"m")};return A})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang",
"../../_base/kernel","./sorter"],function(G,A,B){var v={};G.setObject("dojo.data.util.simpleFetch",v);v.errorHandler=function(t,l){l.onError&&l.onError.call(l.scope||A.global,t,l)};v.fetchHandler=function(t,l){var p=l.abort||null,d=!1,k=l.start?l.start:0,c=l.count&&Infinity!==l.count?k+l.count:t.length;l.abort=function(){d=!0;p&&p.call(l)};var b=l.scope||A.global;l.store||(l.store=this);l.onBegin&&l.onBegin.call(b,t.length,l);l.sort&&t.sort(B.createSortFunction(l.sort,this));if(l.onItem)for(var h=
k;h<t.length&&h<c;++h){var n=t[h];d||l.onItem.call(b,n,l)}l.onComplete&&!d&&(h=null,l.onItem||(h=t.slice(k,c)),l.onComplete.call(b,h,l))};v.fetch=function(t){t=t||{};t.store||(t.store=this);this._fetchItems(t,G.hitch(this,"fetchHandler"),G.hitch(this,"errorHandler"));return t};return v})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(G){var A={};G.setObject("dojo.data.util.sorter",A);A.basicComparator=function(B,v){var t=-1;null===B&&(B=void 0);null===v&&(v=void 0);if(B==
v)t=0;else if(B>v||null==B)t=1;return t};A.createSortFunction=function(B,v){function t(n,m,g,a){return function(f,e){f=a.getValue(f,n);e=a.getValue(e,n);return m*g(f,e)}}for(var l=[],p,d=v.comparatorMap,k=A.basicComparator,c=0;c<B.length;c++){p=B[c];var b=p.attribute;if(b){p=p.descending?-1:1;var h=k;d&&("string"!==typeof b&&"toString"in b&&(b=b.toString()),h=d[b]||k);l.push(t(b,p,h,v))}}return function(n,m){for(var g=0;g<l.length;){var a=l[g++](n,m);if(0!==a)return a}return 0}};return A})},"dojox/date/islamic":function(){define(["dojox/main",
"dojo/_base/lang","dojo/date","./islamic/Date"],function(G,A,B,v){var t=A.getObject("date.islamic",!0,G);t.getDaysInMonth=function(l){return l.getDaysInIslamicMonth(l.getMonth(),l.getFullYear())};t.compare=function(l,p,d){l instanceof v&&(l=l.toGregorian());p instanceof v&&(p=p.toGregorian());return B.compare.apply(null,arguments)};t.add=function(l,p,d){var k=new v(l);switch(p){case "day":k.setDate(l.getDate()+d);break;case "weekday":var c=l.getDay();if(5>c+d&&0<c+d)k.setDate(l.getDate()+d);else{var b=
p=0;5==c?(c=4,b=0<d?-1:1):6==c&&(c=4,b=0<d?-2:2);c=0<d?5-c-1:-c;var h=d-c,n=parseInt(h/5);0!=h%5&&(p=0<d?2:-2);p=p+7*n+h%5+c;k.setDate(l.getDate()+p+b)}break;case "year":k.setFullYear(l.getFullYear()+d);break;case "week":d*=7;k.setDate(l.getDate()+d);break;case "month":l=l.getMonth();k.setMonth(l+d);break;case "hour":k.setHours(l.getHours()+d);break;case "minute":k._addMinutes(d);break;case "second":k._addSeconds(d);break;case "millisecond":k._addMilliseconds(d)}return k};t.difference=function(l,
p,d){p=p||new v;d=d||"day";var k=p.getFullYear()-l.getFullYear(),c=1;switch(d){case "weekday":k=Math.round(t.difference(l,p,"day"));c=parseInt(t.difference(l,p,"week"));if(0==k%7)k=5*c;else{d=0;var b=l.getDay(),h=p.getDay();c=parseInt(k/7);p=k%7;l=new v(l);l.setDate(l.getDate()+7*c);l=l.getDay();if(0<k)switch(!0){case 5==b:d=-1;break;case 6==b:d=0;break;case 5==h:d=-1;break;case 6==h:d=-2;break;case 5<l+p:d=-2}else if(0>k)switch(!0){case 5==b:d=0;break;case 6==b:d=1;break;case 5==h:d=2;break;case 6==
h:d=1;break;case 0>l+p:d=2}k=k+d-2*c}c=k;break;case "year":c=k;break;case "month":d=p.toGregorian()>l.toGregorian()?p:l;b=p.toGregorian()>l.toGregorian()?l:p;c=d.getMonth();h=b.getMonth();if(0==k)c=d.getMonth()-b.getMonth();else for(c=12-h+c,k=b.getFullYear()+1,d=d.getFullYear(),k;k<d;k++)c+=12;p.toGregorian()<l.toGregorian()&&(c=-c);break;case "week":c=parseInt(t.difference(l,p,"day")/7);break;case "day":c/=24;case "hour":c/=60;case "minute":c/=60;case "second":c/=1E3;case "millisecond":c*=p.toGregorian().getTime()-
l.toGregorian().getTime()}return Math.round(c)};return t})},"dojox/main":function(){define(["dojo/_base/kernel"],function(G){return G.dojox})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(G,A,B){var v=A("dojox.date.islamic.Date",null,{_date:0,_month:0,_year:0,_hours:0,_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,constructor:function(){var t=arguments.length;t?1==t?(t=arguments[0],"number"==
typeof t&&(t=new Date(t)),t instanceof Date?this.fromGregorian(t):""==t?this._date=new Date(""):(this._year=t._year,this._month=t._month,this._date=t._date,this._hours=t._hours,this._minutes=t._minutes,this._seconds=t._seconds,this._milliseconds=t._milliseconds)):3<=t&&(this._year+=arguments[0],this._month+=arguments[1],this._date+=arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},
getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},setDate:function(t){t=parseInt(t);if(!(0<t&&t<=this.getDaysInIslamicMonth(this._month,this._year))){var l;if(0<t)for(l=this.getDaysInIslamicMonth(this._month,
this._year);t>l;t-=l,l=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,this._month-=12);else for(l=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=t;l=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),t+=l}this._date=t;return this},setFullYear:function(t){this._year=+t},setMonth:function(t){this._year+=
Math.floor(t/12);this._month=0<t?Math.floor(t%12):Math.floor((t%12+12)%12)},setHours:function(){var t=arguments.length,l=0;1<=t&&(l=parseInt(arguments[0]));2<=t&&(this._minutes=parseInt(arguments[1]));3<=t&&(this._seconds=parseInt(arguments[2]));4==t&&(this._milliseconds=parseInt(arguments[3]));for(;24<=l;)this._date++,t=this.getDaysInIslamicMonth(this._month,this._year),this._date>t&&(this._month++,12<=this._month&&(this._year++,this._month-=12),this._date-=t),l-=24;this._hours=l},_addMinutes:function(t){t+=
this._minutes;this.setMinutes(t);this.setHours(this._hours+parseInt(t/60));return this},_addSeconds:function(t){t+=this._seconds;this.setSeconds(t);this._addMinutes(parseInt(t/60));return this},_addMilliseconds:function(t){t+=this._milliseconds;this.setMilliseconds(t);this._addSeconds(parseInt(t/1E3));return this},setMinutes:function(t){this._minutes=t%60;return this},setSeconds:function(t){this._seconds=t%60;return this},setMilliseconds:function(t){this._milliseconds=t%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";
var t=new Date;t.setHours(this._hours);t.setMinutes(this._minutes);t.setSeconds(this._seconds);t.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+t.toTimeString()},toGregorian:function(){var t=this._year;t=Math.floor(this._date+Math.ceil(29.5*this._month)+354*(t-1)+Math.floor((3+11*t)/30)+this._ISLAMIC_EPOCH-1-.5)+.5;var l=t-this._GREGORIAN_EPOCH,p=Math.floor(l/146097),d=this._mod(l,146097);l=Math.floor(d/36524);var k=this._mod(d,36524);d=Math.floor(k/1461);
k=this._mod(k,1461);k=Math.floor(k/365);p=400*p+100*l+4*d+k;4!=l&&4!=k&&p++;l=t-(this._GREGORIAN_EPOCH+365*(p-1)+Math.floor((p-1)/4)-Math.floor((p-1)/100)+Math.floor((p-1)/400));d=this._GREGORIAN_EPOCH-1+365*(p-1)+Math.floor((p-1)/4)-Math.floor((p-1)/100)+Math.floor((p-1)/400)+Math.floor(739/12+(B.isLeapYear(new Date(p,3,1))?-1:-2)+1);d=t<d?0:B.isLeapYear(new Date(p,3,1))?1:2;l=Math.floor((12*(l+d)+373)/367);d=this._GREGORIAN_EPOCH-1+365*(p-1)+Math.floor((p-1)/4)-Math.floor((p-1)/100)+Math.floor((p-
1)/400)+Math.floor((367*l-362)/12+(2>=l?0:B.isLeapYear(new Date(p,l-1,1))?-1:-2)+1);return new Date(p,l-1,t-d+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(t){t=new Date(t);var l=t.getFullYear(),p=t.getMonth(),d=t.getDate();l=this._GREGORIAN_EPOCH-1+365*(l-1)+Math.floor((l-1)/4)+-Math.floor((l-1)/100)+Math.floor((l-1)/400)+Math.floor((367*(p+1)-362)/12+(2>=p+1?0:B.isLeapYear(t)?-1:-2)+d);l=Math.floor(l)+.5;l-=this._ISLAMIC_EPOCH;p=Math.floor((30*l+10646)/10631);
d=Math.ceil((l-29-this._yearStart(p))/29.5);d=Math.min(d,11);this._date=Math.ceil(l-this._monthStart(p,d))+1;this._month=d;this._year=p;this._hours=t.getHours();this._minutes=t.getMinutes();this._seconds=t.getSeconds();this._milliseconds=t.getMilliseconds();this._day=t.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},_yearStart:function(t){return 354*(t-1)+Math.floor((3+11*t)/30)},_monthStart:function(t,l){return Math.ceil(29.5*l)+354*(t-1)+Math.floor((3+11*t)/30)},_civilLeapYear:function(t){return 11>
(14+11*t)%30},getDaysInIslamicMonth:function(t,l){var p=0;p=29+(t+1)%2;11==t&&this._civilLeapYear(l)&&p++;return p},_mod:function(t,l){return t-l*Math.floor(t/l)}});v.getDaysInIslamicMonth=function(t){return(new v).getDaysInIslamicMonth(t.getMonth(),t.getFullYear())};return v})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),function(G,A,B,v,t,l,p,d,k){function c(g,
a,f,e,r){return r.replace(/([a-z])\1*/ig,function(w){var H=w.charAt(0);w=w.length;var x=["abbr","wide","narrow"];switch(H){case "G":var q=a.eraAbbr[0];break;case "y":q=String(g.getFullYear());break;case "M":q=g.getMonth();if(3>w){q+=1;var C=!0}else H=["months-format",x[w-3]].join("-"),q=a[H][q];break;case "d":q=g.getDate(!0);C=!0;break;case "E":q=g.getDay();3>w?(q+=1,C=!0):(H=["days-format",x[w-3]].join("-"),q=a[H][q]);break;case "a":q=12>g.getHours()?"am":"pm";q=a["dayPeriods-format-wide-"+q];break;
case "h":case "H":case "K":case "k":C=g.getHours();switch(H){case "h":q=C%12||12;break;case "H":q=C;break;case "K":q=C%12;break;case "k":q=C||24}C=!0;break;case "m":q=g.getMinutes();C=!0;break;case "s":q=g.getSeconds();C=!0;break;case "S":q=Math.round(g.getMilliseconds()*Math.pow(10,w-3));C=!0;break;case "z":if(q=v.getTimezoneName(g.toGregorian()))break;w=4;case "Z":q=g.toGregorian().getTimezoneOffset();q=[0>=q?"+":"-",p.pad(Math.floor(Math.abs(q)/60),2),p.pad(Math.abs(q)%60,2)];4==w&&(q.splice(0,
0,"GMT"),q.splice(3,0,":"));q=q.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+r);}C&&(q=p.pad(q,w));return q})}function b(g,a,f,e){var r=function(x){return x};a=a||r;f=f||r;e=e||r;var w=g.match(/(''|[^'])+/g),H="'"==g.charAt(0);B.forEach(w,function(x,q){x?(w[q]=(H?f:a)(x),H=!H):w[q]=""});return e(w.join(""))}function h(g,a,f,e){e=l.escapeString(e);t.normalizeLocale(f.locale);return e.replace(/([a-z])\1*/ig,function(r){var w=r.charAt(0);var H=
r.length,x="";f.strict?1<H&&(x="0{"+(H-1)+"}"):x="0?";switch(w){case "y":w="\\d+";break;case "M":w=2<H?"\\S+ ?\\S+":x+"[1-9]|1[0-2]";break;case "d":w="[12]\\d|"+x+"[1-9]|3[01]";break;case "E":w="\\S+";break;case "h":w=x+"[1-9]|1[0-2]";break;case "k":w=x+"\\d|1[01]";break;case "H":w=x+"\\d|1\\d|2[0-3]";break;case "K":w=x+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":w=x+"\\d|[0-5]\\d";break;case "S":w="\\d{"+H+"}";break;case "a":H=f.am||a["dayPeriods-format-wide-am"];x=f.pm||a["dayPeriods-format-wide-pm"];
f.strict?w=H+"|"+x:(w=H+"|"+x,H!=H.toLowerCase()&&(w+="|"+H.toLowerCase()),x!=x.toLowerCase()&&(w+="|"+x.toLowerCase()));break;default:w=".*"}g&&g.push(r);return"("+w+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var n=A.getObject("date.islamic.locale",!0,G);n.format=function(g,a){a=a||{};var f=t.normalizeLocale(a.locale),e=a.formatLength||"short",r=n._getIslamicBundle(f),w=[];f=A.hitch(this,c,g,r,f,a.fullYear);if("year"==a.selector)return g.getFullYear();"time"!=a.selector&&(g=a.datePattern||r["dateFormat-"+
e])&&w.push(b(g,f));"date"!=a.selector&&(a=a.timePattern||r["timeFormat-"+e])&&w.push(b(a,f));return w.join(" ")};n.regexp=function(g){return n._parseInfo(g).regexp};n._parseInfo=function(g){g=g||{};var a=t.normalizeLocale(g.locale);a=n._getIslamicBundle(a);var f=g.formatLength||"short",e=g.datePattern||a["dateFormat-"+f];f=g.timePattern||a["timeFormat-"+f];var r=[];return{regexp:b("date"==g.selector?e:"time"==g.selector?f:"undefined"==typeof f?e:e+" "+f,A.hitch(this,h,r,a,g)),tokens:r,bundle:a}};
n.parse=function(g,a){g=g.replace(/[\u200E\u200F\u202A\u202E]/g,"");a||(a={});var f=n._parseInfo(a),e=f.tokens,r=f.bundle;f=f.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,"");g=(new RegExp("^"+f+"$")).exec(g);t.normalizeLocale(a.locale);if(!g)return null;var w=[1389,0,1,0,0,0,0],H="",x=["abbr","wide","narrow"];B.every(g,function(q,C){if(!C)return!0;C=e[C-1];var F=C.length;switch(C.charAt(0)){case "y":w[0]=Number(q);break;case "M":if(2<F){if(C=r["months-format-"+x[F-3]].concat(),a.strict||(q=q.replace(".",
"").toLowerCase(),C=B.map(C,function(E){return E?E.replace(".","").toLowerCase():E})),q=B.indexOf(C,q),-1==q)return!1}else q--;w[1]=Number(q);break;case "D":w[1]=0;case "d":w[2]=Number(q);break;case "a":C=a.am||r["dayPeriods-format-wide-am"];F=a.pm||r["dayPeriods-format-wide-pm"];if(!a.strict){var u=/\./g;q=q.replace(u,"").toLowerCase();C=C.replace(u,"").toLowerCase();F=F.replace(u,"").toLowerCase()}if(a.strict&&q!=C&&q!=F)return!1;H=q==F?"p":q==C?"a":"";break;case "K":24==q&&(q=0);case "h":case "H":case "k":w[3]=
Number(q);break;case "m":w[4]=Number(q);break;case "s":w[5]=Number(q);break;case "S":w[6]=Number(q)}return!0});g=+w[3];"p"===H&&12>g?w[3]=g+12:"a"===H&&12==g&&(w[3]=0);return new d(w[0],w[1],w[2],w[3],w[4],w[5],w[6])};var m=[];n.addCustomFormats=function(g,a){m.push({pkg:g,name:a})};n._getIslamicBundle=function(g){var a={};B.forEach(m,function(f){f=t.getLocalization(f.pkg,f.name,g);a=A.mixin(a,f)},this);return a};n.addCustomFormats("dojo.cldr","islamic");n.getNames=function(g,a,f,e,r){e=n._getIslamicBundle(e);
g=[g,f,a];if("standAlone"==f){f=g.join("-");var w=e[f];1==w[0]&&(w=void 0)}g[1]="format";return(w||e[g.join("-")]).concat()};n.weekDays=n.getNames("days","wide","format");n.months=n.getNames("months","wide","format");return n})},"esri/dijit/editing/Editor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/DeferredList dojo/dom-class dojo/dom-construct dojo/string dijit/_Widget dijit/_Templated ../../domUtils ../../graphicsUtils ../../geometry/Polyline ../../geometry/Polygon ../../graphic ../../undoManager ../../tasks/query ../../layers/FeatureLayer ../../layers/FeatureTemplate ../../toolbars/draw ../../toolbars/edit ../AttributeInspector ./Util ./Add ./Update ./Delete ./Cut ./Union ./toolbars/Drawing ./SelectionHelper ./TemplatePicker ../../kernel ../../config dojo/i18n!../../nls/jsapi dojo/text!./templates/Editor.html dijit/ProgressBar dojo/NodeList-dom".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e,r,w,H,x,q,C,F,u,E,D,M,I,z,K,L,N,P,T,S,Z){var da=G([h,n],{declaredClass:"esri.dijit.editing.Editor",widgetsInTemplate:!0,templateString:Z,onLoad:function(){},constructor:function(Q,W){Q=Q||{};Q.settings||console.error("Editor: please provide 'settings' parameter in the constructor");Q.settings.layerInfos||console.error("Editor: please provide 'layerInfos' parameter in the constructor");this._settings=Q.settings;this._eConnects=[]},startup:function(){this.inherited(arguments);
this._setDefaultOptions();this._settings.map.setInfoWindowOnClick(!1);var Q=this._settings.layerInfos;this.featureReductionEnabledLayers=[];B.forEach(Q,function(aa){aa=aa.featureLayer;aa.isFeatureReductionEnabled()&&(aa.disableFeatureReduction(),this.featureReductionEnabledLayers.push(aa))},this);if(B.every(Q,function(aa){return aa.featureLayer.loaded}))this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0;else{var W=Q.length;B.forEach(Q,function(aa){aa=aa.featureLayer;
if(aa.loaded)W--;else var R=v.connect(aa,"onLoad",this,function(V){v.disconnect(R);R=null;W--;W||(this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0)})},this)}this._reset();this._enableMapClickHandler()},stopEditing:function(Q){this._updateCurrentFeature(A.hitch(this,function(){this._clearSelection(!1);Q&&Q()}))},destroy:function(){this._settings.map.setInfoWindowOnClick(!0);this.drawingToolbar&&this.drawingToolbar.destroy();this.attributeInspector&&this.attributeInspector.destroy();
this.templatePicker&&this.templatePicker.destroy();this._selectionHelper&&this._selectionHelper.destroy();this._drawToolbar&&this._drawToolbar.deactivate();this._reset();this._disableMapClickHandler();B.forEach(this._eConnects,v.disconnect);v.disconnect(this._dtConnect);v.disconnect(this._templatePickerOnSelectionChangeEvent);this._layer=this._currentGraphic=this._activeType=this._activeTemplate=this._drawingTool=this._drawToolbar=this.editToolbar=this.drawingToolbar=this.attributeInspector=this.templatePicker=
this.undoManager=null;this._settings.map.infoWindow&&this._settings.map.infoWindow.clearFeatures&&this._settings.map.infoWindow.clearFeatures();B.forEach(this.featureReductionEnabledLayers,function(Q){Q.enableFeatureReduction()});this.inherited(arguments)},_setDefaultOptions:function(){this._drawToolbar=this._settings.drawToolbar||new q(this._settings.map);this._settings.drawToolbar=this._drawToolbar;this.editToolbar=this._settings.editToolbar||new C(this._settings.map,{textSymbolEditorHolder:this.domNode});
this._settings.editToolbar=this.editToolbar;this._settings.toolbarVisible=this._settings.toolbarVisible||!1;this._settings.toolbarOptions=A.mixin({reshapeVisible:!1,cutVisible:!1,mergeVisible:!1},this._settings.toolbarOptions);this._settings.createOptions=A.mixin({polylineDrawTools:[da.CREATE_TOOL_POLYLINE],polygonDrawTools:[da.CREATE_TOOL_POLYGON],editAttributesImmediately:!0},this._settings.createOptions);this._settings.singleSelectionTolerance=this._settings.singleSelectionTolerance||3;this._settings.maxUndoRedoOperations=
this._settings.maxUndoRedoOperations||10;this._settings.editor=this;this._usePopup=this._settings.usePopup=this._settings.map.infoWindow._setPagerCallbacks?!0:!1;this._datePackage=this._settings.datePackage;var Q=T.defaults;this._settings.geometryService=this._settings.geometryService||Q.geometryService;Q.geometryService=Q.geometryService||this._settings.geometryService},_initLayers:function(){this._settings.layers=[];this._settings.userIds={};this._settings.createOnlyLayer={};B.forEach(this._settings.layerInfos,
function(Q){if(Q.featureLayer&&Q.featureLayer.loaded){this._settings.layers.push(Q.featureLayer);var W=Q.featureLayer.id;Q.featureLayer.credential&&(this._settings.userIds[W]=Q.featureLayer.credential.userId);Q.userId&&(this._settings.userIds[W]=Q.userId);var aa=Q.featureLayer.getEditCapabilities();this._settings.createOnlyLayer[W]=aa.canCreate&&!aa.canUpdate?!0:!1;this._isTextSymbolPointLayer(Q.featureLayer)&&(Q.disableAttributeUpdate=!0)}},this)},_reset:function(){this._hideAttributeInspector();
this.editToolbar.deactivate();this._editVertices=!0;this._drawingTool=this._activeTemplate=this._activeType=this._currentGraphic=this._layer=null;this._attributeChanged=!1},_saveFeatureOnClient:function(Q){var W=this.templatePicker.getSelected();var aa=W.template?W.featureLayer.renderer.getSymbol(W.template.prototype):W.symbolInfo.symbol;this._tempGraphic=new e(Q,aa,null,null);this._tempGraphic.setAttributes(A.mixin({},W.template.prototype.attributes));aa=this._settings.map;aa.graphics.add(this._tempGraphic);
Q=this._findCenterPoint(Q);this._createAttributeInspector();aa.infoWindow.setTitle(W.featureLayer?W.featureLayer.name:S.widgets.attributeInspector.NLS_title);this.attributeInspector.showFeature(this._tempGraphic,W.featureLayer);this._showInfoWindow(Q,aa.getInfoWindowAnchor(Q));if(this._settings.createOnlyLayer[W.featureLayer.id]||this._settings.invalidTemplate)this._infoWindowHideEvent=v.connect(aa.infoWindow,"onHide",this,"_infoWindowHide");v.disconnect(this._templatePickerOnSelectionChangeEvent);
this.templatePicker.clearSelection();this._drawToolbar.deactivate();this._enableMapClickHandler();this.drawingToolbar&&this.drawingToolbar.deactivate();this._templatePickerOnSelectionChangeEvent=v.connect(this.templatePicker,"onSelectionChange",A.hitch(this,"_onCreateFeature"))},_saveAttributesOnClient:function(Q,W,aa){this._tempGraphic.attributes[W]="number"===typeof aa&&isNaN(aa)?null:aa},_infoWindowHide:function(){this._createFeature(this._tempGraphic.geometry,this._tempGraphic.attributes);v.disconnect(this._infoWindowHideEvent)},
_createFeature:function(Q,W){this._editClickPoint=this._findCenterPoint(Q);Q.rings?this._simplify(Q,A.hitch(this,function(aa){this._drawingTool!==x.TOOL_AUTO_COMPLETE_POLYGON?this._applyEdits([{layer:this._layer,adds:[this._createGraphic(aa,W)]}],A.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})):this._autoComplete(aa,A.hitch(this,function(R){R&&R.length&&this._applyEdits([{layer:this._layer,adds:B.map(R,
A.hitch(this,function(V){return this._createGraphic(V,W)}))}],function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})}))})):this._applyEdits([{layer:this._layer,adds:[this._createGraphic(Q,W)]}],A.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer);this._layer&&this._layer.renderer&&"heatmap"===this._layer.renderer.type&&this._layer.refresh()}))},
_chainAttachment:function(Q,W){this.attributeInspector&&this.attributeInspector._attachmentEditor&&this.attributeInspector._attachmentEditor._tempUpload&&this.attributeInspector._attachmentEditor._chainAttachment(Q,W)},_updateCurrentFeature:function(Q){var W=this._isModified();W?this._updateFeature(W,Q):Q&&Q(!1)},_updateFeature:function(Q,W,aa){var R=Q.geometry,V=Q.getLayer();V.hasZ&&!V.enableZDefaults||V.hasM&&!V.allowUpdateWithoutMValues||aa&&!this._isModified()?(aa=new e,aa.setAttributes(Q.attributes),
this._applyEdits([{layer:Q.getLayer(),updates:[aa]}],W)):R.rings?this._simplify(R,A.hitch(this,function(ba){this._applyEdits([{layer:Q.getLayer(),updates:[A.mixin(Q,{geometry:ba})]}],W)})):this._applyEdits([{layer:Q.getLayer(),updates:[Q]}],W)},_deleteFeature:function(Q,W){if(this._settings.invalidTemplate&&Q===this._tempGraphic)this._settings.map.graphics.remove(this._tempGraphic),this._hideAttributeInspector();else{var aa=[];Q?aa.push({layer:Q.getLayer(),deletes:[Q]}):(aa=B.map(B.filter(this._settings.layers,
function(R){return 0<R.getSelectedFeatures().length}),function(R){return{layer:R,deletes:R.getSelectedFeatures()}}))&&aa.length||!this._currentGraphic||aa.push({layer:this._layer,deletes:[this._currentGraphic]});this._applyEdits(aa,W)}},_stopEditing:function(Q,W,aa,R){m.hide(this.progressBar.domNode);this._settings.createOnlyLayer[Q.id]||this._undoRedoAdd();if(!0===Q._isSelOnly||1===Q.mode||6===Q.mode){if(W&&W.length){this.templatePicker.clearSelection();var V=new w;V.objectIds=[W[0].objectId];this._settings.createOnlyLayer[Q.id]||
this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):this._selectFeatures([Q],V,A.hitch(this,"_onEditFeature"))}}else(V=this._selectionHelper.findMapService(this._settings.map,Q))&&V.refresh(),W&&W.length&&(this.templatePicker.clearSelection(),this._settings.createOnlyLayer[Q.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):u.findFeatures(W,Q,A.hitch(this,"_onEditFeature")));R&&R.length&&(this._clearSelection(!0),this._undoRedo&&
(V=this._selectionHelper.findMapService(Q,this._settings.map))&&V.refresh());this._undoRedo&&aa&&aa.length&&((V=this._selectionHelper.findMapService(Q,this._settings.map))&&V.refresh(),this.attributeInspector.refresh(),this._undoRedo=!1);this.drawingToolbar&&this.drawingToolbar._updateUI();this._undoRedo=!1;this._settings.invalidTemplate=!1},_undoRedoAdd:function(){this._settings._isApplyEditsCall=!1;if(this._settings.undoManager){var Q=this._edits&&this._edits.length?this._edits[0]:null;if(Q){var W=
Q.adds||[],aa=Q.updates||[],R=Q.deletes||[],V=Q.preUpdates||[];Q={featureLayer:Q.layer};"CUT"===this._activeTool?W.length&&aa.length&&V.length&&this.undoManager.add(new I(A.mixin(Q,{preUpdatedGraphics:V,addedGraphics:W,postUpdatedGraphics:aa}))):"UNION"===this._activeTool?R.length&&aa.length&&V.length&&this.undoManager.add(new z(A.mixin(Q,{preUpdatedGraphics:V,deletedGraphics:R,postUpdatedGraphics:aa}))):W.length?this.undoManager.add(new E(A.mixin(Q,{addedGraphics:W}))):R.length?this.undoManager.add(new M(A.mixin(Q,
{deletedGraphics:R}))):aa.length&&(this._rollbackGraphic||V.length)&&this.undoManager.add(new D(A.mixin(Q,{preUpdatedGraphics:V.length?V:[this._rollbackGraphic],postUpdatedGraphics:aa})));this._rollbackGraphic=this._edits=null}}},_activateDrawToolbar:function(Q){this._layer=Q.featureLayer;this._activeType=Q.type;this._drawingTool=(this._activeTemplate=Q.template)?this._activeTemplate.drawingTool:null;this._drawTool=this._toDrawTool(this._drawingTool,Q.featureLayer);v.disconnect(this._dtConnect);var W=
this._layer.fields;this._settings.invalidTemplate=!1;if(this._activeTemplate&&this._activeTemplate.prototype){var aa=A.mixin({},this._activeTemplate.prototype.attributes);W=W.filter(function(R){return!1===R.nullable&&!0===R.editable});this._settings.invalidTemplate=W.some(function(R){R=aa[R.name];return null===R||void 0===R})}this._dtConnect=this._settings.createOnlyLayer[Q.featureLayer.id]||this._settings.invalidTemplate?v.connect(this._drawToolbar,"onDrawEnd",this,"_saveFeatureOnClient"):v.connect(this._drawToolbar,
"onDrawEnd",this,"_createFeature");this.editToolbar.deactivate();this._disableMapClickHandler();this.drawingToolbar?this.drawingToolbar.activateEditing(this._drawTool,this._layer):this._drawToolbar.activate(this._drawTool)},_activateEditToolbar:function(Q,W){var aa=Q.getLayer(),R=aa?aa.geometryType:null,V=this._isTextSymbolPoint(Q),ba=C.MOVE;"esriGeometryPoint"!==R&&!0===this._isNotesFeature(Q)?(ba=ba|C.ROTATE|C.SCALE,this._editVertices=!1):"esriGeometryPoint"!==R&&!0===this._editVertices?(ba=ba|
C.ROTATE|C.SCALE,this._editVertices=!1):V?(ba=ba|C.ROTATE|C.SCALE|C.EDIT_TEXT,this._editVertices=!1):(ba|=C.EDIT_VERTICES,this._editVertices=!0);this._attributeChanged=this._isModified();this._rollbackGraphic=new e(Q.toJson());R=aa.getEditCapabilities({feature:Q,userId:this._settings.userIds[aa.id]});var ha=B.filter(this._settings.layerInfos,function(qa){return qa.featureLayer.layerId===aa.layerId})[0];R.canUpdate&&!ha.disableGeometryUpdate&&R.canUpdateGeometry&&(this.editToolbar.activate(ba,Q),V&&
(this.editToolbar._textEditor._addTextBox(Q),this.editToolbar._textSymbolEditor&&this.editToolbar._textSymbolEditor.hide()));this._settings.map.infoWindow.isShowing||this._updateAttributeDisabled(Q)||(Q=W&&W.screenPoint||this._findCenterPoint(Q),this._showInfoWindow(Q,this._settings.map.getInfoWindowAnchor(Q)))},_createGraphic:function(Q,W){var aa=new e(Q,this._activeType&&this._activeType.symbol||this._layer.defaultSymbol,W);this._activeTemplate||W?aa.attributes=W||A.mixin({},this._activeTemplate.prototype.attributes):
(aa.attributes=aa.attributes||[],B.forEach(this._layer.fields,function(R){aa.attributes[R.name]=null},this));return aa},_connectEvents:function(){var Q=this._settings.layers;B.forEach(Q,function(W){this._connect(W,"onEditsComplete",A.hitch(this,"_stopEditing",W))},this);B.forEach(Q,function(W){this._connect(W,"onBeforeApplyEdits",A.hitch(this,function(){m.show(this.progressBar.domNode);this._settings._isApplyEditsCall=!0}))},this);this._connect(this.editToolbar,"onGraphicClick",A.hitch(this,"_activateEditToolbar"));
this._connect(this.editToolbar,"onGraphicFirstMove",A.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onVertexFirstMove",A.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onScaleStart",A.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onRotateStart",A.hitch(this,"_hideAttributeInspector"))},_connect:function(Q,W,aa){this._eConnects.push(v.connect(Q,W,aa))},_createWidgets:function(){this._selectionHelper=new L(this._settings);this._createTemplatePicker();
this._createAttributeInspector();this._createDrawingToolbar();this._createUndoRedoManager()},_createTemplatePicker:function(){if(this._settings.templatePicker)this.templatePicker=this._settings.templatePicker,m.hide(this.templatePickerDiv);else{var Q=B.filter(this._settings.layers,function(W){return W.getEditCapabilities().canCreate});this.templatePicker=new N({"class":"esriTemplatePicker",featureLayers:Q,showTooltip:!0,maxLabelLength:this._settings.typesCharacterLimit,columns:"auto",rows:"auto"},
this.templatePickerDiv);this.templatePicker.startup();this._settings.templatePicker=this.templatePicker}this._templatePickerOnSelectionChangeEvent=v.connect(this.templatePicker,"onSelectionChange",A.hitch(this,"_onCreateFeature"))},_createAttributeInspector:function(){var Q=this._settings.map;this._settings.attributeInspector?(this._customAttributeInspector=!0,this.attributeInspector=this._settings.attributeInspector):(this._customAttributeInspector=!1,this.attributeInspector=new F({layerInfos:this._settings.layerInfos,
hideNavButtons:this._usePopup,datePackage:this._datePackage},c.create("div")),this.attributeInspector.startup(),Q.infoWindow.setContent(this.attributeInspector.domNode),Q.infoWindow.setTitle(S.widgets.attributeInspector.NLS_title),Q.infoWindow.resize(350,375),t.query(".esriAttributeInspector .atiLayerName").style({display:"none"}));this._connect(this.attributeInspector,"onDelete",A.hitch(this,"_deleteFeature"));this._connect(this.attributeInspector,"onNext",A.hitch(this,function(W){this._updateCurrentFeature(A.hitch(this,
function(){this._attributeChanged=!1;this._onEditFeature(W)}))}));this._usePopup&&Q.infoWindow._setPagerCallbacks(this.attributeInspector,A.hitch(this.attributeInspector,"previous"),A.hitch(this.attributeInspector,"next"));this._connect(this.attributeInspector,"onAttributeChange",A.hitch(this,function(W,aa,R){if(this._settings.createOnlyLayer[this._layer.id]||this._settings.invalidTemplate)this._saveAttributesOnClient(W,aa,R);else{var V=W.getLayer();(V=B.filter(V.fields,function(ba){return ba.name===
aa})[0])&&""===R&&(R=null);this._rollbackGraphic=new e(A.clone(W.toJson()));this.attributeInspector._rollbackInfo={field:V,graphic:this._rollbackGraphic};this._currentGraphic.attributes[aa]="number"===typeof R&&isNaN(R)?null:R;this._currentGraphic.setAttributes(this._currentGraphic.attributes);this._updateFeature(this._currentGraphic,null,!0);this._attributeChanged=!1}}))},_createDrawingToolbar:function(){!0===this._settings.toolbarVisible&&(this.drawingToolbar=new K({"class":"esriDrawingToolbar",
drawToolbar:this._drawToolbar,editToolbar:this.editToolbar,settings:this._settings,onDelete:A.hitch(this,"_deleteFeature"),onApplyEdits:A.hitch(this,"_applyEdits"),onShowAttributeInspector:A.hitch(this,"_onEditFeature")},this.drawingToolbarDiv))},_createUndoRedoManager:function(){if(this._settings.enableUndoRedo||this._settings.undoManager)this._settings.enableUndoRedo=!0,this.undoManager=this._settings.undoManager,this.undoManager||(this.undoManager=this._settings.undoManager=new r({maxOperations:this._settings.maxUndoRedoOperations})),
this._connect(this.undoManager,"onUndoComplete",A.hitch(this,this._updateUndoRedoOperations)),this._connect(this.undoManager,"onRedoComplete",A.hitch(this,this._updateUndoRedoOperations)),this._connect(document,"onkeypress",A.hitch(this,function(Q){if(Q.metaKey||Q.ctrlKey)"z"===Q.charOrCode&&this._undo(),"y"===Q.charOrCode&&this._redo()}))},_updateUndoRedoOperations:function(Q){if(Q&&Q.addedIds){var W;for(W=0;W<this.undoManager.length;W++){var aa=this.undoManager.get(W);aa&&Q.layer===aa._featureLayer&&
aa.updateObjectIds(Q.oldIds,Q.addedIds)}}Q&&"Update Features"===Q.operation.label&&this.attributeInspector.refresh()},_enableMapClickHandler:function(){this._mapClickHandler=v.connect(this._settings.map,"onClick",A.hitch(this,function(Q){this._drawToolbar._geometryType||("SELECT"===this._activeTool?this._activeTool="":this._updateCurrentFeature(A.hitch(this,function(){this._reset();this._updateSelection(Q)})))}))},_disableMapClickHandler:function(){v.disconnect(this._mapClickHandler)},_onCreateFeature:function(){var Q=
this.templatePicker.getSelected();Q?this._updateCurrentFeature(A.hitch(this,function(){this._currentGraphic&&this._clearSelection(!1);this._reset();this._activateDrawToolbar(Q)})):(this._reset(),v.disconnect(this._dtConnect),this._drawToolbar.deactivate(),this._enableMapClickHandler(),this.drawingToolbar&&this.drawingToolbar.deactivate())},_isTextSymbolPoint:function(Q){if("point"===Q.geometry.type||"multipoint"===Q.geometry.type){var W=Q.getLayer(),aa=W.renderer;Q=Q.symbol||W._getSymbol(Q);!Q&&(aa.hasVisualVariables("sizeInfo",
!1)||aa.hasVisualVariables("colorInfo",!1)||aa.hasVisualVariables("opacityInfo",!1))&&aa.addBreak&&aa.infos&&1===aa.infos.length&&(Q=aa.infos[0].symbol||aa.defaultSymbol);if(Q&&"textsymbol"===Q.type)return!0}return!1},_isTextSymbolPointLayer:function(Q){return"esriGeometryPoint"===Q.geometryType&&Q.renderer&&Q.renderer._symbols&&Q.renderer._symbols[0]&&Q.renderer._symbols[0].symbol&&"textsymbol"===Q.renderer._symbols[0].symbol.type?!0:!1},_updateAttributeDisabled:function(Q){Q=Q.getLayer();if(!Q)return!1;
var W,aa=!1;for(W=0;W<this._settings.layerInfos.length;W++){var R=this._settings.layerInfos[W];if(R.featureLayer==Q){aa=R.disableAttributeUpdate;break}}return aa},_onEditFeature:function(Q,W){if(Q=(A.isArray(Q)?Q[0]:Q)||null){this._layer=Q.getLayer();if(!this._customAttributeInspector&&!this._updateAttributeDisabled(Q)){W=W||this._editClickPoint||this._findCenterPoint(Q);if(1<this._currentFeatureCount){var aa=this._popupFeatures.indexOf(Q);aa=b.substitute(S.widgets.popup.NLS_pagingInfo,{index:aa+
1,total:this._currentFeatureCount})}else aa=this._layer?this._layer.name:S.widgets.attributeInspector.NLS_title;this._settings.map.infoWindow.setTitle(aa);if(this.drawingToolbar||!this._settings.map.infoWindow.isShowing)this.attributeInspector.refresh(),this._showInfoWindow(W,this._settings.map.getInfoWindowAnchor(W));this._editClickPoint=null}Q!==this._currentGraphic&&(this._editVertices=!0,this._currentGraphic=Q,Q.getDojoShape()&&Q.getDojoShape().moveToFront(),W=this._layer.hasM,this._layer.hasZ&&
!this._layer.enableZDefaults||W&&!this._layer.allowUpdateWithoutMValues||this._activateEditToolbar(Q))}},_applyEdits:function(Q,W){Q=Q||[];if(!(0>=Q.length)){this._edits=this._oEdits=Q;var aa=[];B.forEach(Q,function(R){R.layer&&aa.push(R.layer.applyEdits(R.adds,R.updates,R.deletes))});0<aa.length&&(this._deferredsList=(new d(aa)).addCallback(A.hitch(this,function(){m.hide(this.progressBar.domNode);W&&W();var R=this._settings.map;R&&R.infoWindow.reposition&&R.infoWindow.isShowing&&R.infoWindow.reposition()})))}},
_undo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.undo())},_redo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.redo())},_simplify:function(Q,W){f.prototype.isSelfIntersecting(Q)?this._settings.geometryService.simplify([Q],function(aa){var R=aa&&aa.length?aa[0]:R;W&&W(R)}):W&&W(Q)},_autoComplete:function(Q,
W){var aa=this._getLayers("esriGeometryPolygon"),R=new w;R.geometry=Q;R.returnGeometry=!0;this._selectFeatures(aa,R,A.hitch(this,function(V){!V||0>=V.length?W&&W([Q]):this._settings.geometryService.autoComplete(g.getGeometries(V),this._toPolylines([R.geometry]),function(ba){W&&W(ba)})}))},_getLayers:function(Q){return B.filter(this._settings.layers,function(W){return W.geometryType===Q})},_selectFeatures:function(Q,W,aa,R){this._selectionHelper.selectFeatures(Q,W,R||H.SELECTION_NEW,aa)},_updateSelection:function(Q){var W=
Q.mapPoint,aa=Q.graphic,R=this._settings.layerInfos,V;this._selectionHelper.selectFeaturesByGeometry(this._settings.layers,W,H.SELECTION_NEW,A.hitch(this,function(ba){var ha=B.some(ba,A.hitch(this,function(va){return va==aa}));if(aa&&!ha)if(ha=aa.getLayer(),this._isValidLayer(ha)){var qa=new w;qa.objectIds=[aa.attributes[ha.objectIdField]];this._selectionHelper.selectFeatures([ha],qa,H.SELECTION_ADD,A.hitch(this,function(va){va&&va.length&&(va=va.concat(ba),V=u.sortFeaturesById(R,va),this._updatePopupButtons(V),
this._onEditFeature(V,W))}))}else ba&&ba.length?(V=u.sortFeaturesById(R,ba),this._updatePopupButtons(V),this._onEditFeature(V,W)):this._clearSelection();else ba&&ba.length?(V=u.sortFeaturesById(R,ba),this._updatePopupButtons(V),this._onEditFeature(V,W)):this._clearSelection()}));aa&&this._isTextSymbolPoint(aa)&&this._isValidLayer(aa.getLayer())&&this.editToolbar.activate(0|C.MOVE|C.ROTATE|C.SCALE|C.EDIT_TEXT,aa)},_updatePopupButtons:function(Q){if(this._usePopup&&Q){var W=Q.length;B.forEach([this._settings.map.infoWindow._prevFeatureButton,
this._settings.map.infoWindow._nextFeatureButton],A.hitch(this,function(R){1<W?k.remove(R,"hidden"):k.add(R,"hidden")}));var aa=1<W?"block":"none";t.query(".esriAttributeInspector .atiLayerName").style({display:aa});this._currentFeatureCount=W;this._popupFeatures=Q}else this._currentFeatureCount=this._popupFeatures=null},_clearSelection:function(Q){this._currentFeatureCount=0;this._popupFeatures=null;this._selectionHelper.clearSelection(Q||!1);this._reset()},_findCenterPoint:function(Q){Q=Q.geometry||
Q;switch(Q.type){case "point":var W=Q;break;case "polyline":W=Q.getPoint(0,Math.ceil(Q.paths[0].length/2));break;case "polygon":W=Q.rings.length-1,W=Q.getPoint(W,Q.rings[W].length-1)}return this._settings.map.toScreen(W)},_hideAttributeInspector:function(){!this._customAttributeInspector&&this._settings.map.infoWindow&&this._settings.map.infoWindow.hide()},_toPolylines:function(Q){return B.map(Q,function(W){var aa=new a(W.spatialReference);B.forEach(W.rings,function(R){aa.addPath(R)});return aa})},
_isNotesFeature:function(Q){var W=Q.getLayer(),aa=W?W.types||null:null;if(!aa)return!1;var R=Q.attributes[W.typeIdField],V;B.some(aa,function(ba){return ba.id===R?(V=ba.templates,!0):!1});return V?(Q=V[0]||null)?this._isShapeTool(Q.drawingTool)?!0:!1:!1:!1},_isValidLayer:function(Q){var W,aa=this._settings.layerInfos;for(W=0;W<aa.length;W++){var R=aa[W];if(Q.id==(R.featureLayer?R.featureLayer.id:R.layerId))return!0}return!1},_isShapeTool:function(Q){switch(Q){case x.TOOL_ARROW:return q.ARROW;case x.TOOL_LEFT_ARROW:return q.LEFT_ARROW;
case x.TOOL_RIGHT_ARROW:return q.RIGHT_ARROW;case x.TOOL_UP_ARROW:return q.UP_ARROW;case x.TOOL_DOWN_ARROW:return q.DOWN_ARROW;case x.TOOL_CIRCLE:return q.CIRCLE;case x.TOOL_ELLIPSE:return q.ELLIPSE;case x.TOOL_TRIANGLE:return q.TRIANGLE;case x.TOOL_RECTANGLE:return q.RECTANGLE;default:return null}},_toDrawTool:function(Q,W){W=W.geometryType;switch(Q){case x.TOOL_POINT:return q.POINT;case x.TOOL_ARROW:return q.ARROW;case x.TOOL_LEFT_ARROW:return q.LEFT_ARROW;case x.TOOL_RIGHT_ARROW:return q.RIGHT_ARROW;
case x.TOOL_UP_ARROW:return q.UP_ARROW;case x.TOOL_DOWN_ARROW:return q.DOWN_ARROW;case x.TOOL_CIRCLE:return q.CIRCLE;case x.TOOL_ELLIPSE:return q.ELLIPSE;case x.TOOL_TRIANGLE:return q.TRIANGLE;case x.TOOL_RECTANGLE:return q.RECTANGLE;case x.TOOL_LINE:return q.POLYLINE;case x.TOOL_POLYGON:return q.POLYGON;case x.TOOL_FREEHAND:return"esriGeometryPolyline"===W?q.FREEHAND_POLYLINE:q.FREEHAND_POLYGON;default:return Q=q.POINT,"esriGeometryPolyline"===W?(Q=q.POLYLINE,this._settings.createOptions.polylineDrawTools[0]===
da.CREATE_TOOL_FREEHAND_POLYLINE&&(Q=q.FREEHAND_POLYLINE)):"esriGeometryPolygon"===W&&(Q=q.POLYGON,this._settings.createOptions.polygonDrawTools[0]===da.CREATE_TOOL_FREEHAND_POLYGON&&(Q=q.FREEHAND_POLYGON)),Q}},_isModified:function(){var Q=this.editToolbar.getCurrentState();return(Q.isModified||this._attributeChanged)&&Q.graphic?Q.graphic:null},_showInfoWindow:function(Q,W){this._customAttributeInspector||this._settings.map.infoWindow.show(Q,W)}});A.mixin(da,{CREATE_TOOL_POLYLINE:"polyline",CREATE_TOOL_FREEHAND_POLYLINE:"freehandpolyline",
CREATE_TOOL_POLYGON:"polygon",CREATE_TOOL_FREEHAND_POLYGON:"freehandpolygon",CREATE_TOOL_AUTOCOMPLETE:"autocomplete",CREATE_TOOL_RECTANGLE:"rectangle",CREATE_TOOL_TRIANGLE:"triangle",CREATE_TOOL_CIRCLE:"circle",CREATE_TOOL_ELLIPSE:"ellipse",CREATE_TOOL_ARROW:"arrow",CREATE_TOOL_UP_ARROW:"uparrow",CREATE_TOOL_DOWN_ARROW:"downarrow",CREATE_TOOL_RIGHT_ARROW:"rightarrow",CREATE_TOOL_LEFT_ARROW:"leftarrow"});l("extend-esri")&&A.setObject("dijit.editing.Editor",da,P);return da})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented dojo/has!extend-esri?./OperationBase".split(" "),
function(G,A,B,v,t,l){G=G([l],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(p){p=p||{};p.maxOperations&&(this.maxOperations=p.maxOperations);this._historyStack=[]},add:function(p){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,
0,p);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var p=this.peekUndo();this.position--;p?(p=p.performUndo(),this.onUndo(),this._checkAvailability(),v(p).then(A.hitch(this,this.onUndoComplete))):(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var p=this.peekRedo();this.position++;p?(p=p.performRedo(),this.onRedo(),this._checkAvailability(),v(p).then(A.hitch(this,
this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,
this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},get:function(p){return this._historyStack[p]},remove:function(p){0<this._historyStack.length&&(this._historyStack.splice(p,1),0<this.position&&p<this.position&&this.position--,
this._checkAvailability())},destroy:function(){this._historyStack=null}});B("extend-esri")&&(t.UndoManager=G);return G})},"esri/dijit/editing/Add":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(G,A,B,v,t,l){A=A(l,{declaredClass:"esri.dijit.editing.Add",type:"edit",label:"Add Features",constructor:function(p){p=p||{};p.featureLayer?(this._featureLayer=p.featureLayer,p.addedGraphics?this._addedGraphics=p.addedGraphics:
console.error("In constructor of 'esri.dijit.editing.Add', no graphics provided")):console.error("In constructor of 'esri.dijit.editing.Add', featureLayer is not provided")},updateObjectIds:function(p,d){this.updateIds(this._featureLayer,this._addedGraphics,p,d)},performUndo:function(){return this._featureLayer.applyEdits(null,null,this._addedGraphics).then(B.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var p=G.map(this._addedGraphics,function(d){return d.attributes[this._featureLayer.objectIdField]},
this);return this._featureLayer.applyEdits(this._addedGraphics,null,null).then(B.hitch(this,function(d,k,c){d=G.map(d,function(b){return b.objectId});return{oldIds:p,addedIds:d,layer:this._featureLayer,operation:this}}))}});v("extend-esri")&&B.setObject("dijit.editing.Add",A,t);return A})},"esri/dijit/editing/EditOperationBase":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/has","../../kernel","../../OperationBase"],function(G,A,B,v,t){A=A(t,{declaredClass:"esri.EditOperationBase",
updateIds:function(l,p,d,k){G.forEach(p,function(c,b){var h=c[l.objectIdField];G.forEach(d,function(n,m){h===n&&(c[l.objectIdField]=k[m])})})}});B("extend-esri")&&(v.EditOperationBase=A);return A})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(G,A,B){G=G(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(v){v=v||{};v.label&&(this.label=v.label)},performUndo:function(){console.log("performUndo has not been implemented")},
performRedo:function(){console.log("performRedo has not been implemented")}});A("extend-esri")&&(B.OperationBase=G);return G})},"esri/dijit/editing/Update":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(G,A,B,v,t,l,p){G=A(p,{declaredClass:"esri.dijit.editing.Update",type:"edit",label:"Update Features",constructor:function(d){var k;d=d||{};if(d.featureLayer)if(this._featureLayer=d.featureLayer,
d.preUpdatedGraphics){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(k=0;k<d.preUpdatedGraphics.length;k++)this._preUpdatedGraphicsGeometries.push(d.preUpdatedGraphics[k].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(d.preUpdatedGraphics[k].attributes);if(d.postUpdatedGraphics)for(this._postUpdatedGraphics=d.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],k=0;k<d.postUpdatedGraphics.length;k++)d.postUpdatedGraphics[k].geometry?
this._postUpdatedGraphicsGeometries.push(d.postUpdatedGraphics[k].geometry.toJson()):this._postUpdatedGraphicsGeometries.push(d.postUpdatedGraphics[k].geometry),this._postUpdatedGraphicsAttributes.push(B.clone(d.postUpdatedGraphics[k].attributes));else console.error("In constructor of 'esri.dijit.editing.Update', postUpdatedGraphics not provided")}else console.error("In constructor of 'esri.dijit.editing.Update', preUpdatedGraphics not provided");else console.error("In constructor of 'esri.dijit.editing.Update', featureLayer not provided")},
updateObjectIds:function(d,k){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,d,k);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,d,k)},performUndo:function(){var d;for(d=0;d<this._postUpdatedGraphics.length;d++)this._preUpdatedGraphicsGeometries[d]?this._postUpdatedGraphics[d].setGeometry(l.fromJson(this._preUpdatedGraphicsGeometries[d])):this._postUpdatedGraphics[d].setGeometry(this._preUpdatedGraphicsGeometries[d]),this._postUpdatedGraphics[d].setAttributes(this._preUpdatedGraphicsAttributes[d]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(B.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var d;for(d=0;d<this._postUpdatedGraphics.length;d++)this._postUpdatedGraphicsGeometries[d]?this._postUpdatedGraphics[d].setGeometry(l.fromJson(this._postUpdatedGraphicsGeometries[d])):this._postUpdatedGraphics[d].setGeometry(this._postUpdatedGraphicsGeometries[d]),this._postUpdatedGraphics[d].setAttributes(this._postUpdatedGraphicsAttributes[d]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(B.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});v("extend-esri")&&B.setObject("dijit.editing.Update",G,t);return G})},"esri/dijit/editing/Delete":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(G,A,B,v,t,l){A=A(l,{declaredClass:"esri.dijit.editing.Delete",type:"edit",label:"Delete Features",constructor:function(p){p=
p||{};p.featureLayer?(this._featureLayer=p.featureLayer,p.deletedGraphics?this._deletedGraphics=p.deletedGraphics:console.error("In constructor of 'esri.dijit.editing.Delete', no graphics provided")):console.error("In constructor of 'esri.dijit.editing.Delete', featureLayer is not provided")},updateObjectIds:function(p,d){this.updateIds(this._featureLayer,this._deletedGraphics,p,d)},performUndo:function(){var p=G.map(this._deletedGraphics,function(d){return d.attributes[this._featureLayer.objectIdField]},
this);return this._featureLayer.applyEdits(this._deletedGraphics,null,null).then(B.hitch(this,function(d,k,c){d=G.map(d,function(b){return b.objectId});return{oldIds:p,addedIds:d,layer:this._featureLayer,operation:this}}))},performRedo:function(){return this._featureLayer.applyEdits(null,null,this._deletedGraphics).then(B.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});v("extend-esri")&&B.setObject("dijit.editing.Delete",A,t);return A})},"esri/dijit/editing/Cut":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(G,A,B,v,t,l,p){A=A(p,{declaredClass:"esri.dijit.editing.Cut",type:"edit",label:"Cut Features",constructor:function(d){var k;d=d||{};if(d.featureLayer)if(this._featureLayer=d.featureLayer,d.addedGraphics)if(this._addedGraphics=d.addedGraphics,d.preUpdatedGraphics){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(k=0;k<d.preUpdatedGraphics.length;k++)this._preUpdatedGraphicsGeometries.push(d.preUpdatedGraphics[k].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(d.preUpdatedGraphics[k].attributes);
if(d.postUpdatedGraphics)for(this._postUpdatedGraphics=d.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],k=0;k<d.postUpdatedGraphics.length;k++)this._postUpdatedGraphicsGeometries.push(d.postUpdatedGraphics[k].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(B.clone(d.postUpdatedGraphics[k].attributes));else console.error("In constructor of 'esri.dijit.editing.Cut', postUpdatedGraphics not provided")}else console.error("In constructor of 'esri.dijit.editing.Cut', preUpdatedGraphics not provided");
else console.error("In constructor of 'esri.dijit.editing.Cut', addedGraphics for cut not provided");else console.error("In constructor of 'esri.dijit.editing.Cut', featureLayer not provided")},updateObjectIds:function(d,k){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,d,k);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,d,k);this.updateIds(this._featureLayer,this._addedGraphics,d,k)},performUndo:function(){var d;for(d=0;d<this._postUpdatedGraphics.length;d++)this._postUpdatedGraphics[d].setGeometry(l.fromJson(this._preUpdatedGraphicsGeometries[d])),
this._postUpdatedGraphics[d].setAttributes(this._preUpdatedGraphicsAttributes[d]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._addedGraphics).then(B.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var d;for(d=0;d<this._postUpdatedGraphics.length;d++)this._postUpdatedGraphics[d].setGeometry(l.fromJson(this._postUpdatedGraphicsGeometries[d])),this._postUpdatedGraphics[d].setAttributes(this._postUpdatedGraphicsAttributes[d]);
var k=G.map(this._addedGraphics,function(c){return c.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,this._postUpdatedGraphics,null).then(B.hitch(this,function(c,b,h){c=G.map(c,function(n){return n.objectId});return{oldIds:k,addedIds:c,layer:this._featureLayer,operation:this}}))}});v("extend-esri")&&B.setObject("dijit.editing.Cut",A,t);return A})},"esri/dijit/editing/Union":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(G,A,B,v,t,l,p){A=A(p,{declaredClass:"esri.dijit.editing.Union",type:"edit",label:"Union Features",constructor:function(d){d=d||{};this._featureLayer=d.featureLayer;this._deletedGraphics=d.deletedGraphics;this._preUpdatedGraphics=d.preUpdatedGraphics;this._postUpdatedGraphics=d.postUpdatedGraphics;this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];this._postUpdatedGraphicsGeometries=[];this._postUpdatedGraphicsAttributes=[];var k;for(k=0;k<d.preUpdatedGraphics.length;k++)this._preUpdatedGraphicsGeometries.push(d.preUpdatedGraphics[k].geometry.toJson()),
this._preUpdatedGraphicsAttributes.push(d.preUpdatedGraphics[k].attributes);for(k=0;k<d.postUpdatedGraphics.length;k++)this._postUpdatedGraphicsGeometries.push(d.postUpdatedGraphics[k].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(B.clone(d.postUpdatedGraphics[k].attributes))},updateObjectIds:function(d,k){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,d,k);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,d,k);this.updateIds(this._featureLayer,
this._deletedGraphics,d,k)},performUndo:function(){var d;for(d=0;d<this._postUpdatedGraphics.length;d++)this._postUpdatedGraphics[d].setGeometry(l.fromJson(this._preUpdatedGraphicsGeometries[d])),this._postUpdatedGraphics[d].setAttributes(this._preUpdatedGraphicsAttributes[d]);var k=G.map(this._deletedGraphics,function(c){return c.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,this._postUpdatedGraphics,null).then(B.hitch(this,function(c,
b,h){c=G.map(c,function(n){return n.objectId});return{oldIds:k,addedIds:c,layer:this._featureLayer,operation:this}}))},performRedo:function(){var d;for(d=0;d<this._postUpdatedGraphics.length;d++)this._postUpdatedGraphics[d].setGeometry(l.fromJson(this._postUpdatedGraphicsGeometries[d])),this._postUpdatedGraphics[d].setAttributes(this._postUpdatedGraphicsAttributes[d]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._deletedGraphics).then(B.hitch(this,function(){return{layer:this._featureLayer,
operation:this}}))}});v("extend-esri")&&B.setObject("dijit.editing.Union",A,t);return A})},"esri/dijit/editing/toolbars/Drawing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/_CssStateMixin ../Util ./ToolbarBase ../tools/ButtonToolBase ../tools/Cut ../tools/Union ../tools/Reshape ../tools/Editing ../tools/EditingTools ../tools/Selection ../tools/SelectionTools ../../../kernel".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f){G=G([d,
l],{declaredClass:"esri.dijit.editing.toolbars.Drawing",onShowAttributeInspector:function(){},_activateTool:function(e,r){this._settings.editor._activeTool=e;"EDITING"!==e&&this._settings.templatePicker.clearSelection();"ATTRIBUTES"!==e&&this._settings.editor._hideAttributeInspector();"CLEAR"!==e&&this.inherited(arguments)},_initializeToolbar:function(){B.forEach(this._settings.layers,function(e){this._tbConnects.push(v.connect(e,"onSelectionComplete",this,"_updateUI"))},this)},activateEditing:function(e,
r){this._tools.EDITING._activateTool(e,r.geometryType);this._activeTool=this._tools.EDITING;this._activeTool.setChecked(!0)},_updateUI:function(){this._settings.undoManager&&(this._tools.UNDO.set("disabled",!1===this._settings.undoManager.canUndo),this._tools.REDO.set("disabled",!1===this._settings.undoManager.canRedo));this._selectedFeatures=p.getSelection(this._settings.layers);var e=this._selectedFeatures.length;this._tools.DELETE&&this._tools.DELETE.set("disabled",0>=e);this._tools.CLEAR&&this._tools.CLEAR.set("disabled",
0>=e);this._tools.ATTRIBUTES&&this._tools.ATTRIBUTES.set("disabled",0>=e);this._tools.UNION&&this._tools.UNION.set("disabled",2>e)},_toolFinished:function(e){if("ATTRIBUTES"===e&&this._selectedFeatures&&this._selectedFeatures.length)this.onShowAttributeInspector(this._selectedFeatures[0]);if("SELECT"===e||"CUT"===e||"RESHAPING"===e||"EDITING"===e)this._activeTool.deactivate(),this._activeTool.setChecked(!1),this._activeTool=null;if("DELETE"===e)this.onDelete();this._settings.editor._activeTool=null;
this._updateUI()},_createTools:function(){this._tools.SELECT=new g({settings:this._settings,onClick:A.hitch(this,"_activateTool","SELECT",!0),onFinished:A.hitch(this,"_toolFinished","SELECT")});this.addChild(this._tools.SELECT);this._tools.CLEAR=new k(A.mixin(a.selectClear,{settings:this._settings,onClick:A.hitch(this._settings.editor,"_clearSelection",!1)}));this.addChild(this._tools.CLEAR);this._createSeparator();this._tools.ATTRIBUTES=new k(A.mixin(m.attributes,{settings:this._settings,onClick:A.hitch(this,
"_toolFinished","ATTRIBUTES")}));this.addChild(this._tools.ATTRIBUTES);this._createSeparator();this._tools.EDITING=new n({settings:this._settings,onClick:A.hitch(this,"_activateTool","EDITING",!0),onApplyEdits:A.hitch(this,"onApplyEdits"),onFinished:A.hitch(this,"_toolFinished","EDITING")});this.addChild(this._tools.EDITING);this._tools.DELETE=new k(A.mixin(m.del,{settings:this._settings,onClick:A.hitch(this,"_toolFinished","DELETE")}));this.addChild(this._tools.DELETE);this._settings.toolbarOptions&&
((this._settings.toolbarOptions.cutVisible||this._settings.toolbarOptions.mergeVisible||this._settings.toolbarOptions.reshapeVisible)&&this._createSeparator(),this._settings.toolbarOptions.cutVisible&&(this._tools.CUT=new c({settings:this._settings,onFinished:A.hitch(this,"_toolFinished","CUT"),onClick:A.hitch(this,"_activateTool","CUT",!0),onApplyEdits:A.hitch(this,"onApplyEdits")}),this.addChild(this._tools.CUT)),this._settings.toolbarOptions.mergeVisible&&(this._tools.UNION=new b({settings:this._settings,
onFinished:A.hitch(this,"_toolFinished","UNION"),onApplyEdits:A.hitch(this,"onApplyEdits")}),this.addChild(this._tools.UNION)),this._settings.toolbarOptions.reshapeVisible&&(this._tools.RESHAPING=new h({settings:this._settings,onClick:A.hitch(this,"_activateTool","RESHAPING",!0),onFinished:A.hitch(this,"_toolFinished","RESHAPING"),onApplyEdits:A.hitch(this,"onApplyEdits")}),this.addChild(this._tools.RESHAPING)));this._settings.enableUndoRedo&&(this._createSeparator(),this._tools.UNDO=new k(A.mixin(m.undo,
{settings:this._settings,disabled:!0,onClick:A.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._undo()})})),this.addChild(this._tools.UNDO),this._tools.REDO=new k(A.mixin(m.redo,{settings:this._settings,disabled:!0,onClick:A.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._redo()})})),this.addChild(this._tools.REDO))}});t("extend-esri")&&A.setObject("dijit.editing.toolbars.Drawing",
G,f);return G})},"esri/dijit/editing/toolbars/ToolbarBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/Toolbar dijit/ToolbarSeparator ../../../kernel ../../../lang".split(" "),function(G,A,B,v,t,l,p,d,k){G=G([l],{declaredClass:"esri.dijit.editing.toolbars.ToolbarBase",_enabled:!0,graphicsAdded:function(){},drawEnd:function(){},onApplyEdits:function(){},onDelete:function(){},constructor:function(c,b){c&&c.settings&&(this._tools=[],this._tbConnects=
[],this._initialize(c.settings))},postCreate:function(){this._createTools();this.deactivate()},destroy:function(){var c,b=this._tools;for(c in b)b.hasOwnProperty(c)&&k.isDefined(this._tools[c])&&this._tools[c].destroy();B.forEach(this._tbConnects,v.disconnect);this.inherited(arguments)},activate:function(c){this._enabled=!0},deactivate:function(){var c;this._enabled=!1;this._geometryType=this._layer=null;var b=this._tools;for(c in b)b.hasOwnProperty(c)&&(this._tools[c].deactivate(),this._tools[c].setChecked(!1))},
isEnabled:function(){return this._enabled},setActiveSymbol:function(c){this._activeSymbol=c},_getSymbol:function(){},_createTools:function(){},_initialize:function(c){this._settings=c;this._toolbar=c.drawToolbar;this._editToolbar=c.editToolbar;this._initializeToolbar()},_activateTool:function(c,b){this._activeTool&&this._activeTool.deactivate();!0===b&&this._activeTool==this._tools[c]?(this._activeTool.setChecked(!1),this._activeTool=null):(this._activeTool=this._tools[c],this._activeTool.setChecked(!0),
this._activeTool.activate(null))},_createSeparator:function(){this.addChild(new p)}});t("extend-esri")&&A.setObject("dijit.editing.toolbars.ToolbarBase",G,d);return G})},"esri/dijit/editing/tools/ButtonToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/Button ./ToolBase ../../../kernel".split(" "),function(G,A,B,v,t,l){G=G([v,t],{declaredClass:"esri.dijit.editing.tools.ButtonToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},
destroy:function(){v.prototype.destroy.apply(this,arguments);t.prototype.destroy.apply(this,arguments)}});B("extend-esri")&&A.setObject("dijit.editing.tools.ButtonToolBase",G,l);return G})},"esri/dijit/editing/tools/ToolBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../../kernel","dojo/i18n!../../../nls/jsapi"],function(G,A,B,v,t){G=G(null,{declaredClass:"esri.dijit.editing.tools.ToolBase",_enabled:!0,showLabel:!1,constructor:function(l,p){l=l||{};A.mixin(this,l);this.label=
this._label?t.widgets.editor.tools[this._label]:"";this._settings=l.settings;this._toolbar=l.settings.drawToolbar;this._editToolbar=l.settings.editToolbar;this._initializeTool()},onFinished:function(){},onDrawEnd:function(){},onApplyEdits:function(){},postCreate:function(){this.deactivate();this.inherited(arguments)},destroy:function(){},activate:function(l){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this._enabled&&(this._checked=!0,this._layer=l,this._toolbar&&
this._drawType&&this._toolbar.activate(this._drawType))},deactivate:function(){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this.setChecked(!1);this._updateUI()},setEnabled:function(l){this._enabled=l;this._updateUI()},setChecked:function(l){this._checked=l},enable:function(l){this._updateUI()},isEnabled:function(){return this._enabled},getToolName:function(){return this._toolName},_initializeTool:function(){},_updateUI:function(){this.disabled=!this._enabled;
this.attr("iconClass",this._enabled?this._enabledIcon:this._disabledIcon)}});B("extend-esri")&&A.setObject("dijit.editing.tools.ToolBase",G,v);return G})},"esri/dijit/editing/tools/Cut":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/DeferredList ../../../graphicsUtils ../../../graphic ../../../tasks/query ../../../layers/FeatureLayer ../../../toolbars/draw ../Cut ./ToggleToolBase ../../../kernel".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,
n,m){G=G([n],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:b.POLYLINE,_enabled:!0,_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(v.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);B.forEach(this._cutConnects,v.disconnect);this._cutConnects=[];this._edits=[]},_onDrawEnd:function(g){var a=this._cutLayers=
B.filter(this._settings.layers,function(e){return"esriGeometryPolygon"===e.geometryType||"esriGeometryPolyline"===e.geometryType&&e.visible&&e._isMapAtVisibleScale()});this._cutConnects=this._cutConnects.concat(B.map(a,A.hitch(this,function(e){return v.connect(e,"onEditsComplete",A.hitch(this,function(r,w,H){if(this._settings.undoRedoManager){var x=this._settings.undoRedoManager;B.forEach(this._edits,A.hitch(this,function(q){x.add(new h({featureLayer:q.layer,addedGraphics:q.adds,preUpdatedGraphics:q.preUpdates,
postUpdatedGraphics:q.updates}))}),this)}this.onFinished()}))})));var f=new k;f.geometry=g;B.forEach(a,function(e,r){this._settings.editor._selectionHelper.selectFeatures([e],f,c.SELECTION_NEW,A.hitch(this,"_cutFeatures",e,f))},this)},_cutFeatures:function(g,a,f){if(f&&f.length){this._edits=[];var e=[];e.push(this._settings.geometryService.cut(p.getGeometries(f),a.geometry,A.hitch(this,"_cutHandler",g,f)));(new l(e)).addCallback(A.hitch(this,function(){this.onApplyEdits(this._edits)}))}},_cutHandler:function(g,
a,f){var e=[],r=[],w=B.map(a,function(q){return new d(A.clone(q.toJson()))}),H,x;B.forEach(f.cutIndexes,function(q,C){H!=q?(H=q,r.push(a[q].setGeometry(f.geometries[C]))):(x=new d(f.geometries[C],null,A.mixin({},a[q].attributes),null),x.attributes[a[0].getLayer().objectIdField]=null,e.push(x))},this);this._edits.push({layer:g,adds:e,updates:r,preUpdates:w})}});t("extend-esri")&&A.setObject("dijit.editing.tools.Cut",G,m);return G})},"esri/dijit/editing/tools/ToggleToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/ToggleButton ./ToolBase ../../../kernel".split(" "),
function(G,A,B,v,t,l){G=G([v,t],{declaredClass:"esri.dijit.editing.tools.ToggleToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){v.prototype.destroy.apply(this,arguments);t.prototype.destroy.apply(this,arguments)},setChecked:function(p){v.prototype.setChecked.apply(this,arguments)}});B("extend-esri")&&A.setObject("dijit.editing.tools.ToggleToolBase",G,l);return G})},"esri/dijit/editing/tools/Union":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../graphicsUtils ../../../graphic ../../../toolbars/draw ../Union ./ButtonToolBase ../../../kernel".split(" "),
function(G,A,B,v,t,l,p,d,k,c){G=G([k],{declaredClass:"esri.dijit.editing.tools.Union",id:"btnFeatureUnion",_enabledIcon:"toolbarIcon unionIcon",_disabledIcon:"toolbarIcon unionIcon",_drawType:p.POLYLINE,_enabled:!0,_label:"NLS_unionLbl",_onClick:function(b){this._settings.editor._activeTool="UNION";b=B.filter(this._settings.layers,function(m){return"esriGeometryPolygon"===m.geometryType&&m.visible&&m._isMapAtVisibleScale()});var h=[],n=0;B.forEach(b,function(m,g){var a=m.getSelectedFeatures();2<=
a.length&&(n++,this._settings.geometryService.union(t.getGeometries(a),A.hitch(this,function(f){var e=a.shift(),r=[],w=[];r.push(new l(e.toJson()));w.push(e.setGeometry(f));h.push({layer:m,updates:w,deletes:a,preUpdates:r});n--;if(0>=n)this.onApplyEdits(h,A.hitch(this,function(){if(this._settings.undoRedoManager){var H=this._settings.undoRedoManager;B.forEach(this._edits,A.hitch(this,function(x){H.add(new d({featureLayer:x.layer,deletedGraphics:x.deletes,preUpdatedGraphics:x.preUpdates,postUpdatedGraphics:x.updates}))}),
this)}this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()}))})))},this)}});v("extend-esri")&&A.setObject("dijit.editing.tools.Union",G,c);return G})},"esri/dijit/editing/tools/Reshape":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has ../../../graphic ../../../layers/FeatureLayer ../../../tasks/query ../../../toolbars/draw ./ToggleToolBase ../../../kernel".split(" "),function(G,A,B,v,t,l,p,d,k,c,b){G=G([c],{declaredClass:"esri.dijit.editing.tools.Reshape",
id:"btnFeatureReshape",_enabledIcon:"toolbarIcon reshapeIcon",_disabledIcon:"toolbarIcon reshapeIcon",_drawType:k.POLYLINE,_enabled:!0,_label:"NLS_reshapeLbl",activate:function(){v.disconnect(this._rConnect);this._rConnect=v.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd");this.inherited(arguments)},deactivate:function(){this.inherited(arguments);v.disconnect(this._rConnect);delete this._rConnect},_onDrawEnd:function(h){var n=this._settings.layers,m=new d;m.geometry=h;h=this._reshapeLayers=B.filter(n,
function(g){return"esriGeometryPolygon"===g.geometryType||"esriGeometryPolyline"});this._settings.editor._selectionHelper.selectFeatures(h,m,p.SELECTION_NEW,A.hitch(this,"_reshape",m))},_reshape:function(h,n){if(1===n.length){var m=[],g=[],a=[],f=n[0],e=f.getLayer();this._settings.geometryService.reshape(f.geometry,h.geometry,A.hitch(this,function(r){"polyline"===r.type&&r.paths&&0===r.paths.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):"polygon"===r.type&&r.rings&&
0===r.rings.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):(a.push(new l(f.toJson())),g.push(f.setGeometry(r)),m.push({layer:e,updates:g,preUpdates:a}),this.onApplyEdits(m,A.hitch(this,function(){this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()})))}))}}});t("extend-esri")&&A.setObject("dijit.editing.tools.Reshape",G,b);return G})},"esri/dijit/editing/tools/Editing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../layers/FeatureTemplate ./Edit ./EditingTools ./DropDownToolBase ../../../kernel ../../../lang".split(" "),
function(G,A,B,v,t,l,p,d,k,c){G=G([d],{declaredClass:"esri.dijit.editing.tools.Editing",_enabled:!1,deactivate:function(){this._enabled&&(this._enabled=!1,this.inherited(arguments),this._settings.templatePicker.clearSelection())},onItemClicked:function(b,h){this.inherited(arguments);this._activeTool===this._tools.AUTOCOMPLETE&&(this._settings.editor._drawingTool=t.TOOL_AUTO_COMPLETE_POLYGON)},_activateTool:function(b,h){var n;this.enable(h);for(n in this._tools)this._tools.hasOwnProperty(n)&&(this.dropDown.removeChild(this._tools[n]),
!0===this._tools[n]._enabled&&this.dropDown.addChild(this._tools[n]));if(this._geometryType!==h||!1===this._activeTool._enabled)this._activeTool=this._tools[b.toUpperCase()];this._geometryType=h;this._activeTool.activate();this._activeTool.setChecked(!0);this._updateUI()},_initializeTool:function(b){this.inherited(arguments);this._initializeTools()},_initializeTools:function(){var b=this._settings.layers,h=this._settings.editor,n=!1,m=!1,g=!1,a=this._toolTypes=[],f;B.forEach(b,function(e){f=e.geometryType;
n=n||"esriGeometryPoint"===f;m=m||"esriGeometryPolyline"===f;g=g||"esriGeometryPolygon"===f;a=a.concat(B.map(this._getTemplatesFromLayer(e),A.hitch(this,function(r){return h._toDrawTool(r.drawingTool,e)})))},this);b=this._settings.createOptions;n&&this._toolTypes.push("point");m&&(this._toolTypes=this._toolTypes.concat(b.polylineDrawTools));g&&(this._toolTypes=this._toolTypes.concat(b.polygonDrawTools));this._toolTypes=this._toUnique(this._toolTypes.concat(a))},_toUnique:function(b){var h={};return B.filter(b,
function(n){return h[n]?!1:h[n]=!0})},_getTemplatesFromLayer:function(b){var h=b.templates||[];B.forEach(b.types,function(n){h=h.concat(n.templates)});return B.filter(h,c.isDefined)},_createTools:function(){B.forEach(this._toolTypes,this._createTool,this);this.inherited(arguments)},_createTool:function(b){var h=A.mixin(p[b],{settings:this._settings,onClick:A.hitch(this,"onItemClicked",p[b].id)});this._tools[b.toUpperCase()]=new l(h)}});v("extend-esri")&&A.setObject("dijit.editing.tools.Editing",G,
k);return G})},"esri/dijit/editing/tools/Edit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","./MenuItemBase","../../../kernel"],function(G,A,B,v,t){G=G([v],{declaredClass:"esri.dijit.editing.tools.Edit",enable:function(l){this._enabled=l===this._geomType;this.inherited(arguments)}});B("extend-esri")&&A.setObject("dijit.editing.tools.Edit",G,t);return G})},"esri/dijit/editing/tools/MenuItemBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/MenuItem ./ToolBase ../../../kernel".split(" "),
function(G,A,B,v,t,l){G=G([v,t],{declaredClass:"esri.dijit.editing.tools.MenuItemBase",destroy:function(){v.prototype.destroy.apply(this,arguments);t.prototype.destroy.apply(this,arguments)}});B("extend-esri")&&A.setObject("dijit.editing.tools.MenuItemBase",G,l);return G})},"esri/dijit/editing/tools/EditingTools":function(){define(["dojo/_base/lang","dojo/has","../../../toolbars/draw","../../../kernel"],function(G,A,B,v){B={point:{id:"esriPointTool",_enabledIcon:"toolbarIcon pointIcon",_disabledIcon:"toolbarIcon pointIconDisabled",
_drawType:B.POINT,_geomType:"esriGeometryPoint",_label:"NLS_pointLbl"},polyline:{id:"toolDrawFreehandPolyline",_enabledIcon:"toolbarIcon polylineIcon",_disabledIcon:"toolbarIcon polylineIconDisabled",_drawType:B.POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_polylineLbl"},freehandpolyline:{id:"toolDrawPolyline",_enabledIcon:"toolbarIcon freehandPolylineIcon",_disabledIcon:"toolbarIcon freehandPolylineIcon",_drawType:B.FREEHAND_POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_freehandPolylineLbl"},
polygon:{id:"toolDrawPolygon",_enabledIcon:"toolbarIcon polygonIcon",_disabledIcon:"toolbarIcon polygonIconDisabled",_drawType:B.POLYGON,_geomType:"esriGeometryPolygon",_label:"NLS_polygonLbl"},freehandpolygon:{id:"toolDrawFreehandPolygon",_enabledIcon:"toolbarIcon freehandPolygonIcon",_disabledIcon:"toolbarIcon freehandPolygonIconDisabled",_drawType:B.FREEHAND_POLYGON,_label:"NLS_freehandPolygonLbl",_geomType:"esriGeometryPolygon"},autocomplete:{id:"btnFeatureAutoComplete",_enabledIcon:"toolbarIcon autoCompleteIcon",
_disabledIcon:"toolbarIcon autoCompleteIcon",_drawType:B.POLYGON,_label:"NLS_autoCompleteLbl",_geomType:"esriGeometryPolygon"},rectangle:{id:"toolDrawRect",_enabledIcon:"toolbarIcon rectangleIcon",_disabledIcon:"toolbarIcon rectangleIcon",_drawType:B.RECTANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_rectangleLbl"},arrow:{id:"toolDrawArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:B.ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLbl"},uparrow:{id:"toolDrawArrowUp",
_enabledIcon:"toolbarIcon arrowUpIcon",_disabledIcon:"toolbarIcon arrowUpIcon",_drawType:B.UP_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowUpLbl"},downarrow:{id:"toolDrawDownArrow",_enabledIcon:"toolbarIcon arrowDownIcon",_disabledIcon:"toolbarIcon arrowDownIcon",_drawType:B.DOWN_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowDownLbl"},leftarrow:{id:"toolDrawLeftArrow",_enabledIcon:"toolbarIcon arrowLeftIcon",_disabledIcon:"toolbarIcon arrowLeftIcon",_drawType:B.LEFT_ARROW,_geomType:"esriGeometryPolygon",
_label:"NLS_arrowLeftLbl"},rightarrow:{id:"toolDrawRightArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:B.RIGHT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowRightLbl"},circle:{id:"toolDrawCircle",_enabledIcon:"toolbarIcon circleIcon",_disabledIcon:"toolbarIcon circleIcon",_drawType:B.CIRCLE,_geomType:"esriGeometryPolygon",_label:"NLS_circleLbl"},ellipse:{id:"toolDrawEllipse",_enabledIcon:"toolbarIcon ellipseIcon",_disabledIcon:"toolbarIcon ellipseIcon",
_drawType:B.ELLIPSE,_geomType:"esriGeometryPolygon",_label:"NLS_ellipseLbl"},triangle:{id:"toolDrawTriangle",_enabledIcon:"toolbarIcon triangleIcon",_disabledIcon:"toolbarIcon triangleIcon",_drawType:B.TRIANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_triangleLbl"},attributes:{id:"btnAttributes",_enabledIcon:"toolbarIcon attributesIcon",_disabledIcon:"toolbarIcon attributesIcon",_enabled:!1,_label:"NLS_attributesLbl"},del:{id:"btnDelete2",_enabledIcon:"toolbarIcon deleteFeatureIcon",_disabledIcon:"toolbarIcon deleteFeatureIcon",
_enabled:!1,_label:"NLS_deleteLbl"},undo:{id:"btnUndo",_enabledIcon:"dijitEditorIcon dijitEditorIconUndo",_disabledIcon:"dijitEditorIcon dijitEditorIconUndo",_enabled:!1,_label:"NLS_undoLbl"},redo:{id:"btnRedo",_enabledIcon:"dijitEditorIcon dijitEditorIconRedo",_disabledIcon:"dijitEditorIcon dijitEditorIconRedo",_enabled:!1,_label:"NLS_redoLbl"}};A("extend-esri")&&G.setObject("dijit.editing.tools.EditingTools",B,v);return B})},"esri/dijit/editing/tools/DropDownToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-style dijit/registry dijit/Menu dijit/form/ComboButton ./ToolBase ../../../kernel ../../../lang".split(" "),
function(G,A,B,v,t,l,p,d,k,c){G=G([p,d],{declaredClass:"esri.dijit.editing.tools.DropDownToolBase",_enabled:!1,_checked:!1,postCreate:function(){this._tools=[];this._createTools();this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){var b,h=this._tools;for(b in h)h.hasOwnProperty(b)&&c.isDefined(h[b])&&h[b].destroy();this.inherited(arguments)},_createTools:function(){var b,h=new l;this.dropDown=h;for(b in this._tools)this._tools.hasOwnProperty(b)&&h.addChild(this._tools[b]);
this._activeTool=h.getChildren()[0];this._updateUI()},activate:function(b){this.inherited(arguments);this._activeTool?this._activeTool.activate():this._activateDefaultTool()},deactivate:function(){this.inherited(arguments);this._activeTool&&this._activeTool.deactivate()},enable:function(b){for(var h in this._tools)this._tools.hasOwnProperty(h)&&this._tools[h].enable(b);this.setEnabled(!0);this.inherited(arguments)},setChecked:function(b){this._checked=b;this._updateUI()},_onDrawEnd:function(b){},
onLayerChange:function(b,h,n){this._activeTool=null;this._activeType=h;this._activeTemplate=n;this._activeLayer=b},onItemClicked:function(b,h){this._activeTool&&this._activeTool.deactivate();this._activeTool=t.byId(b);!1===this._checked?this._onClick():(this._updateUI(),this._activeTool&&(this._activeTool.activate(),this._activeTool.setChecked(!0)))},_onClick:function(b){!1!==this._enabled&&(this._checked=!this._checked,this.inherited(arguments))},_updateUI:function(){this.attr("disabled",!this._enabled);
v.set(this.focusNode,{outline:"none"});v.set(this.titleNode,{padding:"0px",border:"none"});this._checked?v.set(this.titleNode,{backgroundColor:"#D4DFF2",border:"1px solid #316AC5"}):v.set(this.titleNode,{backgroundColor:"",border:""});this._activeTool&&(this.attr("iconClass",this._checked?this._activeTool._enabledIcon:this._activeTool._disabledIcon),this.attr("label",this._activeTool.label))}});B("extend-esri")&&A.setObject("dijit.editing.tools.DropDownToolBase",G,k);return G})},"dijit/form/ComboButton":function(){define("dojo/_base/declare dojo/keys ../focus ./DropDownButton dojo/text!./templates/ComboButton.html ../a11yclick".split(" "),
function(G,A,B,v,t){return G("dijit.form.ComboButton",v,{templateString:t,_setIdAttr:"",_setTabIndexAttr:["focusNode","titleNode"],_setTitleAttr:"titleNode",optionsTitle:"",baseClass:"dijitComboButton",cssStateNodes:{buttonNode:"dijitButtonNode",titleNode:"dijitButtonContents",_popupStateNode:"dijitDownArrowButton"},_focusedNode:null,_onButtonKeyDown:function(l){l.keyCode==A[this.isLeftToRight()?"RIGHT_ARROW":"LEFT_ARROW"]&&(B.focus(this._popupStateNode),l.stopPropagation(),l.preventDefault())},_onArrowKeyDown:function(l){l.keyCode==
A[this.isLeftToRight()?"LEFT_ARROW":"RIGHT_ARROW"]&&(B.focus(this.titleNode),l.stopPropagation(),l.preventDefault())},focus:function(l){this.disabled||B.focus("start"==l?this.titleNode:this._popupStateNode)}})})},"esri/dijit/editing/tools/Selection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/SimpleFillSymbol ./Edit ./SelectionTools ./DropDownToolBase ../../../kernel".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n){G=G([h],{declaredClass:"esri.dijit.editing.tools.Selection",_enabled:!0,activate:function(){this.inherited(arguments);this._sConnect=v.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd")},deactivate:function(){this.inherited(arguments);v.disconnect(this._sConnect);delete this._sConnect},_initializeTool:function(){this._createSymbols();this._initializeLayers();this._toolTypes=["select","selectadd","selectremove"]},_onDrawEnd:function(m){this.inherited(arguments);
this._settings.editor._hideAttributeInspector();var g=this._settings.layers;this._selectMethod=this._activeTool._selectMethod;this._settings.editor._selectionHelper.selectFeaturesByGeometry(g,m,this._selectMethod,A.hitch(this,"onFinished"))},_createSymbols:function(){this._pointSelectionSymbol=new p(p.STYLE_CIRCLE,10,new d(d.STYLE_SOLID,new t([0,0,0]),1),new t([255,0,0,.5]));this._polylineSelectionSymbol=new d(d.STYLE_SOLID,new t([0,200,255]),2);this._polygonSelectionSymbol=new k(k.STYLE_SOLID,new d(d.STYLE_SOLID,
new t([0,0,0]),1),new t([0,200,255,.5]))},_initializeLayers:function(){B.forEach(this._settings.layers,this._setSelectionSymbol,this)},_setSelectionSymbol:function(m){var g=null;switch(m.geometryType){case "esriGeometryPoint":g=this._pointSelectionSymbol;break;case "esriGeometryPolyline":g=this._polylineSelectionSymbol;break;case "esriGeometryPolygon":g=this._polygonSelectionSymbol}m.setSelectionSymbol(m._selectionSymbol||g)},_createTools:function(){B.forEach(this._toolTypes,this._createTool,this);
this.inherited(arguments)},_createTool:function(m){var g=A.mixin(b[m],{settings:this._settings,onClick:A.hitch(this,"onItemClicked",b[m].id)});this._tools[m.toUpperCase()]=new c(g)}});l("extend-esri")&&A.setObject("dijit.editing.tools.Selection",G,n);return G})},"esri/dijit/editing/tools/SelectionTools":function(){define(["dojo/_base/lang","dojo/has","../../../layers/FeatureLayer","../../../toolbars/draw","../../../kernel"],function(G,A,B,v,t){B={select:{id:"btnNewSelection",_enabledIcon:"toolbarIcon newSelectionIcon",
_disabledIcon:"toolbarIcon newSelectionIcon",_drawType:v.EXTENT,_selectMethod:B.SELECTION_NEW,_label:"NLS_selectionNewLbl"},selectadd:{id:"btnAddToSelection",_enabledIcon:"toolbarIcon addToSelectionIcon",_disabledIcon:"toolbarIcon addToSelectionIcon",_drawType:v.EXTENT,_selectMethod:B.SELECTION_ADD,_label:"NLS_selectionAddLbl"},selectremove:{id:"btnSubtractFromSelection",_enabledIcon:"toolbarIcon removeFromSelectionIcon",_disabledIcon:"toolbarIcon removeFromSelectionIcon",_drawType:v.EXTENT,_selectMethod:B.SELECTION_SUBTRACT,
_label:"NLS_selectionRemoveLbl"},selectClear:{id:"btnClearSelection",_enabledIcon:"toolbarIcon clearSelectionIcon",_disabledIcon:"toolbarIcon clearSelectionIcon",_enabled:!1,_label:"NLS_selectionClearLbl"}};A("extend-esri")&&G.setObject("dijit.editing.tools.SelectionTools",B,t);return B})},"esri/dijit/editing/SelectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dojo/DeferredList ../../geometry/Extent ../../geometry/Point ../../geometry/ScreenPoint ../../layers/FeatureLayer ../../tasks/query ../../kernel".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h){G=G(null,{declaredClass:"esri.dijit.editing.SelectionHelper",constructor:function(n){this._settings=n||{};this._sConnects=[];this._mapServiceCount=0;this._map=this._settings.map;this._tolerance=this._settings.singleSelectionTolerance;this._initMapServiceInfos(this._settings.layers)},destroy:function(){for(var n in this._sConnects)this._sConnects.hasOwnProperty(n)&&B.disconnect(this._sConnects[n])},selectFeatures:function(n,m,g,a){g===c.SELECTION_NEW&&(this._resetMapServiceInfos(),
this.getSelection(n));var f=[];v.forEach(n,function(e){if(!0===e.visible&&!0===e._isMapAtVisibleScale()){var r=g;e._isSelOnly&&r===c.SELECTION_NEW&&(r=c.SELECTION_ADD);f.push(e.selectFeatures(m,r))}});(new l(f)).addCallback(A.hitch(this,function(e){var r=[];v.forEach(e,function(w,H){v.forEach(w[1],function(x){(x=n[H]._mode._getFeature(x.attributes[n[H].objectIdField])||null)&&r.push(x)},this)},this);this._mapServiceCount?((e=g===c.SELECTION_SUBTRACT)?(this._resetMapServiceInfos(),this._createLayerDefs(this._getLayerInfosFromSelection(n))):
this._createLayerDefs(this._getLayerInfosFromFeatures(r)),this._updateLayerDefs(this._mapServiceInfos,!1,!(r&&r.length||e),A.hitch(this,a,r))):a(r)}))},selectFeaturesByGeometry:function(n,m,g,a){var f=m;-1!==m.declaredClass.indexOf("Extent")&&m.xmax===m.xmin&&m.ymax===m.ymin&&(f=new d(m.xmax,m.ymax,m.spatialReference));f=-1!==f.declaredClass.indexOf("Point")?this._extentFromPoint(f):f;m=new b;m.geometry=f;this.selectFeatures(n,m,g,a)},clearSelection:function(n){v.forEach(this._nonSelOnlyLayers,function(g){g.clearSelection&&
g.clearSelection()});if(this._mapServiceCount){this._resetMapServiceInfos();var m=this._getLayerInfosFromSelection(this._settings.layers);v.some(m,function(g){return g.oids&&g.oids.length})&&(this._createLayerDefs(m),this._updateLayerDefs(this._mapServiceInfos,!0,n||!1))}},findMapService:function(n){var m=this._map,g=m.layerIds;n=n&&n._url&&n._url.path?n._url.path.toLowerCase():"";var a;for(a in g)if(g.hasOwnProperty(a)){var f=m.getLayer(g[a]);var e=f._url?f._url.path?f._url.path.toLowerCase().replace("mapserver",
"featureserver"):f._url.toLowerCase().replace("mapserver","featureserver"):"";if(n.substr(0,e.length)===e&&"esri.layers.ArcGISDynamicMapServiceLayer"===f.declaredClass)return f}},getSelection:function(n){var m=[];v.forEach(n,function(g){g._isSelOnly&&m.push(this._createLayerInfo(g))},this);v.forEach(m,function(g){var a=this._createMapServiceInfo(this.findMapService(g.layer));a&&(a.layerInfos[g.layer.layerId]=g)},this)},_initMapServiceInfos:function(n){this._nonSelOnlyLayers=[];this._mapServiceInfos=
[];v.forEach(n,function(m){var g=this.findMapService(m);g?(this._mapServiceCount++,this._createMapServiceInfo(g),g&&g.setDisableClientCaching(!0)):this._nonSelOnlyLayers.push(m)},this)},_createMapServiceInfo:function(n){if(!n)return null;var m=this._mapServiceInfos,g=m[n.id];g||(g=m[n.id]={mapService:n,layerInfos:[],layerDefs:A.mixin([],n.layerDefinitions||[]),origLayerDefs:A.mixin([],n.layerDefinitions||[])});return g},_resetMapServiceInfo:function(n){v.forEach(n.layerInfos,this._resetLayerInfo);
n.layerDefs=A.mixin([],n.origLayerDefs||[])},_resetMapServiceInfos:function(){var n=this._mapServiceInfos,m;for(m in n)n.hasOwnProperty(m)&&this._resetMapServiceInfo(n[m])},_createLayerInfo:function(n,m){var g=n.objectIdField;m=m?[]:n.getSelectedFeatures();return{layer:n,selectedFeatures:m||[],oids:v.map(m,function(a){return a.attributes[g]})}},_resetLayerInfo:function(n){n&&(n.selectedFeatures=[],n.oids=[])},_updateLayerDefs:function(n,m,g,a){for(var f in n)if(n.hasOwnProperty(f)){var e=n[f],r=e.mapService,
w=e.layerDefs=m?A.mixin([],e.origLayerDefs||[]):e.layerDefs;w?(g?a&&a():this._sConnects[r.id]=B.connect(r,"onUpdateEnd",A.hitch(this,"_onMapServiceUpdate",e,m,a)),r.setLayerDefinitions(w,g||!1)):a&&a()}},_onMapServiceUpdate:function(n,m,g){B.disconnect(this._sConnects[n.mapService.id]);v.forEach(n.layerInfos,function(a){if(m)a&&a.layer.clearSelection();else{var f=new b;f.objectIds=a?a.oids:[];f.objectIds.length&&a.layer.selectFeatures(f,c.SELECTION_SUBTRACT)}},this);m&&this._resetMapServiceInfo(n);
g&&g()},_createLayerDefs:function(n){v.forEach(n,function(m){var g=m.layer,a=this._createMapServiceInfo(this.findMapService(m.layer));if(a){a=a.layerDefs;var f=g.layerId,e='("'+g.objectIdField+'" NOT IN (',r=m.oids;r&&r.length&&(v.forEach(m.oids,function(w,H){r=!0;H&&(e+=",");e+="'"+w+"'"}),e+="))",a[f]=a.length&&a[f]&&a[f].length?a[f]+(" AND"+e):e)}},this)},_getLayerInfosFromFeatures:function(n){var m=[];v.forEach(n,function(a){var f=a.getLayer();f&&f._isSelOnly&&(m[f.id]||(m[f.id]=this._createLayerInfo(f,
!0)),m[f.id].selectedFeatures.push(a),m[f.id].oids.push(a.attributes[f.objectIdField]))},this);n=[];for(var g in m)m.hasOwnProperty(g)&&n.push(m[g]);return n},_getLayerInfosFromSelection:function(n){var m=[];v.forEach(n,function(g){g._isSelOnly&&m.push(this._createLayerInfo(g,!1))},this);return m},_extentFromPoint:function(n){var m=this._tolerance,g=this._map,a=g.toScreen(n);n=new k(a.x-m,a.y+m);m=new k(a.x+m,a.y-m);n=g.toMap(n);m=g.toMap(m);return new p(n.x,n.y,m.x,m.y,g.spatialReference)}});t("extend-esri")&&
A.setObject("dijit.editing.SelectionHelper",G,h);return G})},"esri/dijit/editing/TemplatePicker":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/_base/array dojo/_base/json dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/_Widget dijit/_Templated dojo/data/ItemFileReadStore dojox/grid/DataGrid dojox/gfx ../../layers/FeatureLayer ../../symbols/SimpleMarkerSymbol ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ./TemplatePickerItem ../../kernel ../../lang ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi dojo/text!./templates/TemplatePicker.html".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e,r,w,H,x,q,C,F,u,E,D,M,I,z){var K=G([M,g,a],{declaredClass:"esri.dijit.editing.TemplatePicker",widgetsInTemplate:!0,templateString:z,featureLayers:null,items:null,grouping:!0,showTooltip:!1,maxLabelLength:0,rows:4,_rows:0,columns:3,surfaceWidth:30,surfaceHeight:30,emptyMessage:"",useLegend:!0,legendCache:{},_uniqueId:{id:0},_assumedCellWidth:90,_initialAutoWidth:300,_initialAutoHeight:200,_ieTimer:150,constructor:function(L,N){L=L||{};L.items||L.featureLayers||
console.error("TemplatePicker: please provide 'featureLayers' or 'items' parameter in the constructor");this._dojo14x=4<=p.version.minor;this._itemWidgets={};L.featureLayers&&L.featureLayers.length&&(this._flChanged=1);this._nls=I.widgets.templatePicker;this.emptyMessage=L.emptyMessage||this._nls&&this._nls.creationDisabled||""},postMixInProperties:function(){this.inherited(arguments);this._preprocess()},startup:function(){this.inherited(arguments);if("auto"===this.rows&&"auto"===this.columns){var L=
n.getContentBox(this.domNode);L.w||(this.domNode.style.width=this._initialAutoWidth+"px");if(!L.h||1>=L.h)this.domNode.style.height=this._initialAutoHeight+"px";L=n.getContentBox(this.domNode);this._columns=Math.floor(L.w/this._assumedCellWidth)||1}this._applyGridPatches();this._setGridLayout();B.connect(this.grid,"onRowClick",this,this._rowClicked);this._setGridData();this._toggleTooltip();9>d("ie")&&(this._repaintItems=A.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},
destroy:function(){this.showTooltip=!1;this._toggleTooltip();this._clearLegendInfo();this.featureLayers=this.items=this.grid=this._flItems=this._itItems=this._groupRowIndices=this._selectedCell=this._selectedInfo=this._selectedItem=null;this.inherited(arguments)},getSelected:function(){return this._selectedCell?this._selectedItem:null},clearSelection:function(){var L=this._selectedCell,N=this._selectedInfo;L&&this._rowClicked({cellNode:L,rowIndex:N.selRow,cellIndex:N.selCol})},update:function(L){L=
"auto"===this.rows&&"auto"===this.columns&&L?!0:!1;var N=this.grid;if(L){var P=this.domNode;var T=p.query("#"+P.id+".templatePicker div.item")[0];P=n.getContentBox(P);T=(T=T&&T.parentNode)?v.coords(T).w:this._assumedCellWidth;this._columns=(this._columns=Math.floor((P.w-N.views.views[0].getScrollbarWidth())/T))||1}T=this._rows;this._preprocess();var S=this._rows;this._setGridLayout();this._setGridData();S!==T&&N.set("autoHeight",this._rows,!1);L?(N._resize({w:P.w,h:P.h}),N.viewsHeaderNode.style.display=
"none"):N.update();this._toggleTooltip();var Z=this,da=this.getSelected();da&&N.store.fetch({onComplete:function(Q){var W=(Q=Z._locate(da,Z._selectedInfo,Q))&&N.views.views[0].getCellNode(Q[0],Q[1]);W&&Z._rowClicked({cellNode:W,rowIndex:Q[0],cellIndex:Q[1]},!0)}});9>d("ie")&&setTimeout(this._repaintItems,this._ieTimer);L=this.featureLayers;P=this.items;L&&L.length||P&&P.length||!N||!this.emptyMessage||N.showMessage(this.emptyMessage)},_eventMap:{"selection-change":!0},onSelectionChange:function(){},
_setUseLegendAttr:function(L){var N=this.useLegend;this._started&&N===L||(L?this._flChanged=1:this._clearLegendInfo());this.useLegend=L},_setFeatureLayersAttr:function(L){var N=this.featureLayers;this._started&&N===L||(this._flChanged=1);this.featureLayers=L},_adjustRowsCols:function(L){if("auto"===this.rows&&"auto"===this.columns)this._started||(this._rows=!1,this._columns=null,this._autoWidth=!1);else{var N=0;this._rows=this.rows;this._columns=this.columns;"auto"===this.rows?(this.featureLayers?
this.grouping?(N=L.length,t.forEach(L,function(P){N+=Math.ceil(P.length/this.columns)},this)):(t.forEach(L,function(P){N+=P.length},this),N=Math.ceil(N/this.columns)):N=Math.ceil(L.length/this.columns),this._rows=N):"auto"===this.columns&&(this.featureLayers?this.grouping?N=3:(t.forEach(L,function(P){N+=P.length},this),N=Math.ceil(N/this.rows)):N=Math.ceil(L.length/this.rows),this._columns=N)}},_preprocess:function(){this.items&&(this.grouping=!1);this._autoWidth=!1;if("auto"===this.rows||"auto"===
this.columns)this._autoWidth=!0;if(this.featureLayers)if(this.useLegend&&this._flChanged&&(this._legendIndices=[],this._loadingIndices=[],this._legendSymbols={},this._ignoreLegends(),this._loadingLegends=[],clearTimeout(this._legendTimer),this._legendTimer=null,this._processSelectionLayers(),this._flChanged=0),t.every(this.featureLayers,function(P){return P.loaded})){this.featureLayers=t.filter(this.featureLayers,function(P){return!(P.hasZ&&!P.enableZDefaults)});var L=this._flItems=this._getItemsFromLayers(this.featureLayers);
this._adjustRowsCols(L)}else{var N=this.featureLayers.length;t.forEach(this.featureLayers,function(P){if(P.loaded)N--;else var T=B.connect(P,"onLoad",this,function(){B.disconnect(T);T=null;N--;N||this.update()})},this)}else L=this._itItems=this._getItemsFromItems(this.items),this._adjustRowsCols(L)},_processSelectionLayers:function(){var L,N,P,T,S,Z,da,Q={};t.forEach(this.featureLayers,function(W,aa){W.mode===w.MODE_SELECTION&&W._map&&W.url&&W._params.drawMode&&!W.source&&(N=A.trim(W._url.path).replace(/\/(MapServer|FeatureServer).*/ig,
"/MapServer").replace(/^https?:\/\//ig,"").toLowerCase(),P=Q[N]=Q[N]||{},T=P.featureLayers=P.featureLayers||{},Z=P.indices=P.indices||[],T[aa]=W,Z.push(aa),L=W._map)});L&&t.forEach(L.layerIds,function(W){(W=L.getLayer(W))&&W.url&&(W.getImageUrl||W.getTileUrl)&&W.loaded&&10.1<=W.version&&(N=A.trim(W._url.path).replace(/(\/MapServer).*/ig,"$1"),S=N.replace(/^https?:\/\//ig,"").toLowerCase(),Q[S]&&!Q[S].mapServiceUrl&&(P=Q[S],P.mapServiceUrl=N,P.mapServiceLayer=W,this._legendIndices=this._legendIndices.concat(P.indices),
da=this._fetchLegend({pickerInstance:this,info:P},S),da.then?(this._loadingIndices=this._loadingIndices.concat(P.indices),this._loadingLegends.push(da)):this._processLegendResponse(da,P)))},this)},_fetchLegend:function(L,N){var P=K.prototype,T=P.legendCache[N];T?T.then&&T._contexts.push(L):(T=P.legendCache[N]=D({url:L.info.mapServiceUrl+"/legend",content:{f:"json"},callbackParamName:"callback"}),T._contexts=[L],T.addBoth(function(S){if(!T.canceled){P.legendCache[N]=S;var Z=T._contexts;T._contexts=
null;t.forEach(Z,function(da){var Q=da.pickerInstance;da=da.info;if(!Q._destroyed){t.forEach(da.indices,function(aa){W=t.indexOf(Q._loadingIndices,aa);-1<W&&Q._loadingIndices.splice(W,1)});var W=t.indexOf(Q._loadingLegends,T);-1<W&&Q._loadingLegends.splice(W,1);Q._processLegendResponse(S,da)}})}}));return T},_clearLegendInfo:function(){clearTimeout(this._legendTimer);this._ignoreLegends();this._legendIndices=this._loadingIndices=this._legendSymbols=this._loadingLegends=this._legendTimer=null},_ignoreLegends:function(){this._loadingLegends&&
t.forEach(this._loadingLegends,function(L){var N=-1;t.some(L._contexts,function(P,T){P.pickerInstance===this&&(N=T);return-1<N},this);-1<N&&L._contexts.splice(N,1)},this)},_processLegendResponse:function(L,N){if(!L||L instanceof Error){var P;t.forEach(N.indices,function(S){P=t.indexOf(this._legendIndices,S);-1<P&&this._legendIndices.splice(P,1)},this)}else t.forEach(N.indices,function(S){var Z=N.featureLayers[S].layerId,da,Q=N.mapServiceUrl+"/"+Z+"/images/",W=N.mapServiceLayer._getToken(),aa,R;if(!this._legendSymbols[S]){var V=
null;t.some(L.layers,function(ha){ha.layerId==Z&&(V=ha);return!!V});if(V){var ba=this._legendSymbols[S]={};t.forEach(V.legend,function(ha){if((aa=ha.values)&&aa.length)for(da=0;da<aa.length;da++)ba[aa[da]]=ha;else ba.defaultSymbol=ha;(R=ha.url)&&!ha._fixed&&(ha._fixed=1,-1===R.search(/https?:/)&&(ha.url=Q+R),W&&-1!==ha.url.search(/https?:/)&&(ha.url+=(-1<ha.url.indexOf("?")?"\x26":"?")+"token\x3d"+W))})}}},this);var T=this;T._started&&!T._legendTimer&&(T._legendTimer=setTimeout(function(){clearTimeout(T._legendTimer);
T._legendTimer=null;T._destroyed||T.update()},0))},_applyGridPatches:function(){var L=this.grid,N=L.adaptWidth,P,T,S;L.adaptWidth=function(){P=this.views.views;for(T=0;S=P[T];T++)m.set(S.headerNode,"display","block");N.apply(this,arguments);for(T=0;S=P[T];T++)m.set(S.headerNode,"display","none")};if(this._dojo14x){if("auto"!==this.rows&&"auto"!==this.columns)var Z=B.connect(L,"_onFetchComplete",this,function(){B.disconnect(Z);this.grid.set("autoHeight",this._rows)});B.connect(L,"_onDelete",this,this._destroyItems);
B.connect(L,"_clearData",this,this._destroyItems);B.connect(L,"destroy",this,this._destroyItems);(L=L.focus)&&L.findAndFocusGridCell&&(L.findAndFocusGridCell=function(){return!1})}},_setGridLayout:function(){var L=function(Z){return function(da,Q){return this._cellGet(Z,da,Q)}},N=A.hitch(this,this._cellFormatter),P=[],T=this._columns,S;for(S=0;S<T;S++)P.push({field:"cell"+S,get:A.hitch(this,L(S)),formatter:N});L={cells:[P]};this.grouping&&(T={field:"groupName",colSpan:T,get:A.hitch(this,this._cellGetGroup),
formatter:A.hitch(this,this._cellGroupFormatter)},L.cells.push([T]));T=this.grid;N=e.prototype.rowsPerPage;T.set("rowsPerPage",this._rows>N?this._rows:N);T.set("structure",L)},_setGridData:function(){var L=[];if(this.grouping){this._groupRowIndices=[];var N,P,T=this._columns;t.forEach(this._flItems,function(Z,da){L.push({});da=0===da?0:N+P+1;this._groupRowIndices.push(da);N=da;P=Math.ceil(Z.length/T);L=L.concat(this._getStoreItems(Z))},this)}else this.featureLayers?(t.forEach(this._flItems,function(Z){L=
L.concat(Z)}),L=this._getStoreItems(L)):L=this._getStoreItems(this._itItems);var S=new f({data:{items:L}});this.grid.setStore(S)},_toggleTooltip:function(){if(this.showTooltip){if(!this.tooltip){this.tooltip=h.create("div",{"class":"esriMapTooltip"},this.domNode);this.tooltip.style.display="none";this.tooltip.style.position="fixed";var L=this.grid;this._mouseOverConnect=B.connect(L,"onCellMouseOver",this,this._cellMouseOver);this._mouseOutConnect=B.connect(L,"onCellMouseOut",this,this._cellMouseOut)}}else this.tooltip&&
(B.disconnect(this._mouseOverConnect),B.disconnect(this._mouseOutConnect),h.destroy(this.tooltip),this.tooltip=null)},_rowClicked:function(L,N){var P=L.cellNode,T=L.rowIndex;L=L.cellIndex;var S=this._getCellInfo(P,T,L);if(S){var Z=this.grid.store;if(!Z.getValue(S,"loadingCell")&&(this._selectedCell&&b.remove(this._selectedCell,"selectedItem"),P!==this._selectedCell?(b.add(P,"selectedItem"),this._selectedCell=P,this._selectedItem={featureLayer:Z.getValue(S,"layer"),type:Z.getValue(S,"type"),template:Z.getValue(S,
"template"),symbolInfo:Z.getValue(S,"symbolInfo"),item:this._getItem(S)},this._selectedInfo={selRow:T,selCol:L,index1:Z.getValue(S,"index1"),index2:Z.getValue(S,"index2"),index:Z.getValue(S,"index")}):this._selectedCell=this._selectedInfo=this._selectedItem=null,!N))this.onSelectionChange()}},_locate:function(L,N,P){var T=this.grid.store,S=Array(this._columns),Z,da=N.index1,Q=N.index2,W=N.index,aa=L.item;t.some(P,function(R,V){return t.some(S,function(ba,ha){return(ba=T.getValue(R,"cell"+ha))&&(aa?
W===T.getValue(ba,"index"):da===T.getValue(ba,"index1")&&Q===T.getValue(ba,"index2"))?(Z=[V,ha],!0):!1})});return Z},_getCellInfo:function(L,N,P){if(L)return L=this.grid,N=L.getItem(N),L.store.getValue(N,"cell"+P)},_getItem:function(L){var N=this.items;if(N)return N[this.grid.store.getValue(L,"index")]},_cellMouseOver:function(L){var N=this.tooltip,P=L.cellNode,T=this._getCellInfo(P,L.rowIndex,L.cellIndex);if(N&&T){var S=this.grid.store;L=S.getValue(T,"template");var Z=S.getValue(T,"type"),da=S.getValue(T,
"symbolInfo");S=S.getValue(T,"layer");L=(T=this._getItem(T))&&T.label+(T.description?": "+T.description:"")||L&&L.name+(L.description?": "+L.description:"")||Z&&Z.name||da&&da.label+(da.description?": "+da.description:"")||(S&&S.name+": ")+"Default";N.style.display="none";N.innerHTML=L;P=v.coords(P.firstChild);m.set(N,{left:P.x+"px",top:P.y+P.h+5+"px"});N.style.display=""}},_cellMouseOut:function(){var L=this.tooltip;L&&(L.style.display="none")},_destroyItems:function(){var L=this._itemWidgets,N;
for(N in L)L[N]&&(L[N].destroy(),delete L[N])},_repaintItems:function(){var L=this._itemWidgets,N;for(N in L){var P=L[N];P&&P._repaint(P._surface)}},_getStoreItems:function(L){var N=this._uniqueId;L=t.map(L,function(R){return A.mixin({surfaceId:"tpick-surface-"+N.id++},R)});for(var P=L.length,T=0,S={},Z=0,da,Q=[],W=!0,aa=this._columns;T<P;)W=!0,da="cell"+Z,S[da]=L[T],T++,Z++,0===Z%aa&&(W=!1,Q.push(S),S={},Z=0);W&&P&&Q.push(S);return Q},_getItemsFromLayers:function(L){var N=[];t.forEach(L,function(P,
T){N.push(this._getItemsFromLayer(P,T))},this);return N},_getItemsFromLayer:function(L,N){var P=[];if(this.useLegend&&-1<t.indexOf(this._loadingIndices,N))return[{label:this._nls&&this._nls.loading||"",symbol:null,layer:L,type:null,template:null,index1:N,index2:0,loadingCell:1}];var T=[];T=T.concat(L.templates);t.forEach(L.types,function(Q){var W=Q.templates;t.forEach(W,function(aa){aa._type_=Q});T=T.concat(W)});T=t.filter(T,E.isDefined);var S=L.renderer;if(S){var Z=S.declaredClass.replace("esri.renderer.",
"");if(0<T.length)t.forEach(T,function(Q){var W=Q.prototype;if(W){var aa;if(aa=this._isUnclassedRenderer(S)?S.infos[0].symbol:S.valueExpression?this._createSimpleSymbol(L):S.getSymbol(W)||this._createSimpleSymbol(L)){var R=null,V;if(!(9>c("ie"))&&Q.thumbnail&&Q.thumbnail.imageData)R=new x(Q.thumbnail);else if(this.useLegend&&-1<t.indexOf(this._legendIndices,N)){if(V=this._legendSymbols&&this._legendSymbols[N])switch(Z){case "SimpleRenderer":R=V.defaultSymbol;break;case "UniqueValueRenderer":t.some(S.infos,
function(ba){ba.symbol===aa&&(R=V[ba.value]);return!!R});break;case "ClassBreaksRenderer":t.some(S.infos,function(ba){ba.symbol===aa&&(R=V[ba.maxValue]);return!!R})}R&&(W=l.fromJson(l.toJson(x.defaultProps)),W.url=R.url,W.imageData=R.imageData,W.contentType=R.contentType,W.width=R.width,W.height=R.height,E.isDefined(W.width)&&E.isDefined(W.height)||(W.width=15,W.height=15),R=new x(W))}P.push({label:this._trimLabel(Q.name),symbol:R||aa,legendOverride:!!R,layer:L,type:Q._type_,template:Q,index1:N,index2:P.length})}else switch(Z){case "HeatmapRenderer":P.push({label:this._trimLabel(Q.name),
symbol:new H,legendOverride:!!R,layer:L,type:Q._type_,template:Q,index1:N,index2:P.length})}}delete Q._type_},this);else{var da=[];"TemporalRenderer"===Z&&(S=S.observationRenderer)&&(Z=S.declaredClass.replace("esri.renderer.",""));switch(Z){case "SimpleRenderer":da=[{symbol:S.symbol,label:S.label,description:S.description}];break;case "UniqueValueRenderer":case "ClassBreaksRenderer":da=S.infos}P=t.map(da,function(Q,W){return{label:this._trimLabel(Q.label),description:Q.description,symbolInfo:A.mixin({constructor:function(){}},
Q),symbol:Q.symbol,layer:L,index1:N,index2:W}},this)}}return P},_isUnclassedRenderer:function(L){return!!((L.hasVisualVariables("sizeInfo",!1)||L.hasVisualVariables("colorInfo",!1)||L.hasVisualVariables("opacityInfo",!1))&&L.addBreak&&L.infos&&1===L.infos.length)},_createSimpleSymbol:function(L){switch(L.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":var N=new H;break;case "esriGeometryPolyline":N=new C;break;case "esriGeometryPolygon":N=new q;break;default:L.hasXYFootprint&&
L.hasXYFootprint()&&(N=new q)}return N},_getItemsFromItems:function(L){return t.map(L,function(N,P){N=A.mixin({index:P},N);N.label=this._trimLabel(N.label);return N},this)},_trimLabel:function(L){var N=this.maxLabelLength;N&&L&&L.length>N&&(L=L.substr(0,N)+"...");return L||""},_cellGet:function(L,N,P){return P?this.grid.store.getValue(P,"cell"+L):""},_cellFormatter:function(L){if(L){var N=this._itemWidgets,P=this.grid.store,T=P.getValue(L,"surfaceId"),S=N[T];S||(S=N[T]=new F({id:T,label:P.getValue(L,
"label"),symbol:P.getValue(L,"symbol"),legendOverride:P.getValue(L,"legendOverride"),surfaceWidth:this.surfaceWidth,surfaceHeight:this.surfaceHeight,template:P.getValue(L,"template")}));return S||""}return""},_cellGetGroup:function(L,N){if(!this._groupRowIndices)return"";L=t.indexOf(this._groupRowIndices,L);return N&&-1!==L?(N=this.featureLayers[L])&&(this.groupLabelFunction?this.groupLabelFunction(N):N.name)||"":""},_cellGroupFormatter:function(L){return L?"\x3cdiv class\x3d'groupLabel'\x3e"+L+"\x3c/div\x3e":
""}});d("extend-esri")&&A.setObject("dijit.editing.TemplatePicker",K,u);return K})},"dojox/grid/DataGrid":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/json dojo/_base/sniff dojo/_base/declare ./_Grid ./DataSelection dojo/_base/html dojo/has dojo/has!dojo-bidi?./bidi/_BidiMixin".split(" "),function(G,A,B,v,t,l,p,d,k){var c=l("dojox.grid.DataGrid",p,{store:null,query:null,queryOptions:null,fetchText:"...",sortFields:null,updateDelay:1,items:null,_store_connects:null,_by_idty:null,
_by_idx:null,_cache:null,_pages:null,_pending_requests:null,_bop:-1,_eop:-1,_requests:0,rowCount:0,_isLoaded:!1,_isLoading:!1,keepSelection:!1,postCreate:function(){this._pages=[];this._store_connects=[];this._by_idty={};this._by_idx=[];this._cache=[];this._pending_requests={};this._setStore(this.store);this.inherited(arguments)},destroy:function(){this.selection.destroy();this.inherited(arguments)},createSelection:function(){this.selection=new d(this)},get:function(b,h){if(h&&"_item"==this.field&&
!this.fields)return h;if(h&&this.fields){var n=[],m=this.grid.store;A.forEach(this.fields,function(g){n=n.concat(m.getValues(h,g))});return n}return h||"string"!==typeof b?h?this.field?"_item"==this.field?h:this.grid.store.getValue(h,this.field):this.value:this.defaultValue:this.inherited(arguments)},_checkUpdateStatus:function(){if(0<this.updateDelay){var b=!1;this._endUpdateDelay&&(clearTimeout(this._endUpdateDelay),delete this._endUpdateDelay,b=!0);this.updating||(this.beginUpdate(),b=!0);if(b){var h=
this;this._endUpdateDelay=setTimeout(function(){delete h._endUpdateDelay;h.endUpdate()},this.updateDelay)}}},_onSet:function(b,h,n,m){this._checkUpdateStatus();b=this.getItemIndex(b);-1<b&&this.updateRow(b)},_createItem:function(b,h){h=this._hasIdentity?this.store.getIdentity(b):v.toJson(this.query)+":idx:"+h+":sort:"+v.toJson(this.getSortProps());return this._by_idty[h]={idty:h,item:b}},_addItem:function(b,h,n){this._by_idx[h]=this._createItem(b,h);n||this.updateRow(h)},_onNew:function(b,h){this._checkUpdateStatus();
h=this.get("rowCount");this._addingItem=!0;this.updateRowCount(h+1);this._addingItem=!1;this._addItem(b,h);this.showMessage()},_onDelete:function(b){this._checkUpdateStatus();b=this._getItemIndex(b,!0);if(0<=b){this._pages=[];this._eop=this._bop=-1;var h=this._by_idx[b];this._by_idx.splice(b,1);delete this._by_idty[h.idty];this.updateRowCount(this.get("rowCount")-1);0===this.get("rowCount")&&this.showMessage(this.noDataMessage)}this.selection.isSelected(b)&&(this.selection.deselect(b),this.selection.selected.splice(b,
1))},_onRevert:function(){this._refresh()},setStore:function(b,h,n){this._requestsPending(0)||(this._setQuery(h,n),this._setStore(b),this._refresh(!0))},setQuery:function(b,h){this._requestsPending(0)||(this._setQuery(b,h),this._refresh(!0))},setItems:function(b){this.items=b;this._setStore(this.store);this._refresh(!0)},_setQuery:function(b,h){this.query=b;this.queryOptions=h||this.queryOptions},_setStore:function(b){this.store&&this._store_connects&&A.forEach(this._store_connects,this.disconnect,
this);if(this.store=b){b=this.store.getFeatures();var h=[];this._canEdit=!!b["dojo.data.api.Write"]&&!!b["dojo.data.api.Identity"];this._hasIdentity=!!b["dojo.data.api.Identity"];b["dojo.data.api.Notification"]&&!this.items&&(h.push(this.connect(this.store,"onSet","_onSet")),h.push(this.connect(this.store,"onNew","_onNew")),h.push(this.connect(this.store,"onDelete","_onDelete")));this._canEdit&&h.push(this.connect(this.store,"revert","_onRevert"));this._store_connects=h}},_onFetchBegin:function(b,
h){this.scroller&&(this.rowCount!=b&&(h.isRender?(this.scroller.init(b,this.keepRows,this.rowsPerPage),this.rowCount=b,this._setAutoHeightAttr(this.autoHeight,!0),this._skipRowRenormalize=!0,this.prerender(),this._skipRowRenormalize=!1):this.updateRowCount(b)),b?this.showMessage():(this.views.render(),this._resize(),this.showMessage(this.noDataMessage),this.focus.initFocusView()))},_onFetchComplete:function(b,h){this.scroller&&(b&&0<b.length&&(A.forEach(b,function(n,m){this._addItem(n,h.start+m,!0)},
this),this.updateRows(h.start,b.length),h.isRender?(this.setScrollTop(0),this.postrender()):this._lastScrollTop&&this.setScrollTop(this._lastScrollTop),t("ie")&&k.setSelectable(this.domNode,this.selectable)),delete this._lastScrollTop,this._isLoaded||(this._isLoading=!1,this._isLoaded=!0),this._pending_requests[h.start]=!1)},_onFetchError:function(b,h){console.log(b);delete this._lastScrollTop;this._isLoaded||(this._isLoading=!1,this._isLoaded=!0,this.showMessage(this.errorMessage));this._pending_requests[h.start]=
!1;this.onFetchError(b,h)},onFetchError:function(b,h){},_fetch:function(b,h){b=b||0;if(this.store&&!this._pending_requests[b]){this._isLoaded||this._isLoading||(this._isLoading=!0,this.showMessage(this.loadingMessage));this._pending_requests[b]=!0;try{if(this.items){var n=this.items,m=this.store;this.rowsPerPage=n.length;var g={start:b,count:this.rowsPerPage,isRender:h};this._onFetchBegin(n.length,g);var a=0;A.forEach(n,function(e){m.isItemLoaded(e)||a++});if(0===a)this._onFetchComplete(n,g);else{var f=
function(e){a--;0===a&&this._onFetchComplete(n,g)};A.forEach(n,function(e){m.isItemLoaded(e)||m.loadItem({item:e,onItem:f,scope:this})},this)}}else this.store.fetch({start:b,count:this.rowsPerPage,query:this.query,sort:this.getSortProps(),queryOptions:this.queryOptions,isRender:h,onBegin:B.hitch(this,"_onFetchBegin"),onComplete:B.hitch(this,"_onFetchComplete"),onError:B.hitch(this,"_onFetchError")})}catch(e){this._onFetchError(e,{start:b,count:this.rowsPerPage})}}},_clearData:function(){this.updateRowCount(0);
this._by_idty={};this._by_idx=[];this._pages=[];this._bop=this._eop=-1;this._isLoading=this._isLoaded=!1},getItem:function(b){var h=this._by_idx[b];return!h||h&&!h.item?(this._preparePage(b),null):h.item},getItemIndex:function(b){return this._getItemIndex(b,!1)},_getItemIndex:function(b,h){if(!h&&!this.store.isItem(b))return-1;h=this._hasIdentity?this.store.getIdentity(b):null;for(var n=0,m=this._by_idx.length;n<m;n++){var g=this._by_idx[n];if(g&&(h&&g.idty==h||g.item===b))return n}return-1},filter:function(b,
h){this.query=b;h&&this._clearData();this._fetch()},_getItemAttr:function(b,h){return(b=this.getItem(b))?this.store.getValue(b,h):this.fetchText},_render:function(){this.domNode.parentNode&&(this.scroller.init(this.get("rowCount"),this.keepRows,this.rowsPerPage),this.prerender(),this._fetch(0,!0))},_requestsPending:function(b){return this._pending_requests[b]},_rowToPage:function(b){return this.rowsPerPage?Math.floor(b/this.rowsPerPage):b},_pageToRow:function(b){return this.rowsPerPage?this.rowsPerPage*
b:b},_preparePage:function(b){(b<this._bop||b>=this._eop)&&!this._addingItem&&(b=this._rowToPage(b),this._needPage(b),this._bop=b*this.rowsPerPage,this._eop=this._bop+(this.rowsPerPage||this.get("rowCount")))},_needPage:function(b){this._pages[b]||(this._pages[b]=!0,this._requestPage(b))},_requestPage:function(b){b=this._pageToRow(b);0<Math.min(this.rowsPerPage,this.get("rowCount")-b)&&(this._requests++,this._requestsPending(b)||setTimeout(B.hitch(this,"_fetch",b,!1),1))},getCellName:function(b){return b.field},
_refresh:function(b){this._clearData();this._fetch(0,b)},sort:function(){this.edit.apply();this._lastScrollTop=this.scrollTop;this._refresh()},canSort:function(){return!this._isLoading},getSortProps:function(){var b=this.getCell(this.getSortIndex());if(b){var h=b.sortDesc,n=!(0<this.sortInfo);return[{attribute:b.field,descending:"undefined"==typeof h?n:n?!h:h}]}return this.sortFields?this.sortFields:null},styleRowState:function(b){if(this.store&&this.store.getState){for(var h=this.store.getState(b.index),
n="",m=0,g=["inflight","error","inserting"],a;a=g[m];m++)if(h[a]){n=" dojoxGridRow-"+a;break}b.customClasses+=n}},onStyleRow:function(b){this.styleRowState(b);this.inherited(arguments)},canEdit:function(b,h){return this._canEdit},_copyAttr:function(b,h){b=this.getItem(b);return this.store.getValue(b,h)},doStartEdit:function(b,h){this._cache[h]||(this._cache[h]=this._copyAttr(h,b.field));this.onStartEdit(b,h)},doApplyCellEdit:function(b,h,n){this.store.fetchItemByIdentity({identity:this._by_idx[h].idty,
onItem:B.hitch(this,function(m){var g=this.store.getValue(m,n);"number"==typeof g?b=isNaN(b)?b:parseFloat(b):"boolean"==typeof g?b="true"==b?!0:"false"==b?!1:b:g instanceof Date&&(g=new Date(b),b=isNaN(g.getTime())?b:g);this.store.setValue(m,n,b);this.onApplyCellEdit(b,h,n)})})},doCancelEdit:function(b){this._cache[b]&&(this.updateRow(b),delete this._cache[b]);this.onCancelEdit.apply(this,arguments)},doApplyEdit:function(b,h){this.onApplyEdit(b)},removeSelectedRows:function(){if(this._canEdit){this.edit.apply();
var b=B.hitch(this,function(h){h.length&&(A.forEach(h,this.store.deleteItem,this.store),this.selection.clear())});this.allItemsSelected?this.store.fetch({query:this.query,queryOptions:this.queryOptions,onComplete:b}):b(this.selection.getSelected())}}});c.cell_markupFactory=function(b,h,n){var m=B.trim(k.attr(h,"field")||"");m&&(n.field=m);n.field=n.field||n.name;if(m=B.trim(k.attr(h,"fields")||""))n.fields=m.split(",");b&&b(h,n)};c.markupFactory=function(b,h,n,m){return p.markupFactory(b,h,n,B.partial(c.cell_markupFactory,
m))};return c})},"dojox/grid/_Grid":function(){define("dojo/_base/kernel ../main dojo/_base/declare ./_Events ./_Scroller ./_Layout ./_View ./_ViewManager ./_RowManager ./_FocusManager ./_EditManager ./Selection ./_RowSelector ./util dijit/_Widget dijit/_TemplatedMixin dijit/CheckedMenuItem dojo/text!./resources/_Grid.html dojo/string dojo/_base/array dojo/_base/lang dojo/_base/sniff dojox/html/metrics dojo/_base/html dojo/query dojo/dnd/common dojo/i18n!dijit/nls/loading".split(" "),function(G,A,
B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e,r,w,H,x,q,C,F){G.isCopyKey||(G.isCopyKey=G.dnd.getCopyKeyState);B=B("dojox.grid._Grid",[g,a,v],{templateString:e,classTag:"dojoxGrid",rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:!1,initialWidth:"",autoHeight:"",rowHeight:0,autoRender:!0,defaultHeight:"15em",height:"",structure:null,elasticView:-1,singleClickEdit:!1,selectionMode:"extended",rowSelector:"",columnReordering:!1,headerMenu:null,placeholderLabel:"GridColumns",selectable:!1,_click:null,loadingMessage:"\x3cspan class\x3d'dojoxGridLoading'\x3e${loadingState}\x3c/span\x3e",
errorMessage:"\x3cspan class\x3d'dojoxGridError'\x3e${errorState}\x3c/span\x3e",noDataMessage:"",escapeHTMLInData:!0,formatterScope:null,editable:!1,summary:"",_setSummaryAttr:"domNode",sortInfo:0,_placeholders:null,_layoutClass:l,buildRendering:function(){this.inherited(arguments);this.domNode.getAttribute("tabIndex")||(this.domNode.tabIndex="0");this.createScroller();this.createLayout();this.createViews();this.createManagers();this.createSelection();this.connect(this.selection,"onSelected","onSelected");
this.connect(this.selection,"onDeselected","onDeselected");this.connect(this.selection,"onChanged","onSelectionChanged");q.initOnFontResize();this.connect(q,"onFontResize","textSizeChanged");m.funnelEvents(this.domNode,this,"doKeyEvent",m.keyEvents);"none"!=this.selectionMode&&this.domNode.setAttribute("aria-multiselectable","single"==this.selectionMode?"false":"true");C.addClass(this.domNode,this.classTag);this.isLeftToRight()||C.addClass(this.domNode,this.classTag+"Rtl");0<this.rowHeight&&C.addClass(this.viewsNode,
this.classTag+"FixedRowHeight")},postMixInProperties:function(){this.inherited(arguments);var u=G.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=r.substitute(this.loadingMessage,u);this.errorMessage=r.substitute(this.errorMessage,u);this.srcNodeRef&&this.srcNodeRef.style.height&&(this.height=this.srcNodeRef.style.height);this._setAutoHeightAttr(this.autoHeight,!0);this.lastScrollTop=this.scrollTop=0},postCreate:function(){this._placeholders=[];this._setHeaderMenuAttr(this.headerMenu);
this._setStructureAttr(this.structure);this._click=[];this.inherited(arguments);this.domNode&&this.autoWidth&&this.initialWidth&&(this.domNode.style.width=this.initialWidth);this.domNode&&!this.editable&&C.attr(this.domNode,"aria-readonly","true")},destroy:function(){this.domNode.onReveal=null;this.domNode.onSizeChange=null;delete this._click;this.scroller&&(this.scroller.destroy(),delete this.scroller);this.edit.destroy();delete this.edit;this.views.destroyViews();this.focus&&(this.focus.destroy(),
delete this.focus);this.headerMenu&&this._placeholders.length&&(w.forEach(this._placeholders,function(u){u.unReplace(!0)}),this.headerMenu.unBindDomNode(this.viewsHeaderNode));this.inherited(arguments)},_setAutoHeightAttr:function(u,E){"string"==typeof u&&(u=u&&"false"!=u?"true"==u?!0:window.parseInt(u,10):!1);"number"==typeof u&&(isNaN(u)&&(u=!1),0>u?u=!0:0===u&&(u=!1));this.autoHeight=u;this._autoHeight="boolean"==typeof u?u:"number"==typeof u?u>=this.get("rowCount"):!1;this._started&&!E&&this.render()},
_getRowCountAttr:function(){return this.updating&&this.invalidated&&void 0!=this.invalidated.rowCount?this.invalidated.rowCount:this.rowCount},textSizeChanged:function(){this.render()},sizeChange:function(){this.update()},createManagers:function(){this.rows=new k(this);this.focus=new c(this);this.edit=new b(this)},createSelection:function(){this.selection=new h(this)},createScroller:function(){this.scroller=new t;this.scroller.grid=this;this.scroller.renderRow=H.hitch(this,"renderRow");this.scroller.removeRow=
H.hitch(this,"rowRemoved")},createLayout:function(){this.layout=new this._layoutClass(this);this.connect(this.layout,"moveColumn","onMoveColumn")},onMoveColumn:function(){this.update()},onResizeColumn:function(u){},createViews:function(){this.views=new d(this);this.views.createView=H.hitch(this,"createView")},createView:function(u,E){u=new (H.getObject(u))({grid:this,index:E});this.viewsNode.appendChild(u.domNode);this.viewsHeaderNode.appendChild(u.headerNode);this.views.addView(u);C.attr(this.domNode,
"align",this.isLeftToRight()?"left":"right");return u},buildViews:function(){for(var u=0,E;E=this.layout.structure[u];u++)this.createView(E.type||A._scopeName+".grid._View",u).setStructure(E);this.scroller.setContentNodes(this.views.getContentNodes())},_setStructureAttr:function(u){u&&H.isString(u)&&(G.deprecated("dojox.grid._Grid.set('structure', 'objVar')","use dojox.grid._Grid.set('structure', objVar) instead","2.0"),u=H.getObject(u));this.structure=u;if(!u)if(this.layout.structure)u=this.layout.structure;
else return;this.views.destroyViews();this.focus.focusView=null;u!==this.layout.structure&&this.layout.setStructure(u);this._structureChanged()},setStructure:function(u){G.deprecated("dojox.grid._Grid.setStructure(obj)","use dojox.grid._Grid.set('structure', obj) instead.","2.0");this._setStructureAttr(u)},getColumnTogglingItems:function(){var u=[];var E=w.map(this.layout.cells,function(D){D.menuItems||(D.menuItems=[]);var M=this,I=new f({label:D.name,checked:!D.hidden,_gridCell:D,onChange:function(z){if(M.layout.setColumnVisibility(this._gridCell.index,
z)){var K=this._gridCell.menuItems;1<K.length&&w.forEach(K,function(L){L!==this&&L.setAttribute("checked",z)},this);z=w.filter(M.layout.cells,function(L){1<L.menuItems.length?w.forEach(L.menuItems,"item.set('disabled', false);"):L.menuItems[0].set("disabled",!1);return!L.hidden});1==z.length&&w.forEach(z[0].menuItems,"item.set('disabled', true);")}},destroy:function(){var z=w.indexOf(this._gridCell.menuItems,this);this._gridCell.menuItems.splice(z,1);delete this._gridCell;f.prototype.destroy.apply(this,
arguments)}});D.menuItems.push(I);D.hidden||u.push(I);return I},this);1==u.length&&u[0].set("disabled",!0);return E},_setHeaderMenuAttr:function(u){this._placeholders&&this._placeholders.length&&(w.forEach(this._placeholders,function(E){E.unReplace(!0)}),this._placeholders=[]);this.headerMenu&&this.headerMenu.unBindDomNode(this.viewsHeaderNode);if(this.headerMenu=u)this.headerMenu.bindDomNode(this.viewsHeaderNode),this.headerMenu.getPlaceholders&&(this._placeholders=this.headerMenu.getPlaceholders(this.placeholderLabel))},
setHeaderMenu:function(u){G.deprecated("dojox.grid._Grid.setHeaderMenu(obj)","use dojox.grid._Grid.set('headerMenu', obj) instead.","2.0");this._setHeaderMenuAttr(u)},setupHeaderMenu:function(){this._placeholders&&this._placeholders.length&&w.forEach(this._placeholders,function(u){u._replaced&&u.unReplace(!0);u.replace(this.getColumnTogglingItems())},this)},_fetch:function(u){this.setScrollTop(0)},getItem:function(u){return null},showMessage:function(u){u?(this.messagesNode.innerHTML=u,this.messagesNode.style.display=
""):(this.messagesNode.innerHTML="",this.messagesNode.style.display="none")},_structureChanged:function(){this.buildViews();this.autoRender&&this._started&&this.render()},hasLayout:function(){return this.layout.cells.length},resize:function(u,E){this._pendingChangeSize=u;this._pendingResultSize=E;this.sizeChange()},_getPadBorder:function(){return this._padBorder=this._padBorder||C._getPadBorderExtents(this.domNode)},_getHeaderHeight:function(){var u=this.viewsHeaderNode.style,E="none"==u.display?
0:this.views.measureHeader();u.height=E+"px";this.views.normalizeHeaderNodeHeight();return E},_resize:function(u,E){u=u||this._pendingChangeSize;E=E||this._pendingResultSize;delete this._pendingChangeSize;delete this._pendingResultSize;if(this.domNode){var D=this.domNode.parentNode;if(D&&1==D.nodeType&&this.hasLayout()&&"hidden"!=D.style.visibility&&"none"!=D.style.display){var M=this._getPadBorder(),I=void 0;if(this._autoHeight)this.domNode.style.height="auto";else if("number"==typeof this.autoHeight){var z=
I=this._getHeaderHeight();z+=this.scroller.averageRowHeight*this.autoHeight;this.domNode.style.height=z+"px"}else this.domNode.clientHeight<=M.h&&(D==document.body?this.domNode.style.height=this.defaultHeight:this.height?this.domNode.style.height=this.height:this.fitTo="parent");E&&(u=E);!this._autoHeight&&u?(C.marginBox(this.domNode,u),this.height=this.domNode.style.height,delete this.fitTo):"parent"==this.fitTo&&(z=this._parentContentBoxHeight=0<this._parentContentBoxHeight?this._parentContentBoxHeight:
C._getContentBox(D).h,this.domNode.style.height=Math.max(0,z)+"px");u=w.some(this.views.views,function(K){return K.flexCells});this._autoHeight||0!==(z||C._getContentBox(this.domNode).h)?(this.viewsHeaderNode.style.display="block",u||void 0!==I||(I=this._getHeaderHeight())):this.viewsHeaderNode.style.display="none";u&&(I=void 0);this.adaptWidth();this.adaptHeight(I);this.postresize()}}},adaptWidth:function(){var u=!this.initialWidth&&this.autoWidth,E=u?0:this.domNode.clientWidth||this.domNode.offsetWidth-
this._getPadBorder().w;E=this.views.arrange(1,E);this.views.onEach("adaptWidth");u&&(this.domNode.style.width=E+"px")},adaptHeight:function(u){u=void 0===u?this._getHeaderHeight():u;var E=this._autoHeight?-1:Math.max(this.domNode.clientHeight-u,0)||0;this.views.onEach("setSize",[0,E]);this.views.onEach("adaptHeight");if(!this._autoHeight){var D=0,M=0,I=w.filter(this.views.views,function(z){(z=z.hasHScrollbar())?D++:M++;return!z});0<D&&0<M&&w.forEach(I,function(z){z.adaptHeight(!0)})}!0===this.autoHeight||
-1!=E||"number"==typeof this.autoHeight&&this.autoHeight>=this.get("rowCount")?this.scroller.windowHeight=E:this.scroller.windowHeight=Math.max(this.domNode.clientHeight-u,0)},startup:function(){this._started||(this.inherited(arguments),this.autoRender&&this.render())},render:function(){this.domNode&&this._started&&(this.hasLayout()?(this.update=this.defaultUpdate,this._render()):this.scroller.init(0,this.keepRows,this.rowsPerPage))},_render:function(){this.scroller.init(this.get("rowCount"),this.keepRows,
this.rowsPerPage);this.prerender();this.setScrollTop(0);this.postrender()},prerender:function(){this.keepRows=this._autoHeight?0:this.keepRows;this.scroller.setKeepInfo(this.keepRows);this.views.render();this._resize()},postrender:function(){this.postresize();this.focus.initFocusView();C.setSelectable(this.domNode,this.selectable)},postresize:function(){if(this._autoHeight){var u=Math.max(this.views.measureContent())+"px";this.viewsNode.style.height=u}},renderRow:function(u,E){this.views.renderRow(u,
E,this._skipRowRenormalize)},rowRemoved:function(u){this.views.rowRemoved(u)},invalidated:null,updating:!1,beginUpdate:function(){this.invalidated=[];this.updating=!0},endUpdate:function(){this.updating=!1;var u=this.invalidated,E;if(u.all)this.update();else if(void 0!=u.rowCount)this.updateRowCount(u.rowCount);else for(E in u)this.updateRow(Number(E));this.invalidated=[]},defaultUpdate:function(){this.domNode&&(this.updating?this.invalidated.all=!0:(this.lastScrollTop=this.scrollTop,this.prerender(),
this.scroller.invalidateNodes(),this.setScrollTop(this.lastScrollTop),this.postrender()))},update:function(){this.render()},updateRow:function(u){u=Number(u);this.updating?this.invalidated[u]=!0:(this.views.updateRow(u),this.scroller.rowHeightChanged(u))},updateRows:function(u,E){u=Number(u);E=Number(E);var D;if(this.updating)for(D=0;D<E;D++)this.invalidated[D+u]=!0;else{for(D=0;D<E;D++)this.views.updateRow(D+u,this._skipRowRenormalize);this.scroller.rowHeightChanged(u)}},updateRowCount:function(u){this.updating?
this.invalidated.rowCount=u:(this.rowCount=u,this._setAutoHeightAttr(this.autoHeight,!0),this.layout.cells.length&&this.scroller.updateRowCount(u),this.layout.cells.length&&this.setScrollTop(this.scrollTop),this._resize())},updateRowStyles:function(u){this.views.updateRowStyles(u)},getRowNode:function(u){if(!this.focus.focusView||this.focus.focusView instanceof n)for(var E=0,D;D=this.views.views[E];E++){if(!(D instanceof n))return D.rowNodes[u]}else return this.focus.focusView.rowNodes[u];return null},
rowHeightChanged:function(u){this.views.renormalizeRow(u);this.scroller.rowHeightChanged(u)},fastScroll:!0,delayScroll:!1,scrollRedrawThreshold:x("ie")?100:50,scrollTo:function(u){if(this.fastScroll){var E=Math.abs(this.lastScrollTop-u);this.lastScrollTop=u;if(E>this.scrollRedrawThreshold||this.delayScroll){this.delayScroll=!0;this.scrollTop=u;this.views.setScrollTop(u);this._pendingScroll&&window.clearTimeout(this._pendingScroll);var D=this;this._pendingScroll=window.setTimeout(function(){delete D._pendingScroll;
D.finishScrollJob()},200)}else this.setScrollTop(u)}else this.setScrollTop(u)},finishScrollJob:function(){this.delayScroll=!1;this.setScrollTop(this.scrollTop)},setScrollTop:function(u){this.scroller.scroll(this.views.setScrollTop(u))},scrollToRow:function(u){this.setScrollTop(this.scroller.findScrollTop(u)+1)},styleRowNode:function(u,E){E&&this.rows.styleRowNode(u,E)},_mouseOut:function(u){this.rows.setOverRow(-2)},getCell:function(u){return this.layout.cells[u]},setCellWidth:function(u,E){this.getCell(u).unitWidth=
E},getCellName:function(u){return"Cell "+u.index},canSort:function(u){},sort:function(){},getSortAsc:function(u){u=void 0==u?this.sortInfo:u;return 0<u},getSortIndex:function(u){u=void 0==u?this.sortInfo:u;return Math.abs(u)-1},setSortIndex:function(u,E){var D=u+1;void 0!=E?D*=E?1:-1:this.getSortIndex()==u&&(D=-this.sortInfo);this.setSortInfo(D)},setSortInfo:function(u){this.canSort(u)&&(this.sortInfo=u,this.sort(),this.update())},doKeyEvent:function(u){u.dispatch="do"+u.type;this.onKeyEvent(u)},
_dispatch:function(u,E){return u in this?this[u](E):!1},dispatchKeyEvent:function(u){this._dispatch(u.dispatch,u)},dispatchContentEvent:function(u){this.edit.dispatchEvent(u)||u.sourceView.dispatchContentEvent(u)||this._dispatch(u.dispatch,u)},dispatchHeaderEvent:function(u){u.sourceView.dispatchHeaderEvent(u)||this._dispatch("doheader"+u.type,u)},dokeydown:function(u){this.onKeyDown(u)},doclick:function(u){if(u.cellNode)this.onCellClick(u);else this.onRowClick(u)},dodblclick:function(u){if(u.cellNode)this.onCellDblClick(u);
else this.onRowDblClick(u)},docontextmenu:function(u){if(u.cellNode)this.onCellContextMenu(u);else this.onRowContextMenu(u)},doheaderclick:function(u){if(u.cellNode)this.onHeaderCellClick(u);else this.onHeaderClick(u)},doheaderdblclick:function(u){if(u.cellNode)this.onHeaderCellDblClick(u);else this.onHeaderDblClick(u)},doheadercontextmenu:function(u){if(u.cellNode)this.onHeaderCellContextMenu(u);else this.onHeaderContextMenu(u)},doStartEdit:function(u,E){this.onStartEdit(u,E)},doApplyCellEdit:function(u,
E,D){this.onApplyCellEdit(u,E,D)},doCancelEdit:function(u){this.onCancelEdit(u)},doApplyEdit:function(u){this.onApplyEdit(u)},addRow:function(){this.updateRowCount(this.get("rowCount")+1)},removeSelectedRows:function(){this.allItemsSelected?this.updateRowCount(0):this.updateRowCount(Math.max(0,this.get("rowCount")-this.selection.getSelected().length));this.selection.clear()}});B.markupFactory=function(u,E,D,M){var I=function(z){z=C.attr(z,"width")||"auto";"auto"!=z&&"em"!=z.slice(-2)&&"%"!=z.slice(-1)&&
(z=parseInt(z,10)+"px");return z};u.structure||"table"!=E.nodeName.toLowerCase()||(u.structure=F("\x3e colgroup",E).map(function(z){var K=C.attr(z,"span");K={noscroll:"true"==C.attr(z,"noscroll")?!0:!1,__span:K?parseInt(K,10):1,cells:[]};C.hasAttr(z,"width")&&(K.width=I(z));return K}),u.structure.length||u.structure.push({__span:Infinity,cells:[]}),F("thead \x3e tr",E).forEach(function(z,K){var L=0,N=0,P,T=null;F("\x3e th",z).map(function(S){T?L>=P+T.__span&&(N++,P+=T.__span,T=u.structure[N]):(P=
0,T=u.structure[0]);var Z={name:H.trim(C.attr(S,"name")||S.innerHTML),colSpan:parseInt(C.attr(S,"colspan")||1,10),type:H.trim(C.attr(S,"cellType")||""),id:H.trim(C.attr(S,"id")||"")};L+=Z.colSpan;var da=C.attr(S,"rowspan");da&&(Z.rowSpan=da);C.hasAttr(S,"width")&&(Z.width=I(S));C.hasAttr(S,"relWidth")&&(Z.relWidth=window.parseInt(C.attr(S,"relWidth"),10));C.hasAttr(S,"hidden")&&(Z.hidden="true"==C.attr(S,"hidden")||!0===C.attr(S,"hidden"));M&&M(S,Z);Z.type=Z.type?H.getObject(Z.type):A.grid.cells.Cell;
Z.type&&Z.type.markupFactory&&Z.type.markupFactory(S,Z);T.cells[K]||(T.cells[K]=[]);T.cells[K].push(Z)})}));return new D(u,E)};return B})},"dojox/grid/_Events":function(){define(["dojo/keys","dojo/dom-class","dojo/_base/declare","dojo/_base/event","dojo/_base/sniff"],function(G,A,B,v,t){return B("dojox.grid._Events",null,{cellOverClass:"dojoxGridCellOver",onKeyEvent:function(l){this.dispatchKeyEvent(l)},onContentEvent:function(l){this.dispatchContentEvent(l)},onHeaderEvent:function(l){this.dispatchHeaderEvent(l)},
onStyleRow:function(l){l.customClasses+=(l.odd?" dojoxGridRowOdd":"")+(l.selected?" dojoxGridRowSelected":"")+(l.over?" dojoxGridRowOver":"");this.focus.styleRow(l);this.edit.styleRow(l)},onKeyDown:function(l){if(!l.altKey&&!l.metaKey)switch(l.keyCode){case G.ESCAPE:this.edit.cancel();break;case G.ENTER:if(!this.edit.isEditing()){var p=this.focus.getHeaderIndex();if(0<=p){this.setSortIndex(p);break}else this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(l),l.shiftKey);v.stop(l)}l.shiftKey||
(p=this.edit.isEditing(),this.edit.apply(),p||this.edit.setEditCell(this.focus.cell,this.focus.rowIndex));this.edit.isEditing()||((this.focus.focusView||this.views.views[0]).content.decorateEvent(l),this.onRowClick(l),v.stop(l));break;case G.SPACE:this.edit.isEditing()||(p=this.focus.getHeaderIndex(),0<=p?this.setSortIndex(p):(this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(l),l.shiftKey),this.focus._focusifyCellNode(!0),this.focus.setFocusCell(this.focus.cell,this.focus.rowIndex),v.stop(l)));
break;case G.TAB:this.focus[l.shiftKey?"previousKey":"nextKey"](l);break;case G.LEFT_ARROW:case G.RIGHT_ARROW:if(!this.edit.isEditing()){var d=l.keyCode;v.stop(l);p=this.focus.getHeaderIndex();0<=p&&l.shiftKey&&l.ctrlKey?this.focus.colSizeAdjust(l,p,5*(d==G.LEFT_ARROW?-1:1)):(l=d==G.LEFT_ARROW?1:-1,this.isLeftToRight()&&(l*=-1),this.focus.move(0,l))}break;case G.UP_ARROW:this.edit.isEditing()||0===this.focus.rowIndex||(v.stop(l),this.focus.move(-1,0));break;case G.DOWN_ARROW:this.edit.isEditing()||
this.focus.rowIndex+1==this.rowCount||(v.stop(l),this.focus.move(1,0));break;case G.PAGE_UP:this.edit.isEditing()||0===this.focus.rowIndex||(v.stop(l),this.focus.rowIndex!=this.scroller.firstVisibleRow+1?this.focus.move(this.scroller.firstVisibleRow-this.focus.rowIndex,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex-1)),this.focus.move(this.scroller.firstVisibleRow-this.scroller.lastVisibleRow+1,0)));break;case G.PAGE_DOWN:this.edit.isEditing()||this.focus.rowIndex+1==this.rowCount||
(v.stop(l),this.focus.rowIndex!=this.scroller.lastVisibleRow-1?this.focus.move(this.scroller.lastVisibleRow-this.focus.rowIndex-1,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex+1)),this.focus.move(this.scroller.lastVisibleRow-this.scroller.firstVisibleRow-1,0)))}},onMouseOver:function(l){-1==l.rowIndex?this.onHeaderCellMouseOver(l):this.onCellMouseOver(l)},onMouseOut:function(l){-1==l.rowIndex?this.onHeaderCellMouseOut(l):this.onCellMouseOut(l)},onMouseDown:function(l){-1==
l.rowIndex?this.onHeaderCellMouseDown(l):this.onCellMouseDown(l)},onMouseOverRow:function(l){this.rows.isOver(l.rowIndex)||(this.rows.setOverRow(l.rowIndex),-1==l.rowIndex?this.onHeaderMouseOver(l):this.onRowMouseOver(l))},onMouseOutRow:function(l){if(this.rows.isOver(-1))this.onHeaderMouseOut(l);else this.rows.isOver(-2)||(this.rows.setOverRow(-2),this.onRowMouseOut(l))},onMouseDownRow:function(l){if(-1!=l.rowIndex)this.onRowMouseDown(l)},onCellMouseOver:function(l){l.cellNode&&A.add(l.cellNode,
this.cellOverClass)},onCellMouseOut:function(l){l.cellNode&&A.remove(l.cellNode,this.cellOverClass)},onCellMouseDown:function(l){},onCellClick:function(l){this._click[0]=this._click[1];this._click[1]=l;this.edit.isEditCell(l.rowIndex,l.cellIndex)||this.focus.setFocusCell(l.cell,l.rowIndex);1<this._click.length&&null==this._click[0]&&this._click.shift();this.onRowClick(l)},onCellDblClick:function(l){var p=1<this._click.length&&t("ie")?this._click[1]:1<this._click.length&&this._click[0].rowIndex!=this._click[1].rowIndex?
this._click[0]:l;this.focus.setFocusCell(p.cell,p.rowIndex);this.edit.setEditCell(p.cell,p.rowIndex);this.onRowDblClick(l)},onCellContextMenu:function(l){this.onRowContextMenu(l)},onCellFocus:function(l,p){this.edit.cellFocus(l,p)},onRowClick:function(l){this.edit.rowClick(l);this.selection.clickSelectEvent(l)},onRowDblClick:function(l){},onRowMouseOver:function(l){},onRowMouseOut:function(l){},onRowMouseDown:function(l){},onRowContextMenu:function(l){v.stop(l)},onHeaderMouseOver:function(l){},onHeaderMouseOut:function(l){},
onHeaderCellMouseOver:function(l){l.cellNode&&A.add(l.cellNode,this.cellOverClass)},onHeaderCellMouseOut:function(l){l.cellNode&&A.remove(l.cellNode,this.cellOverClass)},onHeaderCellMouseDown:function(l){},onHeaderClick:function(l){},onHeaderCellClick:function(l){this.setSortIndex(l.cell.index);this.onHeaderClick(l)},onHeaderDblClick:function(l){},onHeaderCellDblClick:function(l){this.onHeaderDblClick(l)},onHeaderCellContextMenu:function(l){this.onHeaderContextMenu(l)},onHeaderContextMenu:function(l){this.headerMenu||
v.stop(l)},onStartEdit:function(l,p){},onApplyCellEdit:function(l,p,d){},onCancelEdit:function(l){},onApplyEdit:function(l){},onCanSelect:function(l){return!0},onCanDeselect:function(l){return!0},onSelected:function(l){this.updateRowStyles(l)},onDeselected:function(l){this.updateRowStyles(l)},onSelectionChanged:function(){}})})},"dojox/grid/_Scroller":function(){define(["dijit/registry","dojo/_base/declare","dojo/_base/lang","./util","dojo/_base/html"],function(G,A,B,v,t){var l=function(d){d&&dojo.forEach(G.toArray(),
function(k){k.domNode&&t.isDescendant(k.domNode,d,!0)&&k.destroy()})},p=function(d,k){for(var c=[],b=0,h;h=d.childNodes[b];){b++;var n=t.byId(h);(n&&n.tagName?n.tagName.toLowerCase():"")==k&&c.push(h)}return c};return A("dojox.grid._Scroller",null,{constructor:function(d){this.setContentNodes(d);this.pageHeights=[];this.pageNodes=[];this.stack=[]},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,
lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(d,k,c){switch(arguments.length){case 3:this.rowsPerPage=c;case 2:this.keepRows=k;case 1:this.rowCount=d}this.defaultPageHeight=(0<this.grid.rowHeight?this.grid.rowHeight:this.defaultRowHeight)*this.rowsPerPage;this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);this.setKeepInfo(this.keepRows);this.invalidate();this.scrollboxNode&&(this.scrollboxNode.scrollTop=0,this.scroll(0),this.scrollboxNode.onscroll=B.hitch(this,
"onscroll"))},_getPageCount:function(d,k){return d?Math.ceil(d/k)||1:0},destroy:function(){this.invalidateNodes();delete this.contentNodes;delete this.contentNode;delete this.scrollboxNode},setKeepInfo:function(d){this.keepPages=(this.keepRows=d)?Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2):this.keepPages},setContentNodes:function(d){this.colCount=(this.contentNodes=d)?this.contentNodes.length:0;this.pageNodes=[];for(d=0;d<this.colCount;d++)this.pageNodes[d]=[]},getDefaultNodes:function(){return this.pageNodes[0]||
[]},invalidate:function(){this._invalidating=!0;this.invalidateNodes();this.pageHeights=[];this.height=this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0;this.resize();this._invalidating=!1},updateRowCount:function(d){this.invalidateNodes();this.rowCount=d;d=this.pageCount;0===d&&(this.height=1);this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);if(this.pageCount<d)for(--d;d>=this.pageCount;d--)this.height-=this.getPageHeight(d),delete this.pageHeights[d];
else this.pageCount>d&&(this.height+=this.defaultPageHeight*(this.pageCount-d-1)+this.calcLastPageHeight());this.resize()},pageExists:function(d){return!!this.getDefaultPageNode(d)},measurePage:function(d){return this.grid.rowHeight?((d+1)*this.rowsPerPage>this.rowCount?this.rowCount-d*this.rowsPerPage:this.rowsPerPage)*this.grid.rowHeight:(d=this.getDefaultPageNode(d))&&d.innerHTML?d.offsetHeight:void 0},positionPage:function(d,k){for(var c=0;c<this.colCount;c++)this.pageNodes[c][d].style.top=k+
"px"},repositionPages:function(d){for(var k=this.getDefaultNodes(),c=0,b=0;b<this.stack.length;b++)c=Math.max(this.stack[b],c);var h=(b=k[d])?this.getPageNodePosition(b)+this.getPageHeight(d):0;for(d+=1;d<=c;d++){if(b=k[d]){if(this.getPageNodePosition(b)==h)break;this.positionPage(d,h)}h+=this.getPageHeight(d)}},installPage:function(d){for(var k=0;k<this.colCount;k++)this.contentNodes[k].appendChild(this.pageNodes[k][d])},preparePage:function(d,k){k=k?this.popPage():null;for(var c=0;c<this.colCount;c++){var b=
this.pageNodes[c],h=null===k?this.createPageNode():this.invalidatePageNode(k,b);h.pageIndex=d;b[d]=h}},renderPage:function(d){var k=[],c;for(c=0;c<this.colCount;c++)k[c]=this.pageNodes[c][d];c=0;for(d*=this.rowsPerPage;c<this.rowsPerPage&&d<this.rowCount;c++,d++)this.renderRow(d,k)},removePage:function(d){var k=0;for(d*=this.rowsPerPage;k<this.rowsPerPage;k++,d++)this.removeRow(d)},destroyPage:function(d){for(var k=0;k<this.colCount;k++){var c=this.invalidatePageNode(d,this.pageNodes[k]);c&&t.destroy(c)}},
pacify:function(d){},pacifying:!1,pacifyTicks:200,setPacifying:function(d){this.pacifying!=d&&(this.pacifying=d,this.pacify(this.pacifying))},startPacify:function(){this.startPacifyTicks=(new Date).getTime()},doPacify:function(){var d=(new Date).getTime()-this.startPacifyTicks>this.pacifyTicks;this.setPacifying(!0);this.startPacify();return d},endPacify:function(){this.setPacifying(!1)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight);for(var d=0;d<this.colCount;d++)v.setStyleHeightPx(this.contentNodes[d],
Math.max(1,this.height));d=!this._invalidating;if(!d){var k=this.grid.get("autoHeight");"number"==typeof k&&k<=Math.min(this.rowsPerPage,this.rowCount)&&(d=!0)}d&&this.needPage(this.page,this.pageTop);d=this.page<this.pageCount-1?this.rowsPerPage:this.rowCount%this.rowsPerPage||this.rowsPerPage;k=this.getPageHeight(this.page);this.averageRowHeight=0<k&&0<d?k/d:0},calcLastPageHeight:function(){if(!this.pageCount)return 0;var d=(this.rowCount%this.rowsPerPage||this.rowsPerPage)*this.defaultRowHeight;
return this.pageHeights[this.pageCount-1]=d},updateContentHeight:function(d){this.height+=d;this.resize()},updatePageHeight:function(d,k,c){if(this.pageExists(d)){var b=this.getPageHeight(d),h=this.measurePage(d);void 0===h&&(h=b);this.pageHeights[d]=h;if(b!=h){this.updateContentHeight(h-b);var n=this.grid.get("autoHeight");"number"==typeof n&&n>this.rowCount||!0===n&&!k?c?(k=this.grid.viewsNode.style,k.height=parseInt(k.height)+h-b+"px",this.repositionPages(d)):this.grid.sizeChange():this.repositionPages(d)}return h}return 0},
rowHeightChanged:function(d,k){this.updatePageHeight(Math.floor(d/this.rowsPerPage),!1,k)},invalidateNodes:function(){for(;this.stack.length;)this.destroyPage(this.popPage())},createPageNode:function(){var d=document.createElement("div");t.attr(d,"role","presentation");d.style.position="absolute";d.style[this.grid.isLeftToRight()?"left":"right"]="0";return d},getPageHeight:function(d){d=this.pageHeights[d];return void 0!==d?d:this.defaultPageHeight},pushPage:function(d){return this.stack.push(d)},
popPage:function(){return this.stack.shift()},findPage:function(d){for(var k=0,c=0,b=0;k<this.pageCount&&!(b=this.getPageHeight(k),c+b>=d);k++,c+=b);this.page=k;this.pageTop=c},buildPage:function(d,k,c){this.preparePage(d,k);this.positionPage(d,c);this.installPage(d);this.renderPage(d);this.pushPage(d)},needPage:function(d,k){var c=this.getPageHeight(d);this.pageExists(d)?this.positionPage(d,k):(this.buildPage(d,!this.grid._autoHeight&&this.keepPages&&this.stack.length>=this.keepPages,k),c=this.updatePageHeight(d,
!0));return c},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop)},scroll:function(d){this.grid.scrollTop=d;if(this.colCount){this.startPacify();this.findPage(d);for(var k=this.height,c=this.getScrollBottom(d),b=this.page,h=this.pageTop;b<this.pageCount&&(0>c||h<c);b++)h+=this.needPage(b,h);this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,d);this.lastVisibleRow=this.getLastVisibleRow(b-1,h,c);k!=this.height&&this.repositionPages(b-1);this.endPacify()}},getScrollBottom:function(d){return 0<=
this.windowHeight?d+this.windowHeight:-1},processNodeEvent:function(d,k){for(var c=d.target;c&&c!=k&&c.parentNode&&c.parentNode.parentNode!=k;)c=c.parentNode;if(!c||!c.parentNode||c.parentNode.parentNode!=k)return!1;d.topRowIndex=c.parentNode.pageIndex*this.rowsPerPage;k=d.topRowIndex;a:{var b=0;for(var h,n=c.parentNode;h=n.childNodes[b++];)if(h==c){--b;break a}b=-1}d.rowIndex=k+b;d.rowTarget=c;return!0},processEvent:function(d){return this.processNodeEvent(d,this.contentNode)},renderRow:function(d,
k){},removeRow:function(d){},getDefaultPageNode:function(d){return this.getDefaultNodes()[d]},positionPageNode:function(d,k){},getPageNodePosition:function(d){return d.offsetTop},invalidatePageNode:function(d,k){var c=k[d];c&&(delete k[d],this.removePage(d,c),l(c),c.innerHTML="");return c},getPageRow:function(d){return d*this.rowsPerPage},getLastPageRow:function(d){return Math.min(this.rowCount,this.getPageRow(d+1))-1},getFirstVisibleRow:function(d,k,c){if(!this.pageExists(d))return 0;var b=this.getPageRow(d),
h=this.getDefaultNodes();d=p(h[d],"div");h=0;for(var n=d.length;h<n&&k<c;h++,b++)k+=d[h].offsetHeight;return b?b-1:b},getLastVisibleRow:function(d,k,c){if(!this.pageExists(d))return 0;var b=this.getDefaultNodes(),h=this.getLastPageRow(d);d=p(b[d],"div");for(b=d.length-1;0<=b&&k>c;b--,h--)k-=d[b].offsetHeight;return h+1},findTopRow:function(d){var k=this.getDefaultNodes();k=p(k[this.page],"div");for(var c=0,b=k.length,h=this.pageTop,n;c<b;c++)if(n=k[c].offsetHeight,h+=n,h>=d)return this.offset=n-(h-
d),c+this.page*this.rowsPerPage;return-1},findScrollTop:function(d){var k=Math.floor(d/this.rowsPerPage),c=0,b;for(b=0;b<k;b++)c+=this.getPageHeight(b);this.pageTop=c;this.page=k;this.needPage(k,this.pageTop);b=this.getDefaultNodes();var h=p(b[k],"div");k=d-this.rowsPerPage*k;b=0;for(d=h.length;b<d&&b<k;b++)c+=h[b].offsetHeight;return c},dummy:0})})},"dojox/grid/util":function(){define(["../main","dojo/_base/lang","dojo/dom","dojo/_base/sniff"],function(G,A,B,v){var t=A.getObject("grid.util",!0,G);
t.na="...";t.rowIndexTag="gridRowIndex";t.gridViewTag="gridView";t.fire=function(l,p,d){function k(g,a){if(null==g)return null;var f=a?"Width":"Height";return g["scroll"+f]>g["client"+f]?g:k(g.parentNode,a)}var c;if(v("webkit")&&"focus"==p){var b=l.domNode?l.domNode:l;if(c=k(b,!1))var h=c.scrollTop;if(b=k(b,!0))var n=b.scrollLeft}var m=l&&p&&l[p];l=m&&(d?m.apply(l,d):l[p]());v("webkit")&&"focus"==p&&(c&&(c.scrollTop=h),b&&(b.scrollLeft=n));return l};t.setStyleHeightPx=function(l,p){if(0<=p){var d=
l.style;p+="px";l&&d.height!=p&&(d.height=p)}};t.mouseEvents="mouseover mouseout mousedown mouseup click dblclick contextmenu".split(" ");t.keyEvents=["keyup","keydown","keypress"];t.funnelEvents=function(l,p,d,k){k=k?k:t.mouseEvents.concat(t.keyEvents);for(var c=0,b=k.length;c<b;c++)p.connect(l,"on"+k[c],d)};t.removeNode=function(l){(l=B.byId(l))&&l.parentNode&&l.parentNode.removeChild(l);return l};t.arrayCompare=function(l,p){for(var d=0,k=l.length;d<k;d++)if(l[d]!=p[d])return!1;return l.length==
p.length};t.arrayInsert=function(l,p,d){l.length<=p?l[p]=d:l.splice(p,0,d)};t.arrayRemove=function(l,p){l.splice(p,1)};t.arraySwap=function(l,p,d){var k=l[p];l[p]=l[d];l[d]=k};return t})},"dojox/grid/_Layout":function(){define("dojo/_base/kernel ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/dom-geometry ./cells ./_RowSelector".split(" "),function(G,A,B,v,t,l){return B("dojox.grid._Layout",null,{constructor:function(p){this.grid=p},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(p,
d,k,c,b){var h=this.structure[p].cells[0],n=this.structure[d].cells[0],m=null,g=m=0;p=0;for(var a;a=h[p];p++)if(a.index==k){m=p;break}m=h.splice(m,1)[0];m.view=this.grid.views.views[d];p=0;for(a=null;a=n[p];p++)if(a.index==c){g=p;break}b||(g+=1);n.splice(g,0,m);if(k=this.grid.getCell(this.grid.getSortIndex()))k._currentlySorted=this.grid.getSortAsc();this.cells=[];for(p=k=0;d=this.structure[p];p++)for(c=0;b=d.cells[c];c++)for(h=0;a=b[h];h++)a.index=k,this.cells.push(a),"_currentlySorted"in a&&(n=
k+1,n*=a._currentlySorted?1:-1,this.grid.sortInfo=n,delete a._currentlySorted),k++;v.forEach(this.cells,function(f){var e=f.markup[2].split(" ");parseInt(e[1].substring(5))!=f.index&&(e[1]='idx\x3d"'+f.index+'"',f.markup[2]=e.join(" "))});this.grid.setupHeaderMenu()},setColumnVisibility:function(p,d){p=this.cells[p];if(p.hidden==d){p.hidden=!d;d=p.view;var k=d.viewWidth;k&&"auto"!=k&&(d._togglingColumn=l.getMarginBox(p.getHeaderNode()).w||0);d.update();return!0}return!1},addCellDef:function(p,d,k){var c=
this,b=function(h){var n=0;1<h.colSpan?n=0:(n=h.width||c._defaultCellProps.width||c.defaultWidth,isNaN(n)||(n+="em"));return n};p={grid:this.grid,subrow:p,layoutIndex:d,index:this.cells.length};if(k&&k instanceof A.grid.cells._Base)return d=t.clone(k),p.unitWidth=b(d._props),d=t.mixin(d,this._defaultCellProps,k._props,p);d=k.type||k.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||A.grid.cells.Cell;t.isString(d)&&(d=t.getObject(d));p.unitWidth=b(k);return new d(t.mixin({},this._defaultCellProps,
k,p))},addRowDef:function(p,d){for(var k=[],c=0,b=0,h=!0,n=0,m;m=d[n];n++)m=this.addCellDef(p,n,m),k.push(m),this.cells.push(m),h&&m.relWidth?c+=m.relWidth:m.width&&(m=m.width,"string"==typeof m&&"%"==m.slice(-1)?b+=window.parseInt(m,10):"auto"==m&&(h=!1));c&&h&&v.forEach(k,function(g){g.relWidth&&(g.width=g.unitWidth=g.relWidth/c*(100-b)+"%")});return k},addRowsDef:function(p){var d=[];if(t.isArray(p))if(t.isArrayLike(p[0]))for(var k=0,c;p&&(c=p[k]);k++)d.push(this.addRowDef(k,c));else d.push(this.addRowDef(0,
p));return d},addViewDef:function(p){this._defaultCellProps=p.defaultCell||{};p.width&&"auto"==p.width&&delete p.width;return t.mixin({},p,{cells:this.addRowsDef(p.rows||p.cells)})},setStructure:function(p){this.fieldIndex=0;this.cells=[];var d=this.structure=[];if(this.grid.rowSelector){var k={type:A._scopeName+".grid._RowSelector"};if(t.isString(this.grid.rowSelector)){var c=this.grid.rowSelector;"false"==c?k=null:"true"!=c&&(k.width=c)}else this.grid.rowSelector||(k=null);k&&d.push(this.addViewDef(k))}var b=
function(g){return"name"in g||"field"in g||"get"in g};k=function(g){return t.isArray(g)&&(t.isArray(g[0])||b(g[0]))?!0:!1};c=function(g){return null!==g&&t.isObject(g)&&("cells"in g||"rows"in g||"type"in g&&!b(g))};if(t.isArrayLike(p)){for(var h=!1,n=0,m;m=p[n];n++)if(c(m)){h=!0;break}if(h)for(n=0;m=p[n];n++)k(m)?d.push(this.addViewDef({cells:m})):c(m)&&d.push(this.addViewDef(m));else d.push(this.addViewDef({cells:p}))}else c(p)&&d.push(this.addViewDef(p));this.cellCount=this.cells.length;this.grid.setupHeaderMenu()}})})},
"dojox/grid/cells":function(){define(["../main","./cells/_base"],function(G){return G.grid.cells})},"dojox/grid/cells/_base":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/event dojo/_base/connect dojo/_base/array dojo/_base/sniff dojo/dom dojo/dom-attr dojo/dom-construct dijit/_Widget ../util".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h){var n=A("dojox.grid._DeferredTextWidget",b,{deferred:null,_destroyOnRemove:!0,postCreate:function(){this.deferred&&this.deferred.addBoth(B.hitch(this,
function(e){this.domNode&&(this.domNode.innerHTML=e)}))}}),m=function(){setTimeout(B.hitch.apply(G,arguments),0)},g=A("dojox.grid.cells._Base",null,{styles:"",classes:"",editable:!1,alwaysEditing:!1,formatter:null,defaultValue:"...",value:null,hidden:!1,noresize:!1,draggable:!0,_valueProp:"value",_formatPending:!1,constructor:function(e){this._props=e||{};B.mixin(this,e);void 0===this.draggable&&(this.draggable=!0)},_defaultFormat:function(e,r){var w=this.grid.formatterScope||this,H=this.formatter;
H&&w&&"string"==typeof H&&(H=this.formatter=w[H]);e=e!=this.defaultValue&&H?H.apply(w,r):e;if("undefined"==typeof e)return this.defaultValue;e&&e.addBoth&&(e=new n({deferred:e},c.create("span",{innerHTML:this.defaultValue})));return e&&e.declaredClass&&e.startup?"\x3cdiv class\x3d'dojoxGridStubNode' linkWidget\x3d'"+e.id+"' cellIdx\x3d'"+this.index+"'\x3e"+this.defaultValue+"\x3c/div\x3e":e},format:function(e,r){var w=this.grid.edit.info;(r=this.get?this.get(e,r):this.value||this.defaultValue)&&r.replace&&
this.grid.escapeHTMLInData&&(r=r.replace(/&(?![a-z0-9]{1,8};)/ig,"\x26amp;").replace(/</g,"\x26lt;"));return this.editable&&(this.alwaysEditing||w.rowIndex==e&&w.cell==this)?this.formatEditing(w.value?w.value:r,e):this._defaultFormat(r,[r,e,this])},formatEditing:function(e,r){},getNode:function(e){return this.view.getCellNode(e,this.index)},getHeaderNode:function(){return this.view.getHeaderCellNode(this.index)},getEditNode:function(e){return(this.getNode(e)||0).firstChild||0},canResize:function(){var e=
this.unitWidth;return e&&"auto"!==e},isFlex:function(){var e=this.unitWidth;return e&&B.isString(e)&&("auto"==e||"%"==e.slice(-1))},applyEdit:function(e,r){this.getNode(r)&&this.grid.edit.applyCellEdit(e,this,r)},cancelEdit:function(e){this.grid.doCancelEdit(e)},_onEditBlur:function(e){this.grid.edit.isEditCell(e,this.index)&&this.grid.edit.apply()},registerOnBlur:function(e,r){this.commitOnBlur&&t.connect(e,"onblur",function(w){setTimeout(B.hitch(this,"_onEditBlur",r),250)})},needFormatNode:function(e,
r){this._formatPending=!0;m(this,"_formatNode",e,r)},cancelFormatNode:function(){this._formatPending=!1},_formatNode:function(e,r){this._formatPending&&(this._formatPending=!1,p("ie")||d.setSelectable(this.grid.domNode,!0),this.formatNode(this.getEditNode(r),e,r))},formatNode:function(e,r,w){p("ie")?m(this,"focus",w,e):this.focus(w,e)},dispatchEvent:function(e,r){if(e in this)return this[e](r)},getValue:function(e){return this.getEditNode(e)[this._valueProp]},setValue:function(e,r){(e=this.getEditNode(e))&&
(e[this._valueProp]=r)},focus:function(e,r){e=r||this.getEditNode(e);try{h.fire(e,"focus"),h.fire(e,"select")}catch(w){}},save:function(e){this.value=this.value||this.getValue(e)},restore:function(e){this.setValue(e,this.value)},_finish:function(e){d.setSelectable(this.grid.domNode,!1);this.cancelFormatNode()},apply:function(e){this.applyEdit(this.getValue(e),e);this._finish(e)},cancel:function(e){this.cancelEdit(e);this._finish(e)}});g.markupFactory=function(e,r){var w=B.trim(k.get(e,"formatter")||
"");w&&(r.formatter=B.getObject(w)||w);if(w=B.trim(k.get(e,"get")||""))r.get=B.getObject(w);w=function(H,x,q){var C=B.trim(k.get(e,H)||"");C&&(x[q||H]="false"!=C.toLowerCase())};w("sortDesc",r);w("editable",r);w("alwaysEditing",r);w("noresize",r);w("draggable",r);if(w=B.trim(k.get(e,"loadingText")||k.get(e,"defaultValue")||""))r.defaultValue=w;w=function(H,x,q){var C=B.trim(k.get(e,H)||"")||void 0;C&&(x[q||H]=C)};w("styles",r);w("headerStyles",r);w("cellStyles",r);w("classes",r);w("headerClasses",
r);w("cellClasses",r)};var a=g.Cell=A("dojox.grid.cells.Cell",g,{constructor:function(){this.keyFilter=this.keyFilter},keyFilter:null,formatEditing:function(e,r){this.needFormatNode(e,r);e&&e.replace&&(e=e.replace(/"/g,"\x26quot;"));return'\x3cinput class\x3d"dojoxGridInput" type\x3d"text" value\x3d"'+e+'"\x3e'},formatNode:function(e,r,w){this.inherited(arguments);this.registerOnBlur(e,w)},doKey:function(e){this.keyFilter&&-1==String.fromCharCode(e.charCode).search(this.keyFilter)&&v.stop(e)},_finish:function(e){this.inherited(arguments);
var r=this.getEditNode(e);try{h.fire(r,"blur")}catch(w){}}});a.markupFactory=function(e,r){g.markupFactory(e,r);if(e=B.trim(k.get(e,"keyFilter")||""))r.keyFilter=new RegExp(e)};(g.RowIndex=A("dojox.grid.cells.RowIndex",a,{name:"Row",postscript:function(){this.editable=!1},get:function(e){return e+1}})).markupFactory=function(e,r){a.markupFactory(e,r)};(g.Select=A("dojox.grid.cells.Select",a,{options:null,values:null,returnIndex:-1,constructor:function(e){this.values=this.values||this.options},formatEditing:function(e,
r){this.needFormatNode(e,r);r=['\x3cselect class\x3d"dojoxGridSelect"\x3e'];for(var w=0,H,x;void 0!==(H=this.options[w])&&void 0!==(x=this.values[w]);w++)x=x.replace?x.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):x,H=H.replace?H.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):H,r.push("\x3coption",e==x?" selected":"",' value\x3d"'+x+'"',"\x3e",H,"\x3c/option\x3e");r.push("\x3c/select\x3e");return r.join("")},_defaultFormat:function(e,r){var w=this.inherited(arguments);if(!this.formatter&&this.values&&
this.options){var H=l.indexOf(this.values,w);0<=H&&(w=this.options[H])}return w},getValue:function(e){var r=this.getEditNode(e);if(r)return e=r.selectedIndex,r=r.options[e],-1<this.returnIndex?e:r.value||r.innerHTML}})).markupFactory=function(e,r){a.markupFactory(e,r);var w=B.trim(k.get(e,"options")||"");if(w){var H=w.split(",");H[0]!=w&&(r.options=H)}if(e=B.trim(k.get(e,"values")||""))w=e.split(","),w[0]!=e&&(r.values=w)};var f=g.AlwaysEdit=A("dojox.grid.cells.AlwaysEdit",a,{alwaysEditing:!0,_formatNode:function(e,
r){this.formatNode(this.getEditNode(r),e,r)},applyStaticValue:function(e){var r=this.grid.edit;r.applyCellEdit(this.getValue(e),this,e);r.start(this,e,!0)}});f.markupFactory=function(e,r){a.markupFactory(e,r)};(g.Bool=A("dojox.grid.cells.Bool",f,{_valueProp:"checked",formatEditing:function(e,r){return'\x3cinput class\x3d"dojoxGridInput" type\x3d"checkbox"'+(e?' checked\x3d"checked"':"")+' style\x3d"width: auto" /\x3e'},doclick:function(e){"INPUT"==e.target.tagName&&this.applyStaticValue(e.rowIndex)}})).markupFactory=
function(e,r){f.markupFactory(e,r)};return g})},"dojox/grid/_RowSelector":function(){define(["dojo/_base/declare","./_View"],function(G,A){return G("dojox.grid._RowSelector",A,{defaultWidth:"2em",noscroll:!0,padBorderWidth:2,buildRendering:function(){this.inherited("buildRendering",arguments);this.scrollboxNode.style.overflow="hidden";this.headerNode.style.visibility="hidden"},getWidth:function(){return this.viewWidth||this.defaultWidth},buildRowContent:function(B,v){v.innerHTML='\x3ctable class\x3d"dojoxGridRowbarTable" style\x3d"width:'+
(this.contentWidth||0)+'px;height:1px;" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctr\x3e\x3ctd class\x3d"dojoxGridRowbarInner"\x3e\x26nbsp;\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e'},renderHeader:function(){},updateRow:function(){},resize:function(){this.adaptHeight()},adaptWidth:function(){!("contentWidth"in this)&&this.contentNode&&0<this.contentNode.offsetWidth&&(this.contentWidth=this.contentNode.offsetWidth-this.padBorderWidth)},doStyleRowNode:function(B,v){var t=
["dojoxGridRowbar dojoxGridNonNormalizedCell"];this.grid.rows.isOver(B)&&t.push("dojoxGridRowbarOver");this.grid.selection.isSelected(B)&&t.push("dojoxGridRowbarSelected");v.className=t.join(" ")},domouseover:function(B){this.grid.onMouseOverRow(B)},domouseout:function(B){if(!this.isIntraRowEvent(B))this.grid.onMouseOutRow(B)}})})},"dojox/grid/_View":function(){define("dojo dijit/registry ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/connect dojo/_base/sniff dojo/query dojo/_base/window dojo/text!./resources/View.html dojo/dnd/Source dijit/_Widget dijit/_TemplatedMixin dojox/html/metrics ./util dojo/_base/html ./_Builder dojo/dnd/Avatar dojo/dnd/Manager".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n,m,g,a,f,e,r,w){b=v("dojox.grid._View",[n,m],{defaultWidth:"18em",viewWidth:"",templateString:b,classTag:"dojoxGrid",marginBottom:0,rowPad:2,_togglingColumn:-1,_headerBuilderClass:e._HeaderBuilder,_contentBuilderClass:e._ContentBuilder,postMixInProperties:function(){this.rowNodes={}},postCreate:function(){this.connect(this.scrollboxNode,"onscroll","doscroll");a.funnelEvents(this.contentNode,this,"doContentEvent","mouseover mouseout click dblclick contextmenu mousedown".split(" "));
a.funnelEvents(this.headerNode,this,"doHeaderEvent","dblclick mouseover mouseout mousemove mousedown click contextmenu".split(" "));this.content=new this._contentBuilderClass(this);this.header=new this._headerBuilderClass(this);this.grid.isLeftToRight()||(this.headerNodeContainer.style.width="")},destroy:function(){f.destroy(this.headerNode);delete this.headerNode;for(var q in this.rowNodes)this._cleanupRowWidgets(this.rowNodes[q]),f.destroy(this.rowNodes[q]);this.rowNodes={};this.source&&this.source.destroy();
this.inherited(arguments)},focus:function(){d("ie")||d("webkit")||d("opera")?this.hiddenFocusNode.focus():this.scrollboxNode.focus()},setStructure:function(q){q=this.structure=q;q.width&&!isNaN(q.width)?this.viewWidth=q.width+"em":this.viewWidth=q.width||(q.noscroll?"auto":this.viewWidth);this._onBeforeRow=q.onBeforeRow||function(){};this._onAfterRow=q.onAfterRow||function(){};if(this.noscroll=q.noscroll)this.scrollboxNode.style.overflow="hidden";this.simpleStructure=1==q.cells.length;this.testFlexCells();
this.updateStructure()},_cleanupRowWidgets:function(q){q&&t.forEach(k("[widgetId]",q).map(A.byNode),function(C){C._destroyOnRemove?(C.destroy(),delete C):C.domNode&&C.domNode.parentNode&&C.domNode.parentNode.removeChild(C.domNode)})},onBeforeRow:function(q,C){this._onBeforeRow(q,C);0<=q&&this._cleanupRowWidgets(this.getRowNode(q))},onAfterRow:function(q,C,F){this._onAfterRow(q,C,F);var u=this.grid;t.forEach(k(".dojoxGridStubNode",F),function(E){if(E&&E.parentNode){var D=E.getAttribute("linkWidget"),
M=window.parseInt(f.attr(E,"cellIdx"),10);u.getCell(M);(D=A.byId(D))?(E.parentNode.replaceChild(D.domNode,E),D._started||D.startup(),G.destroy(E)):E.innerHTML=""}},this)},testFlexCells:function(){this.flexCells=!1;for(var q=0,C;C=this.structure.cells[q];q++)for(var F=0,u;u=C[F];F++)u.view=this,this.flexCells=this.flexCells||u.isFlex();return this.flexCells},updateStructure:function(){this.header.update();this.content.update()},getScrollbarWidth:function(){var q=this.hasVScrollbar(),C=f.style(this.scrollboxNode,
"overflow");this.noscroll||!C||"hidden"==C?q=!1:"scroll"==C&&(q=!0);return q?g.getScrollbar().w:0},getColumnsWidth:function(){var q=this.headerContentNode;return q&&q.firstChild?q.firstChild.offsetWidth||f.style(q.firstChild,"width"):0},setColumnsWidth:function(q){this.headerContentNode.firstChild.style.width=q+"px";this.viewWidth&&(this.viewWidth=q+"px")},getWidth:function(){return this.viewWidth||this.getColumnsWidth()+this.getScrollbarWidth()+"px"},getContentWidth:function(){return Math.max(0,
f._getContentBox(this.domNode).w-this.getScrollbarWidth())+"px"},render:function(){this.scrollboxNode.style.height="";this.renderHeader();0<=this._togglingColumn&&(this.setColumnsWidth(this.getColumnsWidth()-this._togglingColumn),this._togglingColumn=-1);var q=this.grid.layout.cells,C=l.hitch(this,function(u,E){!this.grid.isLeftToRight()&&(E=!E);E=E?-1:1;u=this.header.getCellNodeIndex(u)+E;for(var D=q[u];D&&D.getHeaderNode()&&"none"==D.getHeaderNode().style.display;)u+=E,D=q[u];return D?D.getHeaderNode():
null});if(this.grid.columnReordering&&this.simpleStructure){this.source&&this.source.destroy();this.bottomMarker&&f.destroy(this.bottomMarker);this.bottomMarker=f.byId("dojoxGrid_bottomMarker");this.topMarker&&f.destroy(this.topMarker);this.topMarker=f.byId("dojoxGrid_topMarker");this.bottomMarker||(this.bottomMarker=f.create("div",{id:"dojoxGrid_bottomMarker","class":"dojoxGridColPlaceBottom"},c.body()),this._hide(this.bottomMarker),this.topMarker=f.create("div",{id:"dojoxGrid_topMarker","class":"dojoxGridColPlaceTop"},
c.body()),this._hide(this.topMarker));this.arrowDim=f.contentBox(this.bottomMarker);var F=f.contentBox(this.headerContentNode.firstChild.rows[0]).h;this.source=new h(this.headerContentNode.firstChild.rows[0],{horizontal:!0,accept:["gridColumn_"+this.grid.id],viewIndex:this.index,generateText:!1,onMouseDown:l.hitch(this,function(u){this.header.decorateEvent(u);if((this.header.overRightResizeArea(u)||this.header.overLeftResizeArea(u))&&this.header.canResize(u)&&!this.header.moveable)this.header.beginColumnResize(u);
else{if(this.grid.headerMenu)this.grid.headerMenu.onCancel(!0);u.button===(9>d("ie")?1:0)&&h.prototype.onMouseDown.call(this.source,u)}}),onMouseOver:l.hitch(this,function(u){var E=this.source;E._getChildByEvent(u)&&h.prototype.onMouseOver.apply(E,arguments)}),_markTargetAnchor:l.hitch(this,function(u){var E=this.source;if(E.current!=E.targetAnchor||E.before!=u){E.targetAnchor&&C(E.targetAnchor,E.before)&&E._removeItemClass(C(E.targetAnchor,E.before),E.before?"After":"Before");h.prototype._markTargetAnchor.call(E,
u);var D=u?E.targetAnchor:C(E.targetAnchor,E.before);u=0;D||(D=E.targetAnchor,u=f.contentBox(D).w+this.arrowDim.w/2+2);D=f.position(D,!0);u=Math.floor(D.x-this.arrowDim.w/2+u);f.style(this.bottomMarker,"visibility","visible");f.style(this.topMarker,"visibility","visible");f.style(this.bottomMarker,{left:u+"px",top:F+D.y+"px"});f.style(this.topMarker,{left:u+"px",top:D.y-this.arrowDim.h+"px"});E.targetAnchor&&C(E.targetAnchor,E.before)&&E._addItemClass(C(E.targetAnchor,E.before),E.before?"After":"Before")}}),
_unmarkTargetAnchor:l.hitch(this,function(){var u=this.source;u.targetAnchor&&(u.targetAnchor&&C(u.targetAnchor,u.before)&&u._removeItemClass(C(u.targetAnchor,u.before),u.before?"After":"Before"),this._hide(this.bottomMarker),this._hide(this.topMarker),h.prototype._unmarkTargetAnchor.call(u))}),destroy:l.hitch(this,function(){p.disconnect(this._source_conn);p.unsubscribe(this._source_sub);h.prototype.destroy.call(this.source);this.bottomMarker&&(f.destroy(this.bottomMarker),delete this.bottomMarker);
this.topMarker&&(f.destroy(this.topMarker),delete this.topMarker)}),onDndCancel:l.hitch(this,function(){h.prototype.onDndCancel.call(this.source);this._hide(this.bottomMarker);this._hide(this.topMarker)})});this._source_conn=p.connect(this.source,"onDndDrop",this,"_onDndDrop");this._source_sub=p.subscribe("/dnd/drop/before",this,"_onDndDropBefore");this.source.startup()}},_hide:function(q){f.style(q,{top:"-10000px",visibility:"hidden"})},_onDndDropBefore:function(q,C,F){w.manager().target===this.source&&
(this.source._targetNode=this.source.targetAnchor,this.source._beforeTarget=this.source.before,C=this.grid.views.views,q=C[q.viewIndex],C=C[this.index],C!=q&&(q.convertColPctToFixed(),C.convertColPctToFixed()))},_onDndDrop:function(q,C,F){if(w.manager().target!==this.source)w.manager().source===this.source&&(this._removingColumn=!0);else{this._hide(this.bottomMarker);this._hide(this.topMarker);F=function(I){return I?f.attr(I,"idx"):null};var u=f.marginBox(C[0]).w;if(q.viewIndex!==this.index){var E=
this.grid.views.views,D=E[q.viewIndex];E=E[this.index];D.viewWidth&&"auto"!=D.viewWidth&&D.setColumnsWidth(D.getColumnsWidth()-u);E.viewWidth&&"auto"!=E.viewWidth&&E.setColumnsWidth(E.getColumnsWidth())}u=this.source._targetNode;D=this.source._beforeTarget;!this.grid.isLeftToRight()&&(D=!D);E=this.grid.layout;var M=this.index;delete this.source._targetNode;delete this.source._beforeTarget;E.moveColumn(q.viewIndex,M,F(C[0]),F(u),D)}},renderHeader:function(){this.headerContentNode.innerHTML=this.header.generateHtml(this._getHeaderContent);
this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);a.fire(this,"onAfterRow",[-1,this.structure.cells,this.headerContentNode])},_getHeaderContent:function(q){var C=q.name||q.grid.getCellName(q);/^\s+$/.test(C)&&(C="\x26nbsp;");var F=['\x3cdiv class\x3d"dojoxGridSortNode'];q.index!=q.grid.getSortIndex()?F.push('"\x3e'):F=F.concat([" ",0<q.grid.sortInfo?"dojoxGridSortUp":"dojoxGridSortDown",'"\x3e\x3cdiv class\x3d"dojoxGridArrowButtonChar"\x3e',
0<q.grid.sortInfo?"\x26#9650;":"\x26#9660;",'\x3c/div\x3e\x3cdiv class\x3d"dojoxGridArrowButtonNode" role\x3d"presentation"\x3e\x3c/div\x3e','\x3cdiv class\x3d"dojoxGridColCaption"\x3e']);F=F.concat([C,"\x3c/div\x3e\x3c/div\x3e"]);return F.join("")},resize:function(){this.adaptHeight();this.adaptWidth()},hasHScrollbar:function(q){var C=this._hasHScroll||!1;if(void 0==this._hasHScroll||q)this.noscroll?this._hasHScroll=!1:(q=f.style(this.scrollboxNode,"overflow"),this._hasHScroll="hidden"==q?!1:"scroll"==
q?!0:this.scrollboxNode.offsetWidth-this.getScrollbarWidth()<this.contentNode.offsetWidth);C!==this._hasHScroll&&this.grid.update();return this._hasHScroll},hasVScrollbar:function(q){var C=this._hasVScroll||!1;if(void 0==this._hasVScroll||q)this.noscroll?this._hasVScroll=!1:(q=f.style(this.scrollboxNode,"overflow"),this._hasVScroll="hidden"==q?!1:"scroll"==q?!0:this.scrollboxNode.scrollHeight>this.scrollboxNode.clientHeight);C!==this._hasVScroll&&this.grid.update();return this._hasVScroll},convertColPctToFixed:function(){var q=
!1;this.grid.initialWidth="";var C=k("th",this.headerContentNode),F=t.map(C,function(u,E){var D=u.style.width;f.attr(u,"vIdx",E);if(D&&"%"==D.slice(-1))q=!0;else if(D&&"px"==D.slice(-2))return window.parseInt(D,10);return f.contentBox(u).w});return q?(t.forEach(this.grid.layout.cells,function(u,E){if(u.view==this&&(u=u.view.getHeaderCellNode(u.index))&&f.hasAttr(u,"vIdx")){var D=window.parseInt(f.attr(u,"vIdx"));this.setColWidth(E,F[D]);f.removeAttr(u,"vIdx")}},this),!0):!1},adaptHeight:function(q){if(!this.grid._autoHeight){var C=
this.domNode.style.height&&parseInt(this.domNode.style.height.replace(/px/,""),10)||this.domNode.clientHeight;if(!q&&(q=this.noscroll))a:{for(var F=0;F<this.grid.views.views.length;++F)if(q=this.grid.views.views[F],q!==this&&q.hasHScrollbar()){q=!0;break a}q=!1}q&&(C-=g.getScrollbar().h);a.setStyleHeightPx(this.scrollboxNode,C)}this.hasVScrollbar(!0)},adaptWidth:function(){this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);var q=
this.scrollboxNode.offsetWidth-this.getScrollbarWidth();this._removingColumn?(q=Math.min(q,this.getColumnsWidth())+"px",this._removingColumn=!1):q=Math.max(q,this.getColumnsWidth())+"px";this.contentNode.style.width=q;this.hasHScrollbar(!0)},setSize:function(q,C){var F=this.domNode.style,u=this.headerNode.style;q&&(F.width=q,u.width=q);F.height=0<=C?C+"px":""},renderRow:function(q){var C=this.createRowNode(q);this.buildRow(q,C);return C},createRowNode:function(q){var C=document.createElement("div");
C.className=this.classTag+"Row";this instanceof B.grid._RowSelector?f.attr(C,"role","presentation"):(f.attr(C,"role","row"),"none"!=this.grid.selectionMode&&C.setAttribute("aria-selected","false"));C[a.gridViewTag]=this.id;C[a.rowIndexTag]=q;return this.rowNodes[q]=C},buildRow:function(q,C){this.buildRowContent(q,C);this.styleRow(q,C)},buildRowContent:function(q,C){C.innerHTML=this.content.generateHtml(q,q);this.flexCells&&this.contentWidth&&(C.firstChild.style.width=this.contentWidth);a.fire(this,
"onAfterRow",[q,this.structure.cells,C])},rowRemoved:function(q){0<=q&&this._cleanupRowWidgets(this.getRowNode(q));this.grid.edit.save(this,q);delete this.rowNodes[q]},getRowNode:function(q){return this.rowNodes[q]},getCellNode:function(q,C){if(q=this.getRowNode(q))return this.content.getCellNode(q,C)},getHeaderCellNode:function(q){if(this.headerContentNode)return this.header.getCellNode(this.headerContentNode,q)},styleRow:function(q,C){var F=void 0==C.style.cssText?C.getAttribute("style"):C.style.cssText;
C._style=F;this.styleRowNode(q,C)},styleRowNode:function(q,C){C&&this.doStyleRowNode(q,C)},doStyleRowNode:function(q,C){this.grid.styleRowNode(q,C)},updateRow:function(q){var C=this.getRowNode(q);C&&(C.style.height="",this.buildRow(q,C));return C},updateRowStyles:function(q){this.styleRowNode(q,this.getRowNode(q))},lastTop:0,firstScroll:0,_nativeScroll:!1,doscroll:function(q){if(13<=d("ff")||d("chrome"))this._nativeScroll=!0;q=this.grid.isLeftToRight();if(2>this.firstScroll){if(!q&&1==this.firstScroll||
q&&0===this.firstScroll){var C=f.marginBox(this.headerNodeContainer);d("ie")?this.headerNodeContainer.style.width=C.w+this.getScrollbarWidth()+"px":d("mozilla")&&(this.headerNodeContainer.style.width=C.w-this.getScrollbarWidth()+"px",this.scrollboxNode.scrollLeft=q?this.scrollboxNode.clientWidth-this.scrollboxNode.scrollWidth:this.scrollboxNode.scrollWidth-this.scrollboxNode.clientWidth)}this.firstScroll++}this.headerNode.scrollLeft=this.scrollboxNode.scrollLeft;q=this.scrollboxNode.scrollTop;q!==
this.lastTop&&this.grid.scrollTo(q);this._nativeScroll=!1},setScrollTop:function(q){this.lastTop=q;this._nativeScroll||(this.scrollboxNode.scrollTop=q);return this.scrollboxNode.scrollTop},doContentEvent:function(q){if(this.content.decorateEvent(q))this.grid.onContentEvent(q)},doHeaderEvent:function(q){if(this.header.decorateEvent(q))this.grid.onHeaderEvent(q)},dispatchContentEvent:function(q){return this.content.dispatchEvent(q)},dispatchHeaderEvent:function(q){return this.header.dispatchEvent(q)},
setColWidth:function(q,C){this.grid.setCellWidth(q,C+"px")},update:function(){if(this.domNode){this.content.update();this.grid.update();var q=this.scrollboxNode.scrollLeft;this.scrollboxNode.scrollLeft=q;this.headerNode.scrollLeft=q}}});var H=v("dojox.grid._GridAvatar",r,{construct:function(){var q=c.doc,C=q.createElement("table");C.cellPadding=C.cellSpacing="0";C.className="dojoxGridDndAvatar";C.style.position="absolute";C.style.zIndex=1999;C.style.margin="0px";var F=q.createElement("tbody"),u=q.createElement("tr"),
E=q.createElement("td"),D=q.createElement("td");u.className="dojoxGridDndAvatarItem";D.className="dojoxGridDndAvatarItemImage";D.style.width="16px";var M=this.manager.source;if(M.creator)M=M._normalizedCreator(M.getItem(this.manager.nodes[0].id).data,"avatar").node;else if(M=this.manager.nodes[0].cloneNode(!0),"tr"==M.tagName.toLowerCase()){var I=q.createElement("table");var z=q.createElement("tbody");z.appendChild(M);I.appendChild(z);M=I}else"th"==M.tagName.toLowerCase()&&(I=q.createElement("table"),
z=q.createElement("tbody"),q=q.createElement("tr"),I.cellPadding=I.cellSpacing="0",q.appendChild(M),z.appendChild(q),I.appendChild(z),M=I);M.id="";E.appendChild(M);u.appendChild(D);u.appendChild(E);f.style(u,"opacity",.9);F.appendChild(u);C.appendChild(F);this.node=C;C=w.manager();this.oldOffsetY=C.OFFSET_Y;C.OFFSET_Y=1},destroy:function(){w.manager().OFFSET_Y=this.oldOffsetY;this.inherited(arguments)}}),x=w.manager().makeAvatar;w.manager().makeAvatar=function(){return void 0===this.source.viewIndex||
f.hasClass(c.body(),"dijit_a11y")?x.call(w.manager()):new H(this)};return b})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h){B.isAsync||d(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var n=A("dojo.dnd.Source",b,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,
autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(m,g){v.mixin(this,v.mixin({},g));m=this.accept;if(m.length)for(this.accept={},g=0;g<m.length;++g)this.accept[m[g]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&t.add(this.node,"dojoDndSource");this.targetState="";this.accept&&t.add(this.node,"dojoDndTarget");this.horizontal&&t.add(this.node,"dojoDndHorizontal");this.topics=
[k.subscribe("/dnd/source/over",v.hitch(this,"onDndSourceOver")),k.subscribe("/dnd/start",v.hitch(this,"onDndStart")),k.subscribe("/dnd/drop",v.hitch(this,"onDndDrop")),k.subscribe("/dnd/cancel",v.hitch(this,"onDndCancel"))]},checkAcceptance:function(m,g){if(this==m)return!this.copyOnly||this.selfAccept;for(var a=0;a<g.length;++a){for(var f=m.getItem(g[a].id).type,e=!1,r=0;r<f.length;++r)if(f[r]in this.accept){e=!0;break}if(!e)return!1}return!0},copyState:function(m,g){if(m)return!0;2>arguments.length&&
(g=this==h.manager().target);if(g){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){n.superclass.destroy.call(this);G.forEach(this.topics,function(m){m.remove()});this.targetAnchor=null},onMouseMove:function(m){if(!this.isDragging||"Disabled"!=this.targetState){n.superclass.onMouseMove.call(this,m);var g=h.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(m.pageX-this._lastX)>this.delay||Math.abs(m.pageY-this._lastY)>this.delay)){var a=
this.getSelectedNodes();a.length&&g.startDrag(this,a,this.copyState(c.getCopyKeyState(m),!0))}this.isDragging&&(a=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=l.position(this.current,!0)),a=this.horizontal?m.pageX-this.targetBox.x<this.targetBox.w/2==l.isBodyLtr(this.current.ownerDocument):m.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||a!=this.before)&&(this._markTargetAnchor(a),g.canDrop(!this.current||g.source!=this||!(this.current.id in
this.selection)))}},onMouseDown:function(m){this.mouseDown||!this._legalMouseDown(m)||this.skipForm&&c.isFormElement(m)||(this.mouseDown=!0,this._lastX=m.pageX,this._lastY=m.pageY,n.superclass.onMouseDown.call(this,m))},onMouseUp:function(m){this.mouseDown&&(this.mouseDown=!1,n.superclass.onMouseUp.call(this,m))},onDndSourceOver:function(m){this!==m?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(m=h.manager(),m.canDrop("Disabled"!=this.targetState&&(!this.current||
m.source!=this||!(this.current.id in this.selection))))},onDndStart:function(m,g,a){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==m?a?"Copied":"Moved":"");g=this.accept&&this.checkAcceptance(m,g);this._changeState("Target",g?"":"Disabled");this==m&&h.manager().overSource(this);this.isDragging=!0},onDndDrop:function(m,g,a,f){if(this==f)this.onDrop(m,g,a);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=
!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(m,g,a){if(this!=m)this.onDropExternal(m,g,a);else this.onDropInternal(g,a)},onDropExternal:function(m,g,a){var f=this._normalizedCreator;this._normalizedCreator=this.creator?function(e,r){return f.call(this,m.getItem(e.id).data,r)}:a?function(e){var r=m.getItem(e.id);e=e.cloneNode(!0);e.id=c.getUniqueId();return{node:e,data:r.data,type:r.type}}:function(e){var r=m.getItem(e.id);m.delItem(e.id);
return{node:e,data:r.data,type:r.type}};this.selectNone();a||this.creator||m.selectNone();this.insertNodes(!0,g,this.before,this.current);!a&&this.creator&&m.deleteSelectedNodes();this._normalizedCreator=f},onDropInternal:function(m,g){var a=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(g)this._normalizedCreator=this.creator?function(f,e){return a.call(this,this.getItem(f.id).data,e)}:function(f){var e=this.getItem(f.id);f=f.cloneNode(!0);f.id=c.getUniqueId();return{node:f,
data:e.data,type:e.type}};else{if(!this.current)return;this._normalizedCreator=function(f){var e=this.getItem(f.id);return{node:f,data:e.data,type:e.type}}}this._removeSelection();this.insertNodes(!0,m,this.before,this.current);this._normalizedCreator=a}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){n.superclass.onOverEvent.call(this);h.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){n.superclass.onOutEvent.call(this);
h.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(m){if(this.current!=this.targetAnchor||this.before!=m)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=m,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(m){this._changeState("Source",m?"Copied":"Moved")},_legalMouseDown:function(m){if("touchstart"!=m.type&&!p.isLeft(m))return!1;if(!this.withHandles)return!0;for(m=m.target;m&&m!==this.node;m=m.parentNode){if(t.contains(m,"dojoDndHandle"))return!0;if(t.contains(m,"dojoDndItem")||t.contains(m,"dojoDndIgnore"))break}return!1}});return n})},"dojo/dnd/common":function(){define(["../sniff","../_base/kernel",
"../_base/lang","../dom"],function(G,A,B,v){var t=B.getObject("dojo.dnd",!0);t.getCopyKeyState=function(l){return l[G("mac")?"metaKey":"ctrlKey"]};t._uniqueId=0;t.getUniqueId=function(){do var l=A._scopeName+"Unique"+ ++t._uniqueId;while(v.byId(l));return l};t._empty={};t.isFormElement=function(l){l=l.target;3==l.nodeType&&(l=l.parentNode);return 0<=" a button textarea input select option ".indexOf(" "+l.tagName.toLowerCase()+" ")};return t})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h){var n=A("dojo.dnd.Selector",h,{constructor:function(m,g){g||(g={});this.singular=g.singular;this.autoSync=g.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(k(this.node,c.press,v.hitch(this,"onMouseDown")),k(this.node,c.release,v.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var m=new d,g=b._empty,a;for(a in this.selection)a in g||m.push(t.byId(a));return m},selectNone:function(){return this._removeSelection()._removeAnchor()},
selectAll:function(){this.forInItems(function(m,g){this._addItemClass(t.byId(g),"Selected");this.selection[g]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var m=b._empty,g;for(g in this.selection)if(!(g in m)){var a=t.byId(g);this.delItem(g);l.destroy(a)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(m,g){g=g||B.global;var a=this.selection,f=b._empty,e;for(e in a)e in f||m.call(g,this.getItem(e),e,this)},sync:function(){n.superclass.sync.call(this);
this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var m=[],g=b._empty,a;for(a in this.selection)a in g||this.getItem(a)||m.push(a);G.forEach(m,function(f){delete this.selection[f]},this);return this},insertNodes:function(m,g,a,f){var e=this._normalizedCreator;this._normalizedCreator=function(r,w){r=e.call(this,r,w);m?(this.anchor?this.anchor!=r.node&&(this._removeItemClass(r.node,"Anchor"),this._addItemClass(r.node,"Selected")):(this.anchor=r.node,this._removeItemClass(r.node,"Selected"),
this._addItemClass(this.anchor,"Anchor")),this.selection[r.node.id]=1):(this._removeItemClass(r.node,"Selected"),this._removeItemClass(r.node,"Anchor"));return r};n.superclass.insertNodes.call(this,g,a,f);this._normalizedCreator=e;return this},destroy:function(){n.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(m){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!b.getCopyKeyState(m)&&!m.shiftKey&&this.current.id in this.selection)this.simpleSelection=
!0,p.isLeft(m)&&(m.stopPropagation(),m.preventDefault());else{if(!this.singular&&m.shiftKey){b.getCopyKeyState(m)||this._removeSelection();var g=this.getAllNodes();if(g.length&&(this.anchor||(this.anchor=g[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var a=0,f;a<g.length&&(f=g[a],f!=this.anchor&&f!=this.current);++a);for(++a;a<g.length;++a){f=g[a];if(f==this.anchor||f==this.current)break;this._addItemClass(f,"Selected");this.selection[f.id]=
1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?b.getCopyKeyState(m)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):b.getCopyKeyState(m)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):
(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);m.stopPropagation();m.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&
(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=k(this.node,c.move,v.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var m=b._empty,g;for(g in this.selection)if(!(g in m)){var a=t.byId(g);a&&this._removeItemClass(a,"Selected")}this.selection=
{};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return n})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,n,m){A=A("dojo.dnd.Container",k,{skipForm:!1,allowNested:!1,constructor:function(g,a){this.node=l.byId(g);
a||(a={});this.creator=a.creator||null;this.skipForm=a.skipForm;this.parent=a.dropParent&&l.byId(a.dropParent);this.map={};this.current=null;this.containerState="";p.add(this.node,"dojoDndContainer");a&&a._skipStartup||this.startup();this.events=[b(this.node,n.over,v.hitch(this,"onMouseOver")),b(this.node,n.out,v.hitch(this,"onMouseOut")),b(this.node,"dragstart",v.hitch(this,"onSelectStart")),b(this.node,"selectstart",v.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(g){return this.map[g]},
setItem:function(g,a){this.map[g]=a},delItem:function(g){delete this.map[g]},forInItems:function(g,a){a=a||B.global;var f=this.map,e=m._empty,r;for(r in f)r in e||g.call(a,f[r],r,this);return a},clearItems:function(){this.map={}},getAllNodes:function(){return h((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var g={};this.getAllNodes().forEach(function(a){if(a.id){var f=this.getItem(a.id);if(f){g[a.id]=f;return}}else a.id=m.getUniqueId();f=a.getAttribute("dndType");var e=
a.getAttribute("dndData");g[a.id]={data:e||a.innerHTML,type:f?f.split(/\s*,\s*/):["text"]}},this);this.map=g;return this},insertNodes:function(g,a,f){this.parent.firstChild?a?f||(f=this.parent.firstChild):f&&(f=f.nextSibling):f=null;if(f)for(a=0;a<g.length;++a){var e=this._normalizedCreator(g[a]);this.setItem(e.node.id,{data:e.data,type:e.type});f.parentNode.insertBefore(e.node,f)}else for(a=0;a<g.length;++a)e=this._normalizedCreator(g[a]),this.setItem(e.node.id,{data:e.data,type:e.type}),this.parent.appendChild(e.node);
return this},destroy:function(){G.forEach(this.events,function(g){g.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(g,a,f){g._skipStartup=!0;return new f(a,g)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var g=this.parent.getElementsByTagName("tbody");g&&g.length&&(this.parent=g[0])}this.defaultCreator=m._defaultCreator(this.parent);this.sync()},onMouseOver:function(g){for(var a=g.relatedTarget;a&&
a!=this.node;)try{a=a.parentNode}catch(f){a=null}a||(this._changeState("Container","Over"),this.onOverEvent());a=this._getChildByEvent(g);this.current!=a&&(this.current&&this._removeItemClass(this.current,"Over"),a&&this._addItemClass(a,"Over"),this.current=a)},onMouseOut:function(g){for(g=g.relatedTarget;g;){if(g==this.node)return;try{g=g.parentNode}catch(a){g=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(g){this.withHandles||
this.skipForm&&m.isFormElement(g)||(g.stopPropagation(),g.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(g,a){var f="dojoDnd"+g;g=g.toLowerCase()+"State";p.replace(this.node,f+a,f+this[g]);this[g]=a},_addItemClass:function(g,a){p.add(g,"dojoDndItem"+a)},_removeItemClass:function(g,a){p.remove(g,"dojoDndItem"+a)},_getChildByEvent:function(g){if(g=g.target)for(var a=g.parentNode;a;g=a,a=g.parentNode)if((a==this.parent||this.allowNested)&&p.contains(g,"dojoDndItem"))return g;
return null},_normalizedCreator:function(g,a){g=(this.creator||this.defaultCreator).call(this,g,a);v.isArray(g.type)||(g.type=["text"]);g.node.id||(g.node.id=m.getUniqueId());p.add(g.node,"dojoDndItem");return g}});m._createNode=function(g){return g?function(a){return d.create(g,{innerHTML:a})}:m._createSpan};m._createTrTd=function(g){var a=d.create("tr");d.create("td",{innerHTML:g},a);return a};m._createSpan=function(g){return d.create("span",{innerHTML:g})};m._defaultCreatorNodes={ul:"li",ol:"li",
div:"div",p:"div"};m._defaultCreator=function(g){g=g.tagName.toLowerCase();var a="tbody"==g||"thead"==g?m._createTrTd:m._createNode(m._defaultCreatorNodes[g]);return function(f,e){var r=f&&v.isObject(f);if(r&&f.tagName&&f.nodeType&&f.getAttribute){var w=f.getAttribute("dndData")||f.innerHTML;r=(r=f.getAttribute("dndType"))?r.split(/\s*,\s*/):["text"]}else w=r&&f.data?f.data:f,r=r&&f.type?f.type:["text"],f=("avatar"==e?m._createSpan:a)(String(w));f.id||(f.id=m.getUniqueId());return{node:f,data:w,type:r}}};
return A})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,n,m){var g=A("dojo.dnd.Manager",[l],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:p("touch")?4:16,OFFSET_Y:p("touch")?4:16,overSource:function(a){this.avatar&&
(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());c.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),c.publish("/dnd/source/over",null)):c.publish("/dnd/source/over",null)},startDrag:function(a,f,e){function r(w){w.preventDefault();w.stopPropagation()}n.autoScrollStart(v.doc);this.source=a;this.nodes=f;this.copy=!!e;this.avatar=this.makeAvatar();v.body().appendChild(this.avatar.node);
c.publish("/dnd/start",a,f,this.copy);this.events=[k(v.doc,b.move,B.hitch(this,"onMouseMove")),k(v.doc,b.release,B.hitch(this,"onMouseUp")),k(v.doc,"keydown",B.hitch(this,"onKeyDown")),k(v.doc,"keyup",B.hitch(this,"onKeyUp")),k(v.doc,"dragstart",r),k(v.body(),"selectstart",r)];a="dojoDnd"+(e?"Copy":"Move");t.add(v.body(),a)},canDrop:function(a){a=!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){t.remove(v.body(),["dojoDndCopy","dojoDndMove"]);
G.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new m(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var f=this.avatar;f&&(n.autoScrollNodes(a),f=f.node.style,f.left=a.pageX+this.OFFSET_X+"px",f.top=a.pageY+this.OFFSET_Y+"px",f=!!this.source.copyState(h.getCopyKeyState(a)),this.copy!=f&&this._setCopyStatus(f));p("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&
this.canDropFlag){var f=!!this.source.copyState(h.getCopyKeyState(a));c.publish("/dnd/drop/before",this.source,this.nodes,f,this.target,a);c.publish("/dnd/drop",this.source,this.nodes,f,this.target,a)}else c.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case d.CTRL:a=!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case d.ESCAPE:c.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==d.CTRL&&(a=
!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();t.replace(v.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});h._manager=null;g.manager=h.manager=function(){h._manager||(h._manager=new g);return h._manager};return g})},"dojo/dnd/autoscroll":function(){define("../_base/lang ../sniff ../_base/window ../dom-geometry ../dom-style ../window".split(" "),function(G,
A,B,v,t,l){var p={};G.setObject("dojo.dnd.autoscroll",p);p.getViewport=l.getBox;p.V_TRIGGER_AUTOSCROLL=32;p.H_TRIGGER_AUTOSCROLL=32;p.V_AUTOSCROLL_VALUE=16;p.H_AUTOSCROLL_VALUE=16;var d,k=B.doc,c=Infinity,b=Infinity;p.autoScrollStart=function(h){k=h;d=l.getBox(k);h=B.body(k).parentNode;c=Math.max(h.scrollHeight-d.h,0);b=Math.max(h.scrollWidth-d.w,0)};p.autoScroll=function(h){var n=d||l.getBox(k),m=B.body(k).parentNode,g=0,a=0;h.clientX<p.H_TRIGGER_AUTOSCROLL?g=-p.H_AUTOSCROLL_VALUE:h.clientX>n.w-
p.H_TRIGGER_AUTOSCROLL&&(g=Math.min(p.H_AUTOSCROLL_VALUE,b-m.scrollLeft));h.clientY<p.V_TRIGGER_AUTOSCROLL?a=-p.V_AUTOSCROLL_VALUE:h.clientY>n.h-p.V_TRIGGER_AUTOSCROLL&&(a=Math.min(p.V_AUTOSCROLL_VALUE,c-m.scrollTop));window.scrollBy(g,a)};p._validNodes={div:1,p:1,td:1};p._validOverflow={auto:1,scroll:1};p.autoScrollNodes=function(h){for(var n,m,g,a,f,e=0,r=0,w=h.target;w;){if(1==w.nodeType&&w.tagName.toLowerCase()in p._validNodes){g=t.getComputedStyle(w);f=g.overflowX.toLowerCase()in p._validOverflow;
a=g.overflowY.toLowerCase()in p._validOverflow;if(f||a)n=v.getContentBox(w,g),m=v.position(w,!0);if(f){g=Math.min(p.H_TRIGGER_AUTOSCROLL,n.w/2);f=h.pageX-m.x;if(A("webkit")||A("opera"))f+=B.body().scrollLeft;e=0;0<f&&f<n.w&&(f<g?e=-g:f>n.w-g&&(e=g),w.scrollLeft+=e)}if(a){a=Math.min(p.V_TRIGGER_AUTOSCROLL,n.h/2);g=h.pageY-m.y;if(A("webkit")||A("opera"))g+=B.body().scrollTop;r=0;0<g&&g<n.h&&(g<a?r=-a:g>n.h-a&&(r=a),w.scrollTop+=r)}if(e||r)return}try{w=w.parentNode}catch(H){w=null}}p.autoScroll(h)};
return p})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(G,A,B,v,t,l,p,d){return G("dojo.dnd.Avatar",null,{constructor:function(k){this.manager=k;this.construct()},construct:function(){var k=l.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),c=this.manager.source,b=l.create("tbody",null,k),h=l.create("tr",null,b),n=l.create("td",null,h),m=
Math.min(5,this.manager.nodes.length),g=0;p("highcontrast")&&l.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},n);l.create("span",{innerHTML:c.generateText?this._generateText():""},n);for(v.set(h,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});g<m;++g){if(c.creator)var a=c._normalizedCreator(c.getItem(this.manager.nodes[g].id).data,"avatar").node;else a=this.manager.nodes[g].cloneNode(!0),"tr"==a.tagName.toLowerCase()&&(h=l.create("table"),l.create("tbody",null,h).appendChild(a),
a=h);a.id="";h=l.create("tr",null,b);n=l.create("td",null,h);n.appendChild(a);v.set(h,{"class":"dojoDndAvatarItem",style:{opacity:(9-g)/10}})}this.node=k},destroy:function(){l.destroy(this.node);this.node=!1},update:function(){t.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(p("highcontrast")){var k=B.byId("a11yIcon"),c="+";this.manager.canDropFlag&&!this.manager.copy?c="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(c="x"):c="o";k.innerHTML=c}d("tr.dojoDndAvatarHeader td span"+
(p("highcontrast")?" span":""),this.node).forEach(function(b){b.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dojox/html/metrics":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/sniff dojo/ready dojo/_base/unload dojo/_base/window dojo/dom-geometry".split(" "),function(G,A,B,v,t,l,p){var d=A.getObject("dojox.html.metrics",!0),k=A.getObject("dojox");d.getFontMeasurements=function(){var g=
{"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0};if(B("ie")){var a=l.doc.documentElement.style.fontSize||"";a||(l.doc.documentElement.style.fontSize="100%")}var f=l.doc.createElement("div"),e=f.style;e.position="absolute";e.left="-100px";e.top="0";e.width="30px";e.height="1000em";e.borderWidth="0";e.margin="0";e.padding="0";e.outline="0";e.lineHeight="1";e.overflow="hidden";l.body().appendChild(f);for(var r in g)e.fontSize=r,g[r]=
16*Math.round(12*f.offsetHeight/16)/12/1E3;B("ie")&&(l.doc.documentElement.style.fontSize=a);l.body().removeChild(f);f=null;return g};var c=null;d.getCachedFontMeasurements=function(g){if(g||!c)c=d.getFontMeasurements();return c};var b=null,h={};d.getTextBox=function(g,a,f){if(b)var e=b;else{e=b=l.doc.createElement("div");e.style.whiteSpace="nowrap";var r=l.doc.createElement("div");r.appendChild(e);var w=r.style;w.overflow="scroll";w.position="absolute";w.left="0px";w.top="-10000px";w.width="1px";
w.height="1px";w.visibility="hidden";w.borderWidth="0";w.margin="0";w.padding="0";w.outline="0";l.body().appendChild(r)}e.className="";w=e.style;w.borderWidth="0";w.margin="0";w.padding="0";w.outline="0";if(1<arguments.length&&a)for(var H in a)H in h||(w[H]=a[H]);2<arguments.length&&f&&(e.className=f);e.innerHTML=g;w=p.position(e);w.w=e.parentNode.scrollWidth;return w};var n=16,m=16;d.getScrollbar=function(){return{w:n,h:m}};d._fontResizeNode=null;d.initOnFontResize=function(g){var a=d._fontResizeNode=
l.doc.createElement("iframe");g=a.style;g.position="absolute";g.width="5em";g.height="10em";g.top="-10000px";g.display="none";B("ie")?a.onreadystatechange=function(){"complete"==a.contentWindow.document.readyState&&(a.onresize=a.contentWindow.parent[k._scopeName].html.metrics._fontresize)}:a.onload=function(){a.contentWindow.onresize=a.contentWindow.parent[k._scopeName].html.metrics._fontresize};a.setAttribute("src","javascript:'\x3chtml\x3e\x3chead\x3e\x3cscript\x3eif(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}\x3c/script\x3e\x3c/head\x3e\x3cbody\x3e\x3c/body\x3e\x3c/html\x3e'");
l.body().appendChild(a);d.initOnFontResize=function(){}};d.onFontResize=function(){};d._fontresize=function(){d.onFontResize()};t.addOnUnload(function(){var g=d._fontResizeNode;g&&(B("ie")&&g.onresize?g.onresize=null:g.contentWindow&&g.contentWindow.onresize&&(g.contentWindow.onresize=null),d._fontResizeNode=null)});v(function(){try{var g=l.doc.createElement("div");g.style.cssText="top:0;left:0;width:100px;height:100px;overflow:scroll;position:absolute;visibility:hidden;";l.body().appendChild(g);
n=g.offsetWidth-g.clientWidth;m=g.offsetHeight-g.clientHeight;l.body().removeChild(g);delete g}catch(a){}"fontSizeWatch"in G.config&&G.config.fontSizeWatch&&d.initOnFontResize()});return d})},"dojox/grid/_Builder":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/window dojo/_base/event dojo/_base/sniff dojo/_base/connect dojo/dnd/Moveable dojox/html/metrics ./util dojo/_base/html dojo/dom-geometry".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h){var n=G.grid,m=function(x){return 0<=
x.rowIndex?x.rowIndex:A.indexOf(x.parentNode.childNodes,x)},g=function(x,q){return x&&((x.rows||0)[q]||x.childNodes[q])},a=function(x){for(;x&&"TABLE"!=x.tagName;x=x.parentNode);return x},f=function(x){var q=x.toUpperCase();return function(C){return C.tagName!=q}},e=c.rowIndexTag,r=c.gridViewTag,w=n._Builder=B.extend(function(x){x&&(this.view=x,this.grid=x.grid)},{view:null,_table:'\x3ctable class\x3d"dojoxGridRowTable" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"',getTableArray:function(){var x=
[this._table];this.view.viewWidth&&x.push([' style\x3d"width:',this.view.viewWidth,';"'].join(""));x.push("\x3e");return x},generateCellMarkup:function(x,q,C,F){var u=[];if(F){var E=x.index!=x.grid.getSortIndex()?"":0<x.grid.sortInfo?'aria-sort\x3d"ascending"':'aria-sort\x3d"descending"';x.id||(x.id=this.grid.id+"Hdr"+x.index);E=['\x3cth tabIndex\x3d"-1" aria-readonly\x3d"true" role\x3d"columnheader"',E,' id\x3d"',x.id,'"']}else E=['\x3ctd tabIndex\x3d"-1" role\x3d"gridcell"',this.grid.editable&&
!x.editable?'aria-readonly\x3d"true"':""];x.colSpan&&E.push(' colspan\x3d"',x.colSpan,'"');x.rowSpan&&E.push(' rowspan\x3d"',x.rowSpan,'"');E.push(' class\x3d"dojoxGridCell ');x.classes&&E.push(x.classes," ");C&&E.push(C," ");u.push(E.join(""));u.push("");E=['" idx\x3d"',x.index,'" style\x3d"'];q&&";"!=q[q.length-1]&&(q+=";");E.push(x.styles,q||"",x.hidden?"display:none;":"");x.unitWidth&&E.push("width:",x.unitWidth,";");u.push(E.join(""));u.push("");E=['"'];x.attrs&&E.push(" ",x.attrs);E.push("\x3e");
u.push(E.join(""));u.push("");u.push(F?"\x3c/th\x3e":"\x3c/td\x3e");return u},isCellNode:function(x){return!(!x||x==v.doc||!b.attr(x,"idx"))},getCellNodeIndex:function(x){return x?Number(b.attr(x,"idx")):-1},getCellNode:function(x,q){for(var C=0,F;(F=g(x.firstChild,C))&&F.cells;C++)for(var u=0,E;E=F.cells[u];u++)if(this.getCellNodeIndex(E)==q)return E;return null},findCellTarget:function(x,q){for(;x&&(!this.isCellNode(x)||x.offsetParent&&r in x.offsetParent.parentNode&&x.offsetParent.parentNode[r]!=
this.view.id)&&x!=q;)x=x.parentNode;return x!=q?x:null},baseDecorateEvent:function(x){x.dispatch="do"+x.type;x.grid=this.grid;x.sourceView=this.view;x.cellNode=this.findCellTarget(x.target,x.rowNode);x.cellIndex=this.getCellNodeIndex(x.cellNode);x.cell=0<=x.cellIndex?this.grid.getCell(x.cellIndex):null},findTarget:function(x,q){for(;x&&x!=this.domNode&&(!(q in x)||r in x&&x[r]!=this.view.id);)x=x.parentNode;return x!=this.domNode?x:null},findRowTarget:function(x){return this.findTarget(x,e)},isIntraNodeEvent:function(x){try{return x.cellNode&&
x.relatedTarget&&b.isDescendant(x.relatedTarget,x.cellNode)}catch(q){return!1}},isIntraRowEvent:function(x){try{var q=x.relatedTarget&&this.findRowTarget(x.relatedTarget);return!q&&-1==x.rowIndex||q&&x.rowIndex==q.gridRowIndex}catch(C){return!1}},dispatchEvent:function(x){return x.dispatch in this?this[x.dispatch](x):!1},domouseover:function(x){x.cellNode&&x.cellNode!=this.lastOverCellNode&&(this.lastOverCellNode=x.cellNode,this.grid.onMouseOver(x));this.grid.onMouseOverRow(x)},domouseout:function(x){if(x.cellNode&&
x.cellNode==this.lastOverCellNode&&!this.isIntraNodeEvent(x,this.lastOverCellNode)&&(this.lastOverCellNode=null,this.grid.onMouseOut(x),!this.isIntraRowEvent(x)))this.grid.onMouseOutRow(x)},domousedown:function(x){if(x.cellNode)this.grid.onMouseDown(x);this.grid.onMouseDownRow(x)},_getTextDirStyle:function(x,q,C){return""}});G=n._ContentBuilder=B.extend(function(x){w.call(this,x)},w.prototype,{update:function(){this.prepareHtml()},prepareHtml:function(){for(var x=this.grid.get,q=this.view.structure.cells,
C=0,F;F=q[C];C++)for(var u=0,E;E=F[u];u++)E.get=E.get||void 0==E.value&&x,E.markup=this.generateCellMarkup(E,E.cellStyles,E.cellClasses,!1),!this.grid.editable&&E.editable&&(this.grid.editable=!0)},generateHtml:function(x,q){x=this.getTableArray();var C=this.view.structure.cells,F=this.grid.getItem(q);c.fire(this.view,"onBeforeRow",[q,C]);for(var u=0,E;E=C[u];u++)if(!E.hidden&&!E.header){x.push(E.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var D=0,M,I,z;M=E[D];D++){I=M.markup;
var K=M.customClasses=[];z=M.customStyles=[];I[5]=M.format(q,F);I[1]=K.join(" ");I[3]=z.join(";");(K=M.textDir||this.grid.textDir)&&(I[3]+=this._getTextDirStyle(K,M,q));x.push.apply(x,I)}x.push("\x3c/tr\x3e")}x.push("\x3c/table\x3e");return x.join("")},decorateEvent:function(x){x.rowNode=this.findRowTarget(x.target);if(!x.rowNode)return!1;x.rowIndex=x.rowNode[e];this.baseDecorateEvent(x);x.cell=this.grid.getCell(x.cellIndex);return!0}});var H=n._HeaderBuilder=B.extend(function(x){this.moveable=null;
w.call(this,x)},w.prototype,{_skipBogusClicks:!1,overResizeWidth:4,minColWidth:1,update:function(){this.tableMap?this.tableMap.mapRows(this.view.structure.cells):this.tableMap=new n._TableMap(this.view.structure.cells)},generateHtml:function(x,q){var C,F=this.getTableArray(),u=this.view.structure.cells;c.fire(this.view,"onBeforeRow",[-1,u]);for(var E=0,D;D=u[E];E++)if(!D.hidden){F.push(D.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var M=0,I,z;I=D[M];M++)I.customClasses=
[],I.customStyles=[],this.view.simpleStructure&&(I.draggable&&(I.headerClasses?-1==I.headerClasses.indexOf("dojoDndItem")&&(I.headerClasses+=" dojoDndItem"):I.headerClasses="dojoDndItem"),I.attrs?-1==I.attrs.indexOf("dndType\x3d'gridColumn_")&&(I.attrs+=" dndType\x3d'gridColumn_"+this.grid.id+"'"):I.attrs="dndType\x3d'gridColumn_"+this.grid.id+"'"),z=this.generateCellMarkup(I,I.headerStyles,I.headerClasses,!0),z[5]=void 0!=q?q:x(I),z[3]=I.customStyles.join(";"),(C=I.textDir||this.grid.textDir)&&(z[3]+=
this._getTextDirStyle(C,I,q)),z[1]=I.customClasses.join(" "),F.push(z.join(""));F.push("\x3c/tr\x3e")}F.push("\x3c/table\x3e");return F.join("")},getCellX:function(x){var q=f("th");for(var C=x.target;C&&q(C);C=C.parentNode);(q=C)?(q=h.position(q),x=x.clientX-q.x):x=x.layerX;return x},decorateEvent:function(x){this.baseDecorateEvent(x);x.rowIndex=-1;x.cellX=this.getCellX(x);return!0},prepareResize:function(x,q){do{var C=x.cellIndex;x.cellNode=C?x.cellNode.parentNode.cells[C+q]:null;x.cellIndex=x.cellNode?
this.getCellNodeIndex(x.cellNode):-1}while(x.cellNode&&"none"==x.cellNode.style.display);return!!x.cellNode},canResize:function(x){if(!x.cellNode||1<x.cellNode.colSpan)return!1;x=this.grid.getCell(x.cellIndex);return!x.noresize&&x.canResize()},overLeftResizeArea:function(x){if(b.hasClass(v.body(),"dojoDndMove"))return!1;if(l("ie")){var q=x.target;if(b.hasClass(q,"dojoxGridArrowButtonNode")||b.hasClass(q,"dojoxGridArrowButtonChar")||b.hasClass(q,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?
0<x.cellIndex&&0<x.cellX&&x.cellX<this.overResizeWidth&&this.prepareResize(x,-1):x.cellNode&&0<x.cellX&&x.cellX<this.overResizeWidth},overRightResizeArea:function(x){if(b.hasClass(v.body(),"dojoDndMove"))return!1;if(l("ie")){var q=x.target;if(b.hasClass(q,"dojoxGridArrowButtonNode")||b.hasClass(q,"dojoxGridArrowButtonChar")||b.hasClass(q,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?x.cellNode&&x.cellX>=x.cellNode.offsetWidth-this.overResizeWidth:0<x.cellIndex&&x.cellX>=x.cellNode.offsetWidth-
this.overResizeWidth&&this.prepareResize(x,-1)},domousemove:function(x){if(!this.moveable){var q=this.overRightResizeArea(x)?"dojoxGridColResize":this.overLeftResizeArea(x)?"dojoxGridColResize":"";q&&!this.canResize(x)&&(q="dojoxGridColNoResize");b.toggleClass(x.sourceView.headerNode,"dojoxGridColNoResize","dojoxGridColNoResize"==q);b.toggleClass(x.sourceView.headerNode,"dojoxGridColResize","dojoxGridColResize"==q);q&&t.stop(x)}},domousedown:function(x){this.moveable||((this.overRightResizeArea(x)||
this.overLeftResizeArea(x))&&this.canResize(x)?this.beginColumnResize(x):(this.grid.onMouseDown(x),this.grid.onMouseOverRow(x)))},doclick:function(x){return this._skipBogusClicks?(t.stop(x),!0):!1},colResizeSetup:function(x,q){var C=b.contentBox(x.sourceView.headerNode);if(q){this.lineDiv=document.createElement("div");q=b.position(x.sourceView.headerNode,!0);var F=b.contentBox(x.sourceView.domNode),u=x.pageX;!this.grid.isLeftToRight()&&8>l("ie")&&(u-=k.getScrollbar().w);b.style(this.lineDiv,{top:q.y+
"px",left:u+"px",height:F.h+C.h+"px"});b.addClass(this.lineDiv,"dojoxGridResizeColLine");this.lineDiv._origLeft=u;v.body().appendChild(this.lineDiv)}q=[];F=this.tableMap.findOverlappingNodes(x.cellNode);u=0;for(var E;E=F[u];u++)q.push({node:E,index:this.getCellNodeIndex(E),width:E.offsetWidth});F=x.sourceView;E=this.grid.isLeftToRight()?1:-1;var D=x.grid.views.views;u=[];for(var M=F.idx+E,I;I=D[M];M+=E)u.push({node:I.headerNode,left:window.parseInt(I.headerNode.style.left)});E=F.headerContentNode.firstChild;
return{scrollLeft:x.sourceView.headerNode.scrollLeft,view:F,node:x.cellNode,index:x.cellIndex,w:b.contentBox(x.cellNode).w,vw:C.w,table:E,tw:b.contentBox(E).w,spanners:q,followers:u}},beginColumnResize:function(x){this.moverDiv=document.createElement("div");b.style(this.moverDiv,{position:"absolute",left:0});v.body().appendChild(this.moverDiv);b.addClass(this.grid.domNode,"dojoxGridColumnResizing");var q=this.moveable=new d(this.moverDiv),C=this.colResizeSetup(x,!0);q.onMove=B.hitch(this,"doResizeColumn",
C);p.connect(q,"onMoveStop",B.hitch(this,function(){this.endResizeColumn(C);C.node.releaseCapture&&C.node.releaseCapture();this.moveable.destroy();delete this.moveable;this.moveable=null;b.removeClass(this.grid.domNode,"dojoxGridColumnResizing")}));x.cellNode.setCapture&&x.cellNode.setCapture();q.onMouseDown(x)},doResizeColumn:function(x,q,C){var F=C.l;F={deltaX:F,w:x.w+(this.grid.isLeftToRight()?F:-F),vw:x.vw+F,tw:x.tw+F};this.dragRecord={inDrag:x,mover:q,leftTop:C};F.w>=this.minColWidth&&(q?b.style(this.lineDiv,
"left",this.lineDiv._origLeft+F.deltaX+"px"):this.doResizeNow(x,F))},endResizeColumn:function(x){if(this.dragRecord){var q=this.dragRecord.leftTop;q=this.grid.isLeftToRight()?q.l:-q.l;q+=Math.max(x.w+q,this.minColWidth)-(x.w+q);l("webkit")&&x.spanners.length&&(q+=b._getPadBorderExtents(x.spanners[0].node).w);this.doResizeNow(x,{deltaX:q,w:x.w+q,vw:x.vw+q,tw:x.tw+q});delete this.dragRecord}b.destroy(this.lineDiv);b.destroy(this.moverDiv);b.destroy(this.moverDiv);delete this.moverDiv;this._skipBogusClicks=
!0;x.view.update();this._skipBogusClicks=!1;this.grid.onResizeColumn(x.index)},doResizeNow:function(x,q){x.view.convertColPctToFixed();if(x.view.flexCells&&!x.view.testFlexCells()){var C=a(x.node);C&&(C.style.width="")}var F;for(C=0;F=x.spanners[C];C++){var u=F.width+q.deltaX;0<u&&(F.node.style.width=u+"px",x.view.setColWidth(F.index,u))}if(this.grid.isLeftToRight()||!l("ie"))for(C=0;F=x.followers[C];C++)u=F.left+q.deltaX,F.node.style.left=u+"px";x.node.style.width=q.w+"px";x.view.setColWidth(x.index,
q.w);x.view.headerNode.style.width=q.vw+"px";x.view.setColumnsWidth(q.tw);this.grid.isLeftToRight()||(x.view.headerNode.scrollLeft=x.scrollLeft+q.deltaX)}});n._TableMap=B.extend(function(x){this.mapRows(x)},{map:null,mapRows:function(x){if(x.length){this.map=[];for(var q,C=0;q=x[C];C++)this.map[C]=[];for(C=0;q=x[C];C++)for(var F=0,u=0,E,D;E=q[F];F++){for(;this.map[C][u];)u++;this.map[C][u]={c:F,r:C};D=E.rowSpan||1;E=E.colSpan||1;for(var M=0;M<D;M++)for(var I=0;I<E;I++)this.map[C+M][u+I]=this.map[C][u];
u+=E}}},dumpMap:function(){for(var x=0,q;q=this.map[x];x++)for(var C=0;q[C];C++);},getMapCoords:function(x,q){for(var C=0,F;F=this.map[C];C++)for(var u=0,E;E=F[u];u++)if(E.c==q&&E.r==x)return{j:C,i:u};return{j:-1,i:-1}},getNode:function(x,q,C){return(x=x&&x.rows[q])&&x.cells[C]},_findOverlappingNodes:function(x,q,C){var F=[];q=this.getMapCoords(q,C);C=0;for(var u;u=this.map[C];C++)C!=q.j&&(u=(u=u[q.i])?this.getNode(x,u.r,u.c):null)&&F.push(u);return F},findOverlappingNodes:function(x){return this._findOverlappingNodes(a(x),
m(x.parentNode),0<=x.cellIndex?x.cellIndex:A.indexOf(x.parentNode.cells,x))}});return{_Builder:w,_HeaderBuilder:H,_ContentBuilder:G}})},"dojo/dnd/Moveable":function(){define("../_base/array ../_base/declare ../_base/lang ../dom ../dom-class ../Evented ../has ../on ../topic ../touch ./common ./Mover ../_base/window".split(" "),function(G,A,B,v,t,l,p,d,k,c,b,h,n){function m(f,e){"touchAction"in document.body.style?g="touchAction":"msTouchAction"in document.body.style&&(g="msTouchAction");a=function(r,
w){r.style[g]=w};a(f,e)}var g,a=function(){};p("touch-action")&&(a=m);return A("dojo.dnd.Moveable",[l],{handle:"",delay:0,skip:!1,constructor:function(f,e){this.node=v.byId(f);a(this.node,"none");e||(e={});this.handle=e.handle?v.byId(e.handle):null;this.handle||(this.handle=this.node);this.delay=0<e.delay?e.delay:0;this.skip=e.skip;this.mover=e.mover?e.mover:h;this.events=[d(this.handle,c.press,B.hitch(this,"onMouseDown")),d(this.handle,"dragstart",B.hitch(this,"onSelectStart")),d(this.handle,"selectstart",
B.hitch(this,"onSelectStart"))]},markupFactory:function(f,e,r){return new r(e,f)},destroy:function(){G.forEach(this.events,function(f){f.remove()});a(this.node,"");this.events=this.node=this.handle=null},onMouseDown:function(f){if(!this.skip||!b.isFormElement(f)){if(this.delay)this.events.push(d(this.handle,c.move,B.hitch(this,"onMouseMove")),d(this.handle.ownerDocument,c.release,B.hitch(this,"onMouseUp"))),this._lastX=f.pageX,this._lastY=f.pageY;else this.onDragDetected(f);f.stopPropagation();f.preventDefault()}},
onMouseMove:function(f){if(Math.abs(f.pageX-this._lastX)>this.delay||Math.abs(f.pageY-this._lastY)>this.delay)this.onMouseUp(f),this.onDragDetected(f);f.stopPropagation();f.preventDefault()},onMouseUp:function(f){for(var e=0;2>e;++e)this.events.pop().remove();f.stopPropagation();f.preventDefault()},onSelectStart:function(f){this.skip&&b.isFormElement(f)||(f.stopPropagation(),f.preventDefault())},onDragDetected:function(f){new this.mover(this.node,f,this)},onMoveStart:function(f){k.publish("/dnd/move/start",
f);t.add(n.body(),"dojoMove");t.add(this.node,"dojoMoveItem")},onMoveStop:function(f){k.publish("/dnd/move/stop",f);t.remove(n.body(),"dojoMove");t.remove(this.node,"dojoMoveItem")},onFirstMove:function(){},onMove:function(f,e){this.onMoving(f,e);var r=f.node.style;r.left=e.l+"px";r.top=e.t+"px";this.onMoved(f,e)},onMoving:function(){},onMoved:function(){}})})},"dojo/dnd/Mover":function(){define("../_base/array ../_base/declare ../_base/lang ../sniff ../_base/window ../dom ../dom-geometry ../dom-style ../Evented ../on ../touch ./common ./autoscroll".split(" "),
function(G,A,B,v,t,l,p,d,k,c,b,h,n){return A("dojo.dnd.Mover",[k],{constructor:function(m,g,a){function f(e){e.preventDefault();e.stopPropagation()}this.node=l.byId(m);this.marginBox={l:g.pageX,t:g.pageY};this.mouseButton=g.button;g=this.host=a;m=m.ownerDocument;this.events=[c(m,b.move,B.hitch(this,"onFirstMove")),c(m,b.move,B.hitch(this,"onMouseMove")),c(m,b.release,B.hitch(this,"onMouseUp")),c(m,"dragstart",f),c(m.body,"selectstart",f)];n.autoScrollStart(m);if(g&&g.onMoveStart)g.onMoveStart(this)},
onMouseMove:function(m){n.autoScroll(m);var g=this.marginBox;this.host.onMove(this,{l:g.l+m.pageX,t:g.t+m.pageY},m);m.preventDefault();m.stopPropagation()},onMouseUp:function(m){(v("webkit")&&v("mac")&&2==this.mouseButton?0==m.button:this.mouseButton==m.button)&&this.destroy();m.preventDefault();m.stopPropagation()},onFirstMove:function(m){var g=this.node.style,a=this.host;switch(g.position){case "relative":case "absolute":var f=Math.round(parseFloat(g.left))||0;g=Math.round(parseFloat(g.top))||0;
break;default:g.position="absolute";g=p.getMarginBox(this.node);f=t.doc.body;var e=d.getComputedStyle(f),r=p.getMarginBox(f,e);e=p.getContentBox(f,e);f=g.l-(e.l-r.l);g=g.t-(e.t-r.t)}this.marginBox.l=f-this.marginBox.l;this.marginBox.t=g-this.marginBox.t;if(a&&a.onFirstMove)a.onFirstMove(this,m);this.events.shift().remove()},destroy:function(){G.forEach(this.events,function(g){g.remove()});var m=this.host;if(m&&m.onMoveStop)m.onMoveStop(this);this.events=this.node=this.host=null}})})},"dojox/grid/_ViewManager":function(){define(["dojo/_base/declare",
"dojo/_base/sniff","dojo/dom-class"],function(G,A,B){return G("dojox.grid._ViewManager",null,{constructor:function(v){this.grid=v},defaultWidth:200,views:[],resize:function(){this.onEach("resize")},render:function(){this.onEach("render")},addView:function(v){v.idx=this.views.length;this.views.push(v)},destroyViews:function(){for(var v=0,t;t=this.views[v];v++)t.destroy();this.views=[]},getContentNodes:function(){for(var v=[],t=0,l;l=this.views[t];t++)v.push(l.contentNode);return v},forEach:function(v){for(var t=
0,l;l=this.views[t];t++)v(l,t)},onEach:function(v,t){t=t||[];for(var l=0,p;p=this.views[l];l++)v in p&&p[v].apply(p,t)},normalizeHeaderNodeHeight:function(){for(var v=[],t=0,l;l=this.views[t];t++)l.headerContentNode.firstChild&&v.push(l.headerContentNode);this.normalizeRowNodeHeights(v)},normalizeRowNodeHeights:function(v){var t=0,l=[];if(this.grid.rowHeight)t=this.grid.rowHeight;else{if(1>=v.length)return;for(var p=0,d;d=v[p];p++)B.contains(d,"dojoxGridNonNormalizedCell")||(l[p]=d.firstChild.offsetHeight,
t=Math.max(t,l[p]));t=0<=t?t:0;(A("mozilla")||8<A("ie"))&&t&&t++}for(p=0;d=v[p];p++)l[p]!=t&&(d.firstChild.style.height=t+"px")},resetHeaderNodeHeight:function(){for(var v=0,t;t=this.views[v];v++)if(t=t.headerContentNode.firstChild)t.style.height=""},renormalizeRow:function(v){for(var t=[],l=0,p,d;(p=this.views[l])&&(d=p.getRowNode(v));l++)d.firstChild.style.height="",t.push(d);this.normalizeRowNodeHeights(t)},getViewWidth:function(v){return this.views[v].getWidth()||this.defaultWidth},measureHeader:function(){this.resetHeaderNodeHeight();
this.forEach(function(t){t.headerContentNode.style.height=""});var v=0;this.forEach(function(t){v=Math.max(t.headerNode.offsetHeight,v)});return v},measureContent:function(){var v=0;this.forEach(function(t){v=Math.max(t.domNode.offsetHeight,v)});return v},findClient:function(v){v=this.grid.elasticView||-1;if(0>v)for(var t=1,l;l=this.views[t];t++)if(l.viewWidth){for(t=1;l=this.views[t];t++)if(!l.viewWidth){v=t;break}break}0>v&&(v=Math.floor(this.views.length/2));return v},arrange:function(v,t){var l,
p,d=this.views.length,k=this,c=0>=t?d:this.findClient(),b=function(m,g){var a=m.domNode.style,f=m.headerNode.style;k.grid.isLeftToRight()?(a.left=g+"px",f.left=g+"px"):(a.right=g+"px",4>A("ff")?f.right=g+m.getScrollbarWidth()+"px":f.right=g+"px",A("webkit")||"auto"==f.width||(f.width=parseInt(f.width,10)-m.getScrollbarWidth()+"px"));a.top="0px";f.top=0};for(l=0;(p=this.views[l])&&l<c;l++){var h=this.getViewWidth(l);p.setSize(h,0);b(p,v);h=p.headerContentNode&&p.headerContentNode.firstChild?p.getColumnsWidth()+
p.getScrollbarWidth():p.domNode.offsetWidth;v+=h}l++;for(var n=d-1;(p=this.views[n])&&l<=n;n--)h=this.getViewWidth(n),p.setSize(h,0),h=p.domNode.offsetWidth,t-=h,b(p,t);c<d&&(p=this.views[c],h=Math.max(1,t-v),p.setSize(h+"px",0),b(p,v));return v},renderRow:function(v,t,l){for(var p=[],d=0,k,c;(k=this.views[d])&&(c=t[d]);d++)k=k.renderRow(v),c.appendChild(k),p.push(k);l||this.normalizeRowNodeHeights(p)},rowRemoved:function(v){this.onEach("rowRemoved",[v])},updateRow:function(v,t){for(var l=0,p;p=this.views[l];l++)p.updateRow(v);
t||this.renormalizeRow(v)},updateRowStyles:function(v){this.onEach("updateRowStyles",[v])},setScrollTop:function(v){for(var t=v,l=0,p;p=this.views[l];l++)t=p.setScrollTop(v),A("ie")&&p.headerNode&&p.scrollboxNode&&(p.headerNode.scrollLeft=p.scrollboxNode.scrollLeft);return t},getFirstScrollingView:function(){for(var v=0,t;t=this.views[v];v++)if(t.hasHScrollbar()||t.hasVScrollbar())return t;return null}})})},"dojox/grid/_RowManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class"],
function(G,A,B){return G("dojox.grid._RowManager",null,{constructor:function(v){this.grid=v},linesToEms:2,overRow:-2,prepareStylingRow:function(v,t){return{index:v,node:t,odd:!!(v&1),selected:!!this.grid.selection.isSelected(v),over:this.isOver(v),customStyles:"",customClasses:"dojoxGridRow"}},styleRowNode:function(v,t){v=this.prepareStylingRow(v,t);this.grid.onStyleRow(v);this.applyStyles(v)},applyStyles:function(v){v.node.className=v.customClasses;var t=v.node.style.height,l=v.node,p=v.customStyles+
";"+(v.node._style||"");void 0==l.style.cssText?l.setAttribute("style",p):l.style.cssText=p;v.node.style.height=t},updateStyles:function(v){this.grid.updateRowStyles(v)},setOverRow:function(v){var t=this.overRow;this.overRow=v;t!=this.overRow&&(A.isString(t)||0<=t)&&this.updateStyles(t);this.updateStyles(this.overRow)},isOver:function(v){return this.overRow==v&&!B.contains(this.grid.domNode,"dojoxGridColumnResizing")}})})},"dojox/grid/_FocusManager":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/declare dojo/_base/connect dojo/_base/event dojo/_base/sniff dojo/query ./util dojo/_base/html".split(" "),
function(G,A,B,v,t,l,p,d,k){return B("dojox.grid._FocusManager",null,{constructor:function(c){this.grid=c;this.cell=null;this.rowIndex=-1;this._connects=[];this._headerConnects=[];this.headerMenu=this.grid.headerMenu;this._connects.push(v.connect(this.grid.domNode,"onfocus",this,"doFocus"));this._connects.push(v.connect(this.grid.domNode,"onblur",this,"doBlur"));this._connects.push(v.connect(this.grid.domNode,"mousedown",this,"_mouseDown"));this._connects.push(v.connect(this.grid.domNode,"mouseup",
this,"_mouseUp"));this._connects.push(v.connect(this.grid.domNode,"oncontextmenu",this,"doContextMenu"));this._connects.push(v.connect(this.grid.lastFocusNode,"onfocus",this,"doLastNodeFocus"));this._connects.push(v.connect(this.grid.lastFocusNode,"onblur",this,"doLastNodeBlur"));this._connects.push(v.connect(this.grid,"_onFetchComplete",this,"_delayedCellFocus"));this._connects.push(v.connect(this.grid,"postrender",this,"_delayedHeaderFocus"))},destroy:function(){G.forEach(this._connects,v.disconnect);
G.forEach(this._headerConnects,v.disconnect);delete this.grid;delete this.cell},_colHeadNode:null,_colHeadFocusIdx:null,_contextMenuBindNode:null,tabbingOut:!1,focusClass:"dojoxGridCellFocus",focusView:null,initFocusView:function(){this.focusView=this.grid.views.getFirstScrollingView()||this.focusView||this.grid.views.views[0];this._initColumnHeaders()},isFocusCell:function(c,b){return this.cell==c&&this.rowIndex==b},isLastFocusCell:function(){return this.cell?this.rowIndex==this.grid.rowCount-1&&
this.cell.index==this.grid.layout.cellCount-1:!1},isFirstFocusCell:function(){return this.cell?0===this.rowIndex&&0===this.cell.index:!1},isNoFocusCell:function(){return 0>this.rowIndex||!this.cell},isNavHeader:function(){return!!this._colHeadNode},getHeaderIndex:function(){return this._colHeadNode?G.indexOf(this._findHeaderCells(),this._colHeadNode):-1},_focusifyCellNode:function(c){var b=this.cell&&this.cell.getNode(this.rowIndex);if(b&&(k.toggleClass(b,this.focusClass,c),c)){c=this.scrollIntoView();
try{if(l("webkit")||!this.grid.edit.isEditing())d.fire(b,"focus"),c&&(this.cell.view.scrollboxNode.scrollLeft=c)}catch(h){}}},_delayedCellFocus:function(){if(!this.isNavHeader()&&this.grid.focused){var c=this.cell&&this.cell.getNode(this.rowIndex);if(c)try{this.grid.edit.isEditing()||(k.toggleClass(c,this.focusClass,!0),this._colHeadNode&&this.blurHeader(),d.fire(c,"focus"))}catch(b){}}},_delayedHeaderFocus:function(){this.isNavHeader()&&this.focusHeader()},_initColumnHeaders:function(){G.forEach(this._headerConnects,
v.disconnect);this._headerConnects=[];for(var c=this._findHeaderCells(),b=0;b<c.length;b++)this._headerConnects.push(v.connect(c[b],"onfocus",this,"doColHeaderFocus")),this._headerConnects.push(v.connect(c[b],"onblur",this,"doColHeaderBlur"))},_findHeaderCells:function(){for(var c=p("th",this.grid.viewsHeaderNode),b=[],h=0;h<c.length;h++){var n=c[h],m=k.hasAttr(n,"tabIndex"),g=k.attr(n,"tabIndex");m&&0>g&&b.push(n)}return b},_setActiveColHeader:function(c,b,h){this.grid.domNode.setAttribute("aria-activedescendant",
c.id);null!=h&&0<=h&&h!=b&&k.toggleClass(this._findHeaderCells()[h],this.focusClass,!1);k.toggleClass(c,this.focusClass,!0);this._colHeadNode=c;this._colHeadFocusIdx=b;this._scrollHeader(this._colHeadFocusIdx)},scrollIntoView:function(){var c=this.cell?this._scrollInfo(this.cell):null;if(!c||!c.s)return null;var b=this.grid.scroller.findScrollTop(this.rowIndex);c.n&&c.sr&&(c.n.offsetLeft+c.n.offsetWidth>c.sr.l+c.sr.w?c.s.scrollLeft=c.n.offsetLeft+c.n.offsetWidth-c.sr.w:c.n.offsetLeft<c.sr.l&&(c.s.scrollLeft=
c.n.offsetLeft));c.r&&c.sr&&(b+c.r.offsetHeight>c.sr.t+c.sr.h?this.grid.setScrollTop(b+c.r.offsetHeight-c.sr.h):b<c.sr.t&&this.grid.setScrollTop(b));return c.s.scrollLeft},_scrollInfo:function(c,b){if(c){var h=c.view.scrollboxNode,n={w:h.clientWidth,l:h.scrollLeft,t:h.scrollTop,h:h.clientHeight},m=c.view.getRowNode(this.rowIndex);return{c:c,s:h,sr:n,n:b?b:c.getNode(this.rowIndex),r:m}}return null},_scrollHeader:function(c){var b=null;if(this._colHeadNode){var h=this.grid.getCell(c);if(!h)return;b=
this._scrollInfo(h,h.getNode(0))}b&&b.s&&b.sr&&b.n&&(b.n.offsetLeft+b.n.offsetWidth>b.sr.l+b.sr.w?b.s.scrollLeft=b.n.offsetLeft+b.n.offsetWidth-b.sr.w:b.n.offsetLeft<b.sr.l?b.s.scrollLeft=b.n.offsetLeft:7>=l("ie")&&h&&h.view.headerNode&&(h.view.headerNode.scrollLeft=b.s.scrollLeft))},_isHeaderHidden:function(){var c=this.focusView;if(!c)for(var b=0,h;h=this.grid.views.views[b];b++)if(h.headerNode){c=h;break}return c&&"none"==k.getComputedStyle(c.headerNode).display},colSizeAdjust:function(c,b,h){var n=
this._findHeaderCells(),m=this.focusView;if(!m||!m.header.tableMap.map)for(var g=0,a;a=this.grid.views.views[g];g++)if(a.header.tableMap.map){m=a;break}g=n[b];!m||b==n.length-1&&0===b||(m.content.baseDecorateEvent(c),c.cellNode=g,c.cellIndex=m.content.getCellNodeIndex(c.cellNode),c.cell=0<=c.cellIndex?this.grid.getCell(c.cellIndex):null,m.header.canResize(c)&&(b={l:h},c=m.header.colResizeSetup(c,!1),m.header.doResizeColumn(c,null,b),m.update()))},styleRow:function(c){},setFocusIndex:function(c,b){this.setFocusCell(this.grid.getCell(b),
c)},setFocusCell:function(c,b){c&&!this.isFocusCell(c,b)&&(this.tabbingOut=!1,this._colHeadNode&&this.blurHeader(),this._colHeadNode=this._colHeadFocusIdx=null,this.focusGridView(),this._focusifyCellNode(!1),this.cell=c,this.rowIndex=b,this._focusifyCellNode(!0));if(l("opera"))setTimeout(A.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1);else this.grid.onCellFocus(this.cell,this.rowIndex)},next:function(){if(this.cell){var c=this.rowIndex,b=this.cell.index+1,h=this.grid.layout.cellCount-
1,n=this.grid.rowCount-1;b>h&&(b=0,c++);c>n&&(b=h,c=n);if(this.grid.edit.isEditing()&&(h=this.grid.getCell(b),!this.isLastFocusCell()&&(!h.editable||this.grid.canEdit&&!this.grid.canEdit(h,c)))){this.cell=h;this.rowIndex=c;this.next();return}this.setFocusIndex(c,b)}},previous:function(){if(this.cell){var c=this.rowIndex||0,b=(this.cell.index||0)-1;0>b&&(b=this.grid.layout.cellCount-1,c--);0>c&&(b=c=0);if(this.grid.edit.isEditing()){var h=this.grid.getCell(b);if(!this.isFirstFocusCell()&&!h.editable){this.cell=
h;this.rowIndex=c;this.previous();return}}this.setFocusIndex(c,b)}},move:function(c,b){var h=0>b?-1:1;if(this.isNavHeader()){c=this._findHeaderCells();var n=currentIdx=G.indexOf(c,this._colHeadNode);for(currentIdx+=b;0<=currentIdx&&currentIdx<c.length&&"none"==c[currentIdx].style.display;)currentIdx+=h;0<=currentIdx&&currentIdx<c.length&&this._setActiveColHeader(c[currentIdx],currentIdx,n)}else if(this.cell){var m=this.grid.scroller;n=this.rowIndex;var g=this.grid.rowCount-1,a=Math.min(g,Math.max(0,
n+c));c&&(0<c?a>m.getLastPageRow(m.page)&&this.grid.setScrollTop(this.grid.scrollTop+m.findScrollTop(a)-m.findScrollTop(n)):0>c&&a<=m.getPageRow(m.page)&&this.grid.setScrollTop(this.grid.scrollTop-m.findScrollTop(n)-m.findScrollTop(a)));m=this.grid.layout.cellCount-1;for(var f=this.cell.index,e=Math.min(m,Math.max(0,f+b)),r=this.grid.getCell(e);0<=e&&e<m&&r&&!0===r.hidden;)e+=h,r=this.grid.getCell(e);r&&!0!==r.hidden||(e=f);h=r.getNode(a);!h&&c?0<=a+c&&a+c<=g&&this.move(0<c?++c:--c,b):h&&"none"!==
k.style(h,"display")||!b?(this.setFocusIndex(a,e),c&&this.grid.updateRow(n)):0<=e+b&&e+b<=m&&this.move(c,0<b?++b:--b)}},previousKey:function(c){this.grid.edit.isEditing()?(t.stop(c),this.previous()):this.isNavHeader()||this._isHeaderHidden()?(this.tabOut(this.grid.domNode),null!=this._colHeadFocusIdx&&(k.toggleClass(this._findHeaderCells()[this._colHeadFocusIdx],this.focusClass,!1),this._colHeadFocusIdx=null),this._focusifyCellNode(!1)):(this.grid.domNode.focus(),t.stop(c))},nextKey:function(c){c.target===
this.grid.domNode&&null==this._colHeadFocusIdx?(this.focusHeader(),t.stop(c)):this.isNavHeader()?(this.blurHeader(),this.findAndFocusGridCell()||this.tabOut(this.grid.lastFocusNode),this._colHeadNode=this._colHeadFocusIdx=null):this.grid.edit.isEditing()?(t.stop(c),this.next()):this.tabOut(this.grid.lastFocusNode)},tabOut:function(c){this.tabbingOut=!0;c.focus()},focusGridView:function(){d.fire(this.focusView,"focus")},focusGrid:function(c){this.focusGridView();this._focusifyCellNode(!0)},findAndFocusGridCell:function(){var c=
!0,b=0===this.grid.rowCount;this.isNoFocusCell()&&!b?(b=0,this.grid.getCell(b).hidden&&(b=this.isNavHeader()?this._colHeadFocusIdx:0),this.setFocusIndex(0,b)):this.cell&&!b?(this.focusView&&!this.focusView.rowNodes[this.rowIndex]&&this.grid.scrollToRow(this.rowIndex),this.focusGrid()):c=!1;this._colHeadNode=this._colHeadFocusIdx=null;return c},focusHeader:function(){var c=this._findHeaderCells(),b=this._colHeadFocusIdx;this._isHeaderHidden()?this.findAndFocusGridCell():this._colHeadFocusIdx||(this.isNoFocusCell()?
this._colHeadFocusIdx=0:this._colHeadFocusIdx=this.cell.index);for(this._colHeadNode=c[this._colHeadFocusIdx];this._colHeadNode&&0<=this._colHeadFocusIdx&&this._colHeadFocusIdx<c.length&&"none"==this._colHeadNode.style.display;)this._colHeadFocusIdx++,this._colHeadNode=c[this._colHeadFocusIdx];this._colHeadNode&&"none"!=this._colHeadNode.style.display?(this.headerMenu&&this._contextMenuBindNode!=this.grid.domNode&&(this.headerMenu.unBindDomNode(this.grid.viewsHeaderNode),this.headerMenu.bindDomNode(this.grid.domNode),
this._contextMenuBindNode=this.grid.domNode),this._setActiveColHeader(this._colHeadNode,this._colHeadFocusIdx,b),this._scrollHeader(this._colHeadFocusIdx),this._focusifyCellNode(!1)):this.findAndFocusGridCell()},blurHeader:function(){k.removeClass(this._colHeadNode,this.focusClass);k.removeAttr(this.grid.domNode,"aria-activedescendant");if(this.headerMenu&&this._contextMenuBindNode==this.grid.domNode){var c=this.grid.viewsHeaderNode;this.headerMenu.unBindDomNode(this.grid.domNode);this.headerMenu.bindDomNode(c);
this._contextMenuBindNode=c}},doFocus:function(c){c&&c.target!=c.currentTarget?t.stop(c):this._clickFocus||(this.tabbingOut||this.focusHeader(),this.tabbingOut=!1,t.stop(c))},doBlur:function(c){t.stop(c)},doContextMenu:function(c){this.headerMenu||t.stop(c)},doLastNodeFocus:function(c){this.tabbingOut?this._focusifyCellNode(!1):0<this.grid.rowCount?(this.isNoFocusCell()&&this.setFocusIndex(0,0),this._focusifyCellNode(!0)):this.focusHeader();this.tabbingOut=!1;t.stop(c)},doLastNodeBlur:function(c){t.stop(c)},
doColHeaderFocus:function(c){this._setActiveColHeader(c.target,k.attr(c.target,"idx"),this._colHeadFocusIdx);this._scrollHeader(this.getHeaderIndex());t.stop(c)},doColHeaderBlur:function(c){k.toggleClass(c.target,this.focusClass,!1)},_mouseDown:function(c){this._clickFocus=dojo.some(this.grid.views.views,function(b){return b.scrollboxNode===c.target})},_mouseUp:function(c){this._clickFocus=!1}})})},"dojox/grid/_EditManager":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/connect dojo/_base/sniff ./util".split(" "),
function(G,A,B,v,t,l){return B("dojox.grid._EditManager",null,{constructor:function(p){this.grid=p;this.connections=t("ie")?[v.connect(document.body,"onfocus",G.hitch(this,"_boomerangFocus"))]:[];this.connections.push(v.connect(this.grid,"onBlur",this,"apply"));this.connections.push(v.connect(this.grid,"prerender",this,"_onPreRender"))},info:{},destroy:function(){A.forEach(this.connections,v.disconnect)},cellFocus:function(p,d){this.grid.singleClickEdit||this.isEditRow(d)?this.setEditCell(p,d):this.apply();
(this.isEditing()||p&&p.editable&&p.alwaysEditing)&&this._focusEditor(p,d)},rowClick:function(p){this.isEditing()&&!this.isEditRow(p.rowIndex)&&this.apply()},styleRow:function(p){p.index==this.info.rowIndex&&(p.customClasses+=" dojoxGridRowEditing")},dispatchEvent:function(p){var d=p.cell;return(d=d&&d.editable?d:0)&&d.dispatchEvent(p.dispatch,p)},isEditing:function(){return void 0!==this.info.rowIndex},isEditCell:function(p,d){return this.info.rowIndex===p&&this.info.cell.index==d},isEditRow:function(p){return this.info.rowIndex===
p},setEditCell:function(p,d){!this.isEditCell(d,p.index)&&this.grid.canEdit&&this.grid.canEdit(p,d)&&this.start(p,d,this.isEditRow(d)||p.editable)},_focusEditor:function(p,d){l.fire(p,"focus",[d])},focusEditor:function(){this.isEditing()&&this._focusEditor(this.info.cell,this.info.rowIndex)},_boomerangWindow:500,_shouldCatchBoomerang:function(){return this._catchBoomerang>(new Date).getTime()},_boomerangFocus:function(){this._shouldCatchBoomerang()&&(this.grid.focus.focusGrid(),this.focusEditor(),
this._catchBoomerang=0)},_doCatchBoomerang:function(){t("ie")&&(this._catchBoomerang=(new Date).getTime()+this._boomerangWindow)},start:function(p,d,k){this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.isEditing()&&!this.isEditRow(d)&&(this.applyRowEdit(),this.grid.updateRow(d)),k?(this.info={cell:p,rowIndex:d},this.grid.doStartEdit(p,d),this.grid.updateRow(d)):this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._focusEditor(p,d),this._doCatchBoomerang())},_editorDo:function(p){var d=
this.info.cell;if(d&&d.editable)d[p](this.info.rowIndex)},editorApply:function(){this._editorDo("apply")},editorCancel:function(){this._editorDo("cancel")},applyCellEdit:function(p,d,k){this.grid.canEdit(d,k)&&this.grid.doApplyCellEdit(p,k,d.field)},applyRowEdit:function(){this.grid.doApplyEdit(this.info.rowIndex,this.info.cell.field)},apply:function(){this.isEditing()&&this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.applyRowEdit(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),
this._doCatchBoomerang())},cancel:function(){this.isEditing()&&(this.grid.beginUpdate(),this.editorCancel(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},save:function(p,d){var k=this.info.cell;!this.isEditRow(p)||d&&k.view!=d||!k.editable||k.save(k,this.info.rowIndex)},restore:function(p,d){var k=this.info.cell;this.isEditRow(d)&&k.view==p&&k.editable&&k.restore(this.info.rowIndex)},_isValidInput:function(){var p=(this.info.cell||{}).widget;if(!p||!p.isValid)return!0;
p.focused=!0;return p.isValid(!0)},_onPreRender:function(){this.isEditing()&&(this.info.value=this.info.cell.getValue())}})})},"dojox/grid/Selection":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-attr"],function(G,A,B,v){return G("dojox.grid.Selection",null,{constructor:function(t){this.grid=t;this.selected=[];this.setMode(t.selectionMode)},mode:"extended",selected:null,updating:0,selectedIndex:-1,rangeStartIndex:-1,setMode:function(t){this.selected.length&&
this.deselectAll();this.mode="extended"!=t&&"multiple"!=t&&"single"!=t&&"none"!=t?"extended":t},onCanSelect:function(t){return this.grid.onCanSelect(t)},onCanDeselect:function(t){return this.grid.onCanDeselect(t)},onSelected:function(t){},onDeselected:function(t){},onChanging:function(){},onChanged:function(){},isSelected:function(t){return"none"==this.mode?!1:this.selected[t]},getFirstSelected:function(){if(!this.selected.length||"none"==this.mode)return-1;for(var t=0,l=this.selected.length;t<l;t++)if(this.selected[t])return t;
return-1},getNextSelected:function(t){if("none"==this.mode)return-1;t+=1;for(var l=this.selected.length;t<l;t++)if(this.selected[t])return t;return-1},getSelected:function(){for(var t=[],l=0,p=this.selected.length;l<p;l++)this.selected[l]&&t.push(l);return t},getSelectedCount:function(){for(var t=0,l=0;l<this.selected.length;l++)this.selected[l]&&t++;return t},_beginUpdate:function(){if(0===this.updating)this.onChanging();this.updating++},_endUpdate:function(){this.updating--;if(0===this.updating)this.onChanged()},
select:function(t){"none"!=this.mode&&("multiple"!=this.mode?(this.deselectAll(t),this.addToSelection(t)):this.toggleSelect(t))},addToSelection:function(t){if("none"!=this.mode)if(B.isArray(t))A.forEach(t,this.addToSelection,this);else if(t=Number(t),this.selected[t])this.selectedIndex=t;else if(!1!==this.onCanSelect(t)){this.selectedIndex=t;var l=this.grid.getRowNode(t);l&&v.set(l,"aria-selected","true");this._beginUpdate();this.selected[t]=!0;this.onSelected(t);this._endUpdate()}},deselect:function(t){if("none"!=
this.mode)if(B.isArray(t))A.forEach(t,this.deselect,this);else if(t=Number(t),this.selectedIndex==t&&(this.selectedIndex=-1),this.selected[t]&&!1!==this.onCanDeselect(t)){var l=this.grid.getRowNode(t);l&&v.set(l,"aria-selected","false");this._beginUpdate();delete this.selected[t];this.onDeselected(t);this._endUpdate()}},setSelected:function(t,l){this[l?"addToSelection":"deselect"](t)},toggleSelect:function(t){B.isArray(t)?A.forEach(t,this.toggleSelect,this):this.setSelected(t,!this.selected[t])},
_range:function(t,l,p){var d=0<=t?t:l;t=l;d>t&&(t=d,d=l);for(l=d;l<=t;l++)p(l)},selectRange:function(t,l){this._range(t,l,B.hitch(this,"addToSelection"))},deselectRange:function(t,l){this._range(t,l,B.hitch(this,"deselect"))},insert:function(t){this.selected.splice(t,0,!1);this.selectedIndex>=t&&this.selectedIndex++},remove:function(t){this.selected.splice(t,1);this.selectedIndex>=t&&this.selectedIndex--},deselectAll:function(t){for(var l in this.selected)l!=t&&!0===this.selected[l]&&this.deselect(l)},
clickSelect:function(t,l,p){if("none"!=this.mode){this._beginUpdate();if("extended"!=this.mode)this.select(t);else{if(!p||0>this.rangeStartIndex)this.rangeStartIndex=t;l||this.deselectAll(t);p?this.selectRange(this.rangeStartIndex,t):l?this.toggleSelect(t):this.addToSelection(t)}this._endUpdate()}},clickSelectEvent:function(t){this.clickSelect(t.rowIndex,dojo.isCopyKey(t),t.shiftKey)},clear:function(){this._beginUpdate();this.deselectAll();this._endUpdate()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare",
"dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(G,A,B,v){return G("dijit.CheckedMenuItem",B,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:v,checked:!1,_setCheckedAttr:function(t){this.domNode.setAttribute("aria-checked",t?"true":"false");this._set("checked",t)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(t){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));
this.onClick(t)}})})},"dojox/grid/DataSelection":function(){define(["dojo/_base/declare","./_SelectionPreserver","./Selection"],function(G,A,B){return G("dojox.grid.DataSelection",B,{constructor:function(v){v.keepSelection&&(this.preserver=new A(this))},destroy:function(){this.preserver&&this.preserver.destroy()},getFirstSelected:function(){var v=B.prototype.getFirstSelected.call(this);return-1==v?null:this.grid.getItem(v)},getNextSelected:function(v){v=this.grid.getItemIndex(v);v=B.prototype.getNextSelected.call(this,
v);return-1==v?null:this.grid.getItem(v)},getSelected:function(){for(var v=[],t=0,l=this.selected.length;t<l;t++)this.selected[t]&&v.push(this.grid.getItem(t));return v},addToSelection:function(v){if("none"!=this.mode){var t=null;t="number"==typeof v||"string"==typeof v?v:this.grid.getItemIndex(v);B.prototype.addToSelection.call(this,t)}},deselect:function(v){if("none"!=this.mode){var t=null;t="number"==typeof v||"string"==typeof v?v:this.grid.getItemIndex(v);B.prototype.deselect.call(this,t)}},deselectAll:function(v){var t=
null;v||"number"==typeof v?(t="number"==typeof v||"string"==typeof v?v:this.grid.getItemIndex(v),B.prototype.deselectAll.call(this,t)):this.inherited(arguments)}})})},"dojox/grid/_SelectionPreserver":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array"],function(G,A,B,v){return G("dojox.grid._SelectionPreserver",null,{constructor:function(t){this.selection=t;var l=this.grid=t.grid;this.reset();this._connects=[A.connect(l,"_setStore",this,"reset"),A.connect(l,
"_addItem",this,"_reSelectById"),A.connect(t,"onSelected",B.hitch(this,"_selectById",!0)),A.connect(t,"onDeselected",B.hitch(this,"_selectById",!1)),A.connect(t,"deselectAll",this,"reset")]},destroy:function(){this.reset();v.forEach(this._connects,A.disconnect);delete this._connects},reset:function(){this._selectedById={}},_reSelectById:function(t,l){t&&this.grid._hasIdentity&&(this.selection.selected[l]=this._selectedById[this.grid.store.getIdentity(t)])},_selectById:function(t,l){if("none"!=this.selection.mode&&
this.grid._hasIdentity){var p=l,d=this.grid;if("number"==typeof l||"string"==typeof l)p=(l=d._by_idx[l])&&l.item;p&&(this._selectedById[d.store.getIdentity(p)]=!!t);return p}}})})},"esri/dijit/editing/TemplatePickerItem":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/sniff dojo/dom-style dijit/_Widget dijit/_Templated dojox/gfx ../../symbols/jsonUtils ../../kernel".split(" "),function(G,A,B,v,t,l,p,d,k,c,b){G=G([p,d],{declaredClass:"esri.dijit.editing.TemplatePickerItem",
templateString:"\x3cdiv class\x3d'item' style\x3d'text-align: center;'\x3e\x3cdiv class\x3d'itemSymbol' dojoAttachPoint\x3d'_surfaceNode'\x3e\x3c/div\x3e\x3cdiv class\x3d'itemLabel'\x3e${label}\x3c/div\x3e\x3c/div\x3e",startup:function(){this._started||(this.inherited(arguments),this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template))},_draw:function(h,n,m,g,a){if(n&&"textsymbol"!==n.type){h=k.createSurface(h,m,g);if(9>v("ie")){var f=h.getEventSource();
l.set(f,"position","relative");l.set(f.parentNode,"position","relative")}n=!this.legendOverride&&this._getDrawingToolShape(n,a)||c.getShapeDescriptors(n);try{var e=h.createShape(n.defaultShape).setFill(n.fill).setStroke(n.stroke)}catch(H){h.clear();h.destroy();return}var r=e.getBoundingBox();n=r.width;a=r.height;f=-(r.x+n/2);r=-(r.y+a/2);var w=h.getDimensions();f={dx:f+w.width/2,dy:r+w.height/2};if(n>m||a>g)r=n/m>a/g,m=((r?m:g)-5)/(r?n:a),A.mixin(f,{xx:m,yy:m});e.applyTransform(f);return h}},_getDrawingToolShape:function(h,
n){switch(n?n.drawingTool||null:null){case "esriFeatureEditToolArrow":n={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolLeftArrow":n={type:"path",path:"M -15,1 L -8,8 L -8,5 L 10,5 L 10,-2 L -8,-2 L -8,-5 L -15,1 E"};break;case "esriFeatureEditToolRightArrow":n={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolUpArrow":n={type:"path",path:"M 1,-10 L 8,-3 L 5,-3 L 5,15 L -2,15 L -2,-3 L -5,-3 L 1,-10 E"};
break;case "esriFeatureEditToolDownArrow":n={type:"path",path:"M 1,15 L 8,8 L 5,8 L 5,-10 L -2,-10 L -2,8 L -5,8 L 1,15 E"};break;case "esriFeatureEditToolTriangle":n={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":n={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":n={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":n={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;case "esriFeatureEditToolFreehand":n=
"simplelinesymbol"===h.type||"cartographiclinesymbol"===h.type?{type:"path",path:"m -11, -7c-1.5,-3.75 7.25,-9.25 12.5,-7c5.25,2.25 6.75,9.75 3.75,12.75c-3,3 -3.25,2.5 -9.75,5.25c-6.5,2.75 -7.25,14.25 2,15.25c9.25,1 11.75,-4 13.25,-6.75c1.5,-2.75 3.5,-11.75 12,-6.5"}:{type:"path",path:"M 10,-13 c3.1,0.16667 4.42564,2.09743 2.76923,3.69231c-2.61025,2.87179 -5.61025,5.6718 -6.14358,6.20513c-0.66667,0.93333 -0.46667,1.2 -0.53333,1.93333c-0.00001,0.86666 0.6,1.66667 1.13334,2c1.03077,0.38462 2.8,0.93333 3.38974,1.70769c0.47693,0.42564 0.87693,0.75897 1.41026,1.75897c0.13333,1.06667 -0.46667,2.86667 -1.8,3.8c-0.73333,0.73333 -3.86667,2.66666 -4.86667,3.13333c-0.93333,0.8 -7.4,3.2 -7.6,3.06667c-1.06667,0.46667 -4.73333,1.13334 -5.2,1.26667c-1.6,0.33334 -4.6,0.4 -6.25128,0.05128c-1.41539,-0.18462 -2.34872,-2.31796 -1.41539,-4.45129c0.93333,-1.73333 1.86667,-3.13333 2.64615,-3.85641c1.28718,-1.47692 2.57437,-2.68204 3.88718,-3.54359c0.88718,-1.13845 1.8,-1.33333 2.26666,-2.45641c0.33334,-0.74359 0.37949,-1.7641 0.06667,-2.87692c-0.66666,-1.46666 -1.66666,-1.86666 -2.98975,-2.2c-1.27692,-0.26666 -2.12307,-0.64102 -3.27692,-1.46666c-0.66667,-1.00001 -1.01538,-3.01539 0.73333,-4.06667c1.73333,-1.2 3.6,-1.93333 4.93333,-2.2c1.33333,-0.46667 4.84104,-1.09743 5.84103,-1.23076c1.60001,-0.46667 6.02564,-0.50257 7.29231,-0.56924z"};
break;default:return null}return{defaultShape:n,fill:h.getFill(),stroke:h.getStroke()}},_repaint:function(h){h?(h.getStroke&&h.setStroke&&h.setStroke(h.getStroke()),h.getFill&&h.setFill&&h.setFill(h.getFill()),h.children&&A.isArray(h.children)&&B.forEach(h.children,this._repaint,this)):this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template)},destroy:function(){this._surface&&(this._surface.destroy(),delete this._surface);this.inherited(arguments)}});
v("extend-esri")&&A.setObject("dijit.editing.TemplatePickerItem",G,b);return G})},"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Button.html":'\x3cspan class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonNode"\r\n\t\tdata-dojo-attach-event\x3d"ondijitclick:__onClick" role\x3d"presentation"\r\n\t\t\x3e\x3cspan class\x3d"dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode,focusNode"\r\n\t\t\trole\x3d"button" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitToggleButtonIconChar"\x3e\x26#x25CF;\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tid\x3d"${id}_label"\r\n\t\t\t\tdata-dojo-attach-point\x3d"containerNode"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\x3e\x3c/span\r\n\t\x3e\x3c/span\r\n\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" class\x3d"dijitOffScreen"\r\n\t\tdata-dojo-attach-event\x3d"onclick:_onClick"\r\n\t\ttabIndex\x3d"-1" aria-hidden\x3d"true" data-dojo-attach-point\x3d"valueNode"\r\n/\x3e\x3c/span\x3e\r\n',
"url:dijit/form/templates/DropDownButton.html":'\x3cspan class\x3d"dijit dijitReset dijitInline"\r\n\t\x3e\x3cspan class\x3d\'dijitReset dijitInline dijitButtonNode\'\r\n\t\tdata-dojo-attach-event\x3d"ondijitclick:__onClick" data-dojo-attach-point\x3d"_buttonNode"\r\n\t\t\x3e\x3cspan class\x3d"dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"focusNode,titleNode,_arrowWrapperNode,_popupStateNode"\r\n\t\t\trole\x3d"button" aria-haspopup\x3d"true" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitIcon"\r\n\t\t\t\tdata-dojo-attach-point\x3d"iconNode"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tdata-dojo-attach-point\x3d"containerNode"\r\n\t\t\t\tid\x3d"${id}_label"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitArrowButtonInner"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitArrowButtonChar"\x3e\x26#9660;\x3c/span\r\n\t\t\x3e\x3c/span\r\n\t\x3e\x3c/span\r\n\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" class\x3d"dijitOffScreen" tabIndex\x3d"-1"\r\n\t\tdata-dojo-attach-event\x3d"onclick:_onClick" data-dojo-attach-point\x3d"valueNode" aria-hidden\x3d"true"\r\n/\x3e\x3c/span\x3e\r\n',
"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/form/templates/TextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/templates/Tooltip.html":'\x3cdiv class\x3d"dijitTooltip dijitTooltipLeft" id\x3d"dojoTooltip" data-dojo-attach-event\x3d"mouseenter:onMouseEnter,mouseleave:onMouseLeave"\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipConnector" data-dojo-attach-point\x3d"connectorNode"\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipContainer dijitTooltipContents" data-dojo-attach-point\x3d"containerNode" role\x3d\'alert\'\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/ValidationTextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/form/templates/ComboButton.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tcellspacing\x3d\'0\' cellpadding\x3d\'0\' role\x3d"presentation"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonNode" data-dojo-attach-point\x3d"buttonNode" data-dojo-attach-event\x3d"ondijitclick:__onClick,onkeydown:_onButtonKeyDown"\r\n\t\t\x3e\x3cdiv id\x3d"${id}_button" class\x3d"dijitReset dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode"\r\n\t\t\trole\x3d"button" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInline dijitIcon" data-dojo-attach-point\x3d"iconNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInline dijitButtonText" id\x3d"${id}_label" data-dojo-attach-point\x3d"containerNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd id\x3d"${id}_arrow" class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton\'\r\n\t\t\tdata-dojo-attach-point\x3d"_popupStateNode,focusNode,_buttonNode"\r\n\t\t\tdata-dojo-attach-event\x3d"onkeydown:_onArrowKeyDown"\r\n\t\t\ttitle\x3d"${optionsTitle}"\r\n\t\t\trole\x3d"button" aria-haspopup\x3d"true"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitArrowButtonInner" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitArrowButtonChar" role\x3d"presentation"\x3e\x26#9660;\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd style\x3d"display:none !important;"\r\n\t\t\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" data-dojo-attach-point\x3d"valueNode"\r\n\t\t\t\tclass\x3d"dijitOffScreen" aria-hidden\x3d"true" data-dojo-attach-event\x3d"onclick:_onClick"\r\n\t\t/\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dojox/grid/resources/View.html":'\x3cdiv class\x3d"dojoxGridView" role\x3d"presentation"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridHeader" dojoAttachPoint\x3d"headerNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"headerNodeContainer" style\x3d"width:9000em" role\x3d"presentation"\x3e\r\n\t\t\t\x3cdiv dojoAttachPoint\x3d"headerContentNode" role\x3d"row"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" dojoAttachPoint\x3d"hiddenFocusNode" aria-hidden\x3d"true" /\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" aria-hidden\x3d"true" /\x3e\r\n\t\x3cdiv class\x3d"dojoxGridScrollbox" dojoAttachPoint\x3d"scrollboxNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dojoxGridContent" dojoAttachPoint\x3d"contentNode" hidefocus\x3d"hidefocus" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dojox/grid/resources/_Grid.html":'\x3cdiv hidefocus\x3d"hidefocus" role\x3d"grid" dojoAttachEvent\x3d"onmouseout:_mouseOut"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterHeader" dojoAttachPoint\x3d"viewsHeaderNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterView" dojoAttachPoint\x3d"viewsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterMessages" style\x3d"display: none;" dojoAttachPoint\x3d"messagesNode"\x3e\x3c/div\x3e\r\n\t\x3cspan dojoAttachPoint\x3d"lastFocusNode" tabindex\x3d"0"\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/TemplatePicker.html":'\x3cdiv class\x3d"templatePicker"\x3e\r\n\r\n  \x3ctable dojoType\x3d"dojox.grid.DataGrid" noDataMessage\x3d"${emptyMessage}" selectionMode\x3d"none" autoHeight\x3d"${_rows}" autoWidth\x3d"${_autoWidth}"\r\n         query\x3d"{ query: \'*\' }" dojoAttachPoint\x3d"grid" class\x3d"grid"\x3e\r\n  \x3c/table\x3e\r\n  \r\n\x3c/div\x3e',"url:esri/dijit/editing/templates/Editor.html":'\x3cdiv class\x3d"esriEditor"\x3e\r\n    \x3cdiv class\x3d"esriTemplatePicker" dojoAttachPoint\x3d"templatePickerDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriDrawingToolbar" dojoAttachPoint\x3d"drawingToolbarDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"progressBar" dojoAttachPoint\x3d"progressBar" indeterminate\x3d"true" dojoType\x3d"dijit.ProgressBar" /\x3e\r\n\x3c/div\x3e',
"*now":function(G){G(['dojo/i18n!*preload*esri/dijit/editing/nls/Editor-all*["ar","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("esri/dijit/editing/Editor-all","../../layers/FeatureLayer ../../toolbars/_toolbar ../../toolbars/draw ../../toolbars/edit ../../tasks/geometry ../AttributeInspector ./AttachmentEditor ./Editor ./TemplatePicker ./Util ./SelectionHelper".split(" "),function(G,A,B,v,t,l,p,d,k,c,b){return{}});