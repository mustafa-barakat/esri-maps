// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"dojo/debounce":function(){define([],function(){return function(G,I){var C;return function(){C&&clearTimeout(C);var p=this,y=arguments;C=setTimeout(function(){G.apply(p,y)},I)}}})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(G,I,C){G.DeferredList=function(p,y,z,u,r){var x=[];I.call(this);var M=this;0!==p.length||y||this.resolve([0,[]]);var P=0;C.forEach(p,function(U,Z){function H(g,J){x[Z]=[g,J];P++;P===p.length&&M.resolve(x)}
U.then(function(g){y?M.resolve([Z,g]):H(!0,g)},function(g){z?M.reject(g):H(!1,g);if(u)return null;throw g;})})};G.DeferredList.prototype=new I;G.DeferredList.prototype.gatherResults=function(p){p=new G.DeferredList(p,!1,!0,!1);p.addCallback(function(y){var z=[];C.forEach(y,function(u){z.push(u[1])});return z});return p};return G.DeferredList})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(G,I,C,p,y,z,u,r,x,M,P,U,Z){function H(){}function g(J){return function(n,t,F,N){return n&&"string"==typeof t&&n[t]==H?n.on(t.substring(2).toLowerCase(),u.hitch(F,N)):J.apply(C,arguments)}}G.around(C,"connect",g);z.connect&&G.around(z,"connect",g);G=p("dijit._Widget",[P,U,Z],{onClick:H,onDblClick:H,onKeyDown:H,onKeyPress:H,onKeyUp:H,onMouseDown:H,onMouseMove:H,onMouseOut:H,onMouseOver:H,onMouseLeave:H,onMouseEnter:H,onMouseUp:H,constructor:function(J){this._toConnect={};for(var n in J)this[n]===
H&&(this._toConnect[n.replace(/^on/,"").toLowerCase()]=J[n],delete J[n])},postCreate:function(){this.inherited(arguments);for(var J in this._toConnect)this.on(J,this._toConnect[J]);delete this._toConnect},on:function(J,n){return this[this._onMap(J)]===H?C.connect(this.domNode,J.toLowerCase(),this,n):this.inherited(arguments)},_setFocusedAttr:function(J){this._focused=J;this._set("focused",J)},setAttribute:function(J,n){z.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(J,n)},attr:function(J,n){return 2<=arguments.length||"object"===typeof J?this.set.apply(this,arguments):this.get(J)},getDescendants:function(){z.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?r("[widgetId]",this.containerNode).map(M.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});y("dijit-legacy-requires")&&x(0,function(){require(["dijit/_base"])});
return G})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(G,I,C,p,y,z,u,r,x,M,P,U,Z,H,g,J,n,t,F,N,K,T,Q){function X(l){return function(v){r[v?
"set":"remove"](this.domNode,l,v);this._set(l,v)}}Z.add("dijit-legacy-requires",!H.isAsync);Z.add("dojo-bidi",!1);Z("dijit-legacy-requires")&&n(0,function(){G(["dijit/_base/manager"])});var V={};p=z("dijit._WidgetBase",[t,K],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:X("lang"),dir:"",_setDirAttr:X("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(l){this._set("ownerDocument",
l)},attributeMap:{},_blankGif:p.blankGif||G.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var l=this.constructor;if(!l._setterAttrs){var v=l.prototype,A=l._setterAttrs=[];l=l._onMap={};for(var O in v.attributeMap)A.push(O);for(O in v)/^on/.test(O)&&(l[O.substring(2).toLowerCase()]=O),/^_set[A-Z](.*)Attr$/.test(O)&&(O=O.charAt(4).toLowerCase()+O.substr(5,O.length-9),v.attributeMap&&O in v.attributeMap||A.push(O))}},postscript:function(l,v){this.create(l,v)},create:function(l,
v){this._introspect();this.srcNodeRef=u.byId(v);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);l&&(this.params=l,g.mixin(this,l));this.postMixInProperties();this.id||(this.id=Q.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=N.body(this.ownerDocument);
Q.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();if((l=this.srcNodeRef)&&l.parentNode&&this.domNode!==l){l.parentNode.replaceChild(this.domNode,l);var A=!0}this.domNode.setAttribute("widgetId",this.id)}this.postCreate();A&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var l={},v;for(v in this.params||{})l[v]=this._get(v);I.forEach(this.constructor._setterAttrs,function(A){if(!(A in l)){var O=this._get(A);O&&this.set(A,O)}},this);for(v in l)this.set(v,
l[v])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var l=this.baseClass.split(" ");this.isLeftToRight()||(l=l.concat(I.map(l,function(v){return v+"Rtl"})));x.add(this.domNode,l)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,I.forEach(this.getChildren(),function(l){l._started||l._destroyed||!g.isFunction(l.startup)||(l.startup(),l._started=!0)}))},
destroyRecursive:function(l){this._beingDestroyed=!0;this.destroyDescendants(l);this.destroy(l)},destroy:function(l){function v(A){A.destroyRecursive?A.destroyRecursive(l):A.destroy&&A.destroy(l)}this._beingDestroyed=!0;this.uninitialize();I.forEach(this._connects,g.hitch(this,"disconnect"));I.forEach(this._supportingWidgets,v);this.domNode&&I.forEach(Q.findWidgets(this.domNode,this.containerNode),v);this.destroyRendering(l);Q.remove(this.id);this._destroyed=!0},destroyRendering:function(l){this.bgIframe&&
(this.bgIframe.destroy(l),delete this.bgIframe);this.domNode&&(l?r.remove(this.domNode,"widgetId"):M.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(l||M.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(l){I.forEach(this.getChildren(),function(v){v.destroyRecursive&&v.destroyRecursive(l)})},uninitialize:function(){return!1},_setStyleAttr:function(l){var v=this.domNode;g.isObject(l)?U.set(v,l):v.style.cssText=v.style.cssText?v.style.cssText+("; "+l):l;this._set("style",
l)},_attrToDom:function(l,v,A){A=3<=arguments.length?A:this.attributeMap[l];I.forEach(g.isArray(A)?A:[A],function(O){var ba=this[O.node||O||"domNode"];switch(O.type||"attribute"){case "attribute":g.isFunction(v)&&(v=g.hitch(this,v));O=O.attribute?O.attribute:/^on[A-Z][a-zA-Z]*$/.test(l)?l.toLowerCase():l;ba.tagName?r.set(ba,O,v):ba.set(O,v);break;case "innerText":ba.innerHTML="";ba.appendChild(this.ownerDocument.createTextNode(v));break;case "textContent":ba.textContent=v;break;case "innerHTML":ba.innerHTML=
v;break;case "class":x.replace(ba,v,this[l]);break;case "toggleClass":x.toggle(ba,O.className||l,v)}},this)},get:function(l){var v=this._getAttrNames(l);return this[v.g]?this[v.g]():this._get(l)},set:function(l,v){if("object"===typeof l){for(var A in l)this.set(A,l[A]);return this}A=this._getAttrNames(l);var O=this[A.s];if(g.isFunction(O))var ba=O.apply(this,Array.prototype.slice.call(arguments,1));else{O=this.focusNode&&!g.isFunction(this.focusNode)?"focusNode":"domNode";var xa=this[O]&&this[O].tagName,
la;if((la=xa)&&!(la=V[xa])){la=this[O];var za={};for(ma in la)za[ma.toLowerCase()]=!0;la=V[xa]=za}var ma=la;A=l in this.attributeMap?this.attributeMap[l]:A.s in this?this[A.s]:ma&&A.l in ma&&"function"!=typeof v||/^aria-|^data-|^role$/.test(l)?O:null;null!=A&&this._attrToDom(l,v,A);this._set(l,v)}return ba||this},_attrPairNames:{},_getAttrNames:function(l){var v=this._attrPairNames;if(v[l])return v[l];var A=l.replace(/^[a-z]|-[a-zA-Z]/g,function(O){return O.charAt(O.length-1).toUpperCase()});return v[l]=
{n:l+"Node",s:"_set"+A+"Attr",g:"_get"+A+"Attr",l:A.toLowerCase()}},_set:function(l,v){var A=this[l];this[l]=v;!this._created||A===v||A!==A&&v!==v||(this._watchCallbacks&&this._watchCallbacks(l,A,v),this.emit("attrmodified-"+l,{detail:{prevValue:A,newValue:v}}))},_get:function(l){return this[l]},emit:function(l,v,A){v=v||{};void 0===v.bubbles&&(v.bubbles=!0);void 0===v.cancelable&&(v.cancelable=!0);v.detail||(v.detail={});v.detail.widget=this;var O,ba=this["on"+l];ba&&(O=ba.apply(this,A?A:[v]));this._started&&
!this._beingDestroyed&&J.emit(this.domNode,l.toLowerCase(),v);return O},on:function(l,v){var A=this._onMap(l);return A?C.after(this,A,v,!0):this.own(J(this.domNode,l,v))[0]},_onMap:function(l){var v=this.constructor,A=v._onMap;if(!A){A=v._onMap={};for(var O in v.prototype)/^on/.test(O)&&(A[O.replace(/^on/,"").toLowerCase()]=O)}return A["string"==typeof l&&l.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?
Q.findWidgets(this.containerNode):[]},getParent:function(){return Q.getEnclosingWidget(this.domNode.parentNode)},connect:function(l,v,A){return this.own(y.connect(l,v,this,A))[0]},disconnect:function(l){l.remove()},subscribe:function(l,v){return this.own(F.subscribe(l,g.hitch(this,v)))[0]},unsubscribe:function(l){l.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():P.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=U.get(this.domNode,"display")},
placeAt:function(l,v){var A=!l.tagName&&Q.byId(l);!A||!A.addChild||v&&"number"!==typeof v?(l=A&&"domNode"in A?A.containerNode&&!/after|before|replace/.test(v||"")?A.containerNode:A.domNode:u.byId(l,this.ownerDocument),M.place(this.domNode,l,v),!this._started&&(this.getParent()||{})._started&&this.startup()):A.addChild(this,v);return this},defer:function(l,v){var A=setTimeout(g.hitch(this,function(){A&&(A=null,this._destroyed||g.hitch(this,l)())}),v||0);return{remove:function(){A&&(clearTimeout(A),
A=null);return null}}}});Z("dojo-bidi")&&p.extend(T);return p})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(G,I,C){return C("dijit.Destroyable",null,{destroy:function(p){this._destroyed=!0},own:function(){var p=["destroyRecursive","destroy","remove"];G.forEach(arguments,function(y){function z(){u.remove();G.forEach(r,function(M){M.remove()})}var u=I.before(this,"destroy",function(M){y[x](M)}),r=[];if(y.then){var x="cancel";y.then(z,z)}else G.forEach(p,
function(M){"function"===typeof y[M]&&(x||(x=M),r.push(I.after(y,M,z,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(G,I,C,p,y,z){G=p("dijit._OnDijitClickMixin",null,{connect:function(u,r,x){return this.inherited(arguments,[u,"ondijitclick"==r?z:r,x])}});G.a11yclick=z;return G})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],
function(G,I,C,p){p.extend(I,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return C("dijit._FocusMixin",null,{_focusManager:G})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(G,I,C,p){C(function(){I("highcontrast")&&G.add(p.body(),"dijit_a11y")});return I})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(G,I,C,p,y,z,u){y.add("highcontrast",function(){var r=u.doc.createElement("div");try{r.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(I.blankGif||G.toUrl("./resources/blank.gif"))+'");';u.body().appendChild(r);var x=p.getComputedStyle(r),M=x.backgroundImage;return x.borderTopColor==x.borderRightColor||M&&("none"==M||"url(invalid-url:)"==M)}catch(P){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
P.toString()),!1}finally{8>=y("ie")?r.outerHTML="":u.body().removeChild(r)}});z(function(){y("highcontrast")&&C.add(u.body(),"dj_a11y")});return y})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(G){var I=G.getObject("dojox.html.entities",!0),C=function(y,z){if(z._encCache&&z._encCache.regexp&&z._encCache.mapper&&z.length==z._encCache.length){var u=z._encCache.mapper;var r=z._encCache.regexp}else{u={};r=["["];var x;for(x=0;x<z.length;x++)u[z[x][0]]="\x26"+z[x][1]+";",r.push(z[x][0]);
r.push("]");r=new RegExp(r.join(""),"g");z._encCache={mapper:u,regexp:r,length:z.length}}return y=y.replace(r,function(M){return u[M]})},p=function(y,z){if(z._decCache&&z._decCache.regexp&&z._decCache.mapper&&z.length==z._decCache.length){var u=z._decCache.mapper;var r=z._decCache.regexp}else{u={};r=["("];var x;for(x=0;x<z.length;x++){var M="\x26"+z[x][1]+";";x&&r.push("|");u[M]=z[x][0];r.push(M)}r.push(")");r=new RegExp(r.join(""),"g");z._decCache={mapper:u,regexp:r,length:z.length}}return y=y.replace(r,
function(P){return u[P]})};I.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];I.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],
["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],
["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],
["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393",
"Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],
["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044",
"frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],
["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309",
"rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019",
"rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];I.encode=function(y,z){y&&(z?y=C(y,z):(y=C(y,I.html),y=C(y,I.latin)));return y};I.decode=function(y,z){y&&(z?y=p(y,z):(y=p(y,I.html),y=p(y,I.latin)));return y};return I})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(G,I,C,p){var y=function(u,
r){return u-r},z={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(u){var r=String(u),x=r.match(z._reNumber);u={integer:0,fractional:0};x&&x[1]?(u.integer=x[1].split("").length,u.fractional=x[3]?x[3].split("").length:0):-1<r.toLowerCase().indexOf("e")&&(x=r.split("e"),r=x[0],x=x[1],r&&x&&(r=Number(r),x=Number(x),(u=0<x)||(x=Math.abs(x)),r=z.getDigits(r),u?(r.integer+=x,r.fractional=x>r.fractional?0:r.fractional-x):(r.fractional+=x,r.integer=x>r.integer?1:r.integer-x),u=r));return u},getFixedNumbers:function(u,
r){var x=Number(u.toFixed(r));x<u?u=x+1/Math.pow(10,r):(u=x,x-=1/Math.pow(10,r));x=Number(x.toFixed(r));u=Number(u.toFixed(r));return[x,u]},getPctChange:function(u,r,x,M){var P={prev:null,next:null};if(null!=x){var U=u-x;P.prev=Math.floor(Math.abs(100*(r-x-U)/U))}null!=M&&(U=M-u,P.next=Math.floor(Math.abs(100*(M-r-U)/U)));return P},round:function(u,r){u=u.slice(0);var x,M,P=r&&null!=r.tolerance?r.tolerance:2,U=r&&r.indexes,Z=r&&null!=r.strictBounds?r.strictBounds:!1;if(U)U.sort(y);else for(U=[],x=
0;x<u.length;x++)U.push(x);for(x=0;x<U.length;x++){var H=U[x];r=u[H];var g=0===H?null:u[H-1];var J=H===u.length-1?null:u[H+1];var n=z.getDigits(r);if(n=n.fractional){var t=0;for(M=!1;t<=n&&!M;){var F=z.getFixedNumbers(r,t);F=Z&&0===x?F[1]:F[0];M=z.hasMinimalChange(r,F,g,J,P);t++}M&&(u[H]=F)}}return u},hasMinimalChange:function(u,r,x,M,P){u=z.getPctChange(u,r,x,M);r=null==u.prev||u.prev<=P;x=null==u.next||u.next<=P;return r&&x||u.prev+u.next<=2*P},_reAllZeros:new RegExp("\\"+C.decimal+"0+$","g"),_reSomeZeros:/(\d)0*$/g,
format:function(u,r){r=r||{places:20,round:-1};(u=I.format(u,r))&&(u=u.replace(z._reSomeZeros,"$1").replace(z._reAllZeros,""));return u}};G("extend-esri")&&(p.numberUtils=z);return z})},"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!dojo/cldr/nls/gregorian".split(" "),function(G,I,C,p,y,z,u,r){function x(n){return n&&I.map(n,function(t){return new u(t)})}function M(n,t,F){var N="";0===t?N=U.lt+" ":t===
F&&(N=U.gt+" ");return N+n}var P={},U={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},Z={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},H={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",
dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},g={formatLength:"short",fullYear:!0},J={formatLength:"short"};G.mixin(P,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(n,t){var F=[];null==n||n instanceof Date||(n=new Date(n));t=t||{};t=G.mixin({},t);var N=t.selector?t.selector.toLowerCase():null,K=!N||-1<N.indexOf("time");N=!N||-1<N.indexOf("date");
K&&(t.timeOptions=t.timeOptions||J,t.timeOptions&&(t.timeOptions=G.mixin({},t.timeOptions),t.timeOptions.selector=t.timeOptions.selector||"time",F.push(t.timeOptions)));N&&(t.dateOptions=t.dateOptions||g,t.dateOptions&&(t.dateOptions=G.mixin({},t.dateOptions),t.dateOptions.selector=t.dateOptions.selector||"date",F.push(t.dateOptions)));F&&F.length?(F=I.map(F,function(T){return p.format(n,T)}),t=1==F.length?F[0]:r["dateTimeFormat-medium"].replace(/'/g,"").replace(/\{(\d+)\}/g,function(T,Q){return F[Q]})):
t=p.format(n);return t},createColorStops:function(n){var t=n.values,F=n.colors,N=n.labelIndexes,K=n.isDate,T=n.dateFormatOptions;n=[];return n=I.map(t,function(Q,X){var V=null;if(!N||-1<I.indexOf(N,X)){var l;(l=K?P.formatDate(Q,T):z.format(Q))&&(V=M(l,X,t.length-1))}return{value:Q,color:F[X],label:V}})},updateColorStops:function(n){var t=n.stops,F=n.changes,N=n.isDate,K=n.dateFormatOptions,T=[],Q=I.map(t,function(V){return V.value});I.forEach(F,function(V){T.push(V.index);Q[V.index]=V.value});var X=
z.round(Q,{indexes:T});I.forEach(t,function(V,l){V.value=Q[l];if(null!=V.label){var v,A=null;(v=N?P.formatDate(X[l],K):z.format(X[l]))&&(A=M(v,l,t.length-1));V.label=A}})},createClassBreakLabel:function(n){var t=n.minValue,F=n.maxValue,N=n.isFirstBreak?"":U.gt+" ";n="percent-of-total"===n.normalizationType?U.pct:"";t=null==t?"":z.format(t);F=null==F?"":z.format(F);return N+t+n+" \u2013 "+F+n},setLabelsForClassBreaks:function(n){var t=n.classBreaks,F=n.classificationMethod,N=n.normalizationType,K=
[];t&&t.length&&("standard-deviation"===F?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):n.round?(K.push(t[0].minValue),I.forEach(t,function(T){K.push(T.maxValue)}),K=z.round(K),I.forEach(t,function(T,Q){T.label=P.createClassBreakLabel({minValue:0===Q?K[0]:K[Q],maxValue:K[Q+1],isFirstBreak:0===Q,normalizationType:N})})):I.forEach(t,function(T,Q){T.label=P.createClassBreakLabel({minValue:T.minValue,maxValue:T.maxValue,isFirstBreak:0===
Q,normalizationType:N})}))},updateClassBreak:function(n){var t=n.classBreaks,F=n.normalizationType,N=n.change,K=N.index;N=N.value;var T=-1,Q=-1,X=t.length;"standard-deviation"===n.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===K?T=K:K===X?Q=K-1:(Q=K-1,T=K),-1<T&&T<X&&(n=t[T],n.minValue=N,n.label=P.createClassBreakLabel({minValue:n.minValue,maxValue:n.maxValue,isFirstBreak:0===T,normalizationType:F})),-1<
Q&&Q<X&&(n=t[Q],n.maxValue=N,n.label=P.createClassBreakLabel({minValue:n.minValue,maxValue:n.maxValue,isFirstBreak:0===Q,normalizationType:F})))},calculateDateFormatInterval:function(n){var t,F,N=n.length,K=Infinity;n=I.map(n,function(O){return new Date(O)});for(t=0;t<N-1;t++){var T=n[t];var Q=[];var X=Infinity;var V="";for(F=t+1;F<N;F++){var l=n[F];l=T.getFullYear()!==l.getFullYear()&&"year"||T.getMonth()!==l.getMonth()&&"month"||T.getDate()!==l.getDate()&&"day"||T.getHours()!==l.getHours()&&"hour"||
T.getMinutes()!==l.getMinutes()&&"minute"||T.getSeconds()!==l.getSeconds()&&"second"||"millisecond";var v=Z[l];v<X&&(X=v,V=l);Q.push(l)}if(X<K){K=X;var A=V}}return A},createUniqueValueLabel:function(n){var t=n.value,F=n.fieldInfo,N=n.domain;n=n.dateFormatInterval;var K=String(t);(N=N&&N.codedValues?N.getName(t):null)?K=N:"number"===typeof t&&(K=F&&"esriFieldTypeDate"===F.type?P.formatDate(t,n&&H[n]):z.format(t));return K},cloneColorInfo:function(n){if(n){var t=G.mixin({},n);t.colors=x(t.colors);t.stops=
t.stops&&I.map(t.stops,function(F){F=G.mixin({},F);F.color&&(F.color=new u(F.color));return F});t.legendOptions&&(t.legendOptions=G.mixin({},t.legendOptions))}return t},cloneOpacityInfo:function(n){if(n){var t=G.mixin({},n);if(n=t.opacityValues)t.opacityValues=n.slice(0);if(n=t.stops)t.stops=I.map(n,function(F){return G.mixin({},F)});if(n=t.legendOptions)t.legendOptions=G.mixin({},n)}return t},cloneSizeInfo:function(n){if(n){var t=G.mixin({},n);t.stops&&(t.stops=I.map(t.stops,function(F){return G.mixin({},
F)}));(n=t.minSize)&&"object"===typeof n&&(t.minSize=P.cloneSizeInfo(n));(n=t.maxSize)&&"object"===typeof n&&(t.maxSize=P.cloneSizeInfo(n));if(n=t.legendOptions)if(t.legendOptions=G.mixin({},n),n=n.customValues)t.legendOptions.customValues=n.slice(0)}return t},getClassCodesForRelationship:function(){return G.clone({2:["L","H"],3:["L","M","H"],4:["L","M1","M2","H"]})},getClassValuesForRelationship:function(){return G.clone({2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM",
"LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]})}});C("extend-esri")&&G.setObject("renderer.utils",P,y);return P})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(G,I,C,p,y,z){return G([z,y],{_onMap:function(u){var r=this.constructor._onMap;r&&r.FINAL||(delete this.constructor._onMap,r=this.registerConnectEvents(),r.FINAL=!0);
u=u.toLowerCase();if(r[u])var x=this[r[u].method];else u=this._onCamelCase(u),this[u]&&(x=u);return x},on:function(u,r){var x=this._onMap(u),M=u.replace(/\-/g,""),P="on"+M in this.domNode;return x||!P?this.inherited(arguments):this.own(p(this.domNode,M,r))[0]},emit:function(u,r,x){var M,P=u.toLowerCase(),U=this.constructor._onMap||this.registerConnectEvents();var Z=this[this._onMap(P)];r=r||{};r.target||(r.target=this);if(Z&&U&&U[P]){this._onObj2Arr(function(){M=Array.prototype.slice.call(arguments)},
U[P].argKeys)(r);var H=I.mixin({},arguments);H[2]=M;H[0]=U[P].name.replace(/^on/,"")}return this.inherited(H||arguments)}})})},"*noref":1}});
define("esri/dijit/Legend","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/utils ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),function(G,
I,C,p,y,z,u,r,x,M,P,U,Z,H,g,J,n,t,F,N,K,T,Q,X,V,l,v,A,O,ba,xa,la,za,ma,Pa,Ga,ya,Aa,Ba,Ha,ra,Ia,Ja,Ca){var Ka=v.getClassValuesForRelationship(),La={defaultShape:{type:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15"},stroke:{width:1,color:"#555555"}},Da={HH:315,HL:45,LL:135,LH:225},Ma=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,na=I([Ja,t],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new u([64,
64,64]),defaultText:"Aa",sizeRampLightColor:new u([255,255,255]),sizeRampDarkColor:new u([128,128,128]),gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,_preserveCacheOnDestroy:!1,_layerConnects:null,_mapConnects:null,constructor:function(a,b){C.mixin(this,Ca.widgets.legend);this._i18n=Ca.widgets.legend;a=a||{};a.map?b?(this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=!1===a.respectCurrentMapScale?
!1:!0,this._respectVisibility=!1===a.respectVisibility?!1:!0,this._preserveCacheOnDestroy=a.preserveCacheOnDestroy?!0:!1,this.arrangement=a.arrangement===na.ALIGN_RIGHT?na.ALIGN_RIGHT:na.ALIGN_LEFT,this.arrangement===na.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},this.refresh=r(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},
postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],b;for(b=0;b<a.length;b+=1){var c=a[b];G.locale&&-1!==G.locale.indexOf(c)&&(-1!==G.locale.indexOf("-")?-1!==G.locale.indexOf(c+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0)}this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},
startup:function(){this.inherited(arguments);this._surfaceItems=[];this._initialize();9>x("ie")&&(this._repaintItems=C.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeCachedLegendResponses();this._removeHoverHandlers();this.inherited(arguments)},_removeCachedLegendResponses:function(){this._preserveCacheOnDestroy||p.forEach(this.layers,function(a){delete a.legendResponse})},refresh:function(a){if(this.domNode){a?(this.layerInfos=
a,this.layers=[],p.forEach(this.layerInfos,function(b){this._isSupportedLayerType(b.layer)&&(b.title&&(b.layer._titleForLegend=b.title),b.layer._hideDefaultSymbol=!1===b.defaultSymbol?!0:!1,b.hideLayers?(this.hideLayersInLegend[b.layer.id]=b.hideLayers,this._addSubLayersToHide(b)):this.hideLayersInLegend[b.layer.id]=[],b.hoverLabel&&(b.layer._hoverLabel=b.hoverLabel),b.hoverLabels&&(b.layer._hoverLabels=b.hoverLabels),this.layers.push(b.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=
null);for(a=this.domNode.children.length-1;0<=a;a--)g.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],p.forEach(this.layerInfos,function(c){this._isSupportedLayerType(c.layer)&&(c.title&&(c.layer._titleForLegend=c.title),c.layer._hideDefaultSymbol=!1===c.defaultSymbol?!0:!1,c.hideLayers?(this.hideLayersInLegend[c.layer.id]=c.hideLayers,this._addSubLayersToHide(c)):
this.hideLayersInLegend[c.layer.id]=[],c.hoverLabel&&(c.layer._hoverLabel=c.hoverLabel),c.hoverLabels&&(c.layer._hoverLabels=c.hoverLabels),this.layers.push(c.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],b=[];p.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);this._isSupportedLayerType(c)&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c));if("esri.layers.KMLLayer"===c.declaredClass){var e=
c.getLayers();p.forEach(e,function(d){a.push(d.id)},this)}"esri.layers.GeoRSSLayer"===c.declaredClass&&(e=c.getFeatureLayers(),p.forEach(e,function(d){b.push(d.id)},this))},this);p.forEach(this.map.graphicsLayerIds,function(c){var e=this.map.getLayer(c);-1===p.indexOf(a,c)&&-1===p.indexOf(b,c)&&this._isSupportedLayerType(e)&&this._isLayerDrawingEnabled(e)&&(e.arcgisProps&&e.arcgisProps.title&&(e._titleForLegend=e.arcgisProps.title),this.layers.push(e))},this)}this._createLegend()},_isLayerDrawingEnabled:function(a){return a&&
(a._params&&a._params.drawMode||a.isFeatureReductionActive&&a.isFeatureReductionActive())},_activate:function(){this._deactivate();if(this.autoUpdate){this._mapConnects=[];this._layerConnects={};var a=this._mapConnects;this._respectCurrentMapScale&&a.push(y.connect(this.map,"onZoomEnd",this,"_refreshLayers"));this.useAllMapLayers&&(a.push(y.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers")),a.push(y.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers")),a.push(y.connect(this.map,"onLayersReordered",
this,"_updateAllMapLayers")));p.forEach(this.layers,function(b){var c=[y.connect(b,"onFeatureReductionRendererChange",this,"_refreshLayers"),y.connect(b,"onFeatureReductionChange",this,"_refreshLayers"),y.connect(b,"onVisibilityChange",this,"_refreshLayers"),y.connect(b,"onOpacityChange",this,"_refreshLayers"),y.connect(b,"onScaleRangeChange",this,"_refreshLayers")];"esri.layers.ArcGISDynamicMapServiceLayer"===b.declaredClass&&b.supportsDynamicLayers&&c.push(y.connect(b,"_onDynamicLayersChange",C.hitch(this,
"_updateDynamicLayers",b)));if("esri.layers.ArcGISImageServiceLayer"===b.declaredClass||"esri.layers.RasterXLayer"===b.declaredClass)c.push(y.connect(b,"onRenderingChange",C.partial(this._updateImageServiceLayers,this,b))),c.push(y.connect(b,"onRendererChange",C.partial(this._updateImageServiceLayers,this,b)));("esri.layers.ArcGISImageServiceVectorLayer"===b.declaredClass||b.setWebGLEnabled)&&c.push(y.connect(b,"onRendererChange",C.hitch(this,"_refreshLayers")));this._layerConnects[b.id]=c},this)}},
_deactivate:function(){p.forEach(this._mapConnects,function(a){y.disconnect(a)});p.forEach(this.layers,function(a){var b=this._layerConnects;b&&p.forEach(b[a.id],function(c){y.disconnect(c)})},this);this._mapConnects=this._layerConnects=null},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];p.forEach(this.map.layerIds,
function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);p.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this._isLayerDrawingEnabled(a)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var a=!1,b=!1;J.set(this.domNode,"position","relative");g.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var c=[];p.forEach(this.layers,function(d){if("esri.layers.KMLLayer"===
d.declaredClass||"esri.layers.GeoRSSLayer"===d.declaredClass)if(d.loaded){if("esri.layers.KMLLayer"===d.declaredClass)var f=d.getLayers();else"esri.layers.GeoRSSLayer"===d.declaredClass&&(f=d.getFeatureLayers(),this.hideLayersInLegend[d.id]&&(f=p.filter(f,function(k){return-1===p.indexOf(this.hideLayersInLegend[d.id],k.id)},this)));p.forEach(f,function(k){"esri.layers.FeatureLayer"===k.declaredClass&&d._titleForLegend&&(k._titleForLegend=d._titleForLegend+" - ","esriGeometryPoint"===k.geometryType?
k._titleForLegend+=this.NLS_points:"esriGeometryPolyline"===k.geometryType?k._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"===k.geometryType&&(k._titleForLegend+=this.NLS_areas),c.push(k))},this)}else y.connect(d,"onLoad",C.hitch(this,function(){this.refresh(this.layerInfos)}));else if("esri.layers.WMSLayer"===d.declaredClass)if(!d.loaded)y.connect(d,"onLoad",C.hitch(this,function(){this.refresh(this.layerInfos)}));else{if((!this._respectVisibility||this._respectVisibility&&d.visible)&&0<d.layerInfos.length&&
p.some(d.layerInfos,function(k){return k.legendURL})){var h=!1;p.forEach(d.layerInfos,function(k){if(k.legendURL&&-1<p.indexOf(d.visibleLayers,k.name)){h||(g.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(d._titleForLegend||d.name||d.id)+"\x3c/span\x3e"},this.domNode),h=!0);var w;k=k.legendURL;if(d.customParameters||d.customLayerParameters){var q=C.clone(d.customParameters||{});C.mixin(q,d.customLayerParameters||{});for(w in q)k+=(-1===k.indexOf("?")?"?":"\x26")+w+"\x3d"+
q[w]}g.create("div",{innerHTML:"\x3cimg src\x3d'"+k+"'/\x3e"},this.domNode);a=!0}},this)}}else"esri.layers.WFSLayer"!==d.declaredClass||d.renderer?c.push(d):(f=g.create("div",{id:this.id+"_"+d.id,"class":"esriLegendService"}),g.create("span",{innerHTML:this._getServiceTitle(d),"class":"esriLegendServiceLabel"},g.create("td",{align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%"},f))))),g.place(f,this.id,"first"),f=g.create("table",{cellpadding:0,cellspacing:0,width:"95%",
"class":"esriLegendLayer"},f),f=g.create("tbody",{},f),"esriGeometryComplex"===d.geometryType?(this._buildRow_Renderer(d,d._pointSymbol,null,this.NLS_points,null,f),this._buildRow_Renderer(d,d._lineSymbol,null,this.NLS_lines,null,f),this._buildRow_Renderer(d,d._polygonSymbol,null,this.NLS_areas,null,f)):"esriGeometryPoint"===d.geometryType?this._buildRow_Renderer(d,d._pointSymbol,null,"",null,f):"esriGeometryPolyline"===d.geometryType?this._buildRow_Renderer(d,d._lineSymbol,null,"",null,f):"esriGeometryPolygon"===
d.geometryType&&this._buildRow_Renderer(d,d._polygonSymbol,null,"",null,f),b=!0)},this);var e=[];p.forEach(c,function(d){if(!d.loaded)var f=y.connect(d,"onLoad",this,function(k){y.disconnect(f);f=null;this.refresh()});else if((!this._respectVisibility||this._respectVisibility&&d.visible)&&(d.layerInfos||d.renderer||"esri.layers.ArcGISImageServiceLayer"===d.declaredClass||"esri.layers.RasterXLayer"===d.declaredClass)){var h=g.create("div",{id:this.id+"_"+d.id,style:{display:"none"},"class":"esriLegendService"});
g.create("span",{innerHTML:this._getServiceTitle(d),"class":"esriLegendServiceLabel"},g.create("td",{align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%"},h)))));g.place(h,this.id,"first");d.legendResponse||d.renderer&&"esri.renderer.StretchRenderer"!==d.renderer.declaredClass||d.renderer&&"esri.renderer.StretchRenderer"===d.renderer.declaredClass&&1===d.bandCount?this._createLegendForLayer(d):this.isHostedTileService(d)?this._getLayerInfos(d).then(C.hitch(this,function(k){this._createLegendForLayer(k)}),
C.hitch(this,function(k){e.push(this._legendRequest(k))})):"esri.layers.RasterXLayer"===d.declaredClass&&-1<d.capabilities.toLowerCase().indexOf("tilesonly")?this._createLegendForTileOnlyService(d):e.push(this._legendRequest(d))}},this);0!==e.length||a||b?(new U(e)).addCallback(C.hitch(this,function(d){a||b?H.byId(this.id+"_msg").innerHTML="":H.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()})):(H.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate())},_createLegendForTileOnlyService:function(a){function b(q,
B){var m=["red","green","blue"],L=[[255,0,0],[0,255,0],[0,0,255]];(B&&B.length>=f?c(B):c()).forEach(function(R,E){var D=new ya(ya.STYLE_SQUARE,20,new Aa(Aa.STYLE_SOLID,new u([0,0,0]),1),new u(L[E]));q._buildRow_Renderer(a,D,null,m[E]+": "+R,null,d)},q)}function c(q){var B=(a.bandIds&&a.bandIds.length?a.bandIds:[0,1,2]).map(function(m){return q&&q[m]&&q[m].BandName||"Band_"+(m+1)});3>B.length?B.push(B[1]):3<B.length&&B.splice(3);return B}var e=g.create("div",{id:this.id+"_"+a.id+"_clientLegend","class":"esriLegendServiceLabel"},
H.byId(this.id+"_"+a.id));g.create("td",{align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%","class":"esriLegendLayerLabel"},e))));e=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);var d=g.create("tbody",{},e),f=a.bandCount;if(1<f&&(!a.bandIds||0===a.bandIds.length||1<a.bandIds.length))a.getKeyProperties().then(C.hitch(this,function(q){b(this,q.BandProperties)}),C.hitch(this,function(q){b(this)}));else{e={colorRamp:{type:"algorithmic",
fromColor:[0,0,0],toColor:[255,255,255]}};var h=a.renderer;if(h&&h.statistics&&h.statistics.length){var k=null!=h.statistics[0].min?h.statistics[0].min:h.statistics[0][0];var w=null!=h.statistics[0].max?h.statistics[0].max:h.statistics[0][1]}else k=a.serviceInfo.minValues.length?a.serviceInfo.minValues[0]:0,w=a.serviceInfo.maxValues.length?a.serviceInfo.maxValues[0]:255;this._createStretchLegend(d,h||e,k,w)}J.set(H.byId(this.id+"_"+a.id),"display","block");J.set(H.byId(this.id+"_msg"),"display","none")},
_createLegendForLayer:function(a){if(a.legendResponse||a.renderer||this.isHostedTileService(a)){var b=!1;if(a.legendResponse||this.isHostedTileService(a)){var c=a.dynamicLayerInfos||a.layerInfos;if(c&&c.length)p.forEach(c,function(e,d){this.hideLayersInLegend[a.id]&&-1!==p.indexOf(this.hideLayersInLegend[a.id],e.id)||(e=this._buildLegendItems(a,e,d),b=b||e)},this);else if("esri.layers.ArcGISImageServiceLayer"===a.declaredClass||"esri.layers.RasterXLayer"===a.declaredClass)b=this._buildLegendItems(a,
{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0)}else a.renderer&&(c=a.url?a.url.substring(a.url.lastIndexOf("/")+1,a.url.length):"fc_"+a.id,b=this._buildLegendItems(a,{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));b&&(J.set(H.byId(this.id+"_"+a.id),"display","block"),J.set(H.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);y.connect(a,"onLoad",C.hitch(this,"_legendRequest"))},
_legendRequestServer:function(a){var b=a.url,c=b.indexOf("?");b=-1<c?b.substring(0,c)+"/legend"+b.substring(c):b+"/legend";(c=a._getToken())&&(b+="?token\x3d"+c);var e=C.hitch(this,"_processLegendResponse"),d={f:"json"};a._params.dynamicLayers&&(d.dynamicLayers=Z.stringify(this._createDynamicLayers(a)),"[{}]"===d.dynamicLayers&&(d.dynamicLayers="[]"));a._params.bandIds&&(d.bandIds=a._params.bandIds);a._params.renderingRule?d.renderingRule=a._params.renderingRule:a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&
p.forEach(a.rasterFunctionInfos,function(f){f&&f.name&&"none"===f.name.toLowerCase()&&(d.renderingRule=Z.stringify({rasterFunction:f.name}))});(c=a._params.mosaicRule&&JSON.parse(a._params.mosaicRule))&&c.multidimensionalDefinition&&c.multidimensionalDefinition.length&&(d.variable=c.multidimensionalDefinition[0].variableName);return X({url:b,content:d,callbackParamName:"callback",load:function(f,h){e(a,f,h)},error:Q.defaults.io.errorHandler})},_legendRequestTools:function(a){var b=a.url.toLowerCase().indexOf("/rest/");
b=a.url.substring(0,b)+a.url.substring(b+5,a.url.length);b=this._legendUrl+"?soapUrl\x3d"+window.escape(b);if(!x("ie")||8<x("ie"))b+="\x26returnbytes\x3dtrue";var c=C.hitch(this,"_processLegendResponse");return X({url:b,content:{f:"json"},callbackParamName:"callback",load:function(e,d){c(a,e,d)},error:Q.defaults.io.errorHandler})},_processLegendResponse:function(a,b){b&&b.layers?(a.legendResponse=b,H.byId(this.id+"_"+a.id)&&g.empty(H.byId(this.id+"_"+a.id)),g.create("span",{innerHTML:this._getServiceTitle(a),
"class":"esriLegendServiceLabel"},g.create("td",{align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%"},H.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+z.toJson(b))},_buildLegendItems:function(a,b,c){var e=!1,d=H.byId(this.id+"_"+a.id),f=b.parentLayerId;if(b.subLayerIds)a=g.create("div",{id:this.id+"_"+a.id+"_"+b.id+"_group",style:{display:"none"},"class":-1==f?0<c?"esriLegendGroupLayer":"":this._legendAlign},
-1==f?d:H.byId(this.id+"_"+a.id+"_"+f+"_group")),g.create("td",{innerHTML:K.encode(b.name),align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(this._respectVisibility&&a.visibleLayers)if(c=a.dynamicLayerInfos||a.layerInfos)if(a._params&&a._params.layers){if(-1===p.indexOf(a.visibleLayers,b.id))return e}else{if(c=this._getReallyVisibleLayers(c,a.visibleLayers),-1===p.indexOf(c,b.id))return e}else if(-1===p.indexOf(a.visibleLayers,
b.id))return e;d=g.create("div",{id:this.id+"_"+a.id+"_"+b.id,style:{display:"none"},"class":-1<f?this._legendAlign:""},-1==f?d:H.byId(this.id+"_"+a.id+"_"+f+"_group"));g.create("td",{innerHTML:K.encode(b.name)||"",align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%","class":"esriLegendLayerLabel"},d))));c=a.dynamicLayerInfos||a.layerInfos;f=!1;c&&c.length&&(f=p.some(c,function(h){return!!h.drawingInfo}));if(a.legendResponse)e=e||this._buildLegendItems_Tools(a,b,d);
else if(a.renderer||f)e=e||this._buildLegendItems_Renderer(a,b,d)}return e},_getReallyVisibleLayers:function(a,b){if(!a||!b||!b.length)return[];var c=[],e=[],d;for(d=0;d<a.length;d++)if(a[d].subLayerIds){if(-1===p.indexOf(b,a[d].id)||-1<p.indexOf(e,a[d].id))e=e.concat(a[d].subLayerIds)}else-1<p.indexOf(b,a[d].id)&&-1===p.indexOf(e,a[d].id)&&c.push(a[d].id);return c},_buildLegendItems_Tools:function(a,b,c){var e=b.parentLayerId,d=this.map.getScale(),f=!1,h=function(E,D){var Y,aa;for(Y=0;Y<E.length;Y++)if(D.dynamicLayerInfos)for(aa=
0;aa<D.dynamicLayerInfos[aa].length;aa++){if(D.dynamicLayerInfos[aa].mapLayerId==E[Y].layerId)return E[Y]}else if(D.id==E[Y].layerId)return E[Y];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,b,d)){var k=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass)){var w=this._getEffectiveScale(a,b);if(w.minScale&&w.minScale<d||w.maxScale&&w.maxScale>d)k=!1}if(k){h=
h(a.legendResponse.layers,b);var q=h.legendType,B=h.legend;d=h.legendGroups;if(B){"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&"esri.layers.RasterXLayer"===a.declaredClass||this._sanitizeLegendResponse(a,h,b);c=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);var m=g.create("tbody",{},c),L={};d&&0<d.length&&(c.setAttribute("cellspacing","10"),d.forEach(function(E){if(E.heading){var D=g.create("tr",{},m);D=g.create("td",{},D);g.create("div",{innerHTML:K.encode(E.heading)},
D)}D=g.create("tr",{},m);D=g.create("td",{},D);D=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},D);D=g.create("tbody",{},D);L[E.id]=D}));(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(c,a,b);var R=[];p.forEach(B,function(E){if(!(10.1<=a.version&&!E.values&&1<B.length)||!a._hideDefaultSymbol&&"\x3call other values\x3e"!==E.label){var D=E.label;if(E.url&&0===E.url.indexOf("http")||E.imageData&&0<E.imageData.length)f=!0,D&&-1!==p.indexOf(R,D)||(R.push(D),
this._buildRow_Tools(E,L[E.groupId]||m,a,b.id,q))}},this)}}}f&&(J.set(H.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<e&&(J.set(H.byId(this.id+"_"+a.id+"_"+e+"_group"),"display","block"),this._findParentGroup(a.id,a,e)));return f},_getLayerInfos:function(a){var b=new P,c=a.dynamicLayerInfos||a.layerInfos;if(c&&c.length)if(p.some(c,function(f){return!!f.drawingInfo}))b.resolve(a);else{var e=a.url,d=e.indexOf("?");e=-1===d?e+"/layers":e.substring(0,d)+"/layers"+e.substring(d,e.length);X({url:e,
content:{f:"json"},callbackParamName:"callback",load:function(f,h){f.layers?(p.forEach(c,function(k){var w=p.filter(f.layers,function(q){return k.source?q.id===k.source.mapLayerId:q.id===k.id});w&&w[0]&&w[0].drawingInfo&&(k.drawingInfo=w[0].drawingInfo,k.fields=w[0].fields)}),b.resolve(a)):b.reject(a)},error:function(f){b.reject(a)}})}return b},_sanitizeLegendResponse:function(a,b,c){var e=b.legend;if(10.1<=a.version&&1<e.length&&!b._sanitized){a=C.getObject("layerDefinition.drawingInfo.renderer",
!1,c);var d,f;a||(a=C.getObject("drawingInfo.renderer",!1,c));p.some(e,function(h){if(h.values)return!0})&&p.some(e,function(h,k){h.values||(f=k,d=h);return!!d});a?"uniqueValue"===a.type?d&&(e.splice(f,1),e.push(d)):"classBreaks"===a.type&&(d&&e.splice(f,1),e.reverse(),d&&e.push(d)):d&&(e.splice(f,1),e.push(d));b._sanitized=!0}},_buildRow_Tools:function(a,b,c,e,d){var f=g.create("tr",{},b);if(this.alignRight){b=g.create("td",{align:this._isRightToLeft?"left":"right"},f);var h=g.create("td",{align:this._isRightToLeft?
"left":"right",width:35},f)}else h=g.create("td",{width:35,align:"center"},f),b=g.create("td",{},f);f=a.url;(!x("ie")||9<=x("ie")||9>x("ie")&&("esri.layers.ArcGISImageServiceLayer"===c.declaredClass||"esri.layers.RasterXLayer"===c.declaredClass))&&a.imageData&&0<a.imageData.length?f="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(f=c.url+"/"+e+"/images/"+a.url,(e=c._getToken())&&(f+="?token\x3d"+e));e=g.create("img",{src:f,border:0,style:"opacity:"+c.opacity},h);a=g.create("td",{innerHTML:K.encode(a.label),
align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%",dir:"ltr"},b))));d&&"Stretched"===d&&10.3<=c.version&&("esri.layers.ArcGISImageServiceLayer"===c.declaredClass||"esri.layers.RasterXLayer"===c.declaredClass)&&(a.style.verticalAlign="top",a.style.lineHeight="1",e.style.marginBottom="-1px",e.style.display="block",b.style.verticalAlign="top");9>x("ie")&&(e.style.filter="alpha(opacity\x3d"+100*c.opacity+")")},_getVariable:function(a,b,c){if(a)var e=(a=a.getVisualVariablesForType(b,
c))&&a[0];return e},_getVariables:function(a,b,c){a=[this._getVariable(a,"colorInfo",!1),this._getVariable(a,"opacityInfo",!1),this._getVariable(a,"sizeInfo",!1)];return b?p.filter(a,function(e){return!(!e||e.field!==b||e.normalizationField!=c)}):a},_getFieldAlias:function(a,b,c){var e=b.infoTemplate||(b.infoTemplates&&c&&b.infoTemplates[c.id]?b.infoTemplates[c.id].infoTemplate:null);e=e&&e.getFieldInfo&&e.getFieldInfo(a);a=C.isFunction(a)?null:this.getField(b,a,c);b=e||a;c="";b&&(c=e&&e.label||a&&
a.alias||b.name||b.fieldName);return c},_getDomainName:function(a,b,c,e){if(a&&!C.isFunction(a))var d=(c=(a=this.getField(c,a,e))&&c.getDomain?c.getDomain(a.name):null)&&c.codedValues?c.getName(b):null;return d},_getRampTitle:function(a,b,c){var e=a.field,d=a.normalizationField,f=!1,h=!1,k=!1;e=C.isFunction(e)?null:e;d=C.isFunction(d)?null:d;if(a.legendOptions&&a.legendOptions.title)var w=a.legendOptions.title;else if(a.valueExpressionTitle)w=a.valueExpressionTitle;else{if(b.renderer&&b.renderer.authoringInfo&&
b.renderer.authoringInfo.visualVariables){var q=b.renderer.authoringInfo.visualVariables;for(a=0;a<q.length;a++){var B=q[a];if("colorInfo"===B.type&&"ratio"===B.style){f=!0;break}else if("colorInfo"===B.type&&"percent"===B.style){h=!0;break}else if("colorInfo"===B.type&&"percentTotal"===B.style){k=!0;break}}}(f=k&&"showRatioPercentTotal"||h&&"showRatioPercent"||f&&"showRatio"||d&&"showNormField"||e&&"showField"||null)&&(w=V.substitute({field:e&&this._getFieldAlias(e,b,c),normField:d&&this._getFieldAlias(d,
b,c)},"showField"===f?"${field}":this._i18n[f]))}return w},_getRendererTitle:function(a,b,c){if(a){if("esri.renderer.ClassBreaksRenderer"===a.declaredClass){var e=a.attributeField;var d=a.normalizationField;var f="percent-of-total"===a.normalizationType}e=C.isFunction(e)?null:e;d=C.isFunction(d)?null:d;if(a.legendOptions&&a.legendOptions.title)var h=a.legendOptions.title;else a.valueExpressionTitle?h=a.valueExpressionTitle:(a=d&&"showNormField"||(f?"showNormPct":null)||e&&"showField"||null)&&(h=V.substitute({field:e&&
this._getFieldAlias(e,b,c),normField:d&&this._getFieldAlias(d,b,c)},"showField"===a?"${field}":this._i18n[a]))}return h},_buildLegendItems_Renderer:function(a,b,c){function e(){J.set(H.byId(qa.id+"_"+a.id+"_"+b.id),"display","block");-1<d&&(J.set(H.byId(qa.id+"_"+a.id+"_"+d+"_group"),"display","block"),this._findParentGroup(a.id,d))}var d=b.parentLayerId,f=this.map,h=f.getScale(),k=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,b,h)){var w,q,B;var m="esri.layers.ArcGISImageServiceVectorLayer"===
a.declaredClass?a.renderer.renderer:b&&b.drawingInfo?Ia.fromJson(C.clone(b.drawingInfo.renderer)):a.isFeatureReductionActive&&a.isFeatureReductionActive()?a.getFeatureReductionRenderer():a.renderer;if("esri.renderer.ScaleDependentRenderer"===m.declaredClass&&(m=(f="zoom"===m.rangeType?m.getRendererInfoByZoom(f.getZoom()):m.getRendererInfoByScale(h))&&f.renderer,!m))return!1;f=m&&m.authoringInfo&&"relationship"===m.authoringInfo.type;if("esri.renderer.StretchRenderer"!==m.declaredClass&&"esri.renderer.ShadedReliefRenderer"!==
m.declaredClass){h=this._getVariables(m);var L=p.filter(h,function(S){return!!S}).length,R=h[0],E=h[1],D=h[2],Y,aa=!1;if(R){var da=this._getMedianColor(m,R);R.field&&(w=C.isFunction(R.field)?null:this.getField(a,R.field,b));var ia=!(R.legendOptions&&!1===R.legendOptions.showLegend)}if(E){E.field&&(B=C.isFunction(E.field)?null:this.getField(a,E.field,b));var ja=!(E.legendOptions&&!1===E.legendOptions.showLegend)}D&&(D.field&&(q=C.isFunction(D.field)?null:this.getField(a,D.field,b)),aa=(Y=!(D.legendOptions&&
!1===D.legendOptions.showLegend))&&Ma.test(D.valueExpression))}if("esri.renderer.HeatmapRenderer"===m.declaredClass){var ca=k=!0;this._showHeatRamp(a,b,m,c)}else if("esri.renderer.DotDensityRenderer"===m.declaredClass)ca=k=!0,this._showDotDensityLegend(a,b,m,c);else if("esri.renderer.TemporalRenderer"===m.declaredClass){ca=k=!0;h=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);var W=g.create("tbody",{},h);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(h,
a,b);m.latestObservationRenderer&&"esri.renderer.SimpleRenderer"===m.latestObservationRenderer.declaredClass&&this._buildRow_Renderer(a,m.latestObservationRenderer.symbol,da,K.encode(m.latestObservationRenderer.label)||this.NLS_currentObservations,null,W);m.observationRenderer&&"esri.renderer.SimpleRenderer"===m.observationRenderer.declaredClass&&this._buildRow_Renderer(a,m.observationRenderer.symbol,da,K.encode(m.observationRenderer.label)||this.NLS_previousObservations,null,W)}else if("esri.renderer.UniqueValueRenderer"===
m.declaredClass){if(m.infos&&0<m.infos.length){ca=k=!0;if(m.legendOptions&&m.legendOptions.title||m.valueExpressionTitle)h=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),W=g.create("tbody",{},h),L=m.legendOptions&&m.legendOptions.title?m.legendOptions.title:m.valueExpressionTitle,this._buildRow_Renderer(a,null,da,K.encode(L),null,W);h=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);W=g.create("tbody",{},h);(a._hoverLabel||
a._hoverLabels)&&this._createHoverAction(h,a,b);m.attributeField&&D&&this._addSubHeader(W,this._getFieldAlias(m.attributeField,a,b));if(f){var ea=m.authoringInfo;var oa=ea.focus;L=ea.numClasses;var sa=ea.field1.field;h=ea.field2.field;if(L&&sa&&h){var ka=ea.field1.normalizationField;ea=ea.field2.normalizationField;var Na=ka&&this._i18n.showNormField||sa&&"${field}",Oa=ea&&this._i18n.showNormField||h&&"${field}";sa=V.substitute({field:this._getFieldAlias(sa,a,b),normField:ka&&this._getFieldAlias(ka,
a,b)},Na);h=V.substitute({field:this._getFieldAlias(h,a,b),normField:ea&&this._getFieldAlias(ea,a,b)},Oa);ka={shapeDescriptor:La,rotation:this._getRotationAngleForFocus(oa)||0};this._buildRow_Renderer(a,null,null,K.encode(sa),null,W,null,ka);ka.rotation+=90;this._buildRow_Renderer(a,null,null,K.encode(h),null,W,null,ka);this._drawRelationshipLegend(c,{numClasses:L,focus:oa,uvInfos:m.infos})}}else{var Ea=[];p.forEach(m.infos,function(S){var fa=null;this._isLayerEditable(a)&&a.types&&(fa=this._getTemplateFromTypes(a.types,
S.value));var pa=S.label;null==pa&&(pa=this._getDomainName(m.attributeField,S.value,a,b)||S.value);-1===p.indexOf(Ea,pa)&&(Ea.push(pa),S=S.symbol,S=this._applyScaleDrivenSymbolSize(S,m,D,aa),this._buildRow_Renderer(a,S,da,K.encode(pa),fa,W))},this)}}oa=!f&&this._displayDefaultSymbol(a,m,c,D,aa)}else if("esri.renderer.ClassBreaksRenderer"===m.declaredClass){if(m.infos&&0<m.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass){ca=k=!0;var ta=this._isUnclassedRenderer(m);if(!R&&
1===m.infos.length)var ha=(ha=m.infos[0])&&ha.symbol;ta||(h=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),W=g.create("tbody",{},h),L=this._getRendererTitle(m,a,b),this._buildRow_Renderer(a,null,da,K.encode(L),null,W));h=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);W=g.create("tbody",{},h);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(h,a,b);ta&&D&&Y&&!aa||(f=m.infos.slice(0).reverse(),p.forEach(f,function(S){var fa=
S.label;null!=fa||ta||(fa=S.minValue+" - "+S.maxValue);S=S.symbol;S=this._applyScaleDrivenSymbolSize(S,m,D,aa);this._buildRow_Renderer(a,S,da,K.encode(fa),null,W)},this));"esri.layers.ArcGISImageServiceVectorLayer"!==a.declaredClass||a.renderer.style!==ma.STYLE_SCALAR&&a.renderer.style!==ma.STYLE_SINGLE_ARROW||(this._buildRow_Renderer(a,m.defaultSymbol,null,"",null,W),a._hideDefaultSymbol=!0)}ta||(oa=this._displayDefaultSymbol(a,m,c,D,aa))}else if("esri.renderer.StretchRenderer"===m.declaredClass){ca=
k=!0;h=g.create("table",{cellpadding:0,cellspacing:0,width:"95%",class:"esriLegendLayer"},c);W=g.create("tbody",{},h);var qa=this,ua,va,Fa=function(){m.statistics.length?(ua=m.statistics[0][1],va=m.statistics[0][0]):(va=wa?wa.minValues[0]:a.minValues[0],ua=wa?wa.maxValues[0]:a.maxValues[0]);"esri.layers.RasterXLayer"===a.declaredClass&&a.hasStdTime()&&(va=a.getStdTimeValue(va),ua=a.getStdTimeValue(ua));qa._createStretchLegend(W,m,va,ua)};if(a.renderingRule)a.getRenderingRuleServiceInfo(a.renderingRule).then(function(S){var fa=
S&&S.minValues&&0<S.minValues.length&&S.maxValues&&0<S.maxValues.length;S&&1<S.bandCount||!fa?qa._legendRequest(a).then(function(pa){qa._processLegendResponse(a,pa)}):Fa()});else{var wa=a.serviceInfo;if("esri.layers.RasterXLayer"===a.declaredClass&&(wa=a.raster.serviceInfo,a.hasMultidimensions&&(!m.statistics||!m.statistics.length)))return c=a.mosaicRule&&a.mosaicRule.multidimensionalDefinition,a.getStatistics(c&&c.length?c[0].variableName:a._defaultMultidimensionalDefinition[0].variableName).then(C.hitch(this,
function(S){this._createStretchLegend(W,m,S[0][0],S[0][1]);e()})),k;Fa()}}else"esri.renderer.ShadedReliefRenderer"===m.declaredClass?(ca=k=!0,h=g.create("table",{cellpadding:0,cellspacing:0,width:"95%",class:"esriLegendLayer"},c),W=g.create("tbody",{},h),this._createStretchLegend(W,m,0,255)):"esri.renderer.SimpleRenderer"===m.declaredClass?(ca=k=!0,h=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),W=g.create("tbody",{},h),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(h,
a,b),ha=null,this._isLayerEditable(a)&&a.templates&&0<a.templates.length&&(ha=a.templates[0]),f=1<L?null:w&&ia||B&&ja||q&&Y,this._buildRow_Renderer(a,m.symbol,da,K.encode(f?this._getRampTitle(1<L?null:R||E||D,a,b):m.label),ha,W),ha=R?null:m.symbol,f&&(w=B=q=null)):"esri.renderer.ColormapRenderer"===m.declaredClass&&(m.colormapInfos&&m.colormapInfos.length&&(ca=k=!0),h=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),W=g.create("tbody",{},h),m.colormapInfos.forEach(function(S){var fa=
new Ba(Ba.STYLE_SOLID,null,new u(S.color));this._buildRow_Renderer(a,fa,null,S.label,null,W)},this),a._hideDefaultSymbol=!0);ca&&(R&&ia&&(R.field||R.valueExpression)&&this._showGradientRamp(a,b,m,null,c,R,w,null,D&&Y?!0:!1),D&&Y&&(D.field||D.valueExpression&&!aa)&&(ca=R&&ia||"esri.renderer.UniqueValueRenderer"===m.declaredClass?!1:!0,this._showSizeLegend(a,b,m,D,da,c,q,null,ca)),E&&ja&&(E.field||E.valueExpression)&&this._showGradientRamp(a,b,m,ha&&!ha.url&&ha.color?ha.color:this.transparencyRampColor,
c,E,B,null,!1));oa||ta&&!ia&&!Y&&!ja||(oa=this._displayDefaultSymbol(a,m,c,D,aa));k=k||oa}qa=this;k&&e();return k},_createStretchLegend:function(a,b,c,e){var d=g.create("tr",{},a);var f=g.create("td",{rowspan:2,"class":"esriStretchLegend"},d);b=g.toDom(this._addColorRamp(b.colorRamp));g.place(b,f);g.create("td",{},d).innerHTML=this._i18n.high+": "+("string"===typeof e?e:Math.round(e*Math.pow(10,3))/Math.pow(10,3));a=g.create("tr",{},a);g.create("td",{},a).innerHTML=this._i18n.low+": "+("string"===
typeof c?c:Math.round(c*Math.pow(10,3))/Math.pow(10,3))},_addColorRamp:function(a){a||(a={algorithm:"hsv",fromColor:[0,0,0,1],toColor:[255,255,255,1]});var b=this._generateColorRampDivs(a);a.label="\x3cdiv class\x3d'esriStretchLegendGradientLabel'\x3e"+b+"\x3c/div\x3e";return a.label},_generateColorRampDivs:function(a){if(a){var b="";if("multipart"===a.type){var c=100/a.colorRamps.length;var e=a.colorRamps;Object.keys(e).reverse().forEach(function(d){b+=this._generateSingleGradientDiv(e[d].fromColor,
e[d].toColor,c)},this)}else b=this._generateSingleGradientDiv(a.fromColor,a.toColor,100);return b}},_generateSingleGradientDiv:function(a,b,c){if(a&&b){var e="";a=a.toRgb?a.toRgb():a;b=b.toRgb?b.toRgb():b;var d="(0deg, rgb("+a.slice(0,3).join()+"), rgb("+b.slice(0,3).join()+"));";p.forEach(["-webkit-linear-gradient","-o-linear-gradient","-moz-linear-gradient","linear-gradient"],function(f){e+="background: "+f+d});return"\x3cdiv class\x3d'esriStretchLegendSingleGradient' style\x3d'height:"+c+"%;"+
e+"'\x3e\x3c/div\x3e"}},_isLayerEditable:function(a){return"function"===typeof a.isEditable&&a.isEditable()},_isUnclassedRenderer:function(a,b){var c=a.infos;c=c?c.length:0;if("esri.renderer.ClassBreaksRenderer"===a.declaredClass&&1===c){c=a.attributeField;var e=a.normalizationField;a=b?c===b:!!this._getVariables(a,c,e).length}else a=a.authoringInfo&&a.authoringInfo.type,a=2===c&&"univariateColorSize"===a;return a},_displayDefaultSymbol:function(a,b,c,e,d){var f=b.defaultSymbol;if(!a._hideDefaultSymbol&&
f){var h=!0;c=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);c=g.create("tbody",{},c);f=this._applyScaleDrivenSymbolSize(f,b,e,d);this._buildRow_Renderer(a,f,null,K.encode(b.defaultLabel)||"others",null,c)}return h},_applyScaleDrivenSymbolSize:function(a,b,c,e){e&&(a=ra.fromJson(a.toJson()),this._applySize(a,b,c,null));return a},_showGradientRamp:function(a,b,c,e,d,f,h,k,w){w=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+
(w?"":" esriLegendSubFragment")},d);d=g.create("tbody",{},w);(a._hoverLabel||a._hoverLabels||k)&&this._createHoverAction(w,a,b,k);(h||f.valueExpression||f.legendOptions&&f.legendOptions.title)&&this._addSubHeader(d,this._getRampTitle(f,a,b));h=f.field;var q;h&&(q=C.isFunction(h)?null:this.getField(a,h,b));if(f=(b=this._getRampStops(c,f,e,q&&"esriFieldTypeDate"===q.type))?b.length:0)f=10<f,this._drawGradientRamp(d,b,!f,a,this._getRampBorderColor(c),!!e,f)},_getMedianColor:function(a,b){if(b.colors){var c=
b.minDataValue;var e=b.maxDataValue}else b.stops&&(c=b.stops[0].value,e=b.stops[b.stops.length-1].value);return a.getColor(c+(e-c)/2,{colorInfo:b})},_getRampStops:function(a,b,c,e){var d,f,h=!1;if(b.colors||b.opacityValues){var k=b.maxDataValue-b.minDataValue;var w=p.map([0,.25,.5,.75,1],function(L){d=b.minDataValue+L*k;return Number(d.toFixed(6))});this._checkPrecision(0,4,w)}else b.stops&&(w=p.map(b.stops,function(L){return L.value}),e||p.some(w,function(L){return 2<l.getDigits(L).fractional})&&
(w=l.round(w)),(h=p.some(b.stops,function(L){return!!L.label}))&&(f=p.map(b.stops,function(L){return L.label})));var q=w[0],B,m;k=w[w.length-1]-q;return p.map(w,function(L,R){c?(B=new u(c.toRgba()),m=a.getOpacity(L,{opacityInfo:b}),null!=m&&(B.a=m)):B=a.getColor(L,{colorInfo:b});var E="";if(h)E=f[R];else{E=e?v.formatDate(L,v.timelineDateFormatOptions):l.format(L);var D="";0===R?D=this._specialChars.lt+" ":R===w.length-1&&(D=this._specialChars.gt+" ");E=D+E}return{value:L,color:B,offset:1-(L-q)/k,
label:E}},this).reverse()},_checkPrecision:function(a,b,c){var e=a+(b-a)/2,d=c[a],f=c[e],h=c[b],k=Math.floor(d),w=Math.floor(f),q=Math.floor(h);k===d&&q===h&&w!==f&&k!==w&&q!==w&&(c[e]=w);a+1!==e&&this._checkPrecision(a,e,c);e+1!==b&&this._checkPrecision(e,b,c)},_getRampBorderColor:function(a){if("esri.renderer.SimpleRenderer"===a.declaredClass)var b=a.symbol;else if("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)b=a.infos[0].symbol;return(a=
b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&a.color},_drawGradientRamp:function(a,b,c,e,d,f,h){var k=g.create("tr",{},a),w=b.length-1,q;var B=0;if(this.alignRight){a=g.create("td",{align:this._isRightToLeft?"left":"right"},k);var m=g.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},k)}else m=g.create("td",{width:this.gradientWidth,align:"center"},k),a=g.create("td",{},k);k=d&&0<d.a&&!(240<=d.r&&240<=d.g&&240<=d.b);var L=g.create("div",{"class":k?"":"esriLegendBorderLessColorRamp",
style:"position: relative; width:"+this.gradientWidth+"px;"},m);m=g.create("div",{"class":"esriLegendColorRamp"+(f?" esriLegendTransparencyRamp":"")},L);f=J.get(m,"width");k&&(d=9>x("ie")?d.toHex():"rgba("+d.toRgba().join(",")+")",J.set(m,"border",this.colorRampBorder+" "+d));c?(d=this.gradientHeight*w,J.set(m,"height",d+"px")):d=J.get(m,"height");J.set(L,"height",d+"px");k=F.createSurface(m,f,d);9>x("ie")&&(B=k.getEventSource(),J.set(B,"position","relative"),J.set(B.parentNode,"position","relative"),
B=1);try{c&&p.forEach(b,function(D,Y){D.offset=Y/w});var R=k.createRect({x:-B,y:-B,width:f+B,height:d+B});R.setFill({type:"linear",x1:0,y1:0,x2:0,y2:d,colors:b}).setStroke(null);k.createRect({width:f,height:d}).setFill(new u([255,255,255,1-e.opacity])).setStroke(null);this._surfaceItems.push(k)}catch(D){k.clear(),k.destroy()}p.forEach(b,function(D,Y){D.label&&(q="top:"+100*D.offset+"%;",D="",0===Y&&(D+=" esriLegendColorRampTickFirst"),Y===b.length-1&&(D+=" esriLegendColorRampTickLast"),g.create("div",
{"class":"esriLegendColorRampTick"+D,innerHTML:"\x26nbsp;",style:q},L))});var E=g.create("div",{"class":"esriLegendColorRampLabels",style:{height:d+this.gradientHeight+"px"}},a);c?p.forEach(b,function(D){g.create("div",{"class":"esriLegendColorRampLabel",innerHTML:K.encode(D.label)||"\x26nbsp;"},E)}):(g.create("div",{"class":"esriLegendColorRampLabel",innerHTML:h?K.encode(b[0].label)||"\x26nbsp;":this._i18n.high},E),g.create("div",{"class":"esriLegendColorRampLabel",innerHTML:h?K.encode(b[b.length-
1].label)||"\x26nbsp;":this._i18n.low,style:"top: "+(d+this.gradientHeight-2*this.gradientHeight)+"px;"},E))},_showHeatRamp:function(a,b,c,e,d){var f=c.field;var h=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);e=g.create("tbody",{},h);(a._hoverLabel||a._hoverLabels||d)&&this._createHoverAction(h,a,b,d);(f=f&&this.getField(a,f,b))&&this._addSubHeader(e,this._getFieldAlias(f.name,a,b));b=this._getHeatmapStops(c);b.length&&this._drawGradientRamp(e,b,!1,a)},_getHeatmapStops:function(a){var b=
a.colorStops;a=a.colors;if(b&&b[0]){var c=b.length-1;if(a=b[0]&&null!=b[0].ratio)(a=b[c])&&1!==a.ratio&&(b=b.slice(0),b.push({ratio:1,color:a.color}),c++);else{var e=b[0].value;var d=b[c].value-e;b=p.map(b,function(h){return{color:h.color,ratio:(h.value-e)/d}})}}else if(a&&a[0]){c=a.length-1;var f=1/(a.length-1);b=p.map(a,function(h,k){return{color:h,ratio:k*f}})}b=p.map(b,function(h,k){var w="";0===k?w="Low":k===c&&(w="High");return{color:h.color,label:w,offset:1-h.ratio}});return b.reverse()},_showDotDensityLegend:function(a,
b,c,e){var d=c.legendOptions,f,h=this.dotDensitySwatchSize,k=Math.round(h/2);if(d){var w=d.backgroundColor;var q=d.outline;var B=d.valueUnit;var m=d.dotCoverage}m=(m||this.dotCoverage)/100;var L=Math.round(h*h/Math.pow(c.dotSize,2)*m);e=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);var R=g.create("tbody",{},e);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(e,a,b);this._addSubHeader(R,V.substitute({value:c.dotValue,unit:B||""},this.NLS_dotValue));
p.forEach(c.fields,function(E){E=C.mixin({},E);E.numPoints=L;f=new Ga(c._generateImageSrc(h,h,[E],{x:0,y:0},{x:h,y:h},w),q||c.outline,h,h);E=this.getField(a,E.name,b)||E;this._buildRow_Renderer(a,f,null,K.encode(this._getFieldAlias(E.name,a,b)),null,R,{type:"path",path:"M "+-k+","+-k+" L "+k+","+-k+" L "+k+","+k+" L "+-k+","+k+" L "+-k+","+-k+" E"})},this)},_showSizeLegend:function(a,b,c,e,d,f,h,k,w){var q=e.legendOptions;q=q&&q.customValues;d=this._getSizeSymbol(c,d);if((!e.valueUnit||"unknown"===
e.valueUnit)&&d&&(q||null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue||e.stops&&!(1>=e.stops.length))){w=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(w?"":" esriLegendSubFragment")},f);f=g.create("tbody",{},w);(a._hoverLabel||a._hoverLabels||k)&&this._createHoverAction(w,a,b,k);(h||e.valueExpression||e.legendOptions&&e.legendOptions.title)&&this._addSubHeader(f,this._getRampTitle(e,a,b));h=(w=(k=e.field)&&!C.isFunction(k))&&"cluster_count"===
k.toLowerCase();b=(b=w?a.isFeatureReductionActive&&a.isFeatureReductionActive()?a.getFeatureReductionField(k):this.getField(a,k,b):null)&&"esriFieldTypeDate"===b.type;q=q||this._getDataValues(c,d,e,b,h);var B=q.length-1;for(k=B;0<=k;k--){w=q[k];d=ra.fromJson(d.toJson());this._applySize(d,c,e,w);w=b?v.formatDate(w,v.timelineDateFormatOptions):l.format(w);var m="";k===B?m=this._specialChars.gt+" ":0===k&&(m=h&&1===q[k]?"":this._specialChars.lt+" ");m="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+
K.encode(m+w)+"\x3c/span\x3e";this._buildRow_Renderer(a,d,null,m,null,f)}}},_getSizeSymbol:function(a,b){if("esri.renderer.SimpleRenderer"===a.declaredClass)var c=a.symbol;else if("esri.renderer.VectorFieldRenderer"===a.declaredClass)c=a.defaultSymbol;else if("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass){c=a.infos[0].symbol;var e=1<a.infos.length}if(c=c&&-1!==c.type.indexOf("fillsymbol")?null:c)if(c=ra.fromJson(c.toJson()),b||e)-1!==
c.type.indexOf("linesymbol")?c.setColor(new u(this.sizeRampDarkColor)):(c.setColor(new u(this.sizeRampLightColor)),c.setOutline&&(a=new Aa,a.setColor(new u(this.sizeRampDarkColor)),a.setWidth(1.5),c.setOutline(a)));return c},_getDataValues:function(a,b,c,e,d){if(d){var f;p.some([5,3,2],function(h){h=this._getDataValuesByCount(a,b,c,e,h);this._hasFractionalValues(h)||(f=h);return!!f},this);return f}return(d=a.authoringInfo)&&"univariateColorSize"===d.type&&"above-and-below"===d.univariateTheme&&c.stops?
this._getDataValuesFromStops(c,e):this._getDataValuesByCount(a,b,c,e,5)},_getDataValuesFromStops:function(a,b){a=p.map(a.stops,function(c){return c.value});return b?a:l.round(a)},_getDataValuesByCount:function(a,b,c,e,d,f){d=null==d?5:d;f=null==f?20:f;var h=a.getSizeRangeAtScale(c,this.map.getScale());d=this._interpolateSizeRange(h,d);var k=this._getDataRange(c),w=p.map(d,function(B){return this._getDataValueFromSize(B,k,h)},this);if(!e){var q;w=l.round(w);for(e=1;e<w.length-1;e++)if(q=this._roundDataValue(a,
b,c,w[e],w[e-1],f))w[e]=q[0],d[e]=q[1]}return w},_hasFractionalValues:function(a){return p.some(a,function(b){return b!==Math.floor(b)})},_getDataRange:function(a){var b=a.stops;return b?{min:b[0].value,max:b[b.length-1].value}:{min:a.minDataValue,max:a.maxDataValue}},_interpolateSizeRange:function(a,b){var c=a.minSize;a=(a.maxSize-c)/(b-1);var e,d=[];for(e=0;e<b;e++)d.push(c+a*e);return d},_getDataValueFromSize:function(a,b,c){var e=c.minSize;c=c.maxSize;var d=b.min;b=b.max;return a<=e?d:a>=c?b:
(a-e)/(c-e)*(b-d)+d},_roundDataValue:function(a,b,c,e,d,f){var h=this._getSize(b,a,c,e);d=this._getSize(b,a,c,d);var k=l.getDigits(e),w=k.integer;k=k.fractional;var q;if(0<e&&1>e){var B=Math.pow(10,k);e*=B;w=l.getDigits(e).integer}for(--w;0<=w;w--){var m=Math.pow(10,w);k=Math.floor(e/m)*m;m*=Math.ceil(e/m);null!=B&&(k/=B,m/=B);var L=(k+m)/2;L=l.round([k,L,m],{indexes:[1]})[1];var R=this._getSize(b,a,c,k);var E=this._getSize(b,a,c,m);var D=this._getSize(b,a,c,L);var Y=l.getPctChange(h,R,d,null);var aa=
l.getPctChange(h,E,d,null);var da=l.getPctChange(h,D,d,null);var ia=Y.prev<=f;var ja=aa.prev<=f;ia&&ja&&(Y.prev<=aa.prev?(ia=!0,ja=!1):(ja=!0,ia=!1));ia?q=[k,R]:ja?q=[m,E]:da.prev<=f&&(q=[L,D]);if(q)break}return q},_applySize:function(a,b,c,e){var d=a.type;b=this._getSize(a,b,c,e);switch(d){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":d=a.width;c=a.height;a.setHeight(b);a.setWidth(d/c*b);break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);break;case "textsymbol":a.font&&
a.font.setSize(b)}},_getSize:function(a,b,c,e){return b.getSize(e,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,b,c,e,d,f,h,k){var w=!!k,q=g.create("tr",{},f);if(this.alignRight){if(f=g.create("td",{align:this._isRightToLeft?"left":"right"},q),b||w)var B=g.create("td",{align:this._isRightToLeft?"left":"right",width:35},q)}else{if(b||w)B=g.create("td",{width:35,align:"center"},q);f=g.create("td",{},q)}var m=q=30;if(b)if("simplemarkersymbol"===
b.type)q=Math.min(Math.max(q,b.size+12),125),m=Math.min(Math.max(m,b.size+12),125);else if("picturemarkersymbol"===b.type)q=Math.min(Math.max(q,b.width),125),m=Math.min(b.height||m,125);else if("textsymbol"===b.type){if(!b.text){var L=b.text;var R=!0;b.setText(this.defaultText)}q=Math.min(Math.max(q,b.getWidth()+12),125);m=Math.min(Math.max(m,b.getHeight()+12),125);R&&b.setText(L)}if(b||w)var E=g.create("div",{style:"width:"+q+"px;height:"+m+"px;"},B);V.isDefined(e)&&"number"===typeof e&&(e=""+e);
g.create("td",{innerHTML:e||"",align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%"},f))));if(b||w)a=this._drawSymbol(E,b,c,q,m,d,a,h,k),this._surfaceItems.push(a)},_addSubHeader:function(a,b){a=g.create("tr",{},a);a=g.create("td",{align:this._align,colspan:2},a);g.create("td",{innerHTML:K.encode(b)||"",align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%"},a))))},_drawSymbol:function(a,b,c,e,d,f,h,k,w){var q=b&&ra.fromJson(b.toJson()),
B=h.opacity;b=!!w;if(q)if(c&&q.setColor(new u(c.toRgba())),"simplelinesymbol"===q.type||"cartographiclinesymbol"===q.type||"textsymbol"===q.type){if(!q.color)return;c=q.color.toRgba();c[3]*=B;q.color.setColor(c)}else"simplemarkersymbol"===q.type||"simplefillsymbol"===q.type?(q.color&&(c=q.color.toRgba(),c[3]*=B,q.color.setColor(c)),q.outline&&q.outline.color&&(c=q.outline.color.toRgba(),c[3]*=B,q.outline.color.setColor(c))):"picturemarkersymbol"===q.type&&(a.style.opacity=B,a.style.filter="alpha(opacity\x3d("+
100*B+"))");a=F.createSurface(a,e,d);9>x("ie")&&(c=a.getEventSource(),J.set(c,"position","relative"),J.set(c.parentNode,"position","relative"));f=b?w.shapeDescriptor:this._getDrawingToolShape(q,f)||ra.getShapeDescriptors(q);B=(c=f.defaultShape)&&"text"===c.type;try{B&&!c.text&&(c.text=this.defaultText);var m=a.createShape(k||c).setFill(f.fill).setStroke(f.stroke);B&&m.setFont(f.font)}catch(E){a.clear();a.destroy();return}var L=m.getBoundingBox();k=L.width;f=L.height;B=-(L.x+k/2);var R=-(L.y+f/2);
c=a.getDimensions();B={dx:B+c.width/2,dy:R+c.height/2};if(q&&"simplemarkersymbol"===q.type&&"path"===q.style)e=h._getScaleMatrix(L,q.size),m.applyTransform(N.scaleAt(e.xx,e.yy,{x:c.width/2,y:c.height/2}));else if(k>e||f>d)h=k/e>f/d,e=((h?e:d)-5)/(h?k:f),C.mixin(B,{xx:e,yy:e});m.applyTransform(B);b&&m.applyTransform(N.rotategAt(w.rotation,k/2,f/2));return a},_getDrawingToolShape:function(a,b){switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":b={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};
break;case "esriFeatureEditToolTriangle":b={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};break;case "esriFeatureEditToolRectangle":b={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};break;case "esriFeatureEditToolCircle":b={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":b={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:b,fill:a.getFill(),stroke:a.getStroke()}},_drawRelationshipLegend:function(a,b){var c=b.focus,
e=b.numClasses,d=Ka[e],f=!!c,h=Math.sqrt(Math.pow(75,2)+Math.pow(75,2)),k={};b.uvInfos.forEach(function(m){k[m.value]={label:m.label,fill:this._getSymbolColor(m.symbol)}},this);b=[];for(var w=0;w<e;w++){for(var q=[],B=0;B<e;B++)q.push(k[d[w][B]].fill);b.push(q)}d=this._getRelationshipCornerLabels(c,k);a=this._drawRampLayout(a,d,h,f);a=F.createSurface(a,h,h);f||(a.rawNode.style.margin="-15px -15px -18px -15px");b=Ha.create2DColorRamp({surface:a,colors:b,numClasses:e,size:75});e=(h-75)/2;h=(h-75)/2;
b.applyTransform(N.translate(e,h));f&&b.applyTransform(N.rotategAt(this._getRotationAngleForFocus(c),37.5,37.5));b=a.createGroup();d={width:1,color:"#555555"};w=a.defNode;this._createArrowMarker(w,"start");this._createArrowMarker(w,"end");w=b.createLine({x1:-10,y1:60,x2:-10,y2:15}).setStroke(d);d=b.createLine({x1:15,y1:85,x2:60,y2:85}).setStroke(d);this._setLineArrow(w.rawNode,"left",c);this._setLineArrow(d.rawNode,"right",c);b.applyTransform(N.translate(e,h));f&&b.applyTransform(N.rotategAt(-45,
37.5,37.5));this._surfaceItems.push(a)},_drawRampLayout:function(a,b,c,e){var d=g.create("div",{style:{padding:"10px"}},a);a=c+"px";c+="px";e?(e=g.create("div",{style:{display:"flex"}},d),g.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a,textAlign:"right"},innerHTML:b.left},e),d=g.create("div",{style:{display:"flex",flexDirection:"column",textAlign:"center"}},e),g.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:b.right},
e),e=g.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:b.top},d),e=g.create("div",{style:{height:c,width:c}},d),d=g.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:b.bottom},d)):(d=g.create("div",{style:{display:"table",color:"#555555"}},d),e=g.create("div",{style:{display:"table-row"}},d),c=g.create("div",{style:{display:"table-row"}},d),d=g.create("div",{style:{display:"table-row"}},d),g.create("div",
{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"right",verticalAlign:"bottom"},innerHTML:b.left},e),g.create("div",{style:{display:"table-cell"}},e),g.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"left",verticalAlign:"bottom"},innerHTML:b.top},e),g.create("div",{style:{display:"table-cell"}},c),e=g.create("div",{style:{display:"table-cell"}},c),g.create("div",{style:{display:"table-cell"}},c),g.create("div",
{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"right",verticalAlign:"top"},innerHTML:b.bottom},d),g.create("div",{style:{display:"table-cell"}},d),g.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"left",verticalAlign:"top"},innerHTML:b.right},d));return e},_getSymbolColor:function(a){if(a)return"simplelinesymbol"===a.type||"simplemarkersymbol"===a.type&&(a.style===ya.STYLE_X||a.style===ya.STYLE_CROSS)?(a=a.getStroke())&&
a.color:a.getFill()},_getRotationAngleForFocus:function(a){var b=Da[a];a&&null==b&&(b=Da.HH);return b},_setLineArrow:function(a,b,c){var e=this.id+"_arrowStart",d=this.id+"_arrowEnd";b="left"===b;switch(c){case "HL":a.setAttribute(b?"marker-start":"marker-end","url(#"+(b?d:e)+")");break;case "LL":a.setAttribute("marker-start","url(#"+d+")");break;case "LH":a.setAttribute(b?"marker-end":"marker-start","url(#"+(b?e:d)+")");break;default:a.setAttribute("marker-end","url(#"+e+")")}},_createArrowMarker:function(a,
b){var c="start"===b,e=this.id+(c?"_arrowStart":"_arrowEnd");b=c?"0,0 5,5 0,10":"5,0 0,5 5,10";var d=c?5:0;c=document.createElementNS("http://www.w3.org/2000/svg","marker");c.setAttribute("id",e);c.setAttribute("markerWidth","10");c.setAttribute("markerHeight","10");c.setAttribute("refX",d);c.setAttribute("refY","5");c.setAttribute("markerUnits","strokeWidth");c.setAttribute("orient","auto");e=document.createElementNS("http://www.w3.org/2000/svg","polyline");e.setAttribute("points",b);e.setAttribute("fill",
"none");e.setAttribute("stroke","#555555");e.setAttribute("stroke-width","1");c.appendChild(e);a.appendChild(c)},_getRelationshipCornerLabels:function(a,b){var c=b.HH.label,e=b.LL.label,d=b.HL.label;b=b.LH.label;switch(a){case "HH":return{top:c,bottom:e,left:d,right:b};case "HL":return{top:d,bottom:b,left:e,right:c};case "LL":return{top:e,bottom:c,left:b,right:d};case "LH":return{top:b,bottom:d,left:c,right:e};default:return{top:c,bottom:e,left:d,right:b}}},_repaintItems:function(){p.forEach(this._surfaceItems,
function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(b){}a.children&&C.isArray(a.children)&&p.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,b,c,e){if(e=b._hoverLabel||b._hoverLabels&&b._hoverLabels[c.id]||e)e=K.encode(e),b.mouseMoveHandler=b.mouseMoveHandler||{},b.mouseMoveHandler[c.id]=y.connect(a,"onmousemove",C.hitch(this,function(d,f){this.mouseX=f.clientX;
this.mouseY=f.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,J.set(H.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(C.hitch(this,function(h,k,w){if(h==this.mouseX&&k==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,H.byId(this.id+"_hoverLabel")){var q=H.byId(this.id+"_hoverLabel");q.innerHTML="\x3cspan\x3e"+w+"\x3c/span\x3e";J.set(q,"top",k+"px");J.set(q,"left",h+15+"px");J.set(q,"display","")}else g.create("div",{innerHTML:"\x3cspan\x3e"+w+"\x3c/span\x3e",
id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:k+"px",left:h+15+"px"}},document.body)},f.clientX,f.clientY,d),500)},e)),b.mouseOutHandler=b.mouseOutHandler||{},b.mouseOutHandler[c.id]=y.connect(a,"onmouseout",C.hitch(this,function(d){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,J.set(H.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;p.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)y.disconnect(b.mouseMoveHandler[a]);
if(b.mouseOutHandler)for(a in b.mouseOutHandler)y.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var b=[],c;p.forEach(a.dynamicLayerInfos||a.layerInfos,function(e){c={id:e.id};c.source=e.source&&e.source.toJson();var d;a.layerDefinitions&&a.layerDefinitions[e.id]&&(d=a.layerDefinitions[e.id]);d&&(c.definitionExpression=d);var f;a.layerDrawingOptions&&a.layerDrawingOptions[e.id]&&(f=a.layerDrawingOptions[e.id]);f&&(c.drawingInfo=f.toJson());c.minScale=e.minScale||0;c.maxScale=
e.maxScale||0;b.push(c)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var e,d=b.dynamicLayerInfos||b.layerInfos;for(e=0;e<d.length;e++)if(c==d[e].id){-1<d[e].parentLayerId&&(J.set(H.byId(this.id+"_"+a+"_"+d[e].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,d[e].parentLayerId));break}},_addSubLayersToHide:function(a){function b(c,
e){var d=a.layer.dynamicLayerInfos||a.layer.layerInfos,f,h;for(f=0;f<d.length;f++)if(d[f].id===c&&d[f].subLayerIds)for(h=0;h<d[f].subLayerIds.length;h++){var k=d[f].subLayerIds[h];-1===p.indexOf(e,k)&&(e.push(k),b(k,e))}}a.layer.layerInfos&&p.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var e,d=!0;if(a.legendResponse&&a.legendResponse.layers)for(e=0;e<a.legendResponse.layers.length;e++){var f=a.legendResponse.layers[e];
if(b.id==f.layerId){if(!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale){if(0==f.minScale&&a.tileInfo)var h=a.tileInfo.lods[0].scale;if(0==f.maxScale&&a.tileInfo)var k=a.tileInfo.lods[a.tileInfo.lods.length-1].scale}else h=Math.min(a.minScale,f.minScale)||a.minScale||f.minScale,k=Math.max(a.maxScale,f.maxScale);if(0<h&&h<c||k>c)d=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)d=!1;return d},_getServiceTitle:function(a){var b=a._titleForLegend;
b||(b=a.url,a.url?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===
a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],V.isDefined(a)&&(b+=" ("+a+")"));return K.encode(b)},_getEffectiveScale:function(a,b){var c=b.minScale,e=b.maxScale;if(V.isDefined(b.parentLayerId)){a=a.layerInfos;b=b.parentLayerId;var d;for(d=a.length-1;0<=d;d--)if(a[d].id==b)if(0==c&&0<a[d].minScale?c=a[d].minScale:0<c&&0==a[d].minScale||0<c&&0<a[d].minScale&&(c=Math.min(c,
a[d].minScale)),e=Math.max(e||0,a[d].maxScale||0),-1<a[d].parentLayerId)b=a[d].parentLayerId;else break}return{minScale:c,maxScale:e}},_isSupportedLayerType:function(a){return!(!a||!("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.RasterXLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===
a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.WFSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass))},isHostedTileService:function(a){var b=/(https?:)?\/\/services.*\.arcgis\.com/i;return!("esri.layers.ArcGISTiledMapServiceLayer"!==a.declaredClass||!b.test(a.url))},getField:function(a,b,c){if(a.getField)return a.getField(b);
if(c&&c.fields){var e;p.forEach(c.fields,function(d){d.name===b&&(e=d)});return e}return null}});C.mixin(na,{ALIGN_LEFT:0,ALIGN_RIGHT:1});x("extend-esri")&&C.setObject("dijit.Legend",na,T);return na});