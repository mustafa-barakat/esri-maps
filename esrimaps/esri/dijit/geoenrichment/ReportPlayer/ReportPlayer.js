// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/geoenrichment/ReportPlayer/templates/ReportPlayer.html":'\x3cdiv class\x3d"esriGEReportPlayer esriGENonSelectable"\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"printBackgroundView" class\x3d"esriGEAbsoluteStretched"\x3e\x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"normalViewDiv"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"playerToolbarDiv"\x3e\x3c/div\x3e\r\n\r\n        \x3cdiv data-dojo-attach-point\x3d"printableDivContainer" class\x3d"reportPalyer_printableDivContainer"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"printableDiv" class\x3d"reportPalyer_printableDiv"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"reportContainerDiv"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv class\x3d"reportPlayer_sidePageNavigator" data-dojo-attach-point\x3d"sidePageNavigator"\x3e\r\n            \x3cdiv class\x3d"reportPlayer_paginationArrowUp" data-dojo-attach-point\x3d"prevPageButton"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"reportPlayer_paginationArrowDown" data-dojo-attach-point\x3d"nextPageButton"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n\r\n        \x3cdiv data-dojo-attach-point\x3d"playerAfterToolbarDiv" class\x3d"reportPlayer_playerAfterToolbarDiv"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/geoenrichment/ReportPlayer/ReportPlayer","dojo/_base/declare dojo/_base/lang esri/dijit/geoenrichment/promise/all esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when dojo/on dojo/keys dojo/dom-class dijit/_WidgetBase dijit/_TemplatedMixin ./config ./playerSupports/_CommandSupport ./playerSupports/_LogoSupport ./playerSupports/_MapSupport ./playerSupports/_PageNavigationSupport ./playerSupports/_PrintSupport ./playerSupports/_ReportContainersSwitcher ./playerSupports/_SmartLayoutSupport ./playerSupports/_ZoomSupport ./playerSupports/_WaitingSupport ./supportClasses/PlayerConfigurator ./supportClasses/PlayerToFullScreenAnimator ./toolbar/PlayerToolbar ./ReportPlayerViewModel ./PlayerResizeModes ./PlayerThemes ./PlayerViewModes ./ReportPlayerState ./PlayerZoomBehaviors ./DataProviderGE ./dataProvider/commands/supportClasses/LayoutXMLBuilder esri/dijit/geoenrichment/utils/DelayUtil esri/dijit/geoenrichment/utils/DeviceUtil esri/dijit/geoenrichment/utils/DomUtil esri/dijit/geoenrichment/utils/InvokeUtil esri/dijit/geoenrichment/utils/async/AsyncQueue dojo/text!./templates/ReportPlayer.html dojo/i18n!esri/nls/jsapi ./_devConfig".split(" "),
function(B,h,C,t,f,x,D,k,E,F,u,G,H,I,J,K,L,M,N,O,l,y,P,Q,v,R,n,p,S,T,U,q,V,r,W,X,Y,m,w){m=m.geoenrichment.dijit.ReportPlayer.ReportPlayer;return B([E,F,G,H,I,K,L,M,N,J,O],{templateString:Y,nls:m,isPlayer:!0,dataProvider:null,exportCommands:null,config:null,theme:void 0,viewMode:void 0,enableDataDrilling:!0,showToolbarInPopup:!1,showAreaTitle:void 0,showReportTitle:!1,scaleSlidesToFitWindow:void 0,showCloseButton:!1,showToFullScreenAnimation:!1,canAddMoreAreas:!1,areasSelectButtons:null,comparisonSettings:null,
resizeMode:void 0,printConfig:{subtitle:m.preparedByEsri,printDialogClass:"esri/dijit/geoenrichment/ReportPlayer/printing/PageOptionsDialog/PageOptionsDialog"},showProgressBar:!0,defaultZoomBehavior:void 0,nlsMap:null,isDataDrillingPlayer:!1,isPlayerOnServer:!1,_viewModel:null,_reportData:null,_analysisAreaIndex:0,_originalAreaViewMode:null,_showAllAreasSideBySide:!1,playerToolbar:null,postCreate:function(){this.config=h.mixin(u,this.config);if(u.isPlayerOnServer=this.isPlayerOnServer)u.maps.maxNumberOfMapsShownAtTheSameTime=
1E6,this.defaultZoomBehavior=S.RESET;this._viewModel=new (this._getViewModelClass());this._setUpDataProvider();l.configurePlayer(this);!this.isPlayerOnServer&&this._initToolbar();this._initContainerSwither();!this.isPlayerOnServer&&this._initSmartLayout();!this.isPlayerOnServer&&this._initCommands();!this.isPlayerOnServer&&this._initPageNavigationControls();!this.isPlayerOnServer&&this._initZoomControls();!this.isPlayerOnServer&&this._applyTheme();!this.isPlayerOnServer&&this._showError(!1);!this.isPlayerOnServer&&
this._initProgressController();V.isMobileDevice()&&(k.add(this.domNode,"esriGEReportPlayerMobile"),this._setUpMobileOrientationHandling());this._updateElementsVisibility()},_setUpDataProvider:function(){this.dataProvider=this.dataProvider||new T;this.exportCommands&&this.exportCommands.forEach(function(a){this.dataProvider.registerCommand(a)},this)},_orientationDfd:null,_setUpMobileOrientationHandling:function(){var a=this;this.own(x(window,"orientationchange",function(){a._orientationDfd&&a._orientationDfd.resolve("cancel");
var c=a._orientationDfd=new t;a._showWaiting(c.promise,"orientationchange");c.promise.then(function(b){"cancel"!==b&&(a._setViewMode(null),a.refresh())});f(a.getRenderPromise(),function(){q.delay(500).then(c.resolve,c.resolve)})}))},_getViewModelClass:function(){return Q},_setViewMode:function(a){l.configurePlayer(this,a);this._refreshZoomControls()},_initToolbar:function(){var a=this;this.playerToolbar=(new P({player:this,popupButtonDiv:this.playerAfterToolbarDiv,showToolbarInPopup:this.showToolbarInPopup,
showAreaTitle:this.showAreaTitle,stretchToolbarNode:!this.showToolbarInPopup&&(this.resizeMode===v.FIT_WINDOW?document.body:this.domNode),showCloseButton:this.showCloseButton,canAddMoreAreas:this.canAddMoreAreas,areasSelectButtons:this.areasSelectButtons,onShowAnalysisAreaAt:function(c){a.showAnalysisAreaAt(c)},onCompareAreasSideBySide:function(){a.showAllAnalysisAreasSideBySide()},onShowPageAt:function(c){a.showPageAt(c)},isScrollShown:function(){var c=a.getCurrentReportContainer();return c&&c.isScrollShown&&
c.isScrollShown()},onClose:function(){a._onClose()},onAddMoreAreas:function(){a.onAddMoreAreas()},onRemoveAreas:function(c){a.onAreasPreRemoved(c);c.forEach(function(e){e.hidden=!0});if(a.viewMode===n.PANELS_IN_STACK_ALL)if(2>a.getAnalysisAreas().filter(function(e){return!e.hidden}).length)a._setAllAreasVisible(!1);else{var b={};c.forEach(function(e){b[e.index]=!1});a.getCurrentReportContainer().setAreasVisibilityState(b,{append:!0});a._updateAreaSelect()}else if(a.getCurrentAnalysisArea().hidden){var d=
a.getAnalysisAreas().filter(function(e){return!e.hidden})[0];d?a.showAnalysisAreaAt(d.index):a.refresh()}else a._updateAreaSelect();a.onAreasRemoved(c)}})).placeAt(this.playerToolbarDiv);this.own(this.playerToolbar);this.showCloseButton&&this.own(x(window,"keyup",function(c){a.getWaitingPromise()||p.isViewingDataDrillingZoom||p.isImageViewerShown||c.keyCode===D.ESCAPE&&a._onClose()}))},_applyTheme:function(){k.remove(this.domNode,"playerThemeDark playerThemeLight");k.add(this.domNode,this.theme===
R.DARK?"playerThemeDark":"playerThemeLight");this.playerToolbar.setTheme(this.theme)},playReport:function(a,c){return this._showWaiting(this._callAfterRendering("_doPlayReport",[a,c]),"playReport")},_doPlayReport:function(a,c){this.playerToolbar&&this.playerToolbar.closePopup();var b=this;this._showError(!1);this._progressController&&this._progressController.reset();this.showToFullScreenAnimation&&this.resizeMode===v.FIT_WINDOW&&y.animateTo(this);this.dataProvider._onCreateReportStarted=function(){b._viewModel.preInitialize()};
this._viewModel.reset();return f(this.dataProvider.getReportData(a,{progressCallback:function(d){b._progressController&&b._progressController.setLoadDataProgress(d)}}),function(d){if(b.viewMode===n.PANELS_IN_STACK_ALL){var e=b.viewMode;1<d.analysisAreas.length&&!d.isMultiFeature?b._originalAreaViewMode||(b._showAllAreasSideBySide=!0,b._originalAreaViewMode=l.getDefaultViewMode(b)):(b._showAllAreasSideBySide=!1,e=b._originalAreaViewMode||l.getDefaultViewMode(b));b._setViewMode(e)}return b.setReportData(d,
c)},function(d){b._showError(d)})},refresh:function(a){return this._reportData&&f(this.setReportData(this._reportData,{waitUntilAllContentIsReady:!(!a||!a.waitUntilAllContentIsReady)}),function(){this.showPageAt(0);return this.resize()}.bind(this))},_isDataBeingSetFlag:!1,_notifyShownPendingFlag:!1,setReportData:function(a,c){return this._showWaiting(this._callAfterRendering("_doSetReportData",[a,c]),"setReportData")},setReportDataAndExport:function(a,c){var b=this;if(a.reportObject.isMultiFeature)return this.setReportData(a,
{waitUntilAllContentIsReady:!0,disableAnimation:!0}).then(function(){return b.executeCommand(c.commandId,c.commandParams)});var d=new t,e=0,g=[],A=function(){var Z=b.dataProvider.reportDataToSingleAreaReportData(a,{currentFeatureIndex:e,reportTitle:a.reportTitle,templateJson:a.templateJson});b.setReportData(Z,{waitUntilAllContentIsReady:!0,disableAnimation:!0}).then(function(){var z=h.mixin({},c.commandParams);z.pageNumerationInfo={startAreaIndex:e,numAreas:a.analysisAreas.length};return f(b.executeCommand(c.commandId,
z)).then(function(aa){g.push(aa);++e===a.analysisAreas.length?d.resolve(U.stitchDocuments(g)):setTimeout(A)})})};A();return d.promise},_doSetReportData:function(a,c){var b=this;c=c||{};this._reportData=a;w.emulateErrors.playerError&&(a=null);if(!a||w.emulateErrors.emptyDataProviderResponse)this._showError(!0);else{this._isDataBeingSetFlag=!0;p.isAnimationSuspended=!0;this.onSetReportDataStart();var d=new t;this._viewModel.setAnimationAllowed(!c.disableAnimation);this._configureViewModel(a);(b.isPlayerOnServer?
f():q.delay(0)).then(function(){if(1===a.analysisAreas.length||a.isMultiFeature)b._destroyAllContainers(),b._resetMapBuilder(),b._applyReportData({analysisAreaIndex:0,rerenderContent:!0}).then(d.resolve,d.reject);else{!1!==c._resetLoadedContents&&(b._destroyAllContainers(),b._resetMapBuilder());var e=a.analysisAreas.length-1,g=function(){for(;0<=e&&a.analysisAreas[e].hidden;)e--;0>e?d.resolve():b._applyReportData({analysisAreaIndex:e--,rerenderContent:!1,isFinalArea:0>e}).then(function(){(b.isPlayerOnServer?
f():q.delay(0)).then(g)},d.reject)};g()}});this._progressController&&this._progressController.setNumAreas(a.analysisAreas.length);this._progressController&&this._progressController.setLoadDataProgress(1);return d.promise.then(function(){return b._progressController&&b._progressController.finalize()}).otherwise(function(e){b._showError(e)}).always(function(){var e=b.getCurrentReportContainer();if(e&&e.domNode)return(b.isPlayerOnServer?f():q.delay(300)).then(function(){b._isDataBeingSetFlag=!1;b._notifyShownPendingFlag=
!r.isNodeInLayout(b.domNode);p.isAnimationSuspended=b.isPlayerOnServer;b.onSetReportDataEnd();b._emitPendingResizedEvent();b._progressController&&b._progressController.reset();if(c.waitUntilAllContentIsReady)return b.getRenderPromise()})})}},showAnalysisAreaAt:function(a){return this._callAfterRendering("_doShowAnalysisAreaAt",[a])},_doShowAnalysisAreaAt:function(a){var c=this;return f(this._setAllAreasVisible(!1),function(){if(c._analysisAreaIndex!==a&&c.getAnalysisAreas()[a]&&!c.getAnalysisAreas()[a].hidden)return c._applyReportData({analysisAreaIndex:a,
rerenderContent:!1})})},showAllAnalysisAreasSideBySide:function(){return this._callAfterRendering("_doShowAllAnalysisAreasSideBySide")},_doShowAllAnalysisAreasSideBySide:function(){return this._setAllAreasVisible(!0)},_setAllAreasVisible:function(a){if(this._showAllAreasSideBySide!==a)return a?(this._showAllAreasSideBySide=!0,this._originalAreaViewMode=this.viewMode===n.PANELS_IN_STACK_ALL?l.getDefaultViewMode(this):this.viewMode,this._setViewMode(n.PANELS_IN_STACK_ALL)):(this._showAllAreasSideBySide=
!1,this._setViewMode(this._originalAreaViewMode),this._originalAreaViewMode=null),this.refresh()},_applyReportData:function(a){var c=this;a=a||{};var b=this._reportData&&this._reportData.isMultiFeature?0:a.analysisAreaIndex||0,d=!1!==a.rerenderContent;this._analysisAreaIndex=b;this._showError(!this._reportData);if(this._reportData)return f(this._viewModel.initialize(!this._reportData.reportObject.isGraphicReport,this.viewMode),function(){return c._setReportContainer(d)?c._doApplyTemplateJson({analysisAreaIndex:b,
isFinalArea:a.isFinalArea}):c._updateAreaSelect()})},_doApplyTemplateJson:function(a){var c=this,b=this.getCurrentReportContainer(),d=h.clone(this._reportData.templateJson);w.emulateErrors.emptyTemplateJson&&(d.sectionsTables.length=0);var e=b.fromJson(d,{waitUntilAllContentIsReady:!0,progressCallback:function(g){c._progressController&&c._progressController.setProgressForAreaAt(g,a.analysisAreaIndex)},analysisAreaIndex:a.analysisAreaIndex,isFinalArea:a.isFinalArea,renderSync:this.isPlayerOnServer});
d=b.getPagePromise?b.getPagePromise():e;b=b.getContentPromise?b.getContentPromise():e;this._registerContainerLoadPromise(b||d);this._updateAreaSelect();return f(d,function(){c._setCurrentContainerLoaded();c.showPageAt(c._currentPageIndex);return c.resize()})},_updateAreaSelect:function(){this.playerToolbar&&this.playerToolbar.updateAreaSelect({analysisAreas:this._reportData.analysisAreas,combinedAreasInfo:this._reportData.combinedAreasInfo,currentAreaIndex:this._showAllAreasSideBySide?"all":this.getCurrentAnalysisAreaIndex(),
isMultiFeature:this._reportData.isMultiFeature})},getReportData:function(){return this._reportData},getReportTitle:function(){return this._reportData&&this._reportData.reportTitle||""},getCurrentAnalysisAreaIndex:function(){return this._analysisAreaIndex},getCurrentAnalysisArea:function(){return this._reportData&&this._reportData.analysisAreas[this._analysisAreaIndex]},getAnalysisAreas:function(){return this._reportData&&this._reportData.analysisAreas},reportDataToJson:function(a){return this._showWaiting(this.dataProvider.reportDataToJson(this.getReportData(),
a),"reportDataToJson")},reportDataFromJson:function(a,c){var b=this;this._showError(!1);return this._showWaiting(f(this.dataProvider.reportDataFromJson(a),function(d){return b.setReportData(d,c)}),"reportDataFromJson")},_configureViewModel:function(a){this._viewModel.setTheme(this._reportData.templateJson.theme);this._viewModel.enableDataDrilling=!this.isPlayerOnServer&&this.enableDataDrilling;this._viewModel.setDynamicReportInfo({fieldData:this._reportData.fieldData,analysisAreas:this._reportData.analysisAreas,
combinedAreasInfo:this._reportData.combinedAreasInfo,attachmentsStore:this._reportData.attachmentsStore,createMapFunc:h.hitch(this,this._createMap),reportObject:this._reportData.reportObject,isMultiFeature:this._reportData.isMultiFeature,isFixedDataMode:!this._reportData.config.geoenrichmentUrl,geClient:this._reportData.geClient,templateVariableProvider:this._reportData.templateVariableProvider,countryID:this._reportData.config.countryID,hierarchy:this._reportData.config.hierarchy,templateJson:this._reportData.templateJson});
this._viewModel.getDynamicBehaviorImage=h.hitch(this,this._getReportLogo)},notifyShown:function(){!this._isDataBeingSetFlag&&this._notifyShownPendingFlag&&(this.getCurrentReportContainer()&&this.getCurrentReportContainer().notifyShown(),this._notifyShownPendingFlag=!1)},_isErrorShown:!1,_showError:function(a){this.errorViewDiv&&r.destroy(this.errorViewDiv);this.errorViewDiv=null;r[a?"hide":"show"](this.printableDivContainer);k[a?"add":"remove"](this.domNode,"esriGEReportPlayerError");this._isErrorShown=
!!a;this._updateElementsVisibility();a?(this.errorViewDiv=r.create("div",{"class":"esriGEReportPlayerErrorMessage",innerHTML:m.cantPlayReportError},this.domNode),this.playerToolbar&&this.playerToolbar.setErrorShown(!0),this._progressController&&this._progressController.reset(),console.log(a),this.onError(a)):this.playerToolbar&&this.playerToolbar.setErrorShown(!1)},isErrorShown:function(){return this._isErrorShown},_updateElementsVisibility:function(){var a=0<this._waitingCount?!1:this._reportData||
this._isErrorShown,c=0<this._waitingCount||this._isErrorShown?!1:!0,b=0<this._waitingCount||this._isErrorShown?!1:!0;this.playerToolbarDiv&&(this.playerToolbarDiv.style.opacity=a?"":"0.001");this.sidePageNavigator&&(this.sidePageNavigator.style.opacity=c?"":"0.001");this.reportContainerDiv.style.opacity=b?"":"0.001"},setPrintMode:function(a){k[a?"add":"remove"](this.domNode,"esriGEReportPlayerInPrinting")},resize:function(a,c){this._resize({width:a,height:c});this._updatePageNavigator();this._updateZoomControls();
this.playerToolbar&&this.playerToolbar.update()},_pendingResizeEvent:null,_emitResizedEvent:function(a){this._pendingResizeEvent={isPaginating:!!a};this._isDataBeingSetFlag||this._emitPendingResizedEvent()},_emitPendingResizedEvent:function(){this._pendingResizeEvent&&(this.onResized(this._pendingResizeEvent.isPaginating),this._pendingResizeEvent=null)},_onClose:function(){var a;this.showToFullScreenAnimation&&this.resizeMode===v.FIT_WINDOW&&(a=y.animateFrom(this));f(a,function(){this.onClose()}.bind(this))},
getVisualState:function(){return{type:"reportPlayer",viewMode:this.viewMode,reportContainers:this.getAllReportContainers().map(function(a){return a.getVisualState&&a.getVisualState()})}},setVisualState:function(a){return this._callAfterRendering("_doSetVisualState",[a])},_doSetVisualState:function(a){var c=a&&this.getAllReportContainers().map(function(b,d){return b.setVisualState&&b.setVisualState(a.reportContainers[d])});return C(c)},_renderQueue:null,getRenderPromise:function(){return this._renderQueue&&
this._renderQueue.getPromise()},_registerContainerLoadPromise:function(a){this._renderQueue=this._renderQueue||new X;this._renderQueue.add(a);this.playerToolbar&&this.playerToolbar.setContentLoadPromise(this.getRenderPromise())},_safeFuncCaller:null,_callAfterRendering:function(a,c){if(this.isPlayerOnServer)return this[a].apply(this,c);var b=this;this._safeFuncCaller=this._safeFuncCaller||{};this._safeFuncCaller[a]=function(){return b[a].apply(b,c)};return f(this.getRenderPromise(),function(){return W.invoke(b._safeFuncCaller,
a)})},onSetReportDataStart:function(){},onSetReportDataEnd:function(){},onResized:function(a){},onClose:function(){},onError:function(a){},onAddMoreAreas:function(){},onAreasPreRemoved:function(a){},onAreasRemoved:function(a){},destroy:function(){this._destroyAllContainers();this.inherited(arguments)}})});