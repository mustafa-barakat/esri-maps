// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(H,n,t){H.DeferredList=function(l,k,e,c,a){var b=[];n.call(this);var f=this;0!==l.length||k||this.resolve([0,[]]);var g=0;t.forEach(l,function(h,d){function m(p,v){b[d]=[p,v];g++;g===l.length&&f.resolve(b)}h.then(function(p){k?f.resolve([d,p]):m(!0,p)},function(p){e?f.reject(p):m(!1,p);if(c)return null;throw p;})})};H.DeferredList.prototype=new n;H.DeferredList.prototype.gatherResults=
function(l){l=new H.DeferredList(l,!1,!0,!1);l.addCallback(function(k){var e=[];t.forEach(k,function(c){e.push(c[1])});return e});return l};return H.DeferredList})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(H,n,t,l,k,e,c,a,b,f,g,h,d){function m(){}function p(v){return function(q,
w,y,x){return q&&"string"==typeof w&&q[w]==m?q.on(w.substring(2).toLowerCase(),c.hitch(y,x)):v.apply(t,arguments)}}H.around(t,"connect",p);e.connect&&H.around(e,"connect",p);H=l("dijit._Widget",[g,h,d],{onClick:m,onDblClick:m,onKeyDown:m,onKeyPress:m,onKeyUp:m,onMouseDown:m,onMouseMove:m,onMouseOut:m,onMouseOver:m,onMouseLeave:m,onMouseEnter:m,onMouseUp:m,constructor:function(v){this._toConnect={};for(var q in v)this[q]===m&&(this._toConnect[q.replace(/^on/,"").toLowerCase()]=v[q],delete v[q])},postCreate:function(){this.inherited(arguments);
for(var v in this._toConnect)this.on(v,this._toConnect[v]);delete this._toConnect},on:function(v,q){return this[this._onMap(v)]===m?t.connect(this.domNode,v.toLowerCase(),this,q):this.inherited(arguments)},_setFocusedAttr:function(v){this._focused=v;this._set("focused",v)},setAttribute:function(v,q){e.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(v,q)},attr:function(v,q){return 2<=arguments.length||"object"===typeof v?this.set.apply(this,
arguments):this.get(v)},getDescendants:function(){e.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?a("[widgetId]",this.containerNode).map(f.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});k("dijit-legacy-requires")&&b(0,function(){require(["dijit/_base"])});return H})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q,w,y,x,E,B,C){function G(D){return function(r){a[r?"set":"remove"](this.domNode,D,r);this._set(D,r)}}d.add("dijit-legacy-requires",!m.isAsync);d.add("dojo-bidi",!1);d("dijit-legacy-requires")&&q(0,function(){H(["dijit/_base/manager"])});var I={};l=e("dijit._WidgetBase",[w,E],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:G("lang"),dir:"",_setDirAttr:G("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(D){this._set("ownerDocument",D)},attributeMap:{},_blankGif:l.blankGif||H.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var D=this.constructor;if(!D._setterAttrs){var r=D.prototype,u=D._setterAttrs=[];D=D._onMap={};for(var A in r.attributeMap)u.push(A);for(A in r)/^on/.test(A)&&(D[A.substring(2).toLowerCase()]=A),/^_set[A-Z](.*)Attr$/.test(A)&&(A=A.charAt(4).toLowerCase()+
A.substr(5,A.length-9),r.attributeMap&&A in r.attributeMap||u.push(A))}},postscript:function(D,r){this.create(D,r)},create:function(D,r){this._introspect();this.srcNodeRef=c.byId(r);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);D&&(this.params=D,p.mixin(this,D));this.postMixInProperties();this.id||(this.id=C.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=
this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=x.body(this.ownerDocument);C.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();if((D=this.srcNodeRef)&&D.parentNode&&this.domNode!==D){D.parentNode.replaceChild(this.domNode,D);var u=!0}this.domNode.setAttribute("widgetId",this.id)}this.postCreate();u&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var D={},r;for(r in this.params||{})D[r]=this._get(r);n.forEach(this.constructor._setterAttrs,
function(u){if(!(u in D)){var A=this._get(u);A&&this.set(u,A)}},this);for(r in D)this.set(r,D[r])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var D=this.baseClass.split(" ");this.isLeftToRight()||(D=D.concat(n.map(D,function(r){return r+"Rtl"})));b.add(this.domNode,D)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,n.forEach(this.getChildren(),function(D){D._started||
D._destroyed||!p.isFunction(D.startup)||(D.startup(),D._started=!0)}))},destroyRecursive:function(D){this._beingDestroyed=!0;this.destroyDescendants(D);this.destroy(D)},destroy:function(D){function r(u){u.destroyRecursive?u.destroyRecursive(D):u.destroy&&u.destroy(D)}this._beingDestroyed=!0;this.uninitialize();n.forEach(this._connects,p.hitch(this,"disconnect"));n.forEach(this._supportingWidgets,r);this.domNode&&n.forEach(C.findWidgets(this.domNode,this.containerNode),r);this.destroyRendering(D);
C.remove(this.id);this._destroyed=!0},destroyRendering:function(D){this.bgIframe&&(this.bgIframe.destroy(D),delete this.bgIframe);this.domNode&&(D?a.remove(this.domNode,"widgetId"):f.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(D||f.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(D){n.forEach(this.getChildren(),function(r){r.destroyRecursive&&r.destroyRecursive(D)})},uninitialize:function(){return!1},_setStyleAttr:function(D){var r=this.domNode;p.isObject(D)?
h.set(r,D):r.style.cssText=r.style.cssText?r.style.cssText+("; "+D):D;this._set("style",D)},_attrToDom:function(D,r,u){u=3<=arguments.length?u:this.attributeMap[D];n.forEach(p.isArray(u)?u:[u],function(A){var J=this[A.node||A||"domNode"];switch(A.type||"attribute"){case "attribute":p.isFunction(r)&&(r=p.hitch(this,r));A=A.attribute?A.attribute:/^on[A-Z][a-zA-Z]*$/.test(D)?D.toLowerCase():D;J.tagName?a.set(J,A,r):J.set(A,r);break;case "innerText":J.innerHTML="";J.appendChild(this.ownerDocument.createTextNode(r));
break;case "textContent":J.textContent=r;break;case "innerHTML":J.innerHTML=r;break;case "class":b.replace(J,r,this[D]);break;case "toggleClass":b.toggle(J,A.className||D,r)}},this)},get:function(D){var r=this._getAttrNames(D);return this[r.g]?this[r.g]():this._get(D)},set:function(D,r){if("object"===typeof D){for(var u in D)this.set(u,D[u]);return this}u=this._getAttrNames(D);var A=this[u.s];if(p.isFunction(A))var J=A.apply(this,Array.prototype.slice.call(arguments,1));else{A=this.focusNode&&!p.isFunction(this.focusNode)?
"focusNode":"domNode";var O=this[A]&&this[A].tagName,P;if((P=O)&&!(P=I[O])){P=this[A];var z={};for(F in P)z[F.toLowerCase()]=!0;P=I[O]=z}var F=P;u=D in this.attributeMap?this.attributeMap[D]:u.s in this?this[u.s]:F&&u.l in F&&"function"!=typeof r||/^aria-|^data-|^role$/.test(D)?A:null;null!=u&&this._attrToDom(D,r,u);this._set(D,r)}return J||this},_attrPairNames:{},_getAttrNames:function(D){var r=this._attrPairNames;if(r[D])return r[D];var u=D.replace(/^[a-z]|-[a-zA-Z]/g,function(A){return A.charAt(A.length-
1).toUpperCase()});return r[D]={n:D+"Node",s:"_set"+u+"Attr",g:"_get"+u+"Attr",l:u.toLowerCase()}},_set:function(D,r){var u=this[D];this[D]=r;!this._created||u===r||u!==u&&r!==r||(this._watchCallbacks&&this._watchCallbacks(D,u,r),this.emit("attrmodified-"+D,{detail:{prevValue:u,newValue:r}}))},_get:function(D){return this[D]},emit:function(D,r,u){r=r||{};void 0===r.bubbles&&(r.bubbles=!0);void 0===r.cancelable&&(r.cancelable=!0);r.detail||(r.detail={});r.detail.widget=this;var A,J=this["on"+D];J&&
(A=J.apply(this,u?u:[r]));this._started&&!this._beingDestroyed&&v.emit(this.domNode,D.toLowerCase(),r);return A},on:function(D,r){var u=this._onMap(D);return u?t.after(this,u,r,!0):this.own(v(this.domNode,D,r))[0]},_onMap:function(D){var r=this.constructor,u=r._onMap;if(!u){u=r._onMap={};for(var A in r.prototype)/^on/.test(A)&&(u[A.replace(/^on/,"").toLowerCase()]=A)}return u["string"==typeof D&&D.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},
getChildren:function(){return this.containerNode?C.findWidgets(this.containerNode):[]},getParent:function(){return C.getEnclosingWidget(this.domNode.parentNode)},connect:function(D,r,u){return this.own(k.connect(D,r,this,u))[0]},disconnect:function(D){D.remove()},subscribe:function(D,r){return this.own(y.subscribe(D,p.hitch(this,r)))[0]},unsubscribe:function(D){D.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():g.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&
"none"!=h.get(this.domNode,"display")},placeAt:function(D,r){var u=!D.tagName&&C.byId(D);!u||!u.addChild||r&&"number"!==typeof r?(D=u&&"domNode"in u?u.containerNode&&!/after|before|replace/.test(r||"")?u.containerNode:u.domNode:c.byId(D,this.ownerDocument),f.place(this.domNode,D,r),!this._started&&(this.getParent()||{})._started&&this.startup()):u.addChild(this,r);return this},defer:function(D,r){var u=setTimeout(p.hitch(this,function(){u&&(u=null,this._destroyed||p.hitch(this,D)())}),r||0);return{remove:function(){u&&
(clearTimeout(u),u=null);return null}}}});d("dojo-bidi")&&l.extend(B);return l})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(H,n,t){return t("dijit.Destroyable",null,{destroy:function(l){this._destroyed=!0},own:function(){var l=["destroyRecursive","destroy","remove"];H.forEach(arguments,function(k){function e(){c.remove();H.forEach(a,function(f){f.remove()})}var c=n.before(this,"destroy",function(f){k[b](f)}),a=[];if(k.then){var b="cancel";
k.then(e,e)}else H.forEach(l,function(f){"function"===typeof k[f]&&(b||(b=f),a.push(n.after(k,f,e,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(H,n,t,l,k,e){H=l("dijit._OnDijitClickMixin",null,{connect:function(c,a,b){return this.inherited(arguments,[c,"ondijitclick"==a?e:a,b])}});H.a11yclick=e;return H})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase",
"dojo/_base/declare","dojo/_base/lang"],function(H,n,t,l){l.extend(n,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return t("dijit._FocusMixin",null,{_focusManager:H})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(H,n,t,l){t(function(){n("highcontrast")&&H.add(l.body(),"dijit_a11y")});return n})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(H,n,t,l,k,e,c){k.add("highcontrast",function(){var a=c.doc.createElement("div");try{a.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(n.blankGif||H.toUrl("./resources/blank.gif"))+'");';c.body().appendChild(a);var b=l.getComputedStyle(a),f=b.backgroundImage;return b.borderTopColor==b.borderRightColor||f&&("none"==f||"url(invalid-url:)"==f)}catch(g){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
g.toString()),!1}finally{8>=k("ie")?a.outerHTML="":c.body().removeChild(a)}});e(function(){k("highcontrast")&&t.add(c.body(),"dj_a11y")});return k})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(H,n,t,l,k,e,c){e.extend(H,{waiRole:"",waiState:""});return k("dijit._Templated",[n,t],{constructor:function(){c.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(a,b){var f=this.inherited(arguments),g=b(a,"waiRole");g&&a.setAttribute("role",g);(g=b(a,"waiState"))&&l.forEach(g.split(/\s*,\s*/),function(h){-1!=h.indexOf("-")&&(h=h.split("-"),a.setAttribute("aria-"+h[0],h[1]))});return f}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(H,n,t,l,k,e,c,a){var b=n("dijit._TemplatedMixin",a,{templateString:null,
templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(f){var g=this.declaredClass,h=this;return c.substitute(f,this,function(d,m){"!"==m.charAt(0)&&(d=l.getObject(m.substr(1),!1,h));if("undefined"==typeof d)throw Error(g+" template:"+m);return null==d?"":"!"==m.charAt(0)?d:this._escapeValue(""+d)},this)},_escapeValue:function(f){return f.replace(/["'<>&]/g,function(g){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[g]})},buildRendering:function(){if(!this._rendered){this.templateString||
(this.templateString=H(this.templatePath,{sanitize:!0}));var f=b.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument);if(l.isString(f)){var g=t.toDom(this._stringRepl(f),this.ownerDocument);if(1!=g.nodeType)throw Error("Invalid template: "+f);}else g=f.cloneNode(!0);this.domNode=g}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(f){var g=this.containerNode;if(f&&g)for(;f.hasChildNodes();)g.appendChild(f.firstChild)}});
b._templateCache={};b.getCachedTemplate=function(f,g,h){var d=b._templateCache,m=f,p=d[m];if(p){try{if(!p.ownerDocument||p.ownerDocument==(h||document))return p}catch(v){}t.destroy(p)}f=c.trim(f);if(g||f.match(/\$\{([^\}]+)\}/g))return d[m]=f;g=t.toDom(f,h);if(1!=g.nodeType)throw Error("Invalid template: "+f);return d[m]=g};e("ie")&&k(window,"unload",function(){var f=b._templateCache,g;for(g in f){var h=f[g];"object"==typeof h&&t.destroy(h);delete f[g]}});return b})},"dojo/cache":function(){define(["./_base/kernel",
"./text"],function(H){return H.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(H,n,t,l,k,e,c,a,b){var f=k.delegate(a,{mouseenter:e.enter,mouseleave:e.leave,keypress:t._keypress}),g;t=l("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);
this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(h){for(var d=h;;)if(1==d.nodeType&&(this._processTemplateNode(d,function(m,p){return m.getAttribute(p)},this._attach)||this.searchContainerNode)&&d.firstChild)d=d.firstChild;else{if(d==h)break;for(;!d.nextSibling;)if(d=d.parentNode,d==h)return;d=d.nextSibling}},_processTemplateNode:function(h,d,m){var p=!0,v=this.attachScope||this,q=d(h,"dojoAttachPoint")||d(h,"data-dojo-attach-point");if(q)for(var w=q.split(/\s*,\s*/);q=
w.shift();)k.isArray(v[q])?v[q].push(h):v[q]=h,p="containerNode"!=q,this._attachPoints.push(q);if(d=d(h,"dojoAttachEvent")||d(h,"data-dojo-attach-event"))for(q=d.split(/\s*,\s*/),w=k.trim;d=q.shift();)if(d){var y=null;-1!=d.indexOf(":")?(y=d.split(":"),d=w(y[0]),y=w(y[1])):d=w(d);y||(y=d);this._attachEvents.push(m(h,d,k.hitch(v,y)))}return p},_attach:function(h,d,m){d=d.replace(/^on/,"").toLowerCase();d="dijitclick"==d?g||(g=H("./a11yclick")):f[d]||d;return c(h,d,m)},_detachTemplateNodes:function(){var h=
this.attachScope||this;n.forEach(this._attachPoints,function(d){delete h[d]});this._attachPoints=[];n.forEach(this._attachEvents,function(d){d.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});k.extend(b,{dojoAttachEvent:"",dojoAttachPoint:""});return t})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(H,n,t,l,k){return t("dijit._WidgetsInTemplateMixin",
null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var e=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);k.parse(e,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(l.hitch(this,function(c){this._startupWidgets=c;for(var a=0;a<c.length;a++)this._processTemplateNode(c[a],
function(b,f){return b[f]},function(b,f,g){return f in b?b.connect(b,f,g):b.on(f,g,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(e,c,a){return c(e,"dojoType")||c(e,"data-dojo-type")?
!0:this.inherited(arguments)},startup:function(){H.forEach(this._startupWidgets,function(e){e&&!e._started&&e.startup&&e.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v){function q(B){return eval("("+B+")")}function w(B){var C=
B._nameCaseMap,G=B.prototype;if(!C||C._extendCnt<x){C=B._nameCaseMap={};for(var I in G)"_"!==I.charAt(0)&&(C[I.toLowerCase()]=I);C._extendCnt=x}return C}function y(B,C){C||(C=H);var G=C._dojoParserCtorMap||(C._dojoParserCtorMap={}),I=B.join();if(!G[I]){for(var D=[],r=0,u=B.length;r<u;r++){var A=B[r];D[D.length]=G[A]=G[A]||t.getObject(A)||~A.indexOf("/")&&C(A)}B=D.shift();G[I]=D.length?B.createSubclass?B.createSubclass(D):B.extend.apply(B,D):B}return G[I]}new Date("X");var x=0;b.after(t,"extend",function(){x++},
!0);var E={_clearCache:function(){x++;_ctorMap={}},_functionFromScript:function(B,C){var G="",I="",D=B.getAttribute(C+"args")||B.getAttribute("args");C=B.getAttribute("with");D=(D||"").split(/\s*,\s*/);C&&C.length&&l.forEach(C.split(/\s*,\s*/),function(r){G+="with("+r+"){";I+="}"});return new Function(D,G+B.innerHTML+I)},instantiate:function(B,C,G){C=C||{};G=G||{};var I=(G.scope||n._scopeName)+"Type",D="data-"+(G.scope||n._scopeName)+"-",r=D+"type",u=D+"mixins",A=[];l.forEach(B,function(J){var O=
I in C?C[I]:J.getAttribute(r)||J.getAttribute(I);if(O){var P=J.getAttribute(u);O=P?[O].concat(P.split(/\s*,\s*/)):[O];A.push({node:J,types:O})}});return this._instantiate(A,C,G)},_instantiate:function(B,C,G,I){function D(r){C._started||G.noStart||l.forEach(r,function(u){"function"!==typeof u.startup||u._started||u.startup()});return r}B=l.map(B,function(r){var u=r.ctor||y(r.types,G.contextRequire);if(!u)throw Error("Unable to resolve constructor for: '"+r.types.join()+"'");return this.construct(u,
r.node,C,G,r.scripts,r.inherited)},this);return I?f(B).then(D):D(B)},construct:function(B,C,G,I,D,r){function u(S){Q&&t.setObject(Q,S);for(F=0;F<V.length;F++)b[V[F].advice||"after"](S,V[F].method,t.hitch(S,V[F].func),!0);for(F=0;F<W.length;F++)W[F].call(S);for(F=0;F<L.length;F++)S.watch(L[F].prop,L[F].func);for(F=0;F<T.length;F++)p(S,T[F].event,T[F].func);return S}var A=B&&B.prototype;I=I||{};var J={};I.defaults&&t.mixin(J,I.defaults);r&&t.mixin(J,r);if(d("dom-attributes-explicit"))var O=C.attributes;
else d("dom-attributes-specified-flag")?O=l.filter(C.attributes,function(S){return S.specified}):(r=(/^input$|^img$/i.test(C.nodeName)?C:C.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),O=l.map(r.split(/\s+/),function(S){var U=S.toLowerCase();return{name:S,value:"LI"==C.nodeName&&"value"==S||"enctype"==U?C.getAttribute(U):C.getAttributeNode(U).value}}));var P=I.scope||n._scopeName;r="data-"+P+"-";var z={};"dojo"!==P&&(z[r+
"props"]="data-dojo-props",z[r+"type"]="data-dojo-type",z[r+"mixins"]="data-dojo-mixins",z[P+"type"]="dojotype",z[r+"id"]="data-dojo-id");var F=0,M;P=[];for(var Q,R;M=O[F++];){var K=M.name,N=K.toLowerCase();M=M.value;switch(z[N]||N){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":R=M;break;case "data-dojo-id":case "jsid":Q=M;break;case "data-dojo-attach-point":case "dojoattachpoint":J.dojoAttachPoint=M;break;case "data-dojo-attach-event":case "dojoattachevent":J.dojoAttachEvent=
M;break;case "class":J["class"]=C.className;break;case "style":J.style=C.style&&C.style.cssText;break;default:if(K in A||(K=w(B)[N]||K),K in A)switch(typeof A[K]){case "string":J[K]=M;break;case "number":J[K]=M.length?Number(M):NaN;break;case "boolean":J[K]="false"!=M.toLowerCase();break;case "function":""===M||-1!=M.search(/[^\w\.]+/i)?J[K]=new Function(M):J[K]=t.getObject(M,!1)||new Function(M);P.push(K);break;default:N=A[K],J[K]=N&&"length"in N?M?M.split(/\s*,\s*/):[]:N instanceof Date?""==M?new Date(""):
"now"==M?new Date:g.fromISOString(M):N instanceof a?n.baseUrl+M:q(M)}else J[K]=M}}for(O=0;O<P.length;O++)z=P[O].toLowerCase(),C.removeAttribute(z),C[z]=null;if(R)try{R=q.call(I.propsThis,"{"+R+"}"),t.mixin(J,R)}catch(S){throw Error(S.toString()+" in data-dojo-props\x3d'"+R+"'");}t.mixin(J,G);D||(D=B&&(B._noScript||A._noScript)?[]:m("\x3e script[type^\x3d'dojo/']",C));var V=[],W=[],L=[],T=[];if(D)for(F=0;F<D.length;F++)z=D[F],C.removeChild(z),G=z.getAttribute(r+"event")||z.getAttribute("event"),I=
z.getAttribute(r+"prop"),R=z.getAttribute(r+"method"),P=z.getAttribute(r+"advice"),O=z.getAttribute("type"),z=this._functionFromScript(z,r),G?"dojo/connect"==O?V.push({method:G,func:z}):"dojo/on"==O?T.push({event:G,func:z}):J[G]=z:"dojo/aspect"==O?V.push({method:R,advice:P,func:z}):"dojo/watch"==O?L.push({prop:I,func:z}):W.push(z);B=(D=B.markupFactory||A.markupFactory)?D(J,C,B):new B(J,C);return B.then?B.then(u):u(B)},scan:function(B,C){function G(N){if(!N.inherited){N.inherited={};var V=N.node,W=
G(N.parent);V={dir:V.getAttribute("dir")||W.dir,lang:V.getAttribute("lang")||W.lang,textDir:V.getAttribute(O)||W.textDir};for(var L in V)V[L]&&(N.inherited[L]=V[L])}return N.inherited}var I=[],D=[],r={},u=(C.scope||n._scopeName)+"Type",A="data-"+(C.scope||n._scopeName)+"-",J=A+"type",O=A+"textdir";A+="mixins";var P=B.firstChild,z=C.inherited;if(!z){z=function L(V,W){return V.getAttribute&&V.getAttribute(W)||V.parentNode&&L(V.parentNode,W)};z={dir:z(B,"dir"),lang:z(B,"lang"),textDir:z(B,O)};for(var F in z)z[F]||
delete z[F]}F={inherited:z};for(var M,Q;;)if(P)if(1!=P.nodeType)P=P.nextSibling;else if(M&&"script"==P.nodeName.toLowerCase())(z=P.getAttribute("type"))&&/^dojo\/\w/i.test(z)&&M.push(P),P=P.nextSibling;else if(Q)P=P.nextSibling;else if(z=P.getAttribute(J)||P.getAttribute(u),B=P.firstChild,z||B&&(3!=B.nodeType||B.nextSibling)){Q=null;if(z){var R=P.getAttribute(A);M=R?[z].concat(R.split(/\s*,\s*/)):[z];try{Q=y(M,C.contextRequire)}catch(N){}Q||l.forEach(M,function(N){~N.indexOf("/")&&!r[N]&&(r[N]=!0,
D[D.length]=N)});R=Q&&!Q.prototype._noScript?[]:null;F={types:M,ctor:Q,parent:F,node:P,scripts:R};F.inherited=G(F);I.push(F)}else F={node:P,scripts:M,parent:F};M=R;Q=P.stopParser||Q&&Q.prototype.stopParser&&!C.template;P=B}else P=P.nextSibling;else{if(!F||!F.node)break;P=F.node.nextSibling;Q=!1;F=F.parent;M=F.scripts}var K=new h;D.length?(d("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+D.join(", ")),(C.contextRequire||H)(D,function(){K.resolve(l.filter(I,function(N){if(!N.ctor)try{N.ctor=
y(N.types,C.contextRequire)}catch(L){}for(var V=N.parent;V&&!V.types;)V=V.parent;var W=N.ctor&&N.ctor.prototype;N.instantiateChildren=!(W&&W.stopParser&&!C.template);N.instantiate=!V||V.instantiate&&V.instantiateChildren;return N.instantiate}))})):K.resolve(I);return K.promise},_require:function(B,C){B=q("{"+B.innerHTML+"}");var G=[],I=[],D=new h;C=C&&C.contextRequire||H;for(var r in B)G.push(r),I.push(B[r]);C(I,function(){for(var u=0;u<G.length;u++)t.setObject(G[u],arguments[u]);D.resolve(arguments)});
return D.promise},_scanAmd:function(B,C){var G=new h,I=G.promise;G.resolve(!0);var D=this;m("script[type\x3d'dojo/require']",B).forEach(function(r){I=I.then(function(){return D._require(r,C)});r.parentNode.removeChild(r)});return I},parse:function(B,C){!B||"string"==typeof B||"nodeType"in B||(C=B,B=C.rootNode);var G=B?e.byId(B):c.body();C=C||{};var I=C.template?{template:!0}:{},D=[],r=this;B=this._scanAmd(G,C).then(function(){return r.scan(G,C)}).then(function(u){return r._instantiate(u,I,C,!0)}).then(function(u){return D=
D.concat(u)}).otherwise(function(u){console.error("dojo/parser::parse() error",u);throw u;});t.mixin(D,B);return D}};n.parser=E;k.parseOnLoad&&v(100,E,"parse");return E})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(H,n){var t={};H.setObject("dojo.date.stamp",t);t.fromISOString=function(l,k){t._isoRegExp||(t._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var e=t._isoRegExp.exec(l);l=null;
if(e){e.shift();e[1]&&e[1]--;e[6]&&(e[6]*=1E3);k&&(k=new Date(k),n.forEach(n.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(b){return k["get"+b]()}),function(b,f){e[f]=e[f]||b}));l=new Date(e[0]||1970,e[1]||0,e[2]||1,e[3]||0,e[4]||0,e[5]||0,e[6]||0);100>e[0]&&l.setFullYear(e[0]||1970);var c=0,a=e[7]&&e[7].charAt(0);"Z"!=a&&(c=60*(e[8]||0)+(Number(e[9])||0),"-"!=a&&(c*=-1));a&&(c-=l.getTimezoneOffset());c&&l.setTime(l.getTime()+6E4*c)}return l};t.toISOString=function(l,
k){var e=function(f){return 10>f?"0"+f:f};k=k||{};var c=[],a=k.zulu?"getUTC":"get",b="";"time"!=k.selector&&(b=l[a+"FullYear"](),b=["0000".substr((b+"").length)+b,e(l[a+"Month"]()+1),e(l[a+"Date"]())].join("-"));c.push(b);"date"!=k.selector&&(b=[e(l[a+"Hours"]()),e(l[a+"Minutes"]()),e(l[a+"Seconds"]())].join(":"),a=l[a+"Milliseconds"](),k.milliseconds&&(b+="."+(100>a?"0":"")+e(a)),k.zulu?b+="Z":"time"!=k.selector&&(l=l.getTimezoneOffset(),k=Math.abs(l),b+=(0<l?"-":"+")+e(Math.floor(k/60))+":"+e(k%
60)),c.push(b));return c.join("T")};return t})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p){H=H(d,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(v){try{if(v=n.mixin({bingMapsKey:null,
culture:"en-US"},v||{}),this.url=f.getProtocolForWebResource()+"//dev.virtualearth.net/REST/v1",this._url=f.urlToObject(this.url),this.spatialReference=new g({wkid:102100}),this.tileInfo=new h({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,
resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,
scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,scale:1128.497176},{level:20,resolution:.1492910708238085,scale:564.248588}]}),this.initialExtent=
this.fullExtent=new m(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new g({wkid:102100})),n.mixin(this,v),this.hasAttributionData=this.showAttribution,this._initLayer=n.hitch(this,this._initLayer),this._errorHandler=n.hitch(this,this._errorHandler),this._getTileInfo=n.hitch(this,this._getTileInfo),this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");}catch(q){throw this.onError(q),q;}},_unsetMap:function(v,q){this.inherited("_unsetMap",arguments)},
_getTileInfo:function(){if(this.mapStyle){var v=this._url.path+"/Imagery/Metadata/"+this.mapStyle,q=window.location.protocol;if(this.bingMapsKey){var w=this.resourceInfo;!this.loaded&&w?this._initLayer(w):p({url:v,content:n.mixin({},{uriScheme:"https:"===q?"https":"http",key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,error:this._errorHandler})}}},_initLayer:function(v,q){if(200!==v.statusCode)q=Error(),
q.code=v.statusCode,q.message=v.statusDescription,q.details=v.errorDetails,q.authenticationResultCode=v.authenticationResultCode,this.onError(q);else try{this.resourceInfo=t.toJson(v);var w=v.resourceSets[0].resources[0],y=w.imageUrl.replace("{","${");this.tileServers=l.map(w.imageUrlSubdomains,function(E){var B=f.getProtocolForWebResource();return c.substitute(y,{subdomain:E}).replace("http:",B)});this._tsLength=this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=
this.copyright||"\x26copy; 2017 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var x=this.loadCallback;x&&(delete this.loadCallback,x(this))}}catch(E){this.onError(E)}},getAttributionData:function(){var v=new a,q=t.fromJson(this.resourceInfo),w;this.hasAttributionData&&q&&(w=n.getObject("resourceSets.0.resources.0.imageryProviders",!1,q));w?v.callback({contributors:w}):(q=Error("Layer does not have attribution data"),q.log=k.isDebug,v.errback(q));return v},getTileUrl:function(v,
q,w){return c.substitute(this.tileServers[q%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(v,q,w),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(v,q,w){var y="",x;for(x=v;0<x;x--){v="0";var E=1<<x-1;0!=(w&E)&&v++;0!=(q&E)&&(v++,v++);y+=v}return y},setMapStyle:function(v){this.mapStyle=v;this._getTileInfo()},setCulture:function(v){this.culture=v;this._getTileInfo()},setBingMapsKey:function(v){this.bingMapsKey=v},onMapStyleChange:function(){}});n.mixin(H,{MAP_STYLE_AERIAL:"aerial",
MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabelsOnDemand",MAP_STYLE_ROAD:"roadOnDemand"});e("extend-esri")&&n.setObject("virtualearth.VETiledLayer",H,b);return H})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),function(H,n,t,l,k,e,c,a,b,f,g,h,d,m){function p(v,q){var w=[];if(v&&q&&(q.customLayerParameters||
q.customParameters)){var y=n.clone(q.customParameters||{});n.mixin(y,q.customLayerParameters||{});v=f.urlToObject(v);for(var x in v.query)y.hasOwnProperty(x)||w.push(x+"\x3d"+v.query[x]);v=v.path+(w.length?"?"+w.join("\x26"):"")}return v}H=H(d,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(v,q){q||(q={});this.urlTemplate=v=p(v,q.wmtsInfo);var w=new h(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new g({wkid:102100})),y=new h(-2.0037508342787E7,-2.003750834278E7,
2.003750834278E7,2.0037508342787E7,new g({wkid:102100}));this.initialExtent=q.initialExtent||w;this.fullExtent=q.fullExtent||y;this.tileInfo=q.tileInfo?q.tileInfo:new m({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,
scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},
{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,scale:1128.497176},{level:20,resolution:.14929107082380833,
scale:564.248588},{level:21,resolution:.07464553541190416,scale:282.124294},{level:22,resolution:.03732276770595208,scale:141.062147},{level:23,resolution:.01866138385297604,scale:70.5310735}]});this.spatialReference=new g(this.tileInfo.spatialReference.toJson());this.copyright=q.copyright||"";var x=new l(v);w=x.scheme+"://"+x.authority+"/";this.urlPath=v.substring(w.length);this.tileServers=q.tileServers||[];-1===x.authority.indexOf("{subDomain}")&&this.tileServers.push(w);if(q.subDomains&&0<q.subDomains.length&&
1<x.authority.split(".").length){this.subDomains=q.subDomains;var E;t.forEach(q.subDomains,function(G){-1<x.authority.indexOf("${subDomain}")?E=x.scheme+"://"+e.substitute(x.authority,{subDomain:G})+"/":-1<x.authority.indexOf("{subDomain}")&&(E=x.scheme+"://"+x.authority.replace(/\{subDomain\}/gi,G)+"/");this.tileServers.push(E)},this)}this.tileServers=t.map(this.tileServers,function(G){"/"!==G.charAt(G.length-1)&&(G+="/");return G});this._levelToLevelValue=[];var B=0;t.forEach(this.tileInfo.lods,
function(G,I){this._levelToLevelValue[G.level]=G.levelValue||G.level;0===I&&(B=this._levelToLevelValue[G.level])},this);this._wmtsInfo=q.wmtsInfo;var C=n.hitch(this,function(){this.loaded=!0;this.onLoad(this)});k("chrome")?(v=this.getTileUrl(B,0,0),q=c.defaults.io,w="with-credentials"===q.useCors?f.canUseXhr(v,!0):-1,(q=-1<w?q.corsEnabledServers[w]:null)&&q.withCredentials?b({url:v,handleAs:"arraybuffer"}).addBoth(function(){C()}):C()):C()},getTileUrl:function(v,q,w){v=this._levelToLevelValue[v];
var y=this.tileServers[q%this.tileServers.length]+e.substitute(this.urlPath,{level:v,z:v,col:w,x:w,row:q,y:q});y=y.replace(/\{level\}/gi,v).replace(/\{row\}/gi,q).replace(/\{col\}/gi,w).replace(/\{z\}/gi,v).replace(/\{x\}/gi,w).replace(/\{y\}/gi,q);y=this._appendCustomLayerParameters(y);y=this.addTimestampToURL(y);return f.addProxy(y)},_appendCustomLayerParameters:function(v){var q;if(this._wmtsInfo&&(this._wmtsInfo.customLayerParameters||this._wmtsInfo.customParameters)){var w=n.clone(this._wmtsInfo.customParameters||
{});n.mixin(w,this._wmtsInfo.customLayerParameters||{});for(q in w)v+=(-1===v.indexOf("?")?"?":"\x26")+q+"\x3d"+encodeURIComponent(w[q])}return v}});k("extend-esri")&&n.setObject("layers.WebTiledLayer",H,a);return H})},"esri/layers/VectorTileLayer":function(){(function(){var H=function(){try{var t=window.WebGLRenderingContext}catch(b){t=!1}try{for(var l=document.createElement("canvas"),k=["webgl","experimental-webgl","webkit-3d","moz-webgl"],e=null,c=0;c<k.length;++c){try{e=l.getContext(k[c])}catch(b){}if(e)break}var a=
e}catch(b){a=!1}return t&&a?!0:!1}(),n=["dojo/_base/lang","dojo/has","dojo/Deferred","../sniff","./layer"];H&&n.push("./VectorTileLayerImpl");define(n,function(t,l,k,e,c,a){c=a?a:c.createSubclass({declaredClass:"esri.layers.VectorTileLayer",constructor:function(){var b=new k;b.reject(Error("esri.layers.VectorTileLayer is not supported"));b.promise.otherwise(t.hitch(this,function(f){this._errorHandler(f)}))}});c.ACCESS_TOKEN=null;c.supported=function(){return H};l("extend-esri")&&t.setObject("layers.VectorTileLayer",
c,e);return c})})()},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),function(H,n,t,l,k,e,c){H=H([e,c],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(a,b){this._initialize(a,b);this.useMapImage=b&&b.useMapImage||!1},refresh:function(a){if(!0===a)this.inherited(arguments);else{var b=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);
this.disableClientCaching=b}},setRenderer:function(a,b){this.renderer=a;this.onRendererChange();b||this.refresh(!0)},exportMapImage:function(a,b){var f=k.defaults.map;a=n.mixin({size:f.width+","+f.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete a._ts;this._exportMapImage(this._url.path+"/exportImage",a,b)}});t("extend-esri")&&n.setObject("layers.ArcGISImageServiceLayer",H,l);return H})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query dojo/DeferredList ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ../renderers/colorRampUtils ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q,w,y,x,E,B,C,G,I,D,r,u,A,J,O,P){H=H(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_rasterFunctionServiceInfoProps:"bandCount pixelType hasRasterAttributeTable hasColormap hasHistograms minValues maxValues meanValues stdvValues serviceDataType".split(" "),_pixelTypeRanges:{U1:[0,1],U2:[0,3],U4:[0,15],U8:[0,255],S8:[-128,127],U16:[0,65535],S16:[-32768,32767]},_eventMap:{"rendering-change":!0,
"mosaic-rule-change":!0,"spatial-reference-change":!0,"renderer-change":!0},_cachedVariableStats:{},_cachedVariableHistogram:{},constructor:function(z,F){this.useMapTime=F&&F.hasOwnProperty("useMapTime")?!!F.useMapTime:!0},_initialize:function(z,F){this._url=v.urlToObject(z);this.raster=new G(this._url.path);this._rasterFunctionTemplateInfos={};this._customRenderingRuleId={};this.infoTemplate=F&&F.infoTemplate;this.format=(z=F&&F.imageServiceParameters)&&z.format;this.compressionTolerance=z&&z.compressionTolerance?
z.compressionTolerance:.01;this.interpolation=z?z.interpolation:null;this.compressionQuality=z?z.compressionQuality:null;this.bandIds=z?z.bandIds:null;this.mosaicRule=z?z.mosaicRule:null;this.renderingRule=z?z.renderingRule:null;this.renderer=z?z.renderer:null;this.useMapDimensionValue=F&&F.hasOwnProperty("useMapDimensionValue")?!!F.useMapDimensionValue:!0;this.hasImageFilter=F&&F.hasImageFilter;this.activeMapDimensions=F&&F.activeMapDimensions;this._params=n.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,
format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},z?z.toJson():{});this.pixelFilter=F&&F.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=n.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=n.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=n.hitch(this,this._initLayer);this._queryVisibleRastersHandler=n.hitch(this,this._queryVisibleRastersHandler);
this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._renderingRuleColormap={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=F&&F.loadCallback;z&&z.renderer&&(z.renderer.outputUnit||z.renderer.inputUnit)&&(this.vectorFieldPixelFilter=new D,this.vectorFieldPixelFilter.setUnits(z.renderer.inputUnit,z.renderer.outputUnit));(F=F&&F.resourceInfo)?this._initLayer(F):m({url:this._url.path,content:n.mixin({f:"json"},
this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(z,F){if(null!==z&&void 0!==z){this._findCredential();(this.credential&&this.credential.ssl||z&&z._ssl)&&this._useSSL();F=this.minScale;var M=this.maxScale;n.mixin(this,z);this.minScale=F;this.maxScale=M;this.initialExtent=this.fullExtent=this.extent=new q(z.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=
parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);var Q=this.minValues,R=this.maxValues,K=this.meanValues,N=this.stdvValues,V=this.bands=[];F=0;for(M=this.bandCount;F<M;F++)V[F]={min:Q[F],max:R[F],mean:K[F],stddev:N[F]};this.timeInfo=(F=this.timeInfo)&&F.timeExtent?new u(F):null;M=this.fields=[];if(Q=z.fields)for(F=0;F<Q.length;F++)M.push(new A(Q[F]));this._updateInfoTemplateFields(this.fields);this.version=z.currentVersion;this.version||(this.version="fields"in z||"objectIdField"in
z||"timeInfo"in z?10:9.3);d.isDefined(z.minScale)&&!this._hasMin&&"Raster"!==z.cacheType&&this.setMinScale(z.minScale);d.isDefined(z.maxScale)&&!this._hasMax&&"Raster"!==z.cacheType&&this.setMaxScale(z.maxScale);F={};z.defaultMosaicMethod?(F.method=z.defaultMosaicMethod,F.operation=z.mosaicOperator,F.sortField=z.sortField,F.sortValue=z.sortValue):F.method=E.METHOD_NONE;this.defaultMosaicRule=new E(F);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===
this.serviceDataType;this._setDefaultRenderingRule(!0);this._getRenderingRuleAttributeTableAndColormap();this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(n.hitch(this,function(W){W&&(W.features&&W.fields&&(this.rasterAttributeTable=n.clone(W)),W.features&&0<W.features.length&&(this._rasterAttributeTableFeatures=
n.clone(W.features)),W.fields&&0<W.fields.length&&(this._rasterAttributeTableFields=n.clone(W.fields)),this.renderingRule||!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh())}));this._initVectorPixelFilter();this.bandIds||2!==this.bandCount||this.renderingRule||"esri.layers.ArcGISImageServiceLayer"!==this.declaredClass||this.setBandIds([0,0,0],!0);!(10.3<=this.version&&this.rasterFunctionInfos&&
this.rasterFunctionInfos.length)||this._url.query&&this._url.query.raster||this.getRasterFunctionInfos().then(n.hitch(this,function(W){if(W&&W.length){this.rasterFunctionInfos=W;var L=[],T;l.forEach(W,function(S){if(S){var U=S.functionType;T=T||1===U||2===U;L.push(S.name)}},this);this._hasItemLevelRFT=T;this._rasterFunctionNames=L;T&&(this._initVectorPixelFilter(),this.refresh())}}));this.loaded=!0;this._setDefaultFilter();this.onLoad(this);if(z=this._loadCallback)delete this._loadCallback,z(this)}},
_updateInfoTemplateFields:function(z){if(z&&!(1>z.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var F,M;var Q=this.infoTemplate.info.fieldInfos;for(F=0;F<z.length;F++){var R=z[F];for(M=0;M<Q.length;M++)if(Q[M].fieldName.toLowerCase()===R.name.toLowerCase()&&Q[M].fieldName!==R.name){Q[M].fieldName=R.name;break}}}},getKeyProperties:function(z){var F=this._url.path+"/keyProperties",M=new t(p._dfdCanceller),Q={f:"json"};
z&&z.renderingRule&&(Q.renderingRule=k.toJson(z.renderingRule.toJson()));10<this.version?(M._pendingDfd=m({url:F,content:Q,handleAs:"json",callbackParamName:"callback"}),M._pendingDfd.then(function(R){M.callback(R)},function(R){M.errback(R)})):(z=Error("Layer does not have key properties"),z.log=!!e.isDebug,M.errback(z));return M},getRasterAttributeTable:function(z){var F=this._url.path+"/rasterAttributeTable",M=new t(p._dfdCanceller),Q={f:"json"},R=this.hasRasterAttributeTable;z&&z.renderingRule&&
(Q.renderingRule=k.toJson(z.renderingRule.toJson()),R=!0);!this.loaded||10<this.version&&R?(M._pendingDfd=m({url:F,content:Q,handleAs:"json",callbackParamName:"callback"}),M._pendingDfd.then(function(K){M.callback(K)},function(K){M.errback(K)})):(z=Error("Layer does not support raster attribute table"),z.log=!!e.isDebug,M.errback(z));return M},getRenderingRuleAttributeTable:function(z){var F=new t(p._dfdCanceller);if(!z||!z.renderingRule)return F.errback(Error("Rendering rule is not specified")),
F;z=z.renderingRule;var M=this._getRenderingRuleId(z);this._renderingRuleAttributeTable&&M&&this._renderingRuleAttributeTable.hasOwnProperty(M)?F.resolve(this._renderingRuleAttributeTable[M]):F=this.getRasterAttributeTable({renderingRule:z}).then(n.hitch(this,function(Q){if(Q&&Q.features&&Q.features.length&&Q.fields&&Q.fields.length){var R={features:n.clone(Q.features),fields:n.clone(Q.fields)};M&&(this._renderingRuleAttributeTable[M]=R)}return R}));return F},_initVectorPixelFilter:function(){var z;
this._hasItemLevelRFT&&this.renderingRule&&(z=this._getItemLevelRenderingRule(this.renderingRule));if(z=z||this.renderingRule)return this.getRenderingRuleServiceInfo(z).then(n.hitch(this,function(F){!F||!this._isVectorData(F)&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass||d.isDefined(this.pixelFilter)||(this.vectorFieldPixelFilter=this.vectorFieldPixelFilter||new D,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===F.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,
this.getKeyProperties().then(n.hitch(this,this._setFlowRepresentation)),this._applyVectorResamplingType(F.serviceDataType))}))},_applyVectorResamplingType:function(z){if(z){var F=this.renderingRule;F&&"Resample"===F.functionName&&((F.functionArguments||{}).ResamplingType="esriImageServiceDataTypeVector-UV"===z?7:10,this.setRenderingRule(new B(F.toJson())))}},_getRasterAttributeTableFeatures:function(){var z=new t;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return z.resolve(this._rasterAttributeTableFeatures),
z;if(10<this.version&&this.hasRasterAttributeTable)return z=this.getRasterAttributeTable(),z.then(n.hitch(this,function(F){F&&F.features&&0<F.features.length&&(this._rasterAttributeTableFeatures=n.clone(F.features))})),z;z.resolve(this._rasterAttributeTableFeatures);return z},_getRenderingRuleAttributeTableFeatures:function(z){z=z&&z.renderingRule;return z?this.getRenderingRuleAttributeTable({renderingRule:z}).then(function(F){return F&&F.features}):(z=new t,z.errback(Error("Rendering rule is not specified")),
z)},_getRenderingRuleAttributeTableAndColormap:function(){this.renderingRule&&this.getRenderingRuleServiceInfo(this.renderingRule).then(n.hitch(this,function(z){z.hasRasterAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:this.renderingRule}).then(n.hitch(this,function(){!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh()}));z.hasColormap&&this.getRenderingRuleColormap({renderingRule:this.renderingRule}).then(n.hitch(this,
function(){this.renderer&&"esri.renderer.ColormapRenderer"===this.renderer.declaredClass&&this.refresh()}))}))},getCustomRasterFields:function(z){var F=z?z.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;z=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var M={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:z},Q={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,
length:50,type:z},R={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},K=this.fields?n.clone(this.fields):[];z=K.length;K[z]=Q;10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRenderingRuleAProcessingTemplate({functionName:"none"}))&&(z++,K[z]=R);if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||
this.fields&&0<this.fields.length)z++,K[z]=M;!d.isDefined(this.pixelFilter)||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(M={name:this._rasterFieldPrefix+"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},Q={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},z++,K[z]=M,z++,K[z]=Q);z=this._rasterAttributeTableFields;(M=this.renderingRule&&
this._getRenderingRuleId(this.renderingRule))&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(M)&&(z=this._renderingRuleAttributeTable[M].fields);z&&0<z.length&&(z=l.filter(z,function(V){return"esriFieldTypeOID"!==V.type&&"value"!==V.name.toLowerCase()}),z=l.map(z,function(V){var W=n.clone(V);W.name=F+V.name;return W}),K=K.concat(z));var N=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&l.forEach(this.rasterFunctionInfos,
function(V){V&&V.name&&"none"!==V.name.toLowerCase()&&(V={name:N+V.name.replace(/ /gi,"_"),alias:V.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},K.push(V))});return K},_applyTimeToMultidimensionalCRF:function(z,F){var M=this._isTimeSupportedOnCRF();if(M&&(!z||!z.multidimensionalDefinition))return z;var Q=this.timeInfo&&this.timeInfo.startTimeField;if((F=F||this._params.time)&&Q&&this._isMultidimensionalCRF()){z=n.clone(z||this.defaultMosaicRule)||new E;z.multidimensionalDefinition=z.multidimensionalDefinition||
[];var R=z.multidimensionalDefinition.filter(function(N){return N.dimensionName===Q}),K=F.split(",").map(function(N){return parseInt(N,10)});2===K.length&&K[0]===K[1]&&(K.length=1);0<R.length?M?z.multidimensionalDefinition.forEach(function(N){N.dimensionName===Q&&(N.dimensionName=null,N.isSlice=null,N.values=null)}):z.multidimensionalDefinition.forEach(function(N){N.dimensionName===Q&&(N.isSlice=1===K.length,N.values=1===K.length?K:[K])}):M||(z.multidimensionalDefinition.some(function(N){return null!=
N.variableName&&null==N.dimensionName})?z.multidimensionalDefinition.forEach(function(N){null!=N.variableName&&null==N.dimensionName&&(N.dimensionName=Q,N.isSlice=1===K.length,N.values=1===K.length?K:[K])}):z.multidimensionalDefinition.push(new C({variableName:"",dimensionName:Q,isSlice:1===K.length,values:1===K.length?K:[K]})));this._cleanupMultidimensionalDefinition(z)}return z},_prepareGetImageParameters:function(z,F,M,Q){Q=d.isDefined(Q)?Q:this._params;if(this.renderer||this._hasItemLevelRFT&&
this.renderingRule){var R=this.getExportImageRenderingRule();Q.renderingRule=R?k.toJson(R.toJson()):null}R=this.getExportImageMosaicRule(Q);Q.mosaicRule=R?k.toJson(R.toJson()):null;R=z.spatialReference.wkid||k.toJson(z.spatialReference.toJson(!1));delete Q._ts;n.mixin(Q,{bbox:z.xmin+","+z.ymin+","+z.xmax+","+z.ymax,imageSR:R,bboxSR:R,size:F+","+M},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete Q.compressionTolerance;Q.format&&"LERC"===Q.format.toUpperCase()&&(Q.compressionTolerance=
this.compressionTolerance);Q.token=this._getToken()},getImageUrl:function(z,F,M,Q,R){R=d.isDefined(R)?R:this._params;this._prepareGetImageParameters(z,F,M,R);z=n.clone(R);this._cleanupRequestParams(z);F=this._url.path+"/exportImage?";M=v.addProxy(F+b.objectToQuery(n.mixin(z,{f:"image"})));var K=z.token;M.length>h.defaults.io.postLength||this.useMapImage?this._jsonRequest=m({url:F,content:n.mixin(z,{f:"json"}),callbackParamName:"callback",load:function(N,V){N=N.href;K&&(N+=-1===N.indexOf("?")?"?token\x3d"+
K:"\x26token\x3d"+K);Q(v.addProxy(N))},error:this._errorHandler}):Q(M)},onRenderingChange:function(){},onMosaicRuleChange:function(){},onRendererChange:function(){},setInterpolation:function(z,F){this.interpolation=this._params.interpolation=z;F||this.refresh(!0)},setCompressionQuality:function(z,F){this.compressionQuality=this._params.compressionQuality=z;F||this.refresh(!0)},setCompressionTolerance:function(z,F){this.compressionTolerance=z;F||this.refresh(!0)},setBandIds:function(z,F){var M=!1;
this.bandIds!==z&&(M=!0);this.bandIds=z;this._params.bandIds=z?z.join(","):null;if(M&&!F)this.onRenderingChange();F||this.refresh(!0)},setDefaultBandIds:function(z){this.bandIds=this._params.bandIds=null;z||this.refresh(!0)},setDisableClientCaching:function(z){this.disableClientCaching=z},setMosaicRule:function(z,F){var M=!1;this.mosaicRule!==z&&(M=!0);this.mosaicRule=z;this._params.mosaicRule=k.toJson(z.toJson());if(M&&!F)this.onMosaicRuleChange();F||this.refresh(!0)},getRasterFunctionInfos:function(){if(10.3>
this.version||!this.rasterFunctionInfos||!this.rasterFunctionInfos.length)console.log("Layer doesn't support /rasterFunctionInfos resource.");else return m({url:this._url.path+"/rasterFunctionInfos",content:{f:"json"},handleAs:"json",load:function(z){return z&&z.rasterFunctionInfos}})},setRenderingRule:function(z,F){var M=!1;this.renderingRule!==z&&(M=!0);this.renderingRule=z;this._params.renderingRule=z?k.toJson(z.toJson()):null;this._useRenderingRuleAttributeTable?this.getRenderingRuleAttributeTable({renderingRule:z}):
"esri.layers.RasterXLayer"!==this.declaredClass&&this._getRenderingRuleAttributeTableAndColormap();if(M)this.onRenderingChange();this._setDefaultFilter();F||this.refresh(!0)},setImageFormat:function(z,F){this.format=this._params.format=z;this._setDefaultFilter();F||this.refresh(!0)},setInfoTemplate:function(z){this.infoTemplate=z;this._updateInfoTemplateFields(this.fields)},setDefinitionExpression:function(z,F){var M=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?
M=this.defaultMosaicRule.toJson():M.method=E.METHOD_NONE);M.where=z;z=new E(M);this.setMosaicRule(z,F);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(z){this.pixelFilter=z;this._isDefaultPixelFilter=!1},getPixelData:function(z){return z?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):
this.pixelData},getExportImageRenderingRule:function(){var z;this._hasItemLevelRFT&&this.renderingRule&&(z=this._getServiceLevelRenderingRule(this.renderingRule));z=z||this.renderingRule;this._isItemLevelRasterFunction(this.renderingRule)&&(z=void 0);return this._combineRenderingRule(this._convertRendererToRenderingRule(this.renderer),z)},getExportImageMosaicRule:function(){var z=this.mosaicRule,F;this._hasItemLevelRFT&&this.renderingRule&&(F=this._getItemLevelRenderingRule(this.renderingRule));F&&
(z=z||this.defaultMosaicRule||new E,z.itemRenderingRule=F);return z=this._applyTimeToMultidimensionalCRF(z)},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getHistograms:function(z){var F=new t(p._dfdCanceller);if(z&&this._cachedVariableHistogram[z])return F.resolve(this._cachedVariableHistogram[z]),F;if(this.hasHistograms){var M={f:"json"};z&&(M.variable=z);F._pendingDfd=m({url:this._url.path+"/histograms",content:M,handleAs:"json",callbackParamName:"callback"});
F._pendingDfd.then(n.hitch(this,function(Q){z&&(this._cachedVariableHistogram[z]=Q);F.callback(Q)}),function(Q){F.errback(Q)})}else M=Error("Layer does not have histograms."),M.log=!!e.isDebug,F.errback(M);return F},computeHistograms:function(z){var F=new t(p._dfdCanceller);if(10.1<=this.currentVersion){z=z||{};var M=z.geometry||this.fullExtent,Q=(z.geometry||this.fullExtent).toJson();M="extent"===M.type?"esriGeometryEnvelope":"esriGeometryPolygon";var R=z.renderingRule||this.renderingRule||this.defaultRenderingRule;
R=R?R.toJson():null;var K=z.mosaicRule||this.mosaicRule||this.defaultMosaicRule;K=K?K.toJson():null;z=z.pixelSize||{x:this.pixelSizeX,y:this.pixelSizeY};F._pendingDfd=m({url:this._url.path+"/computeHistograms",content:n.mixin({f:"json",geometry:JSON.stringify(Q),geometryType:M,renderingRule:JSON.stringify(R),mosaicRule:JSON.stringify(K),pixelSize:JSON.stringify(z),callbackParamName:"callback"}),handleAs:"json"});F._pendingDfd.then(function(N){F.callback(N)},function(N){F.errback(N)})}else Q=Error("Layer doesn't support computeHistograms."),
Q.log=!!e.isDebug,F.errback(Q);return F},getRenderingRuleServiceInfo:function(z,F){function M(K){return K.name&&K.arguments&&K.function&&K.hasOwnProperty("functionType")}var Q=new p._fixDfd(new t(p._dfdCanceller));if(!z)return Q.errback(Error("Rendering rule is not specified")),Q;if(M(z))"ClipFunction"===z.function.type&&(z=this._handleClipFunctionInRenderingRule(z));else{var R=this._getRenderingRuleId(z);if(R&&this._rasterFunctionTemplateInfos[R])return Q.resolve(this._rasterFunctionTemplateInfos[R]),
Q}return m({url:this._url.path,content:n.mixin(n.mixin({f:"json",renderingRule:JSON.stringify(z.toJson())},this._url.query)),callbackParamName:"callback",load:n.hitch(this,function(K){var N={};l.forEach(this._rasterFunctionServiceInfoProps,function(V){N[V]=K[V]});M(z)||(this._rasterFunctionTemplateInfos[R]=N);return N}),error:F||this._errorHandler})},queryVisibleRasters:function(z,F,M,Q){var R=this._map,K=p._fixDfd(new t(p._dfdCanceller));this._visibleRasters=[];var N,V,W=!0,L=!0,T=null,S=this.infoTemplate?
this.infoTemplate.info:null,U=S?n.clone(this.infoTemplate.info.fieldInfos):null;F=F||{};if(S&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var X=[];l.forEach(this.infoTemplate.info.mediaInfos,function(ca){X=X.concat(ca&&ca.value&&ca.value.fields||[])});X.length&&l.forEach(U,function(ca){ca&&-1<X.indexOf(ca.fieldName)&&(ca.visible=!0)})}var Y=function(ca){var oa=S&&S.title&&-1<S.title.toLowerCase().indexOf(ca.toLowerCase());ca=S&&S.description&&-1<S.description.toLowerCase().indexOf(ca.toLowerCase());
return oa||ca};if(U&&0<U.length)for(W=!1,N=0;N<U.length;N++)if((V=U[N])&&V.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(V.visible||Y(V.fieldName))){W=!0;break}this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("returnTopmostRaster")&&(T=this.infoTemplate.info.layerOptions.returnTopmostRaster?1:null);U&&0<U.length&&(L=!1,l.some(U,function(ca){if(ca&&ca.fieldName.toLowerCase()===
this._rasterFieldPrefix.toLowerCase()+"itempixelvalue"&&ca.visible)return L=!0},this),Y(this._rasterFieldPrefix.toLowerCase()+"itempixelvalue")&&(L=!0));var Z=(V=this._removeVisualizationStretchFunction(this.renderingRule))&&V.functionName,aa=[];if(10.4<=this.version){var ba=!1;if(this.rasterFunctionInfos&&U){var ia=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;l.forEach(this.rasterFunctionInfos,function(ca){var oa=ia+ca.name.replace(/ /gi,"_");l.some(U,function(ra){return ra.visible&&
ra.fieldName===oa})&&(ba=ba||Z&&Z===ca.name,aa.push(new B({rasterFunction:ca.name})))})}V&&!ba&&aa.push(V)}N=new P;N.geometry=z.geometry;N.returnGeometry=this._map.spatialReference.equals(this.spatialReference);N.returnCatalogItems=W;N.timeExtent=this.timeInfo?z.timeExtent:null;N.returnPixelValues=L;N.maxItemCount=T||z.maxItemCount;this._params.time&&this.mosaicRule?(z=n.clone(this.mosaicRule),z=this._filterOutTimeDimension(z),N.mosaicRule=z):N.mosaicRule=this.mosaicRule||null;this._isMultidimensionalCRF()&&
N.timeExtent&&(N.mosaicRule=this._applyTimeToMultidimensionalCRF(N.mosaicRule,N.timeExtent.toJson().join(",")),this._isTimeSupportedOnCRF()||delete N.timeExtent);N.renderingRule=10.4>this.version&&V||null;N.renderingRules=aa||null;10.8>this.version&&(N.returnPixelValues=void 0,N.maxItemCount=void 0);R&&(R=new w((R.extent.xmax-R.extent.xmin)/R.width,(R.extent.ymax-R.extent.ymin)/R.height,R.extent.spatialReference),N.pixelSize=R);F.requestParams=N;var da=this;R=new O(this.url);(K._pendingDfd=R.execute(N)).addCallbacks(function(ca){da._queryVisibleRastersHandler(ca,
F,M,Q,K)},function(ca){da._resolve([ca],null,Q,K,!0)});return K},_queryVisibleRastersHandler:function(z,F,M,Q,R){function K(){var ea=this.getCustomRasterFields(F),sa=this._getDomainFields(ea),xa=F?F.returnDomainValues:!1,fa=F&&F.rasterAttributeTableFieldPrefix,va,la,Aa,Ka,Ba,La,Ra,Pa,ha,Ma;ea=(ea=this._getRenderingRuleId(this.renderingRule))&&this._rasterFunctionTemplateInfos[ea];this.renderingRule&&(this._useRenderingRuleAttributeTable||ea)?(ea=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),
this.hasRasterAttributeTable||(Ma=N)):ea=this._getRasterAttributeTableFeatures();ea.then(n.hitch(this,function(Qa){for(va=0;va<da.length;va++){ma=da[va];ma.setInfoTemplate(this.infoTemplate);ma._layer=this;if(N){ha=N.replace(/ /gi,"").split(",");la=N;Aa=ha;ca&&ca.length>=va&&(la=ca[va].replace(/ /gi,", "),Aa=ca[va].split(" "));ma.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=Aa;ma.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=ha;V&&(ma.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=
V.replace(/ /gi,"").split(","));if(this.pixelFilter){var ua=new I({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});l.forEach(Aa,function(pa){ua.addData({pixels:[pa],statistics:{minValue:pa,maxValue:pa,noDataValue:null}})});this.pixelFilter({pixelBlock:ua,extent:new q(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)ma.attributes[this._rasterFieldPrefix+"Magnitude"]=ua.pixels[0][0],
ma.attributes[this._rasterFieldPrefix+"Direction"]=ua.pixels[1][0]}l.forEach(U,function(pa){ma.attributes[pa.name]=pa.value});var Na=0<this.fields.length?Ma||la:Ma||V;if(Qa&&0<Qa.length&&(Ka=l.filter(Qa,function(pa){if(pa&&pa.attributes)return pa.attributes.hasOwnProperty("Value")?pa.attributes.Value==Na:pa.attributes.VALUE==Na}),0<Ka.length&&(Ba=n.clone(Ka[0]),fa&&Ba))){Pa={};for(La in Ba.attributes)Ba.attributes.hasOwnProperty(La)&&(Ra=fa+La,Pa[Ra]=Ba.attributes[La]);Ba.attributes=Pa;ma.attributes=
n.mixin(ma.attributes,Ba.attributes)}}xa&&sa&&0<sa.length&&l.forEach(sa,function(pa){if(pa){var wa=ma.attributes[pa.name];d.isDefined(wa)&&(wa=this._getDomainValue(pa.domain,wa),d.isDefined(wa)&&(ma.attributes[pa.name]=wa))}},this);Ca.push(ma);this._visibleRasters.push(ma)}this._resolve([Ca,null,!0],null,M,R)}))}var N=z.value,V=z.value,W=0,L=0,T=this,S=this.objectIdField,U=[];Q=F.requestParams.renderingRules;var X=z.processedValues,Y=this.renderingRule&&k.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());
if(Q&&X&&Q.length===X.length){var Z=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;l.forEach(Q,function(ea,sa){if(ea.functionName){var xa={name:Z+ea.functionName.replace(/ /gi,"_"),value:X[sa].replace(/ /gi,"").split(",")};U.push(xa);Y&&Y===k.toJson(ea.toJson())&&(N=X[sa])}})}Q=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(z.catalogItems){var aa=
0,ba=z.catalogItems.features.length;var ia=0;var da=Array(ba);var ca=Array(ba);var oa=Array(ba);if(z.properties&&z.properties.Values){ba=z.properties.Values.length;for(W=0;W<ba;W++)-1<z.properties.Values[W].toLowerCase().indexOf("nodata")&&ia++;var ra=ba-ia;for(W=0;W<ba;W++){ia=!0;if(-1<z.properties.Values[W].toLowerCase().indexOf("nodata")){var ja=ra++;Q||(ia=!1,da.length--,ca.length--,oa.length--)}else ja=aa++;ia&&(da[ja]=z.catalogItems.features[W],ca[ja]=z.properties.Values[W],oa[ja]=da[ja].attributes[S])}}else{for(W=
0;W<ba;W++)da[W]=z.catalogItems.features[W],oa[W]=da[W].attributes[S];ca=null}}this._visibleRasters=[];(z=-1<N.toLowerCase().indexOf("nodata"))&&!Q&&(da=[],ca=[],oa=[]);if(N&&!da&&!z){S="ObjectId";da=[];var ma=new J(new q(this.fullExtent),null,{ObjectId:0});da.push(ma)}var Ca=[];da?!this._map.spatialReference.equals(this.spatialReference)&&oa&&0<oa.length?m({url:this._url.path+"/query",content:{f:"json",objectIds:oa.join(","),returnGeometry:!0,outSR:k.toJson(T._map.spatialReference.toJson()),outFields:S},
handleAs:"json",callbackParamName:"callback",load:function(ea){if(0===ea.features.length)T._resolve([Ca,null,null],null,M,R);else{for(W=0;W<ea.features.length;W++)for(L=0;L<da.length;L++)da[L].attributes[S]==ea.features[W].attributes[S]&&(da[L].geometry=new y(ea.features[W].geometry),da[L].geometry.setSpatialReference(T._map.spatialReference));K.call(T)}},error:function(ea){T._resolve([Ca,null,null],null,M,R)}}):K.call(this):this._resolve([Ca,null,null],null,M,R)},getVisibleRasters:function(){var z=
this._visibleRasters,F=[],M;for(M in z)z.hasOwnProperty(M)&&F.push(z[M]);return F},_getDomainFields:function(z){if(z){var F=[];l.forEach(z,function(M){if(M.domain){var Q={};Q.name=M.name;Q.domain=M.domain;F.push(Q)}});return F}},_getDomainValue:function(z,F){if(z&&z.codedValues){var M;l.some(z.codedValues,function(Q){return Q.code===F?(M=Q.name,!0):!1});return M}},_requestData:function(z,F,M){this._rasterReadPromise&&this._rasterReadPromise.cancel();z=n.clone(z);var Q=z._normalize(!0);this._prepareGetImageParameters(Q,
F,M);F=n.clone(this._params);this._cleanupRequestParams(F);F.extent=z;F.format=F.format||(10.3<=this.version?"lerc":"jpgpng");"lerc"===F.format.toLowerCase()&&!F.lercVersion&&10.5<=this.version&&(F.lercVersion=2);this._params.time&&this._isMultidimensionalCRF()&&!this._isTimeSupportedOnCRF()&&delete F.time;M=null;this._useBrowserDecoding()&&(M=new r({ctx:this._context}));F={imageServiceParameters:F,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:M?n.hitch(M,"decode"):null};this._rasterReadPromise=
this.raster.read(F,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(z){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=z,this.hasDataChanged=!0,this._setPixelData(z))},_setPixelData:function(z){z=this._clonePixelData(z);this.pixelFilter&&this.pixelFilter(z);this.pixelData=z;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this._drawPixelData(),this._rasterReadPromise=null)},_clonePixelData:function(z){if(null===
z||void 0===z)return z;var F={};z.extent&&(F.extent=n.clone(z.extent));z=z.pixelBlock;if(null===z||void 0===z)return F;F.pixelBlock=z.clone();return F},_setDefaultFilter:function(){},_getPixelBlockFromCanvas:function(z,F,M){z=z.getImageData(0,0,F,M).data;var Q=F*M,R=0,K=0,N=new Uint8Array(Q),V=new Uint8Array(Q),W=new Uint8Array(Q),L=new Uint8Array(Q),T=Infinity,S=Infinity,U=Infinity,X=-Infinity,Y=-Infinity,Z=-Infinity;for(R=0;R<Q;R++){var aa=z[K++];var ba=z[K++];var ia=z[K++];T=T<aa?T:aa;X=X>aa?X:
aa;S=S<ba?S:ba;Y=Y>ba?Y:ba;U=U<ia?U:ia;Z=Z>ia?Z:ia;N[R]=aa;V[R]=ba;W[R]=ia;L[R]=z[K++]&1}return new I({width:F,height:M,pixels:[N,V,W],pixelType:"U8",mask:L,statistics:[{minValue:T,maxValue:X},{minValue:S,maxValue:Y},{minValue:U,maxValue:Z}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var z=this._url.path+
"/multiDimensionalInfo",F=new t(p._dfdCanceller);if(this._multidimensionalInfo)return F.resolve(this._multidimensionalInfo),F;!this.loaded||10.3<=this.version&&this.hasMultidimensions?(F._pendingDfd=m({url:z,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),F._pendingDfd.then(n.hitch(this,function(M){this._multidimensionalInfo=M.multidimensionalInfo;F.callback(M.multidimensionalInfo)}),function(M){F.errback(M)})):(z=Error("Layer does not support multidimensional info"),z.log=!!e.isDebug,
F.errback(z));return F},getStatistics:function(z){var F=new t(p._dfdCanceller);if(z&&this._cachedVariableStats[z])F.resolve(this._cachedVariableStats[z]);else{var M={f:"json"};z&&(M.variable=z);F._pendingDfd=m({url:this._url.path+"/statistics",content:M,handleAs:"json",callbackParamName:"callback"});F._pendingDfd.then(n.hitch(this,function(Q){Q=Q.statistics||Q.statitsics;var R=[];Q&&Q[0]&&null!=Q[0].min?Q.forEach(function(K){R.push([K.min,K.max,K.mean,K.standardDeviation])}):R=this.minValues&&this.minValues.length?
this.minValues.map(function(K,N){return[K,this.maxValues[N],this.meanValues[N],this.stdvValues[N]]}.bind(this)):Q;z&&(this._cachedVariableStats[z]=R);F.callback(R)}),function(Q){F.errback(Q)})}return F},getDefaultMultidimensionalDefinition:function(){var z=new t(p._dfdCanceller);if(this._defaultMultidimensionalDefinition)return z.resolve(n.clone(this._defaultMultidimensionalDefinition)),z;z._pendingDfd=this.getMultidimensionalInfo();z._pendingDfd.then(n.hitch(this,function(F){F=this._getDefaultMultidimensionalDefinition(F);
z.callback(F)}),function(F){z.errback(F)});return z},_getDefaultMultidimensionalDefinition:function(z,F,M){var Q,R=[],K=this.defaultVariable||"",N=K.length?z.variables.filter(function(V){return V.name===K})[0].dimensions:z.variables[0].dimensions;M&&(K=this.defaultVariable||z.variables[0].name);for(Q in N)N.hasOwnProperty(Q)&&(F||"StdTime"!==N[Q].name)&&(z=N[Q],R.push(new C({variableName:K,dimensionName:z.name,isSlice:!z.hasRanges,values:[this._getDefaultDimensionValue(z)]})));this._defaultMultidimensionalDefinition=
R;return n.clone(R)},_getDefaultDimensionValue:function(z){if(z&&z.values&&z.values.length){var F=Infinity,M;if(z.hasRanges)return z.values[0];if(z.name&&"stdz"===z.name.toLowerCase()){for(M=0;M<z.values.length;M++){var Q=z.values[M];var R=Math.abs(Q-0);if(R<F){F=R;var K=Q}if(0===R)break}return K}return z.extent[0]}},_setDefaultMultidimensionalDefinition:function(z){var F,M={};this.getDefaultMultidimensionalDefinition().then(n.hitch(this,function(Q){F=Q;0<F.length&&(this.mosaicRule?(M=n.clone(this.mosaicRule),
M.multidimensionalDefinition=F):this.defaultMosaicRule?(M=n.clone(this.defaultMosaicRule),M.multidimensionalDefinition=F):M=new E({multidimensionalDefinition:F}),this.setMosaicRule(M,z))}))},_setDefaultRenderingRule:function(z){var F={},M=this.renderingRule;if(!M&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&!this.bandIds&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())F.rasterFunction=this.rasterFunctionInfos[0].name;
else if("esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version&&(!M||"Resample"!==M.functionName)){var Q="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;F.rasterFunction="Resample";F.rasterFunctionArguments={ResamplingType:Q,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}};M&&(F.rasterFunctionArguments.Raster=M.toJson())}F.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new B(F),this.setRenderingRule(this.defaultRenderingRule,z))},_cleanupRequestParams:function(z){if(!z)return z;
if(z.time&&z.mosaicRule){var F=new E(k.fromJson(z.mosaicRule));F=this._filterOutTimeDimension(F);z.mosaicRule=k.toJson(F.toJson())}F="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent renderer".split(" ");for(var M in F)z.hasOwnProperty(F[M])&&delete z[F[M]];return z},_filterOutTimeDimension:function(z){if(this._isMultidimensionalCRF())return z;if(z&&z.multidimensionalDefinition&&0<z.multidimensionalDefinition.length){var F=l.filter(z.multidimensionalDefinition,
function(M){return"StdTime"!==M.dimensionName});z.multidimensionalDefinition=F}return z},_removeVisualizationStretchFunction:function(z){var F=z&&z.functionName;if(!F||"stretch"!==F.toLowerCase())return z;var M=z.functionArguments.Raster;return M&&M.functionName&&l.some(this.rasterFunctionInfos,function(Q){return M.functionName===Q.name})?M:z},_isMultidimensionalCRF:function(){return 10.71<=this.version&&this.hasMultidimensions&&this.timeInfo&&!(this.objectIdField&&this.fields&&1<this.fields.length)},
_isTimeSupportedOnCRF:function(){return 10.8<=this.version},_cleanupMultidimensionalDefinition:function(z){z&&z.multidimensionalDefinition&&(z.multidimensionalDefinition=z.multidimensionalDefinition.filter(function(F){return!(!F.variableName&&!F.dimensionName)}),0===z.multidimensionalDefinition.length&&(z.multidimensionalDefinition=null))},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||
"esriImageServiceDataTypeScientific"===this.serviceDataType||this.hasMultidimensions},_isVectorData:function(z){z=(z=z||this)&&z.serviceDataType;return"esriImageServiceDataTypeVector-UV"===z||"esriImageServiceDataTypeVector-MagDir"===z},_isRenderingRuleAProcessingTemplate:function(z){var F=z&&z.functionName;return!F||z.functionArguments?!1:l.some(F&&(this.rasterFunctionInfos||[]),function(M){return M&&M.name&&M.name.toLowerCase()===F.toLowerCase()})},_getRenderingRuleId:function(z){var F=z&&z.functionName;
if(F){if(this._isRenderingRuleAProcessingTemplate(z))return F;var M=this._customRenderingRuleId[F];if(M){if(M!==z){for(var Q in this._customRenderingRuleId)if(this._customRenderingRuleId[Q]===z)return Q;for(M=0;this._customRenderingRuleId[R];)M+=1;var R;this._customRenderingRuleId[F+M]=z}}else this._customRenderingRuleId[F]=z;return F}},_createPixelData:function(z){z=new I({width:2,height:2,pixels:z,pixelType:this.pixelType,statistics:z});var F=this.fullExtent.getCenter();F=new q(F.x,F.y,F.x+this.pixelSizeX,
F.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:z,extent:F}},_convertRendererToRenderingRule:function(z){var F=z&&z.declaredClass;if(!F||"esri.renderer.UniqueValueRenderer"!==F&&"esri.renderer.ClassBreaksRenderer"!==F&&"esri.renderer.StretchRenderer"!==F&&"esri.renderer.ShadedReliefRenderer"!==F&&"esri.renderer.ColormapRenderer"!==F)return null;var M=null;"esri.renderer.StretchRenderer"===F?M=z.toRenderingRule({convertToColormap:10.6>this.version}):"esri.renderer.ClassBreaksRenderer"===
F?M=this._convertClassifyRenderer(z):"esri.renderer.UniqueValueRenderer"===F?M=this._convertUniqueValueRenderer(z):"esri.renderer.ShadedReliefRenderer"===F?M=this._convertShadedReliefRenderer(z):"esri.renderer.ColormapRenderer"===F&&(M=this._convertColormapRenderer(z));return M},_getValueField:function(z){if(z&&z.length){var F,M;l.some(z,function(Q){if((M=Q.name)&&"value"===M.toLowerCase())return F=M,!0});return F}},_convertColormapRenderer:function(z){var F=new B;F.functionName="Colormap";F.functionArguments=
{};z=z.colormapInfos.map(function(M){return[M.value].concat(M.color)});F.functionArguments.Colormap=z;return F},_convertShadedReliefRenderer:function(z){var F=new B;F.functionName="Hillshade";var M="traditional"===z.hillshadeType?0:1,Q="none"===z.scalingType?1:3,R={HillshadeType:M,SlopeType:Q,ZFactor:z.zFactor};0===M&&(R.Azimuth=z.azimuth,R.Altitude=z.altitude);3===Q&&(R.PSPower=z.pixelSizePower,R.PSZFactor=z.pixelSizeFactor);F.functionArguments=R;F.variableName="Raster";z.colorRamp&&(F.functionName=
"ShadedRelief",R.Colormap=x.convertColorRampToColormap(z.colorRamp,256));return F},_convertClassifyRenderer:function(z){var F=[],M=[],Q=[],R=[],K;var N=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);var V=this.hasRasterAttributeTable;if(N){V=this._rasterFunctionTemplateInfos[N]?this._rasterFunctionTemplateInfos[N].hasRasterAttributeTable:this.hasRasterAttributeTable;var W=this._renderingRuleAttributeTable[N];var L=this._rasterFunctionTemplateInfos[N]}var T=W&&W.features?W.features:
this._rasterAttributeTableFeatures;var S=this._getValueField(W&&W.fields?W.fields:this._rasterAttributeTableFields);V&&T?(l.forEach(z.infos,function(U,X){var Y,Z=U.symbol.color;Z.a&&l.forEach(T,function(aa){Y=aa.attributes[z.attributeField];(Y>=U.minValue&&Y<U.maxValue||X===z.infos.length-1&&Y>=U.minValue)&&R.push([aa.attributes[S],Z.r,Z.g,Z.b])},this)},this),N=L&&L.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(R,N),N=new B,N.functionName="Colormap",N.functionArguments={},N.functionArguments.Colormap=
R,N.variableName="Raster"):(l.forEach(z.infos,function(U,X){K=U.symbol&&U.symbol.color;K.a?(0===X?F.push.call(F,U.minValue,U.maxValue+1E-4):F.push.call(F,U.minValue+1E-4,U.maxValue+1E-4),M.push(X),R.push([X,K.r,K.g,K.b])):Q.push(U.minValue,U.maxValue)}),N=L&&L.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(R,N),N=new B,N.functionName="Remap",N.functionArguments={InputRanges:F,OutputValues:M,NoDataRanges:Q},N.variableName="Raster",W=new B,W.functionName="Colormap",W.functionArguments=
{Colormap:R,Raster:N},N=W);return N},_convertUniqueValueRenderer:function(z){var F=[],M=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);if(M){var Q=this._renderingRuleAttributeTable[M];var R=this._rasterFunctionTemplateInfos[M]}var K=Q&&Q.features?Q.features:this._rasterAttributeTableFeatures;var N=(M=Q&&Q.fields?Q.fields:this._rasterAttributeTableFields)&&M.length?this._getValueField(M):"Value";l.forEach(z.infos,function(V){var W=V.symbol.color;W.a&&(z.attributeField!==N&&K?l.forEach(K,
function(L){L.attributes[z.attributeField]==V.value&&F.push([L.attributes[N],W.r,W.g,W.b])},this):F.push([V.value,W.r,W.g,W.b]))},this);this._adjustColormapToPixelTypeRange(F,R&&R.pixelType||this.pixelType);R=new B;R.functionName="Colormap";R.functionArguments={};R.functionArguments.Colormap=F;R.variableName="Raster";return R},_adjustColormapToPixelTypeRange:function(z,F){(F=this._pixelTypeRanges[F])&&z.push([Math.floor(F[0]-1),0,0,0],[Math.ceil(F[1]+1),0,0,0]);return z},_combineRenderingRule:function(z,
F){if(!z||!F)return z||F;var M=function(Q){var R=Q.Raster;return R=R&&"esri.layers.RasterFunction"===R.declaredClass?M(R.functionArguments):Q};z=n.clone(z);"none"!==F.functionName.toLocaleLowerCase()&&(M(z.functionArguments).Raster=F);return z},_isItemLevelRasterFunction:function(z){var F=z&&z.functionName;if(!F||!this._hasItemLevelRFT)return!1;var M=!1;l.some(this.rasterFunctionInfos,function(Q){if(Q&&Q.name===F){if(1===Q.functionType||2===Q.functionType)M=!0;return!0}});return M},_getServiceLevelRenderingRule:function(z){if(!this._hasItemLevelRFT||
!z)return z;z=new B(z.toJson());var F=z.functionArguments;for(var M;;)if((M=F&&F.Raster)&&M.functionArguments&&M.functionArguments.Raster)F=M,F=F.functionArguments;else{this._isItemLevelRasterFunction(M)&&delete F.Raster;break}return z},_getItemLevelRenderingRule:function(z){if(!this._hasItemLevelRFT||!z)return null;if(this._isItemLevelRasterFunction(z))return z;z=new B(z.toJson());for(z=z.functionArguments;;)if((z=z&&z.Raster)&&z.functionArguments&&z.functionArguments.Raster)z=z.functionArguments;
else{if(this._isItemLevelRasterFunction(z))return z;break}},_resolve:function(z,F,M,Q,R){F&&this[F].apply(this,z);M&&M.apply(null,z);Q&&p._resDfd(Q,z,R)},_toggleTime:function(){var z=this._map;this.timeInfo&&this.useMapTime&&z&&!this.suspended?(this._timeConnect||(this._timeConnect=c.connect(z,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(z.timeExtent)):(c.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(z,F){this.useMapTime=
z;this._toggleTime();!F&&this._map&&this.refresh(!0)},_setTime:function(z){this._params&&(this._params.time=z?z.toJson().join(","):null)},_onTimeExtentChangeHandler:function(z){this.suspended||(this._setTime(z),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()},getColormap:function(z){var F=this._url.path+"/colormap",M=new t(p._dfdCanceller),Q={f:"json"};z&&z.renderingRule&&(Q.renderingRule=k.toJson(z.renderingRule.toJson()));this.hasColormap?(M._pendingDfd=
m({url:F,content:Q,handleAs:"json",callbackParamName:"callback"}),M._pendingDfd.then(function(R){M.callback(R)},function(R){M.errback(R)})):(z=Error("Layer does not support colormap"),z.log=!!e.isDebug,M.errback(z));return M},getRenderingRuleColormap:function(z){var F=new t(p._dfdCanceller);if(!z||!z.renderingRule)return F.errback(Error("Rendering rule is not specified")),F;z=z.renderingRule;var M=this._getRenderingRuleId(z);this._renderingRuleColormap&&M&&this._renderingRuleColormap.hasOwnProperty(M)?
F.resolve(this._renderingRuleColormap[M]):F=this.getColormap({renderingRule:z}).then(n.hitch(this,function(Q){Q=Q&&Q.colormap;M&&(this._renderingRuleColormap[M]=Q);return Q}));return F},_handleClipFunctionInRenderingRule:function(z){z=n.clone(z);var F=z.arguments,M=F.ClippingGeometry&&F.ClippingGeometry.value,Q=F.Extent&&F.Extent.value;F.ClippingRaster&&F.ClippingRaster.value||M||Q||(F=this._map.extent.toJson(),z.arguments.Extent.value=F,z.functionArguments.Extent.value=F,z._isTemplate&&(z._templateJson.arguments.Extent.value=
F));return z}});a("extend-esri")&&n.setObject("layers.ImageServiceLayerMixin",H,g);return H})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point ./RasterFunction".split(" "),function(H,n,t,l,k,e,c){var a=H(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],itemRenderingRule:null,
constructor:function(b){n.isObject(b)&&(n.mixin(this,b),b.mosaicMethod&&(this.method=b.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),b.mosaicOperation&&(this.operation=b.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),b.fids&&(this.objectIds=b.fids),b.viewpoint&&(this.viewpoint=new e(b.viewpoint)),b.itemRenderingRule&&(this.itemRenderingRule=
new c(b.itemRenderingRule)),this.multidimensionalDefinition=b.multidimensionalDefinition||[])},toJson:function(){var b=null,f=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(f){b=[];for(var g=0;g<f;g++)b.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[g].declaredClass?this.multidimensionalDefinition[g].toJson():this.multidimensionalDefinition[g])}b={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,
lockRasterIds:n.clone(this.lockRasterIds),viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:n.clone(this.objectIds),mosaicOperation:this.operation,multidimensionalDefinition:b,itemRenderingRule:this.itemRenderingRule?this.itemRenderingRule.toJson():null};return k.filter(b,function(h){if(null!==h)return!0})},_getMethodEnum:function(b){if(b){var f=a.METHOD_NONE;switch(b.toLowerCase()){case "byattribute":f=a.METHOD_ATTRIBUTE;break;case "center":f=a.METHOD_CENTER;break;case "lockraster":f=a.METHOD_LOCKRASTER;
break;case "nadir":f=a.METHOD_NADIR;break;case "northwest":f=a.METHOD_NORTHWEST;break;case "seamline":f=a.METHOD_SEAMLINE;break;case "viewpoint":f=a.METHOD_VIEWPOINT}return f}},_getOperatorEnum:function(b){if(b)switch(b.toLowerCase()){case "first":return a.OPERATION_FIRST;case "last":return a.OPERATION_LAST;case "max":return a.OPERATION_MAX;case "min":return a.OPERATION_MIN;case "blend":return a.OPERATION_BLEND;case "mean":return a.OPERATION_MEAN;case "sum":return a.OPERATION_SUM}}});n.mixin(a,{METHOD_NONE:"esriMosaicNone",
METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});t("extend-esri")&&n.setObject("layers.MosaicRule",a,l);return a})},
"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(H,n,t,l,k){H=H(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(e){n.isObject(e)&&n.mixin(this,e)},toJson:function(){var e={variableName:this.variableName,dimensionName:this.dimensionName,values:n.clone(this.values),isSlice:this.isSlice};return k.filter(e,function(c){return null!==
c})}});t("extend-esri")&&n.setObject("layers.DimensionalDefinition",H,l);return H})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q){var w,y,x,E,B,C;n=n(f,{declaredClass:"esri.layers.Raster",
imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(u){this.imageServiceUrl=u;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(u,A,J){var O=this,P=new l(m._dfdCanceller);if(10>a("ie"))throw"This browser is not supported.";if(!u.imageServiceParameters)throw"Insufficient parameters to read data";
var z=t.clone(u.imageServiceParameters),F=u.pixelType;k.some(this.validPixelTypes,function(V){return V===F})||(z.pixelType="F32");k.some(this.validFormats,function(V){return V.toLowerCase()===z.format.toLowerCase()})||(z.format="lerc");var M=u.decodeFunc,Q;this._prepareGetImageParameters(z);var R=z.width,K=z.height,N=z.extent;delete z.width;delete z.height;delete z.extent;P._pendingDfd=g({url:this.imageServiceUrl+"/exportImage",handleAs:"arraybuffer",content:t.mixin(z,{f:"image"}),load:function(V){O.decode(V,
{width:R,height:K,planes:null,pixelType:F,noDataValue:z.noData,format:z.format,decodeFunc:M}).then(function(W){Q={pixelBlock:W,extent:N};O._resolve([Q,z],"onRasterReadComplete",A,P)},function(W){O._resolve([W],null,J,P,!0)})},error:function(V){O._resolve([V],null,J,P,!0)}});return P.promise},decode:function(u,A){if(void 0===A||null===A)throw"missing decode options";var J;A.format&&(J=A.format.toUpperCase());"BSQ"!==J&&"BIP"!==J&&(J=this._getFormat(u));var O=A.decodeFunc;if(void 0===O||null===O)O=
this._getFormatDecoderDfd(J);return O(u,A)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(u){if(u.size&&u.bbox){var A=u.size.split(",");u.width=parseFloat(A[0]);u.height=parseFloat(A[1]);u.extent||(A=u.bbox.split(","),u.extent=new h(parseFloat(A[0]),parseFloat(A[1]),parseFloat(A[2]),parseFloat(A[3]),new d(u.bboxSR)))}else{if(!u.width||Math.floor(u.width)!==u.width||!u.height||Math.floor(u.height)!==u.height)throw"Incorrect Image Dimensions";if(!u.extent||"esri.geometry.Extent"!==
u.extent.declaredClass)throw"Incorrect extent";A=u.extent;var J=A.spatialReference.wkid||c.toJson(A.spatialReference.toJson());delete u._ts;t.mixin(u,{bbox:A.xmin+","+A.ymin+","+A.xmax+","+A.ymax,imageSR:J,bboxSR:J,size:u.width+","+u.height},u.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(u,A,J){var O=u.ymax-u.ymin,P=u.xmax-u.xmin;J>=A?u.ymax=u.ymin+P*A/J:u.xmax=u.xmin+O*J/A;return u},_resolve:function(u,A,J,O,P){A&&this[A].apply(this,u);J&&J.apply(null,u);O&&m._resDfd(O,
u,P)},_getFormatDecoderDfd:function(u){var A=null;switch(u){case "LERC":A=this._decodeLerc;break;case "LERC2":A=this._decodeLerc2;break;case "JPEG":A=this._decodeJpeg;break;case "PNG":A=this._decodePng;break;case "BSQ":A=this._decodeBsq;break;case "BIP":A=this._decodeBip;break;case "TIFF":A=this._decodeTiff;break;default:A=function(J,O){throw"The raster format is not supported";}}A=t.hitch(this,A);return function(J,O){var P=new l;try{if("LERC"===u||!0===B){var z=A(J,O);P.resolve(z)}else C.then(function(){z=
A(J,O);P.resolve(z)})}catch(F){P.reject(F)}return P}},_getFormat:function(u){u=new Uint8Array(u,0,10);var A="";if(255===u[0]&&216===u[1])A="JPEG";else if(137===u[0]&&80===u[1]&&78===u[2]&&71===u[3])A="PNG";else if(67===u[0]&&110===u[1]&&116===u[2]&&90===u[3]&&73===u[4]&&109===u[5]&&97===u[6]&&103===u[7]&&101===u[8]&&32===u[9])A="LERC";else if(76===u[0]&&101===u[1]&&114===u[2]&&99===u[3]&&50===u[4]&&32===u[5])A="LERC2";else if(-1<String.fromCharCode.apply(null,u).toLowerCase().indexOf("error"))A="ERROR";
else if(73===u[0]&&73===u[1]&&42===u[2]&&0===u[3]||77===u[0]&&77===u[1]&&0===u[2]&&42===u[3])A="TIFF";return A},_validateDecodeParams:function(u){if(!u.height||Math.floor(u.height)!==u.height)throw"Height not provided.";if(!u.width||Math.floor(u.width)!==u.width)throw"Width not provided.";},_decodeJpeg:function(u,A){if(!w)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(A);u=(new w).decode(u);if(!r(u,A))throw"The decoded image dimensions are incorrect.";A=[];var J;for(J=0;J<
u.pixels.length;J++){var O=u.pixels[J];A.push(this._calculateBandStatistics(O))}return new p({width:u.width,height:u.height,pixels:u.pixels,pixelType:"U8",mask:u.mask,statistics:A})},_decodePng:function(u,A){if(!y)throw"The png decoder module is not loaded.";this._validateDecodeParams(A);u=new Uint8Array(u);var J=new y(u);u=new Uint8Array(A.width*A.height*4);J.copyToImageData(u,J.decodePixels());var O=J=0;O=new Uint8Array(A.width*A.height);for(J=0;J<A.width*A.height;J++)O[J]=u[4*J+3];var P=new p({width:A.width,
height:A.height,pixels:[],pixelType:"U8",mask:O,statistics:[]});for(J=0;3>J;J++){var z=new Uint8Array(A.width*A.height);for(O=0;O<A.width*A.height;O++)z[O]=u[4*O+J];P.addData({pixels:z,statistics:this._calculateBandStatistics(z)})}return P},_decodeBsq:function(u,A){if(!x)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(A);I=A.noDataValue;A.pixelType=D(A.pixelType);u=x.decodeBSQ(u,{bandCount:A.planes,width:A.width,height:A.height,pixelType:G,noDataValue:I});var J=[],O,P=null;
for(O=0;O<u.pixels.length;O++)P=u.pixels[O],J.push(this._calculateBandStatistics(P));return new p({width:A.width,height:A.height,pixels:u.pixels,pixelType:A.pixelType,mask:u.maskData,statistics:J})},_decodeBip:function(u,A){this._validateDecodeParams(A);I=A.noDataValue;A.pixelType=D(A.pixelType);u=x.decodeBIP(u,{bandCount:A.planes,width:A.width,height:A.height,pixelType:G,noDataValue:I});var J=[],O,P=null;for(O=0;O<u.pixels.length;O++)P=u.pixels[O],J.push(this._calculateBandStatistics(P));return new p({width:A.width,
height:A.height,pixels:u.pixels,pixelType:A.pixelType,mask:u.maskData,statistics:J})},_decodeTiff:function(u,A){this._validateDecodeParams(A);I=A.noDataValue;A.pixelType=D(A.pixelType);u=E.decode(u);A=[];var J,O=null;for(J=0;J<u.pixels.length;J++)O=u.pixels[J],A.push(this._calculateBandStatistics(O,u.maskData));return new p({width:u.width,height:u.height,pixels:u.pixels,pixelType:u.pixelType,mask:u.maskData,statistics:A})},_decodeLerc:function(u,A){this._validateDecodeParams(A);I=A.noDataValue;A.pixelType=
D(A.pixelType);for(var J=0,O,P=0,z,F=u.byteLength-10;P<F;){var M=v.decode(u,{inputOffset:P,encodedMaskData:O,returnMask:0===J?!0:!1,returnEncodedMask:0===J?!0:!1,returnFileInfo:!0,pixelType:G,noDataValue:I});P=M.fileInfo.eofOffset;0===J&&(O=M.encodedMaskData,z=new p({width:A.width,height:A.height,pixels:[],pixelType:A.pixelType,mask:M.maskData,statistics:[]}));J++;if(!r(M,A))throw"The decoded image dimensions are incorrect";z.addData({pixels:M.pixelData,statistics:{minValue:M.minValue,maxValue:M.maxValue,
noDataValue:M.noDataValue}})}return z},_decodeLerc2:function(u,A){this._validateDecodeParams(A);I=A.noDataValue;A.pixelType=D(A.pixelType);for(var J=0,O,P,z=0,F,M=u.byteLength-10,Q=[];z<M;){P=q.decode(u,{inputOffset:z,maskData:O,returnFileInfo:!0});z=P.fileInfo.eofOffset;0===J&&(O=P.maskData,F=new p({width:A.width,height:A.height,pixels:[],pixelType:P.fileInfo.pixelType,mask:P.maskData,statistics:[]}));P.fileInfo.mask&&0<P.fileInfo.mask.numBytes&&Q.push(P.maskData);J++;if(!r(P,A))throw"The decoded image dimensions are incorrect";
if(1<P.dimCount&&P.pixelData&&P.pixelData.length===P.width*P.height*P.dimCount){P.pixelData=P.pixelData.slice(-P.width*P.height);var R=P.dimStats&&P.dimStats.minValues&&P.dimStats.minValues[P.dimCount-1],K=P.dimStats&&P.dimStats.maxValues&&P.dimStats.maxValues[P.dimCount-1];null!=R&&null!=K&&(P.minValue=R,P.maxValue=K)}F.addData({pixels:P.pixelData,statistics:{minValue:P.minValue,maxValue:P.maxValue,noDataValue:P.noDataValue}})}if(1<Q.length){P=F.width*F.height;F.bandMasks=Q;O=new Uint8Array(P);O.set(Q[0]);
for(A=1;A<Q.length;A++)for(u=Q[A],J=0;J<P;J++)O[J]&=u[J];F.maskData=O}return F},_calculateBandStatistics:function(u,A){var J=Infinity,O=-Infinity,P=u.length,z,F=0;if(A)for(z=0;z<P;z++)A[z]&&(F=u[z],J=F<J?F:J,O=F>O?F:O);else for(z=0;z<P;z++)F=u[z],J=F<J?F:J,O=F>O?F:O;return{minValue:J,maxValue:O}},_loadRasterFormatModules:function(){B||(C||(C=new l),10>a("ie")?C.isRejected()||C.reject("unsupported browser version"):H(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder",
"./rasterFormats/Zlib"],function(u,A,J,O){w=u;y=A;x=J;E=O;B=!0;C.isResolved()||C.resolve(!0)}))}});var G=null,I=null,D=function(u){if("U1"===u||"U2"===u||"U4"===u||"U8"===u)return I=Math.pow(2,8)-1,G=Uint8Array,"U8";"U16"===u?(I=I||Math.pow(2,16)-1,G=Uint16Array):"U32"===u?(I=I||Math.pow(2,32)-1,G=Uint32Array):"S8"===u?(I=I||0-Math.pow(2,7),G=Int8Array):"S16"===u?(I=I||0-Math.pow(2,15),G=Int16Array):"S32"===u?(I=I||0-Math.pow(2,31),G=Int32Array):G=Float32Array;return u},r=function(u,A){return u.height!==
A.height||u.width!==A.width?!1:!0};a("extend-esri")&&t.setObject("layers.Raster",n,b);return n})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(H,n,t,l){H=H([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],maskIsAlpha:!1,validPixelCount:null,constructor:function(k){if(k){if(!k.width||Math.floor(k.width)!==k.width)throw"PixelBlock: incorrect width";if(!k.height||
Math.floor(k.height)!==k.height)throw"PixelBlock: incorrect height";if(!k.pixels)throw"PixelBlock: pixel data not present";this.width=k.width;this.height=k.height;this.pixels=k.pixels;this.pixelType=k.pixelType||null;this.statistics=k.statistics;this.mask=k.mask||null;this.maskIsAlpha=k.maskIsAlpha||!1;k=k.validPixelCount;null==k&&(k=this.mask?this._getValidPixelCount(this.mask):this.width*this.height);this.validPixelCount=k}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?
console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(k){if(!k.pixels||!k.statistics)throw"Pixel data or statistics are not present";if(k.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(k.statistics);this.pixels.push(k.pixels)},getAsRGBA:function(){var k=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(k);
break;default:this._fillFrom8Bit(k)}return new Uint8ClampedArray(k)},getAsRGBAFloat:function(){var k=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(k);return k},clone:function(k){k=k||this;var e=new this.constructor;e.width=k.width;e.height=k.height;e.pixelType=k.pixelType;e.maskIsAlpha=k.maskIsAlpha;k.mask&&(e.mask=new Uint8Array(k.mask));var c,a;if(k.pixels){e.pixels=[];var b=(a=k.pixels.length)&&k.pixels[0].slice;for(c=0;c<a;c++)e.pixels[c]=b?k.pixels[c].slice(0,k.pixels[c].length):
new k.pixels[c].constructor(k.pixels[c])}if(k.statistics)for(e.statistics=[],a=k.statistics.length,c=0;c<a;c++)e.statistics[c]=n.clone(k.statistics[c]);k=k.validPixelCount;null==k&&(k=e.mask?this._getValidPixelCount(e.mask):e.width*e.height);return e},clamp:function(k){if("F64"!==k&&"F32"!==k){switch(k){case "U8":var e=[0,255];break;case "U16":e=[0,65535];break;case "U32":e=[0,4294967295];break;case "S8":e=[-128,127];break;case "S16":e=[-32768,32767];break;case "S32":e=[-2147483648,2147483647];break;
default:e=[-3.4*1E39,3.4*1E39]}var c=e[0];e=e[1];var a=this.pixels,b=this.width*this.height,f=a.length,g,h,d=[];for(g=0;g<f;g++){var m=this._createEmptyBand(k,b);var p=a[g];for(h=0;h<b;h++){var v=p[h];m[h]=v>e?e:v<c?c:v}d.push(m)}this.pixels=d;this.pixelType=k}},calculateStatistics:function(){var k,e=[],c=this.mask;for(k=0;k<this.pixels.length;k++){var a=this.pixels[k];e.push(this._calculateBandStatistics(a,c))}this.statistics=e},_getValidPixelCount:function(k){var e,c=0;for(e=0;e<k.length;e++)k[e]&&
c++;return c},_createEmptyBand:function(k,e){switch(k){case "U8":k=new Uint8Array(e);break;case "U16":k=new Uint16Array(e);break;case "U32":k=new Uint32Array(e);break;case "S8":k=new Int8Array(e);break;case "S16":k=new Int16Array(e);break;case "S32":k=new Int32Array(e);break;case "U32":k=new Uint32Array(e);break;case "F32":k=new Float32Array(e);break;case "F64":k=new Float64Array(e);break;default:k=new Float32Array(e)}return k},_fillFrom8Bit:function(k){var e=this.pixels,c=this.mask;if(!k||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var a,b;var f=a=b=e[0];3<=e.length&&(a=e[1],b=e[2]);e=new Uint32Array(k);var g=this.width*this.height;if(f.length!==g)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(c&&c.length===g)if(this.maskIsAlpha)for(k=0;k<g;k++)c[k]&&(e[k]=c[k]<<24|b[k]<<16|a[k]<<8|f[k]);else for(k=0;k<g;k++)c[k]&&(e[k]=-16777216|b[k]<<16|a[k]<<8|f[k]);else for(k=0;k<g;k++)e[k]=-16777216|b[k]<<16|a[k]<<8|f[k]},_fillFromNon8Bit:function(k){var e=this.pixels,c=this.mask,a=this.statistics;if(!k||
!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var b=1,f=0;b=1;a&&0<a.length?(f=a.map(function(m){return m.minValue}).reduce(function(m,p){return Math.min(m,p)}),b=a.map(function(m){return m.maxValue-m.minValue}).reduce(function(m,p){return Math.max(m,p)}),b=255/b):(b=255,"S8"===this.pixelType?(f=-128,b=127):"U16"===this.pixelType?b=65535:"S16"===this.pixelType?(f=-32768,b=32767):"U32"===this.pixelType?b=4294967295:"S32"===this.pixelType?(f=-2147483648,
b=2147483647):"F32"===this.pixelType?(f=-3.4*1E39,b=3.4*1E39):"F64"===this.pixelType&&(f=-Number.MAX_VALUE,b=Number.MAX_VALUE),b=255/(b-f));k=new Uint32Array(k);a=this.width*this.height;var g=e[0];if(g.length!==a)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=e.length){var h=e[1];var d=e[2];if(c&&c.length===a)for(e=0;e<a;e++)c[e]&&(k[e]=-16777216|(d[e]-f)*b<<16|(h[e]-f)*b<<8|(g[e]-f)*b);else for(e=0;e<a;e++)k[e]=-16777216|(d[e]-f)*b<<16|(h[e]-f)*b<<8|(g[e]-f)*
b}else if(c&&c.length===a)for(e=0;e<a;e++)h=(g[e]-f)*b,c[e]&&(k[e]=-16777216|h<<16|h<<8|h);else for(e=0;e<a;e++)h=(g[e]-f)*b,k[e]=-16777216|h<<16|h<<8|h},_fillFrom32Bit:function(k){var e=this.pixels,c=this.mask;if(!k||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,b;var f=a=b=e[0];3<=e.length&&(a=e[1],b=e[2]);var g=this.width*this.height;if(f.length!==g)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var h=0;if(c&&
c.length===g)for(e=0;e<g;e++)k[h++]=f[e],k[h++]=a[e],k[h++]=b[e],k[h++]=c[e]&1;else for(e=0;e<g;e++)k[h++]=f[e],k[h++]=a[e],k[h++]=b[e],k[h++]=1},_calculateBandStatistics:function(k,e){var c=Infinity,a=-Infinity,b=k.length,f,g=0;if(e)for(f=0;f<b;f++)e[f]&&(g=k[f],c=g<c?g:c,a=g>a?g:a);else for(f=0;f<b;f++)g=k[f],c=g<c?g:c,a=g>a?g:a;return{minValue:c,maxValue:a}}});t("extend-esri")&&n.setObject("layers.PixelBlock",H,l);return H})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var H=
{defaultNoDataValue:-3.4027999387901484E38,decode:function(t,l){l=l||{};var k=l.inputOffset||0,e=l.encodedMaskData||null===l.encodedMaskData,c={},a=new Uint8Array(t,k,10);c.fileIdentifierString=String.fromCharCode.apply(null,a);if("CntZImage"!=c.fileIdentifierString.trim())throw"Unexpected file identifier string: "+c.fileIdentifierString;k+=10;a=new DataView(t,k,24);c.fileVersion=a.getInt32(0,!0);c.imageType=a.getInt32(4,!0);c.height=a.getUint32(8,!0);c.width=a.getUint32(12,!0);c.maxZError=a.getFloat64(16,
!0);k+=24;if(!e)if(a=new DataView(t,k,16),c.mask={},c.mask.numBlocksY=a.getUint32(0,!0),c.mask.numBlocksX=a.getUint32(4,!0),c.mask.numBytes=a.getUint32(8,!0),c.mask.maxValue=a.getFloat32(12,!0),k+=16,0<c.mask.numBytes){e=new Uint8Array(Math.ceil(c.width*c.height/8));a=new DataView(t,k,c.mask.numBytes);var b=a.getInt16(0,!0),f=2,g=0;do{if(0<b)for(;b--;)e[g++]=a.getUint8(f++);else{var h=a.getUint8(f++);for(b=-b;b--;)e[g++]=h}b=a.getInt16(f,!0);f+=2}while(f<c.mask.numBytes);if(-32768!==b||g<e.length)throw"Unexpected end of mask RLE encoding";
c.mask.bitset=e;k+=c.mask.numBytes}else 0===(c.mask.numBytes|c.mask.numBlocksY|c.mask.maxValue)&&(e=new Uint8Array(Math.ceil(c.width*c.height/8)),c.mask.bitset=e);a=new DataView(t,k,16);c.pixels={};c.pixels.numBlocksY=a.getUint32(0,!0);c.pixels.numBlocksX=a.getUint32(4,!0);c.pixels.numBytes=a.getUint32(8,!0);c.pixels.maxValue=a.getFloat32(12,!0);k+=16;e=c.pixels.numBlocksX;a=c.pixels.numBlocksY;e+=0<c.width%e?1:0;b=a+(0<c.height%a?1:0);c.pixels.blocks=Array(e*b);for(g=f=0;g<b;g++)for(h=0;h<e;h++){var d=
0;a=new DataView(t,k,Math.min(10,t.byteLength-k));var m={};c.pixels.blocks[f++]=m;var p=a.getUint8(0);d++;m.encoding=p&63;if(3<m.encoding)throw"Invalid block encoding ("+m.encoding+")";if(2===m.encoding)k++;else{if(0!==p&&2!==p){p>>=6;m.offsetType=p;if(2===p)m.offset=a.getInt8(1),d++;else if(1===p)m.offset=a.getInt16(1,!0),d+=2;else if(0===p)m.offset=a.getFloat32(1,!0),d+=4;else throw"Invalid block offset type";if(1===m.encoding)if(p=a.getUint8(d),d++,m.bitsPerPixel=p&63,p>>=6,m.numValidPixelsType=
p,2===p)m.numValidPixels=a.getUint8(d),d++;else if(1===p)m.numValidPixels=a.getUint16(d,!0),d+=2;else if(0===p)m.numValidPixels=a.getUint32(d,!0),d+=4;else throw"Invalid valid pixel count type";}k+=d;if(3!=m.encoding)if(0===m.encoding){p=(c.pixels.numBytes-1)/4;if(p!==Math.floor(p))throw"uncompressed block has invalid length";a=new ArrayBuffer(4*p);d=new Uint8Array(a);d.set(new Uint8Array(t,k,4*p));a=new Float32Array(a);m.rawData=a;k+=4*p}else 1===m.encoding&&(p=Math.ceil(m.numValidPixels*m.bitsPerPixel/
8),a=new ArrayBuffer(4*Math.ceil(p/4)),d=new Uint8Array(a),d.set(new Uint8Array(t,k,p)),m.stuffedData=new Uint32Array(a),k+=p)}}c.eofOffset=k;t=null!=l.noDataValue?l.noDataValue:H.defaultNoDataValue;e=l.encodedMaskData;p=l.returnMask;b=0;f=c.pixels.numBlocksX;g=c.pixels.numBlocksY;h=Math.floor(c.width/f);m=Math.floor(c.height/g);d=2*c.maxZError;k=Number.MAX_VALUE;e=e||(c.mask?c.mask.bitset:null);var v;a=new (l.pixelType||Float32Array)(c.width*c.height);p&&e&&(v=new Uint8Array(c.width*c.height));p=
new Float32Array(h*m);for(var q,w,y=0;y<=g;y++){var x=y!==g?m:c.height%g;if(0!==x)for(var E=0;E<=f;E++){var B=E!==f?h:c.width%f;if(0!==B){var C=y*c.width*m+E*h,G=c.width-B,I=c.pixels.blocks[b],D;if(2>I.encoding){if(0===I.encoding)var r=I.rawData;else{var u=D=r=void 0;q=I.stuffedData;w=I.bitsPerPixel;var A=I.numValidPixels,J=I.offset,O=d,P=p,z=c.pixels.maxValue,F=(1<<w)-1,M=0,Q=0,R=Math.ceil((z-J)/O);q[q.length-1]<<=8*(4*q.length-Math.ceil(w*A/8));for(u=0;u<A;u++)0===Q&&(r=q[M++],Q=32),Q>=w?(D=r>>>
Q-w&F,Q-=w):(Q=w-Q,D=(r&F)<<Q&F,r=q[M++],Q=32-Q,D+=r>>>Q),P[u]=D<R?J+D*O:z;r=p}D=0}else var K=2===I.encoding?0:I.offset;if(e)for(w=0;w<x;w++){if(C&7){var N=e[C>>3];N<<=C&7}for(q=0;q<B;q++)C&7||(N=e[C>>3]),N&128?(v&&(v[C]=1),u=2>I.encoding?r[D++]:K,k=k>u?u:k,a[C++]=u):(v&&(v[C]=0),a[C++]=t),N<<=1;C+=G}else if(2>I.encoding)for(w=0;w<x;w++){for(q=0;q<B;q++)u=r[D++],k=k>u?u:k,a[C++]=u;C+=G}else for(k=k>K?K:k,w=0;w<x;w++){for(q=0;q<B;q++)a[C++]=K;C+=G}if(1===I.encoding&&D!==I.numValidPixels)throw"Block and Mask do not match";
b++}}}K=v;v={width:c.width,height:c.height,pixelData:a,minValue:k,maxValue:c.pixels.maxValue,noDataValue:t};K&&(v.maskData=K);l.returnEncodedMask&&c.mask&&(v.encodedMaskData=c.mask.bitset?c.mask.bitset:null);if(l.returnFileInfo&&(v.fileInfo=n(c),l.computeUsedBitDepths)){l=v.fileInfo;K=c.pixels.numBlocksX*c.pixels.numBlocksY;N={};for(r=0;r<K;r++)D=c.pixels.blocks[r],0===D.encoding?N.float32=!0:1===D.encoding?N[D.bitsPerPixel]=!0:N[0]=!0;c=Object.keys(N);l.bitDepths=c}return v}},n=function(t){return{fileIdentifierString:t.fileIdentifierString,
fileVersion:t.fileVersion,imageType:t.imageType,height:t.height,width:t.width,maxZError:t.maxZError,eofOffset:t.eofOffset,mask:t.mask?{numBlocksX:t.mask.numBlocksX,numBlocksY:t.mask.numBlocksY,numBytes:t.mask.numBytes,maxValue:t.mask.maxValue}:null,pixels:{numBlocksX:t.pixels.numBlocksX,numBlocksY:t.pixels.numBlocksY,numBytes:t.pixels.numBytes,maxValue:t.pixels.maxValue,noDataValue:this.noDataValue}}};return H})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var H={unstuff:function(l,
k,e,c,a,b,f,g){var h=(1<<e)-1,d=0,m,p=0;l[l.length-1]<<=8*(4*l.length-Math.ceil(e*c/8));if(a)for(m=0;m<c;m++){if(0===p){var v=l[d++];p=32}if(p>=e){var q=v>>>p-e&h;p-=e}else p=e-p,q=(v&h)<<p&h,v=l[d++],p=32-p,q+=v>>>p;k[m]=a[q]}else for(a=Math.ceil((g-b)/f),m=0;m<c;m++)0===p&&(v=l[d++],p=32),p>=e?(q=v>>>p-e&h,p-=e):(p=e-p,q=(v&h)<<p&h,v=l[d++],p=32-p,q+=v>>>p),k[m]=q<a?b+q*f:g},unstuffLUT:function(l,k,e,c,a,b){var f=(1<<k)-1,g=0,h=0,d=0,m=d=0,p=[];l[l.length-1]<<=8*(4*l.length-Math.ceil(k*e/8));var v=
Math.ceil((b-c)/a);for(h=0;h<e;h++){if(0===d){var q=l[g++];d=32}d>=k?(m=q>>>d-k&f,d-=k):(d=k-d,m=(q&f)<<d&f,q=l[g++],d=32-d,m+=q>>>d);p[h]=m<v?c+m*a:b}p.unshift(c);return p},unstuff2:function(l,k,e,c,a,b,f,g){var h=(1<<e)-1,d=0,m,p=0,v=0;if(a)for(m=0;m<c;m++){if(0===p){var q=l[d++];p=32;v=0}if(p>=e){var w=q>>>v&h;p-=e;v+=e}else{var y=e-p;w=q>>>v&h;q=l[d++];p=32-y;w|=(q&(1<<y)-1)<<e-y;v=y}k[m]=a[w]}else for(a=Math.ceil((g-b)/f),m=0;m<c;m++)0===p&&(q=l[d++],p=32,v=0),p>=e?(w=q>>>v&h,p-=e,v+=e):(y=e-
p,w=q>>>v&h,q=l[d++],p=32-y,w|=(q&(1<<y)-1)<<e-y,v=y),k[m]=w<a?b+w*f:g;return k},unstuffLUT2:function(l,k,e,c,a,b){var f=(1<<k)-1,g=0,h=0,d=0,m=0,p=0,v=0,q=[],w=Math.ceil((b-c)/a);for(h=0;h<e;h++){if(0===m){var y=l[g++];m=32;v=0}m>=k?(p=y>>>v&f,m-=k,v+=k):(d=k-m,p=y>>>v&f,y=l[g++],m=32-d,p|=(y&(1<<d)-1)<<k-d,v=d);q[h]=p<w?c+p*a:b}q.unshift(c);return q},originalUnstuff:function(l,k,e,c){var a=(1<<e)-1,b=0,f,g=0;l[l.length-1]<<=8*(4*l.length-Math.ceil(e*c/8));for(f=0;f<c;f++){if(0===g){var h=l[b++];
g=32}if(g>=e){var d=h>>>g-e&a;g-=e}else g=e-g,d=(h&a)<<g&a,h=l[b++],g=32-g,d+=h>>>g;k[f]=d}return k},originalUnstuff2:function(l,k,e,c){var a=(1<<e)-1,b=0,f,g=0,h=0;for(f=0;f<c;f++){if(0===g){var d=l[b++];g=32;h=0}if(g>=e){var m=d>>>h&a;g-=e;h+=e}else{var p=e-g;m=d>>>h&a;d=l[b++];g=32-p;m|=(d&(1<<p)-1)<<e-p;h=p}k[f]=m}return k}},n={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(l){for(var k=65535,e=65535,c=l.length,a=Math.floor(c/2),b=0;a;){var f=359<=a?359:a;a-=f;do k+=l[b++]<<8,e+=k+=
l[b++];while(--f);k=(k&65535)+(k>>>16);e=(e&65535)+(e>>>16)}c&1&&(e+=k+=l[b]<<8);return((e&65535)+(e>>>16)<<16|(k&65535)+(k>>>16))>>>0},readHeaderInfo:function(l,k){var e=k.ptr,c=new Uint8Array(l,e,6),a={};a.fileIdentifierString=String.fromCharCode.apply(null,c);if(0!==a.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+a.fileIdentifierString;e+=6;c=new DataView(l,e,8);var b=c.getInt32(0,!0);a.fileVersion=b;e+=4;3<=b&&(a.checksum=c.getUint32(4,
!0),e+=4);c=new DataView(l,e,12);a.height=c.getUint32(0,!0);a.width=c.getUint32(4,!0);e+=8;4<=b?(a.numDims=c.getUint32(8,!0),e+=4):a.numDims=1;c=new DataView(l,e,40);a.numValidPixel=c.getUint32(0,!0);a.microBlockSize=c.getInt32(4,!0);a.blobSize=c.getInt32(8,!0);a.imageType=c.getInt32(12,!0);a.maxZError=c.getFloat64(16,!0);a.zMin=c.getFloat64(24,!0);a.zMax=c.getFloat64(32,!0);e+=40;k.headerInfo=a;k.ptr=e;if(3<=b&&(l=this.computeChecksumFletcher32(new Uint8Array(l,e-(4<=b?52:48),a.blobSize-14)),l!==
a.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(l,k){var e=k.headerInfo,c=this.getDataTypeArray(e.imageType),a=e.numDims*this.getDataTypeSize(e.imageType),b=this.readSubArray(l,k.ptr,c,a);l=this.readSubArray(l,k.ptr+a,c,a);k.ptr+=2*a;a=!0;for(k=0;k<e.numDims;k++)if(b[k]!==l[k]){a=!1;break}e.minValues=b;e.maxValues=l;return a},readSubArray:function(l,k,e,c){if(e===Uint8Array)l=new Uint8Array(l,k,c);else{var a=new ArrayBuffer(c);(new Uint8Array(a)).set(new Uint8Array(l,k,c));
l=new e(a)}return l},readMask:function(l,k){var e=k.ptr,c=k.headerInfo,a=c.width*c.height,b=c.numValidPixel,f=new DataView(l,e,4);c={};c.numBytes=f.getUint32(0,!0);e+=4;if((0===b||a===b)&&0!==c.numBytes)throw"invalid mask";if(0===b)b=new Uint8Array(Math.ceil(a/8)),c.bitset=b,f=new Uint8Array(a),k.pixels.resultMask=f,e+=c.numBytes;else if(0<c.numBytes){b=new Uint8Array(Math.ceil(a/8));f=new DataView(l,e,c.numBytes);l=f.getInt16(0,!0);var g=2,h=0,d=0;do{if(0<l)for(;l--;)b[h++]=f.getUint8(g++);else for(d=
f.getUint8(g++),l=-l;l--;)b[h++]=d;l=f.getInt16(g,!0);g+=2}while(g<c.numBytes);if(-32768!==l||h<b.length)throw"Unexpected end of mask RLE encoding";f=new Uint8Array(a);for(g=g=l=0;g<a;g++)g&7?(l=b[g>>3],l<<=g&7):l=b[g>>3],l&128&&(f[g]=1);k.pixels.resultMask=f;c.bitset=b;e+=c.numBytes}k.ptr=e;k.mask=c;return!0},readDataOneSweep:function(l,k,e,c){var a=k.ptr,b=k.headerInfo,f=b.numDims,g=b.width*b.height;b=b.numValidPixel*n.getDataTypeSize(b.imageType)*f;var h=k.pixels.resultMask;if(e===Uint8Array)l=
new Uint8Array(l,a,b);else{var d=new ArrayBuffer(b);(new Uint8Array(d)).set(new Uint8Array(l,a,b));l=new e(d)}if(l.length===g*f)k.pixels.resultPixels=c?n.swapDimensionOrder(l,g,f,e,!0):l;else{k.pixels.resultPixels=new e(g*f);var m=d=e=0,p=0;if(1<f)if(c)for(d=0;d<g;d++){if(h[d])for(p=d,m=0;m<f;m++,p+=g)k.pixels.resultPixels[p]=l[e++]}else for(d=0;d<g;d++){if(h[d])for(p=d*f,m=0;m<f;m++)k.pixels.resultPixels[p+m]=l[e++]}else for(d=0;d<g;d++)h[d]&&(k.pixels.resultPixels[d]=l[e++])}k.ptr=a+b;return!0},
readHuffmanTree:function(l,k){var e=this.HUFFMAN_LUT_BITS_MAX,c=new DataView(l,k.ptr,16);k.ptr+=16;if(2>c.getInt32(0,!0))throw"unsupported Huffman version";var a=c.getInt32(4,!0),b=c.getInt32(8,!0);c=c.getInt32(12,!0);if(b>=c)return!1;var f=new Uint32Array(c-b);n.decodeBits(l,k,f);var g=[],h;for(h=b;h<c;h++){var d=h-(h<a?0:a);g[d]={first:f[h-b],second:null}}h=l.byteLength-k.ptr;f=new ArrayBuffer(4*Math.ceil(h/4));(new Uint8Array(f)).set(new Uint8Array(l,k.ptr,h));l=new Uint32Array(f);k=0;f=0;var m=
l[0];for(h=b;h<c;h++){d=h-(h<a?0:a);var p=g[d].first;0<p&&(g[d].second=m<<k>>>32-p,32-k>=p?(k+=p,32===k&&(k=0,f++,m=l[f])):(k+=p-32,f++,m=l[f],g[d].second|=m>>>32-k))}var v=m=0,q=new t;for(h=0;h<g.length;h++)void 0!==g[h]&&(m=Math.max(m,g[h].first));v=m>=e?e:m;e=[];var w;for(h=b;h<c;h++)if(d=h-(h<a?0:a),p=g[d].first,0<p)if(b=[p,d],p<=v){d=g[d].second<<v-p;var y=1<<v-p;for(p=0;p<y;p++)e[d|p]=b}else for(d=g[d].second,y=q,--p;0<=p;p--)(w=d>>>p&1)?(y.right||(y.right=new t),y=y.right):(y.left||(y.left=
new t),y=y.left),0!==p||y.val||(y.val=b[1]);return{decodeLut:e,numBitsLUTQick:v,numBitsLUT:m,tree:q,stuffedData:l,srcPtr:f,bitPos:k}},readHuffman:function(l,k,e,c){var a=k.headerInfo.numDims,b=k.headerInfo.height,f=k.headerInfo.width,g=f*b,h=this.readHuffmanTree(l,k);l=h.decodeLut;var d=h.tree,m=h.stuffedData,p=h.srcPtr,v=h.bitPos,q=h.numBitsLUTQick;h=h.numBitsLUT;var w=0===k.headerInfo.imageType?128:0,y=k.pixels.resultMask,x,E,B,C,G,I,D=0;0<v&&(p++,v=0);var r=m[p],u=1===k.encodeMode,A=new e(g*a),
J=A,O;if(2>a||u)for(O=0;O<a;O++)if(1<a&&(J=new e(A.buffer,g*O,g),D=0),k.headerInfo.numValidPixel===f*b)for(B=G=0;B<b;B++)for(C=0;C<f;C++,G++){var P=0;var z=x=r<<v>>>32-q;32-v<q&&(z=x|=m[p+1]>>>64-v-q);if(l[z])P=l[z][1],v+=l[z][0];else for(z=x=r<<v>>>32-h,32-v<h&&(z=x|=m[p+1]>>>64-v-h),z=d,I=0;I<h;I++)if(z=(E=x>>>h-I-1&1)?z.right:z.left,!z.left&&!z.right){P=z.val;v=v+I+1;break}32<=v&&(v-=32,p++,r=m[p]);P-=w;u?(P=0<C?P+D:0<B?P+J[G-f]:P+D,P&=255,D=J[G]=P):J[G]=P}else for(B=G=0;B<b;B++)for(C=0;C<f;C++,
G++){if(y[G]){P=0;z=x=r<<v>>>32-q;32-v<q&&(z=x|=m[p+1]>>>64-v-q);if(l[z])P=l[z][1],v+=l[z][0];else for(z=x=r<<v>>>32-h,32-v<h&&(z=x|=m[p+1]>>>64-v-h),z=d,I=0;I<h;I++)if(z=(E=x>>>h-I-1&1)?z.right:z.left,!z.left&&!z.right){P=z.val;v=v+I+1;break}32<=v&&(v-=32,p++,r=m[p]);P-=w;u?(P=0<C&&y[G-1]?P+D:0<B&&y[G-f]?P+J[G-f]:P+D,P&=255,D=J[G]=P):J[G]=P}}else for(B=G=0;B<b;B++)for(C=0;C<f;C++)if(G=B*f+C,!y||y[G])for(O=0;O<a;O++,G+=g){P=0;z=x=r<<v>>>32-q;32-v<q&&(z=x|=m[p+1]>>>64-v-q);if(l[z])P=l[z][1],v+=l[z][0];
else for(z=x=r<<v>>>32-h,32-v<h&&(z=x|=m[p+1]>>>64-v-h),z=d,I=0;I<h;I++)if(z=(E=x>>>h-I-1&1)?z.right:z.left,!z.left&&!z.right){P=z.val;v=v+I+1;break}32<=v&&(v-=32,p++,r=m[p]);P-=w;J[G]=P}k.ptr=k.ptr+4*(p+1)+(0<v?4:0);k.pixels.resultPixels=A;1<a&&!c&&(k.pixels.resultPixels=n.swapDimensionOrder(A,g,a,e))},decodeBits:function(l,k,e,c,a){var b=k.headerInfo,f=b.fileVersion,g=0,h=new DataView(l,k.ptr,5<=l.byteLength-k.ptr?5:l.byteLength-k.ptr),d=h.getUint8(0);g++;var m=d>>6,p=0===m?4:3-m,v=0<(d&32)?!0:
!1;m=d&31;d=0;if(1===p)d=h.getUint8(g),g++;else if(2===p)d=h.getUint16(g,!0),g+=2;else if(4===p)d=h.getUint32(g,!0),g+=4;else throw"Invalid valid pixel count type";p=2*b.maxZError;a=1<b.numDims?b.maxValues[a]:b.zMax;if(v){k.counter.lut++;v=h.getUint8(g);g++;b=Math.ceil((v-1)*m/8);var q=Math.ceil(b/4);q=new ArrayBuffer(4*q);var w=new Uint8Array(q);k.ptr+=g;w.set(new Uint8Array(l,k.ptr,b));g=new Uint32Array(q);k.ptr+=b;for(h=0;v-1>>>h;)h++;b=Math.ceil(d*h/8);q=Math.ceil(b/4);q=new ArrayBuffer(4*q);
w=new Uint8Array(q);w.set(new Uint8Array(l,k.ptr,b));l=new Uint32Array(q);k.ptr+=b;k=3<=f?H.unstuffLUT2(g,m,v-1,c,p,a):H.unstuffLUT(g,m,v-1,c,p,a);3<=f?H.unstuff2(l,e,h,d,k):H.unstuff(l,e,h,d,k)}else k.counter.bitstuffer++,h=m,k.ptr+=g,0<h&&(b=Math.ceil(d*h/8),q=Math.ceil(b/4),q=new ArrayBuffer(4*q),w=new Uint8Array(q),w.set(new Uint8Array(l,k.ptr,b)),l=new Uint32Array(q),k.ptr+=b,3<=f?null==c?H.originalUnstuff2(l,e,h,d):H.unstuff2(l,e,h,d,!1,c,p,a):null==c?H.originalUnstuff(l,e,h,d):H.unstuff(l,
e,h,d,!1,c,p,a))},readTiles:function(l,k,e,c){var a=k.headerInfo,b=a.width,f=a.height,g=b*f,h=a.microBlockSize,d=a.imageType,m=n.getDataTypeSize(d),p=Math.ceil(b/h),v=Math.ceil(f/h);k.pixels.numBlocksY=v;k.pixels.numBlocksX=p;var q=k.pixels.ptr=0,w=0,y=0,x=0,E=0,B=0,C=0,G=0,I=q=0,D=0,r=0,u=C=0;C=C=0;var A=new e(h*h);f=f%h||h;var J=b%h||h,O=a.numDims,P,z=k.pixels.resultMask,F=k.pixels.resultPixels,M=5<=a.fileVersion?14:15,Q=a.zMax;for(y=0;y<v;y++)for(E=y!==v-1?h:f,x=0;x<p;x++)for(B=x!==p-1?h:J,D=y*
b*h+x*h,r=b-B,P=0;P<O;P++){1<O?(u=F,D=y*b*h+x*h,F=new e(k.pixels.resultPixels.buffer,g*P*m,g),Q=a.maxValues[P]):u=null;C=l.byteLength-k.ptr;w=new DataView(l,k.ptr,Math.min(10,C));var R={};C=0;G=w.getUint8(0);C++;var K=5<=a.fileVersion?G&4:0;q=G>>6&255;I=G>>2&M;if(I!==(x*h>>3&M))throw"integrity issue";if(K&&0===P)throw"integrity issue";G&=3;if(3<G)throw k.ptr+=C,"Invalid block encoding ("+G+")";if(2===G){if(K)if(z)for(q=0;q<E;q++)for(w=0;w<B;w++)z[D]&&(F[D]=u[D]),D++;else for(q=0;q<E;q++)for(w=0;w<
B;w++)F[D]=u[D],D++;k.counter.constant++;k.ptr+=C}else if(0===G){if(K)throw"integrity issue";k.counter.uncompressed++;k.ptr+=C;C=E*B*m;u=l.byteLength-k.ptr;C=C<u?C:u;u=new ArrayBuffer(0===C%m?C:C+m-C%m);K=new Uint8Array(u);K.set(new Uint8Array(l,k.ptr,C));u=new e(u);C=0;if(z)for(q=0;q<E;q++){for(w=0;w<B;w++)z[D]&&(F[D]=u[C++]),D++;D+=r}else for(q=0;q<E;q++){for(w=0;w<B;w++)F[D++]=u[C++];D+=r}k.ptr+=C*m}else if(q=n.getDataTypeUsed(K&&6>d?4:d,q),R=n.getOnePixel(R,C,q,w),C+=n.getDataTypeSize(q),3===
G)if(k.ptr+=C,k.counter.constantoffset++,z)for(q=0;q<E;q++){for(w=0;w<B;w++)z[D]&&(F[D]=K?Math.min(Q,u[D]+R):R),D++;D+=r}else for(q=0;q<E;q++){for(w=0;w<B;w++)F[D]=K?Math.min(Q,u[D]+R):R,D++;D+=r}else if(k.ptr+=C,n.decodeBits(l,k,A,R,P),C=0,K)if(z)for(q=0;q<E;q++){for(w=0;w<B;w++)z[D]&&(F[D]=A[C++]+u[D]),D++;D+=r}else for(q=0;q<E;q++){for(w=0;w<B;w++)F[D]=A[C++]+u[D],D++;D+=r}else if(z)for(q=0;q<E;q++){for(w=0;w<B;w++)z[D]&&(F[D]=A[C++]),D++;D+=r}else for(q=0;q<E;q++){for(w=0;w<B;w++)F[D++]=A[C++];
D+=r}}1<O&&!c&&(k.pixels.resultPixels=n.swapDimensionOrder(k.pixels.resultPixels,g,O,e))},formatFileInfo:function(l){return{fileIdentifierString:l.headerInfo.fileIdentifierString,fileVersion:l.headerInfo.fileVersion,imageType:l.headerInfo.imageType,height:l.headerInfo.height,width:l.headerInfo.width,numValidPixel:l.headerInfo.numValidPixel,microBlockSize:l.headerInfo.microBlockSize,blobSize:l.headerInfo.blobSize,maxZError:l.headerInfo.maxZError,pixelType:n.getPixelType(l.headerInfo.imageType),eofOffset:l.eofOffset,
mask:l.mask?{numBytes:l.mask.numBytes}:null,pixels:{numBlocksX:l.pixels.numBlocksX,numBlocksY:l.pixels.numBlocksY,maxValue:l.headerInfo.zMax,minValue:l.headerInfo.zMin,noDataValue:l.noDataValue}}},constructConstantSurface:function(l,k){var e=l.headerInfo.zMax,c=l.headerInfo.zMin,a=l.headerInfo.maxValues,b=l.headerInfo.numDims,f=l.headerInfo.height*l.headerInfo.width,g=0,h=0,d=0,m=l.pixels.resultMask;l=l.pixels.resultPixels;if(m)if(1<b)if(k)for(g=0;g<b;g++)for(d=g*f,e=a[g],h=0;h<f;h++)m[h]&&(l[d+h]=
e);else for(h=0;h<f;h++){if(m[h])for(d=h*b,g=0;g<b;g++)l[d+b]=a[g]}else for(h=0;h<f;h++)m[h]&&(l[h]=e);else if(1<b&&c!==e)if(k)for(g=0;g<b;g++)for(d=g*f,e=a[g],h=0;h<f;h++)l[d+h]=e;else for(h=0;h<f;h++)for(d=h*b,g=0;g<b;g++)l[d+g]=a[g];else for(h=0;h<f*b;h++)l[h]=e},getDataTypeArray:function(l){switch(l){case 0:l=Int8Array;break;case 1:l=Uint8Array;break;case 2:l=Int16Array;break;case 3:l=Uint16Array;break;case 4:l=Int32Array;break;case 5:l=Uint32Array;break;case 6:l=Float32Array;break;case 7:l=Float64Array;
break;default:l=Float32Array}return l},getPixelType:function(l){switch(l){case 0:l="S8";break;case 1:l="U8";break;case 2:l="S16";break;case 3:l="U16";break;case 4:l="S32";break;case 5:l="U32";break;case 6:l="F32";break;case 7:l="F64";break;default:l="F32"}return l},isValidPixelValue:function(l,k){if(null==k)return!1;switch(l){case 0:l=-128<=k&&127>=k;break;case 1:l=0<=k&&255>=k;break;case 2:l=-32768<=k&&32767>=k;break;case 3:l=0<=k&&65536>=k;break;case 4:l=-2147483648<=k&&2147483647>=k;break;case 5:l=
0<=k&&4294967296>=k;break;case 6:l=-3.4027999387901484E38<=k&&3.4027999387901484E38>=k;break;case 7:l=4.9E-324<=k&&1.7976931348623157E308>=k;break;default:l=!1}return l},getDataTypeSize:function(l){var k=0;switch(l){case 0:case 1:k=1;break;case 2:case 3:k=2;break;case 4:case 5:case 6:k=4;break;case 7:k=8;break;default:k=l}return k},getDataTypeUsed:function(l,k){var e=l;switch(l){case 2:case 4:e=l-k;break;case 3:case 5:e=l-2*k;break;case 6:e=0===k?l:1===k?2:1;break;case 7:e=0===k?l:l-2*k+1;break;default:e=
l}return e},getOnePixel:function(l,k,e,c){l=0;switch(e){case 0:l=c.getInt8(k);break;case 1:l=c.getUint8(k);break;case 2:l=c.getInt16(k,!0);break;case 3:l=c.getUint16(k,!0);break;case 4:l=c.getInt32(k,!0);break;case 5:l=c.getUInt32(k,!0);break;case 6:l=c.getFloat32(k,!0);break;case 7:l=c.getFloat64(k,!0);break;default:throw"the decoder does not understand this pixel type";}return l},swapDimensionOrder:function(l,k,e,c,a){var b=0,f=0,g=0,h=0,d=l;if(1<e)if(d=new c(k*e),a)for(b=0;b<k;b++)for(h=b,g=0;g<
e;g++,h+=k)d[h]=l[f++];else for(b=0;b<k;b++)for(h=b,g=0;g<e;g++,h+=k)d[f++]=l[h];return d}},t=function(l,k,e){this.val=l;this.left=k;this.right=e};return{decode:function(l,k){k=k||{};var e=k.noDataValue,c=0,a={};a.ptr=k.inputOffset||0;a.pixels={};if(n.readHeaderInfo(l,a)){c=a.headerInfo;var b=c.fileVersion,f=n.getDataTypeArray(c.imageType);if(5<b)throw"unsupported lerc version 2."+b;n.readMask(l,a);c.numValidPixel===c.width*c.height||a.pixels.resultMask||(a.pixels.resultMask=k.maskData);var g=c.width*
c.height;a.pixels.resultPixels=new f(g*c.numDims);a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var h=!k.returnPixelInterleavedDims;if(0!==c.numValidPixel)if(c.zMax===c.zMin)n.constructConstantSurface(a,h);else if(4<=b&&n.checkMinMaxRanges(l,a))n.constructConstantSurface(a,h);else{var d=new DataView(l,a.ptr,2),m=d.getUint8(0);a.ptr++;if(m)n.readDataOneSweep(l,a,f,h);else if(1<b&&1>=c.imageType&&1E-5>Math.abs(c.maxZError-.5)){d=d.getUint8(1);a.ptr++;a.encodeMode=
d;if(2<d||4>b&&1<d)throw"Invalid Huffman flag "+d;d?n.readHuffman(l,a,f,h):n.readTiles(l,a,f,h)}else n.readTiles(l,a,f,h)}a.eofOffset=a.ptr;k.inputOffset?(l=a.headerInfo.blobSize+k.inputOffset-a.ptr,1<=Math.abs(l)&&(a.eofOffset=k.inputOffset+a.headerInfo.blobSize)):(l=a.headerInfo.blobSize-a.ptr,1<=Math.abs(l)&&(a.eofOffset=a.headerInfo.blobSize));l={width:c.width,height:c.height,pixelData:a.pixels.resultPixels,minValue:c.zMin,maxValue:c.zMax,validPixelCount:c.numValidPixel,dimCount:c.numDims,dimStats:{minValues:c.minValues,
maxValues:c.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&n.isValidPixelValue(c.imageType,e)){b=a.pixels.resultMask;for(c=0;c<g;c++)b[c]||(l.pixelData[c]=e);l.noDataValue=e}a.noDataValue=e;k.returnFileInfo&&(l.fileInfo=n.formatFileInfo(a));return l}},getBandCount:function(l){for(var k=0,e=0,c={ptr:0,pixels:{}};e<l.byteLength-58;)n.readHeaderInfo(l,c),e+=c.headerInfo.blobSize,k++,c.ptr=e;return k}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),
function(H,n,t,l,k,e){H=H(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(c){n.mixin(this,c);this.isDataUV=c&&c.isDataUV?c.isDataUV:!1;this.computeMagnitudeAndDirection=n.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(c,a){this.inputUnit=c;this.outputUnit=a;this.unitConversionFactor=
1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var c=e.indexOf(this.speedUnits,this.inputUnit),a=e.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=c&&0<=a){var b=[1,.277778,.514444,.3048,.44704,0];this.unitConversionFactor=b[c]/b[a]}},computeMagnitudeAndDirection:function(c){if(!k.isDefined(c))throw"Could not compute magnitude and direction. No pixel data is available.";var a=c.pixelBlock;if(!k.isDefined(a)||2!==a.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";
var b=c.extent,f=(b.xmax-b.xmin)/a.width,g=(b.ymax-b.ymin)/a.height,h=b.xmin+f/2;b=b.ymax-g/2;a.statistics[0].minValue=0;a.statistics[0].maxValue=0;var d=180/Math.PI,m=[],p=0,v=0,q=0,w=!k.isDefined(a.mask),y,x,E,B;var C=E=Infinity;var G=B=-Infinity;for(p=0;p<a.height;p++)for(v=0;v<a.width;v++,q++)if(m.push([h+f*v,b-g*p]),w||a.mask[q]){var I=y=a.pixels[0][q];var D=x=a.pixels[1][q];this.isDataUV&&(I=Math.sqrt(y*y+x*x),D=90-d*Math.atan2(x,y));a.pixels[0][q]=I*this.unitConversionFactor;a.pixels[1][q]=
D;I>G&&(G=I);I<C&&(C=I);D>B&&(B=D);D<E&&(E=D)}a.statistics[0].maxValue=G;a.statistics[0].minValue=C;a.statistics[1].maxValue=B;a.statistics[1].minValue=E;c.locations=m;return c}});t("extend-esri")&&n.setObject("layers.pixelFilters.VectorFieldPixelFilter",H,l);return H})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(H,n,t,l){var k;return n(null,{constructor:function(e){this.ctx=e.ctx;this._loadRasterFormatModule()},
decode:function(e,c){if(!c.width||!c.height)throw"Native decoding requires the image format, width and height";var a=new t,b,f=new Uint8Array(e);e=this._getFormat(e);if("error"===e)throw"invalid format";"jpeg"===e&&(b=this._getMask(f,c));var g="",h;for(h=0;h<f.length;h+=65535){var d=f.subarray(h,h+65535>f.length-1?f.length-1:h+65535);g+=String.fromCharCode.apply(null,d)}f="data:image/"+e+";base64,"+window.btoa(g);var m=new Image,p;m.src=f;var v=this;m.onload=function(){v.ctx.clearRect(0,0,c.width,
c.height);v.ctx.drawImage(m,0,0);var q=v.ctx.getImageData(0,0,m.width,m.height);p=q.data;if(b)for(h=0;h<b.length;h++)p[4*h+3]=b[h]?255:0;v.ctx.putImageData(q,0,0);a.resolve(null)};m.onerror=function(){a.reject("cannot load image")};return a},_getFormat:function(e){e=new Uint8Array(e,0,10);var c="error";255===e[0]&&216===e[1]?c="jpeg":137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&(c="png");return c},_getMask:function(e,c){try{if(!k)throw"The zlib decoder module is not loaded.";var a=0,b=0,f=Math.round(e.length/
2);1===f%2&&(f+=1);var g=e.length-2;for(a=f;a<g&&(255!==e[a]||217!==e[a+1]);a++);f=a+=2;if(f<e.length-1){var h=(new k(e.subarray(f))).getBytes();var d=new Uint8Array(c.width*c.height);for(a=e=0;a<h.length;a++)for(b=7;0<=b;b--)d[e++]=h[a]>>b&1}}catch(m){}return d},_loadRasterFormatModule:function(){10>l("ie")||H(["./Zlib"],function(e){k=e})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),
function(H,n,t,l,k,e,c,a){H=H(c,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(b){this._url.path+="/identify";this._handler=n.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(b,f,g,h,d){try{var m=new a(b);this._successHandler([m],"onComplete",g,d)}catch(p){this._errorHandler(p,h,d)}},execute:function(b,f,g,h){var d=h.assembly;b=this._encode(n.mixin({},this._url.query,{f:"json"},b.toJson(d&&d[0])));var m=this._handler,
p=this._errorHandler;return k({url:this._url.path,content:b,callbackParamName:"callback",load:function(v,q){m(v,q,f,g,h.dfd)},error:function(v){p(v,g,h.dfd)}})},onComplete:function(){}});e._createWrappers(H);t("extend-esri")&&n.setObject("tasks.ImageServiceIdentifyTask",H,l);return H})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(H,n,t,l,k,e,c,a){H=H(a,{declaredClass:"esri.tasks._Task",
_eventMap:{error:["error"],complete:["result"]},constructor:function(b,f){b&&n.isString(b)&&(this._url=c.urlToObject(this.url=b));f&&f.requestOptions&&(this.requestOptions=f.requestOptions);this.normalization=!0;this._errorHandler=n.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var b=this._url,f=/^http:/i;this.url&&(this.url=this.url.replace(f,"https:"));b&&b.path&&(b.path=b.path.replace(f,"https:"))},_encode:function(b,f,g){var h={},d;for(d in b)if("declaredClass"!==
d){var m=b[d];var p=typeof m;if(null!==m&&void 0!==m&&"function"!==p)if(n.isArray(m)){h[d]=[];var v=m.length;for(p=0;p<v;p++)h[d][p]=this._encode(m[p])}else"object"===p?m.toJson&&(p=m.toJson(g&&g[d]),"esri.tasks.FeatureSet"===m.declaredClass&&p.spatialReference&&(p.sr=p.spatialReference,delete p.spatialReference),h[d]=f?p:t.toJson(p)):h[d]=m}return h},_successHandler:function(b,f,g,h){f&&this[f].apply(this,b);g&&g.apply(null,b);h&&e._resDfd(h,b)},_errorHandler:function(b,f,g){this.onError(b);f&&f(b);
g&&g.errback(b)},setNormalization:function(b){this.normalization=b},onError:function(){}});l("extend-esri")&&(k.Task=H);return H})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(H,n,t,l,k,e){H=H(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(c){c.catalogItems&&(this.catalogItems=new e(c.catalogItems));c.location&&(this.location=k.fromJson(c.location));
this.catalogItemVisibilities=c.catalogItemVisibilities;this.name=c.name;this.objectId=c.objectId;this.value=c.value;this.processedValues=c.processedValues;this.properties=c.properties}});t("extend-esri")&&n.setObject("tasks.ImageServiceIdentifyResult",H,l);return H})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h){H=H(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(d,m){if(d){n.mixin(this,d);var p=this.features=this.features||[],v=d.spatialReference;v=this.spatialReference=g.createInstance(a.simpleConstructor,v);var q=g.getGeometryType(d.geometryType);this.geometryType=d.geometryType;d.fields&&(this.fields=d.fields);d=g.supportsLazyUnquantization(this.geometryType);var w=g.unquantizeFunction(this.geometryType,this.transform),y=!!(m&&d&&w),x=q&&(y?q.accessorConstructor:
q.simpleConstructor);t.forEach(p,function(E,B){var C=g.createInstance(c.simpleConstructor),G=E.geometry;if(q&&G){var I=C.geometry=g.createInstance(x,y?null:G);I.setSpatialReference(G.spatialReference?g.createInstance(a.simpleConstructor,G.spatialReference):v);y&&I.setupLazyUnquantization(w,G)}C.symbol=E.symbol?h.fromJson(E.symbol):null;C.attributes=E.attributes;p[B]=C});y||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(d){var m=
{};this.displayFieldName&&(m.displayFieldName=this.displayFieldName);this.fields&&(m.fields=this.fields);this.spatialReference?m.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(m.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(m.geometryType=g.getJsonType(this.features[0].geometry)),m.features=b._encodeGraphics(this.features,d));m.geometryType=m.geometryType||this.geometryType;m.exceededTransferLimit=
this.exceededTransferLimit;m.transform=this.transform;return e.fixJson(m)},_hydrate:function(){g.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(d){if(!this.geometryType)return this.transform=null,this;var m=d.translate[0],p=d.translate[1],v=d.scale[0],q=d.scale[1],w=this.features,y=function(C,G,I){var D,r=[];var u=0;for(D=C.length;u<D;u++){var A=C[u];if(0<u){var J=G(A[0]);A=I(A[1]);if(J!==O||A!==P){r.push([J-O,A-P]);var O=J;var P=A}}else O=G(A[0]),
P=I(A[1]),r.push([O,P])}return 0<r.length?r:null},x=function(C,G,I){if("esriGeometryPoint"===C)return function(D){D.x=G(D.x);D.y=I(D.y);return D};if("esriGeometryPolyline"===C||"esriGeometryPolygon"===C)return function(D){var r;var u=D.rings||D.paths;var A=[];var J=0;for(r=u.length;J<r;J++){var O=u[J];(O=y(O,G,I))&&A.push(O)}return 0<A.length?(D.rings?D.rings=A:D.paths=A,D):null};if("esriGeometryMultipoint"===C)return function(D){var r=y(D.points,G,I);return 0<r.length?(D.points=r,D):null};if("esriGeometryEnvelope"===
C)return function(D){return D}}(this.geometryType,function(C){return Math.round((C-m)/v)},function(C){return Math.round((p-C)/q)}),E;var B=0;for(E=w.length;B<E;B++)w[B].geometry&&(x(w[B].geometry)||w[B].setGeometry(null));this.transform=d;return this}});H.createGraphics=function(d){var m=d.geometryType,p=g.createInstance(a.simpleConstructor,d.spatialReference),v=g.getGeometryType(m).accessorConstructor,q=g.unquantizeFunction(m,d.transform);return t.map(d.features,function(w,y){y=g.createInstance(c.simpleConstructor);
var x=w.geometry;if(x){var E=y.geometry=g.createInstance(v);E.setSpatialReference(p);E.setupLazyUnquantization(q,x)}y.attributes=w.attributes;return y})};H.createPolygon=function(d,m,p){if(d){var v=g.createInstance(f.accessorConstructor);v.setSpatialReference(m);m=g.unquantizeFunction("esriGeometryPolygon",p);v.setupLazyUnquantization(m,d)}return v};l("extend-esri")&&n.setObject("tasks.FeatureSet",H,k);return H})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),
function(H,n,t,l,k,e,c,a){H=H(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,maxItemCount:null,returnPixelValues:!0,toJson:function(b){var f=b&&b.geometry||this.geometry;b={geometry:f,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?t.toJson(this.mosaicRule.toJson()):
null,renderingRule:this.renderingRule?t.toJson(this.renderingRule.toJson()):null};f&&(b.geometryType=a.getJsonType(f));f=this.timeExtent;b.time=f?f.toJson().join(","):null;c.isDefined(this.pixelSizeX)&&c.isDefined(this.pixelSizeY)?b.pixelSize=t.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(b.pixelSize=this.pixelSize?t.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(b.renderingRules=t.toJson(l.map(this.renderingRules,function(g){return g.toJson()})));
c.isDefined(this.returnPixelValues)&&(b.returnPixelValues=this.returnPixelValues);c.isDefined(this.maxItemCount)&&(b.maxItemCount=this.maxItemCount);return b}});k("extend-esri")&&n.setObject("tasks.ImageServiceIdentifyParameters",H,e);return H})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),function(H,n,t,l,k,e){H=H(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,
imageSpatialReference:null,format:null,interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,renderer:null,noData:null,compressionTolerance:null,adjustAspectRatio:null,lercVersion:null,toJson:function(c){var a=this.bbox||this.extent;c=(a=a&&c&&a._normalize(!0))?a.spatialReference.wkid||t.toJson(a.spatialReference.toJson()):null;var b=this.imageSpatialReference;a={bbox:a?a.xmin+","+a.ymin+","+a.xmax+","+a.ymax:null,bboxSR:c,size:null!==this.width&&
null!==this.height?this.width+","+this.height:null,imageSR:b?b.wkid||t.toJson(b.toJson()):c,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?t.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?t.toJson(this.renderingRule.toJson()):null,renderer:this.renderer?t.toJson(this.renderer.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation,
compressionTolerance:this.compressionTolerance,adjustAspectRatio:this.adjustAspectRatio,lercVersion:this.lercVersion};c=this.timeExtent;a.time=c?c.toJson().join(","):null;return e.filter(a,function(f){if(null!==f&&void 0!==f)return!0})}});n.mixin(H,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});
l("extend-esri")&&n.setObject("layers.ImageServiceParameters",H,k);return H})},"esri/layers/RasterXLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/dom-construct dojo/dom-style dojo/on dojox/gfx/matrix dojo/when dojo/DeferredList ../kernel ../config ../lang ../domUtils ../urlUtils ../graphic ../request ../renderers/ClassBreaksRenderer ../renderers/StretchRenderer ../renderers/UniqueValueRenderer ../renderers/ColormapRenderer ../renderers/ShadedReliefRenderer ../geometry/Extent ../SpatialReference ../geometry/Point ./Field ./TimeInfo ./MosaicRule ./DimensionalDefinition ./PixelBlock ./ImageServiceLayerMixin ./rasterLib/raster/rasterFactory ./rasterLib/raster/rasterProjectionHelper ./rasterLib/renderer/rasterRendererHelper ./rasterLib/tile/RasterTileInfo ./rasterLib/tile/RasterTileManager ./rasterLib/tile/RasterHandler ./layer".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q,w,y,x,E,B,C,G,I,D,r,u,A,J,O,P,z,F,M,Q,R,K,N,V){var W=m.defaults.map.zoomDuration;H=H([V],{declaredClass:"esri.layers.RasterXLayer",managedSuspension:!0,opacity:1,tileMode:!0,useWebGL:!0,drawMode:!0,_eventMap:{"raster-change":!0,"renderer-change":!0},_lastPopup:[],_rasterFieldPrefix:"Raster.",_cachedVariableStats:{},_cachedVariableHistogram:{},constructor:function(L,T){T=T||{};this.tileMode=null!=T.tileMode?T.tileMode:this.tileMode;this.useWebGL=null!=T.useWebGL?
T.useWebGL:this.useWebGL;this.roaming=null!=T.roaming?T.roaming:this.roaming;this.drawMode=null!=T.drawMode?T.drawMode:this.drawMode;this.bandIds=T.bandIds&&0<T.bandIds.length?T.bandIds:null;this.renderer=T.renderer;this._customModules=T.customModules;this.useMapTime=T.useMapTime;if(T.multidimensionalDefinition&&0<T.multidimensionalDefinition.length){var S=new J;S.multidimensionalDefinition=T.multidimensionalDefinition.map(function(U){return U.toJson?U:new O(U)});S.method=J.METHOD_NONE;this.mosaicRule=
S}this.infoTemplate=T.infoTemplate;this.drawMode||(this._contextType=T._contextType||T.drawType);this._supportLegacyPropMethods=!1!==T.legacySupport;this._rasterHandler=new N({customModules:this._customModules});this._workInitPromise=this._rasterHandler.start();this.pixelData=null;this._initialize(L,T);b(this,"load",n.hitch(this,function(){g(this._rasterHandler._connected||this._rasterHandler._connectionPromise,n.hitch(this,function(){this._rasterHandler.setLayer({layerId:this.id,raster:{rasterInfo:this.raster.rasterInfo,
rasterFunction:this.raster.rasterFunction&&this.raster.rasterFunction.toJson()},bandCount:this.raster.rasterInfo.bandCount});this.raster.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this.id,data:this.raster.rasterFunction.toJson(!0)});this._rasterRenderer&&this._rasterHandler.setRasterRenderer({layerId:this.id,data:this._rasterRenderer.toJson(!0)})}))}));this._animatePan2d=n.hitch(this,this._animatePan2d)},setOpacity:function(L){this.opacity!==L&&(this.opacity=L,this.onOpacityChange(L))},
onOpacityChange:function(){},onRendererChange:function(){},refresh:function(){if(this.loaded&&this._map)if(!this._canDraw()||10>e("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(L,T,S,U){this._canDraw()&&(this.useWebGL||(S?this._context.clearRect(L,T,S,U):this._context.clearRect(0,0,this._map.width,this._map.height)))},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);
this._toggleTime();v.show(this._div);if("css-transforms"===this._map.navigationMode){var L=this._map.__visibleDelta;this._left=this._tdx=L.x;this._top=this._tdy=L.y;a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(n.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._fireUpdateEnd();this._toggleTime();v.hide(this._div);clearTimeout(this._displayTimer);
this._displayTimer=null},redraw:function(){this.useWebGL&&this._glSetting&&(this._glSetting.hasNewTexture=!1);var L=this.tileMode?this.tileManager.originalPixelData:this.originalPixelData;if(this.tileMode?L&&(L.src||L.texture):L)if(this.tileMode)if(this.useWebGL)this._updateAllTilesOnce(L);else{this.tileManager.tiles.forEach(function(S){S&&(S.update=null,S.completed=!1,S.processedPixelBlock=null,S.renderedPixelBlock=null)});L.processedPixelBlock=null;var T=this.raster.rasterFunction?this.raster.rasterFunction.read(L):
{extent:L.extent,pixelBlock:L.src[this.tileManager.identifiers[0]]&&L.src[this.tileManager.identifiers[0]].pixelBlock};L.renderedPixelBlock=null;L=this._rasterRenderer?this._rasterRenderer.draw(T):T;this._drawOneFrame(L)}else this._supportLegacyPropMethods&&this.pixelFilter?this._setPixelData(this.originalPixelData):(L.processedPixelBlock=null,T=this.raster.rasterFunction?this.raster.rasterFunction.read(L):{extent:L.extent,pixelBlock:L.src?L.src[this.tileManager.identifiers[0]]&&L.src[this.tileManager.identifiers[0]].pixelBlock:
L.pixelBlock},L.renderedPixelBlock=null,L=this._rasterRenderer?this._rasterRenderer.draw(T):T,this._drawOneFrame(L))},getCurrentResolution:function(){var L=this._map.extent;return new r((L.xmax-L.xmin)/this._map.width,(L.ymax-L.ymin)/this._map.height,L.spatialReference)},getCustomRasterFields:function(L){var T=L?L.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix,S={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:10.3<=this.version?
"esriFieldTypeDouble":"esriFieldTypeString"};L=this.fields?n.clone(this.fields):[];L.push(S);(S=this.rasterAttributeTable&&this.rasterAttributeTable.fields)&&0<S.length&&(S=l.filter(S,function(U){return"esriFieldTypeOID"!==U.type&&"value"!==U.name.toLowerCase()}),S=l.map(S,function(U){var X=n.clone(U);X.name=T+U.name;return X}),L=L.concat(S));return L},setRenderer:function(L,T){if(this.loaded&&L){if(L.declaredClass&&-1<L.declaredClass.indexOf("esri.layers.rasterLib")){this._rasterRenderer=L;this._rasterRenderer.bind({layer:this});
var S=this.bandIds=L.bandIndex;this.raster&&this.raster.setFetchParameters({bandIds:S});this._params&&(this._params.bandIds=S&&0<S.length?S.join(","):null);this.renderer=this._getCommonRenderer(L)}else S=n.clone(L.toJson?L.toJson():L),"rasterStretch"===S.type&&(S.bandIndex=this.bandIds,S.bandIndex&&1<S.bandIndex.length||!S.bandIndex&&this.raster&&1<this.raster.rasterInfo.bandCount)&&(S.type="rgb"),this._rasterRenderer=Q.create(S),this.renderer=L.declaredClass?L:this._getCommonRenderer(this._rasterRenderer),
this._rasterRenderer.bind({layer:this});if(this._map){if(this.loaded&&this._rasterHandler._connected){var U=this._rasterHandler.setRasterRenderer({layerId:this.id,data:this._rasterRenderer.toJson(!0)});this._updateTilingEffects()}T||(U?U.then(n.hitch(this,function(){this.redraw()})):this.redraw());this.onRendererChange()}}},setBandIds:function(L,T){this.bandIds=L;this.raster&&this.raster.setFetchParameters({bandIds:L});this._params&&(this._params.bandIds=L&&0<L.length?L.join(","):null);this.setRenderer(this.renderer,
T)},_setTime:function(L){L=L?L.toJson():null;this._params&&(this._params.time=L);this.raster.setFetchParameters({time:L});this.tileManager&&this.tileManager.tiles&&this.tileManager.resetTiles()},setInfoTemplate:function(L){this.infoTemplate=L;this._updateInfoTemplateFields(this.fields)},setMultiDimensionalDefinition:function(L,T){var S=L&&L.multidimensionalDefinition;if(S&&this.loaded){var U=S&&S[0].variableName;""===U&&(U=this._multidimensionalInfo.variables[0].name,S.forEach(function(Y){Y.variableName=
U}));if("ImageService"===this.raster.sourceType){var X=this.raster._getAllDimensionDefinition(S,U);X.defChanged&&(L.multidimensionalDefinition=X.definition,this.setMosaicRule(L,!0))}this.raster.setFetchParameters({multidimensionalDefinition:S});this.tileManager&&this.tileManager.tiles&&this.tileManager.resetTiles();U&&this._updateRasterInfo(U);T||this.refresh()}},_updateRasterInfo:function(L){var T=this.raster.rasterInfo,S=this.getHistograms(L);L=this.getStatistics(L);(new h([S,L])).then(n.hitch(this,
function(U){U[0][0]&&(T.histograms=U[0][1].histograms);U[1][0]&&(T.statistics=U[1][1]);this.refresh()}))},_updateInfoTemplateFields:function(L){if(L&&!(1>L.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var T,S;var U=this.infoTemplate.info.fieldInfos;for(T=0;T<L.length;T++){var X=L[T];for(S=0;S<U.length;S++)if(U[S].fieldName.toLowerCase()===X.name.toLowerCase()&&U[S].fieldName!==X.name){U[S].fieldName=X.name;break}}}},
getPixelData:function(L){return this.tileMode?L?this.tileManager&&this.tileManager.originalPixelData&&this.tileManager.originalPixelData.src&&this.tileManager.originalPixelData.src[this.tileManager.identifiers[0]]:null:this.inherited(arguments)},fetchPopupFromTiles:function(L){var T=new k;this.identify(L.geometry).then(function(S){var U=S.pixelValue;this.hasStdTime()&&U&&U.length&&null!=U[0]&&(U=U.map(function(Z){return this.getStdTimeValue(Z)}.bind(this)).join(", "));if(U){S={ObjectId:0,"Raster.ServicePixelValue":U};
var X=this.rasterAttributeTable&&this.rasterAttributeTable.features;if(X&&0<X.length&&(X=l.filter(X,function(Z){if(Z&&Z.attributes)return Z.attributes.hasOwnProperty("Value")?Z.attributes.Value==U:Z.attributes.VALUE==U}),0<X.length&&(X=n.clone(X[0]))))for(var Y in X.attributes)X.attributes.hasOwnProperty(Y)&&(S[this._rasterFieldPrefix+Y]=X.attributes[Y]);Y=new w(new I(this.projectedFullExtent||this.fullExtent),null,S);Y.setInfoTemplate(this.infoTemplate);Y._layer=this;this._lastPopup=[Y];T.resolve([Y])}else this._lastPopup=
[],T.resolve()}.bind(this),function(S){this._lastPopup=[];T.resolve(S)});return T},getPopupFromTiles:function(){return this._lastPopup},identify:function(L,T){return this.raster?this.raster.identify(L):(L=new k,L.reject("layer must be initialized to identify"),L.promise)},_getCommonRenderer:function(L){switch(L.rendererName){case "RGB":case "Stretch":return new E(L.toCommonRendererJson());case "UniqueValue":return new B(L.toCommonRendererJson());case "ClassBreaks":return new x(L.toCommonRendererJson());
case "Colormap":return new C(L.toCommonRendererJson());case "ShadedRelief":return new G(L.toCommonRendererJson())}},_getProjectedFullExtent:function(L){return this.raster.getProjectedFullExtent(L).then(n.hitch(this,function(T){this.projectedFullExtent=T}))},_initialize:function(L,T){T=T||{};this._supportLegacyPropMethods&&this.constructor._onMap&&(this.constructor._onMap["rendering-change"]={method:"onRenderingChange"},this.constructor._onMap["mosaic-rule-change"]={method:"onMosaicRuleChange"},this.constructor._onMap["spatial-reference-change"]=
{method:"onSpatialReferenceChange"});this.raster={};var S=T.raster?T.raster.url:L;S&&-1<S.toLowerCase().indexOf("/imageserver")&&this._supportLegacyPropMethods&&this._addLegacySupport(S,T);var U=n.hitch(this,function(){this.loaded=!0;this.mosaicRule&&this.mosaicRule.multidimensionalDefinition&&0<this.mosaicRule.multidimensionalDefinition.length&&this.setMultiDimensionalDefinition(this.mosaicRule,!0);this.raster._setRasterHandler(this._rasterHandler);this.onLoad(this);var X=this._loadCallback;X&&(delete this._loadCallback,
X(this))});(L?F.create(n.mixin({url:L},T)):T.raster&&T.raster.open()).then(n.hitch(this,function(X){if(X){this.raster=X;var Y=this._getSourceImageServiceRaster();this.url||(this.url=Y&&Y.url);this.url&&(this._url=q.urlToObject(L));var Z=T.minScale,aa=T.maxScale,ba=X.tileInfo&&"Raster"===X.tileInfo.tileType;null==aa&&(aa=ba&&T.zoomFactor?X.tileInfo.lods[X.tileInfo.lods.length-1].scale/T.zoomFactor:this.maxScale);null==Z&&(Z=ba&&T.zoomFactor?X.tileInfo.lods[0].scale*T.zoomFactor:this.minScale);Y&&"ImageService"===
Y.sourceType&&this._supportLegacyPropMethods&&this._addGeneralProperties(L,T);this.initialExtent=this.fullExtent=this.extent=this.raster.rasterInfo.extent;this.spatialReference=this.extent.spatialReference;this.timeInfo=this.raster.rasterInfo.timeInfo?new A(this.raster.rasterInfo.timeInfo):null;this.rasterAttributeTable=this.raster.rasterInfo.vat;this._multidimensionalInfo=this.raster.rasterInfo.multidimensionalInfo;this.rasterAttributeTable&&(this._rasterAttributeTableFields=this.rasterAttributeTable.fields);
this.mosaicRule&&this.raster.setFetchParameters({multidimensionalDefinition:this.mosaicRule.multidimensionalDefinition});this._multidimensionalInfo&&(this._getDefaultMultidimensionalDefinition(this._multidimensionalInfo,!0,!0),this.mosaicRule||(this.mosaicRule=this.defaultMosaicRule,this.raster.setFetchParameters({multidimensionalDefinition:this._defaultMultidimensionalDefinition})),this.raster.defaultMultidimensionalDefinition=this._defaultMultidimensionalDefinition);null==Z||this._hasMin||this.setMinScale(Z);
null==aa||this._hasMax||this.setMaxScale(aa);this._workInitPromise?this._workInitPromise.then(U,U):U()}else console.error("cannot create rasterx layer as the raster data source cannot be opened")}),this._errorHandler)},_getSourceImageServiceRaster:function(){var L=this.raster&&"Function"===this.raster.sourceType?1===this.raster.getMemberRasters().length?this.raster.getMemberRasters()[0]:null:this.raster;if(L&&"ImageService"===L.sourceType)return L},_addLegacySupport:function(L,T){this._url=q.urlToObject(L);
T=T||{};this.format=(L=T.imageServiceParameters)&&L.format;this.compressionTolerance=L&&L.compressionTolerance?L.compressionTolerance:.01;this.interpolation=L?L.interpolation:null;this.compressionQuality=L?L.compressionQuality:null;this.bandIds=L&&L.bandIds||T&&T.bandIds||null;this.mosaicRule||(this.mosaicRule=L?L.mosaicRule:null);this.renderingRule||(this.renderingRule=L?L.renderingRule:null);this.useMapDimensionValue=T.hasOwnProperty("useMapDimensionValue")?!!T.useMapDimensionValue:!0;this.hasImageFilter=
T.hasImageFilter;this.activeMapDimensions=T.activeMapDimensions;this._params=n.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},L?L.toJson():{});this.pixelFilter=T.pixelFilter;this.originalPixelData=this.pixelData=null;this._queryVisibleRastersHandler=n.hitch(this,this._queryVisibleRastersHandler);this._useRenderingRuleAttributeTable=!1;this._rasterFunctionTemplateInfos=
{};this._customRenderingRuleId={};this._setDefaultFilter=function(){};var S={setInterpolation:"interpolation",setCompressionQuality:"compressionQuality",setCompressionTolerance:"compressionTolerance",setBandIds:"bandIds",setDefaultBandIds:"bandIds",setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setImageFormat:"format"},U,X=new z;Object.keys(S).forEach(n.hitch(this,function(Y){this[Y]=n.hitch(this,function(Z,aa){U={};U[S[Y]]=Z;this.raster&&(this.raster.setFetchParameters(U),X[Y].bind(this)(Z,
aa))})}));this.setDisableClientCaching=function(Y){X.setDisableClientCaching.bind(this)(Y);var Z=this._getSourceImageServiceRaster();Z?Z.disableClientCaching=Y:null}.bind(this);this.setDefinitionExpression=X.setDefinitionExpression.bind(this);this.setUseMapTime=X.setUseMapTime.bind(this);this._toggleTime=X._toggleTime.bind(this);this._onTimeExtentChangeHandler=X._onTimeExtentChangeHandler.bind(this);this.setPixelFilter=X.setPixelFilter.bind(this);this.getHistograms=X.getHistograms.bind(this);this.getRasterFunctionInfos=
X.getRasterFunctionInfos.bind(this);this.getKeyProperties=X.getKeyProperties.bind(this);this.getRasterAttributeTable=X.getRasterAttributeTable.bind(this);this.getRenderingRuleServiceInfo=X.getRenderingRuleServiceInfo.bind(this);this._getRenderingRuleId=X._getRenderingRuleId.bind(this);this._isRenderingRuleAProcessingTemplate=X._isRenderingRuleAProcessingTemplate.bind(this);this.handleSpatialReferenceChange=X.handleSpatialReferenceChange.bind(this);this.onRenderingChange=this.onRenderingChange||function(){};
this.onSpatialReferenceChange=this.onSpatialReferenceChange||function(){};this.onMosaicRuleChange=this.onMosaicRuleChange||function(Y){};this.setRasterRenderer=this.setRenderer;this.getMultidimensionalInfo=X.getMultidimensionalInfo.bind(this);this.getColormap=X.getColormap.bind(this);this.getRenderingRuleColormap=X.getRenderingRuleColormap.bind(this);this.getDefaultMultidimensionalDefinition=X.getDefaultMultidimensionalDefinition.bind(this);this._getDefaultMultidimensionalDefinition=X._getDefaultMultidimensionalDefinition.bind(this);
this._getDefaultDimensionValue=X._getDefaultDimensionValue.bind(this);this.getStatistics=X.getStatistics.bind(this)},_addGeneralProperties:function(){var L=this._getSourceImageServiceRaster();if(L){var T=["minScale","maxScale","tileInfo"];Object.keys(L.serviceInfo).forEach(function(X){null==this[X]&&-1===T.indexOf(X)&&(this[X]=L.serviceInfo[X])}.bind(this));this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);this.bands=L.rasterInfo.statistics;var S,U=[];this.fields=
this.fields||[];for(S=0;S<this.fields.length;S++)U.push(new u(this.fields[S]));this.fields=U;this.version=this.currentVersion;this.defaultMosaicRule=L.serviceInfo.defaultMosaicRule}},setDefaultRenderer:function(){if(this.loaded&&this._canvas&&!this.pixelFilter){var L=Q.createDefaultRenderer(this);if(null!=L){var T=this.mosaicRule&&this.mosaicRule.multidimensionalDefinition&&0<this.mosaicRule.multidimensionalDefinition.length;if(this._multidimensionalInfo&&T&&"Stretch"===L.rendererName){var S=this.mosaicRule.multidimensionalDefinition[0].variableName;
(T=this._multidimensionalInfo.variables.filter(function(U){return U.name===S})[0])&&T.histograms&&T.histograms.length&&(L.histograms=T.histograms,6===L.stretchType&&(L.dra=!1));T&&T.statistics&&T.statistics.length&&(L.statistics=T.statistics.map(function(U){return[U.min,U.max,U.mean,U.stddev||U.standardDeviation]}),6!==L.stretchType&&(L.dra=!1))}this.setRenderer(L,!0)}}},setDefaultInterpolation:function(){if(this.loaded&&this._canvas){var L=this.raster.serviceInfo&&this.raster.serviceInfo.defaultResamplingMethod;
if(L)switch(L.toLowerCase()){case "bilinear":this.interpolation="RSP_BilinearInterpolation";break;case "cubic":this.interpolation="RSP_CubicConvolution";break;case "majority":this.interpolation="RSP_Majority";break;case "nearest":this.interpolation="RSP_NearestNeighbor"}else{L=this.raster.dataType&&this.raster.dataType.toLowerCase();var T=!!this.raster.rasterInfo.colormap;this.raster.rasterInfo.vat||T||"thematic"===L||"StdTime"===L?"RSP_NearestNeighbor":"RSP_BilinearInterpolation"}}},_toggleTime:function(){},
_updateTilingEffects:function(){(this._hasTilingEffects=this._rasterRenderer&&this._rasterRenderer.hasTilingEffects()||this.raster&&this.raster.rasterFunction&&this.raster.rasterFunction.hasTilingEffects())&&this._map&&this.tileMode&&this.useWebGL&&this.tileManager&&(this._hasTilingEffects=!1)},_setMap:function(L,T){this.inherited(arguments);L.spatialReference&&(L.spatialReference.ics||L.spatialReference.icsId)&&(this.roaming=this.useWebGL=this.tileMode=!1);if(this.tileMode){this.virtualTileInfo=
new R(null,{refTileInfo:L.tileInfo,spatialReference:L.spatialReference,extent:this.raster.rasterInfo.extent});var S=this.raster.tileInfo&&(-1<["Elevation","Raster"].indexOf(this.raster.tileInfo.tileType)||3===this.raster.rasterInfo.bandCount&&"U8"===this.raster.rasterInfo.pixelType)?this.raster.tileInfo:this.virtualTileInfo;this._tileParams=this._tileParams||{};this._tileParams.size=S.cols+","+S.rows;this.tileManager=new K({tileInfo:S,layer:this,mapSR:L.spatialReference})}this._dragOrigin={x:0,y:0};
S=this._div=c.create("div",null,T);var U={width:L.width+"px",height:L.height+"px",position:"absolute"};"css-transforms"===L.navigationMode?this.roaming&&this.tileMode&&this.useWebGL||(U[d._css.names.transform]=d._css.translate(L.__visibleDelta.x,L.__visibleDelta.y),this._left=L.__visibleDelta.x,this._top=L.__visibleDelta.y):this._left=this._top=0;a.set(S,U);this._canvas=c.create("canvas",{width:L.width+"px",height:L.height+"px",style:"position: absolute;"},S);p.isDefined(this.opacity)&&a.set(S,"opacity",
this.opacity);this._contextType?(this._context=this._canvas.getContext(this._contextType,null),this.useWebGL=this._context instanceof WebGLRenderingContext):this.useWebGL?(this._context=this._canvas.getContext("webgl",null)||this._canvas.getContext("experimental-webgl",null),this.drawMode=!1):(this._context=this._canvas.getContext("2d"),this.drawMode=!0);this._context||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this.useWebGL&&(L.acquireWebGLContext(this),
this._glSetting={gl:this._context,branchCount:this.raster.rasterFunction?this.raster.rasterFunction.branchCount:0,pingpong:null,branches:null,drawMesh:this._drawMesh,programUniforms:{}});this.raster.rasterFunction&&(this._updateTilingEffects(),this.raster.setProcessingContext({layer:this}));this.setRenderer(this.renderer,!0);this._rasterRenderer||this.setDefaultRenderer();this.interpolation||this.setDefaultInterpolation();this._mapWidth=L.width;this._mapHeight=L.height;this._connects=[];this._connects.push(t.connect(L,
"onPan",this,this._panHandler));this._connects.push(t.connect(L,"onPanEnd",this,this._panEndHandler));"css-transforms"===L.navigationMode?this._connects.push(t.connect(L,"onScale",this,this._onScaleHandler)):(this._connects.push(t.connect(L,"onZoom",this,this._onZoomHandler)),this._connects.push(t.connect(L,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(t.connect(L,"onResize",this,this._onResizeHandler));this._connects.push(t.connect(L,"onExtentChange",this,this._extentChangeHandler));
this._connects.push(t.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(t.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:L.width,height:L.height};this.evaluateSuspension();if(this.suspended&&!L.loaded)var X=t.connect(L,"onLoad",this,function(){t.disconnect(X);X=null;this.evaluateSuspension()});return S},_unsetMap:function(L,T){this.useWebGL&&L.releaseWebGLContext(this);l.forEach(this._connects,t.disconnect,
this);var S=this._div;S&&(T.removeChild(S),c.destroy(S));this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(L){"CancelError"!==L.name&&(this.clear(),this.onError(L))},_clonePixelData:function(L){if(null===L||L.texture)return L;var T={};L.extent&&(T.extent=n.clone(L.extent));var S=L.pixelBlock;null!=
S&&(T.pixelBlock=S.clone());T.texture=L.texture;return T},_setPixelData:function(L){if(L){L=this._clonePixelData(L);this.pixelFilter&&(this.pixelFilter.filter?(this.pixelFilter.renderTexture=!0,this.pixelFilter.filter(L)):this.pixelFilter(L));this.pixelData=L;if(this._rasterReadPromise&&this._rasterReadPromise.isCanceled())return;this._drawPixelData()}this._rasterReadPromise=null},_requestData:function(L,T,S){this._rasterReadPromise&&this._rasterReadPromise.cancel();L=n.clone(L)._normalize(!0);this._rasterReadPromise=
this.raster.read({extent:L,width:this._map.width,height:this._map.height});this._rasterReadPromise.then(n.hitch(this,function(U){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=U&&U.srcData?{extent:U.extent,src:U.srcData}:U,this.useWebGL&&this._glSetting&&(this._glSetting.hasNewTexture=!0),this._setPixelData(U))}),n.hitch(this,this._requestDataErrorHandler));return this._rasterReadPromise},_drawPixelData:function(L){a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+
"px",height:this._map.height+"px"});this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),a.set(this._canvas,d._css.names.transform,d._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});this.useWebGL&&this._rasterRenderer&&this._rasterRenderer.draw(this.pixelData);
if(this._canDraw()&&this.drawMode&&this.drawMode&&(L=L||this.pixelData)&&L.pixelBlock){var T=this.pixelFilter?this.pixelData:this._rasterRenderer?this._rasterRenderer.draw(L):L;L=T.pixelBlock;var S=this._context,U=S.createImageData(L.width,L.height);U.data.set(L.getAsRGBA());T=T.extent;var X=this._map.extent,Y=this.getCurrentResolution(),Z=0,aa=0;Math.abs(T.xmin-X.xmin)>Y.x&&(Z=Math.round((T.xmin-X.xmin)/Y.x));Math.abs(X.ymax-T.ymax)>Y.y&&(aa=Math.round((X.ymax-T.ymax)/Y.y));"css-transforms"===this._map.navigationMode?
(this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),a.set(this._canvas,d._css.names.transform,d._css.translate(-this._left,-this._top))):(a.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};this.tileMode?this.clear(Z,aa,L.width,L.height):this.clear();
S.putImageData(U,Z,aa,0,0,L.width,L.height);this._fireUpdateEnd()}},hasStdTime:function(){if(!this.hasMultidimensions||"StdTime"!==this.raster.dataType)return!1;var L=this.mosaicRule&&this.mosaicRule.multidimensionalDefinition,T=L&&L.length?L[0].variableName:this._defaultMultidimensionalDefinition[0].variableName;return this.raster.rasterInfo.multidimensionalInfo.variables.some(function(S){if(S.name===T)return S.dimensions.some(function(U){return"StdTime"===U.name})})},getStdTimeValue:function(L){return(new Date(864E5*
(L-25569))).toString()},_animatePan2d:function(){this._oldDelta&&this._delta.x===this._oldDelta.x&&this._delta.y===this._oldDelta.y||(this.tileManager.updateTile(this.tileManager.originalPixelData,!0),this._oldDelta={x:this._delta.x,y:this._delta.y});this._roamingAnimation&&this.tileMode&&this.useWebGL&&(this._roamingAnimation=requestAnimationFrame(this._animatePan2d))},_cancelAnimation:function(){this._animation&&(cancelAnimationFrame(this._animation),this._animation=null)},_updateAllTilesOnce:function(L,
T){return this.tileManager.updateTile(L,!0).then(n.hitch(this,function(S){(this._hasTilingEffects||this.useWebGL||T)&&this._drawOneFrame(S)}))},_drawOneFrame:function(L,T){if(!(this.suspended||!this._map||this.tileMode&&!this._drawTile||(this.tileMode&&this.useWebGL&&this.tileManager.originalPixelData.isEmpty&&this._context.clear(this._context.COLOR_BUFFER_BIT),this.tileMode&&this.useWebGL&&this.tileManager.xformSetting&&this.tileManager.xformSetting.requireProjection&&!this.tileManager.xformSetting.gridConfig))){if(!this._resetCss||
this._levelChange)this._levelChange=!1,this._resetDrawing();if(L&&(L.renderedPixelBlock||L.pixelBlock)&&this._canDraw()&&this.drawMode){T=L.extent;var S=this._map.extent;if(!this._isExtentOutSide(T,S)){var U=L.pixelBlock||L.renderedPixelBlock,X=this._context,Y=X.createImageData(U.width,U.height);Y.data.set((L.renderedPixelBlock||L.pixelBlock).getAsRGBA());L=this.getCurrentResolution();var Z=0,aa=0;Math.abs(T.xmin-S.xmin)>L.x&&(Z=Math.round((T.xmin-S.xmin)/L.x));Math.abs(S.ymax-T.ymax)>L.y&&(aa=Math.round((S.ymax-
T.ymax)/L.y));X.putImageData(Y,Z,aa,0,0,U.width,U.height)}}else this._fireUpdateEnd()}},_isExtentOutSide:function(L,T){return L.xmax<=T.xmin||L.xmin>=T.xmax||L.ymax<=T.ymin||L.ymin>=T.ymax},_resetDrawing:function(){this._resetCss=!0;if(!this.useWebGL)if(this._multiply||this._startRect.width!==this._map.width||this._startRect.height!==this._map.height)this.clear();else{var L=this._context.getImageData(0,0,this._map.width,this._map.height);this.clear();this._context.putImageData(L,this._startRect.left,
this._startRect.top)}this._dragOrigin={x:0,y:0};this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});"css-transforms"===this._map.navigationMode?(this.roaming&&this.tileMode&&this.useWebGL&&(this._delta=null),this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),a.set(this._canvas,d._css.names.transform,
d._css.translate(-this._left,-this._top))):(a.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}))},_drawAllFrames:function(){if(!this.suspended&&this._map&&(!this.tileMode||this._drawTile))if(this._resetCss){var L=this._frames,T=0,S;for(S=0;S<L.length;S++)if(L[S].completed)T++;else if(L[S].tileData.renderedPixelBlock){L[S].completed=!0;var U=L[S].tileData;break}else if(L[S].tileData._fetched&&
!L[S].tileData.src){L[S].completed=!0;break}else if(L[S].tileData.update&&L[S].tileData.update.isFulfilled()&&!L[S].tileData.renderedPixelBlock){L[S].completed=!0;break}else L[S].tileData.fetch&&(!0===L[S].tileData.fetch||L[S].tileData.fetch.isCanceled()||L[S].tileData.fetch.isRejected())?(L[S].completed=!0,T++):this._isExtentOutSide(L[S].tileData.extent,this._map.extent)&&(L[S].completed=!0,T++);if(U){T++;var X=U.extent,Y=this._map.extent,Z=this.getCurrentResolution(),aa=S=0;Math.abs(X.xmin-Y.xmin)>
Z.x&&(S=Math.round((X.xmin-Y.xmin)/Z.x));Math.abs(Y.ymax-X.ymax)>Z.y&&(aa=Math.round((Y.ymax-X.ymax)/Z.y));U.renderedPixelBlock?(X=U.renderedPixelBlock,Y=this._context.createImageData(X.width,X.height),Y.data.set(U.renderedPixelBlock.getAsRGBA()),this._context.putImageData(Y,S,aa,0,0,X.width,X.height)):this.clear(S,aa,U.width,U.height)}T===L.length?(this._animation=null,this._fireUpdateEnd()):this._animation=requestAnimationFrame(n.hitch(this,this._drawAllFrames))}else this._resetDrawing(),this._animation=
requestAnimationFrame(n.hitch(this,this._drawAllFrames))},_fetchTiles:function(L,T){if(!this.suspended&&this.loaded){this._cancelAnimation();var S=this.tileManager,U=!(S.xformSetting.requireProjection&&S.xformSetting.requirePE)||M.load();g(U,n.hitch(this,function(){S.updateExtent(L,this.getCurrentResolution());this._resetCss=!1;S.fetchTiles(T);T&&(this._hasTilingEffects||this.useWebGL?this.useWebGL&&0<S.tiles.length?(S.fillupTiles(),S._validateRawPixelBlocks(S.originalPixelData)?this._updateAllTilesOnce(S.originalPixelData):
S.originalPixelData&&S.originalPixelData.src&&S.tiles.some(function(X){return X.updateCompleted})&&this._context.clear(this._context.COLOR_BUFFER_BIT),S.tiles.forEach(n.hitch(this,function(X){X.update&&!X.updateCompleted&&X.update.then(function(Y){X.updateCompleted||(X.updateCompleted=!0);(this._hasTilingEffects||this.useWebGL)&&this._drawOneFrame(Y)}.bind(this))}))):this._hasTilingEffects&&g(S.fetchAllCompleted.isResolved()||S.fetchAllCompleted,n.hitch(this,function(){this._updateAllTilesOnce(S.originalPixelData)})):
(this._frames=S.tiles.map(function(X){return{completed:!1,tileData:X}}),this._drawAllFrames()))}))}},_redrawTiles:function(){this._fetchTiles(this._map.extent,!0)},_panHandler:function(L,T){this._drawTile=!1;"css-transforms"===this._map.navigationMode?this.roaming&&this.tileMode&&this.useWebGL?(this._delta=T,!this._roamingAnimation&&this.tileMode&&(this._roamingAnimation=requestAnimationFrame(this._animatePan2d))):(this._left=this._map.__visibleDelta.x+T.x,this._top=this._map.__visibleDelta.y+T.y,
a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top))):a.set(this._div,{left:this._startRect.left+T.x+"px",top:this._startRect.top+T.y+"px"});this.tileMode&&this._fetchTiles(L)},_panEndHandler:function(L,T){T&&(this._startRect.left+=T.x,this._startRect.top+=T.y);this.oldData=null;this._roamingAnimation&&(cancelAnimationFrame(this._roamingAnimation),this._oldDelta=this._roamingAnimation=null)},_onScaleHandler:function(L,T){var S={},U=d._css.names;a.set(this._canvas,U.transition,
T?"none":U.transformName+" "+W+"ms ease");this._matrix=L;L=this._multiply?f.multiply(L,this._multiply):L;if(this._tdx||this._tdy)L=f.multiply(L,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});S[U.transform]=d._css.matrix(L);a.set(this._canvas,S)},_onZoomHandler:function(L,T,S){var U=this._startRect;L=U.width*T;T*=U.height;var X=U.left-(L-U.width)*(S.x-U.left)/U.width;S=U.top-(T-U.height)*(S.y-U.top)/U.height;a.set(this._canvas,{left:X+"px",top:S+"px",width:L+"px",height:T+"px"});this._endRect=
{left:X,top:S,width:L,height:T}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(L,T,S){a.set(this._div,{width:T+"px",height:S+"px"});a.set(this._canvas,{width:T+"px",height:S+"px"});this._startRect.width=this._canvas.width=T;this._startRect.height=this._canvas.height=S;this.useWebGL&&this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null)},_extentChangeHandler:function(L,T,S,U){if(this.loaded&&!this.suspended&&(!T||0!==
T.x||0!==T.y||S)){this._drawTile=!0;"css-transforms"===this._map.navigationMode&&(T&&(this._dragOrigin.x+=T.x,this._dragOrigin.y+=T.y),this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,this.roaming&&this.tileMode&&this.useWebGL||S||a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),S&&(a.set(this._canvas,d._css.names.transition,"none"),this._multiply=this._multiply?f.multiply(this._matrix,this._multiply):this._matrix,this._levelChange=!0));this._fireUpdateStart();
var X=this._map;T=this.raster.rasterFunction?this.raster.getMemberRasters().map(function(Z){return Z._rasterId}):[this.raster._rasterId];var Y={};this.tileMode?((this.roaming||this.useWebGL)&&this.tileMode||(T.forEach(function(Z,aa){Y[Z]={extent:X.extent,pixelBlock:new P({width:X.width,height:X.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}),this.tileManager.originalPixelData={extent:X.extent,src:Y}),this.projectedFullExtent?this._fetchTiles(L,!0):this._getProjectedFullExtent(X.spatialReference).then(n.hitch(this,
function(){this._fetchTiles(L,!0)}))):this._requestData(X.extent,X.width,X.height)}},_visibilityChangeHandler:function(L){L?v.show(this._div):v.hide(this._div)},_opacityChangeHandler:function(L){a.set(this._div,"opacity",L)}});e("extend-esri")&&n.setObject("layers.RasterXLayer",H,d);return H})},"esri/layers/rasterLib/raster/rasterFactory":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/sniff dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../urlUtils ./ImageServiceRaster ./TileServiceRaster ./TileRaster ./FunctionRaster".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q){H={customDrivers:[],create:function(w){if(w){if(w.url){var y=d.urlToObject(w.url);var x=y.path;var E=y.query}y=w.serviceInfo;var B=w.rasterFxArgs||{},C=new l,G=t.hitch(this,function(u){console.error(u);this._trycustomDrivers(t.mixin({url:x},w),0,C)});if(x)if(-1===x.toLowerCase().indexOf("imageserver")&&-1===x.toLowerCase().indexOf("mapserver")){var I=new v(t.mixin({},w,{url:x}));w.rasterFx&&(I=new q({rasterFx:w.rasterFx,rasterFxArgs:t.mixin({},B,{raster:I})}));
var D=I}else{D=new l;y=y||this._getServiceInfo(x,E);var r=t.hitch(this,function(u){u.bandCount?I=u.capabilities&&-1<u.capabilities.toLowerCase().indexOf("tileonly")?new p(t.mixin({},{serviceInfo:u},E,w,{url:x})):new m(t.mixin({},{serviceInfo:u},E,w,{url:x})):u.tileInfo&&(I=new p(t.mixin({},{serviceInfo:u},E,this._options,{url:x})));w.rasterFx&&(I=new q({rasterFx:w.rasterFx,rasterFxArgs:t.mixin({},B,{raster:I})}));D.resolve(I)});a(y,r,G)}else D=I=new q({rasterFx:w.rasterFx,rasterFxArgs:t.mixin({},
B,{raster:I})});a(D,t.hitch(this,function(u){u?u.open().then(t.hitch(this,function(A){C.resolve(u)}),G):G(Error("There is no raster to open"))}),G);return C.promise}},register:function(w){this.customDrivers=this.customDrivers||[];0<this.customDrivers.filter(function(y){return y.sourceType===w.prototype.sourceType}).length||this.customDrivers.push(w)},_trycustomDrivers:function(w,y,x){x=x||new l;var E=this.customDrivers[y];if(E){var B=new E(w);B.open().then(t.hitch(this,function(C){x.resolve(B)}),
t.hitch(this,function(C){this._trycustomDrivers(w,y+1,x)}))}else x.reject("cannot load layer "+(w&&w.url||""));return x.promise},_getServiceInfo:function(w,y){y=y||{};var x=y.bandIds;y=y.renderingRule;var E=new l(h._dfdCanceller),B={f:"json"};x&&(B.bandIds=x);y&&(B.renderingRule=y.toJson?JSON.stringify(y.toJson()):JSON.stringify(y));E._pendingDfd=g({url:w,content:B,handleAs:"json",callbackParamName:"callback"});E._pendingDfd.then(function(C){E.callback(C)},function(C){E.errback(C)});return E.promise}};
c("extend-esri")&&t.setObject("layers.rasterLib.raster.rasterFactory",H,b);return H})},"esri/layers/rasterLib/raster/ImageServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../WKIDUnitConversion ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ./RasterInfo ./BasicRaster ../../rasterFormats/rasterCodec ../tile/RasterTileInfo".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q,w,y,x,E,B,C,G,I,D){H=n([G],{declaredClass:"esri.layers.rasterLib.raster.ImageServiceRaster",sourceType:"ImageService",constructor:function(r){r&&(this._imageServiceParams=r.imageServiceParameters,this._commonReqParams=r._commonReqParams,this._imageServiceParams||(this._imageServiceParams={interpolation:r.interpolation,pixelType:r.pixelType,format:r.format||"lerc",compressionQuality:r.compressionQuality,bandIds:r.bandIds,noDataInterpretation:r.noDataInterpretation,
adjustAspectRatio:r.adjustAspectRatio,mosaicRule:r.mosaicRule,renderingRule:r.interpolation}))},open:function(){var r=new l;if(this.serviceInfo&&this.rasterInfo)return this.loaded=!0,this._findCredential(),this.setFetchParameters(this._imageServiceParams),r.resolve(this),r.promise;var u=this.serviceInfo||this._generateServiceInfo(this._imageServiceParams&&this._imageServiceParams.renderingRule),A=t.hitch(this,function(O){this._fixServiceInfo(O);this.serviceInfo=O;this._findCredential();var P=this._parseRasterInfo(O),
z={};O.defaultMosaicMethod?(z.method=O.defaultMosaicMethod,z.operation=O.mosaicOperator,z.sortField=O.sortField,z.sortValue=O.sortValue):z.method=x.METHOD_NONE;this.serviceInfo.defaultMosaicRule=new x(z);this.serviceInfo.defaultMosaicRule.ascending=!0;O=this._getColormap(this);z=this._getHistograms(this);var F=this._getRasterAttributeTable(this),M=this._getKeyProperties(this),Q=this._getMultidimensionalInfo(),R=this._getSlices();(new b([O,z,F,M,Q,R])).then(t.hitch(this,function(K){K[0][0]&&(P.colormap=
K[0][1]);K[1][0]&&(P.histograms=K[1][1]);K[2][0]&&(P.vat=K[2][1]);K[3][0]&&(P.keyProperties=K[3][1]);K[4][0]&&(P.multidimensionalInfo=K[4][1]);this._slices=K[5][0]?K[5][1]:null;P.keyProperties&&P.keyProperties.DataType&&(this.dataType=P.keyProperties.DataType);this.loaded=!0;this.rasterInfo=P;this.setFetchParameters(this._imageServiceParams);r.resolve(this)}))}),J=t.hitch(this,function(O){this.loaded=!0;r.reject(O)});f(u,A,J);return r.promise},setFetchParameters:function(r,u){if(u)this.imageServiceParams=
r;else{var A=this.imageServiceParams;A&&r?Object.keys(r).forEach(function(J){A[J]=r[J]}):this.imageServiceParams=r}this._constructGetImageParams();this._getRasterIdentifier(!0)},read:function(r){if(r.pixelBlock||r.texture){var u=new l;u.resolve(r);return u.promise}if(!1===r.virtual&&this.tileInfo&&!this.tileInfo.virtual)return this.readTile(r);if(this._slices){var A=this._getSliceId();if(null==A)return u=new l,u.resolve(r),u.promise}var J=r.extent,O=J.spatialReference.wkid||c.toJson(J.spatialReference.toJson(!1)),
P=r.timeExtent?r.timeExtent.toJson().join(","):null;u=this.url+"/exportImage";var z={};this._slices&&(z.sliceid=A);this.disableClientCaching&&(z._ts=(new Date).getTime());A=t.mixin({},this._commonReqParams,{bbox:J.xmin+","+J.ymin+","+J.xmax+","+J.ymax,imageSR:O,bboxSR:O,size:r.width+","+r.height,time:P},z);return this._requestPixels({url:u,payload:A,decodeParams:{width:r.width,height:r.height,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:!1},tileOptions:r})},readTile:function(r){var u=
this.tileBoundary&&this.tileBoundary[r.level];if(u&&(u.minRow>r.row||u.maxRow<r.row||u.minCol>r.col||u.maxCol<r.col)){var A=new l;A.resolve(r);return A.promise}if(this._slices&&(A=this._getSliceId(),null==A))return A=new l,A.resolve(r),A.promise;u=this.url+"/tile/"+r.level+"/"+r.row+"/"+r.col;var J={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===r.tileType.toLowerCase()?!0:!1};A=this._slices?"sliceid\x3d"+A+"\x26":"";
A=this.disableClientCaching?"_ts\x3d "+(new Date).getTime():A.replace(/&$/,"");return this._requestPixels({url:u+(0<A.length?"?"+A:""),payload:{},decodeParams:J,tileOptions:r})},toJson:function(){return{url:this.url,tileInfo:this.tileInfo,rasterInfo:this.rasterInfo,serviceInfo:this.serviceInfo,sourceType:this.sourceType,_commonReqParams:this._commonReqParams,_rasterId:this._rasterId}},_getSliceId:function(){var r=t.clone(this._imageServiceParams.multidimensionalDefinition),u=t.clone(this._imageServiceParams.time);
if(null==this._slices||null==u&&(null==r||0===r.length))return 0;var A=r||this.defaultMultidimensionalDefinition,J=A[0].variableName;A=this._getAllDimensionDefinition(A,J).definition;r=null;if(null==A||0===A.length)return null;if(u&&this.serviceInfo.timeInfo){if(null==u[1]||u[1]===u[0])var O=u[0];else{var P=this.serviceInfo.timeInfo.startTimeField;O=this.rasterInfo.multidimensionalInfo.variables.find(function(M){return M.name===J}).dimensions.find(function(M){return M.name===P}).values.filter(function(M){return Array.isArray(M)?
Math.max(M[0],u[0])<Math.min(M[1],u[1]):M>=u[0]&&M<=u[1]}).sort(function(M,Q){M=Array.isArray(M)?M[1]:M;Q=Array.isArray(Q)?M[1]:Q;return Math.abs(u[1]-M)-Math.abs(u[1]-Q)})[0]||[u[1]]}A.some(function(M){if(M.dimensionName===P)return M.values[0]=O,!0;if(!M.dimensionName)return M.dimensionName=P,M.isSlice=!0,M.values=[O],!0})||A.push({variableName:J,dimensionName:P,isSlice:!0,values:[O]})}for(var z=0;z<this._slices.length;z++){var F=this._slices[z].multidimensionalDefinition;if(F.length===A.length&&
!F.some(function(M){var Q=A.filter(function(K){return M.variableName===K.variableName&&K.dimensionName===M.dimensionName})[0];if(!Q)return!0;var R=Array.isArray(M.values[0])?M.values[0][0]:M.values[0];Q=Array.isArray(Q.values[0])?Q.values[0][0]:Q.values[0];return R!==Q})){r=z;break}}return r},_getAllDimensionDefinition:function(r,u){var A=r.map(function(O){return O.dimensionName}),J=!1;this.rasterInfo.multidimensionalInfo.variables.forEach(function(O){O.name!==u||O.dimensions.length===r.length&&A[0]||
(O.dimensions.forEach(function(P){0>A.indexOf(P.name)&&(A[0]?r.push({variableName:u,dimensionName:P.name,values:[P.values[0]]}):(r[0].dimensionName=P.name,r[0].values=[P.values[0]],P[0]=P.name))}),J=!0)},this);return{defChanged:J,definition:r}},_generateServiceInfo:function(r){var u=this.url,A=new l(w._dfdCanceller);A._pendingDfd=d({url:u,content:{f:"json",renderingRule:r?c.toJson(r.toJson()):null},handleAs:"json",callbackParamName:"callback"});A._pendingDfd.then(function(J){A.callback(J)},function(J){A.errback(J)});
return A},_fixServiceInfo:function(r){var u=r.spatialReference.wkid;r.tileInfo&&0===r.extent.xmin&&360===r.extent.xmax&&u&&null==q[u]&&(r.tileInfo.applyGCS360Transform=!0)},_parseRasterInfo:function(r){var u=new C;u.bandCount=r.bandCount;u.extent=new m(r.fullExtent);u.spatialReference=r.spatialReference;u.pixelType=r.pixelType;u.width=Math.floor((r.fullExtent.xmax-r.fullExtent.xmin)/r.pixelSizeX+.5);u.height=Math.floor((r.fullExtent.ymax-r.fullExtent.ymin)/r.pixelSizeY+.5);u.cellSize=new p({x:r.pixelSizeX,
y:r.pixelSizeY,spatialReference:r.spatialReference});var A;if(r.minValues&&0<r.minValues.length&&r.maxValues&&r.stdvValues&&r.meanValues){var J=[];for(A=0;A<r.minValues.length;A++)J.push({min:r.minValues[A],max:r.maxValues[A],mean:r.meanValues[A],stddev:r.stdvValues[A]});r.bandCount!==J.length&&(J=null)}this.dataType=r.serviceDataType?r.serviceDataType.replace("esriImageServiceDataType",""):"Generic";u.statistics=J;r.objectIdField&&r.fields&&(u.catalogInfo={objectIdField:r.objectIdField,fields:r.fields});
u.timeInfo=r.timeInfo;if(r.tileInfo){this.tileInfo=new D(r.tileInfo);this.tileInfo.tileType=r.cacheType||"Map";u.tileInfo=this.tileInfo;var O=u.extent,P=this.tileInfo.origin,z=this.tileInfo.cols,F=this.tileInfo.rows;this.tileBoundary=this.tileInfo.lods.map(function(M){return{minCol:Math.floor((O.xmin-P.x+.1*M.resolution)/z/M.resolution),maxCol:Math.floor((O.xmax-P.x-.1*M.resolution)/z/M.resolution),minRow:Math.floor((P.y-O.ymax+.1*M.resolution)/F/M.resolution),maxRow:Math.floor((P.y-O.ymin-.1*M.resolution)/
F/M.resolution)}})}return u},_getColormap:function(r){r=this.url+"/colormap";var u=new l(w._dfdCanceller),A={f:"json"},J=this.serviceInfo.hasColormap||this.rasterInfo&&this.rasterInfo.hasColormap;10<this.serviceInfo.currentVersion&&J?(u._pendingDfd=d({url:r,content:A,handleAs:"json",callbackParamName:"callback"}),u._pendingDfd.then(function(O){u.callback(O.colormap)},function(O){u.errback(O)})):u.callback(null);return u},_getHistograms:function(r){var u=this.url+"/histograms",A=new l(w._dfdCanceller),
J={f:"json"},O=this.serviceInfo.hasHistograms||this.rasterInfo&&this.rasterInfo.hasHistograms;r&&r.renderingRule&&(J.renderingRule=c.toJson(r.renderingRule.toJson()),O=!0);10<this.serviceInfo.currentVersion&&O?(A._pendingDfd=d({url:u,content:J,handleAs:"json",callbackParamName:"callback"}),A._pendingDfd.then(function(P){A.callback(P.histograms)},function(P){A.errback(P)})):A.callback(null);return A},_getRasterAttributeTable:function(r){var u=this.url+"/rasterAttributeTable",A=new l(w._dfdCanceller),
J={f:"json"},O=this.serviceInfo.hasRasterAttributeTable;r&&r.renderingRule&&(J.renderingRule=c.toJson(r.renderingRule.toJson()),O=!0);10<this.serviceInfo.currentVersion&&O?(A._pendingDfd=d({url:u,content:J,handleAs:"json",callbackParamName:"callback"}),A._pendingDfd.then(function(P){A.callback(P)},function(P){A.errback(P)})):A.callback(null);return A},_getKeyProperties:function(r){var u=this.url+"/keyProperties",A=new l(w._dfdCanceller),J={f:"json"};r&&r.renderingRule&&(J.renderingRule=c.toJson(r.renderingRule.toJson()));
10<this.serviceInfo.currentVersion?(A._pendingDfd=d({url:u,content:J,handleAs:"json",callbackParamName:"callback"}),A._pendingDfd.then(function(O){A.callback(O)},function(O){A.errback(O)})):A.callback(null);return A},_getMultidimensionalInfo:function(){var r=this.url+"/multidimensionalInfo",u=new l(w._dfdCanceller);10.3<=this.serviceInfo.currentVersion&&this.serviceInfo.hasMultidimensions?(u._pendingDfd=d({url:r,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),u._pendingDfd.then(t.hitch(this,
function(A){u.callback(A.multidimensionalInfo)}),function(A){u.errback(A)})):u.callback(null);return u},_getSlices:function(){var r=this.url+"/slices",u=new l(w._dfdCanceller);this.serviceInfo.hasMultidimensions?(u._pendingDfd=d({url:r,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),u._pendingDfd.then(t.hitch(this,function(A){u.callback(A.slices)}),function(A){u.errback(A)})):u.callback(null);return u},_initializationFailed:function(){},_constructGetImageParams:function(){var r=
this.imageServiceParams||{},u=t.mixin({},this._query,{f:"image",interpolation:r.interpolation,pixelType:r.pixelType,format:r.format||"lerc",compressionQuality:r.compressionQuality,bandIds:r.bandIds?r.bandIds.join(","):null,noData:null!=r.noData?r.noData.join(","):null,noDataInterpretation:r.noDataInterpretation,adjustAspectRatio:null==r.adjustAspectRatio?null:r.adjustAspectRatio,mosaicRule:r.mosaicRule?c.toJson(r.mosaicRule.toJson()):null,renderingRule:r.renderingRule?c.toJson(r.renderingRule.toJson()):
null,token:this.credential&&this.credential.token||null});"lerc"===u.format.toLowerCase()?(u.compressionTolerance=r.compressionTolerance,10.5<=this.serviceInfo.currentVersion&&(u.lercVersion=r.lercVersion||2)):"tiff"===u.format.toLowerCase()?u.compression=r.compression:-1<["jpg","jpeg","jpg","jpgpng"].indexOf(u.format.toLowerCase())&&(u.compression=r.compression);this._commonReqParams=u},_getRasterIdentifier:function(r){if(this._rasterId)return this._rasterId;r=this.url.replace("http:","").replace("https:",
"");var u=[],A=this.imageServiceParams||{};u.push(r);u.push(A.interpolation);u.push(A.pixelType);u.push(A.compressionQuality);u.push(A.bandIds?A.bandIds.join(","):"");u.push(A.mosaicRule?c.toJson(A.mosaicRule.toJson()):"");u.push(A.renderingRule?c.toJson(A.renderingRule.toJson()):"");r=u.join("|");return this._rasterId=this._computeSignature(r)},_wrapExtent:function(r){var u=r.spatialReference._getInfo();if(u){var A=u.valid[0];u=u.valid[1];if(r.xmin<A-this.resolution.x||r.xmax>u+this.resolution.y){var J=
new m((r.xmin-A)%(u-A),r.ymin,(r.xmax-u)%(u-A),r.ymax,r.spatialReference);J.xmax<J.xmin&&(J=null)}}return J||r}});a("extend-esri")&&t.setObject("layers.rasterLib.raster.ImageServiceRaster",H,g);return H})},"esri/layers/rasterLib/raster/RasterInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../../SpatialReference","../tile/RasterTileInfo"],function(H,n,t,l,k){return H(null,{declaredClass:"esri.layers.rasterLib.raster.RasterInfo",bandCount:null,pixelType:null,
extent:null,spatialReference:null,width:null,height:null,colormap:null,attributeTable:null,multiDimensionalInfo:null,statistics:null,histograms:null,catalogInfo:null,keyProperties:null,cellSize:null,format:null,compression:null,compressionQuality:null,packetSize:null,geodataXform:null,constructor:function(e){n.mixin(this,e);this.extent=this.extent?this.extent.toJson?this.extent:new t(this.extent):null;this.spatialReference=this.spatialReference?this.spatialReference.toJson?this.spatialReference:new l(this.spatialReference):
null;this.tileInfo=this.tileInfo?this.tileInfo.toJson?this.tileInfo:new k(this.tileInfo):null},toJson:function(){return{bandCount:this.bandCount,pixelType:this.pixelType,extent:this.extent&&this.extent.toJson?this.extent.toJson():this.extent,spatialReference:this.spatialReference&&this.spatialReference.toJson?this.spatialReference.toJson():this.spatialReference,width:this.width,height:this.height,colormap:this.colormap?n.clone(this.colormap):null,attributeTable:this.attributeTable?n.clone(this.attributeTable):
null,multiDimensionalInfo:this.multiDimensionalInfo?n.clone(this.multiDimensionalInfo):null,statistics:this.statistics?n.clone(this.statistics):null,histograms:this.histograms?n.clone(this.histograms):null,catalogInfo:this.catalogInfo?n.clone(this.catalogInfo):null,keyProperties:this.keyProperties?n.clone(this.keyProperties):null,cellSize:this.cellSize&&this.cellSize.toJson?this.cellSize.toJson():this.cellSize,tileInfo:this.tileInfo&&this.tileInfo.toJson?this.tileInfo.toJson():this.tileInfo,format:this.format,
compression:this.compression,compressionQuality:this.compressionQuality,packetSize:this.packetSize,geodataXform:this.geodataXform?n.clone(this.geodataXform):null}},clone:function(){return new this.constructor(this.toJson())}})})},"esri/layers/rasterLib/tile/RasterTileInfo":function(){define("dojo/_base/declare dojo/_base/lang ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../../lang ../../TileInfo".split(" "),function(H,n,t,l,k,e,c){return H([c],{declaredClass:"esri.layers.rasterLib.tile.RasterTileInfo",
rows:512,cols:512,compressionQuality:95,lercError:.01,spatialReference:null,origin:null,virtual:!0,tileType:"Raster",constructor:function(a,b){if(a||b){var f=b&&b.refTileInfo;a?this.virtual=!1:(this.virtual=!0,n.mixin(this,{rows:b.rows||this.rows,cols:b.cols||this.cols,compressionQuality:b.compressionQuality||95,lercError:b.compressionTolerance||.01,spatialReference:b.spatialReference,origin:b.origin}),this.width=this.cols,this.height=this.rows,this.origin||(f?this.origin=f.origin:b.spatialReference.isWebMercator()||
b.extent&&360<=Math.max(Math.abs(b.extent.xmin),Math.abs(b.extent.xmax))?this.origin={x:-2.0037508342787E7,y:2.0037508342787E7}:-1<[4326,4269].indexOf(b.spatialReference.wkid)||360>Math.max(Math.abs(b.extent.xmin),Math.abs(b.extent.xmax))?this.origin={x:-180,y:90}:this.origin={x:b.extent.xmin,y:b.extent.ymax}))}},toJson:function(){var a=c.prototype.toJson.apply(this);a.tileType=this.tileType;a.virtual=this.virtual;a.lercError=this.lercError;return a},clone:function(){return new this.prototype(this.toJson())}})})},
"esri/layers/rasterLib/raster/BasicRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterHandler ./rasterProjectionHelper ./RasterInfo".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q,w,y,x,E,B,C,G,I){return n([h],{url:null,dataType:null,rasterInfo:null,tileInfo:null,serviceInfo:null,loaded:null,constructor:function(D){if(D){var r=D.url;r&&(r=w.urlToObject(r),this.url=r.path,this._query=r.query);this.dataType=D.dataType;this.serviceInfo=D.serviceInfo;this.rasterInfo=D.rasterInfo;this.tileInfo=D.tileInfo;this.serviceInfo=D.serviceInfo}},open:function(){},read:function(D){},identify:function(D){var r=new l,u=this.rasterInfo.extent;if(G.requirePE(u.spatialReference,
D.spatialReference))G.load().then(t.hitch(this,function(){A=G.project(D,u.spatialReference);r.resolve(A)}),function(){r.reject(Error("cannot project into this spatial reference"))});else{var A=G.project(D,u.spatialReference);r.resolve(A)}return r.then(t.hitch(this,function(J){var O=this.tileInfo,P=O.origin,z=O.lods[O.lods.length-1],F=(J.x-P.x)/O.cols/z.resolution;J=(P.y-J.y)/O.rows/z.resolution;var M=Math.round((J-Math.floor(J))*O.rows)*O.cols+Math.round((F-Math.floor(F))*O.cols);P=new m(P.x+z.resolution*
O.cols*F,P.y-z.resolution*O.rows*(J+1),P.x+z.resolution*O.cols*(F+1),P.y-z.resolution*O.rows*J,u.spatialReference);var Q=this.getMemberRasters?this.getMemberRasters()[0]:this;return Q.read({level:z.level,row:Math.floor(J),col:Math.floor(F),extent:P,width:O.cols,height:O.rows,virtual:Q.tileInfo.virtual,tileType:Q.tileInfo.tileType}).then(function(R){return(R=R&&R.pixelBlock)&&R.pixels&&0<R.pixels.length&&(!R.mask||R.mask[M])?{pixelValue:R.pixels.map(function(K){return K[M]})}:{pixelValue:null}})}))},
getProjectedFullExtent:function(D,r){var u=new l;if(this.projectedFullExtent&&!r)return u.resolve(this.projectedFullExtent),u.promise;var A=this.rasterInfo.extent;if(G.requirePE(this.rasterInfo.extent.spatialReference,D))G.load().then(t.hitch(this,function(){J=G.project(A,D);this.projectedFullExtent=J=new m(J.toJson());u.resolve(J)}),function(){u.reject(Error("cannot project into this spatial reference"))});else{var J=G.project(A,D);this.projectedFullExtent=J=new m(J.toJson());u.resolve(J)}return u.promise},
setFetchParameters:function(D,r){},_setRasterHandler:function(D){this._rasterHandler=D;this.getMemberRasters&&this.getMemberRasters().forEach(t.hitch(this,function(r){r._rasterHandler=D}))},_findCredential:function(){this.url&&((this._credential=g.id&&g.id.findCredential(this.url))&&this._credential.ssl||this.serviceInfo&&this.serviceInfo._ssl)&&(this.url=this.url.replace(/^http:/i,"https:"))},_initWorker:function(){this._rasterHandler=new C;this._rasterHandler.start().then(function(){this._rasterHandlerInitialized=
!0}.bind(this))},_requestPixels:function(D){var r=D.url,u=D.payload,A=D.decodeParams,J=D.tileOptions,O=new l(q._dfdCanceller);this._rasterHandler||this._initWorker();var P=this._rasterHandler,z={};r={url:r,handleAs:"arraybuffer",content:u};D.headers&&(r.headers=D.headers);O._pendingDfd=d(r).then(t.hitch(this,function(F){(P&&this._rasterHandlerInitialized?P.decode({encodedData:F,decodeParams:A}):B.decode(F,A)).then(function(M){z.pixelBlock=new E(M);z.extent=J.extent;z.level=J.level;z.row=J.row;z.col=
J.col;z.width=J.width;z.height=J.height;q._resDfd(O,[z])},function(M){q._resDfd(O,[M],!0)})}),function(F){q._resDfd(O,[F],!0)});return O},_computeSignature:function(D){if("string"===typeof D){for(var r=new Uint8Array(D.length),u=0;u<D.length;u++)r[u]=D.charCodeAt(u);D=r}u=r=65535;for(var A=D.length,J=Math.floor(A/2),O=0;J;){var P=359<=J?359:J;J-=P;do r+=D[O++]<<8,u+=r+=D[O++];while(--P);r=(r&65535)+(r>>>16);u=(u&65535)+(u>>>16)}A&1&&(u+=r+=D[O]<<8);return((u&65535)+(u>>>16)<<16|(r&65535)+(r>>>16))>>>
0}})})},"esri/layers/rasterFormats/rasterCodec":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred ../PixelBlock ./LercCodec ./Lerc2Codec ./JpgPlus ./Png ./Raw ./TiffDecoder".split(" "),function(H,n,t,l,k,e,c,a,b,f,g){return{validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),supportedFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_isPlatformLittleEndian:function(){var h=new ArrayBuffer(4),d=new Uint8Array(h);(new Uint32Array(h))[0]=
1;return 1===d[0]}(),decode:function(h,d){if(void 0===d||null===d)throw"missing decode options";var m;d.format&&(m=d.format.toUpperCase());"BSQ"!==m&&"BIP"!==m&&(m=this._getFormat(h));var p=d.decodeFunc;if(void 0===p||null===p)p=this._getFormatDecoderDfd(m);return p(h,d)},_getFormatDecoderDfd:function(h){var d=null;switch(h){case "LERC":d=this._decodeLerc;break;case "LERC2":d=this._decodeLerc2;break;case "JPEG":d=this._decodeJpeg;break;case "PNG":d=this._decodePng;break;case "BSQ":d=this._decodeBsq;
break;case "BIP":d=this._decodeBip;break;case "TIFF":d=this._decodeTiff;break;default:d=function(m,p){throw"The raster format is not supported";}}d=t.hitch(this,d);return function(m,p){var v=new l;p.isPoint&&p.width&&(p.width++,p.height++);m=d(m,p);p.isPoint&&p.width&&(this._interpolatePointGrid(m),p.width--,p.height--);v.resolve(m);return v}.bind(this)},_getFormat:function(h){h=new Uint8Array(h,0,10);var d="";if(255===h[0]&&216===h[1])d="JPEG";else if(137===h[0]&&80===h[1]&&78===h[2]&&71===h[3])d=
"PNG";else if(67===h[0]&&110===h[1]&&116===h[2]&&90===h[3]&&73===h[4]&&109===h[5]&&97===h[6]&&103===h[7]&&101===h[8]&&32===h[9])d="LERC";else if(76===h[0]&&101===h[1]&&114===h[2]&&99===h[3]&&50===h[4]&&32===h[5])d="LERC2";else if(-1<String.fromCharCode.apply(null,h).toLowerCase().indexOf("error"))d="ERROR";else if(73===h[0]&&73===h[1]&&42===h[2]&&0===h[3]||77===h[0]&&77===h[1]&&0===h[2]&&42===h[3])d="TIFF";return d},_validateDecodeParams:function(h){if(!h.height||Math.floor(h.height)!==h.height)throw"Height not provided.";
if(!h.width||Math.floor(h.width)!==h.width)throw"Width not provided.";},_decodeJpeg:function(h,d){if(!a)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(d);h=(new a).decode(h);if(!this._verifyResult(h,d))throw"The decoded image dimensions are incorrect.";d=new k({width:h.width,height:h.height,pixels:h.pixels,pixelType:"U8",mask:h.mask,statistics:null});d.calculateStatistics();return d},_decodePng:function(h,d){if(!b)throw"The png decoder module is not loaded.";this._validateDecodeParams(d);
h=new Uint8Array(h);var m=new b(h);h=new Uint8Array(d.width*d.height*4);m.copyToImageData(h,m.decodePixels());var p=m=0;p=new Uint8Array(d.width*d.height);for(m=0;m<d.width*d.height;m++)p[m]=h[4*m+3];var v=new k({width:d.width,height:d.height,pixels:[],pixelType:"U8",mask:p,statistics:[]});for(m=0;3>m;m++){var q=new Uint8Array(d.width*d.height);for(p=0;p<d.width*d.height;p++)q[p]=h[4*p+m];v.addData({pixels:q})}v.calculateStatistics();return v},_decodeBsq:function(h,d){if(!f)throw"The bsq decoder module is not loaded.";
this._validateDecodeParams(d);var m=d.noDataValue;d.pixelType=this._getpixelTypeAndNoData(d.pixelType);h=f.decodeBSQ(h,{bandCount:d.planes,width:d.width,height:d.height,pixelType:d.pixelType,noDataValue:m});d=new k({width:d.width,height:d.height,pixels:h.pixels,pixelType:d.pixelType,mask:h.maskData,statistics:null});d.calculateStatistics();return d},_decodeBip:function(h,d){this._validateDecodeParams(d);var m=d.noDataValue;d.pixelType=this._getpixelTypeAndNoData(d.pixelType);h=f.decodeBIP(h,{bandCount:d.planes,
width:d.width,height:d.height,pixelType:d.pixelType,noDataValue:m});d=new k({width:d.width,height:d.height,pixels:h.pixels,pixelType:d.pixelType,mask:h.maskData,statistics:null});d.calculateStatistics();return d},_decodeTiff:function(h,d){this._validateDecodeParams(d);d.pixelType=this._getpixelTypeAndNoData(d.pixelType);h=g.decode(h);h=new k({width:h.width,height:h.height,pixels:h.pixels,pixelType:h.pixelType,mask:h.maskData,statistics:null});h.calculateStatistics();return h},_decodeLerc:function(h,
d){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(d);var m=d.noDataValue;d.pixelType=this._getpixelTypeAndNoData(d.pixelType);for(var p=0,v,q=0,w,y=h.byteLength-10;q<y;){var x=e.decode(h,{inputOffset:q,encodedMaskData:v,returnMask:0===p?!0:!1,returnEncodedMask:0===p?!0:!1,returnFileInfo:!0,pixelType:d.pixelType,noDataValue:m});q=x.fileInfo.eofOffset;0===p&&(v=x.encodedMaskData,w=new k({width:d.width,height:d.height,pixels:[],
pixelType:d.pixelType,mask:x.maskData,statistics:[]}));p++;if(!this._verifyResult(x,d))throw"The decoded image dimensions are incorrect";w.addData({pixels:x.pixelData,statistics:{minValue:x.minValue,maxValue:x.maxValue,noDataValue:x.noDataValue}})}return w},_decodeLerc2:function(h,d){if(!this._isPlatformLittleEndian)throw"lerc2 decoder is not supported on big endian platform";this._validateDecodeParams(d);d.pixelType=this._getpixelTypeAndNoData(d.pixelType);for(var m=0,p,v,q,w=0,y,x=h.byteLength-
10,E=[],B,C=0;w<x;){v=c.decode(h,{inputOffset:w,maskData:p,returnFileInfo:!0});w=v.fileInfo.eofOffset;p=v.maskData;0===m&&(q=v.fileInfo.numValidPixel,y=new k({width:d.width,height:d.height,pixels:[],dimCount:v.dimCount||1,pixelType:v.fileInfo.pixelType,mask:p,statistics:[]}));v.fileInfo.mask&&0<v.fileInfo.mask.numBytes&&C++;p&&E.push(p);m++;if(!this._verifyResult(v,d))throw"The decoded image dimensions are incorrect";y.addData({pixels:v.pixelData,statistics:{minValue:v.minValue,maxValue:v.maxValue,
noDataValue:v.noDataValue,dimStats:v.dimStats}})}if(1<C){d=y.width*y.height;y.bandMasks=E;p=new Uint8Array(d);p.set(E[0]);for(q=1;q<E.length;q++)for(B=E[q],h=0;h<d;h++)p[h]&=B[h];for(h=q=0;h<d;h++)q+=B[h];y.mask=p}y.validPixelCount=q;return y},_interpolatePointGrid:function(h,d){var m=h.pixels;if(m&&0!==m.length){var p=m.length,v=h.width,q=h.mask,w=v-1,y=h.height-1,x=[],E,B;if(0===(null==d?1:d)){for(d=0;d<p;d++){var C=m[d];var G=new C.constructor(w*y);for(E=0;E<y;E++){var I=E*v;for(B=0;B<w;B++)G[E*
w+B]=C[I+B]}x.push(G)}if(q){var D=new Uint8Array(w*y);for(E=0;E<y;E++)for(I=E*v,B=0;B<w;B++)D[E*w+B]=q[I+B]}}else{for(d=0;d<p;d++){C=m[d];G=new C.constructor(w*y);for(E=0;E<y;E++)for(I=E*v,B=0;B<w;B++)G[E*w+B]=(C[I+B]+C[I+B+1]+C[I+v+B]+C[I+v+B+1])/4;x.push(G)}if(q)for(D=new Uint8Array(w*y),E=0;E<y;E++)for(I=E*v,B=0;B<w;B++)D[E*w+B]=Math.min.apply(null,[q[I+B],q[I+B+1],q[I+v+B],q[I+v+B+1]])}h.width=w;h.height=y;h.mask=D;h.pixels=x;return h}},_getpixelTypeAndNoData:function(h){return"U1"===h||"U2"===
h||"U4"===h||"U8"===h?"U8":h},_verifyResult:function(h,d){return h.height!==d.height||h.width!==d.width?!1:!0}}})},"esri/layers/rasterFormats/JpgPlus":function(){define(["dojo/_base/declare","./Zlib","./Jpg"],function(H,n,t){return H(null,{constructor:function(){},decode:function(l){var k=new Uint8Array(l);l=new t;l.parse(k);var e=l.numComponents,c=l.getData(l.width,l.height,!0),a=l.width*l.height,b=l.eof,f=0,g=0,h=0;if(b<k.length-1){g=(new n(k.subarray(b))).getBytes();var d=new Uint8Array(a);for(f=
k=0;f<g.length;f++)for(h=7;0<=h;h--)d[k++]=g[f]>>h&1}k=[];if(1===e)k=[c,c,c];else{for(f=0;3>f;f++)e=new Uint8Array(a),k.push(e);for(g=h=0;g<a;g++)for(f=0;3>f;f++)k[f][g]=c[h++]}return{width:l.width,height:l.height,pixels:k,mask:d}}})})},"esri/layers/rasterFormats/Zlib":function(){define([],function(){var H=function(){function n(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}n.prototype={ensureBuffer:function(t){var l=this.buffer,k=l?l.byteLength:0;if(t<k)return l;for(var e=512;e<t;)e<<=
1;t=new Uint8Array(e);for(e=0;e<k;++e)t[e]=l[e];return this.buffer=t},getByte:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(t){var l=this.pos;if(t){this.ensureBuffer(l+t);for(t=l+t;!this.eof&&this.bufferLength<t;)this.readBlock();var k=this.bufferLength;t>k&&(t=k)}else{for(;!this.eof;)this.readBlock();t=this.bufferLength}this.pos=t;return this.buffer.subarray(l,t)},lookChar:function(){for(var t=this.pos;this.bufferLength<=
t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(t,l,k){for(var e=t+l;this.bufferLength<=e&&!this.eof;)this.readBlock();return new Stream(this.buffer,t,l,k)},skip:function(t){t||(t=1);this.pos+=t},reset:function(){this.pos=0}};return n}();return function(){function n(b){throw Error(b);
}function t(b){var f=0,g=b[f++],h=b[f++];-1!=g&&-1!=h||n("Invalid header in flate stream");8!=(g&15)&&n("Unknown compression method in flate stream");0!=((g<<8)+h)%31&&n("Bad FCHECK in flate stream");h&32&&n("FDICT bit set in flate stream");this.bytes=b;this.bytesPos=f;this.codeBuf=this.codeSize=0;H.call(this)}if(!self||!self.Uint32Array)return null;var l=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),k=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,
131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),e=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),c=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,
459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,
459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,
459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,
459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,
459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,
459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,
459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,
327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];t.prototype=Object.create(H.prototype);t.prototype.getBits=function(b){for(var f=this.codeSize,g=this.codeBuf,h=this.bytes,d=this.bytesPos,m;f<b;)"undefined"==typeof(m=h[d++])&&n("Bad encoding in flate stream"),g|=m<<f,f+=8;this.codeBuf=g>>b;this.codeSize=f-=b;this.bytesPos=d;return g&(1<<b)-1};t.prototype.getCode=function(b){var f=b[0],g=b[1];b=this.codeSize;for(var h=
this.codeBuf,d=this.bytes,m=this.bytesPos;b<g;){var p;"undefined"==typeof(p=d[m++])&&n("Bad encoding in flate stream");h|=p<<b;b+=8}g=f[h&(1<<g)-1];f=g>>16;g&=65535;(0==b||b<f||0==f)&&n("Bad encoding in flate stream");this.codeBuf=h>>f;this.codeSize=b-f;this.bytesPos=m;return g};t.prototype.generateHuffmanTable=function(b){for(var f=b.length,g=0,h=0;h<f;++h)b[h]>g&&(g=b[h]);for(var d=1<<g,m=new Uint32Array(d),p=1,v=0,q=2;p<=g;++p,v<<=1,q<<=1)for(var w=0;w<f;++w)if(b[w]==p){var y=0,x=v;for(h=0;h<p;++h)y=
y<<1|x&1,x>>=1;for(h=y;h<d;h+=q)m[h]=p<<16|w;++v}return[m,g]};t.prototype.readBlock=function(){function b(y,x,E,B,C){for(y=y.getBits(E)+B;0<y--;)x[v++]=C}var f=this.getBits(3);f&1&&(this.eof=!0);f>>=1;if(0==f){var g=this.bytes,h=this.bytesPos,d;"undefined"==typeof(d=g[h++])&&n("Bad block header in flate stream");var m=d;"undefined"==typeof(d=g[h++])&&n("Bad block header in flate stream");m|=d<<8;"undefined"==typeof(d=g[h++])&&n("Bad block header in flate stream");f=d;"undefined"==typeof(d=g[h++])&&
n("Bad block header in flate stream");(f|d<<8)!=(~m&65535)&&n("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;d=this.bufferLength;f=this.ensureBuffer(d+m);this.bufferLength=m=d+m;for(var p=d;p<m;++p){if("undefined"==typeof(d=g[h++])){this.eof=!0;break}f[p]=d}this.bytesPos=h}else{if(1==f)h=c,d=a;else if(2==f){f=this.getBits(5)+257;d=this.getBits(5)+1;g=this.getBits(4)+4;h=Array(l.length);for(var v=0;v<g;)h[l[v++]]=this.getBits(3);h=this.generateHuffmanTable(h);v=g=0;d=
f+d;for(m=Array(d);v<d;)p=this.getCode(h),16==p?b(this,m,2,3,g):17==p?b(this,m,3,3,g=0):18==p?b(this,m,7,11,g=0):m[v++]=g=p;h=this.generateHuffmanTable(m.slice(0,f));d=this.generateHuffmanTable(m.slice(f,d))}else n("Unknown block type in flate stream");m=(f=this.buffer)?f.length:0;for(p=this.bufferLength;;){var q=this.getCode(h);if(256>q)p+1>=m&&(f=this.ensureBuffer(p+1),m=f.length),f[p++]=q;else{if(256==q){this.bufferLength=p;break}q-=257;q=k[q];var w=q>>16;0<w&&(w=this.getBits(w));g=(q&65535)+w;
q=this.getCode(d);q=e[q];w=q>>16;0<w&&(w=this.getBits(w));q=(q&65535)+w;p+g>=m&&(f=this.ensureBuffer(p+g),m=f.length);for(w=0;w<g;++w,++p)f[p]=f[p-q]}}}};return t}()})},"esri/layers/rasterFormats/Jpg":function(){define([],function(){var H=function(){function n(t){this.message="JPEG error: "+t}n.prototype=Error();n.prototype.name="JpegError";return n.constructor=n}();return function(){function n(){this.decodeTransform=null;this.colorTransform=-1}function t(a,b){for(var f=0,g=[],h,d,m=16;0<m&&!a[m-
1];)m--;g.push({children:[],index:0});var p=g[0],v;for(h=0;h<m;h++){for(d=0;d<a[h];d++){p=g.pop();for(p.children[p.index]=b[f];0<p.index;)p=g.pop();p.index++;for(g.push(p);g.length<=h;)g.push(v={children:[],index:0}),p.children[p.index]=v.children,p=v;f++}h+1<m&&(g.push(v={children:[],index:0}),p.children[p.index]=v.children,p=v)}return g[0].children}function l(a,b,f,g,h,d,m,p,v){function q(){if(0<A)return A--,u>>A&1;u=a[b++];if(255===u){var T=a[b++];if(T)throw new H("unexpected marker "+(u<<8|T).toString(16));
}A=7;return u>>>7}function w(T){for(;;){T=T[q()];if("number"===typeof T)return T;if("object"!==typeof T)throw new H("invalid huffman sequence");}}function y(T){for(var S=0;0<T;)S=S<<1|q(),T--;return S}function x(T){if(1===T)return 1===q()?1:-1;var S=y(T);return S>=1<<T-1?S:S+(-1<<T)+1}function E(T,S){var U=w(T.huffmanTableDC);U=0===U?0:x(U);T.blockData[S]=T.pred+=U;for(U=1;64>U;){var X=w(T.huffmanTableAC),Y=X&15;X>>=4;if(0===Y){if(15>X)break;U+=16}else U+=X,T.blockData[S+c[U]]=x(Y),U++}}function B(T,
S){var U=w(T.huffmanTableDC);U=0===U?0:x(U)<<v;T.blockData[S]=T.pred+=U}function C(T,S){T.blockData[S]|=q()<<v}function G(T,S){if(0<J)J--;else for(var U=d;U<=m;){var X=w(T.huffmanTableAC),Y=X&15;X>>=4;if(0===Y){if(15>X){J=y(X)+(1<<X)-1;break}U+=16}else U+=X,T.blockData[S+c[U]]=x(Y)*(1<<v),U++}}function I(T,S){for(var U=d,X=0,Y;U<=m;){Y=c[U];switch(O){case 0:X=w(T.huffmanTableAC);Y=X&15;X>>=4;if(0===Y)15>X?(J=y(X)+(1<<X),O=4):(X=16,O=1);else{if(1!==Y)throw new H("invalid ACn encoding");P=x(Y);O=X?
2:3}continue;case 1:case 2:T.blockData[S+Y]?T.blockData[S+Y]+=q()<<v:(X--,0===X&&(O=2===O?3:0));break;case 3:T.blockData[S+Y]?T.blockData[S+Y]+=q()<<v:(T.blockData[S+Y]=P<<v,O=0);break;case 4:T.blockData[S+Y]&&(T.blockData[S+Y]+=q()<<v)}U++}4===O&&(J--,0===J&&(O=0))}var D=f.mcusPerLine,r=b,u=0,A=0,J=0,O=0,P,z=g.length,F,M,Q,R;p=f.progressive?0===d?0===p?B:C:0===p?G:I:E;var K=0;f=1===z?g[0].blocksPerLine*g[0].blocksPerColumn:D*f.mcusPerColumn;for(var N,V;K<f;){var W=h?Math.min(f-K,h):f;for(F=0;F<z;F++)g[F].pred=
0;J=0;if(1===z){var L=g[0];for(R=0;R<W;R++)p(L,64*((L.blocksPerLine+1)*(K/L.blocksPerLine|0)+K%L.blocksPerLine)),K++}else for(R=0;R<W;R++){for(F=0;F<z;F++)for(L=g[F],N=L.h,V=L.v,M=0;M<V;M++)for(Q=0;Q<N;Q++)p(L,64*((L.blocksPerLine+1)*((K/D|0)*L.v+M)+(K%D*L.h+Q)));K++}A=0;(L=e(a,b))&&L.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+L.invalid),b=L.offset);L=L&&L.marker;if(!L||65280>=L)throw new H("marker was not found");if(65488<=L&&65495>=L)b+=2;else break}(L=e(a,b))&&L.invalid&&
(console.log("decodeScan - unexpected Scan data, next marker is: "+L.invalid),b=L.offset);return b-r}function k(a,b){a=b.blocksPerLine;for(var f=b.blocksPerColumn,g=new Int16Array(64),h=0;h<f;h++)for(var d=0;d<a;d++){var m=void 0,p=void 0,v=void 0,q=void 0,w=void 0,y=void 0,x=void 0,E=void 0,B=w=y=q=p=m=void 0,C=void 0,G=void 0,I=void 0,D=64*((b.blocksPerLine+1)*h+d),r=g,u=b.quantizationTable,A=b.blockData;if(!u)throw new H("missing required Quantization Table.");for(var J=0;64>J;J+=8)m=A[D+J],E=
A[D+J+1],x=A[D+J+2],y=A[D+J+3],w=A[D+J+4],q=A[D+J+5],v=A[D+J+6],p=A[D+J+7],m*=u[J],0===(E|x|y|w|q|v|p)?(m=5793*m+512>>10,r[J]=m,r[J+1]=m,r[J+2]=m,r[J+3]=m,r[J+4]=m,r[J+5]=m,r[J+6]=m,r[J+7]=m):(E*=u[J+1],x*=u[J+2],y*=u[J+3],w*=u[J+4],q*=u[J+5],v*=u[J+6],p*=u[J+7],I=5793*m+128>>8,G=5793*w+128>>8,C=x,B=v,w=2896*(E-p)+128>>8,p=2896*(E+p)+128>>8,y<<=4,q<<=4,I=I+G+1>>1,G=I-G,m=3784*C+1567*B+128>>8,C=1567*C-3784*B+128>>8,B=m,w=w+q+1>>1,q=w-q,p=p+y+1>>1,y=p-y,I=I+B+1>>1,B=I-B,G=G+C+1>>1,C=G-C,m=2276*w+3406*
p+2048>>12,w=3406*w-2276*p+2048>>12,p=m,m=799*y+4017*q+2048>>12,y=4017*y-799*q+2048>>12,q=m,r[J]=I+p,r[J+7]=I-p,r[J+1]=G+q,r[J+6]=G-q,r[J+2]=C+y,r[J+5]=C-y,r[J+3]=B+w,r[J+4]=B-w);for(u=0;8>u;++u)m=r[u],E=r[u+8],x=r[u+16],y=r[u+24],w=r[u+32],q=r[u+40],v=r[u+48],p=r[u+56],0===(E|x|y|w|q|v|p)?(m=5793*m+8192>>14,m=-2040>m?0:2024<=m?255:m+2056>>4,A[D+u]=m,A[D+u+8]=m,A[D+u+16]=m,A[D+u+24]=m,A[D+u+32]=m,A[D+u+40]=m,A[D+u+48]=m,A[D+u+56]=m):(I=5793*m+2048>>12,G=5793*w+2048>>12,C=x,B=v,w=2896*(E-p)+2048>>
12,p=2896*(E+p)+2048>>12,I=(I+G+1>>1)+4112,G=I-G,m=3784*C+1567*B+2048>>12,C=1567*C-3784*B+2048>>12,B=m,w=w+q+1>>1,q=w-q,p=p+y+1>>1,y=p-y,I=I+B+1>>1,B=I-B,G=G+C+1>>1,C=G-C,m=2276*w+3406*p+2048>>12,w=3406*w-2276*p+2048>>12,p=m,m=799*y+4017*q+2048>>12,y=4017*y-799*q+2048>>12,q=m,m=I+p,p=I-p,E=G+q,v=G-q,x=C+y,q=C-y,y=B+w,w=B-w,m=16>m?0:4080<=m?255:m>>4,E=16>E?0:4080<=E?255:E>>4,x=16>x?0:4080<=x?255:x>>4,y=16>y?0:4080<=y?255:y>>4,w=16>w?0:4080<=w?255:w>>4,q=16>q?0:4080<=q?255:q>>4,v=16>v?0:4080<=v?255:
v>>4,p=16>p?0:4080<=p?255:p>>4,A[D+u]=m,A[D+u+8]=E,A[D+u+16]=x,A[D+u+24]=y,A[D+u+32]=w,A[D+u+40]=q,A[D+u+48]=v,A[D+u+56]=p)}return b.blockData}function e(a,b,f){var g=a.length-1;f=f<b?f:b;if(b>=g)return null;var h=a[b]<<8|a[b+1];if(65472<=h&&65534>=h)return{invalid:null,marker:h,offset:b};for(b=a[f]<<8|a[f+1];!(65472<=b&&65534>=b);){if(++f>=g)return null;b=a[f]<<8|a[f+1]}return{invalid:h.toString(16),marker:b,offset:f}}if(!self||!self.Uint8ClampedArray)return null;var c=new Uint8Array([0,1,8,16,9,
2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);n.prototype={parse:function(a){function b(){var u=a[h]<<8|a[h+1];h+=2;return u}function f(){var u=b();u=h+u-2;var A=e(a,u,h);A&&A.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+A.invalid),u=A.offset);u=a.subarray(h,u);h+=u.length;return u}function g(u){for(var A=Math.ceil(u.samplesPerLine/8/u.maxH),
J=Math.ceil(u.scanLines/8/u.maxV),O=0;O<u.components.length;O++){r=u.components[O];var P=Math.ceil(Math.ceil(u.samplesPerLine/8)*r.h/u.maxH),z=Math.ceil(Math.ceil(u.scanLines/8)*r.v/u.maxV);r.blockData=new Int16Array(64*J*r.v*(A*r.h+1));r.blocksPerLine=P;r.blocksPerColumn=z}u.mcusPerLine=A;u.mcusPerColumn=J}var h=0,d=null,m=null,p=[],v=[],q=[],w=b();if(65496!==w)throw new H("SOI not found");for(w=b();65497!==w;){switch(w){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var y=
f();65504===w&&74===y[0]&&70===y[1]&&73===y[2]&&70===y[3]&&0===y[4]&&(d={version:{major:y[5],minor:y[6]},densityUnits:y[7],xDensity:y[8]<<8|y[9],yDensity:y[10]<<8|y[11],thumbWidth:y[12],thumbHeight:y[13],thumbData:y.subarray(14,14+3*y[12]*y[13])});65518===w&&65===y[0]&&100===y[1]&&111===y[2]&&98===y[3]&&101===y[4]&&(m={version:y[5]<<8|y[6],flags0:y[7]<<8|y[8],flags1:y[9]<<8|y[10],transformCode:y[11]});break;case 65499:w=b()+h-2;for(var x;h<w;){var E=a[h++],B=new Uint16Array(64);if(0===E>>4)for(y=
0;64>y;y++)x=c[y],B[x]=a[h++];else if(1===E>>4)for(y=0;64>y;y++)x=c[y],B[x]=b();else throw new H("DQT - invalid table spec");p[E&15]=B}break;case 65472:case 65473:case 65474:if(C)throw new H("Only single frame JPEGs supported");b();var C={};C.extended=65473===w;C.progressive=65474===w;C.precision=a[h++];C.scanLines=b();C.samplesPerLine=b();C.components=[];C.componentIds={};y=a[h++];for(w=B=E=0;w<y;w++){x=a[h];var G=a[h+1]>>4;var I=a[h+1]&15;E<G&&(E=G);B<I&&(B=I);G=C.components.push({h:G,v:I,quantizationId:a[h+
2],quantizationTable:null});C.componentIds[x]=G-1;h+=3}C.maxH=E;C.maxV=B;g(C);break;case 65476:x=b();for(w=2;w<x;){E=a[h++];B=new Uint8Array(16);for(y=G=0;16>y;y++,h++)G+=B[y]=a[h];I=new Uint8Array(G);for(y=0;y<G;y++,h++)I[y]=a[h];w+=17+G;(0===E>>4?q:v)[E&15]=t(B,I)}break;case 65501:b();var D=b();break;case 65498:b();x=a[h++];y=[];for(w=0;w<x;w++){E=C.componentIds[a[h++]];var r=C.components[E];E=a[h++];r.huffmanTableDC=q[E>>4];r.huffmanTableAC=v[E&15];y.push(r)}w=a[h++];x=a[h++];E=a[h++];w=l(a,h,
C,y,D,w,x,E>>4,E&15);h+=w;break;case 65535:255!==a[h]&&h--;break;default:if(255===a[h-3]&&192<=a[h-2]&&254>=a[h-2])h-=3;else throw new H("unknown marker "+w.toString(16));}w=b()}this.width=C.samplesPerLine;this.height=C.scanLines;this.jfif=d;this.eof=h;this.adobe=m;this.components=[];for(w=0;w<C.components.length;w++){r=C.components[w];if(d=p[r.quantizationId])r.quantizationTable=d;this.components.push({output:k(C,r),scaleX:r.h/C.maxH,scaleY:r.v/C.maxV,blocksPerLine:r.blocksPerLine,blocksPerColumn:r.blocksPerColumn})}this.numComponents=
this.components.length},_getLinearizedBlockData:function(a,b){var f=this.width/a,g=this.height/b,h,d,m=0,p=this.components.length,v=a*b*p,q=new Uint8ClampedArray(v),w=new Uint32Array(a);for(d=0;d<p;d++){var y=this.components[d];var x=y.scaleX*f;var E=y.scaleY*g;m=d;var B=y.output;var C=y.blocksPerLine+1<<3;for(h=0;h<a;h++)y=0|h*x,w[h]=(y&4294967288)<<3|y&7;for(x=0;x<b;x++)for(y=0|x*E,y=C*(y&4294967288)|(y&7)<<3,h=0;h<a;h++)q[m]=B[y+w[h]],m+=p}if(b=this.decodeTransform)for(d=0;d<v;)for(a=y=0;y<p;y++,
d++,a+=2)q[d]=(q[d]*b[a]>>8)+b[a+1];return q},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var b,f,g,h=0,d=a.length;h<d;h+=3)b=a[h],f=a[h+1],g=a[h+2],a[h]=b-179.456+1.402*g,a[h+1]=b+135.459-.344*f-.714*g,a[h+2]=b-226.816+1.772*f;return a},_convertYcckToRgb:function(a){for(var b,f,g,h,d=0,m=0,p=a.length;m<p;m+=4)b=a[m],f=a[m+1],g=a[m+2],h=a[m+3],a[d++]=
-122.67195406894+f*(-6.60635669420364E-5*f+4.37130475926232E-4*g-5.4080610064599E-5*b+4.8449797120281E-4*h-.154362151871126)+g*(-9.57964378445773E-4*g+8.17076911346625E-4*b-.00477271405408747*h+1.53380253221734)+b*(9.61250184130688E-4*b-.00266257332283933*h+.48357088451265)+h*(-3.36197177618394E-4*h+.484791561490776),a[d++]=107.268039397724+f*(2.19927104525741E-5*f-6.40992018297945E-4*g+6.59397001245577E-4*b+4.26105652938837E-4*h-.176491792462875)+g*(-7.78269941513683E-4*g+.00130872261408275*b+7.70482631801132E-4*
h-.151051492775562)+b*(.00126935368114843*b-.00265090189010898*h+.25802910206845)+h*(-3.18913117588328E-4*h-.213742400323665),a[d++]=-20.810012546947+f*(-5.70115196973677E-4*f-2.63409051004589E-5*g+.0020741088115012*b-.00288260236853442*h+.814272968359295)+g*(-1.53496057440975E-5*g-1.32689043961446E-4*b+5.60833691242812E-4*h-.195152027534049)+b*(.00174418132927582*b-.00255243321439347*h+.116935020465145)+h*(-3.43531996510555E-4*h+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var b,
f,g,h=0,d=a.length;h<d;h+=4)b=a[h],f=a[h+1],g=a[h+2],a[h]=434.456-b-1.402*g,a[h+1]=119.541-b+.344*f+.714*g,a[h+2]=481.816-b-1.772*f;return a},_convertCmykToRgb:function(a){for(var b,f,g,h,d=0,m=1/255,p=0,v=a.length;p<v;p+=4)b=a[p]*m,f=a[p+1]*m,g=a[p+2]*m,h=a[p+3]*m,a[d++]=255+b*(-4.387332384609988*b+54.48615194189176*f+18.82290502165302*g+212.25662451639585*h-285.2331026137004)+f*(1.7149763477362134*f-5.6096736904047315*g-17.873870861415444*h-5.497006427196366)+g*(-2.5217340131683033*g-21.248923337353073*
h+17.5119270841813)-h*(21.86122147463605*h+189.48180835922747),a[d++]=255+b*(8.841041422036149*b+60.118027045597366*f+6.871425592049007*g+31.159100130055922*h-79.2970844816548)+f*(-15.310361306967817*f+17.575251261109482*g+131.35250912493976*h-190.9453302588951)+g*(4.444339102852739*g+9.8632861493405*h-24.86741582555878)-h*(20.737325471181034*h+187.80453709719578),a[d++]=255+b*(.8842522430003296*b+8.078677503112928*f+30.89978309703729*g-.23883238689178934*h-14.183576799673286)+f*(10.49593273432072*
f+63.02378494754052*g+50.606957656360734*h-112.23884253719248)+g*(.03296041114873217*g+115.60384449646641*h-193.58209356861505)-h*(22.33816807309886*h+180.12613974708367);return a},getData:function(a,b,f){if(4<this.numComponents)throw new H("Unsupported color mode");a=this._getLinearizedBlockData(a,b);if(1===this.numComponents&&f){f=a.length;b=new Uint8ClampedArray(3*f);for(var g=0,h=0;h<f;h++){var d=a[h];b[g++]=d;b[g++]=d;b[g++]=d}return b}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);
if(4===this.numComponents){if(this._isColorConversionNeeded())return f?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(f)return this._convertCmykToRgb(a)}return a}};return n}()})},"esri/layers/rasterFormats/Png":function(){define(["./Zlib"],function(H){return function(){function n(l){var k,e;this.data=l;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(e=null;;){var c=this.readUInt32();var a=l=void 0;l=[];for(a=0;4>a;++a)l.push(String.fromCharCode(this.data[this.pos++]));
l=l.join("");switch(l){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(c);break;case "fcTL":e&&this.animation.frames.push(e);this.pos+=
4;e={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};l=this.readUInt16();c=this.readUInt16()||100;e.delay=1E3*l/c;e.disposeOp=this.data[this.pos++];e.blendOp=this.data[this.pos++];e.data=[];break;case "IDAT":case "fdAT":"fdAT"===l&&(this.pos+=4,c-=4);l=(null!=e?e.data:void 0)||this.imgData;for(a=0;0<=c?a<c:a>c;0<=c?++a:--a)l.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=
this.read(c);c=255-this.transparency.indexed.length;if(0<c)for(l=0;0<=c?l<c:l>c;0<=c?++l:--l)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(c)[0];break;case 2:this.transparency.rgb=this.read(c)}break;case "tEXt":a=this.read(c);c=a.indexOf(0);l=String.fromCharCode.apply(String,a.slice(0,c));this.text[l]=String.fromCharCode.apply(String,a.slice(c+1));break;case "IEND":e&&this.animation.frames.push(e);a:{switch(this.colorType){case 0:case 3:case 4:e=1;break a;
case 2:case 6:e=3;break a}e=void 0}this.colors=e;this.hasAlphaChannel=4===(k=this.colorType)||6===k;k=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*k;a:{switch(this.colors){case 1:k="DeviceGray";break a;case 3:k="DeviceRGB";break a}k=void 0}this.colorSpace=k;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=c}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}n.load=function(l,k,e){"function"===typeof k&&(e=k);var c=new XMLHttpRequest;
c.open("GET",l,!0);c.responseType="arraybuffer";c.onload=function(){var a=new Uint8Array(c.response||c.mozResponseArrayBuffer);a=new n(a);"function"===typeof(null!=k?k.getContext:void 0)&&a.render(k);return"function"===typeof e?e(a):void 0};return c.send(null)};n.prototype.read=function(l){var k;var e=[];for(k=0;0<=l?k<l:k>l;0<=l?++k:--k)e.push(this.data[this.pos++]);return e};n.prototype.readUInt32=function(){var l=this.data[this.pos++]<<24;var k=this.data[this.pos++]<<16;var e=this.data[this.pos++]<<
8;var c=this.data[this.pos++];return l|k|e|c};n.prototype.readUInt16=function(){var l=this.data[this.pos++]<<8;var k=this.data[this.pos++];return l|k};n.prototype.decodePixels=function(l){var k,e,c,a,b,f,g,h;null==l&&(l=this.imgData);if(0===l.length)return new Uint8Array(0);l=new H(l);l=l.getBytes();var d=this.pixelBitlength/8;var m=d*this.width;var p=new Uint8Array(m*this.height);var v=l.length;for(e=a=b=0;a<v;){switch(l[a++]){case 0:for(c=k=0;k<m;c=k+=1)p[e++]=l[a++];break;case 1:for(c=f=0;f<m;c=
f+=1){k=l[a++];var q=c<d?0:p[e-d];p[e++]=(k+q)%256}break;case 2:for(c=q=0;q<m;c=q+=1){k=l[a++];var w=(c-c%d)/d;f=b&&p[(b-1)*m+w*d+c%d];p[e++]=(f+k)%256}break;case 3:for(c=h=0;h<m;c=h+=1)k=l[a++],w=(c-c%d)/d,q=c<d?0:p[e-d],f=b&&p[(b-1)*m+w*d+c%d],p[e++]=(k+Math.floor((q+f)/2))%256;break;case 4:for(c=h=0;h<m;c=h+=1){k=l[a++];w=(c-c%d)/d;q=c<d?0:p[e-d];0===b?f=g=0:(f=p[(b-1)*m+w*d+c%d],g=w&&p[(b-1)*m+(w-1)*d+c%d]);var y=q+f-g;c=Math.abs(y-q);w=Math.abs(y-f);y=Math.abs(y-g);q=c<=w&&c<=y?q:w<=y?f:g;p[e++]=
(k+q)%256}break;default:throw Error("Invalid filter algorithm: "+l[a-1]);}b++}return p};n.prototype.decodePalette=function(){var l,k,e,c,a;var b=this.palette;var f=this.transparency.indexed||[];var g=new Uint8Array((f.length||0)+b.length);var h=e=l=k=0;for(c=b.length;e<c;h=e+=3)g[k++]=b[h],g[k++]=b[h+1],g[k++]=b[h+2],g[k++]=null!=(a=f[l++])?a:255;return g};n.prototype.copyToImageData=function(l,k){var e,c;var a=this.colors;var b=null;var f=this.hasAlphaChannel;this.palette.length&&(b=null!=(e=this._decodedPalette)?
e:this._decodedPalette=this.decodePalette(),a=4,f=!0);l=l.data||l;var g=l.length;var h=b||k;e=c=0;if(1===a)for(;e<g;)a=b?4*k[e/4]:c,c=h[a++],l[e++]=c,l[e++]=c,l[e++]=c,l[e++]=f?h[a++]:this.transparency.grayscale&&this.transparency.grayscale===c?0:255,c=a;else for(;e<g;)a=b?4*k[e/4]:c,l[e++]=h[a++],l[e++]=h[a++],l[e++]=h[a++],l[e++]=f?h[a++]:this.transparency.rgb&&this.transparency.rgb[1]===h[a-3]&&this.transparency.rgb[3]===h[a-2]&&this.transparency.rgb[5]===h[a-1]?0:255,c=a};n.prototype.decode=function(){var l=
new Uint8Array(this.width*this.height*4);this.copyToImageData(l,this.decodePixels());return l};var t=function(l){(void 0).clearRect(0,0,l.width,l.height);(void 0).putImageData(l,0,0);l=new Image;l.src=(void 0).toDataURL();return l};n.prototype.decodeFrames=function(l){var k,e;if(this.animation){var c=this.animation.frames;var a=[];var b=k=0;for(e=c.length;k<e;b=++k){b=c[b];var f=l.createImageData(b.width,b.height);var g=this.decodePixels(new Uint8Array(b.data));this.copyToImageData(f,g);b.imageData=
f;a.push(b.image=t(f))}return a}};n.prototype.renderFrame=function(l,k){var e=this.animation.frames;var c=e[k];e=e[k-1];0===k&&l.clearRect(0,0,this.width,this.height);1===(null!=e?e.disposeOp:void 0)?l.clearRect(e.xOffset,e.yOffset,e.width,e.height):2===(null!=e?e.disposeOp:void 0)&&l.putImageData(e.imageData,e.xOffset,e.yOffset);0===c.blendOp&&l.clearRect(c.xOffset,c.yOffset,c.width,c.height);return l.drawImage(c.image,c.xOffset,c.yOffset)};n.prototype.animate=function(l){var k,e=this;var c=0;var a=
this.animation;var b=a.numFrames;var f=a.frames;var g=a.numPlays;return(k=function(){var h=c++%b;var d=f[h];e.renderFrame(l,h);if(1<b&&c/b<g)return e.animation._timeout=setTimeout(k,d.delay)})()};n.prototype.stopAnimation=function(){var l;return clearTimeout(null!=(l=this.animation)?l._timeout:void 0)};n.prototype.render=function(l){l._png&&l._png.stopAnimation();l._png=this;l.width=this.width;l.height=this.height;l=l.getContext("2d");if(this.animation)return this.decodeFrames(l),this.animate(l);
var k=l.createImageData(this.width,this.height);this.copyToImageData(k,this.decodePixels());return l.putImageData(k,0,0)};return n}()})},"esri/layers/rasterFormats/Raw":function(){define([],function(){return{decodeBIP:function(H,n){var t=n.pixelType,l=n.bandCount,k=[],e=n.width*n.height,c=this.getBandCount(H,n);l=l||c;var a=H.byteLength-H.byteLength%(e*this._getPixelLength(t)),b=new t(H,0,e*c),f,g,h;for(f=0;f<l;f++){var d=new t(e);for(g=0;g<e;g++)d[g]=b[g*c+f];k.push(d)}a<H.byteLength-1&&(h=this._decodeMask(H.slice(a),
n));return{pixels:k,maskData:h}},decodeBSQ:function(H,n){var t=n.pixelType,l=n.bandCount;if(void 0===l||null===l)l=this.getBandCount(H,n);var k=[],e=n.width*n.height,c=e*l,a=H.byteLength-H.byteLength%(e*this._getPixelLength(t));t=new t(H,0,c);var b;for(c=0;c<l;c++)k.push(t.subarray(c*e,(c+1)*e));a<H.byteLength-1&&(b=this._decodeMask(H.slice(a),n));return{pixels:k,maskData:b}},getBandCount:function(H,n){return Math.floor(H.byteLength/(n.width*n.height*this._getPixelLength(n.pixelType)))},_getPixelLength:function(H){var n=
1;switch(H){case Uint8Array:case Int8Array:case Uint8ClampedArray:n=1;break;case Uint16Array:case Int16Array:n=2;break;case Uint32Array:case Int32Array:case Float32Array:n=4;break;case Float64Array:n=8}return n},_decodeMask:function(H,n){var t=n.width*n.height;if(8*H.byteLength<t)return null;H=new Uint8Array(H,0,Math.ceil(t/8));n=new Uint8Array(n.width*n.height);var l=0,k=0,e=0,c=0;for(e=0;e<H.length-1;e++)for(k=H[e],c=7;0<=c;c--)n[l++]=k>>c&1;for(c=7;l<t-1;)k=H[H.length-1],n[l++]=k>>c&1,c--;return n}}})},
"esri/layers/rasterFormats/TiffDecoder":function(){define(["./Jpg","./Zlib"],function(H,n){var t=function(){var c=new ArrayBuffer(4),a=new Uint8Array(c);c=new Uint32Array(c);a[0]=1;a[1]=2;a[2]=3;a[3]=4;return 67305985===c[0]},l=function(){var c=[];c[254]="NEWSUBFILETYPE";c[255]="SUBFILETYPE";c[256]="IMAGEWIDTH";c[257]="IMAGELENGTH";c[258]="BITSPERSAMPLE";c[259]="COMPRESSION";c[262]="PHOTOMETRICINTERPRETATION";c[263]="THRESHHOLDING";c[264]="CELLWIDTH";c[265]="CELLLENGTH";c[266]="FILLORDER";c[269]=
"DOCUMENTNAME";c[270]="IMAGEDESCRIPTION";c[271]="MAKE";c[272]="MODEL";c[273]="STRIPOFFSETS";c[274]="ORIENTATION";c[277]="SAMPLESPERPIXEL";c[278]="ROWSPERSTRIP";c[279]="STRIPBYTECOUNTS";c[280]="MINSAMPLEVALUE";c[281]="MAXSAMPLEVALUE";c[282]="XRESOLUTION";c[283]="YRESOLUTION";c[284]="PLANARCONFIGURATION";c[285]="PAGENAME";c[286]="XPOSITION";c[287]="YPOSITION";c[288]="FREEOFFSETS";c[289]="FREEBYTECOUNTS";c[290]="GRAYRESPONSEUNIT";c[291]="GRAYRESPONSECURVE";c[292]="T4OPTIONS";c[293]="T6OPTIONS";c[296]=
"RESOLUTIONUNIT";c[297]="PAGENUMBER";c[300]="COLORRESPONSEUNIT";c[301]="TRANSFERFUNCTION";c[305]="SOFTWARE";c[306]="DATETIME";c[315]="ARTIST";c[316]="HOSTCOMPUTER";c[317]="PREDICTOR";c[318]="WHITEPOINT";c[319]="PRIMARYCHROMATICITIES";c[320]="COLORMAP";c[321]="HALFTONEHINTS";c[322]="TILEWIDTH";c[323]="TILELENGTH";c[324]="TILEOFFSETS";c[325]="TILEBYTECOUNTS";c[326]="BADFAXLINES";c[327]="CLEANFAXDATA";c[328]="CONSECUTIVEBADFAXLINES";c[330]="SUBIFD";c[332]="INKSET";c[333]="INKNAMES";c[334]="NUMBEROFINKS";
c[336]="DOTRANGE";c[337]="TARGETPRINTER";c[338]="EXTRASAMPLES";c[339]="SAMPLEFORMAT";c[340]="SMINSAMPLEVALUE";c[341]="SMAXSAMPLEVALUE";c[342]="TRANSFERRANGE";c[347]="JPEGTABLES";c[512]="JPEGPROC";c[513]="JPEGIFOFFSET";c[514]="JPEGIFBYTECOUNT";c[515]="JPEGRESTARTINTERVAL";c[517]="JPEGLOSSLESSPREDICTORS";c[518]="JPEGPOINTTRANSFORM";c[519]="JPEGQTABLES";c[520]="JPEGDCTABLES";c[521]="JPEGACTABLES";c[529]="YCBCRCOEFFICIENTS";c[530]="YCBCRSUBSAMPLING";c[531]="YCBCRPOSITIONING";c[532]="REFERENCEBLACKWHITE";
c[33550]="GEOPIXELSCALE";c[33922]="GEOTIEPOINTS";c[33432]="COPYRIGHT";c[42112]="GDAL_METADATA";c[42113]="GDAL_NODATA";c[50844]="RPCCOEFFICIENT";c[34735]="GEOKEYDIRECTORY";c[34736]="GEODOUBLEPARAMS";c[34737]="GEOASCIIPARAMS";return c}(),k=[0,1,1,2,4,8,1,1,2,4,8,4,8],e=function(c,a){var b="UNKNOWN";3===c?b="F32":1===c?8>=a?b="U8":16>=a?b="U16":32>=a&&(b="U32"):2===c&&(8>=a?b="S8":16>=a?b="S16":32>=a&&(b="S32"));return b};return{decode:function(c){var a=new DataView(c,0,8),b=a.getUint16(0,!1);if(18761===
b)var f=!0;else if(19789===b)f=!1;else throw"unexpected endianess byte";if(42!==a.getUint16(2,f))throw"unexpected tiff identifier";var g=a.getUint32(4,f);var h=f;var d,m;var p=g;for(var v=[];p;){var q=(new DataView(c,p,2)).getUint16(0,h);var w=p+2;p=(new DataView(c,w+12*q,4)).getUint32(0,h);var y={};for(d=0;d<q;d++){var x=new DataView(c,w,12);var E=x.getUint16(0,h);var B=x.getUint16(2,h);var C=x.getUint32(4,h);var G=x.getUint32(8,h);w+=12;if(!(7===B||12<B)){var I=m={fieldTag:E,fieldType:B,fieldValueCount:C,
fieldValueOffset:G},D=void 0,r=void 0,u=c,A=h,J=[],O=m.fieldType,P=m.fieldValueCount,z=m.fieldValueOffset,F=z,M=k[O],Q=8*M,R=P*M,K=P*k[O]*8;if(32>=K)if(A||(z>>>=32-K),1===P)J=[z];else for(D=0;D<P;D++)J.push(z<<Q*D>>>32-Q);else for(F=z;F<z+R;F+=M){switch(O){case 1:r=(new DataView(u,F,1)).getUint8(0);break;case 2:r=(new DataView(u,F,1)).getUint8(0);break;case 3:r=(new DataView(u,F,2)).getUint16(0,A);break;case 4:r=(new DataView(u,F,4)).getUint32(0,A);break;case 5:r=(new DataView(u,F,4)).getUint32(0,
A)/(new DataView(u,F+4,4)).getUint32(0,A);break;case 6:r=(new DataView(u,F,1)).getInt8(0);break;case 8:r=(new DataView(u,F,2)).getInt16(0,A);break;case 9:r=(new DataView(u,F,4)).getInt32(0,A);break;case 10:r=(new DataView(u,F,4)).getInt32(0,A)/(new DataView(u,F+4,4)).getInt32(0,A);break;case 11:r=(new DataView(u,F,4)).getFloat32(0,A);break;case 12:r=(new DataView(u,F,8)).getFloat64(0,A);break;case 7:r=null;break;default:r=null}J.push(r)}if(2===O){var N="",V=J;J=[];for(D=0;D<V.length;D++)0===V[D]&&
""!==N?(J.push(N),N=""):N+=String.fromCharCode(V[D]);""===N&&0!==J.length||J.push(N)}I.fieldValues=J;var W=y,L=l[E];void 0===L&&(L="unknown"+E);W[L]={type:B,values:m.fieldValues}}}v.push(y)}if(0===v.length)throw"no valid image file directory";var T,S=v[0],U=void 0===S.GDAL_NODATA||null===S.GDAL_NODATA?null:parseFloat(S.GDAL_NODATA.values[0]);if(S.TILEOFFSETS){var X=t()===h,Y=S.TILEOFFSETS?S.TILEOFFSETS.values:void 0;if(void 0===Y)var Z=void 0;else{var aa=S.TILEBYTECOUNTS.values,ba=S.TILEWIDTH.values[0],
ia=S.TILELENGTH.values[0],da=S.IMAGEWIDTH.values[0],ca=S.IMAGELENGTH.values[0],oa=da*ca,ra=S.BITSPERSAMPLE.values[0],ja=S.SAMPLESPERPIXEL.values[0],ma=S.SAMPLEFORMAT?S.SAMPLEFORMAT.values[0]:1,Ca=e(ma,ra);if(1!==(S.PLANARCONFIGURATION?S.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var ea=S.COMPRESSION?S.COMPRESSION.values[0]:1;if(1!==ea&&6!==ea&&8!==ea&&32946!==ea)throw console.log("this compression is not supported at this moment"),
"this compression is not supported at this moment";if(3<ma)Z=void 0;else{if(3===ma){var sa=new Float32Array(oa*ja);var xa=Float32Array}else 1===ma?8>=ra?(sa=new Uint8Array(oa*ja),xa=Uint8Array):16>=ra?(sa=new Uint16Array(oa*ja),xa=Uint16Array):32>=ra&&(sa=new Uint32Array(oa*ja),xa=Uint32Array):2===ma&&(8>=ra?(sa=new Int8Array(oa*ja),xa=Int8Array):16>=ra?(sa=new Int16Array(oa*ja),xa=Int16Array):32>=ra&&(sa=new Int32Array(oa*ja),xa=Int32Array));var fa,va,la,Aa,Ka,Ba=Math.ceil(da/ba);if(0===ra%8)for(fa=
0;fa<Y.length;fa++){var La=Math.floor(fa/Ba)*ia;var Ra=fa%Ba*ba;var Pa=(La*da+Ra)*ja;if("U8"===Ca||"S8"===Ca||X)if(8===ea||32946===ea){var ha=new Uint8Array(c,Y[fa],aa[fa]);var Ma=new n(ha);var Qa=Ma.getBytes();var ua=new ArrayBuffer(Qa.length);ha=new Uint8Array(ua);ha.set(Qa);ha.length!==ba*ia*ja*ra/8&&console.log("tile byte counts is different than expected")}else if(6===ea){ha=new Uint8Array(c,Y[fa],aa[fa]);var Na=new H;Na.parse(ha);var pa=Na.getData(Na.width,Na.height);ua=new ArrayBuffer(pa.length);
ha=new Uint8Array(ua);ha.set(pa)}else 1===ea&&(aa[fa]!==ba*ia*ja*ra/8&&console.log("tile byte counts is different than expected"),ua=c.slice(Y[fa],Y[fa]+aa[fa]));else{if(8===ea||32946===ea){ha=new Uint8Array(c,Y[fa],aa[fa]);Ma=new n(ha);ha=Ma.getBytes();ua=new ArrayBuffer(ha.length);var wa=new Uint8Array(ua);ha.length!==ba*ia*ja*ra/8&&console.log("tile byte counts is different than expected")}else 1===ea&&(aa[fa]!==ba*ia*ja*ra/8&&console.log("tile byte counts is different than expected"),ua=new ArrayBuffer(aa[fa]),
ha=new Uint8Array(c,Y[fa],aa[fa]),wa=new Uint8Array(ua));switch(Ca){case "U16":case "S16":for(la=0;la<ha.length;la+=2)wa[la]=ha[la+1],wa[la+1]=ha[la];break;case "U32":case "S32":case "F32":for(la=0;la<ha.length;la+=4)wa[la]=ha[la+3],wa[la+1]=ha[la+2],wa[la+2]=ha[la+1],wa[la+3]=ha[la]}}var hb=new xa(ua);var ab=0;var bb=Pa;var ib=Math.min(ba,da-Ra);var jb=Math.min(ia,ca-La);for(Aa=0;Aa<jb;Aa++)for(bb=Pa+Aa*da*ja,ab=Aa*ba*ja,Ka=0;Ka<ib*ja;Ka++,bb++,ab++)sa[bb]=hb[ab]}var Xa={width:da,height:ca,pixelType:Ca};
if(1===ja)Xa.pixels=[sa];else for(Xa.pixels=[],fa=0;fa<ja;fa++){var db=new xa(oa);for(va=0;va<oa;va++)db[va]=sa[va*ja+fa];Xa.pixels.push(db)}Z=Xa}}}else if(S.STRIPOFFSETS){var kb=t()===h,Fa=S.STRIPOFFSETS?S.STRIPOFFSETS.values:void 0;if(void 0===Fa)Z=void 0;else{var Ga=S.STRIPBYTECOUNTS.values,Sa=S.ROWSPERSTRIP.values,Ha=S.IMAGEWIDTH.values[0],Ta=S.IMAGELENGTH.values[0],Ia=Ha*Ta,ya=S.BITSPERSAMPLE.values[0],ta=S.SAMPLESPERPIXEL.values[0],Ua=S.SAMPLEFORMAT?S.SAMPLEFORMAT.values[0]:1,Ya=e(Ua,ya);if(1!==
(S.PLANARCONFIGURATION?S.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var za=S.COMPRESSION?S.COMPRESSION.values[0]:1;if(1!==za&&6!==za&&8!==za&&32946!==za)throw console.log("compressed tiff is not supported at this moment"),"compressed tiff is not supported at this moment";if(3<Ua)Z=void 0;else{if(3===Ua){var Da=new Float32Array(Ia*ta);var Ja=Float32Array}else 1===Ua?8>=ya?(Da=new Uint8Array(Ia*ta),Ja=Uint8Array):
16>=ya?(Da=new Uint16Array(Ia*ta),Ja=Uint16Array):32>=ya&&(Da=new Uint32Array(Ia*ta),Ja=Uint32Array):2===Ua&&(8>=ya?(Da=new Int8Array(Ia*ta),Ja=Int8Array):16>=ya?(Da=new Int16Array(Ia*ta),Ja=Int16Array):32>=ya&&(Da=new Int32Array(Ha*Ta*ta),Ja=Int32Array));var ka,Va,qa,Wa=Sa;if(0===ya%8)for(ka=0;ka<Fa.length;ka++){var lb=ka*Sa*Ha*ta;Wa=(ka+1)*Sa>Ta?Ta-ka*Sa:Sa;if("U8"===Ya||"S8"===Ya||kb)if(8===za||32946===za){var na=new Uint8Array(c,Fa[ka],Ga[ka]);var cb=new n(na);var eb=cb.getBytes();var Ea=new ArrayBuffer(eb.length);
na=new Uint8Array(Ea);na.set(eb);na.length!==Wa*Ha*ta*ya/8&&console.log("strip byte counts is different than expected")}else if(6===za){na=new Uint8Array(c,Fa[ka],Ga[ka]);var Za=new H;Za.parse(na);var fb=Za.getData(Za.width,Za.height);Ea=new ArrayBuffer(fb.length);na=new Uint8Array(Ea);na.set(fb)}else 1===za&&(Ga[ka]!==Wa*Ha*ta*ya/8&&console.log("strip byte counts is different than expected"),Ea=c.slice(Fa[ka],Fa[ka]+Ga[ka]));else{if(6===za||8===za||32946===za){na=new Uint8Array(c,Fa[ka],Ga[ka]);
cb=new n(na);na=cb.getBytes();Ea=new ArrayBuffer(na.length);var Oa=new Uint8Array(Ea);na.length!==Wa*Ha*ta*ya/8&&console.log("strip byte counts is different than expected")}else 1===za&&(Ga[ka]!==Wa*Ha*ta*ya/8&&console.log("strip byte counts is different than expected"),Ea=new ArrayBuffer(Ga[ka]),na=new Uint8Array(c,Fa[ka],Ga[ka]),Oa=new Uint8Array(Ea));switch(Ya){case "U16":case "S16":for(qa=0;qa<na.length;qa+=2)Oa[qa]=na[qa+1],Oa[qa+1]=na[qa];break;case "U32":case "S32":case "F32":for(qa=0;qa<na.length;qa+=
4)Oa[qa]=na[qa+3],Oa[qa+1]=na[qa+2],Oa[qa+2]=na[qa+1],Oa[qa+3]=na[qa]}}var mb=new Ja(Ea);Da.set(mb,lb)}var $a={width:Ha,height:Ta,pixelType:Ya};if(1===ta)$a.pixels=[Da];else for($a.pixels=[],ka=0;ka<ta;ka++){var gb=new Ja(Ia);for(Va=0;Va<Ia;Va++)gb[Va]=Da[Va*ta+ka];$a.pixels.push(gb)}Z=$a}}}if(null!==U){Z.maskData=new Uint8Array(Z.width*Z.height);if(1E24<Math.abs(U))for(T=0;T<Z.width*Z.height;T++)Z.maskData[T]=1E-6>Math.abs((Z.pixels[0][T]-U)/U)?0:1;else for(T=0;T<Z.width*Z.height;T++)Z.maskData[T]=
Z.pixels[0][T]===U?0:1;Z.noDataValue=U}return Z}}})},"esri/layers/rasterLib/tile/RasterHandler":function(){define("require exports module dojo/Deferred dojo/promise/all ../../PixelBlock ../../vectorTiles/core/workers ../../vectorTiles/core/promiseUtils ../../vectorTiles/core/requireUtils ../../vectorTiles/request ../../rasterLib/function/rasterFunctionHelper ../../rasterLib/renderer/rasterRendererHelper".split(" "),function(H,n,t,l,k,e,c,a,b,f,g,h){function d(m){var p=new l;k(m).then(function(v){p.resolve()});
return p.promise}return function(){function m(p){this.customModules=p&&p.customModules}m.prototype.destroy=function(){this.stop();this.customModules=this.rasterLayer=null};m.prototype.start=function(){this.stop();var p=new l,v=0,q=this.customModules?this.customModules.length+1:1,w=b.getAbsMid("esri/layers/rasterLib/tile/RasterWorker",H,t),y=c.open(w,{client:this}).then(function(x){this._connection=x;v++;v===q&&(this._connected=!0,p.resolve())}.bind(this));this._openDL=[y];this.customModules&&this.customModules.forEach(function(x){y=
c.open(x,{client:this}).then(function(E){v++;v===q&&(this._connected=!0,p.resolve())});this._openDL.push(y);console.log(x)}.bind(this));return this._connectionPromise=p.promise};m.prototype.stop=function(){this._openDL?this._openDL.forEach(function(p){p.isFulfilled()||p.cancel()}.bind(this)):this._connectionPromise&&!this._connectionPromise.isFulfilled()&&this._connectionPromise.cancel();this._connection&&(this._connection.close(),this._connection=null)};m.prototype.decode=function(p){if(!this._connectionPromise.isFulfilled()||
!this._connection)return a.reject(Error("no connection"));var v={id:null};return this._connection.invoke("decode",p,[],v).then(function(q){q.targetWorker=v;return q})};m.prototype.process=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var v={id:null};p.layerId=this.rasterLayer.layerId;var q=new l;this._connection.invoke("process",p,[],v).then(function(w){w.targetWorker=v;w.src?Object.keys(w.src).forEach(function(y){w.src[y].pixelBlock=
new e(w.src[y].pixelBlock)}):w.src=null;w.pixelBlock&&(w.pixelBlock=new e(w.pixelBlock));q.resolve(w)});return q.promise};m.prototype.render=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var v={id:null};p.layerId=this.rasterLayer.layerId;return this._connection.invoke("render",p,[],v).then(function(q){q.targetWorker=v;q.pixelBlock=q.pixelBlock?new e(q.pixelBlock):null;return q})};m.prototype.setLayer=function(p){if(!this._connectionPromise.isFulfilled()||
!this._connection)return a.reject(Error("no connection"));this.rasterLayer=p;p=this._connection.broadcast("setLayer",p,[],{id:null});return d(p)};m.prototype.setRasterFunction=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));p=this._connection.broadcast("setRasterFunction",p,[],{id:null});return d(p)};m.prototype.setRasterRenderer=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));
p=this._connection.broadcast("setRasterRenderer",p,[],{id:null});return d(p)};return m}()})},"esri/layers/vectorTiles/core/workers":function(){define(["require","exports","./workers/workers"],function(H,n,t){Object.defineProperty(n,"__esModule",{value:!0});for(var l in t)n.hasOwnProperty(l)||(n[l]=t[l])})},"esri/layers/vectorTiles/core/workers/workers":function(){define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),function(H,
n,t,l,k,e,c,a,b){function f(){if(v)return v;for(var q=g+h,w=[],y=function(E){var B=b.create(E).then(function(C){return p[E]=C});w.push(B)},x=0;x<q;x++)y(x);return v=l(w).then(function(){})}Object.defineProperty(n,"__esModule",{value:!0});n.Connection=c;n.RemoteClient=a;(c=navigator.hardwareConcurrency)||(c=t("safari")&&t("mac")||t("trident")?8:2);var g=t("esri-workers-debug")?1:Math.max(1,Math.ceil(c/2)),h=t("esri-workers-debug")?1:Math.max(1,Math.floor(c/2)),d=k.getLogger("esri.core.workers"),m=
0,p=[];n.initialize=function(){f()};n.open=function(q,w,y){void 0===w&&(w={});if(Array.isArray(q))return new n.Connection(q.map(function(B){return new n.RemoteClient(B,w.client)}));if("string"!==typeof q){d.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var x=q;q=w;w={client:x,strategy:y?"dedicated":"distributed"}}var E=w.strategy||"distributed";return"local"===E?e.create(function(B){H([q],function(C){B(n.RemoteClient.connect(C))})}).then(function(B){return new n.Connection([new n.RemoteClient(B,
w.client)])}):f().then(function(){if("dedicated"===E){var B=g+m++;m%=h;return p[B].open(q).then(function(C){return new n.Connection([new n.RemoteClient(C,w.client)])})}return e.all(p.map(function(C){return C.open(q)})).then(function(C){return new n.Connection(C.map(function(G){return new n.RemoteClient(G,w.client)}))})})};n.terminate=function(){for(var q=0;q<p.length;q++)p[q]&&p[q].terminate();p.length=0};var v})},"esri/layers/vectorTiles/core/Logger":function(){define(["require","exports","dojo/has"],
function(H,n,t){var l={info:0,warn:1,error:2};H=function(){function k(e){void 0===e&&(e={});this.module=e.module||"";this.writer=e.writer||null;this.level=e.level||null;null!=e.enabled&&(this.enabled=!!e.enabled);k._loggers[this.module]=this;e=this.module.lastIndexOf(".");-1!==e&&(this.parent=k.getLogger(this.module.slice(0,e)))}k.prototype.log=function(e){for(var c=[],a=1;a<arguments.length;a++)c[a-1]=arguments[a];this._isEnabled()&&this._matchLevel(e)&&(a=this._inheritedWriter())&&a.apply(void 0,
[e,this.module].concat(c))};k.prototype.error=function(){for(var e=[],c=0;c<arguments.length;c++)e[c]=arguments[c];this.log.apply(this,["error"].concat(e))};k.prototype.warn=function(){for(var e=[],c=0;c<arguments.length;c++)e[c]=arguments[c];this.log.apply(this,["warn"].concat(e))};k.prototype.info=function(){for(var e=[],c=0;c<arguments.length;c++)e[c]=arguments[c];this.log.apply(this,["info"].concat(e))};k.prototype.getLogger=function(e){return k.getLogger(this.module+"."+e)};k.getLogger=function(e){var c=
k._loggers[e];c||(c=new k({module:e}));return c};k.prototype._parentWithMember=function(e,c){for(var a=this;a&&null==a[e];)a=a.parent;return a?a[e]:c};k.prototype._inheritedWriter=function(){return this._parentWithMember("writer",this._consoleWriter)};k.prototype._consoleWriter=function(e,c){for(var a=[],b=2;b<arguments.length;b++)a[b-2]=arguments[b];console[e].apply(console,["["+c+"]"].concat(a))};k.prototype._matchLevel=function(e){return l[this._parentWithMember("level","error")]<=l[e]};k.prototype._isEnabled=
function(){return this._parentWithMember("enabled",!0)};k._loggers={};return k}();n=H.getLogger("esri");t("dojo-debug-messages")?n.level="info":n.level="warn";return H})},"esri/layers/vectorTiles/core/promiseUtils":function(){define("require exports dojo/Deferred dojo/when dojo/promise/all ./Error".split(" "),function(H,n,t,l,k,e){function c(a){if(a){if("function"!==typeof a.forEach){var b=Object.keys(a),f=b.map(function(m){return a[m]});return c(f).then(function(m){var p={};b.forEach(function(v,
q){return p[v]=m[q]});return p})}var g=new t,h=[],d=a.length;0===d&&g.resolve(h);a.forEach(function(m){var p={promise:m};h.push(p);m.then(function(v){p.value=v}).catch(function(v){p.error=v}).then(function(){--d;0===d&&g.resolve(h)})});return g.promise}}Object.defineProperty(n,"__esModule",{value:!0});n.all=function(a){return k(a)};n.filter=function(a,b){var f=a.slice();return k(a.map(function(g,h){return b(g,h)})).then(function(g){return f.filter(function(h,d){return g[d]})})};n.eachAlways=c;n.create=
function(a,b){var f=new t(b);a(function(g){void 0===g&&(g=null);return l(g).then(f.resolve)},f.reject);return f.promise};n.reject=function(a){var b=new t;b.reject(a);return b.promise};n.resolve=function(a){void 0===a&&(a=null);var b=new t;b.resolve(a);return b.promise};n.after=function(a,b){void 0===b&&(b=null);var f=0,g=new t(function(){f&&(clearTimeout(f),f=0)});f=setTimeout(function(){g.resolve(b)},a);return g.promise};n.timeout=function(a,b,f){var g=0,h=new t(a.cancel);a.then(function(d){h.isFulfilled()||
(h.resolve(d),g&&(clearTimeout(g),g=0))});a.catch(function(d){h.isFulfilled()||(h.reject(d),g&&(clearTimeout(g),g=0))});g=setTimeout(function(){var d=f||new e("promiseUtils:timeout","The wrapped promise did not resolve within "+b+" ms");h.reject(d)},b);return h.promise};n.wrapCallback=function(a){var b=!1,f=new t(function(){return b=!0});a(function(g){b||f.resolve(g)});return f.promise};n.isThenable=function(a){return a&&"function"===typeof a.then};n.when=function(a){return l(a)}})},"esri/layers/vectorTiles/core/Error":function(){define(["require",
"exports","./tsSupport/extendsHelper","./lang","./Message"],function(H,n,t,l,k){H=function(e){function c(a,b,f){var g=e.call(this,a,b,f)||this;return g instanceof c?g:new c(a,b,f)}t(c,e);c.prototype.toJSON=function(){return{name:this.name,message:this.message,details:l.clone(this.details),dojoType:this.dojoType}};c.fromJSON=function(a){var b=new c(a.name,a.message,a.details);null!=a.dojoType&&(b.dojoType=a.dojoType);return b};return c}(k);H.prototype.type="error";return H})},"esri/layers/vectorTiles/core/tsSupport/extendsHelper":function(){define([],
function(){return function(){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var l in t)t.hasOwnProperty(l)&&(n[l]=t[l])};return function(n,t){function l(){this.constructor=n}H(n,t);n.prototype=null===t?Object.create(t):(l.prototype=t.prototype,new l)}}()})},"esri/layers/vectorTiles/core/lang":function(){define("dojo/_base/kernel dojo/_base/lang dojo/date dojo/number dojo/date/locale dojo/i18n!../nls/common".split(" "),function(H,n,t,l,
k,e){function c(m){return void 0!==m&&null!==m}function a(m){return c(m)?m:""}function b(m,p,v){var q=v.match(/([^\(]+)(\([^\)]+\))?/i),w=n.trim(q[1]);v=p[m];q=JSON.parse((q[2]?n.trim(q[2]):"{}").replace(/^\(/,"{").replace(/\)$/,"}").replace(/([{,])\s*([0-9a-zA-Z_]+)\s*:/gi,'$1"$2":').replace(/"\s*:\s*'/gi,'":"').replace(/'\s*(,|\})/gi,'"$1'));var y=q.utcOffset;if(-1===h.indexOf(w))w=n.getObject(w),n.isFunction(w)&&(v=w(v,m,p,q));else if("number"===typeof v||"string"===typeof v&&v&&!isNaN(Number(v)))switch(v=
Number(v),w){case "NumberFormat":m=n.mixin({},q);p=parseFloat(m.places);if(isNaN(p)||0>p)m.places=Infinity;return l.format(v,m);case "DateString":v=new Date(v);if(q.local||q.systemLocale)return q.systemLocale?v.toLocaleDateString()+(q.hideTime?"":" "+v.toLocaleTimeString()):v.toDateString()+(q.hideTime?"":" "+v.toTimeString());v=v.toUTCString();q.hideTime&&(v=v.replace(/\s+\d\d:\d\d:\d\d\s+(utc|gmt)/i,""));return v;case "DateFormat":return v=new Date(v),c(y)&&(v=t.add(v,"minute",v.getTimezoneOffset()-
y)),k.format(v,q)}return a(v)}function f(m,p){var v;if(p)for(v in m)m.hasOwnProperty(v)&&(void 0===m[v]?delete m[v]:m[v]instanceof Object&&f(m[v],!0));else for(v in m)m.hasOwnProperty(v)&&void 0===m[v]&&delete m[v];return m}function g(m){if(!m||"object"!=typeof m||n.isFunction(m))return m;if(m instanceof Int8Array||m instanceof Uint8Array||m instanceof Uint8ClampedArray||m instanceof Int16Array||m instanceof Int32Array||m instanceof Uint16Array||m instanceof Uint32Array||m instanceof Float32Array||
m instanceof Float64Array||m instanceof Date)return new m.constructor(m);if(m instanceof ArrayBuffer)return m.slice(0,m.byteLength);if("function"===typeof m.clone)m=m.clone();else if("function"===typeof m.map&&"function"===typeof m.forEach)m=m.map(g);else if("function"===typeof m.notifyChange&&"function"===typeof m.watch)m=m.clone();else{var p={},v,q={};for(v in m){var w=m[v];var y=!(v in q)||q[v]!==w;if(!(v in p)||p[v]!==w&&y)p[v]=g?g(w):w}m=p}return m}var h=["NumberFormat","DateString","DateFormat"],
d=/<\/?[^>]+>/g;return{equals:function(m,p){return m===p||"number"===typeof m&&isNaN(m)&&"number"===typeof p&&isNaN(p)||n.isFunction((m||{}).getTime)&&n.isFunction((p||{}).getTime)&&m.getTime()==p.getTime()||n.isFunction((m||{}).equals)&&m.equals(p)||n.isFunction((p||{}).equals)&&p.equals(m)||!1},mixin:n.mixin,valueOf:function(m,p){for(var v in m)if(m[v]==p)return v;return null},stripTags:function(m){if(m){var p=typeof m;if("string"===p)m=m.replace(d,"");else if("object"===p)for(var v in m)(p=m[v])&&
"string"===typeof p&&(p=p.replace(d,"")),m[v]=p}return m},substitute:function(m,p,v){if(c(v))if(n.isObject(v)){var q=v.first;var w=v.dateFormat;var y=v.numberFormat}else q=v;if(p&&"{*}"!==p)return n.replace(p,n.hitch({obj:m},function(E,B){E=B.split(":");return 1<E.length?(B=E[0],E.shift(),b(B,this.obj,E.join(":"))):w&&-1!==(w.properties||[]).indexOf(B)?b(B,this.obj,w.formatter||"DateString"):y&&-1!==(y.properties||[]).indexOf(B)?b(B,this.obj,y.formatter||"NumberFormat"):a(this.obj[B])}));p=[];var x;
p.push('\x3ctable class\x3d"esri-widget__table" summary\x3d"'+e.fieldsSummary+'"\x3e\x3ctbody\x3e');for(x in m)if(v=m[x],w&&-1!==(w.properties||[]).indexOf(x)?v=b(x,m,w.formatter||"DateString"):y&&-1!==(y.properties||[]).indexOf(x)&&(v=b(x,m,y.formatter||"NumberFormat")),p.push("\x3ctr\x3e\x3cth\x3e"+x+"\x3c/th\x3e\x3ctd\x3e"+a(v)+"\x3c/td\x3e\x3c/tr\x3e"),q)break;p.push("\x3c/tbody\x3e\x3c/table\x3e");return p.join("")},filter:function(m,p,v){p=[n.isString(m)?m.split(""):m,v||H.global,n.isString(p)?
new Function("item","index","array",p):p];v={};var q;m=p[0];for(q in m)p[2].call(p[q],m[q],q,m)&&(v[q]=m[q]);return v},startsWith:function(m,p,v){v=v||0;return m.indexOf(p,v)===v},endsWith:function(m,p,v){if("number"!==typeof v||!isFinite(v)||Math.floor(v)!==v||v>m.length)v=m.length;v-=p.length;m=m.indexOf(p,v);return-1!==m&&m===v},isDefined:c,fixJson:f,clone:g}})},"esri/layers/vectorTiles/core/Message":function(){define(["require","exports","dojo/string"],function(H,n,t){return function(){function l(k,
e,c){this instanceof l&&(this.name=k,this.message=e&&t.substitute(e,c,function(a){return null==a?"":a})||"",this.details=c)}l.prototype.toString=function(){return"["+this.name+"]: "+this.message};return l}()})},"esri/layers/vectorTiles/core/workers/Connection":function(){define(["require","exports","../promiseUtils"],function(H,n,t){return function(){function l(k){this._clientIdx=0;this._clients=k}l.prototype.broadcast=function(k,e,c){for(var a=[],b=0,f=this._clients;b<f.length;b++)a.push(f[b].invoke(k,
e,c));return a};l.prototype.close=function(){for(var k=0,e=this._clients;k<e.length;k++)e[k].close();this._clients=[]};l.prototype.invoke=function(k,e,c,a){var b=a&&a.client;if(!this._clients||!this._clients.length)return t.reject(Error("Connection closed"));null!=b&&-1!==this._clients.indexOf(b)||this._clients.some(function(f){return f.isBusy()?!1:(b=f,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,b=this._clients[this._clientIdx]);k=b.invoke(k,e,c);a&&(a.client=b);return k};l.prototype.openPorts=
function(){return t.all(this._clients.map(function(k){return k.openPort()}))};return l}()})},"esri/layers/vectorTiles/core/workers/RemoteClient":function(){define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(H,n,t,l,k,e){function c(m,p){m["delete"](p)}var a=e.MessageType.CLOSE,b=e.MessageType.CANCEL,f=e.MessageType.INVOKE,g=e.MessageType.RESPONSE,h=e.MessageType.OPEN_PORT,d=function(){function m(p){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=
[];this._invoke=p;this._timer=null;this._process=this._process.bind(this)}m.prototype.push=function(p){p.type===e.MessageType.CANCEL?this._cancelledJobIds.add(p.jobId):(this._invokeMessages.push(p),null===this._timer&&(this._timer=setTimeout(this._process,0)))};m.prototype.clear=function(){this._invokeMessages.length=0;this._cancelledJobIds.clear();this._timer=null};m.prototype._process=function(){this._timer=null;for(var p=0,v=this._invokeMessages;p<v.length;p++){var q=v[p];this._cancelledJobIds.has(q.jobId)||
this._invoke(q)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return m}();return function(){function m(p,v,q){this._outJobs=new Map;this._inJobs=new Map;this._queue=new d(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=v;this._port=p;this._port.addEventListener("message",this._onMessage);this._port.start();this._channel=q}m.connect=function(p){var v=new MessageChannel;p="function"===typeof p?new p:"default"in p&&"function"===typeof p.default?new p.default:
p;p.remoteClient=new m(v.port1,p,v);return v.port2};m.prototype.close=function(){this._post({type:a});this._close()};m.prototype.isBusy=function(){return 0<this._outJobs.size};m.prototype.invoke=function(p,v,q){var w=this;if(!this._port)return k.reject(new l("remote-client:port-closed","Can't invoke(), port is closed"));var y=e.newJobId(),x=new t(function(){c(w._outJobs,y);w._post({type:b,jobId:y})});this._outJobs.set(y,x);this._post({type:f,jobId:y,methodName:p},v,q);return x.promise};m.prototype.openPort=
function(){var p=this,v=e.newJobId(),q=new t(function(){c(p._outJobs,v);p._post({type:b,jobId:v})});this._outJobs.set(v,q);this._post({type:h,jobId:v});return q.promise};m.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",this._onMessage);this._port.close();this._outJobs.forEach(function(p){p.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};m.prototype._onMessage=function(p){if(p=e.receiveMessage(p))switch(p.type){case g:this._onResponse(p);
break;case f:this._queue.push(p);break;case b:this._onCancel(p);break;case a:this._close();break;case h:this._onOpenPort(p)}};m.prototype._onCancel=function(p){var v=this._inJobs,q=p.jobId,w=v.get(q);this._queue.push(p);w&&(c(v,q),w.cancel())};m.prototype._onInvoke=function(p){var v=this,q=p.methodName,w=p.jobId;p=p.data;var y=this._inJobs,x=this._client,E=x[q];try{if(!E&&q&&-1!==q.indexOf("."))for(var B=q.split("."),C=0;C<B.length-1;C++)x=x[B[C]],E=x[B[C+1]];if("function"!==typeof E)throw new TypeError(q+
" is not a function");var G=E.call(x,p,this)}catch(I){this._post({type:g,jobId:w,error:e.toInvokeError(I)});return}k.isThenable(G)?(y.set(w,G),G.then(function(I){y.has(w)&&(c(y,w),v._post({type:g,jobId:w},I))}).catch(function(I){y.has(w)&&(c(y,w),I&&"cancel"===I.dojoType||v._post({type:g,jobId:w,error:e.toInvokeError(I||{message:"Error encountered at method "+q})}))})):this._post({type:g,jobId:w},G)};m.prototype._onOpenPort=function(p){var v=new MessageChannel;new m(v.port1,this._client);this._post({type:g,
jobId:p.jobId},v.port2,[v.port2])};m.prototype._onResponse=function(p){var v=p.jobId,q=p.error;p=p.data;var w=this._outJobs;if(w.has(v)){var y=w.get(v);c(w,v);q?y.reject(l.fromJSON(JSON.parse(q))):y.resolve(p)}};m.prototype._post=function(p,v,q){return e.postMessage(this._port,p,v,q)};return m}()})},"esri/layers/vectorTiles/core/workers/utils":function(){define(["require","exports","dojo/has"],function(H,n,t){function l(e){return e&&"object"===typeof e&&("result"in e||"transferList"in e)}Object.defineProperty(n,
"__esModule",{value:!0});(function(e){e[e.HANDSHAKE=0]="HANDSHAKE";e[e.CONFIGURE=1]="CONFIGURE";e[e.CONFIGURED=2]="CONFIGURED";e[e.OPEN=3]="OPEN";e[e.OPENED=4]="OPENED";e[e.RESPONSE=5]="RESPONSE";e[e.INVOKE=6]="INVOKE";e[e.CANCEL=7]="CANCEL";e[e.CLOSE=8]="CLOSE";e[e.OPEN_PORT=9]="OPEN_PORT"})(n.MessageType||(n.MessageType={}));var k=0;n.newJobId=function(){return k++};n.isTranferableResult=l;n.toInvokeError=function(e){return e?e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,
details:e.details,stack:e.stack}):null};n.postMessage=function(e,c,a,b){2===arguments.length||void 0===a&&void 0===b?e.postMessage(c):(t("esri-workers-supports-transfer-arraybuffer")||(b?(b=b.filter(function(f){return!(f instanceof ArrayBuffer)}),b.length||(b=null)):l(a)&&a.transferList&&(a.transferList=a.transferList.filter(function(f){return!(f instanceof ArrayBuffer)}),a.transferList.length||(a.transferList=null))),b?(c.data=a,e.postMessage(c,b)):l(a)?(c.data=a.result,a.transferList?e.postMessage(c,
a.transferList):e.postMessage(c)):(c.data=a,e.postMessage(c)))};n.receiveMessage=function(e){return e?(e=e.data)?"string"===typeof e?JSON.parse(e):e:null:null}})},"esri/layers/vectorTiles/core/workers/WorkerOwner":function(){define("require exports dojo/Deferred ../../kernel ../Error ../Logger ../promiseUtils ./utils ./workerFactory".split(" "),function(H,n,t,l,k,e,c,a,b){var f=e.getLogger("esri.core.workers"),g=a.MessageType.CANCEL,h=a.MessageType.INVOKE,d=a.MessageType.OPEN,m=a.MessageType.OPENED,
p=a.MessageType.RESPONSE;return function(){function v(q,w){this._outJobs=new Map;this._inJobs=new Map;this.worker=q;this.id=w;q.addEventListener("message",this._onMessage.bind(this));q.addEventListener("error",function(y){y.preventDefault();f.error(y)})}v.create=function(q){return b.createWorker().then(function(w){return new v(w,q)})};v.prototype.terminate=function(){this.worker.terminate()};v.prototype.open=function(q){var w=this,y=a.newJobId(),x=new t(function(E){w._outJobs["delete"](y);w._post({type:g,
jobId:y})});this._outJobs.set(y,x);this._post({type:d,jobId:y,modulePath:q});return x.promise};v.prototype._onMessage=function(q){if(q=a.receiveMessage(q))switch(q.type){case m:case p:this._onResponse(q);break;case g:this._onCancel(q);break;case h:this._onInvoke(q)}};v.prototype._onCancel=function(q){(q=this._inJobs.get(q.jobId))&&q.cancel()};v.prototype._onInvoke=function(q){var w=this,y=q.methodName,x=q.jobId;q=q.data;var E=this._inJobs,B=l.workerMessages[y];try{if("function"!==typeof B)throw new TypeError(y+
" is not a function");var C=B.call(null,q)}catch(G){this._post({type:p,jobId:x,error:a.toInvokeError(G)});return}c.isThenable(C)?(E.set(x,C),C.then(function(G){E["delete"](x);w._post({type:p,jobId:x},G)}).catch(function(G){E["delete"](x);G||(G={message:"Error encountered at method"+y});G.dojoType&&"cancel"===G.dojoType||w._post({type:p,jobId:x,error:a.toInvokeError(G)})})):this._post({type:p,jobId:x},C)};v.prototype._onResponse=function(q){var w=q.jobId,y=q.error;q=q.data;var x=this._outJobs.get(w);
x&&(this._outJobs["delete"](w),y?x.reject(k.fromJSON(JSON.parse(y))):x.resolve(q))};v.prototype._post=function(q,w,y){return a.postMessage(this.worker,q,w,y)};return v}()})},"esri/layers/vectorTiles/kernel":function(){define(["require","exports","esri/kernel","./identity/IdentityManager"],function(H,n,t,l){return function(){function k(){}Object.defineProperty(k,"id",{get:function(){return t.id?l:null},enumerable:!0,configurable:!0});k.workerMessages={};return k}()})},"esri/layers/vectorTiles/identity/IdentityManager":function(){define(["require",
"exports","esri/IdentityManager"],function(H,n,t){Object.defineProperty(n,"__esModule",{value:!0});n.findCredential=function(l){return t.findCredential(l)}})},"esri/IdentityManager":function(){define(["./IdentityManagerDialog","./kernel","./OAuthSignInHandler","dojo/_base/declare"],function(H,n,t,l){H=new H;n.id=l.safeMixin(H,t);return n.id})},"esri/IdentityManagerDialog":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/config dojo/_base/Deferred dojo/_base/lang dojo/has dojo/dom-attr dojo/keys dijit/registry dijit/Dialog ./kernel ./lang ./domUtils ./Credential ./IdentityManagerBase dojo/i18n!./nls/jsapi dojo/query dijit/form/Button dijit/form/Form dijit/form/ValidationTextBox".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v){n=n([p],{declaredClass:"esri.IdentityManager",_eventMap:{"dialog-cancel":["info"]},constructor:function(q){k.mixin(this,q);this.registerConnectEvents()},_dialogContent:"\x3cdiv data-dojo-type\x3d'dijit.form.Form' data-dojo-props\x3d'\"class\":\"esriIdForm\"'\x3e\x3cdiv class\x3d'dijitDialogPaneContentArea'\x3e\x3cdiv style\x3d'padding-bottom: 5px; word-wrap: break-word;'\x3e${info}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriErrorMsg' style\x3d'display: none; color: white; background-color: #D46464; text-align: center; padding-top: 3px; padding-bottom: 3px;'\x3e${invalidUser}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3ctable style\x3d'width: 100%;'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel\x3e${lblUser}\x3cbr/\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' data-dojo-props\x3d'type:\"text\", \"class\":\"esriIdUser\", required:true, trim:true, style:\"width: 100%;\", autocapitalize:\"none\", autocorrect:\"off\", spellcheck:false' /\x3e\x3c/label\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel\x3e${lblPwd}\x3cbr/\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' data-dojo-props\x3d'type:\"password\", \"class\":\"esriIdPwd\", required:true, style:\"width: 100%;\"' /\x3e\x3c/label\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitDialogPaneActionBar'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdSubmit\"'\x3e${lblOk}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdCancel\"'\x3e${lblCancel}\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e",
onDialogCreate:function(){},onDialogCancel:function(){},signIn:function(q,w,y){this._nls||(this._nls=v.identity);this._loginDialog||(this._loginDialog=this.dialog=this._createLoginDialog(),this.onDialogCreate());var x=this._loginDialog,E=y&&y.error,B=y&&y.token,C=new l(function(){x.onCancel()});if(x.open)return q=Error("BUSY"),q.name="identity-manager:busy",q.code="IdentityManager.1",q.log=!!t.isDebug,C.errback(q),C;d.hide(x.errMsg_);E&&403==E.code&&B&&(c.set(x.errMsg_,"innerHTML",this._nls.forbidden),
d.show(x.errMsg_));x.dfd_=C;x.serverInfo_=w;x.resUrl_=q;x.admin_=y&&y.isAdmin;c.set(x.resLink_,{title:q,innerHTML:"("+(this.getResourceName(q)||this._nls.lblItem)+")"});c.set(x.serverLink_,{title:w.server,innerHTML:(-1!==w.server.toLowerCase().indexOf("arcgis.com")?"ArcGIS Online":w.server)+" "});x.txtPwd_.set("value","");x.show();return C},_createLoginDialog:function(){var q=this._nls,w=h.substitute(q,this._dialogContent);w=h.substitute({resource:"\x3cspan class\x3d'resLink' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e",
server:"\x3cspan class\x3d'serverLink' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e"},w);var y=new f({title:q.title,content:w,"class":"esriSignInDialog",style:"width: 18em;",esriIdMgr_:this,keypressed_:function(x){x.charOrCode===a.ENTER&&this.execute_()},execute_:function(){var x=this.txtUser_.get("value"),E=this.txtPwd_.get("value"),B=this.dfd_,C=this;if(this.form_.validate()&&x&&E){this.btnSubmit_.set("label",q.lblSigning);var G=g.id.findCredential(C.resUrl_,x),I=function(D){C.btnSubmit_.set("label",
q.lblOk);C.btnSubmit_.set("disabled",!1);d.hide(C.errMsg_);C.hide();f._DialogLevelManager.hide(C);var r=C.serverInfo_;C.dfd_=C.serverInfo_=C.generateDfd_=C.resUrl_=null;var u=G;if(D){var A=D.token;var J=h.isDefined(D.expires)?Number(D.expires):null;var O=!!D.ssl;u?(u.userId=x,u.token=A,u.expires=J,u.validity=D.validity,u.ssl=O,u.creationTime=(new Date).getTime()):u=new m({userId:x,server:r.server,token:A,expires:J,ssl:O,isAdmin:C.admin_,validity:D.validity})}B.callback(u)};G&&!G._enqueued?I():(C.btnSubmit_.set("disabled",
!0),C.generateDfd_=g.id.generateToken(this.serverInfo_,{username:x,password:E},{isAdmin:this.admin_}).addCallback(I).addErrback(function(D){C.btnSubmit_.set("disabled",!1);C.generateDfd_=null;C.btnSubmit_.set("label",q.lblOk);c.set(C.errMsg_,"innerHTML",D&&D.code?q.invalidUser:q.noAuthService);d.show(C.errMsg_)}))}},cancel_:function(){y.generateDfd_&&y.generateDfd_.cancel();var x=y.dfd_,E=y.resUrl_,B=y.serverInfo_;y.btnSubmit_.set("disabled",!1);y.dfd_=y.serverInfo_=y.generateDfd_=y.resUrl_=null;
d.hide(y.errMsg_);f._DialogLevelManager.hide(y);y.esriIdMgr_.onDialogCancel({resourceUrl:E,serverInfo:B});E=Error("ABORTED");E.name="identity-manager:user-aborted";E.code="IdentityManager.2";E.log=!!t.isDebug;x.errback(E)}});w=y.domNode;y.form_=b.byNode(H.query(".esriIdForm",w)[0]);y.txtUser_=b.byNode(H.query(".esriIdUser",w)[0]);y.txtPwd_=b.byNode(H.query(".esriIdPwd",w)[0]);y.btnSubmit_=b.byNode(H.query(".esriIdSubmit",w)[0]);y.btnCancel_=b.byNode(H.query(".esriIdCancel",w)[0]);y.resLink_=H.query(".resLink",
w)[0];y.serverLink_=H.query(".serverLink",w)[0];y.errMsg_=H.query(".esriErrorMsg",w)[0];y.connect(y.txtUser_,"onKeyPress",y.keypressed_);y.connect(y.txtPwd_,"onKeyPress",y.keypressed_);y.connect(y.btnSubmit_,"onClick",y.execute_);y.connect(y.btnCancel_,"onClick",y.onCancel);y.connect(y,"onCancel",y.cancel_);return y}});e("extend-esri")&&(g.IdentityManagerDialog=g.IdentityManager=n);return n})},"dijit/Dialog":function(){define("require dojo/_base/array dojo/aspect dojo/_base/declare dojo/Deferred dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/ready dojo/sniff dojo/touch dojo/window dojo/dnd/Moveable dojo/dnd/TimedMoveable ./focus ./_base/manager ./_Widget ./_TemplatedMixin ./_CssStateMixin ./form/_FormMixin ./_DialogMixin ./DialogUnderlay ./layout/ContentPane ./layout/utils dojo/text!./templates/Dialog.html ./a11yclick dojo/i18n!./nls/common".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q,w,y,x,E,B,C,G,I,D,r,u,A,J,O){function P(){}var z=new k;z.resolve(!0);B=l("dijit._DialogBase"+(v("dojo-bidi")?"_NoBidi":""),[G,D,r,I],{templateString:O,baseClass:"dijitDialog",cssStateNodes:{closeButtonNode:"dijitDialogCloseIcon"},_setTitleAttr:{node:"titleNode",type:"innerHTML"},open:!1,duration:B.defaultDuration,refocus:!0,autofocus:!0,_firstFocusItem:null,_lastFocusItem:null,draggable:!0,_setDraggableAttr:function(R){this._set("draggable",R)},maxRatio:.9,
closable:!0,_setClosableAttr:function(R){this.closeButtonNode.style.display=R?"":"none";this._set("closable",R)},postMixInProperties:function(){var R=g.getLocalization("dijit","common");d.mixin(this,R);this.inherited(arguments)},postCreate:function(){b.set(this.domNode,{display:"none",position:"absolute"});this.ownerDocumentBody.appendChild(this.domNode);this.inherited(arguments);t.after(this,"onExecute",d.hitch(this,"hide"),!0);t.after(this,"onCancel",d.hitch(this,"hide"),!0);m(this.closeButtonNode,
q.press,function(R){R.stopPropagation()});this._modalconnects=[]},onLoad:function(){this.resize();this._position();this.autofocus&&M.isTop(this)&&(this._getFocusItems(),E.focus(this._firstFocusItem));this.inherited(arguments)},focus:function(){this._getFocusItems();E.focus(this._firstFocusItem)},_endDrag:function(){var R=a.position(this.domNode),K=w.getBox(this.ownerDocument);R.y=Math.min(Math.max(R.y,0),K.h-R.h);R.x=Math.min(Math.max(R.x,0),K.w-R.w);this._relativePosition=R;this._position()},_setup:function(){var R=
this.domNode;this.titleBar&&this.draggable?(this._moveable=new (6==v("ie")?x:y)(R,{handle:this.titleBar}),t.after(this._moveable,"onMoveStop",d.hitch(this,"_endDrag"),!0)):c.add(R,"dijitDialogFixed");this.underlayAttrs={dialogId:this.id,"class":n.map(this["class"].split(/\s/),function(K){return K+"_underlay"}).join(" "),_onKeyDown:d.hitch(this,"_onKey"),ownerDocument:this.ownerDocument}},_size:function(){this.resize()},_position:function(){if(!c.contains(this.ownerDocumentBody,"dojoMove")){var R=
this.domNode,K=w.getBox(this.ownerDocument),N=this._relativePosition,V=a.position(R);b.set(R,{left:Math.floor(K.l+(N?Math.min(N.x,K.w-V.w):(K.w-V.w)/2))+"px",top:Math.floor(K.t+(N?Math.min(N.y,K.h-V.h):(K.h-V.h)/2))+"px"})}},_onKey:function(R){if(R.keyCode==h.TAB){this._getFocusItems();var K=R.target;this._firstFocusItem==this._lastFocusItem?(R.stopPropagation(),R.preventDefault()):K==this._firstFocusItem&&R.shiftKey?(E.focus(this._lastFocusItem),R.stopPropagation(),R.preventDefault()):K!=this._lastFocusItem||
R.shiftKey||(E.focus(this._firstFocusItem),R.stopPropagation(),R.preventDefault())}else this.closable&&R.keyCode==h.ESCAPE&&(this.onCancel(),R.stopPropagation(),R.preventDefault())},show:function(){if(this.open)return z.promise;this._started||this.startup();this._alreadyInitialized||(this._setup(),this._alreadyInitialized=!0);this._fadeOutDeferred&&(this._fadeOutDeferred.cancel(),M.hide(this));var R=w.get(this.ownerDocument);this._modalconnects.push(m(R,"scroll",d.hitch(this,"resize",null)));this._modalconnects.push(m(this.domNode,
"keydown",d.hitch(this,"_onKey")));b.set(this.domNode,{opacity:0,display:""});this._set("open",!0);this._onShow();this.resize();this._position();this._fadeInDeferred=new k(d.hitch(this,function(){K.stop();delete this._fadeInDeferred}));this._fadeInDeferred.then(void 0,P);R=this._fadeInDeferred.promise;var K=f.fadeIn({node:this.domNode,duration:this.duration,beforeBegin:d.hitch(this,function(){M.show(this,this.underlayAttrs)}),onEnd:d.hitch(this,function(){this.autofocus&&M.isTop(this)&&(this._getFocusItems(),
E.focus(this._firstFocusItem));this._fadeInDeferred.resolve(!0);delete this._fadeInDeferred})}).play();return R},hide:function(){if(!this._alreadyInitialized||!this.open)return z.promise;this._fadeInDeferred&&this._fadeInDeferred.cancel();this._fadeOutDeferred=new k(d.hitch(this,function(){K.stop();delete this._fadeOutDeferred}));this._fadeOutDeferred.then(void 0,P);this._fadeOutDeferred.then(d.hitch(this,"onHide"));var R=this._fadeOutDeferred.promise;var K=f.fadeOut({node:this.domNode,duration:this.duration,
onEnd:d.hitch(this,function(){this.domNode.style.display="none";M.hide(this);this._fadeOutDeferred.resolve(!0);delete this._fadeOutDeferred})}).play();this._scrollConnected&&(this._scrollConnected=!1);for(var N;N=this._modalconnects.pop();)N.remove();this._relativePosition&&delete this._relativePosition;this._set("open",!1);return R},resize:function(R){if("none"!=this.domNode.style.display){this._checkIfSingleChild();if(!R){this._shrunk&&(this._singleChild&&"undefined"!=typeof this._singleChildOriginalStyle&&
(this._singleChild.domNode.style.cssText=this._singleChildOriginalStyle,delete this._singleChildOriginalStyle),n.forEach([this.domNode,this.containerNode,this.titleBar,this.actionBarNode],function(W){W&&b.set(W,{position:"static",width:"auto",height:"auto"})}),this.domNode.style.position="absolute");var K=w.getBox(this.ownerDocument);K.w*=this.maxRatio;K.h*=this.maxRatio;var N=a.position(this.domNode);this._shrunk=!1;N.w>=K.w&&(R={w:K.w},a.setMarginBox(this.domNode,R),N=a.position(this.domNode),this._shrunk=
!0);N.h>=K.h&&(R||(R={w:N.w}),R.h=K.h,this._shrunk=!0);R&&(R.w||(R.w=N.w),R.h||(R.h=N.h))}if(R){a.setMarginBox(this.domNode,R);K=[];this.titleBar&&K.push({domNode:this.titleBar,region:"top"});this.actionBarNode&&K.push({domNode:this.actionBarNode,region:"bottom"});N={domNode:this.containerNode,region:"center"};K.push(N);var V=J.marginBox2contentBox(this.domNode,R);J.layoutChildren(this.domNode,V,K);this._singleChild?(K=J.marginBox2contentBox(this.containerNode,N),this._singleChild.resize({w:K.w,h:K.h})):
(this.containerNode.style.overflow="auto",this._layoutChildren())}else this._layoutChildren();v("touch")||R||this._position()}},_layoutChildren:function(){n.forEach(this.getChildren(),function(R){R.resize&&R.resize()})},destroy:function(){this._fadeInDeferred&&this._fadeInDeferred.cancel();this._fadeOutDeferred&&this._fadeOutDeferred.cancel();this._moveable&&this._moveable.destroy();for(var R;R=this._modalconnects.pop();)R.remove();M.hide(this);this.inherited(arguments)}});v("dojo-bidi")&&(B=l("dijit._DialogBase",
B,{_setTitleAttr:function(R){this._set("title",R);this.titleNode.innerHTML=R;this.applyTextDir(this.titleNode)},_setTextDirAttr:function(R){this._created&&this.textDir!=R&&(this._set("textDir",R),this.set("title",this.title))}}));var F=l("dijit.Dialog",[A,B],{});F._DialogBase=B;var M=F._DialogLevelManager={_beginZIndex:950,show:function(R,K){Q[Q.length-1].focus=E.curNode;var N=Q[Q.length-1].dialog?Q[Q.length-1].zIndex+2:F._DialogLevelManager._beginZIndex;b.set(R.domNode,"zIndex",N);u.show(K,N-1);
Q.push({dialog:R,underlayAttrs:K,zIndex:N})},hide:function(R){if(Q[Q.length-1].dialog==R){Q.pop();var K=Q[Q.length-1];1==Q.length?u.hide():u.show(K.underlayAttrs,K.zIndex-1);if(R.refocus&&(R=K.focus,!K.dialog||R&&e.isDescendant(R,K.dialog.domNode)||(K.dialog._getFocusItems(),R=K.dialog._firstFocusItem),R))try{R.focus()}catch(N){}}else K=n.indexOf(n.map(Q,function(N){return N.dialog}),R),-1!=K&&Q.splice(K,1)},isTop:function(R){return Q[Q.length-1].dialog==R}},Q=F._dialogStack=[{dialog:null,focus:null,
underlayAttrs:null}];E.watch("curNode",function(R,K,N){R=Q[Q.length-1].dialog;if(N&&R&&!R._fadeOutDeferred&&N.ownerDocument==R.ownerDocument){do if(N==R.domNode||c.contains(N,"dijitPopup"))return;while(N=N.parentNode);R.focus()}});v("dijit-legacy-requires")&&p(0,function(){H(["dijit/TooltipDialog"])});return F})},"dojo/dnd/Moveable":function(){define("../_base/array ../_base/declare ../_base/lang ../dom ../dom-class ../Evented ../has ../on ../topic ../touch ./common ./Mover ../_base/window".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d){function m(q,w){"touchAction"in document.body.style?p="touchAction":"msTouchAction"in document.body.style&&(p="msTouchAction");v=function(y,x){y.style[p]=x};v(q,w)}var p,v=function(){};c("touch-action")&&(v=m);return n("dojo.dnd.Moveable",[e],{handle:"",delay:0,skip:!1,constructor:function(q,w){this.node=l.byId(q);v(this.node,"none");w||(w={});this.handle=w.handle?l.byId(w.handle):null;this.handle||(this.handle=this.node);this.delay=0<w.delay?w.delay:0;this.skip=
w.skip;this.mover=w.mover?w.mover:h;this.events=[a(this.handle,f.press,t.hitch(this,"onMouseDown")),a(this.handle,"dragstart",t.hitch(this,"onSelectStart")),a(this.handle,"selectstart",t.hitch(this,"onSelectStart"))]},markupFactory:function(q,w,y){return new y(w,q)},destroy:function(){H.forEach(this.events,function(q){q.remove()});v(this.node,"");this.events=this.node=this.handle=null},onMouseDown:function(q){if(!this.skip||!g.isFormElement(q)){if(this.delay)this.events.push(a(this.handle,f.move,
t.hitch(this,"onMouseMove")),a(this.handle.ownerDocument,f.release,t.hitch(this,"onMouseUp"))),this._lastX=q.pageX,this._lastY=q.pageY;else this.onDragDetected(q);q.stopPropagation();q.preventDefault()}},onMouseMove:function(q){if(Math.abs(q.pageX-this._lastX)>this.delay||Math.abs(q.pageY-this._lastY)>this.delay)this.onMouseUp(q),this.onDragDetected(q);q.stopPropagation();q.preventDefault()},onMouseUp:function(q){for(var w=0;2>w;++w)this.events.pop().remove();q.stopPropagation();q.preventDefault()},
onSelectStart:function(q){this.skip&&g.isFormElement(q)||(q.stopPropagation(),q.preventDefault())},onDragDetected:function(q){new this.mover(this.node,q,this)},onMoveStart:function(q){b.publish("/dnd/move/start",q);k.add(d.body(),"dojoMove");k.add(this.node,"dojoMoveItem")},onMoveStop:function(q){b.publish("/dnd/move/stop",q);k.remove(d.body(),"dojoMove");k.remove(this.node,"dojoMoveItem")},onFirstMove:function(){},onMove:function(q,w){this.onMoving(q,w);var y=q.node.style;y.left=w.l+"px";y.top=w.t+
"px";this.onMoved(q,w)},onMoving:function(){},onMoved:function(){}})})},"dojo/dnd/common":function(){define(["../sniff","../_base/kernel","../_base/lang","../dom"],function(H,n,t,l){var k=t.getObject("dojo.dnd",!0);k.getCopyKeyState=function(e){return e[H("mac")?"metaKey":"ctrlKey"]};k._uniqueId=0;k.getUniqueId=function(){do var e=n._scopeName+"Unique"+ ++k._uniqueId;while(l.byId(e));return e};k._empty={};k.isFormElement=function(e){e=e.target;3==e.nodeType&&(e=e.parentNode);return 0<=" a button textarea input select option ".indexOf(" "+
e.tagName.toLowerCase()+" ")};return k})},"dojo/dnd/Mover":function(){define("../_base/array ../_base/declare ../_base/lang ../sniff ../_base/window ../dom ../dom-geometry ../dom-style ../Evented ../on ../touch ./common ./autoscroll".split(" "),function(H,n,t,l,k,e,c,a,b,f,g,h,d){return n("dojo.dnd.Mover",[b],{constructor:function(m,p,v){function q(w){w.preventDefault();w.stopPropagation()}this.node=e.byId(m);this.marginBox={l:p.pageX,t:p.pageY};this.mouseButton=p.button;p=this.host=v;m=m.ownerDocument;
this.events=[f(m,g.move,t.hitch(this,"onFirstMove")),f(m,g.move,t.hitch(this,"onMouseMove")),f(m,g.release,t.hitch(this,"onMouseUp")),f(m,"dragstart",q),f(m.body,"selectstart",q)];d.autoScrollStart(m);if(p&&p.onMoveStart)p.onMoveStart(this)},onMouseMove:function(m){d.autoScroll(m);var p=this.marginBox;this.host.onMove(this,{l:p.l+m.pageX,t:p.t+m.pageY},m);m.preventDefault();m.stopPropagation()},onMouseUp:function(m){(l("webkit")&&l("mac")&&2==this.mouseButton?0==m.button:this.mouseButton==m.button)&&
this.destroy();m.preventDefault();m.stopPropagation()},onFirstMove:function(m){var p=this.node.style,v=this.host;switch(p.position){case "relative":case "absolute":var q=Math.round(parseFloat(p.left))||0;p=Math.round(parseFloat(p.top))||0;break;default:p.position="absolute";p=c.getMarginBox(this.node);q=k.doc.body;var w=a.getComputedStyle(q),y=c.getMarginBox(q,w);w=c.getContentBox(q,w);q=p.l-(w.l-y.l);p=p.t-(w.t-y.t)}this.marginBox.l=q-this.marginBox.l;this.marginBox.t=p-this.marginBox.t;if(v&&v.onFirstMove)v.onFirstMove(this,
m);this.events.shift().remove()},destroy:function(){H.forEach(this.events,function(p){p.remove()});var m=this.host;if(m&&m.onMoveStop)m.onMoveStop(this);this.events=this.node=this.host=null}})})},"dojo/dnd/autoscroll":function(){define("../_base/lang ../sniff ../_base/window ../dom-geometry ../dom-style ../window".split(" "),function(H,n,t,l,k,e){var c={};H.setObject("dojo.dnd.autoscroll",c);c.getViewport=e.getBox;c.V_TRIGGER_AUTOSCROLL=32;c.H_TRIGGER_AUTOSCROLL=32;c.V_AUTOSCROLL_VALUE=16;c.H_AUTOSCROLL_VALUE=
16;var a,b=t.doc,f=Infinity,g=Infinity;c.autoScrollStart=function(h){b=h;a=e.getBox(b);h=t.body(b).parentNode;f=Math.max(h.scrollHeight-a.h,0);g=Math.max(h.scrollWidth-a.w,0)};c.autoScroll=function(h){var d=a||e.getBox(b),m=t.body(b).parentNode,p=0,v=0;h.clientX<c.H_TRIGGER_AUTOSCROLL?p=-c.H_AUTOSCROLL_VALUE:h.clientX>d.w-c.H_TRIGGER_AUTOSCROLL&&(p=Math.min(c.H_AUTOSCROLL_VALUE,g-m.scrollLeft));h.clientY<c.V_TRIGGER_AUTOSCROLL?v=-c.V_AUTOSCROLL_VALUE:h.clientY>d.h-c.V_TRIGGER_AUTOSCROLL&&(v=Math.min(c.V_AUTOSCROLL_VALUE,
f-m.scrollTop));window.scrollBy(p,v)};c._validNodes={div:1,p:1,td:1};c._validOverflow={auto:1,scroll:1};c.autoScrollNodes=function(h){for(var d,m,p,v,q,w=0,y=0,x=h.target;x;){if(1==x.nodeType&&x.tagName.toLowerCase()in c._validNodes){p=k.getComputedStyle(x);q=p.overflowX.toLowerCase()in c._validOverflow;v=p.overflowY.toLowerCase()in c._validOverflow;if(q||v)d=l.getContentBox(x,p),m=l.position(x,!0);if(q){p=Math.min(c.H_TRIGGER_AUTOSCROLL,d.w/2);q=h.pageX-m.x;if(n("webkit")||n("opera"))q+=t.body().scrollLeft;
w=0;0<q&&q<d.w&&(q<p?w=-p:q>d.w-p&&(w=p),x.scrollLeft+=w)}if(v){v=Math.min(c.V_TRIGGER_AUTOSCROLL,d.h/2);p=h.pageY-m.y;if(n("webkit")||n("opera"))p+=t.body().scrollTop;y=0;0<p&&p<d.h&&(p<v?y=-v:p>d.h-v&&(y=v),x.scrollTop+=y)}if(w||y)return}try{x=x.parentNode}catch(E){x=null}}c.autoScroll(h)};return c})},"dojo/dnd/TimedMoveable":function(){define(["../_base/declare","./Moveable"],function(H,n){var t=n.prototype.onMove;return H("dojo.dnd.TimedMoveable",n,{timeout:40,constructor:function(l,k){k||(k=
{});k.timeout&&"number"==typeof k.timeout&&0<=k.timeout&&(this.timeout=k.timeout)},onMoveStop:function(l){l._timer&&(clearTimeout(l._timer),t.call(this,l,l._leftTop));n.prototype.onMoveStop.apply(this,arguments)},onMove:function(l,k){l._leftTop=k;if(!l._timer){var e=this;l._timer=setTimeout(function(){l._timer=null;t.call(e,l,l._leftTop)},this.timeout)}}})})},"dijit/_CssStateMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-class dojo/has dojo/_base/lang dojo/on dojo/domReady dojo/touch dojo/_base/window ./a11yclick ./registry".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h){n=n("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);H.forEach("disabled readOnly checked selected focused state hovering active _opened".split(" "),function(m){this.watch(m,e.hitch(this,"_setStateClass"))},this);for(var d in this.cssStateNodes||{})this._trackMouseState(this[d],this.cssStateNodes[d]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(d){if(!this.disabled)switch(d.type){case "mouseover":case "MSPointerOver":case "pointerover":this._set("hovering",
!0);this._set("active",this._mouseDown);break;case "mouseout":case "MSPointerOut":case "pointerout":this._set("hovering",!1);this._set("active",!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":this._set("active",!0);break;case "mouseup":case "dojotouchend":case "MSPointerUp":case "pointerup":case "keyup":this._set("active",!1)}},_setStateClass:function(){function d(y){m=m.concat(H.map(m,function(x){return x+y}),"dijit"+y)}var m=this.baseClass.split(" ");
this.isLeftToRight()||d("Rtl");var p="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&d(p);this.state&&d(this.state);this.selected&&d("Selected");this._opened&&d("Opened");this.disabled?d("Disabled"):this.readOnly?d("ReadOnly"):this.active?d("Active"):this.hovering&&d("Hover");this.focused&&d("Focused");p=this.stateNode||this.domNode;var v={};H.forEach(p.className.split(" "),function(y){v[y]=!0});"_stateClasses"in this&&H.forEach(this._stateClasses,function(y){delete v[y]});H.forEach(m,
function(y){v[y]=!0});var q=[],w;for(w in v)q.push(w);p.className=q.join(" ");this._stateClasses=m},_subnodeCssMouseEvent:function(d,m,p){function v(q){l.toggle(d,m+"Active",q)}if(!this.disabled&&!this.readOnly)switch(p.type){case "mouseover":case "MSPointerOver":case "pointerover":l.toggle(d,m+"Hover",!0);break;case "mouseout":case "MSPointerOut":case "pointerout":l.toggle(d,m+"Hover",!1);v(!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":v(!0);
break;case "mouseup":case "MSPointerUp":case "pointerup":case "dojotouchend":case "keyup":v(!1);break;case "focus":case "focusin":l.toggle(d,m+"Focused",!0);break;case "blur":case "focusout":l.toggle(d,m+"Focused",!1)}},_trackMouseState:function(d,m){d._cssState=m}});a(function(){function d(v,q,w){if(!w||!t.isDescendant(w,q))for(;q&&q!=w;q=q.parentNode)if(q._cssState){var y=h.getEnclosingWidget(q);y&&(q==y.domNode?y._cssMouseEvent(v):y._subnodeCssMouseEvent(q,q._cssState,v))}}var m=f.body(),p;c(m,
b.over,function(v){d(v,v.target,v.relatedTarget)});c(m,b.out,function(v){d(v,v.target,v.relatedTarget)});c(m,g.press,function(v){p=v.target;d(v,p)});c(m,g.release,function(v){d(v,p);p=null});c(m,"focusin, focusout",function(v){var q=v.target;if(q._cssState&&!q.getAttribute("widgetId")){var w=h.getEnclosingWidget(q);w&&w._subnodeCssMouseEvent(q,q._cssState,v)}})});return n})},"dijit/form/_FormMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/on dojo/window".split(" "),
function(H,n,t,l,k,e){return n("dijit.form._FormMixin",null,{state:"",_getDescendantFormWidgets:function(c){var a=[];H.forEach(c||this.getChildren(),function(b){"value"in b?a.push(b):a=a.concat(this._getDescendantFormWidgets(b.getChildren()))},this);return a},reset:function(){H.forEach(this._getDescendantFormWidgets(),function(c){c.reset&&c.reset()})},validate:function(){var c=!1;return H.every(H.map(this._getDescendantFormWidgets(),function(a){a._hasBeenBlurred=!0;var b=a.disabled||!a.validate||
a.validate();b||c||(e.scrollIntoView(a.containerNode||a.domNode),a.focus(),c=!0);return b}),function(a){return a})},setValues:function(c){t.deprecated(this.declaredClass+"::setValues() is deprecated. Use set('value', val) instead.","","2.0");return this.set("value",c)},_setValueAttr:function(c){var a={};H.forEach(this._getDescendantFormWidgets(),function(h){h.name&&(a[h.name]||(a[h.name]=[])).push(h)});for(var b in a)if(a.hasOwnProperty(b)){var f=a[b],g=l.getObject(b,!1,c);void 0!==g&&(g=[].concat(g),
"boolean"==typeof f[0].checked?H.forEach(f,function(h){h.set("value",-1!=H.indexOf(g,h._get("value")))}):f[0].multiple?f[0].set("value",g):H.forEach(f,function(h,d){h.set("value",g[d])}))}},getValues:function(){t.deprecated(this.declaredClass+"::getValues() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},_getValueAttr:function(){var c={};H.forEach(this._getDescendantFormWidgets(),function(a){var b=a.name;if(b&&!a.disabled){var f=a.get("value");"boolean"==typeof a.checked?
/Radio/.test(a.declaredClass)?!1!==f?l.setObject(b,f,c):(f=l.getObject(b,!1,c),void 0===f&&l.setObject(b,null,c)):(a=l.getObject(b,!1,c),a||(a=[],l.setObject(b,a,c)),!1!==f&&a.push(f)):(a=l.getObject(b,!1,c),"undefined"!=typeof a?l.isArray(a)?a.push(f):l.setObject(b,[a,f],c):l.setObject(b,f,c))}});return c},isValid:function(){return""==this.state},onValidStateChange:function(){},_getState:function(){var c=H.map(this._descendants,function(a){return a.get("state")||""});return 0<=H.indexOf(c,"Error")?
"Error":0<=H.indexOf(c,"Incomplete")?"Incomplete":""},disconnectChildren:function(){},connectChildren:function(c){this._descendants=this._getDescendantFormWidgets();H.forEach(this._descendants,function(a){a._started||a.startup()});c||this._onChildChange()},_onChildChange:function(c){c&&"state"!=c&&"disabled"!=c||this._set("state",this._getState());c&&"value"!=c&&"disabled"!=c&&"checked"!=c||(this._onChangeDelayTimer&&this._onChangeDelayTimer.remove(),this._onChangeDelayTimer=this.defer(function(){delete this._onChangeDelayTimer;
this._set("value",this.get("value"))},10))},startup:function(){this.inherited(arguments);this._descendants=this._getDescendantFormWidgets();this.value=this.get("value");this.state=this._getState();var c=this;this.own(k(this.containerNode,"attrmodified-state, attrmodified-disabled, attrmodified-value, attrmodified-checked",function(a){a.target!=c.domNode&&c._onChildChange(a.type.replace("attrmodified-",""))}));this.watch("state",function(a,b,f){this.onValidStateChange(""==f)})},destroy:function(){this.inherited(arguments)}})})},
"dijit/_DialogMixin":function(){define(["dojo/_base/declare","./a11y"],function(H,n){return H("dijit._DialogMixin",null,{actionBarTemplate:"",execute:function(){},onCancel:function(){},onExecute:function(){},_onSubmit:function(){this.onExecute();this.execute(this.get("value"))},_getFocusItems:function(){var t=n._getTabNavigable(this.domNode);this._firstFocusItem=t.lowest||t.first||this.closeButtonNode||this.domNode;this._lastFocusItem=t.last||t.highest||this._firstFocusItem}})})},"dijit/DialogUnderlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/dom-attr dojo/dom-style dojo/on dojo/window ./_Widget ./_TemplatedMixin ./BackgroundIframe ./Viewport ./main".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h){var d=H("dijit.DialogUnderlay",[a,b],{templateString:"\x3cdiv class\x3d'dijitDialogUnderlayWrapper'\x3e\x3cdiv class\x3d'dijitDialogUnderlay' tabIndex\x3d'-1' data-dojo-attach-point\x3d'node'\x3e\x3c/div\x3e\x3c/div\x3e",dialogId:"","class":"",_modalConnects:[],_setDialogIdAttr:function(m){l.set(this.node,"id",m+"_underlay");this._set("dialogId",m)},_setClassAttr:function(m){this.node.className="dijitDialogUnderlay "+m;this._set("class",m)},postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);
this.own(e(this.domNode,"keydown",n.hitch(this,"_onKeyDown")));this.inherited(arguments)},layout:function(){var m=this.node.style,p=this.domNode.style;p.display="none";var v=c.getBox(this.ownerDocument);p.top=v.t+"px";p.left=v.l+"px";m.width=v.w+"px";m.height=v.h+"px";p.display="block"},show:function(){this.domNode.style.display="block";this.open=!0;this.layout();this.bgIframe=new f(this.domNode);var m=c.get(this.ownerDocument);this._modalConnects=[g.on("resize",n.hitch(this,"layout")),e(m,"scroll",
n.hitch(this,"layout"))]},hide:function(){this.bgIframe.destroy();delete this.bgIframe;for(this.domNode.style.display="none";this._modalConnects.length;)this._modalConnects.pop().remove();this.open=!1},destroy:function(){for(;this._modalConnects.length;)this._modalConnects.pop().remove();this.inherited(arguments)},_onKeyDown:function(){}});d.show=function(m,p){var v=d._singleton;!v||v._destroyed?v=h._underlay=d._singleton=new d(m):m&&v.set(m);k.set(v.domNode,"zIndex",p);v.open||v.show()};d.hide=function(){var m=
d._singleton;m&&!m._destroyed&&m.hide()};return d})},"dijit/BackgroundIframe":function(){define("require ./main dojo/_base/config dojo/dom-construct dojo/dom-style dojo/_base/lang dojo/on dojo/sniff".split(" "),function(H,n,t,l,k,e,c,a){a.add("config-bgIframe",(a("ie")||a("trident"))&&!/IEMobile\/10\.0/.test(navigator.userAgent));var b=new function(){var f=[];this.pop=function(){if(f.length){var g=f.pop();g.style.display=""}else 9>a("ie")?(g=t.dojoBlankHtmlUrl||H.toUrl("dojo/resources/blank.html")||
'javascript:""',g=document.createElement("\x3ciframe src\x3d'"+g+"' role\x3d'presentation' style\x3d'position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity\x3d\"0\");'\x3e")):(g=l.create("iframe"),g.src='javascript:""',g.className="dijitBackgroundIframe",g.setAttribute("role","presentation"),k.set(g,"opacity",.1)),g.tabIndex=-1;return g};this.push=function(g){g.style.display="none";f.push(g)}};n.BackgroundIframe=function(f){if(!f.id)throw Error("no id");if(a("config-bgIframe")){var g=
this.iframe=b.pop();f.appendChild(g);7>a("ie")||a("quirks")?(this.resize(f),this._conn=c(f,"resize",e.hitch(this,"resize",f))):k.set(g,{width:"100%",height:"100%"})}};e.extend(n.BackgroundIframe,{resize:function(f){this.iframe&&k.set(this.iframe,{width:f.offsetWidth+"px",height:f.offsetHeight+"px"})},destroy:function(){this._conn&&(this._conn.remove(),this._conn=null);this.iframe&&(this.iframe.parentNode.removeChild(this.iframe),b.push(this.iframe),delete this.iframe)}});return n.BackgroundIframe})},
"dijit/Viewport":function(){define(["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],function(H,n,t,l,k){var e=new H,c;t(function(){var a=k.getBox();e._rlh=n(window,"resize",function(){var f=k.getBox();if(a.h!=f.h||a.w!=f.w)a=f,e.emit("resize")});if(8==l("ie")){var b=screen.deviceXDPI;setInterval(function(){screen.deviceXDPI!=b&&(b=screen.deviceXDPI,e.emit("resize"))},500)}l("ios")&&(n(document,"focusin",function(f){c=f.target}),n(document,"focusout",function(f){c=null}))});e.getEffectiveBox=
function(a){a=k.getBox(a);var b=c&&c.tagName&&c.tagName.toLowerCase();l("ios")&&c&&!c.readOnly&&("textarea"==b||"input"==b&&/^(color|email|number|password|search|tel|text|url)$/.test(c.type))&&(a.h*=0==orientation||180==orientation?.66:.4,b=c.getBoundingClientRect(),a.h=Math.max(a.h,b.top+b.height));return a};return e})},"dijit/layout/ContentPane":function(){define("dojo/_base/kernel dojo/_base/lang ../_Widget ../_Container ./_ContentPaneResizeMixin dojo/string dojo/html dojo/_base/array dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-construct dojo/_base/xhr dojo/i18n dojo/when dojo/i18n!../nls/loading".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v){return b("dijit.layout.ContentPane",[t,l,k],{href:"",content:"",extractContent:!1,parseOnLoad:!0,parserScope:H._scopeName,preventCache:!1,preload:!1,refreshOnShow:!1,loadingMessage:"\x3cspan class\x3d'dijitContentPaneLoading'\x3e\x3cspan class\x3d'dijitInline dijitIconLoading'\x3e\x3c/span\x3e${loadingState}\x3c/span\x3e",errorMessage:"\x3cspan class\x3d'dijitContentPaneError'\x3e\x3cspan class\x3d'dijitInline dijitIconError'\x3e\x3c/span\x3e${errorState}\x3c/span\x3e",
isLoaded:!1,baseClass:"dijitContentPane",ioArgs:{},onLoadDeferred:null,_setTitleAttr:null,stopParser:!0,template:!1,markupFactory:function(q,w,y){var x=new y(q,w);return!x.href&&x._contentSetter&&x._contentSetter.parseDeferred&&!x._contentSetter.parseDeferred.isFulfilled()?x._contentSetter.parseDeferred.then(function(){return x}):x},create:function(q,w){if(!(q&&q.template||!w||"href"in q||"content"in q)){w=g.byId(w);for(var y=w.ownerDocument.createDocumentFragment();w.firstChild;)y.appendChild(w.firstChild);
q=n.delegate(q,{content:y})}this.inherited(arguments,[q,w])},postMixInProperties:function(){this.inherited(arguments);var q=p.getLocalization("dijit","loading",this.lang);this.loadingMessage=e.substitute(this.loadingMessage,q);this.errorMessage=e.substitute(this.errorMessage,q)},buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.domNode.removeAttribute("title")},startup:function(){this.inherited(arguments);this._contentSetter&&a.forEach(this._contentSetter.parseResults,
function(q){q._started||q._destroyed||!n.isFunction(q.startup)||(q.startup(),q._started=!0)},this)},_startChildren:function(){a.forEach(this.getChildren(),function(q){q._started||q._destroyed||!n.isFunction(q.startup)||(q.startup(),q._started=!0)});this._contentSetter&&a.forEach(this._contentSetter.parseResults,function(q){q._started||q._destroyed||!n.isFunction(q.startup)||(q.startup(),q._started=!0)},this)},setHref:function(q){H.deprecated("dijit.layout.ContentPane.setHref() is deprecated. Use set('href', ...) instead.",
"","2.0");return this.set("href",q)},_setHrefAttr:function(q){this.cancel();this.onLoadDeferred=new f(n.hitch(this,"cancel"));this.onLoadDeferred.then(n.hitch(this,"onLoad"));this._set("href",q);this.preload||this._created&&this._isShown()?this._load():this._hrefChanged=!0;return this.onLoadDeferred},setContent:function(q){H.deprecated("dijit.layout.ContentPane.setContent() is deprecated.  Use set('content', ...) instead.","","2.0");this.set("content",q)},_setContentAttr:function(q){this._set("href",
"");this.cancel();this.onLoadDeferred=new f(n.hitch(this,"cancel"));this._created&&this.onLoadDeferred.then(n.hitch(this,"onLoad"));this._setContent(q||"");this._isDownloaded=!1;return this.onLoadDeferred},_getContentAttr:function(){return this.containerNode.innerHTML},cancel:function(){this._xhrDfd&&-1==this._xhrDfd.fired&&this._xhrDfd.cancel();delete this._xhrDfd;this.onLoadDeferred=null},destroy:function(){this.cancel();this.inherited(arguments)},destroyRecursive:function(q){this._beingDestroyed||
this.inherited(arguments)},_onShow:function(){this.inherited(arguments);if(this.href&&!this._xhrDfd&&(!this.isLoaded||this._hrefChanged||this.refreshOnShow))return this.refresh()},refresh:function(){this.cancel();this.onLoadDeferred=new f(n.hitch(this,"cancel"));this.onLoadDeferred.then(n.hitch(this,"onLoad"));this._load();return this.onLoadDeferred},_load:function(){this._setContent(this.onDownloadStart(),!0);var q=this,w={preventCache:this.preventCache||this.refreshOnShow,url:this.href,handleAs:"text"};
n.isObject(this.ioArgs)&&n.mixin(w,this.ioArgs);var y=this._xhrDfd=(this.ioMethod||m.get)(w),x;y.then(function(E){x=E;try{return q._isDownloaded=!0,q._setContent(E,!1)}catch(B){q._onError("Content",B)}},function(E){y.canceled||q._onError("Download",E);delete q._xhrDfd;return E}).then(function(){q.onDownloadEnd();delete q._xhrDfd;return x});delete this._hrefChanged},_onLoadHandler:function(q){this._set("isLoaded",!0);try{this.onLoadDeferred.resolve(q)}catch(w){console.error("Error "+(this.widgetId||
this.id)+" running custom onLoad code: "+w.message)}},_onUnloadHandler:function(){this._set("isLoaded",!1);try{this.onUnload()}catch(q){console.error("Error "+this.widgetId+" running custom onUnload code: "+q.message)}},destroyDescendants:function(q){this.isLoaded&&this._onUnloadHandler();var w=this._contentSetter;a.forEach(this.getChildren(),function(y){y.destroyRecursive?y.destroyRecursive(q):y.destroy&&y.destroy(q);y._destroyed=!0});w&&(a.forEach(w.parseResults,function(y){y._destroyed||(y.destroyRecursive?
y.destroyRecursive(q):y.destroy&&y.destroy(q),y._destroyed=!0)}),delete w.parseResults);q||d.empty(this.containerNode);delete this._singleChild},_setContent:function(q,w){q=this.preprocessContent(q);this.destroyDescendants();var y=this._contentSetter;y&&y instanceof c._ContentSetter||(y=this._contentSetter=new c._ContentSetter({node:this.containerNode,_onError:n.hitch(this,this._onError),onContentError:n.hitch(this,function(B){B=this.onContentError(B);try{this.containerNode.innerHTML=B}catch(C){console.error("Fatal "+
this.id+" could not change content due to "+C.message,C)}})}));var x=n.mixin({cleanContent:this.cleanContent,extractContent:this.extractContent,parseContent:!q.domNode&&this.parseOnLoad,parserScope:this.parserScope,startup:!1,dir:this.dir,lang:this.lang,textDir:this.textDir},this._contentSetterParams||{});x=y.set(n.isObject(q)&&q.domNode?q.domNode:q,x);var E=this;return v(x&&x.then?x:y.parseDeferred,function(){delete E._contentSetterParams;w||(E._started&&(E._startChildren(),E._scheduleLayout()),
E._onLoadHandler(q))})},preprocessContent:function(q){return q},_onError:function(q,w,y){this.onLoadDeferred.reject(w);q=this["on"+q+"Error"].call(this,w);y?console.error(y,w):q&&this._setContent(q,!0)},onLoad:function(){},onUnload:function(){},onDownloadStart:function(){return this.loadingMessage},onContentError:function(){},onDownloadError:function(){return this.errorMessage},onDownloadEnd:function(){}})})},"dijit/_Container":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct",
"dojo/_base/kernel"],function(H,n,t,l){return n("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode)},addChild:function(k,e){var c=this.containerNode;if(0<e){for(c=c.firstChild;0<e;)1==c.nodeType&&e--,c=c.nextSibling;c?e="before":(c=this.containerNode,e="last")}t.place(k.domNode,c,e);this._started&&!k._started&&k.startup()},removeChild:function(k){"number"==typeof k&&(k=this.getChildren()[k]);k&&(k=k.domNode)&&k.parentNode&&
k.parentNode.removeChild(k)},hasChildren:function(){return 0<this.getChildren().length},_getSiblingOfChild:function(k,e){var c=this.getChildren();k=H.indexOf(c,k);return c[k+e]},getIndexOfChild:function(k){return H.indexOf(this.getChildren(),k)}})})},"dijit/layout/_ContentPaneResizeMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/query ../registry ../Viewport ./utils".split(" "),function(H,n,t,l,k,e,c,a,b,f){return n("dijit.layout._ContentPaneResizeMixin",
null,{doLayout:!0,isLayoutContainer:!0,startup:function(){if(!this._started){var g=this.getParent();this._childOfLayoutWidget=g&&g.isLayoutContainer;this._needLayout=!this._childOfLayoutWidget;this.inherited(arguments);this._isShown()&&this._onShow();this._childOfLayoutWidget||this.own(b.on("resize",e.hitch(this,"resize")))}},_checkIfSingleChild:function(){if(this.doLayout){var g=[],h=!1;c("\x3e *",this.containerNode).some(function(d){var m=a.byNode(d);m&&m.resize?g.push(m):!/script|link|style/i.test(d.nodeName)&&
d.offsetHeight&&(h=!0)});this._singleChild=1!=g.length||h?null:g[0];t.toggle(this.containerNode,this.baseClass+"SingleChild",!!this._singleChild)}},resize:function(g,h){this._resizeCalled=!0;this._scheduleLayout(g,h)},_scheduleLayout:function(g,h){this._isShown()?this._layout(g,h):(this._needLayout=!0,this._changeSize=g,this._resultSize=h)},_layout:function(g,h){delete this._needLayout;this._wasShown||!1===this.open||this._onShow();g&&l.setMarginBox(this.domNode,g);var d=this.containerNode;d===this.domNode?
(h=h||{},e.mixin(h,g||{}),"h"in h&&"w"in h||(h=e.mixin(l.getMarginBox(d),h)),this._contentBox=f.marginBox2contentBox(d,h)):this._contentBox=l.getContentBox(d);this._layoutChildren()},_layoutChildren:function(){this._checkIfSingleChild();if(this._singleChild&&this._singleChild.resize){var g=this._contentBox||l.getContentBox(this.containerNode);this._singleChild.resize({w:g.w,h:g.h})}else{g=this.getChildren();for(var h,d=0;h=g[d++];)h.resize&&h.resize()}},_isShown:function(){if(this._childOfLayoutWidget)return this._resizeCalled&&
"open"in this?this.open:this._resizeCalled;if("open"in this)return this.open;var g=this.domNode,h=this.domNode.parentNode;return"none"!=g.style.display&&"hidden"!=g.style.visibility&&!t.contains(g,"dijitHidden")&&h&&h.style&&"none"!=h.style.display},_onShow:function(){this._wasShown=!0;this._needLayout&&this._layout(this._changeSize,this._resultSize);this.inherited(arguments)}})})},"dijit/layout/utils":function(){define(["dojo/_base/array","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/lang"],
function(H,n,t,l,k){function e(b){return b.substring(0,1).toUpperCase()+b.substring(1)}function c(b,f){var g=b.resize?b.resize(f):t.setMarginBox(b.domNode,f);g?k.mixin(b,g):(k.mixin(b,t.getMarginBox(b.domNode)),k.mixin(b,f))}var a={marginBox2contentBox:function(b,f){var g=l.getComputedStyle(b),h=t.getMarginExtents(b,g),d=t.getPadBorderExtents(b,g);return{l:l.toPixelValue(b,g.paddingLeft),t:l.toPixelValue(b,g.paddingTop),w:f.w-(h.w+d.w),h:f.h-(h.h+d.h)}},layoutChildren:function(b,f,g,h,d){f=k.mixin({},
f);n.add(b,"dijitLayoutContainer");g=H.filter(g,function(m){return"center"!=m.region&&"client"!=m.layoutAlign}).concat(H.filter(g,function(m){return"center"==m.region||"client"==m.layoutAlign}));H.forEach(g,function(m){var p=m.domNode,v=m.region||m.layoutAlign;if(!v)throw Error("No region setting for "+m.id);var q=p.style;q.left=f.l+"px";q.top=f.t+"px";q.position="absolute";n.add(p,"dijitAlign"+e(v));p={};h&&h==m.id&&(p["top"==m.region||"bottom"==m.region?"h":"w"]=d);"leading"==v&&(v=m.isLeftToRight()?
"left":"right");"trailing"==v&&(v=m.isLeftToRight()?"right":"left");"top"==v||"bottom"==v?(p.w=f.w,c(m,p),f.h-=m.h,"top"==v?f.t+=m.h:q.top=f.t+f.h+"px"):"left"==v||"right"==v?(p.h=f.h,c(m,p),f.w-=m.w,"left"==v?f.l+=m.w:q.left=f.l+f.w+"px"):"client"!=v&&"center"!=v||c(m,f)})}};k.setObject("dijit.layout.utils",a);return a})},"dojo/html":function(){define("./_base/kernel ./_base/lang ./_base/array ./_base/declare ./dom ./dom-construct ./parser".split(" "),function(H,n,t,l,k,e,c){var a=0,b={_secureForInnerHtml:function(f){return f.replace(/(?:\s*<!DOCTYPE\s[^>]+>|<title[^>]*>[\s\S]*?<\/title>)/ig,
"")},_emptyNode:e.empty,_setNodeContent:function(f,g){e.empty(f);if(g)if("number"==typeof g&&(g=g.toString()),"string"==typeof g&&(g=e.toDom(g,f.ownerDocument)),!g.nodeType&&n.isArrayLike(g))for(var h=g.length,d=0;d<g.length;d=h==g.length?d+1:0)e.place(g[d],f,"last");else e.place(g,f,"last");return f},_ContentSetter:l("dojo.html._ContentSetter",null,{node:"",content:"",id:"",cleanContent:!1,extractContent:!1,parseContent:!1,parserScope:H._scopeName,startup:!0,constructor:function(f,g){n.mixin(this,
f||{});g=this.node=k.byId(this.node||g);this.id||(this.id=["Setter",g?g.id||g.tagName:"",a++].join("_"))},set:function(f,g){void 0!==f&&(this.content=f);"number"==typeof f&&(f=f.toString());g&&this._mixin(g);this.onBegin();this.setContent();return(f=this.onEnd())&&f.then?f:this.node},setContent:function(){var f=this.node;if(!f)throw Error(this.declaredClass+": setContent given no node");try{f=b._setNodeContent(f,this.content)}catch(h){var g=this.onContentError(h);try{f.innerHTML=g}catch(d){console.error("Fatal "+
this.declaredClass+".setContent could not change content due to "+d.message,d)}}this.node=f},empty:function(){this.parseDeferred&&(this.parseDeferred.isResolved()||this.parseDeferred.cancel(),delete this.parseDeferred);this.parseResults&&this.parseResults.length&&(t.forEach(this.parseResults,function(f){f.destroy&&f.destroy()}),delete this.parseResults);e.empty(this.node)},onBegin:function(){var f=this.content;if(n.isString(f)&&(this.cleanContent&&(f=b._secureForInnerHtml(f)),this.extractContent)){var g=
f.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);g&&(f=g[1])}this.empty();this.content=f;return this.node},onEnd:function(){this.parseContent&&this._parse();return this.node},tearDown:function(){delete this.parseResults;delete this.parseDeferred;delete this.node;delete this.content},onContentError:function(f){return"Error occurred setting content: "+f},onExecError:function(f){return"Error occurred executing scripts: "+f},_mixin:function(f){var g={},h;for(h in f)h in g||(this[h]=f[h])},_parse:function(){var f=
this.node;try{var g={};t.forEach(["dir","lang","textDir"],function(d){this[d]&&(g[d]=this[d])},this);var h=this;this.parseDeferred=c.parse({rootNode:f,noStart:!this.startup,inherited:g,scope:this.parserScope}).then(function(d){return h.parseResults=d},function(d){h._onError("Content",d,"Error parsing in _ContentSetter#"+h.id)})}catch(d){this._onError("Content",d,"Error parsing in _ContentSetter#"+this.id)}},_onError:function(f,g,h){f=this["on"+f+"Error"].call(this,g);h?console.error(h,g):f&&b._setNodeContent(this.node,
f,!0)}}),set:function(f,g,h){void 0==g&&(console.warn("dojo.html.set: no cont argument provided, using empty string"),g="");"number"==typeof g&&(g=g.toString());return h?(new b._ContentSetter(n.mixin(h,{content:g,node:f}))).set():b._setNodeContent(f,g,!0)}};n.setObject("dojo.html",b);return b})},"esri/Credential":function(){define(["dojo/_base/declare","dojo/has","./kernel","./IdentityManagerBase"],function(H,n,t,l){H=H(l.Credential,{});n("extend-esri")&&(t.Credential=H);return H})},"esri/IdentityManagerBase":function(){define("dojo/_base/declare dojo/_base/config dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/url dojo/sniff dojo/io-query dojo/on ./kernel ./config ./lang ./ServerInfo ./urlUtils ./deferredUtils ./request ./Evented ./OAuthCredential ./arcgis/OAuthInfo".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q,w,y){var x={},E=function(r){var u=(new e(r.owningSystemUrl)).host;r=(new e(r.server)).host;var A=/.+\.arcgis\.com$/i;return A.test(u)&&A.test(r)},B=function(r,u){return!!(E(r)&&u&&l.some(u,function(A){return A.test(r.server)}))},C=null,G=null;try{C=window.localStorage,G=window.sessionStorage}catch(r){}var I=H(q,{declaredClass:"esri.IdentityManagerBase",constructor:function(){this._portalConfig=t.getObject("esriGeowConfig");this.serverInfos=[];this.oAuthInfos=
[];this.credentials=[];this._soReqs=[];this._xoReqs=[];this._portals=[];this._getOAuthHash();b(window,"pageshow",t.hitch(this,this._pageShowHandler))},defaultOAuthInfo:null,defaultTokenValidity:60,tokenValidity:null,normalizeWebTierAuth:!1,_appUrlObj:m.urlToObject(window.location.href),_postMessageAuthHandle:null,_busy:null,_rejectOnPersistedPageShow:!1,_oAuthHash:null,_gwTokenUrl:"/sharing/generateToken",_agsRest:"/rest/services",_agsPortal:/\/sharing(\/|$)/i,_agsAdmin:/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i,
_adminSvcs:/\/rest\/admin\/services(\/|$)/i,_gwDomains:[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/generateToken"},
{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/generateToken"}],_legacyFed:[],_regexSDirUrl:/http.+\/rest\/services\/?/ig,_regexServerType:/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/ig,
_gwUser:/http.+\/users\/([^\/]+)\/?.*/i,_gwItem:/http.+\/items\/([^\/]+)\/?.*/i,_gwGroup:/http.+\/groups\/([^\/]+)\/?.*/i,_errorCodes:[499,498,403,401],_rePortalTokenSvc:/\/sharing(\/rest)?\/generatetoken/i,_publicUrls:[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],_createDefaultOAuthInfo:!0,_hasTestedIfAppIsOnPortal:!1,registerServers:function(r){var u=this.serverInfos;u?(r=l.filter(r,function(A){return!this.findServerInfo(A.server)},this),this.serverInfos=u.concat(r)):
this.serverInfos=r;l.forEach(r,function(A){A.owningSystemUrl&&this._portals.push(A.owningSystemUrl);if(A.hasPortal){this._portals.push(A.server);var J=g.defaults.io.corsEnabledServers,O=this._getOrigin(A.tokenServiceUrl);m.canUseXhr(A.server)||J.push(A.server.replace(/^https?:\/\//i,""));m.canUseXhr(O)||J.push(O.replace(/^https?:\/\//i,""))}},this)},registerOAuthInfos:function(r){var u=this.oAuthInfos;u?(l.forEach(r,function(A){(A=this.findOAuthInfo(A.portalUrl))&&u.splice(u.indexOf(A),1)},this),
this.oAuthInfos=u.concat(r)):this.oAuthInfos=r},registerToken:function(r){r=h.mixin({},r);var u=this._sanitizeUrl(r.server),A=this.findServerInfo(u),J=!0,O;A||(A=new d,A.server=this._getServerInstanceRoot(u),A.tokenServiceUrl=this._getTokenSvcUrl(u),A.hasPortal=!0,this.registerServers([A]));(O=this.findCredential(u,r.userId))?(delete r.server,t.mixin(O,r),J=!1):(O=new D({userId:r.userId,server:A.server,token:r.token,expires:r.expires,ssl:r.ssl,scope:this._isServerRsrc(u)?"server":"portal"}),O.resources=
[u],this.credentials.push(O));O.onTokenChange(!1);J||O.refreshServerTokens()},toJson:function(){return h.fixJson({serverInfos:l.map(this.serverInfos,function(r){return r.toJson()}),oAuthInfos:l.map(this.oAuthInfos,function(r){return r.toJson()}),credentials:l.map(this.credentials,function(r){return r.toJson()})})},initialize:function(r){if(r){t.isString(r)&&(r=JSON.parse(r));var u=r.serverInfos,A=r.oAuthInfos;r=r.credentials;if(u){var J=[];l.forEach(u,function(P){P.server&&P.tokenServiceUrl&&J.push(P.declaredClass?
P:new d(P))});J.length&&this.registerServers(J)}if(A){var O=[];l.forEach(A,function(P){P.appId&&O.push(P.declaredClass?P:new y(P))});O.length&&this.registerOAuthInfos(O)}r&&l.forEach(r,function(P){P.userId&&P.server&&P.token&&P.expires&&P.expires>(new Date).getTime()&&(P=P.declaredClass?P:new D(P),P.onTokenChange(),this.credentials.push(P))},this)}},findServerInfo:function(r){var u;r=this._sanitizeUrl(r);l.some(this.serverInfos,function(A){this._hasSameServerInstance(A.server,r)&&(u=A);return!!u},
this);return u},findOAuthInfo:function(r){var u;r=this._sanitizeUrl(r);l.some(this.oAuthInfos,function(A){this._hasSameServerInstance(A.portalUrl,r)&&(u=A);return!!u},this);return u},findCredential:function(r,u){var A;r=this._sanitizeUrl(r);var J=this._isServerRsrc(r)?"server":"portal";u?l.some(this.credentials,function(O){this._hasSameServerInstance(O.server,r)&&u===O.userId&&O.scope===J&&(A=O);return!!A},this):l.some(this.credentials,function(O){this._hasSameServerInstance(O.server,r)&&-1!==this._getIdenticalSvcIdx(r,
O)&&O.scope===J&&(A=O);return!!A},this);return A},getCredential:function(r,u){var A=!0;if(h.isDefined(u))if(t.isObject(u)){var J=!!u.token;var O=u.error;A=!1!==u.prompt}else J=u;r=this._sanitizeUrl(r);var P=new k(p._dfdCanceller),z=this._isAdminResource(r);if((J=J?this.findCredential(r):null)&&O&&498===O.code)J.destroy();else if(J)return r=Error("You are currently signed in as: '"+J.userId+"'. You do not have access to this resource: "+r),r.name="identity-manager:not-authorized",r.code="IdentityManagerBase.1",
r.httpCode=O&&O.httpCode,r.messageCode=O?O.messageCode:null,r.subcode=O?O.subcode:null,r.details=O?O.details:null,r.log=!!n.isDebug,P.errback(r),P;if(O=this._findCredential(r,u))return P.callback(O),P;var F=this.findServerInfo(r);if(F)!F.hasServer&&this._isServerRsrc(r)&&(F._restInfoDfd=this._getTokenSvcUrl(r,!0),F.hasServer=!0);else{O=this._getTokenSvcUrl(r);if(!O)return r=Error("Unknown resource - could not find token service endpoint."),r.name="identity-manager:unknown-resource",r.code="IdentityManagerBase.2",
r.log=!!n.isDebug,P.errback(r),P;F=new d;F.server=this._getServerInstanceRoot(r);t.isString(O)?(F.tokenServiceUrl=O,F.hasPortal=!0):(F._restInfoDfd=O,F.hasServer=!0);this.registerServers([F])}F.hasPortal&&void 0===F._selfReq&&(A||m.hasSameOrigin(F.tokenServiceUrl,window.location.origin)||this._gwDomains.some(function(M){return M.tokenServiceUrl===F.tokenServiceUrl}))&&(F._selfReq={owningTenant:u&&u.owningTenant,selfDfd:this._getPortalSelf(F.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),
r)});return this._enqueue(r,F,u,P,z)},getResourceName:function(r){return this._isRESTService(r)?r.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(r)&&r.replace(this._gwUser,"$1")||this._gwItem.test(r)&&r.replace(this._gwItem,"$1")||this._gwGroup.test(r)&&r.replace(this._gwGroup,"$1")||""},generateToken:function(r,u,A){var J=this._rePortalTokenSvc.test(r.tokenServiceUrl),O=new e(window.location.href.toLowerCase()),P=!u;var z=r.shortLivedTokenValidity;if(u){var F=
f.id.tokenValidity||z||f.id.defaultTokenValidity;F>z&&(F=z)}if(A){var M=A.isAdmin;var Q=A.serverUrl;var R=A.token;var K=A.ssl;r.customParameters=A.customParameters}if(M)z=r.adminTokenServiceUrl;else{z=r.tokenServiceUrl;var N=new e(z.toLowerCase());r.webTierAuth&&A&&A.serverUrl&&!K&&"http"===O.scheme&&(m.hasSameOrigin(O.uri,z,!0)||"https"===N.scheme&&O.host===N.host&&"7080"===O.port&&"7443"===N.port)&&(z=z.replace(/^https:/i,"http:").replace(/:7443/i,":7080"));P&&J&&(z=z.replace(/\/rest/i,""))}M=t.mixin({url:z,
content:t.mixin({request:"getToken",username:u&&u.username,password:u&&u.password,serverUrl:Q,token:R,expiration:F,referer:M||J?window.location.host:null,client:M?"referer":null,f:"json"},r.customParameters),handleAs:"json",callbackParamName:P?"callback":void 0},A&&A.ioArgs);A={usePost:!P,disableIdentityLookup:!0,useProxy:this._useProxy(r,A)};J||(M.withCredentials=!1);J=v(M,A);J.addCallback(function(V){if(!V||!V.token)return V=Error("Unable to generate token"),V.name="identity-manager:authentication-failed",
V.code="IdentityManagerBase.3",V.log=!!n.isDebug,V;var W=r.server;x[W]||(x[W]={});u&&(x[W][u.username]=u.password);V.validity=F;return V});J.addErrback(function(V){});return J},isBusy:function(){return!!this._busy},checkSignInStatus:function(r){var u=new k;this.checkAppAccess(r,"").then(function(A){u.resolve(A.credential)}).catch(function(A){u.reject(A)});return u},checkAppAccess:function(r,u,A){var J=this,O=!1;return this.getCredential(r,{prompt:!1}).then(function(P){var z={f:"json"};if("portal"===
P.scope)if(u&&(J._doPortalSignIn(r)||A&&A.force)){var F=P.server+"/sharing/rest/oauth2/validateAppAccess";z.client_id=u}else if(P.token)F=P.server+"/sharing/rest";else return{credential:P};else if(P.token)F=P.server+"/rest/services";else return{credential:P};P.token&&(z.token=P.token);return v({url:F,content:z,callbackParamName:"callback"},{disableIdentityLookup:!0}).then(function(M){if(!1===M.valid){var Q=Error("You are currently signed in as: '"+P.userId+"'.  You do not have access to this app: '"+
u+"'.");Q.name="identity-manager:not-authorized";Q.code="IdentityManagerBase.1";Q.log=!!n.isDebug;Q.details=M;throw Q;}O=!!M.viewOnlyUserTypeApp;return{credential:P}}).catch(function(M){if("IdentityManagerBase.1"===M.code||400===M.code)throw 400===M.code&&(M.name="identity-manager:invalid-request"),M;if(498===M.code)throw P.destroy(),M=Error("User is not signed in."),M.name="identity-manager:not-authenticated",M.code="IdentityManagerBase.6",M.log=!!n.isDebug,M;return{credential:P}})}).then(function(P){return{credential:P.credential,
viewOnly:O}})},setProtocolErrorHandler:function(r){this._protocolFunc=r},signIn:function(){},oAuthSignIn:function(){},onCredentialCreate:function(){},onCredentialsDestroy:function(){},destroyCredentials:function(){if(this.credentials){var r=this.credentials.slice();l.forEach(r,function(u){u.destroy()})}this.onCredentialsDestroy()},enablePostMessageAuth:function(r){r||(r="https://www.arcgis.com/sharing/rest");this._postMessageAuthHandle&&this._postMessageAuthHandle.remove();this._postMessageAuthHandle=
b(window,"message",function(u){(u.origin===window.location.origin||h.endsWith(u.origin,".arcgis.com"))&&u.data&&"arcgis:auth:requestCredential"===u.data.type&&this.getCredential(r).then(function(A){u.source.postMessage({type:"arcgis:auth:credential",credential:{expires:A.expires,server:A.server,ssl:A.ssl,token:A.token,userId:A.userId}},u.origin)}).catch(function(A){u.source.postMessage({type:"arcgis:auth:error",error:{name:A.name,message:A.message}},u.origin)})}.bind(this))},disablePostMessageAuth:function(){this._postMessageAuthHandle&&
(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)},_getOAuthHash:function(){var r=window.location.hash;if(r){"#"===r.charAt(0)&&(r=r.substring(1));r=a.queryToObject(r);var u=!1;if(r.access_token&&r.expires_in&&r.state&&r.hasOwnProperty("username"))try{r.state=JSON.parse(r.state),"object"===typeof r.state&&r.state.portalUrl&&(this._oAuthHash=r,u=!0)}catch(A){}else r.error&&r.error_description&&(console.log("IdentityManager OAuth Error: ",r.error," - ",r.error_description),"access_denied"===
r.error&&(u=!0));u&&(window.location.hash=r.state&&r.state.hash||"")}},_pageShowHandler:function(r){r.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow&&(r=Error("ABORTED"),r.name="identity-manager:user-aborted",r.code="IdentityManager.2",r.log=!!n.isDebug,this._errbackFunc(r))},_findCredential:function(r,u){var A=-1,J,O,P=u&&u.token;u=u&&u.resource;var z=this._isServerRsrc(r)?"server":"portal",F=l.filter(this.credentials,function(K){return this._hasSameServerInstance(K.server,r)&&K.scope===
z},this);r=u||r;if(F.length)if(1===F.length){u=F[0];var M=(J=(O=this.findServerInfo(u.server))&&O.owningSystemUrl)&&this.findCredential(J,u.userId);A=this._getIdenticalSvcIdx(r,u);if(P)-1!==A&&(u.resources.splice(A,1),this._removeResource(r,M));else return-1===A&&u.resources.push(r),this._addResource(r,M),u}else{var Q,R;l.some(F,function(K){R=this._getIdenticalSvcIdx(r,K);return-1!==R?(Q=K,M=(J=(O=this.findServerInfo(Q.server))&&O.owningSystemUrl)&&this.findCredential(J,Q.userId),A=R,!0):!1},this);
if(P)Q&&(Q.resources.splice(A,1),this._removeResource(r,M));else if(Q)return this._addResource(r,M),Q}},_findOAuthInfo:function(r){var u=this.findOAuthInfo(r);u||l.some(this.oAuthInfos,function(A){this._isIdProvider(A.portalUrl,r)&&(u=A);return!!u},this);return u},_addResource:function(r,u){u&&-1===this._getIdenticalSvcIdx(r,u)&&u.resources.push(r)},_removeResource:function(r,u){var A=-1;u&&(A=this._getIdenticalSvcIdx(r,u),-1<A&&u.resources.splice(A,1))},_useProxy:function(r,u){return u&&u.isAdmin&&
!m.hasSameOrigin(r.adminTokenServiceUrl,window.location.href)||!this._isPortalDomain(r.tokenServiceUrl)&&10.1==r.currentVersion&&!m.hasSameOrigin(r.tokenServiceUrl,window.location.href)},_getOrigin:function(r){r=new e(r);return r.scheme+"://"+r.host+(h.isDefined(r.port)?":"+r.port:"")},_getServerInstanceRoot:function(r){var u=r.toLowerCase(),A=u.indexOf(this._agsRest);-1===A&&this._isAdminResource(r)&&(A=this._agsAdmin.test(r)?r.replace(this._agsAdmin,"$1").length:r.search(this._adminSvcs));-1===
A&&(A=u.indexOf("/sharing"));-1===A&&"/"===u.substr(-1)&&(A=u.length-1);return-1<A?r.substring(0,A):r},_hasSameServerInstance:function(r,u){"/"===r.substr(-1)&&(r=r.slice(0,-1));r=r.toLowerCase();u=this._getServerInstanceRoot(u).toLowerCase();r=this._normalizeAGOLorgDomain(r);u=this._normalizeAGOLorgDomain(u);r=r.substr(r.indexOf(":"));u=u.substr(u.indexOf(":"));return r===u},_normalizeAGOLorgDomain:function(r){var u=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,A=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,
J=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;u.test(r)?r=r.replace(u,"https://www.arcgis.com"):A.test(r)?r=r.replace(A,"https://devext.arcgis.com"):J.test(r)&&(r=r.replace(J,"https://qaext.arcgis.com"));return r},_sanitizeUrl:function(r){var u=(g.defaults.io.proxyUrl||"").toLowerCase(),A=u?r.toLowerCase().indexOf(u+"?"):-1;-1!==A&&(r=r.substring(A+u.length+1));r=m.normalize(r);return m.urlToObject(r).path},_isRESTService:function(r){return-1<r.indexOf(this._agsRest)},_isAdminResource:function(r){return this._agsAdmin.test(r)||
this._adminSvcs.test(r)},_isServerRsrc:function(r){return this._isRESTService(r)||this._isAdminResource(r)},_isIdenticalService:function(r,u){if(this._isRESTService(r)&&this._isRESTService(u)){r=this._getSuffix(r).toLowerCase();u=this._getSuffix(u).toLowerCase();var A=r===u;A||(A=/(.*)\/(MapServer|FeatureServer).*/ig,A=r.replace(A,"$1")===u.replace(A,"$1"))}else this._isAdminResource(r)&&this._isAdminResource(u)?A=!0:this._isServerRsrc(r)||this._isServerRsrc(u)||!this._isPortalDomain(r)||(A=!0);return A},
_isPortalDomain:function(r){var u=new e(r.toLowerCase()),A=this._portalConfig;r=l.some(this._gwDomains,function(J){return J.regex.test(u.uri)});!r&&A&&(r=this._hasSameServerInstance(this._getServerInstanceRoot(A.restBaseUrl),u.uri));r||(!this._arcgisUrl&&(A=t.getObject("esri.arcgis.utils.arcgisUrl"))&&(this._arcgisUrl=(new e(A)).authority),this._arcgisUrl&&(r=this._arcgisUrl.toLowerCase()===u.authority));r||(r=l.some(this._portals,function(J){return this._hasSameServerInstance(J,u.uri)},this));return r=
r||this._agsPortal.test(u.path)},_isIdProvider:function(r,u){var A=-1,J=-1;l.forEach(this._gwDomains,function(F,M){-1===A&&F.regex.test(r)&&(A=M);-1===J&&F.regex.test(u)&&(J=M)});var O=!1;if(-1<A&&-1<J)if(0===A||4===A){if(0===J||4===J)O=!0}else if(1===A){if(1===J||2===J)O=!0}else 2===A?2===J&&(O=!0):3===A&&3===J&&(O=!0);if(!O){var P=this.findServerInfo(u),z=P&&P.owningSystemUrl;z&&E(P)&&this._isPortalDomain(z)&&this._isIdProvider(r,z)&&(O=!0)}return O},_isPublic:function(r){r=this._sanitizeUrl(r);
return l.some(this._publicUrls,function(u){return u.test(r)})},_getIdenticalSvcIdx:function(r,u){var A=-1;l.some(u.resources,function(J,O){return this._isIdenticalService(r,J)?(A=O,!0):!1},this);return A},_getSuffix:function(r){return r.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")},_getTokenSvcUrl:function(r){if(this._isRESTService(r)||this._isAdminResource(r)){var u=this._getServerInstanceRoot(r);var A=u+"/admin/generateToken";r=u+"/rest/info";u=v({url:r,content:{f:"json"},
handleAs:"json",callbackParamName:"callback"});u.adminUrl_=A;return u}if(this._isPortalDomain(r)){var J="";l.some(this._gwDomains,function(O){O.regex.test(r)&&(J=O.tokenServiceUrl);return!!J});J||l.some(this._portals,function(O){this._hasSameServerInstance(O,r)&&(J=O+this._gwTokenUrl);return!!J},this);J||(A=r.toLowerCase().indexOf("/sharing"),-1!==A&&(J=r.substring(0,A)+this._gwTokenUrl));J||(J=this._getOrigin(r)+this._gwTokenUrl);J&&(A=(new e(r)).port,/^http:\/\//i.test(r)&&"7080"===A&&(J=J.replace(/:7080/i,
":7443")),J=J.replace(/http:/i,"https:"));return J}if(-1!==r.toLowerCase().indexOf("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"},_exchangeToken:function(r,u,A){return v({url:r+"/sharing/rest/oauth2/exchangeToken",content:{f:"json",client_id:u,token:A}},{disableIdentityLookup:!0,usePost:!0}).then(function(J){return J.token})},_getPlatformSelf:function(r,u){return v({url:r+"/sharing/rest/oauth2/platformSelf",content:{f:"json"},headers:{"X-Esri-Auth-Client-Id":u,
"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},withCredentials:!0},{disableIdentityLookup:!0,usePost:!0})},_getPortalSelf:function(r,u){var A="";l.some(this._gwDomains,function(J){J.regex.test(r)&&(A=J.customBaseUrl);return!!A});if(A)return u=new k,u.resolve({allSSL:!0,currentVersion:"4.4",customBaseUrl:A,portalMode:"multitenant",supportsOAuth:!0}),u;"https:"===window.location.protocol?r=r.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(u)&&(r=r.replace(/^https:/i,
"http:").replace(/:7443/i,":7080"));return v({url:r,content:{f:"json"},handleAs:"json",callbackParamName:"callback"},{crossOrigin:!1,disableIdentityLookup:!0})},_doPortalSignIn:function(r){var u=this._portalConfig,A=window.location.href,J=this.findServerInfo(r);return(u||this._isPortalDomain(A))&&(J?J.hasPortal||J.owningSystemUrl&&this._isPortalDomain(J.owningSystemUrl):this._isPortalDomain(r))&&(this._isIdProvider(A,r)||u&&(this._hasSameServerInstance(this._getServerInstanceRoot(u.restBaseUrl),r)||
this._isIdProvider(u.restBaseUrl,r))||m.hasSameOrigin(A,r,!0))?!0:!1},_checkProtocol:function(r,u,A,J){var O=!0;J=J?u.adminTokenServiceUrl:u.tokenServiceUrl;0!==t.trim(J).toLowerCase().indexOf("https:")||0===window.location.href.toLowerCase().indexOf("https:")||g.defaults.io.useCors&&(m.canUseXhr(J)||m.canUseXhr(m.getProxyUrl(!0).path))||(O=this._protocolFunc?!!this._protocolFunc({resourceUrl:r,serverInfo:u}):!1,O||(r=Error("Aborted the Sign-In process to avoid sending password over insecure connection."),
r.name="identity-manager:aborted",r.code="IdentityManagerBase.4",r.log=!!n.isDebug,console.log(r.message),A(r)));return O},_enqueue:function(r,u,A,J,O,P){J||(J=new k(p._dfdCanceller));J.resUrl_=r;J.sinfo_=u;J.options_=A;J.admin_=O;J.refresh_=P;this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(r),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(J)):this._xoReqs.push(J):this._doSignIn(J);return J},_doSignIn:function(r){this._busy=
r;this._rejectOnPersistedPageShow=!1;var u=this,A=function(Q){var R=r.options_&&r.options_.resource,K=r.resUrl_,N=r.refresh_,V=!1;-1===l.indexOf(u.credentials,Q)&&(N&&-1!==l.indexOf(u.credentials,N)?(N.userId=Q.userId,N.token=Q.token,N.expires=Q.expires,N.validity=Q.validity,N.ssl=Q.ssl,N.creationTime=Q.creationTime,V=!0,Q=N):u.credentials.push(Q));Q.resources||(Q.resources=[]);Q.resources.push(R||K);Q.scope=u._isServerRsrc(K)?"server":"portal";Q.onTokenChange();R=u._soReqs;var W={};u._soReqs=[];
l.forEach(R,function(L){if(!this._isIdenticalService(K,L.resUrl_)){var T=this._getSuffix(L.resUrl_);W[T]||(W[T]=!0,Q.resources.push(L.resUrl_))}},u);r.callback(Q);l.forEach(R,function(L){this._hasSameServerInstance(this._getServerInstanceRoot(K),L.resUrl_)?L.callback(Q):this._soReqs.push(L)},u);u._busy=r.resUrl_=r.sinfo_=r.refresh_=null;if(!V)u.onCredentialCreate({credential:Q});u._soReqs.length?u._doSignIn(u._soReqs.shift()):u._xoReqs.length&&u._doSignIn(u._xoReqs.shift())},J=function(Q){r.errback(Q);
u._busy=r.resUrl_=r.sinfo_=r.refresh_=null;u._soReqs.length?u._doSignIn(u._soReqs.shift()):u._xoReqs.length&&u._doSignIn(u._xoReqs.shift())},O=function(Q,R,K,N){var V=r.sinfo_,W=!r.options_||!1!==r.options_.prompt,L=V.hasPortal&&u._findOAuthInfo(r.resUrl_);if(Q)A(new D({userId:Q,server:V.server,token:K||null,expires:h.isDefined(N)?Number(N):null,ssl:!!R}));else if(window!==window.parent&&u._appUrlObj.query&&u._appUrlObj.query["arcgis-auth-origin"]&&u._appUrlObj.query["arcgis-auth-portal"]&&u._hasSameServerInstance(u._getServerInstanceRoot(u._appUrlObj.query["arcgis-auth-portal"]),
r.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},u._appUrlObj.query["arcgis-auth-origin"]);var T=b(window,"message",function(Z){if(Z.source===window.parent&&Z.data)if("arcgis:auth:credential"===Z.data.type)T.remove(),A(new D(Z.data.credential));else if("arcgis:auth:error"===Z.data.type){T.remove();Z=Z.data.error;switch(Z.name){case "identity-manager:busy":case "identity-manager:not-authorized":var aa="IdentityManager.1";break;case "identity-manager:server-identification-failed":case "identity-manager:unknown-resource":case "identity-manager:user-aborted":aa=
"IdentityManager.2";break;case "identity-manager:authentication-failed":aa="IdentityManager.3";break;case "identity-manager:aborted":aa="IdentityManager.4";break;case "identity-manager:not-authenticated":aa="IdentityManager.6";break;case "identity-manager:invalid-request":aa=400}var ba=Error(Z.message);ba.name=Z.name;ba.code=aa;ba.log=!!n.isDebug;J(ba)}})}else if(L){var S=L._oAuthCred;S||(Q=new w(L,C),R=new w(L,G),Q.isValid()&&R.isValid()?Q.expires>R.expires?(S=Q,R.destroy()):(S=R,Q.destroy()):S=
Q.isValid()?Q:R,L._oAuthCred=S);if(S.isValid()){var U=new D({userId:S.userId,server:V.server,token:S.token,expires:S.expires,ssl:S.ssl,_oAuthCred:S});L.appId!==S.appId&&u._doPortalSignIn(r.resUrl_)?r._pendingDfd=u._exchangeToken(U.server,L.appId,U.token).then(function(Z){U.token=Z;S.token=Z;S.save();A(U)}).catch(function(){A(U)}):A(U)}else if(u._oAuthHash&&u._hasSameServerInstance(L.portalUrl,u._oAuthHash.state.portalUrl))Q=u._oAuthHash,U=new D({userId:Q.username,server:V.server,token:Q.access_token,
expires:(new Date).getTime()+1E3*Number(Q.expires_in),ssl:"true"===Q.ssl,oAuthState:Q.state,_oAuthCred:S}),S.storage=Q.persist?C:G,S.token=U.token,S.expires=U.expires,S.userId=U.userId,S.ssl=U.ssl,S.save(),u._oAuthHash=null,A(U);else{var X=function(){W?r._pendingDfd=u.oAuthSignIn(r.resUrl_,V,L,r.options_).addCallbacks(A,J):(Y=Error("User is not signed in."),Y.name="identity-manager:not-authenticated",Y.code="IdentityManagerBase.6",Y.log=!!n.isDebug,J(Y))};u._doPortalSignIn(r.resUrl_)?r._pendingDfd=
u._getPlatformSelf(V.server,L.appId).then(function(Z){var aa=Z.portalUrl;!aa||m.hasSameOrigin(aa,window.location.origin,!0)?(U=new D({server:V.server,userId:Z.username,token:Z.token}),A(U)):X()}).catch(X):X()}}else if(W)u._checkProtocol(r.resUrl_,V,J,r.admin_)&&(Q=r.options_,r.admin_&&(Q=Q||{},Q.isAdmin=!0),r._pendingDfd=u.signIn(r.resUrl_,V,Q).addCallbacks(A,J));else{var Y=Error("User is not signed in.");Y.name="identity-manager:not-authenticated";Y.code="IdentityManagerBase.6";Y.log=!!n.isDebug;
J(Y)}},P=function(){var Q=r.sinfo_,R=Q.owningSystemUrl,K=r.options_,N;if(K){var V=K.token;var W=K.error;var L=K.prompt}(N=u._findCredential(R,{token:V,resource:r.resUrl_}))||l.some(u.credentials,function(T){this._isIdProvider(R,T.server)&&(N=T);return!!N},u);N?(K=u.findCredential(r.resUrl_,N.userId))?A(K):B(Q,u._legacyFed)?(K=N.toJson(),K.server=Q.server,K.resources=null,A(new D(K))):(r._pendingDfd=u.generateToken(u.findServerInfo(N.server),null,{serverUrl:r.resUrl_,token:N.token,ssl:N.ssl})).addCallbacks(function(T){A(new D({userId:N.userId,
server:Q.server,token:T.token,expires:h.isDefined(T.expires)?Number(T.expires):null,ssl:!!T.ssl,isAdmin:r.admin_,validity:T.validity}))},J):(u._busy=null,V&&(r.options_.token=null),(r._pendingDfd=u.getCredential(R.replace(/\/?$/,"/sharing"),{resource:r.resUrl_,owningTenant:Q.owningTenant,token:V,error:W,prompt:L})).addCallbacks(function(T){u._enqueue(r.resUrl_,r.sinfo_,r.options_,r,r.admin_)},function(T){J(T)}))};this._errbackFunc=J;var z=r.sinfo_.owningSystemUrl,F=this._isServerRsrc(r.resUrl_),M=
r.sinfo_._restInfoDfd;M?M.addCallbacks(function(Q){var R=r.sinfo_;R._restInfoDfd&&(R.adminTokenServiceUrl=R._restInfoDfd.adminUrl_,R._restInfoDfd=null,R.tokenServiceUrl=t.getObject("authInfo.tokenServicesUrl",!1,Q)||t.getObject("authInfo.tokenServiceUrl",!1,Q)||t.getObject("tokenServiceUrl",!1,Q),R.shortLivedTokenValidity=t.getObject("authInfo.shortLivedTokenValidity",!1,Q),R.currentVersion=Q.currentVersion,R.owningTenant=Q.owningTenant,(Q=R.owningSystemUrl=Q.owningSystemUrl)&&u._portals.push(Q));
F&&R.owningSystemUrl?P():O()},function(){r.sinfo_._restInfoDfd=null;var Q=Error("Unknown resource - could not find token service endpoint.");Q.name="identity-manager:server-identification-failed";Q.code="IdentityManagerBase.2";Q.log=!!n.isDebug;J(Q)}):F&&z?P():r.sinfo_._selfReq?r.sinfo_._selfReq.selfDfd.then(function(Q){var R={};if(Q){var K=Q.user&&Q.user.username;R.username=K;R.allSSL=Q.allSSL;var N=Q.supportsOAuth;var V=Q.currentVersion;if("multitenant"===Q.portalMode)var W=Q.customBaseUrl}r.sinfo_.webTierAuth=
!!K;return K&&u.normalizeWebTierAuth?u.generateToken(r.sinfo_,null,{ssl:R.allSSL}).addBoth(function(L){R.portalToken=L&&L.token;R.tokenExpiration=L&&L.expires;return R}):!K&&N&&4.4<=parseFloat(V)&&!u._findOAuthInfo(r.resUrl_)?u._generateOAuthInfo({portalUrl:r.sinfo_.server,customBaseUrl:W,owningTenant:r.sinfo_._selfReq.owningTenant}).always(function(){return R}):R}).always(function(Q){r.sinfo_._selfReq=null;Q?O(Q.username,Q.allSSL,Q.portalToken,Q.tokenExpiration):O()}):O()},_generateOAuthInfo:function(r){var u=
this,A=r.portalUrl,J=r.customBaseUrl,O=r.owningTenant;if(r=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal){var P=window.location.href;var z=P.indexOf("?");-1<z&&(P=P.slice(0,z));z=P.search(/\/(apps|home)\//);P=-1<z?P.slice(0,z):null}r&&P?(this._hasTestedIfAppIsOnPortal=!0,r=v({url:P+"/sharing/rest",content:{f:"json"},handleAs:"json"}).then(function(){u.defaultOAuthInfo=new y({appId:"arcgisonline",popupCallbackUrl:P+"/home/oauth-callback.html"})})):(r=new k,r.resolve(),
r=r.promise);return r.then(function(){if(u.defaultOAuthInfo)return A=A.replace(/^http:/i,"https:"),v({url:A+"/sharing/rest/oauth2/validateRedirectUri",content:{accountId:O,client_id:u.defaultOAuthInfo.appId,redirect_uri:m.getAbsoluteUrl(u.defaultOAuthInfo.popupCallbackUrl),f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(F){if(F.valid){var M=u.defaultOAuthInfo.clone();M.portalUrl=F.urlKey&&J?"https://"+F.urlKey.toLowerCase()+"."+J:A;M.popup=window!==window.top||!(m.hasSameOrigin(A,
window.location.origin)||u._gwDomains.some(function(Q){return Q.regex.test(A)&&Q.regex.test(window.location.origin)}));u.oAuthInfos.push(M)}})})}});var D=H(q,{declaredClass:"esri.Credential",tokenRefreshBuffer:2,constructor:function(r){t.mixin(this,r);this.resources=this.resources||[];h.isDefined(this.creationTime)||(this.creationTime=(new Date).getTime())},_oAuthCred:null,refreshToken:function(){var r=this,u=this.resources&&this.resources[0],A=f.id.findServerInfo(this.server),J=A&&A.owningSystemUrl,
O=!!J&&"server"===this.scope,P=O&&B(A,f.id._legacyFed),z=O&&f.id.findServerInfo(J),F,M=(F=A.webTierAuth)&&f.id.normalizeWebTierAuth,Q=x[this.server];Q=Q&&Q[this.userId];var R={username:this.userId,password:Q};if(!F||M)if(O&&!z&&l.some(f.id.serverInfos,function(V){f.id._isIdProvider(J,V.server)&&(z=V);return!!z}),F=z&&f.id.findCredential(z.server,this.userId),!O||F)if(P)F.refreshToken();else{if(O)var K={serverUrl:u,token:F&&F.token,ssl:F&&F.ssl};else if(M)R=null,K={ssl:this.ssl};else if(Q)this.isAdmin&&
(K={isAdmin:!0});else{if(u){u=f.id._sanitizeUrl(u);this._enqueued=1;var N=f.id._enqueue(u,A,null,null,this.isAdmin,this);N.addCallback(function(){r._enqueued=0;r.refreshServerTokens()}).addErrback(function(){r._enqueued=0})}return N}return f.id.generateToken(O?z:A,O?null:R,K).addCallback(function(V){r.token=V.token;r.expires=h.isDefined(V.expires)?Number(V.expires):null;r.creationTime=(new Date).getTime();r.validity=V.validity;r.onTokenChange();r.refreshServerTokens()}).addErrback(function(){})}},
refreshServerTokens:function(){"portal"===this.scope&&l.forEach(f.id.credentials,function(r){var u=f.id.findServerInfo(r.server),A=u&&u.owningSystemUrl;r!==this&&r.userId===this.userId&&A&&"server"===r.scope&&(f.id._hasSameServerInstance(this.server,A)||f.id._isIdProvider(A,this.server))&&(B(u,f.id._legacyFed)?(r.token=this.token,r.expires=this.expires,r.creationTime=this.creationTime,r.validity=this.validity,r.onTokenChange()):r.refreshToken())},this)},onTokenChange:function(r){clearTimeout(this._refreshTimer);
var u=this.server&&f.id.findServerInfo(this.server),A=(u=u&&u.owningSystemUrl)&&f.id.findServerInfo(u);!1!==r&&(!u||"portal"===this.scope||A&&A.webTierAuth&&!f.id.normalizeWebTierAuth)&&(h.isDefined(this.expires)||h.isDefined(this.validity))&&this._startRefreshTimer()},onDestroy:function(){},destroy:function(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null;this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);var r=l.indexOf(f.id.credentials,
this);-1<r&&f.id.credentials.splice(r,1);this.onTokenChange();this.onDestroy()},toJson:function(){return this._toJson()},_toJson:function(){var r=h.fixJson({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),u=this.resources;u&&0<u.length&&(r.resources=u.slice());return r},_startRefreshTimer:function(){clearTimeout(this._refreshTimer);var r=6E4*this.tokenRefreshBuffer,
u=Math.pow(2,31)-1,A=(this.validity?this.creationTime+6E4*this.validity:this.expires)-(new Date).getTime();0>A?A=0:A>u&&(A=u);this._refreshTimer=setTimeout(t.hitch(this,this.refreshToken),A>r?A-r:A)}});I.Credential=D;c("extend-esri")&&(f.IdentityManagerBase=I);return I})},"esri/ServerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","./kernel","./lang"],function(H,n,t,l,k){H=H(null,{declaredClass:"esri.ServerInfo",constructor:function(e){n.mixin(this,e)},toJson:function(){return k.fixJson({server:this.server,
tokenServiceUrl:this.tokenServiceUrl,adminTokenServiceUrl:this.adminTokenServiceUrl,shortLivedTokenValidity:this.shortLivedTokenValidity,owningSystemUrl:this.owningSystemUrl,owningTenant:this.owningTenant,currentVersion:this.currentVersion,hasPortal:this.hasPortal,hasServer:this.hasServer,webTierAuth:this.webTierAuth})}});t("extend-esri")&&(l.ServerInfo=H);return H})},"esri/OAuthCredential":function(){define(["./kernel","dojo/_base/declare","dojo/has","dojo/json"],function(H,n,t,l){n=n(null,{declaredClass:"esri.OAuthCredential",
oAuthInfo:null,storage:null,appId:null,expires:null,ssl:null,token:null,userId:null,constructor:function(k,e){this.oAuthInfo=k;this.storage=e;this._init()},isValid:function(){var k=!1;if(this.oAuthInfo&&this.token&&this.userId){var e=(new Date).getTime();this.expires>e&&(this.expires-e)/1E3>60*this.oAuthInfo.minTimeUntilExpiration&&(k=!0)}return k},save:function(){if(this.storage){var k=this._load(),e=this.oAuthInfo;if(e&&e.authNamespace&&e.portalUrl){var c=k[e.authNamespace];c||(c=k[e.authNamespace]=
{});c[e.portalUrl]={appId:this.appId=e.appId,expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem("esriJSAPIOAuth",l.stringify(k))}catch(a){console.log(a)}}}},destroy:function(){var k=this._load(),e=this.oAuthInfo;if(e&&e.appId&&e.portalUrl&&this.token&&this.expires>Date.now()){var c=e.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",a=new FormData;a.append("f","json");a.append("auth_token",this.token);a.append("client_id",e.appId);
a.append("token_type_hint","access_token");if("function"===typeof navigator.sendBeacon)navigator.sendBeacon(c,a);else{var b=new XMLHttpRequest;b.open("POST",c);b.send(a)}}if(e&&e.authNamespace&&e.portalUrl&&this.storage&&(c=k[e.authNamespace])){delete c[e.portalUrl];try{this.storage.setItem("esriJSAPIOAuth",l.stringify(k))}catch(f){console.log(f)}}e&&(this.oAuthInfo=e._oAuthCred=null)},_init:function(){var k=this._load(),e=this.oAuthInfo;e&&e.authNamespace&&e.portalUrl&&(k=k[e.authNamespace])&&(k=
k[e.portalUrl])&&(this.appId=k.appId,this.expires=k.expires,this.ssl=k.ssl,this.token=k.token,this.userId=k.userId)},_load:function(){var k={};if(this.storage){var e=this.storage.getItem("esriJSAPIOAuth");if(e)try{k=l.parse(e)}catch(c){console.log(c)}}return k}});t("extend-esri")&&(H.OAuthCredential=n);return n})},"esri/arcgis/OAuthInfo":function(){define(["../kernel","../lang","dojo/_base/declare","dojo/_base/lang","dojo/has"],function(H,n,t,l,k){var e=t(null,{declaredClass:"esri.arcgis.OAuthInfo",
constructor:function(c){l.mixin(this,{expiration:20160,minTimeUntilExpiration:30,portalUrl:"https://www.arcgis.com",authNamespace:"/",forceLogin:!1,popup:!1,popupCallbackUrl:"oauth-callback.html",popupWindowFeatures:"height\x3d490,width\x3d800,resizable,scrollbars,status",preserveUrlHash:!1},c)},_oAuthCred:null,toJson:function(){return n.fixJson({appId:this.appId,expiration:this.expiration,locale:this.locale,minTimeUntilExpiration:this.minTimeUntilExpiration,portalUrl:this.portalUrl,authNamespace:this.authNamespace,
forceLogin:this.forceLogin,popup:this.popup,popupCallbackUrl:this.popupCallbackUrl,popupWindowFeatures:this.popupWindowFeatures,preserveUrlHash:this.preserveUrlHash})},clone:function(){return new e(this.toJson())}});k("extend-esri")&&l.setObject("arcgis.OAuthInfo",e,H);return e})},"dijit/form/Button":function(){define("require dojo/_base/declare dojo/dom-class dojo/has dojo/_base/kernel dojo/_base/lang dojo/ready ./_FormWidget ./_ButtonMixin dojo/text!./templates/Button.html ../a11yclick".split(" "),
function(H,n,t,l,k,e,c,a,b,f){l("dijit-legacy-requires")&&c(0,function(){H(["dijit/form/DropDownButton","dijit/form/ComboButton","dijit/form/ToggleButton"])});c=n("dijit.form.Button"+(l("dojo-bidi")?"_NoBidi":""),[a,b],{showLabel:!0,iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},baseClass:"dijitButton",templateString:f,_setValueAttr:"valueNode",_setNameAttr:function(g){this.valueNode&&this.valueNode.setAttribute("name",g)},postCreate:function(){this.inherited(arguments);
this._setLabelFromContainer()},_setLabelFromContainer:function(){this.containerNode&&!this.label&&(this.label=e.trim(this.containerNode.innerHTML),this.onLabelSet())},_setShowLabelAttr:function(g){this.containerNode&&t.toggle(this.containerNode,"dijitDisplayNone",!g);this._set("showLabel",g)},setLabel:function(g){k.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",g)},onLabelSet:function(){this.inherited(arguments);this.showLabel||
"title"in this.params||(this.titleNode.title=e.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});l("dojo-bidi")&&(c=n("dijit.form.Button",c,{onLabelSet:function(){this.inherited(arguments);this.titleNode.title&&this.applyTextDir(this.titleNode,this.titleNode.title)},_setTextDirAttr:function(g){this._created&&this.textDir!=g&&(this._set("textDir",g),this._setLabelAttr(this.label))}}));return c})},"dijit/form/_FormWidget":function(){define("dojo/_base/declare dojo/sniff dojo/_base/kernel dojo/ready ../_Widget ../_CssStateMixin ../_TemplatedMixin ./_FormWidgetMixin".split(" "),
function(H,n,t,l,k,e,c,a){n("dijit-legacy-requires")&&l(0,function(){require(["dijit/form/_FormValueWidget"])});return H("dijit.form._FormWidget",[k,c,e,a],{setDisabled:function(b){t.deprecated("setDisabled("+b+") is deprecated. Use set('disabled',"+b+") instead.","","2.0");this.set("disabled",b)},setValue:function(b){t.deprecated("dijit.form._FormWidget:setValue("+b+") is deprecated.  Use set('value',"+b+") instead.","","2.0");this.set("value",b)},getValue:function(){t.deprecated(this.declaredClass+
"::getValue() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},postMixInProperties:function(){this.nameAttrSetting=this.name&&!n("msapp")?'name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"";this.inherited(arguments)}})})},"dijit/form/_FormWidgetMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff dojo/window ../a11y".split(" "),function(H,n,t,l,k,e,c,a,b,f){return n("dijit.form._FormWidgetMixin",
null,{name:"",alt:"",value:"",type:"text","aria-label":"focusNode",tabIndex:"0",_setTabIndexAttr:"focusNode",disabled:!1,intermediateChanges:!1,scrollOnFocus:!0,_setIdAttr:"focusNode",_setDisabledAttr:function(g){this._set("disabled",g);/^(button|input|select|textarea|optgroup|option|fieldset)$/i.test(this.focusNode.tagName)?(t.set(this.focusNode,"disabled",g),a("trident")&&"readOnly"in this&&t.set(this.focusNode,"readonly",g||this.readOnly)):this.focusNode.setAttribute("aria-disabled",g?"true":"false");
this.valueNode&&t.set(this.valueNode,"disabled",g);g?(this._set("hovering",!1),this._set("active",!1),g="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"_setTabIndexAttr"in this?this._setTabIndexAttr:"focusNode",H.forEach(k.isArray(g)?g:[g],function(h){h=this[h];a("webkit")||f.hasDefaultTabStop(h)?h.setAttribute("tabIndex","-1"):h.removeAttribute("tabIndex")},this)):""!=this.tabIndex&&this.set("tabIndex",this.tabIndex)},_onFocus:function(g){if("mouse"==g&&this.isFocusable())var h=this.own(c(this.focusNode,
"focus",function(){m.remove();h.remove()}))[0],d=a("pointer-events")?"pointerup":a("MSPointer")?"MSPointerUp":a("touch-events")?"touchend, mouseup":"mouseup",m=this.own(c(this.ownerDocumentBody,d,k.hitch(this,function(p){m.remove();h.remove();this.focused&&("touchend"==p.type?this.defer("focus"):this.focus())})))[0];this.scrollOnFocus&&this.defer(function(){b.scrollIntoView(this.domNode)});this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&"none"!=l.get(this.domNode,
"display")},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(g){}},compare:function(g,h){return"number"==typeof g&&"number"==typeof h?isNaN(g)&&isNaN(h)?0:g-h:g>h?1:g<h?-1:0},onChange:function(){},_onChangeActive:!1,_handleOnChange:function(g,h){void 0!=this._lastValueReported||null!==h&&this._onChangeActive||(this._resetValue=this._lastValueReported=g);this._pendingOnChange=this._pendingOnChange||typeof g!=typeof this._lastValueReported||0!=this.compare(g,
this._lastValueReported);(this.intermediateChanges||h||void 0===h)&&this._pendingOnChange&&(this._lastValueReported=g,this._pendingOnChange=!1,this._onChangeActive&&(this._onChangeHandle&&this._onChangeHandle.remove(),this._onChangeHandle=this.defer(function(){this._onChangeHandle=null;this.onChange(g)})))},create:function(){this.inherited(arguments);this._onChangeActive=!0},destroy:function(){this._onChangeHandle&&(this._onChangeHandle.remove(),this.onChange(this._lastValueReported));this.inherited(arguments)}})})},
"dijit/form/_ButtonMixin":function(){define(["dojo/_base/declare","dojo/dom","dojo/has","../registry"],function(H,n,t,l){var k=H("dijit.form._ButtonMixin"+(t("dojo-bidi")?"_NoBidi":""),null,{label:"",type:"button",__onClick:function(e){e.stopPropagation();e.preventDefault();this.disabled||this.valueNode.click(e);return!1},_onClick:function(e){if(this.disabled)return e.stopPropagation(),e.preventDefault(),!1;!1===this.onClick(e)&&e.preventDefault();var c=e.defaultPrevented;if(!c&&"submit"==this.type&&
!(this.valueNode||this.focusNode).form)for(var a=this.domNode;a.parentNode;a=a.parentNode){var b=l.byNode(a);if(b&&"function"==typeof b._onSubmit){b._onSubmit(e);e.preventDefault();c=!0;break}}return!c},postCreate:function(){this.inherited(arguments);n.setSelectable(this.focusNode,!1)},onClick:function(){return!0},_setLabelAttr:function(e){this._set("label",e);(this.containerNode||this.focusNode).innerHTML=e;this.onLabelSet()},onLabelSet:function(){}});t("dojo-bidi")&&(k=H("dijit.form._ButtonMixin",
k,{onLabelSet:function(){this.inherited(arguments);this.applyTextDir(this.containerNode||this.focusNode)}}));return k})},"dijit/form/Form":function(){define("dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/sniff ../_Widget ../_TemplatedMixin ./_FormMixin ../layout/_ContentPaneResizeMixin".split(" "),function(H,n,t,l,k,e,c,a){return H("dijit.form.Form",[k,e,c,a],{name:"",action:"",method:"",encType:"","accept-charset":"",accept:"",target:"",templateString:"\x3cform data-dojo-attach-point\x3d'containerNode' data-dojo-attach-event\x3d'onreset:_onReset,onsubmit:_onSubmit' ${!nameAttrSetting}\x3e\x3c/form\x3e",
postMixInProperties:function(){this.nameAttrSetting=this.name?"name\x3d'"+this.name+"'":"";this.inherited(arguments)},execute:function(){},onExecute:function(){},_setEncTypeAttr:function(b){n.set(this.domNode,"encType",b);l("ie")&&(this.domNode.encoding=b);this._set("encType",b)},reset:function(b){var f={returnValue:!0,preventDefault:function(){this.returnValue=!1},stopPropagation:function(){},currentTarget:b?b.target:this.domNode,target:b?b.target:this.domNode};!1!==this.onReset(f)&&f.returnValue&&
this.inherited(arguments,[])},onReset:function(){return!0},_onReset:function(b){this.reset(b);b.stopPropagation();b.preventDefault();return!1},_onSubmit:function(b){var f=this.constructor.prototype;if(this.execute!=f.execute||this.onExecute!=f.onExecute)t.deprecated("dijit.form.Form:execute()/onExecute() are deprecated. Use onSubmit() instead.","","2.0"),this.onExecute(),this.execute(this.getValues());!1===this.onSubmit(b)&&(b.stopPropagation(),b.preventDefault())},onSubmit:function(){return this.isValid()},
submit:function(){!1!==this.onSubmit()&&this.containerNode.submit()}})})},"dijit/form/ValidationTextBox":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/i18n ./TextBox ../Tooltip dojo/text!./templates/ValidationTextBox.html dojo/i18n!./nls/validate".split(" "),function(H,n,t,l,k,e,c){var a=H("dijit.form.ValidationTextBox",k,{templateString:c,required:!1,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},pattern:".*",regExp:"",
regExpGen:function(){},state:"",tooltipPosition:[],_deprecateRegExp:function(b,f){f!=a.prototype[b]&&(n.deprecated("ValidationTextBox id\x3d"+this.id+", set('"+b+"', ...) is deprecated.  Use set('pattern', ...) instead.","","2.0"),this.set("pattern",f))},_setRegExpGenAttr:function(b){this._deprecateRegExp("regExpGen",b);this._set("regExpGen",this._computeRegexp)},_setRegExpAttr:function(b){this._deprecateRegExp("regExp",b)},_setValueAttr:function(){this.inherited(arguments);this._refreshState()},
validator:function(b,f){return(new RegExp("^(?:"+this._computeRegexp(f)+")"+(this.required?"":"?")+"$")).test(b)&&(!this.required||!this._isEmpty(b))&&(this._isEmpty(b)||void 0!==this.parse(b,f))},_isValidSubset:function(){return 0==this.textbox.value.search(this._partialre)},isValid:function(){return this.validator(this.textbox.value,this.get("constraints"))},_isEmpty:function(b){return(this.trim?/^\s*$/:/^$/).test(b)},getErrorMessage:function(){var b="$_unset_$"==this.invalidMessage?this.messages.invalidMessage:
this.invalidMessage?this.invalidMessage:this.promptMessage,f="$_unset_$"==this.missingMessage?this.messages.missingMessage:this.missingMessage?this.missingMessage:b;return this.required&&this._isEmpty(this.textbox.value)?f:b},getPromptMessage:function(){return this.promptMessage},_maskValidSubsetError:!0,validate:function(b){var f="",g=this.disabled||this.isValid(b);g&&(this._maskValidSubsetError=!0);var h=this._isEmpty(this.textbox.value),d=!g&&b&&this._isValidSubset();this._set("state",g?"":((!this._hasBeenBlurred||
b)&&h||d)&&(this._maskValidSubsetError||d&&!this._hasBeenBlurred&&b)?"Incomplete":"Error");this.focusNode.setAttribute("aria-invalid","Error"==this.state?"true":"false");"Error"==this.state?(this._maskValidSubsetError=b&&d,f=this.getErrorMessage(b)):"Incomplete"==this.state?(f=this.getPromptMessage(b),this._maskValidSubsetError=!this._hasBeenBlurred||b):h&&(f=this.getPromptMessage(b));this.set("message",f);return g},displayMessage:function(b){b&&this.focused?e.show(b,this.domNode,this.tooltipPosition,
!this.isLeftToRight()):e.hide(this.domNode)},_refreshState:function(){this._created&&this.validate(this.focused);this.inherited(arguments)},constructor:function(b){this.constraints=t.clone(this.constraints);this.baseClass+=" dijitValidationTextBox"},startup:function(){this.inherited(arguments);this._refreshState()},_setConstraintsAttr:function(b){!b.locale&&this.lang&&(b.locale=this.lang);this._set("constraints",b);this._refreshState()},_setPatternAttr:function(b){this._set("pattern",b);this._refreshState()},
_computeRegexp:function(b){var f=this.pattern;"function"==typeof f&&(f=f.call(this,b));if(f!=this._lastRegExp){var g="";this._lastRegExp=f;".*"!=f&&f.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(h){switch(h.charAt(0)){case "{":case "+":case "?":case "*":case "^":case "$":case "|":case "(":g+=h;break;case ")":g+="|$)";break;default:g+="(?:"+h+"|$)"}});try{"".search(g)}catch(h){g=this.pattern,console.warn("RegExp error in "+this.declaredClass+": "+this.pattern)}this._partialre="^(?:"+
g+")$"}return f},postMixInProperties:function(){this.inherited(arguments);this.messages=l.getLocalization("dijit.form","validate",this.lang);this._setConstraintsAttr(this.constraints)},_setDisabledAttr:function(b){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(b){this._set("required",b);this.focusNode.setAttribute("aria-required",b);this._refreshState()},_setMessageAttr:function(b){this._set("message",b);this.displayMessage(b)},reset:function(){this._maskValidSubsetError=
!0;this.inherited(arguments)},_onBlur:function(){this.displayMessage("");this.inherited(arguments)},destroy:function(){e.hide(this.domNode);this.inherited(arguments)}});return a})},"dijit/form/TextBox":function(){define("dojo/_base/declare dojo/dom-construct dojo/dom-style dojo/_base/kernel dojo/_base/lang dojo/on dojo/sniff ./_FormValueWidget ./_TextBoxMixin dojo/text!./templates/TextBox.html ../main".split(" "),function(H,n,t,l,k,e,c,a,b,f,g){a=H("dijit.form.TextBox"+(c("dojo-bidi")?"_NoBidi":""),
[a,b],{templateString:f,_singleNodeTemplate:'\x3cinput class\x3d"dijit dijitReset dijitLeft dijitInputField" data-dojo-attach-point\x3d"textbox,focusNode" autocomplete\x3d"off" type\x3d"${type}" ${!nameAttrSetting} /\x3e',_buttonInputDisabled:c("ie")?"disabled":"",baseClass:"dijitTextBox",postMixInProperties:function(){var h=this.type.toLowerCase();if(this.templateString&&"input"==this.templateString.toLowerCase()||("hidden"==h||"file"==h)&&this.templateString==this.constructor.prototype.templateString)this.templateString=
this._singleNodeTemplate;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);9>c("ie")&&this.defer(function(){try{var h=t.getComputedStyle(this.domNode);if(h){var d=h.fontFamily;if(d){var m=this.domNode.getElementsByTagName("INPUT");if(m)for(h=0;h<m.length;h++)m[h].style.fontFamily=d}}}catch(p){}})},_setPlaceHolderAttr:function(h){this._set("placeHolder",h);this._phspan||(this._attachPoints.push("_phspan"),this._phspan=n.create("span",{className:"dijitPlaceHolder dijitInputField"},
this.textbox,"after"),this.own(e(this._phspan,"mousedown",function(d){d.preventDefault()}),e(this._phspan,"touchend, pointerup, MSPointerUp",k.hitch(this,function(){this.focus()}))));this._phspan.innerHTML="";this._phspan.appendChild(this._phspan.ownerDocument.createTextNode(h));this._updatePlaceHolder()},_onInput:function(h){this.inherited(arguments);this._updatePlaceHolder()},_updatePlaceHolder:function(){this._phspan&&(this._phspan.style.display=this.placeHolder&&!this.textbox.value?"":"none")},
_setValueAttr:function(h,d,m){this.inherited(arguments);this._updatePlaceHolder()},getDisplayedValue:function(){l.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use get('displayedValue') instead.","","2.0");return this.get("displayedValue")},setDisplayedValue:function(h){l.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");this.set("displayedValue",h)},_onBlur:function(h){this.disabled||(this.inherited(arguments),
this._updatePlaceHolder(),c("mozilla")&&this.selectOnClick&&(this.textbox.selectionStart=this.textbox.selectionEnd=void 0))},_onFocus:function(h){this.disabled||this.readOnly||(this.inherited(arguments),this._updatePlaceHolder())}});9>c("ie")&&(a.prototype._isTextSelected=function(){var h=this.ownerDocument.selection.createRange();return h.parentElement()==this.textbox&&0<h.text.length},g._setSelectionRange=b._setSelectionRange=function(h,d,m){h.createTextRange&&(h=h.createTextRange(),h.collapse(!0),
h.moveStart("character",-99999),h.moveStart("character",d),h.moveEnd("character",m-d),h.select())});c("dojo-bidi")&&(a=H("dijit.form.TextBox",a,{_setPlaceHolderAttr:function(h){this.inherited(arguments);this.applyTextDir(this._phspan)}}));return a})},"dijit/form/_FormValueWidget":function(){define(["dojo/_base/declare","dojo/sniff","./_FormWidget","./_FormValueMixin"],function(H,n,t,l){return H("dijit.form._FormValueWidget",[t,l],{_layoutHackIE7:function(){if(7==n("ie"))for(var k=this.domNode,e=k.parentNode,
c=k.firstChild||k,a=c.style.filter,b=this;e&&0==e.clientHeight;)(function(){var f=b.connect(e,"onscroll",function(){b.disconnect(f);c.style.filter=(new Date).getMilliseconds();b.defer(function(){c.style.filter=a})})})(),e=e.parentNode}})})},"dijit/form/_FormValueMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormWidgetMixin".split(" "),function(H,n,t,l,k,e,c){return H("dijit.form._FormValueMixin",c,{readOnly:!1,_setReadOnlyAttr:function(a){e("trident")&&
"disabled"in this?n.set(this.focusNode,"readOnly",a||this.disabled):n.set(this.focusNode,"readOnly",a);this._set("readOnly",a)},postCreate:function(){this.inherited(arguments);void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.value)},_setValueAttr:function(a,b){this._handleOnChange(a,b)},_handleOnChange:function(a,b){this._set("value",a);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,!1)},reset:function(){this._hasBeenBlurred=!1;this._setValueAttr(this._resetValue,
!0)}})})},"dijit/form/_TextBoxMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/sniff dojo/keys dojo/_base/lang dojo/on ../main".split(" "),function(H,n,t,l,k,e,c,a){var b=n("dijit.form._TextBoxMixin"+(l("dojo-bidi")?"_NoBidi":""),null,{trim:!1,uppercase:!1,lowercase:!1,propercase:!1,maxLength:"",selectOnClick:!1,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(f,g,h){if(void 0!==f){var d=this.filter(f);
"string"!=typeof h&&(h=null===d||"number"==typeof d&&isNaN(d)?"":this.filter(this.format(d,this.constraints)),0!=this.compare(d,this.filter(this.parse(h,this.constraints)))&&(h=null))}null==h||"number"==typeof h&&isNaN(h)||this.textbox.value==h||(this.textbox.value=h,this._set("displayedValue",this.get("displayedValue")));this.inherited(arguments,[d,g])},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},_setDisplayedValueAttr:function(f){null==f?f="":"string"!=
typeof f&&(f=String(f));this.textbox.value=f;this._setValueAttr(this.get("value"),void 0);this._set("displayedValue",this.get("displayedValue"))},format:function(f){return null==f?"":f.toString?f.toString():f},parse:function(f){return f},_refreshState:function(){},onInput:function(){},_onInput:function(f){this._lastInputEventValue=this.textbox.value;this._processInput(this._lastInputProducingEvent||f);delete this._lastInputProducingEvent;this.intermediateChanges&&this._handleOnChange(this.get("value"),
!1)},_processInput:function(){this._refreshState();this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);this.own(c(this.textbox,"keydown, keypress, paste, cut, compositionend",e.hitch(this,function(f){if("keydown"==f.type&&229!=f.keyCode){var g=f.keyCode;switch(g){case k.SHIFT:case k.ALT:case k.CTRL:case k.META:case k.CAPS_LOCK:case k.NUM_LOCK:case k.SCROLL_LOCK:return}if(!f.ctrlKey&&!f.metaKey&&
!f.altKey){switch(g){case k.NUMPAD_0:case k.NUMPAD_1:case k.NUMPAD_2:case k.NUMPAD_3:case k.NUMPAD_4:case k.NUMPAD_5:case k.NUMPAD_6:case k.NUMPAD_7:case k.NUMPAD_8:case k.NUMPAD_9:case k.NUMPAD_MULTIPLY:case k.NUMPAD_PLUS:case k.NUMPAD_ENTER:case k.NUMPAD_MINUS:case k.NUMPAD_PERIOD:case k.NUMPAD_DIVIDE:return}if(65<=g&&90>=g||48<=g&&57>=g||g==k.SPACE)return;g=!1;for(var h in k)if(k[h]===f.keyCode){g=!0;break}if(!g)return}}(g=32<=f.charCode?String.fromCharCode(f.charCode):f.charCode)||(g=65<=f.keyCode&&
90>=f.keyCode||48<=f.keyCode&&57>=f.keyCode||f.keyCode==k.SPACE?String.fromCharCode(f.keyCode):f.keyCode);g||(g=229);if("keypress"==f.type){if("string"!=typeof g)return;if("a"<=g&&"z">=g||"A"<=g&&"Z">=g||"0"<=g&&"9">=g||" "===g)if(f.ctrlKey||f.metaKey||f.altKey)return}var d={faux:!0},m;for(m in f)/^(layer[XY]|returnValue|keyLocation)$/.test(m)||(h=f[m],"function"!=typeof h&&"undefined"!=typeof h&&(d[m]=h));e.mixin(d,{charOrCode:g,_wasConsumed:!1,preventDefault:function(){d._wasConsumed=!0;f.preventDefault()},
stopPropagation:function(){f.stopPropagation()}});this._lastInputProducingEvent=d;!1===this.onInput(d)&&(d.preventDefault(),d.stopPropagation());if(!d._wasConsumed&&9>=l("ie"))switch(f.keyCode){case k.TAB:case k.ESCAPE:case k.DOWN_ARROW:case k.UP_ARROW:case k.LEFT_ARROW:case k.RIGHT_ARROW:break;default:f.keyCode==k.ENTER&&"textarea"!=this.textbox.tagName.toLowerCase()||this.defer(function(){this.textbox.value!==this._lastInputEventValue&&c.emit(this.textbox,"input",{bubbles:!0})})}})),c(this.textbox,
"input",e.hitch(this,"_onInput")),c(this.domNode,"keypress",function(f){f.stopPropagation()}))},_blankValue:"",filter:function(f){if(null===f)return this._blankValue;if("string"!=typeof f)return f;this.trim&&(f=e.trim(f));this.uppercase&&(f=f.toUpperCase());this.lowercase&&(f=f.toLowerCase());this.propercase&&(f=f.replace(/[^\s]+/g,function(g){return g.substring(0,1).toUpperCase()+g.substring(1)}));return f},_setBlurValue:function(){this._setValueAttr(this.get("value"),!0)},_onBlur:function(f){this.disabled||
(this._setBlurValue(),this.inherited(arguments))},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd},_onFocus:function(f){this.disabled||this.readOnly||(this.selectOnClick&&"mouse"==f&&(this._selectOnClickHandle=c.once(this.domNode,"mouseup, touchend",e.hitch(this,function(g){this._isTextSelected()||b.selectInputText(this.textbox)})),this.own(this._selectOnClickHandle),this.defer(function(){this._selectOnClickHandle&&(this._selectOnClickHandle.remove(),this._selectOnClickHandle=
null)},500)),this.inherited(arguments),this._refreshState())},reset:function(){this.textbox.value="";this.inherited(arguments)}});l("dojo-bidi")&&(b=n("dijit.form._TextBoxMixin",b,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_setDisplayedValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_onInput:function(){this.applyTextDir(this.focusNode);this.inherited(arguments)}}));b._setSelectionRange=a._setSelectionRange=function(f,g,
h){f.setSelectionRange&&f.setSelectionRange(g,h)};b.selectInputText=a.selectInputText=function(f,g,h){f=t.byId(f);isNaN(g)&&(g=0);isNaN(h)&&(h=f.value?f.value.length:0);try{f.focus(),b._setSelectionRange(f,g,h)}catch(d){}};return b})},"dijit/Tooltip":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff ./_base/manager ./place ./_Widget ./_TemplatedMixin ./BackgroundIframe dojo/text!./templates/Tooltip.html ./main".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q,w){function y(){}var x=n("dijit._MasterTooltip",[m,p],{duration:h.defaultDuration,templateString:q,postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.bgIframe=new v(this.domNode);this.fadeIn=t.fadeIn({node:this.domNode,duration:this.duration,onEnd:a.hitch(this,"_onShow")});this.fadeOut=t.fadeOut({node:this.domNode,duration:this.duration,onEnd:a.hitch(this,"_onHide")})},show:function(B,C,G,I,D,r,u){if(!this.aroundNode||this.aroundNode!==
C||this.containerNode.innerHTML!=B)if("playing"==this.fadeOut.status())this._onDeck=arguments;else{this.containerNode.innerHTML=B;D&&this.set("textDir",D);this.containerNode.align=I?"right":"left";var A=d.around(this.domNode,C,G&&G.length?G:E.defaultPosition,!I,a.hitch(this,"orient")),J=A.aroundNodePos;"M"==A.corner.charAt(0)&&"M"==A.aroundCorner.charAt(0)?(this.connectorNode.style.top=J.y+(J.h-this.connectorNode.offsetHeight>>1)-A.y+"px",this.connectorNode.style.left=""):"M"==A.corner.charAt(1)&&
"M"==A.aroundCorner.charAt(1)?this.connectorNode.style.left=J.x+(J.w-this.connectorNode.offsetWidth>>1)-A.x+"px":(this.connectorNode.style.left="",this.connectorNode.style.top="");c.set(this.domNode,"opacity",0);this.fadeIn.play();this.isShowingNow=!0;this.aroundNode=C;this.onMouseEnter=r||y;this.onMouseLeave=u||y}},orient:function(B,C,G,I,D){this.connectorNode.style.top="";var r=I.h;I=I.w;B.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove",
"BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[C+"-"+G];this.domNode.style.width="auto";var u=e.position(this.domNode);if(g("ie")||g("trident"))u.w+=2;e.setMarginBox(this.domNode,{w:Math.min(Math.max(I,1),u.w)});"B"==G.charAt(0)&&"B"==C.charAt(0)?(B=e.position(B),C=this.connectorNode.offsetHeight,
B.h>r?(this.connectorNode.style.top=r-(D.h+C>>1)+"px",this.connectorNode.style.bottom=""):(this.connectorNode.style.bottom=Math.min(Math.max(D.h/2-C/2,0),B.h-C)+"px",this.connectorNode.style.top="")):(this.connectorNode.style.top="",this.connectorNode.style.bottom="");return Math.max(0,u.w-I)},_onShow:function(){g("ie")&&(this.domNode.style.filter="")},hide:function(B){this._onDeck&&this._onDeck[1]==B?this._onDeck=null:this.aroundNode===B&&(this.fadeIn.stop(),this.isShowingNow=!1,this.aroundNode=
null,this.fadeOut.play());this.onMouseEnter=this.onMouseLeave=y},_onHide:function(){this.domNode.style.cssText="";this.containerNode.innerHTML="";this._onDeck&&(this.show.apply(this,this._onDeck),this._onDeck=null)}});g("dojo-bidi")&&x.extend({_setAutoTextDir:function(B){this.applyTextDir(B);H.forEach(B.children,function(C){this._setAutoTextDir(C)},this)},_setTextDirAttr:function(B){this._set("textDir",B);"auto"==B?this._setAutoTextDir(this.containerNode):this.containerNode.dir=this.textDir}});w.showTooltip=
function(B,C,G,I,D,r,u){G&&(G=H.map(G,function(A){return{after:"after-centered",before:"before-centered"}[A]||A}));E._masterTT||(w._masterTT=E._masterTT=new x);return E._masterTT.show(B,C,G,I,D,r,u)};w.hideTooltip=function(B){return E._masterTT&&E._masterTT.hide(B)};var E=n("dijit.Tooltip",m,{label:"",showDelay:400,hideDelay:400,connectId:[],position:[],selector:"",_setConnectIdAttr:function(B){H.forEach(this._connections||[],function(C){H.forEach(C,function(G){G.remove()})},this);this._connectIds=
H.filter(a.isArrayLike(B)?B:B?[B]:[],function(C){return l.byId(C,this.ownerDocument)},this);this._connections=H.map(this._connectIds,function(C){C=l.byId(C,this.ownerDocument);var G=this.selector,I=G?function(r){return f.selector(G,r)}:function(r){return r},D=this;return[f(C,I(b.enter),function(){D._onHover(this)}),f(C,I("focusin"),function(){D._onHover(this)}),f(C,I(b.leave),a.hitch(D,"_onUnHover")),f(C,I("focusout"),a.hitch(D,"set","state","DORMANT"))]},this);this._set("connectId",B)},addTarget:function(B){B=
B.id||B;-1==H.indexOf(this._connectIds,B)&&this.set("connectId",this._connectIds.concat(B))},removeTarget:function(B){B=H.indexOf(this._connectIds,B.id||B);0<=B&&(this._connectIds.splice(B,1),this.set("connectId",this._connectIds))},buildRendering:function(){this.inherited(arguments);k.add(this.domNode,"dijitTooltipData")},startup:function(){this.inherited(arguments);var B=this.connectId;H.forEach(a.isArrayLike(B)?B:[B],this.addTarget,this)},getContent:function(B){return this.label||this.domNode.innerHTML},
state:"DORMANT",_setStateAttr:function(B){if(!(this.state==B||"SHOW TIMER"==B&&"SHOWING"==this.state||"HIDE TIMER"==B&&"DORMANT"==this.state)){this._hideTimer&&(this._hideTimer.remove(),delete this._hideTimer);this._showTimer&&(this._showTimer.remove(),delete this._showTimer);switch(B){case "DORMANT":this._connectNode&&(E.hide(this._connectNode),delete this._connectNode,this.onHide());break;case "SHOW TIMER":"SHOWING"!=this.state&&(this._showTimer=this.defer(function(){this.set("state","SHOWING")},
this.showDelay));break;case "SHOWING":var C=this.getContent(this._connectNode);if(!C){this.set("state","DORMANT");return}E.show(C,this._connectNode,this.position,!this.isLeftToRight(),this.textDir,a.hitch(this,"set","state","SHOWING"),a.hitch(this,"set","state","HIDE TIMER"));this.onShow(this._connectNode,this.position);break;case "HIDE TIMER":this._hideTimer=this.defer(function(){this.set("state","DORMANT")},this.hideDelay)}this._set("state",B)}},_onHover:function(B){this._connectNode&&B!=this._connectNode&&
this.set("state","DORMANT");this._connectNode=B;this.set("state","SHOW TIMER")},_onUnHover:function(B){this.set("state","HIDE TIMER")},open:function(B){this.set("state","DORMANT");this._connectNode=B;this.set("state","SHOWING")},close:function(){this.set("state","DORMANT")},onShow:function(){},onHide:function(){},destroy:function(){this.set("state","DORMANT");H.forEach(this._connections||[],function(B){H.forEach(B,function(C){C.remove()})},this);this.inherited(arguments)}});E._MasterTooltip=x;E.show=
w.showTooltip;E.hide=w.hideTooltip;E.defaultPosition=["after-centered","before-centered"];return E})},"dijit/place":function(){define("dojo/_base/array dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/_base/window ./Viewport ./main".split(" "),function(H,n,t,l,k,e,c){function a(f,g,h,d){var m=e.getEffectiveBox(f.ownerDocument);f.parentNode&&"body"==String(f.parentNode.tagName).toLowerCase()||k.body(f.ownerDocument).appendChild(f);var p=null;H.some(g,function(w){var y=w.corner,x=w.pos,E=0,B=
{w:{L:m.l+m.w-x.x,R:x.x-m.l,M:m.w}[y.charAt(1)],h:{T:m.t+m.h-x.y,B:x.y-m.t,M:m.h}[y.charAt(0)]},C=f.style;C.left=C.right="auto";h&&(E=h(f,w.aroundCorner,y,B,d),E="undefined"==typeof E?0:E);var G=f.style,I=G.display,D=G.visibility;"none"==G.display&&(G.visibility="hidden",G.display="");C=n.position(f);G.display=I;G.visibility=D;I={L:x.x,R:x.x-C.w,M:Math.max(m.l,Math.min(m.l+m.w,x.x+(C.w>>1))-C.w)}[y.charAt(1)];D={T:x.y,B:x.y-C.h,M:Math.max(m.t,Math.min(m.t+m.h,x.y+(C.h>>1))-C.h)}[y.charAt(0)];x=Math.max(m.l,
I);G=Math.max(m.t,D);I=Math.min(m.l+m.w,I+C.w)-x;D=Math.min(m.t+m.h,D+C.h)-G;E+=C.w-I+(C.h-D);if(null==p||E<p.overflow)p={corner:y,aroundCorner:w.aroundCorner,x:x,y:G,w:I,h:D,overflow:E,spaceAvailable:B};return!E});p.overflow&&h&&h(f,p.aroundCorner,p.corner,p.spaceAvailable,d);g=p.y;var v=p.x,q=k.body(f.ownerDocument);/relative|absolute/.test(t.get(q,"position"))&&(g-=t.get(q,"marginTop"),v-=t.get(q,"marginLeft"));q=f.style;q.top=g+"px";q.left=v+"px";q.right="auto";return p}var b={TL:"BR",TR:"BL",
BL:"TR",BR:"TL"};return c.place={at:function(f,g,h,d,m){h=H.map(h,function(p){var v={corner:p,aroundCorner:b[p],pos:{x:g.x,y:g.y}};d&&(v.pos.x+="L"==p.charAt(1)?d.x:-d.x,v.pos.y+="T"==p.charAt(0)?d.y:-d.y);return v});return a(f,h,m)},around:function(f,g,h,d,m){function p(r,u){D.push({aroundCorner:r,corner:u,pos:{x:{L:B,R:B+G,M:B+(G>>1)}[r.charAt(1)],y:{T:C,B:C+I,M:C+(I>>1)}[r.charAt(0)]}})}if("string"==typeof g||"offsetWidth"in g||"ownerSVGElement"in g){var v=n.position(g,!0);if(/^(above|below)/.test(h[0])){var q=
n.getBorderExtents(g),w=g.firstChild?n.getBorderExtents(g.firstChild):{t:0,l:0,b:0,r:0},y=n.getBorderExtents(f),x=f.firstChild?n.getBorderExtents(f.firstChild):{t:0,l:0,b:0,r:0};v.y+=Math.min(q.t+w.t,y.t+x.t);v.h-=Math.min(q.t+w.t,y.t+x.t)+Math.min(q.b+w.b,y.b+x.b)}}else v=g;if(g.parentNode)for(q="absolute"==t.getComputedStyle(g).position,g=g.parentNode;g&&1==g.nodeType&&"BODY"!=g.nodeName;){w=n.position(g,!0);y=t.getComputedStyle(g);/relative|absolute/.test(y.position)&&(q=!1);if(!q&&/hidden|auto|scroll/.test(y.overflow)){x=
Math.min(v.y+v.h,w.y+w.h);var E=Math.min(v.x+v.w,w.x+w.w);v.x=Math.max(v.x,w.x);v.y=Math.max(v.y,w.y);v.h=x-v.y;v.w=E-v.x}"absolute"==y.position&&(q=!0);g=g.parentNode}var B=v.x,C=v.y,G="w"in v?v.w:v.w=v.width,I="h"in v?v.h:(l.deprecated("place.around: dijit/place.__Rectangle: { x:"+B+", y:"+C+", height:"+v.height+", width:"+G+" } has been deprecated.  Please use { x:"+B+", y:"+C+", h:"+v.height+", w:"+G+" }","","2.0"),v.h=v.height),D=[];H.forEach(h,function(r){var u=d;switch(r){case "above-centered":p("TM",
"BM");break;case "below-centered":p("BM","TM");break;case "after-centered":u=!u;case "before-centered":p(u?"ML":"MR",u?"MR":"ML");break;case "after":u=!u;case "before":p(u?"TL":"TR",u?"TR":"TL");p(u?"BL":"BR",u?"BR":"BL");break;case "below-alt":u=!u;case "below":p(u?"BL":"BR",u?"TL":"TR");p(u?"BR":"BL",u?"TR":"TL");break;case "above-alt":u=!u;case "above":p(u?"TL":"TR",u?"BL":"BR");p(u?"TR":"TL",u?"BR":"BL");break;default:p(r.aroundCorner,r.corner)}});f=a(f,D,m,{w:G,h:I});f.aroundNodePos=v;return f}}})},
"esri/OAuthSignInHandler":function(){define("./Credential ./domUtils ./lang ./urlUtils dijit/Dialog dijit/registry dojo/_base/config dojo/_base/Deferred dojo/_base/kernel dojo/dom-attr dojo/i18n!./nls/jsapi dojo/io-query dojo/sniff dojo/json dijit/form/Button dojo/query".split(" "),function(H,n,t,l,k,e,c,a,b,f,g,h,d,m){var p=null,v=null;try{p=window.localStorage,v=window.sessionStorage}catch(q){}return{_oAuthDfd:null,_oAuthIntervalId:0,_oAuthDialogContent:"\x3cdiv class\x3d'dijitDialogPaneContentArea'\x3e\x3cdiv style\x3d'padding-bottom: 5px; word-wrap: break-word;'\x3e${oAuthInfo}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriErrorMsg' style\x3d'display: none; color: white; background-color: #D46464; text-align: center; padding-top: 3px; padding-bottom: 3px;'\x3e${invalidUser}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitDialogPaneActionBar'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdSubmit\"'\x3e${lblOk}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdCancel\"'\x3e${lblCancel}\x3c/button\x3e\x3c/div\x3e",
setOAuthRedirectionHandler:function(q){this._oAuthRedirectFunc=q},oAuthSignIn:function(q,w,y,x){var E=this._oAuthDfd=new a;E.resUrl_=q;E.sinfo_=w;E.oinfo_=y;var B=!x||!1!==x.oAuthPopupConfirmation;if(!y.popup||!B)return this._doOAuthSignIn(q,w,y),E;this._nls||(this._nls=g.identity);this.oAuthDialog||(this.oAuthDialog=this._createOAuthDialog());q=this.oAuthDialog;y=x&&x.error;x=x&&x.token;n.hide(q.errMsg_);y&&403==y.code&&x&&(f.set(q.errMsg_,"innerHTML",this._nls.forbidden),n.show(q.errMsg_));f.set(q.serverLink_,
{title:w.server,innerHTML:-1!==w.server.toLowerCase().indexOf("arcgis.com")?"ArcGIS Online":w.server});q.show();return E},setOAuthResponseHash:function(q){var w=this._oAuthDfd;this._oAuthDfd=null;if(w&&q)if(clearInterval(this._oAuthIntervalId),"#"===q.charAt(0)&&(q=q.substring(1)),q=h.queryToObject(q),q.error){var y="access_denied"===q.error;q=Error(y?"ABORTED":"OAuth: "+q.error+" - "+q.error_description);q.name=y?"identity-manager:user-aborted":"identity-manager:authentication-failed";q.code="IdentityManagerBase."+
(y?2:3);q.log=!!c.isDebug;w.errback(q)}else{y=w.oinfo_._oAuthCred;var x=new H({userId:q.username,server:w.sinfo_.server,token:q.access_token,expires:(new Date).getTime()+1E3*Number(q.expires_in),ssl:"true"===q.ssl,_oAuthCred:y});y.storage=q.persist?p:v;y.token=x.token;y.expires=x.expires;y.userId=x.userId;y.ssl=x.ssl;y.save();w.callback(x)}},_createOAuthDialog:function(){var q=this._nls,w=t.substitute(q,this._oAuthDialogContent);w=t.substitute({server:"\x3cspan class\x3d'serverLink' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e"},
w);var y=new k({title:q.title,content:w,"class":"esriOAuthSignInDialog",style:"min-width: 18em;",esriIdMgr_:this,execute_:function(){var x=y.esriIdMgr_._oAuthDfd;y.hide_();y.esriIdMgr_._doOAuthSignIn(x.resUrl_,x.sinfo_,x.oinfo_)},cancel_:function(){var x=y.esriIdMgr_._oAuthDfd;y.esriIdMgr_._oAuthDfd=null;y.hide_();var E=Error("ABORTED");E.code="IdentityManager.2";E.log=!!c.isDebug;x.errback(E)},hide_:function(){n.hide(y.errMsg_);y.hide();k._DialogLevelManager.hide(y)}});q=y.domNode;y.btnSubmit_=e.byNode(b.query(".esriIdSubmit",
q)[0]);y.btnCancel_=e.byNode(b.query(".esriIdCancel",q)[0]);y.serverLink_=b.query(".serverLink",q)[0];y.errMsg_=b.query(".esriErrorMsg",q)[0];y.connect(y.btnSubmit_,"onClick",y.execute_);y.connect(y.btnCancel_,"onClick",y.onCancel);y.connect(y,"onCancel",y.cancel_);return y},_doOAuthSignIn:function(q,w,y){var x=this,E={portalUrl:y.portalUrl};!y.popup&&y.preserveUrlHash&&window.location.hash&&(E.hash=window.location.hash);E={client_id:y.appId,response_type:"token",state:m.stringify(E),expiration:y.expiration,
locale:y.locale,redirect_uri:y.popup?l.getAbsoluteUrl(y.popupCallbackUrl):window.location.href.replace(/#.*$/,"")};y.forceLogin&&(E.force_login=!0);!y.popup&&this._doPortalSignIn(q)&&(E.redirectToUserOrgUrl=!0);var B=y.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",C=B+"?"+h.objectToQuery(E);if(y.popup){if(7===d("ie")){var G=window.open(y.popupCallbackUrl,"esriJSAPIOAuth",y.popupWindowFeatures);G.location=C}else G=window.open(C,"esriJSAPIOAuth",y.popupWindowFeatures);G?(G.focus(),
this._oAuthDfd.oAuthWin_=G,this._oAuthIntervalId=setInterval(function(){if(G.closed){clearInterval(x._oAuthIntervalId);var I=x._oAuthDfd;if(I){var D=Error("ABORTED");D.code="IdentityManager.2";D.log=!!c.isDebug;I.errback(D)}}},500)):(q=Error("ABORTED"),q.name="identity-manager:user-aborted",q.code="IdentityManager.2",q.log=!!c.isDebug,this._oAuthDfd.errback(q))}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:E,authorizeUrl:B,resourceUrl:q,serverInfo:w,
oAuthInfo:y}):window.location=C}}})},"esri/layers/vectorTiles/core/workers/workerFactory":function(){define("require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../../request ../Logger ../promiseUtils ../sniff ../urlUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),function(H,n,t,l,k,e,c,a,b,f,g,h,d){function m(B){return a.create(function(C){function G(D){if(D=h.receiveMessage(D))switch(D.type){case E:D=B;var r=k.workers.loaderUrl||g.DEFAULT_LOADER_URL;if(null!=k["default"]){var u=
t({},k);delete u["default"];u=JSON.parse(JSON.stringify(u))}else u=JSON.parse(JSON.stringify(k));var A=k.workers.loaderConfig;A=g.default({baseUrl:A.baseUrl,locale:l.locale,has:t({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-cors":1,"esri-secure-context":b("esri-secure-context"),"esri-workers-supports-transfer-arraybuffer":b("esri-workers-supports-transfer-arraybuffer"),"events-keypress-typed":0,"host-webworker":1},A.has),map:t({},A.map),paths:t({},A.paths),packages:A.packages||[]});
D.postMessage({type:x,configure:{esriConfig:u,loaderUrl:r,loaderConfig:A}});break;case y:B.removeEventListener("message",G),B.removeEventListener("error",I),C(B)}}function I(D){D.preventDefault();B.removeEventListener("message",G);B.removeEventListener("error",I);q.warn("Failed to create Worker. Fallback to execute module in main thread",D);B=new d;B.addEventListener("message",G);B.addEventListener("error",I)}B.addEventListener("message",G);B.addEventListener("error",I)})}Object.defineProperty(n,
"__esModule",{value:!0});var p=f.normalize(H.toUrl("./worker.js")),v=!f.hasSameOrigin(p,location.href),q=c.getLogger("esri.core.workers"),w=null,y=h.MessageType.CONFIGURED,x=h.MessageType.CONFIGURE,E=h.MessageType.HANDSHAKE;n.createWorker=function(){if(!b("esri-workers"))return m(new d);if(!v){var B=void 0;try{B=new Worker(p)}catch(C){q.warn("Failed to create Worker. Fallback to execute module in main thread",event),B=new d}return m(B)}w||(w=e(p,{responseType:"text"}));return w.then(function(C){return new Worker(URL.createObjectURL(new Blob([C.data],
{type:"text/javascript"})))}).catch(function(C){q.warn("Failed to create Worker. Fallback to execute module in main thread",C);return new d}).then(function(C){return m(C)})}})},"esri/layers/vectorTiles/core/tsSupport/assignHelper":function(){define([],function(){return Object.assign||function(H){for(var n,t=1,l=arguments.length;t<l;t++){n=arguments[t];for(var k in n)Object.prototype.hasOwnProperty.call(n,k)&&(H[k]=n[k])}return H}})},"esri/layers/vectorTiles/config":function(){define(["require","exports",
"esri/config"],function(H,n,t){Object.defineProperty(t,"workers",{get:function(){return t.defaults.workers},set:function(l){return t.defaults.workers=l}});return t})},"esri/layers/vectorTiles/request":function(){define(["require","exports","esri/request","dojo/_base/lang","dojo/Deferred"],function(H,n,t,l,k){return function(e,c){e=l.mixin({},{url:e,failOk:!0},c);"array-buffer"===c.responseType?(e.handleAs="arraybuffer",delete e.responseType):c.responseType&&(e.handleAs=c.responseType,delete e.responseType);
null!==c.query&&(e.content=e.query,delete e.query);if(c.hasOwnProperty("allowImageDataAccess")){var a={allowImageDataAccess:c.allowImageDataAccess};delete e.allowImageDataAccess}var b=new k(function(){f.isFulfilled()||f.cancel()});var f=t(e,a).then(function(g){b.resolve({data:g})}).catch(function(g){g&&null!=g.httpCode&&(g.details=g.details||{},g.details.httpStatus=g.httpCode);b.reject(g)});return b.promise}})},"esri/layers/vectorTiles/core/sniff":function(){define(["require","exports","dojo/sniff",
"./global","../views/webgl/context-util"],function(H,n,t,l,k){function e(){var f={available:!1,version:0,majorPerformanceCaveat:!1,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1},g=document.createElement("canvas");if(!g)return f;var h=k.createContext(g,{failIfMajorPerformanceCaveat:!0},"webgl");!h&&(h=k.createContext(g,{},"webgl"))&&(f.majorPerformanceCaveat=!0);if(!h)return f;g=h.getParameter(h.VERSION);if(!g)return f;if(g=
g.match(/^WebGL\s+([\d.]*)/))f.version=parseFloat(g[1]),f.available=.94<=f.version,g=h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.HIGH_FLOAT),f.supportsHighPrecisionFragment=g&&0<g.precision,f.supportsVertexShaderSamplers=0<h.getParameter(h.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f.supportsElementIndexUint=null!==h.getExtension("OES_element_index_uint"),f.supportsStandardDerivatives=null!==h.getExtension("OES_standard_derivatives");return f}function c(){var f={available:!1,version:0},g=document.createElement("canvas");
if(!g)return f;g=k.createContext(g,{},"webgl2");if(!g)return f;f.available=!0;g=g.getParameter(g.VERSION);if(!g)return f;if(g=g.match(/^WebGL\s+([\d.]*)/))f.version=parseFloat(g[1]);return f}(function(){var f=navigator.userAgent,g=f.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i);f=f.match(/iPhone/i);g&&t.add("esri-mobile",g);f&&t.add("esri-iPhone",f);t.add("esri-phonegap",!!l.cordova);t.add("esri-cors",t("esri-phonegap")||"XMLHttpRequest"in l&&"withCredentials"in new XMLHttpRequest);
t.add("esri-geolocation",function(){return!!navigator.geolocation});t.add("esri-canvas-svg-support",function(){return!(t("trident")||t("ie"))});t.add("esri-secure-context",function(){if("isSecureContext"in l)return l.isSecureContext;if(l.location&&l.location.origin)return 0===l.location.origin.indexOf("https:")});t.add("esri-wasm","WebAssembly"in l);t("host-webworker")||(t.add("esri-workers","Worker"in l),t.add("esri-script-sandbox",function(){return"MessageChannel"in l&&"HTMLIFrameElement"in l&&
"sandbox"in HTMLIFrameElement.prototype}),t.add("esri-url-encodes-apostrophe",function(){var h=l.document.createElement("a");h.href="?'";return-1<h.href.indexOf("?%27")}),a||(a=e()),t.add("esri-webgl",a.available),t.add("esri-webgl-high-precision-fragment",a.supportsHighPrecisionFragment),t.add("esri-webgl-vertex-shader-samplers",a.supportsVertexShaderSamplers),t.add("esri-webgl-element-index-uint",a.supportsElementIndexUint),t.add("esri-webgl-standard-derivatives",a.supportsStandardDerivatives),
t.add("esri-webgl-major-performance-caveat",a.majorPerformanceCaveat),t.add("esri-featurelayer-webgl-labeling",!0),b||(b=c()),t.add("esri-webgl2",b.available))})();var a=null,b=null;return t})},"esri/layers/vectorTiles/core/global":function(){define(["require","exports"],function(H,n){return function(){if("undefined"!==typeof global)return global;if("undefined"!==typeof window)return window;if("undefined"!==typeof self)return self}()})},"esri/layers/vectorTiles/views/webgl/context-util":function(){define(["require",
"exports"],function(H,n){function t(c,a,b){void 0===a&&(a={});switch(b){case "webgl":var f=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case "webgl2":f=["webgl2"];break;default:f=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}b=null;for(var g=0;g<f.length;g++){var h=f[g];try{b=c.getContext(h,a)}catch(d){}if(b)break}return b}function l(c,a){(c=c.parentNode)&&(c.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
a+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}Object.defineProperty(n,"__esModule",{value:!0});n.createContextOrErrorHTML=function(c,a,b){void 0===a&&(a={});if(!window.WebGLRenderingContext)return l(c,k),null;a=t(c,a,b);return a?a:(l(c,e),null)};n.createContext=t;var k='This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e',e='It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'})},
"esri/layers/vectorTiles/core/urlUtils":function(){define(["require","exports","esri/urlUtils","dojo/_base/url"],function(H,n,t,l){function k(x){return t.normalize(x)}function e(x){return"data:"===x.slice(0,5)}function c(x){return a(x)||w.test(x)}function a(x){return x&&"/"===x[0]&&"/"===x[1]}function b(x){return t.urlToObject(x)}function f(x){if("string"===typeof x)return new l(h(x));x.scheme||(x.scheme=n.appUrl.scheme);return x}function g(x){if(e(x))return null;var E=x.indexOf("://");if(-1===E&&
a(x))E=2;else if(-1!==E)E+=3;else return null;E=x.indexOf("/",E);return-1===E?x:x.slice(0,E)}function h(x,E,B){void 0===E&&(E=n.appBaseUrl);if(a(x))return B&&B.preserveProtocolRelative?x:"http"===n.appUrl.scheme&&n.appUrl.authority===g(x).slice(2)?"http:"+x:"https:"+x;if(w.test(x))return x;"/"===x[0]&&(B=E.indexOf("//"),B=E.indexOf("/",B+2),E=-1===B?E:E.slice(0,B));return m(E,x)}function d(x,E,B){void 0===B&&(B=!1);x=f(x);E=f(E);return B||x.scheme===E.scheme?x.host.toLowerCase()===E.host.toLowerCase()&&
x.port===E.port:!1}function m(){for(var x=[],E=0;E<arguments.length;E++)x[E]=arguments[E];if(x&&x.length){E=[];if(c(x[0])){var B=x[0],C=B.indexOf("//");E.push(B.slice(0,C+1));q.test(x[0])&&(E[0]+="/");x[0]=B.slice(C+2)}else"/"===x[0][0]&&E.push("");x=x.reduce(function(G,I){return I?G.concat(I.split("/")):G},[]);for(B=0;B<x.length;B++)C=x[B],".."===C&&0<E.length?E.pop():!C||"."===C&&0!==E.length||E.push(C);return E.join("/")}}function p(x,E,B){if(!(E&&B&&x&&c(x)))return x;var C=x.indexOf("//"),G=x.indexOf("/",
C+2),I=x.indexOf(":",C+2);G=Math.min(0>G?x.length:G,0>I?x.length:I);if(x.slice(C+2,G).toLowerCase()!==E.toLowerCase())return x;E=x.slice(0,C+2);x=x.slice(G);return""+E+B+x}function v(x,E,B){void 0===E&&(E=n.appBaseUrl);if(!c(x))return x;var C=k(x),G=C.toLowerCase();E=k(E).toLowerCase().replace(/\/+$/,"");if((B=B?k(B).toLowerCase().replace(/\/+$/,""):null)&&0!==E.indexOf(B))return x;for(var I=function(u,A,J){J=u.indexOf(A,J);return-1===J?u.length:J},D=I(G,"/",G.indexOf("//")+2),r=-1;G.slice(0,D+1)===
E.slice(0,D)+"/";){r=D+1;if(D===G.length)break;D=I(G,"/",D+1)}if(-1===r||B&&r<B.length)return x;x=C.slice(r);C=E.slice(r-1).replace(/[^/]+/g,"").length;if(0<C)for(G=0;G<C;G++)x="../"+x;else x="./"+x;return x}Object.defineProperty(n,"__esModule",{value:!0});n.normalize=k;n.canUseXhr=function(x){return t.canUseXhr(x)};n.removeTrailingSlash=function(x){return x.replace(/\/+$/,"")};H=Function("return this")();n.appUrl=new l(H.location);n.appBaseUrl=function(){var x=n.appUrl.path;x=x.substring(0,x.lastIndexOf(x.split("/")[x.split("/").length-
1]));return n.appUrl.scheme+"://"+n.appUrl.host+(null!=n.appUrl.port?":"+n.appUrl.port:"")+x}();var q=/^\s*file:/i,w=/^\s*[a-z][a-z0-9-+.]*:[^0-9]/i;n.isDataProtocol=e;n.isAbsolute=c;n.isProtocolRelative=a;n.urlToObject=b;n.getOrigin=g;n.makeAbsolute=h;n.hasSameOrigin=d;n.join=m;n.removeFile=function(x){var E=0;if(c(x)){var B=x.indexOf("//");-1!==B&&(E=B+2)}B=x.lastIndexOf("/");return B<E?x:x.slice(0,B+1)};n.addProxy=function(x){return t.addProxy(x)};n.makeData=function(x){return x.isBase64?"data:"+
x.mediaType+";base64,"+x.data:"data:"+x.mediaType+","+x.data};var y=/^data:(.*?)(;base64)?,(.*)$/;n.dataComponents=function(x){return(x=x.match(y))?{mediaType:x[1],isBase64:!!x[2],data:x[3]}:null};n.changeDomain=p;n.read=function(x,E){var B=E&&E.url&&E.url.path;x&&B&&(x=h(x,B,{preserveProtocolRelative:!0}));(E=E&&E.portal)&&!E.isPortal&&E.urlKey&&E.customBaseUrl?(B=E.urlKey+"."+E.customBaseUrl,E=d(n.appUrl,n.appUrl.scheme+"://"+B)?p(x,E.portalHostname,B):p(x,B,E.portalHostname)):E=x;return E};n.write=
function(x,E){if(!x)return x;!c(x)&&E&&E.blockedRelativeUrls&&E.blockedRelativeUrls.push(x);var B=h(x);if(E){var C=E.verifyItemRelativeUrls&&E.verifyItemRelativeUrls.rootPath||E.url&&E.url.path;C&&(B=v(B,C,C),B!==x&&E.verifyItemRelativeUrls&&E.verifyItemRelativeUrls.writtenUrls.push(B))}x=B;B=(E=E&&E.portal)&&!E.isPortal&&E.urlKey&&E.customBaseUrl?p(x,E.urlKey+"."+E.customBaseUrl,E.portalHostname):x;return B};n.makeRelative=v;n.removeQueryParameters=function(x){x=b(x);Object.keys(x.query||{});return x.path}})},
"esri/layers/vectorTiles/core/workers/loaderConfig":function(){define(["require","exports","../tsSupport/assignHelper","dojo/has","../urlUtils"],function(H,n,t,l,k){Object.defineProperty(n,"__esModule",{value:!0});n.DEFAULT_LOADER_URL=k.makeAbsolute(k.removeQueryParameters(H.toUrl("./worker-init.js")));n.DEFAULT_CONFIG={baseUrl:function(){var e=k.removeQueryParameters(H.toUrl("dojo/x.js"));return k.makeAbsolute(e.slice(0,e.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},{name:"dstore"},
{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}};n.default=
function(e){var c={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:t({},e.has),map:t({},e.map),packages:e.packages&&e.packages.concat()||[],paths:t({},e.paths)};e.hasOwnProperty("async")||(c.async=!0);e.hasOwnProperty("isDebug")||(c.isDebug=!1);e.baseUrl||(c.baseUrl=n.DEFAULT_CONFIG.baseUrl);n.DEFAULT_CONFIG.packages.forEach(function(g){a:{for(var h=c.packages,d=0;d<h.length;d++)if(h[d].name===g.name)break a;g=t({},g);d=k.removeQueryParameters(H.toUrl(g.name+"/x.js"));d=d.slice(0,
d.length-5);g.location=k.makeAbsolute(d);h.push(g)}});e=c.map=c.map||{};for(var a=0,b=Object.keys(n.DEFAULT_CONFIG.map);a<b.length;a++){var f=b[a];e[f]||(e[f]=n.DEFAULT_CONFIG.map[f])}return c}})},"esri/layers/vectorTiles/core/workers/WorkerFallback":function(){define(["require","exports","dojo/has","../global","./utils"],function(H,n,t,l,k){var e=function(){return function(){var b=this,f=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(g){b[g]=
function(){for(var h=[],d=0;d<arguments.length;d++)h[d]=arguments[d];return f[g].apply(f,h)}})}}(),c=l.MutationObserver||l.WebKitMutationObserver,a=function(){if(l.process&&l.process.nextTick)var b=function(h){l.process.nextTick(h)};else if(l.Promise)b=function(h){l.Promise.resolve().then(h)};else if(c){var f=[],g=document.createElement("div");(new c(function(){for(;0<f.length;)f.shift()()})).observe(g,{attributes:!0});b=function(h){f.push(h);g.setAttribute("queueStatus","1")}}return b}();return function(){function b(){this._dispatcher=
new e;this._isInitialized=!1;this._workerPostMessage({type:k.MessageType.HANDSHAKE})}b.prototype.terminate=function(){};Object.defineProperty(b.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(f){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=f)&&this.addEventListener("message",f)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(f){this._onerrorHandler&&
this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=f)&&this.addEventListener("error",f)},enumerable:!0,configurable:!0});b.prototype.postMessage=function(f,g){var h=this;a(function(){h._workerMessageHandler(new MessageEvent("message",{data:f}))})};b.prototype.dispatchEvent=function(f){return this._dispatcher.dispatchEvent(f)};b.prototype.addEventListener=function(f,g,h){this._dispatcher.addEventListener(f,g,h)};b.prototype.removeEventListener=function(f,g,h){this._dispatcher.removeEventListener(f,
g,h)};b.prototype._workerPostMessage=function(f,g){var h=this;a(function(){h.dispatchEvent(new MessageEvent("message",{data:f}))})};b.prototype._workerMessageHandler=function(f){var g=this;if(f=k.receiveMessage(f)){var h=f.jobId;switch(f.type){case k.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:k.MessageType.CONFIGURED});break;case k.MessageType.OPEN:f=f.modulePath,t("esri-webpack")?H(["esri/core/workers/RemoteClient","esri/views/vectorTiles/WorkerTileHandler","esri/views/2d/layers/features/Pipeline",
"esri/views/3d/layers/PointCloudWorker","esri/views/3d/layers/SceneLayerWorker","esri/layers/graphics/sources/support/CSVSourceWorker","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker",f],function(d,m,p,v,q,w,y,x){switch(x){case "esri/views/vectorTiles/WorkerTileHandler":break;case "esri/views/2d/layers/features/Pipeline":m=p;break;case "esri/views/3d/layers/PointCloudWorker":m=v;break;case "esri/views/3d/layers/SceneLayerWorker":m=q;break;case "esri/layers/graphics/sources/support/CSVSourceWorker":m=
w;break;case "esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":m=y;break;default:m=x}d=d.connect(m);g._workerPostMessage({type:k.MessageType.OPENED,jobId:h,data:d})}):H(["./RemoteClient",f],function(d,m){d=d.connect(m);g._workerPostMessage({type:k.MessageType.OPENED,jobId:h,data:d})})}}};return b}()})},"esri/layers/vectorTiles/core/requireUtils":function(){define(["require","exports","dojo/Deferred"],function(H,n,t){function l(k,e){if(Array.isArray(e)){var c=new t;k(e,function(){for(var a=
[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.resolve(a)});return c.promise}return l(k,[e]).then(function(a){return a[0]})}Object.defineProperty(n,"__esModule",{value:!0});n.when=l;n.getAbsMid=function(k,e,c){return e.toAbsMid?e.toAbsMid(k):c.id.replace(/\/[^\/]*$/gi,"/")+k}})},"esri/layers/rasterLib/function/rasterFunctionHelper":function(){define(["dojo/_base/declare","dojo/_base/lang","./rasterFunctionRegistry"],function(H,n,t){return{create:function(l,k){if(l){var e=l.renderTexture,c=Object.keys(l);
if(l.read&&!k)return l;l.read&&k&&(l=l.toJson());-1<c.indexOf("name")&&c.indexOf(!1)?(l=n.mixin({},l),k=this._parseV2(l,k)):(l="esri.layers.RasterFunction"===l.declaredClass?l.toJson():n.mixin({},l),k=this._parseV1(l,k));k.branchCount=k.updateBranchStructure();k.renderTexture||(k.renderTexture=!!e);return k}},_parseV1:function(l,k){var e=l.rasterFunction,c=l.rasterFunctionArguments,a=l.renderTexture||l.rasterFunctionArguments.renderTexture||!1,b,f,g,h,d,m,p;(h=c.raster||c.Raster)&&h.rasterFunction&&
(b=this._parseV1(h,k));(h=c.raster2||c.Raster2)&&h.rasterFunction&&(f=this._parseV1(h,k));(h=c.rasters||c.Rasters)&&0<h.length&&(g=h.map(n.hitch(this,function(v){return v&&v.rasterFunction?this._parseV1(v,k):v})));(h=c.dem||c.DEM)&&(h.functionName||h.rasterFunction)&&(d=this._parseV1(h,k));(h=c.fillRaster||c.FillRaster)&&(h.functionName||h.rasterFunction)&&(m=this._parseV1(h,k));h=t.functions[e];if(!h)return console.error("Function is not currently supported: "+e),null;e=new h(c);e.variableName&&
(h=c[e.variableName])&&(h.functionName||h.rasterFunction)&&(p=this._parseV1(h,k));l.outputPixelType&&(e.pixelType=l.outputPixelType);"$$"===b?e.functionArguments.raster=k&&k.raster:null!=b?e.functionArguments.raster=b:e.functionArguments.raster||(e.functionArguments.raster=k&&k.raster);null!=f&&(e.functionArguments.raster2=f);null!=g&&(e.functionArguments.rasters=g.map(function(v){"$$"===v&&(v=k&&k.raster);return v}));null!=d&&(e.functionArguments.dem=d);null!=m&&(e.functionArguments.fillRaster=m);
null!=p&&(e.functionArguments[e.variableName]=p);e.renderTexture=a;return e},_parseV2:function(l,k){if(!l)return null;l=n.clone(l);this._bindV2Args(l,k);var e={};this._convertTov1(l,e);return this._parseV1(e,k)},_bindV2Args:function(l,k){(l||k)&&Object.keys(l).forEach(function(e){l[e]["function"]&&l[e].arguments?this._bindV2Args(l[e].arguments,k):null!=k[l[e].name]&&(l[e].value=k[l[e].name])}.bind(this))},_convertV2Types:function(l){if(!l)return null;"ArgumentArray"===l.type?l.elements&&"RasterStatistics"===
l.elements[0].type&&(l=l.elements):l instanceof Array&&0===l.length&&(l=null);return l},_convertTov1:function(l,k){if((l||k)&&l["function"]){var e=l["function"],c=l.arguments;k.rasterFunction=e.type.replace("Function","");k.outputPixelType="UNKNOWN"===e.pixelType?"Unknown":e.pixelType;k.rasterFunctionArguments={};var a;Object.keys(c).forEach(function(b){c[b]["function"]&&c[b].arguments?(k.rasterFunctionArguments[b]={},this._convertTov1(c[b],k.rasterFunctionArguments[b])):(a=c[b].value,k.rasterFunctionArguments[b]=
"object"!==typeof a||a.functionArguments?a:this._convertV2Types(a))}.bind(this))}}}})},"esri/layers/rasterLib/function/rasterFunctionRegistry":function(){define("dojo/_base/declare dojo/_base/lang ../../rasterLib/function/AspectFunction ../../rasterLib/function/BandArithmeticFunction ../../rasterLib/function/ColormapFunction ../../rasterLib/function/CompositeBandFunction ../../rasterLib/function/ContrastBrightnessFunction ../../rasterLib/function/ConvolutionFunction ../../rasterLib/function/ExtractBandFunction ../../rasterLib/function/HillshadeFunction ../../rasterLib/function/LocalFunction ../../rasterLib/function/MaskFunction ../../rasterLib/function/NDVIFunction ../../rasterLib/function/SlopeFunction ../../rasterLib/function/StretchFunction ../../rasterLib/function/RemapFunction ../../rasterLib/function/IdentityFunction ../../rasterLib/function/ResampleFunction".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q,w){return function(){function y(C){C.prototype.supportWebGL&&(E[C.prototype.functionName]=C);C.prototype.support2D&&(x[C.prototype.functionName]=C);B[C.prototype.functionName]=C}var x={},E={},B={};y(t);y(l);y(k);y(e);y(c);y(a);y(b);y(f);y(g);y(h);y(d);y(m);y(p);y(v);y(q);y(w);return{cpu:x,gpu:E,functions:B,register:y,getFunction:function(C){return B[C]},support:function(C,G){return!!("gpu"===G?E:"cpu"===G?x:B)[C]}}}()})},"esri/layers/rasterLib/function/AspectFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),
function(H,n,t,l,k,e,c,a){return H([t,c],{declaredClass:"esri.layers.rasterLib.function.AspectFunction",functionName:"Aspect",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({raster:null},b)},bind:function(){var b=this.getSourceRasterInfo();if(!b.raster)return Error("The raster input to aspect function is invalid.");this.rasterInfo=n.mixin(b.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:[{min:0,max:360}],histograms:null});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(b){this._performance.start();b=a.aspect(b.raster);this._addPerformanceMetric(this._performance.elapsed());return b},readGL:function(b){this._performance.start();this._initializeProgram({fragment:e.aspect,fragmentName:"Aspect"});var f=this._setupTextureData(b.raster),g=this.bindFrameBuffer(),h=this.gl,d=h.drawingBufferWidth;h=h.drawingBufferHeight;var m=f.extent;
this._setUniforms({u_resolution:b&&b.raster&&b.raster.pixelBlock?[1/b.raster.pixelBlock.width,1/b.raster.pixelBlock.height]:[1/d,1/h],u_cellSize:[(m.xmax-m.xmin)/d,(m.ymax-m.ymin)/h]});this._bindTexture(f.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:g.texture}}})})},"esri/layers/rasterLib/function/RasterFunctionX":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/config ../raster/RasterInfo ../../../geometry/Extent ../../PixelBlock".split(" "),
function(H,n,t,l,k,e){return H(null,{functionName:null,functionArguments:null,pixelType:"Unknown",rasterInfo:null,constructor:function(c){c&&(this.pixelType=c.outputPixelType||c.OutputPixelType||this.pixelType,this.renderTexture=c.renderTexture,this._initFunction())},mixinIgnoreCase:function(c,a){var b=Object.keys(c),f=Object.keys(a),g,h,d=b.length;for(g=0;g<f.length;g++){var m=a[f[g]];if(null!=m)for(h=0;h<d;h++)if(b[h].toLowerCase()===f[g].toLowerCase()){c[b[h]]=m;break}}return c},bind:function(c){},
setProcessingContext:function(c){if(!c)throw"cannot bind to layer without options";this.useWebGL=!!c.useWebGL;this._tileMode=!!c.tileMode;this._glSetting=c.glSetting;this._rawRasterInfo=c.rawRasterInfo;this._xformSetting=c.xformSetting||this._xformSetting;if(!this.useWebGL||this._glSetting&&this._glSetting.gl){this.gl=this.useWebGL?this._glSetting.gl:null;this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null);var a=this.functionArguments.raster,b=this.functionArguments.raster2,
f=this.functionArguments.dem,g=this.functionArguments.fillRaster,h=this.functionArguments.rasters;a&&a.functionArguments&&a.setProcessingContext(c);b&&b.functionArguments&&b.setProcessingContext(c);f&&f.functionArguments&&f.setProcessingContext(c);g&&g.functionArguments&&g.setProcessingContext(c);if(h)for(a=0;a<h.length;a++)h[a]&&h[a].functionArguments&&h[a].setProcessingContext(c);this.bind()}},updateBranchStructure:function(){var c=0,a=this.functionArguments;a.raster&&a.raster.read&&a.raster.functionArguments&&
(c+=a.raster.updateBranchStructure());a.raster2&&a.raster2.read&&a.raster2.functionArguments&&(c+=a.raster2.updateBranchStructure(),a.raster2.isBranch=!0,a.raster&&a.raster.read&&(a.raster.isBranch=!0));a.rasters&&(c=a.rasters.length,a.rasters.forEach(function(b){b.read&&b.functionArguments&&(b.isBranch=!0)}));a.dem&&a.dem.read&&a.dem.functionArguments&&(c+=a.dem.updateBranchStructure());return 1===c?0:c},read:function(c){c=this.processRasterArgument(c);return this.useWebGL?this.readGL(c):this.read2D(c)},
hasTilingEffects:function(){return!1},read2D:function(){},readGL:function(){},getSourceRasterInfo:function(){var c,a={};if(this.functionArguments.raster2)a.functionArguments.raster=this._bindRaster(this.functionArguments.raster),a.functionArguments.raster2=this._bindRaster(this.functionArguments.raster2);else if(this.functionArguments.rasters)for(a.rasters=[],c=0;c<this.functionArguments.rasters.length;c++)a.rasters[c]=this._bindRaster(this.functionArguments.rasters[c]);else a.raster=this._bindRaster(this.functionArguments.raster);
return this.sourceRasterInfo=a},processRasterArgument:function(c){var a=this.bind();if(!0!==a)throw a;var b={};if(this.functionArguments.raster2)b.raster=this._readRaster(this.functionArguments.raster,c),b.raster2=this._readRaster(this.functionArguments.raster2,c);else if(this.functionArguments.rasters)for(b.rasters=[],a=0;a<this.functionArguments.rasters.length;a++)b.rasters[a]=this._readRaster(this.functionArguments.rasters[a],c);else b.raster=this._readRaster(this.functionArguments.raster,c);return b},
toJson:function(){var c=this.functionArguments,a=c.raster,b=c.raster2;c=c.rasters;a=a?a.toJson?a.toJson():a:null;b=b?b.toJson?b.toJson():b:null;var f;c&&0<c.length&&(f=c.map(function(g){return g.toJson?g.toJson():g}));c=n.mixin({},this.functionArguments);c.raster=a;c.raster2=b;c.rasters=f;c=this._fixRasterFunctionJson(c);return{rasterFunction:this.functionName,rasterFunctionArguments:c,outputPixelType:this.pixelType}},_initFunction:function(c){},_getIntegerRange:function(c){switch(c){case "U8":var a=
[0,255];break;case "U16":a=[0,65535];break;case "U32":a=[0,4294967295];break;case "S8":a=[-128,127];break;case "S16":a=[-32768,32767];break;case "S32":a=[-2147483648,2147483647]}return a},_calculatePixelType:function(c,a){return c&&"unknown"!==c.toLowerCase()?c:a},_clonePixelData:function(c){if(null==c)return c;var a={};c.extent&&(a.extent=new k(c.extent.xmin,c.extent.ymin,c.extent.xmax,c.extent.ymax,c.extent.spatialReference));c=c.pixelBlock;if(null==c)return a;a.pixelBlock=c.clone?c.clone():e.prototype.clone(c);
return a},_readRaster:function(c,a){if(null==c||"$$"===c)var b=this._clonePixelData(a.src[Object.keys(a.src)[0]]);else c&&c.rasterInfo&&!c.functionArguments?b=this._clonePixelData(a.src[c._rasterId]):isNaN(c)?c.read&&(b=c.functionArguments?c.read(a):this._clonePixelData(a)):(b=a.src?a.src[Object.keys(a.src)[0]]:a,a=b.pixelBlock,a=new Float32Array(a.width*a.height),a.fill(parseFloat(c)),b=this._clonePixelData(b),b.pixelBlock.pixels=[a],b.isConstant=!0);return b},_bindRaster:function(c){if(c&&"$$"!==
c)isNaN(c)?c.rasterInfo?a=c.rasterInfo:c.bind&&c.bind()&&(a=c.rasterInfo):a={};else var a=this._rawRasterInfo;a&&(a=a.clone?a.clone():new l(a),a.bandCount=a.bandCount||3);return a},_getOutputBand:function(c,a){switch(c){case "U8":c=new Uint8Array(a);break;case "U16":c=new Uint16Array(a);break;case "U32":c=new Uint32Array(a);break;case "S8":c=new Int8Array(a);break;case "S16":c=new Int16Array(a);break;case "S32":c=new Int32Array(a);break;case "U32":c=new Uint32Array(a);break;case "F32":c=new Float32Array(a);
break;case "F64":c=new Float64Array(a);break;default:c=new Float32Array(a)}return c},_clampBand:function(c,a,b){if(("F64"===a||"F32"===a)&&!b)return c;var f,g=this._getIntegerRange(a),h=c.length;if(g)for(b=g[1],g=g[0],a=this._getOutputBand(a,h),f=0;f<h;f++){var d=c[f];a[f]=d>b?b:d<g?g:d}else a=c;return a},_performance:{start:function(){return this._start=self.performance&&self.performance.now()||new Date}.bind(this),elapsed:function(){return(self.performance&&self.performance.now()||new Date)-this._start}.bind(this)},
_addPerformanceMetric:function(c){t.isDebug&&(self.rasterFunctionPerformance||(self.rasterFunctionPerformance=[]),self.rasterFunctionPerformance.push(c),50<self.rasterFunctionPerformance.length&&self.rasterFunctionPerformance.shift())},_fixRasterFunctionJson:function(c){for(var a in c)c.hasOwnProperty(a)&&(null==c[a]?delete c[a]:c[a]instanceof Object&&!c[a].sourceType&&this._fixRasterFunctionJson(c[a],!0));return c}})})},"esri/layers/rasterLib/function/pixelShaders":function(){define(["dojo/_base/declare",
"dojo/_base/lang","./pixelShaderScripts"],function(H,n,t){H={shaderType:"fragment",getShader:function(l,k){var e=l.createShader(l.FRAGMENT_SHADER);l.shaderSource(e,k);l.compileShader(e);l.getShaderParameter(e,l.COMPILE_STATUS)||(e=null);return e}};n.mixin(H,t);return H})},"esri/layers/rasterLib/function/pixelShaderScripts":function(){define([],function(){return{aspect:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nfloat pi \x3d 3.141592653589793238;\nfloat dz_dx \x3d 0.0;\nfloat dz_dy \x3d 0.0;\nvec4 va, vb, vc,vd,ve,vf,vg,vh,vi;\nvec2 axy \x3d vec2(-1.0,-1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s)\n{\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t)\n{\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e1.0-u_resolution.s)\n{\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0- u_resolution.t)\n{\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0-u_resolution.s)\x3e\x3dv_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0-u_resolution.t)\x3e\x3dv_texCoord.t)\n{\nva \x3d texture2D(u_image, v_texCoord + u_resolution* axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution* bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution* cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution* dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution* vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution* fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution* gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution* hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution* ixy);\n}\ndz_dx \x3d (vc+2.0*vf+vi - va - 2.0*vd - vg).r/(8.0*u_cellSize[0]);\ndz_dy \x3d -(vg+2.0*vh+vi - va - 2.0*vb - vc).r/(8.0*u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat aspect_rad \x3d 0.0;\nif (dz_dx \x3d\x3d 0.0)\n{\nif (dz_dy \x3e 0.0)\naspect_rad \x3d 0.5 * pi;\nelse if (dz_dy \x3c 0.0)\naspect_rad \x3d 1.5 * pi;\nelse\nalpha \x3d 0.0;//undefined make it nodata\n}\nelse\n{\naspect_rad \x3d 0.5*pi + atan(dz_dy, -dz_dx);\nif (aspect_rad \x3c 0.0)\naspect_rad \x3d 2.0*pi + aspect_rad;\n}\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, alpha);\n}",
bandArithmetic:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_nir;\nuniform int u_bandId_red;\nuniform bool u_scaled;\nuniform int u_bandCount;\nuniform int u_method;\nuniform float u_constants[6];\nvec4 calculateNDVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n} else {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nvec4 calculateSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat savi_denom \x3d nir + red + u_constants[0];\nfloat savi;\nif (savi_denom \x3d\x3d 0.0) {\nsavi \x3d 0.0;\n} else {\nsavi \x3d (nir - red) / savi_denom * (1.0 + u_constants[0]);\n}\nreturn vec4(savi, savi, savi, currentPixel.a);\n}\nvec4 calculateMSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat msavi \x3d 0.5 * (2.0 * (nir + 1.0) - sqrt(pow((2.0 * nir + 1.0), 2.0) - 8.0 * (nir - red)));\nreturn vec4(msavi, msavi, msavi, currentPixel.a);\n}\nvec4 calculateTSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat s \x3d u_constants[0];\nfloat a \x3d u_constants[1];\nfloat x \x3d u_constants[2];\nfloat tsavi_denom \x3d a * nir + red - a * s + x * (1.0 + s * s);\nfloat tsavi;\nif (tsavi_denom \x3d\x3d 0.0) {\ntsavi \x3d 0.0;\n} else {\ntsavi \x3d s * (nir - s * red - a) / tsavi_denom;\n}\nreturn vec4(tsavi, tsavi, tsavi, currentPixel.a);\n}\nvec4 calculatePVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat a \x3d u_constants[0];\nfloat b \x3d u_constants[1];\nfloat pvi \x3d (nir - a * red - b) / sqrt(1.0 + a * 2.0);\nreturn vec4(pvi, pvi, pvi, currentPixel.a);\n}\nvec4 calculateGEMI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat gemi;\nif (red \x3d\x3d 1.0) {\ngemi \x3d 0.0;\n} else {\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) / (nir + red + 0.5);\nfloat gemi \x3d eta * (1.0 - 0.25*eta) - (red - 0.125) / (1.0 - red);\n}\nreturn vec4(gemi, gemi, gemi, currentPixel.a);\n}\nvec4 calculateVARI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(currentPixel.r);\nfloat green \x3d float(currentPixel.g);\nfloat blue \x3d float(currentPixel.b);\nfloat vari \x3d (green - red) /(green + red - blue);\nreturn vec4(vari, vari, vari, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 pv;\nif (u_method \x3c 4) {\nif (u_method \x3d\x3d 1) {\npv \x3d calculateNDVI();\n} else if (u_method \x3d\x3d 2) {\npv \x3d calculateSAVI();\n} else if (u_method \x3d\x3d 3) {\npv \x3d calculateTSAVI();\n} else if (u_method \x3d\x3d 4) {\npv \x3d calculateMSAVI();\n}\n} else {\nif (u_method \x3d\x3d 5) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 6) {\npv \x3d calculatePVI();\n} else if (u_method \x3d\x3d 7) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 9) {\npv \x3d calculateVARI();\n}\n}\ngl_FragColor \x3d pv;\n}",
colormap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nvec4 colorize() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat clrIndex \x3d currentPixel.r - u_indexedColormapOffset;\nvec4 result;\nif (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d colorize();\n}",
compositeBand:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 composite() {\nvec4 p0, p1, p2;\np0 \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nif (u_rasterCount \x3d\x3d 1){\nresult \x3d p0;\n}\nelse if (u_rasterCount \x3d\x3d 2){\np1 \x3d texture2D(u_image1, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,0.0,min(p0.a,p1.a));\n}\nelse if (u_rasterCount \x3d\x3d 3){\np1 \x3d texture2D(u_image1, v_texCoord);\np2 \x3d texture2D(u_image2, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,p2.r,min(min(p0.a,p1.a),p2.a));\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d composite();\n}",
constant:"precision mediump float;\nuniform vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}",contrastBrightness:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nuniform float u_scaleFactor;\nvec4 adjustContrastBrightness() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0; //binary contrast with extra mid tone at 0.5\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a); //no contrast\n}\nreturn vec4(v.r / u_scaleFactor, v.g / u_scaleFactor, v.b / u_scaleFactor, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d adjustContrastBrightness();\n}",
convolution:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform float u_kernel[25];\nuniform int u_kernelSize;\nvec4 convolve33(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nvec2 xy11 \x3d vec2(-1.0, -1.0);\nvec2 xy12 \x3d vec2(0.0, -1.0);\nvec2 xy13 \x3d vec2(1.0, -1.0);\nvec2 xy21 \x3d vec2(-1.0, 0.0);\nvec2 xy23 \x3d vec2(1.0, 0.0);\nvec2 xy31 \x3d vec2(-1.0, 1.0);\nvec2 xy32 \x3d vec2(0.0, 1.0);\nvec2 xy33 \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\nxy11[0] \x3d 1.0;\nxy21[0] \x3d 1.0;\nxy31[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\nxy11[1] \x3d 1.0;\nxy12[1] \x3d 1.0;\nxy13[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxy13[0] \x3d -1.0;\nxy23[0] \x3d -1.0;\nxy33[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nxy31[1] \x3d -1.0;\nxy32[1] \x3d -1.0;\nxy33[1] \x3d -1.0;\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * xy11) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * xy12) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * xy13) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * xy21) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(0, 0)) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * xy23) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * xy31) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * xy32) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * xy33) * u_kernel[8];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nvec4 convolve55(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nfloat xdif[5];//https://www.opengl.org/wiki/Data_Type_(GLSL) array constructor ES3.0\nfloat ydif[5];\nfloat a \x3d -2.0;\nfor (int i\x3d0; i\x3c5; i++){\nxdif[i] \x3d a;\nydif[i] \x3d a;\na++;\n}\nif (v_texCoord.s \x3c u_resolution.s *2.0) { //2 pixel\nxdif[0] \x3d 2.0;\nif (v_texCoord.s \x3c u_resolution.s) { //1 pixel\nxdif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.s \x3e 1.0 - u_resolution.s *2.0) {\nxdif[0] \x3d -2.0;\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxdif[1] \x3d -1.0;\n}\n}\nif (v_texCoord.t \x3c u_resolution.t *2.0) {\nydif[0] \x3d 2.0;\nif (v_texCoord.t \x3c u_resolution.t) {\nydif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.t \x3e 1.0 - u_resolution.t*2.0) {\nydif[0] \x3d -2.0;\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nydif[1] \x3d -1.0;\n}\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[0])) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[0])) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[0])) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[0])) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[0])) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[1])) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[1])) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[1])) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[1])) * u_kernel[8] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[1])) * u_kernel[9] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[2])) * u_kernel[10] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[2])) * u_kernel[11] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[2])) * u_kernel[12] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[2])) * u_kernel[13] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[2])) * u_kernel[14] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[3])) * u_kernel[15] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[3])) * u_kernel[16] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[3])) * u_kernel[17] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[3])) * u_kernel[18] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[3])) * u_kernel[19] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[4])) * u_kernel[20] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[4])) * u_kernel[21] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[4])) * u_kernel[22] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[4])) * u_kernel[23] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[4])) * u_kernel[24];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_kernelSize \x3d\x3d 9){\ngl_FragColor \x3d convolve33();\n}\nelse {\ngl_FragColor \x3d convolve55();\n}\n}",
extractBand:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandIDs[3];\nuniform bool u_alterBand;\nvec4 extractBand() {\nvec4 p \x3d texture2D(u_image, v_texCoord);\nif (!u_alterBand){\nreturn p;\n}\nfloat r, g, b;\nif (u_bandIDs[0] \x3d\x3d0){\nr \x3d p.r;\n}\nelse if (u_bandIDs[0] \x3d\x3d1){\nr \x3d p.g;\n}\nelse if (u_bandIDs[0] \x3d\x3d2){\nr \x3d p.b;\n}\nif (u_bandIDs[1] \x3d\x3d0){\ng \x3d p.r;\n}\nelse if (u_bandIDs[1] \x3d\x3d1){\ng \x3d p.g;\n}\nelse if (u_bandIDs[1] \x3d\x3d2){\ng \x3d p.b;\n}\nif (u_bandIDs[2] \x3d\x3d0){\nb \x3d p.r;\n}\nelse if (u_bandIDs[2] \x3d\x3d1){\nb \x3d p.g;\n}\nelse if (u_bandIDs[2] \x3d\x3d2){\nb \x3d p.b;\n}\nreturn vec4(r, g, b, p.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d extractBand();\n}",
hillshade:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform int u_slopeType;\nuniform int u_hillshadeType;\nuniform int u_lightSourceCount;\nuniform float u_sinZcosA;\nuniform float u_sinZsinA;\nuniform float u_cosZ;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform float u_xFactor;\nuniform float u_yFactor;\nuniform bool u_scaled;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform bool u_applyColorramp;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\nfloat clrIndex \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d texture2D(u_image1, vec2(clrIndex, 0.0));\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv) * alpha, alpha);\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 va, vb, vc, vd, ve, vf, vg, vh, vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_xFactor;\nfloat dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_yFactor; //flip\nfloat s2 \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinA * dzy - u_sinZcosA * dzx;\nfloat z \x3d (u_cosZ + cosDelta) / s2;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n}\nelse if (u_hillshadeType \x3d\x3d 1){\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / s2;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d u_lightSourceCount-1) break;\n}\n}\nif (u_applyColorramp) {\nvec4 result \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);\nif (u_scaled) {\nresult \x3d vec4(result.rgb * 255.0, result.a);\n}\ngl_FragColor \x3d result;\n} else {\nif (u_scaled) {\nhillshade \x3d hillshade * 255.0;\nif (hillshade\x3e 255.0) {\nhillshade \x3d 255.0;\n}\n}\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n}\n}",
identity:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandCount;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d  texture2D(u_image, v_texCoord);\ngl_FragColor \x3d vec4( currentPixel.rgb, currentPixel.a); //encode_float(currentPixel.r);\n}",
local:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 polyfill;\nvec4 localOp1() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nvec4 replaceme1;\nreturn result;\n}\nvec4 localOp2() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 result;\nvec4 replaceme2;\nreturn result;\n}\nvec4 localOp3() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 c \x3d texture2D(u_image2, v_texCoord);\nvec4 result;\nvec4 replaceme3;\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d localOp1();\n}",
local0:"precision mediump float;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_operation;\nuniform int u_constant[3];\nuniform vec4 gamma;\nfloat localOperate1(float a, float b, float c){\nfloat result;\nif (u_operation \x3d\x3d 1){\nresult \x3d a + b;\n}\nelse if (u_operation \x3d\x3d 2){\nresult \x3d a - b;\n}\nelse if (u_operation \x3d\x3d3){\nresult \x3d a * b;\n}\nelse if (u_operation \x3d\x3d4){\nresult \x3d sqrt(a);\n}\nelse if (u_operation \x3d\x3d5){\nresult \x3d pow(a, b);\n}\nelse if (u_operation \x3d\x3d6){\nresult \x3d acos(a);\n}\nelse if (u_operation \x3d\x3d7){\nresult \x3d asin(a);\n}\nelse if (u_operation \x3d\x3d8){\nresult \x3d atan(a);\n}\nelse if (u_operation \x3d\x3d9){\nresult \x3d 999.0; //atanh not available\n}\nelse if (u_operation \x3d\x3d10){\nresult \x3d abs(a);\n}\nelse if (u_operation \x3d\x3d13){\nresult \x3d 999.0; //bitwise not available\n}\nelse if (u_operation \x3d\x3d17){\nresult \x3d a !\x3d 0.0 \x26\x26 b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d18){\nresult \x3d a \x3d\x3d0.0? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d19){\nresult \x3d a !\x3d 0.0 || b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d20){\nresult \x3d a !\x3d 0.0 ^^ b !\x3d0.0; //exclusive or\n}\nelse if (u_operation \x3d\x3d21){\nresult \x3d cos(a);\n}\nelse if (u_operation \x3d\x3d23){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d24){\nresult \x3d a \x3d\x3d b ? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d25){\nresult \x3d exp(a);\n}\nelse if (u_operation \x3d\x3d26){\nresult \x3d pow(10.0, a);\n}\nelse if (u_operation \x3d\x3d27){\nresult \x3d exp2(a);\n}\nelse if (u_operation \x3d\x3d28){\nresult \x3d a \x3e b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d29){\nresult \x3d  a \x3e\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d30){\nresult \x3d floor(a); //int\n}\nelse if (u_operation \x3d\x3d31){\nresult \x3d a \x3d\x3d0? 1.0:0.0; //null pass mask\n}\nelse if (u_operation \x3d\x3d32){\nresult \x3d a; //float\n}\nelse if (u_operation \x3d\x3d33){\nresult \x3d a \x3c b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d34){\nresult \x3d a \x3c\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d35){\nresult \x3d log(a);\n}\nelse if (u_operation \x3d\x3d36){\nresult \x3d log2(a) / log2(10.0);\n}\nelse if (u_operation \x3d\x3d37){\nresult \x3d log2(a);\n}\nelse if (u_operation \x3d\x3d44){\nresult \x3d mod(a, b);\n}\nelse if (u_operation \x3d\x3d45){\nresult \x3d -a;\n}\nelse if (u_operation \x3d\x3d46){\nresult \x3d a !\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d48){\nresult \x3d ceil(a);\n}\nelse if (u_operation \x3d\x3d49){\nresult \x3d floor(a);\n}\nelse if (u_operation \x3d\x3d51){\nresult \x3d sin(a);\n}\nelse if (u_operation \x3d\x3d53){\nresult \x3d a * a;\n}\nelse if (u_operation \x3d\x3d56){\nresult \x3d tan(a);\n}\nelse if (u_operation \x3d\x3d57){\nresult \x3d 999.0; //tanh not available\n}\nelse if (u_operation \x3d\x3d59){\nresult \x3d 999.0; //acosh not available\n}\nelse if (u_operation \x3d\x3d60){\nresult \x3d 999.0; //asinh not available\n}\nelse if (u_operation \x3d\x3d61){\nresult \x3d atan(a, b);\n}\nelse if (u_operation \x3d\x3d64){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d65){\nresult \x3d floor(a/b);\n}\nelse if (u_operation \x3d\x3d76){\nresult \x3d a !\x3d0? b:c;\n}\n}\nvoid main() {\nvec4 currentPixel0 \x3d  texture2D(u_image0, v_texCoord);\nfloat graya, reda, greena, bluea;\nif (u_bandCount \x3d\x3d 1) {\ngraya \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngl_FragColor \x3d vec4(graya, graya, graya, currentPixel.a);\n}\nelse if (u_bandCount \x3d\x3d 3) {\nreda \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngreena \x3d stretchOneaue(float(currentPixel.g), u_minCutOff[1], u_maxCutOff[1], u_minOutput[1], u_maxOutput[1], u_factor[1]);\nbluea \x3d stretchOneaue(float(currentPixel.b), u_minCutOff[2], u_maxCutOff[2], u_minOutput[2], u_maxOutput[2], u_factor[2]);\ngl_FragColor \x3d vec4(reda, greena, bluea, currentPixel.a);\n}\n}",
mask:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_includedRanges[6];\nuniform bool u_includedRanges_specified;\nuniform float u_noDataValues[6];\nuniform bool u_noDataValues_specified;\nuniform int u_noDataInterpretation;\nuniform int u_bandCount;\nvec4 mask() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nvec4 processedPixel \x3d currentPixel;\nif (u_includedRanges_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n} else if (u_bandCount \x3d\x3d 3) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1] \x26\x26 currentPixel.g \x3e u_includedRanges[2] \x26\x26 currentPixel.g \x3c u_includedRanges[3] \x26\x26 currentPixel.b \x3e u_includedRanges[4] \x26\x26 currentPixel.b \x3c u_includedRanges[5])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n}\n}\nif (u_noDataValues_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (processedPixel.r \x3d\x3d u_noDataValues[0])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n} else if (u_bandCount \x3d\x3d 3) {\nif (u_noDataInterpretation \x3d\x3d1 \x26\x26 processedPixel.r \x3d\x3d u_noDataValues[0] \x26\x26 processedPixel.g \x3d\x3d u_noDataValues[1] \x26\x26 processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse if (processedPixel.r \x3d\x3d u_noDataValues[0] || processedPixel.g \x3d\x3d u_noDataValues[1] || processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n}\n}\nreturn processedPixel;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d mask();\n}",
ndvi:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_red;\nuniform int u_bandId_nir;\nuniform bool u_scaled;\nuniform int u_bandCount;\nvec4 calculateNDVI(){\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n}\nelse {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateNDVI();\n}",
remap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform float u_breaks[16];\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getRemapIndex(float pixelValue) {\nif (pixelValue \x3c u_breaks[0] || pixelValue \x3e u_breaks[15]) {\nreturn -1.0;\n}\nfor (int i \x3d 0; i \x3c 16; i++) {\nif (pixelValue \x3c u_breaks[i]) {\nreturn float(i - 1);\n}\n}\nif (pixelValue \x3d\x3d u_breaks[15]) {\nreturn 15.0;\n}\nreturn 0.0;\n}\nvec4 colorize(float pv) {\nfloat clrIndex \x3d pv - u_indexedColormapOffset;\nvec4 result;\nif (clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat remappedIndex \x3d getRemapIndex(currentPixel.r);\nif (remappedIndex \x3c 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\ngl_FragColor \x3d colorize(remappedIndex);\n}",
resample:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resamplingRatio;\nuniform int u_resamplingType;\nuniform vec2 u_anchor;\nuniform vec2 u_resolution;\nvec4 resample(){\nvec2 pos_nn, pos_ul, pos_ur, pos_ll, pos_lr, pos_offset;\nfloat weight,weight_total, weight_ul, weight_ur, weight_ll, weight_lr;\nvec4 vp;  //v_texCoord is canvas space 0-1\nvec2 originalResolution \x3d vec2(u_resolution.s*u_resamplingRatio.s, u_resolution.t*u_resamplingRatio.t);\nvec2 pos \x3d vec2(u_anchor.s+(v_texCoord.s-u_anchor.s),(u_anchor.t+(v_texCoord.t-u_anchor.t)));\nif (u_resamplingType \x3d\x3d 0)\n{//shift and scaling, y \x3d ax+b so x \x3d (y-b)/a\npos_nn \x3d vec2(floor(pos.s/originalResolution.s+0.5)*originalResolution.s,floor(pos.t/originalResolution.t+0.5)*originalResolution.t);\nif (pos_nn.s \x3c0.0 || pos_nn.s \x3e 1.0 || pos_nn.t \x3c0.0 || pos_nn.t \x3e 1.0){\nvp \x3d vec4(1.0, 0.0, 0.0, 1.0);//vec4(0.0, 1.0, 0.0, vp.a);\n}\nelse {\nvp \x3d texture2D(u_image, vec2(pos_nn.s, pos_nn.t));\n}\n}\nelse if (u_resamplingType \x3d\x3d 1)\n{//shift and scaling, 4 neighbors y \x3d ax+b so x \x3d (y-b)/a\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t);\npos_ur \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t);\npos_ll \x3d vec2(pos_ul.s, pos_ul.t+originalResolution.t);\npos_lr \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t+originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nweight_lr \x3d sqrt(pow(pos_offset.s,2.0) + pow(pos_offset.t,2.0));\nweight_ul \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(originalResolution.t- pos_offset.t,2.0));\nweight_ur \x3d sqrt(pow( pos_offset.s,2.0)+ 1.0- pow(originalResolution.t - pos_offset.t,2.0));\nweight_ll \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(pos_offset.t,2.0));\nvp \x3d (texture2D(u_image, pos_ul) * weight_ul + texture2D(u_image, pos_ur) * weight_ur + texture2D(u_image, pos_ll) * weight_ll + texture2D(u_image, pos_lr) * weight_lr)/(weight_ul+weight_ur+weight_ll+weight_lr);\n}\nelse if (u_resamplingType \x3d\x3d 2)\n{//shift and scaling, 16 neighbors\nweight_total \x3d 0.0;\nvp \x3d vec4(0.0,0.0,0.0,0.0);\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s-originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t-originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nfor (int i\x3d0; i\x3c4; i++){//row\nfor (int j\x3d0; j\x3c4; j++){//col\nweight \x3d sqrt(pow(pos_offset.s-float(j),2.0)+ pow(pos_offset.t-float(i),2.0));\nvp +\x3dtexture2D(u_image, vec2(pos_ul.s+float(i)*originalResolution.s,pos_ul.t+float(j)*originalResolution.t)) * weight;\nweight_total +\x3d weight;\n}\n}\nvp \x3d vp/weight_total;\n}\nreturn vp;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d resample();\n}",
slope:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nuniform float u_zfactor;\nuniform float u_altitude;\nuniform float u_azimuth;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nvec4 calculateSlope() {\nfloat pi \x3d 3.141592653589793238;\nfloat dzx \x3d 0.0;\nfloat dzy \x3d 0.0;\nvec4 va,  vb,  vc,  vd,  ve,  vf,  vg,  vh,  vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0 - u_resolution.s) \x3e\x3d v_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0 - u_resolution.t) \x3e\x3d v_texCoord.t) {\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\n}\ndzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r / (8.0 * u_cellSize[0]);\ndzy \x3d -(vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r / (8.0 * u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat slope \x3d atan(u_zfactor * sqrt(dzx * dzx + dzy * dzy)) * 57.2957795;\nreturn vec4(slope, slope, slope, alpha);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateSlope();\n}",
stretch:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_bandCount;\nuniform vec2 u_sourceDim;\nuniform vec2 u_targetDim;\nuniform int u_state;\nuniform bool u_minMaxTexture;\nuniform bool u_useGamma;\nuniform float u_gamma[4];\nuniform float u_gammaCorrection[4];\nuniform bool u_scaled;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nif (u_bandCount \x3d\x3d 1) {\nfloat alpha \x3d vp_ul.a * vp_ur.a * vp_ll.a * vp_lr.a;\nvec4 vp_nn \x3d texture2D(u_image, coords);\nreturn alpha \x3d\x3d 0.0 ? vp_nn : vec4(vp.rgb, alpha);\n}\nreturn vp;\n}\nvec4 findMin(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r),min(p1.g, p2.g),min(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(max(p1.r, p2.r),max(p1.g, p2.g),max(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMinMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r), max(p1.g, p2.g), 0.0, p1.a);\n}\n}\nvec4 minMax(int state) {\nvec2 pixelFract \x3d fract(v_texCoord * u_sourceDim);\nfloat xshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.s; //take left pixel if \x3e 0.5\nfloat yshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.t; //take bottom pixel if \x3e 0.5\nif (u_sourceDim.s \x3d\x3d 1.0) {\nxshift \x3d 0.0;\n}\nif (u_sourceDim.t \x3d\x3d 1.0) {\nyshift \x3d 0.0;\n}\nvec4 p1 \x3d texture2D(u_image, v_texCoord);\nvec4 p2 \x3d texture2D(u_image, v_texCoord + vec2(xshift, 0.0));\nvec4 p3 \x3d texture2D(u_image, v_texCoord + vec2(0.0, yshift));\nvec4 p4 \x3d texture2D(u_image, v_texCoord + vec2(xshift, yshift));\nvec4 pval;\nif (state \x3d\x3d 2) {\npval \x3d findMinMax(findMinMax(p1, p2), findMinMax(p3, p4));\n} else if (state \x3d\x3d 1) {\npval \x3d findMax(findMax(p1, p2), findMax(p3, p4));\n} else if (state \x3d\x3d 0) {\npval \x3d findMin(findMin(p1, p2), findMin(p3, p4));\n}\nreturn pval;\n}\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool scaled) {\nfloat stretchedVal;\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n} else if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nfloat stretchOneValueGamma(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection, bool scaled) {\nfloat stretchedVal;\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d floor(tempf * outRange * pow(relativeVal, 1.0 / gamma)) + minOutput;\n}\nelse if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_state \x3d\x3d 100) {\nvec4 currentPixel \x3d getPixelValue(v_texCoord);\nfloat grayVal,\nredVal,\ngreenVal,\nblueVal;\nfloat min0,\nmax0,\nmin1,\nmax1,\nmin2,\nmax2,\nfactor0,\nfactor1,\nfactor2;\nvec4 minV, maxV;\nif (u_minMaxTexture) {\nif (u_bandCount \x3d\x3d 1) {\nminV \x3d texture2D(u_image1, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d minV.g;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\n} else {\nminV \x3d texture2D(u_image1, v_texCoord);\nmaxV \x3d texture2D(u_image2, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d maxV.r;\nmin1 \x3d minV.g;\nmax1 \x3d maxV.g;\nmin2 \x3d minV.b;\nmax2 \x3d maxV.b;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\nfactor1 \x3d (u_maxOutput[1] - u_minOutput[1]) / (max1 - min1);\nfactor2 \x3d (u_maxOutput[2] - u_minOutput[2]) / (max2 - min2);\n}\n} else {\nmin0 \x3d u_minCutOff[0];\nmax0 \x3d u_maxCutOff[0];\nmin1 \x3d u_minCutOff[1];\nmax1 \x3d u_maxCutOff[1];\nmin2 \x3d u_minCutOff[2];\nmax2 \x3d u_maxCutOff[2];\nfactor0 \x3d u_factor[0];\nfactor1 \x3d u_factor[1];\nfactor2 \x3d u_factor[2];\n}\nif (u_useGamma){\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngreenVal \x3d stretchOneValueGamma(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_gamma[1], u_gammaCorrection[1], u_scaled);\nblueVal \x3d stretchOneValueGamma(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_gamma[1], u_gammaCorrection[2], u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\nelse {\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngreenVal \x3d stretchOneValue(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_scaled);\nblueVal \x3d stretchOneValue(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\n} else {\nvec4 currentPixel \x3d minMax(u_state);\ngl_FragColor \x3d currentPixel;\n}\n}"}})},
"esri/layers/rasterLib/function/RasterFunctionWebGLMixin":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ./pixelShaders ./vertexShaders ./webglHelper ./convolutionKernel".split(" "),function(H,n,t,l,k,e,c){return H(null,{gl:null,rgbaFloatData:null,originalTexture:null,lastTexture:null,renderTexture:!1,constructor:function(a){this._isProgramInitialized=!1;this.gl=a&&a.gl;a&&a.renderTexture&&(this.renderTexture=a.renderTexture);this._xformSetting=a&&a._xformSetting||{requireProjection:!1,
meshSize:[20,20]}},bindFrameBuffer:function(){var a=this.gl;this._setupPingPongTextures();this._setupBranchingTextures();var b=this._glSetting;this.isBranch?(b.branchIndex=(b.branchIndex+1)%b.branchCount,b=b.branches[b.branchIndex]):(b.pingpongIndex=(b.pingpongIndex+1)%b.pingpong.length,b=b.pingpong[b.pingpongIndex]);a.bindFramebuffer(a.FRAMEBUFFER,b.frameBuffer);a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight);return b},_initializeProgram:function(a){if(this.gl)try{var b=this.gl;b.viewport(0,
0,b.drawingBufferWidth,b.drawingBufferHeight);var f=this._glSetting.programUniforms,g="local"===this.functionName?"local"+this.functionArguments.operation:this.functionName,h=f[g];if(h)this._uniforms=h.uniforms,this.rasterProgram=h.program;else{var d=(this._useMesh=this._tileMode&&this._xformSetting.requireProjection)?k.mesh:k.basic,m=k.getShader(b,a.vertex||d),p=l.getShader(b,a.fragment),v=this._loadProgram(m,p),q={rasterProgram:e.getUniforms(b,v)};f[g]={uniforms:q,program:v};this.rasterProgram=
v;this._uniforms=q}b.useProgram(this.rasterProgram);var w=b.getAttribLocation(this.rasterProgram,"a_texCoord"),y=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,y);var x=e.createMesh(this._xformSetting.meshSize);b.bufferData(b.ARRAY_BUFFER,x,b.STATIC_DRAW);b.enableVertexAttribArray(w);b.vertexAttribPointer(w,2,b.FLOAT,!1,0,0);b.disable(b.DEPTH_TEST);b.blendFunc(b.SRC_ALPHA,b.ZERO);b.disable(b.BLEND);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!1);this._shaderInfo=
{fragment:a.fragmentName}}catch(E){console.error("webgl exception: "+E.message)}else console.error("WebGL is required.")},_setUniform:function(a,b,f){null!=b&&(f&&!this._uniforms[f]&&(this._uniforms[f]=e.getUniforms(this.gl,this[f])),f=f?this._uniforms[f]:this._uniforms.rasterProgram,(a=f[a]||f[a+"[0]"])&&e.setUniform(this.gl,a,b))},_setUniforms:function(a,b){var f=Object.keys(a),g,h=f.length;for(g=0;g<h;g++)this._setUniform(f[g],a[f[g]],b);this.rawInput?this._setUniform("u_flipY",!0,b):this._setUniform("u_flipY",
!1,b);this._tileMode?(this.rawInput?(a=this._xformSetting.offset,f=this._xformSetting.scale):(a=[0,0],f=[1,1]),this._setUniform("u_xformOffset",a,b),this._setUniform("u_xformScale",f,b),this._xformSetting.requireProjection&&(this.rawInput?(this._setupXformTexture(),this._setUniform("u_projection",!0,b),this._setUniform("u_transformGridSize",this._xformSetting.gridConfig.size,b),this._setUniform("u_transformSpacing",this._xformSetting.gridConfig.spacing,b),this._setUniform("u_targetImageSize",new Float32Array([this.gl.drawingBufferWidth,
this.gl.drawingBufferHeight]),b)):this._setUniform("u_projection",!1,b))):(a=[0,0],f=[1,1],this._setUniform("u_xformOffset",a,b),this._setUniform("u_xformScale",f,b));this.rawInput&&this._rawResolution&&("RSP_BilinearInterpolation"===this.interpolation||"RSP_CubicConvolution"===this.interpolation)?(this._setUniform("u_resampling",1),this._setUniform("u_rawResolution",this._rawResolution)):this._setUniform("u_resampling",0)},_setupTextureData:function(a,b){if(a.texture)return a;a.raster&&a.raster.pixelBlock&&
(a=a.raster);this.rawInput=!0;var f=b&&b.notOriginal,g=b&&b.bandIDs;b&&b.reCreate?b=!1:(b=this._tileMode?!this._xformSetting.hasNewTexture:!this._glSetting.hasNewTexture)&&this._originalBandIDs&&(b=g?this._originalBandIDs.join("")===g.join(""):!1);0<this._glSetting.branchCount&&(b=!1);if(b&&this.originalTexture)return{extent:a.extent,texture:this.originalTexture};b=this._createTexture();f||(this.originalTexture=b,this._originalBandIDs=g);f=this.gl;var h=a.pixelBlock;this._rawResolution=h?[1/a.pixelBlock.width,
1/a.pixelBlock.height]:[1/this.gl.drawingBufferWidth,1/this.gl.drawingBufferHeight];var d=0;g&&0<g.length&&h&&(d=Math.max.apply(null,g),h.pixels.length>d&&g&&(h.pixels=g.map(function(p){return h.pixels[p]}),h.statistics&&(h.statistics=g.map(function(p){return h.statistics[p]}))));g=h.width;d=h.height;f.getExtension("OES_texture_float");var m=h.getAsRGBAFloat();f.texImage2D(f.TEXTURE_2D,0,f.RGBA,g,d,0,f.RGBA,f.FLOAT,m);return{extent:a.extent,texture:b}},_setupPingPongTextures:function(){var a=this._glSetting;
if(!a||!a.pingpong){a.pingpong=[];var b=e.createBufferTexture(this.gl,!1);a.pingpong.push(b);b=e.createBufferTexture(this.gl,!1);a.pingpong.push(b);a.pingpongIndex=1}},_setupBranchingTextures:function(){var a=this._glSetting;if(!a||!a.branches){a.branches=[];var b=0,f=a.branchCount;if(0<f){for(b=0;b<f;b++){var g=e.createBufferTexture(this.gl,!1);a.branches.push(g)}a.branchIndex=f-1}}},_setupXformTexture:function(a){for(var b=this._createTexture(),f=this.gl,g=4*this._xformSetting.gridConfig.size[0],
h=this._xformSetting.gridConfig.size[1],d=new Float32Array(g*h*4),m=0,p=0;p<this._xformSetting.gridConfig.coefficients.length;p++)d[m++]=this._xformSetting.gridConfig.coefficients[p],2===p%3&&(d[m++]=1);f.getExtension("OES_texture_float");f.texImage2D(f.TEXTURE_2D,0,f.RGBA,g,h,0,f.RGBA,f.FLOAT,d);this._bindTexture(b,"u_transformGrid",a)},_createTexture:function(a){return e.createTexture(this.gl,a)},_bindTexture:function(a,b,f){b=b||"u_image";f=this._uniforms[f||"rasterProgram"];var g=this._getTextureIndex(b);
if(-1!==g){var h=this.gl;h.uniform1i(f[b].location,g);h.activeTexture(h.TEXTURE0+g);h.bindTexture(h.TEXTURE_2D,a)}},_getTextureIndex:function(a,b){b=this._uniforms[b||"rasterProgram"];if(!b||!b[a]||b[a].info.type!==this.gl.SAMPLER_2D)return-1;if("u_transformGrid"===a)return 0;a="u_image"===a?0:parseInt(a.replace("u_image",""));return this._xformSetting.requireProjection?a+1:a},_drawGL:function(a){var b=this.gl;this.renderTexture?(b.enable(b.BLEND),b.bindFramebuffer(b.FRAMEBUFFER,null)):b.disable(b.BLEND);
a||b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight);a=this._xformSetting.meshSize||[1,1];b.drawArrays(b.TRIANGLES,0,a[0]*a[1]*6);this._drawMesh()},_drawMesh:function(){if(this.renderTexture&&this._glSetting.drawMesh){this.meshProgram=this.meshProgram||this._setupMeshProgram();var a=this.gl;a.useProgram(this.meshProgram);a.bindFramebuffer(a.FRAMEBUFFER,null);var b=a.getAttribLocation(this.meshProgram,"a_texCoord"),f=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,f);f=this._xformSetting.meshSize||
[1,1];var g=e.createMesh(f,!0);a.bufferData(a.ARRAY_BUFFER,g,a.STATIC_DRAW);a.enableVertexAttribArray(b);a.vertexAttribPointer(b,2,a.FLOAT,!1,0,0);a.disable(a.DEPTH_TEST);a.blendFunc(a.ONE,a.ZERO);this._setUniforms({u_color:[0,0,1,1],u_drawMeshLines:!0},"meshProgram");a.drawArrays(a.LINES,0,f[0]*f[1]*10)}},_setupMeshProgram:function(){var a=k.getShader(this.gl,k.mesh),b=l.getShader(this.gl,l.constant);return this._loadProgram(a,b)},_loadProgram:function(a,b){return e.loadProgram(this.gl,a,b)},_getShaderScript:function(a,
b){b=document.getElementById(b);if(!b)return null;a="";for(b=b.firstChild;b;)3==b.nodeType&&(a+=b.textContent),b=b.nextSibling;return a}})})},"esri/layers/rasterLib/function/vertexShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./vertexShaderScripts"],function(H,n,t){H={shaderType:"vertex",getShader:function(l,k){var e=l.createShader(l.VERTEX_SHADER);l.shaderSource(e,k);l.compileShader(e);l.getShaderParameter(e,l.COMPILE_STATUS)||(e=null);return e}};n.mixin(H,t);return H})},"esri/layers/rasterLib/function/vertexShaderScripts":function(){define([],
function(){return{basic:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform bool u_flipY;\nvoid main() {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}",histogram:"attribute float a_pixelIndex;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nuniform vec2 u_sourceDim;\nuniform vec2 u_halfPixel;\nuniform vec4 u_bandSelection;\nuniform vec4 u_mins;\nuniform vec4 u_factors;\nuniform float u_size;\nuniform int u_bandCount;\nuniform bool u_minMaxTexture;\nvoid main() {\nfloat row \x3d a_pixelIndex/u_sourceDim.s;\nvec2 coord \x3d vec2(fract(row), floor(row)/u_sourceDim.t);\nvec4 pv \x3d texture2D(u_image, coord + u_halfPixel);\nvec4 minVal, maxVal, pvm;\nif (u_minMaxTexture){\nif (u_bandCount \x3d\x3d1){ //min \x3d red, max \x3d green\nvec4 minmax \x3d texture2D(u_image1, vec2(0.5,0.5));\nminVal \x3d vec4(minmax.r, minmax.r, minmax.r, 0.0);\nmaxVal \x3d vec4(minmax.g, minmax.g, minmax.g, 0.0);\n}\nelse if (u_bandCount \x3d\x3d3){ //min \x3d red, max \x3d green\nminVal \x3d texture2D(u_image1, vec2(0.5,0.5));\nmaxVal \x3d texture2D(u_image2, vec2(0.5,0.5));\n}\nvec4 factors \x3d u_size/(maxVal-minVal+vec4(0.0,0.0,0.0,1.0)) * u_factors;\npvm \x3d (pv - minVal) * factors;\n}\nelse {\npvm \x3d (pv - u_mins) * u_factors;\n}\nfloat histVal \x3d min(floor(pvm.r+pvm.g+pvm.b), u_size-1.0);\nhistVal \x3d pv.a \x3d\x3d 1.0? histVal: u_size;\ngl_Position \x3d vec4((histVal+0.1) / (u_size+1.0) * 2.0 - 1.0, 0.5, 0, 1);\ngl_PointSize \x3d 1.0;\n}",
mesh:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform bool u_drawMeshLines;\nuniform bool u_flipY;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nuniform vec2 u_srcImageSize;\nuniform bool u_projection;\nvec2 projectPixelLocation(vec2 coords) {\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;// + halfPixel;\n}\nvoid main() {\nif (u_projection) {\nv_texCoord \x3d projectPixelLocation(a_texCoord);\n} else {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\n}\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\nif (u_drawMeshLines){\nvec2 adjustedPos \x3d (v_texCoord - u_xformOffset) / u_xformScale;\ngl_Position \x3d vec4( adjustedPos * 2.0 - 1.0, 0.0, 1.0);\n}\nelse {\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}\n}"}})},
"esri/layers/rasterLib/function/webglHelper":function(){define([],function(){var H={getUniforms:function(n,t){var l=n.getProgramParameter(t,n.ACTIVE_UNIFORMS),k,e,c={};for(k=0;k<l;k++)(e=n.getActiveUniform(t,k))&&(c[e.name]={location:n.getUniformLocation(t,e.name),info:e});return c},setUniform:function(n,t,l){var k=t.info,e=t.location,c=k.type;if(null==l)console.log("uniform "+t.info.name+" has null or undefined value");else switch(c){case n.FLOAT:1<k.size?0===l.length?console.log("uniform "+t.info.name+
" has length 0"):n.uniform1fv(e,l):n.uniform1f(e,l);break;case n.FLOAT_VEC2:if(0===l.length){console.log("uniform "+t.info.name+" has length 0");break}n.uniform2fv(e,l);break;case n.FLOAT_VEC3:if(0===l.length){console.log("uniform "+t.info.name+" has length 0");break}n.uniform3fv(e,l);break;case n.FLOAT_VEC4:if(0===l.length){console.log("uniform "+t.info.name+" has length 0");break}n.uniform4fv(e,l);break;case n.INT:case n.BOOL:1<k.size?0===l.length?console.log("uniform "+t.info.name+" has length 0"):
n.uniform1iv(e,l):n.uniform1i(e,l);break;case n.INT_VEC2:case n.BOOL_VEC2:if(0===l.length){console.log("uniform "+t.info.name+" has length 0");break}n.uniform2iv(e,l);break;case n.INT_VEC3:case n.BOOL_VEC3:if(0===l.length){console.log("uniform "+t.info.name+" has length 0");break}n.uniform3iv(e,l);break;case n.INT_VEC4:case n.BOOL_VEC4:0===l.length?console.log("uniform "+t.info.name+" has length 0"):n.uniform4iv(e,l)}},createTexture:function(n,t){var l=n.createTexture();n.bindTexture(n.TEXTURE_2D,
l);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,t?n.LINEAR:n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t?n.LINEAR:n.NEAREST);return l},createBufferTexture:function(n,t,l){t=H.createTexture(n,t);n.getExtension("OES_texture_float");l=l||[n.drawingBufferWidth,n.drawingBufferHeight];n.texImage2D(n.TEXTURE_2D,0,n.RGBA,l[0],l[1],0,n.RGBA,n.FLOAT,null);l=n.createFramebuffer();
n.bindFramebuffer(n.FRAMEBUFFER,l);n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);return{texture:t,frameBuffer:l}},getShader:function(n,t,l){l=l?n.createShader(n.VERTEX_SHADER):n.createShader(n.FRAGMENT_SHADER);n.shaderSource(l,t);n.compileShader(l);n.getShaderParameter(l,n.COMPILE_STATUS)||(console.log(n.getShaderInfoLog(l)),l=null);return l},loadProgram:function(n,t,l){var k=n.createProgram();n.attachShader(k,t);n.attachShader(k,l);n.linkProgram(k);n.getProgramParameter(k,
n.LINK_STATUS)||(console.warn("failed to load webgl program: "+n.getProgramInfoLog(k)),n.deleteProgram(k),k=null);return k},createMesh:function(n,t){if(!n||1===n[0]&&1===n[1])return new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);var l=n&&t?new Float32Array(n[0]*n[1]*20):new Float32Array(n[0]*n[1]*12);var k=.9998/n[1],e=.9998/n[0],c,a,b=0;for(c=0;c<n[1];c++)for(a=0;a<n[0];a++){var f=1E-4+k*c;var g=1E-4+e*a;n&&!t?(l[b++]=f,l[b++]=g,l[b++]=f+k,l[b++]=g,l[b++]=f,l[b++]=g+e,l[b++]=f,l[b++]=g+e,l[b++]=f+k,
l[b++]=g,l[b++]=f+k,l[b++]=g+e):(l[b++]=f,l[b++]=g,l[b++]=f,l[b++]=g+e,l[b++]=f,l[b++]=g+e,l[b++]=f+k,l[b++]=g+e,l[b++]=f+k,l[b++]=g+e,l[b++]=f+k,l[b++]=g,l[b++]=f,l[b++]=g,l[b++]=f+k,l[b++]=g,l[b++]=f,l[b++]=g+e,l[b++]=f+k,l[b++]=g)}return l}};return H})},"esri/layers/rasterLib/function/convolutionKernel":function(){define([],function(){var H={Default:[0,0,0,0,1,0,0,0,0],LineDetectionHorizontal:[-1,-1,-1,2,2,2,-1,-1,-1],LineDetectionVertical:[-1,2,-1,-1,2,-1,-1,2,-1],LineDetectionLeftDiagonal:[2,
-1,-1,-1,2,-1,-1,-1,2],LineDetectionRightDiagonal:[-1,-1,2,-1,2,-1,2,-1,-1],GradientNorth:[-1,-2,-1,0,0,0,1,2,1],GradientWest:[-1,0,1,-2,0,2,-1,0,1],GradientEast:[1,0,-1,2,0,-2,1,0,-1],GradientSouth:[1,2,1,0,0,0,-1,-2,-1],GradientNorthEast:[0,-1,-2,1,0,-1,2,1,0],GradientNorthWest:[-2,-1,0,-1,0,1,0,1,2],SmoothArithmeticMean:[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111],Smoothing3x3:[.0625,.125,.0625,.125,.25,.125,.0625,
.125,.0625],Smoothing5x5:[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1],Sharpening3x3:[-1,-1,-1,-1,9,-1,-1,-1,-1],Sharpening5x5:[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1],Laplacian3x3:[0,-1,0,-1,4,-1,0,-1,0],Laplacian5x5:[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0],SobelHorizontal:[-1,-2,-1,0,0,0,1,2,1],SobelVertical:[-1,0,1,-2,0,2,-1,0,1],Sharpen:[0,-.25,0,-.25,2,-.25,0,-.25,0],Sharpen2:[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25],PointSpread:[-.627,
.352,-.627,.352,2.923,.352,-.627,.352,-.627],getKernel:function(n){switch(n){case 0:return H.LineDetectionHorizontal;case 1:return H.LineDetectionVertical;case 2:return H.LineDetectionLeftDiagonal;case 3:return H.LineDetectionRightDiagonal;case 4:return H.GradientNorth;case 5:return H.GradientWest;case 6:return H.GradientEast;case 7:return H.GradientSouth;case 8:return H.GradientNorthEast;case 9:return H.GradientNorthWest;case 10:return H.SmoothArithmeticMean;case 11:return H.Smoothing3x3;case 12:return H.Smoothing5x5;
case 13:return H.Sharpening3x3;case 14:return H.Sharpening5x5;case 15:return H.Laplacian3x3;case 16:return H.Laplacian5x5;case 17:return H.SobelHorizontal;case 18:return H.SobelVertical;case 19:return H.Sharpen;case 20:return H.Sharpen2;case 21:return H.PointSpread;default:return H.Default}}};return H})},"esri/layers/rasterLib/function/surfaceUtils":function(){define(["dojo/_base/lang"],function(H){return{hillshade:function(n,t){if(null!==n&&null!==n.pixelBlock&&null!==n.pixelBlock.pixels){var l=
this._clonePixelBlock(n.pixelBlock),k=t.altitude,e=t.azimuth,c=t.zFactor,a=t.psPower,b=t.psFactor,f=t.hillshadeType,g=t.slopeType,h=t.isGCS;1===f&&(c*=2);t=l.width;var d=l.height,m=l.pixels[0],p=l.mask,v=new Uint8Array(t*d);p&&v.set(p);var q=new Uint8Array(t*d),w=(n.extent.xmax-n.extent.xmin)/t,y=(n.extent.ymax-n.extent.ymin)/d,x=c/(8*w),E=c/(8*y);.001<c&&h&&(x/=111E3,E/=111E3);3===g&&(h?(x=111E3*w,E=111E3*y,x=(c+Math.pow(x,a)*b)/(8*x),E=(c+Math.pow(E,a)*b)/(8*E)):(x=(c+Math.pow(w,a)*b)/(8*w),E=(c+
Math.pow(y,a)*b)/(8*y)));h=(90-k)*Math.PI/180;k=Math.cos(h);var B=(360-e+90)*Math.PI/180;e=Math.sin(h)*Math.cos(B);h=Math.sin(h)*Math.sin(B);c=[];a=[];b=[];w=[315,270,225,360,180,0];var C=[60,60,60,60,60,90];g=[3,5,3,2,1,4];var G=g.reduce(function(z,F){return z+F});y=g.map(function(z){return z/G});if(1===f){var I=w.length;for(g=0;g<I;g++)k=C[g],e=w[g],h=(90-k)*Math.PI/180,k=Math.cos(h),B=(360-e+90)*Math.PI/180,e=Math.sin(h)*Math.cos(B),h=Math.sin(h)*Math.sin(B),c.push(k),a.push(e),b.push(h)}var D=
0;for(g=1;g<d-1;g++)for(C=g*t,w=1;w<t-1;w++)if(p&&!p[C+w])q[C+w]=0;else{B=0;if(p&&(B=p[C-t+w-1]+p[C-t+w]+p[C-t+w+1]+p[C+w-1]+p[C+w+1]+p[C+t+w-1]+p[C+t+w]+p[C+t+w+1],7>B)){q[C+w]=0;v[C+w]=0;continue}if(7===B){var r=p[C-t+w-1]?m[C-t+w-1]:m[C+w];var u=p[C-t+w]?m[C-t+w]:m[C+w];var A=p[C-t+w+1]?m[C-t+w+1]:m[C+w];B=p[C+w-1]?m[C+w-1]:m[C+w];var J=p[C+w+1]?m[C+w+1]:m[C+w];D=p[C+t+w-1]?m[C+t+w-1]:m[C+w];var O=p[C+t+w]?m[C+t+w]:m[C+w];var P=p[C+t+w+1]?m[C+t+w+1]:m[C+w]}else r=m[C-t+w-1],u=m[C-t+w],A=m[C-t+
w+1],B=m[C+w-1],J=m[C+w+1],D=m[C+t+w-1],O=m[C+t+w],P=m[C+t+w+1];B=(A+J+J+P-(r+B+B+D))*x;u=(D+O+O+P-(r+u+u+A))*E;A=Math.sqrt(1+B*B+u*u);D=0;if(0===f)O=h*u-e*B,O=255*(k+O)/A,0>O&&(O=0),D=O;else if(1===f)for(r=0;r<I;r++)O=b[r]*u-a[r]*B,O=255*(c[r]+O)/A,0>O&&(O=0),D+=O*y[r];q[C+w]=D}for(g=0;g<d;g++)q[g*t]=q[g*t+1],q[(g+1)*t-1]=q[(g+1)*t-2];for(g=1;g<t-1;g++)q[g]=q[g+t],q[g+(d-1)*t]=q[g+(d-2)*t];l.pixelType="U8";l.pixels=[q];l.statistics=[{minValue:0,maxValue:255}];p&&(l.mask=v);return{extent:n.extent,
pixelBlock:l}}},slope:function(n,t){if(null!==n&&null!==n.pixelBlock&&null!==n.pixelBlock.pixels){var l=this._clonePixelBlock(n.pixelBlock),k=t.zFactor,e=t.psPower,c=t.psFactor,a=t.slopeType,b=t.isGCS;t=l.width;var f=l.height,g=l.pixels[0],h=l.mask,d=new Uint8Array(t*f);h&&d.set(h);var m=new Float32Array(t*f),p=(n.extent.xmax-n.extent.xmin)/t,v=(n.extent.ymax-n.extent.ymin)/f,q=k/(8*p),w=k/(8*v);1E-4>Math.abs(k-1)&&b&&(q/=111E3,w/=111E3);3===a&&(b?(q=111E3*p,w=111E3*v,q=(k+Math.pow(q,e)*c)/(8*q),
w=(k+Math.pow(w,e)*c)/(8*w)):(q=(k+Math.pow(p,e)*c)/(8*p),w=(k+Math.pow(v,e)*c)/(8*v)));for(k=1;k<f-1;k++)for(c=k*t,e=1;e<t-1;e++)if(h&&!h[c+e])m[c+e]=0;else{v=0;if(h&&(v=h[c-t+e-1]+h[c-t+e]+h[c-t+e+1]+h[c+e-1]+h[c+e+1]+h[c+t+e-1]+h[c+t+e]+h[c+t+e+1],7>v)){m[c+e]=0;d[c+e]=0;continue}if(7===v){v=h[c-t+e-1]?g[c-t+e-1]:g[c+e];b=h[c-t+e]?g[c-t+e]:g[c+e];p=h[c-t+e+1]?g[c-t+e+1]:g[c+e];var y=h[c+e-1]?g[c+e-1]:g[c+e];var x=h[c+e+1]?g[c+e+1]:g[c+e];var E=h[c+t+e-1]?g[c+t+e-1]:g[c+e];var B=h[c+t+e]?g[c+t+
e]:g[c+e];var C=h[c+t+e+1]?g[c+t+e+1]:g[c+e]}else v=g[c-t+e-1],b=g[c-t+e],p=g[c-t+e+1],y=g[c+e-1],x=g[c+e+1],E=g[c+t+e-1],B=g[c+t+e],C=g[c+t+e+1];y=(p+x+x+C-(v+y+y+E))*q;v=(E+B+B+C-(v+b+b+p))*w;v=Math.sqrt(y*y+v*v);m[c+e]=1===a||3===a?57.2957795*Math.atan(v):100*v}for(k=0;k<f;k++)m[k*t]=m[k*t+1],m[(k+1)*t-1]=m[(k+1)*t-2];for(k=1;k<t-1;k++)m[k]=m[k+t],m[k+(f-1)*t]=m[k+(f-2)*t];l.pixelType="F32";l.pixels=[m];l.statistics=[{minValue:0,maxValue:255}];h&&(l.mask=d);return{extent:n.extent,pixelBlock:l}}},
aspect:function(n){if(null!==n&&null!==n.pixelBlock&&null!==n.pixelBlock.pixels){var t=this._clonePixelBlock(n.pixelBlock),l=t.width,k=t.height,e=t.pixels[0],c=t.mask,a=new Uint8Array(l*k);c&&a.set(c);var b=new Float32Array(l*k),f=1/((n.extent.xmax-n.extent.xmin)/l),g=1/((n.extent.ymax-n.extent.ymin)/k),h,d;for(h=1;h<k-1;h++){var m=h*l;for(d=1;d<l-1;d++)if(c&&!c[m+d])b[m+d]=0;else{var p=0;if(c&&(p=c[m-l+d-1]+c[m-l+d]+c[m-l+d+1]+c[m+d-1]+c[m+d+1]+c[m+l+d-1]+c[m+l+d]+c[m+l+d+1],7>p)){b[m+d]=0;a[m+d]=
0;continue}if(7===p){p=c[m-l+d-1]?e[m-l+d-1]:e[m+d];var v=c[m-l+d]?e[m-l+d]:e[m+d];var q=c[m-l+d+1]?e[m-l+d+1]:e[m+d];var w=c[m+d-1]?e[m+d-1]:e[m+d];var y=c[m+d+1]?e[m+d+1]:e[m+d];var x=c[m+l+d-1]?e[m+l+d-1]:e[m+d];var E=c[m+l+d]?e[m+l+d]:e[m+d];var B=c[m+l+d+1]?e[m+l+d+1]:e[m+d]}else p=e[m-l+d-1],v=e[m-l+d],q=e[m-l+d+1],w=e[m+d-1],y=e[m+d+1],x=e[m+l+d-1],E=e[m+l+d],B=e[m+l+d+1];w=(q+y+y+B-(p+w+w+x))*f;p=(x+E+E+B-(p+v+v+q))*g;0===w&&0===p?p=-1:(p=90-57.29578*Math.atan2(p,-w),0>p&&(p+=360),360===p?
p=0:360<p&&(p%=360));b[m+d]=p}}for(h=0;h<k;h++)b[h*l]=b[h*l+1],b[(h+1)*l-1]=b[(h+1)*l-2];for(h=1;h<l-1;h++)b[h]=b[h+l],b[h+(k-1)*l]=b[h+(k-2)*l];t.pixelType="F32";t.pixels=[b];t.statistics={minValue:0,maxValue:360};c&&(t.mask=a);return{extent:n.extent,pixelBlock:t}}},_clonePixelBlock:function(n){return n.clone?n.clone():H.clone(n)}}})},"esri/layers/rasterLib/function/BandArithmeticFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),
function(H,n,t,l,k,e,c){return H([t,e],{declaredClass:"esri.layers.rasterLib.function.BandArithmeticFunction",functionName:"BandArithmetic",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({method:1,bandIndexes:"",raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to band arithmetic function is invalid.");this.rasterInfo=n.mixin(a.raster,{bandCount:8===this.functionArguments.method?a.raster.bandCount:
1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var b=c.calculate(a.pixelBlock,{bandIndexes:this.functionArguments.bandIndexes,method:this.functionArguments.method});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(b.pixelType=this.pixelType);
return{extent:a.extent,pixelBlock:b}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:k.bandArithmetic,fragmentName:"bandArithmetic"});var b=this.functionArguments.bandIndexes.trim().split(" ").map(function(d){return parseInt(d,10)});this._infraredBandID=b[0]-1;this._visibleBandID=b[1]-1;this._alterBand=2<Math.max(this._infraredBandID,this._visibleBandID)?!0:!1;a=this._setupTextureData(a.raster,this._alterBand&&2==b.length?{bandIDs:[this._infraredBandID,this._visibleBandID,
this._infraredBandID]}:{bandIDs:[b[0]-1,b[1]-1,b[2]-1]});var f=this.bindFrameBuffer(),g=this.functionArguments.method,h=2<b.length?b.slice(2):null;this._alterBand?this._setUniforms({u_method:g,u_bandId_nir:0,u_bandId_red:1,u_constants:h}):this._setUniforms({u_method:g,u_bandId_nir:b[0]-1,u_bandId_red:b[1]-1,u_constants:h});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:f.texture}}})})},"esri/layers/rasterLib/function/rasterIndex":function(){define(["dojo/_base/lang"],
function(H){return{calculate:function(n,t){if(n&&n.pixels&&n.pixels.length){var l=t&&t.bandIndexes;t=t&&t.method;var k=l.trim().split(" ").map(function(a){return parseInt(a,10)}).filter(function(a){return null!=a});n=this._clonePixelBlock(n);var e=n.pixels,c=n.mask;switch(t){case 1:e=this._calculateNDVI(c,e[k[0]-1],e[k[1]-1]);break;case 2:e=this._calculateSAVI(c,e[k[0]-1],e[k[1]-1],k[2]);break;case 3:e=this._calculateTSAVI(c,e[k[0]-1],e[k[1]-1],k[2],k[3],k[4]);break;case 4:e=this._calculateMSAVI(c,
e[k[0]-1],e[k[1]-1]);break;case 5:e=this._calculateGEMI(c,e[k[0]-1],e[k[1]-1]);break;case 6:e=this._calculatePVI(c,e[k[0]-1],e[k[1]-1],k[2],k[3]);break;case 7:e=this._calculateGVITM(c,e[k[0]-1],e[k[1]-1],e[k[2]-1],e[k[3]-1],e[k[4]-1],e[k[5]-1]);break;case 8:e=this._calculateSultan(c,e[k[0]-1],e[k[1]-1],e[k[2]-1],e[k[3]-1],e[k[4]-1],e[k[5]-1]);break;case 9:e=this._calculateVARI(c,e[k[0]-1],e[k[1]-1],e[k[2]-1]);break;case 0:e=this._calculateUserDefined(c,e,l)}n.pixels=e;n.pixelType="F32";n.calculateStatistics();
return n}},_clonePixelBlock:function(n){return n.clone?n.clone():H.clone(n)},_parseUserDefined:function(n,t){n=n.replace(" ","");0===n.indexOf("-")&&(n="0"+n);0===n.indexOf("+")&&(n=n.slice(1,n.length));n=n.split("");var l=[],k=[],e="+-*/()".split(""),c,a="";for(c=0;c<n.length;c++){var b=n[c];e.some(function(f){return f===b})?(""!==a&&k.push(parseFloat(a)),l.push(b),a=""):"b"===b.toLowerCase()?(c++,a=b.concat(n[c]),k.push(t[parseInt(a[1],10)-1]),a=""):(a=a.concat(b),c===n.length-1&&k.push(parseFloat(a)))}return{ops:l,
nums:k}},_op:function(n,t,l,k){if(l.constructor===Number&&k.constructor===Number)return l+k;var e;if(l.constructor===Number){var c=k.length;var a=l;l=new Float32Array(c);for(e=0;e<c;e++)l[e]=a}else if(c=l.length,k.constructor===Number)for(a=k,k=new Float32Array(c),e=0;e<c;e++)k[e]=a;a=new Float32Array(c);if(null==n)if("+"===t)for(e=0;e<c;e++)a[e]=l[e]+k[e];else if("-"===t)for(e=0;e<c;e++)a[e]=l[e]-k[e];else if("*"===t)for(e=0;e<c;e++)a[e]=l[e]*k[e];else{if("/"===t)for(e=0;e<c;e++)a[e]=l[e]/k[e]}else if("+"===
t)for(e=0;e<c;e++)n[e]&&(a[e]=l[e]+k[e]);else if("-"===t)for(e=0;e<c;e++)n[e]&&(a[e]=l[e]-k[e]);else if("*"===t)for(e=0;e<c;e++)n[e]&&(a[e]=l[e]*k[e]);else if("/"===t)for(e=0;e<c;e++)n[e]&&(a[e]=l[e]/k[e]);return a},_shrinkOp:function(n,t){n.splice(t,1);var l=t=0,k=0;do{for(t=k=l=0;t<n.length;t++)if("("===n[t])l=t;else if(")"===n[t]){k=t;break}k===l+1&&n.splice(l,2)}while(k===l+1);return n},_getPriorityOpIndex:function(n,t){if(1===n.length)return{opIndex:0,numIndex:0};var l=t=0,k=0,e=-1,c=0;for(t=
0;t<n.length;t++)if("("===n[t])l=t;else if(")"===n[t]){k=t;break}var a=0===k?n:n.slice(l+1,k);for(t=0;t<a.length;t++)if("*"===a[t]||"/"===a[t]){e=t;break}if(!(-1<e))for(t=0;t<a.length;t++)if("+"===a[t]||"-"===a[t]){e=t;break}0<k&&(e+=l+1);for(t=0;t<e;t++)"("===n[t]&&c++;return{opIndex:e,numIndex:e-c}},_calculateUserDefined:function(n,t,l){t=this._parseUserDefined(l,t);l=t.ops;for(var k=t.nums,e,c,a;0<l.length&&(t=this._getPriorityOpIndex(l,k),e=l[t.opIndex],c=k[t.numIndex],a=k[t.numIndex+1],e=this._op(n,
e,c,a),1!==l.length);)l=this._shrinkOp(l,t.opIndex),k.splice(t.numIndex,2,e);return[e]},_calculateNDVI:function(n,t,l){var k=l.length,e=new Float32Array(k),c;if(null==n)for(c=0;c<k;c++){var a=l[c];var b=t[c];e[c]=(b-a)/(b+a)}else for(c=0;c<k;c++)n[c]&&(a=l[c],b=t[c],e[c]=(b-a)/(b+a));return[e]},_calculateSAVI:function(n,t,l,k){var e=l.length,c=new Float32Array(e),a;if(null==n)for(a=0;a<e;a++){var b=l[a];var f=t[a];c[a]=(f-b)/(f+b+k)*(1+k)}else for(a=0;a<e;a++)n[a]&&(b=l[a],f=t[a],c[a]=(f-b)/(f+b+
k)*(1+k));return[c]},_calculateTSAVI:function(n,t,l,k,e,c){var a=l.length,b=new Float32Array(a),f=-e*k+c*(1+k*k);if(null==n)for(c=0;c<a;c++){var g=l[c];var h=t[c];b[c]=k*(h-k*g-e)/(e*h+g+f)}else for(c=0;c<a;c++)n[c]&&(g=l[c],h=t[c],b[c]=k*(h-k*g-e)/(e*h+g+f));return[b]},_calculateMSAVI:function(n,t,l){var k=l.length,e=new Float32Array(k),c;if(null==n)for(c=0;c<k;c++){var a=l[c];var b=t[c];e[c]=.5*(2*(b+1)-Math.sqrt(Math.pow(2*b+1,2)-8*(b-a)))}else for(c=0;c<k;c++)n[c]&&(e[c]=.5*(2*(b+1)-Math.sqrt(Math.pow(2*
b+1,2)-8*(b-a))));return[e]},_calculateGEMI:function(n,t,l){var k=l.length,e=new Float32Array(k),c;if(null==n)for(c=0;c<k;c++){var a=l[c];var b=t[c];b=(2*(b*b-a*a)+1.5*b+.5*a)/(b+a+.5);e[c]=b*(1-.25*b)-(a-.125)/(1-a)}else for(c=0;c<k;c++)n[c]&&(a=l[c],b=t[c],b=(2*(b*b-a*a)+1.5*b+.5*a)/(b+a+.5),e[c]=b*(1-.25*b)-(a-.125)/(1-a));return[e]},_calculatePVI:function(n,t,l,k,e){var c=l.length,a=new Float32Array(c),b,f=Math.sqrt(1+k*k);if(null==n)for(b=0;b<c;b++){var g=l[b];var h=t[b];a[b]=(h-k*g-e)/f}else for(b=
0;b<c;b++)n[b]&&(g=l[b],h=t[b],a[b]=(h-k*g-e)/f);return[a]},_calculateGVITM:function(n,t,l,k,e,c,a){var b=t.length,f=new Float32Array(b),g;if(null==n)for(g=0;g<b;g++)f[g]=-.2848*t[g]-.2435*l[g]-.5436*k[g]+.7243*e[g]+.084*c[g]-1.18*a[g];else for(g=0;g<b;g++)n[g]&&(f[g]=-.2848*t[g]-.2435*l[g]-.5436*k[g]+.7243*e[g]+.084*c[g]-1.18*a[g]);return[f]},_calculateSultan:function(n,t,l,k,e,c,a){l=t.length;var b=new Float32Array(l),f=new Float32Array(l),g=new Float32Array(l),h;if(null==n)for(h=0;h<l;h++)b[h]=
c[h]/a[h]*100,f[h]=c[h]/t[h]*100,g[h]=k[h]/e[h]*(c[h]/e[h])*100;else for(h=0;h<l;h++)n[h]&&(b[h]=c[h]/a[h]*100,f[h]=c[h]/t[h]*100,g[h]=k[h]/e[h]*(c[h]/e[h])*100);return[b,f,g]},_calculateVARI:function(n,t,l,k){var e=t.length,c=new Float32Array(e),a;if(null==n)for(a=0;a<e;a++){var b=t[a];var f=l[a];var g=k[a];c[a]=(f-b)/(f+b-g)}else for(a=0;a<e;a++)if(n[a])for(a=0;a<e;a++)b=t[a],f=l[a],g=k[a],c[a]=(f-b)/(f+b-g);return[c]}}})},"esri/layers/rasterLib/function/ColormapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(H,n,t,l,k,e,c){return H([l,e],{declaredClass:"esri.layers.rasterLib.function.ColormapFunction",functionName:"Colormap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({colormap:null,colorRampName:null,colorRamp:null,colorMapName:null,raster:null},a);this.invert=a&&a.invert;a=a.colormap||a.Colormap;if(a){if(a.features||a[0].attributes){a=a.features||a;var b=Object.keys(a[0].attributes);var f=b.filter(function(v){return"alpha"===
v.toLowerCase()})[0];var g=b.filter(function(v){return"value"===v.toLowerCase()})[0];var h=b.filter(function(v){return"red"===v.toLowerCase()})[0];var d=b.filter(function(v){return"green"===v.toLowerCase()})[0];var m=b.filter(function(v){return"blue"===v.toLowerCase()})[0];if(!(g&&h&&d&&m))throw"invalid colormap";a=a.map(function(v){return f?[v.attributes[g],v.attributes[h],v.attributes[d],v.attributes[m],v.attributes[f]]:[v.attributes[g],v.attributes[h],v.attributes[d],v.attributes[m]]});var p=1.1>
Math.max.apply(null,a.map(function(v){return v[1]}));b=f&&1.1>Math.max.apply(null,a.map(function(v){return v[4]}));if(p)for(p=0;p<a.length;p++)a[p][1]=Math.round(255*a[p][1]),a[p][2]=Math.round(255*a[p][2]),a[p][3]=Math.round(255*a[p][3]),b&&(a[p][4]=Math.round(255*a[p][4]))}this.functionArguments.colormap=this._sortClr(a)}this._initialize()},bind:function(a){this._initialize();a=this.getSourceRasterInfo(a);if(!a.raster||"F32"===a.raster.pixelType)return Error("The raster input to colormap function is invalid. It must be integer type.");
this.rasterInfo=n.mixin(a.raster,{bandCount:3,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){return this._colorize(a.raster)},readGL:function(a){return this._colorizeGL(a.raster)},_colorize:function(a){this._performance.start();var b=c.colorize(a.pixelBlock,{indexedColormap:this._indexedColormap,indexedColormapOffset:this._indexedColormapOffset,
indexed2DColormap:this._indexed2DColormap,alphaSpecified:this._alphaSpecified});this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,pixelBlock:b}},_binarySearchClr:function(a,b){for(var f=0,g=a.length-1,h=0,d=0;f<g;)if(h=Math.floor((f+g)/2),d=a[h],d[0]<b)f=h;else if(d[0]>b)g=h;else return d.slice(1);return null},_sortClr:function(a,b){var f,g=[];for(f=0;f<a.length;f++)g.push(a[f]);for(f=0;f<g.length-1;f++){var h=g[f];for(a=f+1;a<g.length;a++)h[0]>g[a][0]&&(h=g[a],g[a]=g[f],
g[f]=h)}if(b)for(f=0;f<g.length/2;f++)h=g[f],g[g.length-1-f]=g[f],g[f]=h;return g},_invertColorRamp:function(a){if(!a)return a;var b={type:a.type};"random"===a.type?b=a:"multipart"===a.type?b.colorRamps=a.colorRamps.map(function(f){return{fromColor:f.toColor,toColor:f.fromColor}}).reverse():(b.fromColor=a.toColor,b.toColor=a.fromColor);return b},_initialize:function(){this._indexedColormapOffset=0;if(this.functionArguments.colormap){var a=c.buildIndexedColormap(this.functionArguments.colormap);this._alphaSpecified=
a&&a.alphaSpecified;this._indexedColormap=a&&a.indexedColormap;this._indexedColormapOffset=a&&a.offset;this._indexedColormap||(this._indexed2DColormap=this._getIndexed2DColormap())}else this.functionArguments.colorRamp?this._indexedColormap="multipart"===this.functionArguments.colorRamp.type?this.invert?t.createMultiPartColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):t.createMultiPartColorRamp(this.functionArguments.colorRamp):this.invert?t.createAlgorithmicColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):
t.createAlgorithmicColorRamp(this.functionArguments.colorRamp):this.functionArguments.colormapName&&"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=t.createRandomColorRamp())},_getIndexed2DColormap:function(){var a=this.functionArguments.colormap;if(!a)return null;var b=0;0>a[0][0]&&(b=a[0][0]);var f=[],g=5===a[0].length,h;for(h=0;h<a.length;h++)f[a[h][0]-b]=g?a[h].slice(1):a[h].slice(1).concat([255]);return f},_colorizeGL:function(a){this._performance.start();
this._initializeProgram({fragment:k.colormap,fragmentName:"Colormap"});var b=this._indexedColormap,f=this._indexedColormapOffset;this._clrTexture||(this._clrTexture=this._setupColormapTexture(b));var g=this._clrTexture,h=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:f,u_indexedColormapMaxIndex:b.length/4-1});this._bindTexture(g,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:h.texture}},_setupColormapTexture:function(a){var b=
this._createTexture(),f=this.gl,g=a.length/4,h=new Float32Array(a.length),d,m=this.renderTexture?255:1;for(d=0;d<a.length;d++)h[d]=a[d]/m;f.getExtension("OES_texture_float");f.texImage2D(f.TEXTURE_2D,0,f.RGBA,g,1,0,f.RGBA,f.FLOAT,h);return b}})})},"esri/renderers/colorRampGenerator":function(){define(["dojo/_base/declare","dojo/_base/lang","../renderers/colorUtils"],function(H,n,t){return{createAlgorithmicColorRamp:function(l,k){if(!l)return null;var e=l.fromColor,c=l.toColor;if(!e||!c)return null;
void 0===e.r&&3<=e.length&&(e={r:e[0],g:e[1],b:e[2]});void 0===c.r&&3<=c.length&&(c={r:c[0],g:c[1],b:c[2]});var a=l.size||256;l=l.algorithm||"cie-lab";if(1===a)var b=[e.r,e.g,e.b,255];else if(2===a)b=[e.r,e.g,e.b,255,c.r,c.g,e.b,255];else if(-1<l.toLowerCase().indexOf("hsv")){b=t.toHSV(e);c=t.toHSV(c);a=a||256;var f=0===b.s,g=0===c.s;e=b.h;l=c.h;f&&!g?e=b.h=l:g&&!f&&(l=c.h=e);f=Math.abs(l-e);180>f?l=(l-e)/(a-1):(f=360-f,l=e>l?f/(a-1):-f/(a-1));f=(c.s-b.s)/(a-1);g=(c.v-b.v)/(a-1);var h=b.s;b=b.v;var d,
m=new Uint8Array(4*a);for(d=0;d<a-1;d++){var p=t.toRGB({h:e,s:h,v:b});m[4*d]=p.r;m[4*d+1]=p.g;m[4*d+2]=p.b;m[4*d+3]=255;e+=l;h+=f;b+=g;360<e?e-=360:0>e&&(e+=360)}p=t.toRGB(c);m[4*(a-1)]=p.r;m[4*(a-1)+1]=p.g;m[4*(a-1)+2]=p.b;m[4*(a-1)+3]=255;b=m}else if(-1<l.toLowerCase().indexOf("lch")){h=t.toLCH(e);c=t.toLCH(c);a=a||256;b=(c.l-h.l)/(a-1);e=(c.c-h.c)/(a-1);l=(c.h-h.h)/(a-1);f=h.l;g=h.c;h=h.h;m=new Uint8Array(4*a);for(d=0;d<a-1;d++)p=t.toRGB({l:f,c:g,h:h}),m[4*d]=p.r,m[4*d+1]=p.g,m[4*d+2]=p.b,m[4*
d+3]=255,f+=b,g+=e,h+=l;p=t.toRGB(c);m[4*(a-1)]=p.r;m[4*(a-1)+1]=p.g;m[4*(a-1)+2]=p.b;m[4*(a-1)+3]=255;b=m}else if(-1<l.toLowerCase().indexOf("lab")){h=t.toLAB(e);c=t.toLAB(c);a=a||256;b=(c.l-h.l)/(a-1);e=(c.a-h.a)/(a-1);l=(c.b-h.b)/(a-1);f=h.l;g=h.a;h=h.b;m=new Uint8Array(4*a);for(d=0;d<a-1;d++)p=t.toRGB({l:f,a:g,b:h}),m[4*d]=p.r,m[4*d+1]=p.g,m[4*d+2]=p.b,m[4*d+3]=255,f+=b,g+=e,h+=l;p=t.toRGB(c);m[4*(a-1)]=p.r;m[4*(a-1)+1]=p.g;m[4*(a-1)+2]=p.b;m[4*(a-1)+3]=255;b=m}if(k&&!1===k.flattened)for(k=b,
b=[],c=0;c<b/4;c++)b[c]=k.slice(4*c,4*c+4);return b},createMultiPartColorRamp:function(l,k){if(!l)return null;k=k&&n.clone(k)||{flattened:!0};var e=l.colorRamps;if(!e||0===e.length)return null;var c=l.size||256;l=Math.max(Math.floor(c/e.length),1);var a=Math.max(l,c-(e.length-1)*l),b=!1!==k.flattened;k.flattened=!0;c=(e.length-1)*l+a;var f=new Uint8Array(4*c);for(c=0;c<e.length;c++){var g={fromColor:e[c].fromColor,toColor:e[c].toColor,size:c===e.length-1?a:l};f instanceof Array?f.concat(this.createAlgorithmicColorRamp(g,
k)):f.set(this.createAlgorithmicColorRamp(g,k),l*c*4)}if(!b)for(k=f,f=[],c=0;c<f/4;c++)f[c]=k.slice(4*c,4*c+4);return f},createRandomColorRamp:function(l){l=l||{};var k=l.size||256,e=!1===l.flattened;var c=e?new Uint8Array(4*k):[];for(l=0;l<k;l++)e?(c[4*l]=Math.round(255*Math.random()),c[4*l+1]=Math.round(255*Math.random()),c[4*l+2]=Math.round(255*Math.random()),c[4*l+3]=255):c[l]=[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),255];return c}}})},"esri/layers/rasterLib/function/rasterUtils":function(){define(["dojo/_base/lang"],
function(H){return{mask:function(n,t){if(n&&n.pixels&&n.pixels.length){n=this._clonePixelBlock(n);var l=t.includedRanges,k=t.noDataInterpretation;t=t.noDataValues;if(null===l&&null===t)return n;var e=n.pixels,c=n.mask,a=n.width*n.height,b=e.length,f;if(null!==t&&t.length!==b)throw"expect "+b+" elements in noDataValues";if(null!==l&&l.length!==2*b)throw"expect "+2*b+" elements in IncludeRanges";if(null==c){c=new Uint8Array(a);for(f=0;f<a;f++)c[f]=1;n.mask=c}if(0===k)for(k=0;k<b;k++){var g=e[k];var h=
null===l?null:l[2*k];var d=null===l?null:l[2*k+1];var m=null===t?null:parseFloat(t[k]);if(null===h||null===d)for(f=0;f<a;f++){if(c[f]){var p=g[f];p===m&&(c[f]=0)}}else if(null===m)for(f=0;f<a;f++)c[f]&&(p=g[f],p<h||p>d)&&(c[f]=0);else for(f=0;f<a;f++)c[f]&&(p=g[f],p<h||p>d||p===m)&&(c[f]=0)}else{var v=new Uint8Array(a);for(f=0;f<a;f++)v[f]=c[f];for(k=0;k<b;k++)if(g=e[k],h=null===l?null:l[2*k],d=null===l?null:l[2*k+1],m=null===t?null:parseFloat(t[k]),null===h||null===d)for(f=0;f<a;f++)v[f]&&(p=g[f],
p!==m&&(v=0));else if(null===m)for(f=0;f<a;f++)v[f]&&(p=g[f],p<=h&&p<=d&&(v=0));else for(f=0;f<a;f++)v[f]&&(p=g[f],p<=h&&p<=d&&p!==m&&(v=0));for(f=0;f<a;f++)c[f]&&v[f]&&(c[f]=0)}return n}},calculateStatisticsHistograms:function(n,t){n=this._clonePixelBlock(n);t=n.pixelType;var l=n.pixels,k=n.mask,e=l.length,c,a,b=[],f;for(c=0;c<e;c++){var g={min:-.5,max:255.5,size:256,counts:new Uint32Array(256)};var h=g.counts;var d=l[c];if("U8"===t)if(k)for(a=0;a<n.width*n.height;a++)k[a]&&h[d[a]]++;else for(a=
0;a<n.width*n.height;a++)h[d[a]]++;else{var m=n.statistics[c].minValue;var p=n.statistics[c].maxValue;g.min=m;g.max=p;p=(p-m)/256;var v=new Uint32Array(257);if(k)for(a=0;a<n.width*n.height;a++)k[a]&&v[Math.floor((d[a]-m)/p)]++;else for(a=0;a<n.width*n.height;a++)v[Math.floor((d[a]-m)/p)]++;for(a=0;255>a;a++)h[a]=v[a];h[255]=v[255]+v[256]}b.push(g);m=n.statistics[c].minValue;p=n.statistics[c].maxValue;for(a=v=f=d=0;a<g.size;a++)d+=h[a],f+=a*h[a];f/=d;for(a=0;a<g.size;a++)v+=h[a]*Math.pow(a-f,2);h=
Math.sqrt(v/(d-1));a=(f+.5)*(g.max-g.min)/g.size+g.min;g=h*(g.max-g.min)/g.size;n.statistics[c]={min:m,minValue:m,max:p,maxValue:p,mean:a,stddev:g}}n.histograms=b;return n},buildIndexedColormap:function(n,t){if(!n)return null;var l=0;0>n[0][0]&&(l=n[0][0]);var k=Math.max(256,n[n.length-1][0]-l);if(65536<k)return null;var e=new Uint8Array(4*k),c=[],a=0,b=5===n[0].length;if(t)for(c=n[a],t=c[0]-l;t<k;t++)e[4*t]=c[1],e[4*t+1]=c[2],e[4*t+2]=c[3],e[4*t+3]=b?c[4]:255,t===c[0]-l&&(c=a===n.length-1?c:n[++a]);
else for(t=0;t<n.length;t++)c=n[t],a=4*(c[0]-l),e[a]=c[1],e[a+1]=c[2],e[a+2]=c[3],e[a+3]=b?c[4]:255;return{indexedColormap:e,offset:l,alphaSpecified:b}},colorize:function(n,t){if(null!==n&&null!==n.pixels){n=this._clonePixelBlock(n);var l=n.pixels,k=n.width*n.height,e=n.mask,c=t.indexedColormap,a=t.indexedColormapOffset,b=c&&c.length-1,f=t.indexed2DColormap;t=t.alphaSpecified;if(3<=l.length)throw"colormap only works on single band image";var g=l[0],h=new Uint8Array(g.length),d=new Uint8Array(g.length),
m=new Uint8Array(g.length),p=0;if(c)if(e)for(l=0;l<k;l++)e[l]&&(p=4*(g[l]-a),p<a||p>b?e[l]=0:(h[l]=c[p],d[l]=c[p+1],m[l]=c[p+2],e[l]=c[p+3]));else{e=new Uint8Array(k);for(l=0;l<k;l++)p=4*(g[l]-a),p<a||p>b?e[l]=0:(h[l]=c[p],d[l]=c[p+1],m[l]=c[p+2],e[l]=c[p+3]);n.mask=e}else if(e)for(l=0;l<k;l++)e[l]&&(c=f[g[l]],h[l]=c[0],d[l]=c[1],m[l]=c[2],e[l]=c[3]);else{e=new Uint8Array(k);for(l=0;l<k;l++)c=f[g[l]],h[l]=c[0],d[l]=c[1],m[l]=c[2],e[l]=c[3];n.mask=e}n.pixels=[h,d,m];n.statistics=null;n.pixelType="U8";
n.maskIsAlpha=t;return n}},convolute:function(n,t){n=this._clonePixelBlock(n);var l=n.pixels,k=n.width,e=n.height,c=k*e,a=l.length,b,f,g,h,d=[],m=[],p=t.normalizedKernel,v=t.kernelRows,q=t.kernelCols;for(t=0;t<a;t++){var w=l[t];var y=new Float32Array(c);y.set(w);for(g=1;g<e-1;g++){var x=g*k;for(h=1;h<k-1;h++){for(b=m=0;b<v;b++)for(f=0;f<q;f++)m+=w[x+h+(b-1)*k+f-1]*p[b*q+f];y[x+h]=m}}d.push(y)}n.pixels=d;return n},contrastBrightnessStretch:function(n,t){if(null!==n&&null!==n.pixels){n=this._clonePixelBlock(n);
var l=n.pixels,k=n.mask,e=n.width*n.height,c=l.length;var a=t&&t.contrastOffset;t=t&&t.brightnessOffset;if("U8"!==n.pixelType)throw"the contrast and brightness function only supports 8 bit unsigned integer data";var b=this._createContrastBrightnessLUT(a,t);if(null==k)for(a=0;a<e;a++)for(t=0;t<c;t++)l[t][a]=b[l[t][a]];else for(a=0;a<e;a++)if(k[a])for(t=0;t<c;t++)l[t][a]=b[l[t][a]];n.pixelType="U8";return n}},isNull:function(n,t){if(null!==n&&null!==n.pixels){n=this._clonePixelBlock(n);t=n.mask;var l=
n.pixels[0],k=l.length,e;if(t){for(e=0;e<k;e++)l[e]=t[e]?0:1;n.mask=null}else if(l.fill)l.fill(0);else for(e=0;e<k;e++)l[e]=0;return n}},setNull:function(n){if(null!==t&&null!==t.pixels){var t=this._clonePixelBlock(n);n=t.mask;var l=t.pixels[0],k=l.length,e;n=n||new Uint8Array(k);for(e=0;e<k;e++)n[e]=l[e]?0:1;t.mask=n;return t}},local:function(n,t){if(!t)return n[0];var l=t.rasterCountNeeded;t=t.functor;var k=this._clonePixelBlock(n[0]);if(null!==k&&null!==k.pixels){var e=k.width*k.height,c;n=(c=
n[1])&&c.pixels[0];var a=c&&c.mask,b=k.mask,f=k.pixels[0];if(2===l)if(!b&&a)b=a;else if(b&&a)for(c=0;c<e;c++)b[c]=b[c]&&a[c]?1:0;k.mask=b;if(1===l)if(null==b)for(c=0;c<e;c++)f[c]=t(f[c]);else for(c=0;c<e;c++)b[c]&&(f[c]=t(f[c]));else if(2===l)if(null==b)for(c=0;c<e;c++)f[c]=t(f[c],n[c]);else for(c=0;c<e;c++)b[c]&&(f[c]=t(f[c],n[c]));k.mask=b;k.calculateStatistics();return k}},remapColor:function(n,t){n=this._clonePixelBlock(n);var l=n.width*n.height,k=t.length,e=Math.floor(k/2),c=t[Math.floor(e)],
a=t[0].value,b=t[t.length-1].value,f=n.pixels[0],g,h,d=!1,m=new Uint8Array(l),p=new Uint8Array(l),v=new Uint8Array(l),q=n.mask,w=4===t[0].mappedColor.length;q&&0!==q.length||(q=new Uint8Array(l),q.fill(w?255:1),n.mask=q);for(h=0;h<l;h++)if(q[h]){var y=f[h];if(y<a||y>b)m[h]=p[h]=v[h]=q[h]=0;else{d=!1;var x=e;var E=c;var B=0;for(g=k-1;1<g-B;){if(y===E.value){d=!0;break}y>E.value?B=x:g=x;x=Math.floor((B+g)/2);E=t[Math.floor(x)]}d||(E=y===t[g].value?t[g]:t[B]);m[h]=E.mappedColor[0];p[h]=E.mappedColor[1];
v[h]=E.mappedColor[2];q[h]=E.mappedColor[3]}}n.pixels=[m,p,v];n.mask=q;n.pixelType="u8";n.maskIsAlpha=w;return n},_clonePixelBlock:function(n){if(n.clone)return n.clone();var t=H.clone(n),l;if(n.pixels&&n.pixels[0]&&0<n.pixels[0].length&&!(t.pixels&&t.pixels[0]&&0<t.pixels[0].length)){t.pixels=[];var k=n.pixels.length;for(l=0;l<k;l++)t.pixels[l]=new n.pixels[l].constructor(n.pixels[l])}if(n.statistics)for(t.statistics=[],k=n.statistics.length,l=0;l<k;l++)t.statistics[l]=H.clone(n.statistics[l]);n.mask&&
(t.mask=new Uint8Array(n.mask));return t},_createContrastBrightnessLUT:function(n,t){if(this._contrastCache&&this._contrastCache.contrastOffset===n&&this._contrastCache.brightnessOffset===t)return this._contrastCache.lut;var l=Math.min(Math.max(n,-100),100),k=Math.min(Math.max(t,-100),100),e,c=new Uint8Array(256);for(e=0;256>e;e++){if(0<l&&100>l)var a=(200*e-25500+510*k)/(2*(100-l))+128;else 0>=l&&-100<l?a=(200*e-25500+510*k)*(100+l)/2E4+128:100===l?(a=200*e-25500+256*(100-l)+510*k,a=0<a?255:0):-100===
l&&(a=128);c[e]=255<a?255:0>a?0:a}this._contrastCache={contrastOffset:n,brightnessOffset:t,lut:c};return c}}})},"esri/layers/rasterLib/function/CompositeBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(H,n,t,l,k,e){return H([t,e],{declaredClass:"esri.layers.rasterLib.function.CompositeBandFunction",functionName:"CompositeBand",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=
this.mixinIgnoreCase({rasters:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.rasters)return Error("The rasters input to composite band function is invalid.");var a=[],b=[],f=c.rasters.length,g;if(c.rasters[0].statistics)for(g=0;g<f;g++)a.push(c.rasters[g].statistics[0]);if(c.rasters[0].histograms)for(g=0;g<f;g++)b.push(c.rasters[g].histograms[0]);this.rasterInfo=n.mixin(c.rasters[0],{bandCount:f,pixelType:this._calculatePixelType(this.pixelType,c.rasters[0].pixelType),statistics:a,
histograms:b});return!0},read2D:function(c){c=c.rasters;if(null!=c&&0!==c.length){var a=this._clonePixelData(c[0]),b=a.pixelBlock,f=[],g=[];for(h=0;h<c.length;h++)f.push(c[h].pixelBlock.pixels[0]),g.push(c[h].pixelBlock.statistics[0]);b.pixels=f;b.stackedStatistics=g;b.planes=c.length;var h;g=b.width*b.height;for(h=0;h<c.length;h++)if(b=c[h].pixelBlock.mask,d&&b)for(f=0;f<g;f++)d[f]&=b[f];else var d=d||b;a.maks=d;return a}},readGL:function(c){this._performance.start();this._initializeProgram({fragment:k.compositeBand,
fragmentName:"CompositeBand"});var a=c.rasters;if(null!=a&&0!==a.length){a=a.length;var b,f=this.bindFrameBuffer();for(b=0;b<a;b++){var g=this._setupTextureData(c.rasters[b],{notOriginal:0<b});var h=0<b?b.toString():"";this._bindTexture(g.texture,"u_image"+h)}this._setUniforms({u_rasterCount:a});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:g.extent,texture:f.texture}}}})})},"esri/layers/rasterLib/function/ContrastBrightnessFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(H,n,t,l,k,e,c){return H([t,e],{declaredClass:"esri.layers.rasterLib.function.ContrastBrightnessFunction",renderTexture:!0,functionName:"ContrastBrightness",supportWebGL:!0,support2D:!0,pixelType:"U8",constructor:function(a){this.functionArguments=this.mixinIgnoreCase({contrastOffset:0,brightnessOffset:0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to contrast and brightness function is invalid.");this.rasterInfo=n.mixin(a.raster,
{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){a=a.raster;if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var b=c.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.functionArguments.contrastOffset,brightnessOffset:this.functionArguments.brightnessOffset});"Unknown"!==
this.pixelType&&(b.pixelType=this.pixelType,b.pixels=b.pixels.map(n.hitch(this,function(f){return this._clampBand(f,b.pixelType)})));return{extent:a.extent,pixelBlock:b}}},readGL:function(a){return this._cbGL(a.raster)},_cbGL:function(a){this._performance.start();this._initializeProgram({fragment:k.contrastBrightness,fragmentName:"ContrastBrightness"});a=this._setupTextureData(a);this._setUniforms({u_contrastOffset:Math.min(Math.max(this.functionArguments.contrastOffset,-100),100),u_brightnessOffset:Math.min(Math.max(this.functionArguments.brightnessOffset,
-100),100),u_scaleFactor:this.renderTexture?255:1});this._bindTexture(a.texture,"u_image");var b=this.bindFrameBuffer();this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:b.texture}}})})},"esri/layers/rasterLib/function/ConvolutionFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./convolutionKernel ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(H,n,t,l,k,e,c,a){return H([t,
c],{declaredClass:"esri.layers.rasterLib.function.ConvolutionFunction",functionName:"Convolution",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({columns:3,rows:3,type:0,kernel:null,raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=n.mixin(b.raster,{bandCount:b.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,b.raster.pixelType),
statistics:b.raster.statistics,histograms:b.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(b){this._performance.start();b=b.raster;var f=this._analyzeKernel(),g=a.convolute(b.pixelBlock,{normalizedKernel:f.normalizedKernel,kernelCols:this.functionArguments.columns,kernelRows:this.functionArguments.rows});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&
(g.pixelType=this.pixelType);g.pixels=g.pixels.map(n.hitch(this,function(h){return this._clampBand(h,g.pixelType)}));return{extent:b.extent,pixelBlock:g}},readGL:function(b){this._performance.start();this._initializeProgram({fragment:e.convolution,fragmentName:"Convolution"});var f=this._setupTextureData(b.raster),g=this.bindFrameBuffer(),h=this.gl,d=h.drawingBufferWidth;h=h.drawingBufferHeight;var m=this.functionArguments.kernel;this._setUniforms({u_resolution:b&&b.raster&&b.raster.pixelBlock?[1/
b.raster.pixelBlock.width,1/b.raster.pixelBlock.height]:[1/d,1/h],u_kernel:m,u_kernelSize:m.length});this._bindTexture(f.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:g.texture}},_analyzeKernel:function(){var b=this.functionArguments.kernel,f=b.reduce(function(d,m){return d+m});0!==f&&1!==f&&(b=b.map(function(d){return d/f}));var g,h=[];for(g=0;g<b.length;g++)h.some(function(d){return d===b[g]})||h.push(b[g]);return{normalizedKernel:b,
distinctValues:h}},_analyzeKernelPattern:function(){var b=this.functionArguments.rows,f=this.functionArguments.columns,g=this.functionArguments.kernel,h=[],d,m;for(d=0;d<b;d++)h.push({weights:g.slice(d*f,(d+1)*f)});var p;for(d=1;d<b;d++){var v=h[d].weights;for(g=0;g<d;g++)if(p=h[g].weights){var q=v[0]/p[0];for(m=1;m<f;m++)v[m]/p[m]!==q&&(q=null);null!==q&&(h[d]={row:g,factor:q})}}return h}})})},"esri/layers/rasterLib/function/ExtractBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),
function(H,n,t,l,k,e){return H([t,e],{declaredClass:"esri.layers.rasterLib.function.ExtractBandFunction",functionName:"ExtractBand",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({bandIDs:[],missingBandAction:0,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to extract band function is invalid.");var a=[],b=c.raster.statistics,f=[],g=c.raster.histograms,h=this.functionArguments.bandIDs.length||
c.raster.bandCount;this.functionArguments.bandIDs.forEach(n.hitch(this,function(d){if(d>=h-1){if(1===this.functionArguments.missingBandAction)return Error("missing band "+d);d=h-1}if(0>d)return Error("missing band "+d);void 0!==b&&null!==b&&0<b.length&&a.push(b[d]);void 0!==g&&null!==g&&0<g.length&&f.push(g[d])}));this.rasterInfo=n.mixin(c.raster,{bandCount:h,pixelType:this._calculatePixelType(this.pixelType,c.raster.pixelType),statistics:a,histograms:f});return!0},read2D:function(c){c=this._clonePixelData(c.raster);
if(null!==c&&null!==c.pixelBlock&&null!==c.pixelBlock.pixels){this._performance.start();var a=c.pixelBlock,b=a.statistics,f=a.pixels,g=f.length;if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(0===this.functionArguments.bandIDs.length)return c;var h=[],d=[];this.functionArguments.bandIDs.forEach(function(m){if(m>=g-1){if(1===this.functionArguments.missingBandAction)throw"missing band "+m;m=g-1}if(0>m)throw"missing band "+m;h.push(f[m]);void 0!==b&&null!==b&&0<b.length&&
d.push(b[m])});a.pixels=h;a.statistics=d;a.planes=this.functionArguments.bandIDs.length;return c}},readGL:function(c){this._performance.start();if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(3<this.functionArguments.bandIDs.length)throw"this version does not support more than 3 bands yet";this._initializeProgram({fragment:k.extractBand,fragmentName:"ExtractBand"});var a=this.functionArguments.bandIDs;1===a.length&&(a=[a[0],a[0],a[0]]);this._bandIDs=a;this._alterBand=!(0===
this.functionArguments.bandIDs.length||0===a[0]&&1===a[1]&&2===a[2]);var b=!!(this._alterBand&&c.raster&&c.raster.texture);c=this._setupTextureData(c.raster,{bandIDs:a});var f=this.bindFrameBuffer();b?this._setUniforms({u_bandIDs:a,u_alterBand:this._alterBand}):this._setUniforms({u_bandIDs:a,u_alterBand:!1});this._bindTexture(c.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:c.extent,texture:f.texture}}})})},"esri/layers/rasterLib/function/HillshadeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../renderers/colorRampGenerator ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils ./rasterUtils".split(" "),
function(H,n,t,l,k,e,c,a,b,f){return H([t,a],{declaredClass:"esri.layers.rasterLib.function.HillshadeFunction",functionName:"Hillshade",supportWebGL:!0,support2D:!0,renderTexture:!0,constructor:function(g){this.functionArguments=this.mixinIgnoreCase({hillshadeType:0,altitude:45,azimuth:315,zFactor:1,slopeType:1,psPower:.664,psFactor:.024,colorRamp:null,raster:null},g);this._azimuths=[315,270,225,360,180,0];this._altitudes=[60,60,60,60,60,90];this._weights=[3,5,3,2,1,4];var h=this._weights.reduce(function(d,
m){return d+m});this._weights=this._weights.map(function(d){return d/h})},bind:function(g){g=this.getSourceRasterInfo(g);if(!g.raster)return Error("The raster input to hillshade function is invalid.");g.raster.statistics&&(this.srcStatistics=g.raster.statistics);this.rasterInfo=n.mixin(g.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:[{min:0,max:255}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=
"Generic";this._initializeColormap();return!0},read2D:function(g){this._performance.start();g=g.raster;g=b.hillshade(g,{altitude:this.functionArguments.altitude,azimuth:this.functionArguments.azimuth,zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,hillshadeType:this.functionArguments.hillshadeType,slopeType:this.functionArguments.slopeType,isGCS:g.extent.spatialReference.wkid&&null==k[g.extent.spatialReference.wkid]});this._addPerformanceMetric(this._performance.elapsed());
return g},readGL:function(g){this._performance.start();this._initializeProgram({fragment:c.hillshade,fragmentName:"Hillshade"});this.functionArguments.colorRamp&&this._indexedColormap&&!this._clrTexture&&(this._clrTexture=this._setupColormapTexture(this._indexedColormap));var h=this._setupTextureData(g.raster),d=this.bindFrameBuffer(),m=this.gl,p=m.drawingBufferWidth;m=m.drawingBufferHeight;var v=h.extent,q=(v.xmax-v.xmin)/p,w=(v.ymax-v.ymin)/m,y=this.functionArguments.altitude,x=this.functionArguments.azimuth,
E=this.functionArguments.zFactor;1===this.functionArguments.hillshadeType&&(E*=2);var B=E/(8*q),C=E/(8*w);.001<E&&v.spatialReference.wkid&&null==k[v.spatialReference.wkid]&&(B/=111E3,C/=111E3);var G=this.functionArguments.psPower,I=this.functionArguments.psFactor;3===this.functionArguments.slopeType&&((B=v.spatialReference.wkid&&null==k[v.spatialReference.wkid])?(B=111E3*q,C=111E3*w,B=(E+Math.pow(B,G)*I)/(8*B),C=(E+Math.pow(C,G)*I)/(8*C)):(B=(E+Math.pow(q,G)*I)/(8*q),C=(E+Math.pow(w,G)*I)/(8*w)));
var D=(90-y)*Math.PI/180;y=Math.cos(D);var r=(360-x+90)*Math.PI/180;x=Math.sin(D)*Math.cos(r);D=Math.sin(D)*Math.sin(r);G=Array(6);I=Array(6);v=Array(6);var u=this._weights,A;if(1===this.functionArguments.hillshadeType){var J=this._azimuths.length;for(A=0;A<J;A++)y=this._altitudes[A],x=this._azimuths[A],D=(90-y)*Math.PI/180,y=Math.cos(D),r=(360-x+90)*Math.PI/180,x=Math.sin(D)*Math.cos(r),D=Math.sin(D)*Math.sin(r),G[A]=y,I[A]=x,v[A]=D}else G[0]=y,I[0]=x,v[0]=D;G=G.map(function(O){return parseFloat(O)});
I=I.map(function(O){return parseFloat(O)});v=v.map(function(O){return parseFloat(O)});this._setUniforms({u_cellSize:[q,w],u_zfactor:E,u_xFactor:B,u_yFactor:C,u_sinZcosA:x,u_sinZsinA:D,u_cosZ:y,u_sinZcosAs:I,u_sinZsinAs:v,u_cosZs:G,u_weights:u,u_hillshadeType:this.functionArguments.hillshadeType,u_resolution:g&&g.raster&&g.raster.pixelBlock?[1/g.raster.pixelBlock.width,1/g.raster.pixelBlock.height]:[1/p,1/m],u_scaled:!this.renderTexture,u_applyColorramp:this._clrTexture?!0:!1,u_minValue:this.srcStatistics[0].min,
u_maxValue:this.srcStatistics[0].max,u_indexedColormapOffset:this._indexedColormapOffset||0,u_indexedColormapMaxIndex:this._indexedColormap?this._indexedColormap.length/4-1:0});this._clrTexture&&this._bindTexture(this._clrTexture,"u_image1");this._bindTexture(h.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:h.extent,texture:d.texture}},_initializeColormap:function(){this._indexedColormapOffset=0;var g=this._indexedColormap,h=this.functionArguments.colorRamp;
this.functionArguments.colormap?(this._alphaSpecified=(h=f.buildIndexedColormap(this.functionArguments.colormap))&&h.alphaSpecified,this._indexedColormap=h&&h.indexedColormap,this._indexedColormapOffset=h&&h.offset):h?(this._indexedColormap="multipart"===h.type?this.invert?l.createMultiPartColorRamp(this._invertColorRamp(h)):l.createMultiPartColorRamp(h):this.invert?l.createAlgorithmicColorRamp(this._invertColorRamp(h)):l.createAlgorithmicColorRamp(h),h.fromColor&&h.toColor&&"000"===h.fromColor.slice(0,
3).join("")&&"255255255"===h.toColor.slice(0,3).join("")&&(this._clrTexture=this._indexedColormap=null)):this.functionArguments.colormapName?"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=l.createRandomColorRamp()):this._clrTexture=this._indexedColormap=null;if(g&&this._indexedColormap){h=!0;for(var d=0;d<g.length;d++)if(g[d]!==this._indexedColormap[d]){h=!1;break}h||(this._clrTexture=null)}},_setupColormapTexture:function(g){var h=this._createTexture(),d=this.gl,
m=g.length/4,p=new Float32Array(g.length),v;for(v=0;v<g.length;v++)p[v]=g[v]/255;d.getExtension("OES_texture_float");d.texImage2D(d.TEXTURE_2D,0,d.RGBA,m,1,0,d.RGBA,d.FLOAT,p);return h}})})},"esri/layers/rasterLib/function/LocalFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(H,n,t,l,k,e,c){return H([t,e],{declaredClass:"esri.layers.rasterLib.function.LocalFunction",functionName:"Local",
supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({operation:null,rasters:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);var b=0;a.raster?b=a.raster.bandCount:a.rasters&&(b=Math.max.apply(null,a.rasters.map(function(f){return f.bandCount})));if(0===b)return Error("The raster input to local function is invalid. It only takes single band input.");a=a.raster||a.rasters.filter(function(f){return!!f.extent})[0];this.rasterInfo=n.mixin(a,{bandCount:1,
pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){var b=[];b=a.raster?a.raster2?[a.raster,a.raster2]:[a.raster]:a.rasters;a=b.map(function(m){return m.pixelBlock});var f=this.functionArguments.operation;if(null===f)return b[0];this._performance.start();var g=this._getOperations(),h=g.operators[f-1];g=g.functors[f-1];
if(!this.functionArguments.rasters){if(1!==h)throw"no sufficient rasters, require "+h;}else if(999!==h&&this.functionArguments.rasters.length!==h)throw"number of rasters does not meet (short or exceed) the operation requirment, require "+h;var d=31===f?c.isNull(a[0]):50===f?c.setNull(a[0]):c.local(a,{rasterCountNeeded:h,functor:g});"Unknown"!==this.pixelType&&(d.pixelType=this.pixelType,d.pixels=d.pixels.map(n.hitch(this,function(m){return this._clampBand(m,d.pixelType)})));d.statistics||d.calculateStatistics();
return{extent:b[0].extent,pixelBlock:d}},readGL:function(a){this._performance.start();var b=this.functionArguments.operation,f=this._getWebGLOperations(),g=f.operators[b-1],h=k.local;f="result\x3d"+f.functors[b-1]+";";31!==b&&50!==b&&(f+="result \x3d vec4(result.rgb, a.a);");h=h.replace("vec4 replaceme"+g+";",f);f=this.gl.getParameter(this.gl.VERSION);var d="";if(-1<f.toLowerCase().indexOf("webgl 1.0")||-1<f.toLowerCase().indexOf("webgl 0."))d=this._getPolyfill(b);h=h.replace("vec4 polyfill;",d);
1<g&&(h=h.replace("gl_FragColor \x3d localOp1();","gl_FragColor \x3d localOp1();".replace("1",g.toString())));this._initializeProgram({fragment:h,fragmentName:"Local"});b=a.rasters;if(null!=b&&0!==b.length){b=b.length;f=this.bindFrameBuffer();for(g=0;g<b;g++){h=0<g?g.toString():"";var m=this._setupTextureData(a.rasters[g],{reCreate:!0});this._bindTexture(m.texture,"u_image"+h)}this._setUniforms({});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:m.extent,texture:f.texture}}},
_getOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:[function(a,b){return a+b},function(a,b){return a-b},function(a,b){return a*b},function(a){return Math.sqrt(a)},function(a,b){return Math.pow(a,b)},function(a){return Math.acos(a)},function(a){return Math.asin(a)},function(a){return Math.atan(a)},function(a){return Math.atanh(a)},
function(a){return Math.abs(a)},function(a,b){return a&b},function(a,b){return a<<b},function(a){return~a},function(a,b){return a|b},function(a,b){return a>>b},function(a,b){return a^b},function(a,b){return a&&b},function(a){return!a},function(a,b){return a||b},function(a,b){return a!=b},function(a){return Math.cos(a)},function(a,b){return Math.cosh(a)},function(a,b){return a/b},function(a,b){return a==b},function(a){return Math.exp(a)},function(a){return Math.pow(10,a)},function(a){return Math.pow(2,
a)},function(a,b){return a>b?1:0},function(a,b){return a>=b?1:0},function(a,b){return Math.floor(a)},function(a){return!a},function(a){return a},function(a,b){return a<b?1:0},function(a,b){return a<=b?1:0},function(a){return Math.log(a)},function(a,b){return Math.log10(a)},function(a,b){return Math.log2(a)},999,999,999,999,999,999,function(a,b){return a%b},function(a){return-a},function(a,b){return a!=b?1:0},999,function(a,b){return Math.floor(a)},function(a,b){return Math.ceil(a)},function(a,b){return b?
0:a},function(a,b){return Math.sin(a)},function(a,b){return Math.sinh(a)},function(a,b){return a*a},999,999,function(a){return Math.tan(a)},function(a){return Math.tanh(a)},999,function(a){return Math.acosh(a)},function(a){return Math.asinh(a)},function(a,b){return Math.atan2(a,b)},function(a,b){return a/b},function(a,b){return Math.floor(a/b)},999,999,999,999,999,999,999,999,999,999,function(a,b,f){return a?b:f}]}},_polyfill:{sinh:"vec4 sinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp - 1.0/halfexp;\n}",
asinh:"vec4 asinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp - 1.0/halfexp);\n}",cosh:"vec4 cosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp + 1.0/halfexp;\n}",acosh:"vec4 acosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp + 1.0/halfexp);\n}",tanh:"vec4 tanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx - 1.0/expx)/(expx + 1.0/expx);\n}",atanh:"vec4 atanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx + 1.0/expx)/(expx - 1.0/expx);\n}"},_getPolyfill:function(a){var b=
"";switch(a){case 9:b=this._polyfill.atanh;break;case 22:b=this._polyfill.cosh;break;case 52:b=this._polyfill.sinh;break;case 57:b=this._polyfill.tanh;break;case 59:b=this._polyfill.acosh;break;case 60:b=this._polyfill.asinh}return b},_getWebGLOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:["(a + b)","(a - b)",
"(a * b)","sqrt(a)","pow(a, b)","acos(a)","asin(a)","atan(a)","atanh(a)","abs(a)","a","a","a","a","a","a","(a.r\x3d\x3d0.0 || b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","a.r\x3d\x3d0.0?vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","(a.r\x3d\x3d0.0 \x26\x26 b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","(a.r\x3d\x3d0.0 ^^ b.r\x3d\x3d0.0) ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","cos(a)","cosh(a)","a / b","a.r \x3d\x3d b.r? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
"exp(a)","pow(10.0, a)","pow(2.0, a)","a.r \x3e b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3e\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","floor(a)","a.a \x3d\x3d 0.0? vec4(1.0,1.0,1.0,1.0) : vec4(0.0,0.0,0.0,1.0)","a","a.r \x3c b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3c\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","log(a)","log2(a) / log2(10.0)","log2(a)",999,999,999,999,999,999,"mod(a, b)","-a","a.r !\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
999,"floor(a)","ceil(a)","a.r !\x3d 0.0 ? vec4(0.0,0.0,0.0,0.0) : a","sin(a)","sinh(a)","a * a",999,999,"tan(a)","tanh(a)",999,"acosh(a)","asinh(a)","atan(a, b)","a / b","floor(a / b)",999,999,999,999,999,999,999,999,999,999,"a.r!\x3d0 ? b : c"]}}})})},"esri/layers/rasterLib/function/MaskFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(H,n,t,l,k,e,c){return H([t,e],{declaredClass:"esri.layers.rasterLib.function.MaskFunction",
functionName:"Mask",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({includedRanges:null,noDataInterpretation:0,noDataValues:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to mask function is invalid.");this.rasterInfo=n.mixin(a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,a.raster.pixelType),statistics:a.raster.statistics,histograms:a.raster.histograms});
return!0},read2D:function(a){this._performance.start();a=a.raster;var b=c.mask(a.pixelBlock,{includedRanges:this.functionArguments.includedRanges,noDataInterpretation:this.functionArguments.noDataInterpretation,noDataValues:this.functionArguments.noDataValues});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(b.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:b}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:k.mask,fragmentName:"Mask"});
a=this._setupTextureData(a.raster);var b=this.bindFrameBuffer(),f=this.functionArguments.includedRanges,g=this.functionArguments.noDataValues?this.functionArguments.noDataValues.map(function(h){return parseFloat(h,10)}):null;this._setUniforms({u_includedRanges:f,u_includedRanges_specified:f?!0:!1,u_noDataValues:g,u_noDataValues_specified:g?!0:!1,u_noDataInterpretation:this.functionArguments.noDataInterpretation,u_bandCount:Math.min(this.sourceRasterInfo.raster.bandCount,3)});this._bindTexture(a.texture,
"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:b.texture}}})})},"esri/layers/rasterLib/function/NDVIFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(H,n,t,l,k,e,c){return H([t,e],{declaredClass:"esri.layers.rasterLib.function.NDVIFunction",functionName:"NDVI",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=
this.mixinIgnoreCase({visibleBandID:1,infraredBandID:2,scaled:!0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!(a.raster&&1<a.raster.bandCount))return Error("The raster input to ndvi function is invalid. It requires more than 1 band.");this.rasterInfo=n.mixin(a.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,this.scaled?"U8":"F32"),statistics:this.scaled?[{min:0,max:200}]:[{min:-1,max:1}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||
{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var b=c.calculate(a.pixelBlock,{bandIndexes:[this.functionArguments.infraredBandID+1,this.functionArguments.visibleBandID+1].join(" "),method:1}),f;if(this.functionArguments.scaled){var g=b.pixels[0];var h=b.mask;var d=g.length;var m=new Uint8Array(d);if(null==h)for(f=0;f<d;f++)m[f]=100*g[f]+100&255;else for(f=0;f<d;f++)h[f]&&(m[f]=100*g[f]+100&255);b.pixels[0]=m;b.pixelType="U8"}this._addPerformanceMetric(this._performance.elapsed());
"Unknown"!==this.pixelType&&(b.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:b}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:k.ndvi,fragmentName:"NDVI"});var b=this.functionArguments.visibleBandID,f=this.functionArguments.infraredBandID,g=this.functionArguments.scaled||!1;this._alterBand=2<Math.max(f,b)?!0:!1;a=this._setupTextureData(a.raster,{bandIDs:this._alterBand?{bandIDs:[f,b,f]}:null});var h=this.bindFrameBuffer();this._alterBand?this._setUniforms({u_bandId_nir:0,
u_bandId_red:1,u_scaled:g}):this._setUniforms({u_bandId_nir:f,u_bandId_red:b,u_scaled:g});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:h.texture}}})})},"esri/layers/rasterLib/function/SlopeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),function(H,n,t,l,k,e,
c,a){return H([t,c],{declaredClass:"esri.layers.rasterLib.function.SlopeFunction",functionName:"Slope",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({zFactor:1,slopeType:1,psPower:.664,psFactor:.024,raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input to slope function is invalid.");this.rasterInfo=n.mixin(b.raster,{bandCount:1,pixelType:this._calculatePixelType(this.outputPixelType,"F32"),statistics:1===
this.slopeType||3===this.slopeType?[{min:0,max:90}]:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(b){this._performance.start();b=b.raster;b=a.slope(b,{zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,slopeType:this.functionArguments.slopeType,isGCS:b.extent.spatialReference.wkid&&null==l[b.extent.spatialReference.wkid]});
this._addPerformanceMetric(this._performance.elapsed());return b},readGL:function(b){this._performance.start();this._initializeProgram({fragment:e.slope,fragmentName:"Slope"});var f=this._setupTextureData(b.raster),g=this.bindFrameBuffer(),h=this.gl,d=h.drawingBufferWidth;h=h.drawingBufferHeight;var m=f.extent;this._setUniforms({u_resolution:b&&b.raster&&b.raster.pixelBlock?[1/b.raster.pixelBlock.width,1/b.raster.pixelBlock.height]:[1/d,1/h],u_cellSize:[(m.xmax-m.xmin)/d,(m.ymax-m.ymin)/h],u_zfactor:this.functionArguments.zFactor});
this._bindTexture(f.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:g.texture}}})})},"esri/layers/rasterLib/function/StretchFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./vertexShaders ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(H,n,t,l,k,e,c){return H([t,c],{declaredClass:"esri.layers.rasterLib.function.StretchFunction",functionName:"Stretch",supportWebGL:!0,
support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,computeGamma:!1},a);this.functionArguments.statistics=this._convertStats(this.functionArguments.statistics);-1===[0,3,5,6].indexOf(this.functionArguments.stretchType)&&(console.error("The specific stretch type has not been implemented: "+this.functionArguments.stretchType),
this.functionArguments.stretchType=5);this.min=null==this.min?0:this.min;this.max=null==this.max?255:this.max},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to stretch function is invalid.");a.raster.statistics&&(this.srcStatistics=this._convertStats(a.raster.statistics));a.raster.histograms&&(this.srcHistograms=a.raster.histograms);this.rasterInfo=n.mixin({},a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),
statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){a=a.raster;this._stretch(a);return a},hasTilingEffects:function(a){a=a||this.functionArguments;return!!(a.dra||a.raster&&"object"===typeof a.raster&&a.raster.dra)},_convertStats:function(a){return a?a.map(function(b){return b&&null!=b.min?[b.min,b.max,b.mean,b.stddev]:b}):null},_updateStatistisHistograms:function(a){var b=this.functionArguments,
f=b.histograms||this.srcHistograms;if(a&&a.pixelBlock&&a.pixelBlock.pixels){if(0===b.stretchType)this._statistics=b.statistics&&0<b.statistics.length?b.statistics:this.srcStatistics,this._histograms=f;else{var g=a.pixelBlock,h=g.pixels.length,d=6===b.stretchType&&(b.dra||!f)||3===b.stretchType&&b.dra;d&&(g.statistics||g.calculateStatistics(),this._calculateStatisticsHistograms(a));if(b.dra)if(g.statistics||g.calculateStatistics(),d)this._statistics=g.statistics,this._histograms=g.histograms;else for(b=
g.statistics,this._statistics=[],a=0;a<h;a++)this._statistics[a]=[b[a].minValue,b[a].maxValue,0,0];else this._statistics=b.statistics&&0<b.statistics.length?b.statistics:this.srcStatistics,this._histograms=f}this._statistics=this._convertStats(this._statistics);this._gammaCorrection=this._getGammaCorrection()}else this._statistics=b.statistics&&0<b.statistics.length?b.statistics:this.srcStatistics,this._histograms=f,this._gammaCorrection=this._getGammaCorrection(),this._statistics=this._convertStats(this._statistics)},
_getGammaCorrection:function(){var a=this.functionArguments.gamma;if(a){var b=[],f;for(f=0;f<a.length;f++)b[f]=1<a[f]?2<a[f]?6.5+Math.pow(a[f]-2,2.5):6.5+100*Math.pow(2-a[f],4):1;return b}},_stretch:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels&&0!==this.functionArguments.stretchType){this._updateStatistisHistograms(a);var b=a.pixelBlock,f=b.pixels;b=b.width*b.height;var g=f.length,h,d;this._createLUT(a);if(null==this.LUT)return this._filterNoLUT(a);var m=this.LUT,p=this.LUTOffset;
for(h=0;h<g;h++){var v=m[h];for(d=0;d<b;d++){var q=f[h][d];f[h][d]=v[q-p]}}a.pixelBlock.pixelType="U8"}},_calculateStatisticsHistograms:function(a){a=a.pixelBlock;var b=a.pixelType,f=a.pixels,g=a.mask,h=f.length,d,m,p=function(I){this.min=-.5;this.max=255.5;this.size=256;n.mixin(this,I);this.counts=this.counts||new Uint32Array(this.size)},v=[],q,w;for(d=0;d<h;d++){var y=new p;var x=y.counts;var E=f[d];if("U8"===b)if(g)for(m=0;m<a.width*a.height;m++)g[m]&&x[E[m]]++;else for(m=0;m<a.width*a.height;m++)x[E[m]]++;
else{var B=a.statistics[d].minValue;var C=a.statistics[d].maxValue;y.min=B;y.max=C;C=(C-B)/256;var G=new Uint32Array(257);if(g)for(m=0;m<a.width*a.height;m++)g[m]&&G[Math.floor((E[m]-B)/C)]++;else for(m=0;m<a.width*a.height;m++)G[Math.floor((E[m]-B)/C)]++;for(m=0;255>m;m++)x[m]=G[m];x[255]=G[255]+G[256]}v.push(y);E=[];B=a.statistics[d].minValue;C=a.statistics[d].maxValue;for(m=w=q=G=0;m<y.size;m++)G+=x[m],q+=m*x[m];q/=G;for(m=0;m<y.size;m++)w+=x[m]*Math.pow(m-q,2);x=Math.sqrt(w/(G-1));m=(q+.5)*(y.max-
y.min)/y.size+y.min;y=x*(y.max-y.min)/y.size;E.push(B);E.push(C);E.push(m);E.push(y);a.statistics[d]={min:B,minValue:B,max:C,maxValue:C,mean:m,stddev:y}}a.histograms=v},_getCutOffPoints:function(a){var b=this.functionArguments,f=999;a&&a.pixelBlock?f=a.pixelBlock.pixels.length:a&&a.texture&&(f=3);a=Math.min(f,this._statistics.length);var g=[],h=[],d,m;switch(b.stretchType){case 5:for(d=0;d<a;d++)g[d]=this._statistics[d][0],h[d]=this._statistics[d][1];break;case 3:for(d=0;d<a;d++)g[d]=this._statistics[d][2]-
b.numberOfStandardDeviations*this._statistics[d][3],h[d]=this._statistics[d][2]+b.numberOfStandardDeviations*this._statistics[d][3],g[d]<this._statistics[d][0]&&(g[d]=this._statistics[d][0]),h[d]>this._statistics[d][1]&&(h[d]=this._statistics[d][1]);break;case 6:for(d=0;d<a;d++){f=this._histograms[d];var p=new Uint32Array(f.size);var v=f.counts;var q=0;var w=-.5===f.min&&1===(f.max-f.min)/v?.5:0;for(m=0;m<f.size;m++)q+=v[m],p[m]=q;v=b.minPercent*q/100;for(m=0;m<f.size;m++)if(p[m]>v){g[d]=f.min+(f.max-
f.min)/f.size*(m+w);break}v=(1-b.maxPercent/100)*q;for(m=f.size-2;0<=m;m--)if(p[m]<v){h[d]=f.min+(f.max-f.min)/f.size*(m+2-w);break}}break;default:for(d=0;d<f;d++)g[d]=0,h[d]=255}return{minCutOff:g,maxCutOff:h}},_createLUT:function(a){var b=this.functionArguments,f=a.pixelBlock,g=f.pixelType;if("U8"===g||"U16"===g||"S8"===g||"S16"===g){if(this._LUTSignature&&(g=this._computeLutSignature(),g.length===this._LUTSignature.length&&!g.some(function(D,r){return D!==this._LUTSignature[r]}.bind(this))))return;
g=f.pixels.length;var h=[],d=[],m=b.max,p=b.min,v=b.gamma,q=m-p,w=this._getCutOffPoints(a);a=w.minCutOff;w=w.maxCutOff;var y=0,x=256;"S8"===f.pixelType?y=-127:"S16"===f.pixelType&&(y=-32767);if("U16"===f.pixelType||"S16"===f.pixelType)x=65536;for(f=0;f<g;f++)h[f]=w[f]-a[f];var E=this._gammaCorrection;if(b.useGamma)for(f=0;f<g;f++){var B=[];for(b=0;b<x;b++){var C=b+y;var G=(C-a[f])/h[f];var I=1;1<v[f]&&(I-=Math.pow(1/q,G*E[f]));C<w[f]&&C>a[f]?B[b]=Math.floor(I*q*Math.pow(G,1/v[f]))+p:C>w[f]?B[b]=m:
C<a[f]&&(B[b]=p)}d[f]=B}else for(f=0;f<g;f++){B=[];for(b=0;b<x;b++)C=b+y,B[b]=C<a[f]?p:C>w[f]?m:Math.floor((C-a[f])/h[f]*q)+p;d[f]=B}this.LUT=d;this.LUTOffset=y;this._LUTSignature=this._computeLutSignature()}},_computeLutSignature:function(){var a=this.functionArguments,b=[],f,g;b.push(a.stretchType);b.push(a.min);b.push(a.max);b.push(a.numberOfStandardDeviations);if(this._statistics)for(f=0;f<this._statistics.length;f++)for(g=0;g<this._statistics[f].length;g++)b.push(this._statistics[f][g]);b.push(a.dra?
1:0);b.push(a.minPercent);b.push(a.maxPercent);if(a.gamma)for(f=0;f<this._statistics.length;f++)b.push(a.gamma[f]);b.push(a.useGamma?1:0);return b},_filterNoLUT:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var b=this.functionArguments,f=a.pixelBlock,g=f.pixels,h=f.mask;f=f.width*f.height;var d=g.length,m=[],p=[],v=b.max,q=b.min,w=b.gamma,y=v-q;var x=this._getCutOffPoints(a);var E=x.minCutOff,B=x.maxCutOff;for(x=0;x<d;x++)m[x]=B[x]-E[x];if(b.useGamma&&null!==w&&w.length>=
d)for(x=0;x<d;x++)p[x]=1<w[x]?2<w[x]?6.5+Math.pow(w[x]-2,2.5):6.5+100*Math.pow(2-w[x],4):1;if(b.useGamma)if(void 0!==h&&null!==h)for(b=0;b<f;b++){if(h[b])for(x=0;x<d;x++){var C=g[x][b];var G=(C-E[x])/m[x];var I=1;1<w[x]&&(I-=Math.pow(1/y,G*p[x]));C<B[x]&&C>E[x]?g[x][b]=Math.floor(I*y*Math.pow(G,1/w[x]))+q:C>B[x]?g[x][b]=v:C<E[x]&&(g[x][b]=q)}}else for(b=0;b<f;b++)for(x=0;x<d;x++)C=g[x][b],G=(C-E[x])/m[x],I=1,1<w[x]&&(I-=Math.pow(1/y,G*p[x])),C<B[x]&&C>E[x]?g[x][b]=Math.floor(I*y*Math.pow(G,1/w[x]))+
q:C>B[x]?g[x][b]=v:C<E[x]&&(g[x][b]=q);else if(void 0!==h&&null!==h)for(b=0;b<f;b++){if(h[b])for(x=0;x<d;x++)C=g[x][b],C<B[x]&&C>E[x]?g[x][b]=Math.floor((C-E[x])/m[x]*y)+q:C>B[x]?g[x][b]=v:C<E[x]&&(g[x][b]=q)}else for(b=0;b<f;b++)for(x=0;x<d;x++)C=g[x][b],C<B[x]&&C>E[x]?g[x][b]=Math.floor((C-E[x])/m[x]*y)+q:C>B[x]?g[x][b]=v:C<E[x]&&(g[x][b]=q);a.pixelBlock.pixelType="U8";return a}},_computeGammaValues:function(a){var b=this._statistics.length,f,g=[];for(f=0;f<b;f++){var h=this._statistics[f][2];"U8"!==
a&&(h=255*(h-this._statistics[f][0])/(this._statistics[f][1]-this._statistics[f][0]));g.push(this._computeGammaValue(h))}return g},_computeGammaValue:function(a){if(0!==a&&!(255<a||0>a)){var b=0;0<a&&150!=a&&255>a&&(b=150>=a?45*Math.cos(.01047*a):17*Math.sin(.021*a));b=Math.log((a+b)/255);if(0!==b&&(a=Math.log(a/255)/b,!isNaN(a)))return Math.min(9.9,Math.max(.01,a))}},readGL:function(a){return this._stretchGL(a.raster)},_stretchGL:function(a){this._performance.start();var b=this.renderTexture,f,g=
a.pixelBlock&&a.pixelBlock.pixels&&a.pixelBlock.pixels.length||this.sourceRasterInfo.raster.bandCount,h=a.pixelBlock,d=this.gl,m=d.drawingBufferWidth,p=d.drawingBufferHeight;if(!h&&this.functionArguments.dra){var v=new Float32Array(m*p*4),q=new Uint8Array(m*p);var w=new Float32Array(m*p);var y=new Float32Array(m*p);var x=new Float32Array(m*p);d.checkFramebufferStatus(d.FRAMEBUFFER)==d.FRAMEBUFFER_COMPLETE&&d.readPixels(0,0,m,p,d.RGBA,d.FLOAT,v);for(f=0;f<m*p;f++)w[f]=v[4*f],y[f]=v[4*f+1],x[f]=v[4*
f+2],q[f]=v[4*f+3];a.pixelBlock=new l({width:m,height:p,pixels:[w,y,x],mask:q});a.pixelBlock.calculateStatistics()}!h&&this.functionArguments.dra&&this._useGPUStats?(w=new Float32Array(g),y=new Float32Array(g)):(this._updateStatistisHistograms(a),v=this._getCutOffPoints(a),w=new Float32Array(g),y=new Float32Array(g),w.set(v.minCutOff.slice(0,g)),y.set(v.maxCutOff.slice(0,g)));this._initializeProgram({fragment:e.stretch,fragmentName:"Stretch"});v=this._setupTextureData(a);q=this.bindFrameBuffer();
this.renderTexture=!1;this._performance.start();if(!h&&this.functionArguments.dra&&this._useGPUStats){this._setUniforms({u_sourceDim:[m,p],u_bandCount:g});if(1===g)var E=this._readMinMax(v,2);else{E=this._readMinMax(v,0);var B=this._readMinMax(v,1)}if(6===this.functionArguments.stretchType||3===this.functionArguments.stretchType&&this.functionArguments.dra)f=this._readHistogram(E,B,a),w=f.minCutOff||w,y=f.minCutOff||y}x=this.functionArguments.max-this.functionArguments.min;a=new Float32Array(g);for(f=
0;f<g;f++)a[f]=x/(y[f]-w[f]);this._useGPUStats&&this._initializeProgram({fragment:e.stretch,fragmentName:"Stretch"});d.blendFunc(d.SRC_ALPHA,d.ZERO);x=new Float32Array(3);var C=new Float32Array(3);for(f=0;3>f;f++)x[f]=this.functionArguments.min,C[f]=this.functionArguments.max;f=this.functionArguments.useGamma;var G=this.functionArguments.gamma,I=this._gammaCorrection;Array.isArray(G)&&G.length>=g||(f=!1);this._setUniforms({u_sourceDim:[m,p],u_bandCount:g,u_minOutput:x,u_maxOutput:C,u_minCutOff:w,
u_maxCutOff:y,u_factor:a,u_state:100,u_useGamma:f,u_gamma:G,u_scaled:!b,u_gammaCorrection:I,u_minMaxTexture:!h&&this.functionArguments.dra&&this._useGPUStats?!0:!1});this.renderTexture=b;d.viewport(0,0,m,p);this._bindTexture(v.texture,"u_image");!h&&this.functionArguments.dra&&this._useGPUStats&&(b=d.getUniformLocation(this.rasterProgram,"u_image1"),d.uniform1i(b,1),d.activeTexture(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,E.texture),1<g&&(g=d.getUniformLocation(this.rasterProgram,"u_image2"),d.uniform1i(g,
2),d.activeTexture(d.TEXTURE2),d.bindTexture(d.TEXTURE_2D,B.texture)));this._drawGL();return{extent:v.extent,texture:q.texture}},_readMinMax:function(a,b){var f=this.gl,g=a.width||f.drawingBufferWidth,h=a.height||f.drawingBufferHeight;this._setUniforms({u_state:b});this.renderTexture=!1;var d=a.texture;for(f.activeTexture(f.TEXTURE0);1<g||1<h;){var m=this._createTexture();b=Math.max(Math.ceil(g/2),1);var p=Math.max(Math.ceil(h/2),1);f.getExtension("OES_texture_float");f.texImage2D(f.TEXTURE_2D,0,
f.RGBA,b,p,0,f.RGBA,f.FLOAT,null);a=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,a);f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,m,0);f.viewport(0,0,b,p);f.bindTexture(f.TEXTURE_2D,d);this._setUniforms({u_sourceDim:[g,h]});g=b;h=p;this._drawGL(!0);d=m}a=new Float32Array(g*h*4);f.checkFramebufferStatus(f.FRAMEBUFFER)==f.FRAMEBUFFER_COMPLETE&&f.readPixels(0,0,g,h,f.RGBA,f.FLOAT,a);return{texture:m,minmax:a}},_readHistogram:function(a,b,f){if(a)try{var g=this.gl,h=g.drawingBufferWidth,
d=g.drawingBufferHeight,m,p,v;if(a.texture instanceof WebGLTexture){var q=!0;var w=[1,0,0,1];if(b){var y=a.minmax;var x=b.minmax}else y=[a.minmax[0]],x=[a.minmax[1]]}else for(x=b,y=a,w=new Float32Array(x.length),m=0;m<x.length;m++)w[m]=256/(x[m]-y[m]);var E=new Float32Array(h*d);for(v=0;v<E.length;v++)E[v]=v;if(!this.histogramProgram){var B=k.getShader(g,k.histogram),C=e.getShader(g,e.constant);this.histogramProgram=this._loadProgram(B,C)}g.blendFunc(g.ONE,g.ONE);g.enable(g.BLEND);g.useProgram(this.histogramProgram);
var G=g.getAttribLocation(this.histogramProgram,"a_pixelIndex"),I=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,I);g.bufferData(g.ARRAY_BUFFER,E,g.STATIC_DRAW);g.enableVertexAttribArray(G);g.vertexAttribPointer(G,1,g.FLOAT,!1,0,0);var D=this._setupHistTexture(f),r=this._createTexture();g.getExtension("OES_texture_float");g.texImage2D(g.TEXTURE_2D,0,g.RGBA,257,1,0,g.RGBA,g.FLOAT,null);var u=g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,u);g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,
g.TEXTURE_2D,r,0);g.viewport(0,0,257,1);var A=g.getUniformLocation(this.histogramProgram,"u_image");g.uniform1i(A,0);g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,D);var J=g.getUniformLocation(this.histogramProgram,"u_sourceDim");g.uniform2f(J,h,d);var O=g.getUniformLocation(this.histogramProgram,"u_bandCount");g.uniform1i(O,3);var P=g.getUniformLocation(this.histogramProgram,"u_halfPixel");g.uniform2f(P,.5/h,.5/d);var z=g.getUniformLocation(this.histogramProgram,"u_minMaxTexture");if(q){g.uniform1i(z,
1);var F=g.getUniformLocation(this.histogramProgram,"u_image1");g.uniform1i(F,1);g.activeTexture(g.TEXTURE1);g.bindTexture(g.TEXTURE_2D,a.texture);if(b){var M=g.getUniformLocation(this.histogramProgram,"u_image2");g.uniform1i(M,2);g.activeTexture(g.TEXTURE2);g.bindTexture(g.TEXTURE_2D,b.texture)}}else{var Q=g.getUniformLocation(this.histogramProgram,"u_mins");g.uniform4f(Q,y[0],y[0],y[0],y[0]);g.uniform1i(z,0)}var R=g.getUniformLocation(this.histogramProgram,"u_color"),K=g.getUniformLocation(this.histogramProgram,
"u_factors"),N=g.getUniformLocation(this.histogramProgram,"u_size");g.uniform1f(N,256);a=[];b=[];g.uniform4fv(R,[1,0,0,1]);g.uniform4fv(K,[w[0],0,0,1]);g.drawArrays(g.POINTS,0,E.length);var V=this.sourceRasterInfo.raster.bandCount;1<V&&(g.uniform4fv(R,[0,1,0,1]),g.uniform4fv(K,[0,w[0],0,1]),g.drawArrays(g.POINTS,0,E.length),g.uniform4fv(R,[0,0,1,1]),g.uniform4fv(K,[0,0,w[0],1]),g.drawArrays(g.POINTS,0,E.length));if(g.checkFramebufferStatus(g.FRAMEBUFFER)==g.FRAMEBUFFER_COMPLETE){var W=new Float32Array(1028);
g.readPixels(0,0,257,1,g.RGBA,g.FLOAT,W);g=0;var L=-.5===y[0]&&1===(x[0]-y[0])/256?.5:0;for(m=0;m<V;m++){var T=new Float32Array(257);var S=new Float32Array(257);for(v=g=0;256>v;v++)g+=W[4*v+m],T[v]=g,S[v]=W[4*v+m];S[256]=W[1024+m];T[256]=g+W[1024+m];var U=this.functionArguments.minPercent*g/100;if(x){for(p=0;256>p;p++)if(T[p]>U){a[m]=y[0]+(x[0]-y[0])/256*(p+L);break}U=(1-this.functionArguments.maxPercent/100)*g;for(p=254;0<=p;p--)if(T[p]<U){b[m]=y[0]+(x[0]-y[0])/256*(p+2-L);break}}}}return{histogram:W,
minCutOff:a,maxCutOff:b}}catch(X){console.debug("webgl filter exception: "+X.message)}},_setupHistTexture:function(a){if(a instanceof WebGLTexture)return a;var b=this.originalHistTexture=this._createTexture(),f=this.gl;a=a.pixelBlock;var g=a.width,h=a.height;f.getExtension("OES_texture_float");this.rgbaFloatData=a.getAsRGBAFloat();f.texImage2D(f.TEXTURE_2D,0,f.RGBA,g,h,0,f.RGBA,f.FLOAT,this.rgbaFloatData);return b}})})},"esri/layers/rasterLib/function/RemapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(H,n,t,l,k,e,c){return H([l,e],{declaredClass:"esri.layers.rasterLib.function.RemapFunction",functionName:"Remap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({inputRanges:null,outputValues:null,outputColors:null,colorBreaks:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input is not available.");var b=!(!this.functionArguments.outputColors&&!this.functionArguments.colorBreaks);
this.rasterInfo=n.mixin(a.raster,{bandCount:b?3:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=b?"Processed":"Thematic";return!0},read2D:function(a){return this._remap(a.raster)},readGL:function(a){return this._remapGL(a.raster)},_remap:function(a){this._performance.start();var b=c.remapColor(a.pixelBlock,this.functionArguments.colorBreaks);this._addPerformanceMetric(this._performance.elapsed());
return{extent:a.extent,pixelBlock:b}},_remapGL:function(a){this._performance.start();this._initializeProgram({fragment:k.remap,fragmentName:"Remap"});var b=new Uint8Array(64),f=this.functionArguments.colorBreaks;f.forEach(function(m,p){b[4*p]=m.mappedColor[0];b[4*p+1]=m.mappedColor[1];b[4*p+2]=m.mappedColor[2];b[4*p+3]=1>=m.mappedColor[3]?255*m.mappedColor[3]:m.mappedColor[3]});var g=f[f.length-1],h=g.mappedColor;b[60]=h[0];b[61]=h[1];b[62]=h[2];b[63]=1>=h[3]?255*h[3]:h[3];var d=new Float32Array(16);
f.forEach(function(m,p){d[p]=m.value});d[15]=g.value;this._clrTexture||(this._clrTexture=this._setupColormapTexture(b));f=this._clrTexture;g=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:0,u_indexedColormapMaxIndex:b.length/4-1,u_breaks:d});this._bindTexture(f,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:g.texture}},_setupColormapTexture:function(a){var b=this._createTexture(),f=a.length/4,g=new Float32Array(a.length),
h=this.renderTexture?255:1,d,m=this.gl;for(d=0;d<a.length;d++)g[d]=a[d]/h;m.getExtension("OES_texture_float");m.texImage2D(m.TEXTURE_2D,0,m.RGBA,f,1,0,m.RGBA,m.FLOAT,g);return b}})})},"esri/layers/rasterLib/function/IdentityFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(H,n,t,l,k){return H([l,k],{declaredClass:"esri.layers.rasterLib.function.IdentityFunction",functionName:"Identity",supportWebGL:!0,support2D:!0,
constructor:function(e){this.functionArguments={raster:null}},bind:function(e){e=this.getSourceRasterInfo(e);if(!e.raster)return Error("The raster input to identity function is invalid.");this.rasterInfo=n.mixin(e.raster,{});return!0},read2D:function(e){return e.raster},readGL:function(e){this._initializeProgram({fragment:t.identity,fragmentName:"identity"});e=this._setupTextureData(e.raster);var c=this.bindFrameBuffer();this._bindTexture(e.texture,"u_image");this._drawGL();return{extent:e.extent,
texture:c.texture}}})})},"esri/layers/rasterLib/function/ResampleFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(H,n,t,l,k){return H([l,k],{declaredClass:"esri.layers.rasterLib.function.ResampleFunction",renderTexture:!0,resamplingOrigin:null,resamplingRatio:null,zFactor:1,functionName:"Resample",supportWebGL:!0,support2D:!1,constructor:function(e){this.functionArguments=this.mixinIgnoreCase({resamplingType:0},
e)},bind:function(e){e=this.getSourceRasterInfo(e);if(!e.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=n.mixin(e.raster,{bandCount:e.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,e.raster.pixelType),statistics:e.raster.statistics,histograms:e.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};return!0},readGL:function(e){this._performance.start();this._initializeProgram({fragment:t.resample,fragmentName:"Resample"});
var c=this._setupTextureData(e.raster),a=this.bindFrameBuffer(),b=this.gl,f=b.drawingBufferWidth;b=b.drawingBufferHeight;var g=e.raster;void 0!==g.pixelBlock?(c=c||this._setupTextureData(g),e=g.pixelBlock.width,g=g.pixelBlock.height):(c=c||g,e=f,g=b);this._setUniforms({u_resamplingRatio:this.resamplingRatio||[e/f,g/b],u_anchor:this.resamplingOrigin||[0,1],u_resamplingType:this.functionArguments.resamplingType,u_resolution:[1/f,1/b]});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());
return{extent:c.extent,texture:a.texture}}})})},"esri/layers/rasterLib/renderer/rasterRendererHelper":function(){define("dojo/_base/declare dojo/_base/lang ../../PixelBlock ./RasterColormapRenderer ./RasterUniqueValueRenderer ./RasterRGBRenderer ./RasterStretchColorRampRenderer ./RasterClassBreaksRenderer ./RasterShadedReliefRenderer".split(" "),function(H,n,t,l,k,e,c,a,b){var f=function(){function g(d){h[d.prototype.rendererName]=d}var h={};g(l);g(e);g(c);g(k);g(a);g(b);return h}();return{wellKnownRenderers:f,
isSupported:function(g){if(!g)return!1;var h=!0;f[g.rendererName]||(h=!1);return h},create:function(g){if(!g)return null;if(g.rendererName){var h=g.rendererName;g=g.rendererArguments}else h="uniqueValue rasterStretch rasterShadedRelief rgb rasterColormap classBreaks".split(" ").indexOf(g.type),h="UniqueValue Stretch ShadedRelief RGB Colormap ClassBreaks".split(" ")[h],"rasterStretch"===g.type&&g.bandIndex&&1<g.bandIndex.length&&(h="RGB");return(h=f[h])?new h(g):null},createDefaultRenderer:function(g){if(g&&
g.raster){var h=g.raster.rasterInfo,d=g.raster.dataType;if(h){var m=g.raster.rasterFunction,p=["Stretch","Colormap","ContrastAndBrightness"];if(m&&"U8"===h.pixelType&&-1<p.indexOf(m.functionName))m.renderTexture=!0;else if("Processed"!==d||!(g.useWebGL&&m&&m.renderTexture||!g.useWebGL&&"U8"===h.pixelType)){m&&(h=m.rasterInfo);m=h.bandCount;var v=h.colormap,q=h.vat;p=h.histograms;p&&0===p.length&&(p=null);var w=h.statistics&&h.statistics.map(function(E){return[E.min,E.max,E.mean,E.stddev]});if(1===
m&&v&&0<v.length)var y=this._getDefaultColormapRenderer(q,v);else if(1===m&&q&&q.features&&0<q.features.length)y=new k({});else{v=0;q=!1;d||!g.raster||!g.raster.tileInfo||void 0!==g.raster.tileInfo.tileType&&"Map"!==g.raster.tileInfo.tileType?"U8"===h.pixelType&&"Processed"===d?(v=5,w=w||[[0,255,0,0],[0,255,0,0],[0,255,0,0]],q=!1):"U8"===h.pixelType||"Elevation"===d?(v=5,q=w?!1:!0):"Scientific"===d||"StdTime"===d?(v=5,q=w?!1:!0,y=this._getDefaultScientificColorRamp()):p&&0<p.length?(v=6,q=!1):w?(v=
5,q=!1):(v=6,q=!0):(w=[[0,255,0,0],[0,255,0,0],[0,255,0,0]],v=5,q=!1);w||(v=5,q=!0);var x;3<=m&&!(g.bandIds||g.raster&&g.raster.imageServiceParams&&g.raster.imageServiceParams.bandIds)&&(x=this.getDefaultBandCombination(h));x&&(w=x.map(function(E){return w[E]}));g={stretchType:v,min:0,max:255,dra:q,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,statistics:w,histograms:p,numberOfStandardDeviations:2.5,bandIndex:x};1===m||x&&1===x.length?(y&&(g.colorRamp=y,g.invert=!1),y=new c(g)):y=new e(g)}return y}}}},
getDefaultBandCombination:function(g){var h=g.bandCount;if(1===h)return null;if(2===h)return[0];var d=(g=g.keyProperties)&&g.ChangeAnalysisParameters&&g.ChangeAnalysisParameters.AnalysisType;if(d&&("ccdc"===d.toLowerCase()||"landtrendr"===d.toLowerCase()))return[0];g=g&&g.BandProperties;var m;if(g&&g.length===h){var p=this.getWellKnownBandIndexes(g);g=p.red;d=p.green;var v=p.blue;p=p.nir;null!=g&&null!=d&&null!=v?m=[g,d,v]:null!=p&&null!=g&&null!=d&&(m=[p,g,d])}!m&&3<=h&&(m=[0,1,2]);return m},getWellKnownBandIndexes:function(g){for(var h=
{},d=0;d<g.length;d++){var m=g[d],p=m.BandName&&m.BandName.toLowerCase();"red"===p?h.red=d:"green"===p?h.green=d:"blue"===p?h.blue=d:"nearinfrared"===p||"nearinfrared_1"===p||"nir"===p?h.nir=d:m.WavelengthMax&&m.WavelengthMin&&(p=m.WavelengthMin,m=m.WavelengthMax,null==h.blue&&410<=p&&480>=p&&480<=m&&540>=m?h.blue=d:null==h.green&&490<=p&&560>=p&&560<=m&&610>=m?h.green=d:null==h.red&&595<=p&&670>=p&&660<=m&&730>=m?h.red=d:null==h.nir&&700<=p&&860>=p&&800<=m&&950>=m&&(h.nir=d))}return h},_getDefaultColormapRenderer:function(g,
h){if(h||h.length){var d=[],m=this._ratContainsColormap(g);if(m)var p=this._getRATValueClassNameMap(g);h.forEach(function(v){var q=p?p[v[0]]:v[0];d.push({color:[v[1],v[2],v[3]],value:v[0],label:m?null!=q?q:"":v[0]})});return new l({colormapInfos:d})}},_ratContainsColormap:function(g){if(!g||!g.fields)return!1;var h,d,m;return g.fields.some(function(p){p&&p.name&&(p=p.name.toLowerCase(),"red"===p&&(h=!0),"green"===p&&(d=!0),"blue"===p&&(m=!0));return h&&d&&m})},_getRATValueClassNameMap:function(g){if(!g||
!g.fields)return null;var h={},d,m;g.fields.forEach(function(p){if("classname"===p.name.toLowerCase()||"class_name"===p.name.toLowerCase())d=p.name;"value"===p.name.toLowerCase()&&(m=p.name)});g.features.forEach(function(p){p=p.attributes;h[p[m]]=d?p[d]:p[m]});return h},_getDefaultScientificColorRamp:function(){return{type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}].map(function(g){return{fromColor:g.toColor,
toColor:g.fromColor}}).reverse()}}}})},"esri/layers/rasterLib/renderer/RasterColormapRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction"],function(H,n,t,l){return H([t],{declaredClass:"esri.layers.rasterLib.renderer.RasterColormapRenderer",rendererName:"Colormap",renderTexture:!0,constructor:function(k){k&&k.colormapInfos&&(k.colormap=k.colormapInfos.map(function(e){return[e.value].concat(e.color)}));this._function=new l(k);this._function.outputPixelType=
"U8";this._function.renderTexture=!0},draw2D:function(k){this._updateColormapParameters();k=this._clonePixelData(k);return k=this._function._colorize(k)},drawGL:function(k){this._updateColormapParameters();this._function._colorizeGL(k)},toJson:function(){var k=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:k}},toCommonRendererJson:function(){return{type:"rasterColormap",colormapInfos:this.colormapInfos||this.colormap.map(function(k){return{value:k[0],
color:k.slice(1),label:k[0]}})}},_updateColormapParameters:function(){var k=this._function.functionArguments;k.colormap=this.colormap;k.colormapName=this.colormapName;k.colorRamp=this.colorRamp;k.colorRampName=this.colorRampName}})})},"esri/layers/rasterLib/renderer/RasterRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../PixelBlock"],function(H,n,t,l){return H(null,{declaredClass:"esri.layers.rasterLib.renderer.RasterRenderer",raster:null,constructor:function(k){k=
k||{};this.raster=k.raster||k.Raster||this.raster;this.draw=n.hitch(this,this.draw);this.bind=n.hitch(this,this.bind);k=n.clone(k);Object.keys(k).forEach(function(e){null==k[e]&&delete k[e]});n.mixin(this,k)},bind:function(k){if(!k)throw"failed to bind without options";var e=k;k.layer&&(k=k.layer,e={id:k.id,rawRasterInfo:k.raster.rasterInfo,glSetting:k._glSetting,xformSetting:k.tileManager&&k.tileManager.xformSetting,useWebGL:k.useWebGL,resampling:k.tileMode&&k.tileManager&&k.tileManager.xformSetting.requireProjection&&
!k._hasTilingEffects&&"Thematic"!==k.raster.dataType?1:0,tileMode:k.tileMode});this._rawRasterInfo=e.rawRasterInfo;this.useWebGL=e.useWebGL;this._function&&this._function.setProcessingContext(n.mixin({useProcessedData:!0},e));this._processingContext=e},hasTilingEffects:function(){},draw:function(k){return this.useWebGL?this.drawGL(k):this.draw2D(k)},toJson:function(){},_clonePixelData:function(k){if(null==k)return k;var e={};k.extent&&(e.extent=new t(k.extent.xmin,k.extent.ymin,k.extent.xmax,k.extent.ymax,
k.extent.spatialReference));k=k.processedPixelBlock||k.pixelBlock;if(null==k)return e;e.pixelBlock=k.clone?k.clone():l.prototype.clone(k);return e}})})},"esri/layers/rasterLib/renderer/RasterUniqueValueRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../../../renderers/colorRampGenerator"],function(H,n,t,l,k){return H([t],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",rendererName:"UniqueValue",field:"",
alias:"",uniqueValueInfos:null,constructor:function(e){e&&e.colormap&&(this.colormap=e.colormap,this._function=new l(e),this._function.outputPixelType="U8",this._function.renderTexture=!0)},bind:function(e){this.inherited(arguments);if(!this._function){var c=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;if(!c)throw"uv renderer requires data source to have raster attribute table";var a=this.attributeField||this.field1||this.field,b=this.infos||this.uniqueValueInfos;this.defaultColor=
this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var f=c.fields.filter(function(y){return"value"===y.name.toLowerCase()})[0];if(f)var g=f.name;a||((a=c.fields.filter(function(y){return-1<["classname","category"].indexOf(y.name.toLowerCase())})[0])||(a=c.fields.filter(function(y){return"esriFieldTypeString"===y.type})[0]),this.alias=(this.field=a=a&&a.name||g)&&a.alias||g);var h=[],d;if(!b){b=[];var m=c.fields.filter(function(y){return"alpha"===y.name.toLowerCase()})[0];var p=c.fields.filter(function(y){return"red"===
y.name.toLowerCase()})[0];var v=c.fields.filter(function(y){return"green"===y.name.toLowerCase()})[0];var q=c.fields.filter(function(y){return"blue"===y.name.toLowerCase()})[0];for(f=0;f<c.features.length;f++){var w=c.features[f].attributes;(d=b.some(function(y){y.value===w[a]}))||(m&&p&&v&&q?b.push({value:w[a],alias:w[a],color:[w[p.name],w[v.name],w[q.name],w[m.name]]}):p&&v&&q?b.push({value:w[a],alias:w[a],color:[w[p.name],w[v.name],w[q.name]]}):b.push({value:w[a],alias:w[a]}))}if(!(p&&v&&q))for(d=
k.createRandomColorRamp({size:b.length}),f=0;f<b.length;f++)b[f].color=d[f];this.uniqueValueInfos=b}if(b)b.forEach(function(y){h=h.concat(c.features.filter(function(x){return y.value==x.attributes[a]}).map(function(x){return[x.attributes[g]].concat(y.color||y.symbol&&y.symbol.color)}))}),this.defaultColor&&c.features.filter(function(y){h.some(function(x){return x[0]===y.attributes[g]})||h.push([y.attributes[g]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";this._function=
new l({colormap:h});this.colormap=h;this._function.outputPixelType="U8";this._function.renderTexture=!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(e){e=this._clonePixelData(e);return e=this._function._colorize(e)},drawGL:function(e){this._function._colorizeGL(e)},toJson:function(e){var c={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};e&&(c.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:c}},
toCommonRendererJson:function(){var e=this.attributeField||this.field1||this.field,c=(this.infos||this.uniqueValueInfos).map(function(a){return{value:a.value,label:a.alias+"",symbol:{color:3===a.color.length?a.color.concat([255]):a.color,type:"esriSFS",style:"esriSFSSolid"}}});return{type:"uniqueValue",field1:e,uniqueValueInfos:c}}})})},"esri/layers/rasterLib/renderer/RasterRGBRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/rasterUtils".split(" "),
function(H,n,t,l,k,e){return H([t],{declaredClass:"esri.layers.rasterLib.renderer.RasterRGBRenderer",rendererName:"RGB",bandIndex:null,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(c){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
c=n.mixin({},c,{stretchType:this.stretchType});this._stretchFunction=new l(c);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this.bandIndex=c.bandIndex||c.BandIndex;this._function=new k(c);this._function.functionArguments.raster=this._stretchFunction;this._function.renderTexture=!0},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},draw2D:function(c){this._updateStretchParameters();c=this._clonePixelData(c);if("U8"===c.pixelBlock.pixelType&&
!this.contrastOffset&&!this.brightnessOffset)return c;this._stretchFunction._stretch(c);var a=c.pixelBlock,b=this.bandIndex,f=Math.max.apply(null,b);a&&a.pixels.length>f&&b&&(a.pixels=b.map(function(g){return a.pixels[g]}),a.statistics&&(a.statistics=b.map(function(g){return a.statistics[g]})));if(this.contrastOffset||this.brightnessOffset)c.pixelBlock=e.contrastBrightnessStretch(c.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return c},drawGL:function(c){this._updateStretchParameters();
c.pixelBlock&&(c=this._clonePixelData(c));var a=c.pixelBlock,b=this.bandIndex,f=Math.max.apply(null,b),g=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,h=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,d,m;a&&a.pixels.length>f&&b&&(a.pixels=b.map(function(p){return a.pixels[p]}),a.statistics&&(a.statistics=b.map(function(p){return a.statistics[p]})),g&&0<g.length&&
g.length!==b.length&&(d=b.map(function(p){return g[p]})),h&&0<h.length&&h.length!==b.length&&(m=b.map(function(p){return h[p]})));this._stretchFunction.functionArguments.statistics=d||g;this._stretchFunction.functionArguments.histograms=m||h;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._function.renderTexture=!0,c=this._stretchFunction._stretchGL(c),this._function._cbGL(c)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(c))},toJson:function(){var c=
this._stretchFunction.toJson().rasterFunctionArguments;c.bandIndex=this.bandIndex;c.contrastOffset=this.contrastOffset;c.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:c}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:n.clone(this.statistics),
dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,gamma:n.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var c=this._stretchFunction.functionArguments;c.stretchType=this.stretchType;c.min=this.min;c.max=this.max;c.numberOfStandardDeviations=this.numberOfStandardDeviations;c.statistics=this.statistics;c.histograms=this.histograms;c.dra=this.dra;c.minPercent=this.minPercent;
c.maxPercent=this.maxPercent;c.useGamma=this.useGamma;c.gamma=this.gamma;c.computeGamma=this.computeGamma;this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterStretchColorRampRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/ResampleFunction ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(H,n,t,l,k,e,c,a){return H([t],
{declaredClass:"esri.layers.rasterLib.renderer.RasterStretchColorRampRenderer",rendererName:"Stretch",bandIndex:[0],colorRamp:null,invert:!1,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(b){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
b=n.mixin({},b,{stretchType:this.stretchType});Object.keys(b).forEach(function(f){null==b[f]&&delete b[f]});this._function=new e(b);this._stretchFunction=new k(b);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this._clrFunction=new c(b);this._clrFunction.functionArguments.raster=this._stretchFunction;this._clrFunction.renderTexture=!1;this._function.functionArguments.raster=this._clrFunction},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},
draw2D:function(b){this._updateStretchParameters();b=this._clonePixelData(b);if("U8"===b.pixelBlock.pixelType&&!(this.contrastOffset||this.brightnessOffset||this.colorRamp))return b;this._stretchFunction._stretch(b);var f=b.pixelBlock,g=this.bandIndex?this.bandIndex[0]:0;f&&1<f.pixels.length&&f.pixels.length>g&&(f.pixels=[f.pixels[g]],f.statistics&&(f.statistics=[f.statistics[g]]));this.colorRamp&&(b=this._clrFunction._colorize(b));if(this.contrastOffset||this.brightnessOffset)b.pixelBlock=a.contrastBrightnessStretch(b.pixelBlock,
{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return b},drawGL:function(b){this._updateStretchParameters();b.pixelBlock&&(b=this._clonePixelData(b));var f=b.pixelBlock,g=this.bandIndex?this.bandIndex[0]||0:0,h=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,d=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,m,p;f&&1<f.pixels.length&&
f.pixels.length>g&&(f.pixels=[f.pixels[g]],f.statistics&&(f.statistics=[f.statistics[g]]),h&&h.length>g&&(m=[h[g]]),d&&d.length>g&&(p=[d[g]]));this._stretchFunction.functionArguments.statistics=m||h;this._stretchFunction.functionArguments.histograms=p||d;f=!!this.colorRamp;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!1,this._function.renderTexture=!0,b=this._stretchFunction._stretchGL(b),f&&(b=this._clrFunction._colorizeGL(b)),
this._function._cbGL(b)):f?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!0,b=this._stretchFunction._stretchGL(b),this._clrFunction._colorizeGL(b)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(b))},toJson:function(){var b=this._stretchFunction.toJson().rasterFunctionArguments;b.colorRamp=this.colorRamp||"";this.invert&&(b.invert=!0);b.contrastOffset=this.contrastOffset;b.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,
rendererArguments:b}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp,min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:n.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,
gamma:n.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var b=this._stretchFunction.functionArguments;b.stretchType=this.stretchType;b.min=this.min;b.max=this.max;b.numberOfStandardDeviations=this.numberOfStandardDeviations;b.statistics=this.statistics;b.histograms=this.histograms;b.dra=this.dra;b.minPercent=this.minPercent;b.maxPercent=this.maxPercent;b.useGamma=this.useGamma;b.gamma=this.gamma;b.computeGamma=this.computeGamma;
this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterClassBreaksRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../function/RemapFunction"],function(H,n,t,l,k){return H([t],{declaredClass:"esri.layers.rasterLib.renderer.RasterClassBreaksRenderer",rendererName:"ClassBreaks",renderTexture:!0,constructor:function(e){e=e||{};this._function=new k(e);this._function.outputPixelType="U8";var c=
e.classBreakInfos;e=e.minValue;null!=e&&c&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(e,c))},bind:function(e){this.inherited(arguments);this.isColormapFunction=!1;var c=this.raster&&this.raster.rasterInfo||this._rawRasterInfo,a=c&&c.vat;if(a&&"u8"===c.pixelType.toLowerCase()&&this.classBreakInfos){var b=this.field;if(c=a.fields.filter(function(p){return"value"===p.name.toLowerCase()})[0])var f=c.name;var g=a.features.sort(function(p,v){return parseFloat(p.attributes[b])-
parseFloat(v.attributes[b])})[0].attributes[b];this.isColormapFunction=!0;var h=[],d=this.field,m=this.classBreakInfos;m.forEach(function(p,v){a.features.forEach(function(q){var w=m[v-1]&&m[v-1].classMaxValue||g;q.attributes[d]<=p.classMaxValue&&(q.attributes[d]>w||q.attributes[d]===g)&&(w=p.symbol.color,h.some(function(y){return y[0]===q.attributes[f]})||h.push([q.attributes[f]].concat(w)))})});this._function=new l({colormap:h});this.colormap=h;this._function.outputPixelType="U8";this._function.renderTexture=
!0}this._function&&this._function.setProcessingContext(n.mixin({useProcessedData:!0},this._processingContext))},draw2D:function(e){if(this.isColormapFunction)return this._updateColormapParameters(),e=this._clonePixelData(e),e=this._function._colorize(e);this._updateRemapParameters();return this._function._remap(e)},drawGL:function(e){this.isColormapFunction?(this._updateColormapParameters(),this._function._colorizeGL(e)):(this._function.renderTexture=!0,this._updateRemapParameters(),this._function._remapGL(e))},
toJson:function(){var e=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:e}},toCommonRendererJson:function(){var e,c=this.classBreakInfos,a=this.colorBreaks;if(null==c&&a)for(c=[],e=0;e<a.length-1;e++)c.push({classMaxValue:a[e+1].value,symbol:{color:a[e].mappedColor,type:"esriSFS",style:"esriSFSSolid"},label:a[e].value+" - "+a[e+1].value});return{type:"classBreaks",field:"Value",minValue:null!=this.minValue?this.minValue:a[0].value,classBreakInfos:c}},
_updateRemapParameters:function(){var e=this.classBreakInfos,c=this.minValue;null!=c&&e&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(c,e))},_getSortedColorBreaks:function(e,c){c=c.map(function(b){return{maxValue:b.classMaxValue,color:b.symbol.color}}).sort(function(b,f){return b.maxValue-f.maxValue});var a=[{value:e,mappedColor:c[0].color}];for(e=0;e<c.length;e++)a.push({value:c[e].maxValue,mappedColor:e===c.length-1?c[e].color:c[e+1].color});return a},_updateColormapParameters:function(){this._function.functionArguments.colormap=
this.colormap;this._function.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterShadedReliefRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/HillshadeFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(H,n,t,l,k,e,c){return H([t],{declaredClass:"esri.layers.rasterLib.renderer.RasterShadedReliefRenderer",rendererName:"ShadedRelief",hillshadeType:null,azimuth:315,
altitude:45,zFactor:1,slopeType:null,psPower:.664,psFactor:.024,raster:null,constructor:function(a){this.hillshadeType="number"===typeof this.hillshadeType?this.hillshadeType:["traditional","multi-directional"].indexOf(this.hillshadeType);a&&a.scalingType&&(this.slopeType="adjusted"===a.scalingType?3:1);a&&a.pixelSizePower&&(this.psPower=a.pixelSizePower);a&&a.pixelSizeFactor&&(this.psFactor=a.pixelSizeFactor);a=n.mixin({},a,{hillshadeType:this.hillshadeType,psPower:this.psPower,psFactor:this.psFactor,
slopeType:this.slopeType});Object.keys(a).forEach(function(b){null==a[b]&&delete a[b]});this._function=new k(a);this._hillshadeFunction=new l(a);this._hillshadeFunction.outputPixelType="U8";this._hillshadeFunction.renderTexture=!1;this._function.functionArguments.raster=this._hillshadeFunction},hasTilingEffects:function(){return this._hillshadeFunction.hasTilingEffects()},draw2D:function(a){this._updateHillshadeParameters();a=this._clonePixelData(a);a=this._hillshadeFunction.read2D({raster:a});if(this.contrastOffset||
this.brightnessOffset)a.pixelBlock=c.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return a},drawGL:function(a){this._updateHillshadeParameters();this.contrastOffset||this.brightnessOffset?(this._hillshadeFunction.renderTexture=!1,this._function.renderTexture=!0,a=this._hillshadeFunction.readGL({raster:a}),this._function._cbGL(a)):(this._hillshadeFunction.renderTexture=!0,this._hillshadeFunction.readGL({raster:a}))},toJson:function(){var a=
this._hillshadeFunction.toJson().rasterFunctionArguments;a.colorRamp=this.colorRamp||"";this.invert&&(a.invert=!0);a.contrastOffset=this.contrastOffset;a.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:a}},toCommonRendererJson:function(){return{type:"rasterShadedRelief",hillshadeType:["traditional","multi-directional"][this.hillshadeType]||"traditional",azimuth:this.azimuth,altitude:this.altitude,zFactor:this.zFactor,scalingType:3===this.slopeType?"adjusted":
"none",pixelSizePower:this.psPower,pixelSizeFactor:this.psFactor,colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp}},_updateHillshadeParameters:function(){var a=this._hillshadeFunction.functionArguments;a.hillshadeType=this.hillshadeType;a.azimuth=this.azimuth;a.altitude=this.altitude;a.zFactor=this.zFactor;a.slopeType=this.slopeType;a.psPower=this.psPower;a.psFactor=this.psFactor}})})},"esri/layers/rasterLib/raster/rasterProjectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/sniff ../../../kernel ../../../WKIDUnitConversion ../../../geometry/Extent ../../../geometry/projection ../../../geometry/webMercatorUtils ../../../SpatialReference ../../../geometry/Point".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g){H={requirePE:function(d,m){return!(d.equals(m)||d._canProject(m))},load:function(){var d=new t;if(!this._loadPromise)if(a.isSupported())this._loadPromise=a.load();else{var m=new t;m.reject("projection engine is not supported on this version of the browser, please try with a modern browser");this._loadPromise=m.promise}this._loadPromise.isFulfilled()?this._loadPromise.isResolved()?d.resolve():this._loadPromise.isRejected()&&d.resolve():(this._pendingdfds=this._pendingdfds||
[],this._pendingdfds.push(d),this._loadPromise.then(n.hitch(this,function(){this._pendingdfds.forEach(function(p){p.isFulfilled()||p.resolve()})}),n.hitch(this,function(){this._pendingdfds.forEach(function(p){p.isFulfilled()||p.reject()})})));return d.promise},computeError:function(d,m){return[Math.abs((d[0]+d[4]+d[4*m.rows]+d[4*m.rows+4])/4-d[2*m.rows+2]),Math.abs((d[1]+d[5]+d[4*m.rows+1]+d[4*m.rows+5])/4-d[2*m.rows+3])]},getDefaultDatumTransformationForDataset:function(d,m,p){if(!(m&&d.spatialReference&&
this.requirePE(d.spatialReference,m)&&a.isLoaded()))return null;d=new c(d.toJson());m=new f(m.toJson());return p?a.getTransformation(m,d.spatialReference,d):a.getTransformation(d.spatialReference,m,d)},project:function(d,m,p){if(!m||d.spatialReference.equals(m))return d;var v=a.isLoaded()?a:b;"esri.geometry.Extent"===d.declaredClass?d=new c(d.toJson()):"esri.geometry.Point"===d.declaredClass&&(d=new g(d.toJson()));m=new f(m.toJson());(d=v.project(d,m))&&"esri.geometry.Extent"===d.declaredClass?(d=
new c(d.toJson()),p&&(1E-5>Math.abs(d.xmin+180)&&1E-5>Math.abs(d.xmax-180)?(d.xmin=0,d.xmax=360):(0>d.xmin&&(d.xmin+=360,d.xmax+=360),0>d.xmax&&(d.xmax+=360)))):d&&"esri.geometry.Point"===d.declaredClass&&(d=new g(d.toJson()),p&&0>d.x&&(d.x+=360));return d},projectResolution:function(d,m,p){var v=p.xmin+(p.xmax-p.xmin)/2;p=p.ymin+(p.ymax-p.ymin)/2;d=new c(v,p,v+d.x,p+d.y,d.spatialReference);d=this.project(d,m);return new g(d.xmax-d.xmin,d.ymax-d.ymin,m)},getProjectionOffsetGrid:function(d,m,p,v,q,
w,y){null==y&&(y=[32,32]);var x=d.xmin,E=d.ymin,B=d.xmax,C=d.ymax,G=d.spatialReference,I=m.spatialReference,D=a.isLoaded()?a:b,r=q?-q:null,u=y[0]*p.x,A=y[1]*p.y;B={cols:Math.ceil((B-x)/u)+1,rows:Math.ceil((C-E)/A)+1};d=[];for(C=0;C<B.cols;C++){var J=O;var O=[];for(p=0;p<B.rows;p++){var P=new g({x:x+u*C,y:E+A*p,spatialReference:G});P=D.project(P,I,w);if(!P)return null;v&&0>P.x&&(P.x+=360);O.push(P);0<C&&null!=r&&P.x<J[p].x&&(P.x+=q-r,P.x<J[p].x&&(P.x+=q-r));d.push((P.x-m.xmin)/(m.xmax-m.xmin));d.push((P.y-
m.ymin)/(m.ymax-m.ymin))}}m=this.computeError(d,B);v=new Float32Array((B.cols-1)*(B.rows-1)*12);q=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);w=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(C=0;C<B.cols-1;C++)for(p=0;p<B.rows-1;p++){u=C*B.rows*2+2*p;x=d[u];E=d[u+1];O=d[u+2];G=d[u+3];u+=2*B.rows;I=d[u];D=d[u+1];r=d[u+2];A=d[u+3];J=0;P=12*(p*(B.cols-1)+C);for(u=0;3>u;u++)v[P++]=q[J++]*x+q[J++]*O+q[J++]*r;for(u=J=0;3>u;u++)v[P++]=q[J++]*E+q[J++]*G+q[J++]*A;for(u=J=0;3>u;u++)v[P++]=w[J++]*x+w[J++]*I+w[J++]*
r;for(u=J=0;3>u;u++)v[P++]=w[J++]*E+w[J++]*D+w[J++]*A}return{offsets:d,error:m,coefficients:v,spacing:y,size:[B.cols-1,B.rows-1]}},getHalfWorldWidth:function(d){var m=d&&d.wkid;if(null!=m)return d.isWebMercator()&&(m=3857),null==e[m]?180:h[m]}};l("extend-esri")&&n.setObject("layers.rasterLib.raster.rasterProjectionHelper",H,k);var h={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3832:3339584.723798206,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,
6933:1.7367530445161372E7,8858:7396237.374497803,8859:2465412.4581659334,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53025:7276828.3848298555,53031:1.0384677558821043E7,53034:2.001508679602057E7,53036:7389443.187332862,53037:2463147.729110953,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,
54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54025:7311399.09166516,54031:1.0396310810074743E7,54034:2.0037508342789244E7,54050:808820.9223376509,54053:1920897.3915568967,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54099:1.3524439768288724E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7,102038:4297258.582585486,102299:5013965.117483125};return H})},"esri/geometry/projection":function(){define("require exports dojo/Deferred ./pe ../SpatialReference ./GeographicTransformation".split(" "),
function(H,n,t,l,k,e){function c(h,d,m,p,v){void 0===p&&(p=null);void 0===v&&(v=!1);if(null===p){var q=e.cacheKey(d,m);void 0!==g[q]?p=g[q]:(p=a(d,m,null),null===p&&(p=new e),g[q]=p)}return b._project(h,d,m instanceof k||!1===v?m:new k(m),p,v)}function a(h,d,m){void 0===m&&(m=null);h=b._getTransformation(h,d,m);return null!==h?e.fromGE(h):null}Object.defineProperty(n,"__esModule",{value:!0});var b=null;n.isLoaded=function(){return!!b&&l.isLoaded()};n.isSupported=function(){return l.isSupported()};
var f=null;n.load=function(){if(f)return f.promise;f=new t;var h=l.load();H(["./geometryEngine"],function(d){b=d;h.then(function(){b._enableProjection(l);f.resolve()},function(m){f.reject(m)})});return f.promise};n.project=function(h,d,m){void 0===m&&(m=null);return h instanceof Array?0===h.length?[]:c(h,h[0].spatialReference,d,m):c([h],h.spatialReference,d,m)[0]};var g={};n.projectMany=c;n.getTransformation=a;n.getTransformations=function(h,d,m){void 0===m&&(m=null);h=b._getTransformationBySuitability(h,
d,m);if(null!==h){d=[];for(m=0;m<h.length;m++)d.push(e.fromGE(h[m]));return d}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","dojo/Deferred","../core/sniff"],function(H,n,t,l,k){function e(q){function w(B,C,G){B[C]=G(B[C])}n._pe=q;h.init();d.init();m.init();p.init();v.init();n.PeGCSExtent=function(B){function C(){return null!==B&&B.apply(this,arguments)||this}t(C,B);C.prototype.destroy=function(){n._pe.destroy(this)};return C}(n._pe.PeGCSExtent);
for(var y=0,x=[n._pe.PeDatum,n._pe.PeGeogcs,n._pe.PeGeogtran,n._pe.PeObject,n._pe.PeParameter,n._pe.PePrimem,n._pe.PeProjcs,n._pe.PeSpheroid,n._pe.PeUnit];y<x.length;y++)q=x[y],w(q.prototype,"getName",function(B){return function(){return B.call(this,Array(h.PE_NAME_MAX))}});y=0;for(x=[n._pe.PeGeogtran,n._pe.PeProjcs];y<x.length;y++)q=x[y],w(q.prototype,"getParameters",function(B){return function(){for(var C=Array(h.PE_PARM_MAX),G=B.call(this),I=0;I<C.length;I++){var D=n._pe.getValue(G,"*");C[I]=D?
n._pe.wrapPointer(D,n._pe.PeParameter):null;G+=Int32Array.BYTES_PER_ELEMENT}return C}});w(n._pe.PeHorizon.prototype,"getCoord",function(B){return function(){var C=this.getSize();if(!C)return null;var G=[],I=B.call(this);f(G,C,I);return G}});w(n._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(B){var C=n._pe._pe_getPeGTlistExtendedGTsSize();return function(){var G=null,I=B.call(this);if(!n._pe.compare(I,n._pe.NULL)){G=[I];var D=this.getSteps();if(1<D){I=n._pe.getPointer(I);for(var r=1;r<D;r++)G.push(n._pe.wrapPointer(I+
C*r,n._pe.PeGTlistExtendedGTs))}}return G}});var E=n._pe._pe_getPeHorizonSize();q=function(B){return function(){var C=this._cache;C||(this._cache=C=new Map);if(C.has(B))return C.get(B);var G=null,I=B.call(this);if(!n._pe.compare(I,n._pe.NULL)){G=[I];var D=I.getNump();if(1<D){I=n._pe.getPointer(I);for(var r=1;r<D;r++)G.push(n._pe.wrapPointer(I+E*r,n._pe.PeHorizon))}}C.set(B,G);return G}};w(n._pe.PeProjcs.prototype,"horizonGcsGenerate",q);w(n._pe.PeProjcs.prototype,"horizonPcsGenerate",q);n._pe.PeObject.prototype.toString=
function(B){void 0===B&&(B=h.PE_STR_OPTS_NONE);n._pe.ensureCache.prepare();var C=n._pe.getPointer(this),G=n._pe.ensureInt8(Array(h.PE_BUFFER_MAX));return n._pe.UTF8ToString(n._pe._pe_object_to_string_ext(C,B,G))}}function c(q){if(q){var w=n._pe.getClass(q);w&&(w=n._pe.getCache(w))&&(q=n._pe.getPointer(q))&&delete w[q]}}function a(q,w){var y=[];w=Array(w);for(var x=0;x<q;x++)y.push(n._pe.ensureInt8(w));return y}function b(q){if(Array.isArray(q[0])){var w=[];q.forEach(function(y){w.push(y[0],y[1])})}else w=
q;return w}function f(q,w,y,x){void 0===x&&(x=!1);if(x)for(x=0;x<2*w;x++)q[x]=n._pe.getValue(y+x*Float64Array.BYTES_PER_ELEMENT,"double");else{var E=0===q.length;for(x=0;x<w;x++)E&&(q[x]=Array(2)),q[x][0]=n._pe.getValue(y,"double"),q[x][1]=n._pe.getValue(y+Float64Array.BYTES_PER_ELEMENT,"double"),y+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(n,"__esModule",{value:!0});var g;n._pe=null;n.isLoaded=function(){return!!n._pe};n.isSupported=function(){return!!k("esri-wasm")};n.load=function(){if(g)return g.promise;
g=new l;H(["./support/pe-wasm"],function(q){q({locateFile:function(w){return H.toUrl("./support/"+w)},onAbort:function(w){g.reject(Error(w))}}).then(function(w){e(w);g.resolve()})});return g.promise};(function(q){function w(E,B,C){n._pe.ensureCache.prepare();var G=b(C),I=C===G;G=n._pe.ensureFloat64(G);(E=n._pe._pe_geog_to_proj(n._pe.getPointer(E),B,G))&&f(C,B,G,I);return E}function y(E,B,C){return x(E,B,C,0)}function x(E,B,C,G){n._pe.ensureCache.prepare();var I=b(C),D=C===I;I=n._pe.ensureFloat64(I);
(E=n._pe._pe_proj_to_geog_center(n._pe.getPointer(E),B,I,G))&&f(C,B,I,D);return E}q.geogToProj=w;q.projGeog=function(E,B,C,G){switch(G){case h.PE_TRANSFORM_P_TO_G:return y(E,B,C);case h.PE_TRANSFORM_G_TO_P:return w(E,B,C)}return 0};q.projToGeog=y;q.projToGeogCenter=x})(n.PeCSTransformations||(n.PeCSTransformations={}));var h;(function(q){q.init=function(){q.PE_BUFFER_MAX=n._pe.PeDefs.prototype.PE_BUFFER_MAX;q.PE_NAME_MAX=n._pe.PeDefs.prototype.PE_NAME_MAX;q.PE_MGRS_MAX=n._pe.PeDefs.prototype.PE_MGRS_MAX;
q.PE_USNG_MAX=n._pe.PeDefs.prototype.PE_USNG_MAX;q.PE_DD_MAX=n._pe.PeDefs.prototype.PE_DD_MAX;q.PE_DDM_MAX=n._pe.PeDefs.prototype.PE_DDM_MAX;q.PE_DMS_MAX=n._pe.PeDefs.prototype.PE_DMS_MAX;q.PE_UTM_MAX=n._pe.PeDefs.prototype.PE_UTM_MAX;q.PE_PARM_MAX=n._pe.PeDefs.prototype.PE_PARM_MAX;q.PE_TYPE_NONE=n._pe.PeDefs.prototype.PE_TYPE_NONE;q.PE_TYPE_GEOGCS=n._pe.PeDefs.prototype.PE_TYPE_GEOGCS;q.PE_TYPE_PROJCS=n._pe.PeDefs.prototype.PE_TYPE_PROJCS;q.PE_TYPE_GEOGTRAN=n._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;
q.PE_TYPE_COORDSYS=n._pe.PeDefs.prototype.PE_TYPE_COORDSYS;q.PE_TYPE_UNIT=n._pe.PeDefs.prototype.PE_TYPE_UNIT;q.PE_STR_OPTS_NONE=n._pe.PeDefs.prototype.PE_STR_OPTS_NONE;q.PE_STR_AUTH_NONE=n._pe.PeDefs.prototype.PE_STR_AUTH_NONE;q.PE_STR_AUTH_TOP=n._pe.PeDefs.prototype.PE_STR_AUTH_TOP;q.PE_STR_NAME_CANON=n._pe.PeDefs.prototype.PE_STR_NAME_CANON;q.PE_PARM_X0=n._pe.PeDefs.prototype.PE_PARM_X0;q.PE_PARM_ND=n._pe.PeDefs.prototype.PE_PARM_ND;q.PE_TRANSFORM_1_TO_2=n._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;
q.PE_TRANSFORM_2_TO_1=n._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;q.PE_TRANSFORM_P_TO_G=n._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;q.PE_TRANSFORM_G_TO_P=n._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;q.PE_HORIZON_RECT=n._pe.PeDefs.prototype.PE_HORIZON_RECT;q.PE_HORIZON_POLY=n._pe.PeDefs.prototype.PE_HORIZON_POLY;q.PE_HORIZON_LINE=n._pe.PeDefs.prototype.PE_HORIZON_LINE;q.PE_HORIZON_DELTA=n._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(h=n.PeDefs||(n.PeDefs={}));(function(q){function w(B,C){var G=null,I=x[B];
I||(I={},x[B]=I);I.hasOwnProperty(String(C))?G=I[C]:(B=n._pe.PeFactory.prototype.factoryByType(B,C),n._pe.compare(B,n._pe.NULL)||(G=B,I[C]=G));return G=y(G)}function y(B){if(B){var C=B.getType();switch(C){case h.PE_TYPE_GEOGCS:B=n._pe.castObject(B,n._pe.PeGeogcs);break;case h.PE_TYPE_PROJCS:B=n._pe.castObject(B,n._pe.PeProjcs);break;case h.PE_TYPE_GEOGTRAN:B=n._pe.castObject(B,n._pe.PeGeogtran);break;default:C&h.PE_TYPE_UNIT&&(B=n._pe.castObject(B,n._pe.PeUnit))}}return B}var x={},E={};q.initialize=
function(){n._pe.PeFactory.prototype.initialize(null)};q.coordsys=function(B){return w(h.PE_TYPE_COORDSYS,B)};q.factoryByType=w;q.fromString=function(B,C){var G=null,I=E[B];I||(I={},E[B]=I);I.hasOwnProperty(C)?G=I[C]:(B=n._pe.PeFactory.prototype.fromString(B,C),n._pe.compare(B,n._pe.NULL)||(G=B,I[C]=G));return G=y(G)};q.geogcs=function(B){return w(h.PE_TYPE_GEOGCS,B)};q.geogtran=function(B){return w(h.PE_TYPE_GEOGTRAN,B)};q.getCode=function(B){return n._pe.PeFactory.prototype.getCode(B)};q.projcs=
function(B){return w(h.PE_TYPE_PROJCS,B)};q.unit=function(B){return w(h.PE_TYPE_UNIT,B)}})(n.PeFactory||(n.PeFactory={}));n.PeGCSExtent=null;var d;(function(q){var w;q.init=function(){q.PE_GTLIST_OPTS_COMMON=n._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;w=n._pe._pe_getPeGTlistExtendedEntrySize()};q.getGTlist=function(y,x,E,B,C,G){var I=null,D=new n._pe.PeInteger(G);try{var r=n._pe.PeGTlistExtended.prototype.getGTlist(y,x,E,B,C,D);if(G=D.val)if(I=[r],1<G){var u=n._pe.getPointer(r);for(y=1;y<
G;y++)I.push(n._pe.wrapPointer(u+w*y,n._pe.PeGTlistExtendedEntry))}}finally{n._pe.destroy(D)}return I}})(d=n.PeGTlistExtended||(n.PeGTlistExtended={}));(function(q){q.destroy=function(w){if(w&&w.length){for(var y=0;y<w.length;y++){var x=w[y];c(x);x.getEntries().forEach(function(E){c(E);E=E.getGeogtran();c(E);E.getParameters().forEach(c);[E.getGeogcs1(),E.getGeogcs2()].forEach(function(B){c(B);var C=B.getDatum();c(C);c(C.getSpheroid());c(B.getPrimem());c(B.getUnit())})})}n._pe.PeGTlistExtendedEntry.prototype.Delete(w[0])}}})(n.PeGTlistExtendedEntry||
(n.PeGTlistExtendedEntry={}));(function(q){q.geogToGeog=function(w,y,x,E,B){n._pe.ensureCache.prepare();var C=b(x),G=x===C;C=n._pe.ensureFloat64(C);var I=0;E&&(I=n._pe.ensureFloat64(E));(w=n._pe._pe_geog_to_geog(n._pe.getPointer(w),y,C,I,B))&&f(x,y,C,G);return w}})(n.PeGTTransformations||(n.PeGTTransformations={}));(function(q){function w(x,E,B,C,G,I){n._pe.ensureCache.prepare();switch(x){case "dd":var D=n._pe._pe_geog_to_dd;var r=h.PE_DD_MAX;break;case "ddm":D=n._pe._pe_geog_to_ddm;r=h.PE_DDM_MAX;
break;case "dms":D=n._pe._pe_geog_to_dms,r=h.PE_DMS_MAX}x=0;E&&(x=n._pe.getPointer(E));E=b(C);E=n._pe.ensureFloat64(E);r=a(B,r);C=n._pe.ensureInt32(r);if(G=D(x,B,E,G,C))for(D=0;D<B;D++)I[D]=n._pe.UTF8ToString(r[D]);return G}function y(x,E,B,C,G){n._pe.ensureCache.prepare();switch(x){case "dd":var I=n._pe._pe_dd_to_geog;break;case "ddm":I=n._pe._pe_ddm_to_geog;break;case "dms":I=n._pe._pe_dms_to_geog}x=0;E&&(x=n._pe.getPointer(E));E=C.map(function(D){return n._pe.ensureString(D)});C=n._pe.ensureInt32(E);
E=n._pe.ensureFloat64(Array(2*B));(I=I(x,B,C,E))&&f(G,B,E);return I}q.geog_to_dms=function(x,E,B,C,G){return w("dms",x,E,B,C,G)};q.dms_to_geog=function(x,E,B,C){return y("dms",x,E,B,C)};q.geog_to_ddm=function(x,E,B,C,G){return w("ddm",x,E,B,C,G)};q.ddm_to_geog=function(x,E,B,C){return y("ddm",x,E,B,C)};q.geog_to_dd=function(x,E,B,C,G){return w("dd",x,E,B,C,G)};q.dd_to_geog=function(x,E,B,C){return y("dd",x,E,B,C)}})(n.PeNotationDms||(n.PeNotationDms={}));var m;(function(q){q.init=function(){q.PE_MGRS_STYLE_NEW=
n._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;q.PE_MGRS_STYLE_OLD=n._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;q.PE_MGRS_STYLE_AUTO=n._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;q.PE_MGRS_180_ZONE_1_PLUS=n._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;q.PE_MGRS_ADD_SPACES=n._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};q.geog_to_mgrs_extended=function(w,y,x,E,B,C,G){n._pe.ensureCache.prepare();var I=0;w&&(I=n._pe.getPointer(w));w=b(x);x=n._pe.ensureFloat64(w);w=a(y,h.PE_MGRS_MAX);
var D=n._pe.ensureInt32(w);if(E=n._pe._pe_geog_to_mgrs_extended(I,y,x,E,B,C,D))for(B=0;B<y;B++)G[B]=n._pe.UTF8ToString(w[B]);return E};q.mgrs_to_geog_extended=function(w,y,x,E,B){n._pe.ensureCache.prepare();var C=0;w&&(C=n._pe.getPointer(w));w=x.map(function(G){return n._pe.ensureString(G)});x=n._pe.ensureInt32(w);w=n._pe.ensureFloat64(Array(2*y));(E=n._pe._pe_mgrs_to_geog_extended(C,y,x,E,w))&&f(B,y,w);return E}})(m=n.PeNotationMgrs||(n.PeNotationMgrs={}));(function(q){q.geog_to_usng=function(w,
y,x,E,B,C,G){n._pe.ensureCache.prepare();var I=0;w&&(I=n._pe.getPointer(w));w=b(x);x=n._pe.ensureFloat64(w);w=a(y,h.PE_MGRS_MAX);var D=n._pe.ensureInt32(w);if(E=n._pe._pe_geog_to_usng(I,y,x,E,B,C,D))for(B=0;B<y;B++)G[B]=n._pe.UTF8ToString(w[B]);return E};q.usng_to_geog=function(w,y,x,E){n._pe.ensureCache.prepare();var B=0;w&&(B=n._pe.getPointer(w));w=x.map(function(C){return n._pe.ensureString(C)});x=n._pe.ensureInt32(w);w=n._pe.ensureFloat64(Array(2*y));(B=n._pe._pe_usng_to_geog(B,y,x,w))&&f(E,y,
w);return B}})(n.PeNotationUsng||(n.PeNotationUsng={}));var p;(function(q){q.init=function(){q.PE_UTM_OPTS_NONE=n._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;q.PE_UTM_OPTS_ADD_SPACES=n._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;q.PE_UTM_OPTS_NS=n._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};q.geog_to_utm=function(w,y,x,E,B){n._pe.ensureCache.prepare();var C=0;w&&(C=n._pe.getPointer(w));w=b(x);x=n._pe.ensureFloat64(w);w=a(y,h.PE_UTM_MAX);var G=n._pe.ensureInt32(w);if(E=n._pe._pe_geog_to_utm(C,
y,x,E,G))for(C=0;C<y;C++)B[C]=n._pe.UTF8ToString(w[C]);return E};q.utm_to_geog=function(w,y,x,E,B){n._pe.ensureCache.prepare();var C=0;w&&(C=n._pe.getPointer(w));w=x.map(function(G){return n._pe.ensureString(G)});x=n._pe.ensureInt32(w);w=n._pe.ensureFloat64(Array(2*y));(E=n._pe._pe_utm_to_geog(C,y,x,E,w))&&f(B,y,w);return E}})(p=n.PeNotationUtm||(n.PeNotationUtm={}));var v;(function(q){var w=new Map;q.init=function(){q.PE_PCSINFO_OPTION_NONE=n._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;q.PE_PCSINFO_OPTION_DOMAIN=
n._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;q.PE_POLE_OUTSIDE_BOUNDARY=n._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;q.PE_POLE_POINT=n._pe.PePCSInfo.prototype.PE_POLE_POINT};q.generate=function(y,x){void 0===x&&(x=q.PE_PCSINFO_OPTION_DOMAIN);var E;if(w.has(y)){var B=w.get(y);B[x]&&(E=B[x])}E||(E=n._pe.PePCSInfo.prototype.generate(y,x),B||(B=[],w.set(y,B)),B[x]=E);return E}})(v=n.PePCSInfo||(n.PePCSInfo={}));(function(q){q.version_string=function(){return n._pe.PeVersion.prototype.version_string()}})(n.PeVersion||
(n.PeVersion={}));n._init=e})},"esri/core/tsSupport/extendsHelper":function(){define([],function(){return function(){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var l in t)t.hasOwnProperty(l)&&(n[l]=t[l])};return function(n,t){function l(){this.constructor=n}H(n,t);n.prototype=null===t?Object.create(t):(l.prototype=t.prototype,new l)}}()})},"esri/geometry/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],
function(H,n,t){return function(){function l(k){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(k&&k.steps){var e=0;for(k=k.steps;e<k.length;e++){var c=k[e];c instanceof t?this.steps.push(c):this.steps.push(new t({wkid:c.wkid,wkt:c.wkt,isInverse:c.isInverse}))}}}l.cacheKey=function(k,e){return[void 0!==k.wkid&&null!==k.wkid?k.wkid.toString():"-1",void 0!==k.wkt&&null!==k.wkt?k.wkt.toString():"",void 0!==e.wkid&&null!==e.wkid?e.wkid.toString():"-1",void 0!==e.wkt&&
null!==e.wkt?e.wkt.toString():""].join()};l.fromGE=function(k){var e=new l,c="",a=0;for(k=k.steps;a<k.length;a++){var b=t.fromGE(k[a]);e.steps.push(b);c+=b.uid.toString()+","}e._cached_projection={};e._gtlistentry=null;e._chain=c;return e};l.prototype.getInverse=function(){var k=new l;k.steps=[];for(var e=this.steps.length-1;0<=e;e--)k.steps.push(this.steps[e].getInverse());return k};l.prototype.getGTListEntry=function(){for(var k="",e=0,c=this.steps;e<c.length;e++)k+=c[e].uid.toString()+",";k!==
this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=k);return this._gtlistentry};l.prototype.assignCachedGe=function(k,e,c){this._cached_projection[l.cacheKey(k,e)]=c};l.prototype.getCachedGeTransformation=function(k,e){for(var c="",a=0,b=this.steps;a<b.length;a++)c+=b[a].uid.toString()+",";c!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=c);k=this._cached_projection[l.cacheKey(k,e)];return void 0===k?null:k};return l}()})},"esri/geometry/GeographicTransformationStep":function(){define(["require",
"exports"],function(H,n){var t=0;return function(){function l(k){void 0===k&&(k=null);this.uid=t++;k?(this._wkt=void 0!==k.wkt?k.wkt:null,this._wkid=void 0!==k.wkid?k.wkid:-1,this._isInverse=void 0!==k.isInverse?!0===k.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}l.fromGE=function(k){var e=new l;e._wkt=k.wkt;e._wkid=k.wkid;e._isInverse=k.isInverse;return e};Object.defineProperty(l.prototype,"wkt",{get:function(){return this._wkt},set:function(k){this._wkt=k;this.uid=t++},enumerable:!0,
configurable:!0});Object.defineProperty(l.prototype,"wkid",{get:function(){return this._wkid},set:function(k){this._wkid=k;this.uid=t++},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"isInverse",{get:function(){return this._isInverse},set:function(k){this._isInverse=k;this.uid=t++},enumerable:!0,configurable:!0});l.prototype.getInverse=function(){var k=new l;k._wkt=this.wkt;k._wkid=this._wkid;k._isInverse=!this.isInverse;return k};return l}()})},"esri/layers/rasterLib/raster/TileServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q,w,y,x,E,B,C){H=n([C],{declaredClass:"esri.layers.rasterLib.raster.TileServiceRaster",constructor:function(G){},open:function(){var G=new l,I=this.serviceInfo||this._getServiceInfo(null),D=t.hitch(this,function(u){this.serviceInfo=u;this.version=u.currentVersion;this.rasterInfo=this._parseRasterInfo(u);this.loaded=!0;this._getRasterIdentifier();G.resolve(this)}),r=t.hitch(this,function(u){this.loaded=!0;this._getRasterIdentifier();G.reject(u)});f(I,D,r);return G.promise},
read:function(G){var I=this.url+"/tile/"+G.level+"/"+G.row+"/"+G.col,D={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};return this._requestPixels({url:I+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},decodeParams:D,tileOptions:G})},identify:function(G,I){null==I&&(I=this.tileInfo.lods[this.tileInfo.lods.length-1].level);var D=(G.x-this.tileInfo.origin.x)/
this.tileInfo.lods[I].resolution/this.tileInfo.cols;G=(this.tileInfo.origin.y-G.y)/this.tileInfo.lods[I].resolution/this.tileInfo.rows;var r=Math.floor(D),u=Math.floor(G),A=Math.floor((D-r)*this.tileInfo.cols);A=Math.min(A,this.tileInfo.cols-1);var J=Math.floor((G-u)*this.tileInfo.rows);J=Math.min(J,this.tileInfo.rows-1);var O=new l;this.read({level:I,row:u,col:r}).then(function(P){var z=J*P.width+A;P&&P.pixels&&0<P.pixels.length?(P=P.mask?P.mask[z]?P.pixels.map(function(F){return F[z]}):null:P.pixels.map(function(F){return F[z]}),
O.resolve(P)):O.reject("no valid data")},function(P){O.reject(P)});return O.promise},setFetchParameters:function(G,I){},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_getServiceInfo:function(){var G=this.url,I=new l(q._dfdCanceller);I._pendingDfd=d({url:G,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});I._pendingDfd.then(function(D){I.callback(D)},function(D){I.errback(D)});return I},_parseRasterInfo:function(G){var I=
new B;I.extent=new m(G.fullExtent);I.spatialReference=new v(G.spatialReference);this.tileType=G.cacheType||"Map";switch(this.tileType){case "Map":I.bandCount=3;I.pixelType="U8";this.dataType="Processed";break;case "Elevation":I.bandCount=1;I.pixelType=G.pixelType||"F32";this.dataType="Elevation";break;case "Raster":I.bandCount=null,I.pixelType=null,this.dataType=G.serviceDataType&&G.serviceDataType.replace("esriImageServiceDataType","")||"Generic"}var D=G.tileInfo;I.width=Math.floor((G.fullExtent.xmax-
G.fullExtent.xmin)/D.lods[D.lods.length-1].resolution+.5);I.height=Math.floor((G.fullExtent.ymax-G.fullExtent.ymin)/D.lods[D.lods.length-1].resolution+.5);I.cellSize=new p({x:D.lods[D.lods.length-1].resolution,y:D.lods[D.lods.length-1].resolution,spatialReference:G.spatialReference});this.tileInfo=new E(D);this.tileInfo.tileType=this.tileType;return I}});a("extend-esri")&&t.setObject("layers.rasterLib.raster.TileServiceRaster",H,g);return H})},"esri/layers/rasterLib/raster/TileRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q,w,y,x,E,B,C){H=n([C],{declaredClass:"esri.layers.rasterLib.raster.TileRaster",sourceType:"TileCache",_RECORD_SIZE:8,constructor:function(G){this._cloudBlobStorage=G&&G._cloudBlobStorage},open:function(){var G=new l,I=this.datasetInfo||this._getDatasetInfo(null),D=t.hitch(this,function(u){this.datasetInfo=u;this.rasterInfo=u=this._parseRasterInfo(u);this.tileType="Cache/LERC"===u.format?"Elevation":"Cache/MIXED"===u.format||"Cache/JPEG"===u.format||"Cache/PNG"===
u.format?"Map":"Raster";this.tileInfo=u.tileInfo;this.dataType=["Generic","Elevation","Processed"][["Raster","Elevation","Map"].indexOf(this.tileType)];this._HEADER_SIZE=u.packetSize*u.packetSize*this._RECORD_SIZE+64;this.loaded=!0;this._cloudBlobStorage=this._cloudBlobStorage||-1<this.url.toLowerCase().indexOf("s3.amazonaws.com")||-1<this.url.toLowerCase().indexOf("windows.net")||-1<this.url.toLowerCase().indexOf("googleapis.com");this._getRasterIdentifier();G.resolve(this)}),r=t.hitch(this,function(u){this.loaded=
!0;this._getRasterIdentifier();G.reject(u)});f(I,D,r);return G.promise},read:function(G){var I=new l,D=G.level,r=G.row,u=G.col,A=this._buildCacheFilePath(this.url,D,r,u),J=this._getIndexRecordFromBundle(D,r,u);d({url:A,content:{},headers:{Range:"bytes\x3d0-"+(this._HEADER_SIZE-1).toString()},handleAs:"arraybuffer"}).then(t.hitch(this,function(O,P){if(!I.isCanceled()){console.log("time in ms request "+(new Date-z));var z=new Date;O=new Uint8Array(O);O=this._getTileEndAndContentType(O,J);P={width:this.tileInfo.cols,
height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};this._requestPixels({url:A+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},headers:{Range:"bytes\x3d"+O.position.toString()+"-"+(O.position+O.recordSize).toString()},decodeParams:P,tileOptions:G}).then(function(F){I.isCanceled()||I.resolve(F)},function(F){I.isCanceled()||I.reject(F)})}}));return I.promise},identify:function(){return null},
setFetchParameters:function(G,I){},toJson:function(){return{url:this.url,tileInfo:this.tileInfo.toJson(),rasterInfo:this.rasterInfo.toJson(),datasetInfo:this.datasetInfo,sourceType:this.sourceType,tileType:this.tileType,_rasterId:this._rasterId}},_getDatasetInfo:function(){return d({url:this.url+"/conf.json",handleAs:"json",content:{}})},_parseRasterInfo:function(G){var I=new B;switch(G.pixelType){case 1:var D="U1";break;case 1:D="U2";break;case 2:D="U4";break;case 3:D="U8";break;case 4:D="S8";break;
case 5:D="U16";break;case 6:D="S16";break;case 7:D="U32";break;case 8:D="S32";break;case 9:D="F32";break;default:D="F32"}var r,u=[],A=G.LODInfos;for(r=0;r<A.levels.length;r++)u.push({level:A.levels[r],resolution:A.resolutions[r],scale:96/.0254*A.resolutions[r]});r=new v(G.extent.spatialReference||G.geodataXform.spatialReference);u=new E({rows:G.blockHeight,cols:G.blockWidth,dpi:96,format:G.format,compressionQuality:0,origin:G.origin,spatialReference:r,lods:u});I.pixelType=D;I.bandCount=G.bandCount;
I.spatialReference=r;I.extent=new m({xmin:G.extent.xmin,ymin:G.extent.ymin,xmax:G.extent.xmax,ymax:G.extent.ymax,spatialReference:r});I.cellSize=new p({x:G.pixelSizeX,y:G.pixelSizeY,spatialReference:r});I.width=Math.floor((I.extent.xmax-I.extent.xmin)/I.cellSize.x+.5);I.height=Math.floor((I.extent.ymax-I.extent.ymin)/I.cellSize.y+.5);I.statistics=G.statistics.map(function(J){Object.keys(J).forEach(function(O){isNaN(J[O])&&(J[O]=null)});return J});I.histograms=G.histograms;I.geodataXform=G.geodataXform;
I.packetSize=G.packetSize;I.format=G.format;I.compressionQuality=G.compressionQuality;I.tileInfo=u;return I},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_buildCacheFilePath:function(G,I,D,r){var u=this.rasterInfo.packetSize;r=Math.floor(r/u)*u;D="R"+this._toHexString4(Math.floor(D/u)*u)+"C"+this._toHexString4(r);u="L";u=10<=I?u+I.toString():u+("0"+I.toString());return this._cloudBlobStorage?G+"/_alllayers/"+
u+"/"+D+".bundle":G+"/"+u+"_"+D+"/bundle"},_getIndexRecordFromBundle:function(G,I,D){G=this.rasterInfo.packetSize;I=I%G*G+D%G;if(0>I)throw"Invalid level / row / col";return I*this._RECORD_SIZE+64},_getTileEndAndContentType:function(G,I){G=G.subarray(I,I+8);I=0;var D;for(D=0;5>D;D++)I|=(G[D]&255)<<8*D;var r=I&0xffffffffff;I=0;for(D=5;8>D;D++)I|=(G[D]&255)<<8*(D-5);return{position:r,recordSize:I&0xffffffffff}},_toHexString4:function(G){G=G.toString(16);if(4!=G.length)for(var I=4-G.length;0<I--;)G="0"+
G;return G}});a("extend-esri")&&t.setObject("layers.rasterLib.raster.TileRaster",H,g);return H})},"esri/layers/rasterLib/raster/FunctionRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff ../DeferredList2 dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../rasterFormats/rasterCodec ./RasterInfo ./BasicRaster ../../rasterLib/function/rasterFunctionHelper".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q,w,y,x,E,B,C){H=n([B],{declaredClass:"esri.layers.rasterLib.raster.FunctionRaster",rasterFunction:null,sourceType:"Function",constructor:function(G){G&&G.rasterFx&&this._init(G.rasterFx,G.rasterFxArgs)},open:function(){var G=this.getMemberRasters().map(function(D){return D.open()});this.identifiers=this.getMemberRasters().map(function(D){return D._rasterId});var I=new l;(new b(G,null,null,!0)).then(function(D){D.some(function(r){return!r[0]})?I.reject(D):
(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.tileInfo=D[0][1].tileInfo,I.resolve(this))}.bind(this));return I.promise},getProjectedFullExtent:function(G){var I=new l;this.getMemberRasters()[0].getProjectedFullExtent(G).then(t.hitch(this,function(D){this.projectedFullExtent=D;I.resolve(D)}));return I.promise},setProcessingContext:function(G){var I=G;G.layer&&(G=G.layer,
I={id:G.id,rawRasterInfo:G.raster.rasterInfo,glSetting:G._glSetting,xformSetting:G.tileManager&&G.tileManager.xformSetting,useWebGL:G.useWebGL,resampling:G.tileMode&&G.tileManager&&G.tileManager.xformSetting.requireProjection&&!G._hasTilingEffects&&"Thematic"!==G.raster.dataType?1:0,tileMode:G.tileMode});this.rasterFunction.setProcessingContext(I);this._layerOptions=I},alterDefinition:function(G){if(G=G||this.rasterFunction)1===this.memberRasters.length&&!G._bindComplete&&(this.rasterFunction=C.create(G,
{raster:this.memberRasters[0]}))&&(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.rasterFunction.setProcessingContext(this._layerOptions)),this._rasterHandler&&this._rasterHandler._connected&&this.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this._layerOptions.id,data:this.rasterFunction.toJson(!0)})},setFetchParameters:function(G,I){var D=this.getMemberRasters();
D&&1===D.length&&D[0].setFetchParameters(G,I)},getMemberRasters:function(){this.memberRasters||(this.memberRasters=[],this._getMemberRasters(this.rasterFunction.functionArguments,this.memberRasters));return this.memberRasters},read:function(G){var I=new l(m._dfdCanceller);if(G.src){var D=this.rasterFunction.read(G);I.resolve(D);return I.promise}var r=this.getMemberRasters().map(function(O){return O.read(G)});r=new b(r);var u,A,J=this.identifiers;I._pendingDfd=r;r.then(t.hitch(this,function(O){if(u=
O.some(function(P){return P[0]}))A={},O.forEach(function(P,z){A[J[z]]=P[0]?P[1]:null});D=A?this.rasterFunction.read({extent:G.extent,src:A}):null;D.srcData=A;I.resolve(D)}));return I},_init:function(G,I){if(this.rasterFunction=C.create(G,I))this.rasterFunction._bindComplete=!0;else throw"Cannot initialize a function raster without a raster function";},_getMemberRasters:function(G,I){var D=Object.keys(G),r,u,A;for(r=0;r<D.length;r++)if(A=G[D[r]]){var J=A instanceof Array?A:[A];for(u=0;u<J.length;u++)(A=
J[u])&&("function"===typeof A||"object"===typeof A)&&A.read&&(A.functionArguments?this._getMemberRasters(A.functionArguments,I):A.sourceType&&"Function"!==A.sourceType&&(A._identifier=A._getRasterIdentifier(),I.some(function(O){return O._identifier===A._identifier})||I.push(A)))}return I}});a("extend-esri")&&t.setObject("layers.rasterLib.raster.FunctionRaster",H,g);return H})},"esri/layers/rasterLib/DeferredList2":function(){define(["dojo/DeferredList"],function(H){return function(n,t,l,k,e){this.list=
n;t=new H(n,t,l,k,e);var c=t.resolve.bind(t),a=t.cancel.bind(t);t.cancel=function(){n&&n.forEach(function(b){b.cancel&&b.cancel()});a.apply(this,arguments)}.bind(t);t.resolve=function(){this.isFulfilled()||c.apply(this,arguments)}.bind(t);return t}})},"esri/layers/rasterLib/tile/RasterTileManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/when ../DeferredList2 ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../PixelBlock ./RasterTileInfo ../raster/rasterProjectionHelper".split(" "),
function(H,n,t,l,k,e,c,a,b,f,g){var h=function(d,m){var p;for(p=0;p<d.length;p++)if(m(d[p]))return p;return-1};return H(null,{declaredClass:"esri.layers.rasterLib.tile.RasterTileManager",count:null,fullBoundary:null,tileBoundary:null,tiles:null,resolution:null,virtual:!0,prefetchBufferSize:0,_progressiveGlobal:!1,_MAX_TILES:128,_defaultMatrixResolution:20,constructor:function(d){this.tiles=[];this.xformSetting={};this.mapSpatialReference=d&&d.mapSR;this.layer=d&&d.layer;this.identifiers=this.layer.raster.rasterFunction?
this.layer.raster.getMemberRasters().map(function(m){return m._rasterId}):[this.layer.raster._rasterId];(d=d&&d.tileInfo)&&this.setTileInfo(d)},setTileInfo:function(d){this.tileInfo=d;this.virtual=d.virtual;this.mapResolution=null;this.tiles.length=0;this.xformSetting.requireProjection=!this.virtual&&!this.mapSpatialReference.equals(this.tileInfo.spatialReference);this.xformSetting.requirePE=g.requirePE(this.mapSpatialReference,this.tileInfo.spatialReference);this.xformSetting.meshSize=this.xformSetting.requireProjection?
[this._defaultMatrixResolution,this._defaultMatrixResolution]:[1,1];this.halfWorldWidth=g.getHalfWorldWidth(d.spatialReference)},updateResolution:function(d,m){if(!(this.mapResolution&&d&&this._resolutionEqual(this.mapResolution.x,d.x)&&this._resolutionEqual(this.mapResolution.y,d.y))){this.resetTiles();var p=this.xformSetting.requireProjection;this.mapResolution=this.resolution=d;p&&(this.resolution=g.projectResolution(d,this.tileInfo.spatialReference,this.layer.projectedFullExtent||m));this._resolution=
this.resolution;d=this.resolution;if(!this.tileInfo.virtual){p=.75*Math.min(d.x,d.y)+.25*Math.max(d.x,d.y);if(p>=this.tileInfo.lods[0].resolution){var v=this.tileInfo.lods[0];this.ooe=!0}else{if(p<=this.tileInfo.lods[this.tileInfo.lods.length-1].resolution)v=this.tileInfo.lods[this.tileInfo.lods.length-1];else for(d=0;d<this.tileInfo.lods.length-1;d++)if(v=this.tileInfo.lods[d],m=this.tileInfo.lods[d+1],v.resolution>=p&&m.resolution<=p){v.resolution-p>p-m.resolution&&(v=m);break}this.ooe=!1}this.level=
v&&v.level;d=this.resolution=new a({x:v.resolution,y:v.resolution,spatialReference:this.tileInfo.spatialReference})}p=this.layer.raster.rasterInfo.extent;v=this.tileInfo.origin;m=this.tileInfo.cols;var q=this.tileInfo.rows;this.fullBoundary={rowStart:Math.floor((v.y-p.ymax)/d.y/q),rowEnd:Math.floor((v.y-p.ymin-d.y)/d.y/q),colStart:Math.floor((p.xmin-v.x)/d.x/m),colEnd:Math.floor((p.xmax-v.x-d.x)/d.x/m)};if(p=this.halfWorldWidth){q=Math.ceil(p/d.x/(m/2));var w=this.tileInfo.applyGCS360Transform?360:
p,y=Math.round(m-(w-v.x)/d.x%m);y===m&&(y=0);this.fullBoundary.colRange=q;this.fullBoundary.paddingRight=y;this.fullBoundary.paddingLeft=Math.round((q*m*d.x+v.x-w-(this.tileInfo.applyGCS360Transform?0:v.x+p))/d.x)}this.hasNewData=!0}},getXformGrid:function(){var d=this.mapExtent,m=this.layer._hasTilingEffects?this.extent:this.fullExtent,p=this.layer.getCurrentResolution(),v=JSON.stringify(d.toJson())+JSON.stringify(m.toJson());this._datumTransformationInitialized||(this._datumTransformationInitialized=
!0,this._datumTransformation=g.getDefaultDatumTransformationForDataset(this.layer.raster.rasterInfo.extent,d.spatialReference,!0));this._cachedExtentString&&this._cachedExtentString===v||(this._cachedExtentString=v,this._xformGrid=d=g.getProjectionOffsetGrid(d,m,p,this.tileInfo.applyGCS360Transform,this.halfWorldWidth,this._datumTransformation));d=this._xformGrid;this.xformSetting.meshSize=d&&d.size;return d},getWrapTimes:function(d){var m=g.getHalfWorldWidth(d.spatialReference);if(!m)return 0;var p=
2*m;m=this.tileInfo.applyGCS360Transform?0:-m;return Math.floor((d.xmax-m)/p)-Math.floor((d.xmin-m)/p)},normalizeCoordinate:function(d,m){if(!m)return 0;var p=2*m;if(0<d){for(;d>m;)d-=p;return d}for(;d<-m;)d+=p;return d},resetTiles:function(){this.tiles.forEach(n.hitch(this,function(d){d.fetch&&!d.fetch.isCanceled()&&d.fetch.cancel();d.update&&!d.update.isCanceled()&&d.update.cancel()}));this.tiles.length=0},updateExtent:function(d,m){this.mapExtent=this.extent=d;var p=this.xformSetting.requireProjection;
if(p){this.extent=g.project(d,this.tileInfo.spatialReference,this.tileInfo.applyGCS360Transform);if(!this.extent)return;this.extent.spatialReference=new c(this.extent.spatialReference.toJson())}this.updateResolution(m,d);var v=this.extent,q=this.tileInfo,w=q.cols,y=q.rows;m=this.resolution;var x=v;p=p?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent;this.ooe&&(x=this._getIntersect(v,p));var E=Math.floor((x.xmin-q.origin.x)/m.x/w)-this.prefetchBufferSize,B=Math.floor((x.xmax-
q.origin.x)/m.x/w)+this.prefetchBufferSize,C=null;d=this.getWrapTimes(d);var G=this.fullBoundary&&this.fullBoundary.colRange;d&&this.halfWorldWidth&&(B===E&&(C=E),B+=d*G);var I=this.halfWorldWidth&&this.tiles.length&&(d!==this.wrapTimes||C!==this._circlularColId);I&&(this._wrapSwitchCount=this._wrapSwitchCount?this._wrapSwitchCount+1:1);this.wrapTimes=d;this._circlularColId=C;var D=Math.floor((q.origin.y-x.ymax)/m.y/y)-this.prefetchBufferSize;C=Math.floor((q.origin.y-x.ymin)/m.y/y)+this.prefetchBufferSize;
this.tileBoundary={rowStart:D,rowEnd:C,colStart:E,colEnd:B};var r,u;((x=(C-D+1)*(B-E+1)>this._MAX_TILES||!this.virtual&&this._resolution.x>8*this.tileInfo.lods[0].resolution)||2<d||I)&&this.resetTiles();if(!(x||2<d)){I=this.tiles;x=!1;for(r=I.length-1;0<=r;r--){var A=I[r].row;var J=I[r].wrapCol;if(A<D||A>C||J<E||J>B)I[r].fetch&&!I[r].fetch.isCanceled()&&I[r].fetch.cancel(),I[r].update&&!I[r].update.isCanceled()&&I[r].update.cancel(),I.splice(r,1),x=!0}for(r=D;r<=C;r++)for(u=E;u<=B;u++){D=new e(q.origin.x+
m.x*w*u,q.origin.y-m.y*y*(r+1),q.origin.x+m.x*w*(u+1),q.origin.y-m.y*y*r,v.spatialReference);var O=d&&G?0<=u?u%G:G- -u%G:u;A=h(I,function(P){return P.row===r&&P.col===O&&P.wrapCol===u});J=p.xmax>=D.xmax?w:Math.round((p.xmax-D.xmin)/m.x);-1===A&&(I.push({row:r,col:O,wrapCol:u,cellsizeX:m.x,cellsizeY:m.y,width:w,height:y,actualWidth:J,extent:D,normalizedExtent:this._wrapExtent(D,O),pixelBlock:null,virtual:this.virtual,level:this.level,tileType:this.tileInfo.tileType||"Raster"}),x=!0)}x&&this._sortTiles();
m=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);this.width=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);this.height=m;this.count=I.length;m=Math.min.apply(null,I.map(function(P){return P.extent.xmin}));q=Math.max.apply(null,I.map(function(P){return P.extent.xmax}));w=Math.min.apply(null,I.map(function(P){return P.extent.ymin}));y=Math.max.apply(null,I.map(function(P){return P.extent.ymax}));m=this.fullExtent=new e(m,w,q,y,v.spatialReference);
if(this.layer.roaming||this.layer.useWebGL)this.layer._hasTilingEffects?(this.xformSetting.offset=[0,0],this.xformSetting.scale=[1,1]):(x&&(this._tilesChanged=!0),this.xformSetting.offset=[(v.xmin-m.xmin)/(m.xmax-m.xmin),-(m.ymin-v.ymin)/(m.ymax-m.ymin)],this.xformSetting.scale=[(v.xmax-v.xmin)/(m.xmax-m.xmin),(v.ymax-v.ymin)/(m.ymax-m.ymin)])}},fetchTiles:function(d){(this._tilesChanged||d)&&this._fetchTiles(d)},_fetchTiles:function(d){this._fetchCounter=0;var m=this.extent;this.fetchAllCompleted=
d?new t:null;(this._tilesChanged||d&&this.layer._hasTilingEffects)&&this.tiles.forEach(n.hitch(this,function(v){v.updateCompleted=!1}));var p={};!this.layer.roaming&&this.layer._hasTilingEffects&&d?(this.identifiers.forEach(function(v,q){p[v]={extent:this.extent,pixelBlock:new b({width:this.layer._map.width,height:this.layer._map.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.extent,src:p,isEmpty:!0}):this._tilesChanged&&(this.identifiers.forEach(function(v,
q){p[v]={extent:this.fullExtent,pixelBlock:new b({width:128,height:128,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.fullExtent,src:p,isEmpty:!0});this.tiles.forEach(n.hitch(this,function(v){if(v.fetch)v.update||(v.update=this.updateTile(v));else{if(this._isTileOutSide(v,m)){v.updateCompleted=!0;return}this._requestTile(v)}this.layer.roaming&&this.layer.useWebGL?this._fillPixelData(v):v.src&&d&&(this.layer._hasTilingEffects||this.layer.useWebGL)&&
(this._fillPixelData(v),this.layer._hasTilingEffects&&(v.updateCompleted=!0),v.processedPixelBlock=null,v.renderedPixelBlock=null)}));0===this._fetchCounter&&(this._fetched=!0);this._tilesChanged=!1;d&&this._updateFetchStatus()},updateTile:function(d,m){var p=new t;if(!d.src&&!d.fetch)return p.resolve(d),p.promise;l(d.src||d._fetched||d.fetch,n.hitch(this,function(){var v=this.layer.tileMode&&this.layer._rasterHandler&&!(this.layer._hasTilingEffects||this.layer.useWebGL),q=this.layer._drawTile,w=
this._validateRawPixelBlocks(d);this.layer._hasTilingEffects&&!this.layer.useWebGL&&(q=q&&(this._progressiveGlobal||m));if((m||!m&&w)&&(v||q||this.layer.roaming)){if(this.xformSetting.requireProjection&&this.layer.useWebGL&&(this.xformSetting.gridConfig=this.getXformGrid(),null==this.xformSetting.gridConfig))return p.cancel(),p.promise;this._processTile(d,m).then(n.hitch(this,function(y){p.isCanceled()||this._renderTile(y,m).then(n.hitch(this,function(x){this.hasNewData=!1;p.isCanceled()||p.resolve(x)}))}))}else m||
w||(d.updateCompleted=!0),this.layer.useWebGL||this.layer._hasTilingEffects?p.resolve(this.originalPixelData):p.resolve()}));return p.promise},setLayer:function(d){this.layer=d},fillupTiles:function(){this.tiles.forEach(n.hitch(this,function(d){d.update&&d.updateCompleted&&!d.filled&&(d.updateCompleted=!1,this._fillPixelData(d),d.updateCompleted=!0)}))},_validateRawPixelBlocks:function(d){return d&&d.src&&!this.identifiers.some(function(m){return!(d.src[m].pixelBlock&&0!==d.src[m].pixelBlock.validPixelCount&&
d.src[m].pixelBlock.pixels&&0<d.src[m].pixelBlock.pixels.length)})},_wrapExtent:function(d,m){if(d){if(this.tileInfo.applyGCS360Transform){var p=this.normalizeCoordinate(d.xmin,180);0>p&&(p+=360);return new e({xmin:p,ymin:d.ymin,xmax:d.xmax-d.xmin+p,ymax:d.ymax,spatialReference:d.spatialReference})}if(this.halfWorldWidth){p=null!=m?new e({xmin:this.tileInfo.origin.x+this.tileInfo.cols*m*this.resolution.x,ymin:d.ymin,xmax:this.tileInfo.origin.x+this.tileInfo.cols*(m+1)*this.resolution.x,ymax:d.ymax,
spatialReference:d.spatialReference}):new e({xmin:d.xmin,ymin:d.ymin,xmax:d.xmax,ymax:d.ymax,spatialReference:d.spatialReference});m=this.normalizeCoordinate(p.xmin,this.halfWorldWidth);var v=m-p.xmin;.01<Math.abs(v)&&(p.xmin=m,p.xmax+=v)}return p||d}},_getIntersect:function(d,m){return new e(Math.max(d.xmin,m.xmin),Math.max(d.ymin,m.ymin),Math.min(d.xmax,m.xmax),Math.min(d.ymax,m.ymax),d.spatialReference)},_isTileOutSide:function(d,m){var p=!1;if(d.virtual){var v=d.normalizedExtent;if(m=m||(this.xformSetting.requireProjection?
this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent)){d=v.xmin-this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;p=v.ymin-this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;var q=v.xmax+this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;v=v.ymax+this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;p=q<=m.xmin||d>=m.xmax||v<=m.ymin||p>=m.ymax}else p=!1}else p=0>d.level||d.row<this.fullBoundary.rowStart||d.row>this.fullBoundary.rowEnd||d.col<
this.fullBoundary.colStart||d.col>this.fullBoundary.colEnd;return p},_resolutionEqual:function(d,m){return d===m||d&&m&&Math.abs(d-m)<Math.abs(m/1E4)?!0:!1},_requestTile:function(d){var m=this.identifiers,p;if(this._isTileOutSide(d)){var v=new t;d.updateCompleted=!0;v.resolve(null);v=v.promise}else v=this.layer.raster.rasterFunction?new k(this.layer.raster.getMemberRasters().map(function(q){return q.read(d)})):new k([this.layer.raster.read(d)]);d.fetch=v;this._fetchCounter++;l(d.src||d._fetched||
v,n.hitch(this,function(q){if(p=q&&q.some(function(y){return y[0]})){var w={};q.forEach(function(y,x){w[m[x]]=y[0]&&y[1]?{extent:y[1].extent,pixelBlock:y[1].pixelBlock,width:y[1].width,height:y[1].height}:null});d.src=w}else d.src=null;this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);d._fetched=!0;this._updateFetchStatus()}),n.hitch(this,function(){this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);d._fetched=!0;this._updateFetchStatus()}));d.update=this.updateTile(d)},
_updateFetchStatus:function(){this.layer._drawTile&&this.fetchAllCompleted&&!this.fetchAllCompleted.isResolved()&&!this.tiles.some(function(d){return!d._fetched})&&(this.tiles.forEach(n.hitch(this,function(d){this._fillPixelData(d)})),this.fetchAllCompleted.resolve())},_fillPixelData:function(d,m){if(d&&!d.updateCompleted)if(Math.abs(d.cellsizeX-this.resolution.x)>d.cellsizeX/10)d.updateCompleted=!0;else if(!1===this._validateRawPixelBlocks(d))d.updateCompleted=!0;else{var p=d.extent;if(this.layer.roaming||
this.layer.useWebGL&&!this.layer._hasTilingEffects){var v=this.fullExtent;var q=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);var w=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);m?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new b({width:q,height:w,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(n.hitch(this,function(x){this.originalPixelData.src[x].pixelBlock.width=q;this.originalPixelData.src[x].pixelBlock.height=
w}))}else v=this.extent,q=this.layer._map.width,w=this.layer._map.height,m?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new b({width:q,height:w,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(n.hitch(this,function(x){this.originalPixelData.src[x].pixelBlock.width=q;this.originalPixelData.src[x].pixelBlock.height=w}));if(v.xmax<=p.xmin||v.xmin>=p.xmax||v.ymax<=p.ymin||v.ymin>=p.ymax)return null;var y=this.originalPixelData.isEmpty=
!1;this.identifiers.forEach(n.hitch(this,function(x){d.src&&(this._fillPixelBlock(d.src[x],this.originalPixelData.src[x],{extent:v,width:q,height:w,normalizedExtent:d.normalizedExtent},!1),y=!0)}));d.filled=y;this.hasNewData=!0}},_fillPixelBlock:function(d,m,p,v){var q=d.extent,w=p.extent;v=p.width;var y=p.height;if(d.pixelBlock&&d.pixelBlock.pixels&&d.pixelBlock.pixels[0]){var x=(q.xmax-q.xmin)/d.width,E=Math.max(q.xmin,w.xmin),B=Math.min(q.ymax,w.ymax),C=Math.round((E-q.xmin)/x),G=d.width-Math.round(Math.abs(q.xmax-
Math.min(q.xmax,w.xmax))/x),I=Math.round(Math.abs(q.ymax-B)/x),D=d.height-Math.round((Math.max(q.ymin,w.ymin)-q.ymin)/x),r=this.halfWorldWidth;E=Math.round((E-w.xmin)/x);p=p.normalizedExtent;if(!(this.wrapTimes&&r&&q.xmin<-r)){if(this.wrapTimes&&r){if(this.tileInfo.applyGCS360Transform)360<q.xmin&&(E-=this.fullBoundary.paddingLeft);else if(q.xmin>r){E-=this.fullBoundary.paddingLeft;var u=this.normalizeCoordinate(q.xmin,r);var A=this.normalizeCoordinate(q.xmax,r)}else u=q.xmin,A=q.xmax;this.tileInfo.applyGCS360Transform?
p&&360>p.xmin&&360<p.xmax&&(G-=this.fullBoundary.paddingRight):p&&p.xmin<r&&p.xmax>r?G-=this.fullBoundary.paddingRight:u<r&&A>r&&(G-=this.fullBoundary.paddingRight)}u=Math.round(Math.abs(w.ymax-B)/x);A=d.pixelBlock.pixels.length;m=m.pixelBlock;p=d.width;q=m.mask||new Uint8Array(v*y);var J=d.pixelBlock,O=J.mask,P=0;for(x=0;x<A;x++){B=J.pixels[x];r=m.pixels[x]||new B.constructor(v*y);for(d=I;d<D;d++)for(P=(u+d-I)*v+E,w=C;w<G;w++)r[P+w-C]=B[d*p+w];m.pixels[x]=r}if(O)for(d=I;d<D;d++)for(P=(u+d-I)*v+E,
w=C;w<G;w++)q[P+w-C]=O[d*p+w];else for(d=I;d<D;d++)for(P=(u+d-I)*v+E,w=C;w<G;w++)q[P+w-C]=1;m.pixelType=m.pixelType||J.pixelType;m.mask=q;if(!(m.statistics&&0<m.statistics.length))for(m.statistics=[],d=0;d<J.statistics.length;d++)m.statistics[d]={minValue:J.statistics[d].minValue,maxValue:J.statistics[d].maxValue};else if(J.statistics&&m.statistics)for(d=0;d<m.statistics.length;d++)m.statistics[d].minValue=Math.min(J.statistics[d].minValue,m.statistics[d].minValue),m.statistics[d].maxValue=Math.max(J.statistics[d].maxValue,
m.statistics[d].maxValue)}}},_processTile:function(d,m){var p=new t,v=this.layer._hasTilingEffects,q=this.layer.useWebGL,w=v||q,y=this.layer.raster.rasterFunction&&d&&(v||q||!d.processedPixelBlock);if(m)var x=d;else this._fillPixelData(d),x=w?this.originalPixelData:d;this.xformSetting.hasNewTexture=this.hasNewData;var E;y?(this.identifiers.forEach(function(B){if(0===x.src[B].pixelBlock.pixels.length||0===x.src[B].pixelBlock.pixels[0].length)E=!0}),E?p.resolve({extent:x.extent,processedPixelBlock:x.src[this.identifiers[0]],
pixelBlock:x.src[this.identifiers[0]]}):q?(this.processedPixelData=this.layer.raster.rasterFunction.read(x),p.resolve(this.processedPixelData)):this.layer._rasterHandler?this.layer._rasterHandler.process({extent:x.extent,src:x.src}).then(function(B){v?(this.processedPixelData=B,p.resolve(this.processedPixelData)):(d.processedPixelBlock=B.pixelBlock,p.resolve(d))}):(m=this.layer.raster.rasterFunction.read(d),d.processedPixelBlock=m.pixelBlock,p.resolve(d))):w?p.resolve(x.src[this.identifiers[0]]):
(d.pixelBlock=x.src[this.identifiers[0]]&&x.src[this.identifiers[0]].pixelBlock,p.resolve(d));return p.promise},_renderTile:function(d){var m=new t,p=this.layer._hasTilingEffects,v=this.layer.useWebGL,q=Math.abs((d.extent.xmax-d.extent.xmin)/d.width-this.layer.getCurrentResolution().x)>this.resolution.x/10;q=this.layer.useWebGL&&(q||this._isTileOutSide(d,this.layer._map.extent));this.xformSetting.hasNewTexture=this.hasNewData;this.layer._rasterRenderer&&d&&(d.texture||d.src||d.pixelBlock||d.processedPixelBlock)?
(this.layer._rasterRenderer.interpolation=this.layer.interpolation,v&&!q?(this.layer.raster.rasterFunction&&this.layer.raster.rasterFunction.renderTexture||this.layer._rasterRenderer.draw(d),m.resolve(d)):this.layer._rasterHandler?this.layer._rasterHandler.render({extent:d.extent,pixelBlock:d.processedPixelBlock||d.pixelBlock}).then(function(w){p?(w.renderedPixelBlock=w.pixelBlock,m.resolve(w)):(d.renderedPixelBlock=w.pixelBlock,m.resolve(d))}.bind(this)):(d.renderedPixelBlock=this.layer._rasterRenderer.draw(d).pixelBlock,
m.resolve(d))):(d.renderedPixelBlock=d.processedPixelBlock||d.pixelBlock,m.resolve(d));return m.promise},_sortTiles:function(){this.tiles.sort(function(d,m){return d.row<m.row||d.row==m.row&&d.col<m.col?-1:1})}})})},"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),function(H,n,t,l,k,e,c){H=H(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,
constructor:function(a,b){a=a||{};a.layers||a.itemId||console.error("esri.dijit.Basemap: unable to find the 'layers' property in parameters");this.id=a.id;this.itemId=a.itemId;this.layers=a.layers;this.title=a.title||"";this.thumbnailUrl=a.thumbnailUrl;this.basemapGallery=b},getLayers:function(a){if(this.layers)return this.layers;if(this.itemId)return a=e({url:(a||k.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:t.hitch(this,function(b,
f){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.")})}),a.addCallback(t.hitch(this,function(b,f){if(b.baseMap)return this.layers=[],n.forEach(b.baseMap.baseMapLayers,function(g){this.layers.push(new c(g))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.");
return[]})),a}});l("extend-esri")&&t.setObject("dijit.Basemap",H,k);return H})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(H,n,t,l){H=H(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(k){k=k||{};k.url||k.type||console.error("esri.dijit.BasemapLayer: unable to find the 'url' or 'type' property in parameters");this.url=k.url;this.type=k.type;this.isReference=!0===k.isReference?!0:!1;this.opacity=k.opacity;this.visibleLayers=
k.visibleLayers;this.displayLevels=k.displayLevels;this.exclusionAreas=k.exclusionAreas;this.bandIds=k.bandIds;this.renderingRule=k.renderingRule;this.templateUrl=k.templateUrl;this.copyright=k.copyright;this.subDomains=k.subDomains;this.fullExtent=k.fullExtent;this.initialExtent=k.initialExtent;this.tileInfo=k.tileInfo;this.tileServers=k.tileServers;this.styleUrl=k.styleUrl}});t("extend-esri")&&n.setObject("dijit.BasemapLayer",H,l);return H})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),
function(H,n,t,l,k,e){return H([e,k],{_onMap:function(c){var a=this.constructor._onMap;a&&a.FINAL||(delete this.constructor._onMap,a=this.registerConnectEvents(),a.FINAL=!0);c=c.toLowerCase();if(a[c])var b=this[a[c].method];else c=this._onCamelCase(c),this[c]&&(b=c);return b},on:function(c,a){var b=this._onMap(c),f=c.replace(/\-/g,""),g="on"+f in this.domNode;return b||!g?this.inherited(arguments):this.own(l(this.domNode,f,a))[0]},emit:function(c,a,b){var f,g=c.toLowerCase(),h=this.constructor._onMap||
this.registerConnectEvents();var d=this[this._onMap(g)];a=a||{};a.target||(a.target=this);if(d&&h&&h[g]){this._onObj2Arr(function(){f=Array.prototype.slice.call(arguments)},h[g].argKeys)(a);var m=n.mixin({},arguments);m[2]=f;m[0]=h[g].name.replace(/^on/,"")}return this.inherited(m||arguments)}})})},"url:dijit/templates/Dialog.html":'\x3cdiv class\x3d"dijitDialog" role\x3d"dialog" aria-labelledby\x3d"${id}_title"\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"titleBar" class\x3d"dijitDialogTitleBar"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"titleNode" class\x3d"dijitDialogTitle" id\x3d"${id}_title"\r\n\t\t\t\trole\x3d"heading" level\x3d"1"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"closeButtonNode" class\x3d"dijitDialogCloseIcon" data-dojo-attach-event\x3d"ondijitclick: onCancel" title\x3d"${buttonCancel}" role\x3d"button" tabindex\x3d"-1"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"closeText" class\x3d"closeText" title\x3d"${buttonCancel}"\x3ex\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitDialogPaneContent"\x3e\x3c/div\x3e\r\n\t${!actionBarTemplate}\r\n\x3c/div\x3e\r\n\r\n',
"url:dijit/form/templates/Button.html":'\x3cspan class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonNode"\r\n\t\tdata-dojo-attach-event\x3d"ondijitclick:__onClick" role\x3d"presentation"\r\n\t\t\x3e\x3cspan class\x3d"dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode,focusNode"\r\n\t\t\trole\x3d"button" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitToggleButtonIconChar"\x3e\x26#x25CF;\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tid\x3d"${id}_label"\r\n\t\t\t\tdata-dojo-attach-point\x3d"containerNode"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\x3e\x3c/span\r\n\t\x3e\x3c/span\r\n\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" class\x3d"dijitOffScreen"\r\n\t\tdata-dojo-attach-event\x3d"onclick:_onClick"\r\n\t\ttabIndex\x3d"-1" aria-hidden\x3d"true" data-dojo-attach-point\x3d"valueNode"\r\n/\x3e\x3c/span\x3e\r\n',
"url:dijit/form/templates/TextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/templates/Tooltip.html":'\x3cdiv class\x3d"dijitTooltip dijitTooltipLeft" id\x3d"dojoTooltip" data-dojo-attach-event\x3d"mouseenter:onMouseEnter,mouseleave:onMouseLeave"\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipConnector" data-dojo-attach-point\x3d"connectorNode"\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipContainer dijitTooltipContents" data-dojo-attach-point\x3d"containerNode" role\x3d\'alert\'\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/ValidationTextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\r\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"*now":function(H){H(['dojo/i18n!*preload*esri/dijit/nls/BasemapGallery*["ar","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},
"*noref":1}});
define("esri/dijit/BasemapGallery","require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/Deferred dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ../request ../geometry/Extent ../SpatialReference ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/VectorTileLayer ../layers/TileInfo ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ../layers/ImageParameters ../layers/RasterFunction ../layers/RasterXLayer ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),function(H,
n,t,l,k,e,c,a,b,f,g,h,d,m,p,v,q,w,y,x,E,B,C,G,I,D,r,u,A,J,O,P,z,F,M,Q,R){n=n([Q,p,v],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:R,loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_supportsVTL:null,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(K,N){K=K||{};K.map||console.error("esri.dijit.BasemapGallery: Unable to find the 'map' property in parameters");
this.map=K.map;this._hasUI=N?!0:!1;this.bingMapsKey=K.bingMapsKey&&0<K.bingMapsKey.length?K.bingMapsKey:null;this.showArcGISBasemaps=!1!==K.showArcGISBasemaps;this.basemaps=K.basemaps||[];this.basemapIds=K.basemapIds;this.referenceIds=K.referenceIds;this.basemapsGroup=K.basemapsGroup;this.arcgisUrl=q.dijit._arcgisUrl;K.portalUrl&&(this.arcgisUrl=K.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=y.getProtocolForWebResource()+"//"+this.arcgisUrl:"https:"===window.location.protocol&&
(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));this.init()},init:function(){this.inherited(arguments);this._checkVTLSupport().then(k.hitch(this,function(K){this._supportsVTL=K}));t.forEach(this.basemaps,function(K){K.id&&0!==K.id.length||(K.id=this._getUniqueId());t.forEach(K.layers,function(N){N.opacity=0<=N.opacity?N.opacity:1;N.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&t.forEach(this.basemapIds,function(K){this.map.getLayer(K)._basemapGalleryLayerType="basemap"},
this);this.referenceIds&&0<this.referenceIds.length&&t.forEach(this.referenceIds,function(K){K=this.map.getLayer(K);K._basemapGalleryLayerType="reference";K.attr("data-reference",!0)},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(k.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(k.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup()},startup:function(){this.loaded?
this._refreshUI():l.connect(this,"onLoad",k.hitch(this,function(){this._refreshUI()}))},select:function(K){this._select(K)},getSelected:function(){return this._selectedBasemap},get:function(K){var N;for(N=0;N<this.basemaps.length;N++)if(this.basemaps[N].id===K)return this.basemaps[N];return null},add:function(K){return K&&!K.id?(K.id=this._getUniqueId(),this.basemaps.push(K),this._refreshUI(),this.onAdd(K),!0):K&&this._isUniqueId(K.id)?(this.basemaps.push(K),this._refreshUI(),this.onAdd(K),!0):!1},
remove:function(K){var N;for(N=0;N<this.basemaps.length;N++){var V=this.basemaps[N];if(V.id===K)return this._selectedBasemap&&this._selectedBasemap.id===V.id&&(this._selectedBasemap=null),this.basemaps.splice(N,1),this._refreshUI(),this.onRemove(V),V}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(K){},onRemove:function(K){},onError:function(K){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=
!0;this.onLoad();0===this.map.layerIds.length&&0<this.basemaps.length&&!this._selectBasemapInProgress&&this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(K){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,K):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(K))},_findArcGISBasemapsGroup:function(K){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(K);
else{var N=this.arcgisUrl+"/portals/self",V={f:"json"};V.culture=e.locale;x({url:N,content:V,callbackParamName:"callback",load:k.hitch(this,function(W,L){W&&W.useVectorBasemaps&&W.vectorBasemapGalleryGroupQuery?this._checkVTLSupport().then(k.hitch(this,function(T){this._basemapGalleryGroupQuery=T?W.vectorBasemapGalleryGroupQuery:W&&W.basemapGalleryGroupQuery?W.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(K)})):(this._basemapGalleryGroupQuery=
W&&W.basemapGalleryGroupQuery?W.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery,this._findArcGISBasemapsGroupContent(K))}),error:k.hitch(this,function(W,L){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(K){var N=k.hitch(this,"_findArcGISBasemaps"),V=this.arcgisUrl+"/community/groups",W={};W.q=this._basemapGalleryGroupQuery;W.f="json";x({url:V,content:W,callbackParamName:"callback",load:k.hitch(this,function(L,T){if(0<
L.results.length)N(L.results[0].id,K,L.results[0].sortField,L.results[0].sortOrder);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:k.hitch(this,function(L){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(K,N,V,W){var L=k.hitch(this,function(T,S,U,X){var Y=this.arcgisUrl+"/search",Z={};Z.q="group:"+T+' AND type:"web map" NOT type:"web mapping application"';Z.sortField=U;Z.sortOrder="asc"===X?
"desc":"asc";Z.num=100;Z.f="json";x({url:Y,content:Z,callbackParamName:"callback",load:k.hitch(this,function(aa,ba){if(0<aa.results.length)S(aa.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:k.hitch(this,function(aa,ba){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})});V&&W?L(K,N,V,W):x({url:this.arcgisUrl+"/community/groups/"+K,content:{f:"json"},callbackParamName:"callback",load:k.hitch(this,function(T,S){T.sortField?
L(K,N,T.sortField,T.sortOrder):L(K,N,"name","desc")}),error:k.hitch(this,function(T,S){L(K,N,"name","desc")})})},_handleArcGISBasemapsResponse:function(K){0<K.length&&(t.forEach(K,function(N,V){if(this.bingMapsKey||!this.bingMapsKey&&N.title&&-1===N.title.indexOf("Bing Maps")){V={};V.id=this._getUniqueId();V.title=N.title;V.thumbnailUrl="";if(N.thumbnail&&N.thumbnail.length&&(V.thumbnailUrl=this.arcgisUrl+"/content/items/"+N.id+"/info/"+N.thumbnail,q.id)){var W=q.id.findCredential(y.urlToObject(this.arcgisUrl).path);
W&&(V.thumbnailUrl+="?token\x3d"+W.token)}V.itemId=N.id;N=new M(V,this);this.basemaps.splice(0,0,N)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(d.empty(this.flowContainer),t.forEach(this.basemaps,function(K,N){K.id||(K.id="basemap_"+N);this.flowContainer.appendChild(this._buildNodeLayout(K))},this),d.create("br",{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(K){var N=d.create("div",{id:"galleryNode_"+K.id,"class":"esriBasemapGalleryNode"}),
V=d.create("a",{href:"javascript:void(0);"},N);l.connect(V,"onclick",k.hitch(this,"_onNodeClick",K));var W=K.title||"";K.thumbnailUrl?d.create("img",{"class":"esriBasemapGalleryThumbnail",src:K.thumbnailUrl,title:W,alt:W},V):d.create("img",{"class":"esriBasemapGalleryThumbnail",src:H.toUrl("./images/transparent.gif"),title:W,alt:W},V);K=d.create("div",{"class":"esriBasemapGalleryLabelContainer"},N);d.create("span",{innerHTML:W,alt:W,title:W},K);return N},_onNodeClick:function(K,N){N.preventDefault();
this._markSelected(K);this.select(K.id)},_markSelected:function(K){K&&(t.forEach(e.query(".esriBasemapGallerySelectedNode",this.domNode),function(N){m.remove(N,"esriBasemapGallerySelectedNode")}),(K=h.byId("galleryNode_"+K.id))&&m.add(K,"esriBasemapGallerySelectedNode"))},_select:function(K){this._selectBasemapInProgress=!0;var N=this.get(K);N?(N.layers?this._getServiceInfos(N):(K=N.getLayers(this.arcgisUrl),k.isArray(K)?this._getServiceInfos(N):K.addCallback(k.hitch(this,function(V){this._getServiceInfos(N)}))),
this._markSelected(N)):this._selectBasemapInProgress=!1},_getServiceInfos:function(K){"https:"===location.protocol&&t.forEach(K.layers,function(V){if(this._isAgolService(V.url)||this._isHostedService(V.url))V.url=V.url.replace("http:","https:")},this);this._selectedBasemap=K;var N=[];t.forEach(K.layers,function(V){V.url&&0<V.url.length&&!V.isReference&&!V.type&&(V.deferredsPos=N.length,N.push(this._getServiceInfo(V.url)))},this);0<N.length?(new g(N)).addCallback(k.hitch(this,function(V){var W=null;
t.forEach(K.layers,function(L){if(0===L.deferredsPos||L.deferredsPos){L.serviceInfoResponse=V[L.deferredsPos][1];var T=L.serviceInfoResponse.fullExtent;T||(T=L.serviceInfoResponse.extent);W=W?W.union(new E(T)):new E(T)}},this);this.map.extent&&5>this._getIntersectionPercent(W,this.map.extent)&&this.map.setExtent(W,!0);this._switchBasemapLayers(K);this._updateReferenceLayer(K)})):(this._switchBasemapLayers(K),this._updateReferenceLayer(K))},_checkVTLSupport:function(){var K=new f;c("ie")?K.resolve(!1):
K.resolve(u.supported());return K},_switchBasemapLayers:function(K){var N=K.layers,V=!1,W,L,T;t.forEach(N,function(U){"VectorTileLayer"===U.type&&(V=!0)});if(V&&!0!==this._supportsVTL)this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because layer type is not supported by your current browser version.");else if(0<this.map.layerIds.length&&0===this.map.getNumLevels()&&("OpenStreetMap"===N[0].type||N[0].type&&-1<N[0].type.indexOf("BingMaps")||"WebTiledLayer"===N[0].type||"VectorTileLayer"===
N[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else{t.forEach(N,function(U){if(!U.isReference&&U.type&&-1<U.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);var S=0;t.forEach(N,function(U,X){if(!U.isReference){if("OpenStreetMap"===U.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");
return}var Y=new G({id:"layer_osm",opacity:U.opacity})}else if(U.type&&-1<U.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}Y=C.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"===U.type?Y=C.MAP_STYLE_AERIAL:"BingMapsRoad"===U.type&&(Y=C.MAP_STYLE_ROAD);Y=new C({id:"layer_bing",bingMapsKey:this.bingMapsKey,mapStyle:Y,
opacity:U.opacity})}else if("WebTiledLayer"===U.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}Y=U.initialExtent||U.fullExtent;Y=new r(U.templateUrl||U.url,{visible:U.visibility,opacity:U.opacity,copyright:U.copyright,fullExtent:U.fullExtent&&new E(U.fullExtent),initialExtent:Y&&new E(Y),subDomains:U.subDomains,tileInfo:U.tileInfo?
new A(U.tileInfo):null,tileServers:U.tileServers})}else if("VectorTileLayer"===U.type){Y=new u(U.styleUrl,{visible:U.visibility,opacity:U.opacity});0===X&&1<N.length&&this._removeBasemapLayers();var Z=this;l.connect(Y,"onLoad",k.hitch(this,function(aa,ba,ia){var da=Z._sameSpatialReference(ia.spatialReference,Z.map.spatialReference);if(Z.map.spatialReference&&!da)Z.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");else{if(0<Z.map.getNumLevels()){if(da=
Z._sameTilingScheme(ia.tileInfo,Z.map.__tileInfo),!da){Z.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(Z.map.loaded){Z.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a vector tile layer and cannot be loaded as a dynamic layer.");return}0===ba&&1===N.length&&Z._removeBasemapLayers();ia._basemapGalleryLayerType="basemap";Z.map.addLayer(ia,aa)}},S,X))}else if(U.serviceInfoResponse&&
U.serviceInfoResponse.mapName){W=new B(U.serviceInfoResponse.spatialReference);L=this._sameSpatialReference(W,this.map.spatialReference);if(this.map.spatialReference&&!L){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===U.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()){if(T=this._sameTilingScheme(U.serviceInfoResponse.tileInfo,this.map.__tileInfo),!T){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");
return}}else if(!0===U.serviceInfoResponse.singleFusedMapCache&&-1<U.serviceInfoResponse.capabilities.toLowerCase().indexOf("tilesonly")&&this.map.loaded&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}Y=(0===this.map.layerIds.length||0<this.map.getNumLevels())&&!0===U.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(U):this._loadAsDynamic(U)}else if(U.serviceInfoResponse&&
U.serviceInfoResponse.pixelSizeX){W=new B(U.serviceInfoResponse.spatialReference);L=this._sameSpatialReference(W,this.map.spatialReference);if(this.map.spatialReference&&!L){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===U.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()&&(T=this._sameTilingScheme(U.serviceInfoResponse.tileInfo,this.map.__tileInfo),!T)){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");
return}U.serviceInfoResponse.singleFusedMapCache&&"ArcGISImageServiceLayer"!==U.type?Y="Raster"===U.serviceInfoResponse.cacheType?new F(U.url,{serviceInfo:U.serviceInfoResponse,opacity:U.opacity,visible:U.visibility,bandIds:U.bandIds&&0<U.bandIds.length?U.bandIds:null}):new I(U.url,{resourceInfo:U.serviceInfoResponse,opacity:U.opacity,visible:U.visibility}):U.serviceInfoResponse.pixelSizeX?(Y=new O,Y.bandIds=U.bandIds,U.renderingRule?Y.renderingRule=new z(U.renderingRule):!U.bandIds&&U.serviceInfoResponse.bandCount&&
3<parseInt(U.serviceInfoResponse.bandCount,10)&&(Y.bandIds=[0,1,2]),Y=new J(U.url,{resourceInfo:U.serviceInfoResponse,opacity:U.opacity,visible:U.visibility,imageServiceParameters:Y})):(Y=new P,Y.format="png24",U.serviceInfoResponse.supportedImageFormatTypes&&-1<U.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(Y.format="png32"),Y=new D(U.url,{resourceInfo:U.serviceInfoResponse,opacity:U.opacity,visible:U.visibility,imageParameters:Y}))}"VectorTileLayer"===U.type?S++:Y&&(0===X&&this._removeBasemapLayers(),
Y._basemapGalleryLayerType="basemap",this.map.addLayer(Y,S),S++)}},this);this._selectBasemapInProgress=!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var K=this.map.layerIds,N=[];t.forEach(K,function(V){V=this.map.getLayer(V);"basemap"===V._basemapGalleryLayerType&&N.push(V)},this);0===N.length&&0<K.length&&N.push(this.map.getLayer(K[0]));0<N.length&&t.forEach(N,function(V){this.map.removeLayer(V)},this)},_updateReferenceLayer:function(K){var N;this._removeReferenceLayer();for(N=0;N<
K.layers.length;N++)!0===K.layers[N].isReference&&this._addReferenceLayer(K.layers[N])},_removeReferenceLayer:function(){var K;for(K=this.map.layerIds.length-1;0<=K;K--){var N=this.map.getLayer(this.map.layerIds[K]);"reference"===N._basemapGalleryLayerType&&this.map.removeLayer(N)}},_addReferenceLayer:function(K){"VectorTileLayer"===K.type?this._handleReferenceServiceInfoResponse(K):this._getServiceInfo(K.url,k.hitch(this,"_handleReferenceServiceInfoResponse",K))},_handleReferenceServiceInfoResponse:function(K,
N,V){K.serviceInfoResponse=N;if("VectorTileLayer"===K.type)var W=new u(K.styleUrl,{visible:K.visibility,opacity:K.opacity});else N&&N.mapName?W=!0===N.singleFusedMapCache?this._loadAsCached(K):this._loadAsDynamic(K):N&&N.pixelSizeX&&(K.serviceInfoResponse.singleFusedMapCache?W=new I(K.url,{resourceInfo:K.serviceInfoResponse,opacity:K.opacity,visible:K.visibility}):K.serviceInfoResponse.pixelSizeX?(V=new O,V.bandIds=K.bandIds,K.renderingRule?V.renderingRule=new z(K.renderingRule):!K.bandIds&&N.bandCount&&
3<parseInt(N.bandCount,10)&&(V.bandIds=[0,1,2]),W=new J(K.url,{resourceInfo:N,opacity:K.opacity,visible:K.visibility,imageServiceParameters:V})):(N=new P,N.format="png24",K.serviceInfoResponse.supportedImageFormatTypes&&-1<K.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(N.format="png32"),N.transparent=!0,W=new D(K.url,{resourceInfo:K.serviceInfoResponse,opacity:K.opacity,visible:K.visibility,imageParameters:N})));W&&(W._basemapGalleryLayerType="reference",W.attr("data-reference",
!0),this.map.addLayer(W))},_getServiceInfo:function(K,N){return x({url:K,content:{f:"json"},callbackParamName:"callback",load:function(V,W){N&&N(V,W)},error:k.hitch(this,function(V,W){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(K){var N=[];K.displayLevels||(N=t.map(K.serviceInfoResponse.tileInfo.lods,function(W){return W.level}));var V=null;K.exclusionAreas&&K.exclusionAreas.length&&(V=[],t.forEach(K.exclusionAreas,function(W){V.push({minZoom:W.minZoom,
maxZoom:W.maxZoom,minScale:W.minScale,maxScale:W.maxScale,geometry:new E(W.geometry)})}));return new I(K.url,{resourceInfo:K.serviceInfoResponse,opacity:K.opacity,visible:K.visibility,exclusionAreas:V,displayLevels:K.displayLevels||N})},_loadAsDynamic:function(K){var N=new D(K.url,{resourceInfo:K.serviceInfoResponse,opacity:K.opacity,visible:K.visibility});K.visibleLayers&&N.setVisibleLayers(K.visibleLayers);return N},_getIntersectionPercent:function(K,N){return(K=N.intersects(K))?(K=K.getWidth()*
K.getHeight(),N=N.getWidth()*N.getHeight(),K/N*100):0},_getIds:function(){var K=[];t.forEach(this.basemaps,function(N){K.push(N.id)},this);return K},_getUniqueId:function(){for(var K=","+this._getIds().toString()+",",N=0;;)if(-1<K.indexOf(",basemap_"+N+","))N++;else return"basemap_"+N},_isUniqueId:function(K){return-1===(","+this._getIds().toString()+",").indexOf(","+K+",")?!0:!1},_isAgolService:function(K){return K?-1!==K.indexOf("/services.arcgisonline.com/")||-1!==K.indexOf("/server.arcgisonline.com/"):
!1},_isHostedService:function(K){return K?-1!==K.indexOf(".arcgis.com/"):!1},_sameSpatialReference:function(K,N){return K&&N&&K.wkt==N.wkt&&(K.wkid===N.wkid||w.isDefined(K.latestWkid)&&K.latestWkid===N.wkid||w.isDefined(N.latestWkid)&&K.wkid===N.latestWkid||w.isDefined(K.latestWkid)&&K.latestWkid===N.latestWkid)||K&&N&&K.isWebMercator()&&N.isWebMercator()?!0:!1},_sameTilingScheme:function(K,N){var V=this.map;V=V.width>V.height?V.width:V.height;var W=!1,L=!1,T,S;for(T=0;T<K.lods.length;T++){var U=
K.lods[T].scale;K.dpi!==N.dpi&&(U=K.lods[T].scale/K.dpi);for(S=0;S<N.lods.length;S++){var X=N.lods[S].scale;K.dpi!==N.dpi&&(X=N.lods[S].scale/N.dpi);if(Math.abs(X-U)/X<1/V)if(W){L=!0;break}else W=!0;if(X<U)break}if(L)break}return L||W&&(1===K.lods.length||1===N.lods.length)?!0:!1}});a("extend-esri")&&k.setObject("dijit.BasemapGallery",n,q);return n});