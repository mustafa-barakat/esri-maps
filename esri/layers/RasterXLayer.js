// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(H,n,u){H.DeferredList=function(m,k,e,c,a){var b=[];n.call(this);var f=this;0!==m.length||k||this.resolve([0,[]]);var g=0;u.forEach(m,function(h,d){function l(p,v){b[d]=[p,v];g++;g===m.length&&f.resolve(b)}h.then(function(p){k?f.resolve([d,p]):l(!0,p)},function(p){e?f.reject(p):l(!1,p);if(c)return null;throw p;})})};H.DeferredList.prototype=new n;H.DeferredList.prototype.gatherResults=
function(m){m=new H.DeferredList(m,!1,!0,!1);m.addCallback(function(k){var e=[];u.forEach(k,function(c){e.push(c[1])});return e});return m};return H.DeferredList})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point ./RasterFunction".split(" "),function(H,n,u,m,k,e,c){var a=H(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,
operation:null,multidimensionalDefinition:[],itemRenderingRule:null,constructor:function(b){n.isObject(b)&&(n.mixin(this,b),b.mosaicMethod&&(this.method=b.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),b.mosaicOperation&&(this.operation=b.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),b.fids&&(this.objectIds=b.fids),b.viewpoint&&
(this.viewpoint=new e(b.viewpoint)),b.itemRenderingRule&&(this.itemRenderingRule=new c(b.itemRenderingRule)),this.multidimensionalDefinition=b.multidimensionalDefinition||[])},toJson:function(){var b=null,f=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(f){b=[];for(var g=0;g<f;g++)b.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[g].declaredClass?this.multidimensionalDefinition[g].toJson():this.multidimensionalDefinition[g])}b={mosaicMethod:this.method,
where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:n.clone(this.lockRasterIds),viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:n.clone(this.objectIds),mosaicOperation:this.operation,multidimensionalDefinition:b,itemRenderingRule:this.itemRenderingRule?this.itemRenderingRule.toJson():null};return k.filter(b,function(h){if(null!==h)return!0})},_getMethodEnum:function(b){if(b){var f=a.METHOD_NONE;switch(b.toLowerCase()){case "byattribute":f=
a.METHOD_ATTRIBUTE;break;case "center":f=a.METHOD_CENTER;break;case "lockraster":f=a.METHOD_LOCKRASTER;break;case "nadir":f=a.METHOD_NADIR;break;case "northwest":f=a.METHOD_NORTHWEST;break;case "seamline":f=a.METHOD_SEAMLINE;break;case "viewpoint":f=a.METHOD_VIEWPOINT}return f}},_getOperatorEnum:function(b){if(b)switch(b.toLowerCase()){case "first":return a.OPERATION_FIRST;case "last":return a.OPERATION_LAST;case "max":return a.OPERATION_MAX;case "min":return a.OPERATION_MIN;case "blend":return a.OPERATION_BLEND;
case "mean":return a.OPERATION_MEAN;case "sum":return a.OPERATION_SUM}}});n.mixin(a,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",
OPERATION_SUM:"MT_SUM"});u("extend-esri")&&n.setObject("layers.MosaicRule",a,m);return a})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(H,n,u,m,k){H=H(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(e){n.isObject(e)&&n.mixin(this,e)},toJson:function(){var e={variableName:this.variableName,dimensionName:this.dimensionName,
values:n.clone(this.values),isSlice:this.isSlice};return k.filter(e,function(c){return null!==c})}});u("extend-esri")&&n.setObject("layers.DimensionalDefinition",H,m);return H})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(H,n,u,m){H=H([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],maskIsAlpha:!1,validPixelCount:null,constructor:function(k){if(k){if(!k.width||
Math.floor(k.width)!==k.width)throw"PixelBlock: incorrect width";if(!k.height||Math.floor(k.height)!==k.height)throw"PixelBlock: incorrect height";if(!k.pixels)throw"PixelBlock: pixel data not present";this.width=k.width;this.height=k.height;this.pixels=k.pixels;this.pixelType=k.pixelType||null;this.statistics=k.statistics;this.mask=k.mask||null;this.maskIsAlpha=k.maskIsAlpha||!1;k=k.validPixelCount;null==k&&(k=this.mask?this._getValidPixelCount(this.mask):this.width*this.height);this.validPixelCount=
k}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(k){if(!k.pixels||!k.statistics)throw"Pixel data or statistics are not present";if(k.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(k.statistics);this.pixels.push(k.pixels)},getAsRGBA:function(){var k=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(k);
break;default:this._fillFrom8Bit(k)}return new Uint8ClampedArray(k)},getAsRGBAFloat:function(){var k=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(k);return k},clone:function(k){k=k||this;var e=new this.constructor;e.width=k.width;e.height=k.height;e.pixelType=k.pixelType;e.maskIsAlpha=k.maskIsAlpha;k.mask&&(e.mask=new Uint8Array(k.mask));var c,a;if(k.pixels){e.pixels=[];var b=(a=k.pixels.length)&&k.pixels[0].slice;for(c=0;c<a;c++)e.pixels[c]=b?k.pixels[c].slice(0,k.pixels[c].length):
new k.pixels[c].constructor(k.pixels[c])}if(k.statistics)for(e.statistics=[],a=k.statistics.length,c=0;c<a;c++)e.statistics[c]=n.clone(k.statistics[c]);k=k.validPixelCount;null==k&&(k=e.mask?this._getValidPixelCount(e.mask):e.width*e.height);return e},clamp:function(k){if("F64"!==k&&"F32"!==k){switch(k){case "U8":var e=[0,255];break;case "U16":e=[0,65535];break;case "U32":e=[0,4294967295];break;case "S8":e=[-128,127];break;case "S16":e=[-32768,32767];break;case "S32":e=[-2147483648,2147483647];break;
default:e=[-3.4*1E39,3.4*1E39]}var c=e[0];e=e[1];var a=this.pixels,b=this.width*this.height,f=a.length,g,h,d=[];for(g=0;g<f;g++){var l=this._createEmptyBand(k,b);var p=a[g];for(h=0;h<b;h++){var v=p[h];l[h]=v>e?e:v<c?c:v}d.push(l)}this.pixels=d;this.pixelType=k}},calculateStatistics:function(){var k,e=[],c=this.mask;for(k=0;k<this.pixels.length;k++){var a=this.pixels[k];e.push(this._calculateBandStatistics(a,c))}this.statistics=e},_getValidPixelCount:function(k){var e,c=0;for(e=0;e<k.length;e++)k[e]&&
c++;return c},_createEmptyBand:function(k,e){switch(k){case "U8":k=new Uint8Array(e);break;case "U16":k=new Uint16Array(e);break;case "U32":k=new Uint32Array(e);break;case "S8":k=new Int8Array(e);break;case "S16":k=new Int16Array(e);break;case "S32":k=new Int32Array(e);break;case "U32":k=new Uint32Array(e);break;case "F32":k=new Float32Array(e);break;case "F64":k=new Float64Array(e);break;default:k=new Float32Array(e)}return k},_fillFrom8Bit:function(k){var e=this.pixels,c=this.mask;if(!k||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var a,b;var f=a=b=e[0];3<=e.length&&(a=e[1],b=e[2]);e=new Uint32Array(k);var g=this.width*this.height;if(f.length!==g)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(c&&c.length===g)if(this.maskIsAlpha)for(k=0;k<g;k++)c[k]&&(e[k]=c[k]<<24|b[k]<<16|a[k]<<8|f[k]);else for(k=0;k<g;k++)c[k]&&(e[k]=-16777216|b[k]<<16|a[k]<<8|f[k]);else for(k=0;k<g;k++)e[k]=-16777216|b[k]<<16|a[k]<<8|f[k]},_fillFromNon8Bit:function(k){var e=this.pixels,c=this.mask,a=this.statistics;if(!k||
!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var b=1,f=0;b=1;a&&0<a.length?(f=a.map(function(l){return l.minValue}).reduce(function(l,p){return Math.min(l,p)}),b=a.map(function(l){return l.maxValue-l.minValue}).reduce(function(l,p){return Math.max(l,p)}),b=255/b):(b=255,"S8"===this.pixelType?(f=-128,b=127):"U16"===this.pixelType?b=65535:"S16"===this.pixelType?(f=-32768,b=32767):"U32"===this.pixelType?b=4294967295:"S32"===this.pixelType?(f=-2147483648,
b=2147483647):"F32"===this.pixelType?(f=-3.4*1E39,b=3.4*1E39):"F64"===this.pixelType&&(f=-Number.MAX_VALUE,b=Number.MAX_VALUE),b=255/(b-f));k=new Uint32Array(k);a=this.width*this.height;var g=e[0];if(g.length!==a)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=e.length){var h=e[1];var d=e[2];if(c&&c.length===a)for(e=0;e<a;e++)c[e]&&(k[e]=-16777216|(d[e]-f)*b<<16|(h[e]-f)*b<<8|(g[e]-f)*b);else for(e=0;e<a;e++)k[e]=-16777216|(d[e]-f)*b<<16|(h[e]-f)*b<<8|(g[e]-f)*
b}else if(c&&c.length===a)for(e=0;e<a;e++)h=(g[e]-f)*b,c[e]&&(k[e]=-16777216|h<<16|h<<8|h);else for(e=0;e<a;e++)h=(g[e]-f)*b,k[e]=-16777216|h<<16|h<<8|h},_fillFrom32Bit:function(k){var e=this.pixels,c=this.mask;if(!k||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,b;var f=a=b=e[0];3<=e.length&&(a=e[1],b=e[2]);var g=this.width*this.height;if(f.length!==g)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var h=0;if(c&&
c.length===g)for(e=0;e<g;e++)k[h++]=f[e],k[h++]=a[e],k[h++]=b[e],k[h++]=c[e]&1;else for(e=0;e<g;e++)k[h++]=f[e],k[h++]=a[e],k[h++]=b[e],k[h++]=1},_calculateBandStatistics:function(k,e){var c=Infinity,a=-Infinity,b=k.length,f,g=0;if(e)for(f=0;f<b;f++)e[f]&&(g=k[f],c=g<c?g:c,a=g>a?g:a);else for(f=0;f<b;f++)g=k[f],c=g<c?g:c,a=g>a?g:a;return{minValue:c,maxValue:a}}});u("extend-esri")&&n.setObject("layers.PixelBlock",H,m);return H})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query dojo/DeferredList ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ../renderers/colorRampUtils ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v,r,w,y,z,E,B,C,G,I,D,q,t,A,J,M,N){H=H(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_rasterFunctionServiceInfoProps:"bandCount pixelType hasRasterAttributeTable hasColormap hasHistograms minValues maxValues meanValues stdvValues serviceDataType".split(" "),_pixelTypeRanges:{U1:[0,1],U2:[0,3],U4:[0,15],U8:[0,255],S8:[-128,127],U16:[0,65535],S16:[-32768,32767]},_eventMap:{"rendering-change":!0,
"mosaic-rule-change":!0,"spatial-reference-change":!0,"renderer-change":!0},_cachedVariableStats:{},_cachedVariableHistogram:{},constructor:function(x,F){this.useMapTime=F&&F.hasOwnProperty("useMapTime")?!!F.useMapTime:!0},_initialize:function(x,F){this._url=v.urlToObject(x);this.raster=new G(this._url.path);this._rasterFunctionTemplateInfos={};this._customRenderingRuleId={};this.infoTemplate=F&&F.infoTemplate;this.format=(x=F&&F.imageServiceParameters)&&x.format;this.compressionTolerance=x&&x.compressionTolerance?
x.compressionTolerance:.01;this.interpolation=x?x.interpolation:null;this.compressionQuality=x?x.compressionQuality:null;this.bandIds=x?x.bandIds:null;this.mosaicRule=x?x.mosaicRule:null;this.renderingRule=x?x.renderingRule:null;this.renderer=x?x.renderer:null;this.useMapDimensionValue=F&&F.hasOwnProperty("useMapDimensionValue")?!!F.useMapDimensionValue:!0;this.hasImageFilter=F&&F.hasImageFilter;this.activeMapDimensions=F&&F.activeMapDimensions;this._params=n.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,
format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},x?x.toJson():{});this.pixelFilter=F&&F.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=n.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=n.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=n.hitch(this,this._initLayer);this._queryVisibleRastersHandler=n.hitch(this,this._queryVisibleRastersHandler);
this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._renderingRuleColormap={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=F&&F.loadCallback;x&&x.renderer&&(x.renderer.outputUnit||x.renderer.inputUnit)&&(this.vectorFieldPixelFilter=new D,this.vectorFieldPixelFilter.setUnits(x.renderer.inputUnit,x.renderer.outputUnit));(F=F&&F.resourceInfo)?this._initLayer(F):l({url:this._url.path,content:n.mixin({f:"json"},
this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(x,F){if(null!==x&&void 0!==x){this._findCredential();(this.credential&&this.credential.ssl||x&&x._ssl)&&this._useSSL();F=this.minScale;var L=this.maxScale;n.mixin(this,x);this.minScale=F;this.maxScale=L;this.initialExtent=this.fullExtent=this.extent=new r(x.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=
parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);var O=this.minValues,P=this.maxValues,S=this.meanValues,T=this.stdvValues,W=this.bands=[];F=0;for(L=this.bandCount;F<L;F++)W[F]={min:O[F],max:P[F],mean:S[F],stddev:T[F]};this.timeInfo=(F=this.timeInfo)&&F.timeExtent?new t(F):null;L=this.fields=[];if(O=x.fields)for(F=0;F<O.length;F++)L.push(new A(O[F]));this._updateInfoTemplateFields(this.fields);this.version=x.currentVersion;this.version||(this.version="fields"in x||"objectIdField"in
x||"timeInfo"in x?10:9.3);d.isDefined(x.minScale)&&!this._hasMin&&"Raster"!==x.cacheType&&this.setMinScale(x.minScale);d.isDefined(x.maxScale)&&!this._hasMax&&"Raster"!==x.cacheType&&this.setMaxScale(x.maxScale);F={};x.defaultMosaicMethod?(F.method=x.defaultMosaicMethod,F.operation=x.mosaicOperator,F.sortField=x.sortField,F.sortValue=x.sortValue):F.method=E.METHOD_NONE;this.defaultMosaicRule=new E(F);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===
this.serviceDataType;this._setDefaultRenderingRule(!0);this._getRenderingRuleAttributeTableAndColormap();this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(n.hitch(this,function(X){X&&(X.features&&X.fields&&(this.rasterAttributeTable=n.clone(X)),X.features&&0<X.features.length&&(this._rasterAttributeTableFeatures=
n.clone(X.features)),X.fields&&0<X.fields.length&&(this._rasterAttributeTableFields=n.clone(X.fields)),this.renderingRule||!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh())}));this._initVectorPixelFilter();this.bandIds||2!==this.bandCount||this.renderingRule||"esri.layers.ArcGISImageServiceLayer"!==this.declaredClass||this.setBandIds([0,0,0],!0);!(10.3<=this.version&&this.rasterFunctionInfos&&
this.rasterFunctionInfos.length)||this._url.query&&this._url.query.raster||this.getRasterFunctionInfos().then(n.hitch(this,function(X){if(X&&X.length){this.rasterFunctionInfos=X;var K=[],R;m.forEach(X,function(Q){if(Q){var U=Q.functionType;R=R||1===U||2===U;K.push(Q.name)}},this);this._hasItemLevelRFT=R;this._rasterFunctionNames=K;R&&(this._initVectorPixelFilter(),this.refresh())}}));this.loaded=!0;this._setDefaultFilter();this.onLoad(this);if(x=this._loadCallback)delete this._loadCallback,x(this)}},
_updateInfoTemplateFields:function(x){if(x&&!(1>x.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var F,L;var O=this.infoTemplate.info.fieldInfos;for(F=0;F<x.length;F++){var P=x[F];for(L=0;L<O.length;L++)if(O[L].fieldName.toLowerCase()===P.name.toLowerCase()&&O[L].fieldName!==P.name){O[L].fieldName=P.name;break}}}},getKeyProperties:function(x){var F=this._url.path+"/keyProperties",L=new u(p._dfdCanceller),O={f:"json"};
x&&x.renderingRule&&(O.renderingRule=k.toJson(x.renderingRule.toJson()));10<this.version?(L._pendingDfd=l({url:F,content:O,handleAs:"json",callbackParamName:"callback"}),L._pendingDfd.then(function(P){L.callback(P)},function(P){L.errback(P)})):(x=Error("Layer does not have key properties"),x.log=!!e.isDebug,L.errback(x));return L},getRasterAttributeTable:function(x){var F=this._url.path+"/rasterAttributeTable",L=new u(p._dfdCanceller),O={f:"json"},P=this.hasRasterAttributeTable;x&&x.renderingRule&&
(O.renderingRule=k.toJson(x.renderingRule.toJson()),P=!0);!this.loaded||10<this.version&&P?(L._pendingDfd=l({url:F,content:O,handleAs:"json",callbackParamName:"callback"}),L._pendingDfd.then(function(S){L.callback(S)},function(S){L.errback(S)})):(x=Error("Layer does not support raster attribute table"),x.log=!!e.isDebug,L.errback(x));return L},getRenderingRuleAttributeTable:function(x){var F=new u(p._dfdCanceller);if(!x||!x.renderingRule)return F.errback(Error("Rendering rule is not specified")),
F;x=x.renderingRule;var L=this._getRenderingRuleId(x);this._renderingRuleAttributeTable&&L&&this._renderingRuleAttributeTable.hasOwnProperty(L)?F.resolve(this._renderingRuleAttributeTable[L]):F=this.getRasterAttributeTable({renderingRule:x}).then(n.hitch(this,function(O){if(O&&O.features&&O.features.length&&O.fields&&O.fields.length){var P={features:n.clone(O.features),fields:n.clone(O.fields)};L&&(this._renderingRuleAttributeTable[L]=P)}return P}));return F},_initVectorPixelFilter:function(){var x;
this._hasItemLevelRFT&&this.renderingRule&&(x=this._getItemLevelRenderingRule(this.renderingRule));if(x=x||this.renderingRule)return this.getRenderingRuleServiceInfo(x).then(n.hitch(this,function(F){!F||!this._isVectorData(F)&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass||d.isDefined(this.pixelFilter)||(this.vectorFieldPixelFilter=this.vectorFieldPixelFilter||new D,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===F.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,
this.getKeyProperties().then(n.hitch(this,this._setFlowRepresentation)),this._applyVectorResamplingType(F.serviceDataType))}))},_applyVectorResamplingType:function(x){if(x){var F=this.renderingRule;F&&"Resample"===F.functionName&&((F.functionArguments||{}).ResamplingType="esriImageServiceDataTypeVector-UV"===x?7:10,this.setRenderingRule(new B(F.toJson())))}},_getRasterAttributeTableFeatures:function(){var x=new u;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return x.resolve(this._rasterAttributeTableFeatures),
x;if(10<this.version&&this.hasRasterAttributeTable)return x=this.getRasterAttributeTable(),x.then(n.hitch(this,function(F){F&&F.features&&0<F.features.length&&(this._rasterAttributeTableFeatures=n.clone(F.features))})),x;x.resolve(this._rasterAttributeTableFeatures);return x},_getRenderingRuleAttributeTableFeatures:function(x){x=x&&x.renderingRule;return x?this.getRenderingRuleAttributeTable({renderingRule:x}).then(function(F){return F&&F.features}):(x=new u,x.errback(Error("Rendering rule is not specified")),
x)},_getRenderingRuleAttributeTableAndColormap:function(){this.renderingRule&&this.getRenderingRuleServiceInfo(this.renderingRule).then(n.hitch(this,function(x){x.hasRasterAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:this.renderingRule}).then(n.hitch(this,function(){!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh()}));x.hasColormap&&this.getRenderingRuleColormap({renderingRule:this.renderingRule}).then(n.hitch(this,
function(){this.renderer&&"esri.renderer.ColormapRenderer"===this.renderer.declaredClass&&this.refresh()}))}))},getCustomRasterFields:function(x){var F=x?x.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;x=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var L={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:x},O={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,
length:50,type:x},P={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},S=this.fields?n.clone(this.fields):[];x=S.length;S[x]=O;10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRenderingRuleAProcessingTemplate({functionName:"none"}))&&(x++,S[x]=P);if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||
this.fields&&0<this.fields.length)x++,S[x]=L;!d.isDefined(this.pixelFilter)||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(L={name:this._rasterFieldPrefix+"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},O={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},x++,S[x]=L,x++,S[x]=O);x=this._rasterAttributeTableFields;(L=this.renderingRule&&
this._getRenderingRuleId(this.renderingRule))&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(L)&&(x=this._renderingRuleAttributeTable[L].fields);x&&0<x.length&&(x=m.filter(x,function(W){return"esriFieldTypeOID"!==W.type&&"value"!==W.name.toLowerCase()}),x=m.map(x,function(W){var X=n.clone(W);X.name=F+W.name;return X}),S=S.concat(x));var T=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&m.forEach(this.rasterFunctionInfos,
function(W){W&&W.name&&"none"!==W.name.toLowerCase()&&(W={name:T+W.name.replace(/ /gi,"_"),alias:W.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},S.push(W))});return S},_applyTimeToMultidimensionalCRF:function(x,F){var L=this._isTimeSupportedOnCRF();if(L&&(!x||!x.multidimensionalDefinition))return x;var O=this.timeInfo&&this.timeInfo.startTimeField;if((F=F||this._params.time)&&O&&this._isMultidimensionalCRF()){x=n.clone(x||this.defaultMosaicRule)||new E;x.multidimensionalDefinition=x.multidimensionalDefinition||
[];var P=x.multidimensionalDefinition.filter(function(T){return T.dimensionName===O}),S=F.split(",").map(function(T){return parseInt(T,10)});2===S.length&&S[0]===S[1]&&(S.length=1);0<P.length?L?x.multidimensionalDefinition.forEach(function(T){T.dimensionName===O&&(T.dimensionName=null,T.isSlice=null,T.values=null)}):x.multidimensionalDefinition.forEach(function(T){T.dimensionName===O&&(T.isSlice=1===S.length,T.values=1===S.length?S:[S])}):L||(x.multidimensionalDefinition.some(function(T){return null!=
T.variableName&&null==T.dimensionName})?x.multidimensionalDefinition.forEach(function(T){null!=T.variableName&&null==T.dimensionName&&(T.dimensionName=O,T.isSlice=1===S.length,T.values=1===S.length?S:[S])}):x.multidimensionalDefinition.push(new C({variableName:"",dimensionName:O,isSlice:1===S.length,values:1===S.length?S:[S]})));this._cleanupMultidimensionalDefinition(x)}return x},_prepareGetImageParameters:function(x,F,L,O){O=d.isDefined(O)?O:this._params;if(this.renderer||this._hasItemLevelRFT&&
this.renderingRule){var P=this.getExportImageRenderingRule();O.renderingRule=P?k.toJson(P.toJson()):null}P=this.getExportImageMosaicRule(O);O.mosaicRule=P?k.toJson(P.toJson()):null;P=x.spatialReference.wkid||k.toJson(x.spatialReference.toJson(!1));delete O._ts;n.mixin(O,{bbox:x.xmin+","+x.ymin+","+x.xmax+","+x.ymax,imageSR:P,bboxSR:P,size:F+","+L},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete O.compressionTolerance;O.format&&"LERC"===O.format.toUpperCase()&&(O.compressionTolerance=
this.compressionTolerance);O.token=this._getToken()},getImageUrl:function(x,F,L,O,P){P=d.isDefined(P)?P:this._params;this._prepareGetImageParameters(x,F,L,P);x=n.clone(P);this._cleanupRequestParams(x);F=this._url.path+"/exportImage?";L=v.addProxy(F+b.objectToQuery(n.mixin(x,{f:"image"})));var S=x.token;L.length>h.defaults.io.postLength||this.useMapImage?this._jsonRequest=l({url:F,content:n.mixin(x,{f:"json"}),callbackParamName:"callback",load:function(T,W){T=T.href;S&&(T+=-1===T.indexOf("?")?"?token\x3d"+
S:"\x26token\x3d"+S);O(v.addProxy(T))},error:this._errorHandler}):O(L)},onRenderingChange:function(){},onMosaicRuleChange:function(){},onRendererChange:function(){},setInterpolation:function(x,F){this.interpolation=this._params.interpolation=x;F||this.refresh(!0)},setCompressionQuality:function(x,F){this.compressionQuality=this._params.compressionQuality=x;F||this.refresh(!0)},setCompressionTolerance:function(x,F){this.compressionTolerance=x;F||this.refresh(!0)},setBandIds:function(x,F){var L=!1;
this.bandIds!==x&&(L=!0);this.bandIds=x;this._params.bandIds=x?x.join(","):null;if(L&&!F)this.onRenderingChange();F||this.refresh(!0)},setDefaultBandIds:function(x){this.bandIds=this._params.bandIds=null;x||this.refresh(!0)},setDisableClientCaching:function(x){this.disableClientCaching=x},setMosaicRule:function(x,F){var L=!1;this.mosaicRule!==x&&(L=!0);this.mosaicRule=x;this._params.mosaicRule=k.toJson(x.toJson());if(L&&!F)this.onMosaicRuleChange();F||this.refresh(!0)},getRasterFunctionInfos:function(){if(10.3>
this.version||!this.rasterFunctionInfos||!this.rasterFunctionInfos.length)console.log("Layer doesn't support /rasterFunctionInfos resource.");else return l({url:this._url.path+"/rasterFunctionInfos",content:{f:"json"},handleAs:"json",load:function(x){return x&&x.rasterFunctionInfos}})},setRenderingRule:function(x,F){var L=!1;this.renderingRule!==x&&(L=!0);this.renderingRule=x;this._params.renderingRule=x?k.toJson(x.toJson()):null;this._useRenderingRuleAttributeTable?this.getRenderingRuleAttributeTable({renderingRule:x}):
"esri.layers.RasterXLayer"!==this.declaredClass&&this._getRenderingRuleAttributeTableAndColormap();if(L)this.onRenderingChange();this._setDefaultFilter();F||this.refresh(!0)},setImageFormat:function(x,F){this.format=this._params.format=x;this._setDefaultFilter();F||this.refresh(!0)},setInfoTemplate:function(x){this.infoTemplate=x;this._updateInfoTemplateFields(this.fields)},setDefinitionExpression:function(x,F){var L=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?
L=this.defaultMosaicRule.toJson():L.method=E.METHOD_NONE);L.where=x;x=new E(L);this.setMosaicRule(x,F);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(x){this.pixelFilter=x;this._isDefaultPixelFilter=!1},getPixelData:function(x){return x?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):
this.pixelData},getExportImageRenderingRule:function(){var x;this._hasItemLevelRFT&&this.renderingRule&&(x=this._getServiceLevelRenderingRule(this.renderingRule));x=x||this.renderingRule;this._isItemLevelRasterFunction(this.renderingRule)&&(x=void 0);return this._combineRenderingRule(this._convertRendererToRenderingRule(this.renderer),x)},getExportImageMosaicRule:function(){var x=this.mosaicRule,F;this._hasItemLevelRFT&&this.renderingRule&&(F=this._getItemLevelRenderingRule(this.renderingRule));F&&
(x=x||this.defaultMosaicRule||new E,x.itemRenderingRule=F);return x=this._applyTimeToMultidimensionalCRF(x)},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getHistograms:function(x){var F=new u(p._dfdCanceller);if(x&&this._cachedVariableHistogram[x])return F.resolve(this._cachedVariableHistogram[x]),F;if(this.hasHistograms){var L={f:"json"};x&&(L.variable=x);F._pendingDfd=l({url:this._url.path+"/histograms",content:L,handleAs:"json",callbackParamName:"callback"});
F._pendingDfd.then(n.hitch(this,function(O){x&&(this._cachedVariableHistogram[x]=O);F.callback(O)}),function(O){F.errback(O)})}else L=Error("Layer does not have histograms."),L.log=!!e.isDebug,F.errback(L);return F},computeHistograms:function(x){var F=new u(p._dfdCanceller);if(10.1<=this.currentVersion){x=x||{};var L=x.geometry||this.fullExtent,O=(x.geometry||this.fullExtent).toJson();L="extent"===L.type?"esriGeometryEnvelope":"esriGeometryPolygon";var P=x.renderingRule||this.renderingRule||this.defaultRenderingRule;
P=P?P.toJson():null;var S=x.mosaicRule||this.mosaicRule||this.defaultMosaicRule;S=S?S.toJson():null;x=x.pixelSize||{x:this.pixelSizeX,y:this.pixelSizeY};F._pendingDfd=l({url:this._url.path+"/computeHistograms",content:n.mixin({f:"json",geometry:JSON.stringify(O),geometryType:L,renderingRule:JSON.stringify(P),mosaicRule:JSON.stringify(S),pixelSize:JSON.stringify(x),callbackParamName:"callback"}),handleAs:"json"});F._pendingDfd.then(function(T){F.callback(T)},function(T){F.errback(T)})}else O=Error("Layer doesn't support computeHistograms."),
O.log=!!e.isDebug,F.errback(O);return F},getRenderingRuleServiceInfo:function(x,F){function L(S){return S.name&&S.arguments&&S.function&&S.hasOwnProperty("functionType")}var O=new p._fixDfd(new u(p._dfdCanceller));if(!x)return O.errback(Error("Rendering rule is not specified")),O;if(L(x))"ClipFunction"===x.function.type&&(x=this._handleClipFunctionInRenderingRule(x));else{var P=this._getRenderingRuleId(x);if(P&&this._rasterFunctionTemplateInfos[P])return O.resolve(this._rasterFunctionTemplateInfos[P]),
O}return l({url:this._url.path,content:n.mixin(n.mixin({f:"json",renderingRule:JSON.stringify(x.toJson())},this._url.query)),callbackParamName:"callback",load:n.hitch(this,function(S){var T={};m.forEach(this._rasterFunctionServiceInfoProps,function(W){T[W]=S[W]});L(x)||(this._rasterFunctionTemplateInfos[P]=T);return T}),error:F||this._errorHandler})},queryVisibleRasters:function(x,F,L,O){var P=this._map,S=p._fixDfd(new u(p._dfdCanceller));this._visibleRasters=[];var T,W,X=!0,K=!0,R=null,Q=this.infoTemplate?
this.infoTemplate.info:null,U=Q?n.clone(this.infoTemplate.info.fieldInfos):null;F=F||{};if(Q&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var V=[];m.forEach(this.infoTemplate.info.mediaInfos,function(ba){V=V.concat(ba&&ba.value&&ba.value.fields||[])});V.length&&m.forEach(U,function(ba){ba&&-1<V.indexOf(ba.fieldName)&&(ba.visible=!0)})}var Y=function(ba){var na=Q&&Q.title&&-1<Q.title.toLowerCase().indexOf(ba.toLowerCase());ba=Q&&Q.description&&-1<Q.description.toLowerCase().indexOf(ba.toLowerCase());
return na||ba};if(U&&0<U.length)for(X=!1,T=0;T<U.length;T++)if((W=U[T])&&W.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(W.visible||Y(W.fieldName))){X=!0;break}this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("returnTopmostRaster")&&(R=this.infoTemplate.info.layerOptions.returnTopmostRaster?1:null);U&&0<U.length&&(K=!1,m.some(U,function(ba){if(ba&&ba.fieldName.toLowerCase()===
this._rasterFieldPrefix.toLowerCase()+"itempixelvalue"&&ba.visible)return K=!0},this),Y(this._rasterFieldPrefix.toLowerCase()+"itempixelvalue")&&(K=!0));var Z=(W=this._removeVisualizationStretchFunction(this.renderingRule))&&W.functionName,aa=[];if(10.4<=this.version){var ca=!1;if(this.rasterFunctionInfos&&U){var oa=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;m.forEach(this.rasterFunctionInfos,function(ba){var na=oa+ba.name.replace(/ /gi,"_");m.some(U,function(ra){return ra.visible&&
ra.fieldName===na})&&(ca=ca||Z&&Z===ba.name,aa.push(new B({rasterFunction:ba.name})))})}W&&!ca&&aa.push(W)}T=new N;T.geometry=x.geometry;T.returnGeometry=this._map.spatialReference.equals(this.spatialReference);T.returnCatalogItems=X;T.timeExtent=this.timeInfo?x.timeExtent:null;T.returnPixelValues=K;T.maxItemCount=R||x.maxItemCount;this._params.time&&this.mosaicRule?(x=n.clone(this.mosaicRule),x=this._filterOutTimeDimension(x),T.mosaicRule=x):T.mosaicRule=this.mosaicRule||null;this._isMultidimensionalCRF()&&
T.timeExtent&&(T.mosaicRule=this._applyTimeToMultidimensionalCRF(T.mosaicRule,T.timeExtent.toJson().join(",")),this._isTimeSupportedOnCRF()||delete T.timeExtent);T.renderingRule=10.4>this.version&&W||null;T.renderingRules=aa||null;10.8>this.version&&(T.returnPixelValues=void 0,T.maxItemCount=void 0);P&&(P=new w((P.extent.xmax-P.extent.xmin)/P.width,(P.extent.ymax-P.extent.ymin)/P.height,P.extent.spatialReference),T.pixelSize=P);F.requestParams=T;var ea=this;P=new M(this.url);(S._pendingDfd=P.execute(T)).addCallbacks(function(ba){ea._queryVisibleRastersHandler(ba,
F,L,O,S)},function(ba){ea._resolve([ba],null,O,S,!0)});return S},_queryVisibleRastersHandler:function(x,F,L,O,P){function S(){var da=this.getCustomRasterFields(F),sa=this._getDomainFields(da),xa=F?F.returnDomainValues:!1,fa=F&&F.rasterAttributeTableFieldPrefix,va,ka,Aa,Ka,Ba,La,Ra,Pa,ha,Ma;da=(da=this._getRenderingRuleId(this.renderingRule))&&this._rasterFunctionTemplateInfos[da];this.renderingRule&&(this._useRenderingRuleAttributeTable||da)?(da=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),
this.hasRasterAttributeTable||(Ma=T)):da=this._getRasterAttributeTableFeatures();da.then(n.hitch(this,function(Qa){for(va=0;va<ea.length;va++){la=ea[va];la.setInfoTemplate(this.infoTemplate);la._layer=this;if(T){ha=T.replace(/ /gi,"").split(",");ka=T;Aa=ha;ba&&ba.length>=va&&(ka=ba[va].replace(/ /gi,", "),Aa=ba[va].split(" "));la.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=Aa;la.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=ha;W&&(la.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=
W.replace(/ /gi,"").split(","));if(this.pixelFilter){var ua=new I({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});m.forEach(Aa,function(pa){ua.addData({pixels:[pa],statistics:{minValue:pa,maxValue:pa,noDataValue:null}})});this.pixelFilter({pixelBlock:ua,extent:new r(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)la.attributes[this._rasterFieldPrefix+"Magnitude"]=ua.pixels[0][0],
la.attributes[this._rasterFieldPrefix+"Direction"]=ua.pixels[1][0]}m.forEach(U,function(pa){la.attributes[pa.name]=pa.value});var Na=0<this.fields.length?Ma||ka:Ma||W;if(Qa&&0<Qa.length&&(Ka=m.filter(Qa,function(pa){if(pa&&pa.attributes)return pa.attributes.hasOwnProperty("Value")?pa.attributes.Value==Na:pa.attributes.VALUE==Na}),0<Ka.length&&(Ba=n.clone(Ka[0]),fa&&Ba))){Pa={};for(La in Ba.attributes)Ba.attributes.hasOwnProperty(La)&&(Ra=fa+La,Pa[Ra]=Ba.attributes[La]);Ba.attributes=Pa;la.attributes=
n.mixin(la.attributes,Ba.attributes)}}xa&&sa&&0<sa.length&&m.forEach(sa,function(pa){if(pa){var wa=la.attributes[pa.name];d.isDefined(wa)&&(wa=this._getDomainValue(pa.domain,wa),d.isDefined(wa)&&(la.attributes[pa.name]=wa))}},this);Ca.push(la);this._visibleRasters.push(la)}this._resolve([Ca,null,!0],null,L,P)}))}var T=x.value,W=x.value,X=0,K=0,R=this,Q=this.objectIdField,U=[];O=F.requestParams.renderingRules;var V=x.processedValues,Y=this.renderingRule&&k.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());
if(O&&V&&O.length===V.length){var Z=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;m.forEach(O,function(da,sa){if(da.functionName){var xa={name:Z+da.functionName.replace(/ /gi,"_"),value:V[sa].replace(/ /gi,"").split(",")};U.push(xa);Y&&Y===k.toJson(da.toJson())&&(T=V[sa])}})}O=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(x.catalogItems){var aa=
0,ca=x.catalogItems.features.length;var oa=0;var ea=Array(ca);var ba=Array(ca);var na=Array(ca);if(x.properties&&x.properties.Values){ca=x.properties.Values.length;for(X=0;X<ca;X++)-1<x.properties.Values[X].toLowerCase().indexOf("nodata")&&oa++;var ra=ca-oa;for(X=0;X<ca;X++){oa=!0;if(-1<x.properties.Values[X].toLowerCase().indexOf("nodata")){var ia=ra++;O||(oa=!1,ea.length--,ba.length--,na.length--)}else ia=aa++;oa&&(ea[ia]=x.catalogItems.features[X],ba[ia]=x.properties.Values[X],na[ia]=ea[ia].attributes[Q])}}else{for(X=
0;X<ca;X++)ea[X]=x.catalogItems.features[X],na[X]=ea[X].attributes[Q];ba=null}}this._visibleRasters=[];(x=-1<T.toLowerCase().indexOf("nodata"))&&!O&&(ea=[],ba=[],na=[]);if(T&&!ea&&!x){Q="ObjectId";ea=[];var la=new J(new r(this.fullExtent),null,{ObjectId:0});ea.push(la)}var Ca=[];ea?!this._map.spatialReference.equals(this.spatialReference)&&na&&0<na.length?l({url:this._url.path+"/query",content:{f:"json",objectIds:na.join(","),returnGeometry:!0,outSR:k.toJson(R._map.spatialReference.toJson()),outFields:Q},
handleAs:"json",callbackParamName:"callback",load:function(da){if(0===da.features.length)R._resolve([Ca,null,null],null,L,P);else{for(X=0;X<da.features.length;X++)for(K=0;K<ea.length;K++)ea[K].attributes[Q]==da.features[X].attributes[Q]&&(ea[K].geometry=new y(da.features[X].geometry),ea[K].geometry.setSpatialReference(R._map.spatialReference));S.call(R)}},error:function(da){R._resolve([Ca,null,null],null,L,P)}}):S.call(this):this._resolve([Ca,null,null],null,L,P)},getVisibleRasters:function(){var x=
this._visibleRasters,F=[],L;for(L in x)x.hasOwnProperty(L)&&F.push(x[L]);return F},_getDomainFields:function(x){if(x){var F=[];m.forEach(x,function(L){if(L.domain){var O={};O.name=L.name;O.domain=L.domain;F.push(O)}});return F}},_getDomainValue:function(x,F){if(x&&x.codedValues){var L;m.some(x.codedValues,function(O){return O.code===F?(L=O.name,!0):!1});return L}},_requestData:function(x,F,L){this._rasterReadPromise&&this._rasterReadPromise.cancel();x=n.clone(x);var O=x._normalize(!0);this._prepareGetImageParameters(O,
F,L);F=n.clone(this._params);this._cleanupRequestParams(F);F.extent=x;F.format=F.format||(10.3<=this.version?"lerc":"jpgpng");"lerc"===F.format.toLowerCase()&&!F.lercVersion&&10.5<=this.version&&(F.lercVersion=2);this._params.time&&this._isMultidimensionalCRF()&&!this._isTimeSupportedOnCRF()&&delete F.time;L=null;this._useBrowserDecoding()&&(L=new q({ctx:this._context}));F={imageServiceParameters:F,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:L?n.hitch(L,"decode"):null};this._rasterReadPromise=
this.raster.read(F,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(x){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=x,this.hasDataChanged=!0,this._setPixelData(x))},_setPixelData:function(x){x=this._clonePixelData(x);this.pixelFilter&&this.pixelFilter(x);this.pixelData=x;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this._drawPixelData(),this._rasterReadPromise=null)},_clonePixelData:function(x){if(null===
x||void 0===x)return x;var F={};x.extent&&(F.extent=n.clone(x.extent));x=x.pixelBlock;if(null===x||void 0===x)return F;F.pixelBlock=x.clone();return F},_setDefaultFilter:function(){},_getPixelBlockFromCanvas:function(x,F,L){x=x.getImageData(0,0,F,L).data;var O=F*L,P=0,S=0,T=new Uint8Array(O),W=new Uint8Array(O),X=new Uint8Array(O),K=new Uint8Array(O),R=Infinity,Q=Infinity,U=Infinity,V=-Infinity,Y=-Infinity,Z=-Infinity;for(P=0;P<O;P++){var aa=x[S++];var ca=x[S++];var oa=x[S++];R=R<aa?R:aa;V=V>aa?V:
aa;Q=Q<ca?Q:ca;Y=Y>ca?Y:ca;U=U<oa?U:oa;Z=Z>oa?Z:oa;T[P]=aa;W[P]=ca;X[P]=oa;K[P]=x[S++]&1}return new I({width:F,height:L,pixels:[T,W,X],pixelType:"U8",mask:K,statistics:[{minValue:R,maxValue:V},{minValue:Q,maxValue:Y},{minValue:U,maxValue:Z}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var x=this._url.path+
"/multiDimensionalInfo",F=new u(p._dfdCanceller);if(this._multidimensionalInfo)return F.resolve(this._multidimensionalInfo),F;!this.loaded||10.3<=this.version&&this.hasMultidimensions?(F._pendingDfd=l({url:x,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),F._pendingDfd.then(n.hitch(this,function(L){this._multidimensionalInfo=L.multidimensionalInfo;F.callback(L.multidimensionalInfo)}),function(L){F.errback(L)})):(x=Error("Layer does not support multidimensional info"),x.log=!!e.isDebug,
F.errback(x));return F},getStatistics:function(x){var F=new u(p._dfdCanceller);if(x&&this._cachedVariableStats[x])F.resolve(this._cachedVariableStats[x]);else{var L={f:"json"};x&&(L.variable=x);F._pendingDfd=l({url:this._url.path+"/statistics",content:L,handleAs:"json",callbackParamName:"callback"});F._pendingDfd.then(n.hitch(this,function(O){O=O.statistics||O.statitsics;var P=[];O&&O[0]&&null!=O[0].min?O.forEach(function(S){P.push([S.min,S.max,S.mean,S.standardDeviation])}):P=this.minValues&&this.minValues.length?
this.minValues.map(function(S,T){return[S,this.maxValues[T],this.meanValues[T],this.stdvValues[T]]}.bind(this)):O;x&&(this._cachedVariableStats[x]=P);F.callback(P)}),function(O){F.errback(O)})}return F},getDefaultMultidimensionalDefinition:function(){var x=new u(p._dfdCanceller);if(this._defaultMultidimensionalDefinition)return x.resolve(n.clone(this._defaultMultidimensionalDefinition)),x;x._pendingDfd=this.getMultidimensionalInfo();x._pendingDfd.then(n.hitch(this,function(F){F=this._getDefaultMultidimensionalDefinition(F);
x.callback(F)}),function(F){x.errback(F)});return x},_getDefaultMultidimensionalDefinition:function(x,F,L){var O,P=[],S=this.defaultVariable||"",T=S.length?x.variables.filter(function(W){return W.name===S})[0].dimensions:x.variables[0].dimensions;L&&(S=this.defaultVariable||x.variables[0].name);for(O in T)T.hasOwnProperty(O)&&(F||"StdTime"!==T[O].name)&&(x=T[O],P.push(new C({variableName:S,dimensionName:x.name,isSlice:!x.hasRanges,values:[this._getDefaultDimensionValue(x)]})));this._defaultMultidimensionalDefinition=
P;return n.clone(P)},_getDefaultDimensionValue:function(x){if(x&&x.values&&x.values.length){var F=Infinity,L;if(x.hasRanges)return x.values[0];if(x.name&&"stdz"===x.name.toLowerCase()){for(L=0;L<x.values.length;L++){var O=x.values[L];var P=Math.abs(O-0);if(P<F){F=P;var S=O}if(0===P)break}return S}return x.extent[0]}},_setDefaultMultidimensionalDefinition:function(x){var F,L={};this.getDefaultMultidimensionalDefinition().then(n.hitch(this,function(O){F=O;0<F.length&&(this.mosaicRule?(L=n.clone(this.mosaicRule),
L.multidimensionalDefinition=F):this.defaultMosaicRule?(L=n.clone(this.defaultMosaicRule),L.multidimensionalDefinition=F):L=new E({multidimensionalDefinition:F}),this.setMosaicRule(L,x))}))},_setDefaultRenderingRule:function(x){var F={},L=this.renderingRule;if(!L&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&!this.bandIds&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())F.rasterFunction=this.rasterFunctionInfos[0].name;
else if("esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version&&(!L||"Resample"!==L.functionName)){var O="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;F.rasterFunction="Resample";F.rasterFunctionArguments={ResamplingType:O,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}};L&&(F.rasterFunctionArguments.Raster=L.toJson())}F.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new B(F),this.setRenderingRule(this.defaultRenderingRule,x))},_cleanupRequestParams:function(x){if(!x)return x;
if(x.time&&x.mosaicRule){var F=new E(k.fromJson(x.mosaicRule));F=this._filterOutTimeDimension(F);x.mosaicRule=k.toJson(F.toJson())}F="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent renderer".split(" ");for(var L in F)x.hasOwnProperty(F[L])&&delete x[F[L]];return x},_filterOutTimeDimension:function(x){if(this._isMultidimensionalCRF())return x;if(x&&x.multidimensionalDefinition&&0<x.multidimensionalDefinition.length){var F=m.filter(x.multidimensionalDefinition,
function(L){return"StdTime"!==L.dimensionName});x.multidimensionalDefinition=F}return x},_removeVisualizationStretchFunction:function(x){var F=x&&x.functionName;if(!F||"stretch"!==F.toLowerCase())return x;var L=x.functionArguments.Raster;return L&&L.functionName&&m.some(this.rasterFunctionInfos,function(O){return L.functionName===O.name})?L:x},_isMultidimensionalCRF:function(){return 10.71<=this.version&&this.hasMultidimensions&&this.timeInfo&&!(this.objectIdField&&this.fields&&1<this.fields.length)},
_isTimeSupportedOnCRF:function(){return 10.8<=this.version},_cleanupMultidimensionalDefinition:function(x){x&&x.multidimensionalDefinition&&(x.multidimensionalDefinition=x.multidimensionalDefinition.filter(function(F){return!(!F.variableName&&!F.dimensionName)}),0===x.multidimensionalDefinition.length&&(x.multidimensionalDefinition=null))},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||
"esriImageServiceDataTypeScientific"===this.serviceDataType||this.hasMultidimensions},_isVectorData:function(x){x=(x=x||this)&&x.serviceDataType;return"esriImageServiceDataTypeVector-UV"===x||"esriImageServiceDataTypeVector-MagDir"===x},_isRenderingRuleAProcessingTemplate:function(x){var F=x&&x.functionName;return!F||x.functionArguments?!1:m.some(F&&(this.rasterFunctionInfos||[]),function(L){return L&&L.name&&L.name.toLowerCase()===F.toLowerCase()})},_getRenderingRuleId:function(x){var F=x&&x.functionName;
if(F){if(this._isRenderingRuleAProcessingTemplate(x))return F;var L=this._customRenderingRuleId[F];if(L){if(L!==x){for(var O in this._customRenderingRuleId)if(this._customRenderingRuleId[O]===x)return O;for(L=0;this._customRenderingRuleId[P];)L+=1;var P;this._customRenderingRuleId[F+L]=x}}else this._customRenderingRuleId[F]=x;return F}},_createPixelData:function(x){x=new I({width:2,height:2,pixels:x,pixelType:this.pixelType,statistics:x});var F=this.fullExtent.getCenter();F=new r(F.x,F.y,F.x+this.pixelSizeX,
F.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:x,extent:F}},_convertRendererToRenderingRule:function(x){var F=x&&x.declaredClass;if(!F||"esri.renderer.UniqueValueRenderer"!==F&&"esri.renderer.ClassBreaksRenderer"!==F&&"esri.renderer.StretchRenderer"!==F&&"esri.renderer.ShadedReliefRenderer"!==F&&"esri.renderer.ColormapRenderer"!==F)return null;var L=null;"esri.renderer.StretchRenderer"===F?L=x.toRenderingRule({convertToColormap:10.6>this.version}):"esri.renderer.ClassBreaksRenderer"===
F?L=this._convertClassifyRenderer(x):"esri.renderer.UniqueValueRenderer"===F?L=this._convertUniqueValueRenderer(x):"esri.renderer.ShadedReliefRenderer"===F?L=this._convertShadedReliefRenderer(x):"esri.renderer.ColormapRenderer"===F&&(L=this._convertColormapRenderer(x));return L},_getValueField:function(x){if(x&&x.length){var F,L;m.some(x,function(O){if((L=O.name)&&"value"===L.toLowerCase())return F=L,!0});return F}},_convertColormapRenderer:function(x){var F=new B;F.functionName="Colormap";F.functionArguments=
{};x=x.colormapInfos.map(function(L){return[L.value].concat(L.color)});F.functionArguments.Colormap=x;return F},_convertShadedReliefRenderer:function(x){var F=new B;F.functionName="Hillshade";var L="traditional"===x.hillshadeType?0:1,O="none"===x.scalingType?1:3,P={HillshadeType:L,SlopeType:O,ZFactor:x.zFactor};0===L&&(P.Azimuth=x.azimuth,P.Altitude=x.altitude);3===O&&(P.PSPower=x.pixelSizePower,P.PSZFactor=x.pixelSizeFactor);F.functionArguments=P;F.variableName="Raster";x.colorRamp&&(F.functionName=
"ShadedRelief",P.Colormap=z.convertColorRampToColormap(x.colorRamp,256));return F},_convertClassifyRenderer:function(x){var F=[],L=[],O=[],P=[],S;var T=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);var W=this.hasRasterAttributeTable;if(T){W=this._rasterFunctionTemplateInfos[T]?this._rasterFunctionTemplateInfos[T].hasRasterAttributeTable:this.hasRasterAttributeTable;var X=this._renderingRuleAttributeTable[T];var K=this._rasterFunctionTemplateInfos[T]}var R=X&&X.features?X.features:
this._rasterAttributeTableFeatures;var Q=this._getValueField(X&&X.fields?X.fields:this._rasterAttributeTableFields);W&&R?(m.forEach(x.infos,function(U,V){var Y,Z=U.symbol.color;Z.a&&m.forEach(R,function(aa){Y=aa.attributes[x.attributeField];(Y>=U.minValue&&Y<U.maxValue||V===x.infos.length-1&&Y>=U.minValue)&&P.push([aa.attributes[Q],Z.r,Z.g,Z.b])},this)},this),T=K&&K.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(P,T),T=new B,T.functionName="Colormap",T.functionArguments={},T.functionArguments.Colormap=
P,T.variableName="Raster"):(m.forEach(x.infos,function(U,V){S=U.symbol&&U.symbol.color;S.a?(0===V?F.push.call(F,U.minValue,U.maxValue+1E-4):F.push.call(F,U.minValue+1E-4,U.maxValue+1E-4),L.push(V),P.push([V,S.r,S.g,S.b])):O.push(U.minValue,U.maxValue)}),T=K&&K.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(P,T),T=new B,T.functionName="Remap",T.functionArguments={InputRanges:F,OutputValues:L,NoDataRanges:O},T.variableName="Raster",X=new B,X.functionName="Colormap",X.functionArguments=
{Colormap:P,Raster:T},T=X);return T},_convertUniqueValueRenderer:function(x){var F=[],L=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);if(L){var O=this._renderingRuleAttributeTable[L];var P=this._rasterFunctionTemplateInfos[L]}var S=O&&O.features?O.features:this._rasterAttributeTableFeatures;var T=(L=O&&O.fields?O.fields:this._rasterAttributeTableFields)&&L.length?this._getValueField(L):"Value";m.forEach(x.infos,function(W){var X=W.symbol.color;X.a&&(x.attributeField!==T&&S?m.forEach(S,
function(K){K.attributes[x.attributeField]==W.value&&F.push([K.attributes[T],X.r,X.g,X.b])},this):F.push([W.value,X.r,X.g,X.b]))},this);this._adjustColormapToPixelTypeRange(F,P&&P.pixelType||this.pixelType);P=new B;P.functionName="Colormap";P.functionArguments={};P.functionArguments.Colormap=F;P.variableName="Raster";return P},_adjustColormapToPixelTypeRange:function(x,F){(F=this._pixelTypeRanges[F])&&x.push([Math.floor(F[0]-1),0,0,0],[Math.ceil(F[1]+1),0,0,0]);return x},_combineRenderingRule:function(x,
F){if(!x||!F)return x||F;var L=function(O){var P=O.Raster;return P=P&&"esri.layers.RasterFunction"===P.declaredClass?L(P.functionArguments):O};x=n.clone(x);"none"!==F.functionName.toLocaleLowerCase()&&(L(x.functionArguments).Raster=F);return x},_isItemLevelRasterFunction:function(x){var F=x&&x.functionName;if(!F||!this._hasItemLevelRFT)return!1;var L=!1;m.some(this.rasterFunctionInfos,function(O){if(O&&O.name===F){if(1===O.functionType||2===O.functionType)L=!0;return!0}});return L},_getServiceLevelRenderingRule:function(x){if(!this._hasItemLevelRFT||
!x)return x;x=new B(x.toJson());var F=x.functionArguments;for(var L;;)if((L=F&&F.Raster)&&L.functionArguments&&L.functionArguments.Raster)F=L,F=F.functionArguments;else{this._isItemLevelRasterFunction(L)&&delete F.Raster;break}return x},_getItemLevelRenderingRule:function(x){if(!this._hasItemLevelRFT||!x)return null;if(this._isItemLevelRasterFunction(x))return x;x=new B(x.toJson());for(x=x.functionArguments;;)if((x=x&&x.Raster)&&x.functionArguments&&x.functionArguments.Raster)x=x.functionArguments;
else{if(this._isItemLevelRasterFunction(x))return x;break}},_resolve:function(x,F,L,O,P){F&&this[F].apply(this,x);L&&L.apply(null,x);O&&p._resDfd(O,x,P)},_toggleTime:function(){var x=this._map;this.timeInfo&&this.useMapTime&&x&&!this.suspended?(this._timeConnect||(this._timeConnect=c.connect(x,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(x.timeExtent)):(c.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(x,F){this.useMapTime=
x;this._toggleTime();!F&&this._map&&this.refresh(!0)},_setTime:function(x){this._params&&(this._params.time=x?x.toJson().join(","):null)},_onTimeExtentChangeHandler:function(x){this.suspended||(this._setTime(x),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()},getColormap:function(x){var F=this._url.path+"/colormap",L=new u(p._dfdCanceller),O={f:"json"};x&&x.renderingRule&&(O.renderingRule=k.toJson(x.renderingRule.toJson()));this.hasColormap?(L._pendingDfd=
l({url:F,content:O,handleAs:"json",callbackParamName:"callback"}),L._pendingDfd.then(function(P){L.callback(P)},function(P){L.errback(P)})):(x=Error("Layer does not support colormap"),x.log=!!e.isDebug,L.errback(x));return L},getRenderingRuleColormap:function(x){var F=new u(p._dfdCanceller);if(!x||!x.renderingRule)return F.errback(Error("Rendering rule is not specified")),F;x=x.renderingRule;var L=this._getRenderingRuleId(x);this._renderingRuleColormap&&L&&this._renderingRuleColormap.hasOwnProperty(L)?
F.resolve(this._renderingRuleColormap[L]):F=this.getColormap({renderingRule:x}).then(n.hitch(this,function(O){O=O&&O.colormap;L&&(this._renderingRuleColormap[L]=O);return O}));return F},_handleClipFunctionInRenderingRule:function(x){x=n.clone(x);var F=x.arguments,L=F.ClippingGeometry&&F.ClippingGeometry.value,O=F.Extent&&F.Extent.value;F.ClippingRaster&&F.ClippingRaster.value||L||O||(F=this._map.extent.toJson(),x.arguments.Extent.value=F,x.functionArguments.Extent.value=F,x._isTemplate&&(x._templateJson.arguments.Extent.value=
F));return x}});a("extend-esri")&&n.setObject("layers.ImageServiceLayerMixin",H,g);return H})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v,r){var w,y,z,E,B,C;n=n(f,{declaredClass:"esri.layers.Raster",
imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(t){this.imageServiceUrl=t;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(t,A,J){var M=this,N=new m(l._dfdCanceller);if(10>a("ie"))throw"This browser is not supported.";if(!t.imageServiceParameters)throw"Insufficient parameters to read data";
var x=u.clone(t.imageServiceParameters),F=t.pixelType;k.some(this.validPixelTypes,function(W){return W===F})||(x.pixelType="F32");k.some(this.validFormats,function(W){return W.toLowerCase()===x.format.toLowerCase()})||(x.format="lerc");var L=t.decodeFunc,O;this._prepareGetImageParameters(x);var P=x.width,S=x.height,T=x.extent;delete x.width;delete x.height;delete x.extent;N._pendingDfd=g({url:this.imageServiceUrl+"/exportImage",handleAs:"arraybuffer",content:u.mixin(x,{f:"image"}),load:function(W){M.decode(W,
{width:P,height:S,planes:null,pixelType:F,noDataValue:x.noData,format:x.format,decodeFunc:L}).then(function(X){O={pixelBlock:X,extent:T};M._resolve([O,x],"onRasterReadComplete",A,N)},function(X){M._resolve([X],null,J,N,!0)})},error:function(W){M._resolve([W],null,J,N,!0)}});return N.promise},decode:function(t,A){if(void 0===A||null===A)throw"missing decode options";var J;A.format&&(J=A.format.toUpperCase());"BSQ"!==J&&"BIP"!==J&&(J=this._getFormat(t));var M=A.decodeFunc;if(void 0===M||null===M)M=
this._getFormatDecoderDfd(J);return M(t,A)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(t){if(t.size&&t.bbox){var A=t.size.split(",");t.width=parseFloat(A[0]);t.height=parseFloat(A[1]);t.extent||(A=t.bbox.split(","),t.extent=new h(parseFloat(A[0]),parseFloat(A[1]),parseFloat(A[2]),parseFloat(A[3]),new d(t.bboxSR)))}else{if(!t.width||Math.floor(t.width)!==t.width||!t.height||Math.floor(t.height)!==t.height)throw"Incorrect Image Dimensions";if(!t.extent||"esri.geometry.Extent"!==
t.extent.declaredClass)throw"Incorrect extent";A=t.extent;var J=A.spatialReference.wkid||c.toJson(A.spatialReference.toJson());delete t._ts;u.mixin(t,{bbox:A.xmin+","+A.ymin+","+A.xmax+","+A.ymax,imageSR:J,bboxSR:J,size:t.width+","+t.height},t.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(t,A,J){var M=t.ymax-t.ymin,N=t.xmax-t.xmin;J>=A?t.ymax=t.ymin+N*A/J:t.xmax=t.xmin+M*J/A;return t},_resolve:function(t,A,J,M,N){A&&this[A].apply(this,t);J&&J.apply(null,t);M&&l._resDfd(M,
t,N)},_getFormatDecoderDfd:function(t){var A=null;switch(t){case "LERC":A=this._decodeLerc;break;case "LERC2":A=this._decodeLerc2;break;case "JPEG":A=this._decodeJpeg;break;case "PNG":A=this._decodePng;break;case "BSQ":A=this._decodeBsq;break;case "BIP":A=this._decodeBip;break;case "TIFF":A=this._decodeTiff;break;default:A=function(J,M){throw"The raster format is not supported";}}A=u.hitch(this,A);return function(J,M){var N=new m;try{if("LERC"===t||!0===B){var x=A(J,M);N.resolve(x)}else C.then(function(){x=
A(J,M);N.resolve(x)})}catch(F){N.reject(F)}return N}},_getFormat:function(t){t=new Uint8Array(t,0,10);var A="";if(255===t[0]&&216===t[1])A="JPEG";else if(137===t[0]&&80===t[1]&&78===t[2]&&71===t[3])A="PNG";else if(67===t[0]&&110===t[1]&&116===t[2]&&90===t[3]&&73===t[4]&&109===t[5]&&97===t[6]&&103===t[7]&&101===t[8]&&32===t[9])A="LERC";else if(76===t[0]&&101===t[1]&&114===t[2]&&99===t[3]&&50===t[4]&&32===t[5])A="LERC2";else if(-1<String.fromCharCode.apply(null,t).toLowerCase().indexOf("error"))A="ERROR";
else if(73===t[0]&&73===t[1]&&42===t[2]&&0===t[3]||77===t[0]&&77===t[1]&&0===t[2]&&42===t[3])A="TIFF";return A},_validateDecodeParams:function(t){if(!t.height||Math.floor(t.height)!==t.height)throw"Height not provided.";if(!t.width||Math.floor(t.width)!==t.width)throw"Width not provided.";},_decodeJpeg:function(t,A){if(!w)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(A);t=(new w).decode(t);if(!q(t,A))throw"The decoded image dimensions are incorrect.";A=[];var J;for(J=0;J<
t.pixels.length;J++){var M=t.pixels[J];A.push(this._calculateBandStatistics(M))}return new p({width:t.width,height:t.height,pixels:t.pixels,pixelType:"U8",mask:t.mask,statistics:A})},_decodePng:function(t,A){if(!y)throw"The png decoder module is not loaded.";this._validateDecodeParams(A);t=new Uint8Array(t);var J=new y(t);t=new Uint8Array(A.width*A.height*4);J.copyToImageData(t,J.decodePixels());var M=J=0;M=new Uint8Array(A.width*A.height);for(J=0;J<A.width*A.height;J++)M[J]=t[4*J+3];var N=new p({width:A.width,
height:A.height,pixels:[],pixelType:"U8",mask:M,statistics:[]});for(J=0;3>J;J++){var x=new Uint8Array(A.width*A.height);for(M=0;M<A.width*A.height;M++)x[M]=t[4*M+J];N.addData({pixels:x,statistics:this._calculateBandStatistics(x)})}return N},_decodeBsq:function(t,A){if(!z)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(A);I=A.noDataValue;A.pixelType=D(A.pixelType);t=z.decodeBSQ(t,{bandCount:A.planes,width:A.width,height:A.height,pixelType:G,noDataValue:I});var J=[],M,N=null;
for(M=0;M<t.pixels.length;M++)N=t.pixels[M],J.push(this._calculateBandStatistics(N));return new p({width:A.width,height:A.height,pixels:t.pixels,pixelType:A.pixelType,mask:t.maskData,statistics:J})},_decodeBip:function(t,A){this._validateDecodeParams(A);I=A.noDataValue;A.pixelType=D(A.pixelType);t=z.decodeBIP(t,{bandCount:A.planes,width:A.width,height:A.height,pixelType:G,noDataValue:I});var J=[],M,N=null;for(M=0;M<t.pixels.length;M++)N=t.pixels[M],J.push(this._calculateBandStatistics(N));return new p({width:A.width,
height:A.height,pixels:t.pixels,pixelType:A.pixelType,mask:t.maskData,statistics:J})},_decodeTiff:function(t,A){this._validateDecodeParams(A);I=A.noDataValue;A.pixelType=D(A.pixelType);t=E.decode(t);A=[];var J,M=null;for(J=0;J<t.pixels.length;J++)M=t.pixels[J],A.push(this._calculateBandStatistics(M,t.maskData));return new p({width:t.width,height:t.height,pixels:t.pixels,pixelType:t.pixelType,mask:t.maskData,statistics:A})},_decodeLerc:function(t,A){this._validateDecodeParams(A);I=A.noDataValue;A.pixelType=
D(A.pixelType);for(var J=0,M,N=0,x,F=t.byteLength-10;N<F;){var L=v.decode(t,{inputOffset:N,encodedMaskData:M,returnMask:0===J?!0:!1,returnEncodedMask:0===J?!0:!1,returnFileInfo:!0,pixelType:G,noDataValue:I});N=L.fileInfo.eofOffset;0===J&&(M=L.encodedMaskData,x=new p({width:A.width,height:A.height,pixels:[],pixelType:A.pixelType,mask:L.maskData,statistics:[]}));J++;if(!q(L,A))throw"The decoded image dimensions are incorrect";x.addData({pixels:L.pixelData,statistics:{minValue:L.minValue,maxValue:L.maxValue,
noDataValue:L.noDataValue}})}return x},_decodeLerc2:function(t,A){this._validateDecodeParams(A);I=A.noDataValue;A.pixelType=D(A.pixelType);for(var J=0,M,N,x=0,F,L=t.byteLength-10,O=[];x<L;){N=r.decode(t,{inputOffset:x,maskData:M,returnFileInfo:!0});x=N.fileInfo.eofOffset;0===J&&(M=N.maskData,F=new p({width:A.width,height:A.height,pixels:[],pixelType:N.fileInfo.pixelType,mask:N.maskData,statistics:[]}));N.fileInfo.mask&&0<N.fileInfo.mask.numBytes&&O.push(N.maskData);J++;if(!q(N,A))throw"The decoded image dimensions are incorrect";
if(1<N.dimCount&&N.pixelData&&N.pixelData.length===N.width*N.height*N.dimCount){N.pixelData=N.pixelData.slice(-N.width*N.height);var P=N.dimStats&&N.dimStats.minValues&&N.dimStats.minValues[N.dimCount-1],S=N.dimStats&&N.dimStats.maxValues&&N.dimStats.maxValues[N.dimCount-1];null!=P&&null!=S&&(N.minValue=P,N.maxValue=S)}F.addData({pixels:N.pixelData,statistics:{minValue:N.minValue,maxValue:N.maxValue,noDataValue:N.noDataValue}})}if(1<O.length){N=F.width*F.height;F.bandMasks=O;M=new Uint8Array(N);M.set(O[0]);
for(A=1;A<O.length;A++)for(t=O[A],J=0;J<N;J++)M[J]&=t[J];F.maskData=M}return F},_calculateBandStatistics:function(t,A){var J=Infinity,M=-Infinity,N=t.length,x,F=0;if(A)for(x=0;x<N;x++)A[x]&&(F=t[x],J=F<J?F:J,M=F>M?F:M);else for(x=0;x<N;x++)F=t[x],J=F<J?F:J,M=F>M?F:M;return{minValue:J,maxValue:M}},_loadRasterFormatModules:function(){B||(C||(C=new m),10>a("ie")?C.isRejected()||C.reject("unsupported browser version"):H(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder",
"./rasterFormats/Zlib"],function(t,A,J,M){w=t;y=A;z=J;E=M;B=!0;C.isResolved()||C.resolve(!0)}))}});var G=null,I=null,D=function(t){if("U1"===t||"U2"===t||"U4"===t||"U8"===t)return I=Math.pow(2,8)-1,G=Uint8Array,"U8";"U16"===t?(I=I||Math.pow(2,16)-1,G=Uint16Array):"U32"===t?(I=I||Math.pow(2,32)-1,G=Uint32Array):"S8"===t?(I=I||0-Math.pow(2,7),G=Int8Array):"S16"===t?(I=I||0-Math.pow(2,15),G=Int16Array):"S32"===t?(I=I||0-Math.pow(2,31),G=Int32Array):G=Float32Array;return t},q=function(t,A){return t.height!==
A.height||t.width!==A.width?!1:!0};a("extend-esri")&&u.setObject("layers.Raster",n,b);return n})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var H={defaultNoDataValue:-3.4027999387901484E38,decode:function(u,m){m=m||{};var k=m.inputOffset||0,e=m.encodedMaskData||null===m.encodedMaskData,c={},a=new Uint8Array(u,k,10);c.fileIdentifierString=String.fromCharCode.apply(null,a);if("CntZImage"!=c.fileIdentifierString.trim())throw"Unexpected file identifier string: "+c.fileIdentifierString;
k+=10;a=new DataView(u,k,24);c.fileVersion=a.getInt32(0,!0);c.imageType=a.getInt32(4,!0);c.height=a.getUint32(8,!0);c.width=a.getUint32(12,!0);c.maxZError=a.getFloat64(16,!0);k+=24;if(!e)if(a=new DataView(u,k,16),c.mask={},c.mask.numBlocksY=a.getUint32(0,!0),c.mask.numBlocksX=a.getUint32(4,!0),c.mask.numBytes=a.getUint32(8,!0),c.mask.maxValue=a.getFloat32(12,!0),k+=16,0<c.mask.numBytes){e=new Uint8Array(Math.ceil(c.width*c.height/8));a=new DataView(u,k,c.mask.numBytes);var b=a.getInt16(0,!0),f=2,
g=0;do{if(0<b)for(;b--;)e[g++]=a.getUint8(f++);else{var h=a.getUint8(f++);for(b=-b;b--;)e[g++]=h}b=a.getInt16(f,!0);f+=2}while(f<c.mask.numBytes);if(-32768!==b||g<e.length)throw"Unexpected end of mask RLE encoding";c.mask.bitset=e;k+=c.mask.numBytes}else 0===(c.mask.numBytes|c.mask.numBlocksY|c.mask.maxValue)&&(e=new Uint8Array(Math.ceil(c.width*c.height/8)),c.mask.bitset=e);a=new DataView(u,k,16);c.pixels={};c.pixels.numBlocksY=a.getUint32(0,!0);c.pixels.numBlocksX=a.getUint32(4,!0);c.pixels.numBytes=
a.getUint32(8,!0);c.pixels.maxValue=a.getFloat32(12,!0);k+=16;e=c.pixels.numBlocksX;a=c.pixels.numBlocksY;e+=0<c.width%e?1:0;b=a+(0<c.height%a?1:0);c.pixels.blocks=Array(e*b);for(g=f=0;g<b;g++)for(h=0;h<e;h++){var d=0;a=new DataView(u,k,Math.min(10,u.byteLength-k));var l={};c.pixels.blocks[f++]=l;var p=a.getUint8(0);d++;l.encoding=p&63;if(3<l.encoding)throw"Invalid block encoding ("+l.encoding+")";if(2===l.encoding)k++;else{if(0!==p&&2!==p){p>>=6;l.offsetType=p;if(2===p)l.offset=a.getInt8(1),d++;
else if(1===p)l.offset=a.getInt16(1,!0),d+=2;else if(0===p)l.offset=a.getFloat32(1,!0),d+=4;else throw"Invalid block offset type";if(1===l.encoding)if(p=a.getUint8(d),d++,l.bitsPerPixel=p&63,p>>=6,l.numValidPixelsType=p,2===p)l.numValidPixels=a.getUint8(d),d++;else if(1===p)l.numValidPixels=a.getUint16(d,!0),d+=2;else if(0===p)l.numValidPixels=a.getUint32(d,!0),d+=4;else throw"Invalid valid pixel count type";}k+=d;if(3!=l.encoding)if(0===l.encoding){p=(c.pixels.numBytes-1)/4;if(p!==Math.floor(p))throw"uncompressed block has invalid length";
a=new ArrayBuffer(4*p);d=new Uint8Array(a);d.set(new Uint8Array(u,k,4*p));a=new Float32Array(a);l.rawData=a;k+=4*p}else 1===l.encoding&&(p=Math.ceil(l.numValidPixels*l.bitsPerPixel/8),a=new ArrayBuffer(4*Math.ceil(p/4)),d=new Uint8Array(a),d.set(new Uint8Array(u,k,p)),l.stuffedData=new Uint32Array(a),k+=p)}}c.eofOffset=k;u=null!=m.noDataValue?m.noDataValue:H.defaultNoDataValue;e=m.encodedMaskData;p=m.returnMask;b=0;f=c.pixels.numBlocksX;g=c.pixels.numBlocksY;h=Math.floor(c.width/f);l=Math.floor(c.height/
g);d=2*c.maxZError;k=Number.MAX_VALUE;e=e||(c.mask?c.mask.bitset:null);var v;a=new (m.pixelType||Float32Array)(c.width*c.height);p&&e&&(v=new Uint8Array(c.width*c.height));p=new Float32Array(h*l);for(var r,w,y=0;y<=g;y++){var z=y!==g?l:c.height%g;if(0!==z)for(var E=0;E<=f;E++){var B=E!==f?h:c.width%f;if(0!==B){var C=y*c.width*l+E*h,G=c.width-B,I=c.pixels.blocks[b],D;if(2>I.encoding){if(0===I.encoding)var q=I.rawData;else{var t=D=q=void 0;r=I.stuffedData;w=I.bitsPerPixel;var A=I.numValidPixels,J=I.offset,
M=d,N=p,x=c.pixels.maxValue,F=(1<<w)-1,L=0,O=0,P=Math.ceil((x-J)/M);r[r.length-1]<<=8*(4*r.length-Math.ceil(w*A/8));for(t=0;t<A;t++)0===O&&(q=r[L++],O=32),O>=w?(D=q>>>O-w&F,O-=w):(O=w-O,D=(q&F)<<O&F,q=r[L++],O=32-O,D+=q>>>O),N[t]=D<P?J+D*M:x;q=p}D=0}else var S=2===I.encoding?0:I.offset;if(e)for(w=0;w<z;w++){if(C&7){var T=e[C>>3];T<<=C&7}for(r=0;r<B;r++)C&7||(T=e[C>>3]),T&128?(v&&(v[C]=1),t=2>I.encoding?q[D++]:S,k=k>t?t:k,a[C++]=t):(v&&(v[C]=0),a[C++]=u),T<<=1;C+=G}else if(2>I.encoding)for(w=0;w<z;w++){for(r=
0;r<B;r++)t=q[D++],k=k>t?t:k,a[C++]=t;C+=G}else for(k=k>S?S:k,w=0;w<z;w++){for(r=0;r<B;r++)a[C++]=S;C+=G}if(1===I.encoding&&D!==I.numValidPixels)throw"Block and Mask do not match";b++}}}S=v;v={width:c.width,height:c.height,pixelData:a,minValue:k,maxValue:c.pixels.maxValue,noDataValue:u};S&&(v.maskData=S);m.returnEncodedMask&&c.mask&&(v.encodedMaskData=c.mask.bitset?c.mask.bitset:null);if(m.returnFileInfo&&(v.fileInfo=n(c),m.computeUsedBitDepths)){m=v.fileInfo;S=c.pixels.numBlocksX*c.pixels.numBlocksY;
T={};for(q=0;q<S;q++)D=c.pixels.blocks[q],0===D.encoding?T.float32=!0:1===D.encoding?T[D.bitsPerPixel]=!0:T[0]=!0;c=Object.keys(T);m.bitDepths=c}return v}},n=function(u){return{fileIdentifierString:u.fileIdentifierString,fileVersion:u.fileVersion,imageType:u.imageType,height:u.height,width:u.width,maxZError:u.maxZError,eofOffset:u.eofOffset,mask:u.mask?{numBlocksX:u.mask.numBlocksX,numBlocksY:u.mask.numBlocksY,numBytes:u.mask.numBytes,maxValue:u.mask.maxValue}:null,pixels:{numBlocksX:u.pixels.numBlocksX,
numBlocksY:u.pixels.numBlocksY,numBytes:u.pixels.numBytes,maxValue:u.pixels.maxValue,noDataValue:this.noDataValue}}};return H})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var H={unstuff:function(m,k,e,c,a,b,f,g){var h=(1<<e)-1,d=0,l,p=0;m[m.length-1]<<=8*(4*m.length-Math.ceil(e*c/8));if(a)for(l=0;l<c;l++){if(0===p){var v=m[d++];p=32}if(p>=e){var r=v>>>p-e&h;p-=e}else p=e-p,r=(v&h)<<p&h,v=m[d++],p=32-p,r+=v>>>p;k[l]=a[r]}else for(a=Math.ceil((g-b)/f),l=0;l<c;l++)0===p&&
(v=m[d++],p=32),p>=e?(r=v>>>p-e&h,p-=e):(p=e-p,r=(v&h)<<p&h,v=m[d++],p=32-p,r+=v>>>p),k[l]=r<a?b+r*f:g},unstuffLUT:function(m,k,e,c,a,b){var f=(1<<k)-1,g=0,h=0,d=0,l=d=0,p=[];m[m.length-1]<<=8*(4*m.length-Math.ceil(k*e/8));var v=Math.ceil((b-c)/a);for(h=0;h<e;h++){if(0===d){var r=m[g++];d=32}d>=k?(l=r>>>d-k&f,d-=k):(d=k-d,l=(r&f)<<d&f,r=m[g++],d=32-d,l+=r>>>d);p[h]=l<v?c+l*a:b}p.unshift(c);return p},unstuff2:function(m,k,e,c,a,b,f,g){var h=(1<<e)-1,d=0,l,p=0,v=0;if(a)for(l=0;l<c;l++){if(0===p){var r=
m[d++];p=32;v=0}if(p>=e){var w=r>>>v&h;p-=e;v+=e}else{var y=e-p;w=r>>>v&h;r=m[d++];p=32-y;w|=(r&(1<<y)-1)<<e-y;v=y}k[l]=a[w]}else for(a=Math.ceil((g-b)/f),l=0;l<c;l++)0===p&&(r=m[d++],p=32,v=0),p>=e?(w=r>>>v&h,p-=e,v+=e):(y=e-p,w=r>>>v&h,r=m[d++],p=32-y,w|=(r&(1<<y)-1)<<e-y,v=y),k[l]=w<a?b+w*f:g;return k},unstuffLUT2:function(m,k,e,c,a,b){var f=(1<<k)-1,g=0,h=0,d=0,l=0,p=0,v=0,r=[],w=Math.ceil((b-c)/a);for(h=0;h<e;h++){if(0===l){var y=m[g++];l=32;v=0}l>=k?(p=y>>>v&f,l-=k,v+=k):(d=k-l,p=y>>>v&f,y=
m[g++],l=32-d,p|=(y&(1<<d)-1)<<k-d,v=d);r[h]=p<w?c+p*a:b}r.unshift(c);return r},originalUnstuff:function(m,k,e,c){var a=(1<<e)-1,b=0,f,g=0;m[m.length-1]<<=8*(4*m.length-Math.ceil(e*c/8));for(f=0;f<c;f++){if(0===g){var h=m[b++];g=32}if(g>=e){var d=h>>>g-e&a;g-=e}else g=e-g,d=(h&a)<<g&a,h=m[b++],g=32-g,d+=h>>>g;k[f]=d}return k},originalUnstuff2:function(m,k,e,c){var a=(1<<e)-1,b=0,f,g=0,h=0;for(f=0;f<c;f++){if(0===g){var d=m[b++];g=32;h=0}if(g>=e){var l=d>>>h&a;g-=e;h+=e}else{var p=e-g;l=d>>>h&a;d=
m[b++];g=32-p;l|=(d&(1<<p)-1)<<e-p;h=p}k[f]=l}return k}},n={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(m){for(var k=65535,e=65535,c=m.length,a=Math.floor(c/2),b=0;a;){var f=359<=a?359:a;a-=f;do k+=m[b++]<<8,e+=k+=m[b++];while(--f);k=(k&65535)+(k>>>16);e=(e&65535)+(e>>>16)}c&1&&(e+=k+=m[b]<<8);return((e&65535)+(e>>>16)<<16|(k&65535)+(k>>>16))>>>0},readHeaderInfo:function(m,k){var e=k.ptr,c=new Uint8Array(m,e,6),a={};a.fileIdentifierString=String.fromCharCode.apply(null,c);if(0!==a.fileIdentifierString.lastIndexOf("Lerc2",
0))throw"Unexpected file identifier string (expect Lerc2 ): "+a.fileIdentifierString;e+=6;c=new DataView(m,e,8);var b=c.getInt32(0,!0);a.fileVersion=b;e+=4;3<=b&&(a.checksum=c.getUint32(4,!0),e+=4);c=new DataView(m,e,12);a.height=c.getUint32(0,!0);a.width=c.getUint32(4,!0);e+=8;4<=b?(a.numDims=c.getUint32(8,!0),e+=4):a.numDims=1;c=new DataView(m,e,40);a.numValidPixel=c.getUint32(0,!0);a.microBlockSize=c.getInt32(4,!0);a.blobSize=c.getInt32(8,!0);a.imageType=c.getInt32(12,!0);a.maxZError=c.getFloat64(16,
!0);a.zMin=c.getFloat64(24,!0);a.zMax=c.getFloat64(32,!0);e+=40;k.headerInfo=a;k.ptr=e;if(3<=b&&(m=this.computeChecksumFletcher32(new Uint8Array(m,e-(4<=b?52:48),a.blobSize-14)),m!==a.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(m,k){var e=k.headerInfo,c=this.getDataTypeArray(e.imageType),a=e.numDims*this.getDataTypeSize(e.imageType),b=this.readSubArray(m,k.ptr,c,a);m=this.readSubArray(m,k.ptr+a,c,a);k.ptr+=2*a;a=!0;for(k=0;k<e.numDims;k++)if(b[k]!==m[k]){a=!1;break}e.minValues=
b;e.maxValues=m;return a},readSubArray:function(m,k,e,c){if(e===Uint8Array)m=new Uint8Array(m,k,c);else{var a=new ArrayBuffer(c);(new Uint8Array(a)).set(new Uint8Array(m,k,c));m=new e(a)}return m},readMask:function(m,k){var e=k.ptr,c=k.headerInfo,a=c.width*c.height,b=c.numValidPixel,f=new DataView(m,e,4);c={};c.numBytes=f.getUint32(0,!0);e+=4;if((0===b||a===b)&&0!==c.numBytes)throw"invalid mask";if(0===b)b=new Uint8Array(Math.ceil(a/8)),c.bitset=b,f=new Uint8Array(a),k.pixels.resultMask=f,e+=c.numBytes;
else if(0<c.numBytes){b=new Uint8Array(Math.ceil(a/8));f=new DataView(m,e,c.numBytes);m=f.getInt16(0,!0);var g=2,h=0,d=0;do{if(0<m)for(;m--;)b[h++]=f.getUint8(g++);else for(d=f.getUint8(g++),m=-m;m--;)b[h++]=d;m=f.getInt16(g,!0);g+=2}while(g<c.numBytes);if(-32768!==m||h<b.length)throw"Unexpected end of mask RLE encoding";f=new Uint8Array(a);for(g=g=m=0;g<a;g++)g&7?(m=b[g>>3],m<<=g&7):m=b[g>>3],m&128&&(f[g]=1);k.pixels.resultMask=f;c.bitset=b;e+=c.numBytes}k.ptr=e;k.mask=c;return!0},readDataOneSweep:function(m,
k,e,c){var a=k.ptr,b=k.headerInfo,f=b.numDims,g=b.width*b.height;b=b.numValidPixel*n.getDataTypeSize(b.imageType)*f;var h=k.pixels.resultMask;if(e===Uint8Array)m=new Uint8Array(m,a,b);else{var d=new ArrayBuffer(b);(new Uint8Array(d)).set(new Uint8Array(m,a,b));m=new e(d)}if(m.length===g*f)k.pixels.resultPixels=c?n.swapDimensionOrder(m,g,f,e,!0):m;else{k.pixels.resultPixels=new e(g*f);var l=d=e=0,p=0;if(1<f)if(c)for(d=0;d<g;d++){if(h[d])for(p=d,l=0;l<f;l++,p+=g)k.pixels.resultPixels[p]=m[e++]}else for(d=
0;d<g;d++){if(h[d])for(p=d*f,l=0;l<f;l++)k.pixels.resultPixels[p+l]=m[e++]}else for(d=0;d<g;d++)h[d]&&(k.pixels.resultPixels[d]=m[e++])}k.ptr=a+b;return!0},readHuffmanTree:function(m,k){var e=this.HUFFMAN_LUT_BITS_MAX,c=new DataView(m,k.ptr,16);k.ptr+=16;if(2>c.getInt32(0,!0))throw"unsupported Huffman version";var a=c.getInt32(4,!0),b=c.getInt32(8,!0);c=c.getInt32(12,!0);if(b>=c)return!1;var f=new Uint32Array(c-b);n.decodeBits(m,k,f);var g=[],h;for(h=b;h<c;h++){var d=h-(h<a?0:a);g[d]={first:f[h-b],
second:null}}h=m.byteLength-k.ptr;f=new ArrayBuffer(4*Math.ceil(h/4));(new Uint8Array(f)).set(new Uint8Array(m,k.ptr,h));m=new Uint32Array(f);k=0;f=0;var l=m[0];for(h=b;h<c;h++){d=h-(h<a?0:a);var p=g[d].first;0<p&&(g[d].second=l<<k>>>32-p,32-k>=p?(k+=p,32===k&&(k=0,f++,l=m[f])):(k+=p-32,f++,l=m[f],g[d].second|=l>>>32-k))}var v=l=0,r=new u;for(h=0;h<g.length;h++)void 0!==g[h]&&(l=Math.max(l,g[h].first));v=l>=e?e:l;e=[];var w;for(h=b;h<c;h++)if(d=h-(h<a?0:a),p=g[d].first,0<p)if(b=[p,d],p<=v){d=g[d].second<<
v-p;var y=1<<v-p;for(p=0;p<y;p++)e[d|p]=b}else for(d=g[d].second,y=r,--p;0<=p;p--)(w=d>>>p&1)?(y.right||(y.right=new u),y=y.right):(y.left||(y.left=new u),y=y.left),0!==p||y.val||(y.val=b[1]);return{decodeLut:e,numBitsLUTQick:v,numBitsLUT:l,tree:r,stuffedData:m,srcPtr:f,bitPos:k}},readHuffman:function(m,k,e,c){var a=k.headerInfo.numDims,b=k.headerInfo.height,f=k.headerInfo.width,g=f*b,h=this.readHuffmanTree(m,k);m=h.decodeLut;var d=h.tree,l=h.stuffedData,p=h.srcPtr,v=h.bitPos,r=h.numBitsLUTQick;h=
h.numBitsLUT;var w=0===k.headerInfo.imageType?128:0,y=k.pixels.resultMask,z,E,B,C,G,I,D=0;0<v&&(p++,v=0);var q=l[p],t=1===k.encodeMode,A=new e(g*a),J=A,M;if(2>a||t)for(M=0;M<a;M++)if(1<a&&(J=new e(A.buffer,g*M,g),D=0),k.headerInfo.numValidPixel===f*b)for(B=G=0;B<b;B++)for(C=0;C<f;C++,G++){var N=0;var x=z=q<<v>>>32-r;32-v<r&&(x=z|=l[p+1]>>>64-v-r);if(m[x])N=m[x][1],v+=m[x][0];else for(x=z=q<<v>>>32-h,32-v<h&&(x=z|=l[p+1]>>>64-v-h),x=d,I=0;I<h;I++)if(x=(E=z>>>h-I-1&1)?x.right:x.left,!x.left&&!x.right){N=
x.val;v=v+I+1;break}32<=v&&(v-=32,p++,q=l[p]);N-=w;t?(N=0<C?N+D:0<B?N+J[G-f]:N+D,N&=255,D=J[G]=N):J[G]=N}else for(B=G=0;B<b;B++)for(C=0;C<f;C++,G++){if(y[G]){N=0;x=z=q<<v>>>32-r;32-v<r&&(x=z|=l[p+1]>>>64-v-r);if(m[x])N=m[x][1],v+=m[x][0];else for(x=z=q<<v>>>32-h,32-v<h&&(x=z|=l[p+1]>>>64-v-h),x=d,I=0;I<h;I++)if(x=(E=z>>>h-I-1&1)?x.right:x.left,!x.left&&!x.right){N=x.val;v=v+I+1;break}32<=v&&(v-=32,p++,q=l[p]);N-=w;t?(N=0<C&&y[G-1]?N+D:0<B&&y[G-f]?N+J[G-f]:N+D,N&=255,D=J[G]=N):J[G]=N}}else for(B=G=
0;B<b;B++)for(C=0;C<f;C++)if(G=B*f+C,!y||y[G])for(M=0;M<a;M++,G+=g){N=0;x=z=q<<v>>>32-r;32-v<r&&(x=z|=l[p+1]>>>64-v-r);if(m[x])N=m[x][1],v+=m[x][0];else for(x=z=q<<v>>>32-h,32-v<h&&(x=z|=l[p+1]>>>64-v-h),x=d,I=0;I<h;I++)if(x=(E=z>>>h-I-1&1)?x.right:x.left,!x.left&&!x.right){N=x.val;v=v+I+1;break}32<=v&&(v-=32,p++,q=l[p]);N-=w;J[G]=N}k.ptr=k.ptr+4*(p+1)+(0<v?4:0);k.pixels.resultPixels=A;1<a&&!c&&(k.pixels.resultPixels=n.swapDimensionOrder(A,g,a,e))},decodeBits:function(m,k,e,c,a){var b=k.headerInfo,
f=b.fileVersion,g=0,h=new DataView(m,k.ptr,5<=m.byteLength-k.ptr?5:m.byteLength-k.ptr),d=h.getUint8(0);g++;var l=d>>6,p=0===l?4:3-l,v=0<(d&32)?!0:!1;l=d&31;d=0;if(1===p)d=h.getUint8(g),g++;else if(2===p)d=h.getUint16(g,!0),g+=2;else if(4===p)d=h.getUint32(g,!0),g+=4;else throw"Invalid valid pixel count type";p=2*b.maxZError;a=1<b.numDims?b.maxValues[a]:b.zMax;if(v){k.counter.lut++;v=h.getUint8(g);g++;b=Math.ceil((v-1)*l/8);var r=Math.ceil(b/4);r=new ArrayBuffer(4*r);var w=new Uint8Array(r);k.ptr+=
g;w.set(new Uint8Array(m,k.ptr,b));g=new Uint32Array(r);k.ptr+=b;for(h=0;v-1>>>h;)h++;b=Math.ceil(d*h/8);r=Math.ceil(b/4);r=new ArrayBuffer(4*r);w=new Uint8Array(r);w.set(new Uint8Array(m,k.ptr,b));m=new Uint32Array(r);k.ptr+=b;k=3<=f?H.unstuffLUT2(g,l,v-1,c,p,a):H.unstuffLUT(g,l,v-1,c,p,a);3<=f?H.unstuff2(m,e,h,d,k):H.unstuff(m,e,h,d,k)}else k.counter.bitstuffer++,h=l,k.ptr+=g,0<h&&(b=Math.ceil(d*h/8),r=Math.ceil(b/4),r=new ArrayBuffer(4*r),w=new Uint8Array(r),w.set(new Uint8Array(m,k.ptr,b)),m=
new Uint32Array(r),k.ptr+=b,3<=f?null==c?H.originalUnstuff2(m,e,h,d):H.unstuff2(m,e,h,d,!1,c,p,a):null==c?H.originalUnstuff(m,e,h,d):H.unstuff(m,e,h,d,!1,c,p,a))},readTiles:function(m,k,e,c){var a=k.headerInfo,b=a.width,f=a.height,g=b*f,h=a.microBlockSize,d=a.imageType,l=n.getDataTypeSize(d),p=Math.ceil(b/h),v=Math.ceil(f/h);k.pixels.numBlocksY=v;k.pixels.numBlocksX=p;var r=k.pixels.ptr=0,w=0,y=0,z=0,E=0,B=0,C=0,G=0,I=r=0,D=0,q=0,t=C=0;C=C=0;var A=new e(h*h);f=f%h||h;var J=b%h||h,M=a.numDims,N,x=
k.pixels.resultMask,F=k.pixels.resultPixels,L=5<=a.fileVersion?14:15,O=a.zMax;for(y=0;y<v;y++)for(E=y!==v-1?h:f,z=0;z<p;z++)for(B=z!==p-1?h:J,D=y*b*h+z*h,q=b-B,N=0;N<M;N++){1<M?(t=F,D=y*b*h+z*h,F=new e(k.pixels.resultPixels.buffer,g*N*l,g),O=a.maxValues[N]):t=null;C=m.byteLength-k.ptr;w=new DataView(m,k.ptr,Math.min(10,C));var P={};C=0;G=w.getUint8(0);C++;var S=5<=a.fileVersion?G&4:0;r=G>>6&255;I=G>>2&L;if(I!==(z*h>>3&L))throw"integrity issue";if(S&&0===N)throw"integrity issue";G&=3;if(3<G)throw k.ptr+=
C,"Invalid block encoding ("+G+")";if(2===G){if(S)if(x)for(r=0;r<E;r++)for(w=0;w<B;w++)x[D]&&(F[D]=t[D]),D++;else for(r=0;r<E;r++)for(w=0;w<B;w++)F[D]=t[D],D++;k.counter.constant++;k.ptr+=C}else if(0===G){if(S)throw"integrity issue";k.counter.uncompressed++;k.ptr+=C;C=E*B*l;t=m.byteLength-k.ptr;C=C<t?C:t;t=new ArrayBuffer(0===C%l?C:C+l-C%l);S=new Uint8Array(t);S.set(new Uint8Array(m,k.ptr,C));t=new e(t);C=0;if(x)for(r=0;r<E;r++){for(w=0;w<B;w++)x[D]&&(F[D]=t[C++]),D++;D+=q}else for(r=0;r<E;r++){for(w=
0;w<B;w++)F[D++]=t[C++];D+=q}k.ptr+=C*l}else if(r=n.getDataTypeUsed(S&&6>d?4:d,r),P=n.getOnePixel(P,C,r,w),C+=n.getDataTypeSize(r),3===G)if(k.ptr+=C,k.counter.constantoffset++,x)for(r=0;r<E;r++){for(w=0;w<B;w++)x[D]&&(F[D]=S?Math.min(O,t[D]+P):P),D++;D+=q}else for(r=0;r<E;r++){for(w=0;w<B;w++)F[D]=S?Math.min(O,t[D]+P):P,D++;D+=q}else if(k.ptr+=C,n.decodeBits(m,k,A,P,N),C=0,S)if(x)for(r=0;r<E;r++){for(w=0;w<B;w++)x[D]&&(F[D]=A[C++]+t[D]),D++;D+=q}else for(r=0;r<E;r++){for(w=0;w<B;w++)F[D]=A[C++]+t[D],
D++;D+=q}else if(x)for(r=0;r<E;r++){for(w=0;w<B;w++)x[D]&&(F[D]=A[C++]),D++;D+=q}else for(r=0;r<E;r++){for(w=0;w<B;w++)F[D++]=A[C++];D+=q}}1<M&&!c&&(k.pixels.resultPixels=n.swapDimensionOrder(k.pixels.resultPixels,g,M,e))},formatFileInfo:function(m){return{fileIdentifierString:m.headerInfo.fileIdentifierString,fileVersion:m.headerInfo.fileVersion,imageType:m.headerInfo.imageType,height:m.headerInfo.height,width:m.headerInfo.width,numValidPixel:m.headerInfo.numValidPixel,microBlockSize:m.headerInfo.microBlockSize,
blobSize:m.headerInfo.blobSize,maxZError:m.headerInfo.maxZError,pixelType:n.getPixelType(m.headerInfo.imageType),eofOffset:m.eofOffset,mask:m.mask?{numBytes:m.mask.numBytes}:null,pixels:{numBlocksX:m.pixels.numBlocksX,numBlocksY:m.pixels.numBlocksY,maxValue:m.headerInfo.zMax,minValue:m.headerInfo.zMin,noDataValue:m.noDataValue}}},constructConstantSurface:function(m,k){var e=m.headerInfo.zMax,c=m.headerInfo.zMin,a=m.headerInfo.maxValues,b=m.headerInfo.numDims,f=m.headerInfo.height*m.headerInfo.width,
g=0,h=0,d=0,l=m.pixels.resultMask;m=m.pixels.resultPixels;if(l)if(1<b)if(k)for(g=0;g<b;g++)for(d=g*f,e=a[g],h=0;h<f;h++)l[h]&&(m[d+h]=e);else for(h=0;h<f;h++){if(l[h])for(d=h*b,g=0;g<b;g++)m[d+b]=a[g]}else for(h=0;h<f;h++)l[h]&&(m[h]=e);else if(1<b&&c!==e)if(k)for(g=0;g<b;g++)for(d=g*f,e=a[g],h=0;h<f;h++)m[d+h]=e;else for(h=0;h<f;h++)for(d=h*b,g=0;g<b;g++)m[d+g]=a[g];else for(h=0;h<f*b;h++)m[h]=e},getDataTypeArray:function(m){switch(m){case 0:m=Int8Array;break;case 1:m=Uint8Array;break;case 2:m=Int16Array;
break;case 3:m=Uint16Array;break;case 4:m=Int32Array;break;case 5:m=Uint32Array;break;case 6:m=Float32Array;break;case 7:m=Float64Array;break;default:m=Float32Array}return m},getPixelType:function(m){switch(m){case 0:m="S8";break;case 1:m="U8";break;case 2:m="S16";break;case 3:m="U16";break;case 4:m="S32";break;case 5:m="U32";break;case 6:m="F32";break;case 7:m="F64";break;default:m="F32"}return m},isValidPixelValue:function(m,k){if(null==k)return!1;switch(m){case 0:m=-128<=k&&127>=k;break;case 1:m=
0<=k&&255>=k;break;case 2:m=-32768<=k&&32767>=k;break;case 3:m=0<=k&&65536>=k;break;case 4:m=-2147483648<=k&&2147483647>=k;break;case 5:m=0<=k&&4294967296>=k;break;case 6:m=-3.4027999387901484E38<=k&&3.4027999387901484E38>=k;break;case 7:m=4.9E-324<=k&&1.7976931348623157E308>=k;break;default:m=!1}return m},getDataTypeSize:function(m){var k=0;switch(m){case 0:case 1:k=1;break;case 2:case 3:k=2;break;case 4:case 5:case 6:k=4;break;case 7:k=8;break;default:k=m}return k},getDataTypeUsed:function(m,k){var e=
m;switch(m){case 2:case 4:e=m-k;break;case 3:case 5:e=m-2*k;break;case 6:e=0===k?m:1===k?2:1;break;case 7:e=0===k?m:m-2*k+1;break;default:e=m}return e},getOnePixel:function(m,k,e,c){m=0;switch(e){case 0:m=c.getInt8(k);break;case 1:m=c.getUint8(k);break;case 2:m=c.getInt16(k,!0);break;case 3:m=c.getUint16(k,!0);break;case 4:m=c.getInt32(k,!0);break;case 5:m=c.getUInt32(k,!0);break;case 6:m=c.getFloat32(k,!0);break;case 7:m=c.getFloat64(k,!0);break;default:throw"the decoder does not understand this pixel type";
}return m},swapDimensionOrder:function(m,k,e,c,a){var b=0,f=0,g=0,h=0,d=m;if(1<e)if(d=new c(k*e),a)for(b=0;b<k;b++)for(h=b,g=0;g<e;g++,h+=k)d[h]=m[f++];else for(b=0;b<k;b++)for(h=b,g=0;g<e;g++,h+=k)d[f++]=m[h];return d}},u=function(m,k,e){this.val=m;this.left=k;this.right=e};return{decode:function(m,k){k=k||{};var e=k.noDataValue,c=0,a={};a.ptr=k.inputOffset||0;a.pixels={};if(n.readHeaderInfo(m,a)){c=a.headerInfo;var b=c.fileVersion,f=n.getDataTypeArray(c.imageType);if(5<b)throw"unsupported lerc version 2."+
b;n.readMask(m,a);c.numValidPixel===c.width*c.height||a.pixels.resultMask||(a.pixels.resultMask=k.maskData);var g=c.width*c.height;a.pixels.resultPixels=new f(g*c.numDims);a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var h=!k.returnPixelInterleavedDims;if(0!==c.numValidPixel)if(c.zMax===c.zMin)n.constructConstantSurface(a,h);else if(4<=b&&n.checkMinMaxRanges(m,a))n.constructConstantSurface(a,h);else{var d=new DataView(m,a.ptr,2),l=d.getUint8(0);a.ptr++;if(l)n.readDataOneSweep(m,
a,f,h);else if(1<b&&1>=c.imageType&&1E-5>Math.abs(c.maxZError-.5)){d=d.getUint8(1);a.ptr++;a.encodeMode=d;if(2<d||4>b&&1<d)throw"Invalid Huffman flag "+d;d?n.readHuffman(m,a,f,h):n.readTiles(m,a,f,h)}else n.readTiles(m,a,f,h)}a.eofOffset=a.ptr;k.inputOffset?(m=a.headerInfo.blobSize+k.inputOffset-a.ptr,1<=Math.abs(m)&&(a.eofOffset=k.inputOffset+a.headerInfo.blobSize)):(m=a.headerInfo.blobSize-a.ptr,1<=Math.abs(m)&&(a.eofOffset=a.headerInfo.blobSize));m={width:c.width,height:c.height,pixelData:a.pixels.resultPixels,
minValue:c.zMin,maxValue:c.zMax,validPixelCount:c.numValidPixel,dimCount:c.numDims,dimStats:{minValues:c.minValues,maxValues:c.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&n.isValidPixelValue(c.imageType,e)){b=a.pixels.resultMask;for(c=0;c<g;c++)b[c]||(m.pixelData[c]=e);m.noDataValue=e}a.noDataValue=e;k.returnFileInfo&&(m.fileInfo=n.formatFileInfo(a));return m}},getBandCount:function(m){for(var k=0,e=0,c={ptr:0,pixels:{}};e<m.byteLength-58;)n.readHeaderInfo(m,c),e+=c.headerInfo.blobSize,
k++,c.ptr=e;return k}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),function(H,n,u,m,k,e){H=H(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(c){n.mixin(this,c);this.isDataUV=c&&c.isDataUV?c.isDataUV:!1;this.computeMagnitudeAndDirection=
n.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(c,a){this.inputUnit=c;this.outputUnit=a;this.unitConversionFactor=1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var c=e.indexOf(this.speedUnits,this.inputUnit),a=e.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=c&&0<=a){var b=[1,.277778,.514444,.3048,.44704,0];this.unitConversionFactor=b[c]/b[a]}},computeMagnitudeAndDirection:function(c){if(!k.isDefined(c))throw"Could not compute magnitude and direction. No pixel data is available.";
var a=c.pixelBlock;if(!k.isDefined(a)||2!==a.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";var b=c.extent,f=(b.xmax-b.xmin)/a.width,g=(b.ymax-b.ymin)/a.height,h=b.xmin+f/2;b=b.ymax-g/2;a.statistics[0].minValue=0;a.statistics[0].maxValue=0;var d=180/Math.PI,l=[],p=0,v=0,r=0,w=!k.isDefined(a.mask),y,z,E,B;var C=E=Infinity;var G=B=-Infinity;for(p=0;p<a.height;p++)for(v=0;v<a.width;v++,r++)if(l.push([h+f*v,b-g*p]),w||a.mask[r]){var I=y=a.pixels[0][r];
var D=z=a.pixels[1][r];this.isDataUV&&(I=Math.sqrt(y*y+z*z),D=90-d*Math.atan2(z,y));a.pixels[0][r]=I*this.unitConversionFactor;a.pixels[1][r]=D;I>G&&(G=I);I<C&&(C=I);D>B&&(B=D);D<E&&(E=D)}a.statistics[0].maxValue=G;a.statistics[0].minValue=C;a.statistics[1].maxValue=B;a.statistics[1].minValue=E;c.locations=l;return c}});u("extend-esri")&&n.setObject("layers.pixelFilters.VectorFieldPixelFilter",H,m);return H})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare",
"dojo/Deferred","dojo/sniff"],function(H,n,u,m){var k;return n(null,{constructor:function(e){this.ctx=e.ctx;this._loadRasterFormatModule()},decode:function(e,c){if(!c.width||!c.height)throw"Native decoding requires the image format, width and height";var a=new u,b,f=new Uint8Array(e);e=this._getFormat(e);if("error"===e)throw"invalid format";"jpeg"===e&&(b=this._getMask(f,c));var g="",h;for(h=0;h<f.length;h+=65535){var d=f.subarray(h,h+65535>f.length-1?f.length-1:h+65535);g+=String.fromCharCode.apply(null,
d)}f="data:image/"+e+";base64,"+window.btoa(g);var l=new Image,p;l.src=f;var v=this;l.onload=function(){v.ctx.clearRect(0,0,c.width,c.height);v.ctx.drawImage(l,0,0);var r=v.ctx.getImageData(0,0,l.width,l.height);p=r.data;if(b)for(h=0;h<b.length;h++)p[4*h+3]=b[h]?255:0;v.ctx.putImageData(r,0,0);a.resolve(null)};l.onerror=function(){a.reject("cannot load image")};return a},_getFormat:function(e){e=new Uint8Array(e,0,10);var c="error";255===e[0]&&216===e[1]?c="jpeg":137===e[0]&&80===e[1]&&78===e[2]&&
71===e[3]&&(c="png");return c},_getMask:function(e,c){try{if(!k)throw"The zlib decoder module is not loaded.";var a=0,b=0,f=Math.round(e.length/2);1===f%2&&(f+=1);var g=e.length-2;for(a=f;a<g&&(255!==e[a]||217!==e[a+1]);a++);f=a+=2;if(f<e.length-1){var h=(new k(e.subarray(f))).getBytes();var d=new Uint8Array(c.width*c.height);for(a=e=0;a<h.length;a++)for(b=7;0<=b;b--)d[e++]=h[a]>>b&1}}catch(l){}return d},_loadRasterFormatModule:function(){10>m("ie")||H(["./Zlib"],function(e){k=e})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),
function(H,n,u,m,k,e,c,a){H=H(c,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(b){this._url.path+="/identify";this._handler=n.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(b,f,g,h,d){try{var l=new a(b);this._successHandler([l],"onComplete",g,d)}catch(p){this._errorHandler(p,h,d)}},execute:function(b,f,g,h){var d=h.assembly;b=this._encode(n.mixin({},this._url.query,{f:"json"},b.toJson(d&&d[0])));var l=this._handler,
p=this._errorHandler;return k({url:this._url.path,content:b,callbackParamName:"callback",load:function(v,r){l(v,r,f,g,h.dfd)},error:function(v){p(v,g,h.dfd)}})},onComplete:function(){}});e._createWrappers(H);u("extend-esri")&&n.setObject("tasks.ImageServiceIdentifyTask",H,m);return H})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(H,n,u,m,k,e,c,a){H=H(a,{declaredClass:"esri.tasks._Task",
_eventMap:{error:["error"],complete:["result"]},constructor:function(b,f){b&&n.isString(b)&&(this._url=c.urlToObject(this.url=b));f&&f.requestOptions&&(this.requestOptions=f.requestOptions);this.normalization=!0;this._errorHandler=n.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var b=this._url,f=/^http:/i;this.url&&(this.url=this.url.replace(f,"https:"));b&&b.path&&(b.path=b.path.replace(f,"https:"))},_encode:function(b,f,g){var h={},d;for(d in b)if("declaredClass"!==
d){var l=b[d];var p=typeof l;if(null!==l&&void 0!==l&&"function"!==p)if(n.isArray(l)){h[d]=[];var v=l.length;for(p=0;p<v;p++)h[d][p]=this._encode(l[p])}else"object"===p?l.toJson&&(p=l.toJson(g&&g[d]),"esri.tasks.FeatureSet"===l.declaredClass&&p.spatialReference&&(p.sr=p.spatialReference,delete p.spatialReference),h[d]=f?p:u.toJson(p)):h[d]=l}return h},_successHandler:function(b,f,g,h){f&&this[f].apply(this,b);g&&g.apply(null,b);h&&e._resDfd(h,b)},_errorHandler:function(b,f,g){this.onError(b);f&&f(b);
g&&g.errback(b)},setNormalization:function(b){this.normalization=b},onError:function(){}});m("extend-esri")&&(k.Task=H);return H})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(H,n,u,m,k,e){H=H(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(c){c.catalogItems&&(this.catalogItems=new e(c.catalogItems));c.location&&(this.location=k.fromJson(c.location));
this.catalogItemVisibilities=c.catalogItemVisibilities;this.name=c.name;this.objectId=c.objectId;this.value=c.value;this.processedValues=c.processedValues;this.properties=c.properties}});u("extend-esri")&&n.setObject("tasks.ImageServiceIdentifyResult",H,m);return H})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h){H=H(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(d,l){if(d){n.mixin(this,d);var p=this.features=this.features||[],v=d.spatialReference;v=this.spatialReference=g.createInstance(a.simpleConstructor,v);var r=g.getGeometryType(d.geometryType);this.geometryType=d.geometryType;d.fields&&(this.fields=d.fields);d=g.supportsLazyUnquantization(this.geometryType);var w=g.unquantizeFunction(this.geometryType,this.transform),y=!!(l&&d&&w),z=r&&(y?r.accessorConstructor:
r.simpleConstructor);u.forEach(p,function(E,B){var C=g.createInstance(c.simpleConstructor),G=E.geometry;if(r&&G){var I=C.geometry=g.createInstance(z,y?null:G);I.setSpatialReference(G.spatialReference?g.createInstance(a.simpleConstructor,G.spatialReference):v);y&&I.setupLazyUnquantization(w,G)}C.symbol=E.symbol?h.fromJson(E.symbol):null;C.attributes=E.attributes;p[B]=C});y||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(d){var l=
{};this.displayFieldName&&(l.displayFieldName=this.displayFieldName);this.fields&&(l.fields=this.fields);this.spatialReference?l.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(l.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(l.geometryType=g.getJsonType(this.features[0].geometry)),l.features=b._encodeGraphics(this.features,d));l.geometryType=l.geometryType||this.geometryType;l.exceededTransferLimit=
this.exceededTransferLimit;l.transform=this.transform;return e.fixJson(l)},_hydrate:function(){g.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(d){if(!this.geometryType)return this.transform=null,this;var l=d.translate[0],p=d.translate[1],v=d.scale[0],r=d.scale[1],w=this.features,y=function(C,G,I){var D,q=[];var t=0;for(D=C.length;t<D;t++){var A=C[t];if(0<t){var J=G(A[0]);A=I(A[1]);if(J!==M||A!==N){q.push([J-M,A-N]);var M=J;var N=A}}else M=G(A[0]),
N=I(A[1]),q.push([M,N])}return 0<q.length?q:null},z=function(C,G,I){if("esriGeometryPoint"===C)return function(D){D.x=G(D.x);D.y=I(D.y);return D};if("esriGeometryPolyline"===C||"esriGeometryPolygon"===C)return function(D){var q;var t=D.rings||D.paths;var A=[];var J=0;for(q=t.length;J<q;J++){var M=t[J];(M=y(M,G,I))&&A.push(M)}return 0<A.length?(D.rings?D.rings=A:D.paths=A,D):null};if("esriGeometryMultipoint"===C)return function(D){var q=y(D.points,G,I);return 0<q.length?(D.points=q,D):null};if("esriGeometryEnvelope"===
C)return function(D){return D}}(this.geometryType,function(C){return Math.round((C-l)/v)},function(C){return Math.round((p-C)/r)}),E;var B=0;for(E=w.length;B<E;B++)w[B].geometry&&(z(w[B].geometry)||w[B].setGeometry(null));this.transform=d;return this}});H.createGraphics=function(d){var l=d.geometryType,p=g.createInstance(a.simpleConstructor,d.spatialReference),v=g.getGeometryType(l).accessorConstructor,r=g.unquantizeFunction(l,d.transform);return u.map(d.features,function(w,y){y=g.createInstance(c.simpleConstructor);
var z=w.geometry;if(z){var E=y.geometry=g.createInstance(v);E.setSpatialReference(p);E.setupLazyUnquantization(r,z)}y.attributes=w.attributes;return y})};H.createPolygon=function(d,l,p){if(d){var v=g.createInstance(f.accessorConstructor);v.setSpatialReference(l);l=g.unquantizeFunction("esriGeometryPolygon",p);v.setupLazyUnquantization(l,d)}return v};m("extend-esri")&&n.setObject("tasks.FeatureSet",H,k);return H})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),
function(H,n,u,m,k,e,c,a){H=H(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,maxItemCount:null,returnPixelValues:!0,toJson:function(b){var f=b&&b.geometry||this.geometry;b={geometry:f,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?u.toJson(this.mosaicRule.toJson()):
null,renderingRule:this.renderingRule?u.toJson(this.renderingRule.toJson()):null};f&&(b.geometryType=a.getJsonType(f));f=this.timeExtent;b.time=f?f.toJson().join(","):null;c.isDefined(this.pixelSizeX)&&c.isDefined(this.pixelSizeY)?b.pixelSize=u.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(b.pixelSize=this.pixelSize?u.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(b.renderingRules=u.toJson(m.map(this.renderingRules,function(g){return g.toJson()})));
c.isDefined(this.returnPixelValues)&&(b.returnPixelValues=this.returnPixelValues);c.isDefined(this.maxItemCount)&&(b.maxItemCount=this.maxItemCount);return b}});k("extend-esri")&&n.setObject("tasks.ImageServiceIdentifyParameters",H,e);return H})},"esri/layers/rasterLib/raster/rasterFactory":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/sniff dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../urlUtils ./ImageServiceRaster ./TileServiceRaster ./TileRaster ./FunctionRaster".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v,r){H={customDrivers:[],create:function(w){if(w){if(w.url){var y=d.urlToObject(w.url);var z=y.path;var E=y.query}y=w.serviceInfo;var B=w.rasterFxArgs||{},C=new m,G=u.hitch(this,function(t){console.error(t);this._trycustomDrivers(u.mixin({url:z},w),0,C)});if(z)if(-1===z.toLowerCase().indexOf("imageserver")&&-1===z.toLowerCase().indexOf("mapserver")){var I=new v(u.mixin({},w,{url:z}));w.rasterFx&&(I=new r({rasterFx:w.rasterFx,rasterFxArgs:u.mixin({},B,{raster:I})}));
var D=I}else{D=new m;y=y||this._getServiceInfo(z,E);var q=u.hitch(this,function(t){t.bandCount?I=t.capabilities&&-1<t.capabilities.toLowerCase().indexOf("tileonly")?new p(u.mixin({},{serviceInfo:t},E,w,{url:z})):new l(u.mixin({},{serviceInfo:t},E,w,{url:z})):t.tileInfo&&(I=new p(u.mixin({},{serviceInfo:t},E,this._options,{url:z})));w.rasterFx&&(I=new r({rasterFx:w.rasterFx,rasterFxArgs:u.mixin({},B,{raster:I})}));D.resolve(I)});a(y,q,G)}else D=I=new r({rasterFx:w.rasterFx,rasterFxArgs:u.mixin({},
B,{raster:I})});a(D,u.hitch(this,function(t){t?t.open().then(u.hitch(this,function(A){C.resolve(t)}),G):G(Error("There is no raster to open"))}),G);return C.promise}},register:function(w){this.customDrivers=this.customDrivers||[];0<this.customDrivers.filter(function(y){return y.sourceType===w.prototype.sourceType}).length||this.customDrivers.push(w)},_trycustomDrivers:function(w,y,z){z=z||new m;var E=this.customDrivers[y];if(E){var B=new E(w);B.open().then(u.hitch(this,function(C){z.resolve(B)}),
u.hitch(this,function(C){this._trycustomDrivers(w,y+1,z)}))}else z.reject("cannot load layer "+(w&&w.url||""));return z.promise},_getServiceInfo:function(w,y){y=y||{};var z=y.bandIds;y=y.renderingRule;var E=new m(h._dfdCanceller),B={f:"json"};z&&(B.bandIds=z);y&&(B.renderingRule=y.toJson?JSON.stringify(y.toJson()):JSON.stringify(y));E._pendingDfd=g({url:w,content:B,handleAs:"json",callbackParamName:"callback"});E._pendingDfd.then(function(C){E.callback(C)},function(C){E.errback(C)});return E.promise}};
c("extend-esri")&&u.setObject("layers.rasterLib.raster.rasterFactory",H,b);return H})},"esri/layers/rasterLib/raster/ImageServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../WKIDUnitConversion ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ./RasterInfo ./BasicRaster ../../rasterFormats/rasterCodec ../tile/RasterTileInfo".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v,r,w,y,z,E,B,C,G,I,D){H=n([G],{declaredClass:"esri.layers.rasterLib.raster.ImageServiceRaster",sourceType:"ImageService",constructor:function(q){q&&(this._imageServiceParams=q.imageServiceParameters,this._commonReqParams=q._commonReqParams,this._imageServiceParams||(this._imageServiceParams={interpolation:q.interpolation,pixelType:q.pixelType,format:q.format||"lerc",compressionQuality:q.compressionQuality,bandIds:q.bandIds,noDataInterpretation:q.noDataInterpretation,
adjustAspectRatio:q.adjustAspectRatio,mosaicRule:q.mosaicRule,renderingRule:q.interpolation}))},open:function(){var q=new m;if(this.serviceInfo&&this.rasterInfo)return this.loaded=!0,this._findCredential(),this.setFetchParameters(this._imageServiceParams),q.resolve(this),q.promise;var t=this.serviceInfo||this._generateServiceInfo(this._imageServiceParams&&this._imageServiceParams.renderingRule),A=u.hitch(this,function(M){this._fixServiceInfo(M);this.serviceInfo=M;this._findCredential();var N=this._parseRasterInfo(M),
x={};M.defaultMosaicMethod?(x.method=M.defaultMosaicMethod,x.operation=M.mosaicOperator,x.sortField=M.sortField,x.sortValue=M.sortValue):x.method=z.METHOD_NONE;this.serviceInfo.defaultMosaicRule=new z(x);this.serviceInfo.defaultMosaicRule.ascending=!0;M=this._getColormap(this);x=this._getHistograms(this);var F=this._getRasterAttributeTable(this),L=this._getKeyProperties(this),O=this._getMultidimensionalInfo(),P=this._getSlices();(new b([M,x,F,L,O,P])).then(u.hitch(this,function(S){S[0][0]&&(N.colormap=
S[0][1]);S[1][0]&&(N.histograms=S[1][1]);S[2][0]&&(N.vat=S[2][1]);S[3][0]&&(N.keyProperties=S[3][1]);S[4][0]&&(N.multidimensionalInfo=S[4][1]);this._slices=S[5][0]?S[5][1]:null;N.keyProperties&&N.keyProperties.DataType&&(this.dataType=N.keyProperties.DataType);this.loaded=!0;this.rasterInfo=N;this.setFetchParameters(this._imageServiceParams);q.resolve(this)}))}),J=u.hitch(this,function(M){this.loaded=!0;q.reject(M)});f(t,A,J);return q.promise},setFetchParameters:function(q,t){if(t)this.imageServiceParams=
q;else{var A=this.imageServiceParams;A&&q?Object.keys(q).forEach(function(J){A[J]=q[J]}):this.imageServiceParams=q}this._constructGetImageParams();this._getRasterIdentifier(!0)},read:function(q){if(q.pixelBlock||q.texture){var t=new m;t.resolve(q);return t.promise}if(!1===q.virtual&&this.tileInfo&&!this.tileInfo.virtual)return this.readTile(q);if(this._slices){var A=this._getSliceId();if(null==A)return t=new m,t.resolve(q),t.promise}var J=q.extent,M=J.spatialReference.wkid||c.toJson(J.spatialReference.toJson(!1)),
N=q.timeExtent?q.timeExtent.toJson().join(","):null;t=this.url+"/exportImage";var x={};this._slices&&(x.sliceid=A);this.disableClientCaching&&(x._ts=(new Date).getTime());A=u.mixin({},this._commonReqParams,{bbox:J.xmin+","+J.ymin+","+J.xmax+","+J.ymax,imageSR:M,bboxSR:M,size:q.width+","+q.height,time:N},x);return this._requestPixels({url:t,payload:A,decodeParams:{width:q.width,height:q.height,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:!1},tileOptions:q})},readTile:function(q){var t=
this.tileBoundary&&this.tileBoundary[q.level];if(t&&(t.minRow>q.row||t.maxRow<q.row||t.minCol>q.col||t.maxCol<q.col)){var A=new m;A.resolve(q);return A.promise}if(this._slices&&(A=this._getSliceId(),null==A))return A=new m,A.resolve(q),A.promise;t=this.url+"/tile/"+q.level+"/"+q.row+"/"+q.col;var J={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===q.tileType.toLowerCase()?!0:!1};A=this._slices?"sliceid\x3d"+A+"\x26":"";
A=this.disableClientCaching?"_ts\x3d "+(new Date).getTime():A.replace(/&$/,"");return this._requestPixels({url:t+(0<A.length?"?"+A:""),payload:{},decodeParams:J,tileOptions:q})},toJson:function(){return{url:this.url,tileInfo:this.tileInfo,rasterInfo:this.rasterInfo,serviceInfo:this.serviceInfo,sourceType:this.sourceType,_commonReqParams:this._commonReqParams,_rasterId:this._rasterId}},_getSliceId:function(){var q=u.clone(this._imageServiceParams.multidimensionalDefinition),t=u.clone(this._imageServiceParams.time);
if(null==this._slices||null==t&&(null==q||0===q.length))return 0;var A=q||this.defaultMultidimensionalDefinition,J=A[0].variableName;A=this._getAllDimensionDefinition(A,J).definition;q=null;if(null==A||0===A.length)return null;if(t&&this.serviceInfo.timeInfo){if(null==t[1]||t[1]===t[0])var M=t[0];else{var N=this.serviceInfo.timeInfo.startTimeField;M=this.rasterInfo.multidimensionalInfo.variables.find(function(L){return L.name===J}).dimensions.find(function(L){return L.name===N}).values.filter(function(L){return Array.isArray(L)?
Math.max(L[0],t[0])<Math.min(L[1],t[1]):L>=t[0]&&L<=t[1]}).sort(function(L,O){L=Array.isArray(L)?L[1]:L;O=Array.isArray(O)?L[1]:O;return Math.abs(t[1]-L)-Math.abs(t[1]-O)})[0]||[t[1]]}A.some(function(L){if(L.dimensionName===N)return L.values[0]=M,!0;if(!L.dimensionName)return L.dimensionName=N,L.isSlice=!0,L.values=[M],!0})||A.push({variableName:J,dimensionName:N,isSlice:!0,values:[M]})}for(var x=0;x<this._slices.length;x++){var F=this._slices[x].multidimensionalDefinition;if(F.length===A.length&&
!F.some(function(L){var O=A.filter(function(S){return L.variableName===S.variableName&&S.dimensionName===L.dimensionName})[0];if(!O)return!0;var P=Array.isArray(L.values[0])?L.values[0][0]:L.values[0];O=Array.isArray(O.values[0])?O.values[0][0]:O.values[0];return P!==O})){q=x;break}}return q},_getAllDimensionDefinition:function(q,t){var A=q.map(function(M){return M.dimensionName}),J=!1;this.rasterInfo.multidimensionalInfo.variables.forEach(function(M){M.name!==t||M.dimensions.length===q.length&&A[0]||
(M.dimensions.forEach(function(N){0>A.indexOf(N.name)&&(A[0]?q.push({variableName:t,dimensionName:N.name,values:[N.values[0]]}):(q[0].dimensionName=N.name,q[0].values=[N.values[0]],N[0]=N.name))}),J=!0)},this);return{defChanged:J,definition:q}},_generateServiceInfo:function(q){var t=this.url,A=new m(w._dfdCanceller);A._pendingDfd=d({url:t,content:{f:"json",renderingRule:q?c.toJson(q.toJson()):null},handleAs:"json",callbackParamName:"callback"});A._pendingDfd.then(function(J){A.callback(J)},function(J){A.errback(J)});
return A},_fixServiceInfo:function(q){var t=q.spatialReference.wkid;q.tileInfo&&0===q.extent.xmin&&360===q.extent.xmax&&t&&null==r[t]&&(q.tileInfo.applyGCS360Transform=!0)},_parseRasterInfo:function(q){var t=new C;t.bandCount=q.bandCount;t.extent=new l(q.fullExtent);t.spatialReference=q.spatialReference;t.pixelType=q.pixelType;t.width=Math.floor((q.fullExtent.xmax-q.fullExtent.xmin)/q.pixelSizeX+.5);t.height=Math.floor((q.fullExtent.ymax-q.fullExtent.ymin)/q.pixelSizeY+.5);t.cellSize=new p({x:q.pixelSizeX,
y:q.pixelSizeY,spatialReference:q.spatialReference});var A;if(q.minValues&&0<q.minValues.length&&q.maxValues&&q.stdvValues&&q.meanValues){var J=[];for(A=0;A<q.minValues.length;A++)J.push({min:q.minValues[A],max:q.maxValues[A],mean:q.meanValues[A],stddev:q.stdvValues[A]});q.bandCount!==J.length&&(J=null)}this.dataType=q.serviceDataType?q.serviceDataType.replace("esriImageServiceDataType",""):"Generic";t.statistics=J;q.objectIdField&&q.fields&&(t.catalogInfo={objectIdField:q.objectIdField,fields:q.fields});
t.timeInfo=q.timeInfo;if(q.tileInfo){this.tileInfo=new D(q.tileInfo);this.tileInfo.tileType=q.cacheType||"Map";t.tileInfo=this.tileInfo;var M=t.extent,N=this.tileInfo.origin,x=this.tileInfo.cols,F=this.tileInfo.rows;this.tileBoundary=this.tileInfo.lods.map(function(L){return{minCol:Math.floor((M.xmin-N.x+.1*L.resolution)/x/L.resolution),maxCol:Math.floor((M.xmax-N.x-.1*L.resolution)/x/L.resolution),minRow:Math.floor((N.y-M.ymax+.1*L.resolution)/F/L.resolution),maxRow:Math.floor((N.y-M.ymin-.1*L.resolution)/
F/L.resolution)}})}return t},_getColormap:function(q){q=this.url+"/colormap";var t=new m(w._dfdCanceller),A={f:"json"},J=this.serviceInfo.hasColormap||this.rasterInfo&&this.rasterInfo.hasColormap;10<this.serviceInfo.currentVersion&&J?(t._pendingDfd=d({url:q,content:A,handleAs:"json",callbackParamName:"callback"}),t._pendingDfd.then(function(M){t.callback(M.colormap)},function(M){t.errback(M)})):t.callback(null);return t},_getHistograms:function(q){var t=this.url+"/histograms",A=new m(w._dfdCanceller),
J={f:"json"},M=this.serviceInfo.hasHistograms||this.rasterInfo&&this.rasterInfo.hasHistograms;q&&q.renderingRule&&(J.renderingRule=c.toJson(q.renderingRule.toJson()),M=!0);10<this.serviceInfo.currentVersion&&M?(A._pendingDfd=d({url:t,content:J,handleAs:"json",callbackParamName:"callback"}),A._pendingDfd.then(function(N){A.callback(N.histograms)},function(N){A.errback(N)})):A.callback(null);return A},_getRasterAttributeTable:function(q){var t=this.url+"/rasterAttributeTable",A=new m(w._dfdCanceller),
J={f:"json"},M=this.serviceInfo.hasRasterAttributeTable;q&&q.renderingRule&&(J.renderingRule=c.toJson(q.renderingRule.toJson()),M=!0);10<this.serviceInfo.currentVersion&&M?(A._pendingDfd=d({url:t,content:J,handleAs:"json",callbackParamName:"callback"}),A._pendingDfd.then(function(N){A.callback(N)},function(N){A.errback(N)})):A.callback(null);return A},_getKeyProperties:function(q){var t=this.url+"/keyProperties",A=new m(w._dfdCanceller),J={f:"json"};q&&q.renderingRule&&(J.renderingRule=c.toJson(q.renderingRule.toJson()));
10<this.serviceInfo.currentVersion?(A._pendingDfd=d({url:t,content:J,handleAs:"json",callbackParamName:"callback"}),A._pendingDfd.then(function(M){A.callback(M)},function(M){A.errback(M)})):A.callback(null);return A},_getMultidimensionalInfo:function(){var q=this.url+"/multidimensionalInfo",t=new m(w._dfdCanceller);10.3<=this.serviceInfo.currentVersion&&this.serviceInfo.hasMultidimensions?(t._pendingDfd=d({url:q,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),t._pendingDfd.then(u.hitch(this,
function(A){t.callback(A.multidimensionalInfo)}),function(A){t.errback(A)})):t.callback(null);return t},_getSlices:function(){var q=this.url+"/slices",t=new m(w._dfdCanceller);this.serviceInfo.hasMultidimensions?(t._pendingDfd=d({url:q,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),t._pendingDfd.then(u.hitch(this,function(A){t.callback(A.slices)}),function(A){t.errback(A)})):t.callback(null);return t},_initializationFailed:function(){},_constructGetImageParams:function(){var q=
this.imageServiceParams||{},t=u.mixin({},this._query,{f:"image",interpolation:q.interpolation,pixelType:q.pixelType,format:q.format||"lerc",compressionQuality:q.compressionQuality,bandIds:q.bandIds?q.bandIds.join(","):null,noData:null!=q.noData?q.noData.join(","):null,noDataInterpretation:q.noDataInterpretation,adjustAspectRatio:null==q.adjustAspectRatio?null:q.adjustAspectRatio,mosaicRule:q.mosaicRule?c.toJson(q.mosaicRule.toJson()):null,renderingRule:q.renderingRule?c.toJson(q.renderingRule.toJson()):
null,token:this.credential&&this.credential.token||null});"lerc"===t.format.toLowerCase()?(t.compressionTolerance=q.compressionTolerance,10.5<=this.serviceInfo.currentVersion&&(t.lercVersion=q.lercVersion||2)):"tiff"===t.format.toLowerCase()?t.compression=q.compression:-1<["jpg","jpeg","jpg","jpgpng"].indexOf(t.format.toLowerCase())&&(t.compression=q.compression);this._commonReqParams=t},_getRasterIdentifier:function(q){if(this._rasterId)return this._rasterId;q=this.url.replace("http:","").replace("https:",
"");var t=[],A=this.imageServiceParams||{};t.push(q);t.push(A.interpolation);t.push(A.pixelType);t.push(A.compressionQuality);t.push(A.bandIds?A.bandIds.join(","):"");t.push(A.mosaicRule?c.toJson(A.mosaicRule.toJson()):"");t.push(A.renderingRule?c.toJson(A.renderingRule.toJson()):"");q=t.join("|");return this._rasterId=this._computeSignature(q)},_wrapExtent:function(q){var t=q.spatialReference._getInfo();if(t){var A=t.valid[0];t=t.valid[1];if(q.xmin<A-this.resolution.x||q.xmax>t+this.resolution.y){var J=
new l((q.xmin-A)%(t-A),q.ymin,(q.xmax-t)%(t-A),q.ymax,q.spatialReference);J.xmax<J.xmin&&(J=null)}}return J||q}});a("extend-esri")&&u.setObject("layers.rasterLib.raster.ImageServiceRaster",H,g);return H})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),function(H,n,u,m,k,e){H=H(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,
interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,renderer:null,noData:null,compressionTolerance:null,adjustAspectRatio:null,lercVersion:null,toJson:function(c){var a=this.bbox||this.extent;c=(a=a&&c&&a._normalize(!0))?a.spatialReference.wkid||u.toJson(a.spatialReference.toJson()):null;var b=this.imageSpatialReference;a={bbox:a?a.xmin+","+a.ymin+","+a.xmax+","+a.ymax:null,bboxSR:c,size:null!==this.width&&null!==this.height?this.width+","+this.height:
null,imageSR:b?b.wkid||u.toJson(b.toJson()):c,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?u.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?u.toJson(this.renderingRule.toJson()):null,renderer:this.renderer?u.toJson(this.renderer.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation,compressionTolerance:this.compressionTolerance,
adjustAspectRatio:this.adjustAspectRatio,lercVersion:this.lercVersion};c=this.timeExtent;a.time=c?c.toJson().join(","):null;return e.filter(a,function(f){if(null!==f&&void 0!==f)return!0})}});n.mixin(H,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});m("extend-esri")&&n.setObject("layers.ImageServiceParameters",
H,k);return H})},"esri/layers/rasterLib/raster/RasterInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../../SpatialReference","../tile/RasterTileInfo"],function(H,n,u,m,k){return H(null,{declaredClass:"esri.layers.rasterLib.raster.RasterInfo",bandCount:null,pixelType:null,extent:null,spatialReference:null,width:null,height:null,colormap:null,attributeTable:null,multiDimensionalInfo:null,statistics:null,histograms:null,catalogInfo:null,keyProperties:null,
cellSize:null,format:null,compression:null,compressionQuality:null,packetSize:null,geodataXform:null,constructor:function(e){n.mixin(this,e);this.extent=this.extent?this.extent.toJson?this.extent:new u(this.extent):null;this.spatialReference=this.spatialReference?this.spatialReference.toJson?this.spatialReference:new m(this.spatialReference):null;this.tileInfo=this.tileInfo?this.tileInfo.toJson?this.tileInfo:new k(this.tileInfo):null},toJson:function(){return{bandCount:this.bandCount,pixelType:this.pixelType,
extent:this.extent&&this.extent.toJson?this.extent.toJson():this.extent,spatialReference:this.spatialReference&&this.spatialReference.toJson?this.spatialReference.toJson():this.spatialReference,width:this.width,height:this.height,colormap:this.colormap?n.clone(this.colormap):null,attributeTable:this.attributeTable?n.clone(this.attributeTable):null,multiDimensionalInfo:this.multiDimensionalInfo?n.clone(this.multiDimensionalInfo):null,statistics:this.statistics?n.clone(this.statistics):null,histograms:this.histograms?
n.clone(this.histograms):null,catalogInfo:this.catalogInfo?n.clone(this.catalogInfo):null,keyProperties:this.keyProperties?n.clone(this.keyProperties):null,cellSize:this.cellSize&&this.cellSize.toJson?this.cellSize.toJson():this.cellSize,tileInfo:this.tileInfo&&this.tileInfo.toJson?this.tileInfo.toJson():this.tileInfo,format:this.format,compression:this.compression,compressionQuality:this.compressionQuality,packetSize:this.packetSize,geodataXform:this.geodataXform?n.clone(this.geodataXform):null}},
clone:function(){return new this.constructor(this.toJson())}})})},"esri/layers/rasterLib/tile/RasterTileInfo":function(){define("dojo/_base/declare dojo/_base/lang ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../../lang ../../TileInfo".split(" "),function(H,n,u,m,k,e,c){return H([c],{declaredClass:"esri.layers.rasterLib.tile.RasterTileInfo",rows:512,cols:512,compressionQuality:95,lercError:.01,spatialReference:null,origin:null,virtual:!0,tileType:"Raster",constructor:function(a,
b){if(a||b){var f=b&&b.refTileInfo;a?this.virtual=!1:(this.virtual=!0,n.mixin(this,{rows:b.rows||this.rows,cols:b.cols||this.cols,compressionQuality:b.compressionQuality||95,lercError:b.compressionTolerance||.01,spatialReference:b.spatialReference,origin:b.origin}),this.width=this.cols,this.height=this.rows,this.origin||(f?this.origin=f.origin:b.spatialReference.isWebMercator()||b.extent&&360<=Math.max(Math.abs(b.extent.xmin),Math.abs(b.extent.xmax))?this.origin={x:-2.0037508342787E7,y:2.0037508342787E7}:
-1<[4326,4269].indexOf(b.spatialReference.wkid)||360>Math.max(Math.abs(b.extent.xmin),Math.abs(b.extent.xmax))?this.origin={x:-180,y:90}:this.origin={x:b.extent.xmin,y:b.extent.ymax}))}},toJson:function(){var a=c.prototype.toJson.apply(this);a.tileType=this.tileType;a.virtual=this.virtual;a.lercError=this.lercError;return a},clone:function(){return new this.prototype(this.toJson())}})})},"esri/layers/rasterLib/raster/BasicRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterHandler ./rasterProjectionHelper ./RasterInfo".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v,r,w,y,z,E,B,C,G,I){return n([h],{url:null,dataType:null,rasterInfo:null,tileInfo:null,serviceInfo:null,loaded:null,constructor:function(D){if(D){var q=D.url;q&&(q=w.urlToObject(q),this.url=q.path,this._query=q.query);this.dataType=D.dataType;this.serviceInfo=D.serviceInfo;this.rasterInfo=D.rasterInfo;this.tileInfo=D.tileInfo;this.serviceInfo=D.serviceInfo}},open:function(){},read:function(D){},identify:function(D){var q=new m,t=this.rasterInfo.extent;if(G.requirePE(t.spatialReference,
D.spatialReference))G.load().then(u.hitch(this,function(){A=G.project(D,t.spatialReference);q.resolve(A)}),function(){q.reject(Error("cannot project into this spatial reference"))});else{var A=G.project(D,t.spatialReference);q.resolve(A)}return q.then(u.hitch(this,function(J){var M=this.tileInfo,N=M.origin,x=M.lods[M.lods.length-1],F=(J.x-N.x)/M.cols/x.resolution;J=(N.y-J.y)/M.rows/x.resolution;var L=Math.round((J-Math.floor(J))*M.rows)*M.cols+Math.round((F-Math.floor(F))*M.cols);N=new l(N.x+x.resolution*
M.cols*F,N.y-x.resolution*M.rows*(J+1),N.x+x.resolution*M.cols*(F+1),N.y-x.resolution*M.rows*J,t.spatialReference);var O=this.getMemberRasters?this.getMemberRasters()[0]:this;return O.read({level:x.level,row:Math.floor(J),col:Math.floor(F),extent:N,width:M.cols,height:M.rows,virtual:O.tileInfo.virtual,tileType:O.tileInfo.tileType}).then(function(P){return(P=P&&P.pixelBlock)&&P.pixels&&0<P.pixels.length&&(!P.mask||P.mask[L])?{pixelValue:P.pixels.map(function(S){return S[L]})}:{pixelValue:null}})}))},
getProjectedFullExtent:function(D,q){var t=new m;if(this.projectedFullExtent&&!q)return t.resolve(this.projectedFullExtent),t.promise;var A=this.rasterInfo.extent;if(G.requirePE(this.rasterInfo.extent.spatialReference,D))G.load().then(u.hitch(this,function(){J=G.project(A,D);this.projectedFullExtent=J=new l(J.toJson());t.resolve(J)}),function(){t.reject(Error("cannot project into this spatial reference"))});else{var J=G.project(A,D);this.projectedFullExtent=J=new l(J.toJson());t.resolve(J)}return t.promise},
setFetchParameters:function(D,q){},_setRasterHandler:function(D){this._rasterHandler=D;this.getMemberRasters&&this.getMemberRasters().forEach(u.hitch(this,function(q){q._rasterHandler=D}))},_findCredential:function(){this.url&&((this._credential=g.id&&g.id.findCredential(this.url))&&this._credential.ssl||this.serviceInfo&&this.serviceInfo._ssl)&&(this.url=this.url.replace(/^http:/i,"https:"))},_initWorker:function(){this._rasterHandler=new C;this._rasterHandler.start().then(function(){this._rasterHandlerInitialized=
!0}.bind(this))},_requestPixels:function(D){var q=D.url,t=D.payload,A=D.decodeParams,J=D.tileOptions,M=new m(r._dfdCanceller);this._rasterHandler||this._initWorker();var N=this._rasterHandler,x={};q={url:q,handleAs:"arraybuffer",content:t};D.headers&&(q.headers=D.headers);M._pendingDfd=d(q).then(u.hitch(this,function(F){(N&&this._rasterHandlerInitialized?N.decode({encodedData:F,decodeParams:A}):B.decode(F,A)).then(function(L){x.pixelBlock=new E(L);x.extent=J.extent;x.level=J.level;x.row=J.row;x.col=
J.col;x.width=J.width;x.height=J.height;r._resDfd(M,[x])},function(L){r._resDfd(M,[L],!0)})}),function(F){r._resDfd(M,[F],!0)});return M},_computeSignature:function(D){if("string"===typeof D){for(var q=new Uint8Array(D.length),t=0;t<D.length;t++)q[t]=D.charCodeAt(t);D=q}t=q=65535;for(var A=D.length,J=Math.floor(A/2),M=0;J;){var N=359<=J?359:J;J-=N;do q+=D[M++]<<8,t+=q+=D[M++];while(--N);q=(q&65535)+(q>>>16);t=(t&65535)+(t>>>16)}A&1&&(t+=q+=D[M]<<8);return((t&65535)+(t>>>16)<<16|(q&65535)+(q>>>16))>>>
0}})})},"esri/layers/rasterFormats/rasterCodec":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred ../PixelBlock ./LercCodec ./Lerc2Codec ./JpgPlus ./Png ./Raw ./TiffDecoder".split(" "),function(H,n,u,m,k,e,c,a,b,f,g){return{validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),supportedFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_isPlatformLittleEndian:function(){var h=new ArrayBuffer(4),d=new Uint8Array(h);(new Uint32Array(h))[0]=
1;return 1===d[0]}(),decode:function(h,d){if(void 0===d||null===d)throw"missing decode options";var l;d.format&&(l=d.format.toUpperCase());"BSQ"!==l&&"BIP"!==l&&(l=this._getFormat(h));var p=d.decodeFunc;if(void 0===p||null===p)p=this._getFormatDecoderDfd(l);return p(h,d)},_getFormatDecoderDfd:function(h){var d=null;switch(h){case "LERC":d=this._decodeLerc;break;case "LERC2":d=this._decodeLerc2;break;case "JPEG":d=this._decodeJpeg;break;case "PNG":d=this._decodePng;break;case "BSQ":d=this._decodeBsq;
break;case "BIP":d=this._decodeBip;break;case "TIFF":d=this._decodeTiff;break;default:d=function(l,p){throw"The raster format is not supported";}}d=u.hitch(this,d);return function(l,p){var v=new m;p.isPoint&&p.width&&(p.width++,p.height++);l=d(l,p);p.isPoint&&p.width&&(this._interpolatePointGrid(l),p.width--,p.height--);v.resolve(l);return v}.bind(this)},_getFormat:function(h){h=new Uint8Array(h,0,10);var d="";if(255===h[0]&&216===h[1])d="JPEG";else if(137===h[0]&&80===h[1]&&78===h[2]&&71===h[3])d=
"PNG";else if(67===h[0]&&110===h[1]&&116===h[2]&&90===h[3]&&73===h[4]&&109===h[5]&&97===h[6]&&103===h[7]&&101===h[8]&&32===h[9])d="LERC";else if(76===h[0]&&101===h[1]&&114===h[2]&&99===h[3]&&50===h[4]&&32===h[5])d="LERC2";else if(-1<String.fromCharCode.apply(null,h).toLowerCase().indexOf("error"))d="ERROR";else if(73===h[0]&&73===h[1]&&42===h[2]&&0===h[3]||77===h[0]&&77===h[1]&&0===h[2]&&42===h[3])d="TIFF";return d},_validateDecodeParams:function(h){if(!h.height||Math.floor(h.height)!==h.height)throw"Height not provided.";
if(!h.width||Math.floor(h.width)!==h.width)throw"Width not provided.";},_decodeJpeg:function(h,d){if(!a)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(d);h=(new a).decode(h);if(!this._verifyResult(h,d))throw"The decoded image dimensions are incorrect.";d=new k({width:h.width,height:h.height,pixels:h.pixels,pixelType:"U8",mask:h.mask,statistics:null});d.calculateStatistics();return d},_decodePng:function(h,d){if(!b)throw"The png decoder module is not loaded.";this._validateDecodeParams(d);
h=new Uint8Array(h);var l=new b(h);h=new Uint8Array(d.width*d.height*4);l.copyToImageData(h,l.decodePixels());var p=l=0;p=new Uint8Array(d.width*d.height);for(l=0;l<d.width*d.height;l++)p[l]=h[4*l+3];var v=new k({width:d.width,height:d.height,pixels:[],pixelType:"U8",mask:p,statistics:[]});for(l=0;3>l;l++){var r=new Uint8Array(d.width*d.height);for(p=0;p<d.width*d.height;p++)r[p]=h[4*p+l];v.addData({pixels:r})}v.calculateStatistics();return v},_decodeBsq:function(h,d){if(!f)throw"The bsq decoder module is not loaded.";
this._validateDecodeParams(d);var l=d.noDataValue;d.pixelType=this._getpixelTypeAndNoData(d.pixelType);h=f.decodeBSQ(h,{bandCount:d.planes,width:d.width,height:d.height,pixelType:d.pixelType,noDataValue:l});d=new k({width:d.width,height:d.height,pixels:h.pixels,pixelType:d.pixelType,mask:h.maskData,statistics:null});d.calculateStatistics();return d},_decodeBip:function(h,d){this._validateDecodeParams(d);var l=d.noDataValue;d.pixelType=this._getpixelTypeAndNoData(d.pixelType);h=f.decodeBIP(h,{bandCount:d.planes,
width:d.width,height:d.height,pixelType:d.pixelType,noDataValue:l});d=new k({width:d.width,height:d.height,pixels:h.pixels,pixelType:d.pixelType,mask:h.maskData,statistics:null});d.calculateStatistics();return d},_decodeTiff:function(h,d){this._validateDecodeParams(d);d.pixelType=this._getpixelTypeAndNoData(d.pixelType);h=g.decode(h);h=new k({width:h.width,height:h.height,pixels:h.pixels,pixelType:h.pixelType,mask:h.maskData,statistics:null});h.calculateStatistics();return h},_decodeLerc:function(h,
d){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(d);var l=d.noDataValue;d.pixelType=this._getpixelTypeAndNoData(d.pixelType);for(var p=0,v,r=0,w,y=h.byteLength-10;r<y;){var z=e.decode(h,{inputOffset:r,encodedMaskData:v,returnMask:0===p?!0:!1,returnEncodedMask:0===p?!0:!1,returnFileInfo:!0,pixelType:d.pixelType,noDataValue:l});r=z.fileInfo.eofOffset;0===p&&(v=z.encodedMaskData,w=new k({width:d.width,height:d.height,pixels:[],
pixelType:d.pixelType,mask:z.maskData,statistics:[]}));p++;if(!this._verifyResult(z,d))throw"The decoded image dimensions are incorrect";w.addData({pixels:z.pixelData,statistics:{minValue:z.minValue,maxValue:z.maxValue,noDataValue:z.noDataValue}})}return w},_decodeLerc2:function(h,d){if(!this._isPlatformLittleEndian)throw"lerc2 decoder is not supported on big endian platform";this._validateDecodeParams(d);d.pixelType=this._getpixelTypeAndNoData(d.pixelType);for(var l=0,p,v,r,w=0,y,z=h.byteLength-
10,E=[],B,C=0;w<z;){v=c.decode(h,{inputOffset:w,maskData:p,returnFileInfo:!0});w=v.fileInfo.eofOffset;p=v.maskData;0===l&&(r=v.fileInfo.numValidPixel,y=new k({width:d.width,height:d.height,pixels:[],dimCount:v.dimCount||1,pixelType:v.fileInfo.pixelType,mask:p,statistics:[]}));v.fileInfo.mask&&0<v.fileInfo.mask.numBytes&&C++;p&&E.push(p);l++;if(!this._verifyResult(v,d))throw"The decoded image dimensions are incorrect";y.addData({pixels:v.pixelData,statistics:{minValue:v.minValue,maxValue:v.maxValue,
noDataValue:v.noDataValue,dimStats:v.dimStats}})}if(1<C){d=y.width*y.height;y.bandMasks=E;p=new Uint8Array(d);p.set(E[0]);for(r=1;r<E.length;r++)for(B=E[r],h=0;h<d;h++)p[h]&=B[h];for(h=r=0;h<d;h++)r+=B[h];y.mask=p}y.validPixelCount=r;return y},_interpolatePointGrid:function(h,d){var l=h.pixels;if(l&&0!==l.length){var p=l.length,v=h.width,r=h.mask,w=v-1,y=h.height-1,z=[],E,B;if(0===(null==d?1:d)){for(d=0;d<p;d++){var C=l[d];var G=new C.constructor(w*y);for(E=0;E<y;E++){var I=E*v;for(B=0;B<w;B++)G[E*
w+B]=C[I+B]}z.push(G)}if(r){var D=new Uint8Array(w*y);for(E=0;E<y;E++)for(I=E*v,B=0;B<w;B++)D[E*w+B]=r[I+B]}}else{for(d=0;d<p;d++){C=l[d];G=new C.constructor(w*y);for(E=0;E<y;E++)for(I=E*v,B=0;B<w;B++)G[E*w+B]=(C[I+B]+C[I+B+1]+C[I+v+B]+C[I+v+B+1])/4;z.push(G)}if(r)for(D=new Uint8Array(w*y),E=0;E<y;E++)for(I=E*v,B=0;B<w;B++)D[E*w+B]=Math.min.apply(null,[r[I+B],r[I+B+1],r[I+v+B],r[I+v+B+1]])}h.width=w;h.height=y;h.mask=D;h.pixels=z;return h}},_getpixelTypeAndNoData:function(h){return"U1"===h||"U2"===
h||"U4"===h||"U8"===h?"U8":h},_verifyResult:function(h,d){return h.height!==d.height||h.width!==d.width?!1:!0}}})},"esri/layers/rasterFormats/JpgPlus":function(){define(["dojo/_base/declare","./Zlib","./Jpg"],function(H,n,u){return H(null,{constructor:function(){},decode:function(m){var k=new Uint8Array(m);m=new u;m.parse(k);var e=m.numComponents,c=m.getData(m.width,m.height,!0),a=m.width*m.height,b=m.eof,f=0,g=0,h=0;if(b<k.length-1){g=(new n(k.subarray(b))).getBytes();var d=new Uint8Array(a);for(f=
k=0;f<g.length;f++)for(h=7;0<=h;h--)d[k++]=g[f]>>h&1}k=[];if(1===e)k=[c,c,c];else{for(f=0;3>f;f++)e=new Uint8Array(a),k.push(e);for(g=h=0;g<a;g++)for(f=0;3>f;f++)k[f][g]=c[h++]}return{width:m.width,height:m.height,pixels:k,mask:d}}})})},"esri/layers/rasterFormats/Zlib":function(){define([],function(){var H=function(){function n(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}n.prototype={ensureBuffer:function(u){var m=this.buffer,k=m?m.byteLength:0;if(u<k)return m;for(var e=512;e<u;)e<<=
1;u=new Uint8Array(e);for(e=0;e<k;++e)u[e]=m[e];return this.buffer=u},getByte:function(){for(var u=this.pos;this.bufferLength<=u;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(u){var m=this.pos;if(u){this.ensureBuffer(m+u);for(u=m+u;!this.eof&&this.bufferLength<u;)this.readBlock();var k=this.bufferLength;u>k&&(u=k)}else{for(;!this.eof;)this.readBlock();u=this.bufferLength}this.pos=u;return this.buffer.subarray(m,u)},lookChar:function(){for(var u=this.pos;this.bufferLength<=
u;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var u=this.pos;this.bufferLength<=u;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(u,m,k){for(var e=u+m;this.bufferLength<=e&&!this.eof;)this.readBlock();return new Stream(this.buffer,u,m,k)},skip:function(u){u||(u=1);this.pos+=u},reset:function(){this.pos=0}};return n}();return function(){function n(b){throw Error(b);
}function u(b){var f=0,g=b[f++],h=b[f++];-1!=g&&-1!=h||n("Invalid header in flate stream");8!=(g&15)&&n("Unknown compression method in flate stream");0!=((g<<8)+h)%31&&n("Bad FCHECK in flate stream");h&32&&n("FDICT bit set in flate stream");this.bytes=b;this.bytesPos=f;this.codeBuf=this.codeSize=0;H.call(this)}if(!self||!self.Uint32Array)return null;var m=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),k=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,
131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),e=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),c=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,
459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,
459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,
459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,
459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,
459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,
459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,
459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,
327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];u.prototype=Object.create(H.prototype);u.prototype.getBits=function(b){for(var f=this.codeSize,g=this.codeBuf,h=this.bytes,d=this.bytesPos,l;f<b;)"undefined"==typeof(l=h[d++])&&n("Bad encoding in flate stream"),g|=l<<f,f+=8;this.codeBuf=g>>b;this.codeSize=f-=b;this.bytesPos=d;return g&(1<<b)-1};u.prototype.getCode=function(b){var f=b[0],g=b[1];b=this.codeSize;for(var h=
this.codeBuf,d=this.bytes,l=this.bytesPos;b<g;){var p;"undefined"==typeof(p=d[l++])&&n("Bad encoding in flate stream");h|=p<<b;b+=8}g=f[h&(1<<g)-1];f=g>>16;g&=65535;(0==b||b<f||0==f)&&n("Bad encoding in flate stream");this.codeBuf=h>>f;this.codeSize=b-f;this.bytesPos=l;return g};u.prototype.generateHuffmanTable=function(b){for(var f=b.length,g=0,h=0;h<f;++h)b[h]>g&&(g=b[h]);for(var d=1<<g,l=new Uint32Array(d),p=1,v=0,r=2;p<=g;++p,v<<=1,r<<=1)for(var w=0;w<f;++w)if(b[w]==p){var y=0,z=v;for(h=0;h<p;++h)y=
y<<1|z&1,z>>=1;for(h=y;h<d;h+=r)l[h]=p<<16|w;++v}return[l,g]};u.prototype.readBlock=function(){function b(y,z,E,B,C){for(y=y.getBits(E)+B;0<y--;)z[v++]=C}var f=this.getBits(3);f&1&&(this.eof=!0);f>>=1;if(0==f){var g=this.bytes,h=this.bytesPos,d;"undefined"==typeof(d=g[h++])&&n("Bad block header in flate stream");var l=d;"undefined"==typeof(d=g[h++])&&n("Bad block header in flate stream");l|=d<<8;"undefined"==typeof(d=g[h++])&&n("Bad block header in flate stream");f=d;"undefined"==typeof(d=g[h++])&&
n("Bad block header in flate stream");(f|d<<8)!=(~l&65535)&&n("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;d=this.bufferLength;f=this.ensureBuffer(d+l);this.bufferLength=l=d+l;for(var p=d;p<l;++p){if("undefined"==typeof(d=g[h++])){this.eof=!0;break}f[p]=d}this.bytesPos=h}else{if(1==f)h=c,d=a;else if(2==f){f=this.getBits(5)+257;d=this.getBits(5)+1;g=this.getBits(4)+4;h=Array(m.length);for(var v=0;v<g;)h[m[v++]]=this.getBits(3);h=this.generateHuffmanTable(h);v=g=0;d=
f+d;for(l=Array(d);v<d;)p=this.getCode(h),16==p?b(this,l,2,3,g):17==p?b(this,l,3,3,g=0):18==p?b(this,l,7,11,g=0):l[v++]=g=p;h=this.generateHuffmanTable(l.slice(0,f));d=this.generateHuffmanTable(l.slice(f,d))}else n("Unknown block type in flate stream");l=(f=this.buffer)?f.length:0;for(p=this.bufferLength;;){var r=this.getCode(h);if(256>r)p+1>=l&&(f=this.ensureBuffer(p+1),l=f.length),f[p++]=r;else{if(256==r){this.bufferLength=p;break}r-=257;r=k[r];var w=r>>16;0<w&&(w=this.getBits(w));g=(r&65535)+w;
r=this.getCode(d);r=e[r];w=r>>16;0<w&&(w=this.getBits(w));r=(r&65535)+w;p+g>=l&&(f=this.ensureBuffer(p+g),l=f.length);for(w=0;w<g;++w,++p)f[p]=f[p-r]}}}};return u}()})},"esri/layers/rasterFormats/Jpg":function(){define([],function(){var H=function(){function n(u){this.message="JPEG error: "+u}n.prototype=Error();n.prototype.name="JpegError";return n.constructor=n}();return function(){function n(){this.decodeTransform=null;this.colorTransform=-1}function u(a,b){for(var f=0,g=[],h,d,l=16;0<l&&!a[l-
1];)l--;g.push({children:[],index:0});var p=g[0],v;for(h=0;h<l;h++){for(d=0;d<a[h];d++){p=g.pop();for(p.children[p.index]=b[f];0<p.index;)p=g.pop();p.index++;for(g.push(p);g.length<=h;)g.push(v={children:[],index:0}),p.children[p.index]=v.children,p=v;f++}h+1<l&&(g.push(v={children:[],index:0}),p.children[p.index]=v.children,p=v)}return g[0].children}function m(a,b,f,g,h,d,l,p,v){function r(){if(0<A)return A--,t>>A&1;t=a[b++];if(255===t){var R=a[b++];if(R)throw new H("unexpected marker "+(t<<8|R).toString(16));
}A=7;return t>>>7}function w(R){for(;;){R=R[r()];if("number"===typeof R)return R;if("object"!==typeof R)throw new H("invalid huffman sequence");}}function y(R){for(var Q=0;0<R;)Q=Q<<1|r(),R--;return Q}function z(R){if(1===R)return 1===r()?1:-1;var Q=y(R);return Q>=1<<R-1?Q:Q+(-1<<R)+1}function E(R,Q){var U=w(R.huffmanTableDC);U=0===U?0:z(U);R.blockData[Q]=R.pred+=U;for(U=1;64>U;){var V=w(R.huffmanTableAC),Y=V&15;V>>=4;if(0===Y){if(15>V)break;U+=16}else U+=V,R.blockData[Q+c[U]]=z(Y),U++}}function B(R,
Q){var U=w(R.huffmanTableDC);U=0===U?0:z(U)<<v;R.blockData[Q]=R.pred+=U}function C(R,Q){R.blockData[Q]|=r()<<v}function G(R,Q){if(0<J)J--;else for(var U=d;U<=l;){var V=w(R.huffmanTableAC),Y=V&15;V>>=4;if(0===Y){if(15>V){J=y(V)+(1<<V)-1;break}U+=16}else U+=V,R.blockData[Q+c[U]]=z(Y)*(1<<v),U++}}function I(R,Q){for(var U=d,V=0,Y;U<=l;){Y=c[U];switch(M){case 0:V=w(R.huffmanTableAC);Y=V&15;V>>=4;if(0===Y)15>V?(J=y(V)+(1<<V),M=4):(V=16,M=1);else{if(1!==Y)throw new H("invalid ACn encoding");N=z(Y);M=V?
2:3}continue;case 1:case 2:R.blockData[Q+Y]?R.blockData[Q+Y]+=r()<<v:(V--,0===V&&(M=2===M?3:0));break;case 3:R.blockData[Q+Y]?R.blockData[Q+Y]+=r()<<v:(R.blockData[Q+Y]=N<<v,M=0);break;case 4:R.blockData[Q+Y]&&(R.blockData[Q+Y]+=r()<<v)}U++}4===M&&(J--,0===J&&(M=0))}var D=f.mcusPerLine,q=b,t=0,A=0,J=0,M=0,N,x=g.length,F,L,O,P;p=f.progressive?0===d?0===p?B:C:0===p?G:I:E;var S=0;f=1===x?g[0].blocksPerLine*g[0].blocksPerColumn:D*f.mcusPerColumn;for(var T,W;S<f;){var X=h?Math.min(f-S,h):f;for(F=0;F<x;F++)g[F].pred=
0;J=0;if(1===x){var K=g[0];for(P=0;P<X;P++)p(K,64*((K.blocksPerLine+1)*(S/K.blocksPerLine|0)+S%K.blocksPerLine)),S++}else for(P=0;P<X;P++){for(F=0;F<x;F++)for(K=g[F],T=K.h,W=K.v,L=0;L<W;L++)for(O=0;O<T;O++)p(K,64*((K.blocksPerLine+1)*((S/D|0)*K.v+L)+(S%D*K.h+O)));S++}A=0;(K=e(a,b))&&K.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+K.invalid),b=K.offset);K=K&&K.marker;if(!K||65280>=K)throw new H("marker was not found");if(65488<=K&&65495>=K)b+=2;else break}(K=e(a,b))&&K.invalid&&
(console.log("decodeScan - unexpected Scan data, next marker is: "+K.invalid),b=K.offset);return b-q}function k(a,b){a=b.blocksPerLine;for(var f=b.blocksPerColumn,g=new Int16Array(64),h=0;h<f;h++)for(var d=0;d<a;d++){var l=void 0,p=void 0,v=void 0,r=void 0,w=void 0,y=void 0,z=void 0,E=void 0,B=w=y=r=p=l=void 0,C=void 0,G=void 0,I=void 0,D=64*((b.blocksPerLine+1)*h+d),q=g,t=b.quantizationTable,A=b.blockData;if(!t)throw new H("missing required Quantization Table.");for(var J=0;64>J;J+=8)l=A[D+J],E=
A[D+J+1],z=A[D+J+2],y=A[D+J+3],w=A[D+J+4],r=A[D+J+5],v=A[D+J+6],p=A[D+J+7],l*=t[J],0===(E|z|y|w|r|v|p)?(l=5793*l+512>>10,q[J]=l,q[J+1]=l,q[J+2]=l,q[J+3]=l,q[J+4]=l,q[J+5]=l,q[J+6]=l,q[J+7]=l):(E*=t[J+1],z*=t[J+2],y*=t[J+3],w*=t[J+4],r*=t[J+5],v*=t[J+6],p*=t[J+7],I=5793*l+128>>8,G=5793*w+128>>8,C=z,B=v,w=2896*(E-p)+128>>8,p=2896*(E+p)+128>>8,y<<=4,r<<=4,I=I+G+1>>1,G=I-G,l=3784*C+1567*B+128>>8,C=1567*C-3784*B+128>>8,B=l,w=w+r+1>>1,r=w-r,p=p+y+1>>1,y=p-y,I=I+B+1>>1,B=I-B,G=G+C+1>>1,C=G-C,l=2276*w+3406*
p+2048>>12,w=3406*w-2276*p+2048>>12,p=l,l=799*y+4017*r+2048>>12,y=4017*y-799*r+2048>>12,r=l,q[J]=I+p,q[J+7]=I-p,q[J+1]=G+r,q[J+6]=G-r,q[J+2]=C+y,q[J+5]=C-y,q[J+3]=B+w,q[J+4]=B-w);for(t=0;8>t;++t)l=q[t],E=q[t+8],z=q[t+16],y=q[t+24],w=q[t+32],r=q[t+40],v=q[t+48],p=q[t+56],0===(E|z|y|w|r|v|p)?(l=5793*l+8192>>14,l=-2040>l?0:2024<=l?255:l+2056>>4,A[D+t]=l,A[D+t+8]=l,A[D+t+16]=l,A[D+t+24]=l,A[D+t+32]=l,A[D+t+40]=l,A[D+t+48]=l,A[D+t+56]=l):(I=5793*l+2048>>12,G=5793*w+2048>>12,C=z,B=v,w=2896*(E-p)+2048>>
12,p=2896*(E+p)+2048>>12,I=(I+G+1>>1)+4112,G=I-G,l=3784*C+1567*B+2048>>12,C=1567*C-3784*B+2048>>12,B=l,w=w+r+1>>1,r=w-r,p=p+y+1>>1,y=p-y,I=I+B+1>>1,B=I-B,G=G+C+1>>1,C=G-C,l=2276*w+3406*p+2048>>12,w=3406*w-2276*p+2048>>12,p=l,l=799*y+4017*r+2048>>12,y=4017*y-799*r+2048>>12,r=l,l=I+p,p=I-p,E=G+r,v=G-r,z=C+y,r=C-y,y=B+w,w=B-w,l=16>l?0:4080<=l?255:l>>4,E=16>E?0:4080<=E?255:E>>4,z=16>z?0:4080<=z?255:z>>4,y=16>y?0:4080<=y?255:y>>4,w=16>w?0:4080<=w?255:w>>4,r=16>r?0:4080<=r?255:r>>4,v=16>v?0:4080<=v?255:
v>>4,p=16>p?0:4080<=p?255:p>>4,A[D+t]=l,A[D+t+8]=E,A[D+t+16]=z,A[D+t+24]=y,A[D+t+32]=w,A[D+t+40]=r,A[D+t+48]=v,A[D+t+56]=p)}return b.blockData}function e(a,b,f){var g=a.length-1;f=f<b?f:b;if(b>=g)return null;var h=a[b]<<8|a[b+1];if(65472<=h&&65534>=h)return{invalid:null,marker:h,offset:b};for(b=a[f]<<8|a[f+1];!(65472<=b&&65534>=b);){if(++f>=g)return null;b=a[f]<<8|a[f+1]}return{invalid:h.toString(16),marker:b,offset:f}}if(!self||!self.Uint8ClampedArray)return null;var c=new Uint8Array([0,1,8,16,9,
2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);n.prototype={parse:function(a){function b(){var t=a[h]<<8|a[h+1];h+=2;return t}function f(){var t=b();t=h+t-2;var A=e(a,t,h);A&&A.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+A.invalid),t=A.offset);t=a.subarray(h,t);h+=t.length;return t}function g(t){for(var A=Math.ceil(t.samplesPerLine/8/t.maxH),
J=Math.ceil(t.scanLines/8/t.maxV),M=0;M<t.components.length;M++){q=t.components[M];var N=Math.ceil(Math.ceil(t.samplesPerLine/8)*q.h/t.maxH),x=Math.ceil(Math.ceil(t.scanLines/8)*q.v/t.maxV);q.blockData=new Int16Array(64*J*q.v*(A*q.h+1));q.blocksPerLine=N;q.blocksPerColumn=x}t.mcusPerLine=A;t.mcusPerColumn=J}var h=0,d=null,l=null,p=[],v=[],r=[],w=b();if(65496!==w)throw new H("SOI not found");for(w=b();65497!==w;){switch(w){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var y=
f();65504===w&&74===y[0]&&70===y[1]&&73===y[2]&&70===y[3]&&0===y[4]&&(d={version:{major:y[5],minor:y[6]},densityUnits:y[7],xDensity:y[8]<<8|y[9],yDensity:y[10]<<8|y[11],thumbWidth:y[12],thumbHeight:y[13],thumbData:y.subarray(14,14+3*y[12]*y[13])});65518===w&&65===y[0]&&100===y[1]&&111===y[2]&&98===y[3]&&101===y[4]&&(l={version:y[5]<<8|y[6],flags0:y[7]<<8|y[8],flags1:y[9]<<8|y[10],transformCode:y[11]});break;case 65499:w=b()+h-2;for(var z;h<w;){var E=a[h++],B=new Uint16Array(64);if(0===E>>4)for(y=
0;64>y;y++)z=c[y],B[z]=a[h++];else if(1===E>>4)for(y=0;64>y;y++)z=c[y],B[z]=b();else throw new H("DQT - invalid table spec");p[E&15]=B}break;case 65472:case 65473:case 65474:if(C)throw new H("Only single frame JPEGs supported");b();var C={};C.extended=65473===w;C.progressive=65474===w;C.precision=a[h++];C.scanLines=b();C.samplesPerLine=b();C.components=[];C.componentIds={};y=a[h++];for(w=B=E=0;w<y;w++){z=a[h];var G=a[h+1]>>4;var I=a[h+1]&15;E<G&&(E=G);B<I&&(B=I);G=C.components.push({h:G,v:I,quantizationId:a[h+
2],quantizationTable:null});C.componentIds[z]=G-1;h+=3}C.maxH=E;C.maxV=B;g(C);break;case 65476:z=b();for(w=2;w<z;){E=a[h++];B=new Uint8Array(16);for(y=G=0;16>y;y++,h++)G+=B[y]=a[h];I=new Uint8Array(G);for(y=0;y<G;y++,h++)I[y]=a[h];w+=17+G;(0===E>>4?r:v)[E&15]=u(B,I)}break;case 65501:b();var D=b();break;case 65498:b();z=a[h++];y=[];for(w=0;w<z;w++){E=C.componentIds[a[h++]];var q=C.components[E];E=a[h++];q.huffmanTableDC=r[E>>4];q.huffmanTableAC=v[E&15];y.push(q)}w=a[h++];z=a[h++];E=a[h++];w=m(a,h,
C,y,D,w,z,E>>4,E&15);h+=w;break;case 65535:255!==a[h]&&h--;break;default:if(255===a[h-3]&&192<=a[h-2]&&254>=a[h-2])h-=3;else throw new H("unknown marker "+w.toString(16));}w=b()}this.width=C.samplesPerLine;this.height=C.scanLines;this.jfif=d;this.eof=h;this.adobe=l;this.components=[];for(w=0;w<C.components.length;w++){q=C.components[w];if(d=p[q.quantizationId])q.quantizationTable=d;this.components.push({output:k(C,q),scaleX:q.h/C.maxH,scaleY:q.v/C.maxV,blocksPerLine:q.blocksPerLine,blocksPerColumn:q.blocksPerColumn})}this.numComponents=
this.components.length},_getLinearizedBlockData:function(a,b){var f=this.width/a,g=this.height/b,h,d,l=0,p=this.components.length,v=a*b*p,r=new Uint8ClampedArray(v),w=new Uint32Array(a);for(d=0;d<p;d++){var y=this.components[d];var z=y.scaleX*f;var E=y.scaleY*g;l=d;var B=y.output;var C=y.blocksPerLine+1<<3;for(h=0;h<a;h++)y=0|h*z,w[h]=(y&4294967288)<<3|y&7;for(z=0;z<b;z++)for(y=0|z*E,y=C*(y&4294967288)|(y&7)<<3,h=0;h<a;h++)r[l]=B[y+w[h]],l+=p}if(b=this.decodeTransform)for(d=0;d<v;)for(a=y=0;y<p;y++,
d++,a+=2)r[d]=(r[d]*b[a]>>8)+b[a+1];return r},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var b,f,g,h=0,d=a.length;h<d;h+=3)b=a[h],f=a[h+1],g=a[h+2],a[h]=b-179.456+1.402*g,a[h+1]=b+135.459-.344*f-.714*g,a[h+2]=b-226.816+1.772*f;return a},_convertYcckToRgb:function(a){for(var b,f,g,h,d=0,l=0,p=a.length;l<p;l+=4)b=a[l],f=a[l+1],g=a[l+2],h=a[l+3],a[d++]=
-122.67195406894+f*(-6.60635669420364E-5*f+4.37130475926232E-4*g-5.4080610064599E-5*b+4.8449797120281E-4*h-.154362151871126)+g*(-9.57964378445773E-4*g+8.17076911346625E-4*b-.00477271405408747*h+1.53380253221734)+b*(9.61250184130688E-4*b-.00266257332283933*h+.48357088451265)+h*(-3.36197177618394E-4*h+.484791561490776),a[d++]=107.268039397724+f*(2.19927104525741E-5*f-6.40992018297945E-4*g+6.59397001245577E-4*b+4.26105652938837E-4*h-.176491792462875)+g*(-7.78269941513683E-4*g+.00130872261408275*b+7.70482631801132E-4*
h-.151051492775562)+b*(.00126935368114843*b-.00265090189010898*h+.25802910206845)+h*(-3.18913117588328E-4*h-.213742400323665),a[d++]=-20.810012546947+f*(-5.70115196973677E-4*f-2.63409051004589E-5*g+.0020741088115012*b-.00288260236853442*h+.814272968359295)+g*(-1.53496057440975E-5*g-1.32689043961446E-4*b+5.60833691242812E-4*h-.195152027534049)+b*(.00174418132927582*b-.00255243321439347*h+.116935020465145)+h*(-3.43531996510555E-4*h+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var b,
f,g,h=0,d=a.length;h<d;h+=4)b=a[h],f=a[h+1],g=a[h+2],a[h]=434.456-b-1.402*g,a[h+1]=119.541-b+.344*f+.714*g,a[h+2]=481.816-b-1.772*f;return a},_convertCmykToRgb:function(a){for(var b,f,g,h,d=0,l=1/255,p=0,v=a.length;p<v;p+=4)b=a[p]*l,f=a[p+1]*l,g=a[p+2]*l,h=a[p+3]*l,a[d++]=255+b*(-4.387332384609988*b+54.48615194189176*f+18.82290502165302*g+212.25662451639585*h-285.2331026137004)+f*(1.7149763477362134*f-5.6096736904047315*g-17.873870861415444*h-5.497006427196366)+g*(-2.5217340131683033*g-21.248923337353073*
h+17.5119270841813)-h*(21.86122147463605*h+189.48180835922747),a[d++]=255+b*(8.841041422036149*b+60.118027045597366*f+6.871425592049007*g+31.159100130055922*h-79.2970844816548)+f*(-15.310361306967817*f+17.575251261109482*g+131.35250912493976*h-190.9453302588951)+g*(4.444339102852739*g+9.8632861493405*h-24.86741582555878)-h*(20.737325471181034*h+187.80453709719578),a[d++]=255+b*(.8842522430003296*b+8.078677503112928*f+30.89978309703729*g-.23883238689178934*h-14.183576799673286)+f*(10.49593273432072*
f+63.02378494754052*g+50.606957656360734*h-112.23884253719248)+g*(.03296041114873217*g+115.60384449646641*h-193.58209356861505)-h*(22.33816807309886*h+180.12613974708367);return a},getData:function(a,b,f){if(4<this.numComponents)throw new H("Unsupported color mode");a=this._getLinearizedBlockData(a,b);if(1===this.numComponents&&f){f=a.length;b=new Uint8ClampedArray(3*f);for(var g=0,h=0;h<f;h++){var d=a[h];b[g++]=d;b[g++]=d;b[g++]=d}return b}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);
if(4===this.numComponents){if(this._isColorConversionNeeded())return f?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(f)return this._convertCmykToRgb(a)}return a}};return n}()})},"esri/layers/rasterFormats/Png":function(){define(["./Zlib"],function(H){return function(){function n(m){var k,e;this.data=m;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(e=null;;){var c=this.readUInt32();var a=m=void 0;m=[];for(a=0;4>a;++a)m.push(String.fromCharCode(this.data[this.pos++]));
m=m.join("");switch(m){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(c);break;case "fcTL":e&&this.animation.frames.push(e);this.pos+=
4;e={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};m=this.readUInt16();c=this.readUInt16()||100;e.delay=1E3*m/c;e.disposeOp=this.data[this.pos++];e.blendOp=this.data[this.pos++];e.data=[];break;case "IDAT":case "fdAT":"fdAT"===m&&(this.pos+=4,c-=4);m=(null!=e?e.data:void 0)||this.imgData;for(a=0;0<=c?a<c:a>c;0<=c?++a:--a)m.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=
this.read(c);c=255-this.transparency.indexed.length;if(0<c)for(m=0;0<=c?m<c:m>c;0<=c?++m:--m)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(c)[0];break;case 2:this.transparency.rgb=this.read(c)}break;case "tEXt":a=this.read(c);c=a.indexOf(0);m=String.fromCharCode.apply(String,a.slice(0,c));this.text[m]=String.fromCharCode.apply(String,a.slice(c+1));break;case "IEND":e&&this.animation.frames.push(e);a:{switch(this.colorType){case 0:case 3:case 4:e=1;break a;
case 2:case 6:e=3;break a}e=void 0}this.colors=e;this.hasAlphaChannel=4===(k=this.colorType)||6===k;k=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*k;a:{switch(this.colors){case 1:k="DeviceGray";break a;case 3:k="DeviceRGB";break a}k=void 0}this.colorSpace=k;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=c}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}n.load=function(m,k,e){"function"===typeof k&&(e=k);var c=new XMLHttpRequest;
c.open("GET",m,!0);c.responseType="arraybuffer";c.onload=function(){var a=new Uint8Array(c.response||c.mozResponseArrayBuffer);a=new n(a);"function"===typeof(null!=k?k.getContext:void 0)&&a.render(k);return"function"===typeof e?e(a):void 0};return c.send(null)};n.prototype.read=function(m){var k;var e=[];for(k=0;0<=m?k<m:k>m;0<=m?++k:--k)e.push(this.data[this.pos++]);return e};n.prototype.readUInt32=function(){var m=this.data[this.pos++]<<24;var k=this.data[this.pos++]<<16;var e=this.data[this.pos++]<<
8;var c=this.data[this.pos++];return m|k|e|c};n.prototype.readUInt16=function(){var m=this.data[this.pos++]<<8;var k=this.data[this.pos++];return m|k};n.prototype.decodePixels=function(m){var k,e,c,a,b,f,g,h;null==m&&(m=this.imgData);if(0===m.length)return new Uint8Array(0);m=new H(m);m=m.getBytes();var d=this.pixelBitlength/8;var l=d*this.width;var p=new Uint8Array(l*this.height);var v=m.length;for(e=a=b=0;a<v;){switch(m[a++]){case 0:for(c=k=0;k<l;c=k+=1)p[e++]=m[a++];break;case 1:for(c=f=0;f<l;c=
f+=1){k=m[a++];var r=c<d?0:p[e-d];p[e++]=(k+r)%256}break;case 2:for(c=r=0;r<l;c=r+=1){k=m[a++];var w=(c-c%d)/d;f=b&&p[(b-1)*l+w*d+c%d];p[e++]=(f+k)%256}break;case 3:for(c=h=0;h<l;c=h+=1)k=m[a++],w=(c-c%d)/d,r=c<d?0:p[e-d],f=b&&p[(b-1)*l+w*d+c%d],p[e++]=(k+Math.floor((r+f)/2))%256;break;case 4:for(c=h=0;h<l;c=h+=1){k=m[a++];w=(c-c%d)/d;r=c<d?0:p[e-d];0===b?f=g=0:(f=p[(b-1)*l+w*d+c%d],g=w&&p[(b-1)*l+(w-1)*d+c%d]);var y=r+f-g;c=Math.abs(y-r);w=Math.abs(y-f);y=Math.abs(y-g);r=c<=w&&c<=y?r:w<=y?f:g;p[e++]=
(k+r)%256}break;default:throw Error("Invalid filter algorithm: "+m[a-1]);}b++}return p};n.prototype.decodePalette=function(){var m,k,e,c,a;var b=this.palette;var f=this.transparency.indexed||[];var g=new Uint8Array((f.length||0)+b.length);var h=e=m=k=0;for(c=b.length;e<c;h=e+=3)g[k++]=b[h],g[k++]=b[h+1],g[k++]=b[h+2],g[k++]=null!=(a=f[m++])?a:255;return g};n.prototype.copyToImageData=function(m,k){var e,c;var a=this.colors;var b=null;var f=this.hasAlphaChannel;this.palette.length&&(b=null!=(e=this._decodedPalette)?
e:this._decodedPalette=this.decodePalette(),a=4,f=!0);m=m.data||m;var g=m.length;var h=b||k;e=c=0;if(1===a)for(;e<g;)a=b?4*k[e/4]:c,c=h[a++],m[e++]=c,m[e++]=c,m[e++]=c,m[e++]=f?h[a++]:this.transparency.grayscale&&this.transparency.grayscale===c?0:255,c=a;else for(;e<g;)a=b?4*k[e/4]:c,m[e++]=h[a++],m[e++]=h[a++],m[e++]=h[a++],m[e++]=f?h[a++]:this.transparency.rgb&&this.transparency.rgb[1]===h[a-3]&&this.transparency.rgb[3]===h[a-2]&&this.transparency.rgb[5]===h[a-1]?0:255,c=a};n.prototype.decode=function(){var m=
new Uint8Array(this.width*this.height*4);this.copyToImageData(m,this.decodePixels());return m};var u=function(m){(void 0).clearRect(0,0,m.width,m.height);(void 0).putImageData(m,0,0);m=new Image;m.src=(void 0).toDataURL();return m};n.prototype.decodeFrames=function(m){var k,e;if(this.animation){var c=this.animation.frames;var a=[];var b=k=0;for(e=c.length;k<e;b=++k){b=c[b];var f=m.createImageData(b.width,b.height);var g=this.decodePixels(new Uint8Array(b.data));this.copyToImageData(f,g);b.imageData=
f;a.push(b.image=u(f))}return a}};n.prototype.renderFrame=function(m,k){var e=this.animation.frames;var c=e[k];e=e[k-1];0===k&&m.clearRect(0,0,this.width,this.height);1===(null!=e?e.disposeOp:void 0)?m.clearRect(e.xOffset,e.yOffset,e.width,e.height):2===(null!=e?e.disposeOp:void 0)&&m.putImageData(e.imageData,e.xOffset,e.yOffset);0===c.blendOp&&m.clearRect(c.xOffset,c.yOffset,c.width,c.height);return m.drawImage(c.image,c.xOffset,c.yOffset)};n.prototype.animate=function(m){var k,e=this;var c=0;var a=
this.animation;var b=a.numFrames;var f=a.frames;var g=a.numPlays;return(k=function(){var h=c++%b;var d=f[h];e.renderFrame(m,h);if(1<b&&c/b<g)return e.animation._timeout=setTimeout(k,d.delay)})()};n.prototype.stopAnimation=function(){var m;return clearTimeout(null!=(m=this.animation)?m._timeout:void 0)};n.prototype.render=function(m){m._png&&m._png.stopAnimation();m._png=this;m.width=this.width;m.height=this.height;m=m.getContext("2d");if(this.animation)return this.decodeFrames(m),this.animate(m);
var k=m.createImageData(this.width,this.height);this.copyToImageData(k,this.decodePixels());return m.putImageData(k,0,0)};return n}()})},"esri/layers/rasterFormats/Raw":function(){define([],function(){return{decodeBIP:function(H,n){var u=n.pixelType,m=n.bandCount,k=[],e=n.width*n.height,c=this.getBandCount(H,n);m=m||c;var a=H.byteLength-H.byteLength%(e*this._getPixelLength(u)),b=new u(H,0,e*c),f,g,h;for(f=0;f<m;f++){var d=new u(e);for(g=0;g<e;g++)d[g]=b[g*c+f];k.push(d)}a<H.byteLength-1&&(h=this._decodeMask(H.slice(a),
n));return{pixels:k,maskData:h}},decodeBSQ:function(H,n){var u=n.pixelType,m=n.bandCount;if(void 0===m||null===m)m=this.getBandCount(H,n);var k=[],e=n.width*n.height,c=e*m,a=H.byteLength-H.byteLength%(e*this._getPixelLength(u));u=new u(H,0,c);var b;for(c=0;c<m;c++)k.push(u.subarray(c*e,(c+1)*e));a<H.byteLength-1&&(b=this._decodeMask(H.slice(a),n));return{pixels:k,maskData:b}},getBandCount:function(H,n){return Math.floor(H.byteLength/(n.width*n.height*this._getPixelLength(n.pixelType)))},_getPixelLength:function(H){var n=
1;switch(H){case Uint8Array:case Int8Array:case Uint8ClampedArray:n=1;break;case Uint16Array:case Int16Array:n=2;break;case Uint32Array:case Int32Array:case Float32Array:n=4;break;case Float64Array:n=8}return n},_decodeMask:function(H,n){var u=n.width*n.height;if(8*H.byteLength<u)return null;H=new Uint8Array(H,0,Math.ceil(u/8));n=new Uint8Array(n.width*n.height);var m=0,k=0,e=0,c=0;for(e=0;e<H.length-1;e++)for(k=H[e],c=7;0<=c;c--)n[m++]=k>>c&1;for(c=7;m<u-1;)k=H[H.length-1],n[m++]=k>>c&1,c--;return n}}})},
"esri/layers/rasterFormats/TiffDecoder":function(){define(["./Jpg","./Zlib"],function(H,n){var u=function(){var c=new ArrayBuffer(4),a=new Uint8Array(c);c=new Uint32Array(c);a[0]=1;a[1]=2;a[2]=3;a[3]=4;return 67305985===c[0]},m=function(){var c=[];c[254]="NEWSUBFILETYPE";c[255]="SUBFILETYPE";c[256]="IMAGEWIDTH";c[257]="IMAGELENGTH";c[258]="BITSPERSAMPLE";c[259]="COMPRESSION";c[262]="PHOTOMETRICINTERPRETATION";c[263]="THRESHHOLDING";c[264]="CELLWIDTH";c[265]="CELLLENGTH";c[266]="FILLORDER";c[269]=
"DOCUMENTNAME";c[270]="IMAGEDESCRIPTION";c[271]="MAKE";c[272]="MODEL";c[273]="STRIPOFFSETS";c[274]="ORIENTATION";c[277]="SAMPLESPERPIXEL";c[278]="ROWSPERSTRIP";c[279]="STRIPBYTECOUNTS";c[280]="MINSAMPLEVALUE";c[281]="MAXSAMPLEVALUE";c[282]="XRESOLUTION";c[283]="YRESOLUTION";c[284]="PLANARCONFIGURATION";c[285]="PAGENAME";c[286]="XPOSITION";c[287]="YPOSITION";c[288]="FREEOFFSETS";c[289]="FREEBYTECOUNTS";c[290]="GRAYRESPONSEUNIT";c[291]="GRAYRESPONSECURVE";c[292]="T4OPTIONS";c[293]="T6OPTIONS";c[296]=
"RESOLUTIONUNIT";c[297]="PAGENUMBER";c[300]="COLORRESPONSEUNIT";c[301]="TRANSFERFUNCTION";c[305]="SOFTWARE";c[306]="DATETIME";c[315]="ARTIST";c[316]="HOSTCOMPUTER";c[317]="PREDICTOR";c[318]="WHITEPOINT";c[319]="PRIMARYCHROMATICITIES";c[320]="COLORMAP";c[321]="HALFTONEHINTS";c[322]="TILEWIDTH";c[323]="TILELENGTH";c[324]="TILEOFFSETS";c[325]="TILEBYTECOUNTS";c[326]="BADFAXLINES";c[327]="CLEANFAXDATA";c[328]="CONSECUTIVEBADFAXLINES";c[330]="SUBIFD";c[332]="INKSET";c[333]="INKNAMES";c[334]="NUMBEROFINKS";
c[336]="DOTRANGE";c[337]="TARGETPRINTER";c[338]="EXTRASAMPLES";c[339]="SAMPLEFORMAT";c[340]="SMINSAMPLEVALUE";c[341]="SMAXSAMPLEVALUE";c[342]="TRANSFERRANGE";c[347]="JPEGTABLES";c[512]="JPEGPROC";c[513]="JPEGIFOFFSET";c[514]="JPEGIFBYTECOUNT";c[515]="JPEGRESTARTINTERVAL";c[517]="JPEGLOSSLESSPREDICTORS";c[518]="JPEGPOINTTRANSFORM";c[519]="JPEGQTABLES";c[520]="JPEGDCTABLES";c[521]="JPEGACTABLES";c[529]="YCBCRCOEFFICIENTS";c[530]="YCBCRSUBSAMPLING";c[531]="YCBCRPOSITIONING";c[532]="REFERENCEBLACKWHITE";
c[33550]="GEOPIXELSCALE";c[33922]="GEOTIEPOINTS";c[33432]="COPYRIGHT";c[42112]="GDAL_METADATA";c[42113]="GDAL_NODATA";c[50844]="RPCCOEFFICIENT";c[34735]="GEOKEYDIRECTORY";c[34736]="GEODOUBLEPARAMS";c[34737]="GEOASCIIPARAMS";return c}(),k=[0,1,1,2,4,8,1,1,2,4,8,4,8],e=function(c,a){var b="UNKNOWN";3===c?b="F32":1===c?8>=a?b="U8":16>=a?b="U16":32>=a&&(b="U32"):2===c&&(8>=a?b="S8":16>=a?b="S16":32>=a&&(b="S32"));return b};return{decode:function(c){var a=new DataView(c,0,8),b=a.getUint16(0,!1);if(18761===
b)var f=!0;else if(19789===b)f=!1;else throw"unexpected endianess byte";if(42!==a.getUint16(2,f))throw"unexpected tiff identifier";var g=a.getUint32(4,f);var h=f;var d,l;var p=g;for(var v=[];p;){var r=(new DataView(c,p,2)).getUint16(0,h);var w=p+2;p=(new DataView(c,w+12*r,4)).getUint32(0,h);var y={};for(d=0;d<r;d++){var z=new DataView(c,w,12);var E=z.getUint16(0,h);var B=z.getUint16(2,h);var C=z.getUint32(4,h);var G=z.getUint32(8,h);w+=12;if(!(7===B||12<B)){var I=l={fieldTag:E,fieldType:B,fieldValueCount:C,
fieldValueOffset:G},D=void 0,q=void 0,t=c,A=h,J=[],M=l.fieldType,N=l.fieldValueCount,x=l.fieldValueOffset,F=x,L=k[M],O=8*L,P=N*L,S=N*k[M]*8;if(32>=S)if(A||(x>>>=32-S),1===N)J=[x];else for(D=0;D<N;D++)J.push(x<<O*D>>>32-O);else for(F=x;F<x+P;F+=L){switch(M){case 1:q=(new DataView(t,F,1)).getUint8(0);break;case 2:q=(new DataView(t,F,1)).getUint8(0);break;case 3:q=(new DataView(t,F,2)).getUint16(0,A);break;case 4:q=(new DataView(t,F,4)).getUint32(0,A);break;case 5:q=(new DataView(t,F,4)).getUint32(0,
A)/(new DataView(t,F+4,4)).getUint32(0,A);break;case 6:q=(new DataView(t,F,1)).getInt8(0);break;case 8:q=(new DataView(t,F,2)).getInt16(0,A);break;case 9:q=(new DataView(t,F,4)).getInt32(0,A);break;case 10:q=(new DataView(t,F,4)).getInt32(0,A)/(new DataView(t,F+4,4)).getInt32(0,A);break;case 11:q=(new DataView(t,F,4)).getFloat32(0,A);break;case 12:q=(new DataView(t,F,8)).getFloat64(0,A);break;case 7:q=null;break;default:q=null}J.push(q)}if(2===M){var T="",W=J;J=[];for(D=0;D<W.length;D++)0===W[D]&&
""!==T?(J.push(T),T=""):T+=String.fromCharCode(W[D]);""===T&&0!==J.length||J.push(T)}I.fieldValues=J;var X=y,K=m[E];void 0===K&&(K="unknown"+E);X[K]={type:B,values:l.fieldValues}}}v.push(y)}if(0===v.length)throw"no valid image file directory";var R,Q=v[0],U=void 0===Q.GDAL_NODATA||null===Q.GDAL_NODATA?null:parseFloat(Q.GDAL_NODATA.values[0]);if(Q.TILEOFFSETS){var V=u()===h,Y=Q.TILEOFFSETS?Q.TILEOFFSETS.values:void 0;if(void 0===Y)var Z=void 0;else{var aa=Q.TILEBYTECOUNTS.values,ca=Q.TILEWIDTH.values[0],
oa=Q.TILELENGTH.values[0],ea=Q.IMAGEWIDTH.values[0],ba=Q.IMAGELENGTH.values[0],na=ea*ba,ra=Q.BITSPERSAMPLE.values[0],ia=Q.SAMPLESPERPIXEL.values[0],la=Q.SAMPLEFORMAT?Q.SAMPLEFORMAT.values[0]:1,Ca=e(la,ra);if(1!==(Q.PLANARCONFIGURATION?Q.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var da=Q.COMPRESSION?Q.COMPRESSION.values[0]:1;if(1!==da&&6!==da&&8!==da&&32946!==da)throw console.log("this compression is not supported at this moment"),
"this compression is not supported at this moment";if(3<la)Z=void 0;else{if(3===la){var sa=new Float32Array(na*ia);var xa=Float32Array}else 1===la?8>=ra?(sa=new Uint8Array(na*ia),xa=Uint8Array):16>=ra?(sa=new Uint16Array(na*ia),xa=Uint16Array):32>=ra&&(sa=new Uint32Array(na*ia),xa=Uint32Array):2===la&&(8>=ra?(sa=new Int8Array(na*ia),xa=Int8Array):16>=ra?(sa=new Int16Array(na*ia),xa=Int16Array):32>=ra&&(sa=new Int32Array(na*ia),xa=Int32Array));var fa,va,ka,Aa,Ka,Ba=Math.ceil(ea/ca);if(0===ra%8)for(fa=
0;fa<Y.length;fa++){var La=Math.floor(fa/Ba)*oa;var Ra=fa%Ba*ca;var Pa=(La*ea+Ra)*ia;if("U8"===Ca||"S8"===Ca||V)if(8===da||32946===da){var ha=new Uint8Array(c,Y[fa],aa[fa]);var Ma=new n(ha);var Qa=Ma.getBytes();var ua=new ArrayBuffer(Qa.length);ha=new Uint8Array(ua);ha.set(Qa);ha.length!==ca*oa*ia*ra/8&&console.log("tile byte counts is different than expected")}else if(6===da){ha=new Uint8Array(c,Y[fa],aa[fa]);var Na=new H;Na.parse(ha);var pa=Na.getData(Na.width,Na.height);ua=new ArrayBuffer(pa.length);
ha=new Uint8Array(ua);ha.set(pa)}else 1===da&&(aa[fa]!==ca*oa*ia*ra/8&&console.log("tile byte counts is different than expected"),ua=c.slice(Y[fa],Y[fa]+aa[fa]));else{if(8===da||32946===da){ha=new Uint8Array(c,Y[fa],aa[fa]);Ma=new n(ha);ha=Ma.getBytes();ua=new ArrayBuffer(ha.length);var wa=new Uint8Array(ua);ha.length!==ca*oa*ia*ra/8&&console.log("tile byte counts is different than expected")}else 1===da&&(aa[fa]!==ca*oa*ia*ra/8&&console.log("tile byte counts is different than expected"),ua=new ArrayBuffer(aa[fa]),
ha=new Uint8Array(c,Y[fa],aa[fa]),wa=new Uint8Array(ua));switch(Ca){case "U16":case "S16":for(ka=0;ka<ha.length;ka+=2)wa[ka]=ha[ka+1],wa[ka+1]=ha[ka];break;case "U32":case "S32":case "F32":for(ka=0;ka<ha.length;ka+=4)wa[ka]=ha[ka+3],wa[ka+1]=ha[ka+2],wa[ka+2]=ha[ka+1],wa[ka+3]=ha[ka]}}var hb=new xa(ua);var ab=0;var bb=Pa;var ib=Math.min(ca,ea-Ra);var jb=Math.min(oa,ba-La);for(Aa=0;Aa<jb;Aa++)for(bb=Pa+Aa*ea*ia,ab=Aa*ca*ia,Ka=0;Ka<ib*ia;Ka++,bb++,ab++)sa[bb]=hb[ab]}var Xa={width:ea,height:ba,pixelType:Ca};
if(1===ia)Xa.pixels=[sa];else for(Xa.pixels=[],fa=0;fa<ia;fa++){var db=new xa(na);for(va=0;va<na;va++)db[va]=sa[va*ia+fa];Xa.pixels.push(db)}Z=Xa}}}else if(Q.STRIPOFFSETS){var kb=u()===h,Fa=Q.STRIPOFFSETS?Q.STRIPOFFSETS.values:void 0;if(void 0===Fa)Z=void 0;else{var Ga=Q.STRIPBYTECOUNTS.values,Sa=Q.ROWSPERSTRIP.values,Ha=Q.IMAGEWIDTH.values[0],Ta=Q.IMAGELENGTH.values[0],Ia=Ha*Ta,ya=Q.BITSPERSAMPLE.values[0],ta=Q.SAMPLESPERPIXEL.values[0],Ua=Q.SAMPLEFORMAT?Q.SAMPLEFORMAT.values[0]:1,Ya=e(Ua,ya);if(1!==
(Q.PLANARCONFIGURATION?Q.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var za=Q.COMPRESSION?Q.COMPRESSION.values[0]:1;if(1!==za&&6!==za&&8!==za&&32946!==za)throw console.log("compressed tiff is not supported at this moment"),"compressed tiff is not supported at this moment";if(3<Ua)Z=void 0;else{if(3===Ua){var Da=new Float32Array(Ia*ta);var Ja=Float32Array}else 1===Ua?8>=ya?(Da=new Uint8Array(Ia*ta),Ja=Uint8Array):
16>=ya?(Da=new Uint16Array(Ia*ta),Ja=Uint16Array):32>=ya&&(Da=new Uint32Array(Ia*ta),Ja=Uint32Array):2===Ua&&(8>=ya?(Da=new Int8Array(Ia*ta),Ja=Int8Array):16>=ya?(Da=new Int16Array(Ia*ta),Ja=Int16Array):32>=ya&&(Da=new Int32Array(Ha*Ta*ta),Ja=Int32Array));var ja,Va,qa,Wa=Sa;if(0===ya%8)for(ja=0;ja<Fa.length;ja++){var lb=ja*Sa*Ha*ta;Wa=(ja+1)*Sa>Ta?Ta-ja*Sa:Sa;if("U8"===Ya||"S8"===Ya||kb)if(8===za||32946===za){var ma=new Uint8Array(c,Fa[ja],Ga[ja]);var cb=new n(ma);var eb=cb.getBytes();var Ea=new ArrayBuffer(eb.length);
ma=new Uint8Array(Ea);ma.set(eb);ma.length!==Wa*Ha*ta*ya/8&&console.log("strip byte counts is different than expected")}else if(6===za){ma=new Uint8Array(c,Fa[ja],Ga[ja]);var Za=new H;Za.parse(ma);var fb=Za.getData(Za.width,Za.height);Ea=new ArrayBuffer(fb.length);ma=new Uint8Array(Ea);ma.set(fb)}else 1===za&&(Ga[ja]!==Wa*Ha*ta*ya/8&&console.log("strip byte counts is different than expected"),Ea=c.slice(Fa[ja],Fa[ja]+Ga[ja]));else{if(6===za||8===za||32946===za){ma=new Uint8Array(c,Fa[ja],Ga[ja]);
cb=new n(ma);ma=cb.getBytes();Ea=new ArrayBuffer(ma.length);var Oa=new Uint8Array(Ea);ma.length!==Wa*Ha*ta*ya/8&&console.log("strip byte counts is different than expected")}else 1===za&&(Ga[ja]!==Wa*Ha*ta*ya/8&&console.log("strip byte counts is different than expected"),Ea=new ArrayBuffer(Ga[ja]),ma=new Uint8Array(c,Fa[ja],Ga[ja]),Oa=new Uint8Array(Ea));switch(Ya){case "U16":case "S16":for(qa=0;qa<ma.length;qa+=2)Oa[qa]=ma[qa+1],Oa[qa+1]=ma[qa];break;case "U32":case "S32":case "F32":for(qa=0;qa<ma.length;qa+=
4)Oa[qa]=ma[qa+3],Oa[qa+1]=ma[qa+2],Oa[qa+2]=ma[qa+1],Oa[qa+3]=ma[qa]}}var mb=new Ja(Ea);Da.set(mb,lb)}var $a={width:Ha,height:Ta,pixelType:Ya};if(1===ta)$a.pixels=[Da];else for($a.pixels=[],ja=0;ja<ta;ja++){var gb=new Ja(Ia);for(Va=0;Va<Ia;Va++)gb[Va]=Da[Va*ta+ja];$a.pixels.push(gb)}Z=$a}}}if(null!==U){Z.maskData=new Uint8Array(Z.width*Z.height);if(1E24<Math.abs(U))for(R=0;R<Z.width*Z.height;R++)Z.maskData[R]=1E-6>Math.abs((Z.pixels[0][R]-U)/U)?0:1;else for(R=0;R<Z.width*Z.height;R++)Z.maskData[R]=
Z.pixels[0][R]===U?0:1;Z.noDataValue=U}return Z}}})},"esri/layers/rasterLib/tile/RasterHandler":function(){define("require exports module dojo/Deferred dojo/promise/all ../../PixelBlock ../../vectorTiles/core/workers ../../vectorTiles/core/promiseUtils ../../vectorTiles/core/requireUtils ../../vectorTiles/request ../../rasterLib/function/rasterFunctionHelper ../../rasterLib/renderer/rasterRendererHelper".split(" "),function(H,n,u,m,k,e,c,a,b,f,g,h){function d(l){var p=new m;k(l).then(function(v){p.resolve()});
return p.promise}return function(){function l(p){this.customModules=p&&p.customModules}l.prototype.destroy=function(){this.stop();this.customModules=this.rasterLayer=null};l.prototype.start=function(){this.stop();var p=new m,v=0,r=this.customModules?this.customModules.length+1:1,w=b.getAbsMid("esri/layers/rasterLib/tile/RasterWorker",H,u),y=c.open(w,{client:this}).then(function(z){this._connection=z;v++;v===r&&(this._connected=!0,p.resolve())}.bind(this));this._openDL=[y];this.customModules&&this.customModules.forEach(function(z){y=
c.open(z,{client:this}).then(function(E){v++;v===r&&(this._connected=!0,p.resolve())});this._openDL.push(y);console.log(z)}.bind(this));return this._connectionPromise=p.promise};l.prototype.stop=function(){this._openDL?this._openDL.forEach(function(p){p.isFulfilled()||p.cancel()}.bind(this)):this._connectionPromise&&!this._connectionPromise.isFulfilled()&&this._connectionPromise.cancel();this._connection&&(this._connection.close(),this._connection=null)};l.prototype.decode=function(p){if(!this._connectionPromise.isFulfilled()||
!this._connection)return a.reject(Error("no connection"));var v={id:null};return this._connection.invoke("decode",p,[],v).then(function(r){r.targetWorker=v;return r})};l.prototype.process=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var v={id:null};p.layerId=this.rasterLayer.layerId;var r=new m;this._connection.invoke("process",p,[],v).then(function(w){w.targetWorker=v;w.src?Object.keys(w.src).forEach(function(y){w.src[y].pixelBlock=
new e(w.src[y].pixelBlock)}):w.src=null;w.pixelBlock&&(w.pixelBlock=new e(w.pixelBlock));r.resolve(w)});return r.promise};l.prototype.render=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var v={id:null};p.layerId=this.rasterLayer.layerId;return this._connection.invoke("render",p,[],v).then(function(r){r.targetWorker=v;r.pixelBlock=r.pixelBlock?new e(r.pixelBlock):null;return r})};l.prototype.setLayer=function(p){if(!this._connectionPromise.isFulfilled()||
!this._connection)return a.reject(Error("no connection"));this.rasterLayer=p;p=this._connection.broadcast("setLayer",p,[],{id:null});return d(p)};l.prototype.setRasterFunction=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));p=this._connection.broadcast("setRasterFunction",p,[],{id:null});return d(p)};l.prototype.setRasterRenderer=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));
p=this._connection.broadcast("setRasterRenderer",p,[],{id:null});return d(p)};return l}()})},"esri/layers/vectorTiles/core/workers":function(){define(["require","exports","./workers/workers"],function(H,n,u){Object.defineProperty(n,"__esModule",{value:!0});for(var m in u)n.hasOwnProperty(m)||(n[m]=u[m])})},"esri/layers/vectorTiles/core/workers/workers":function(){define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),function(H,
n,u,m,k,e,c,a,b){function f(){if(v)return v;for(var r=g+h,w=[],y=function(E){var B=b.create(E).then(function(C){return p[E]=C});w.push(B)},z=0;z<r;z++)y(z);return v=m(w).then(function(){})}Object.defineProperty(n,"__esModule",{value:!0});n.Connection=c;n.RemoteClient=a;(c=navigator.hardwareConcurrency)||(c=u("safari")&&u("mac")||u("trident")?8:2);var g=u("esri-workers-debug")?1:Math.max(1,Math.ceil(c/2)),h=u("esri-workers-debug")?1:Math.max(1,Math.floor(c/2)),d=k.getLogger("esri.core.workers"),l=
0,p=[];n.initialize=function(){f()};n.open=function(r,w,y){void 0===w&&(w={});if(Array.isArray(r))return new n.Connection(r.map(function(B){return new n.RemoteClient(B,w.client)}));if("string"!==typeof r){d.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var z=r;r=w;w={client:z,strategy:y?"dedicated":"distributed"}}var E=w.strategy||"distributed";return"local"===E?e.create(function(B){H([r],function(C){B(n.RemoteClient.connect(C))})}).then(function(B){return new n.Connection([new n.RemoteClient(B,
w.client)])}):f().then(function(){if("dedicated"===E){var B=g+l++;l%=h;return p[B].open(r).then(function(C){return new n.Connection([new n.RemoteClient(C,w.client)])})}return e.all(p.map(function(C){return C.open(r)})).then(function(C){return new n.Connection(C.map(function(G){return new n.RemoteClient(G,w.client)}))})})};n.terminate=function(){for(var r=0;r<p.length;r++)p[r]&&p[r].terminate();p.length=0};var v})},"esri/layers/vectorTiles/core/Logger":function(){define(["require","exports","dojo/has"],
function(H,n,u){var m={info:0,warn:1,error:2};H=function(){function k(e){void 0===e&&(e={});this.module=e.module||"";this.writer=e.writer||null;this.level=e.level||null;null!=e.enabled&&(this.enabled=!!e.enabled);k._loggers[this.module]=this;e=this.module.lastIndexOf(".");-1!==e&&(this.parent=k.getLogger(this.module.slice(0,e)))}k.prototype.log=function(e){for(var c=[],a=1;a<arguments.length;a++)c[a-1]=arguments[a];this._isEnabled()&&this._matchLevel(e)&&(a=this._inheritedWriter())&&a.apply(void 0,
[e,this.module].concat(c))};k.prototype.error=function(){for(var e=[],c=0;c<arguments.length;c++)e[c]=arguments[c];this.log.apply(this,["error"].concat(e))};k.prototype.warn=function(){for(var e=[],c=0;c<arguments.length;c++)e[c]=arguments[c];this.log.apply(this,["warn"].concat(e))};k.prototype.info=function(){for(var e=[],c=0;c<arguments.length;c++)e[c]=arguments[c];this.log.apply(this,["info"].concat(e))};k.prototype.getLogger=function(e){return k.getLogger(this.module+"."+e)};k.getLogger=function(e){var c=
k._loggers[e];c||(c=new k({module:e}));return c};k.prototype._parentWithMember=function(e,c){for(var a=this;a&&null==a[e];)a=a.parent;return a?a[e]:c};k.prototype._inheritedWriter=function(){return this._parentWithMember("writer",this._consoleWriter)};k.prototype._consoleWriter=function(e,c){for(var a=[],b=2;b<arguments.length;b++)a[b-2]=arguments[b];console[e].apply(console,["["+c+"]"].concat(a))};k.prototype._matchLevel=function(e){return m[this._parentWithMember("level","error")]<=m[e]};k.prototype._isEnabled=
function(){return this._parentWithMember("enabled",!0)};k._loggers={};return k}();n=H.getLogger("esri");u("dojo-debug-messages")?n.level="info":n.level="warn";return H})},"esri/layers/vectorTiles/core/promiseUtils":function(){define("require exports dojo/Deferred dojo/when dojo/promise/all ./Error".split(" "),function(H,n,u,m,k,e){function c(a){if(a){if("function"!==typeof a.forEach){var b=Object.keys(a),f=b.map(function(l){return a[l]});return c(f).then(function(l){var p={};b.forEach(function(v,
r){return p[v]=l[r]});return p})}var g=new u,h=[],d=a.length;0===d&&g.resolve(h);a.forEach(function(l){var p={promise:l};h.push(p);l.then(function(v){p.value=v}).catch(function(v){p.error=v}).then(function(){--d;0===d&&g.resolve(h)})});return g.promise}}Object.defineProperty(n,"__esModule",{value:!0});n.all=function(a){return k(a)};n.filter=function(a,b){var f=a.slice();return k(a.map(function(g,h){return b(g,h)})).then(function(g){return f.filter(function(h,d){return g[d]})})};n.eachAlways=c;n.create=
function(a,b){var f=new u(b);a(function(g){void 0===g&&(g=null);return m(g).then(f.resolve)},f.reject);return f.promise};n.reject=function(a){var b=new u;b.reject(a);return b.promise};n.resolve=function(a){void 0===a&&(a=null);var b=new u;b.resolve(a);return b.promise};n.after=function(a,b){void 0===b&&(b=null);var f=0,g=new u(function(){f&&(clearTimeout(f),f=0)});f=setTimeout(function(){g.resolve(b)},a);return g.promise};n.timeout=function(a,b,f){var g=0,h=new u(a.cancel);a.then(function(d){h.isFulfilled()||
(h.resolve(d),g&&(clearTimeout(g),g=0))});a.catch(function(d){h.isFulfilled()||(h.reject(d),g&&(clearTimeout(g),g=0))});g=setTimeout(function(){var d=f||new e("promiseUtils:timeout","The wrapped promise did not resolve within "+b+" ms");h.reject(d)},b);return h.promise};n.wrapCallback=function(a){var b=!1,f=new u(function(){return b=!0});a(function(g){b||f.resolve(g)});return f.promise};n.isThenable=function(a){return a&&"function"===typeof a.then};n.when=function(a){return m(a)}})},"esri/layers/vectorTiles/core/Error":function(){define(["require",
"exports","./tsSupport/extendsHelper","./lang","./Message"],function(H,n,u,m,k){H=function(e){function c(a,b,f){var g=e.call(this,a,b,f)||this;return g instanceof c?g:new c(a,b,f)}u(c,e);c.prototype.toJSON=function(){return{name:this.name,message:this.message,details:m.clone(this.details),dojoType:this.dojoType}};c.fromJSON=function(a){var b=new c(a.name,a.message,a.details);null!=a.dojoType&&(b.dojoType=a.dojoType);return b};return c}(k);H.prototype.type="error";return H})},"esri/layers/vectorTiles/core/tsSupport/extendsHelper":function(){define([],
function(){return function(){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,u){n.__proto__=u}||function(n,u){for(var m in u)u.hasOwnProperty(m)&&(n[m]=u[m])};return function(n,u){function m(){this.constructor=n}H(n,u);n.prototype=null===u?Object.create(u):(m.prototype=u.prototype,new m)}}()})},"esri/layers/vectorTiles/core/lang":function(){define("dojo/_base/kernel dojo/_base/lang dojo/date dojo/number dojo/date/locale dojo/i18n!../nls/common".split(" "),function(H,n,u,m,
k,e){function c(l){return void 0!==l&&null!==l}function a(l){return c(l)?l:""}function b(l,p,v){var r=v.match(/([^\(]+)(\([^\)]+\))?/i),w=n.trim(r[1]);v=p[l];r=JSON.parse((r[2]?n.trim(r[2]):"{}").replace(/^\(/,"{").replace(/\)$/,"}").replace(/([{,])\s*([0-9a-zA-Z_]+)\s*:/gi,'$1"$2":').replace(/"\s*:\s*'/gi,'":"').replace(/'\s*(,|\})/gi,'"$1'));var y=r.utcOffset;if(-1===h.indexOf(w))w=n.getObject(w),n.isFunction(w)&&(v=w(v,l,p,r));else if("number"===typeof v||"string"===typeof v&&v&&!isNaN(Number(v)))switch(v=
Number(v),w){case "NumberFormat":l=n.mixin({},r);p=parseFloat(l.places);if(isNaN(p)||0>p)l.places=Infinity;return m.format(v,l);case "DateString":v=new Date(v);if(r.local||r.systemLocale)return r.systemLocale?v.toLocaleDateString()+(r.hideTime?"":" "+v.toLocaleTimeString()):v.toDateString()+(r.hideTime?"":" "+v.toTimeString());v=v.toUTCString();r.hideTime&&(v=v.replace(/\s+\d\d:\d\d:\d\d\s+(utc|gmt)/i,""));return v;case "DateFormat":return v=new Date(v),c(y)&&(v=u.add(v,"minute",v.getTimezoneOffset()-
y)),k.format(v,r)}return a(v)}function f(l,p){var v;if(p)for(v in l)l.hasOwnProperty(v)&&(void 0===l[v]?delete l[v]:l[v]instanceof Object&&f(l[v],!0));else for(v in l)l.hasOwnProperty(v)&&void 0===l[v]&&delete l[v];return l}function g(l){if(!l||"object"!=typeof l||n.isFunction(l))return l;if(l instanceof Int8Array||l instanceof Uint8Array||l instanceof Uint8ClampedArray||l instanceof Int16Array||l instanceof Int32Array||l instanceof Uint16Array||l instanceof Uint32Array||l instanceof Float32Array||
l instanceof Float64Array||l instanceof Date)return new l.constructor(l);if(l instanceof ArrayBuffer)return l.slice(0,l.byteLength);if("function"===typeof l.clone)l=l.clone();else if("function"===typeof l.map&&"function"===typeof l.forEach)l=l.map(g);else if("function"===typeof l.notifyChange&&"function"===typeof l.watch)l=l.clone();else{var p={},v,r={};for(v in l){var w=l[v];var y=!(v in r)||r[v]!==w;if(!(v in p)||p[v]!==w&&y)p[v]=g?g(w):w}l=p}return l}var h=["NumberFormat","DateString","DateFormat"],
d=/<\/?[^>]+>/g;return{equals:function(l,p){return l===p||"number"===typeof l&&isNaN(l)&&"number"===typeof p&&isNaN(p)||n.isFunction((l||{}).getTime)&&n.isFunction((p||{}).getTime)&&l.getTime()==p.getTime()||n.isFunction((l||{}).equals)&&l.equals(p)||n.isFunction((p||{}).equals)&&p.equals(l)||!1},mixin:n.mixin,valueOf:function(l,p){for(var v in l)if(l[v]==p)return v;return null},stripTags:function(l){if(l){var p=typeof l;if("string"===p)l=l.replace(d,"");else if("object"===p)for(var v in l)(p=l[v])&&
"string"===typeof p&&(p=p.replace(d,"")),l[v]=p}return l},substitute:function(l,p,v){if(c(v))if(n.isObject(v)){var r=v.first;var w=v.dateFormat;var y=v.numberFormat}else r=v;if(p&&"{*}"!==p)return n.replace(p,n.hitch({obj:l},function(E,B){E=B.split(":");return 1<E.length?(B=E[0],E.shift(),b(B,this.obj,E.join(":"))):w&&-1!==(w.properties||[]).indexOf(B)?b(B,this.obj,w.formatter||"DateString"):y&&-1!==(y.properties||[]).indexOf(B)?b(B,this.obj,y.formatter||"NumberFormat"):a(this.obj[B])}));p=[];var z;
p.push('\x3ctable class\x3d"esri-widget__table" summary\x3d"'+e.fieldsSummary+'"\x3e\x3ctbody\x3e');for(z in l)if(v=l[z],w&&-1!==(w.properties||[]).indexOf(z)?v=b(z,l,w.formatter||"DateString"):y&&-1!==(y.properties||[]).indexOf(z)&&(v=b(z,l,y.formatter||"NumberFormat")),p.push("\x3ctr\x3e\x3cth\x3e"+z+"\x3c/th\x3e\x3ctd\x3e"+a(v)+"\x3c/td\x3e\x3c/tr\x3e"),r)break;p.push("\x3c/tbody\x3e\x3c/table\x3e");return p.join("")},filter:function(l,p,v){p=[n.isString(l)?l.split(""):l,v||H.global,n.isString(p)?
new Function("item","index","array",p):p];v={};var r;l=p[0];for(r in l)p[2].call(p[r],l[r],r,l)&&(v[r]=l[r]);return v},startsWith:function(l,p,v){v=v||0;return l.indexOf(p,v)===v},endsWith:function(l,p,v){if("number"!==typeof v||!isFinite(v)||Math.floor(v)!==v||v>l.length)v=l.length;v-=p.length;l=l.indexOf(p,v);return-1!==l&&l===v},isDefined:c,fixJson:f,clone:g}})},"esri/layers/vectorTiles/core/Message":function(){define(["require","exports","dojo/string"],function(H,n,u){return function(){function m(k,
e,c){this instanceof m&&(this.name=k,this.message=e&&u.substitute(e,c,function(a){return null==a?"":a})||"",this.details=c)}m.prototype.toString=function(){return"["+this.name+"]: "+this.message};return m}()})},"esri/layers/vectorTiles/core/workers/Connection":function(){define(["require","exports","../promiseUtils"],function(H,n,u){return function(){function m(k){this._clientIdx=0;this._clients=k}m.prototype.broadcast=function(k,e,c){for(var a=[],b=0,f=this._clients;b<f.length;b++)a.push(f[b].invoke(k,
e,c));return a};m.prototype.close=function(){for(var k=0,e=this._clients;k<e.length;k++)e[k].close();this._clients=[]};m.prototype.invoke=function(k,e,c,a){var b=a&&a.client;if(!this._clients||!this._clients.length)return u.reject(Error("Connection closed"));null!=b&&-1!==this._clients.indexOf(b)||this._clients.some(function(f){return f.isBusy()?!1:(b=f,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,b=this._clients[this._clientIdx]);k=b.invoke(k,e,c);a&&(a.client=b);return k};m.prototype.openPorts=
function(){return u.all(this._clients.map(function(k){return k.openPort()}))};return m}()})},"esri/layers/vectorTiles/core/workers/RemoteClient":function(){define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(H,n,u,m,k,e){function c(l,p){l["delete"](p)}var a=e.MessageType.CLOSE,b=e.MessageType.CANCEL,f=e.MessageType.INVOKE,g=e.MessageType.RESPONSE,h=e.MessageType.OPEN_PORT,d=function(){function l(p){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=
[];this._invoke=p;this._timer=null;this._process=this._process.bind(this)}l.prototype.push=function(p){p.type===e.MessageType.CANCEL?this._cancelledJobIds.add(p.jobId):(this._invokeMessages.push(p),null===this._timer&&(this._timer=setTimeout(this._process,0)))};l.prototype.clear=function(){this._invokeMessages.length=0;this._cancelledJobIds.clear();this._timer=null};l.prototype._process=function(){this._timer=null;for(var p=0,v=this._invokeMessages;p<v.length;p++){var r=v[p];this._cancelledJobIds.has(r.jobId)||
this._invoke(r)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return l}();return function(){function l(p,v,r){this._outJobs=new Map;this._inJobs=new Map;this._queue=new d(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=v;this._port=p;this._port.addEventListener("message",this._onMessage);this._port.start();this._channel=r}l.connect=function(p){var v=new MessageChannel;p="function"===typeof p?new p:"default"in p&&"function"===typeof p.default?new p.default:
p;p.remoteClient=new l(v.port1,p,v);return v.port2};l.prototype.close=function(){this._post({type:a});this._close()};l.prototype.isBusy=function(){return 0<this._outJobs.size};l.prototype.invoke=function(p,v,r){var w=this;if(!this._port)return k.reject(new m("remote-client:port-closed","Can't invoke(), port is closed"));var y=e.newJobId(),z=new u(function(){c(w._outJobs,y);w._post({type:b,jobId:y})});this._outJobs.set(y,z);this._post({type:f,jobId:y,methodName:p},v,r);return z.promise};l.prototype.openPort=
function(){var p=this,v=e.newJobId(),r=new u(function(){c(p._outJobs,v);p._post({type:b,jobId:v})});this._outJobs.set(v,r);this._post({type:h,jobId:v});return r.promise};l.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",this._onMessage);this._port.close();this._outJobs.forEach(function(p){p.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};l.prototype._onMessage=function(p){if(p=e.receiveMessage(p))switch(p.type){case g:this._onResponse(p);
break;case f:this._queue.push(p);break;case b:this._onCancel(p);break;case a:this._close();break;case h:this._onOpenPort(p)}};l.prototype._onCancel=function(p){var v=this._inJobs,r=p.jobId,w=v.get(r);this._queue.push(p);w&&(c(v,r),w.cancel())};l.prototype._onInvoke=function(p){var v=this,r=p.methodName,w=p.jobId;p=p.data;var y=this._inJobs,z=this._client,E=z[r];try{if(!E&&r&&-1!==r.indexOf("."))for(var B=r.split("."),C=0;C<B.length-1;C++)z=z[B[C]],E=z[B[C+1]];if("function"!==typeof E)throw new TypeError(r+
" is not a function");var G=E.call(z,p,this)}catch(I){this._post({type:g,jobId:w,error:e.toInvokeError(I)});return}k.isThenable(G)?(y.set(w,G),G.then(function(I){y.has(w)&&(c(y,w),v._post({type:g,jobId:w},I))}).catch(function(I){y.has(w)&&(c(y,w),I&&"cancel"===I.dojoType||v._post({type:g,jobId:w,error:e.toInvokeError(I||{message:"Error encountered at method "+r})}))})):this._post({type:g,jobId:w},G)};l.prototype._onOpenPort=function(p){var v=new MessageChannel;new l(v.port1,this._client);this._post({type:g,
jobId:p.jobId},v.port2,[v.port2])};l.prototype._onResponse=function(p){var v=p.jobId,r=p.error;p=p.data;var w=this._outJobs;if(w.has(v)){var y=w.get(v);c(w,v);r?y.reject(m.fromJSON(JSON.parse(r))):y.resolve(p)}};l.prototype._post=function(p,v,r){return e.postMessage(this._port,p,v,r)};return l}()})},"esri/layers/vectorTiles/core/workers/utils":function(){define(["require","exports","dojo/has"],function(H,n,u){function m(e){return e&&"object"===typeof e&&("result"in e||"transferList"in e)}Object.defineProperty(n,
"__esModule",{value:!0});(function(e){e[e.HANDSHAKE=0]="HANDSHAKE";e[e.CONFIGURE=1]="CONFIGURE";e[e.CONFIGURED=2]="CONFIGURED";e[e.OPEN=3]="OPEN";e[e.OPENED=4]="OPENED";e[e.RESPONSE=5]="RESPONSE";e[e.INVOKE=6]="INVOKE";e[e.CANCEL=7]="CANCEL";e[e.CLOSE=8]="CLOSE";e[e.OPEN_PORT=9]="OPEN_PORT"})(n.MessageType||(n.MessageType={}));var k=0;n.newJobId=function(){return k++};n.isTranferableResult=m;n.toInvokeError=function(e){return e?e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,
details:e.details,stack:e.stack}):null};n.postMessage=function(e,c,a,b){2===arguments.length||void 0===a&&void 0===b?e.postMessage(c):(u("esri-workers-supports-transfer-arraybuffer")||(b?(b=b.filter(function(f){return!(f instanceof ArrayBuffer)}),b.length||(b=null)):m(a)&&a.transferList&&(a.transferList=a.transferList.filter(function(f){return!(f instanceof ArrayBuffer)}),a.transferList.length||(a.transferList=null))),b?(c.data=a,e.postMessage(c,b)):m(a)?(c.data=a.result,a.transferList?e.postMessage(c,
a.transferList):e.postMessage(c)):(c.data=a,e.postMessage(c)))};n.receiveMessage=function(e){return e?(e=e.data)?"string"===typeof e?JSON.parse(e):e:null:null}})},"esri/layers/vectorTiles/core/workers/WorkerOwner":function(){define("require exports dojo/Deferred ../../kernel ../Error ../Logger ../promiseUtils ./utils ./workerFactory".split(" "),function(H,n,u,m,k,e,c,a,b){var f=e.getLogger("esri.core.workers"),g=a.MessageType.CANCEL,h=a.MessageType.INVOKE,d=a.MessageType.OPEN,l=a.MessageType.OPENED,
p=a.MessageType.RESPONSE;return function(){function v(r,w){this._outJobs=new Map;this._inJobs=new Map;this.worker=r;this.id=w;r.addEventListener("message",this._onMessage.bind(this));r.addEventListener("error",function(y){y.preventDefault();f.error(y)})}v.create=function(r){return b.createWorker().then(function(w){return new v(w,r)})};v.prototype.terminate=function(){this.worker.terminate()};v.prototype.open=function(r){var w=this,y=a.newJobId(),z=new u(function(E){w._outJobs["delete"](y);w._post({type:g,
jobId:y})});this._outJobs.set(y,z);this._post({type:d,jobId:y,modulePath:r});return z.promise};v.prototype._onMessage=function(r){if(r=a.receiveMessage(r))switch(r.type){case l:case p:this._onResponse(r);break;case g:this._onCancel(r);break;case h:this._onInvoke(r)}};v.prototype._onCancel=function(r){(r=this._inJobs.get(r.jobId))&&r.cancel()};v.prototype._onInvoke=function(r){var w=this,y=r.methodName,z=r.jobId;r=r.data;var E=this._inJobs,B=m.workerMessages[y];try{if("function"!==typeof B)throw new TypeError(y+
" is not a function");var C=B.call(null,r)}catch(G){this._post({type:p,jobId:z,error:a.toInvokeError(G)});return}c.isThenable(C)?(E.set(z,C),C.then(function(G){E["delete"](z);w._post({type:p,jobId:z},G)}).catch(function(G){E["delete"](z);G||(G={message:"Error encountered at method"+y});G.dojoType&&"cancel"===G.dojoType||w._post({type:p,jobId:z,error:a.toInvokeError(G)})})):this._post({type:p,jobId:z},C)};v.prototype._onResponse=function(r){var w=r.jobId,y=r.error;r=r.data;var z=this._outJobs.get(w);
z&&(this._outJobs["delete"](w),y?z.reject(k.fromJSON(JSON.parse(y))):z.resolve(r))};v.prototype._post=function(r,w,y){return a.postMessage(this.worker,r,w,y)};return v}()})},"esri/layers/vectorTiles/kernel":function(){define(["require","exports","esri/kernel","./identity/IdentityManager"],function(H,n,u,m){return function(){function k(){}Object.defineProperty(k,"id",{get:function(){return u.id?m:null},enumerable:!0,configurable:!0});k.workerMessages={};return k}()})},"esri/layers/vectorTiles/identity/IdentityManager":function(){define(["require",
"exports","esri/IdentityManager"],function(H,n,u){Object.defineProperty(n,"__esModule",{value:!0});n.findCredential=function(m){return u.findCredential(m)}})},"esri/IdentityManager":function(){define(["./IdentityManagerDialog","./kernel","./OAuthSignInHandler","dojo/_base/declare"],function(H,n,u,m){H=new H;n.id=m.safeMixin(H,u);return n.id})},"esri/IdentityManagerDialog":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/config dojo/_base/Deferred dojo/_base/lang dojo/has dojo/dom-attr dojo/keys dijit/registry dijit/Dialog ./kernel ./lang ./domUtils ./Credential ./IdentityManagerBase dojo/i18n!./nls/jsapi dojo/query dijit/form/Button dijit/form/Form dijit/form/ValidationTextBox".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v){n=n([p],{declaredClass:"esri.IdentityManager",_eventMap:{"dialog-cancel":["info"]},constructor:function(r){k.mixin(this,r);this.registerConnectEvents()},_dialogContent:"\x3cdiv data-dojo-type\x3d'dijit.form.Form' data-dojo-props\x3d'\"class\":\"esriIdForm\"'\x3e\x3cdiv class\x3d'dijitDialogPaneContentArea'\x3e\x3cdiv style\x3d'padding-bottom: 5px; word-wrap: break-word;'\x3e${info}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriErrorMsg' style\x3d'display: none; color: white; background-color: #D46464; text-align: center; padding-top: 3px; padding-bottom: 3px;'\x3e${invalidUser}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3ctable style\x3d'width: 100%;'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel\x3e${lblUser}\x3cbr/\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' data-dojo-props\x3d'type:\"text\", \"class\":\"esriIdUser\", required:true, trim:true, style:\"width: 100%;\", autocapitalize:\"none\", autocorrect:\"off\", spellcheck:false' /\x3e\x3c/label\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel\x3e${lblPwd}\x3cbr/\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' data-dojo-props\x3d'type:\"password\", \"class\":\"esriIdPwd\", required:true, style:\"width: 100%;\"' /\x3e\x3c/label\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitDialogPaneActionBar'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdSubmit\"'\x3e${lblOk}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdCancel\"'\x3e${lblCancel}\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e",
onDialogCreate:function(){},onDialogCancel:function(){},signIn:function(r,w,y){this._nls||(this._nls=v.identity);this._loginDialog||(this._loginDialog=this.dialog=this._createLoginDialog(),this.onDialogCreate());var z=this._loginDialog,E=y&&y.error,B=y&&y.token,C=new m(function(){z.onCancel()});if(z.open)return r=Error("BUSY"),r.name="identity-manager:busy",r.code="IdentityManager.1",r.log=!!u.isDebug,C.errback(r),C;d.hide(z.errMsg_);E&&403==E.code&&B&&(c.set(z.errMsg_,"innerHTML",this._nls.forbidden),
d.show(z.errMsg_));z.dfd_=C;z.serverInfo_=w;z.resUrl_=r;z.admin_=y&&y.isAdmin;c.set(z.resLink_,{title:r,innerHTML:"("+(this.getResourceName(r)||this._nls.lblItem)+")"});c.set(z.serverLink_,{title:w.server,innerHTML:(-1!==w.server.toLowerCase().indexOf("arcgis.com")?"ArcGIS Online":w.server)+" "});z.txtPwd_.set("value","");z.show();return C},_createLoginDialog:function(){var r=this._nls,w=h.substitute(r,this._dialogContent);w=h.substitute({resource:"\x3cspan class\x3d'resLink' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e",
server:"\x3cspan class\x3d'serverLink' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e"},w);var y=new f({title:r.title,content:w,"class":"esriSignInDialog",style:"width: 18em;",esriIdMgr_:this,keypressed_:function(z){z.charOrCode===a.ENTER&&this.execute_()},execute_:function(){var z=this.txtUser_.get("value"),E=this.txtPwd_.get("value"),B=this.dfd_,C=this;if(this.form_.validate()&&z&&E){this.btnSubmit_.set("label",r.lblSigning);var G=g.id.findCredential(C.resUrl_,z),I=function(D){C.btnSubmit_.set("label",
r.lblOk);C.btnSubmit_.set("disabled",!1);d.hide(C.errMsg_);C.hide();f._DialogLevelManager.hide(C);var q=C.serverInfo_;C.dfd_=C.serverInfo_=C.generateDfd_=C.resUrl_=null;var t=G;if(D){var A=D.token;var J=h.isDefined(D.expires)?Number(D.expires):null;var M=!!D.ssl;t?(t.userId=z,t.token=A,t.expires=J,t.validity=D.validity,t.ssl=M,t.creationTime=(new Date).getTime()):t=new l({userId:z,server:q.server,token:A,expires:J,ssl:M,isAdmin:C.admin_,validity:D.validity})}B.callback(t)};G&&!G._enqueued?I():(C.btnSubmit_.set("disabled",
!0),C.generateDfd_=g.id.generateToken(this.serverInfo_,{username:z,password:E},{isAdmin:this.admin_}).addCallback(I).addErrback(function(D){C.btnSubmit_.set("disabled",!1);C.generateDfd_=null;C.btnSubmit_.set("label",r.lblOk);c.set(C.errMsg_,"innerHTML",D&&D.code?r.invalidUser:r.noAuthService);d.show(C.errMsg_)}))}},cancel_:function(){y.generateDfd_&&y.generateDfd_.cancel();var z=y.dfd_,E=y.resUrl_,B=y.serverInfo_;y.btnSubmit_.set("disabled",!1);y.dfd_=y.serverInfo_=y.generateDfd_=y.resUrl_=null;
d.hide(y.errMsg_);f._DialogLevelManager.hide(y);y.esriIdMgr_.onDialogCancel({resourceUrl:E,serverInfo:B});E=Error("ABORTED");E.name="identity-manager:user-aborted";E.code="IdentityManager.2";E.log=!!u.isDebug;z.errback(E)}});w=y.domNode;y.form_=b.byNode(H.query(".esriIdForm",w)[0]);y.txtUser_=b.byNode(H.query(".esriIdUser",w)[0]);y.txtPwd_=b.byNode(H.query(".esriIdPwd",w)[0]);y.btnSubmit_=b.byNode(H.query(".esriIdSubmit",w)[0]);y.btnCancel_=b.byNode(H.query(".esriIdCancel",w)[0]);y.resLink_=H.query(".resLink",
w)[0];y.serverLink_=H.query(".serverLink",w)[0];y.errMsg_=H.query(".esriErrorMsg",w)[0];y.connect(y.txtUser_,"onKeyPress",y.keypressed_);y.connect(y.txtPwd_,"onKeyPress",y.keypressed_);y.connect(y.btnSubmit_,"onClick",y.execute_);y.connect(y.btnCancel_,"onClick",y.onCancel);y.connect(y,"onCancel",y.cancel_);return y}});e("extend-esri")&&(g.IdentityManagerDialog=g.IdentityManager=n);return n})},"dijit/Dialog":function(){define("require dojo/_base/array dojo/aspect dojo/_base/declare dojo/Deferred dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/ready dojo/sniff dojo/touch dojo/window dojo/dnd/Moveable dojo/dnd/TimedMoveable ./focus ./_base/manager ./_Widget ./_TemplatedMixin ./_CssStateMixin ./form/_FormMixin ./_DialogMixin ./DialogUnderlay ./layout/ContentPane ./layout/utils dojo/text!./templates/Dialog.html ./a11yclick dojo/i18n!./nls/common".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v,r,w,y,z,E,B,C,G,I,D,q,t,A,J,M){function N(){}var x=new k;x.resolve(!0);B=m("dijit._DialogBase"+(v("dojo-bidi")?"_NoBidi":""),[G,D,q,I],{templateString:M,baseClass:"dijitDialog",cssStateNodes:{closeButtonNode:"dijitDialogCloseIcon"},_setTitleAttr:{node:"titleNode",type:"innerHTML"},open:!1,duration:B.defaultDuration,refocus:!0,autofocus:!0,_firstFocusItem:null,_lastFocusItem:null,draggable:!0,_setDraggableAttr:function(P){this._set("draggable",P)},maxRatio:.9,
closable:!0,_setClosableAttr:function(P){this.closeButtonNode.style.display=P?"":"none";this._set("closable",P)},postMixInProperties:function(){var P=g.getLocalization("dijit","common");d.mixin(this,P);this.inherited(arguments)},postCreate:function(){b.set(this.domNode,{display:"none",position:"absolute"});this.ownerDocumentBody.appendChild(this.domNode);this.inherited(arguments);u.after(this,"onExecute",d.hitch(this,"hide"),!0);u.after(this,"onCancel",d.hitch(this,"hide"),!0);l(this.closeButtonNode,
r.press,function(P){P.stopPropagation()});this._modalconnects=[]},onLoad:function(){this.resize();this._position();this.autofocus&&L.isTop(this)&&(this._getFocusItems(),E.focus(this._firstFocusItem));this.inherited(arguments)},focus:function(){this._getFocusItems();E.focus(this._firstFocusItem)},_endDrag:function(){var P=a.position(this.domNode),S=w.getBox(this.ownerDocument);P.y=Math.min(Math.max(P.y,0),S.h-P.h);P.x=Math.min(Math.max(P.x,0),S.w-P.w);this._relativePosition=P;this._position()},_setup:function(){var P=
this.domNode;this.titleBar&&this.draggable?(this._moveable=new (6==v("ie")?z:y)(P,{handle:this.titleBar}),u.after(this._moveable,"onMoveStop",d.hitch(this,"_endDrag"),!0)):c.add(P,"dijitDialogFixed");this.underlayAttrs={dialogId:this.id,"class":n.map(this["class"].split(/\s/),function(S){return S+"_underlay"}).join(" "),_onKeyDown:d.hitch(this,"_onKey"),ownerDocument:this.ownerDocument}},_size:function(){this.resize()},_position:function(){if(!c.contains(this.ownerDocumentBody,"dojoMove")){var P=
this.domNode,S=w.getBox(this.ownerDocument),T=this._relativePosition,W=a.position(P);b.set(P,{left:Math.floor(S.l+(T?Math.min(T.x,S.w-W.w):(S.w-W.w)/2))+"px",top:Math.floor(S.t+(T?Math.min(T.y,S.h-W.h):(S.h-W.h)/2))+"px"})}},_onKey:function(P){if(P.keyCode==h.TAB){this._getFocusItems();var S=P.target;this._firstFocusItem==this._lastFocusItem?(P.stopPropagation(),P.preventDefault()):S==this._firstFocusItem&&P.shiftKey?(E.focus(this._lastFocusItem),P.stopPropagation(),P.preventDefault()):S!=this._lastFocusItem||
P.shiftKey||(E.focus(this._firstFocusItem),P.stopPropagation(),P.preventDefault())}else this.closable&&P.keyCode==h.ESCAPE&&(this.onCancel(),P.stopPropagation(),P.preventDefault())},show:function(){if(this.open)return x.promise;this._started||this.startup();this._alreadyInitialized||(this._setup(),this._alreadyInitialized=!0);this._fadeOutDeferred&&(this._fadeOutDeferred.cancel(),L.hide(this));var P=w.get(this.ownerDocument);this._modalconnects.push(l(P,"scroll",d.hitch(this,"resize",null)));this._modalconnects.push(l(this.domNode,
"keydown",d.hitch(this,"_onKey")));b.set(this.domNode,{opacity:0,display:""});this._set("open",!0);this._onShow();this.resize();this._position();this._fadeInDeferred=new k(d.hitch(this,function(){S.stop();delete this._fadeInDeferred}));this._fadeInDeferred.then(void 0,N);P=this._fadeInDeferred.promise;var S=f.fadeIn({node:this.domNode,duration:this.duration,beforeBegin:d.hitch(this,function(){L.show(this,this.underlayAttrs)}),onEnd:d.hitch(this,function(){this.autofocus&&L.isTop(this)&&(this._getFocusItems(),
E.focus(this._firstFocusItem));this._fadeInDeferred.resolve(!0);delete this._fadeInDeferred})}).play();return P},hide:function(){if(!this._alreadyInitialized||!this.open)return x.promise;this._fadeInDeferred&&this._fadeInDeferred.cancel();this._fadeOutDeferred=new k(d.hitch(this,function(){S.stop();delete this._fadeOutDeferred}));this._fadeOutDeferred.then(void 0,N);this._fadeOutDeferred.then(d.hitch(this,"onHide"));var P=this._fadeOutDeferred.promise;var S=f.fadeOut({node:this.domNode,duration:this.duration,
onEnd:d.hitch(this,function(){this.domNode.style.display="none";L.hide(this);this._fadeOutDeferred.resolve(!0);delete this._fadeOutDeferred})}).play();this._scrollConnected&&(this._scrollConnected=!1);for(var T;T=this._modalconnects.pop();)T.remove();this._relativePosition&&delete this._relativePosition;this._set("open",!1);return P},resize:function(P){if("none"!=this.domNode.style.display){this._checkIfSingleChild();if(!P){this._shrunk&&(this._singleChild&&"undefined"!=typeof this._singleChildOriginalStyle&&
(this._singleChild.domNode.style.cssText=this._singleChildOriginalStyle,delete this._singleChildOriginalStyle),n.forEach([this.domNode,this.containerNode,this.titleBar,this.actionBarNode],function(X){X&&b.set(X,{position:"static",width:"auto",height:"auto"})}),this.domNode.style.position="absolute");var S=w.getBox(this.ownerDocument);S.w*=this.maxRatio;S.h*=this.maxRatio;var T=a.position(this.domNode);this._shrunk=!1;T.w>=S.w&&(P={w:S.w},a.setMarginBox(this.domNode,P),T=a.position(this.domNode),this._shrunk=
!0);T.h>=S.h&&(P||(P={w:T.w}),P.h=S.h,this._shrunk=!0);P&&(P.w||(P.w=T.w),P.h||(P.h=T.h))}if(P){a.setMarginBox(this.domNode,P);S=[];this.titleBar&&S.push({domNode:this.titleBar,region:"top"});this.actionBarNode&&S.push({domNode:this.actionBarNode,region:"bottom"});T={domNode:this.containerNode,region:"center"};S.push(T);var W=J.marginBox2contentBox(this.domNode,P);J.layoutChildren(this.domNode,W,S);this._singleChild?(S=J.marginBox2contentBox(this.containerNode,T),this._singleChild.resize({w:S.w,h:S.h})):
(this.containerNode.style.overflow="auto",this._layoutChildren())}else this._layoutChildren();v("touch")||P||this._position()}},_layoutChildren:function(){n.forEach(this.getChildren(),function(P){P.resize&&P.resize()})},destroy:function(){this._fadeInDeferred&&this._fadeInDeferred.cancel();this._fadeOutDeferred&&this._fadeOutDeferred.cancel();this._moveable&&this._moveable.destroy();for(var P;P=this._modalconnects.pop();)P.remove();L.hide(this);this.inherited(arguments)}});v("dojo-bidi")&&(B=m("dijit._DialogBase",
B,{_setTitleAttr:function(P){this._set("title",P);this.titleNode.innerHTML=P;this.applyTextDir(this.titleNode)},_setTextDirAttr:function(P){this._created&&this.textDir!=P&&(this._set("textDir",P),this.set("title",this.title))}}));var F=m("dijit.Dialog",[A,B],{});F._DialogBase=B;var L=F._DialogLevelManager={_beginZIndex:950,show:function(P,S){O[O.length-1].focus=E.curNode;var T=O[O.length-1].dialog?O[O.length-1].zIndex+2:F._DialogLevelManager._beginZIndex;b.set(P.domNode,"zIndex",T);t.show(S,T-1);
O.push({dialog:P,underlayAttrs:S,zIndex:T})},hide:function(P){if(O[O.length-1].dialog==P){O.pop();var S=O[O.length-1];1==O.length?t.hide():t.show(S.underlayAttrs,S.zIndex-1);if(P.refocus&&(P=S.focus,!S.dialog||P&&e.isDescendant(P,S.dialog.domNode)||(S.dialog._getFocusItems(),P=S.dialog._firstFocusItem),P))try{P.focus()}catch(T){}}else S=n.indexOf(n.map(O,function(T){return T.dialog}),P),-1!=S&&O.splice(S,1)},isTop:function(P){return O[O.length-1].dialog==P}},O=F._dialogStack=[{dialog:null,focus:null,
underlayAttrs:null}];E.watch("curNode",function(P,S,T){P=O[O.length-1].dialog;if(T&&P&&!P._fadeOutDeferred&&T.ownerDocument==P.ownerDocument){do if(T==P.domNode||c.contains(T,"dijitPopup"))return;while(T=T.parentNode);P.focus()}});v("dijit-legacy-requires")&&p(0,function(){H(["dijit/TooltipDialog"])});return F})},"dojo/dnd/Moveable":function(){define("../_base/array ../_base/declare ../_base/lang ../dom ../dom-class ../Evented ../has ../on ../topic ../touch ./common ./Mover ../_base/window".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d){function l(r,w){"touchAction"in document.body.style?p="touchAction":"msTouchAction"in document.body.style&&(p="msTouchAction");v=function(y,z){y.style[p]=z};v(r,w)}var p,v=function(){};c("touch-action")&&(v=l);return n("dojo.dnd.Moveable",[e],{handle:"",delay:0,skip:!1,constructor:function(r,w){this.node=m.byId(r);v(this.node,"none");w||(w={});this.handle=w.handle?m.byId(w.handle):null;this.handle||(this.handle=this.node);this.delay=0<w.delay?w.delay:0;this.skip=
w.skip;this.mover=w.mover?w.mover:h;this.events=[a(this.handle,f.press,u.hitch(this,"onMouseDown")),a(this.handle,"dragstart",u.hitch(this,"onSelectStart")),a(this.handle,"selectstart",u.hitch(this,"onSelectStart"))]},markupFactory:function(r,w,y){return new y(w,r)},destroy:function(){H.forEach(this.events,function(r){r.remove()});v(this.node,"");this.events=this.node=this.handle=null},onMouseDown:function(r){if(!this.skip||!g.isFormElement(r)){if(this.delay)this.events.push(a(this.handle,f.move,
u.hitch(this,"onMouseMove")),a(this.handle.ownerDocument,f.release,u.hitch(this,"onMouseUp"))),this._lastX=r.pageX,this._lastY=r.pageY;else this.onDragDetected(r);r.stopPropagation();r.preventDefault()}},onMouseMove:function(r){if(Math.abs(r.pageX-this._lastX)>this.delay||Math.abs(r.pageY-this._lastY)>this.delay)this.onMouseUp(r),this.onDragDetected(r);r.stopPropagation();r.preventDefault()},onMouseUp:function(r){for(var w=0;2>w;++w)this.events.pop().remove();r.stopPropagation();r.preventDefault()},
onSelectStart:function(r){this.skip&&g.isFormElement(r)||(r.stopPropagation(),r.preventDefault())},onDragDetected:function(r){new this.mover(this.node,r,this)},onMoveStart:function(r){b.publish("/dnd/move/start",r);k.add(d.body(),"dojoMove");k.add(this.node,"dojoMoveItem")},onMoveStop:function(r){b.publish("/dnd/move/stop",r);k.remove(d.body(),"dojoMove");k.remove(this.node,"dojoMoveItem")},onFirstMove:function(){},onMove:function(r,w){this.onMoving(r,w);var y=r.node.style;y.left=w.l+"px";y.top=w.t+
"px";this.onMoved(r,w)},onMoving:function(){},onMoved:function(){}})})},"dojo/dnd/common":function(){define(["../sniff","../_base/kernel","../_base/lang","../dom"],function(H,n,u,m){var k=u.getObject("dojo.dnd",!0);k.getCopyKeyState=function(e){return e[H("mac")?"metaKey":"ctrlKey"]};k._uniqueId=0;k.getUniqueId=function(){do var e=n._scopeName+"Unique"+ ++k._uniqueId;while(m.byId(e));return e};k._empty={};k.isFormElement=function(e){e=e.target;3==e.nodeType&&(e=e.parentNode);return 0<=" a button textarea input select option ".indexOf(" "+
e.tagName.toLowerCase()+" ")};return k})},"dojo/dnd/Mover":function(){define("../_base/array ../_base/declare ../_base/lang ../sniff ../_base/window ../dom ../dom-geometry ../dom-style ../Evented ../on ../touch ./common ./autoscroll".split(" "),function(H,n,u,m,k,e,c,a,b,f,g,h,d){return n("dojo.dnd.Mover",[b],{constructor:function(l,p,v){function r(w){w.preventDefault();w.stopPropagation()}this.node=e.byId(l);this.marginBox={l:p.pageX,t:p.pageY};this.mouseButton=p.button;p=this.host=v;l=l.ownerDocument;
this.events=[f(l,g.move,u.hitch(this,"onFirstMove")),f(l,g.move,u.hitch(this,"onMouseMove")),f(l,g.release,u.hitch(this,"onMouseUp")),f(l,"dragstart",r),f(l.body,"selectstart",r)];d.autoScrollStart(l);if(p&&p.onMoveStart)p.onMoveStart(this)},onMouseMove:function(l){d.autoScroll(l);var p=this.marginBox;this.host.onMove(this,{l:p.l+l.pageX,t:p.t+l.pageY},l);l.preventDefault();l.stopPropagation()},onMouseUp:function(l){(m("webkit")&&m("mac")&&2==this.mouseButton?0==l.button:this.mouseButton==l.button)&&
this.destroy();l.preventDefault();l.stopPropagation()},onFirstMove:function(l){var p=this.node.style,v=this.host;switch(p.position){case "relative":case "absolute":var r=Math.round(parseFloat(p.left))||0;p=Math.round(parseFloat(p.top))||0;break;default:p.position="absolute";p=c.getMarginBox(this.node);r=k.doc.body;var w=a.getComputedStyle(r),y=c.getMarginBox(r,w);w=c.getContentBox(r,w);r=p.l-(w.l-y.l);p=p.t-(w.t-y.t)}this.marginBox.l=r-this.marginBox.l;this.marginBox.t=p-this.marginBox.t;if(v&&v.onFirstMove)v.onFirstMove(this,
l);this.events.shift().remove()},destroy:function(){H.forEach(this.events,function(p){p.remove()});var l=this.host;if(l&&l.onMoveStop)l.onMoveStop(this);this.events=this.node=this.host=null}})})},"dojo/dnd/autoscroll":function(){define("../_base/lang ../sniff ../_base/window ../dom-geometry ../dom-style ../window".split(" "),function(H,n,u,m,k,e){var c={};H.setObject("dojo.dnd.autoscroll",c);c.getViewport=e.getBox;c.V_TRIGGER_AUTOSCROLL=32;c.H_TRIGGER_AUTOSCROLL=32;c.V_AUTOSCROLL_VALUE=16;c.H_AUTOSCROLL_VALUE=
16;var a,b=u.doc,f=Infinity,g=Infinity;c.autoScrollStart=function(h){b=h;a=e.getBox(b);h=u.body(b).parentNode;f=Math.max(h.scrollHeight-a.h,0);g=Math.max(h.scrollWidth-a.w,0)};c.autoScroll=function(h){var d=a||e.getBox(b),l=u.body(b).parentNode,p=0,v=0;h.clientX<c.H_TRIGGER_AUTOSCROLL?p=-c.H_AUTOSCROLL_VALUE:h.clientX>d.w-c.H_TRIGGER_AUTOSCROLL&&(p=Math.min(c.H_AUTOSCROLL_VALUE,g-l.scrollLeft));h.clientY<c.V_TRIGGER_AUTOSCROLL?v=-c.V_AUTOSCROLL_VALUE:h.clientY>d.h-c.V_TRIGGER_AUTOSCROLL&&(v=Math.min(c.V_AUTOSCROLL_VALUE,
f-l.scrollTop));window.scrollBy(p,v)};c._validNodes={div:1,p:1,td:1};c._validOverflow={auto:1,scroll:1};c.autoScrollNodes=function(h){for(var d,l,p,v,r,w=0,y=0,z=h.target;z;){if(1==z.nodeType&&z.tagName.toLowerCase()in c._validNodes){p=k.getComputedStyle(z);r=p.overflowX.toLowerCase()in c._validOverflow;v=p.overflowY.toLowerCase()in c._validOverflow;if(r||v)d=m.getContentBox(z,p),l=m.position(z,!0);if(r){p=Math.min(c.H_TRIGGER_AUTOSCROLL,d.w/2);r=h.pageX-l.x;if(n("webkit")||n("opera"))r+=u.body().scrollLeft;
w=0;0<r&&r<d.w&&(r<p?w=-p:r>d.w-p&&(w=p),z.scrollLeft+=w)}if(v){v=Math.min(c.V_TRIGGER_AUTOSCROLL,d.h/2);p=h.pageY-l.y;if(n("webkit")||n("opera"))p+=u.body().scrollTop;y=0;0<p&&p<d.h&&(p<v?y=-v:p>d.h-v&&(y=v),z.scrollTop+=y)}if(w||y)return}try{z=z.parentNode}catch(E){z=null}}c.autoScroll(h)};return c})},"dojo/dnd/TimedMoveable":function(){define(["../_base/declare","./Moveable"],function(H,n){var u=n.prototype.onMove;return H("dojo.dnd.TimedMoveable",n,{timeout:40,constructor:function(m,k){k||(k=
{});k.timeout&&"number"==typeof k.timeout&&0<=k.timeout&&(this.timeout=k.timeout)},onMoveStop:function(m){m._timer&&(clearTimeout(m._timer),u.call(this,m,m._leftTop));n.prototype.onMoveStop.apply(this,arguments)},onMove:function(m,k){m._leftTop=k;if(!m._timer){var e=this;m._timer=setTimeout(function(){m._timer=null;u.call(e,m,m._leftTop)},this.timeout)}}})})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d){function l(){}function p(v){return function(r,w,y,z){return r&&"string"==typeof w&&r[w]==l?r.on(w.substring(2).toLowerCase(),c.hitch(y,z)):v.apply(u,arguments)}}H.around(u,"connect",p);e.connect&&H.around(e,"connect",p);H=m("dijit._Widget",[g,h,d],{onClick:l,onDblClick:l,onKeyDown:l,onKeyPress:l,onKeyUp:l,onMouseDown:l,onMouseMove:l,onMouseOut:l,onMouseOver:l,onMouseLeave:l,onMouseEnter:l,onMouseUp:l,constructor:function(v){this._toConnect={};for(var r in v)this[r]===
l&&(this._toConnect[r.replace(/^on/,"").toLowerCase()]=v[r],delete v[r])},postCreate:function(){this.inherited(arguments);for(var v in this._toConnect)this.on(v,this._toConnect[v]);delete this._toConnect},on:function(v,r){return this[this._onMap(v)]===l?u.connect(this.domNode,v.toLowerCase(),this,r):this.inherited(arguments)},_setFocusedAttr:function(v){this._focused=v;this._set("focused",v)},setAttribute:function(v,r){e.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(v,r)},attr:function(v,r){return 2<=arguments.length||"object"===typeof v?this.set.apply(this,arguments):this.get(v)},getDescendants:function(){e.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?a("[widgetId]",this.containerNode).map(f.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});k("dijit-legacy-requires")&&b(0,function(){require(["dijit/_base"])});
return H})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v,r,w,y,z,E,B,C){function G(D){return function(q){a[q?
"set":"remove"](this.domNode,D,q);this._set(D,q)}}d.add("dijit-legacy-requires",!l.isAsync);d.add("dojo-bidi",!1);d("dijit-legacy-requires")&&r(0,function(){H(["dijit/_base/manager"])});var I={};m=e("dijit._WidgetBase",[w,E],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:G("lang"),dir:"",_setDirAttr:G("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(D){this._set("ownerDocument",
D)},attributeMap:{},_blankGif:m.blankGif||H.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var D=this.constructor;if(!D._setterAttrs){var q=D.prototype,t=D._setterAttrs=[];D=D._onMap={};for(var A in q.attributeMap)t.push(A);for(A in q)/^on/.test(A)&&(D[A.substring(2).toLowerCase()]=A),/^_set[A-Z](.*)Attr$/.test(A)&&(A=A.charAt(4).toLowerCase()+A.substr(5,A.length-9),q.attributeMap&&A in q.attributeMap||t.push(A))}},postscript:function(D,q){this.create(D,q)},create:function(D,
q){this._introspect();this.srcNodeRef=c.byId(q);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);D&&(this.params=D,p.mixin(this,D));this.postMixInProperties();this.id||(this.id=C.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=z.body(this.ownerDocument);
C.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();if((D=this.srcNodeRef)&&D.parentNode&&this.domNode!==D){D.parentNode.replaceChild(this.domNode,D);var t=!0}this.domNode.setAttribute("widgetId",this.id)}this.postCreate();t&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var D={},q;for(q in this.params||{})D[q]=this._get(q);n.forEach(this.constructor._setterAttrs,function(t){if(!(t in D)){var A=this._get(t);A&&this.set(t,A)}},this);for(q in D)this.set(q,
D[q])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var D=this.baseClass.split(" ");this.isLeftToRight()||(D=D.concat(n.map(D,function(q){return q+"Rtl"})));b.add(this.domNode,D)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,n.forEach(this.getChildren(),function(D){D._started||D._destroyed||!p.isFunction(D.startup)||(D.startup(),D._started=!0)}))},
destroyRecursive:function(D){this._beingDestroyed=!0;this.destroyDescendants(D);this.destroy(D)},destroy:function(D){function q(t){t.destroyRecursive?t.destroyRecursive(D):t.destroy&&t.destroy(D)}this._beingDestroyed=!0;this.uninitialize();n.forEach(this._connects,p.hitch(this,"disconnect"));n.forEach(this._supportingWidgets,q);this.domNode&&n.forEach(C.findWidgets(this.domNode,this.containerNode),q);this.destroyRendering(D);C.remove(this.id);this._destroyed=!0},destroyRendering:function(D){this.bgIframe&&
(this.bgIframe.destroy(D),delete this.bgIframe);this.domNode&&(D?a.remove(this.domNode,"widgetId"):f.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(D||f.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(D){n.forEach(this.getChildren(),function(q){q.destroyRecursive&&q.destroyRecursive(D)})},uninitialize:function(){return!1},_setStyleAttr:function(D){var q=this.domNode;p.isObject(D)?h.set(q,D):q.style.cssText=q.style.cssText?q.style.cssText+("; "+D):D;this._set("style",
D)},_attrToDom:function(D,q,t){t=3<=arguments.length?t:this.attributeMap[D];n.forEach(p.isArray(t)?t:[t],function(A){var J=this[A.node||A||"domNode"];switch(A.type||"attribute"){case "attribute":p.isFunction(q)&&(q=p.hitch(this,q));A=A.attribute?A.attribute:/^on[A-Z][a-zA-Z]*$/.test(D)?D.toLowerCase():D;J.tagName?a.set(J,A,q):J.set(A,q);break;case "innerText":J.innerHTML="";J.appendChild(this.ownerDocument.createTextNode(q));break;case "textContent":J.textContent=q;break;case "innerHTML":J.innerHTML=
q;break;case "class":b.replace(J,q,this[D]);break;case "toggleClass":b.toggle(J,A.className||D,q)}},this)},get:function(D){var q=this._getAttrNames(D);return this[q.g]?this[q.g]():this._get(D)},set:function(D,q){if("object"===typeof D){for(var t in D)this.set(t,D[t]);return this}t=this._getAttrNames(D);var A=this[t.s];if(p.isFunction(A))var J=A.apply(this,Array.prototype.slice.call(arguments,1));else{A=this.focusNode&&!p.isFunction(this.focusNode)?"focusNode":"domNode";var M=this[A]&&this[A].tagName,
N;if((N=M)&&!(N=I[M])){N=this[A];var x={};for(F in N)x[F.toLowerCase()]=!0;N=I[M]=x}var F=N;t=D in this.attributeMap?this.attributeMap[D]:t.s in this?this[t.s]:F&&t.l in F&&"function"!=typeof q||/^aria-|^data-|^role$/.test(D)?A:null;null!=t&&this._attrToDom(D,q,t);this._set(D,q)}return J||this},_attrPairNames:{},_getAttrNames:function(D){var q=this._attrPairNames;if(q[D])return q[D];var t=D.replace(/^[a-z]|-[a-zA-Z]/g,function(A){return A.charAt(A.length-1).toUpperCase()});return q[D]={n:D+"Node",
s:"_set"+t+"Attr",g:"_get"+t+"Attr",l:t.toLowerCase()}},_set:function(D,q){var t=this[D];this[D]=q;!this._created||t===q||t!==t&&q!==q||(this._watchCallbacks&&this._watchCallbacks(D,t,q),this.emit("attrmodified-"+D,{detail:{prevValue:t,newValue:q}}))},_get:function(D){return this[D]},emit:function(D,q,t){q=q||{};void 0===q.bubbles&&(q.bubbles=!0);void 0===q.cancelable&&(q.cancelable=!0);q.detail||(q.detail={});q.detail.widget=this;var A,J=this["on"+D];J&&(A=J.apply(this,t?t:[q]));this._started&&!this._beingDestroyed&&
v.emit(this.domNode,D.toLowerCase(),q);return A},on:function(D,q){var t=this._onMap(D);return t?u.after(this,t,q,!0):this.own(v(this.domNode,D,q))[0]},_onMap:function(D){var q=this.constructor,t=q._onMap;if(!t){t=q._onMap={};for(var A in q.prototype)/^on/.test(A)&&(t[A.replace(/^on/,"").toLowerCase()]=A)}return t["string"==typeof D&&D.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?C.findWidgets(this.containerNode):
[]},getParent:function(){return C.getEnclosingWidget(this.domNode.parentNode)},connect:function(D,q,t){return this.own(k.connect(D,q,this,t))[0]},disconnect:function(D){D.remove()},subscribe:function(D,q){return this.own(y.subscribe(D,p.hitch(this,q)))[0]},unsubscribe:function(D){D.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():g.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=h.get(this.domNode,"display")},placeAt:function(D,q){var t=
!D.tagName&&C.byId(D);!t||!t.addChild||q&&"number"!==typeof q?(D=t&&"domNode"in t?t.containerNode&&!/after|before|replace/.test(q||"")?t.containerNode:t.domNode:c.byId(D,this.ownerDocument),f.place(this.domNode,D,q),!this._started&&(this.getParent()||{})._started&&this.startup()):t.addChild(this,q);return this},defer:function(D,q){var t=setTimeout(p.hitch(this,function(){t&&(t=null,this._destroyed||p.hitch(this,D)())}),q||0);return{remove:function(){t&&(clearTimeout(t),t=null);return null}}}});d("dojo-bidi")&&
m.extend(B);return m})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(H,n,u){return u("dijit.Destroyable",null,{destroy:function(m){this._destroyed=!0},own:function(){var m=["destroyRecursive","destroy","remove"];H.forEach(arguments,function(k){function e(){c.remove();H.forEach(a,function(f){f.remove()})}var c=n.before(this,"destroy",function(f){k[b](f)}),a=[];if(k.then){var b="cancel";k.then(e,e)}else H.forEach(m,function(f){"function"===typeof k[f]&&
(b||(b=f),a.push(n.after(k,f,e,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(H,n,u,m,k,e){H=m("dijit._OnDijitClickMixin",null,{connect:function(c,a,b){return this.inherited(arguments,[c,"ondijitclick"==a?e:a,b])}});H.a11yclick=e;return H})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(H,n,u,m){m.extend(n,
{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return u("dijit._FocusMixin",null,{_focusManager:H})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(H,n,u,m){u(function(){n("highcontrast")&&H.add(m.body(),"dijit_a11y")});return n})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(H,
n,u,m,k,e,c){k.add("highcontrast",function(){var a=c.doc.createElement("div");try{a.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(n.blankGif||H.toUrl("./resources/blank.gif"))+'");';c.body().appendChild(a);var b=m.getComputedStyle(a),f=b.backgroundImage;return b.borderTopColor==b.borderRightColor||f&&("none"==f||"url(invalid-url:)"==f)}catch(g){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
g.toString()),!1}finally{8>=k("ie")?a.outerHTML="":c.body().removeChild(a)}});e(function(){k("highcontrast")&&u.add(c.body(),"dj_a11y")});return k})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(H,n,u,m,k,e,c,a){var b=n("dijit._TemplatedMixin",a,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(f){var g=this.declaredClass,
h=this;return c.substitute(f,this,function(d,l){"!"==l.charAt(0)&&(d=m.getObject(l.substr(1),!1,h));if("undefined"==typeof d)throw Error(g+" template:"+l);return null==d?"":"!"==l.charAt(0)?d:this._escapeValue(""+d)},this)},_escapeValue:function(f){return f.replace(/["'<>&]/g,function(g){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[g]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=H(this.templatePath,{sanitize:!0}));
var f=b.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument);if(m.isString(f)){var g=u.toDom(this._stringRepl(f),this.ownerDocument);if(1!=g.nodeType)throw Error("Invalid template: "+f);}else g=f.cloneNode(!0);this.domNode=g}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(f){var g=this.containerNode;if(f&&g)for(;f.hasChildNodes();)g.appendChild(f.firstChild)}});b._templateCache={};b.getCachedTemplate=function(f,
g,h){var d=b._templateCache,l=f,p=d[l];if(p){try{if(!p.ownerDocument||p.ownerDocument==(h||document))return p}catch(v){}u.destroy(p)}f=c.trim(f);if(g||f.match(/\$\{([^\}]+)\}/g))return d[l]=f;g=u.toDom(f,h);if(1!=g.nodeType)throw Error("Invalid template: "+f);return d[l]=g};e("ie")&&k(window,"unload",function(){var f=b._templateCache,g;for(g in f){var h=f[g];"object"==typeof h&&u.destroy(h);delete f[g]}});return b})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(H){return H.cache})},
"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(H,n,u,m,k,e,c,a,b){var f=k.delegate(a,{mouseenter:e.enter,mouseleave:e.leave,keypress:u._keypress}),g;u=m("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},
_beforeFillContent:function(){},_attachTemplateNodes:function(h){for(var d=h;;)if(1==d.nodeType&&(this._processTemplateNode(d,function(l,p){return l.getAttribute(p)},this._attach)||this.searchContainerNode)&&d.firstChild)d=d.firstChild;else{if(d==h)break;for(;!d.nextSibling;)if(d=d.parentNode,d==h)return;d=d.nextSibling}},_processTemplateNode:function(h,d,l){var p=!0,v=this.attachScope||this,r=d(h,"dojoAttachPoint")||d(h,"data-dojo-attach-point");if(r)for(var w=r.split(/\s*,\s*/);r=w.shift();)k.isArray(v[r])?
v[r].push(h):v[r]=h,p="containerNode"!=r,this._attachPoints.push(r);if(d=d(h,"dojoAttachEvent")||d(h,"data-dojo-attach-event"))for(r=d.split(/\s*,\s*/),w=k.trim;d=r.shift();)if(d){var y=null;-1!=d.indexOf(":")?(y=d.split(":"),d=w(y[0]),y=w(y[1])):d=w(d);y||(y=d);this._attachEvents.push(l(h,d,k.hitch(v,y)))}return p},_attach:function(h,d,l){d=d.replace(/^on/,"").toLowerCase();d="dijitclick"==d?g||(g=H("./a11yclick")):f[d]||d;return c(h,d,l)},_detachTemplateNodes:function(){var h=this.attachScope||
this;n.forEach(this._attachPoints,function(d){delete h[d]});this._attachPoints=[];n.forEach(this._attachEvents,function(d){d.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});k.extend(b,{dojoAttachEvent:"",dojoAttachPoint:""});return u})},"dijit/_CssStateMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-class dojo/has dojo/_base/lang dojo/on dojo/domReady dojo/touch dojo/_base/window ./a11yclick ./registry".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h){n=n("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);H.forEach("disabled readOnly checked selected focused state hovering active _opened".split(" "),function(l){this.watch(l,e.hitch(this,"_setStateClass"))},this);for(var d in this.cssStateNodes||{})this._trackMouseState(this[d],this.cssStateNodes[d]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(d){if(!this.disabled)switch(d.type){case "mouseover":case "MSPointerOver":case "pointerover":this._set("hovering",
!0);this._set("active",this._mouseDown);break;case "mouseout":case "MSPointerOut":case "pointerout":this._set("hovering",!1);this._set("active",!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":this._set("active",!0);break;case "mouseup":case "dojotouchend":case "MSPointerUp":case "pointerup":case "keyup":this._set("active",!1)}},_setStateClass:function(){function d(y){l=l.concat(H.map(l,function(z){return z+y}),"dijit"+y)}var l=this.baseClass.split(" ");
this.isLeftToRight()||d("Rtl");var p="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&d(p);this.state&&d(this.state);this.selected&&d("Selected");this._opened&&d("Opened");this.disabled?d("Disabled"):this.readOnly?d("ReadOnly"):this.active?d("Active"):this.hovering&&d("Hover");this.focused&&d("Focused");p=this.stateNode||this.domNode;var v={};H.forEach(p.className.split(" "),function(y){v[y]=!0});"_stateClasses"in this&&H.forEach(this._stateClasses,function(y){delete v[y]});H.forEach(l,
function(y){v[y]=!0});var r=[],w;for(w in v)r.push(w);p.className=r.join(" ");this._stateClasses=l},_subnodeCssMouseEvent:function(d,l,p){function v(r){m.toggle(d,l+"Active",r)}if(!this.disabled&&!this.readOnly)switch(p.type){case "mouseover":case "MSPointerOver":case "pointerover":m.toggle(d,l+"Hover",!0);break;case "mouseout":case "MSPointerOut":case "pointerout":m.toggle(d,l+"Hover",!1);v(!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":v(!0);
break;case "mouseup":case "MSPointerUp":case "pointerup":case "dojotouchend":case "keyup":v(!1);break;case "focus":case "focusin":m.toggle(d,l+"Focused",!0);break;case "blur":case "focusout":m.toggle(d,l+"Focused",!1)}},_trackMouseState:function(d,l){d._cssState=l}});a(function(){function d(v,r,w){if(!w||!u.isDescendant(w,r))for(;r&&r!=w;r=r.parentNode)if(r._cssState){var y=h.getEnclosingWidget(r);y&&(r==y.domNode?y._cssMouseEvent(v):y._subnodeCssMouseEvent(r,r._cssState,v))}}var l=f.body(),p;c(l,
b.over,function(v){d(v,v.target,v.relatedTarget)});c(l,b.out,function(v){d(v,v.target,v.relatedTarget)});c(l,g.press,function(v){p=v.target;d(v,p)});c(l,g.release,function(v){d(v,p);p=null});c(l,"focusin, focusout",function(v){var r=v.target;if(r._cssState&&!r.getAttribute("widgetId")){var w=h.getEnclosingWidget(r);w&&w._subnodeCssMouseEvent(r,r._cssState,v)}})});return n})},"dijit/form/_FormMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/on dojo/window".split(" "),
function(H,n,u,m,k,e){return n("dijit.form._FormMixin",null,{state:"",_getDescendantFormWidgets:function(c){var a=[];H.forEach(c||this.getChildren(),function(b){"value"in b?a.push(b):a=a.concat(this._getDescendantFormWidgets(b.getChildren()))},this);return a},reset:function(){H.forEach(this._getDescendantFormWidgets(),function(c){c.reset&&c.reset()})},validate:function(){var c=!1;return H.every(H.map(this._getDescendantFormWidgets(),function(a){a._hasBeenBlurred=!0;var b=a.disabled||!a.validate||
a.validate();b||c||(e.scrollIntoView(a.containerNode||a.domNode),a.focus(),c=!0);return b}),function(a){return a})},setValues:function(c){u.deprecated(this.declaredClass+"::setValues() is deprecated. Use set('value', val) instead.","","2.0");return this.set("value",c)},_setValueAttr:function(c){var a={};H.forEach(this._getDescendantFormWidgets(),function(h){h.name&&(a[h.name]||(a[h.name]=[])).push(h)});for(var b in a)if(a.hasOwnProperty(b)){var f=a[b],g=m.getObject(b,!1,c);void 0!==g&&(g=[].concat(g),
"boolean"==typeof f[0].checked?H.forEach(f,function(h){h.set("value",-1!=H.indexOf(g,h._get("value")))}):f[0].multiple?f[0].set("value",g):H.forEach(f,function(h,d){h.set("value",g[d])}))}},getValues:function(){u.deprecated(this.declaredClass+"::getValues() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},_getValueAttr:function(){var c={};H.forEach(this._getDescendantFormWidgets(),function(a){var b=a.name;if(b&&!a.disabled){var f=a.get("value");"boolean"==typeof a.checked?
/Radio/.test(a.declaredClass)?!1!==f?m.setObject(b,f,c):(f=m.getObject(b,!1,c),void 0===f&&m.setObject(b,null,c)):(a=m.getObject(b,!1,c),a||(a=[],m.setObject(b,a,c)),!1!==f&&a.push(f)):(a=m.getObject(b,!1,c),"undefined"!=typeof a?m.isArray(a)?a.push(f):m.setObject(b,[a,f],c):m.setObject(b,f,c))}});return c},isValid:function(){return""==this.state},onValidStateChange:function(){},_getState:function(){var c=H.map(this._descendants,function(a){return a.get("state")||""});return 0<=H.indexOf(c,"Error")?
"Error":0<=H.indexOf(c,"Incomplete")?"Incomplete":""},disconnectChildren:function(){},connectChildren:function(c){this._descendants=this._getDescendantFormWidgets();H.forEach(this._descendants,function(a){a._started||a.startup()});c||this._onChildChange()},_onChildChange:function(c){c&&"state"!=c&&"disabled"!=c||this._set("state",this._getState());c&&"value"!=c&&"disabled"!=c&&"checked"!=c||(this._onChangeDelayTimer&&this._onChangeDelayTimer.remove(),this._onChangeDelayTimer=this.defer(function(){delete this._onChangeDelayTimer;
this._set("value",this.get("value"))},10))},startup:function(){this.inherited(arguments);this._descendants=this._getDescendantFormWidgets();this.value=this.get("value");this.state=this._getState();var c=this;this.own(k(this.containerNode,"attrmodified-state, attrmodified-disabled, attrmodified-value, attrmodified-checked",function(a){a.target!=c.domNode&&c._onChildChange(a.type.replace("attrmodified-",""))}));this.watch("state",function(a,b,f){this.onValidStateChange(""==f)})},destroy:function(){this.inherited(arguments)}})})},
"dijit/_DialogMixin":function(){define(["dojo/_base/declare","./a11y"],function(H,n){return H("dijit._DialogMixin",null,{actionBarTemplate:"",execute:function(){},onCancel:function(){},onExecute:function(){},_onSubmit:function(){this.onExecute();this.execute(this.get("value"))},_getFocusItems:function(){var u=n._getTabNavigable(this.domNode);this._firstFocusItem=u.lowest||u.first||this.closeButtonNode||this.domNode;this._lastFocusItem=u.last||u.highest||this._firstFocusItem}})})},"dijit/DialogUnderlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/dom-attr dojo/dom-style dojo/on dojo/window ./_Widget ./_TemplatedMixin ./BackgroundIframe ./Viewport ./main".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h){var d=H("dijit.DialogUnderlay",[a,b],{templateString:"\x3cdiv class\x3d'dijitDialogUnderlayWrapper'\x3e\x3cdiv class\x3d'dijitDialogUnderlay' tabIndex\x3d'-1' data-dojo-attach-point\x3d'node'\x3e\x3c/div\x3e\x3c/div\x3e",dialogId:"","class":"",_modalConnects:[],_setDialogIdAttr:function(l){m.set(this.node,"id",l+"_underlay");this._set("dialogId",l)},_setClassAttr:function(l){this.node.className="dijitDialogUnderlay "+l;this._set("class",l)},postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);
this.own(e(this.domNode,"keydown",n.hitch(this,"_onKeyDown")));this.inherited(arguments)},layout:function(){var l=this.node.style,p=this.domNode.style;p.display="none";var v=c.getBox(this.ownerDocument);p.top=v.t+"px";p.left=v.l+"px";l.width=v.w+"px";l.height=v.h+"px";p.display="block"},show:function(){this.domNode.style.display="block";this.open=!0;this.layout();this.bgIframe=new f(this.domNode);var l=c.get(this.ownerDocument);this._modalConnects=[g.on("resize",n.hitch(this,"layout")),e(l,"scroll",
n.hitch(this,"layout"))]},hide:function(){this.bgIframe.destroy();delete this.bgIframe;for(this.domNode.style.display="none";this._modalConnects.length;)this._modalConnects.pop().remove();this.open=!1},destroy:function(){for(;this._modalConnects.length;)this._modalConnects.pop().remove();this.inherited(arguments)},_onKeyDown:function(){}});d.show=function(l,p){var v=d._singleton;!v||v._destroyed?v=h._underlay=d._singleton=new d(l):l&&v.set(l);k.set(v.domNode,"zIndex",p);v.open||v.show()};d.hide=function(){var l=
d._singleton;l&&!l._destroyed&&l.hide()};return d})},"dijit/BackgroundIframe":function(){define("require ./main dojo/_base/config dojo/dom-construct dojo/dom-style dojo/_base/lang dojo/on dojo/sniff".split(" "),function(H,n,u,m,k,e,c,a){a.add("config-bgIframe",(a("ie")||a("trident"))&&!/IEMobile\/10\.0/.test(navigator.userAgent));var b=new function(){var f=[];this.pop=function(){if(f.length){var g=f.pop();g.style.display=""}else 9>a("ie")?(g=u.dojoBlankHtmlUrl||H.toUrl("dojo/resources/blank.html")||
'javascript:""',g=document.createElement("\x3ciframe src\x3d'"+g+"' role\x3d'presentation' style\x3d'position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity\x3d\"0\");'\x3e")):(g=m.create("iframe"),g.src='javascript:""',g.className="dijitBackgroundIframe",g.setAttribute("role","presentation"),k.set(g,"opacity",.1)),g.tabIndex=-1;return g};this.push=function(g){g.style.display="none";f.push(g)}};n.BackgroundIframe=function(f){if(!f.id)throw Error("no id");if(a("config-bgIframe")){var g=
this.iframe=b.pop();f.appendChild(g);7>a("ie")||a("quirks")?(this.resize(f),this._conn=c(f,"resize",e.hitch(this,"resize",f))):k.set(g,{width:"100%",height:"100%"})}};e.extend(n.BackgroundIframe,{resize:function(f){this.iframe&&k.set(this.iframe,{width:f.offsetWidth+"px",height:f.offsetHeight+"px"})},destroy:function(){this._conn&&(this._conn.remove(),this._conn=null);this.iframe&&(this.iframe.parentNode.removeChild(this.iframe),b.push(this.iframe),delete this.iframe)}});return n.BackgroundIframe})},
"dijit/Viewport":function(){define(["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],function(H,n,u,m,k){var e=new H,c;u(function(){var a=k.getBox();e._rlh=n(window,"resize",function(){var f=k.getBox();if(a.h!=f.h||a.w!=f.w)a=f,e.emit("resize")});if(8==m("ie")){var b=screen.deviceXDPI;setInterval(function(){screen.deviceXDPI!=b&&(b=screen.deviceXDPI,e.emit("resize"))},500)}m("ios")&&(n(document,"focusin",function(f){c=f.target}),n(document,"focusout",function(f){c=null}))});e.getEffectiveBox=
function(a){a=k.getBox(a);var b=c&&c.tagName&&c.tagName.toLowerCase();m("ios")&&c&&!c.readOnly&&("textarea"==b||"input"==b&&/^(color|email|number|password|search|tel|text|url)$/.test(c.type))&&(a.h*=0==orientation||180==orientation?.66:.4,b=c.getBoundingClientRect(),a.h=Math.max(a.h,b.top+b.height));return a};return e})},"dijit/layout/ContentPane":function(){define("dojo/_base/kernel dojo/_base/lang ../_Widget ../_Container ./_ContentPaneResizeMixin dojo/string dojo/html dojo/_base/array dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-construct dojo/_base/xhr dojo/i18n dojo/when dojo/i18n!../nls/loading".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v){return b("dijit.layout.ContentPane",[u,m,k],{href:"",content:"",extractContent:!1,parseOnLoad:!0,parserScope:H._scopeName,preventCache:!1,preload:!1,refreshOnShow:!1,loadingMessage:"\x3cspan class\x3d'dijitContentPaneLoading'\x3e\x3cspan class\x3d'dijitInline dijitIconLoading'\x3e\x3c/span\x3e${loadingState}\x3c/span\x3e",errorMessage:"\x3cspan class\x3d'dijitContentPaneError'\x3e\x3cspan class\x3d'dijitInline dijitIconError'\x3e\x3c/span\x3e${errorState}\x3c/span\x3e",
isLoaded:!1,baseClass:"dijitContentPane",ioArgs:{},onLoadDeferred:null,_setTitleAttr:null,stopParser:!0,template:!1,markupFactory:function(r,w,y){var z=new y(r,w);return!z.href&&z._contentSetter&&z._contentSetter.parseDeferred&&!z._contentSetter.parseDeferred.isFulfilled()?z._contentSetter.parseDeferred.then(function(){return z}):z},create:function(r,w){if(!(r&&r.template||!w||"href"in r||"content"in r)){w=g.byId(w);for(var y=w.ownerDocument.createDocumentFragment();w.firstChild;)y.appendChild(w.firstChild);
r=n.delegate(r,{content:y})}this.inherited(arguments,[r,w])},postMixInProperties:function(){this.inherited(arguments);var r=p.getLocalization("dijit","loading",this.lang);this.loadingMessage=e.substitute(this.loadingMessage,r);this.errorMessage=e.substitute(this.errorMessage,r)},buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.domNode.removeAttribute("title")},startup:function(){this.inherited(arguments);this._contentSetter&&a.forEach(this._contentSetter.parseResults,
function(r){r._started||r._destroyed||!n.isFunction(r.startup)||(r.startup(),r._started=!0)},this)},_startChildren:function(){a.forEach(this.getChildren(),function(r){r._started||r._destroyed||!n.isFunction(r.startup)||(r.startup(),r._started=!0)});this._contentSetter&&a.forEach(this._contentSetter.parseResults,function(r){r._started||r._destroyed||!n.isFunction(r.startup)||(r.startup(),r._started=!0)},this)},setHref:function(r){H.deprecated("dijit.layout.ContentPane.setHref() is deprecated. Use set('href', ...) instead.",
"","2.0");return this.set("href",r)},_setHrefAttr:function(r){this.cancel();this.onLoadDeferred=new f(n.hitch(this,"cancel"));this.onLoadDeferred.then(n.hitch(this,"onLoad"));this._set("href",r);this.preload||this._created&&this._isShown()?this._load():this._hrefChanged=!0;return this.onLoadDeferred},setContent:function(r){H.deprecated("dijit.layout.ContentPane.setContent() is deprecated.  Use set('content', ...) instead.","","2.0");this.set("content",r)},_setContentAttr:function(r){this._set("href",
"");this.cancel();this.onLoadDeferred=new f(n.hitch(this,"cancel"));this._created&&this.onLoadDeferred.then(n.hitch(this,"onLoad"));this._setContent(r||"");this._isDownloaded=!1;return this.onLoadDeferred},_getContentAttr:function(){return this.containerNode.innerHTML},cancel:function(){this._xhrDfd&&-1==this._xhrDfd.fired&&this._xhrDfd.cancel();delete this._xhrDfd;this.onLoadDeferred=null},destroy:function(){this.cancel();this.inherited(arguments)},destroyRecursive:function(r){this._beingDestroyed||
this.inherited(arguments)},_onShow:function(){this.inherited(arguments);if(this.href&&!this._xhrDfd&&(!this.isLoaded||this._hrefChanged||this.refreshOnShow))return this.refresh()},refresh:function(){this.cancel();this.onLoadDeferred=new f(n.hitch(this,"cancel"));this.onLoadDeferred.then(n.hitch(this,"onLoad"));this._load();return this.onLoadDeferred},_load:function(){this._setContent(this.onDownloadStart(),!0);var r=this,w={preventCache:this.preventCache||this.refreshOnShow,url:this.href,handleAs:"text"};
n.isObject(this.ioArgs)&&n.mixin(w,this.ioArgs);var y=this._xhrDfd=(this.ioMethod||l.get)(w),z;y.then(function(E){z=E;try{return r._isDownloaded=!0,r._setContent(E,!1)}catch(B){r._onError("Content",B)}},function(E){y.canceled||r._onError("Download",E);delete r._xhrDfd;return E}).then(function(){r.onDownloadEnd();delete r._xhrDfd;return z});delete this._hrefChanged},_onLoadHandler:function(r){this._set("isLoaded",!0);try{this.onLoadDeferred.resolve(r)}catch(w){console.error("Error "+(this.widgetId||
this.id)+" running custom onLoad code: "+w.message)}},_onUnloadHandler:function(){this._set("isLoaded",!1);try{this.onUnload()}catch(r){console.error("Error "+this.widgetId+" running custom onUnload code: "+r.message)}},destroyDescendants:function(r){this.isLoaded&&this._onUnloadHandler();var w=this._contentSetter;a.forEach(this.getChildren(),function(y){y.destroyRecursive?y.destroyRecursive(r):y.destroy&&y.destroy(r);y._destroyed=!0});w&&(a.forEach(w.parseResults,function(y){y._destroyed||(y.destroyRecursive?
y.destroyRecursive(r):y.destroy&&y.destroy(r),y._destroyed=!0)}),delete w.parseResults);r||d.empty(this.containerNode);delete this._singleChild},_setContent:function(r,w){r=this.preprocessContent(r);this.destroyDescendants();var y=this._contentSetter;y&&y instanceof c._ContentSetter||(y=this._contentSetter=new c._ContentSetter({node:this.containerNode,_onError:n.hitch(this,this._onError),onContentError:n.hitch(this,function(B){B=this.onContentError(B);try{this.containerNode.innerHTML=B}catch(C){console.error("Fatal "+
this.id+" could not change content due to "+C.message,C)}})}));var z=n.mixin({cleanContent:this.cleanContent,extractContent:this.extractContent,parseContent:!r.domNode&&this.parseOnLoad,parserScope:this.parserScope,startup:!1,dir:this.dir,lang:this.lang,textDir:this.textDir},this._contentSetterParams||{});z=y.set(n.isObject(r)&&r.domNode?r.domNode:r,z);var E=this;return v(z&&z.then?z:y.parseDeferred,function(){delete E._contentSetterParams;w||(E._started&&(E._startChildren(),E._scheduleLayout()),
E._onLoadHandler(r))})},preprocessContent:function(r){return r},_onError:function(r,w,y){this.onLoadDeferred.reject(w);r=this["on"+r+"Error"].call(this,w);y?console.error(y,w):r&&this._setContent(r,!0)},onLoad:function(){},onUnload:function(){},onDownloadStart:function(){return this.loadingMessage},onContentError:function(){},onDownloadError:function(){return this.errorMessage},onDownloadEnd:function(){}})})},"dijit/_Container":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct",
"dojo/_base/kernel"],function(H,n,u,m){return n("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode)},addChild:function(k,e){var c=this.containerNode;if(0<e){for(c=c.firstChild;0<e;)1==c.nodeType&&e--,c=c.nextSibling;c?e="before":(c=this.containerNode,e="last")}u.place(k.domNode,c,e);this._started&&!k._started&&k.startup()},removeChild:function(k){"number"==typeof k&&(k=this.getChildren()[k]);k&&(k=k.domNode)&&k.parentNode&&
k.parentNode.removeChild(k)},hasChildren:function(){return 0<this.getChildren().length},_getSiblingOfChild:function(k,e){var c=this.getChildren();k=H.indexOf(c,k);return c[k+e]},getIndexOfChild:function(k){return H.indexOf(this.getChildren(),k)}})})},"dijit/layout/_ContentPaneResizeMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/query ../registry ../Viewport ./utils".split(" "),function(H,n,u,m,k,e,c,a,b,f){return n("dijit.layout._ContentPaneResizeMixin",
null,{doLayout:!0,isLayoutContainer:!0,startup:function(){if(!this._started){var g=this.getParent();this._childOfLayoutWidget=g&&g.isLayoutContainer;this._needLayout=!this._childOfLayoutWidget;this.inherited(arguments);this._isShown()&&this._onShow();this._childOfLayoutWidget||this.own(b.on("resize",e.hitch(this,"resize")))}},_checkIfSingleChild:function(){if(this.doLayout){var g=[],h=!1;c("\x3e *",this.containerNode).some(function(d){var l=a.byNode(d);l&&l.resize?g.push(l):!/script|link|style/i.test(d.nodeName)&&
d.offsetHeight&&(h=!0)});this._singleChild=1!=g.length||h?null:g[0];u.toggle(this.containerNode,this.baseClass+"SingleChild",!!this._singleChild)}},resize:function(g,h){this._resizeCalled=!0;this._scheduleLayout(g,h)},_scheduleLayout:function(g,h){this._isShown()?this._layout(g,h):(this._needLayout=!0,this._changeSize=g,this._resultSize=h)},_layout:function(g,h){delete this._needLayout;this._wasShown||!1===this.open||this._onShow();g&&m.setMarginBox(this.domNode,g);var d=this.containerNode;d===this.domNode?
(h=h||{},e.mixin(h,g||{}),"h"in h&&"w"in h||(h=e.mixin(m.getMarginBox(d),h)),this._contentBox=f.marginBox2contentBox(d,h)):this._contentBox=m.getContentBox(d);this._layoutChildren()},_layoutChildren:function(){this._checkIfSingleChild();if(this._singleChild&&this._singleChild.resize){var g=this._contentBox||m.getContentBox(this.containerNode);this._singleChild.resize({w:g.w,h:g.h})}else{g=this.getChildren();for(var h,d=0;h=g[d++];)h.resize&&h.resize()}},_isShown:function(){if(this._childOfLayoutWidget)return this._resizeCalled&&
"open"in this?this.open:this._resizeCalled;if("open"in this)return this.open;var g=this.domNode,h=this.domNode.parentNode;return"none"!=g.style.display&&"hidden"!=g.style.visibility&&!u.contains(g,"dijitHidden")&&h&&h.style&&"none"!=h.style.display},_onShow:function(){this._wasShown=!0;this._needLayout&&this._layout(this._changeSize,this._resultSize);this.inherited(arguments)}})})},"dijit/layout/utils":function(){define(["dojo/_base/array","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/lang"],
function(H,n,u,m,k){function e(b){return b.substring(0,1).toUpperCase()+b.substring(1)}function c(b,f){var g=b.resize?b.resize(f):u.setMarginBox(b.domNode,f);g?k.mixin(b,g):(k.mixin(b,u.getMarginBox(b.domNode)),k.mixin(b,f))}var a={marginBox2contentBox:function(b,f){var g=m.getComputedStyle(b),h=u.getMarginExtents(b,g),d=u.getPadBorderExtents(b,g);return{l:m.toPixelValue(b,g.paddingLeft),t:m.toPixelValue(b,g.paddingTop),w:f.w-(h.w+d.w),h:f.h-(h.h+d.h)}},layoutChildren:function(b,f,g,h,d){f=k.mixin({},
f);n.add(b,"dijitLayoutContainer");g=H.filter(g,function(l){return"center"!=l.region&&"client"!=l.layoutAlign}).concat(H.filter(g,function(l){return"center"==l.region||"client"==l.layoutAlign}));H.forEach(g,function(l){var p=l.domNode,v=l.region||l.layoutAlign;if(!v)throw Error("No region setting for "+l.id);var r=p.style;r.left=f.l+"px";r.top=f.t+"px";r.position="absolute";n.add(p,"dijitAlign"+e(v));p={};h&&h==l.id&&(p["top"==l.region||"bottom"==l.region?"h":"w"]=d);"leading"==v&&(v=l.isLeftToRight()?
"left":"right");"trailing"==v&&(v=l.isLeftToRight()?"right":"left");"top"==v||"bottom"==v?(p.w=f.w,c(l,p),f.h-=l.h,"top"==v?f.t+=l.h:r.top=f.t+f.h+"px"):"left"==v||"right"==v?(p.h=f.h,c(l,p),f.w-=l.w,"left"==v?f.l+=l.w:r.left=f.l+f.w+"px"):"client"!=v&&"center"!=v||c(l,f)})}};k.setObject("dijit.layout.utils",a);return a})},"dojo/html":function(){define("./_base/kernel ./_base/lang ./_base/array ./_base/declare ./dom ./dom-construct ./parser".split(" "),function(H,n,u,m,k,e,c){var a=0,b={_secureForInnerHtml:function(f){return f.replace(/(?:\s*<!DOCTYPE\s[^>]+>|<title[^>]*>[\s\S]*?<\/title>)/ig,
"")},_emptyNode:e.empty,_setNodeContent:function(f,g){e.empty(f);if(g)if("number"==typeof g&&(g=g.toString()),"string"==typeof g&&(g=e.toDom(g,f.ownerDocument)),!g.nodeType&&n.isArrayLike(g))for(var h=g.length,d=0;d<g.length;d=h==g.length?d+1:0)e.place(g[d],f,"last");else e.place(g,f,"last");return f},_ContentSetter:m("dojo.html._ContentSetter",null,{node:"",content:"",id:"",cleanContent:!1,extractContent:!1,parseContent:!1,parserScope:H._scopeName,startup:!0,constructor:function(f,g){n.mixin(this,
f||{});g=this.node=k.byId(this.node||g);this.id||(this.id=["Setter",g?g.id||g.tagName:"",a++].join("_"))},set:function(f,g){void 0!==f&&(this.content=f);"number"==typeof f&&(f=f.toString());g&&this._mixin(g);this.onBegin();this.setContent();return(f=this.onEnd())&&f.then?f:this.node},setContent:function(){var f=this.node;if(!f)throw Error(this.declaredClass+": setContent given no node");try{f=b._setNodeContent(f,this.content)}catch(h){var g=this.onContentError(h);try{f.innerHTML=g}catch(d){console.error("Fatal "+
this.declaredClass+".setContent could not change content due to "+d.message,d)}}this.node=f},empty:function(){this.parseDeferred&&(this.parseDeferred.isResolved()||this.parseDeferred.cancel(),delete this.parseDeferred);this.parseResults&&this.parseResults.length&&(u.forEach(this.parseResults,function(f){f.destroy&&f.destroy()}),delete this.parseResults);e.empty(this.node)},onBegin:function(){var f=this.content;if(n.isString(f)&&(this.cleanContent&&(f=b._secureForInnerHtml(f)),this.extractContent)){var g=
f.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);g&&(f=g[1])}this.empty();this.content=f;return this.node},onEnd:function(){this.parseContent&&this._parse();return this.node},tearDown:function(){delete this.parseResults;delete this.parseDeferred;delete this.node;delete this.content},onContentError:function(f){return"Error occurred setting content: "+f},onExecError:function(f){return"Error occurred executing scripts: "+f},_mixin:function(f){var g={},h;for(h in f)h in g||(this[h]=f[h])},_parse:function(){var f=
this.node;try{var g={};u.forEach(["dir","lang","textDir"],function(d){this[d]&&(g[d]=this[d])},this);var h=this;this.parseDeferred=c.parse({rootNode:f,noStart:!this.startup,inherited:g,scope:this.parserScope}).then(function(d){return h.parseResults=d},function(d){h._onError("Content",d,"Error parsing in _ContentSetter#"+h.id)})}catch(d){this._onError("Content",d,"Error parsing in _ContentSetter#"+this.id)}},_onError:function(f,g,h){f=this["on"+f+"Error"].call(this,g);h?console.error(h,g):f&&b._setNodeContent(this.node,
f,!0)}}),set:function(f,g,h){void 0==g&&(console.warn("dojo.html.set: no cont argument provided, using empty string"),g="");"number"==typeof g&&(g=g.toString());return h?(new b._ContentSetter(n.mixin(h,{content:g,node:f}))).set():b._setNodeContent(f,g,!0)}};n.setObject("dojo.html",b);return b})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v){function r(B){return eval("("+B+")")}function w(B){var C=B._nameCaseMap,G=B.prototype;if(!C||C._extendCnt<z){C=B._nameCaseMap={};for(var I in G)"_"!==I.charAt(0)&&(C[I.toLowerCase()]=I);C._extendCnt=z}return C}function y(B,C){C||(C=H);var G=C._dojoParserCtorMap||(C._dojoParserCtorMap={}),I=B.join();if(!G[I]){for(var D=[],q=0,t=B.length;q<t;q++){var A=B[q];D[D.length]=G[A]=G[A]||u.getObject(A)||~A.indexOf("/")&&C(A)}B=D.shift();G[I]=D.length?B.createSubclass?
B.createSubclass(D):B.extend.apply(B,D):B}return G[I]}new Date("X");var z=0;b.after(u,"extend",function(){z++},!0);var E={_clearCache:function(){z++;_ctorMap={}},_functionFromScript:function(B,C){var G="",I="",D=B.getAttribute(C+"args")||B.getAttribute("args");C=B.getAttribute("with");D=(D||"").split(/\s*,\s*/);C&&C.length&&m.forEach(C.split(/\s*,\s*/),function(q){G+="with("+q+"){";I+="}"});return new Function(D,G+B.innerHTML+I)},instantiate:function(B,C,G){C=C||{};G=G||{};var I=(G.scope||n._scopeName)+
"Type",D="data-"+(G.scope||n._scopeName)+"-",q=D+"type",t=D+"mixins",A=[];m.forEach(B,function(J){var M=I in C?C[I]:J.getAttribute(q)||J.getAttribute(I);if(M){var N=J.getAttribute(t);M=N?[M].concat(N.split(/\s*,\s*/)):[M];A.push({node:J,types:M})}});return this._instantiate(A,C,G)},_instantiate:function(B,C,G,I){function D(q){C._started||G.noStart||m.forEach(q,function(t){"function"!==typeof t.startup||t._started||t.startup()});return q}B=m.map(B,function(q){var t=q.ctor||y(q.types,G.contextRequire);
if(!t)throw Error("Unable to resolve constructor for: '"+q.types.join()+"'");return this.construct(t,q.node,C,G,q.scripts,q.inherited)},this);return I?f(B).then(D):D(B)},construct:function(B,C,G,I,D,q){function t(Q){O&&u.setObject(O,Q);for(F=0;F<W.length;F++)b[W[F].advice||"after"](Q,W[F].method,u.hitch(Q,W[F].func),!0);for(F=0;F<X.length;F++)X[F].call(Q);for(F=0;F<K.length;F++)Q.watch(K[F].prop,K[F].func);for(F=0;F<R.length;F++)p(Q,R[F].event,R[F].func);return Q}var A=B&&B.prototype;I=I||{};var J=
{};I.defaults&&u.mixin(J,I.defaults);q&&u.mixin(J,q);if(d("dom-attributes-explicit"))var M=C.attributes;else d("dom-attributes-specified-flag")?M=m.filter(C.attributes,function(Q){return Q.specified}):(q=(/^input$|^img$/i.test(C.nodeName)?C:C.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),M=m.map(q.split(/\s+/),function(Q){var U=Q.toLowerCase();return{name:Q,value:"LI"==C.nodeName&&"value"==Q||"enctype"==U?C.getAttribute(U):
C.getAttributeNode(U).value}}));var N=I.scope||n._scopeName;q="data-"+N+"-";var x={};"dojo"!==N&&(x[q+"props"]="data-dojo-props",x[q+"type"]="data-dojo-type",x[q+"mixins"]="data-dojo-mixins",x[N+"type"]="dojotype",x[q+"id"]="data-dojo-id");var F=0,L;N=[];for(var O,P;L=M[F++];){var S=L.name,T=S.toLowerCase();L=L.value;switch(x[T]||T){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":P=L;break;case "data-dojo-id":case "jsid":O=L;break;case "data-dojo-attach-point":case "dojoattachpoint":J.dojoAttachPoint=
L;break;case "data-dojo-attach-event":case "dojoattachevent":J.dojoAttachEvent=L;break;case "class":J["class"]=C.className;break;case "style":J.style=C.style&&C.style.cssText;break;default:if(S in A||(S=w(B)[T]||S),S in A)switch(typeof A[S]){case "string":J[S]=L;break;case "number":J[S]=L.length?Number(L):NaN;break;case "boolean":J[S]="false"!=L.toLowerCase();break;case "function":""===L||-1!=L.search(/[^\w\.]+/i)?J[S]=new Function(L):J[S]=u.getObject(L,!1)||new Function(L);N.push(S);break;default:T=
A[S],J[S]=T&&"length"in T?L?L.split(/\s*,\s*/):[]:T instanceof Date?""==L?new Date(""):"now"==L?new Date:g.fromISOString(L):T instanceof a?n.baseUrl+L:r(L)}else J[S]=L}}for(M=0;M<N.length;M++)x=N[M].toLowerCase(),C.removeAttribute(x),C[x]=null;if(P)try{P=r.call(I.propsThis,"{"+P+"}"),u.mixin(J,P)}catch(Q){throw Error(Q.toString()+" in data-dojo-props\x3d'"+P+"'");}u.mixin(J,G);D||(D=B&&(B._noScript||A._noScript)?[]:l("\x3e script[type^\x3d'dojo/']",C));var W=[],X=[],K=[],R=[];if(D)for(F=0;F<D.length;F++)x=
D[F],C.removeChild(x),G=x.getAttribute(q+"event")||x.getAttribute("event"),I=x.getAttribute(q+"prop"),P=x.getAttribute(q+"method"),N=x.getAttribute(q+"advice"),M=x.getAttribute("type"),x=this._functionFromScript(x,q),G?"dojo/connect"==M?W.push({method:G,func:x}):"dojo/on"==M?R.push({event:G,func:x}):J[G]=x:"dojo/aspect"==M?W.push({method:P,advice:N,func:x}):"dojo/watch"==M?K.push({prop:I,func:x}):X.push(x);B=(D=B.markupFactory||A.markupFactory)?D(J,C,B):new B(J,C);return B.then?B.then(t):t(B)},scan:function(B,
C){function G(T){if(!T.inherited){T.inherited={};var W=T.node,X=G(T.parent);W={dir:W.getAttribute("dir")||X.dir,lang:W.getAttribute("lang")||X.lang,textDir:W.getAttribute(M)||X.textDir};for(var K in W)W[K]&&(T.inherited[K]=W[K])}return T.inherited}var I=[],D=[],q={},t=(C.scope||n._scopeName)+"Type",A="data-"+(C.scope||n._scopeName)+"-",J=A+"type",M=A+"textdir";A+="mixins";var N=B.firstChild,x=C.inherited;if(!x){x=function K(W,X){return W.getAttribute&&W.getAttribute(X)||W.parentNode&&K(W.parentNode,
X)};x={dir:x(B,"dir"),lang:x(B,"lang"),textDir:x(B,M)};for(var F in x)x[F]||delete x[F]}F={inherited:x};for(var L,O;;)if(N)if(1!=N.nodeType)N=N.nextSibling;else if(L&&"script"==N.nodeName.toLowerCase())(x=N.getAttribute("type"))&&/^dojo\/\w/i.test(x)&&L.push(N),N=N.nextSibling;else if(O)N=N.nextSibling;else if(x=N.getAttribute(J)||N.getAttribute(t),B=N.firstChild,x||B&&(3!=B.nodeType||B.nextSibling)){O=null;if(x){var P=N.getAttribute(A);L=P?[x].concat(P.split(/\s*,\s*/)):[x];try{O=y(L,C.contextRequire)}catch(T){}O||
m.forEach(L,function(T){~T.indexOf("/")&&!q[T]&&(q[T]=!0,D[D.length]=T)});P=O&&!O.prototype._noScript?[]:null;F={types:L,ctor:O,parent:F,node:N,scripts:P};F.inherited=G(F);I.push(F)}else F={node:N,scripts:L,parent:F};L=P;O=N.stopParser||O&&O.prototype.stopParser&&!C.template;N=B}else N=N.nextSibling;else{if(!F||!F.node)break;N=F.node.nextSibling;O=!1;F=F.parent;L=F.scripts}var S=new h;D.length?(d("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+D.join(", ")),(C.contextRequire||
H)(D,function(){S.resolve(m.filter(I,function(T){if(!T.ctor)try{T.ctor=y(T.types,C.contextRequire)}catch(K){}for(var W=T.parent;W&&!W.types;)W=W.parent;var X=T.ctor&&T.ctor.prototype;T.instantiateChildren=!(X&&X.stopParser&&!C.template);T.instantiate=!W||W.instantiate&&W.instantiateChildren;return T.instantiate}))})):S.resolve(I);return S.promise},_require:function(B,C){B=r("{"+B.innerHTML+"}");var G=[],I=[],D=new h;C=C&&C.contextRequire||H;for(var q in B)G.push(q),I.push(B[q]);C(I,function(){for(var t=
0;t<G.length;t++)u.setObject(G[t],arguments[t]);D.resolve(arguments)});return D.promise},_scanAmd:function(B,C){var G=new h,I=G.promise;G.resolve(!0);var D=this;l("script[type\x3d'dojo/require']",B).forEach(function(q){I=I.then(function(){return D._require(q,C)});q.parentNode.removeChild(q)});return I},parse:function(B,C){!B||"string"==typeof B||"nodeType"in B||(C=B,B=C.rootNode);var G=B?e.byId(B):c.body();C=C||{};var I=C.template?{template:!0}:{},D=[],q=this;B=this._scanAmd(G,C).then(function(){return q.scan(G,
C)}).then(function(t){return q._instantiate(t,I,C,!0)}).then(function(t){return D=D.concat(t)}).otherwise(function(t){console.error("dojo/parser::parse() error",t);throw t;});u.mixin(D,B);return D}};n.parser=E;k.parseOnLoad&&v(100,E,"parse");return E})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(H,n){var u={};H.setObject("dojo.date.stamp",u);u.fromISOString=function(m,k){u._isoRegExp||(u._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);
var e=u._isoRegExp.exec(m);m=null;if(e){e.shift();e[1]&&e[1]--;e[6]&&(e[6]*=1E3);k&&(k=new Date(k),n.forEach(n.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(b){return k["get"+b]()}),function(b,f){e[f]=e[f]||b}));m=new Date(e[0]||1970,e[1]||0,e[2]||1,e[3]||0,e[4]||0,e[5]||0,e[6]||0);100>e[0]&&m.setFullYear(e[0]||1970);var c=0,a=e[7]&&e[7].charAt(0);"Z"!=a&&(c=60*(e[8]||0)+(Number(e[9])||0),"-"!=a&&(c*=-1));a&&(c-=m.getTimezoneOffset());c&&m.setTime(m.getTime()+6E4*
c)}return m};u.toISOString=function(m,k){var e=function(f){return 10>f?"0"+f:f};k=k||{};var c=[],a=k.zulu?"getUTC":"get",b="";"time"!=k.selector&&(b=m[a+"FullYear"](),b=["0000".substr((b+"").length)+b,e(m[a+"Month"]()+1),e(m[a+"Date"]())].join("-"));c.push(b);"date"!=k.selector&&(b=[e(m[a+"Hours"]()),e(m[a+"Minutes"]()),e(m[a+"Seconds"]())].join(":"),a=m[a+"Milliseconds"](),k.milliseconds&&(b+="."+(100>a?"0":"")+e(a)),k.zulu?b+="Z":"time"!=k.selector&&(m=m.getTimezoneOffset(),k=Math.abs(m),b+=(0<
m?"-":"+")+e(Math.floor(k/60))+":"+e(k%60)),c.push(b));return c.join("T")};return u})},"esri/Credential":function(){define(["dojo/_base/declare","dojo/has","./kernel","./IdentityManagerBase"],function(H,n,u,m){H=H(m.Credential,{});n("extend-esri")&&(u.Credential=H);return H})},"esri/IdentityManagerBase":function(){define("dojo/_base/declare dojo/_base/config dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/url dojo/sniff dojo/io-query dojo/on ./kernel ./config ./lang ./ServerInfo ./urlUtils ./deferredUtils ./request ./Evented ./OAuthCredential ./arcgis/OAuthInfo".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v,r,w,y){var z={},E=function(q){var t=(new e(q.owningSystemUrl)).host;q=(new e(q.server)).host;var A=/.+\.arcgis\.com$/i;return A.test(t)&&A.test(q)},B=function(q,t){return!!(E(q)&&t&&m.some(t,function(A){return A.test(q.server)}))},C=null,G=null;try{C=window.localStorage,G=window.sessionStorage}catch(q){}var I=H(r,{declaredClass:"esri.IdentityManagerBase",constructor:function(){this._portalConfig=u.getObject("esriGeowConfig");this.serverInfos=[];this.oAuthInfos=
[];this.credentials=[];this._soReqs=[];this._xoReqs=[];this._portals=[];this._getOAuthHash();b(window,"pageshow",u.hitch(this,this._pageShowHandler))},defaultOAuthInfo:null,defaultTokenValidity:60,tokenValidity:null,normalizeWebTierAuth:!1,_appUrlObj:l.urlToObject(window.location.href),_postMessageAuthHandle:null,_busy:null,_rejectOnPersistedPageShow:!1,_oAuthHash:null,_gwTokenUrl:"/sharing/generateToken",_agsRest:"/rest/services",_agsPortal:/\/sharing(\/|$)/i,_agsAdmin:/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i,
_adminSvcs:/\/rest\/admin\/services(\/|$)/i,_gwDomains:[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/generateToken"},
{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/generateToken"}],_legacyFed:[],_regexSDirUrl:/http.+\/rest\/services\/?/ig,_regexServerType:/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/ig,
_gwUser:/http.+\/users\/([^\/]+)\/?.*/i,_gwItem:/http.+\/items\/([^\/]+)\/?.*/i,_gwGroup:/http.+\/groups\/([^\/]+)\/?.*/i,_errorCodes:[499,498,403,401],_rePortalTokenSvc:/\/sharing(\/rest)?\/generatetoken/i,_publicUrls:[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],_createDefaultOAuthInfo:!0,_hasTestedIfAppIsOnPortal:!1,registerServers:function(q){var t=this.serverInfos;t?(q=m.filter(q,function(A){return!this.findServerInfo(A.server)},this),this.serverInfos=t.concat(q)):
this.serverInfos=q;m.forEach(q,function(A){A.owningSystemUrl&&this._portals.push(A.owningSystemUrl);if(A.hasPortal){this._portals.push(A.server);var J=g.defaults.io.corsEnabledServers,M=this._getOrigin(A.tokenServiceUrl);l.canUseXhr(A.server)||J.push(A.server.replace(/^https?:\/\//i,""));l.canUseXhr(M)||J.push(M.replace(/^https?:\/\//i,""))}},this)},registerOAuthInfos:function(q){var t=this.oAuthInfos;t?(m.forEach(q,function(A){(A=this.findOAuthInfo(A.portalUrl))&&t.splice(t.indexOf(A),1)},this),
this.oAuthInfos=t.concat(q)):this.oAuthInfos=q},registerToken:function(q){q=h.mixin({},q);var t=this._sanitizeUrl(q.server),A=this.findServerInfo(t),J=!0,M;A||(A=new d,A.server=this._getServerInstanceRoot(t),A.tokenServiceUrl=this._getTokenSvcUrl(t),A.hasPortal=!0,this.registerServers([A]));(M=this.findCredential(t,q.userId))?(delete q.server,u.mixin(M,q),J=!1):(M=new D({userId:q.userId,server:A.server,token:q.token,expires:q.expires,ssl:q.ssl,scope:this._isServerRsrc(t)?"server":"portal"}),M.resources=
[t],this.credentials.push(M));M.onTokenChange(!1);J||M.refreshServerTokens()},toJson:function(){return h.fixJson({serverInfos:m.map(this.serverInfos,function(q){return q.toJson()}),oAuthInfos:m.map(this.oAuthInfos,function(q){return q.toJson()}),credentials:m.map(this.credentials,function(q){return q.toJson()})})},initialize:function(q){if(q){u.isString(q)&&(q=JSON.parse(q));var t=q.serverInfos,A=q.oAuthInfos;q=q.credentials;if(t){var J=[];m.forEach(t,function(N){N.server&&N.tokenServiceUrl&&J.push(N.declaredClass?
N:new d(N))});J.length&&this.registerServers(J)}if(A){var M=[];m.forEach(A,function(N){N.appId&&M.push(N.declaredClass?N:new y(N))});M.length&&this.registerOAuthInfos(M)}q&&m.forEach(q,function(N){N.userId&&N.server&&N.token&&N.expires&&N.expires>(new Date).getTime()&&(N=N.declaredClass?N:new D(N),N.onTokenChange(),this.credentials.push(N))},this)}},findServerInfo:function(q){var t;q=this._sanitizeUrl(q);m.some(this.serverInfos,function(A){this._hasSameServerInstance(A.server,q)&&(t=A);return!!t},
this);return t},findOAuthInfo:function(q){var t;q=this._sanitizeUrl(q);m.some(this.oAuthInfos,function(A){this._hasSameServerInstance(A.portalUrl,q)&&(t=A);return!!t},this);return t},findCredential:function(q,t){var A;q=this._sanitizeUrl(q);var J=this._isServerRsrc(q)?"server":"portal";t?m.some(this.credentials,function(M){this._hasSameServerInstance(M.server,q)&&t===M.userId&&M.scope===J&&(A=M);return!!A},this):m.some(this.credentials,function(M){this._hasSameServerInstance(M.server,q)&&-1!==this._getIdenticalSvcIdx(q,
M)&&M.scope===J&&(A=M);return!!A},this);return A},getCredential:function(q,t){var A=!0;if(h.isDefined(t))if(u.isObject(t)){var J=!!t.token;var M=t.error;A=!1!==t.prompt}else J=t;q=this._sanitizeUrl(q);var N=new k(p._dfdCanceller),x=this._isAdminResource(q);if((J=J?this.findCredential(q):null)&&M&&498===M.code)J.destroy();else if(J)return q=Error("You are currently signed in as: '"+J.userId+"'. You do not have access to this resource: "+q),q.name="identity-manager:not-authorized",q.code="IdentityManagerBase.1",
q.httpCode=M&&M.httpCode,q.messageCode=M?M.messageCode:null,q.subcode=M?M.subcode:null,q.details=M?M.details:null,q.log=!!n.isDebug,N.errback(q),N;if(M=this._findCredential(q,t))return N.callback(M),N;var F=this.findServerInfo(q);if(F)!F.hasServer&&this._isServerRsrc(q)&&(F._restInfoDfd=this._getTokenSvcUrl(q,!0),F.hasServer=!0);else{M=this._getTokenSvcUrl(q);if(!M)return q=Error("Unknown resource - could not find token service endpoint."),q.name="identity-manager:unknown-resource",q.code="IdentityManagerBase.2",
q.log=!!n.isDebug,N.errback(q),N;F=new d;F.server=this._getServerInstanceRoot(q);u.isString(M)?(F.tokenServiceUrl=M,F.hasPortal=!0):(F._restInfoDfd=M,F.hasServer=!0);this.registerServers([F])}F.hasPortal&&void 0===F._selfReq&&(A||l.hasSameOrigin(F.tokenServiceUrl,window.location.origin)||this._gwDomains.some(function(L){return L.tokenServiceUrl===F.tokenServiceUrl}))&&(F._selfReq={owningTenant:t&&t.owningTenant,selfDfd:this._getPortalSelf(F.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),
q)});return this._enqueue(q,F,t,N,x)},getResourceName:function(q){return this._isRESTService(q)?q.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(q)&&q.replace(this._gwUser,"$1")||this._gwItem.test(q)&&q.replace(this._gwItem,"$1")||this._gwGroup.test(q)&&q.replace(this._gwGroup,"$1")||""},generateToken:function(q,t,A){var J=this._rePortalTokenSvc.test(q.tokenServiceUrl),M=new e(window.location.href.toLowerCase()),N=!t;var x=q.shortLivedTokenValidity;if(t){var F=
f.id.tokenValidity||x||f.id.defaultTokenValidity;F>x&&(F=x)}if(A){var L=A.isAdmin;var O=A.serverUrl;var P=A.token;var S=A.ssl;q.customParameters=A.customParameters}if(L)x=q.adminTokenServiceUrl;else{x=q.tokenServiceUrl;var T=new e(x.toLowerCase());q.webTierAuth&&A&&A.serverUrl&&!S&&"http"===M.scheme&&(l.hasSameOrigin(M.uri,x,!0)||"https"===T.scheme&&M.host===T.host&&"7080"===M.port&&"7443"===T.port)&&(x=x.replace(/^https:/i,"http:").replace(/:7443/i,":7080"));N&&J&&(x=x.replace(/\/rest/i,""))}L=u.mixin({url:x,
content:u.mixin({request:"getToken",username:t&&t.username,password:t&&t.password,serverUrl:O,token:P,expiration:F,referer:L||J?window.location.host:null,client:L?"referer":null,f:"json"},q.customParameters),handleAs:"json",callbackParamName:N?"callback":void 0},A&&A.ioArgs);A={usePost:!N,disableIdentityLookup:!0,useProxy:this._useProxy(q,A)};J||(L.withCredentials=!1);J=v(L,A);J.addCallback(function(W){if(!W||!W.token)return W=Error("Unable to generate token"),W.name="identity-manager:authentication-failed",
W.code="IdentityManagerBase.3",W.log=!!n.isDebug,W;var X=q.server;z[X]||(z[X]={});t&&(z[X][t.username]=t.password);W.validity=F;return W});J.addErrback(function(W){});return J},isBusy:function(){return!!this._busy},checkSignInStatus:function(q){var t=new k;this.checkAppAccess(q,"").then(function(A){t.resolve(A.credential)}).catch(function(A){t.reject(A)});return t},checkAppAccess:function(q,t,A){var J=this,M=!1;return this.getCredential(q,{prompt:!1}).then(function(N){var x={f:"json"};if("portal"===
N.scope)if(t&&(J._doPortalSignIn(q)||A&&A.force)){var F=N.server+"/sharing/rest/oauth2/validateAppAccess";x.client_id=t}else if(N.token)F=N.server+"/sharing/rest";else return{credential:N};else if(N.token)F=N.server+"/rest/services";else return{credential:N};N.token&&(x.token=N.token);return v({url:F,content:x,callbackParamName:"callback"},{disableIdentityLookup:!0}).then(function(L){if(!1===L.valid){var O=Error("You are currently signed in as: '"+N.userId+"'.  You do not have access to this app: '"+
t+"'.");O.name="identity-manager:not-authorized";O.code="IdentityManagerBase.1";O.log=!!n.isDebug;O.details=L;throw O;}M=!!L.viewOnlyUserTypeApp;return{credential:N}}).catch(function(L){if("IdentityManagerBase.1"===L.code||400===L.code)throw 400===L.code&&(L.name="identity-manager:invalid-request"),L;if(498===L.code)throw N.destroy(),L=Error("User is not signed in."),L.name="identity-manager:not-authenticated",L.code="IdentityManagerBase.6",L.log=!!n.isDebug,L;return{credential:N}})}).then(function(N){return{credential:N.credential,
viewOnly:M}})},setProtocolErrorHandler:function(q){this._protocolFunc=q},signIn:function(){},oAuthSignIn:function(){},onCredentialCreate:function(){},onCredentialsDestroy:function(){},destroyCredentials:function(){if(this.credentials){var q=this.credentials.slice();m.forEach(q,function(t){t.destroy()})}this.onCredentialsDestroy()},enablePostMessageAuth:function(q){q||(q="https://www.arcgis.com/sharing/rest");this._postMessageAuthHandle&&this._postMessageAuthHandle.remove();this._postMessageAuthHandle=
b(window,"message",function(t){(t.origin===window.location.origin||h.endsWith(t.origin,".arcgis.com"))&&t.data&&"arcgis:auth:requestCredential"===t.data.type&&this.getCredential(q).then(function(A){t.source.postMessage({type:"arcgis:auth:credential",credential:{expires:A.expires,server:A.server,ssl:A.ssl,token:A.token,userId:A.userId}},t.origin)}).catch(function(A){t.source.postMessage({type:"arcgis:auth:error",error:{name:A.name,message:A.message}},t.origin)})}.bind(this))},disablePostMessageAuth:function(){this._postMessageAuthHandle&&
(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)},_getOAuthHash:function(){var q=window.location.hash;if(q){"#"===q.charAt(0)&&(q=q.substring(1));q=a.queryToObject(q);var t=!1;if(q.access_token&&q.expires_in&&q.state&&q.hasOwnProperty("username"))try{q.state=JSON.parse(q.state),"object"===typeof q.state&&q.state.portalUrl&&(this._oAuthHash=q,t=!0)}catch(A){}else q.error&&q.error_description&&(console.log("IdentityManager OAuth Error: ",q.error," - ",q.error_description),"access_denied"===
q.error&&(t=!0));t&&(window.location.hash=q.state&&q.state.hash||"")}},_pageShowHandler:function(q){q.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow&&(q=Error("ABORTED"),q.name="identity-manager:user-aborted",q.code="IdentityManager.2",q.log=!!n.isDebug,this._errbackFunc(q))},_findCredential:function(q,t){var A=-1,J,M,N=t&&t.token;t=t&&t.resource;var x=this._isServerRsrc(q)?"server":"portal",F=m.filter(this.credentials,function(S){return this._hasSameServerInstance(S.server,q)&&S.scope===
x},this);q=t||q;if(F.length)if(1===F.length){t=F[0];var L=(J=(M=this.findServerInfo(t.server))&&M.owningSystemUrl)&&this.findCredential(J,t.userId);A=this._getIdenticalSvcIdx(q,t);if(N)-1!==A&&(t.resources.splice(A,1),this._removeResource(q,L));else return-1===A&&t.resources.push(q),this._addResource(q,L),t}else{var O,P;m.some(F,function(S){P=this._getIdenticalSvcIdx(q,S);return-1!==P?(O=S,L=(J=(M=this.findServerInfo(O.server))&&M.owningSystemUrl)&&this.findCredential(J,O.userId),A=P,!0):!1},this);
if(N)O&&(O.resources.splice(A,1),this._removeResource(q,L));else if(O)return this._addResource(q,L),O}},_findOAuthInfo:function(q){var t=this.findOAuthInfo(q);t||m.some(this.oAuthInfos,function(A){this._isIdProvider(A.portalUrl,q)&&(t=A);return!!t},this);return t},_addResource:function(q,t){t&&-1===this._getIdenticalSvcIdx(q,t)&&t.resources.push(q)},_removeResource:function(q,t){var A=-1;t&&(A=this._getIdenticalSvcIdx(q,t),-1<A&&t.resources.splice(A,1))},_useProxy:function(q,t){return t&&t.isAdmin&&
!l.hasSameOrigin(q.adminTokenServiceUrl,window.location.href)||!this._isPortalDomain(q.tokenServiceUrl)&&10.1==q.currentVersion&&!l.hasSameOrigin(q.tokenServiceUrl,window.location.href)},_getOrigin:function(q){q=new e(q);return q.scheme+"://"+q.host+(h.isDefined(q.port)?":"+q.port:"")},_getServerInstanceRoot:function(q){var t=q.toLowerCase(),A=t.indexOf(this._agsRest);-1===A&&this._isAdminResource(q)&&(A=this._agsAdmin.test(q)?q.replace(this._agsAdmin,"$1").length:q.search(this._adminSvcs));-1===
A&&(A=t.indexOf("/sharing"));-1===A&&"/"===t.substr(-1)&&(A=t.length-1);return-1<A?q.substring(0,A):q},_hasSameServerInstance:function(q,t){"/"===q.substr(-1)&&(q=q.slice(0,-1));q=q.toLowerCase();t=this._getServerInstanceRoot(t).toLowerCase();q=this._normalizeAGOLorgDomain(q);t=this._normalizeAGOLorgDomain(t);q=q.substr(q.indexOf(":"));t=t.substr(t.indexOf(":"));return q===t},_normalizeAGOLorgDomain:function(q){var t=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,A=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,
J=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;t.test(q)?q=q.replace(t,"https://www.arcgis.com"):A.test(q)?q=q.replace(A,"https://devext.arcgis.com"):J.test(q)&&(q=q.replace(J,"https://qaext.arcgis.com"));return q},_sanitizeUrl:function(q){var t=(g.defaults.io.proxyUrl||"").toLowerCase(),A=t?q.toLowerCase().indexOf(t+"?"):-1;-1!==A&&(q=q.substring(A+t.length+1));q=l.normalize(q);return l.urlToObject(q).path},_isRESTService:function(q){return-1<q.indexOf(this._agsRest)},_isAdminResource:function(q){return this._agsAdmin.test(q)||
this._adminSvcs.test(q)},_isServerRsrc:function(q){return this._isRESTService(q)||this._isAdminResource(q)},_isIdenticalService:function(q,t){if(this._isRESTService(q)&&this._isRESTService(t)){q=this._getSuffix(q).toLowerCase();t=this._getSuffix(t).toLowerCase();var A=q===t;A||(A=/(.*)\/(MapServer|FeatureServer).*/ig,A=q.replace(A,"$1")===t.replace(A,"$1"))}else this._isAdminResource(q)&&this._isAdminResource(t)?A=!0:this._isServerRsrc(q)||this._isServerRsrc(t)||!this._isPortalDomain(q)||(A=!0);return A},
_isPortalDomain:function(q){var t=new e(q.toLowerCase()),A=this._portalConfig;q=m.some(this._gwDomains,function(J){return J.regex.test(t.uri)});!q&&A&&(q=this._hasSameServerInstance(this._getServerInstanceRoot(A.restBaseUrl),t.uri));q||(!this._arcgisUrl&&(A=u.getObject("esri.arcgis.utils.arcgisUrl"))&&(this._arcgisUrl=(new e(A)).authority),this._arcgisUrl&&(q=this._arcgisUrl.toLowerCase()===t.authority));q||(q=m.some(this._portals,function(J){return this._hasSameServerInstance(J,t.uri)},this));return q=
q||this._agsPortal.test(t.path)},_isIdProvider:function(q,t){var A=-1,J=-1;m.forEach(this._gwDomains,function(F,L){-1===A&&F.regex.test(q)&&(A=L);-1===J&&F.regex.test(t)&&(J=L)});var M=!1;if(-1<A&&-1<J)if(0===A||4===A){if(0===J||4===J)M=!0}else if(1===A){if(1===J||2===J)M=!0}else 2===A?2===J&&(M=!0):3===A&&3===J&&(M=!0);if(!M){var N=this.findServerInfo(t),x=N&&N.owningSystemUrl;x&&E(N)&&this._isPortalDomain(x)&&this._isIdProvider(q,x)&&(M=!0)}return M},_isPublic:function(q){q=this._sanitizeUrl(q);
return m.some(this._publicUrls,function(t){return t.test(q)})},_getIdenticalSvcIdx:function(q,t){var A=-1;m.some(t.resources,function(J,M){return this._isIdenticalService(q,J)?(A=M,!0):!1},this);return A},_getSuffix:function(q){return q.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")},_getTokenSvcUrl:function(q){if(this._isRESTService(q)||this._isAdminResource(q)){var t=this._getServerInstanceRoot(q);var A=t+"/admin/generateToken";q=t+"/rest/info";t=v({url:q,content:{f:"json"},
handleAs:"json",callbackParamName:"callback"});t.adminUrl_=A;return t}if(this._isPortalDomain(q)){var J="";m.some(this._gwDomains,function(M){M.regex.test(q)&&(J=M.tokenServiceUrl);return!!J});J||m.some(this._portals,function(M){this._hasSameServerInstance(M,q)&&(J=M+this._gwTokenUrl);return!!J},this);J||(A=q.toLowerCase().indexOf("/sharing"),-1!==A&&(J=q.substring(0,A)+this._gwTokenUrl));J||(J=this._getOrigin(q)+this._gwTokenUrl);J&&(A=(new e(q)).port,/^http:\/\//i.test(q)&&"7080"===A&&(J=J.replace(/:7080/i,
":7443")),J=J.replace(/http:/i,"https:"));return J}if(-1!==q.toLowerCase().indexOf("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"},_exchangeToken:function(q,t,A){return v({url:q+"/sharing/rest/oauth2/exchangeToken",content:{f:"json",client_id:t,token:A}},{disableIdentityLookup:!0,usePost:!0}).then(function(J){return J.token})},_getPlatformSelf:function(q,t){return v({url:q+"/sharing/rest/oauth2/platformSelf",content:{f:"json"},headers:{"X-Esri-Auth-Client-Id":t,
"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},withCredentials:!0},{disableIdentityLookup:!0,usePost:!0})},_getPortalSelf:function(q,t){var A="";m.some(this._gwDomains,function(J){J.regex.test(q)&&(A=J.customBaseUrl);return!!A});if(A)return t=new k,t.resolve({allSSL:!0,currentVersion:"4.4",customBaseUrl:A,portalMode:"multitenant",supportsOAuth:!0}),t;"https:"===window.location.protocol?q=q.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(t)&&(q=q.replace(/^https:/i,
"http:").replace(/:7443/i,":7080"));return v({url:q,content:{f:"json"},handleAs:"json",callbackParamName:"callback"},{crossOrigin:!1,disableIdentityLookup:!0})},_doPortalSignIn:function(q){var t=this._portalConfig,A=window.location.href,J=this.findServerInfo(q);return(t||this._isPortalDomain(A))&&(J?J.hasPortal||J.owningSystemUrl&&this._isPortalDomain(J.owningSystemUrl):this._isPortalDomain(q))&&(this._isIdProvider(A,q)||t&&(this._hasSameServerInstance(this._getServerInstanceRoot(t.restBaseUrl),q)||
this._isIdProvider(t.restBaseUrl,q))||l.hasSameOrigin(A,q,!0))?!0:!1},_checkProtocol:function(q,t,A,J){var M=!0;J=J?t.adminTokenServiceUrl:t.tokenServiceUrl;0!==u.trim(J).toLowerCase().indexOf("https:")||0===window.location.href.toLowerCase().indexOf("https:")||g.defaults.io.useCors&&(l.canUseXhr(J)||l.canUseXhr(l.getProxyUrl(!0).path))||(M=this._protocolFunc?!!this._protocolFunc({resourceUrl:q,serverInfo:t}):!1,M||(q=Error("Aborted the Sign-In process to avoid sending password over insecure connection."),
q.name="identity-manager:aborted",q.code="IdentityManagerBase.4",q.log=!!n.isDebug,console.log(q.message),A(q)));return M},_enqueue:function(q,t,A,J,M,N){J||(J=new k(p._dfdCanceller));J.resUrl_=q;J.sinfo_=t;J.options_=A;J.admin_=M;J.refresh_=N;this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(q),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(J)):this._xoReqs.push(J):this._doSignIn(J);return J},_doSignIn:function(q){this._busy=
q;this._rejectOnPersistedPageShow=!1;var t=this,A=function(O){var P=q.options_&&q.options_.resource,S=q.resUrl_,T=q.refresh_,W=!1;-1===m.indexOf(t.credentials,O)&&(T&&-1!==m.indexOf(t.credentials,T)?(T.userId=O.userId,T.token=O.token,T.expires=O.expires,T.validity=O.validity,T.ssl=O.ssl,T.creationTime=O.creationTime,W=!0,O=T):t.credentials.push(O));O.resources||(O.resources=[]);O.resources.push(P||S);O.scope=t._isServerRsrc(S)?"server":"portal";O.onTokenChange();P=t._soReqs;var X={};t._soReqs=[];
m.forEach(P,function(K){if(!this._isIdenticalService(S,K.resUrl_)){var R=this._getSuffix(K.resUrl_);X[R]||(X[R]=!0,O.resources.push(K.resUrl_))}},t);q.callback(O);m.forEach(P,function(K){this._hasSameServerInstance(this._getServerInstanceRoot(S),K.resUrl_)?K.callback(O):this._soReqs.push(K)},t);t._busy=q.resUrl_=q.sinfo_=q.refresh_=null;if(!W)t.onCredentialCreate({credential:O});t._soReqs.length?t._doSignIn(t._soReqs.shift()):t._xoReqs.length&&t._doSignIn(t._xoReqs.shift())},J=function(O){q.errback(O);
t._busy=q.resUrl_=q.sinfo_=q.refresh_=null;t._soReqs.length?t._doSignIn(t._soReqs.shift()):t._xoReqs.length&&t._doSignIn(t._xoReqs.shift())},M=function(O,P,S,T){var W=q.sinfo_,X=!q.options_||!1!==q.options_.prompt,K=W.hasPortal&&t._findOAuthInfo(q.resUrl_);if(O)A(new D({userId:O,server:W.server,token:S||null,expires:h.isDefined(T)?Number(T):null,ssl:!!P}));else if(window!==window.parent&&t._appUrlObj.query&&t._appUrlObj.query["arcgis-auth-origin"]&&t._appUrlObj.query["arcgis-auth-portal"]&&t._hasSameServerInstance(t._getServerInstanceRoot(t._appUrlObj.query["arcgis-auth-portal"]),
q.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},t._appUrlObj.query["arcgis-auth-origin"]);var R=b(window,"message",function(Z){if(Z.source===window.parent&&Z.data)if("arcgis:auth:credential"===Z.data.type)R.remove(),A(new D(Z.data.credential));else if("arcgis:auth:error"===Z.data.type){R.remove();Z=Z.data.error;switch(Z.name){case "identity-manager:busy":case "identity-manager:not-authorized":var aa="IdentityManager.1";break;case "identity-manager:server-identification-failed":case "identity-manager:unknown-resource":case "identity-manager:user-aborted":aa=
"IdentityManager.2";break;case "identity-manager:authentication-failed":aa="IdentityManager.3";break;case "identity-manager:aborted":aa="IdentityManager.4";break;case "identity-manager:not-authenticated":aa="IdentityManager.6";break;case "identity-manager:invalid-request":aa=400}var ca=Error(Z.message);ca.name=Z.name;ca.code=aa;ca.log=!!n.isDebug;J(ca)}})}else if(K){var Q=K._oAuthCred;Q||(O=new w(K,C),P=new w(K,G),O.isValid()&&P.isValid()?O.expires>P.expires?(Q=O,P.destroy()):(Q=P,O.destroy()):Q=
O.isValid()?O:P,K._oAuthCred=Q);if(Q.isValid()){var U=new D({userId:Q.userId,server:W.server,token:Q.token,expires:Q.expires,ssl:Q.ssl,_oAuthCred:Q});K.appId!==Q.appId&&t._doPortalSignIn(q.resUrl_)?q._pendingDfd=t._exchangeToken(U.server,K.appId,U.token).then(function(Z){U.token=Z;Q.token=Z;Q.save();A(U)}).catch(function(){A(U)}):A(U)}else if(t._oAuthHash&&t._hasSameServerInstance(K.portalUrl,t._oAuthHash.state.portalUrl))O=t._oAuthHash,U=new D({userId:O.username,server:W.server,token:O.access_token,
expires:(new Date).getTime()+1E3*Number(O.expires_in),ssl:"true"===O.ssl,oAuthState:O.state,_oAuthCred:Q}),Q.storage=O.persist?C:G,Q.token=U.token,Q.expires=U.expires,Q.userId=U.userId,Q.ssl=U.ssl,Q.save(),t._oAuthHash=null,A(U);else{var V=function(){X?q._pendingDfd=t.oAuthSignIn(q.resUrl_,W,K,q.options_).addCallbacks(A,J):(Y=Error("User is not signed in."),Y.name="identity-manager:not-authenticated",Y.code="IdentityManagerBase.6",Y.log=!!n.isDebug,J(Y))};t._doPortalSignIn(q.resUrl_)?q._pendingDfd=
t._getPlatformSelf(W.server,K.appId).then(function(Z){var aa=Z.portalUrl;!aa||l.hasSameOrigin(aa,window.location.origin,!0)?(U=new D({server:W.server,userId:Z.username,token:Z.token}),A(U)):V()}).catch(V):V()}}else if(X)t._checkProtocol(q.resUrl_,W,J,q.admin_)&&(O=q.options_,q.admin_&&(O=O||{},O.isAdmin=!0),q._pendingDfd=t.signIn(q.resUrl_,W,O).addCallbacks(A,J));else{var Y=Error("User is not signed in.");Y.name="identity-manager:not-authenticated";Y.code="IdentityManagerBase.6";Y.log=!!n.isDebug;
J(Y)}},N=function(){var O=q.sinfo_,P=O.owningSystemUrl,S=q.options_,T;if(S){var W=S.token;var X=S.error;var K=S.prompt}(T=t._findCredential(P,{token:W,resource:q.resUrl_}))||m.some(t.credentials,function(R){this._isIdProvider(P,R.server)&&(T=R);return!!T},t);T?(S=t.findCredential(q.resUrl_,T.userId))?A(S):B(O,t._legacyFed)?(S=T.toJson(),S.server=O.server,S.resources=null,A(new D(S))):(q._pendingDfd=t.generateToken(t.findServerInfo(T.server),null,{serverUrl:q.resUrl_,token:T.token,ssl:T.ssl})).addCallbacks(function(R){A(new D({userId:T.userId,
server:O.server,token:R.token,expires:h.isDefined(R.expires)?Number(R.expires):null,ssl:!!R.ssl,isAdmin:q.admin_,validity:R.validity}))},J):(t._busy=null,W&&(q.options_.token=null),(q._pendingDfd=t.getCredential(P.replace(/\/?$/,"/sharing"),{resource:q.resUrl_,owningTenant:O.owningTenant,token:W,error:X,prompt:K})).addCallbacks(function(R){t._enqueue(q.resUrl_,q.sinfo_,q.options_,q,q.admin_)},function(R){J(R)}))};this._errbackFunc=J;var x=q.sinfo_.owningSystemUrl,F=this._isServerRsrc(q.resUrl_),L=
q.sinfo_._restInfoDfd;L?L.addCallbacks(function(O){var P=q.sinfo_;P._restInfoDfd&&(P.adminTokenServiceUrl=P._restInfoDfd.adminUrl_,P._restInfoDfd=null,P.tokenServiceUrl=u.getObject("authInfo.tokenServicesUrl",!1,O)||u.getObject("authInfo.tokenServiceUrl",!1,O)||u.getObject("tokenServiceUrl",!1,O),P.shortLivedTokenValidity=u.getObject("authInfo.shortLivedTokenValidity",!1,O),P.currentVersion=O.currentVersion,P.owningTenant=O.owningTenant,(O=P.owningSystemUrl=O.owningSystemUrl)&&t._portals.push(O));
F&&P.owningSystemUrl?N():M()},function(){q.sinfo_._restInfoDfd=null;var O=Error("Unknown resource - could not find token service endpoint.");O.name="identity-manager:server-identification-failed";O.code="IdentityManagerBase.2";O.log=!!n.isDebug;J(O)}):F&&x?N():q.sinfo_._selfReq?q.sinfo_._selfReq.selfDfd.then(function(O){var P={};if(O){var S=O.user&&O.user.username;P.username=S;P.allSSL=O.allSSL;var T=O.supportsOAuth;var W=O.currentVersion;if("multitenant"===O.portalMode)var X=O.customBaseUrl}q.sinfo_.webTierAuth=
!!S;return S&&t.normalizeWebTierAuth?t.generateToken(q.sinfo_,null,{ssl:P.allSSL}).addBoth(function(K){P.portalToken=K&&K.token;P.tokenExpiration=K&&K.expires;return P}):!S&&T&&4.4<=parseFloat(W)&&!t._findOAuthInfo(q.resUrl_)?t._generateOAuthInfo({portalUrl:q.sinfo_.server,customBaseUrl:X,owningTenant:q.sinfo_._selfReq.owningTenant}).always(function(){return P}):P}).always(function(O){q.sinfo_._selfReq=null;O?M(O.username,O.allSSL,O.portalToken,O.tokenExpiration):M()}):M()},_generateOAuthInfo:function(q){var t=
this,A=q.portalUrl,J=q.customBaseUrl,M=q.owningTenant;if(q=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal){var N=window.location.href;var x=N.indexOf("?");-1<x&&(N=N.slice(0,x));x=N.search(/\/(apps|home)\//);N=-1<x?N.slice(0,x):null}q&&N?(this._hasTestedIfAppIsOnPortal=!0,q=v({url:N+"/sharing/rest",content:{f:"json"},handleAs:"json"}).then(function(){t.defaultOAuthInfo=new y({appId:"arcgisonline",popupCallbackUrl:N+"/home/oauth-callback.html"})})):(q=new k,q.resolve(),
q=q.promise);return q.then(function(){if(t.defaultOAuthInfo)return A=A.replace(/^http:/i,"https:"),v({url:A+"/sharing/rest/oauth2/validateRedirectUri",content:{accountId:M,client_id:t.defaultOAuthInfo.appId,redirect_uri:l.getAbsoluteUrl(t.defaultOAuthInfo.popupCallbackUrl),f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(F){if(F.valid){var L=t.defaultOAuthInfo.clone();L.portalUrl=F.urlKey&&J?"https://"+F.urlKey.toLowerCase()+"."+J:A;L.popup=window!==window.top||!(l.hasSameOrigin(A,
window.location.origin)||t._gwDomains.some(function(O){return O.regex.test(A)&&O.regex.test(window.location.origin)}));t.oAuthInfos.push(L)}})})}});var D=H(r,{declaredClass:"esri.Credential",tokenRefreshBuffer:2,constructor:function(q){u.mixin(this,q);this.resources=this.resources||[];h.isDefined(this.creationTime)||(this.creationTime=(new Date).getTime())},_oAuthCred:null,refreshToken:function(){var q=this,t=this.resources&&this.resources[0],A=f.id.findServerInfo(this.server),J=A&&A.owningSystemUrl,
M=!!J&&"server"===this.scope,N=M&&B(A,f.id._legacyFed),x=M&&f.id.findServerInfo(J),F,L=(F=A.webTierAuth)&&f.id.normalizeWebTierAuth,O=z[this.server];O=O&&O[this.userId];var P={username:this.userId,password:O};if(!F||L)if(M&&!x&&m.some(f.id.serverInfos,function(W){f.id._isIdProvider(J,W.server)&&(x=W);return!!x}),F=x&&f.id.findCredential(x.server,this.userId),!M||F)if(N)F.refreshToken();else{if(M)var S={serverUrl:t,token:F&&F.token,ssl:F&&F.ssl};else if(L)P=null,S={ssl:this.ssl};else if(O)this.isAdmin&&
(S={isAdmin:!0});else{if(t){t=f.id._sanitizeUrl(t);this._enqueued=1;var T=f.id._enqueue(t,A,null,null,this.isAdmin,this);T.addCallback(function(){q._enqueued=0;q.refreshServerTokens()}).addErrback(function(){q._enqueued=0})}return T}return f.id.generateToken(M?x:A,M?null:P,S).addCallback(function(W){q.token=W.token;q.expires=h.isDefined(W.expires)?Number(W.expires):null;q.creationTime=(new Date).getTime();q.validity=W.validity;q.onTokenChange();q.refreshServerTokens()}).addErrback(function(){})}},
refreshServerTokens:function(){"portal"===this.scope&&m.forEach(f.id.credentials,function(q){var t=f.id.findServerInfo(q.server),A=t&&t.owningSystemUrl;q!==this&&q.userId===this.userId&&A&&"server"===q.scope&&(f.id._hasSameServerInstance(this.server,A)||f.id._isIdProvider(A,this.server))&&(B(t,f.id._legacyFed)?(q.token=this.token,q.expires=this.expires,q.creationTime=this.creationTime,q.validity=this.validity,q.onTokenChange()):q.refreshToken())},this)},onTokenChange:function(q){clearTimeout(this._refreshTimer);
var t=this.server&&f.id.findServerInfo(this.server),A=(t=t&&t.owningSystemUrl)&&f.id.findServerInfo(t);!1!==q&&(!t||"portal"===this.scope||A&&A.webTierAuth&&!f.id.normalizeWebTierAuth)&&(h.isDefined(this.expires)||h.isDefined(this.validity))&&this._startRefreshTimer()},onDestroy:function(){},destroy:function(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null;this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);var q=m.indexOf(f.id.credentials,
this);-1<q&&f.id.credentials.splice(q,1);this.onTokenChange();this.onDestroy()},toJson:function(){return this._toJson()},_toJson:function(){var q=h.fixJson({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),t=this.resources;t&&0<t.length&&(q.resources=t.slice());return q},_startRefreshTimer:function(){clearTimeout(this._refreshTimer);var q=6E4*this.tokenRefreshBuffer,
t=Math.pow(2,31)-1,A=(this.validity?this.creationTime+6E4*this.validity:this.expires)-(new Date).getTime();0>A?A=0:A>t&&(A=t);this._refreshTimer=setTimeout(u.hitch(this,this.refreshToken),A>q?A-q:A)}});I.Credential=D;c("extend-esri")&&(f.IdentityManagerBase=I);return I})},"esri/ServerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","./kernel","./lang"],function(H,n,u,m,k){H=H(null,{declaredClass:"esri.ServerInfo",constructor:function(e){n.mixin(this,e)},toJson:function(){return k.fixJson({server:this.server,
tokenServiceUrl:this.tokenServiceUrl,adminTokenServiceUrl:this.adminTokenServiceUrl,shortLivedTokenValidity:this.shortLivedTokenValidity,owningSystemUrl:this.owningSystemUrl,owningTenant:this.owningTenant,currentVersion:this.currentVersion,hasPortal:this.hasPortal,hasServer:this.hasServer,webTierAuth:this.webTierAuth})}});u("extend-esri")&&(m.ServerInfo=H);return H})},"esri/OAuthCredential":function(){define(["./kernel","dojo/_base/declare","dojo/has","dojo/json"],function(H,n,u,m){n=n(null,{declaredClass:"esri.OAuthCredential",
oAuthInfo:null,storage:null,appId:null,expires:null,ssl:null,token:null,userId:null,constructor:function(k,e){this.oAuthInfo=k;this.storage=e;this._init()},isValid:function(){var k=!1;if(this.oAuthInfo&&this.token&&this.userId){var e=(new Date).getTime();this.expires>e&&(this.expires-e)/1E3>60*this.oAuthInfo.minTimeUntilExpiration&&(k=!0)}return k},save:function(){if(this.storage){var k=this._load(),e=this.oAuthInfo;if(e&&e.authNamespace&&e.portalUrl){var c=k[e.authNamespace];c||(c=k[e.authNamespace]=
{});c[e.portalUrl]={appId:this.appId=e.appId,expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem("esriJSAPIOAuth",m.stringify(k))}catch(a){console.log(a)}}}},destroy:function(){var k=this._load(),e=this.oAuthInfo;if(e&&e.appId&&e.portalUrl&&this.token&&this.expires>Date.now()){var c=e.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",a=new FormData;a.append("f","json");a.append("auth_token",this.token);a.append("client_id",e.appId);
a.append("token_type_hint","access_token");if("function"===typeof navigator.sendBeacon)navigator.sendBeacon(c,a);else{var b=new XMLHttpRequest;b.open("POST",c);b.send(a)}}if(e&&e.authNamespace&&e.portalUrl&&this.storage&&(c=k[e.authNamespace])){delete c[e.portalUrl];try{this.storage.setItem("esriJSAPIOAuth",m.stringify(k))}catch(f){console.log(f)}}e&&(this.oAuthInfo=e._oAuthCred=null)},_init:function(){var k=this._load(),e=this.oAuthInfo;e&&e.authNamespace&&e.portalUrl&&(k=k[e.authNamespace])&&(k=
k[e.portalUrl])&&(this.appId=k.appId,this.expires=k.expires,this.ssl=k.ssl,this.token=k.token,this.userId=k.userId)},_load:function(){var k={};if(this.storage){var e=this.storage.getItem("esriJSAPIOAuth");if(e)try{k=m.parse(e)}catch(c){console.log(c)}}return k}});u("extend-esri")&&(H.OAuthCredential=n);return n})},"esri/arcgis/OAuthInfo":function(){define(["../kernel","../lang","dojo/_base/declare","dojo/_base/lang","dojo/has"],function(H,n,u,m,k){var e=u(null,{declaredClass:"esri.arcgis.OAuthInfo",
constructor:function(c){m.mixin(this,{expiration:20160,minTimeUntilExpiration:30,portalUrl:"https://www.arcgis.com",authNamespace:"/",forceLogin:!1,popup:!1,popupCallbackUrl:"oauth-callback.html",popupWindowFeatures:"height\x3d490,width\x3d800,resizable,scrollbars,status",preserveUrlHash:!1},c)},_oAuthCred:null,toJson:function(){return n.fixJson({appId:this.appId,expiration:this.expiration,locale:this.locale,minTimeUntilExpiration:this.minTimeUntilExpiration,portalUrl:this.portalUrl,authNamespace:this.authNamespace,
forceLogin:this.forceLogin,popup:this.popup,popupCallbackUrl:this.popupCallbackUrl,popupWindowFeatures:this.popupWindowFeatures,preserveUrlHash:this.preserveUrlHash})},clone:function(){return new e(this.toJson())}});k("extend-esri")&&m.setObject("arcgis.OAuthInfo",e,H);return e})},"dijit/form/Button":function(){define("require dojo/_base/declare dojo/dom-class dojo/has dojo/_base/kernel dojo/_base/lang dojo/ready ./_FormWidget ./_ButtonMixin dojo/text!./templates/Button.html ../a11yclick".split(" "),
function(H,n,u,m,k,e,c,a,b,f){m("dijit-legacy-requires")&&c(0,function(){H(["dijit/form/DropDownButton","dijit/form/ComboButton","dijit/form/ToggleButton"])});c=n("dijit.form.Button"+(m("dojo-bidi")?"_NoBidi":""),[a,b],{showLabel:!0,iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},baseClass:"dijitButton",templateString:f,_setValueAttr:"valueNode",_setNameAttr:function(g){this.valueNode&&this.valueNode.setAttribute("name",g)},postCreate:function(){this.inherited(arguments);
this._setLabelFromContainer()},_setLabelFromContainer:function(){this.containerNode&&!this.label&&(this.label=e.trim(this.containerNode.innerHTML),this.onLabelSet())},_setShowLabelAttr:function(g){this.containerNode&&u.toggle(this.containerNode,"dijitDisplayNone",!g);this._set("showLabel",g)},setLabel:function(g){k.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",g)},onLabelSet:function(){this.inherited(arguments);this.showLabel||
"title"in this.params||(this.titleNode.title=e.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});m("dojo-bidi")&&(c=n("dijit.form.Button",c,{onLabelSet:function(){this.inherited(arguments);this.titleNode.title&&this.applyTextDir(this.titleNode,this.titleNode.title)},_setTextDirAttr:function(g){this._created&&this.textDir!=g&&(this._set("textDir",g),this._setLabelAttr(this.label))}}));return c})},"dijit/form/_FormWidget":function(){define("dojo/_base/declare dojo/sniff dojo/_base/kernel dojo/ready ../_Widget ../_CssStateMixin ../_TemplatedMixin ./_FormWidgetMixin".split(" "),
function(H,n,u,m,k,e,c,a){n("dijit-legacy-requires")&&m(0,function(){require(["dijit/form/_FormValueWidget"])});return H("dijit.form._FormWidget",[k,c,e,a],{setDisabled:function(b){u.deprecated("setDisabled("+b+") is deprecated. Use set('disabled',"+b+") instead.","","2.0");this.set("disabled",b)},setValue:function(b){u.deprecated("dijit.form._FormWidget:setValue("+b+") is deprecated.  Use set('value',"+b+") instead.","","2.0");this.set("value",b)},getValue:function(){u.deprecated(this.declaredClass+
"::getValue() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},postMixInProperties:function(){this.nameAttrSetting=this.name&&!n("msapp")?'name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"";this.inherited(arguments)}})})},"dijit/form/_FormWidgetMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff dojo/window ../a11y".split(" "),function(H,n,u,m,k,e,c,a,b,f){return n("dijit.form._FormWidgetMixin",
null,{name:"",alt:"",value:"",type:"text","aria-label":"focusNode",tabIndex:"0",_setTabIndexAttr:"focusNode",disabled:!1,intermediateChanges:!1,scrollOnFocus:!0,_setIdAttr:"focusNode",_setDisabledAttr:function(g){this._set("disabled",g);/^(button|input|select|textarea|optgroup|option|fieldset)$/i.test(this.focusNode.tagName)?(u.set(this.focusNode,"disabled",g),a("trident")&&"readOnly"in this&&u.set(this.focusNode,"readonly",g||this.readOnly)):this.focusNode.setAttribute("aria-disabled",g?"true":"false");
this.valueNode&&u.set(this.valueNode,"disabled",g);g?(this._set("hovering",!1),this._set("active",!1),g="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"_setTabIndexAttr"in this?this._setTabIndexAttr:"focusNode",H.forEach(k.isArray(g)?g:[g],function(h){h=this[h];a("webkit")||f.hasDefaultTabStop(h)?h.setAttribute("tabIndex","-1"):h.removeAttribute("tabIndex")},this)):""!=this.tabIndex&&this.set("tabIndex",this.tabIndex)},_onFocus:function(g){if("mouse"==g&&this.isFocusable())var h=this.own(c(this.focusNode,
"focus",function(){l.remove();h.remove()}))[0],d=a("pointer-events")?"pointerup":a("MSPointer")?"MSPointerUp":a("touch-events")?"touchend, mouseup":"mouseup",l=this.own(c(this.ownerDocumentBody,d,k.hitch(this,function(p){l.remove();h.remove();this.focused&&("touchend"==p.type?this.defer("focus"):this.focus())})))[0];this.scrollOnFocus&&this.defer(function(){b.scrollIntoView(this.domNode)});this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&"none"!=m.get(this.domNode,
"display")},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(g){}},compare:function(g,h){return"number"==typeof g&&"number"==typeof h?isNaN(g)&&isNaN(h)?0:g-h:g>h?1:g<h?-1:0},onChange:function(){},_onChangeActive:!1,_handleOnChange:function(g,h){void 0!=this._lastValueReported||null!==h&&this._onChangeActive||(this._resetValue=this._lastValueReported=g);this._pendingOnChange=this._pendingOnChange||typeof g!=typeof this._lastValueReported||0!=this.compare(g,
this._lastValueReported);(this.intermediateChanges||h||void 0===h)&&this._pendingOnChange&&(this._lastValueReported=g,this._pendingOnChange=!1,this._onChangeActive&&(this._onChangeHandle&&this._onChangeHandle.remove(),this._onChangeHandle=this.defer(function(){this._onChangeHandle=null;this.onChange(g)})))},create:function(){this.inherited(arguments);this._onChangeActive=!0},destroy:function(){this._onChangeHandle&&(this._onChangeHandle.remove(),this.onChange(this._lastValueReported));this.inherited(arguments)}})})},
"dijit/form/_ButtonMixin":function(){define(["dojo/_base/declare","dojo/dom","dojo/has","../registry"],function(H,n,u,m){var k=H("dijit.form._ButtonMixin"+(u("dojo-bidi")?"_NoBidi":""),null,{label:"",type:"button",__onClick:function(e){e.stopPropagation();e.preventDefault();this.disabled||this.valueNode.click(e);return!1},_onClick:function(e){if(this.disabled)return e.stopPropagation(),e.preventDefault(),!1;!1===this.onClick(e)&&e.preventDefault();var c=e.defaultPrevented;if(!c&&"submit"==this.type&&
!(this.valueNode||this.focusNode).form)for(var a=this.domNode;a.parentNode;a=a.parentNode){var b=m.byNode(a);if(b&&"function"==typeof b._onSubmit){b._onSubmit(e);e.preventDefault();c=!0;break}}return!c},postCreate:function(){this.inherited(arguments);n.setSelectable(this.focusNode,!1)},onClick:function(){return!0},_setLabelAttr:function(e){this._set("label",e);(this.containerNode||this.focusNode).innerHTML=e;this.onLabelSet()},onLabelSet:function(){}});u("dojo-bidi")&&(k=H("dijit.form._ButtonMixin",
k,{onLabelSet:function(){this.inherited(arguments);this.applyTextDir(this.containerNode||this.focusNode)}}));return k})},"dijit/form/Form":function(){define("dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/sniff ../_Widget ../_TemplatedMixin ./_FormMixin ../layout/_ContentPaneResizeMixin".split(" "),function(H,n,u,m,k,e,c,a){return H("dijit.form.Form",[k,e,c,a],{name:"",action:"",method:"",encType:"","accept-charset":"",accept:"",target:"",templateString:"\x3cform data-dojo-attach-point\x3d'containerNode' data-dojo-attach-event\x3d'onreset:_onReset,onsubmit:_onSubmit' ${!nameAttrSetting}\x3e\x3c/form\x3e",
postMixInProperties:function(){this.nameAttrSetting=this.name?"name\x3d'"+this.name+"'":"";this.inherited(arguments)},execute:function(){},onExecute:function(){},_setEncTypeAttr:function(b){n.set(this.domNode,"encType",b);m("ie")&&(this.domNode.encoding=b);this._set("encType",b)},reset:function(b){var f={returnValue:!0,preventDefault:function(){this.returnValue=!1},stopPropagation:function(){},currentTarget:b?b.target:this.domNode,target:b?b.target:this.domNode};!1!==this.onReset(f)&&f.returnValue&&
this.inherited(arguments,[])},onReset:function(){return!0},_onReset:function(b){this.reset(b);b.stopPropagation();b.preventDefault();return!1},_onSubmit:function(b){var f=this.constructor.prototype;if(this.execute!=f.execute||this.onExecute!=f.onExecute)u.deprecated("dijit.form.Form:execute()/onExecute() are deprecated. Use onSubmit() instead.","","2.0"),this.onExecute(),this.execute(this.getValues());!1===this.onSubmit(b)&&(b.stopPropagation(),b.preventDefault())},onSubmit:function(){return this.isValid()},
submit:function(){!1!==this.onSubmit()&&this.containerNode.submit()}})})},"dijit/form/ValidationTextBox":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/i18n ./TextBox ../Tooltip dojo/text!./templates/ValidationTextBox.html dojo/i18n!./nls/validate".split(" "),function(H,n,u,m,k,e,c){var a=H("dijit.form.ValidationTextBox",k,{templateString:c,required:!1,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},pattern:".*",regExp:"",
regExpGen:function(){},state:"",tooltipPosition:[],_deprecateRegExp:function(b,f){f!=a.prototype[b]&&(n.deprecated("ValidationTextBox id\x3d"+this.id+", set('"+b+"', ...) is deprecated.  Use set('pattern', ...) instead.","","2.0"),this.set("pattern",f))},_setRegExpGenAttr:function(b){this._deprecateRegExp("regExpGen",b);this._set("regExpGen",this._computeRegexp)},_setRegExpAttr:function(b){this._deprecateRegExp("regExp",b)},_setValueAttr:function(){this.inherited(arguments);this._refreshState()},
validator:function(b,f){return(new RegExp("^(?:"+this._computeRegexp(f)+")"+(this.required?"":"?")+"$")).test(b)&&(!this.required||!this._isEmpty(b))&&(this._isEmpty(b)||void 0!==this.parse(b,f))},_isValidSubset:function(){return 0==this.textbox.value.search(this._partialre)},isValid:function(){return this.validator(this.textbox.value,this.get("constraints"))},_isEmpty:function(b){return(this.trim?/^\s*$/:/^$/).test(b)},getErrorMessage:function(){var b="$_unset_$"==this.invalidMessage?this.messages.invalidMessage:
this.invalidMessage?this.invalidMessage:this.promptMessage,f="$_unset_$"==this.missingMessage?this.messages.missingMessage:this.missingMessage?this.missingMessage:b;return this.required&&this._isEmpty(this.textbox.value)?f:b},getPromptMessage:function(){return this.promptMessage},_maskValidSubsetError:!0,validate:function(b){var f="",g=this.disabled||this.isValid(b);g&&(this._maskValidSubsetError=!0);var h=this._isEmpty(this.textbox.value),d=!g&&b&&this._isValidSubset();this._set("state",g?"":((!this._hasBeenBlurred||
b)&&h||d)&&(this._maskValidSubsetError||d&&!this._hasBeenBlurred&&b)?"Incomplete":"Error");this.focusNode.setAttribute("aria-invalid","Error"==this.state?"true":"false");"Error"==this.state?(this._maskValidSubsetError=b&&d,f=this.getErrorMessage(b)):"Incomplete"==this.state?(f=this.getPromptMessage(b),this._maskValidSubsetError=!this._hasBeenBlurred||b):h&&(f=this.getPromptMessage(b));this.set("message",f);return g},displayMessage:function(b){b&&this.focused?e.show(b,this.domNode,this.tooltipPosition,
!this.isLeftToRight()):e.hide(this.domNode)},_refreshState:function(){this._created&&this.validate(this.focused);this.inherited(arguments)},constructor:function(b){this.constraints=u.clone(this.constraints);this.baseClass+=" dijitValidationTextBox"},startup:function(){this.inherited(arguments);this._refreshState()},_setConstraintsAttr:function(b){!b.locale&&this.lang&&(b.locale=this.lang);this._set("constraints",b);this._refreshState()},_setPatternAttr:function(b){this._set("pattern",b);this._refreshState()},
_computeRegexp:function(b){var f=this.pattern;"function"==typeof f&&(f=f.call(this,b));if(f!=this._lastRegExp){var g="";this._lastRegExp=f;".*"!=f&&f.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(h){switch(h.charAt(0)){case "{":case "+":case "?":case "*":case "^":case "$":case "|":case "(":g+=h;break;case ")":g+="|$)";break;default:g+="(?:"+h+"|$)"}});try{"".search(g)}catch(h){g=this.pattern,console.warn("RegExp error in "+this.declaredClass+": "+this.pattern)}this._partialre="^(?:"+
g+")$"}return f},postMixInProperties:function(){this.inherited(arguments);this.messages=m.getLocalization("dijit.form","validate",this.lang);this._setConstraintsAttr(this.constraints)},_setDisabledAttr:function(b){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(b){this._set("required",b);this.focusNode.setAttribute("aria-required",b);this._refreshState()},_setMessageAttr:function(b){this._set("message",b);this.displayMessage(b)},reset:function(){this._maskValidSubsetError=
!0;this.inherited(arguments)},_onBlur:function(){this.displayMessage("");this.inherited(arguments)},destroy:function(){e.hide(this.domNode);this.inherited(arguments)}});return a})},"dijit/form/TextBox":function(){define("dojo/_base/declare dojo/dom-construct dojo/dom-style dojo/_base/kernel dojo/_base/lang dojo/on dojo/sniff ./_FormValueWidget ./_TextBoxMixin dojo/text!./templates/TextBox.html ../main".split(" "),function(H,n,u,m,k,e,c,a,b,f,g){a=H("dijit.form.TextBox"+(c("dojo-bidi")?"_NoBidi":""),
[a,b],{templateString:f,_singleNodeTemplate:'\x3cinput class\x3d"dijit dijitReset dijitLeft dijitInputField" data-dojo-attach-point\x3d"textbox,focusNode" autocomplete\x3d"off" type\x3d"${type}" ${!nameAttrSetting} /\x3e',_buttonInputDisabled:c("ie")?"disabled":"",baseClass:"dijitTextBox",postMixInProperties:function(){var h=this.type.toLowerCase();if(this.templateString&&"input"==this.templateString.toLowerCase()||("hidden"==h||"file"==h)&&this.templateString==this.constructor.prototype.templateString)this.templateString=
this._singleNodeTemplate;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);9>c("ie")&&this.defer(function(){try{var h=u.getComputedStyle(this.domNode);if(h){var d=h.fontFamily;if(d){var l=this.domNode.getElementsByTagName("INPUT");if(l)for(h=0;h<l.length;h++)l[h].style.fontFamily=d}}}catch(p){}})},_setPlaceHolderAttr:function(h){this._set("placeHolder",h);this._phspan||(this._attachPoints.push("_phspan"),this._phspan=n.create("span",{className:"dijitPlaceHolder dijitInputField"},
this.textbox,"after"),this.own(e(this._phspan,"mousedown",function(d){d.preventDefault()}),e(this._phspan,"touchend, pointerup, MSPointerUp",k.hitch(this,function(){this.focus()}))));this._phspan.innerHTML="";this._phspan.appendChild(this._phspan.ownerDocument.createTextNode(h));this._updatePlaceHolder()},_onInput:function(h){this.inherited(arguments);this._updatePlaceHolder()},_updatePlaceHolder:function(){this._phspan&&(this._phspan.style.display=this.placeHolder&&!this.textbox.value?"":"none")},
_setValueAttr:function(h,d,l){this.inherited(arguments);this._updatePlaceHolder()},getDisplayedValue:function(){m.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use get('displayedValue') instead.","","2.0");return this.get("displayedValue")},setDisplayedValue:function(h){m.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");this.set("displayedValue",h)},_onBlur:function(h){this.disabled||(this.inherited(arguments),
this._updatePlaceHolder(),c("mozilla")&&this.selectOnClick&&(this.textbox.selectionStart=this.textbox.selectionEnd=void 0))},_onFocus:function(h){this.disabled||this.readOnly||(this.inherited(arguments),this._updatePlaceHolder())}});9>c("ie")&&(a.prototype._isTextSelected=function(){var h=this.ownerDocument.selection.createRange();return h.parentElement()==this.textbox&&0<h.text.length},g._setSelectionRange=b._setSelectionRange=function(h,d,l){h.createTextRange&&(h=h.createTextRange(),h.collapse(!0),
h.moveStart("character",-99999),h.moveStart("character",d),h.moveEnd("character",l-d),h.select())});c("dojo-bidi")&&(a=H("dijit.form.TextBox",a,{_setPlaceHolderAttr:function(h){this.inherited(arguments);this.applyTextDir(this._phspan)}}));return a})},"dijit/form/_FormValueWidget":function(){define(["dojo/_base/declare","dojo/sniff","./_FormWidget","./_FormValueMixin"],function(H,n,u,m){return H("dijit.form._FormValueWidget",[u,m],{_layoutHackIE7:function(){if(7==n("ie"))for(var k=this.domNode,e=k.parentNode,
c=k.firstChild||k,a=c.style.filter,b=this;e&&0==e.clientHeight;)(function(){var f=b.connect(e,"onscroll",function(){b.disconnect(f);c.style.filter=(new Date).getMilliseconds();b.defer(function(){c.style.filter=a})})})(),e=e.parentNode}})})},"dijit/form/_FormValueMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormWidgetMixin".split(" "),function(H,n,u,m,k,e,c){return H("dijit.form._FormValueMixin",c,{readOnly:!1,_setReadOnlyAttr:function(a){e("trident")&&
"disabled"in this?n.set(this.focusNode,"readOnly",a||this.disabled):n.set(this.focusNode,"readOnly",a);this._set("readOnly",a)},postCreate:function(){this.inherited(arguments);void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.value)},_setValueAttr:function(a,b){this._handleOnChange(a,b)},_handleOnChange:function(a,b){this._set("value",a);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,!1)},reset:function(){this._hasBeenBlurred=!1;this._setValueAttr(this._resetValue,
!0)}})})},"dijit/form/_TextBoxMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/sniff dojo/keys dojo/_base/lang dojo/on ../main".split(" "),function(H,n,u,m,k,e,c,a){var b=n("dijit.form._TextBoxMixin"+(m("dojo-bidi")?"_NoBidi":""),null,{trim:!1,uppercase:!1,lowercase:!1,propercase:!1,maxLength:"",selectOnClick:!1,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(f,g,h){if(void 0!==f){var d=this.filter(f);
"string"!=typeof h&&(h=null===d||"number"==typeof d&&isNaN(d)?"":this.filter(this.format(d,this.constraints)),0!=this.compare(d,this.filter(this.parse(h,this.constraints)))&&(h=null))}null==h||"number"==typeof h&&isNaN(h)||this.textbox.value==h||(this.textbox.value=h,this._set("displayedValue",this.get("displayedValue")));this.inherited(arguments,[d,g])},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},_setDisplayedValueAttr:function(f){null==f?f="":"string"!=
typeof f&&(f=String(f));this.textbox.value=f;this._setValueAttr(this.get("value"),void 0);this._set("displayedValue",this.get("displayedValue"))},format:function(f){return null==f?"":f.toString?f.toString():f},parse:function(f){return f},_refreshState:function(){},onInput:function(){},_onInput:function(f){this._lastInputEventValue=this.textbox.value;this._processInput(this._lastInputProducingEvent||f);delete this._lastInputProducingEvent;this.intermediateChanges&&this._handleOnChange(this.get("value"),
!1)},_processInput:function(){this._refreshState();this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);this.own(c(this.textbox,"keydown, keypress, paste, cut, compositionend",e.hitch(this,function(f){if("keydown"==f.type&&229!=f.keyCode){var g=f.keyCode;switch(g){case k.SHIFT:case k.ALT:case k.CTRL:case k.META:case k.CAPS_LOCK:case k.NUM_LOCK:case k.SCROLL_LOCK:return}if(!f.ctrlKey&&!f.metaKey&&
!f.altKey){switch(g){case k.NUMPAD_0:case k.NUMPAD_1:case k.NUMPAD_2:case k.NUMPAD_3:case k.NUMPAD_4:case k.NUMPAD_5:case k.NUMPAD_6:case k.NUMPAD_7:case k.NUMPAD_8:case k.NUMPAD_9:case k.NUMPAD_MULTIPLY:case k.NUMPAD_PLUS:case k.NUMPAD_ENTER:case k.NUMPAD_MINUS:case k.NUMPAD_PERIOD:case k.NUMPAD_DIVIDE:return}if(65<=g&&90>=g||48<=g&&57>=g||g==k.SPACE)return;g=!1;for(var h in k)if(k[h]===f.keyCode){g=!0;break}if(!g)return}}(g=32<=f.charCode?String.fromCharCode(f.charCode):f.charCode)||(g=65<=f.keyCode&&
90>=f.keyCode||48<=f.keyCode&&57>=f.keyCode||f.keyCode==k.SPACE?String.fromCharCode(f.keyCode):f.keyCode);g||(g=229);if("keypress"==f.type){if("string"!=typeof g)return;if("a"<=g&&"z">=g||"A"<=g&&"Z">=g||"0"<=g&&"9">=g||" "===g)if(f.ctrlKey||f.metaKey||f.altKey)return}var d={faux:!0},l;for(l in f)/^(layer[XY]|returnValue|keyLocation)$/.test(l)||(h=f[l],"function"!=typeof h&&"undefined"!=typeof h&&(d[l]=h));e.mixin(d,{charOrCode:g,_wasConsumed:!1,preventDefault:function(){d._wasConsumed=!0;f.preventDefault()},
stopPropagation:function(){f.stopPropagation()}});this._lastInputProducingEvent=d;!1===this.onInput(d)&&(d.preventDefault(),d.stopPropagation());if(!d._wasConsumed&&9>=m("ie"))switch(f.keyCode){case k.TAB:case k.ESCAPE:case k.DOWN_ARROW:case k.UP_ARROW:case k.LEFT_ARROW:case k.RIGHT_ARROW:break;default:f.keyCode==k.ENTER&&"textarea"!=this.textbox.tagName.toLowerCase()||this.defer(function(){this.textbox.value!==this._lastInputEventValue&&c.emit(this.textbox,"input",{bubbles:!0})})}})),c(this.textbox,
"input",e.hitch(this,"_onInput")),c(this.domNode,"keypress",function(f){f.stopPropagation()}))},_blankValue:"",filter:function(f){if(null===f)return this._blankValue;if("string"!=typeof f)return f;this.trim&&(f=e.trim(f));this.uppercase&&(f=f.toUpperCase());this.lowercase&&(f=f.toLowerCase());this.propercase&&(f=f.replace(/[^\s]+/g,function(g){return g.substring(0,1).toUpperCase()+g.substring(1)}));return f},_setBlurValue:function(){this._setValueAttr(this.get("value"),!0)},_onBlur:function(f){this.disabled||
(this._setBlurValue(),this.inherited(arguments))},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd},_onFocus:function(f){this.disabled||this.readOnly||(this.selectOnClick&&"mouse"==f&&(this._selectOnClickHandle=c.once(this.domNode,"mouseup, touchend",e.hitch(this,function(g){this._isTextSelected()||b.selectInputText(this.textbox)})),this.own(this._selectOnClickHandle),this.defer(function(){this._selectOnClickHandle&&(this._selectOnClickHandle.remove(),this._selectOnClickHandle=
null)},500)),this.inherited(arguments),this._refreshState())},reset:function(){this.textbox.value="";this.inherited(arguments)}});m("dojo-bidi")&&(b=n("dijit.form._TextBoxMixin",b,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_setDisplayedValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_onInput:function(){this.applyTextDir(this.focusNode);this.inherited(arguments)}}));b._setSelectionRange=a._setSelectionRange=function(f,g,
h){f.setSelectionRange&&f.setSelectionRange(g,h)};b.selectInputText=a.selectInputText=function(f,g,h){f=u.byId(f);isNaN(g)&&(g=0);isNaN(h)&&(h=f.value?f.value.length:0);try{f.focus(),b._setSelectionRange(f,g,h)}catch(d){}};return b})},"dijit/Tooltip":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff ./_base/manager ./place ./_Widget ./_TemplatedMixin ./BackgroundIframe dojo/text!./templates/Tooltip.html ./main".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v,r,w){function y(){}var z=n("dijit._MasterTooltip",[l,p],{duration:h.defaultDuration,templateString:r,postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.bgIframe=new v(this.domNode);this.fadeIn=u.fadeIn({node:this.domNode,duration:this.duration,onEnd:a.hitch(this,"_onShow")});this.fadeOut=u.fadeOut({node:this.domNode,duration:this.duration,onEnd:a.hitch(this,"_onHide")})},show:function(B,C,G,I,D,q,t){if(!this.aroundNode||this.aroundNode!==
C||this.containerNode.innerHTML!=B)if("playing"==this.fadeOut.status())this._onDeck=arguments;else{this.containerNode.innerHTML=B;D&&this.set("textDir",D);this.containerNode.align=I?"right":"left";var A=d.around(this.domNode,C,G&&G.length?G:E.defaultPosition,!I,a.hitch(this,"orient")),J=A.aroundNodePos;"M"==A.corner.charAt(0)&&"M"==A.aroundCorner.charAt(0)?(this.connectorNode.style.top=J.y+(J.h-this.connectorNode.offsetHeight>>1)-A.y+"px",this.connectorNode.style.left=""):"M"==A.corner.charAt(1)&&
"M"==A.aroundCorner.charAt(1)?this.connectorNode.style.left=J.x+(J.w-this.connectorNode.offsetWidth>>1)-A.x+"px":(this.connectorNode.style.left="",this.connectorNode.style.top="");c.set(this.domNode,"opacity",0);this.fadeIn.play();this.isShowingNow=!0;this.aroundNode=C;this.onMouseEnter=q||y;this.onMouseLeave=t||y}},orient:function(B,C,G,I,D){this.connectorNode.style.top="";var q=I.h;I=I.w;B.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove",
"BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[C+"-"+G];this.domNode.style.width="auto";var t=e.position(this.domNode);if(g("ie")||g("trident"))t.w+=2;e.setMarginBox(this.domNode,{w:Math.min(Math.max(I,1),t.w)});"B"==G.charAt(0)&&"B"==C.charAt(0)?(B=e.position(B),C=this.connectorNode.offsetHeight,
B.h>q?(this.connectorNode.style.top=q-(D.h+C>>1)+"px",this.connectorNode.style.bottom=""):(this.connectorNode.style.bottom=Math.min(Math.max(D.h/2-C/2,0),B.h-C)+"px",this.connectorNode.style.top="")):(this.connectorNode.style.top="",this.connectorNode.style.bottom="");return Math.max(0,t.w-I)},_onShow:function(){g("ie")&&(this.domNode.style.filter="")},hide:function(B){this._onDeck&&this._onDeck[1]==B?this._onDeck=null:this.aroundNode===B&&(this.fadeIn.stop(),this.isShowingNow=!1,this.aroundNode=
null,this.fadeOut.play());this.onMouseEnter=this.onMouseLeave=y},_onHide:function(){this.domNode.style.cssText="";this.containerNode.innerHTML="";this._onDeck&&(this.show.apply(this,this._onDeck),this._onDeck=null)}});g("dojo-bidi")&&z.extend({_setAutoTextDir:function(B){this.applyTextDir(B);H.forEach(B.children,function(C){this._setAutoTextDir(C)},this)},_setTextDirAttr:function(B){this._set("textDir",B);"auto"==B?this._setAutoTextDir(this.containerNode):this.containerNode.dir=this.textDir}});w.showTooltip=
function(B,C,G,I,D,q,t){G&&(G=H.map(G,function(A){return{after:"after-centered",before:"before-centered"}[A]||A}));E._masterTT||(w._masterTT=E._masterTT=new z);return E._masterTT.show(B,C,G,I,D,q,t)};w.hideTooltip=function(B){return E._masterTT&&E._masterTT.hide(B)};var E=n("dijit.Tooltip",l,{label:"",showDelay:400,hideDelay:400,connectId:[],position:[],selector:"",_setConnectIdAttr:function(B){H.forEach(this._connections||[],function(C){H.forEach(C,function(G){G.remove()})},this);this._connectIds=
H.filter(a.isArrayLike(B)?B:B?[B]:[],function(C){return m.byId(C,this.ownerDocument)},this);this._connections=H.map(this._connectIds,function(C){C=m.byId(C,this.ownerDocument);var G=this.selector,I=G?function(q){return f.selector(G,q)}:function(q){return q},D=this;return[f(C,I(b.enter),function(){D._onHover(this)}),f(C,I("focusin"),function(){D._onHover(this)}),f(C,I(b.leave),a.hitch(D,"_onUnHover")),f(C,I("focusout"),a.hitch(D,"set","state","DORMANT"))]},this);this._set("connectId",B)},addTarget:function(B){B=
B.id||B;-1==H.indexOf(this._connectIds,B)&&this.set("connectId",this._connectIds.concat(B))},removeTarget:function(B){B=H.indexOf(this._connectIds,B.id||B);0<=B&&(this._connectIds.splice(B,1),this.set("connectId",this._connectIds))},buildRendering:function(){this.inherited(arguments);k.add(this.domNode,"dijitTooltipData")},startup:function(){this.inherited(arguments);var B=this.connectId;H.forEach(a.isArrayLike(B)?B:[B],this.addTarget,this)},getContent:function(B){return this.label||this.domNode.innerHTML},
state:"DORMANT",_setStateAttr:function(B){if(!(this.state==B||"SHOW TIMER"==B&&"SHOWING"==this.state||"HIDE TIMER"==B&&"DORMANT"==this.state)){this._hideTimer&&(this._hideTimer.remove(),delete this._hideTimer);this._showTimer&&(this._showTimer.remove(),delete this._showTimer);switch(B){case "DORMANT":this._connectNode&&(E.hide(this._connectNode),delete this._connectNode,this.onHide());break;case "SHOW TIMER":"SHOWING"!=this.state&&(this._showTimer=this.defer(function(){this.set("state","SHOWING")},
this.showDelay));break;case "SHOWING":var C=this.getContent(this._connectNode);if(!C){this.set("state","DORMANT");return}E.show(C,this._connectNode,this.position,!this.isLeftToRight(),this.textDir,a.hitch(this,"set","state","SHOWING"),a.hitch(this,"set","state","HIDE TIMER"));this.onShow(this._connectNode,this.position);break;case "HIDE TIMER":this._hideTimer=this.defer(function(){this.set("state","DORMANT")},this.hideDelay)}this._set("state",B)}},_onHover:function(B){this._connectNode&&B!=this._connectNode&&
this.set("state","DORMANT");this._connectNode=B;this.set("state","SHOW TIMER")},_onUnHover:function(B){this.set("state","HIDE TIMER")},open:function(B){this.set("state","DORMANT");this._connectNode=B;this.set("state","SHOWING")},close:function(){this.set("state","DORMANT")},onShow:function(){},onHide:function(){},destroy:function(){this.set("state","DORMANT");H.forEach(this._connections||[],function(B){H.forEach(B,function(C){C.remove()})},this);this.inherited(arguments)}});E._MasterTooltip=z;E.show=
w.showTooltip;E.hide=w.hideTooltip;E.defaultPosition=["after-centered","before-centered"];return E})},"dijit/place":function(){define("dojo/_base/array dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/_base/window ./Viewport ./main".split(" "),function(H,n,u,m,k,e,c){function a(f,g,h,d){var l=e.getEffectiveBox(f.ownerDocument);f.parentNode&&"body"==String(f.parentNode.tagName).toLowerCase()||k.body(f.ownerDocument).appendChild(f);var p=null;H.some(g,function(w){var y=w.corner,z=w.pos,E=0,B=
{w:{L:l.l+l.w-z.x,R:z.x-l.l,M:l.w}[y.charAt(1)],h:{T:l.t+l.h-z.y,B:z.y-l.t,M:l.h}[y.charAt(0)]},C=f.style;C.left=C.right="auto";h&&(E=h(f,w.aroundCorner,y,B,d),E="undefined"==typeof E?0:E);var G=f.style,I=G.display,D=G.visibility;"none"==G.display&&(G.visibility="hidden",G.display="");C=n.position(f);G.display=I;G.visibility=D;I={L:z.x,R:z.x-C.w,M:Math.max(l.l,Math.min(l.l+l.w,z.x+(C.w>>1))-C.w)}[y.charAt(1)];D={T:z.y,B:z.y-C.h,M:Math.max(l.t,Math.min(l.t+l.h,z.y+(C.h>>1))-C.h)}[y.charAt(0)];z=Math.max(l.l,
I);G=Math.max(l.t,D);I=Math.min(l.l+l.w,I+C.w)-z;D=Math.min(l.t+l.h,D+C.h)-G;E+=C.w-I+(C.h-D);if(null==p||E<p.overflow)p={corner:y,aroundCorner:w.aroundCorner,x:z,y:G,w:I,h:D,overflow:E,spaceAvailable:B};return!E});p.overflow&&h&&h(f,p.aroundCorner,p.corner,p.spaceAvailable,d);g=p.y;var v=p.x,r=k.body(f.ownerDocument);/relative|absolute/.test(u.get(r,"position"))&&(g-=u.get(r,"marginTop"),v-=u.get(r,"marginLeft"));r=f.style;r.top=g+"px";r.left=v+"px";r.right="auto";return p}var b={TL:"BR",TR:"BL",
BL:"TR",BR:"TL"};return c.place={at:function(f,g,h,d,l){h=H.map(h,function(p){var v={corner:p,aroundCorner:b[p],pos:{x:g.x,y:g.y}};d&&(v.pos.x+="L"==p.charAt(1)?d.x:-d.x,v.pos.y+="T"==p.charAt(0)?d.y:-d.y);return v});return a(f,h,l)},around:function(f,g,h,d,l){function p(q,t){D.push({aroundCorner:q,corner:t,pos:{x:{L:B,R:B+G,M:B+(G>>1)}[q.charAt(1)],y:{T:C,B:C+I,M:C+(I>>1)}[q.charAt(0)]}})}if("string"==typeof g||"offsetWidth"in g||"ownerSVGElement"in g){var v=n.position(g,!0);if(/^(above|below)/.test(h[0])){var r=
n.getBorderExtents(g),w=g.firstChild?n.getBorderExtents(g.firstChild):{t:0,l:0,b:0,r:0},y=n.getBorderExtents(f),z=f.firstChild?n.getBorderExtents(f.firstChild):{t:0,l:0,b:0,r:0};v.y+=Math.min(r.t+w.t,y.t+z.t);v.h-=Math.min(r.t+w.t,y.t+z.t)+Math.min(r.b+w.b,y.b+z.b)}}else v=g;if(g.parentNode)for(r="absolute"==u.getComputedStyle(g).position,g=g.parentNode;g&&1==g.nodeType&&"BODY"!=g.nodeName;){w=n.position(g,!0);y=u.getComputedStyle(g);/relative|absolute/.test(y.position)&&(r=!1);if(!r&&/hidden|auto|scroll/.test(y.overflow)){z=
Math.min(v.y+v.h,w.y+w.h);var E=Math.min(v.x+v.w,w.x+w.w);v.x=Math.max(v.x,w.x);v.y=Math.max(v.y,w.y);v.h=z-v.y;v.w=E-v.x}"absolute"==y.position&&(r=!0);g=g.parentNode}var B=v.x,C=v.y,G="w"in v?v.w:v.w=v.width,I="h"in v?v.h:(m.deprecated("place.around: dijit/place.__Rectangle: { x:"+B+", y:"+C+", height:"+v.height+", width:"+G+" } has been deprecated.  Please use { x:"+B+", y:"+C+", h:"+v.height+", w:"+G+" }","","2.0"),v.h=v.height),D=[];H.forEach(h,function(q){var t=d;switch(q){case "above-centered":p("TM",
"BM");break;case "below-centered":p("BM","TM");break;case "after-centered":t=!t;case "before-centered":p(t?"ML":"MR",t?"MR":"ML");break;case "after":t=!t;case "before":p(t?"TL":"TR",t?"TR":"TL");p(t?"BL":"BR",t?"BR":"BL");break;case "below-alt":t=!t;case "below":p(t?"BL":"BR",t?"TL":"TR");p(t?"BR":"BL",t?"TR":"TL");break;case "above-alt":t=!t;case "above":p(t?"TL":"TR",t?"BL":"BR");p(t?"TR":"TL",t?"BR":"BL");break;default:p(q.aroundCorner,q.corner)}});f=a(f,D,l,{w:G,h:I});f.aroundNodePos=v;return f}}})},
"esri/OAuthSignInHandler":function(){define("./Credential ./domUtils ./lang ./urlUtils dijit/Dialog dijit/registry dojo/_base/config dojo/_base/Deferred dojo/_base/kernel dojo/dom-attr dojo/i18n!./nls/jsapi dojo/io-query dojo/sniff dojo/json dijit/form/Button dojo/query".split(" "),function(H,n,u,m,k,e,c,a,b,f,g,h,d,l){var p=null,v=null;try{p=window.localStorage,v=window.sessionStorage}catch(r){}return{_oAuthDfd:null,_oAuthIntervalId:0,_oAuthDialogContent:"\x3cdiv class\x3d'dijitDialogPaneContentArea'\x3e\x3cdiv style\x3d'padding-bottom: 5px; word-wrap: break-word;'\x3e${oAuthInfo}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriErrorMsg' style\x3d'display: none; color: white; background-color: #D46464; text-align: center; padding-top: 3px; padding-bottom: 3px;'\x3e${invalidUser}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitDialogPaneActionBar'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdSubmit\"'\x3e${lblOk}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdCancel\"'\x3e${lblCancel}\x3c/button\x3e\x3c/div\x3e",
setOAuthRedirectionHandler:function(r){this._oAuthRedirectFunc=r},oAuthSignIn:function(r,w,y,z){var E=this._oAuthDfd=new a;E.resUrl_=r;E.sinfo_=w;E.oinfo_=y;var B=!z||!1!==z.oAuthPopupConfirmation;if(!y.popup||!B)return this._doOAuthSignIn(r,w,y),E;this._nls||(this._nls=g.identity);this.oAuthDialog||(this.oAuthDialog=this._createOAuthDialog());r=this.oAuthDialog;y=z&&z.error;z=z&&z.token;n.hide(r.errMsg_);y&&403==y.code&&z&&(f.set(r.errMsg_,"innerHTML",this._nls.forbidden),n.show(r.errMsg_));f.set(r.serverLink_,
{title:w.server,innerHTML:-1!==w.server.toLowerCase().indexOf("arcgis.com")?"ArcGIS Online":w.server});r.show();return E},setOAuthResponseHash:function(r){var w=this._oAuthDfd;this._oAuthDfd=null;if(w&&r)if(clearInterval(this._oAuthIntervalId),"#"===r.charAt(0)&&(r=r.substring(1)),r=h.queryToObject(r),r.error){var y="access_denied"===r.error;r=Error(y?"ABORTED":"OAuth: "+r.error+" - "+r.error_description);r.name=y?"identity-manager:user-aborted":"identity-manager:authentication-failed";r.code="IdentityManagerBase."+
(y?2:3);r.log=!!c.isDebug;w.errback(r)}else{y=w.oinfo_._oAuthCred;var z=new H({userId:r.username,server:w.sinfo_.server,token:r.access_token,expires:(new Date).getTime()+1E3*Number(r.expires_in),ssl:"true"===r.ssl,_oAuthCred:y});y.storage=r.persist?p:v;y.token=z.token;y.expires=z.expires;y.userId=z.userId;y.ssl=z.ssl;y.save();w.callback(z)}},_createOAuthDialog:function(){var r=this._nls,w=u.substitute(r,this._oAuthDialogContent);w=u.substitute({server:"\x3cspan class\x3d'serverLink' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e"},
w);var y=new k({title:r.title,content:w,"class":"esriOAuthSignInDialog",style:"min-width: 18em;",esriIdMgr_:this,execute_:function(){var z=y.esriIdMgr_._oAuthDfd;y.hide_();y.esriIdMgr_._doOAuthSignIn(z.resUrl_,z.sinfo_,z.oinfo_)},cancel_:function(){var z=y.esriIdMgr_._oAuthDfd;y.esriIdMgr_._oAuthDfd=null;y.hide_();var E=Error("ABORTED");E.code="IdentityManager.2";E.log=!!c.isDebug;z.errback(E)},hide_:function(){n.hide(y.errMsg_);y.hide();k._DialogLevelManager.hide(y)}});r=y.domNode;y.btnSubmit_=e.byNode(b.query(".esriIdSubmit",
r)[0]);y.btnCancel_=e.byNode(b.query(".esriIdCancel",r)[0]);y.serverLink_=b.query(".serverLink",r)[0];y.errMsg_=b.query(".esriErrorMsg",r)[0];y.connect(y.btnSubmit_,"onClick",y.execute_);y.connect(y.btnCancel_,"onClick",y.onCancel);y.connect(y,"onCancel",y.cancel_);return y},_doOAuthSignIn:function(r,w,y){var z=this,E={portalUrl:y.portalUrl};!y.popup&&y.preserveUrlHash&&window.location.hash&&(E.hash=window.location.hash);E={client_id:y.appId,response_type:"token",state:l.stringify(E),expiration:y.expiration,
locale:y.locale,redirect_uri:y.popup?m.getAbsoluteUrl(y.popupCallbackUrl):window.location.href.replace(/#.*$/,"")};y.forceLogin&&(E.force_login=!0);!y.popup&&this._doPortalSignIn(r)&&(E.redirectToUserOrgUrl=!0);var B=y.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",C=B+"?"+h.objectToQuery(E);if(y.popup){if(7===d("ie")){var G=window.open(y.popupCallbackUrl,"esriJSAPIOAuth",y.popupWindowFeatures);G.location=C}else G=window.open(C,"esriJSAPIOAuth",y.popupWindowFeatures);G?(G.focus(),
this._oAuthDfd.oAuthWin_=G,this._oAuthIntervalId=setInterval(function(){if(G.closed){clearInterval(z._oAuthIntervalId);var I=z._oAuthDfd;if(I){var D=Error("ABORTED");D.code="IdentityManager.2";D.log=!!c.isDebug;I.errback(D)}}},500)):(r=Error("ABORTED"),r.name="identity-manager:user-aborted",r.code="IdentityManager.2",r.log=!!c.isDebug,this._oAuthDfd.errback(r))}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:E,authorizeUrl:B,resourceUrl:r,serverInfo:w,
oAuthInfo:y}):window.location=C}}})},"esri/layers/vectorTiles/core/workers/workerFactory":function(){define("require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../../request ../Logger ../promiseUtils ../sniff ../urlUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),function(H,n,u,m,k,e,c,a,b,f,g,h,d){function l(B){return a.create(function(C){function G(D){if(D=h.receiveMessage(D))switch(D.type){case E:D=B;var q=k.workers.loaderUrl||g.DEFAULT_LOADER_URL;if(null!=k["default"]){var t=
u({},k);delete t["default"];t=JSON.parse(JSON.stringify(t))}else t=JSON.parse(JSON.stringify(k));var A=k.workers.loaderConfig;A=g.default({baseUrl:A.baseUrl,locale:m.locale,has:u({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-cors":1,"esri-secure-context":b("esri-secure-context"),"esri-workers-supports-transfer-arraybuffer":b("esri-workers-supports-transfer-arraybuffer"),"events-keypress-typed":0,"host-webworker":1},A.has),map:u({},A.map),paths:u({},A.paths),packages:A.packages||[]});
D.postMessage({type:z,configure:{esriConfig:t,loaderUrl:q,loaderConfig:A}});break;case y:B.removeEventListener("message",G),B.removeEventListener("error",I),C(B)}}function I(D){D.preventDefault();B.removeEventListener("message",G);B.removeEventListener("error",I);r.warn("Failed to create Worker. Fallback to execute module in main thread",D);B=new d;B.addEventListener("message",G);B.addEventListener("error",I)}B.addEventListener("message",G);B.addEventListener("error",I)})}Object.defineProperty(n,
"__esModule",{value:!0});var p=f.normalize(H.toUrl("./worker.js")),v=!f.hasSameOrigin(p,location.href),r=c.getLogger("esri.core.workers"),w=null,y=h.MessageType.CONFIGURED,z=h.MessageType.CONFIGURE,E=h.MessageType.HANDSHAKE;n.createWorker=function(){if(!b("esri-workers"))return l(new d);if(!v){var B=void 0;try{B=new Worker(p)}catch(C){r.warn("Failed to create Worker. Fallback to execute module in main thread",event),B=new d}return l(B)}w||(w=e(p,{responseType:"text"}));return w.then(function(C){return new Worker(URL.createObjectURL(new Blob([C.data],
{type:"text/javascript"})))}).catch(function(C){r.warn("Failed to create Worker. Fallback to execute module in main thread",C);return new d}).then(function(C){return l(C)})}})},"esri/layers/vectorTiles/core/tsSupport/assignHelper":function(){define([],function(){return Object.assign||function(H){for(var n,u=1,m=arguments.length;u<m;u++){n=arguments[u];for(var k in n)Object.prototype.hasOwnProperty.call(n,k)&&(H[k]=n[k])}return H}})},"esri/layers/vectorTiles/config":function(){define(["require","exports",
"esri/config"],function(H,n,u){Object.defineProperty(u,"workers",{get:function(){return u.defaults.workers},set:function(m){return u.defaults.workers=m}});return u})},"esri/layers/vectorTiles/request":function(){define(["require","exports","esri/request","dojo/_base/lang","dojo/Deferred"],function(H,n,u,m,k){return function(e,c){e=m.mixin({},{url:e,failOk:!0},c);"array-buffer"===c.responseType?(e.handleAs="arraybuffer",delete e.responseType):c.responseType&&(e.handleAs=c.responseType,delete e.responseType);
null!==c.query&&(e.content=e.query,delete e.query);if(c.hasOwnProperty("allowImageDataAccess")){var a={allowImageDataAccess:c.allowImageDataAccess};delete e.allowImageDataAccess}var b=new k(function(){f.isFulfilled()||f.cancel()});var f=u(e,a).then(function(g){b.resolve({data:g})}).catch(function(g){g&&null!=g.httpCode&&(g.details=g.details||{},g.details.httpStatus=g.httpCode);b.reject(g)});return b.promise}})},"esri/layers/vectorTiles/core/sniff":function(){define(["require","exports","dojo/sniff",
"./global","../views/webgl/context-util"],function(H,n,u,m,k){function e(){var f={available:!1,version:0,majorPerformanceCaveat:!1,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1},g=document.createElement("canvas");if(!g)return f;var h=k.createContext(g,{failIfMajorPerformanceCaveat:!0},"webgl");!h&&(h=k.createContext(g,{},"webgl"))&&(f.majorPerformanceCaveat=!0);if(!h)return f;g=h.getParameter(h.VERSION);if(!g)return f;if(g=
g.match(/^WebGL\s+([\d.]*)/))f.version=parseFloat(g[1]),f.available=.94<=f.version,g=h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.HIGH_FLOAT),f.supportsHighPrecisionFragment=g&&0<g.precision,f.supportsVertexShaderSamplers=0<h.getParameter(h.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f.supportsElementIndexUint=null!==h.getExtension("OES_element_index_uint"),f.supportsStandardDerivatives=null!==h.getExtension("OES_standard_derivatives");return f}function c(){var f={available:!1,version:0},g=document.createElement("canvas");
if(!g)return f;g=k.createContext(g,{},"webgl2");if(!g)return f;f.available=!0;g=g.getParameter(g.VERSION);if(!g)return f;if(g=g.match(/^WebGL\s+([\d.]*)/))f.version=parseFloat(g[1]);return f}(function(){var f=navigator.userAgent,g=f.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i);f=f.match(/iPhone/i);g&&u.add("esri-mobile",g);f&&u.add("esri-iPhone",f);u.add("esri-phonegap",!!m.cordova);u.add("esri-cors",u("esri-phonegap")||"XMLHttpRequest"in m&&"withCredentials"in new XMLHttpRequest);
u.add("esri-geolocation",function(){return!!navigator.geolocation});u.add("esri-canvas-svg-support",function(){return!(u("trident")||u("ie"))});u.add("esri-secure-context",function(){if("isSecureContext"in m)return m.isSecureContext;if(m.location&&m.location.origin)return 0===m.location.origin.indexOf("https:")});u.add("esri-wasm","WebAssembly"in m);u("host-webworker")||(u.add("esri-workers","Worker"in m),u.add("esri-script-sandbox",function(){return"MessageChannel"in m&&"HTMLIFrameElement"in m&&
"sandbox"in HTMLIFrameElement.prototype}),u.add("esri-url-encodes-apostrophe",function(){var h=m.document.createElement("a");h.href="?'";return-1<h.href.indexOf("?%27")}),a||(a=e()),u.add("esri-webgl",a.available),u.add("esri-webgl-high-precision-fragment",a.supportsHighPrecisionFragment),u.add("esri-webgl-vertex-shader-samplers",a.supportsVertexShaderSamplers),u.add("esri-webgl-element-index-uint",a.supportsElementIndexUint),u.add("esri-webgl-standard-derivatives",a.supportsStandardDerivatives),
u.add("esri-webgl-major-performance-caveat",a.majorPerformanceCaveat),u.add("esri-featurelayer-webgl-labeling",!0),b||(b=c()),u.add("esri-webgl2",b.available))})();var a=null,b=null;return u})},"esri/layers/vectorTiles/core/global":function(){define(["require","exports"],function(H,n){return function(){if("undefined"!==typeof global)return global;if("undefined"!==typeof window)return window;if("undefined"!==typeof self)return self}()})},"esri/layers/vectorTiles/views/webgl/context-util":function(){define(["require",
"exports"],function(H,n){function u(c,a,b){void 0===a&&(a={});switch(b){case "webgl":var f=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case "webgl2":f=["webgl2"];break;default:f=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}b=null;for(var g=0;g<f.length;g++){var h=f[g];try{b=c.getContext(h,a)}catch(d){}if(b)break}return b}function m(c,a){(c=c.parentNode)&&(c.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
a+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}Object.defineProperty(n,"__esModule",{value:!0});n.createContextOrErrorHTML=function(c,a,b){void 0===a&&(a={});if(!window.WebGLRenderingContext)return m(c,k),null;a=u(c,a,b);return a?a:(m(c,e),null)};n.createContext=u;var k='This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e',e='It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'})},
"esri/layers/vectorTiles/core/urlUtils":function(){define(["require","exports","esri/urlUtils","dojo/_base/url"],function(H,n,u,m){function k(z){return u.normalize(z)}function e(z){return"data:"===z.slice(0,5)}function c(z){return a(z)||w.test(z)}function a(z){return z&&"/"===z[0]&&"/"===z[1]}function b(z){return u.urlToObject(z)}function f(z){if("string"===typeof z)return new m(h(z));z.scheme||(z.scheme=n.appUrl.scheme);return z}function g(z){if(e(z))return null;var E=z.indexOf("://");if(-1===E&&
a(z))E=2;else if(-1!==E)E+=3;else return null;E=z.indexOf("/",E);return-1===E?z:z.slice(0,E)}function h(z,E,B){void 0===E&&(E=n.appBaseUrl);if(a(z))return B&&B.preserveProtocolRelative?z:"http"===n.appUrl.scheme&&n.appUrl.authority===g(z).slice(2)?"http:"+z:"https:"+z;if(w.test(z))return z;"/"===z[0]&&(B=E.indexOf("//"),B=E.indexOf("/",B+2),E=-1===B?E:E.slice(0,B));return l(E,z)}function d(z,E,B){void 0===B&&(B=!1);z=f(z);E=f(E);return B||z.scheme===E.scheme?z.host.toLowerCase()===E.host.toLowerCase()&&
z.port===E.port:!1}function l(){for(var z=[],E=0;E<arguments.length;E++)z[E]=arguments[E];if(z&&z.length){E=[];if(c(z[0])){var B=z[0],C=B.indexOf("//");E.push(B.slice(0,C+1));r.test(z[0])&&(E[0]+="/");z[0]=B.slice(C+2)}else"/"===z[0][0]&&E.push("");z=z.reduce(function(G,I){return I?G.concat(I.split("/")):G},[]);for(B=0;B<z.length;B++)C=z[B],".."===C&&0<E.length?E.pop():!C||"."===C&&0!==E.length||E.push(C);return E.join("/")}}function p(z,E,B){if(!(E&&B&&z&&c(z)))return z;var C=z.indexOf("//"),G=z.indexOf("/",
C+2),I=z.indexOf(":",C+2);G=Math.min(0>G?z.length:G,0>I?z.length:I);if(z.slice(C+2,G).toLowerCase()!==E.toLowerCase())return z;E=z.slice(0,C+2);z=z.slice(G);return""+E+B+z}function v(z,E,B){void 0===E&&(E=n.appBaseUrl);if(!c(z))return z;var C=k(z),G=C.toLowerCase();E=k(E).toLowerCase().replace(/\/+$/,"");if((B=B?k(B).toLowerCase().replace(/\/+$/,""):null)&&0!==E.indexOf(B))return z;for(var I=function(t,A,J){J=t.indexOf(A,J);return-1===J?t.length:J},D=I(G,"/",G.indexOf("//")+2),q=-1;G.slice(0,D+1)===
E.slice(0,D)+"/";){q=D+1;if(D===G.length)break;D=I(G,"/",D+1)}if(-1===q||B&&q<B.length)return z;z=C.slice(q);C=E.slice(q-1).replace(/[^/]+/g,"").length;if(0<C)for(G=0;G<C;G++)z="../"+z;else z="./"+z;return z}Object.defineProperty(n,"__esModule",{value:!0});n.normalize=k;n.canUseXhr=function(z){return u.canUseXhr(z)};n.removeTrailingSlash=function(z){return z.replace(/\/+$/,"")};H=Function("return this")();n.appUrl=new m(H.location);n.appBaseUrl=function(){var z=n.appUrl.path;z=z.substring(0,z.lastIndexOf(z.split("/")[z.split("/").length-
1]));return n.appUrl.scheme+"://"+n.appUrl.host+(null!=n.appUrl.port?":"+n.appUrl.port:"")+z}();var r=/^\s*file:/i,w=/^\s*[a-z][a-z0-9-+.]*:[^0-9]/i;n.isDataProtocol=e;n.isAbsolute=c;n.isProtocolRelative=a;n.urlToObject=b;n.getOrigin=g;n.makeAbsolute=h;n.hasSameOrigin=d;n.join=l;n.removeFile=function(z){var E=0;if(c(z)){var B=z.indexOf("//");-1!==B&&(E=B+2)}B=z.lastIndexOf("/");return B<E?z:z.slice(0,B+1)};n.addProxy=function(z){return u.addProxy(z)};n.makeData=function(z){return z.isBase64?"data:"+
z.mediaType+";base64,"+z.data:"data:"+z.mediaType+","+z.data};var y=/^data:(.*?)(;base64)?,(.*)$/;n.dataComponents=function(z){return(z=z.match(y))?{mediaType:z[1],isBase64:!!z[2],data:z[3]}:null};n.changeDomain=p;n.read=function(z,E){var B=E&&E.url&&E.url.path;z&&B&&(z=h(z,B,{preserveProtocolRelative:!0}));(E=E&&E.portal)&&!E.isPortal&&E.urlKey&&E.customBaseUrl?(B=E.urlKey+"."+E.customBaseUrl,E=d(n.appUrl,n.appUrl.scheme+"://"+B)?p(z,E.portalHostname,B):p(z,B,E.portalHostname)):E=z;return E};n.write=
function(z,E){if(!z)return z;!c(z)&&E&&E.blockedRelativeUrls&&E.blockedRelativeUrls.push(z);var B=h(z);if(E){var C=E.verifyItemRelativeUrls&&E.verifyItemRelativeUrls.rootPath||E.url&&E.url.path;C&&(B=v(B,C,C),B!==z&&E.verifyItemRelativeUrls&&E.verifyItemRelativeUrls.writtenUrls.push(B))}z=B;B=(E=E&&E.portal)&&!E.isPortal&&E.urlKey&&E.customBaseUrl?p(z,E.urlKey+"."+E.customBaseUrl,E.portalHostname):z;return B};n.makeRelative=v;n.removeQueryParameters=function(z){z=b(z);Object.keys(z.query||{});return z.path}})},
"esri/layers/vectorTiles/core/workers/loaderConfig":function(){define(["require","exports","../tsSupport/assignHelper","dojo/has","../urlUtils"],function(H,n,u,m,k){Object.defineProperty(n,"__esModule",{value:!0});n.DEFAULT_LOADER_URL=k.makeAbsolute(k.removeQueryParameters(H.toUrl("./worker-init.js")));n.DEFAULT_CONFIG={baseUrl:function(){var e=k.removeQueryParameters(H.toUrl("dojo/x.js"));return k.makeAbsolute(e.slice(0,e.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},{name:"dstore"},
{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}};n.default=
function(e){var c={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:u({},e.has),map:u({},e.map),packages:e.packages&&e.packages.concat()||[],paths:u({},e.paths)};e.hasOwnProperty("async")||(c.async=!0);e.hasOwnProperty("isDebug")||(c.isDebug=!1);e.baseUrl||(c.baseUrl=n.DEFAULT_CONFIG.baseUrl);n.DEFAULT_CONFIG.packages.forEach(function(g){a:{for(var h=c.packages,d=0;d<h.length;d++)if(h[d].name===g.name)break a;g=u({},g);d=k.removeQueryParameters(H.toUrl(g.name+"/x.js"));d=d.slice(0,
d.length-5);g.location=k.makeAbsolute(d);h.push(g)}});e=c.map=c.map||{};for(var a=0,b=Object.keys(n.DEFAULT_CONFIG.map);a<b.length;a++){var f=b[a];e[f]||(e[f]=n.DEFAULT_CONFIG.map[f])}return c}})},"esri/layers/vectorTiles/core/workers/WorkerFallback":function(){define(["require","exports","dojo/has","../global","./utils"],function(H,n,u,m,k){var e=function(){return function(){var b=this,f=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(g){b[g]=
function(){for(var h=[],d=0;d<arguments.length;d++)h[d]=arguments[d];return f[g].apply(f,h)}})}}(),c=m.MutationObserver||m.WebKitMutationObserver,a=function(){if(m.process&&m.process.nextTick)var b=function(h){m.process.nextTick(h)};else if(m.Promise)b=function(h){m.Promise.resolve().then(h)};else if(c){var f=[],g=document.createElement("div");(new c(function(){for(;0<f.length;)f.shift()()})).observe(g,{attributes:!0});b=function(h){f.push(h);g.setAttribute("queueStatus","1")}}return b}();return function(){function b(){this._dispatcher=
new e;this._isInitialized=!1;this._workerPostMessage({type:k.MessageType.HANDSHAKE})}b.prototype.terminate=function(){};Object.defineProperty(b.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(f){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=f)&&this.addEventListener("message",f)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(f){this._onerrorHandler&&
this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=f)&&this.addEventListener("error",f)},enumerable:!0,configurable:!0});b.prototype.postMessage=function(f,g){var h=this;a(function(){h._workerMessageHandler(new MessageEvent("message",{data:f}))})};b.prototype.dispatchEvent=function(f){return this._dispatcher.dispatchEvent(f)};b.prototype.addEventListener=function(f,g,h){this._dispatcher.addEventListener(f,g,h)};b.prototype.removeEventListener=function(f,g,h){this._dispatcher.removeEventListener(f,
g,h)};b.prototype._workerPostMessage=function(f,g){var h=this;a(function(){h.dispatchEvent(new MessageEvent("message",{data:f}))})};b.prototype._workerMessageHandler=function(f){var g=this;if(f=k.receiveMessage(f)){var h=f.jobId;switch(f.type){case k.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:k.MessageType.CONFIGURED});break;case k.MessageType.OPEN:f=f.modulePath,u("esri-webpack")?H(["esri/core/workers/RemoteClient","esri/views/vectorTiles/WorkerTileHandler","esri/views/2d/layers/features/Pipeline",
"esri/views/3d/layers/PointCloudWorker","esri/views/3d/layers/SceneLayerWorker","esri/layers/graphics/sources/support/CSVSourceWorker","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker",f],function(d,l,p,v,r,w,y,z){switch(z){case "esri/views/vectorTiles/WorkerTileHandler":break;case "esri/views/2d/layers/features/Pipeline":l=p;break;case "esri/views/3d/layers/PointCloudWorker":l=v;break;case "esri/views/3d/layers/SceneLayerWorker":l=r;break;case "esri/layers/graphics/sources/support/CSVSourceWorker":l=
w;break;case "esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":l=y;break;default:l=z}d=d.connect(l);g._workerPostMessage({type:k.MessageType.OPENED,jobId:h,data:d})}):H(["./RemoteClient",f],function(d,l){d=d.connect(l);g._workerPostMessage({type:k.MessageType.OPENED,jobId:h,data:d})})}}};return b}()})},"esri/layers/vectorTiles/core/requireUtils":function(){define(["require","exports","dojo/Deferred"],function(H,n,u){function m(k,e){if(Array.isArray(e)){var c=new u;k(e,function(){for(var a=
[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.resolve(a)});return c.promise}return m(k,[e]).then(function(a){return a[0]})}Object.defineProperty(n,"__esModule",{value:!0});n.when=m;n.getAbsMid=function(k,e,c){return e.toAbsMid?e.toAbsMid(k):c.id.replace(/\/[^\/]*$/gi,"/")+k}})},"esri/layers/rasterLib/function/rasterFunctionHelper":function(){define(["dojo/_base/declare","dojo/_base/lang","./rasterFunctionRegistry"],function(H,n,u){return{create:function(m,k){if(m){var e=m.renderTexture,c=Object.keys(m);
if(m.read&&!k)return m;m.read&&k&&(m=m.toJson());-1<c.indexOf("name")&&c.indexOf(!1)?(m=n.mixin({},m),k=this._parseV2(m,k)):(m="esri.layers.RasterFunction"===m.declaredClass?m.toJson():n.mixin({},m),k=this._parseV1(m,k));k.branchCount=k.updateBranchStructure();k.renderTexture||(k.renderTexture=!!e);return k}},_parseV1:function(m,k){var e=m.rasterFunction,c=m.rasterFunctionArguments,a=m.renderTexture||m.rasterFunctionArguments.renderTexture||!1,b,f,g,h,d,l,p;(h=c.raster||c.Raster)&&h.rasterFunction&&
(b=this._parseV1(h,k));(h=c.raster2||c.Raster2)&&h.rasterFunction&&(f=this._parseV1(h,k));(h=c.rasters||c.Rasters)&&0<h.length&&(g=h.map(n.hitch(this,function(v){return v&&v.rasterFunction?this._parseV1(v,k):v})));(h=c.dem||c.DEM)&&(h.functionName||h.rasterFunction)&&(d=this._parseV1(h,k));(h=c.fillRaster||c.FillRaster)&&(h.functionName||h.rasterFunction)&&(l=this._parseV1(h,k));h=u.functions[e];if(!h)return console.error("Function is not currently supported: "+e),null;e=new h(c);e.variableName&&
(h=c[e.variableName])&&(h.functionName||h.rasterFunction)&&(p=this._parseV1(h,k));m.outputPixelType&&(e.pixelType=m.outputPixelType);"$$"===b?e.functionArguments.raster=k&&k.raster:null!=b?e.functionArguments.raster=b:e.functionArguments.raster||(e.functionArguments.raster=k&&k.raster);null!=f&&(e.functionArguments.raster2=f);null!=g&&(e.functionArguments.rasters=g.map(function(v){"$$"===v&&(v=k&&k.raster);return v}));null!=d&&(e.functionArguments.dem=d);null!=l&&(e.functionArguments.fillRaster=l);
null!=p&&(e.functionArguments[e.variableName]=p);e.renderTexture=a;return e},_parseV2:function(m,k){if(!m)return null;m=n.clone(m);this._bindV2Args(m,k);var e={};this._convertTov1(m,e);return this._parseV1(e,k)},_bindV2Args:function(m,k){(m||k)&&Object.keys(m).forEach(function(e){m[e]["function"]&&m[e].arguments?this._bindV2Args(m[e].arguments,k):null!=k[m[e].name]&&(m[e].value=k[m[e].name])}.bind(this))},_convertV2Types:function(m){if(!m)return null;"ArgumentArray"===m.type?m.elements&&"RasterStatistics"===
m.elements[0].type&&(m=m.elements):m instanceof Array&&0===m.length&&(m=null);return m},_convertTov1:function(m,k){if((m||k)&&m["function"]){var e=m["function"],c=m.arguments;k.rasterFunction=e.type.replace("Function","");k.outputPixelType="UNKNOWN"===e.pixelType?"Unknown":e.pixelType;k.rasterFunctionArguments={};var a;Object.keys(c).forEach(function(b){c[b]["function"]&&c[b].arguments?(k.rasterFunctionArguments[b]={},this._convertTov1(c[b],k.rasterFunctionArguments[b])):(a=c[b].value,k.rasterFunctionArguments[b]=
"object"!==typeof a||a.functionArguments?a:this._convertV2Types(a))}.bind(this))}}}})},"esri/layers/rasterLib/function/rasterFunctionRegistry":function(){define("dojo/_base/declare dojo/_base/lang ../../rasterLib/function/AspectFunction ../../rasterLib/function/BandArithmeticFunction ../../rasterLib/function/ColormapFunction ../../rasterLib/function/CompositeBandFunction ../../rasterLib/function/ContrastBrightnessFunction ../../rasterLib/function/ConvolutionFunction ../../rasterLib/function/ExtractBandFunction ../../rasterLib/function/HillshadeFunction ../../rasterLib/function/LocalFunction ../../rasterLib/function/MaskFunction ../../rasterLib/function/NDVIFunction ../../rasterLib/function/SlopeFunction ../../rasterLib/function/StretchFunction ../../rasterLib/function/RemapFunction ../../rasterLib/function/IdentityFunction ../../rasterLib/function/ResampleFunction".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v,r,w){return function(){function y(C){C.prototype.supportWebGL&&(E[C.prototype.functionName]=C);C.prototype.support2D&&(z[C.prototype.functionName]=C);B[C.prototype.functionName]=C}var z={},E={},B={};y(u);y(m);y(k);y(e);y(c);y(a);y(b);y(f);y(g);y(h);y(d);y(l);y(p);y(v);y(r);y(w);return{cpu:z,gpu:E,functions:B,register:y,getFunction:function(C){return B[C]},support:function(C,G){return!!("gpu"===G?E:"cpu"===G?z:B)[C]}}}()})},"esri/layers/rasterLib/function/AspectFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),
function(H,n,u,m,k,e,c,a){return H([u,c],{declaredClass:"esri.layers.rasterLib.function.AspectFunction",functionName:"Aspect",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({raster:null},b)},bind:function(){var b=this.getSourceRasterInfo();if(!b.raster)return Error("The raster input to aspect function is invalid.");this.rasterInfo=n.mixin(b.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:[{min:0,max:360}],histograms:null});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(b){this._performance.start();b=a.aspect(b.raster);this._addPerformanceMetric(this._performance.elapsed());return b},readGL:function(b){this._performance.start();this._initializeProgram({fragment:e.aspect,fragmentName:"Aspect"});var f=this._setupTextureData(b.raster),g=this.bindFrameBuffer(),h=this.gl,d=h.drawingBufferWidth;h=h.drawingBufferHeight;var l=f.extent;
this._setUniforms({u_resolution:b&&b.raster&&b.raster.pixelBlock?[1/b.raster.pixelBlock.width,1/b.raster.pixelBlock.height]:[1/d,1/h],u_cellSize:[(l.xmax-l.xmin)/d,(l.ymax-l.ymin)/h]});this._bindTexture(f.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:g.texture}}})})},"esri/layers/rasterLib/function/RasterFunctionX":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/config ../raster/RasterInfo ../../../geometry/Extent ../../PixelBlock".split(" "),
function(H,n,u,m,k,e){return H(null,{functionName:null,functionArguments:null,pixelType:"Unknown",rasterInfo:null,constructor:function(c){c&&(this.pixelType=c.outputPixelType||c.OutputPixelType||this.pixelType,this.renderTexture=c.renderTexture,this._initFunction())},mixinIgnoreCase:function(c,a){var b=Object.keys(c),f=Object.keys(a),g,h,d=b.length;for(g=0;g<f.length;g++){var l=a[f[g]];if(null!=l)for(h=0;h<d;h++)if(b[h].toLowerCase()===f[g].toLowerCase()){c[b[h]]=l;break}}return c},bind:function(c){},
setProcessingContext:function(c){if(!c)throw"cannot bind to layer without options";this.useWebGL=!!c.useWebGL;this._tileMode=!!c.tileMode;this._glSetting=c.glSetting;this._rawRasterInfo=c.rawRasterInfo;this._xformSetting=c.xformSetting||this._xformSetting;if(!this.useWebGL||this._glSetting&&this._glSetting.gl){this.gl=this.useWebGL?this._glSetting.gl:null;this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null);var a=this.functionArguments.raster,b=this.functionArguments.raster2,
f=this.functionArguments.dem,g=this.functionArguments.fillRaster,h=this.functionArguments.rasters;a&&a.functionArguments&&a.setProcessingContext(c);b&&b.functionArguments&&b.setProcessingContext(c);f&&f.functionArguments&&f.setProcessingContext(c);g&&g.functionArguments&&g.setProcessingContext(c);if(h)for(a=0;a<h.length;a++)h[a]&&h[a].functionArguments&&h[a].setProcessingContext(c);this.bind()}},updateBranchStructure:function(){var c=0,a=this.functionArguments;a.raster&&a.raster.read&&a.raster.functionArguments&&
(c+=a.raster.updateBranchStructure());a.raster2&&a.raster2.read&&a.raster2.functionArguments&&(c+=a.raster2.updateBranchStructure(),a.raster2.isBranch=!0,a.raster&&a.raster.read&&(a.raster.isBranch=!0));a.rasters&&(c=a.rasters.length,a.rasters.forEach(function(b){b.read&&b.functionArguments&&(b.isBranch=!0)}));a.dem&&a.dem.read&&a.dem.functionArguments&&(c+=a.dem.updateBranchStructure());return 1===c?0:c},read:function(c){c=this.processRasterArgument(c);return this.useWebGL?this.readGL(c):this.read2D(c)},
hasTilingEffects:function(){return!1},read2D:function(){},readGL:function(){},getSourceRasterInfo:function(){var c,a={};if(this.functionArguments.raster2)a.functionArguments.raster=this._bindRaster(this.functionArguments.raster),a.functionArguments.raster2=this._bindRaster(this.functionArguments.raster2);else if(this.functionArguments.rasters)for(a.rasters=[],c=0;c<this.functionArguments.rasters.length;c++)a.rasters[c]=this._bindRaster(this.functionArguments.rasters[c]);else a.raster=this._bindRaster(this.functionArguments.raster);
return this.sourceRasterInfo=a},processRasterArgument:function(c){var a=this.bind();if(!0!==a)throw a;var b={};if(this.functionArguments.raster2)b.raster=this._readRaster(this.functionArguments.raster,c),b.raster2=this._readRaster(this.functionArguments.raster2,c);else if(this.functionArguments.rasters)for(b.rasters=[],a=0;a<this.functionArguments.rasters.length;a++)b.rasters[a]=this._readRaster(this.functionArguments.rasters[a],c);else b.raster=this._readRaster(this.functionArguments.raster,c);return b},
toJson:function(){var c=this.functionArguments,a=c.raster,b=c.raster2;c=c.rasters;a=a?a.toJson?a.toJson():a:null;b=b?b.toJson?b.toJson():b:null;var f;c&&0<c.length&&(f=c.map(function(g){return g.toJson?g.toJson():g}));c=n.mixin({},this.functionArguments);c.raster=a;c.raster2=b;c.rasters=f;c=this._fixRasterFunctionJson(c);return{rasterFunction:this.functionName,rasterFunctionArguments:c,outputPixelType:this.pixelType}},_initFunction:function(c){},_getIntegerRange:function(c){switch(c){case "U8":var a=
[0,255];break;case "U16":a=[0,65535];break;case "U32":a=[0,4294967295];break;case "S8":a=[-128,127];break;case "S16":a=[-32768,32767];break;case "S32":a=[-2147483648,2147483647]}return a},_calculatePixelType:function(c,a){return c&&"unknown"!==c.toLowerCase()?c:a},_clonePixelData:function(c){if(null==c)return c;var a={};c.extent&&(a.extent=new k(c.extent.xmin,c.extent.ymin,c.extent.xmax,c.extent.ymax,c.extent.spatialReference));c=c.pixelBlock;if(null==c)return a;a.pixelBlock=c.clone?c.clone():e.prototype.clone(c);
return a},_readRaster:function(c,a){if(null==c||"$$"===c)var b=this._clonePixelData(a.src[Object.keys(a.src)[0]]);else c&&c.rasterInfo&&!c.functionArguments?b=this._clonePixelData(a.src[c._rasterId]):isNaN(c)?c.read&&(b=c.functionArguments?c.read(a):this._clonePixelData(a)):(b=a.src?a.src[Object.keys(a.src)[0]]:a,a=b.pixelBlock,a=new Float32Array(a.width*a.height),a.fill(parseFloat(c)),b=this._clonePixelData(b),b.pixelBlock.pixels=[a],b.isConstant=!0);return b},_bindRaster:function(c){if(c&&"$$"!==
c)isNaN(c)?c.rasterInfo?a=c.rasterInfo:c.bind&&c.bind()&&(a=c.rasterInfo):a={};else var a=this._rawRasterInfo;a&&(a=a.clone?a.clone():new m(a),a.bandCount=a.bandCount||3);return a},_getOutputBand:function(c,a){switch(c){case "U8":c=new Uint8Array(a);break;case "U16":c=new Uint16Array(a);break;case "U32":c=new Uint32Array(a);break;case "S8":c=new Int8Array(a);break;case "S16":c=new Int16Array(a);break;case "S32":c=new Int32Array(a);break;case "U32":c=new Uint32Array(a);break;case "F32":c=new Float32Array(a);
break;case "F64":c=new Float64Array(a);break;default:c=new Float32Array(a)}return c},_clampBand:function(c,a,b){if(("F64"===a||"F32"===a)&&!b)return c;var f,g=this._getIntegerRange(a),h=c.length;if(g)for(b=g[1],g=g[0],a=this._getOutputBand(a,h),f=0;f<h;f++){var d=c[f];a[f]=d>b?b:d<g?g:d}else a=c;return a},_performance:{start:function(){return this._start=self.performance&&self.performance.now()||new Date}.bind(this),elapsed:function(){return(self.performance&&self.performance.now()||new Date)-this._start}.bind(this)},
_addPerformanceMetric:function(c){u.isDebug&&(self.rasterFunctionPerformance||(self.rasterFunctionPerformance=[]),self.rasterFunctionPerformance.push(c),50<self.rasterFunctionPerformance.length&&self.rasterFunctionPerformance.shift())},_fixRasterFunctionJson:function(c){for(var a in c)c.hasOwnProperty(a)&&(null==c[a]?delete c[a]:c[a]instanceof Object&&!c[a].sourceType&&this._fixRasterFunctionJson(c[a],!0));return c}})})},"esri/layers/rasterLib/function/pixelShaders":function(){define(["dojo/_base/declare",
"dojo/_base/lang","./pixelShaderScripts"],function(H,n,u){H={shaderType:"fragment",getShader:function(m,k){var e=m.createShader(m.FRAGMENT_SHADER);m.shaderSource(e,k);m.compileShader(e);m.getShaderParameter(e,m.COMPILE_STATUS)||(e=null);return e}};n.mixin(H,u);return H})},"esri/layers/rasterLib/function/pixelShaderScripts":function(){define([],function(){return{aspect:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nfloat pi \x3d 3.141592653589793238;\nfloat dz_dx \x3d 0.0;\nfloat dz_dy \x3d 0.0;\nvec4 va, vb, vc,vd,ve,vf,vg,vh,vi;\nvec2 axy \x3d vec2(-1.0,-1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s)\n{\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t)\n{\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e1.0-u_resolution.s)\n{\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0- u_resolution.t)\n{\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0-u_resolution.s)\x3e\x3dv_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0-u_resolution.t)\x3e\x3dv_texCoord.t)\n{\nva \x3d texture2D(u_image, v_texCoord + u_resolution* axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution* bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution* cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution* dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution* vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution* fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution* gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution* hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution* ixy);\n}\ndz_dx \x3d (vc+2.0*vf+vi - va - 2.0*vd - vg).r/(8.0*u_cellSize[0]);\ndz_dy \x3d -(vg+2.0*vh+vi - va - 2.0*vb - vc).r/(8.0*u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat aspect_rad \x3d 0.0;\nif (dz_dx \x3d\x3d 0.0)\n{\nif (dz_dy \x3e 0.0)\naspect_rad \x3d 0.5 * pi;\nelse if (dz_dy \x3c 0.0)\naspect_rad \x3d 1.5 * pi;\nelse\nalpha \x3d 0.0;//undefined make it nodata\n}\nelse\n{\naspect_rad \x3d 0.5*pi + atan(dz_dy, -dz_dx);\nif (aspect_rad \x3c 0.0)\naspect_rad \x3d 2.0*pi + aspect_rad;\n}\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, alpha);\n}",
bandArithmetic:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_nir;\nuniform int u_bandId_red;\nuniform bool u_scaled;\nuniform int u_bandCount;\nuniform int u_method;\nuniform float u_constants[6];\nvec4 calculateNDVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n} else {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nvec4 calculateSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat savi_denom \x3d nir + red + u_constants[0];\nfloat savi;\nif (savi_denom \x3d\x3d 0.0) {\nsavi \x3d 0.0;\n} else {\nsavi \x3d (nir - red) / savi_denom * (1.0 + u_constants[0]);\n}\nreturn vec4(savi, savi, savi, currentPixel.a);\n}\nvec4 calculateMSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat msavi \x3d 0.5 * (2.0 * (nir + 1.0) - sqrt(pow((2.0 * nir + 1.0), 2.0) - 8.0 * (nir - red)));\nreturn vec4(msavi, msavi, msavi, currentPixel.a);\n}\nvec4 calculateTSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat s \x3d u_constants[0];\nfloat a \x3d u_constants[1];\nfloat x \x3d u_constants[2];\nfloat tsavi_denom \x3d a * nir + red - a * s + x * (1.0 + s * s);\nfloat tsavi;\nif (tsavi_denom \x3d\x3d 0.0) {\ntsavi \x3d 0.0;\n} else {\ntsavi \x3d s * (nir - s * red - a) / tsavi_denom;\n}\nreturn vec4(tsavi, tsavi, tsavi, currentPixel.a);\n}\nvec4 calculatePVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat a \x3d u_constants[0];\nfloat b \x3d u_constants[1];\nfloat pvi \x3d (nir - a * red - b) / sqrt(1.0 + a * 2.0);\nreturn vec4(pvi, pvi, pvi, currentPixel.a);\n}\nvec4 calculateGEMI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat gemi;\nif (red \x3d\x3d 1.0) {\ngemi \x3d 0.0;\n} else {\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) / (nir + red + 0.5);\nfloat gemi \x3d eta * (1.0 - 0.25*eta) - (red - 0.125) / (1.0 - red);\n}\nreturn vec4(gemi, gemi, gemi, currentPixel.a);\n}\nvec4 calculateVARI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(currentPixel.r);\nfloat green \x3d float(currentPixel.g);\nfloat blue \x3d float(currentPixel.b);\nfloat vari \x3d (green - red) /(green + red - blue);\nreturn vec4(vari, vari, vari, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 pv;\nif (u_method \x3c 4) {\nif (u_method \x3d\x3d 1) {\npv \x3d calculateNDVI();\n} else if (u_method \x3d\x3d 2) {\npv \x3d calculateSAVI();\n} else if (u_method \x3d\x3d 3) {\npv \x3d calculateTSAVI();\n} else if (u_method \x3d\x3d 4) {\npv \x3d calculateMSAVI();\n}\n} else {\nif (u_method \x3d\x3d 5) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 6) {\npv \x3d calculatePVI();\n} else if (u_method \x3d\x3d 7) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 9) {\npv \x3d calculateVARI();\n}\n}\ngl_FragColor \x3d pv;\n}",
colormap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nvec4 colorize() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat clrIndex \x3d currentPixel.r - u_indexedColormapOffset;\nvec4 result;\nif (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d colorize();\n}",
compositeBand:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 composite() {\nvec4 p0, p1, p2;\np0 \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nif (u_rasterCount \x3d\x3d 1){\nresult \x3d p0;\n}\nelse if (u_rasterCount \x3d\x3d 2){\np1 \x3d texture2D(u_image1, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,0.0,min(p0.a,p1.a));\n}\nelse if (u_rasterCount \x3d\x3d 3){\np1 \x3d texture2D(u_image1, v_texCoord);\np2 \x3d texture2D(u_image2, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,p2.r,min(min(p0.a,p1.a),p2.a));\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d composite();\n}",
constant:"precision mediump float;\nuniform vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}",contrastBrightness:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nuniform float u_scaleFactor;\nvec4 adjustContrastBrightness() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0; //binary contrast with extra mid tone at 0.5\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a); //no contrast\n}\nreturn vec4(v.r / u_scaleFactor, v.g / u_scaleFactor, v.b / u_scaleFactor, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d adjustContrastBrightness();\n}",
convolution:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform float u_kernel[25];\nuniform int u_kernelSize;\nvec4 convolve33(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nvec2 xy11 \x3d vec2(-1.0, -1.0);\nvec2 xy12 \x3d vec2(0.0, -1.0);\nvec2 xy13 \x3d vec2(1.0, -1.0);\nvec2 xy21 \x3d vec2(-1.0, 0.0);\nvec2 xy23 \x3d vec2(1.0, 0.0);\nvec2 xy31 \x3d vec2(-1.0, 1.0);\nvec2 xy32 \x3d vec2(0.0, 1.0);\nvec2 xy33 \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\nxy11[0] \x3d 1.0;\nxy21[0] \x3d 1.0;\nxy31[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\nxy11[1] \x3d 1.0;\nxy12[1] \x3d 1.0;\nxy13[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxy13[0] \x3d -1.0;\nxy23[0] \x3d -1.0;\nxy33[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nxy31[1] \x3d -1.0;\nxy32[1] \x3d -1.0;\nxy33[1] \x3d -1.0;\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * xy11) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * xy12) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * xy13) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * xy21) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(0, 0)) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * xy23) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * xy31) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * xy32) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * xy33) * u_kernel[8];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nvec4 convolve55(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nfloat xdif[5];//https://www.opengl.org/wiki/Data_Type_(GLSL) array constructor ES3.0\nfloat ydif[5];\nfloat a \x3d -2.0;\nfor (int i\x3d0; i\x3c5; i++){\nxdif[i] \x3d a;\nydif[i] \x3d a;\na++;\n}\nif (v_texCoord.s \x3c u_resolution.s *2.0) { //2 pixel\nxdif[0] \x3d 2.0;\nif (v_texCoord.s \x3c u_resolution.s) { //1 pixel\nxdif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.s \x3e 1.0 - u_resolution.s *2.0) {\nxdif[0] \x3d -2.0;\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxdif[1] \x3d -1.0;\n}\n}\nif (v_texCoord.t \x3c u_resolution.t *2.0) {\nydif[0] \x3d 2.0;\nif (v_texCoord.t \x3c u_resolution.t) {\nydif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.t \x3e 1.0 - u_resolution.t*2.0) {\nydif[0] \x3d -2.0;\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nydif[1] \x3d -1.0;\n}\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[0])) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[0])) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[0])) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[0])) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[0])) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[1])) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[1])) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[1])) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[1])) * u_kernel[8] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[1])) * u_kernel[9] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[2])) * u_kernel[10] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[2])) * u_kernel[11] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[2])) * u_kernel[12] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[2])) * u_kernel[13] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[2])) * u_kernel[14] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[3])) * u_kernel[15] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[3])) * u_kernel[16] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[3])) * u_kernel[17] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[3])) * u_kernel[18] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[3])) * u_kernel[19] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[4])) * u_kernel[20] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[4])) * u_kernel[21] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[4])) * u_kernel[22] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[4])) * u_kernel[23] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[4])) * u_kernel[24];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_kernelSize \x3d\x3d 9){\ngl_FragColor \x3d convolve33();\n}\nelse {\ngl_FragColor \x3d convolve55();\n}\n}",
extractBand:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandIDs[3];\nuniform bool u_alterBand;\nvec4 extractBand() {\nvec4 p \x3d texture2D(u_image, v_texCoord);\nif (!u_alterBand){\nreturn p;\n}\nfloat r, g, b;\nif (u_bandIDs[0] \x3d\x3d0){\nr \x3d p.r;\n}\nelse if (u_bandIDs[0] \x3d\x3d1){\nr \x3d p.g;\n}\nelse if (u_bandIDs[0] \x3d\x3d2){\nr \x3d p.b;\n}\nif (u_bandIDs[1] \x3d\x3d0){\ng \x3d p.r;\n}\nelse if (u_bandIDs[1] \x3d\x3d1){\ng \x3d p.g;\n}\nelse if (u_bandIDs[1] \x3d\x3d2){\ng \x3d p.b;\n}\nif (u_bandIDs[2] \x3d\x3d0){\nb \x3d p.r;\n}\nelse if (u_bandIDs[2] \x3d\x3d1){\nb \x3d p.g;\n}\nelse if (u_bandIDs[2] \x3d\x3d2){\nb \x3d p.b;\n}\nreturn vec4(r, g, b, p.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d extractBand();\n}",
hillshade:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform int u_slopeType;\nuniform int u_hillshadeType;\nuniform int u_lightSourceCount;\nuniform float u_sinZcosA;\nuniform float u_sinZsinA;\nuniform float u_cosZ;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform float u_xFactor;\nuniform float u_yFactor;\nuniform bool u_scaled;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform bool u_applyColorramp;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\nfloat clrIndex \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d texture2D(u_image1, vec2(clrIndex, 0.0));\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv) * alpha, alpha);\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 va, vb, vc, vd, ve, vf, vg, vh, vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_xFactor;\nfloat dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_yFactor; //flip\nfloat s2 \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinA * dzy - u_sinZcosA * dzx;\nfloat z \x3d (u_cosZ + cosDelta) / s2;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n}\nelse if (u_hillshadeType \x3d\x3d 1){\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / s2;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d u_lightSourceCount-1) break;\n}\n}\nif (u_applyColorramp) {\nvec4 result \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);\nif (u_scaled) {\nresult \x3d vec4(result.rgb * 255.0, result.a);\n}\ngl_FragColor \x3d result;\n} else {\nif (u_scaled) {\nhillshade \x3d hillshade * 255.0;\nif (hillshade\x3e 255.0) {\nhillshade \x3d 255.0;\n}\n}\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n}\n}",
identity:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandCount;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d  texture2D(u_image, v_texCoord);\ngl_FragColor \x3d vec4( currentPixel.rgb, currentPixel.a); //encode_float(currentPixel.r);\n}",
local:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 polyfill;\nvec4 localOp1() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nvec4 replaceme1;\nreturn result;\n}\nvec4 localOp2() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 result;\nvec4 replaceme2;\nreturn result;\n}\nvec4 localOp3() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 c \x3d texture2D(u_image2, v_texCoord);\nvec4 result;\nvec4 replaceme3;\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d localOp1();\n}",
local0:"precision mediump float;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_operation;\nuniform int u_constant[3];\nuniform vec4 gamma;\nfloat localOperate1(float a, float b, float c){\nfloat result;\nif (u_operation \x3d\x3d 1){\nresult \x3d a + b;\n}\nelse if (u_operation \x3d\x3d 2){\nresult \x3d a - b;\n}\nelse if (u_operation \x3d\x3d3){\nresult \x3d a * b;\n}\nelse if (u_operation \x3d\x3d4){\nresult \x3d sqrt(a);\n}\nelse if (u_operation \x3d\x3d5){\nresult \x3d pow(a, b);\n}\nelse if (u_operation \x3d\x3d6){\nresult \x3d acos(a);\n}\nelse if (u_operation \x3d\x3d7){\nresult \x3d asin(a);\n}\nelse if (u_operation \x3d\x3d8){\nresult \x3d atan(a);\n}\nelse if (u_operation \x3d\x3d9){\nresult \x3d 999.0; //atanh not available\n}\nelse if (u_operation \x3d\x3d10){\nresult \x3d abs(a);\n}\nelse if (u_operation \x3d\x3d13){\nresult \x3d 999.0; //bitwise not available\n}\nelse if (u_operation \x3d\x3d17){\nresult \x3d a !\x3d 0.0 \x26\x26 b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d18){\nresult \x3d a \x3d\x3d0.0? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d19){\nresult \x3d a !\x3d 0.0 || b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d20){\nresult \x3d a !\x3d 0.0 ^^ b !\x3d0.0; //exclusive or\n}\nelse if (u_operation \x3d\x3d21){\nresult \x3d cos(a);\n}\nelse if (u_operation \x3d\x3d23){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d24){\nresult \x3d a \x3d\x3d b ? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d25){\nresult \x3d exp(a);\n}\nelse if (u_operation \x3d\x3d26){\nresult \x3d pow(10.0, a);\n}\nelse if (u_operation \x3d\x3d27){\nresult \x3d exp2(a);\n}\nelse if (u_operation \x3d\x3d28){\nresult \x3d a \x3e b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d29){\nresult \x3d  a \x3e\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d30){\nresult \x3d floor(a); //int\n}\nelse if (u_operation \x3d\x3d31){\nresult \x3d a \x3d\x3d0? 1.0:0.0; //null pass mask\n}\nelse if (u_operation \x3d\x3d32){\nresult \x3d a; //float\n}\nelse if (u_operation \x3d\x3d33){\nresult \x3d a \x3c b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d34){\nresult \x3d a \x3c\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d35){\nresult \x3d log(a);\n}\nelse if (u_operation \x3d\x3d36){\nresult \x3d log2(a) / log2(10.0);\n}\nelse if (u_operation \x3d\x3d37){\nresult \x3d log2(a);\n}\nelse if (u_operation \x3d\x3d44){\nresult \x3d mod(a, b);\n}\nelse if (u_operation \x3d\x3d45){\nresult \x3d -a;\n}\nelse if (u_operation \x3d\x3d46){\nresult \x3d a !\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d48){\nresult \x3d ceil(a);\n}\nelse if (u_operation \x3d\x3d49){\nresult \x3d floor(a);\n}\nelse if (u_operation \x3d\x3d51){\nresult \x3d sin(a);\n}\nelse if (u_operation \x3d\x3d53){\nresult \x3d a * a;\n}\nelse if (u_operation \x3d\x3d56){\nresult \x3d tan(a);\n}\nelse if (u_operation \x3d\x3d57){\nresult \x3d 999.0; //tanh not available\n}\nelse if (u_operation \x3d\x3d59){\nresult \x3d 999.0; //acosh not available\n}\nelse if (u_operation \x3d\x3d60){\nresult \x3d 999.0; //asinh not available\n}\nelse if (u_operation \x3d\x3d61){\nresult \x3d atan(a, b);\n}\nelse if (u_operation \x3d\x3d64){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d65){\nresult \x3d floor(a/b);\n}\nelse if (u_operation \x3d\x3d76){\nresult \x3d a !\x3d0? b:c;\n}\n}\nvoid main() {\nvec4 currentPixel0 \x3d  texture2D(u_image0, v_texCoord);\nfloat graya, reda, greena, bluea;\nif (u_bandCount \x3d\x3d 1) {\ngraya \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngl_FragColor \x3d vec4(graya, graya, graya, currentPixel.a);\n}\nelse if (u_bandCount \x3d\x3d 3) {\nreda \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngreena \x3d stretchOneaue(float(currentPixel.g), u_minCutOff[1], u_maxCutOff[1], u_minOutput[1], u_maxOutput[1], u_factor[1]);\nbluea \x3d stretchOneaue(float(currentPixel.b), u_minCutOff[2], u_maxCutOff[2], u_minOutput[2], u_maxOutput[2], u_factor[2]);\ngl_FragColor \x3d vec4(reda, greena, bluea, currentPixel.a);\n}\n}",
mask:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_includedRanges[6];\nuniform bool u_includedRanges_specified;\nuniform float u_noDataValues[6];\nuniform bool u_noDataValues_specified;\nuniform int u_noDataInterpretation;\nuniform int u_bandCount;\nvec4 mask() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nvec4 processedPixel \x3d currentPixel;\nif (u_includedRanges_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n} else if (u_bandCount \x3d\x3d 3) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1] \x26\x26 currentPixel.g \x3e u_includedRanges[2] \x26\x26 currentPixel.g \x3c u_includedRanges[3] \x26\x26 currentPixel.b \x3e u_includedRanges[4] \x26\x26 currentPixel.b \x3c u_includedRanges[5])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n}\n}\nif (u_noDataValues_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (processedPixel.r \x3d\x3d u_noDataValues[0])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n} else if (u_bandCount \x3d\x3d 3) {\nif (u_noDataInterpretation \x3d\x3d1 \x26\x26 processedPixel.r \x3d\x3d u_noDataValues[0] \x26\x26 processedPixel.g \x3d\x3d u_noDataValues[1] \x26\x26 processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse if (processedPixel.r \x3d\x3d u_noDataValues[0] || processedPixel.g \x3d\x3d u_noDataValues[1] || processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n}\n}\nreturn processedPixel;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d mask();\n}",
ndvi:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_red;\nuniform int u_bandId_nir;\nuniform bool u_scaled;\nuniform int u_bandCount;\nvec4 calculateNDVI(){\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n}\nelse {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateNDVI();\n}",
remap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform float u_breaks[16];\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getRemapIndex(float pixelValue) {\nif (pixelValue \x3c u_breaks[0] || pixelValue \x3e u_breaks[15]) {\nreturn -1.0;\n}\nfor (int i \x3d 0; i \x3c 16; i++) {\nif (pixelValue \x3c u_breaks[i]) {\nreturn float(i - 1);\n}\n}\nif (pixelValue \x3d\x3d u_breaks[15]) {\nreturn 15.0;\n}\nreturn 0.0;\n}\nvec4 colorize(float pv) {\nfloat clrIndex \x3d pv - u_indexedColormapOffset;\nvec4 result;\nif (clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat remappedIndex \x3d getRemapIndex(currentPixel.r);\nif (remappedIndex \x3c 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\ngl_FragColor \x3d colorize(remappedIndex);\n}",
resample:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resamplingRatio;\nuniform int u_resamplingType;\nuniform vec2 u_anchor;\nuniform vec2 u_resolution;\nvec4 resample(){\nvec2 pos_nn, pos_ul, pos_ur, pos_ll, pos_lr, pos_offset;\nfloat weight,weight_total, weight_ul, weight_ur, weight_ll, weight_lr;\nvec4 vp;  //v_texCoord is canvas space 0-1\nvec2 originalResolution \x3d vec2(u_resolution.s*u_resamplingRatio.s, u_resolution.t*u_resamplingRatio.t);\nvec2 pos \x3d vec2(u_anchor.s+(v_texCoord.s-u_anchor.s),(u_anchor.t+(v_texCoord.t-u_anchor.t)));\nif (u_resamplingType \x3d\x3d 0)\n{//shift and scaling, y \x3d ax+b so x \x3d (y-b)/a\npos_nn \x3d vec2(floor(pos.s/originalResolution.s+0.5)*originalResolution.s,floor(pos.t/originalResolution.t+0.5)*originalResolution.t);\nif (pos_nn.s \x3c0.0 || pos_nn.s \x3e 1.0 || pos_nn.t \x3c0.0 || pos_nn.t \x3e 1.0){\nvp \x3d vec4(1.0, 0.0, 0.0, 1.0);//vec4(0.0, 1.0, 0.0, vp.a);\n}\nelse {\nvp \x3d texture2D(u_image, vec2(pos_nn.s, pos_nn.t));\n}\n}\nelse if (u_resamplingType \x3d\x3d 1)\n{//shift and scaling, 4 neighbors y \x3d ax+b so x \x3d (y-b)/a\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t);\npos_ur \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t);\npos_ll \x3d vec2(pos_ul.s, pos_ul.t+originalResolution.t);\npos_lr \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t+originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nweight_lr \x3d sqrt(pow(pos_offset.s,2.0) + pow(pos_offset.t,2.0));\nweight_ul \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(originalResolution.t- pos_offset.t,2.0));\nweight_ur \x3d sqrt(pow( pos_offset.s,2.0)+ 1.0- pow(originalResolution.t - pos_offset.t,2.0));\nweight_ll \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(pos_offset.t,2.0));\nvp \x3d (texture2D(u_image, pos_ul) * weight_ul + texture2D(u_image, pos_ur) * weight_ur + texture2D(u_image, pos_ll) * weight_ll + texture2D(u_image, pos_lr) * weight_lr)/(weight_ul+weight_ur+weight_ll+weight_lr);\n}\nelse if (u_resamplingType \x3d\x3d 2)\n{//shift and scaling, 16 neighbors\nweight_total \x3d 0.0;\nvp \x3d vec4(0.0,0.0,0.0,0.0);\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s-originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t-originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nfor (int i\x3d0; i\x3c4; i++){//row\nfor (int j\x3d0; j\x3c4; j++){//col\nweight \x3d sqrt(pow(pos_offset.s-float(j),2.0)+ pow(pos_offset.t-float(i),2.0));\nvp +\x3dtexture2D(u_image, vec2(pos_ul.s+float(i)*originalResolution.s,pos_ul.t+float(j)*originalResolution.t)) * weight;\nweight_total +\x3d weight;\n}\n}\nvp \x3d vp/weight_total;\n}\nreturn vp;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d resample();\n}",
slope:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nuniform float u_zfactor;\nuniform float u_altitude;\nuniform float u_azimuth;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nvec4 calculateSlope() {\nfloat pi \x3d 3.141592653589793238;\nfloat dzx \x3d 0.0;\nfloat dzy \x3d 0.0;\nvec4 va,  vb,  vc,  vd,  ve,  vf,  vg,  vh,  vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0 - u_resolution.s) \x3e\x3d v_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0 - u_resolution.t) \x3e\x3d v_texCoord.t) {\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\n}\ndzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r / (8.0 * u_cellSize[0]);\ndzy \x3d -(vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r / (8.0 * u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat slope \x3d atan(u_zfactor * sqrt(dzx * dzx + dzy * dzy)) * 57.2957795;\nreturn vec4(slope, slope, slope, alpha);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateSlope();\n}",
stretch:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_bandCount;\nuniform vec2 u_sourceDim;\nuniform vec2 u_targetDim;\nuniform int u_state;\nuniform bool u_minMaxTexture;\nuniform bool u_useGamma;\nuniform float u_gamma[4];\nuniform float u_gammaCorrection[4];\nuniform bool u_scaled;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nif (u_bandCount \x3d\x3d 1) {\nfloat alpha \x3d vp_ul.a * vp_ur.a * vp_ll.a * vp_lr.a;\nvec4 vp_nn \x3d texture2D(u_image, coords);\nreturn alpha \x3d\x3d 0.0 ? vp_nn : vec4(vp.rgb, alpha);\n}\nreturn vp;\n}\nvec4 findMin(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r),min(p1.g, p2.g),min(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(max(p1.r, p2.r),max(p1.g, p2.g),max(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMinMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r), max(p1.g, p2.g), 0.0, p1.a);\n}\n}\nvec4 minMax(int state) {\nvec2 pixelFract \x3d fract(v_texCoord * u_sourceDim);\nfloat xshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.s; //take left pixel if \x3e 0.5\nfloat yshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.t; //take bottom pixel if \x3e 0.5\nif (u_sourceDim.s \x3d\x3d 1.0) {\nxshift \x3d 0.0;\n}\nif (u_sourceDim.t \x3d\x3d 1.0) {\nyshift \x3d 0.0;\n}\nvec4 p1 \x3d texture2D(u_image, v_texCoord);\nvec4 p2 \x3d texture2D(u_image, v_texCoord + vec2(xshift, 0.0));\nvec4 p3 \x3d texture2D(u_image, v_texCoord + vec2(0.0, yshift));\nvec4 p4 \x3d texture2D(u_image, v_texCoord + vec2(xshift, yshift));\nvec4 pval;\nif (state \x3d\x3d 2) {\npval \x3d findMinMax(findMinMax(p1, p2), findMinMax(p3, p4));\n} else if (state \x3d\x3d 1) {\npval \x3d findMax(findMax(p1, p2), findMax(p3, p4));\n} else if (state \x3d\x3d 0) {\npval \x3d findMin(findMin(p1, p2), findMin(p3, p4));\n}\nreturn pval;\n}\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool scaled) {\nfloat stretchedVal;\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n} else if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nfloat stretchOneValueGamma(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection, bool scaled) {\nfloat stretchedVal;\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d floor(tempf * outRange * pow(relativeVal, 1.0 / gamma)) + minOutput;\n}\nelse if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_state \x3d\x3d 100) {\nvec4 currentPixel \x3d getPixelValue(v_texCoord);\nfloat grayVal,\nredVal,\ngreenVal,\nblueVal;\nfloat min0,\nmax0,\nmin1,\nmax1,\nmin2,\nmax2,\nfactor0,\nfactor1,\nfactor2;\nvec4 minV, maxV;\nif (u_minMaxTexture) {\nif (u_bandCount \x3d\x3d 1) {\nminV \x3d texture2D(u_image1, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d minV.g;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\n} else {\nminV \x3d texture2D(u_image1, v_texCoord);\nmaxV \x3d texture2D(u_image2, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d maxV.r;\nmin1 \x3d minV.g;\nmax1 \x3d maxV.g;\nmin2 \x3d minV.b;\nmax2 \x3d maxV.b;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\nfactor1 \x3d (u_maxOutput[1] - u_minOutput[1]) / (max1 - min1);\nfactor2 \x3d (u_maxOutput[2] - u_minOutput[2]) / (max2 - min2);\n}\n} else {\nmin0 \x3d u_minCutOff[0];\nmax0 \x3d u_maxCutOff[0];\nmin1 \x3d u_minCutOff[1];\nmax1 \x3d u_maxCutOff[1];\nmin2 \x3d u_minCutOff[2];\nmax2 \x3d u_maxCutOff[2];\nfactor0 \x3d u_factor[0];\nfactor1 \x3d u_factor[1];\nfactor2 \x3d u_factor[2];\n}\nif (u_useGamma){\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngreenVal \x3d stretchOneValueGamma(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_gamma[1], u_gammaCorrection[1], u_scaled);\nblueVal \x3d stretchOneValueGamma(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_gamma[1], u_gammaCorrection[2], u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\nelse {\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngreenVal \x3d stretchOneValue(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_scaled);\nblueVal \x3d stretchOneValue(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\n} else {\nvec4 currentPixel \x3d minMax(u_state);\ngl_FragColor \x3d currentPixel;\n}\n}"}})},
"esri/layers/rasterLib/function/RasterFunctionWebGLMixin":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ./pixelShaders ./vertexShaders ./webglHelper ./convolutionKernel".split(" "),function(H,n,u,m,k,e,c){return H(null,{gl:null,rgbaFloatData:null,originalTexture:null,lastTexture:null,renderTexture:!1,constructor:function(a){this._isProgramInitialized=!1;this.gl=a&&a.gl;a&&a.renderTexture&&(this.renderTexture=a.renderTexture);this._xformSetting=a&&a._xformSetting||{requireProjection:!1,
meshSize:[20,20]}},bindFrameBuffer:function(){var a=this.gl;this._setupPingPongTextures();this._setupBranchingTextures();var b=this._glSetting;this.isBranch?(b.branchIndex=(b.branchIndex+1)%b.branchCount,b=b.branches[b.branchIndex]):(b.pingpongIndex=(b.pingpongIndex+1)%b.pingpong.length,b=b.pingpong[b.pingpongIndex]);a.bindFramebuffer(a.FRAMEBUFFER,b.frameBuffer);a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight);return b},_initializeProgram:function(a){if(this.gl)try{var b=this.gl;b.viewport(0,
0,b.drawingBufferWidth,b.drawingBufferHeight);var f=this._glSetting.programUniforms,g="local"===this.functionName?"local"+this.functionArguments.operation:this.functionName,h=f[g];if(h)this._uniforms=h.uniforms,this.rasterProgram=h.program;else{var d=(this._useMesh=this._tileMode&&this._xformSetting.requireProjection)?k.mesh:k.basic,l=k.getShader(b,a.vertex||d),p=m.getShader(b,a.fragment),v=this._loadProgram(l,p),r={rasterProgram:e.getUniforms(b,v)};f[g]={uniforms:r,program:v};this.rasterProgram=
v;this._uniforms=r}b.useProgram(this.rasterProgram);var w=b.getAttribLocation(this.rasterProgram,"a_texCoord"),y=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,y);var z=e.createMesh(this._xformSetting.meshSize);b.bufferData(b.ARRAY_BUFFER,z,b.STATIC_DRAW);b.enableVertexAttribArray(w);b.vertexAttribPointer(w,2,b.FLOAT,!1,0,0);b.disable(b.DEPTH_TEST);b.blendFunc(b.SRC_ALPHA,b.ZERO);b.disable(b.BLEND);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!1);this._shaderInfo=
{fragment:a.fragmentName}}catch(E){console.error("webgl exception: "+E.message)}else console.error("WebGL is required.")},_setUniform:function(a,b,f){null!=b&&(f&&!this._uniforms[f]&&(this._uniforms[f]=e.getUniforms(this.gl,this[f])),f=f?this._uniforms[f]:this._uniforms.rasterProgram,(a=f[a]||f[a+"[0]"])&&e.setUniform(this.gl,a,b))},_setUniforms:function(a,b){var f=Object.keys(a),g,h=f.length;for(g=0;g<h;g++)this._setUniform(f[g],a[f[g]],b);this.rawInput?this._setUniform("u_flipY",!0,b):this._setUniform("u_flipY",
!1,b);this._tileMode?(this.rawInput?(a=this._xformSetting.offset,f=this._xformSetting.scale):(a=[0,0],f=[1,1]),this._setUniform("u_xformOffset",a,b),this._setUniform("u_xformScale",f,b),this._xformSetting.requireProjection&&(this.rawInput?(this._setupXformTexture(),this._setUniform("u_projection",!0,b),this._setUniform("u_transformGridSize",this._xformSetting.gridConfig.size,b),this._setUniform("u_transformSpacing",this._xformSetting.gridConfig.spacing,b),this._setUniform("u_targetImageSize",new Float32Array([this.gl.drawingBufferWidth,
this.gl.drawingBufferHeight]),b)):this._setUniform("u_projection",!1,b))):(a=[0,0],f=[1,1],this._setUniform("u_xformOffset",a,b),this._setUniform("u_xformScale",f,b));this.rawInput&&this._rawResolution&&("RSP_BilinearInterpolation"===this.interpolation||"RSP_CubicConvolution"===this.interpolation)?(this._setUniform("u_resampling",1),this._setUniform("u_rawResolution",this._rawResolution)):this._setUniform("u_resampling",0)},_setupTextureData:function(a,b){if(a.texture)return a;a.raster&&a.raster.pixelBlock&&
(a=a.raster);this.rawInput=!0;var f=b&&b.notOriginal,g=b&&b.bandIDs;b&&b.reCreate?b=!1:(b=this._tileMode?!this._xformSetting.hasNewTexture:!this._glSetting.hasNewTexture)&&this._originalBandIDs&&(b=g?this._originalBandIDs.join("")===g.join(""):!1);0<this._glSetting.branchCount&&(b=!1);if(b&&this.originalTexture)return{extent:a.extent,texture:this.originalTexture};b=this._createTexture();f||(this.originalTexture=b,this._originalBandIDs=g);f=this.gl;var h=a.pixelBlock;this._rawResolution=h?[1/a.pixelBlock.width,
1/a.pixelBlock.height]:[1/this.gl.drawingBufferWidth,1/this.gl.drawingBufferHeight];var d=0;g&&0<g.length&&h&&(d=Math.max.apply(null,g),h.pixels.length>d&&g&&(h.pixels=g.map(function(p){return h.pixels[p]}),h.statistics&&(h.statistics=g.map(function(p){return h.statistics[p]}))));g=h.width;d=h.height;f.getExtension("OES_texture_float");var l=h.getAsRGBAFloat();f.texImage2D(f.TEXTURE_2D,0,f.RGBA,g,d,0,f.RGBA,f.FLOAT,l);return{extent:a.extent,texture:b}},_setupPingPongTextures:function(){var a=this._glSetting;
if(!a||!a.pingpong){a.pingpong=[];var b=e.createBufferTexture(this.gl,!1);a.pingpong.push(b);b=e.createBufferTexture(this.gl,!1);a.pingpong.push(b);a.pingpongIndex=1}},_setupBranchingTextures:function(){var a=this._glSetting;if(!a||!a.branches){a.branches=[];var b=0,f=a.branchCount;if(0<f){for(b=0;b<f;b++){var g=e.createBufferTexture(this.gl,!1);a.branches.push(g)}a.branchIndex=f-1}}},_setupXformTexture:function(a){for(var b=this._createTexture(),f=this.gl,g=4*this._xformSetting.gridConfig.size[0],
h=this._xformSetting.gridConfig.size[1],d=new Float32Array(g*h*4),l=0,p=0;p<this._xformSetting.gridConfig.coefficients.length;p++)d[l++]=this._xformSetting.gridConfig.coefficients[p],2===p%3&&(d[l++]=1);f.getExtension("OES_texture_float");f.texImage2D(f.TEXTURE_2D,0,f.RGBA,g,h,0,f.RGBA,f.FLOAT,d);this._bindTexture(b,"u_transformGrid",a)},_createTexture:function(a){return e.createTexture(this.gl,a)},_bindTexture:function(a,b,f){b=b||"u_image";f=this._uniforms[f||"rasterProgram"];var g=this._getTextureIndex(b);
if(-1!==g){var h=this.gl;h.uniform1i(f[b].location,g);h.activeTexture(h.TEXTURE0+g);h.bindTexture(h.TEXTURE_2D,a)}},_getTextureIndex:function(a,b){b=this._uniforms[b||"rasterProgram"];if(!b||!b[a]||b[a].info.type!==this.gl.SAMPLER_2D)return-1;if("u_transformGrid"===a)return 0;a="u_image"===a?0:parseInt(a.replace("u_image",""));return this._xformSetting.requireProjection?a+1:a},_drawGL:function(a){var b=this.gl;this.renderTexture?(b.enable(b.BLEND),b.bindFramebuffer(b.FRAMEBUFFER,null)):b.disable(b.BLEND);
a||b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight);a=this._xformSetting.meshSize||[1,1];b.drawArrays(b.TRIANGLES,0,a[0]*a[1]*6);this._drawMesh()},_drawMesh:function(){if(this.renderTexture&&this._glSetting.drawMesh){this.meshProgram=this.meshProgram||this._setupMeshProgram();var a=this.gl;a.useProgram(this.meshProgram);a.bindFramebuffer(a.FRAMEBUFFER,null);var b=a.getAttribLocation(this.meshProgram,"a_texCoord"),f=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,f);f=this._xformSetting.meshSize||
[1,1];var g=e.createMesh(f,!0);a.bufferData(a.ARRAY_BUFFER,g,a.STATIC_DRAW);a.enableVertexAttribArray(b);a.vertexAttribPointer(b,2,a.FLOAT,!1,0,0);a.disable(a.DEPTH_TEST);a.blendFunc(a.ONE,a.ZERO);this._setUniforms({u_color:[0,0,1,1],u_drawMeshLines:!0},"meshProgram");a.drawArrays(a.LINES,0,f[0]*f[1]*10)}},_setupMeshProgram:function(){var a=k.getShader(this.gl,k.mesh),b=m.getShader(this.gl,m.constant);return this._loadProgram(a,b)},_loadProgram:function(a,b){return e.loadProgram(this.gl,a,b)},_getShaderScript:function(a,
b){b=document.getElementById(b);if(!b)return null;a="";for(b=b.firstChild;b;)3==b.nodeType&&(a+=b.textContent),b=b.nextSibling;return a}})})},"esri/layers/rasterLib/function/vertexShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./vertexShaderScripts"],function(H,n,u){H={shaderType:"vertex",getShader:function(m,k){var e=m.createShader(m.VERTEX_SHADER);m.shaderSource(e,k);m.compileShader(e);m.getShaderParameter(e,m.COMPILE_STATUS)||(e=null);return e}};n.mixin(H,u);return H})},"esri/layers/rasterLib/function/vertexShaderScripts":function(){define([],
function(){return{basic:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform bool u_flipY;\nvoid main() {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}",histogram:"attribute float a_pixelIndex;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nuniform vec2 u_sourceDim;\nuniform vec2 u_halfPixel;\nuniform vec4 u_bandSelection;\nuniform vec4 u_mins;\nuniform vec4 u_factors;\nuniform float u_size;\nuniform int u_bandCount;\nuniform bool u_minMaxTexture;\nvoid main() {\nfloat row \x3d a_pixelIndex/u_sourceDim.s;\nvec2 coord \x3d vec2(fract(row), floor(row)/u_sourceDim.t);\nvec4 pv \x3d texture2D(u_image, coord + u_halfPixel);\nvec4 minVal, maxVal, pvm;\nif (u_minMaxTexture){\nif (u_bandCount \x3d\x3d1){ //min \x3d red, max \x3d green\nvec4 minmax \x3d texture2D(u_image1, vec2(0.5,0.5));\nminVal \x3d vec4(minmax.r, minmax.r, minmax.r, 0.0);\nmaxVal \x3d vec4(minmax.g, minmax.g, minmax.g, 0.0);\n}\nelse if (u_bandCount \x3d\x3d3){ //min \x3d red, max \x3d green\nminVal \x3d texture2D(u_image1, vec2(0.5,0.5));\nmaxVal \x3d texture2D(u_image2, vec2(0.5,0.5));\n}\nvec4 factors \x3d u_size/(maxVal-minVal+vec4(0.0,0.0,0.0,1.0)) * u_factors;\npvm \x3d (pv - minVal) * factors;\n}\nelse {\npvm \x3d (pv - u_mins) * u_factors;\n}\nfloat histVal \x3d min(floor(pvm.r+pvm.g+pvm.b), u_size-1.0);\nhistVal \x3d pv.a \x3d\x3d 1.0? histVal: u_size;\ngl_Position \x3d vec4((histVal+0.1) / (u_size+1.0) * 2.0 - 1.0, 0.5, 0, 1);\ngl_PointSize \x3d 1.0;\n}",
mesh:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform bool u_drawMeshLines;\nuniform bool u_flipY;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nuniform vec2 u_srcImageSize;\nuniform bool u_projection;\nvec2 projectPixelLocation(vec2 coords) {\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;// + halfPixel;\n}\nvoid main() {\nif (u_projection) {\nv_texCoord \x3d projectPixelLocation(a_texCoord);\n} else {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\n}\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\nif (u_drawMeshLines){\nvec2 adjustedPos \x3d (v_texCoord - u_xformOffset) / u_xformScale;\ngl_Position \x3d vec4( adjustedPos * 2.0 - 1.0, 0.0, 1.0);\n}\nelse {\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}\n}"}})},
"esri/layers/rasterLib/function/webglHelper":function(){define([],function(){var H={getUniforms:function(n,u){var m=n.getProgramParameter(u,n.ACTIVE_UNIFORMS),k,e,c={};for(k=0;k<m;k++)(e=n.getActiveUniform(u,k))&&(c[e.name]={location:n.getUniformLocation(u,e.name),info:e});return c},setUniform:function(n,u,m){var k=u.info,e=u.location,c=k.type;if(null==m)console.log("uniform "+u.info.name+" has null or undefined value");else switch(c){case n.FLOAT:1<k.size?0===m.length?console.log("uniform "+u.info.name+
" has length 0"):n.uniform1fv(e,m):n.uniform1f(e,m);break;case n.FLOAT_VEC2:if(0===m.length){console.log("uniform "+u.info.name+" has length 0");break}n.uniform2fv(e,m);break;case n.FLOAT_VEC3:if(0===m.length){console.log("uniform "+u.info.name+" has length 0");break}n.uniform3fv(e,m);break;case n.FLOAT_VEC4:if(0===m.length){console.log("uniform "+u.info.name+" has length 0");break}n.uniform4fv(e,m);break;case n.INT:case n.BOOL:1<k.size?0===m.length?console.log("uniform "+u.info.name+" has length 0"):
n.uniform1iv(e,m):n.uniform1i(e,m);break;case n.INT_VEC2:case n.BOOL_VEC2:if(0===m.length){console.log("uniform "+u.info.name+" has length 0");break}n.uniform2iv(e,m);break;case n.INT_VEC3:case n.BOOL_VEC3:if(0===m.length){console.log("uniform "+u.info.name+" has length 0");break}n.uniform3iv(e,m);break;case n.INT_VEC4:case n.BOOL_VEC4:0===m.length?console.log("uniform "+u.info.name+" has length 0"):n.uniform4iv(e,m)}},createTexture:function(n,u){var m=n.createTexture();n.bindTexture(n.TEXTURE_2D,
m);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,u?n.LINEAR:n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,u?n.LINEAR:n.NEAREST);return m},createBufferTexture:function(n,u,m){u=H.createTexture(n,u);n.getExtension("OES_texture_float");m=m||[n.drawingBufferWidth,n.drawingBufferHeight];n.texImage2D(n.TEXTURE_2D,0,n.RGBA,m[0],m[1],0,n.RGBA,n.FLOAT,null);m=n.createFramebuffer();
n.bindFramebuffer(n.FRAMEBUFFER,m);n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,u,0);return{texture:u,frameBuffer:m}},getShader:function(n,u,m){m=m?n.createShader(n.VERTEX_SHADER):n.createShader(n.FRAGMENT_SHADER);n.shaderSource(m,u);n.compileShader(m);n.getShaderParameter(m,n.COMPILE_STATUS)||(console.log(n.getShaderInfoLog(m)),m=null);return m},loadProgram:function(n,u,m){var k=n.createProgram();n.attachShader(k,u);n.attachShader(k,m);n.linkProgram(k);n.getProgramParameter(k,
n.LINK_STATUS)||(console.warn("failed to load webgl program: "+n.getProgramInfoLog(k)),n.deleteProgram(k),k=null);return k},createMesh:function(n,u){if(!n||1===n[0]&&1===n[1])return new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);var m=n&&u?new Float32Array(n[0]*n[1]*20):new Float32Array(n[0]*n[1]*12);var k=.9998/n[1],e=.9998/n[0],c,a,b=0;for(c=0;c<n[1];c++)for(a=0;a<n[0];a++){var f=1E-4+k*c;var g=1E-4+e*a;n&&!u?(m[b++]=f,m[b++]=g,m[b++]=f+k,m[b++]=g,m[b++]=f,m[b++]=g+e,m[b++]=f,m[b++]=g+e,m[b++]=f+k,
m[b++]=g,m[b++]=f+k,m[b++]=g+e):(m[b++]=f,m[b++]=g,m[b++]=f,m[b++]=g+e,m[b++]=f,m[b++]=g+e,m[b++]=f+k,m[b++]=g+e,m[b++]=f+k,m[b++]=g+e,m[b++]=f+k,m[b++]=g,m[b++]=f,m[b++]=g,m[b++]=f+k,m[b++]=g,m[b++]=f,m[b++]=g+e,m[b++]=f+k,m[b++]=g)}return m}};return H})},"esri/layers/rasterLib/function/convolutionKernel":function(){define([],function(){var H={Default:[0,0,0,0,1,0,0,0,0],LineDetectionHorizontal:[-1,-1,-1,2,2,2,-1,-1,-1],LineDetectionVertical:[-1,2,-1,-1,2,-1,-1,2,-1],LineDetectionLeftDiagonal:[2,
-1,-1,-1,2,-1,-1,-1,2],LineDetectionRightDiagonal:[-1,-1,2,-1,2,-1,2,-1,-1],GradientNorth:[-1,-2,-1,0,0,0,1,2,1],GradientWest:[-1,0,1,-2,0,2,-1,0,1],GradientEast:[1,0,-1,2,0,-2,1,0,-1],GradientSouth:[1,2,1,0,0,0,-1,-2,-1],GradientNorthEast:[0,-1,-2,1,0,-1,2,1,0],GradientNorthWest:[-2,-1,0,-1,0,1,0,1,2],SmoothArithmeticMean:[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111],Smoothing3x3:[.0625,.125,.0625,.125,.25,.125,.0625,
.125,.0625],Smoothing5x5:[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1],Sharpening3x3:[-1,-1,-1,-1,9,-1,-1,-1,-1],Sharpening5x5:[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1],Laplacian3x3:[0,-1,0,-1,4,-1,0,-1,0],Laplacian5x5:[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0],SobelHorizontal:[-1,-2,-1,0,0,0,1,2,1],SobelVertical:[-1,0,1,-2,0,2,-1,0,1],Sharpen:[0,-.25,0,-.25,2,-.25,0,-.25,0],Sharpen2:[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25],PointSpread:[-.627,
.352,-.627,.352,2.923,.352,-.627,.352,-.627],getKernel:function(n){switch(n){case 0:return H.LineDetectionHorizontal;case 1:return H.LineDetectionVertical;case 2:return H.LineDetectionLeftDiagonal;case 3:return H.LineDetectionRightDiagonal;case 4:return H.GradientNorth;case 5:return H.GradientWest;case 6:return H.GradientEast;case 7:return H.GradientSouth;case 8:return H.GradientNorthEast;case 9:return H.GradientNorthWest;case 10:return H.SmoothArithmeticMean;case 11:return H.Smoothing3x3;case 12:return H.Smoothing5x5;
case 13:return H.Sharpening3x3;case 14:return H.Sharpening5x5;case 15:return H.Laplacian3x3;case 16:return H.Laplacian5x5;case 17:return H.SobelHorizontal;case 18:return H.SobelVertical;case 19:return H.Sharpen;case 20:return H.Sharpen2;case 21:return H.PointSpread;default:return H.Default}}};return H})},"esri/layers/rasterLib/function/surfaceUtils":function(){define(["dojo/_base/lang"],function(H){return{hillshade:function(n,u){if(null!==n&&null!==n.pixelBlock&&null!==n.pixelBlock.pixels){var m=
this._clonePixelBlock(n.pixelBlock),k=u.altitude,e=u.azimuth,c=u.zFactor,a=u.psPower,b=u.psFactor,f=u.hillshadeType,g=u.slopeType,h=u.isGCS;1===f&&(c*=2);u=m.width;var d=m.height,l=m.pixels[0],p=m.mask,v=new Uint8Array(u*d);p&&v.set(p);var r=new Uint8Array(u*d),w=(n.extent.xmax-n.extent.xmin)/u,y=(n.extent.ymax-n.extent.ymin)/d,z=c/(8*w),E=c/(8*y);.001<c&&h&&(z/=111E3,E/=111E3);3===g&&(h?(z=111E3*w,E=111E3*y,z=(c+Math.pow(z,a)*b)/(8*z),E=(c+Math.pow(E,a)*b)/(8*E)):(z=(c+Math.pow(w,a)*b)/(8*w),E=(c+
Math.pow(y,a)*b)/(8*y)));h=(90-k)*Math.PI/180;k=Math.cos(h);var B=(360-e+90)*Math.PI/180;e=Math.sin(h)*Math.cos(B);h=Math.sin(h)*Math.sin(B);c=[];a=[];b=[];w=[315,270,225,360,180,0];var C=[60,60,60,60,60,90];g=[3,5,3,2,1,4];var G=g.reduce(function(x,F){return x+F});y=g.map(function(x){return x/G});if(1===f){var I=w.length;for(g=0;g<I;g++)k=C[g],e=w[g],h=(90-k)*Math.PI/180,k=Math.cos(h),B=(360-e+90)*Math.PI/180,e=Math.sin(h)*Math.cos(B),h=Math.sin(h)*Math.sin(B),c.push(k),a.push(e),b.push(h)}var D=
0;for(g=1;g<d-1;g++)for(C=g*u,w=1;w<u-1;w++)if(p&&!p[C+w])r[C+w]=0;else{B=0;if(p&&(B=p[C-u+w-1]+p[C-u+w]+p[C-u+w+1]+p[C+w-1]+p[C+w+1]+p[C+u+w-1]+p[C+u+w]+p[C+u+w+1],7>B)){r[C+w]=0;v[C+w]=0;continue}if(7===B){var q=p[C-u+w-1]?l[C-u+w-1]:l[C+w];var t=p[C-u+w]?l[C-u+w]:l[C+w];var A=p[C-u+w+1]?l[C-u+w+1]:l[C+w];B=p[C+w-1]?l[C+w-1]:l[C+w];var J=p[C+w+1]?l[C+w+1]:l[C+w];D=p[C+u+w-1]?l[C+u+w-1]:l[C+w];var M=p[C+u+w]?l[C+u+w]:l[C+w];var N=p[C+u+w+1]?l[C+u+w+1]:l[C+w]}else q=l[C-u+w-1],t=l[C-u+w],A=l[C-u+
w+1],B=l[C+w-1],J=l[C+w+1],D=l[C+u+w-1],M=l[C+u+w],N=l[C+u+w+1];B=(A+J+J+N-(q+B+B+D))*z;t=(D+M+M+N-(q+t+t+A))*E;A=Math.sqrt(1+B*B+t*t);D=0;if(0===f)M=h*t-e*B,M=255*(k+M)/A,0>M&&(M=0),D=M;else if(1===f)for(q=0;q<I;q++)M=b[q]*t-a[q]*B,M=255*(c[q]+M)/A,0>M&&(M=0),D+=M*y[q];r[C+w]=D}for(g=0;g<d;g++)r[g*u]=r[g*u+1],r[(g+1)*u-1]=r[(g+1)*u-2];for(g=1;g<u-1;g++)r[g]=r[g+u],r[g+(d-1)*u]=r[g+(d-2)*u];m.pixelType="U8";m.pixels=[r];m.statistics=[{minValue:0,maxValue:255}];p&&(m.mask=v);return{extent:n.extent,
pixelBlock:m}}},slope:function(n,u){if(null!==n&&null!==n.pixelBlock&&null!==n.pixelBlock.pixels){var m=this._clonePixelBlock(n.pixelBlock),k=u.zFactor,e=u.psPower,c=u.psFactor,a=u.slopeType,b=u.isGCS;u=m.width;var f=m.height,g=m.pixels[0],h=m.mask,d=new Uint8Array(u*f);h&&d.set(h);var l=new Float32Array(u*f),p=(n.extent.xmax-n.extent.xmin)/u,v=(n.extent.ymax-n.extent.ymin)/f,r=k/(8*p),w=k/(8*v);1E-4>Math.abs(k-1)&&b&&(r/=111E3,w/=111E3);3===a&&(b?(r=111E3*p,w=111E3*v,r=(k+Math.pow(r,e)*c)/(8*r),
w=(k+Math.pow(w,e)*c)/(8*w)):(r=(k+Math.pow(p,e)*c)/(8*p),w=(k+Math.pow(v,e)*c)/(8*v)));for(k=1;k<f-1;k++)for(c=k*u,e=1;e<u-1;e++)if(h&&!h[c+e])l[c+e]=0;else{v=0;if(h&&(v=h[c-u+e-1]+h[c-u+e]+h[c-u+e+1]+h[c+e-1]+h[c+e+1]+h[c+u+e-1]+h[c+u+e]+h[c+u+e+1],7>v)){l[c+e]=0;d[c+e]=0;continue}if(7===v){v=h[c-u+e-1]?g[c-u+e-1]:g[c+e];b=h[c-u+e]?g[c-u+e]:g[c+e];p=h[c-u+e+1]?g[c-u+e+1]:g[c+e];var y=h[c+e-1]?g[c+e-1]:g[c+e];var z=h[c+e+1]?g[c+e+1]:g[c+e];var E=h[c+u+e-1]?g[c+u+e-1]:g[c+e];var B=h[c+u+e]?g[c+u+
e]:g[c+e];var C=h[c+u+e+1]?g[c+u+e+1]:g[c+e]}else v=g[c-u+e-1],b=g[c-u+e],p=g[c-u+e+1],y=g[c+e-1],z=g[c+e+1],E=g[c+u+e-1],B=g[c+u+e],C=g[c+u+e+1];y=(p+z+z+C-(v+y+y+E))*r;v=(E+B+B+C-(v+b+b+p))*w;v=Math.sqrt(y*y+v*v);l[c+e]=1===a||3===a?57.2957795*Math.atan(v):100*v}for(k=0;k<f;k++)l[k*u]=l[k*u+1],l[(k+1)*u-1]=l[(k+1)*u-2];for(k=1;k<u-1;k++)l[k]=l[k+u],l[k+(f-1)*u]=l[k+(f-2)*u];m.pixelType="F32";m.pixels=[l];m.statistics=[{minValue:0,maxValue:255}];h&&(m.mask=d);return{extent:n.extent,pixelBlock:m}}},
aspect:function(n){if(null!==n&&null!==n.pixelBlock&&null!==n.pixelBlock.pixels){var u=this._clonePixelBlock(n.pixelBlock),m=u.width,k=u.height,e=u.pixels[0],c=u.mask,a=new Uint8Array(m*k);c&&a.set(c);var b=new Float32Array(m*k),f=1/((n.extent.xmax-n.extent.xmin)/m),g=1/((n.extent.ymax-n.extent.ymin)/k),h,d;for(h=1;h<k-1;h++){var l=h*m;for(d=1;d<m-1;d++)if(c&&!c[l+d])b[l+d]=0;else{var p=0;if(c&&(p=c[l-m+d-1]+c[l-m+d]+c[l-m+d+1]+c[l+d-1]+c[l+d+1]+c[l+m+d-1]+c[l+m+d]+c[l+m+d+1],7>p)){b[l+d]=0;a[l+d]=
0;continue}if(7===p){p=c[l-m+d-1]?e[l-m+d-1]:e[l+d];var v=c[l-m+d]?e[l-m+d]:e[l+d];var r=c[l-m+d+1]?e[l-m+d+1]:e[l+d];var w=c[l+d-1]?e[l+d-1]:e[l+d];var y=c[l+d+1]?e[l+d+1]:e[l+d];var z=c[l+m+d-1]?e[l+m+d-1]:e[l+d];var E=c[l+m+d]?e[l+m+d]:e[l+d];var B=c[l+m+d+1]?e[l+m+d+1]:e[l+d]}else p=e[l-m+d-1],v=e[l-m+d],r=e[l-m+d+1],w=e[l+d-1],y=e[l+d+1],z=e[l+m+d-1],E=e[l+m+d],B=e[l+m+d+1];w=(r+y+y+B-(p+w+w+z))*f;p=(z+E+E+B-(p+v+v+r))*g;0===w&&0===p?p=-1:(p=90-57.29578*Math.atan2(p,-w),0>p&&(p+=360),360===p?
p=0:360<p&&(p%=360));b[l+d]=p}}for(h=0;h<k;h++)b[h*m]=b[h*m+1],b[(h+1)*m-1]=b[(h+1)*m-2];for(h=1;h<m-1;h++)b[h]=b[h+m],b[h+(k-1)*m]=b[h+(k-2)*m];u.pixelType="F32";u.pixels=[b];u.statistics={minValue:0,maxValue:360};c&&(u.mask=a);return{extent:n.extent,pixelBlock:u}}},_clonePixelBlock:function(n){return n.clone?n.clone():H.clone(n)}}})},"esri/layers/rasterLib/function/BandArithmeticFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),
function(H,n,u,m,k,e,c){return H([u,e],{declaredClass:"esri.layers.rasterLib.function.BandArithmeticFunction",functionName:"BandArithmetic",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({method:1,bandIndexes:"",raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to band arithmetic function is invalid.");this.rasterInfo=n.mixin(a.raster,{bandCount:8===this.functionArguments.method?a.raster.bandCount:
1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var b=c.calculate(a.pixelBlock,{bandIndexes:this.functionArguments.bandIndexes,method:this.functionArguments.method});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(b.pixelType=this.pixelType);
return{extent:a.extent,pixelBlock:b}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:k.bandArithmetic,fragmentName:"bandArithmetic"});var b=this.functionArguments.bandIndexes.trim().split(" ").map(function(d){return parseInt(d,10)});this._infraredBandID=b[0]-1;this._visibleBandID=b[1]-1;this._alterBand=2<Math.max(this._infraredBandID,this._visibleBandID)?!0:!1;a=this._setupTextureData(a.raster,this._alterBand&&2==b.length?{bandIDs:[this._infraredBandID,this._visibleBandID,
this._infraredBandID]}:{bandIDs:[b[0]-1,b[1]-1,b[2]-1]});var f=this.bindFrameBuffer(),g=this.functionArguments.method,h=2<b.length?b.slice(2):null;this._alterBand?this._setUniforms({u_method:g,u_bandId_nir:0,u_bandId_red:1,u_constants:h}):this._setUniforms({u_method:g,u_bandId_nir:b[0]-1,u_bandId_red:b[1]-1,u_constants:h});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:f.texture}}})})},"esri/layers/rasterLib/function/rasterIndex":function(){define(["dojo/_base/lang"],
function(H){return{calculate:function(n,u){if(n&&n.pixels&&n.pixels.length){var m=u&&u.bandIndexes;u=u&&u.method;var k=m.trim().split(" ").map(function(a){return parseInt(a,10)}).filter(function(a){return null!=a});n=this._clonePixelBlock(n);var e=n.pixels,c=n.mask;switch(u){case 1:e=this._calculateNDVI(c,e[k[0]-1],e[k[1]-1]);break;case 2:e=this._calculateSAVI(c,e[k[0]-1],e[k[1]-1],k[2]);break;case 3:e=this._calculateTSAVI(c,e[k[0]-1],e[k[1]-1],k[2],k[3],k[4]);break;case 4:e=this._calculateMSAVI(c,
e[k[0]-1],e[k[1]-1]);break;case 5:e=this._calculateGEMI(c,e[k[0]-1],e[k[1]-1]);break;case 6:e=this._calculatePVI(c,e[k[0]-1],e[k[1]-1],k[2],k[3]);break;case 7:e=this._calculateGVITM(c,e[k[0]-1],e[k[1]-1],e[k[2]-1],e[k[3]-1],e[k[4]-1],e[k[5]-1]);break;case 8:e=this._calculateSultan(c,e[k[0]-1],e[k[1]-1],e[k[2]-1],e[k[3]-1],e[k[4]-1],e[k[5]-1]);break;case 9:e=this._calculateVARI(c,e[k[0]-1],e[k[1]-1],e[k[2]-1]);break;case 0:e=this._calculateUserDefined(c,e,m)}n.pixels=e;n.pixelType="F32";n.calculateStatistics();
return n}},_clonePixelBlock:function(n){return n.clone?n.clone():H.clone(n)},_parseUserDefined:function(n,u){n=n.replace(" ","");0===n.indexOf("-")&&(n="0"+n);0===n.indexOf("+")&&(n=n.slice(1,n.length));n=n.split("");var m=[],k=[],e="+-*/()".split(""),c,a="";for(c=0;c<n.length;c++){var b=n[c];e.some(function(f){return f===b})?(""!==a&&k.push(parseFloat(a)),m.push(b),a=""):"b"===b.toLowerCase()?(c++,a=b.concat(n[c]),k.push(u[parseInt(a[1],10)-1]),a=""):(a=a.concat(b),c===n.length-1&&k.push(parseFloat(a)))}return{ops:m,
nums:k}},_op:function(n,u,m,k){if(m.constructor===Number&&k.constructor===Number)return m+k;var e;if(m.constructor===Number){var c=k.length;var a=m;m=new Float32Array(c);for(e=0;e<c;e++)m[e]=a}else if(c=m.length,k.constructor===Number)for(a=k,k=new Float32Array(c),e=0;e<c;e++)k[e]=a;a=new Float32Array(c);if(null==n)if("+"===u)for(e=0;e<c;e++)a[e]=m[e]+k[e];else if("-"===u)for(e=0;e<c;e++)a[e]=m[e]-k[e];else if("*"===u)for(e=0;e<c;e++)a[e]=m[e]*k[e];else{if("/"===u)for(e=0;e<c;e++)a[e]=m[e]/k[e]}else if("+"===
u)for(e=0;e<c;e++)n[e]&&(a[e]=m[e]+k[e]);else if("-"===u)for(e=0;e<c;e++)n[e]&&(a[e]=m[e]-k[e]);else if("*"===u)for(e=0;e<c;e++)n[e]&&(a[e]=m[e]*k[e]);else if("/"===u)for(e=0;e<c;e++)n[e]&&(a[e]=m[e]/k[e]);return a},_shrinkOp:function(n,u){n.splice(u,1);var m=u=0,k=0;do{for(u=k=m=0;u<n.length;u++)if("("===n[u])m=u;else if(")"===n[u]){k=u;break}k===m+1&&n.splice(m,2)}while(k===m+1);return n},_getPriorityOpIndex:function(n,u){if(1===n.length)return{opIndex:0,numIndex:0};var m=u=0,k=0,e=-1,c=0;for(u=
0;u<n.length;u++)if("("===n[u])m=u;else if(")"===n[u]){k=u;break}var a=0===k?n:n.slice(m+1,k);for(u=0;u<a.length;u++)if("*"===a[u]||"/"===a[u]){e=u;break}if(!(-1<e))for(u=0;u<a.length;u++)if("+"===a[u]||"-"===a[u]){e=u;break}0<k&&(e+=m+1);for(u=0;u<e;u++)"("===n[u]&&c++;return{opIndex:e,numIndex:e-c}},_calculateUserDefined:function(n,u,m){u=this._parseUserDefined(m,u);m=u.ops;for(var k=u.nums,e,c,a;0<m.length&&(u=this._getPriorityOpIndex(m,k),e=m[u.opIndex],c=k[u.numIndex],a=k[u.numIndex+1],e=this._op(n,
e,c,a),1!==m.length);)m=this._shrinkOp(m,u.opIndex),k.splice(u.numIndex,2,e);return[e]},_calculateNDVI:function(n,u,m){var k=m.length,e=new Float32Array(k),c;if(null==n)for(c=0;c<k;c++){var a=m[c];var b=u[c];e[c]=(b-a)/(b+a)}else for(c=0;c<k;c++)n[c]&&(a=m[c],b=u[c],e[c]=(b-a)/(b+a));return[e]},_calculateSAVI:function(n,u,m,k){var e=m.length,c=new Float32Array(e),a;if(null==n)for(a=0;a<e;a++){var b=m[a];var f=u[a];c[a]=(f-b)/(f+b+k)*(1+k)}else for(a=0;a<e;a++)n[a]&&(b=m[a],f=u[a],c[a]=(f-b)/(f+b+
k)*(1+k));return[c]},_calculateTSAVI:function(n,u,m,k,e,c){var a=m.length,b=new Float32Array(a),f=-e*k+c*(1+k*k);if(null==n)for(c=0;c<a;c++){var g=m[c];var h=u[c];b[c]=k*(h-k*g-e)/(e*h+g+f)}else for(c=0;c<a;c++)n[c]&&(g=m[c],h=u[c],b[c]=k*(h-k*g-e)/(e*h+g+f));return[b]},_calculateMSAVI:function(n,u,m){var k=m.length,e=new Float32Array(k),c;if(null==n)for(c=0;c<k;c++){var a=m[c];var b=u[c];e[c]=.5*(2*(b+1)-Math.sqrt(Math.pow(2*b+1,2)-8*(b-a)))}else for(c=0;c<k;c++)n[c]&&(e[c]=.5*(2*(b+1)-Math.sqrt(Math.pow(2*
b+1,2)-8*(b-a))));return[e]},_calculateGEMI:function(n,u,m){var k=m.length,e=new Float32Array(k),c;if(null==n)for(c=0;c<k;c++){var a=m[c];var b=u[c];b=(2*(b*b-a*a)+1.5*b+.5*a)/(b+a+.5);e[c]=b*(1-.25*b)-(a-.125)/(1-a)}else for(c=0;c<k;c++)n[c]&&(a=m[c],b=u[c],b=(2*(b*b-a*a)+1.5*b+.5*a)/(b+a+.5),e[c]=b*(1-.25*b)-(a-.125)/(1-a));return[e]},_calculatePVI:function(n,u,m,k,e){var c=m.length,a=new Float32Array(c),b,f=Math.sqrt(1+k*k);if(null==n)for(b=0;b<c;b++){var g=m[b];var h=u[b];a[b]=(h-k*g-e)/f}else for(b=
0;b<c;b++)n[b]&&(g=m[b],h=u[b],a[b]=(h-k*g-e)/f);return[a]},_calculateGVITM:function(n,u,m,k,e,c,a){var b=u.length,f=new Float32Array(b),g;if(null==n)for(g=0;g<b;g++)f[g]=-.2848*u[g]-.2435*m[g]-.5436*k[g]+.7243*e[g]+.084*c[g]-1.18*a[g];else for(g=0;g<b;g++)n[g]&&(f[g]=-.2848*u[g]-.2435*m[g]-.5436*k[g]+.7243*e[g]+.084*c[g]-1.18*a[g]);return[f]},_calculateSultan:function(n,u,m,k,e,c,a){m=u.length;var b=new Float32Array(m),f=new Float32Array(m),g=new Float32Array(m),h;if(null==n)for(h=0;h<m;h++)b[h]=
c[h]/a[h]*100,f[h]=c[h]/u[h]*100,g[h]=k[h]/e[h]*(c[h]/e[h])*100;else for(h=0;h<m;h++)n[h]&&(b[h]=c[h]/a[h]*100,f[h]=c[h]/u[h]*100,g[h]=k[h]/e[h]*(c[h]/e[h])*100);return[b,f,g]},_calculateVARI:function(n,u,m,k){var e=u.length,c=new Float32Array(e),a;if(null==n)for(a=0;a<e;a++){var b=u[a];var f=m[a];var g=k[a];c[a]=(f-b)/(f+b-g)}else for(a=0;a<e;a++)if(n[a])for(a=0;a<e;a++)b=u[a],f=m[a],g=k[a],c[a]=(f-b)/(f+b-g);return[c]}}})},"esri/layers/rasterLib/function/ColormapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(H,n,u,m,k,e,c){return H([m,e],{declaredClass:"esri.layers.rasterLib.function.ColormapFunction",functionName:"Colormap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({colormap:null,colorRampName:null,colorRamp:null,colorMapName:null,raster:null},a);this.invert=a&&a.invert;a=a.colormap||a.Colormap;if(a){if(a.features||a[0].attributes){a=a.features||a;var b=Object.keys(a[0].attributes);var f=b.filter(function(v){return"alpha"===
v.toLowerCase()})[0];var g=b.filter(function(v){return"value"===v.toLowerCase()})[0];var h=b.filter(function(v){return"red"===v.toLowerCase()})[0];var d=b.filter(function(v){return"green"===v.toLowerCase()})[0];var l=b.filter(function(v){return"blue"===v.toLowerCase()})[0];if(!(g&&h&&d&&l))throw"invalid colormap";a=a.map(function(v){return f?[v.attributes[g],v.attributes[h],v.attributes[d],v.attributes[l],v.attributes[f]]:[v.attributes[g],v.attributes[h],v.attributes[d],v.attributes[l]]});var p=1.1>
Math.max.apply(null,a.map(function(v){return v[1]}));b=f&&1.1>Math.max.apply(null,a.map(function(v){return v[4]}));if(p)for(p=0;p<a.length;p++)a[p][1]=Math.round(255*a[p][1]),a[p][2]=Math.round(255*a[p][2]),a[p][3]=Math.round(255*a[p][3]),b&&(a[p][4]=Math.round(255*a[p][4]))}this.functionArguments.colormap=this._sortClr(a)}this._initialize()},bind:function(a){this._initialize();a=this.getSourceRasterInfo(a);if(!a.raster||"F32"===a.raster.pixelType)return Error("The raster input to colormap function is invalid. It must be integer type.");
this.rasterInfo=n.mixin(a.raster,{bandCount:3,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){return this._colorize(a.raster)},readGL:function(a){return this._colorizeGL(a.raster)},_colorize:function(a){this._performance.start();var b=c.colorize(a.pixelBlock,{indexedColormap:this._indexedColormap,indexedColormapOffset:this._indexedColormapOffset,
indexed2DColormap:this._indexed2DColormap,alphaSpecified:this._alphaSpecified});this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,pixelBlock:b}},_binarySearchClr:function(a,b){for(var f=0,g=a.length-1,h=0,d=0;f<g;)if(h=Math.floor((f+g)/2),d=a[h],d[0]<b)f=h;else if(d[0]>b)g=h;else return d.slice(1);return null},_sortClr:function(a,b){var f,g=[];for(f=0;f<a.length;f++)g.push(a[f]);for(f=0;f<g.length-1;f++){var h=g[f];for(a=f+1;a<g.length;a++)h[0]>g[a][0]&&(h=g[a],g[a]=g[f],
g[f]=h)}if(b)for(f=0;f<g.length/2;f++)h=g[f],g[g.length-1-f]=g[f],g[f]=h;return g},_invertColorRamp:function(a){if(!a)return a;var b={type:a.type};"random"===a.type?b=a:"multipart"===a.type?b.colorRamps=a.colorRamps.map(function(f){return{fromColor:f.toColor,toColor:f.fromColor}}).reverse():(b.fromColor=a.toColor,b.toColor=a.fromColor);return b},_initialize:function(){this._indexedColormapOffset=0;if(this.functionArguments.colormap){var a=c.buildIndexedColormap(this.functionArguments.colormap);this._alphaSpecified=
a&&a.alphaSpecified;this._indexedColormap=a&&a.indexedColormap;this._indexedColormapOffset=a&&a.offset;this._indexedColormap||(this._indexed2DColormap=this._getIndexed2DColormap())}else this.functionArguments.colorRamp?this._indexedColormap="multipart"===this.functionArguments.colorRamp.type?this.invert?u.createMultiPartColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):u.createMultiPartColorRamp(this.functionArguments.colorRamp):this.invert?u.createAlgorithmicColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):
u.createAlgorithmicColorRamp(this.functionArguments.colorRamp):this.functionArguments.colormapName&&"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=u.createRandomColorRamp())},_getIndexed2DColormap:function(){var a=this.functionArguments.colormap;if(!a)return null;var b=0;0>a[0][0]&&(b=a[0][0]);var f=[],g=5===a[0].length,h;for(h=0;h<a.length;h++)f[a[h][0]-b]=g?a[h].slice(1):a[h].slice(1).concat([255]);return f},_colorizeGL:function(a){this._performance.start();
this._initializeProgram({fragment:k.colormap,fragmentName:"Colormap"});var b=this._indexedColormap,f=this._indexedColormapOffset;this._clrTexture||(this._clrTexture=this._setupColormapTexture(b));var g=this._clrTexture,h=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:f,u_indexedColormapMaxIndex:b.length/4-1});this._bindTexture(g,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:h.texture}},_setupColormapTexture:function(a){var b=
this._createTexture(),f=this.gl,g=a.length/4,h=new Float32Array(a.length),d,l=this.renderTexture?255:1;for(d=0;d<a.length;d++)h[d]=a[d]/l;f.getExtension("OES_texture_float");f.texImage2D(f.TEXTURE_2D,0,f.RGBA,g,1,0,f.RGBA,f.FLOAT,h);return b}})})},"esri/renderers/colorRampGenerator":function(){define(["dojo/_base/declare","dojo/_base/lang","../renderers/colorUtils"],function(H,n,u){return{createAlgorithmicColorRamp:function(m,k){if(!m)return null;var e=m.fromColor,c=m.toColor;if(!e||!c)return null;
void 0===e.r&&3<=e.length&&(e={r:e[0],g:e[1],b:e[2]});void 0===c.r&&3<=c.length&&(c={r:c[0],g:c[1],b:c[2]});var a=m.size||256;m=m.algorithm||"cie-lab";if(1===a)var b=[e.r,e.g,e.b,255];else if(2===a)b=[e.r,e.g,e.b,255,c.r,c.g,e.b,255];else if(-1<m.toLowerCase().indexOf("hsv")){b=u.toHSV(e);c=u.toHSV(c);a=a||256;var f=0===b.s,g=0===c.s;e=b.h;m=c.h;f&&!g?e=b.h=m:g&&!f&&(m=c.h=e);f=Math.abs(m-e);180>f?m=(m-e)/(a-1):(f=360-f,m=e>m?f/(a-1):-f/(a-1));f=(c.s-b.s)/(a-1);g=(c.v-b.v)/(a-1);var h=b.s;b=b.v;var d,
l=new Uint8Array(4*a);for(d=0;d<a-1;d++){var p=u.toRGB({h:e,s:h,v:b});l[4*d]=p.r;l[4*d+1]=p.g;l[4*d+2]=p.b;l[4*d+3]=255;e+=m;h+=f;b+=g;360<e?e-=360:0>e&&(e+=360)}p=u.toRGB(c);l[4*(a-1)]=p.r;l[4*(a-1)+1]=p.g;l[4*(a-1)+2]=p.b;l[4*(a-1)+3]=255;b=l}else if(-1<m.toLowerCase().indexOf("lch")){h=u.toLCH(e);c=u.toLCH(c);a=a||256;b=(c.l-h.l)/(a-1);e=(c.c-h.c)/(a-1);m=(c.h-h.h)/(a-1);f=h.l;g=h.c;h=h.h;l=new Uint8Array(4*a);for(d=0;d<a-1;d++)p=u.toRGB({l:f,c:g,h:h}),l[4*d]=p.r,l[4*d+1]=p.g,l[4*d+2]=p.b,l[4*
d+3]=255,f+=b,g+=e,h+=m;p=u.toRGB(c);l[4*(a-1)]=p.r;l[4*(a-1)+1]=p.g;l[4*(a-1)+2]=p.b;l[4*(a-1)+3]=255;b=l}else if(-1<m.toLowerCase().indexOf("lab")){h=u.toLAB(e);c=u.toLAB(c);a=a||256;b=(c.l-h.l)/(a-1);e=(c.a-h.a)/(a-1);m=(c.b-h.b)/(a-1);f=h.l;g=h.a;h=h.b;l=new Uint8Array(4*a);for(d=0;d<a-1;d++)p=u.toRGB({l:f,a:g,b:h}),l[4*d]=p.r,l[4*d+1]=p.g,l[4*d+2]=p.b,l[4*d+3]=255,f+=b,g+=e,h+=m;p=u.toRGB(c);l[4*(a-1)]=p.r;l[4*(a-1)+1]=p.g;l[4*(a-1)+2]=p.b;l[4*(a-1)+3]=255;b=l}if(k&&!1===k.flattened)for(k=b,
b=[],c=0;c<b/4;c++)b[c]=k.slice(4*c,4*c+4);return b},createMultiPartColorRamp:function(m,k){if(!m)return null;k=k&&n.clone(k)||{flattened:!0};var e=m.colorRamps;if(!e||0===e.length)return null;var c=m.size||256;m=Math.max(Math.floor(c/e.length),1);var a=Math.max(m,c-(e.length-1)*m),b=!1!==k.flattened;k.flattened=!0;c=(e.length-1)*m+a;var f=new Uint8Array(4*c);for(c=0;c<e.length;c++){var g={fromColor:e[c].fromColor,toColor:e[c].toColor,size:c===e.length-1?a:m};f instanceof Array?f.concat(this.createAlgorithmicColorRamp(g,
k)):f.set(this.createAlgorithmicColorRamp(g,k),m*c*4)}if(!b)for(k=f,f=[],c=0;c<f/4;c++)f[c]=k.slice(4*c,4*c+4);return f},createRandomColorRamp:function(m){m=m||{};var k=m.size||256,e=!1===m.flattened;var c=e?new Uint8Array(4*k):[];for(m=0;m<k;m++)e?(c[4*m]=Math.round(255*Math.random()),c[4*m+1]=Math.round(255*Math.random()),c[4*m+2]=Math.round(255*Math.random()),c[4*m+3]=255):c[m]=[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),255];return c}}})},"esri/layers/rasterLib/function/rasterUtils":function(){define(["dojo/_base/lang"],
function(H){return{mask:function(n,u){if(n&&n.pixels&&n.pixels.length){n=this._clonePixelBlock(n);var m=u.includedRanges,k=u.noDataInterpretation;u=u.noDataValues;if(null===m&&null===u)return n;var e=n.pixels,c=n.mask,a=n.width*n.height,b=e.length,f;if(null!==u&&u.length!==b)throw"expect "+b+" elements in noDataValues";if(null!==m&&m.length!==2*b)throw"expect "+2*b+" elements in IncludeRanges";if(null==c){c=new Uint8Array(a);for(f=0;f<a;f++)c[f]=1;n.mask=c}if(0===k)for(k=0;k<b;k++){var g=e[k];var h=
null===m?null:m[2*k];var d=null===m?null:m[2*k+1];var l=null===u?null:parseFloat(u[k]);if(null===h||null===d)for(f=0;f<a;f++){if(c[f]){var p=g[f];p===l&&(c[f]=0)}}else if(null===l)for(f=0;f<a;f++)c[f]&&(p=g[f],p<h||p>d)&&(c[f]=0);else for(f=0;f<a;f++)c[f]&&(p=g[f],p<h||p>d||p===l)&&(c[f]=0)}else{var v=new Uint8Array(a);for(f=0;f<a;f++)v[f]=c[f];for(k=0;k<b;k++)if(g=e[k],h=null===m?null:m[2*k],d=null===m?null:m[2*k+1],l=null===u?null:parseFloat(u[k]),null===h||null===d)for(f=0;f<a;f++)v[f]&&(p=g[f],
p!==l&&(v=0));else if(null===l)for(f=0;f<a;f++)v[f]&&(p=g[f],p<=h&&p<=d&&(v=0));else for(f=0;f<a;f++)v[f]&&(p=g[f],p<=h&&p<=d&&p!==l&&(v=0));for(f=0;f<a;f++)c[f]&&v[f]&&(c[f]=0)}return n}},calculateStatisticsHistograms:function(n,u){n=this._clonePixelBlock(n);u=n.pixelType;var m=n.pixels,k=n.mask,e=m.length,c,a,b=[],f;for(c=0;c<e;c++){var g={min:-.5,max:255.5,size:256,counts:new Uint32Array(256)};var h=g.counts;var d=m[c];if("U8"===u)if(k)for(a=0;a<n.width*n.height;a++)k[a]&&h[d[a]]++;else for(a=
0;a<n.width*n.height;a++)h[d[a]]++;else{var l=n.statistics[c].minValue;var p=n.statistics[c].maxValue;g.min=l;g.max=p;p=(p-l)/256;var v=new Uint32Array(257);if(k)for(a=0;a<n.width*n.height;a++)k[a]&&v[Math.floor((d[a]-l)/p)]++;else for(a=0;a<n.width*n.height;a++)v[Math.floor((d[a]-l)/p)]++;for(a=0;255>a;a++)h[a]=v[a];h[255]=v[255]+v[256]}b.push(g);l=n.statistics[c].minValue;p=n.statistics[c].maxValue;for(a=v=f=d=0;a<g.size;a++)d+=h[a],f+=a*h[a];f/=d;for(a=0;a<g.size;a++)v+=h[a]*Math.pow(a-f,2);h=
Math.sqrt(v/(d-1));a=(f+.5)*(g.max-g.min)/g.size+g.min;g=h*(g.max-g.min)/g.size;n.statistics[c]={min:l,minValue:l,max:p,maxValue:p,mean:a,stddev:g}}n.histograms=b;return n},buildIndexedColormap:function(n,u){if(!n)return null;var m=0;0>n[0][0]&&(m=n[0][0]);var k=Math.max(256,n[n.length-1][0]-m);if(65536<k)return null;var e=new Uint8Array(4*k),c=[],a=0,b=5===n[0].length;if(u)for(c=n[a],u=c[0]-m;u<k;u++)e[4*u]=c[1],e[4*u+1]=c[2],e[4*u+2]=c[3],e[4*u+3]=b?c[4]:255,u===c[0]-m&&(c=a===n.length-1?c:n[++a]);
else for(u=0;u<n.length;u++)c=n[u],a=4*(c[0]-m),e[a]=c[1],e[a+1]=c[2],e[a+2]=c[3],e[a+3]=b?c[4]:255;return{indexedColormap:e,offset:m,alphaSpecified:b}},colorize:function(n,u){if(null!==n&&null!==n.pixels){n=this._clonePixelBlock(n);var m=n.pixels,k=n.width*n.height,e=n.mask,c=u.indexedColormap,a=u.indexedColormapOffset,b=c&&c.length-1,f=u.indexed2DColormap;u=u.alphaSpecified;if(3<=m.length)throw"colormap only works on single band image";var g=m[0],h=new Uint8Array(g.length),d=new Uint8Array(g.length),
l=new Uint8Array(g.length),p=0;if(c)if(e)for(m=0;m<k;m++)e[m]&&(p=4*(g[m]-a),p<a||p>b?e[m]=0:(h[m]=c[p],d[m]=c[p+1],l[m]=c[p+2],e[m]=c[p+3]));else{e=new Uint8Array(k);for(m=0;m<k;m++)p=4*(g[m]-a),p<a||p>b?e[m]=0:(h[m]=c[p],d[m]=c[p+1],l[m]=c[p+2],e[m]=c[p+3]);n.mask=e}else if(e)for(m=0;m<k;m++)e[m]&&(c=f[g[m]],h[m]=c[0],d[m]=c[1],l[m]=c[2],e[m]=c[3]);else{e=new Uint8Array(k);for(m=0;m<k;m++)c=f[g[m]],h[m]=c[0],d[m]=c[1],l[m]=c[2],e[m]=c[3];n.mask=e}n.pixels=[h,d,l];n.statistics=null;n.pixelType="U8";
n.maskIsAlpha=u;return n}},convolute:function(n,u){n=this._clonePixelBlock(n);var m=n.pixels,k=n.width,e=n.height,c=k*e,a=m.length,b,f,g,h,d=[],l=[],p=u.normalizedKernel,v=u.kernelRows,r=u.kernelCols;for(u=0;u<a;u++){var w=m[u];var y=new Float32Array(c);y.set(w);for(g=1;g<e-1;g++){var z=g*k;for(h=1;h<k-1;h++){for(b=l=0;b<v;b++)for(f=0;f<r;f++)l+=w[z+h+(b-1)*k+f-1]*p[b*r+f];y[z+h]=l}}d.push(y)}n.pixels=d;return n},contrastBrightnessStretch:function(n,u){if(null!==n&&null!==n.pixels){n=this._clonePixelBlock(n);
var m=n.pixels,k=n.mask,e=n.width*n.height,c=m.length;var a=u&&u.contrastOffset;u=u&&u.brightnessOffset;if("U8"!==n.pixelType)throw"the contrast and brightness function only supports 8 bit unsigned integer data";var b=this._createContrastBrightnessLUT(a,u);if(null==k)for(a=0;a<e;a++)for(u=0;u<c;u++)m[u][a]=b[m[u][a]];else for(a=0;a<e;a++)if(k[a])for(u=0;u<c;u++)m[u][a]=b[m[u][a]];n.pixelType="U8";return n}},isNull:function(n,u){if(null!==n&&null!==n.pixels){n=this._clonePixelBlock(n);u=n.mask;var m=
n.pixels[0],k=m.length,e;if(u){for(e=0;e<k;e++)m[e]=u[e]?0:1;n.mask=null}else if(m.fill)m.fill(0);else for(e=0;e<k;e++)m[e]=0;return n}},setNull:function(n){if(null!==u&&null!==u.pixels){var u=this._clonePixelBlock(n);n=u.mask;var m=u.pixels[0],k=m.length,e;n=n||new Uint8Array(k);for(e=0;e<k;e++)n[e]=m[e]?0:1;u.mask=n;return u}},local:function(n,u){if(!u)return n[0];var m=u.rasterCountNeeded;u=u.functor;var k=this._clonePixelBlock(n[0]);if(null!==k&&null!==k.pixels){var e=k.width*k.height,c;n=(c=
n[1])&&c.pixels[0];var a=c&&c.mask,b=k.mask,f=k.pixels[0];if(2===m)if(!b&&a)b=a;else if(b&&a)for(c=0;c<e;c++)b[c]=b[c]&&a[c]?1:0;k.mask=b;if(1===m)if(null==b)for(c=0;c<e;c++)f[c]=u(f[c]);else for(c=0;c<e;c++)b[c]&&(f[c]=u(f[c]));else if(2===m)if(null==b)for(c=0;c<e;c++)f[c]=u(f[c],n[c]);else for(c=0;c<e;c++)b[c]&&(f[c]=u(f[c],n[c]));k.mask=b;k.calculateStatistics();return k}},remapColor:function(n,u){n=this._clonePixelBlock(n);var m=n.width*n.height,k=u.length,e=Math.floor(k/2),c=u[Math.floor(e)],
a=u[0].value,b=u[u.length-1].value,f=n.pixels[0],g,h,d=!1,l=new Uint8Array(m),p=new Uint8Array(m),v=new Uint8Array(m),r=n.mask,w=4===u[0].mappedColor.length;r&&0!==r.length||(r=new Uint8Array(m),r.fill(w?255:1),n.mask=r);for(h=0;h<m;h++)if(r[h]){var y=f[h];if(y<a||y>b)l[h]=p[h]=v[h]=r[h]=0;else{d=!1;var z=e;var E=c;var B=0;for(g=k-1;1<g-B;){if(y===E.value){d=!0;break}y>E.value?B=z:g=z;z=Math.floor((B+g)/2);E=u[Math.floor(z)]}d||(E=y===u[g].value?u[g]:u[B]);l[h]=E.mappedColor[0];p[h]=E.mappedColor[1];
v[h]=E.mappedColor[2];r[h]=E.mappedColor[3]}}n.pixels=[l,p,v];n.mask=r;n.pixelType="u8";n.maskIsAlpha=w;return n},_clonePixelBlock:function(n){if(n.clone)return n.clone();var u=H.clone(n),m;if(n.pixels&&n.pixels[0]&&0<n.pixels[0].length&&!(u.pixels&&u.pixels[0]&&0<u.pixels[0].length)){u.pixels=[];var k=n.pixels.length;for(m=0;m<k;m++)u.pixels[m]=new n.pixels[m].constructor(n.pixels[m])}if(n.statistics)for(u.statistics=[],k=n.statistics.length,m=0;m<k;m++)u.statistics[m]=H.clone(n.statistics[m]);n.mask&&
(u.mask=new Uint8Array(n.mask));return u},_createContrastBrightnessLUT:function(n,u){if(this._contrastCache&&this._contrastCache.contrastOffset===n&&this._contrastCache.brightnessOffset===u)return this._contrastCache.lut;var m=Math.min(Math.max(n,-100),100),k=Math.min(Math.max(u,-100),100),e,c=new Uint8Array(256);for(e=0;256>e;e++){if(0<m&&100>m)var a=(200*e-25500+510*k)/(2*(100-m))+128;else 0>=m&&-100<m?a=(200*e-25500+510*k)*(100+m)/2E4+128:100===m?(a=200*e-25500+256*(100-m)+510*k,a=0<a?255:0):-100===
m&&(a=128);c[e]=255<a?255:0>a?0:a}this._contrastCache={contrastOffset:n,brightnessOffset:u,lut:c};return c}}})},"esri/layers/rasterLib/function/CompositeBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(H,n,u,m,k,e){return H([u,e],{declaredClass:"esri.layers.rasterLib.function.CompositeBandFunction",functionName:"CompositeBand",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=
this.mixinIgnoreCase({rasters:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.rasters)return Error("The rasters input to composite band function is invalid.");var a=[],b=[],f=c.rasters.length,g;if(c.rasters[0].statistics)for(g=0;g<f;g++)a.push(c.rasters[g].statistics[0]);if(c.rasters[0].histograms)for(g=0;g<f;g++)b.push(c.rasters[g].histograms[0]);this.rasterInfo=n.mixin(c.rasters[0],{bandCount:f,pixelType:this._calculatePixelType(this.pixelType,c.rasters[0].pixelType),statistics:a,
histograms:b});return!0},read2D:function(c){c=c.rasters;if(null!=c&&0!==c.length){var a=this._clonePixelData(c[0]),b=a.pixelBlock,f=[],g=[];for(h=0;h<c.length;h++)f.push(c[h].pixelBlock.pixels[0]),g.push(c[h].pixelBlock.statistics[0]);b.pixels=f;b.stackedStatistics=g;b.planes=c.length;var h;g=b.width*b.height;for(h=0;h<c.length;h++)if(b=c[h].pixelBlock.mask,d&&b)for(f=0;f<g;f++)d[f]&=b[f];else var d=d||b;a.maks=d;return a}},readGL:function(c){this._performance.start();this._initializeProgram({fragment:k.compositeBand,
fragmentName:"CompositeBand"});var a=c.rasters;if(null!=a&&0!==a.length){a=a.length;var b,f=this.bindFrameBuffer();for(b=0;b<a;b++){var g=this._setupTextureData(c.rasters[b],{notOriginal:0<b});var h=0<b?b.toString():"";this._bindTexture(g.texture,"u_image"+h)}this._setUniforms({u_rasterCount:a});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:g.extent,texture:f.texture}}}})})},"esri/layers/rasterLib/function/ContrastBrightnessFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(H,n,u,m,k,e,c){return H([u,e],{declaredClass:"esri.layers.rasterLib.function.ContrastBrightnessFunction",renderTexture:!0,functionName:"ContrastBrightness",supportWebGL:!0,support2D:!0,pixelType:"U8",constructor:function(a){this.functionArguments=this.mixinIgnoreCase({contrastOffset:0,brightnessOffset:0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to contrast and brightness function is invalid.");this.rasterInfo=n.mixin(a.raster,
{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){a=a.raster;if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var b=c.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.functionArguments.contrastOffset,brightnessOffset:this.functionArguments.brightnessOffset});"Unknown"!==
this.pixelType&&(b.pixelType=this.pixelType,b.pixels=b.pixels.map(n.hitch(this,function(f){return this._clampBand(f,b.pixelType)})));return{extent:a.extent,pixelBlock:b}}},readGL:function(a){return this._cbGL(a.raster)},_cbGL:function(a){this._performance.start();this._initializeProgram({fragment:k.contrastBrightness,fragmentName:"ContrastBrightness"});a=this._setupTextureData(a);this._setUniforms({u_contrastOffset:Math.min(Math.max(this.functionArguments.contrastOffset,-100),100),u_brightnessOffset:Math.min(Math.max(this.functionArguments.brightnessOffset,
-100),100),u_scaleFactor:this.renderTexture?255:1});this._bindTexture(a.texture,"u_image");var b=this.bindFrameBuffer();this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:b.texture}}})})},"esri/layers/rasterLib/function/ConvolutionFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./convolutionKernel ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(H,n,u,m,k,e,c,a){return H([u,
c],{declaredClass:"esri.layers.rasterLib.function.ConvolutionFunction",functionName:"Convolution",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({columns:3,rows:3,type:0,kernel:null,raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=n.mixin(b.raster,{bandCount:b.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,b.raster.pixelType),
statistics:b.raster.statistics,histograms:b.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(b){this._performance.start();b=b.raster;var f=this._analyzeKernel(),g=a.convolute(b.pixelBlock,{normalizedKernel:f.normalizedKernel,kernelCols:this.functionArguments.columns,kernelRows:this.functionArguments.rows});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&
(g.pixelType=this.pixelType);g.pixels=g.pixels.map(n.hitch(this,function(h){return this._clampBand(h,g.pixelType)}));return{extent:b.extent,pixelBlock:g}},readGL:function(b){this._performance.start();this._initializeProgram({fragment:e.convolution,fragmentName:"Convolution"});var f=this._setupTextureData(b.raster),g=this.bindFrameBuffer(),h=this.gl,d=h.drawingBufferWidth;h=h.drawingBufferHeight;var l=this.functionArguments.kernel;this._setUniforms({u_resolution:b&&b.raster&&b.raster.pixelBlock?[1/
b.raster.pixelBlock.width,1/b.raster.pixelBlock.height]:[1/d,1/h],u_kernel:l,u_kernelSize:l.length});this._bindTexture(f.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:g.texture}},_analyzeKernel:function(){var b=this.functionArguments.kernel,f=b.reduce(function(d,l){return d+l});0!==f&&1!==f&&(b=b.map(function(d){return d/f}));var g,h=[];for(g=0;g<b.length;g++)h.some(function(d){return d===b[g]})||h.push(b[g]);return{normalizedKernel:b,
distinctValues:h}},_analyzeKernelPattern:function(){var b=this.functionArguments.rows,f=this.functionArguments.columns,g=this.functionArguments.kernel,h=[],d,l;for(d=0;d<b;d++)h.push({weights:g.slice(d*f,(d+1)*f)});var p;for(d=1;d<b;d++){var v=h[d].weights;for(g=0;g<d;g++)if(p=h[g].weights){var r=v[0]/p[0];for(l=1;l<f;l++)v[l]/p[l]!==r&&(r=null);null!==r&&(h[d]={row:g,factor:r})}}return h}})})},"esri/layers/rasterLib/function/ExtractBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),
function(H,n,u,m,k,e){return H([u,e],{declaredClass:"esri.layers.rasterLib.function.ExtractBandFunction",functionName:"ExtractBand",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({bandIDs:[],missingBandAction:0,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to extract band function is invalid.");var a=[],b=c.raster.statistics,f=[],g=c.raster.histograms,h=this.functionArguments.bandIDs.length||
c.raster.bandCount;this.functionArguments.bandIDs.forEach(n.hitch(this,function(d){if(d>=h-1){if(1===this.functionArguments.missingBandAction)return Error("missing band "+d);d=h-1}if(0>d)return Error("missing band "+d);void 0!==b&&null!==b&&0<b.length&&a.push(b[d]);void 0!==g&&null!==g&&0<g.length&&f.push(g[d])}));this.rasterInfo=n.mixin(c.raster,{bandCount:h,pixelType:this._calculatePixelType(this.pixelType,c.raster.pixelType),statistics:a,histograms:f});return!0},read2D:function(c){c=this._clonePixelData(c.raster);
if(null!==c&&null!==c.pixelBlock&&null!==c.pixelBlock.pixels){this._performance.start();var a=c.pixelBlock,b=a.statistics,f=a.pixels,g=f.length;if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(0===this.functionArguments.bandIDs.length)return c;var h=[],d=[];this.functionArguments.bandIDs.forEach(function(l){if(l>=g-1){if(1===this.functionArguments.missingBandAction)throw"missing band "+l;l=g-1}if(0>l)throw"missing band "+l;h.push(f[l]);void 0!==b&&null!==b&&0<b.length&&
d.push(b[l])});a.pixels=h;a.statistics=d;a.planes=this.functionArguments.bandIDs.length;return c}},readGL:function(c){this._performance.start();if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(3<this.functionArguments.bandIDs.length)throw"this version does not support more than 3 bands yet";this._initializeProgram({fragment:k.extractBand,fragmentName:"ExtractBand"});var a=this.functionArguments.bandIDs;1===a.length&&(a=[a[0],a[0],a[0]]);this._bandIDs=a;this._alterBand=!(0===
this.functionArguments.bandIDs.length||0===a[0]&&1===a[1]&&2===a[2]);var b=!!(this._alterBand&&c.raster&&c.raster.texture);c=this._setupTextureData(c.raster,{bandIDs:a});var f=this.bindFrameBuffer();b?this._setUniforms({u_bandIDs:a,u_alterBand:this._alterBand}):this._setUniforms({u_bandIDs:a,u_alterBand:!1});this._bindTexture(c.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:c.extent,texture:f.texture}}})})},"esri/layers/rasterLib/function/HillshadeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../renderers/colorRampGenerator ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils ./rasterUtils".split(" "),
function(H,n,u,m,k,e,c,a,b,f){return H([u,a],{declaredClass:"esri.layers.rasterLib.function.HillshadeFunction",functionName:"Hillshade",supportWebGL:!0,support2D:!0,renderTexture:!0,constructor:function(g){this.functionArguments=this.mixinIgnoreCase({hillshadeType:0,altitude:45,azimuth:315,zFactor:1,slopeType:1,psPower:.664,psFactor:.024,colorRamp:null,raster:null},g);this._azimuths=[315,270,225,360,180,0];this._altitudes=[60,60,60,60,60,90];this._weights=[3,5,3,2,1,4];var h=this._weights.reduce(function(d,
l){return d+l});this._weights=this._weights.map(function(d){return d/h})},bind:function(g){g=this.getSourceRasterInfo(g);if(!g.raster)return Error("The raster input to hillshade function is invalid.");g.raster.statistics&&(this.srcStatistics=g.raster.statistics);this.rasterInfo=n.mixin(g.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:[{min:0,max:255}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=
"Generic";this._initializeColormap();return!0},read2D:function(g){this._performance.start();g=g.raster;g=b.hillshade(g,{altitude:this.functionArguments.altitude,azimuth:this.functionArguments.azimuth,zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,hillshadeType:this.functionArguments.hillshadeType,slopeType:this.functionArguments.slopeType,isGCS:g.extent.spatialReference.wkid&&null==k[g.extent.spatialReference.wkid]});this._addPerformanceMetric(this._performance.elapsed());
return g},readGL:function(g){this._performance.start();this._initializeProgram({fragment:c.hillshade,fragmentName:"Hillshade"});this.functionArguments.colorRamp&&this._indexedColormap&&!this._clrTexture&&(this._clrTexture=this._setupColormapTexture(this._indexedColormap));var h=this._setupTextureData(g.raster),d=this.bindFrameBuffer(),l=this.gl,p=l.drawingBufferWidth;l=l.drawingBufferHeight;var v=h.extent,r=(v.xmax-v.xmin)/p,w=(v.ymax-v.ymin)/l,y=this.functionArguments.altitude,z=this.functionArguments.azimuth,
E=this.functionArguments.zFactor;1===this.functionArguments.hillshadeType&&(E*=2);var B=E/(8*r),C=E/(8*w);.001<E&&v.spatialReference.wkid&&null==k[v.spatialReference.wkid]&&(B/=111E3,C/=111E3);var G=this.functionArguments.psPower,I=this.functionArguments.psFactor;3===this.functionArguments.slopeType&&((B=v.spatialReference.wkid&&null==k[v.spatialReference.wkid])?(B=111E3*r,C=111E3*w,B=(E+Math.pow(B,G)*I)/(8*B),C=(E+Math.pow(C,G)*I)/(8*C)):(B=(E+Math.pow(r,G)*I)/(8*r),C=(E+Math.pow(w,G)*I)/(8*w)));
var D=(90-y)*Math.PI/180;y=Math.cos(D);var q=(360-z+90)*Math.PI/180;z=Math.sin(D)*Math.cos(q);D=Math.sin(D)*Math.sin(q);G=Array(6);I=Array(6);v=Array(6);var t=this._weights,A;if(1===this.functionArguments.hillshadeType){var J=this._azimuths.length;for(A=0;A<J;A++)y=this._altitudes[A],z=this._azimuths[A],D=(90-y)*Math.PI/180,y=Math.cos(D),q=(360-z+90)*Math.PI/180,z=Math.sin(D)*Math.cos(q),D=Math.sin(D)*Math.sin(q),G[A]=y,I[A]=z,v[A]=D}else G[0]=y,I[0]=z,v[0]=D;G=G.map(function(M){return parseFloat(M)});
I=I.map(function(M){return parseFloat(M)});v=v.map(function(M){return parseFloat(M)});this._setUniforms({u_cellSize:[r,w],u_zfactor:E,u_xFactor:B,u_yFactor:C,u_sinZcosA:z,u_sinZsinA:D,u_cosZ:y,u_sinZcosAs:I,u_sinZsinAs:v,u_cosZs:G,u_weights:t,u_hillshadeType:this.functionArguments.hillshadeType,u_resolution:g&&g.raster&&g.raster.pixelBlock?[1/g.raster.pixelBlock.width,1/g.raster.pixelBlock.height]:[1/p,1/l],u_scaled:!this.renderTexture,u_applyColorramp:this._clrTexture?!0:!1,u_minValue:this.srcStatistics[0].min,
u_maxValue:this.srcStatistics[0].max,u_indexedColormapOffset:this._indexedColormapOffset||0,u_indexedColormapMaxIndex:this._indexedColormap?this._indexedColormap.length/4-1:0});this._clrTexture&&this._bindTexture(this._clrTexture,"u_image1");this._bindTexture(h.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:h.extent,texture:d.texture}},_initializeColormap:function(){this._indexedColormapOffset=0;var g=this._indexedColormap,h=this.functionArguments.colorRamp;
this.functionArguments.colormap?(this._alphaSpecified=(h=f.buildIndexedColormap(this.functionArguments.colormap))&&h.alphaSpecified,this._indexedColormap=h&&h.indexedColormap,this._indexedColormapOffset=h&&h.offset):h?(this._indexedColormap="multipart"===h.type?this.invert?m.createMultiPartColorRamp(this._invertColorRamp(h)):m.createMultiPartColorRamp(h):this.invert?m.createAlgorithmicColorRamp(this._invertColorRamp(h)):m.createAlgorithmicColorRamp(h),h.fromColor&&h.toColor&&"000"===h.fromColor.slice(0,
3).join("")&&"255255255"===h.toColor.slice(0,3).join("")&&(this._clrTexture=this._indexedColormap=null)):this.functionArguments.colormapName?"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=m.createRandomColorRamp()):this._clrTexture=this._indexedColormap=null;if(g&&this._indexedColormap){h=!0;for(var d=0;d<g.length;d++)if(g[d]!==this._indexedColormap[d]){h=!1;break}h||(this._clrTexture=null)}},_setupColormapTexture:function(g){var h=this._createTexture(),d=this.gl,
l=g.length/4,p=new Float32Array(g.length),v;for(v=0;v<g.length;v++)p[v]=g[v]/255;d.getExtension("OES_texture_float");d.texImage2D(d.TEXTURE_2D,0,d.RGBA,l,1,0,d.RGBA,d.FLOAT,p);return h}})})},"esri/layers/rasterLib/function/LocalFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(H,n,u,m,k,e,c){return H([u,e],{declaredClass:"esri.layers.rasterLib.function.LocalFunction",functionName:"Local",
supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({operation:null,rasters:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);var b=0;a.raster?b=a.raster.bandCount:a.rasters&&(b=Math.max.apply(null,a.rasters.map(function(f){return f.bandCount})));if(0===b)return Error("The raster input to local function is invalid. It only takes single band input.");a=a.raster||a.rasters.filter(function(f){return!!f.extent})[0];this.rasterInfo=n.mixin(a,{bandCount:1,
pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){var b=[];b=a.raster?a.raster2?[a.raster,a.raster2]:[a.raster]:a.rasters;a=b.map(function(l){return l.pixelBlock});var f=this.functionArguments.operation;if(null===f)return b[0];this._performance.start();var g=this._getOperations(),h=g.operators[f-1];g=g.functors[f-1];
if(!this.functionArguments.rasters){if(1!==h)throw"no sufficient rasters, require "+h;}else if(999!==h&&this.functionArguments.rasters.length!==h)throw"number of rasters does not meet (short or exceed) the operation requirment, require "+h;var d=31===f?c.isNull(a[0]):50===f?c.setNull(a[0]):c.local(a,{rasterCountNeeded:h,functor:g});"Unknown"!==this.pixelType&&(d.pixelType=this.pixelType,d.pixels=d.pixels.map(n.hitch(this,function(l){return this._clampBand(l,d.pixelType)})));d.statistics||d.calculateStatistics();
return{extent:b[0].extent,pixelBlock:d}},readGL:function(a){this._performance.start();var b=this.functionArguments.operation,f=this._getWebGLOperations(),g=f.operators[b-1],h=k.local;f="result\x3d"+f.functors[b-1]+";";31!==b&&50!==b&&(f+="result \x3d vec4(result.rgb, a.a);");h=h.replace("vec4 replaceme"+g+";",f);f=this.gl.getParameter(this.gl.VERSION);var d="";if(-1<f.toLowerCase().indexOf("webgl 1.0")||-1<f.toLowerCase().indexOf("webgl 0."))d=this._getPolyfill(b);h=h.replace("vec4 polyfill;",d);
1<g&&(h=h.replace("gl_FragColor \x3d localOp1();","gl_FragColor \x3d localOp1();".replace("1",g.toString())));this._initializeProgram({fragment:h,fragmentName:"Local"});b=a.rasters;if(null!=b&&0!==b.length){b=b.length;f=this.bindFrameBuffer();for(g=0;g<b;g++){h=0<g?g.toString():"";var l=this._setupTextureData(a.rasters[g],{reCreate:!0});this._bindTexture(l.texture,"u_image"+h)}this._setUniforms({});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:l.extent,texture:f.texture}}},
_getOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:[function(a,b){return a+b},function(a,b){return a-b},function(a,b){return a*b},function(a){return Math.sqrt(a)},function(a,b){return Math.pow(a,b)},function(a){return Math.acos(a)},function(a){return Math.asin(a)},function(a){return Math.atan(a)},function(a){return Math.atanh(a)},
function(a){return Math.abs(a)},function(a,b){return a&b},function(a,b){return a<<b},function(a){return~a},function(a,b){return a|b},function(a,b){return a>>b},function(a,b){return a^b},function(a,b){return a&&b},function(a){return!a},function(a,b){return a||b},function(a,b){return a!=b},function(a){return Math.cos(a)},function(a,b){return Math.cosh(a)},function(a,b){return a/b},function(a,b){return a==b},function(a){return Math.exp(a)},function(a){return Math.pow(10,a)},function(a){return Math.pow(2,
a)},function(a,b){return a>b?1:0},function(a,b){return a>=b?1:0},function(a,b){return Math.floor(a)},function(a){return!a},function(a){return a},function(a,b){return a<b?1:0},function(a,b){return a<=b?1:0},function(a){return Math.log(a)},function(a,b){return Math.log10(a)},function(a,b){return Math.log2(a)},999,999,999,999,999,999,function(a,b){return a%b},function(a){return-a},function(a,b){return a!=b?1:0},999,function(a,b){return Math.floor(a)},function(a,b){return Math.ceil(a)},function(a,b){return b?
0:a},function(a,b){return Math.sin(a)},function(a,b){return Math.sinh(a)},function(a,b){return a*a},999,999,function(a){return Math.tan(a)},function(a){return Math.tanh(a)},999,function(a){return Math.acosh(a)},function(a){return Math.asinh(a)},function(a,b){return Math.atan2(a,b)},function(a,b){return a/b},function(a,b){return Math.floor(a/b)},999,999,999,999,999,999,999,999,999,999,function(a,b,f){return a?b:f}]}},_polyfill:{sinh:"vec4 sinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp - 1.0/halfexp;\n}",
asinh:"vec4 asinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp - 1.0/halfexp);\n}",cosh:"vec4 cosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp + 1.0/halfexp;\n}",acosh:"vec4 acosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp + 1.0/halfexp);\n}",tanh:"vec4 tanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx - 1.0/expx)/(expx + 1.0/expx);\n}",atanh:"vec4 atanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx + 1.0/expx)/(expx - 1.0/expx);\n}"},_getPolyfill:function(a){var b=
"";switch(a){case 9:b=this._polyfill.atanh;break;case 22:b=this._polyfill.cosh;break;case 52:b=this._polyfill.sinh;break;case 57:b=this._polyfill.tanh;break;case 59:b=this._polyfill.acosh;break;case 60:b=this._polyfill.asinh}return b},_getWebGLOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:["(a + b)","(a - b)",
"(a * b)","sqrt(a)","pow(a, b)","acos(a)","asin(a)","atan(a)","atanh(a)","abs(a)","a","a","a","a","a","a","(a.r\x3d\x3d0.0 || b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","a.r\x3d\x3d0.0?vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","(a.r\x3d\x3d0.0 \x26\x26 b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","(a.r\x3d\x3d0.0 ^^ b.r\x3d\x3d0.0) ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","cos(a)","cosh(a)","a / b","a.r \x3d\x3d b.r? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
"exp(a)","pow(10.0, a)","pow(2.0, a)","a.r \x3e b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3e\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","floor(a)","a.a \x3d\x3d 0.0? vec4(1.0,1.0,1.0,1.0) : vec4(0.0,0.0,0.0,1.0)","a","a.r \x3c b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3c\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","log(a)","log2(a) / log2(10.0)","log2(a)",999,999,999,999,999,999,"mod(a, b)","-a","a.r !\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
999,"floor(a)","ceil(a)","a.r !\x3d 0.0 ? vec4(0.0,0.0,0.0,0.0) : a","sin(a)","sinh(a)","a * a",999,999,"tan(a)","tanh(a)",999,"acosh(a)","asinh(a)","atan(a, b)","a / b","floor(a / b)",999,999,999,999,999,999,999,999,999,999,"a.r!\x3d0 ? b : c"]}}})})},"esri/layers/rasterLib/function/MaskFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(H,n,u,m,k,e,c){return H([u,e],{declaredClass:"esri.layers.rasterLib.function.MaskFunction",
functionName:"Mask",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({includedRanges:null,noDataInterpretation:0,noDataValues:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to mask function is invalid.");this.rasterInfo=n.mixin(a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,a.raster.pixelType),statistics:a.raster.statistics,histograms:a.raster.histograms});
return!0},read2D:function(a){this._performance.start();a=a.raster;var b=c.mask(a.pixelBlock,{includedRanges:this.functionArguments.includedRanges,noDataInterpretation:this.functionArguments.noDataInterpretation,noDataValues:this.functionArguments.noDataValues});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(b.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:b}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:k.mask,fragmentName:"Mask"});
a=this._setupTextureData(a.raster);var b=this.bindFrameBuffer(),f=this.functionArguments.includedRanges,g=this.functionArguments.noDataValues?this.functionArguments.noDataValues.map(function(h){return parseFloat(h,10)}):null;this._setUniforms({u_includedRanges:f,u_includedRanges_specified:f?!0:!1,u_noDataValues:g,u_noDataValues_specified:g?!0:!1,u_noDataInterpretation:this.functionArguments.noDataInterpretation,u_bandCount:Math.min(this.sourceRasterInfo.raster.bandCount,3)});this._bindTexture(a.texture,
"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:b.texture}}})})},"esri/layers/rasterLib/function/NDVIFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(H,n,u,m,k,e,c){return H([u,e],{declaredClass:"esri.layers.rasterLib.function.NDVIFunction",functionName:"NDVI",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=
this.mixinIgnoreCase({visibleBandID:1,infraredBandID:2,scaled:!0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!(a.raster&&1<a.raster.bandCount))return Error("The raster input to ndvi function is invalid. It requires more than 1 band.");this.rasterInfo=n.mixin(a.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,this.scaled?"U8":"F32"),statistics:this.scaled?[{min:0,max:200}]:[{min:-1,max:1}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||
{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var b=c.calculate(a.pixelBlock,{bandIndexes:[this.functionArguments.infraredBandID+1,this.functionArguments.visibleBandID+1].join(" "),method:1}),f;if(this.functionArguments.scaled){var g=b.pixels[0];var h=b.mask;var d=g.length;var l=new Uint8Array(d);if(null==h)for(f=0;f<d;f++)l[f]=100*g[f]+100&255;else for(f=0;f<d;f++)h[f]&&(l[f]=100*g[f]+100&255);b.pixels[0]=l;b.pixelType="U8"}this._addPerformanceMetric(this._performance.elapsed());
"Unknown"!==this.pixelType&&(b.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:b}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:k.ndvi,fragmentName:"NDVI"});var b=this.functionArguments.visibleBandID,f=this.functionArguments.infraredBandID,g=this.functionArguments.scaled||!1;this._alterBand=2<Math.max(f,b)?!0:!1;a=this._setupTextureData(a.raster,{bandIDs:this._alterBand?{bandIDs:[f,b,f]}:null});var h=this.bindFrameBuffer();this._alterBand?this._setUniforms({u_bandId_nir:0,
u_bandId_red:1,u_scaled:g}):this._setUniforms({u_bandId_nir:f,u_bandId_red:b,u_scaled:g});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:h.texture}}})})},"esri/layers/rasterLib/function/SlopeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),function(H,n,u,m,k,e,
c,a){return H([u,c],{declaredClass:"esri.layers.rasterLib.function.SlopeFunction",functionName:"Slope",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({zFactor:1,slopeType:1,psPower:.664,psFactor:.024,raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input to slope function is invalid.");this.rasterInfo=n.mixin(b.raster,{bandCount:1,pixelType:this._calculatePixelType(this.outputPixelType,"F32"),statistics:1===
this.slopeType||3===this.slopeType?[{min:0,max:90}]:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(b){this._performance.start();b=b.raster;b=a.slope(b,{zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,slopeType:this.functionArguments.slopeType,isGCS:b.extent.spatialReference.wkid&&null==m[b.extent.spatialReference.wkid]});
this._addPerformanceMetric(this._performance.elapsed());return b},readGL:function(b){this._performance.start();this._initializeProgram({fragment:e.slope,fragmentName:"Slope"});var f=this._setupTextureData(b.raster),g=this.bindFrameBuffer(),h=this.gl,d=h.drawingBufferWidth;h=h.drawingBufferHeight;var l=f.extent;this._setUniforms({u_resolution:b&&b.raster&&b.raster.pixelBlock?[1/b.raster.pixelBlock.width,1/b.raster.pixelBlock.height]:[1/d,1/h],u_cellSize:[(l.xmax-l.xmin)/d,(l.ymax-l.ymin)/h],u_zfactor:this.functionArguments.zFactor});
this._bindTexture(f.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:g.texture}}})})},"esri/layers/rasterLib/function/StretchFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./vertexShaders ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(H,n,u,m,k,e,c){return H([u,c],{declaredClass:"esri.layers.rasterLib.function.StretchFunction",functionName:"Stretch",supportWebGL:!0,
support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,computeGamma:!1},a);this.functionArguments.statistics=this._convertStats(this.functionArguments.statistics);-1===[0,3,5,6].indexOf(this.functionArguments.stretchType)&&(console.error("The specific stretch type has not been implemented: "+this.functionArguments.stretchType),
this.functionArguments.stretchType=5);this.min=null==this.min?0:this.min;this.max=null==this.max?255:this.max},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to stretch function is invalid.");a.raster.statistics&&(this.srcStatistics=this._convertStats(a.raster.statistics));a.raster.histograms&&(this.srcHistograms=a.raster.histograms);this.rasterInfo=n.mixin({},a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),
statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){a=a.raster;this._stretch(a);return a},hasTilingEffects:function(a){a=a||this.functionArguments;return!!(a.dra||a.raster&&"object"===typeof a.raster&&a.raster.dra)},_convertStats:function(a){return a?a.map(function(b){return b&&null!=b.min?[b.min,b.max,b.mean,b.stddev]:b}):null},_updateStatistisHistograms:function(a){var b=this.functionArguments,
f=b.histograms||this.srcHistograms;if(a&&a.pixelBlock&&a.pixelBlock.pixels){if(0===b.stretchType)this._statistics=b.statistics&&0<b.statistics.length?b.statistics:this.srcStatistics,this._histograms=f;else{var g=a.pixelBlock,h=g.pixels.length,d=6===b.stretchType&&(b.dra||!f)||3===b.stretchType&&b.dra;d&&(g.statistics||g.calculateStatistics(),this._calculateStatisticsHistograms(a));if(b.dra)if(g.statistics||g.calculateStatistics(),d)this._statistics=g.statistics,this._histograms=g.histograms;else for(b=
g.statistics,this._statistics=[],a=0;a<h;a++)this._statistics[a]=[b[a].minValue,b[a].maxValue,0,0];else this._statistics=b.statistics&&0<b.statistics.length?b.statistics:this.srcStatistics,this._histograms=f}this._statistics=this._convertStats(this._statistics);this._gammaCorrection=this._getGammaCorrection()}else this._statistics=b.statistics&&0<b.statistics.length?b.statistics:this.srcStatistics,this._histograms=f,this._gammaCorrection=this._getGammaCorrection(),this._statistics=this._convertStats(this._statistics)},
_getGammaCorrection:function(){var a=this.functionArguments.gamma;if(a){var b=[],f;for(f=0;f<a.length;f++)b[f]=1<a[f]?2<a[f]?6.5+Math.pow(a[f]-2,2.5):6.5+100*Math.pow(2-a[f],4):1;return b}},_stretch:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels&&0!==this.functionArguments.stretchType){this._updateStatistisHistograms(a);var b=a.pixelBlock,f=b.pixels;b=b.width*b.height;var g=f.length,h,d;this._createLUT(a);if(null==this.LUT)return this._filterNoLUT(a);var l=this.LUT,p=this.LUTOffset;
for(h=0;h<g;h++){var v=l[h];for(d=0;d<b;d++){var r=f[h][d];f[h][d]=v[r-p]}}a.pixelBlock.pixelType="U8"}},_calculateStatisticsHistograms:function(a){a=a.pixelBlock;var b=a.pixelType,f=a.pixels,g=a.mask,h=f.length,d,l,p=function(I){this.min=-.5;this.max=255.5;this.size=256;n.mixin(this,I);this.counts=this.counts||new Uint32Array(this.size)},v=[],r,w;for(d=0;d<h;d++){var y=new p;var z=y.counts;var E=f[d];if("U8"===b)if(g)for(l=0;l<a.width*a.height;l++)g[l]&&z[E[l]]++;else for(l=0;l<a.width*a.height;l++)z[E[l]]++;
else{var B=a.statistics[d].minValue;var C=a.statistics[d].maxValue;y.min=B;y.max=C;C=(C-B)/256;var G=new Uint32Array(257);if(g)for(l=0;l<a.width*a.height;l++)g[l]&&G[Math.floor((E[l]-B)/C)]++;else for(l=0;l<a.width*a.height;l++)G[Math.floor((E[l]-B)/C)]++;for(l=0;255>l;l++)z[l]=G[l];z[255]=G[255]+G[256]}v.push(y);E=[];B=a.statistics[d].minValue;C=a.statistics[d].maxValue;for(l=w=r=G=0;l<y.size;l++)G+=z[l],r+=l*z[l];r/=G;for(l=0;l<y.size;l++)w+=z[l]*Math.pow(l-r,2);z=Math.sqrt(w/(G-1));l=(r+.5)*(y.max-
y.min)/y.size+y.min;y=z*(y.max-y.min)/y.size;E.push(B);E.push(C);E.push(l);E.push(y);a.statistics[d]={min:B,minValue:B,max:C,maxValue:C,mean:l,stddev:y}}a.histograms=v},_getCutOffPoints:function(a){var b=this.functionArguments,f=999;a&&a.pixelBlock?f=a.pixelBlock.pixels.length:a&&a.texture&&(f=3);a=Math.min(f,this._statistics.length);var g=[],h=[],d,l;switch(b.stretchType){case 5:for(d=0;d<a;d++)g[d]=this._statistics[d][0],h[d]=this._statistics[d][1];break;case 3:for(d=0;d<a;d++)g[d]=this._statistics[d][2]-
b.numberOfStandardDeviations*this._statistics[d][3],h[d]=this._statistics[d][2]+b.numberOfStandardDeviations*this._statistics[d][3],g[d]<this._statistics[d][0]&&(g[d]=this._statistics[d][0]),h[d]>this._statistics[d][1]&&(h[d]=this._statistics[d][1]);break;case 6:for(d=0;d<a;d++){f=this._histograms[d];var p=new Uint32Array(f.size);var v=f.counts;var r=0;var w=-.5===f.min&&1===(f.max-f.min)/v?.5:0;for(l=0;l<f.size;l++)r+=v[l],p[l]=r;v=b.minPercent*r/100;for(l=0;l<f.size;l++)if(p[l]>v){g[d]=f.min+(f.max-
f.min)/f.size*(l+w);break}v=(1-b.maxPercent/100)*r;for(l=f.size-2;0<=l;l--)if(p[l]<v){h[d]=f.min+(f.max-f.min)/f.size*(l+2-w);break}}break;default:for(d=0;d<f;d++)g[d]=0,h[d]=255}return{minCutOff:g,maxCutOff:h}},_createLUT:function(a){var b=this.functionArguments,f=a.pixelBlock,g=f.pixelType;if("U8"===g||"U16"===g||"S8"===g||"S16"===g){if(this._LUTSignature&&(g=this._computeLutSignature(),g.length===this._LUTSignature.length&&!g.some(function(D,q){return D!==this._LUTSignature[q]}.bind(this))))return;
g=f.pixels.length;var h=[],d=[],l=b.max,p=b.min,v=b.gamma,r=l-p,w=this._getCutOffPoints(a);a=w.minCutOff;w=w.maxCutOff;var y=0,z=256;"S8"===f.pixelType?y=-127:"S16"===f.pixelType&&(y=-32767);if("U16"===f.pixelType||"S16"===f.pixelType)z=65536;for(f=0;f<g;f++)h[f]=w[f]-a[f];var E=this._gammaCorrection;if(b.useGamma)for(f=0;f<g;f++){var B=[];for(b=0;b<z;b++){var C=b+y;var G=(C-a[f])/h[f];var I=1;1<v[f]&&(I-=Math.pow(1/r,G*E[f]));C<w[f]&&C>a[f]?B[b]=Math.floor(I*r*Math.pow(G,1/v[f]))+p:C>w[f]?B[b]=l:
C<a[f]&&(B[b]=p)}d[f]=B}else for(f=0;f<g;f++){B=[];for(b=0;b<z;b++)C=b+y,B[b]=C<a[f]?p:C>w[f]?l:Math.floor((C-a[f])/h[f]*r)+p;d[f]=B}this.LUT=d;this.LUTOffset=y;this._LUTSignature=this._computeLutSignature()}},_computeLutSignature:function(){var a=this.functionArguments,b=[],f,g;b.push(a.stretchType);b.push(a.min);b.push(a.max);b.push(a.numberOfStandardDeviations);if(this._statistics)for(f=0;f<this._statistics.length;f++)for(g=0;g<this._statistics[f].length;g++)b.push(this._statistics[f][g]);b.push(a.dra?
1:0);b.push(a.minPercent);b.push(a.maxPercent);if(a.gamma)for(f=0;f<this._statistics.length;f++)b.push(a.gamma[f]);b.push(a.useGamma?1:0);return b},_filterNoLUT:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var b=this.functionArguments,f=a.pixelBlock,g=f.pixels,h=f.mask;f=f.width*f.height;var d=g.length,l=[],p=[],v=b.max,r=b.min,w=b.gamma,y=v-r;var z=this._getCutOffPoints(a);var E=z.minCutOff,B=z.maxCutOff;for(z=0;z<d;z++)l[z]=B[z]-E[z];if(b.useGamma&&null!==w&&w.length>=
d)for(z=0;z<d;z++)p[z]=1<w[z]?2<w[z]?6.5+Math.pow(w[z]-2,2.5):6.5+100*Math.pow(2-w[z],4):1;if(b.useGamma)if(void 0!==h&&null!==h)for(b=0;b<f;b++){if(h[b])for(z=0;z<d;z++){var C=g[z][b];var G=(C-E[z])/l[z];var I=1;1<w[z]&&(I-=Math.pow(1/y,G*p[z]));C<B[z]&&C>E[z]?g[z][b]=Math.floor(I*y*Math.pow(G,1/w[z]))+r:C>B[z]?g[z][b]=v:C<E[z]&&(g[z][b]=r)}}else for(b=0;b<f;b++)for(z=0;z<d;z++)C=g[z][b],G=(C-E[z])/l[z],I=1,1<w[z]&&(I-=Math.pow(1/y,G*p[z])),C<B[z]&&C>E[z]?g[z][b]=Math.floor(I*y*Math.pow(G,1/w[z]))+
r:C>B[z]?g[z][b]=v:C<E[z]&&(g[z][b]=r);else if(void 0!==h&&null!==h)for(b=0;b<f;b++){if(h[b])for(z=0;z<d;z++)C=g[z][b],C<B[z]&&C>E[z]?g[z][b]=Math.floor((C-E[z])/l[z]*y)+r:C>B[z]?g[z][b]=v:C<E[z]&&(g[z][b]=r)}else for(b=0;b<f;b++)for(z=0;z<d;z++)C=g[z][b],C<B[z]&&C>E[z]?g[z][b]=Math.floor((C-E[z])/l[z]*y)+r:C>B[z]?g[z][b]=v:C<E[z]&&(g[z][b]=r);a.pixelBlock.pixelType="U8";return a}},_computeGammaValues:function(a){var b=this._statistics.length,f,g=[];for(f=0;f<b;f++){var h=this._statistics[f][2];"U8"!==
a&&(h=255*(h-this._statistics[f][0])/(this._statistics[f][1]-this._statistics[f][0]));g.push(this._computeGammaValue(h))}return g},_computeGammaValue:function(a){if(0!==a&&!(255<a||0>a)){var b=0;0<a&&150!=a&&255>a&&(b=150>=a?45*Math.cos(.01047*a):17*Math.sin(.021*a));b=Math.log((a+b)/255);if(0!==b&&(a=Math.log(a/255)/b,!isNaN(a)))return Math.min(9.9,Math.max(.01,a))}},readGL:function(a){return this._stretchGL(a.raster)},_stretchGL:function(a){this._performance.start();var b=this.renderTexture,f,g=
a.pixelBlock&&a.pixelBlock.pixels&&a.pixelBlock.pixels.length||this.sourceRasterInfo.raster.bandCount,h=a.pixelBlock,d=this.gl,l=d.drawingBufferWidth,p=d.drawingBufferHeight;if(!h&&this.functionArguments.dra){var v=new Float32Array(l*p*4),r=new Uint8Array(l*p);var w=new Float32Array(l*p);var y=new Float32Array(l*p);var z=new Float32Array(l*p);d.checkFramebufferStatus(d.FRAMEBUFFER)==d.FRAMEBUFFER_COMPLETE&&d.readPixels(0,0,l,p,d.RGBA,d.FLOAT,v);for(f=0;f<l*p;f++)w[f]=v[4*f],y[f]=v[4*f+1],z[f]=v[4*
f+2],r[f]=v[4*f+3];a.pixelBlock=new m({width:l,height:p,pixels:[w,y,z],mask:r});a.pixelBlock.calculateStatistics()}!h&&this.functionArguments.dra&&this._useGPUStats?(w=new Float32Array(g),y=new Float32Array(g)):(this._updateStatistisHistograms(a),v=this._getCutOffPoints(a),w=new Float32Array(g),y=new Float32Array(g),w.set(v.minCutOff.slice(0,g)),y.set(v.maxCutOff.slice(0,g)));this._initializeProgram({fragment:e.stretch,fragmentName:"Stretch"});v=this._setupTextureData(a);r=this.bindFrameBuffer();
this.renderTexture=!1;this._performance.start();if(!h&&this.functionArguments.dra&&this._useGPUStats){this._setUniforms({u_sourceDim:[l,p],u_bandCount:g});if(1===g)var E=this._readMinMax(v,2);else{E=this._readMinMax(v,0);var B=this._readMinMax(v,1)}if(6===this.functionArguments.stretchType||3===this.functionArguments.stretchType&&this.functionArguments.dra)f=this._readHistogram(E,B,a),w=f.minCutOff||w,y=f.minCutOff||y}z=this.functionArguments.max-this.functionArguments.min;a=new Float32Array(g);for(f=
0;f<g;f++)a[f]=z/(y[f]-w[f]);this._useGPUStats&&this._initializeProgram({fragment:e.stretch,fragmentName:"Stretch"});d.blendFunc(d.SRC_ALPHA,d.ZERO);z=new Float32Array(3);var C=new Float32Array(3);for(f=0;3>f;f++)z[f]=this.functionArguments.min,C[f]=this.functionArguments.max;f=this.functionArguments.useGamma;var G=this.functionArguments.gamma,I=this._gammaCorrection;Array.isArray(G)&&G.length>=g||(f=!1);this._setUniforms({u_sourceDim:[l,p],u_bandCount:g,u_minOutput:z,u_maxOutput:C,u_minCutOff:w,
u_maxCutOff:y,u_factor:a,u_state:100,u_useGamma:f,u_gamma:G,u_scaled:!b,u_gammaCorrection:I,u_minMaxTexture:!h&&this.functionArguments.dra&&this._useGPUStats?!0:!1});this.renderTexture=b;d.viewport(0,0,l,p);this._bindTexture(v.texture,"u_image");!h&&this.functionArguments.dra&&this._useGPUStats&&(b=d.getUniformLocation(this.rasterProgram,"u_image1"),d.uniform1i(b,1),d.activeTexture(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,E.texture),1<g&&(g=d.getUniformLocation(this.rasterProgram,"u_image2"),d.uniform1i(g,
2),d.activeTexture(d.TEXTURE2),d.bindTexture(d.TEXTURE_2D,B.texture)));this._drawGL();return{extent:v.extent,texture:r.texture}},_readMinMax:function(a,b){var f=this.gl,g=a.width||f.drawingBufferWidth,h=a.height||f.drawingBufferHeight;this._setUniforms({u_state:b});this.renderTexture=!1;var d=a.texture;for(f.activeTexture(f.TEXTURE0);1<g||1<h;){var l=this._createTexture();b=Math.max(Math.ceil(g/2),1);var p=Math.max(Math.ceil(h/2),1);f.getExtension("OES_texture_float");f.texImage2D(f.TEXTURE_2D,0,
f.RGBA,b,p,0,f.RGBA,f.FLOAT,null);a=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,a);f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l,0);f.viewport(0,0,b,p);f.bindTexture(f.TEXTURE_2D,d);this._setUniforms({u_sourceDim:[g,h]});g=b;h=p;this._drawGL(!0);d=l}a=new Float32Array(g*h*4);f.checkFramebufferStatus(f.FRAMEBUFFER)==f.FRAMEBUFFER_COMPLETE&&f.readPixels(0,0,g,h,f.RGBA,f.FLOAT,a);return{texture:l,minmax:a}},_readHistogram:function(a,b,f){if(a)try{var g=this.gl,h=g.drawingBufferWidth,
d=g.drawingBufferHeight,l,p,v;if(a.texture instanceof WebGLTexture){var r=!0;var w=[1,0,0,1];if(b){var y=a.minmax;var z=b.minmax}else y=[a.minmax[0]],z=[a.minmax[1]]}else for(z=b,y=a,w=new Float32Array(z.length),l=0;l<z.length;l++)w[l]=256/(z[l]-y[l]);var E=new Float32Array(h*d);for(v=0;v<E.length;v++)E[v]=v;if(!this.histogramProgram){var B=k.getShader(g,k.histogram),C=e.getShader(g,e.constant);this.histogramProgram=this._loadProgram(B,C)}g.blendFunc(g.ONE,g.ONE);g.enable(g.BLEND);g.useProgram(this.histogramProgram);
var G=g.getAttribLocation(this.histogramProgram,"a_pixelIndex"),I=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,I);g.bufferData(g.ARRAY_BUFFER,E,g.STATIC_DRAW);g.enableVertexAttribArray(G);g.vertexAttribPointer(G,1,g.FLOAT,!1,0,0);var D=this._setupHistTexture(f),q=this._createTexture();g.getExtension("OES_texture_float");g.texImage2D(g.TEXTURE_2D,0,g.RGBA,257,1,0,g.RGBA,g.FLOAT,null);var t=g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,t);g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,
g.TEXTURE_2D,q,0);g.viewport(0,0,257,1);var A=g.getUniformLocation(this.histogramProgram,"u_image");g.uniform1i(A,0);g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,D);var J=g.getUniformLocation(this.histogramProgram,"u_sourceDim");g.uniform2f(J,h,d);var M=g.getUniformLocation(this.histogramProgram,"u_bandCount");g.uniform1i(M,3);var N=g.getUniformLocation(this.histogramProgram,"u_halfPixel");g.uniform2f(N,.5/h,.5/d);var x=g.getUniformLocation(this.histogramProgram,"u_minMaxTexture");if(r){g.uniform1i(x,
1);var F=g.getUniformLocation(this.histogramProgram,"u_image1");g.uniform1i(F,1);g.activeTexture(g.TEXTURE1);g.bindTexture(g.TEXTURE_2D,a.texture);if(b){var L=g.getUniformLocation(this.histogramProgram,"u_image2");g.uniform1i(L,2);g.activeTexture(g.TEXTURE2);g.bindTexture(g.TEXTURE_2D,b.texture)}}else{var O=g.getUniformLocation(this.histogramProgram,"u_mins");g.uniform4f(O,y[0],y[0],y[0],y[0]);g.uniform1i(x,0)}var P=g.getUniformLocation(this.histogramProgram,"u_color"),S=g.getUniformLocation(this.histogramProgram,
"u_factors"),T=g.getUniformLocation(this.histogramProgram,"u_size");g.uniform1f(T,256);a=[];b=[];g.uniform4fv(P,[1,0,0,1]);g.uniform4fv(S,[w[0],0,0,1]);g.drawArrays(g.POINTS,0,E.length);var W=this.sourceRasterInfo.raster.bandCount;1<W&&(g.uniform4fv(P,[0,1,0,1]),g.uniform4fv(S,[0,w[0],0,1]),g.drawArrays(g.POINTS,0,E.length),g.uniform4fv(P,[0,0,1,1]),g.uniform4fv(S,[0,0,w[0],1]),g.drawArrays(g.POINTS,0,E.length));if(g.checkFramebufferStatus(g.FRAMEBUFFER)==g.FRAMEBUFFER_COMPLETE){var X=new Float32Array(1028);
g.readPixels(0,0,257,1,g.RGBA,g.FLOAT,X);g=0;var K=-.5===y[0]&&1===(z[0]-y[0])/256?.5:0;for(l=0;l<W;l++){var R=new Float32Array(257);var Q=new Float32Array(257);for(v=g=0;256>v;v++)g+=X[4*v+l],R[v]=g,Q[v]=X[4*v+l];Q[256]=X[1024+l];R[256]=g+X[1024+l];var U=this.functionArguments.minPercent*g/100;if(z){for(p=0;256>p;p++)if(R[p]>U){a[l]=y[0]+(z[0]-y[0])/256*(p+K);break}U=(1-this.functionArguments.maxPercent/100)*g;for(p=254;0<=p;p--)if(R[p]<U){b[l]=y[0]+(z[0]-y[0])/256*(p+2-K);break}}}}return{histogram:X,
minCutOff:a,maxCutOff:b}}catch(V){console.debug("webgl filter exception: "+V.message)}},_setupHistTexture:function(a){if(a instanceof WebGLTexture)return a;var b=this.originalHistTexture=this._createTexture(),f=this.gl;a=a.pixelBlock;var g=a.width,h=a.height;f.getExtension("OES_texture_float");this.rgbaFloatData=a.getAsRGBAFloat();f.texImage2D(f.TEXTURE_2D,0,f.RGBA,g,h,0,f.RGBA,f.FLOAT,this.rgbaFloatData);return b}})})},"esri/layers/rasterLib/function/RemapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(H,n,u,m,k,e,c){return H([m,e],{declaredClass:"esri.layers.rasterLib.function.RemapFunction",functionName:"Remap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({inputRanges:null,outputValues:null,outputColors:null,colorBreaks:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input is not available.");var b=!(!this.functionArguments.outputColors&&!this.functionArguments.colorBreaks);
this.rasterInfo=n.mixin(a.raster,{bandCount:b?3:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=b?"Processed":"Thematic";return!0},read2D:function(a){return this._remap(a.raster)},readGL:function(a){return this._remapGL(a.raster)},_remap:function(a){this._performance.start();var b=c.remapColor(a.pixelBlock,this.functionArguments.colorBreaks);this._addPerformanceMetric(this._performance.elapsed());
return{extent:a.extent,pixelBlock:b}},_remapGL:function(a){this._performance.start();this._initializeProgram({fragment:k.remap,fragmentName:"Remap"});var b=new Uint8Array(64),f=this.functionArguments.colorBreaks;f.forEach(function(l,p){b[4*p]=l.mappedColor[0];b[4*p+1]=l.mappedColor[1];b[4*p+2]=l.mappedColor[2];b[4*p+3]=1>=l.mappedColor[3]?255*l.mappedColor[3]:l.mappedColor[3]});var g=f[f.length-1],h=g.mappedColor;b[60]=h[0];b[61]=h[1];b[62]=h[2];b[63]=1>=h[3]?255*h[3]:h[3];var d=new Float32Array(16);
f.forEach(function(l,p){d[p]=l.value});d[15]=g.value;this._clrTexture||(this._clrTexture=this._setupColormapTexture(b));f=this._clrTexture;g=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:0,u_indexedColormapMaxIndex:b.length/4-1,u_breaks:d});this._bindTexture(f,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:g.texture}},_setupColormapTexture:function(a){var b=this._createTexture(),f=a.length/4,g=new Float32Array(a.length),
h=this.renderTexture?255:1,d,l=this.gl;for(d=0;d<a.length;d++)g[d]=a[d]/h;l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,l.RGBA,f,1,0,l.RGBA,l.FLOAT,g);return b}})})},"esri/layers/rasterLib/function/IdentityFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(H,n,u,m,k){return H([m,k],{declaredClass:"esri.layers.rasterLib.function.IdentityFunction",functionName:"Identity",supportWebGL:!0,support2D:!0,
constructor:function(e){this.functionArguments={raster:null}},bind:function(e){e=this.getSourceRasterInfo(e);if(!e.raster)return Error("The raster input to identity function is invalid.");this.rasterInfo=n.mixin(e.raster,{});return!0},read2D:function(e){return e.raster},readGL:function(e){this._initializeProgram({fragment:u.identity,fragmentName:"identity"});e=this._setupTextureData(e.raster);var c=this.bindFrameBuffer();this._bindTexture(e.texture,"u_image");this._drawGL();return{extent:e.extent,
texture:c.texture}}})})},"esri/layers/rasterLib/function/ResampleFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(H,n,u,m,k){return H([m,k],{declaredClass:"esri.layers.rasterLib.function.ResampleFunction",renderTexture:!0,resamplingOrigin:null,resamplingRatio:null,zFactor:1,functionName:"Resample",supportWebGL:!0,support2D:!1,constructor:function(e){this.functionArguments=this.mixinIgnoreCase({resamplingType:0},
e)},bind:function(e){e=this.getSourceRasterInfo(e);if(!e.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=n.mixin(e.raster,{bandCount:e.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,e.raster.pixelType),statistics:e.raster.statistics,histograms:e.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};return!0},readGL:function(e){this._performance.start();this._initializeProgram({fragment:u.resample,fragmentName:"Resample"});
var c=this._setupTextureData(e.raster),a=this.bindFrameBuffer(),b=this.gl,f=b.drawingBufferWidth;b=b.drawingBufferHeight;var g=e.raster;void 0!==g.pixelBlock?(c=c||this._setupTextureData(g),e=g.pixelBlock.width,g=g.pixelBlock.height):(c=c||g,e=f,g=b);this._setUniforms({u_resamplingRatio:this.resamplingRatio||[e/f,g/b],u_anchor:this.resamplingOrigin||[0,1],u_resamplingType:this.functionArguments.resamplingType,u_resolution:[1/f,1/b]});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());
return{extent:c.extent,texture:a.texture}}})})},"esri/layers/rasterLib/renderer/rasterRendererHelper":function(){define("dojo/_base/declare dojo/_base/lang ../../PixelBlock ./RasterColormapRenderer ./RasterUniqueValueRenderer ./RasterRGBRenderer ./RasterStretchColorRampRenderer ./RasterClassBreaksRenderer ./RasterShadedReliefRenderer".split(" "),function(H,n,u,m,k,e,c,a,b){var f=function(){function g(d){h[d.prototype.rendererName]=d}var h={};g(m);g(e);g(c);g(k);g(a);g(b);return h}();return{wellKnownRenderers:f,
isSupported:function(g){if(!g)return!1;var h=!0;f[g.rendererName]||(h=!1);return h},create:function(g){if(!g)return null;if(g.rendererName){var h=g.rendererName;g=g.rendererArguments}else h="uniqueValue rasterStretch rasterShadedRelief rgb rasterColormap classBreaks".split(" ").indexOf(g.type),h="UniqueValue Stretch ShadedRelief RGB Colormap ClassBreaks".split(" ")[h],"rasterStretch"===g.type&&g.bandIndex&&1<g.bandIndex.length&&(h="RGB");return(h=f[h])?new h(g):null},createDefaultRenderer:function(g){if(g&&
g.raster){var h=g.raster.rasterInfo,d=g.raster.dataType;if(h){var l=g.raster.rasterFunction,p=["Stretch","Colormap","ContrastAndBrightness"];if(l&&"U8"===h.pixelType&&-1<p.indexOf(l.functionName))l.renderTexture=!0;else if("Processed"!==d||!(g.useWebGL&&l&&l.renderTexture||!g.useWebGL&&"U8"===h.pixelType)){l&&(h=l.rasterInfo);l=h.bandCount;var v=h.colormap,r=h.vat;p=h.histograms;p&&0===p.length&&(p=null);var w=h.statistics&&h.statistics.map(function(E){return[E.min,E.max,E.mean,E.stddev]});if(1===
l&&v&&0<v.length)var y=this._getDefaultColormapRenderer(r,v);else if(1===l&&r&&r.features&&0<r.features.length)y=new k({});else{v=0;r=!1;d||!g.raster||!g.raster.tileInfo||void 0!==g.raster.tileInfo.tileType&&"Map"!==g.raster.tileInfo.tileType?"U8"===h.pixelType&&"Processed"===d?(v=5,w=w||[[0,255,0,0],[0,255,0,0],[0,255,0,0]],r=!1):"U8"===h.pixelType||"Elevation"===d?(v=5,r=w?!1:!0):"Scientific"===d||"StdTime"===d?(v=5,r=w?!1:!0,y=this._getDefaultScientificColorRamp()):p&&0<p.length?(v=6,r=!1):w?(v=
5,r=!1):(v=6,r=!0):(w=[[0,255,0,0],[0,255,0,0],[0,255,0,0]],v=5,r=!1);w||(v=5,r=!0);var z;3<=l&&!(g.bandIds||g.raster&&g.raster.imageServiceParams&&g.raster.imageServiceParams.bandIds)&&(z=this.getDefaultBandCombination(h));z&&(w=z.map(function(E){return w[E]}));g={stretchType:v,min:0,max:255,dra:r,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,statistics:w,histograms:p,numberOfStandardDeviations:2.5,bandIndex:z};1===l||z&&1===z.length?(y&&(g.colorRamp=y,g.invert=!1),y=new c(g)):y=new e(g)}return y}}}},
getDefaultBandCombination:function(g){var h=g.bandCount;if(1===h)return null;if(2===h)return[0];var d=(g=g.keyProperties)&&g.ChangeAnalysisParameters&&g.ChangeAnalysisParameters.AnalysisType;if(d&&("ccdc"===d.toLowerCase()||"landtrendr"===d.toLowerCase()))return[0];g=g&&g.BandProperties;var l;if(g&&g.length===h){var p=this.getWellKnownBandIndexes(g);g=p.red;d=p.green;var v=p.blue;p=p.nir;null!=g&&null!=d&&null!=v?l=[g,d,v]:null!=p&&null!=g&&null!=d&&(l=[p,g,d])}!l&&3<=h&&(l=[0,1,2]);return l},getWellKnownBandIndexes:function(g){for(var h=
{},d=0;d<g.length;d++){var l=g[d],p=l.BandName&&l.BandName.toLowerCase();"red"===p?h.red=d:"green"===p?h.green=d:"blue"===p?h.blue=d:"nearinfrared"===p||"nearinfrared_1"===p||"nir"===p?h.nir=d:l.WavelengthMax&&l.WavelengthMin&&(p=l.WavelengthMin,l=l.WavelengthMax,null==h.blue&&410<=p&&480>=p&&480<=l&&540>=l?h.blue=d:null==h.green&&490<=p&&560>=p&&560<=l&&610>=l?h.green=d:null==h.red&&595<=p&&670>=p&&660<=l&&730>=l?h.red=d:null==h.nir&&700<=p&&860>=p&&800<=l&&950>=l&&(h.nir=d))}return h},_getDefaultColormapRenderer:function(g,
h){if(h||h.length){var d=[],l=this._ratContainsColormap(g);if(l)var p=this._getRATValueClassNameMap(g);h.forEach(function(v){var r=p?p[v[0]]:v[0];d.push({color:[v[1],v[2],v[3]],value:v[0],label:l?null!=r?r:"":v[0]})});return new m({colormapInfos:d})}},_ratContainsColormap:function(g){if(!g||!g.fields)return!1;var h,d,l;return g.fields.some(function(p){p&&p.name&&(p=p.name.toLowerCase(),"red"===p&&(h=!0),"green"===p&&(d=!0),"blue"===p&&(l=!0));return h&&d&&l})},_getRATValueClassNameMap:function(g){if(!g||
!g.fields)return null;var h={},d,l;g.fields.forEach(function(p){if("classname"===p.name.toLowerCase()||"class_name"===p.name.toLowerCase())d=p.name;"value"===p.name.toLowerCase()&&(l=p.name)});g.features.forEach(function(p){p=p.attributes;h[p[l]]=d?p[d]:p[l]});return h},_getDefaultScientificColorRamp:function(){return{type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}].map(function(g){return{fromColor:g.toColor,
toColor:g.fromColor}}).reverse()}}}})},"esri/layers/rasterLib/renderer/RasterColormapRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction"],function(H,n,u,m){return H([u],{declaredClass:"esri.layers.rasterLib.renderer.RasterColormapRenderer",rendererName:"Colormap",renderTexture:!0,constructor:function(k){k&&k.colormapInfos&&(k.colormap=k.colormapInfos.map(function(e){return[e.value].concat(e.color)}));this._function=new m(k);this._function.outputPixelType=
"U8";this._function.renderTexture=!0},draw2D:function(k){this._updateColormapParameters();k=this._clonePixelData(k);return k=this._function._colorize(k)},drawGL:function(k){this._updateColormapParameters();this._function._colorizeGL(k)},toJson:function(){var k=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:k}},toCommonRendererJson:function(){return{type:"rasterColormap",colormapInfos:this.colormapInfos||this.colormap.map(function(k){return{value:k[0],
color:k.slice(1),label:k[0]}})}},_updateColormapParameters:function(){var k=this._function.functionArguments;k.colormap=this.colormap;k.colormapName=this.colormapName;k.colorRamp=this.colorRamp;k.colorRampName=this.colorRampName}})})},"esri/layers/rasterLib/renderer/RasterRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../PixelBlock"],function(H,n,u,m){return H(null,{declaredClass:"esri.layers.rasterLib.renderer.RasterRenderer",raster:null,constructor:function(k){k=
k||{};this.raster=k.raster||k.Raster||this.raster;this.draw=n.hitch(this,this.draw);this.bind=n.hitch(this,this.bind);k=n.clone(k);Object.keys(k).forEach(function(e){null==k[e]&&delete k[e]});n.mixin(this,k)},bind:function(k){if(!k)throw"failed to bind without options";var e=k;k.layer&&(k=k.layer,e={id:k.id,rawRasterInfo:k.raster.rasterInfo,glSetting:k._glSetting,xformSetting:k.tileManager&&k.tileManager.xformSetting,useWebGL:k.useWebGL,resampling:k.tileMode&&k.tileManager&&k.tileManager.xformSetting.requireProjection&&
!k._hasTilingEffects&&"Thematic"!==k.raster.dataType?1:0,tileMode:k.tileMode});this._rawRasterInfo=e.rawRasterInfo;this.useWebGL=e.useWebGL;this._function&&this._function.setProcessingContext(n.mixin({useProcessedData:!0},e));this._processingContext=e},hasTilingEffects:function(){},draw:function(k){return this.useWebGL?this.drawGL(k):this.draw2D(k)},toJson:function(){},_clonePixelData:function(k){if(null==k)return k;var e={};k.extent&&(e.extent=new u(k.extent.xmin,k.extent.ymin,k.extent.xmax,k.extent.ymax,
k.extent.spatialReference));k=k.processedPixelBlock||k.pixelBlock;if(null==k)return e;e.pixelBlock=k.clone?k.clone():m.prototype.clone(k);return e}})})},"esri/layers/rasterLib/renderer/RasterUniqueValueRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../../../renderers/colorRampGenerator"],function(H,n,u,m,k){return H([u],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",rendererName:"UniqueValue",field:"",
alias:"",uniqueValueInfos:null,constructor:function(e){e&&e.colormap&&(this.colormap=e.colormap,this._function=new m(e),this._function.outputPixelType="U8",this._function.renderTexture=!0)},bind:function(e){this.inherited(arguments);if(!this._function){var c=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;if(!c)throw"uv renderer requires data source to have raster attribute table";var a=this.attributeField||this.field1||this.field,b=this.infos||this.uniqueValueInfos;this.defaultColor=
this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var f=c.fields.filter(function(y){return"value"===y.name.toLowerCase()})[0];if(f)var g=f.name;a||((a=c.fields.filter(function(y){return-1<["classname","category"].indexOf(y.name.toLowerCase())})[0])||(a=c.fields.filter(function(y){return"esriFieldTypeString"===y.type})[0]),this.alias=(this.field=a=a&&a.name||g)&&a.alias||g);var h=[],d;if(!b){b=[];var l=c.fields.filter(function(y){return"alpha"===y.name.toLowerCase()})[0];var p=c.fields.filter(function(y){return"red"===
y.name.toLowerCase()})[0];var v=c.fields.filter(function(y){return"green"===y.name.toLowerCase()})[0];var r=c.fields.filter(function(y){return"blue"===y.name.toLowerCase()})[0];for(f=0;f<c.features.length;f++){var w=c.features[f].attributes;(d=b.some(function(y){y.value===w[a]}))||(l&&p&&v&&r?b.push({value:w[a],alias:w[a],color:[w[p.name],w[v.name],w[r.name],w[l.name]]}):p&&v&&r?b.push({value:w[a],alias:w[a],color:[w[p.name],w[v.name],w[r.name]]}):b.push({value:w[a],alias:w[a]}))}if(!(p&&v&&r))for(d=
k.createRandomColorRamp({size:b.length}),f=0;f<b.length;f++)b[f].color=d[f];this.uniqueValueInfos=b}if(b)b.forEach(function(y){h=h.concat(c.features.filter(function(z){return y.value==z.attributes[a]}).map(function(z){return[z.attributes[g]].concat(y.color||y.symbol&&y.symbol.color)}))}),this.defaultColor&&c.features.filter(function(y){h.some(function(z){return z[0]===y.attributes[g]})||h.push([y.attributes[g]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";this._function=
new m({colormap:h});this.colormap=h;this._function.outputPixelType="U8";this._function.renderTexture=!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(e){e=this._clonePixelData(e);return e=this._function._colorize(e)},drawGL:function(e){this._function._colorizeGL(e)},toJson:function(e){var c={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};e&&(c.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:c}},
toCommonRendererJson:function(){var e=this.attributeField||this.field1||this.field,c=(this.infos||this.uniqueValueInfos).map(function(a){return{value:a.value,label:a.alias+"",symbol:{color:3===a.color.length?a.color.concat([255]):a.color,type:"esriSFS",style:"esriSFSSolid"}}});return{type:"uniqueValue",field1:e,uniqueValueInfos:c}}})})},"esri/layers/rasterLib/renderer/RasterRGBRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/rasterUtils".split(" "),
function(H,n,u,m,k,e){return H([u],{declaredClass:"esri.layers.rasterLib.renderer.RasterRGBRenderer",rendererName:"RGB",bandIndex:null,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(c){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
c=n.mixin({},c,{stretchType:this.stretchType});this._stretchFunction=new m(c);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this.bandIndex=c.bandIndex||c.BandIndex;this._function=new k(c);this._function.functionArguments.raster=this._stretchFunction;this._function.renderTexture=!0},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},draw2D:function(c){this._updateStretchParameters();c=this._clonePixelData(c);if("U8"===c.pixelBlock.pixelType&&
!this.contrastOffset&&!this.brightnessOffset)return c;this._stretchFunction._stretch(c);var a=c.pixelBlock,b=this.bandIndex,f=Math.max.apply(null,b);a&&a.pixels.length>f&&b&&(a.pixels=b.map(function(g){return a.pixels[g]}),a.statistics&&(a.statistics=b.map(function(g){return a.statistics[g]})));if(this.contrastOffset||this.brightnessOffset)c.pixelBlock=e.contrastBrightnessStretch(c.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return c},drawGL:function(c){this._updateStretchParameters();
c.pixelBlock&&(c=this._clonePixelData(c));var a=c.pixelBlock,b=this.bandIndex,f=Math.max.apply(null,b),g=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,h=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,d,l;a&&a.pixels.length>f&&b&&(a.pixels=b.map(function(p){return a.pixels[p]}),a.statistics&&(a.statistics=b.map(function(p){return a.statistics[p]})),g&&0<g.length&&
g.length!==b.length&&(d=b.map(function(p){return g[p]})),h&&0<h.length&&h.length!==b.length&&(l=b.map(function(p){return h[p]})));this._stretchFunction.functionArguments.statistics=d||g;this._stretchFunction.functionArguments.histograms=l||h;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._function.renderTexture=!0,c=this._stretchFunction._stretchGL(c),this._function._cbGL(c)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(c))},toJson:function(){var c=
this._stretchFunction.toJson().rasterFunctionArguments;c.bandIndex=this.bandIndex;c.contrastOffset=this.contrastOffset;c.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:c}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:n.clone(this.statistics),
dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,gamma:n.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var c=this._stretchFunction.functionArguments;c.stretchType=this.stretchType;c.min=this.min;c.max=this.max;c.numberOfStandardDeviations=this.numberOfStandardDeviations;c.statistics=this.statistics;c.histograms=this.histograms;c.dra=this.dra;c.minPercent=this.minPercent;
c.maxPercent=this.maxPercent;c.useGamma=this.useGamma;c.gamma=this.gamma;c.computeGamma=this.computeGamma;this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterStretchColorRampRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/ResampleFunction ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(H,n,u,m,k,e,c,a){return H([u],
{declaredClass:"esri.layers.rasterLib.renderer.RasterStretchColorRampRenderer",rendererName:"Stretch",bandIndex:[0],colorRamp:null,invert:!1,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(b){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
b=n.mixin({},b,{stretchType:this.stretchType});Object.keys(b).forEach(function(f){null==b[f]&&delete b[f]});this._function=new e(b);this._stretchFunction=new k(b);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this._clrFunction=new c(b);this._clrFunction.functionArguments.raster=this._stretchFunction;this._clrFunction.renderTexture=!1;this._function.functionArguments.raster=this._clrFunction},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},
draw2D:function(b){this._updateStretchParameters();b=this._clonePixelData(b);if("U8"===b.pixelBlock.pixelType&&!(this.contrastOffset||this.brightnessOffset||this.colorRamp))return b;this._stretchFunction._stretch(b);var f=b.pixelBlock,g=this.bandIndex?this.bandIndex[0]:0;f&&1<f.pixels.length&&f.pixels.length>g&&(f.pixels=[f.pixels[g]],f.statistics&&(f.statistics=[f.statistics[g]]));this.colorRamp&&(b=this._clrFunction._colorize(b));if(this.contrastOffset||this.brightnessOffset)b.pixelBlock=a.contrastBrightnessStretch(b.pixelBlock,
{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return b},drawGL:function(b){this._updateStretchParameters();b.pixelBlock&&(b=this._clonePixelData(b));var f=b.pixelBlock,g=this.bandIndex?this.bandIndex[0]||0:0,h=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,d=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,l,p;f&&1<f.pixels.length&&
f.pixels.length>g&&(f.pixels=[f.pixels[g]],f.statistics&&(f.statistics=[f.statistics[g]]),h&&h.length>g&&(l=[h[g]]),d&&d.length>g&&(p=[d[g]]));this._stretchFunction.functionArguments.statistics=l||h;this._stretchFunction.functionArguments.histograms=p||d;f=!!this.colorRamp;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!1,this._function.renderTexture=!0,b=this._stretchFunction._stretchGL(b),f&&(b=this._clrFunction._colorizeGL(b)),
this._function._cbGL(b)):f?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!0,b=this._stretchFunction._stretchGL(b),this._clrFunction._colorizeGL(b)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(b))},toJson:function(){var b=this._stretchFunction.toJson().rasterFunctionArguments;b.colorRamp=this.colorRamp||"";this.invert&&(b.invert=!0);b.contrastOffset=this.contrastOffset;b.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,
rendererArguments:b}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp,min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:n.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,
gamma:n.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var b=this._stretchFunction.functionArguments;b.stretchType=this.stretchType;b.min=this.min;b.max=this.max;b.numberOfStandardDeviations=this.numberOfStandardDeviations;b.statistics=this.statistics;b.histograms=this.histograms;b.dra=this.dra;b.minPercent=this.minPercent;b.maxPercent=this.maxPercent;b.useGamma=this.useGamma;b.gamma=this.gamma;b.computeGamma=this.computeGamma;
this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterClassBreaksRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../function/RemapFunction"],function(H,n,u,m,k){return H([u],{declaredClass:"esri.layers.rasterLib.renderer.RasterClassBreaksRenderer",rendererName:"ClassBreaks",renderTexture:!0,constructor:function(e){e=e||{};this._function=new k(e);this._function.outputPixelType="U8";var c=
e.classBreakInfos;e=e.minValue;null!=e&&c&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(e,c))},bind:function(e){this.inherited(arguments);this.isColormapFunction=!1;var c=this.raster&&this.raster.rasterInfo||this._rawRasterInfo,a=c&&c.vat;if(a&&"u8"===c.pixelType.toLowerCase()&&this.classBreakInfos){var b=this.field;if(c=a.fields.filter(function(p){return"value"===p.name.toLowerCase()})[0])var f=c.name;var g=a.features.sort(function(p,v){return parseFloat(p.attributes[b])-
parseFloat(v.attributes[b])})[0].attributes[b];this.isColormapFunction=!0;var h=[],d=this.field,l=this.classBreakInfos;l.forEach(function(p,v){a.features.forEach(function(r){var w=l[v-1]&&l[v-1].classMaxValue||g;r.attributes[d]<=p.classMaxValue&&(r.attributes[d]>w||r.attributes[d]===g)&&(w=p.symbol.color,h.some(function(y){return y[0]===r.attributes[f]})||h.push([r.attributes[f]].concat(w)))})});this._function=new m({colormap:h});this.colormap=h;this._function.outputPixelType="U8";this._function.renderTexture=
!0}this._function&&this._function.setProcessingContext(n.mixin({useProcessedData:!0},this._processingContext))},draw2D:function(e){if(this.isColormapFunction)return this._updateColormapParameters(),e=this._clonePixelData(e),e=this._function._colorize(e);this._updateRemapParameters();return this._function._remap(e)},drawGL:function(e){this.isColormapFunction?(this._updateColormapParameters(),this._function._colorizeGL(e)):(this._function.renderTexture=!0,this._updateRemapParameters(),this._function._remapGL(e))},
toJson:function(){var e=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:e}},toCommonRendererJson:function(){var e,c=this.classBreakInfos,a=this.colorBreaks;if(null==c&&a)for(c=[],e=0;e<a.length-1;e++)c.push({classMaxValue:a[e+1].value,symbol:{color:a[e].mappedColor,type:"esriSFS",style:"esriSFSSolid"},label:a[e].value+" - "+a[e+1].value});return{type:"classBreaks",field:"Value",minValue:null!=this.minValue?this.minValue:a[0].value,classBreakInfos:c}},
_updateRemapParameters:function(){var e=this.classBreakInfos,c=this.minValue;null!=c&&e&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(c,e))},_getSortedColorBreaks:function(e,c){c=c.map(function(b){return{maxValue:b.classMaxValue,color:b.symbol.color}}).sort(function(b,f){return b.maxValue-f.maxValue});var a=[{value:e,mappedColor:c[0].color}];for(e=0;e<c.length;e++)a.push({value:c[e].maxValue,mappedColor:e===c.length-1?c[e].color:c[e+1].color});return a},_updateColormapParameters:function(){this._function.functionArguments.colormap=
this.colormap;this._function.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterShadedReliefRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/HillshadeFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(H,n,u,m,k,e,c){return H([u],{declaredClass:"esri.layers.rasterLib.renderer.RasterShadedReliefRenderer",rendererName:"ShadedRelief",hillshadeType:null,azimuth:315,
altitude:45,zFactor:1,slopeType:null,psPower:.664,psFactor:.024,raster:null,constructor:function(a){this.hillshadeType="number"===typeof this.hillshadeType?this.hillshadeType:["traditional","multi-directional"].indexOf(this.hillshadeType);a&&a.scalingType&&(this.slopeType="adjusted"===a.scalingType?3:1);a&&a.pixelSizePower&&(this.psPower=a.pixelSizePower);a&&a.pixelSizeFactor&&(this.psFactor=a.pixelSizeFactor);a=n.mixin({},a,{hillshadeType:this.hillshadeType,psPower:this.psPower,psFactor:this.psFactor,
slopeType:this.slopeType});Object.keys(a).forEach(function(b){null==a[b]&&delete a[b]});this._function=new k(a);this._hillshadeFunction=new m(a);this._hillshadeFunction.outputPixelType="U8";this._hillshadeFunction.renderTexture=!1;this._function.functionArguments.raster=this._hillshadeFunction},hasTilingEffects:function(){return this._hillshadeFunction.hasTilingEffects()},draw2D:function(a){this._updateHillshadeParameters();a=this._clonePixelData(a);a=this._hillshadeFunction.read2D({raster:a});if(this.contrastOffset||
this.brightnessOffset)a.pixelBlock=c.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return a},drawGL:function(a){this._updateHillshadeParameters();this.contrastOffset||this.brightnessOffset?(this._hillshadeFunction.renderTexture=!1,this._function.renderTexture=!0,a=this._hillshadeFunction.readGL({raster:a}),this._function._cbGL(a)):(this._hillshadeFunction.renderTexture=!0,this._hillshadeFunction.readGL({raster:a}))},toJson:function(){var a=
this._hillshadeFunction.toJson().rasterFunctionArguments;a.colorRamp=this.colorRamp||"";this.invert&&(a.invert=!0);a.contrastOffset=this.contrastOffset;a.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:a}},toCommonRendererJson:function(){return{type:"rasterShadedRelief",hillshadeType:["traditional","multi-directional"][this.hillshadeType]||"traditional",azimuth:this.azimuth,altitude:this.altitude,zFactor:this.zFactor,scalingType:3===this.slopeType?"adjusted":
"none",pixelSizePower:this.psPower,pixelSizeFactor:this.psFactor,colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp}},_updateHillshadeParameters:function(){var a=this._hillshadeFunction.functionArguments;a.hillshadeType=this.hillshadeType;a.azimuth=this.azimuth;a.altitude=this.altitude;a.zFactor=this.zFactor;a.slopeType=this.slopeType;a.psPower=this.psPower;a.psFactor=this.psFactor}})})},"esri/layers/rasterLib/raster/rasterProjectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/sniff ../../../kernel ../../../WKIDUnitConversion ../../../geometry/Extent ../../../geometry/projection ../../../geometry/webMercatorUtils ../../../SpatialReference ../../../geometry/Point".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g){H={requirePE:function(d,l){return!(d.equals(l)||d._canProject(l))},load:function(){var d=new u;if(!this._loadPromise)if(a.isSupported())this._loadPromise=a.load();else{var l=new u;l.reject("projection engine is not supported on this version of the browser, please try with a modern browser");this._loadPromise=l.promise}this._loadPromise.isFulfilled()?this._loadPromise.isResolved()?d.resolve():this._loadPromise.isRejected()&&d.resolve():(this._pendingdfds=this._pendingdfds||
[],this._pendingdfds.push(d),this._loadPromise.then(n.hitch(this,function(){this._pendingdfds.forEach(function(p){p.isFulfilled()||p.resolve()})}),n.hitch(this,function(){this._pendingdfds.forEach(function(p){p.isFulfilled()||p.reject()})})));return d.promise},computeError:function(d,l){return[Math.abs((d[0]+d[4]+d[4*l.rows]+d[4*l.rows+4])/4-d[2*l.rows+2]),Math.abs((d[1]+d[5]+d[4*l.rows+1]+d[4*l.rows+5])/4-d[2*l.rows+3])]},getDefaultDatumTransformationForDataset:function(d,l,p){if(!(l&&d.spatialReference&&
this.requirePE(d.spatialReference,l)&&a.isLoaded()))return null;d=new c(d.toJson());l=new f(l.toJson());return p?a.getTransformation(l,d.spatialReference,d):a.getTransformation(d.spatialReference,l,d)},project:function(d,l,p){if(!l||d.spatialReference.equals(l))return d;var v=a.isLoaded()?a:b;"esri.geometry.Extent"===d.declaredClass?d=new c(d.toJson()):"esri.geometry.Point"===d.declaredClass&&(d=new g(d.toJson()));l=new f(l.toJson());(d=v.project(d,l))&&"esri.geometry.Extent"===d.declaredClass?(d=
new c(d.toJson()),p&&(1E-5>Math.abs(d.xmin+180)&&1E-5>Math.abs(d.xmax-180)?(d.xmin=0,d.xmax=360):(0>d.xmin&&(d.xmin+=360,d.xmax+=360),0>d.xmax&&(d.xmax+=360)))):d&&"esri.geometry.Point"===d.declaredClass&&(d=new g(d.toJson()),p&&0>d.x&&(d.x+=360));return d},projectResolution:function(d,l,p){var v=p.xmin+(p.xmax-p.xmin)/2;p=p.ymin+(p.ymax-p.ymin)/2;d=new c(v,p,v+d.x,p+d.y,d.spatialReference);d=this.project(d,l);return new g(d.xmax-d.xmin,d.ymax-d.ymin,l)},getProjectionOffsetGrid:function(d,l,p,v,r,
w,y){null==y&&(y=[32,32]);var z=d.xmin,E=d.ymin,B=d.xmax,C=d.ymax,G=d.spatialReference,I=l.spatialReference,D=a.isLoaded()?a:b,q=r?-r:null,t=y[0]*p.x,A=y[1]*p.y;B={cols:Math.ceil((B-z)/t)+1,rows:Math.ceil((C-E)/A)+1};d=[];for(C=0;C<B.cols;C++){var J=M;var M=[];for(p=0;p<B.rows;p++){var N=new g({x:z+t*C,y:E+A*p,spatialReference:G});N=D.project(N,I,w);if(!N)return null;v&&0>N.x&&(N.x+=360);M.push(N);0<C&&null!=q&&N.x<J[p].x&&(N.x+=r-q,N.x<J[p].x&&(N.x+=r-q));d.push((N.x-l.xmin)/(l.xmax-l.xmin));d.push((N.y-
l.ymin)/(l.ymax-l.ymin))}}l=this.computeError(d,B);v=new Float32Array((B.cols-1)*(B.rows-1)*12);r=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);w=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(C=0;C<B.cols-1;C++)for(p=0;p<B.rows-1;p++){t=C*B.rows*2+2*p;z=d[t];E=d[t+1];M=d[t+2];G=d[t+3];t+=2*B.rows;I=d[t];D=d[t+1];q=d[t+2];A=d[t+3];J=0;N=12*(p*(B.cols-1)+C);for(t=0;3>t;t++)v[N++]=r[J++]*z+r[J++]*M+r[J++]*q;for(t=J=0;3>t;t++)v[N++]=r[J++]*E+r[J++]*G+r[J++]*A;for(t=J=0;3>t;t++)v[N++]=w[J++]*z+w[J++]*I+w[J++]*
q;for(t=J=0;3>t;t++)v[N++]=w[J++]*E+w[J++]*D+w[J++]*A}return{offsets:d,error:l,coefficients:v,spacing:y,size:[B.cols-1,B.rows-1]}},getHalfWorldWidth:function(d){var l=d&&d.wkid;if(null!=l)return d.isWebMercator()&&(l=3857),null==e[l]?180:h[l]}};m("extend-esri")&&n.setObject("layers.rasterLib.raster.rasterProjectionHelper",H,k);var h={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3832:3339584.723798206,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,
6933:1.7367530445161372E7,8858:7396237.374497803,8859:2465412.4581659334,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53025:7276828.3848298555,53031:1.0384677558821043E7,53034:2.001508679602057E7,53036:7389443.187332862,53037:2463147.729110953,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,
54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54025:7311399.09166516,54031:1.0396310810074743E7,54034:2.0037508342789244E7,54050:808820.9223376509,54053:1920897.3915568967,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54099:1.3524439768288724E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7,102038:4297258.582585486,102299:5013965.117483125};return H})},"esri/geometry/projection":function(){define("require exports dojo/Deferred ./pe ../SpatialReference ./GeographicTransformation".split(" "),
function(H,n,u,m,k,e){function c(h,d,l,p,v){void 0===p&&(p=null);void 0===v&&(v=!1);if(null===p){var r=e.cacheKey(d,l);void 0!==g[r]?p=g[r]:(p=a(d,l,null),null===p&&(p=new e),g[r]=p)}return b._project(h,d,l instanceof k||!1===v?l:new k(l),p,v)}function a(h,d,l){void 0===l&&(l=null);h=b._getTransformation(h,d,l);return null!==h?e.fromGE(h):null}Object.defineProperty(n,"__esModule",{value:!0});var b=null;n.isLoaded=function(){return!!b&&m.isLoaded()};n.isSupported=function(){return m.isSupported()};
var f=null;n.load=function(){if(f)return f.promise;f=new u;var h=m.load();H(["./geometryEngine"],function(d){b=d;h.then(function(){b._enableProjection(m);f.resolve()},function(l){f.reject(l)})});return f.promise};n.project=function(h,d,l){void 0===l&&(l=null);return h instanceof Array?0===h.length?[]:c(h,h[0].spatialReference,d,l):c([h],h.spatialReference,d,l)[0]};var g={};n.projectMany=c;n.getTransformation=a;n.getTransformations=function(h,d,l){void 0===l&&(l=null);h=b._getTransformationBySuitability(h,
d,l);if(null!==h){d=[];for(l=0;l<h.length;l++)d.push(e.fromGE(h[l]));return d}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","dojo/Deferred","../core/sniff"],function(H,n,u,m,k){function e(r){function w(B,C,G){B[C]=G(B[C])}n._pe=r;h.init();d.init();l.init();p.init();v.init();n.PeGCSExtent=function(B){function C(){return null!==B&&B.apply(this,arguments)||this}u(C,B);C.prototype.destroy=function(){n._pe.destroy(this)};return C}(n._pe.PeGCSExtent);
for(var y=0,z=[n._pe.PeDatum,n._pe.PeGeogcs,n._pe.PeGeogtran,n._pe.PeObject,n._pe.PeParameter,n._pe.PePrimem,n._pe.PeProjcs,n._pe.PeSpheroid,n._pe.PeUnit];y<z.length;y++)r=z[y],w(r.prototype,"getName",function(B){return function(){return B.call(this,Array(h.PE_NAME_MAX))}});y=0;for(z=[n._pe.PeGeogtran,n._pe.PeProjcs];y<z.length;y++)r=z[y],w(r.prototype,"getParameters",function(B){return function(){for(var C=Array(h.PE_PARM_MAX),G=B.call(this),I=0;I<C.length;I++){var D=n._pe.getValue(G,"*");C[I]=D?
n._pe.wrapPointer(D,n._pe.PeParameter):null;G+=Int32Array.BYTES_PER_ELEMENT}return C}});w(n._pe.PeHorizon.prototype,"getCoord",function(B){return function(){var C=this.getSize();if(!C)return null;var G=[],I=B.call(this);f(G,C,I);return G}});w(n._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(B){var C=n._pe._pe_getPeGTlistExtendedGTsSize();return function(){var G=null,I=B.call(this);if(!n._pe.compare(I,n._pe.NULL)){G=[I];var D=this.getSteps();if(1<D){I=n._pe.getPointer(I);for(var q=1;q<D;q++)G.push(n._pe.wrapPointer(I+
C*q,n._pe.PeGTlistExtendedGTs))}}return G}});var E=n._pe._pe_getPeHorizonSize();r=function(B){return function(){var C=this._cache;C||(this._cache=C=new Map);if(C.has(B))return C.get(B);var G=null,I=B.call(this);if(!n._pe.compare(I,n._pe.NULL)){G=[I];var D=I.getNump();if(1<D){I=n._pe.getPointer(I);for(var q=1;q<D;q++)G.push(n._pe.wrapPointer(I+E*q,n._pe.PeHorizon))}}C.set(B,G);return G}};w(n._pe.PeProjcs.prototype,"horizonGcsGenerate",r);w(n._pe.PeProjcs.prototype,"horizonPcsGenerate",r);n._pe.PeObject.prototype.toString=
function(B){void 0===B&&(B=h.PE_STR_OPTS_NONE);n._pe.ensureCache.prepare();var C=n._pe.getPointer(this),G=n._pe.ensureInt8(Array(h.PE_BUFFER_MAX));return n._pe.UTF8ToString(n._pe._pe_object_to_string_ext(C,B,G))}}function c(r){if(r){var w=n._pe.getClass(r);w&&(w=n._pe.getCache(w))&&(r=n._pe.getPointer(r))&&delete w[r]}}function a(r,w){var y=[];w=Array(w);for(var z=0;z<r;z++)y.push(n._pe.ensureInt8(w));return y}function b(r){if(Array.isArray(r[0])){var w=[];r.forEach(function(y){w.push(y[0],y[1])})}else w=
r;return w}function f(r,w,y,z){void 0===z&&(z=!1);if(z)for(z=0;z<2*w;z++)r[z]=n._pe.getValue(y+z*Float64Array.BYTES_PER_ELEMENT,"double");else{var E=0===r.length;for(z=0;z<w;z++)E&&(r[z]=Array(2)),r[z][0]=n._pe.getValue(y,"double"),r[z][1]=n._pe.getValue(y+Float64Array.BYTES_PER_ELEMENT,"double"),y+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(n,"__esModule",{value:!0});var g;n._pe=null;n.isLoaded=function(){return!!n._pe};n.isSupported=function(){return!!k("esri-wasm")};n.load=function(){if(g)return g.promise;
g=new m;H(["./support/pe-wasm"],function(r){r({locateFile:function(w){return H.toUrl("./support/"+w)},onAbort:function(w){g.reject(Error(w))}}).then(function(w){e(w);g.resolve()})});return g.promise};(function(r){function w(E,B,C){n._pe.ensureCache.prepare();var G=b(C),I=C===G;G=n._pe.ensureFloat64(G);(E=n._pe._pe_geog_to_proj(n._pe.getPointer(E),B,G))&&f(C,B,G,I);return E}function y(E,B,C){return z(E,B,C,0)}function z(E,B,C,G){n._pe.ensureCache.prepare();var I=b(C),D=C===I;I=n._pe.ensureFloat64(I);
(E=n._pe._pe_proj_to_geog_center(n._pe.getPointer(E),B,I,G))&&f(C,B,I,D);return E}r.geogToProj=w;r.projGeog=function(E,B,C,G){switch(G){case h.PE_TRANSFORM_P_TO_G:return y(E,B,C);case h.PE_TRANSFORM_G_TO_P:return w(E,B,C)}return 0};r.projToGeog=y;r.projToGeogCenter=z})(n.PeCSTransformations||(n.PeCSTransformations={}));var h;(function(r){r.init=function(){r.PE_BUFFER_MAX=n._pe.PeDefs.prototype.PE_BUFFER_MAX;r.PE_NAME_MAX=n._pe.PeDefs.prototype.PE_NAME_MAX;r.PE_MGRS_MAX=n._pe.PeDefs.prototype.PE_MGRS_MAX;
r.PE_USNG_MAX=n._pe.PeDefs.prototype.PE_USNG_MAX;r.PE_DD_MAX=n._pe.PeDefs.prototype.PE_DD_MAX;r.PE_DDM_MAX=n._pe.PeDefs.prototype.PE_DDM_MAX;r.PE_DMS_MAX=n._pe.PeDefs.prototype.PE_DMS_MAX;r.PE_UTM_MAX=n._pe.PeDefs.prototype.PE_UTM_MAX;r.PE_PARM_MAX=n._pe.PeDefs.prototype.PE_PARM_MAX;r.PE_TYPE_NONE=n._pe.PeDefs.prototype.PE_TYPE_NONE;r.PE_TYPE_GEOGCS=n._pe.PeDefs.prototype.PE_TYPE_GEOGCS;r.PE_TYPE_PROJCS=n._pe.PeDefs.prototype.PE_TYPE_PROJCS;r.PE_TYPE_GEOGTRAN=n._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;
r.PE_TYPE_COORDSYS=n._pe.PeDefs.prototype.PE_TYPE_COORDSYS;r.PE_TYPE_UNIT=n._pe.PeDefs.prototype.PE_TYPE_UNIT;r.PE_STR_OPTS_NONE=n._pe.PeDefs.prototype.PE_STR_OPTS_NONE;r.PE_STR_AUTH_NONE=n._pe.PeDefs.prototype.PE_STR_AUTH_NONE;r.PE_STR_AUTH_TOP=n._pe.PeDefs.prototype.PE_STR_AUTH_TOP;r.PE_STR_NAME_CANON=n._pe.PeDefs.prototype.PE_STR_NAME_CANON;r.PE_PARM_X0=n._pe.PeDefs.prototype.PE_PARM_X0;r.PE_PARM_ND=n._pe.PeDefs.prototype.PE_PARM_ND;r.PE_TRANSFORM_1_TO_2=n._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;
r.PE_TRANSFORM_2_TO_1=n._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;r.PE_TRANSFORM_P_TO_G=n._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;r.PE_TRANSFORM_G_TO_P=n._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;r.PE_HORIZON_RECT=n._pe.PeDefs.prototype.PE_HORIZON_RECT;r.PE_HORIZON_POLY=n._pe.PeDefs.prototype.PE_HORIZON_POLY;r.PE_HORIZON_LINE=n._pe.PeDefs.prototype.PE_HORIZON_LINE;r.PE_HORIZON_DELTA=n._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(h=n.PeDefs||(n.PeDefs={}));(function(r){function w(B,C){var G=null,I=z[B];
I||(I={},z[B]=I);I.hasOwnProperty(String(C))?G=I[C]:(B=n._pe.PeFactory.prototype.factoryByType(B,C),n._pe.compare(B,n._pe.NULL)||(G=B,I[C]=G));return G=y(G)}function y(B){if(B){var C=B.getType();switch(C){case h.PE_TYPE_GEOGCS:B=n._pe.castObject(B,n._pe.PeGeogcs);break;case h.PE_TYPE_PROJCS:B=n._pe.castObject(B,n._pe.PeProjcs);break;case h.PE_TYPE_GEOGTRAN:B=n._pe.castObject(B,n._pe.PeGeogtran);break;default:C&h.PE_TYPE_UNIT&&(B=n._pe.castObject(B,n._pe.PeUnit))}}return B}var z={},E={};r.initialize=
function(){n._pe.PeFactory.prototype.initialize(null)};r.coordsys=function(B){return w(h.PE_TYPE_COORDSYS,B)};r.factoryByType=w;r.fromString=function(B,C){var G=null,I=E[B];I||(I={},E[B]=I);I.hasOwnProperty(C)?G=I[C]:(B=n._pe.PeFactory.prototype.fromString(B,C),n._pe.compare(B,n._pe.NULL)||(G=B,I[C]=G));return G=y(G)};r.geogcs=function(B){return w(h.PE_TYPE_GEOGCS,B)};r.geogtran=function(B){return w(h.PE_TYPE_GEOGTRAN,B)};r.getCode=function(B){return n._pe.PeFactory.prototype.getCode(B)};r.projcs=
function(B){return w(h.PE_TYPE_PROJCS,B)};r.unit=function(B){return w(h.PE_TYPE_UNIT,B)}})(n.PeFactory||(n.PeFactory={}));n.PeGCSExtent=null;var d;(function(r){var w;r.init=function(){r.PE_GTLIST_OPTS_COMMON=n._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;w=n._pe._pe_getPeGTlistExtendedEntrySize()};r.getGTlist=function(y,z,E,B,C,G){var I=null,D=new n._pe.PeInteger(G);try{var q=n._pe.PeGTlistExtended.prototype.getGTlist(y,z,E,B,C,D);if(G=D.val)if(I=[q],1<G){var t=n._pe.getPointer(q);for(y=1;y<
G;y++)I.push(n._pe.wrapPointer(t+w*y,n._pe.PeGTlistExtendedEntry))}}finally{n._pe.destroy(D)}return I}})(d=n.PeGTlistExtended||(n.PeGTlistExtended={}));(function(r){r.destroy=function(w){if(w&&w.length){for(var y=0;y<w.length;y++){var z=w[y];c(z);z.getEntries().forEach(function(E){c(E);E=E.getGeogtran();c(E);E.getParameters().forEach(c);[E.getGeogcs1(),E.getGeogcs2()].forEach(function(B){c(B);var C=B.getDatum();c(C);c(C.getSpheroid());c(B.getPrimem());c(B.getUnit())})})}n._pe.PeGTlistExtendedEntry.prototype.Delete(w[0])}}})(n.PeGTlistExtendedEntry||
(n.PeGTlistExtendedEntry={}));(function(r){r.geogToGeog=function(w,y,z,E,B){n._pe.ensureCache.prepare();var C=b(z),G=z===C;C=n._pe.ensureFloat64(C);var I=0;E&&(I=n._pe.ensureFloat64(E));(w=n._pe._pe_geog_to_geog(n._pe.getPointer(w),y,C,I,B))&&f(z,y,C,G);return w}})(n.PeGTTransformations||(n.PeGTTransformations={}));(function(r){function w(z,E,B,C,G,I){n._pe.ensureCache.prepare();switch(z){case "dd":var D=n._pe._pe_geog_to_dd;var q=h.PE_DD_MAX;break;case "ddm":D=n._pe._pe_geog_to_ddm;q=h.PE_DDM_MAX;
break;case "dms":D=n._pe._pe_geog_to_dms,q=h.PE_DMS_MAX}z=0;E&&(z=n._pe.getPointer(E));E=b(C);E=n._pe.ensureFloat64(E);q=a(B,q);C=n._pe.ensureInt32(q);if(G=D(z,B,E,G,C))for(D=0;D<B;D++)I[D]=n._pe.UTF8ToString(q[D]);return G}function y(z,E,B,C,G){n._pe.ensureCache.prepare();switch(z){case "dd":var I=n._pe._pe_dd_to_geog;break;case "ddm":I=n._pe._pe_ddm_to_geog;break;case "dms":I=n._pe._pe_dms_to_geog}z=0;E&&(z=n._pe.getPointer(E));E=C.map(function(D){return n._pe.ensureString(D)});C=n._pe.ensureInt32(E);
E=n._pe.ensureFloat64(Array(2*B));(I=I(z,B,C,E))&&f(G,B,E);return I}r.geog_to_dms=function(z,E,B,C,G){return w("dms",z,E,B,C,G)};r.dms_to_geog=function(z,E,B,C){return y("dms",z,E,B,C)};r.geog_to_ddm=function(z,E,B,C,G){return w("ddm",z,E,B,C,G)};r.ddm_to_geog=function(z,E,B,C){return y("ddm",z,E,B,C)};r.geog_to_dd=function(z,E,B,C,G){return w("dd",z,E,B,C,G)};r.dd_to_geog=function(z,E,B,C){return y("dd",z,E,B,C)}})(n.PeNotationDms||(n.PeNotationDms={}));var l;(function(r){r.init=function(){r.PE_MGRS_STYLE_NEW=
n._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;r.PE_MGRS_STYLE_OLD=n._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;r.PE_MGRS_STYLE_AUTO=n._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;r.PE_MGRS_180_ZONE_1_PLUS=n._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;r.PE_MGRS_ADD_SPACES=n._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};r.geog_to_mgrs_extended=function(w,y,z,E,B,C,G){n._pe.ensureCache.prepare();var I=0;w&&(I=n._pe.getPointer(w));w=b(z);z=n._pe.ensureFloat64(w);w=a(y,h.PE_MGRS_MAX);
var D=n._pe.ensureInt32(w);if(E=n._pe._pe_geog_to_mgrs_extended(I,y,z,E,B,C,D))for(B=0;B<y;B++)G[B]=n._pe.UTF8ToString(w[B]);return E};r.mgrs_to_geog_extended=function(w,y,z,E,B){n._pe.ensureCache.prepare();var C=0;w&&(C=n._pe.getPointer(w));w=z.map(function(G){return n._pe.ensureString(G)});z=n._pe.ensureInt32(w);w=n._pe.ensureFloat64(Array(2*y));(E=n._pe._pe_mgrs_to_geog_extended(C,y,z,E,w))&&f(B,y,w);return E}})(l=n.PeNotationMgrs||(n.PeNotationMgrs={}));(function(r){r.geog_to_usng=function(w,
y,z,E,B,C,G){n._pe.ensureCache.prepare();var I=0;w&&(I=n._pe.getPointer(w));w=b(z);z=n._pe.ensureFloat64(w);w=a(y,h.PE_MGRS_MAX);var D=n._pe.ensureInt32(w);if(E=n._pe._pe_geog_to_usng(I,y,z,E,B,C,D))for(B=0;B<y;B++)G[B]=n._pe.UTF8ToString(w[B]);return E};r.usng_to_geog=function(w,y,z,E){n._pe.ensureCache.prepare();var B=0;w&&(B=n._pe.getPointer(w));w=z.map(function(C){return n._pe.ensureString(C)});z=n._pe.ensureInt32(w);w=n._pe.ensureFloat64(Array(2*y));(B=n._pe._pe_usng_to_geog(B,y,z,w))&&f(E,y,
w);return B}})(n.PeNotationUsng||(n.PeNotationUsng={}));var p;(function(r){r.init=function(){r.PE_UTM_OPTS_NONE=n._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;r.PE_UTM_OPTS_ADD_SPACES=n._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;r.PE_UTM_OPTS_NS=n._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};r.geog_to_utm=function(w,y,z,E,B){n._pe.ensureCache.prepare();var C=0;w&&(C=n._pe.getPointer(w));w=b(z);z=n._pe.ensureFloat64(w);w=a(y,h.PE_UTM_MAX);var G=n._pe.ensureInt32(w);if(E=n._pe._pe_geog_to_utm(C,
y,z,E,G))for(C=0;C<y;C++)B[C]=n._pe.UTF8ToString(w[C]);return E};r.utm_to_geog=function(w,y,z,E,B){n._pe.ensureCache.prepare();var C=0;w&&(C=n._pe.getPointer(w));w=z.map(function(G){return n._pe.ensureString(G)});z=n._pe.ensureInt32(w);w=n._pe.ensureFloat64(Array(2*y));(E=n._pe._pe_utm_to_geog(C,y,z,E,w))&&f(B,y,w);return E}})(p=n.PeNotationUtm||(n.PeNotationUtm={}));var v;(function(r){var w=new Map;r.init=function(){r.PE_PCSINFO_OPTION_NONE=n._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;r.PE_PCSINFO_OPTION_DOMAIN=
n._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;r.PE_POLE_OUTSIDE_BOUNDARY=n._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;r.PE_POLE_POINT=n._pe.PePCSInfo.prototype.PE_POLE_POINT};r.generate=function(y,z){void 0===z&&(z=r.PE_PCSINFO_OPTION_DOMAIN);var E;if(w.has(y)){var B=w.get(y);B[z]&&(E=B[z])}E||(E=n._pe.PePCSInfo.prototype.generate(y,z),B||(B=[],w.set(y,B)),B[z]=E);return E}})(v=n.PePCSInfo||(n.PePCSInfo={}));(function(r){r.version_string=function(){return n._pe.PeVersion.prototype.version_string()}})(n.PeVersion||
(n.PeVersion={}));n._init=e})},"esri/core/tsSupport/extendsHelper":function(){define([],function(){return function(){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,u){n.__proto__=u}||function(n,u){for(var m in u)u.hasOwnProperty(m)&&(n[m]=u[m])};return function(n,u){function m(){this.constructor=n}H(n,u);n.prototype=null===u?Object.create(u):(m.prototype=u.prototype,new m)}}()})},"esri/geometry/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],
function(H,n,u){return function(){function m(k){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(k&&k.steps){var e=0;for(k=k.steps;e<k.length;e++){var c=k[e];c instanceof u?this.steps.push(c):this.steps.push(new u({wkid:c.wkid,wkt:c.wkt,isInverse:c.isInverse}))}}}m.cacheKey=function(k,e){return[void 0!==k.wkid&&null!==k.wkid?k.wkid.toString():"-1",void 0!==k.wkt&&null!==k.wkt?k.wkt.toString():"",void 0!==e.wkid&&null!==e.wkid?e.wkid.toString():"-1",void 0!==e.wkt&&
null!==e.wkt?e.wkt.toString():""].join()};m.fromGE=function(k){var e=new m,c="",a=0;for(k=k.steps;a<k.length;a++){var b=u.fromGE(k[a]);e.steps.push(b);c+=b.uid.toString()+","}e._cached_projection={};e._gtlistentry=null;e._chain=c;return e};m.prototype.getInverse=function(){var k=new m;k.steps=[];for(var e=this.steps.length-1;0<=e;e--)k.steps.push(this.steps[e].getInverse());return k};m.prototype.getGTListEntry=function(){for(var k="",e=0,c=this.steps;e<c.length;e++)k+=c[e].uid.toString()+",";k!==
this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=k);return this._gtlistentry};m.prototype.assignCachedGe=function(k,e,c){this._cached_projection[m.cacheKey(k,e)]=c};m.prototype.getCachedGeTransformation=function(k,e){for(var c="",a=0,b=this.steps;a<b.length;a++)c+=b[a].uid.toString()+",";c!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=c);k=this._cached_projection[m.cacheKey(k,e)];return void 0===k?null:k};return m}()})},"esri/geometry/GeographicTransformationStep":function(){define(["require",
"exports"],function(H,n){var u=0;return function(){function m(k){void 0===k&&(k=null);this.uid=u++;k?(this._wkt=void 0!==k.wkt?k.wkt:null,this._wkid=void 0!==k.wkid?k.wkid:-1,this._isInverse=void 0!==k.isInverse?!0===k.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}m.fromGE=function(k){var e=new m;e._wkt=k.wkt;e._wkid=k.wkid;e._isInverse=k.isInverse;return e};Object.defineProperty(m.prototype,"wkt",{get:function(){return this._wkt},set:function(k){this._wkt=k;this.uid=u++},enumerable:!0,
configurable:!0});Object.defineProperty(m.prototype,"wkid",{get:function(){return this._wkid},set:function(k){this._wkid=k;this.uid=u++},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"isInverse",{get:function(){return this._isInverse},set:function(k){this._isInverse=k;this.uid=u++},enumerable:!0,configurable:!0});m.prototype.getInverse=function(){var k=new m;k._wkt=this.wkt;k._wkid=this._wkid;k._isInverse=!this.isInverse;return k};return m}()})},"esri/layers/rasterLib/raster/TileServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v,r,w,y,z,E,B,C){H=n([C],{declaredClass:"esri.layers.rasterLib.raster.TileServiceRaster",constructor:function(G){},open:function(){var G=new m,I=this.serviceInfo||this._getServiceInfo(null),D=u.hitch(this,function(t){this.serviceInfo=t;this.version=t.currentVersion;this.rasterInfo=this._parseRasterInfo(t);this.loaded=!0;this._getRasterIdentifier();G.resolve(this)}),q=u.hitch(this,function(t){this.loaded=!0;this._getRasterIdentifier();G.reject(t)});f(I,D,q);return G.promise},
read:function(G){var I=this.url+"/tile/"+G.level+"/"+G.row+"/"+G.col,D={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};return this._requestPixels({url:I+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},decodeParams:D,tileOptions:G})},identify:function(G,I){null==I&&(I=this.tileInfo.lods[this.tileInfo.lods.length-1].level);var D=(G.x-this.tileInfo.origin.x)/
this.tileInfo.lods[I].resolution/this.tileInfo.cols;G=(this.tileInfo.origin.y-G.y)/this.tileInfo.lods[I].resolution/this.tileInfo.rows;var q=Math.floor(D),t=Math.floor(G),A=Math.floor((D-q)*this.tileInfo.cols);A=Math.min(A,this.tileInfo.cols-1);var J=Math.floor((G-t)*this.tileInfo.rows);J=Math.min(J,this.tileInfo.rows-1);var M=new m;this.read({level:I,row:t,col:q}).then(function(N){var x=J*N.width+A;N&&N.pixels&&0<N.pixels.length?(N=N.mask?N.mask[x]?N.pixels.map(function(F){return F[x]}):null:N.pixels.map(function(F){return F[x]}),
M.resolve(N)):M.reject("no valid data")},function(N){M.reject(N)});return M.promise},setFetchParameters:function(G,I){},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_getServiceInfo:function(){var G=this.url,I=new m(r._dfdCanceller);I._pendingDfd=d({url:G,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});I._pendingDfd.then(function(D){I.callback(D)},function(D){I.errback(D)});return I},_parseRasterInfo:function(G){var I=
new B;I.extent=new l(G.fullExtent);I.spatialReference=new v(G.spatialReference);this.tileType=G.cacheType||"Map";switch(this.tileType){case "Map":I.bandCount=3;I.pixelType="U8";this.dataType="Processed";break;case "Elevation":I.bandCount=1;I.pixelType=G.pixelType||"F32";this.dataType="Elevation";break;case "Raster":I.bandCount=null,I.pixelType=null,this.dataType=G.serviceDataType&&G.serviceDataType.replace("esriImageServiceDataType","")||"Generic"}var D=G.tileInfo;I.width=Math.floor((G.fullExtent.xmax-
G.fullExtent.xmin)/D.lods[D.lods.length-1].resolution+.5);I.height=Math.floor((G.fullExtent.ymax-G.fullExtent.ymin)/D.lods[D.lods.length-1].resolution+.5);I.cellSize=new p({x:D.lods[D.lods.length-1].resolution,y:D.lods[D.lods.length-1].resolution,spatialReference:G.spatialReference});this.tileInfo=new E(D);this.tileInfo.tileType=this.tileType;return I}});a("extend-esri")&&u.setObject("layers.rasterLib.raster.TileServiceRaster",H,g);return H})},"esri/layers/rasterLib/raster/TileRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v,r,w,y,z,E,B,C){H=n([C],{declaredClass:"esri.layers.rasterLib.raster.TileRaster",sourceType:"TileCache",_RECORD_SIZE:8,constructor:function(G){this._cloudBlobStorage=G&&G._cloudBlobStorage},open:function(){var G=new m,I=this.datasetInfo||this._getDatasetInfo(null),D=u.hitch(this,function(t){this.datasetInfo=t;this.rasterInfo=t=this._parseRasterInfo(t);this.tileType="Cache/LERC"===t.format?"Elevation":"Cache/MIXED"===t.format||"Cache/JPEG"===t.format||"Cache/PNG"===
t.format?"Map":"Raster";this.tileInfo=t.tileInfo;this.dataType=["Generic","Elevation","Processed"][["Raster","Elevation","Map"].indexOf(this.tileType)];this._HEADER_SIZE=t.packetSize*t.packetSize*this._RECORD_SIZE+64;this.loaded=!0;this._cloudBlobStorage=this._cloudBlobStorage||-1<this.url.toLowerCase().indexOf("s3.amazonaws.com")||-1<this.url.toLowerCase().indexOf("windows.net")||-1<this.url.toLowerCase().indexOf("googleapis.com");this._getRasterIdentifier();G.resolve(this)}),q=u.hitch(this,function(t){this.loaded=
!0;this._getRasterIdentifier();G.reject(t)});f(I,D,q);return G.promise},read:function(G){var I=new m,D=G.level,q=G.row,t=G.col,A=this._buildCacheFilePath(this.url,D,q,t),J=this._getIndexRecordFromBundle(D,q,t);d({url:A,content:{},headers:{Range:"bytes\x3d0-"+(this._HEADER_SIZE-1).toString()},handleAs:"arraybuffer"}).then(u.hitch(this,function(M,N){if(!I.isCanceled()){console.log("time in ms request "+(new Date-x));var x=new Date;M=new Uint8Array(M);M=this._getTileEndAndContentType(M,J);N={width:this.tileInfo.cols,
height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};this._requestPixels({url:A+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},headers:{Range:"bytes\x3d"+M.position.toString()+"-"+(M.position+M.recordSize).toString()},decodeParams:N,tileOptions:G}).then(function(F){I.isCanceled()||I.resolve(F)},function(F){I.isCanceled()||I.reject(F)})}}));return I.promise},identify:function(){return null},
setFetchParameters:function(G,I){},toJson:function(){return{url:this.url,tileInfo:this.tileInfo.toJson(),rasterInfo:this.rasterInfo.toJson(),datasetInfo:this.datasetInfo,sourceType:this.sourceType,tileType:this.tileType,_rasterId:this._rasterId}},_getDatasetInfo:function(){return d({url:this.url+"/conf.json",handleAs:"json",content:{}})},_parseRasterInfo:function(G){var I=new B;switch(G.pixelType){case 1:var D="U1";break;case 1:D="U2";break;case 2:D="U4";break;case 3:D="U8";break;case 4:D="S8";break;
case 5:D="U16";break;case 6:D="S16";break;case 7:D="U32";break;case 8:D="S32";break;case 9:D="F32";break;default:D="F32"}var q,t=[],A=G.LODInfos;for(q=0;q<A.levels.length;q++)t.push({level:A.levels[q],resolution:A.resolutions[q],scale:96/.0254*A.resolutions[q]});q=new v(G.extent.spatialReference||G.geodataXform.spatialReference);t=new E({rows:G.blockHeight,cols:G.blockWidth,dpi:96,format:G.format,compressionQuality:0,origin:G.origin,spatialReference:q,lods:t});I.pixelType=D;I.bandCount=G.bandCount;
I.spatialReference=q;I.extent=new l({xmin:G.extent.xmin,ymin:G.extent.ymin,xmax:G.extent.xmax,ymax:G.extent.ymax,spatialReference:q});I.cellSize=new p({x:G.pixelSizeX,y:G.pixelSizeY,spatialReference:q});I.width=Math.floor((I.extent.xmax-I.extent.xmin)/I.cellSize.x+.5);I.height=Math.floor((I.extent.ymax-I.extent.ymin)/I.cellSize.y+.5);I.statistics=G.statistics.map(function(J){Object.keys(J).forEach(function(M){isNaN(J[M])&&(J[M]=null)});return J});I.histograms=G.histograms;I.geodataXform=G.geodataXform;
I.packetSize=G.packetSize;I.format=G.format;I.compressionQuality=G.compressionQuality;I.tileInfo=t;return I},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_buildCacheFilePath:function(G,I,D,q){var t=this.rasterInfo.packetSize;q=Math.floor(q/t)*t;D="R"+this._toHexString4(Math.floor(D/t)*t)+"C"+this._toHexString4(q);t="L";t=10<=I?t+I.toString():t+("0"+I.toString());return this._cloudBlobStorage?G+"/_alllayers/"+
t+"/"+D+".bundle":G+"/"+t+"_"+D+"/bundle"},_getIndexRecordFromBundle:function(G,I,D){G=this.rasterInfo.packetSize;I=I%G*G+D%G;if(0>I)throw"Invalid level / row / col";return I*this._RECORD_SIZE+64},_getTileEndAndContentType:function(G,I){G=G.subarray(I,I+8);I=0;var D;for(D=0;5>D;D++)I|=(G[D]&255)<<8*D;var q=I&0xffffffffff;I=0;for(D=5;8>D;D++)I|=(G[D]&255)<<8*(D-5);return{position:q,recordSize:I&0xffffffffff}},_toHexString4:function(G){G=G.toString(16);if(4!=G.length)for(var I=4-G.length;0<I--;)G="0"+
G;return G}});a("extend-esri")&&u.setObject("layers.rasterLib.raster.TileRaster",H,g);return H})},"esri/layers/rasterLib/raster/FunctionRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff ../DeferredList2 dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../rasterFormats/rasterCodec ./RasterInfo ./BasicRaster ../../rasterLib/function/rasterFunctionHelper".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g,h,d,l,p,v,r,w,y,z,E,B,C){H=n([B],{declaredClass:"esri.layers.rasterLib.raster.FunctionRaster",rasterFunction:null,sourceType:"Function",constructor:function(G){G&&G.rasterFx&&this._init(G.rasterFx,G.rasterFxArgs)},open:function(){var G=this.getMemberRasters().map(function(D){return D.open()});this.identifiers=this.getMemberRasters().map(function(D){return D._rasterId});var I=new m;(new b(G,null,null,!0)).then(function(D){D.some(function(q){return!q[0]})?I.reject(D):
(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.tileInfo=D[0][1].tileInfo,I.resolve(this))}.bind(this));return I.promise},getProjectedFullExtent:function(G){var I=new m;this.getMemberRasters()[0].getProjectedFullExtent(G).then(u.hitch(this,function(D){this.projectedFullExtent=D;I.resolve(D)}));return I.promise},setProcessingContext:function(G){var I=G;G.layer&&(G=G.layer,
I={id:G.id,rawRasterInfo:G.raster.rasterInfo,glSetting:G._glSetting,xformSetting:G.tileManager&&G.tileManager.xformSetting,useWebGL:G.useWebGL,resampling:G.tileMode&&G.tileManager&&G.tileManager.xformSetting.requireProjection&&!G._hasTilingEffects&&"Thematic"!==G.raster.dataType?1:0,tileMode:G.tileMode});this.rasterFunction.setProcessingContext(I);this._layerOptions=I},alterDefinition:function(G){if(G=G||this.rasterFunction)1===this.memberRasters.length&&!G._bindComplete&&(this.rasterFunction=C.create(G,
{raster:this.memberRasters[0]}))&&(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.rasterFunction.setProcessingContext(this._layerOptions)),this._rasterHandler&&this._rasterHandler._connected&&this.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this._layerOptions.id,data:this.rasterFunction.toJson(!0)})},setFetchParameters:function(G,I){var D=this.getMemberRasters();
D&&1===D.length&&D[0].setFetchParameters(G,I)},getMemberRasters:function(){this.memberRasters||(this.memberRasters=[],this._getMemberRasters(this.rasterFunction.functionArguments,this.memberRasters));return this.memberRasters},read:function(G){var I=new m(l._dfdCanceller);if(G.src){var D=this.rasterFunction.read(G);I.resolve(D);return I.promise}var q=this.getMemberRasters().map(function(M){return M.read(G)});q=new b(q);var t,A,J=this.identifiers;I._pendingDfd=q;q.then(u.hitch(this,function(M){if(t=
M.some(function(N){return N[0]}))A={},M.forEach(function(N,x){A[J[x]]=N[0]?N[1]:null});D=A?this.rasterFunction.read({extent:G.extent,src:A}):null;D.srcData=A;I.resolve(D)}));return I},_init:function(G,I){if(this.rasterFunction=C.create(G,I))this.rasterFunction._bindComplete=!0;else throw"Cannot initialize a function raster without a raster function";},_getMemberRasters:function(G,I){var D=Object.keys(G),q,t,A;for(q=0;q<D.length;q++)if(A=G[D[q]]){var J=A instanceof Array?A:[A];for(t=0;t<J.length;t++)(A=
J[t])&&("function"===typeof A||"object"===typeof A)&&A.read&&(A.functionArguments?this._getMemberRasters(A.functionArguments,I):A.sourceType&&"Function"!==A.sourceType&&(A._identifier=A._getRasterIdentifier(),I.some(function(M){return M._identifier===A._identifier})||I.push(A)))}return I}});a("extend-esri")&&u.setObject("layers.rasterLib.raster.FunctionRaster",H,g);return H})},"esri/layers/rasterLib/DeferredList2":function(){define(["dojo/DeferredList"],function(H){return function(n,u,m,k,e){this.list=
n;u=new H(n,u,m,k,e);var c=u.resolve.bind(u),a=u.cancel.bind(u);u.cancel=function(){n&&n.forEach(function(b){b.cancel&&b.cancel()});a.apply(this,arguments)}.bind(u);u.resolve=function(){this.isFulfilled()||c.apply(this,arguments)}.bind(u);return u}})},"esri/layers/rasterLib/tile/RasterTileManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/when ../DeferredList2 ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../PixelBlock ./RasterTileInfo ../raster/rasterProjectionHelper".split(" "),
function(H,n,u,m,k,e,c,a,b,f,g){var h=function(d,l){var p;for(p=0;p<d.length;p++)if(l(d[p]))return p;return-1};return H(null,{declaredClass:"esri.layers.rasterLib.tile.RasterTileManager",count:null,fullBoundary:null,tileBoundary:null,tiles:null,resolution:null,virtual:!0,prefetchBufferSize:0,_progressiveGlobal:!1,_MAX_TILES:128,_defaultMatrixResolution:20,constructor:function(d){this.tiles=[];this.xformSetting={};this.mapSpatialReference=d&&d.mapSR;this.layer=d&&d.layer;this.identifiers=this.layer.raster.rasterFunction?
this.layer.raster.getMemberRasters().map(function(l){return l._rasterId}):[this.layer.raster._rasterId];(d=d&&d.tileInfo)&&this.setTileInfo(d)},setTileInfo:function(d){this.tileInfo=d;this.virtual=d.virtual;this.mapResolution=null;this.tiles.length=0;this.xformSetting.requireProjection=!this.virtual&&!this.mapSpatialReference.equals(this.tileInfo.spatialReference);this.xformSetting.requirePE=g.requirePE(this.mapSpatialReference,this.tileInfo.spatialReference);this.xformSetting.meshSize=this.xformSetting.requireProjection?
[this._defaultMatrixResolution,this._defaultMatrixResolution]:[1,1];this.halfWorldWidth=g.getHalfWorldWidth(d.spatialReference)},updateResolution:function(d,l){if(!(this.mapResolution&&d&&this._resolutionEqual(this.mapResolution.x,d.x)&&this._resolutionEqual(this.mapResolution.y,d.y))){this.resetTiles();var p=this.xformSetting.requireProjection;this.mapResolution=this.resolution=d;p&&(this.resolution=g.projectResolution(d,this.tileInfo.spatialReference,this.layer.projectedFullExtent||l));this._resolution=
this.resolution;d=this.resolution;if(!this.tileInfo.virtual){p=.75*Math.min(d.x,d.y)+.25*Math.max(d.x,d.y);if(p>=this.tileInfo.lods[0].resolution){var v=this.tileInfo.lods[0];this.ooe=!0}else{if(p<=this.tileInfo.lods[this.tileInfo.lods.length-1].resolution)v=this.tileInfo.lods[this.tileInfo.lods.length-1];else for(d=0;d<this.tileInfo.lods.length-1;d++)if(v=this.tileInfo.lods[d],l=this.tileInfo.lods[d+1],v.resolution>=p&&l.resolution<=p){v.resolution-p>p-l.resolution&&(v=l);break}this.ooe=!1}this.level=
v&&v.level;d=this.resolution=new a({x:v.resolution,y:v.resolution,spatialReference:this.tileInfo.spatialReference})}p=this.layer.raster.rasterInfo.extent;v=this.tileInfo.origin;l=this.tileInfo.cols;var r=this.tileInfo.rows;this.fullBoundary={rowStart:Math.floor((v.y-p.ymax)/d.y/r),rowEnd:Math.floor((v.y-p.ymin-d.y)/d.y/r),colStart:Math.floor((p.xmin-v.x)/d.x/l),colEnd:Math.floor((p.xmax-v.x-d.x)/d.x/l)};if(p=this.halfWorldWidth){r=Math.ceil(p/d.x/(l/2));var w=this.tileInfo.applyGCS360Transform?360:
p,y=Math.round(l-(w-v.x)/d.x%l);y===l&&(y=0);this.fullBoundary.colRange=r;this.fullBoundary.paddingRight=y;this.fullBoundary.paddingLeft=Math.round((r*l*d.x+v.x-w-(this.tileInfo.applyGCS360Transform?0:v.x+p))/d.x)}this.hasNewData=!0}},getXformGrid:function(){var d=this.mapExtent,l=this.layer._hasTilingEffects?this.extent:this.fullExtent,p=this.layer.getCurrentResolution(),v=JSON.stringify(d.toJson())+JSON.stringify(l.toJson());this._datumTransformationInitialized||(this._datumTransformationInitialized=
!0,this._datumTransformation=g.getDefaultDatumTransformationForDataset(this.layer.raster.rasterInfo.extent,d.spatialReference,!0));this._cachedExtentString&&this._cachedExtentString===v||(this._cachedExtentString=v,this._xformGrid=d=g.getProjectionOffsetGrid(d,l,p,this.tileInfo.applyGCS360Transform,this.halfWorldWidth,this._datumTransformation));d=this._xformGrid;this.xformSetting.meshSize=d&&d.size;return d},getWrapTimes:function(d){var l=g.getHalfWorldWidth(d.spatialReference);if(!l)return 0;var p=
2*l;l=this.tileInfo.applyGCS360Transform?0:-l;return Math.floor((d.xmax-l)/p)-Math.floor((d.xmin-l)/p)},normalizeCoordinate:function(d,l){if(!l)return 0;var p=2*l;if(0<d){for(;d>l;)d-=p;return d}for(;d<-l;)d+=p;return d},resetTiles:function(){this.tiles.forEach(n.hitch(this,function(d){d.fetch&&!d.fetch.isCanceled()&&d.fetch.cancel();d.update&&!d.update.isCanceled()&&d.update.cancel()}));this.tiles.length=0},updateExtent:function(d,l){this.mapExtent=this.extent=d;var p=this.xformSetting.requireProjection;
if(p){this.extent=g.project(d,this.tileInfo.spatialReference,this.tileInfo.applyGCS360Transform);if(!this.extent)return;this.extent.spatialReference=new c(this.extent.spatialReference.toJson())}this.updateResolution(l,d);var v=this.extent,r=this.tileInfo,w=r.cols,y=r.rows;l=this.resolution;var z=v;p=p?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent;this.ooe&&(z=this._getIntersect(v,p));var E=Math.floor((z.xmin-r.origin.x)/l.x/w)-this.prefetchBufferSize,B=Math.floor((z.xmax-
r.origin.x)/l.x/w)+this.prefetchBufferSize,C=null;d=this.getWrapTimes(d);var G=this.fullBoundary&&this.fullBoundary.colRange;d&&this.halfWorldWidth&&(B===E&&(C=E),B+=d*G);var I=this.halfWorldWidth&&this.tiles.length&&(d!==this.wrapTimes||C!==this._circlularColId);I&&(this._wrapSwitchCount=this._wrapSwitchCount?this._wrapSwitchCount+1:1);this.wrapTimes=d;this._circlularColId=C;var D=Math.floor((r.origin.y-z.ymax)/l.y/y)-this.prefetchBufferSize;C=Math.floor((r.origin.y-z.ymin)/l.y/y)+this.prefetchBufferSize;
this.tileBoundary={rowStart:D,rowEnd:C,colStart:E,colEnd:B};var q,t;((z=(C-D+1)*(B-E+1)>this._MAX_TILES||!this.virtual&&this._resolution.x>8*this.tileInfo.lods[0].resolution)||2<d||I)&&this.resetTiles();if(!(z||2<d)){I=this.tiles;z=!1;for(q=I.length-1;0<=q;q--){var A=I[q].row;var J=I[q].wrapCol;if(A<D||A>C||J<E||J>B)I[q].fetch&&!I[q].fetch.isCanceled()&&I[q].fetch.cancel(),I[q].update&&!I[q].update.isCanceled()&&I[q].update.cancel(),I.splice(q,1),z=!0}for(q=D;q<=C;q++)for(t=E;t<=B;t++){D=new e(r.origin.x+
l.x*w*t,r.origin.y-l.y*y*(q+1),r.origin.x+l.x*w*(t+1),r.origin.y-l.y*y*q,v.spatialReference);var M=d&&G?0<=t?t%G:G- -t%G:t;A=h(I,function(N){return N.row===q&&N.col===M&&N.wrapCol===t});J=p.xmax>=D.xmax?w:Math.round((p.xmax-D.xmin)/l.x);-1===A&&(I.push({row:q,col:M,wrapCol:t,cellsizeX:l.x,cellsizeY:l.y,width:w,height:y,actualWidth:J,extent:D,normalizedExtent:this._wrapExtent(D,M),pixelBlock:null,virtual:this.virtual,level:this.level,tileType:this.tileInfo.tileType||"Raster"}),z=!0)}z&&this._sortTiles();
l=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);this.width=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);this.height=l;this.count=I.length;l=Math.min.apply(null,I.map(function(N){return N.extent.xmin}));r=Math.max.apply(null,I.map(function(N){return N.extent.xmax}));w=Math.min.apply(null,I.map(function(N){return N.extent.ymin}));y=Math.max.apply(null,I.map(function(N){return N.extent.ymax}));l=this.fullExtent=new e(l,w,r,y,v.spatialReference);
if(this.layer.roaming||this.layer.useWebGL)this.layer._hasTilingEffects?(this.xformSetting.offset=[0,0],this.xformSetting.scale=[1,1]):(z&&(this._tilesChanged=!0),this.xformSetting.offset=[(v.xmin-l.xmin)/(l.xmax-l.xmin),-(l.ymin-v.ymin)/(l.ymax-l.ymin)],this.xformSetting.scale=[(v.xmax-v.xmin)/(l.xmax-l.xmin),(v.ymax-v.ymin)/(l.ymax-l.ymin)])}},fetchTiles:function(d){(this._tilesChanged||d)&&this._fetchTiles(d)},_fetchTiles:function(d){this._fetchCounter=0;var l=this.extent;this.fetchAllCompleted=
d?new u:null;(this._tilesChanged||d&&this.layer._hasTilingEffects)&&this.tiles.forEach(n.hitch(this,function(v){v.updateCompleted=!1}));var p={};!this.layer.roaming&&this.layer._hasTilingEffects&&d?(this.identifiers.forEach(function(v,r){p[v]={extent:this.extent,pixelBlock:new b({width:this.layer._map.width,height:this.layer._map.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.extent,src:p,isEmpty:!0}):this._tilesChanged&&(this.identifiers.forEach(function(v,
r){p[v]={extent:this.fullExtent,pixelBlock:new b({width:128,height:128,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.fullExtent,src:p,isEmpty:!0});this.tiles.forEach(n.hitch(this,function(v){if(v.fetch)v.update||(v.update=this.updateTile(v));else{if(this._isTileOutSide(v,l)){v.updateCompleted=!0;return}this._requestTile(v)}this.layer.roaming&&this.layer.useWebGL?this._fillPixelData(v):v.src&&d&&(this.layer._hasTilingEffects||this.layer.useWebGL)&&
(this._fillPixelData(v),this.layer._hasTilingEffects&&(v.updateCompleted=!0),v.processedPixelBlock=null,v.renderedPixelBlock=null)}));0===this._fetchCounter&&(this._fetched=!0);this._tilesChanged=!1;d&&this._updateFetchStatus()},updateTile:function(d,l){var p=new u;if(!d.src&&!d.fetch)return p.resolve(d),p.promise;m(d.src||d._fetched||d.fetch,n.hitch(this,function(){var v=this.layer.tileMode&&this.layer._rasterHandler&&!(this.layer._hasTilingEffects||this.layer.useWebGL),r=this.layer._drawTile,w=
this._validateRawPixelBlocks(d);this.layer._hasTilingEffects&&!this.layer.useWebGL&&(r=r&&(this._progressiveGlobal||l));if((l||!l&&w)&&(v||r||this.layer.roaming)){if(this.xformSetting.requireProjection&&this.layer.useWebGL&&(this.xformSetting.gridConfig=this.getXformGrid(),null==this.xformSetting.gridConfig))return p.cancel(),p.promise;this._processTile(d,l).then(n.hitch(this,function(y){p.isCanceled()||this._renderTile(y,l).then(n.hitch(this,function(z){this.hasNewData=!1;p.isCanceled()||p.resolve(z)}))}))}else l||
w||(d.updateCompleted=!0),this.layer.useWebGL||this.layer._hasTilingEffects?p.resolve(this.originalPixelData):p.resolve()}));return p.promise},setLayer:function(d){this.layer=d},fillupTiles:function(){this.tiles.forEach(n.hitch(this,function(d){d.update&&d.updateCompleted&&!d.filled&&(d.updateCompleted=!1,this._fillPixelData(d),d.updateCompleted=!0)}))},_validateRawPixelBlocks:function(d){return d&&d.src&&!this.identifiers.some(function(l){return!(d.src[l].pixelBlock&&0!==d.src[l].pixelBlock.validPixelCount&&
d.src[l].pixelBlock.pixels&&0<d.src[l].pixelBlock.pixels.length)})},_wrapExtent:function(d,l){if(d){if(this.tileInfo.applyGCS360Transform){var p=this.normalizeCoordinate(d.xmin,180);0>p&&(p+=360);return new e({xmin:p,ymin:d.ymin,xmax:d.xmax-d.xmin+p,ymax:d.ymax,spatialReference:d.spatialReference})}if(this.halfWorldWidth){p=null!=l?new e({xmin:this.tileInfo.origin.x+this.tileInfo.cols*l*this.resolution.x,ymin:d.ymin,xmax:this.tileInfo.origin.x+this.tileInfo.cols*(l+1)*this.resolution.x,ymax:d.ymax,
spatialReference:d.spatialReference}):new e({xmin:d.xmin,ymin:d.ymin,xmax:d.xmax,ymax:d.ymax,spatialReference:d.spatialReference});l=this.normalizeCoordinate(p.xmin,this.halfWorldWidth);var v=l-p.xmin;.01<Math.abs(v)&&(p.xmin=l,p.xmax+=v)}return p||d}},_getIntersect:function(d,l){return new e(Math.max(d.xmin,l.xmin),Math.max(d.ymin,l.ymin),Math.min(d.xmax,l.xmax),Math.min(d.ymax,l.ymax),d.spatialReference)},_isTileOutSide:function(d,l){var p=!1;if(d.virtual){var v=d.normalizedExtent;if(l=l||(this.xformSetting.requireProjection?
this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent)){d=v.xmin-this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;p=v.ymin-this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;var r=v.xmax+this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;v=v.ymax+this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;p=r<=l.xmin||d>=l.xmax||v<=l.ymin||p>=l.ymax}else p=!1}else p=0>d.level||d.row<this.fullBoundary.rowStart||d.row>this.fullBoundary.rowEnd||d.col<
this.fullBoundary.colStart||d.col>this.fullBoundary.colEnd;return p},_resolutionEqual:function(d,l){return d===l||d&&l&&Math.abs(d-l)<Math.abs(l/1E4)?!0:!1},_requestTile:function(d){var l=this.identifiers,p;if(this._isTileOutSide(d)){var v=new u;d.updateCompleted=!0;v.resolve(null);v=v.promise}else v=this.layer.raster.rasterFunction?new k(this.layer.raster.getMemberRasters().map(function(r){return r.read(d)})):new k([this.layer.raster.read(d)]);d.fetch=v;this._fetchCounter++;m(d.src||d._fetched||
v,n.hitch(this,function(r){if(p=r&&r.some(function(y){return y[0]})){var w={};r.forEach(function(y,z){w[l[z]]=y[0]&&y[1]?{extent:y[1].extent,pixelBlock:y[1].pixelBlock,width:y[1].width,height:y[1].height}:null});d.src=w}else d.src=null;this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);d._fetched=!0;this._updateFetchStatus()}),n.hitch(this,function(){this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);d._fetched=!0;this._updateFetchStatus()}));d.update=this.updateTile(d)},
_updateFetchStatus:function(){this.layer._drawTile&&this.fetchAllCompleted&&!this.fetchAllCompleted.isResolved()&&!this.tiles.some(function(d){return!d._fetched})&&(this.tiles.forEach(n.hitch(this,function(d){this._fillPixelData(d)})),this.fetchAllCompleted.resolve())},_fillPixelData:function(d,l){if(d&&!d.updateCompleted)if(Math.abs(d.cellsizeX-this.resolution.x)>d.cellsizeX/10)d.updateCompleted=!0;else if(!1===this._validateRawPixelBlocks(d))d.updateCompleted=!0;else{var p=d.extent;if(this.layer.roaming||
this.layer.useWebGL&&!this.layer._hasTilingEffects){var v=this.fullExtent;var r=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);var w=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);l?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new b({width:r,height:w,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(n.hitch(this,function(z){this.originalPixelData.src[z].pixelBlock.width=r;this.originalPixelData.src[z].pixelBlock.height=
w}))}else v=this.extent,r=this.layer._map.width,w=this.layer._map.height,l?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new b({width:r,height:w,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(n.hitch(this,function(z){this.originalPixelData.src[z].pixelBlock.width=r;this.originalPixelData.src[z].pixelBlock.height=w}));if(v.xmax<=p.xmin||v.xmin>=p.xmax||v.ymax<=p.ymin||v.ymin>=p.ymax)return null;var y=this.originalPixelData.isEmpty=
!1;this.identifiers.forEach(n.hitch(this,function(z){d.src&&(this._fillPixelBlock(d.src[z],this.originalPixelData.src[z],{extent:v,width:r,height:w,normalizedExtent:d.normalizedExtent},!1),y=!0)}));d.filled=y;this.hasNewData=!0}},_fillPixelBlock:function(d,l,p,v){var r=d.extent,w=p.extent;v=p.width;var y=p.height;if(d.pixelBlock&&d.pixelBlock.pixels&&d.pixelBlock.pixels[0]){var z=(r.xmax-r.xmin)/d.width,E=Math.max(r.xmin,w.xmin),B=Math.min(r.ymax,w.ymax),C=Math.round((E-r.xmin)/z),G=d.width-Math.round(Math.abs(r.xmax-
Math.min(r.xmax,w.xmax))/z),I=Math.round(Math.abs(r.ymax-B)/z),D=d.height-Math.round((Math.max(r.ymin,w.ymin)-r.ymin)/z),q=this.halfWorldWidth;E=Math.round((E-w.xmin)/z);p=p.normalizedExtent;if(!(this.wrapTimes&&q&&r.xmin<-q)){if(this.wrapTimes&&q){if(this.tileInfo.applyGCS360Transform)360<r.xmin&&(E-=this.fullBoundary.paddingLeft);else if(r.xmin>q){E-=this.fullBoundary.paddingLeft;var t=this.normalizeCoordinate(r.xmin,q);var A=this.normalizeCoordinate(r.xmax,q)}else t=r.xmin,A=r.xmax;this.tileInfo.applyGCS360Transform?
p&&360>p.xmin&&360<p.xmax&&(G-=this.fullBoundary.paddingRight):p&&p.xmin<q&&p.xmax>q?G-=this.fullBoundary.paddingRight:t<q&&A>q&&(G-=this.fullBoundary.paddingRight)}t=Math.round(Math.abs(w.ymax-B)/z);A=d.pixelBlock.pixels.length;l=l.pixelBlock;p=d.width;r=l.mask||new Uint8Array(v*y);var J=d.pixelBlock,M=J.mask,N=0;for(z=0;z<A;z++){B=J.pixels[z];q=l.pixels[z]||new B.constructor(v*y);for(d=I;d<D;d++)for(N=(t+d-I)*v+E,w=C;w<G;w++)q[N+w-C]=B[d*p+w];l.pixels[z]=q}if(M)for(d=I;d<D;d++)for(N=(t+d-I)*v+E,
w=C;w<G;w++)r[N+w-C]=M[d*p+w];else for(d=I;d<D;d++)for(N=(t+d-I)*v+E,w=C;w<G;w++)r[N+w-C]=1;l.pixelType=l.pixelType||J.pixelType;l.mask=r;if(!(l.statistics&&0<l.statistics.length))for(l.statistics=[],d=0;d<J.statistics.length;d++)l.statistics[d]={minValue:J.statistics[d].minValue,maxValue:J.statistics[d].maxValue};else if(J.statistics&&l.statistics)for(d=0;d<l.statistics.length;d++)l.statistics[d].minValue=Math.min(J.statistics[d].minValue,l.statistics[d].minValue),l.statistics[d].maxValue=Math.max(J.statistics[d].maxValue,
l.statistics[d].maxValue)}}},_processTile:function(d,l){var p=new u,v=this.layer._hasTilingEffects,r=this.layer.useWebGL,w=v||r,y=this.layer.raster.rasterFunction&&d&&(v||r||!d.processedPixelBlock);if(l)var z=d;else this._fillPixelData(d),z=w?this.originalPixelData:d;this.xformSetting.hasNewTexture=this.hasNewData;var E;y?(this.identifiers.forEach(function(B){if(0===z.src[B].pixelBlock.pixels.length||0===z.src[B].pixelBlock.pixels[0].length)E=!0}),E?p.resolve({extent:z.extent,processedPixelBlock:z.src[this.identifiers[0]],
pixelBlock:z.src[this.identifiers[0]]}):r?(this.processedPixelData=this.layer.raster.rasterFunction.read(z),p.resolve(this.processedPixelData)):this.layer._rasterHandler?this.layer._rasterHandler.process({extent:z.extent,src:z.src}).then(function(B){v?(this.processedPixelData=B,p.resolve(this.processedPixelData)):(d.processedPixelBlock=B.pixelBlock,p.resolve(d))}):(l=this.layer.raster.rasterFunction.read(d),d.processedPixelBlock=l.pixelBlock,p.resolve(d))):w?p.resolve(z.src[this.identifiers[0]]):
(d.pixelBlock=z.src[this.identifiers[0]]&&z.src[this.identifiers[0]].pixelBlock,p.resolve(d));return p.promise},_renderTile:function(d){var l=new u,p=this.layer._hasTilingEffects,v=this.layer.useWebGL,r=Math.abs((d.extent.xmax-d.extent.xmin)/d.width-this.layer.getCurrentResolution().x)>this.resolution.x/10;r=this.layer.useWebGL&&(r||this._isTileOutSide(d,this.layer._map.extent));this.xformSetting.hasNewTexture=this.hasNewData;this.layer._rasterRenderer&&d&&(d.texture||d.src||d.pixelBlock||d.processedPixelBlock)?
(this.layer._rasterRenderer.interpolation=this.layer.interpolation,v&&!r?(this.layer.raster.rasterFunction&&this.layer.raster.rasterFunction.renderTexture||this.layer._rasterRenderer.draw(d),l.resolve(d)):this.layer._rasterHandler?this.layer._rasterHandler.render({extent:d.extent,pixelBlock:d.processedPixelBlock||d.pixelBlock}).then(function(w){p?(w.renderedPixelBlock=w.pixelBlock,l.resolve(w)):(d.renderedPixelBlock=w.pixelBlock,l.resolve(d))}.bind(this)):(d.renderedPixelBlock=this.layer._rasterRenderer.draw(d).pixelBlock,
l.resolve(d))):(d.renderedPixelBlock=d.processedPixelBlock||d.pixelBlock,l.resolve(d));return l.promise},_sortTiles:function(){this.tiles.sort(function(d,l){return d.row<l.row||d.row==l.row&&d.col<l.col?-1:1})}})})},"url:dijit/templates/Dialog.html":'\x3cdiv class\x3d"dijitDialog" role\x3d"dialog" aria-labelledby\x3d"${id}_title"\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"titleBar" class\x3d"dijitDialogTitleBar"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"titleNode" class\x3d"dijitDialogTitle" id\x3d"${id}_title"\r\n\t\t\t\trole\x3d"heading" level\x3d"1"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"closeButtonNode" class\x3d"dijitDialogCloseIcon" data-dojo-attach-event\x3d"ondijitclick: onCancel" title\x3d"${buttonCancel}" role\x3d"button" tabindex\x3d"-1"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"closeText" class\x3d"closeText" title\x3d"${buttonCancel}"\x3ex\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitDialogPaneContent"\x3e\x3c/div\x3e\r\n\t${!actionBarTemplate}\r\n\x3c/div\x3e\r\n\r\n',
"url:dijit/form/templates/Button.html":'\x3cspan class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonNode"\r\n\t\tdata-dojo-attach-event\x3d"ondijitclick:__onClick" role\x3d"presentation"\r\n\t\t\x3e\x3cspan class\x3d"dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode,focusNode"\r\n\t\t\trole\x3d"button" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitToggleButtonIconChar"\x3e\x26#x25CF;\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tid\x3d"${id}_label"\r\n\t\t\t\tdata-dojo-attach-point\x3d"containerNode"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\x3e\x3c/span\r\n\t\x3e\x3c/span\r\n\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" class\x3d"dijitOffScreen"\r\n\t\tdata-dojo-attach-event\x3d"onclick:_onClick"\r\n\t\ttabIndex\x3d"-1" aria-hidden\x3d"true" data-dojo-attach-point\x3d"valueNode"\r\n/\x3e\x3c/span\x3e\r\n',
"url:dijit/form/templates/TextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/templates/Tooltip.html":'\x3cdiv class\x3d"dijitTooltip dijitTooltipLeft" id\x3d"dojoTooltip" data-dojo-attach-event\x3d"mouseenter:onMouseEnter,mouseleave:onMouseLeave"\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipConnector" data-dojo-attach-point\x3d"connectorNode"\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipContainer dijitTooltipContents" data-dojo-attach-point\x3d"containerNode" role\x3d\'alert\'\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/ValidationTextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(H){H(['dojo/i18n!*preload*esri/layers/nls/RasterXLayer*["ar","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("esri/layers/RasterXLayer","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/dom-construct dojo/dom-style dojo/on dojox/gfx/matrix dojo/when dojo/DeferredList ../kernel ../config ../lang ../domUtils ../urlUtils ../graphic ../request ../renderers/ClassBreaksRenderer ../renderers/StretchRenderer ../renderers/UniqueValueRenderer ../renderers/ColormapRenderer ../renderers/ShadedReliefRenderer ../geometry/Extent ../SpatialReference ../geometry/Point ./Field ./TimeInfo ./MosaicRule ./DimensionalDefinition ./PixelBlock ./ImageServiceLayerMixin ./rasterLib/raster/rasterFactory ./rasterLib/raster/rasterProjectionHelper ./rasterLib/renderer/rasterRendererHelper ./rasterLib/tile/RasterTileInfo ./rasterLib/tile/RasterTileManager ./rasterLib/tile/RasterHandler ./layer".split(" "),function(H,
n,u,m,k,e,c,a,b,f,g,h,d,l,p,v,r,w,y,z,E,B,C,G,I,D,q,t,A,J,M,N,x,F,L,O,P,S,T,W){var X=l.defaults.map.zoomDuration;H=H([W],{declaredClass:"esri.layers.RasterXLayer",managedSuspension:!0,opacity:1,tileMode:!0,useWebGL:!0,drawMode:!0,_eventMap:{"raster-change":!0,"renderer-change":!0},_lastPopup:[],_rasterFieldPrefix:"Raster.",_cachedVariableStats:{},_cachedVariableHistogram:{},constructor:function(K,R){R=R||{};this.tileMode=null!=R.tileMode?R.tileMode:this.tileMode;this.useWebGL=null!=R.useWebGL?R.useWebGL:
this.useWebGL;this.roaming=null!=R.roaming?R.roaming:this.roaming;this.drawMode=null!=R.drawMode?R.drawMode:this.drawMode;this.bandIds=R.bandIds&&0<R.bandIds.length?R.bandIds:null;this.renderer=R.renderer;this._customModules=R.customModules;this.useMapTime=R.useMapTime;if(R.multidimensionalDefinition&&0<R.multidimensionalDefinition.length){var Q=new J;Q.multidimensionalDefinition=R.multidimensionalDefinition.map(function(U){return U.toJson?U:new M(U)});Q.method=J.METHOD_NONE;this.mosaicRule=Q}this.infoTemplate=
R.infoTemplate;this.drawMode||(this._contextType=R._contextType||R.drawType);this._supportLegacyPropMethods=!1!==R.legacySupport;this._rasterHandler=new T({customModules:this._customModules});this._workInitPromise=this._rasterHandler.start();this.pixelData=null;this._initialize(K,R);b(this,"load",n.hitch(this,function(){g(this._rasterHandler._connected||this._rasterHandler._connectionPromise,n.hitch(this,function(){this._rasterHandler.setLayer({layerId:this.id,raster:{rasterInfo:this.raster.rasterInfo,
rasterFunction:this.raster.rasterFunction&&this.raster.rasterFunction.toJson()},bandCount:this.raster.rasterInfo.bandCount});this.raster.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this.id,data:this.raster.rasterFunction.toJson(!0)});this._rasterRenderer&&this._rasterHandler.setRasterRenderer({layerId:this.id,data:this._rasterRenderer.toJson(!0)})}))}));this._animatePan2d=n.hitch(this,this._animatePan2d)},setOpacity:function(K){this.opacity!==K&&(this.opacity=K,this.onOpacityChange(K))},
onOpacityChange:function(){},onRendererChange:function(){},refresh:function(){if(this.loaded&&this._map)if(!this._canDraw()||10>e("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(K,R,Q,U){this._canDraw()&&(this.useWebGL||(Q?this._context.clearRect(K,R,Q,U):this._context.clearRect(0,0,this._map.width,this._map.height)))},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);
this._toggleTime();v.show(this._div);if("css-transforms"===this._map.navigationMode){var K=this._map.__visibleDelta;this._left=this._tdx=K.x;this._top=this._tdy=K.y;a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(n.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._fireUpdateEnd();this._toggleTime();v.hide(this._div);clearTimeout(this._displayTimer);
this._displayTimer=null},redraw:function(){this.useWebGL&&this._glSetting&&(this._glSetting.hasNewTexture=!1);var K=this.tileMode?this.tileManager.originalPixelData:this.originalPixelData;if(this.tileMode?K&&(K.src||K.texture):K)if(this.tileMode)if(this.useWebGL)this._updateAllTilesOnce(K);else{this.tileManager.tiles.forEach(function(Q){Q&&(Q.update=null,Q.completed=!1,Q.processedPixelBlock=null,Q.renderedPixelBlock=null)});K.processedPixelBlock=null;var R=this.raster.rasterFunction?this.raster.rasterFunction.read(K):
{extent:K.extent,pixelBlock:K.src[this.tileManager.identifiers[0]]&&K.src[this.tileManager.identifiers[0]].pixelBlock};K.renderedPixelBlock=null;K=this._rasterRenderer?this._rasterRenderer.draw(R):R;this._drawOneFrame(K)}else this._supportLegacyPropMethods&&this.pixelFilter?this._setPixelData(this.originalPixelData):(K.processedPixelBlock=null,R=this.raster.rasterFunction?this.raster.rasterFunction.read(K):{extent:K.extent,pixelBlock:K.src?K.src[this.tileManager.identifiers[0]]&&K.src[this.tileManager.identifiers[0]].pixelBlock:
K.pixelBlock},K.renderedPixelBlock=null,K=this._rasterRenderer?this._rasterRenderer.draw(R):R,this._drawOneFrame(K))},getCurrentResolution:function(){var K=this._map.extent;return new q((K.xmax-K.xmin)/this._map.width,(K.ymax-K.ymin)/this._map.height,K.spatialReference)},getCustomRasterFields:function(K){var R=K?K.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix,Q={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:10.3<=this.version?
"esriFieldTypeDouble":"esriFieldTypeString"};K=this.fields?n.clone(this.fields):[];K.push(Q);(Q=this.rasterAttributeTable&&this.rasterAttributeTable.fields)&&0<Q.length&&(Q=m.filter(Q,function(U){return"esriFieldTypeOID"!==U.type&&"value"!==U.name.toLowerCase()}),Q=m.map(Q,function(U){var V=n.clone(U);V.name=R+U.name;return V}),K=K.concat(Q));return K},setRenderer:function(K,R){if(this.loaded&&K){if(K.declaredClass&&-1<K.declaredClass.indexOf("esri.layers.rasterLib")){this._rasterRenderer=K;this._rasterRenderer.bind({layer:this});
var Q=this.bandIds=K.bandIndex;this.raster&&this.raster.setFetchParameters({bandIds:Q});this._params&&(this._params.bandIds=Q&&0<Q.length?Q.join(","):null);this.renderer=this._getCommonRenderer(K)}else Q=n.clone(K.toJson?K.toJson():K),"rasterStretch"===Q.type&&(Q.bandIndex=this.bandIds,Q.bandIndex&&1<Q.bandIndex.length||!Q.bandIndex&&this.raster&&1<this.raster.rasterInfo.bandCount)&&(Q.type="rgb"),this._rasterRenderer=O.create(Q),this.renderer=K.declaredClass?K:this._getCommonRenderer(this._rasterRenderer),
this._rasterRenderer.bind({layer:this});if(this._map){if(this.loaded&&this._rasterHandler._connected){var U=this._rasterHandler.setRasterRenderer({layerId:this.id,data:this._rasterRenderer.toJson(!0)});this._updateTilingEffects()}R||(U?U.then(n.hitch(this,function(){this.redraw()})):this.redraw());this.onRendererChange()}}},setBandIds:function(K,R){this.bandIds=K;this.raster&&this.raster.setFetchParameters({bandIds:K});this._params&&(this._params.bandIds=K&&0<K.length?K.join(","):null);this.setRenderer(this.renderer,
R)},_setTime:function(K){K=K?K.toJson():null;this._params&&(this._params.time=K);this.raster.setFetchParameters({time:K});this.tileManager&&this.tileManager.tiles&&this.tileManager.resetTiles()},setInfoTemplate:function(K){this.infoTemplate=K;this._updateInfoTemplateFields(this.fields)},setMultiDimensionalDefinition:function(K,R){var Q=K&&K.multidimensionalDefinition;if(Q&&this.loaded){var U=Q&&Q[0].variableName;""===U&&(U=this._multidimensionalInfo.variables[0].name,Q.forEach(function(Y){Y.variableName=
U}));if("ImageService"===this.raster.sourceType){var V=this.raster._getAllDimensionDefinition(Q,U);V.defChanged&&(K.multidimensionalDefinition=V.definition,this.setMosaicRule(K,!0))}this.raster.setFetchParameters({multidimensionalDefinition:Q});this.tileManager&&this.tileManager.tiles&&this.tileManager.resetTiles();U&&this._updateRasterInfo(U);R||this.refresh()}},_updateRasterInfo:function(K){var R=this.raster.rasterInfo,Q=this.getHistograms(K);K=this.getStatistics(K);(new h([Q,K])).then(n.hitch(this,
function(U){U[0][0]&&(R.histograms=U[0][1].histograms);U[1][0]&&(R.statistics=U[1][1]);this.refresh()}))},_updateInfoTemplateFields:function(K){if(K&&!(1>K.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var R,Q;var U=this.infoTemplate.info.fieldInfos;for(R=0;R<K.length;R++){var V=K[R];for(Q=0;Q<U.length;Q++)if(U[Q].fieldName.toLowerCase()===V.name.toLowerCase()&&U[Q].fieldName!==V.name){U[Q].fieldName=V.name;break}}}},
getPixelData:function(K){return this.tileMode?K?this.tileManager&&this.tileManager.originalPixelData&&this.tileManager.originalPixelData.src&&this.tileManager.originalPixelData.src[this.tileManager.identifiers[0]]:null:this.inherited(arguments)},fetchPopupFromTiles:function(K){var R=new k;this.identify(K.geometry).then(function(Q){var U=Q.pixelValue;this.hasStdTime()&&U&&U.length&&null!=U[0]&&(U=U.map(function(Z){return this.getStdTimeValue(Z)}.bind(this)).join(", "));if(U){Q={ObjectId:0,"Raster.ServicePixelValue":U};
var V=this.rasterAttributeTable&&this.rasterAttributeTable.features;if(V&&0<V.length&&(V=m.filter(V,function(Z){if(Z&&Z.attributes)return Z.attributes.hasOwnProperty("Value")?Z.attributes.Value==U:Z.attributes.VALUE==U}),0<V.length&&(V=n.clone(V[0]))))for(var Y in V.attributes)V.attributes.hasOwnProperty(Y)&&(Q[this._rasterFieldPrefix+Y]=V.attributes[Y]);Y=new w(new I(this.projectedFullExtent||this.fullExtent),null,Q);Y.setInfoTemplate(this.infoTemplate);Y._layer=this;this._lastPopup=[Y];R.resolve([Y])}else this._lastPopup=
[],R.resolve()}.bind(this),function(Q){this._lastPopup=[];R.resolve(Q)});return R},getPopupFromTiles:function(){return this._lastPopup},identify:function(K,R){return this.raster?this.raster.identify(K):(K=new k,K.reject("layer must be initialized to identify"),K.promise)},_getCommonRenderer:function(K){switch(K.rendererName){case "RGB":case "Stretch":return new E(K.toCommonRendererJson());case "UniqueValue":return new B(K.toCommonRendererJson());case "ClassBreaks":return new z(K.toCommonRendererJson());
case "Colormap":return new C(K.toCommonRendererJson());case "ShadedRelief":return new G(K.toCommonRendererJson())}},_getProjectedFullExtent:function(K){return this.raster.getProjectedFullExtent(K).then(n.hitch(this,function(R){this.projectedFullExtent=R}))},_initialize:function(K,R){R=R||{};this._supportLegacyPropMethods&&this.constructor._onMap&&(this.constructor._onMap["rendering-change"]={method:"onRenderingChange"},this.constructor._onMap["mosaic-rule-change"]={method:"onMosaicRuleChange"},this.constructor._onMap["spatial-reference-change"]=
{method:"onSpatialReferenceChange"});this.raster={};var Q=R.raster?R.raster.url:K;Q&&-1<Q.toLowerCase().indexOf("/imageserver")&&this._supportLegacyPropMethods&&this._addLegacySupport(Q,R);var U=n.hitch(this,function(){this.loaded=!0;this.mosaicRule&&this.mosaicRule.multidimensionalDefinition&&0<this.mosaicRule.multidimensionalDefinition.length&&this.setMultiDimensionalDefinition(this.mosaicRule,!0);this.raster._setRasterHandler(this._rasterHandler);this.onLoad(this);var V=this._loadCallback;V&&(delete this._loadCallback,
V(this))});(K?F.create(n.mixin({url:K},R)):R.raster&&R.raster.open()).then(n.hitch(this,function(V){if(V){this.raster=V;var Y=this._getSourceImageServiceRaster();this.url||(this.url=Y&&Y.url);this.url&&(this._url=r.urlToObject(K));var Z=R.minScale,aa=R.maxScale,ca=V.tileInfo&&"Raster"===V.tileInfo.tileType;null==aa&&(aa=ca&&R.zoomFactor?V.tileInfo.lods[V.tileInfo.lods.length-1].scale/R.zoomFactor:this.maxScale);null==Z&&(Z=ca&&R.zoomFactor?V.tileInfo.lods[0].scale*R.zoomFactor:this.minScale);Y&&"ImageService"===
Y.sourceType&&this._supportLegacyPropMethods&&this._addGeneralProperties(K,R);this.initialExtent=this.fullExtent=this.extent=this.raster.rasterInfo.extent;this.spatialReference=this.extent.spatialReference;this.timeInfo=this.raster.rasterInfo.timeInfo?new A(this.raster.rasterInfo.timeInfo):null;this.rasterAttributeTable=this.raster.rasterInfo.vat;this._multidimensionalInfo=this.raster.rasterInfo.multidimensionalInfo;this.rasterAttributeTable&&(this._rasterAttributeTableFields=this.rasterAttributeTable.fields);
this.mosaicRule&&this.raster.setFetchParameters({multidimensionalDefinition:this.mosaicRule.multidimensionalDefinition});this._multidimensionalInfo&&(this._getDefaultMultidimensionalDefinition(this._multidimensionalInfo,!0,!0),this.mosaicRule||(this.mosaicRule=this.defaultMosaicRule,this.raster.setFetchParameters({multidimensionalDefinition:this._defaultMultidimensionalDefinition})),this.raster.defaultMultidimensionalDefinition=this._defaultMultidimensionalDefinition);null==Z||this._hasMin||this.setMinScale(Z);
null==aa||this._hasMax||this.setMaxScale(aa);this._workInitPromise?this._workInitPromise.then(U,U):U()}else console.error("cannot create rasterx layer as the raster data source cannot be opened")}),this._errorHandler)},_getSourceImageServiceRaster:function(){var K=this.raster&&"Function"===this.raster.sourceType?1===this.raster.getMemberRasters().length?this.raster.getMemberRasters()[0]:null:this.raster;if(K&&"ImageService"===K.sourceType)return K},_addLegacySupport:function(K,R){this._url=r.urlToObject(K);
R=R||{};this.format=(K=R.imageServiceParameters)&&K.format;this.compressionTolerance=K&&K.compressionTolerance?K.compressionTolerance:.01;this.interpolation=K?K.interpolation:null;this.compressionQuality=K?K.compressionQuality:null;this.bandIds=K&&K.bandIds||R&&R.bandIds||null;this.mosaicRule||(this.mosaicRule=K?K.mosaicRule:null);this.renderingRule||(this.renderingRule=K?K.renderingRule:null);this.useMapDimensionValue=R.hasOwnProperty("useMapDimensionValue")?!!R.useMapDimensionValue:!0;this.hasImageFilter=
R.hasImageFilter;this.activeMapDimensions=R.activeMapDimensions;this._params=n.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},K?K.toJson():{});this.pixelFilter=R.pixelFilter;this.originalPixelData=this.pixelData=null;this._queryVisibleRastersHandler=n.hitch(this,this._queryVisibleRastersHandler);this._useRenderingRuleAttributeTable=!1;this._rasterFunctionTemplateInfos=
{};this._customRenderingRuleId={};this._setDefaultFilter=function(){};var Q={setInterpolation:"interpolation",setCompressionQuality:"compressionQuality",setCompressionTolerance:"compressionTolerance",setBandIds:"bandIds",setDefaultBandIds:"bandIds",setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setImageFormat:"format"},U,V=new x;Object.keys(Q).forEach(n.hitch(this,function(Y){this[Y]=n.hitch(this,function(Z,aa){U={};U[Q[Y]]=Z;this.raster&&(this.raster.setFetchParameters(U),V[Y].bind(this)(Z,
aa))})}));this.setDisableClientCaching=function(Y){V.setDisableClientCaching.bind(this)(Y);var Z=this._getSourceImageServiceRaster();Z?Z.disableClientCaching=Y:null}.bind(this);this.setDefinitionExpression=V.setDefinitionExpression.bind(this);this.setUseMapTime=V.setUseMapTime.bind(this);this._toggleTime=V._toggleTime.bind(this);this._onTimeExtentChangeHandler=V._onTimeExtentChangeHandler.bind(this);this.setPixelFilter=V.setPixelFilter.bind(this);this.getHistograms=V.getHistograms.bind(this);this.getRasterFunctionInfos=
V.getRasterFunctionInfos.bind(this);this.getKeyProperties=V.getKeyProperties.bind(this);this.getRasterAttributeTable=V.getRasterAttributeTable.bind(this);this.getRenderingRuleServiceInfo=V.getRenderingRuleServiceInfo.bind(this);this._getRenderingRuleId=V._getRenderingRuleId.bind(this);this._isRenderingRuleAProcessingTemplate=V._isRenderingRuleAProcessingTemplate.bind(this);this.handleSpatialReferenceChange=V.handleSpatialReferenceChange.bind(this);this.onRenderingChange=this.onRenderingChange||function(){};
this.onSpatialReferenceChange=this.onSpatialReferenceChange||function(){};this.onMosaicRuleChange=this.onMosaicRuleChange||function(Y){};this.setRasterRenderer=this.setRenderer;this.getMultidimensionalInfo=V.getMultidimensionalInfo.bind(this);this.getColormap=V.getColormap.bind(this);this.getRenderingRuleColormap=V.getRenderingRuleColormap.bind(this);this.getDefaultMultidimensionalDefinition=V.getDefaultMultidimensionalDefinition.bind(this);this._getDefaultMultidimensionalDefinition=V._getDefaultMultidimensionalDefinition.bind(this);
this._getDefaultDimensionValue=V._getDefaultDimensionValue.bind(this);this.getStatistics=V.getStatistics.bind(this)},_addGeneralProperties:function(){var K=this._getSourceImageServiceRaster();if(K){var R=["minScale","maxScale","tileInfo"];Object.keys(K.serviceInfo).forEach(function(V){null==this[V]&&-1===R.indexOf(V)&&(this[V]=K.serviceInfo[V])}.bind(this));this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);this.bands=K.rasterInfo.statistics;var Q,U=[];this.fields=
this.fields||[];for(Q=0;Q<this.fields.length;Q++)U.push(new t(this.fields[Q]));this.fields=U;this.version=this.currentVersion;this.defaultMosaicRule=K.serviceInfo.defaultMosaicRule}},setDefaultRenderer:function(){if(this.loaded&&this._canvas&&!this.pixelFilter){var K=O.createDefaultRenderer(this);if(null!=K){var R=this.mosaicRule&&this.mosaicRule.multidimensionalDefinition&&0<this.mosaicRule.multidimensionalDefinition.length;if(this._multidimensionalInfo&&R&&"Stretch"===K.rendererName){var Q=this.mosaicRule.multidimensionalDefinition[0].variableName;
(R=this._multidimensionalInfo.variables.filter(function(U){return U.name===Q})[0])&&R.histograms&&R.histograms.length&&(K.histograms=R.histograms,6===K.stretchType&&(K.dra=!1));R&&R.statistics&&R.statistics.length&&(K.statistics=R.statistics.map(function(U){return[U.min,U.max,U.mean,U.stddev||U.standardDeviation]}),6!==K.stretchType&&(K.dra=!1))}this.setRenderer(K,!0)}}},setDefaultInterpolation:function(){if(this.loaded&&this._canvas){var K=this.raster.serviceInfo&&this.raster.serviceInfo.defaultResamplingMethod;
if(K)switch(K.toLowerCase()){case "bilinear":this.interpolation="RSP_BilinearInterpolation";break;case "cubic":this.interpolation="RSP_CubicConvolution";break;case "majority":this.interpolation="RSP_Majority";break;case "nearest":this.interpolation="RSP_NearestNeighbor"}else{K=this.raster.dataType&&this.raster.dataType.toLowerCase();var R=!!this.raster.rasterInfo.colormap;this.raster.rasterInfo.vat||R||"thematic"===K||"StdTime"===K?"RSP_NearestNeighbor":"RSP_BilinearInterpolation"}}},_toggleTime:function(){},
_updateTilingEffects:function(){(this._hasTilingEffects=this._rasterRenderer&&this._rasterRenderer.hasTilingEffects()||this.raster&&this.raster.rasterFunction&&this.raster.rasterFunction.hasTilingEffects())&&this._map&&this.tileMode&&this.useWebGL&&this.tileManager&&(this._hasTilingEffects=!1)},_setMap:function(K,R){this.inherited(arguments);K.spatialReference&&(K.spatialReference.ics||K.spatialReference.icsId)&&(this.roaming=this.useWebGL=this.tileMode=!1);if(this.tileMode){this.virtualTileInfo=
new P(null,{refTileInfo:K.tileInfo,spatialReference:K.spatialReference,extent:this.raster.rasterInfo.extent});var Q=this.raster.tileInfo&&(-1<["Elevation","Raster"].indexOf(this.raster.tileInfo.tileType)||3===this.raster.rasterInfo.bandCount&&"U8"===this.raster.rasterInfo.pixelType)?this.raster.tileInfo:this.virtualTileInfo;this._tileParams=this._tileParams||{};this._tileParams.size=Q.cols+","+Q.rows;this.tileManager=new S({tileInfo:Q,layer:this,mapSR:K.spatialReference})}this._dragOrigin={x:0,y:0};
Q=this._div=c.create("div",null,R);var U={width:K.width+"px",height:K.height+"px",position:"absolute"};"css-transforms"===K.navigationMode?this.roaming&&this.tileMode&&this.useWebGL||(U[d._css.names.transform]=d._css.translate(K.__visibleDelta.x,K.__visibleDelta.y),this._left=K.__visibleDelta.x,this._top=K.__visibleDelta.y):this._left=this._top=0;a.set(Q,U);this._canvas=c.create("canvas",{width:K.width+"px",height:K.height+"px",style:"position: absolute;"},Q);p.isDefined(this.opacity)&&a.set(Q,"opacity",
this.opacity);this._contextType?(this._context=this._canvas.getContext(this._contextType,null),this.useWebGL=this._context instanceof WebGLRenderingContext):this.useWebGL?(this._context=this._canvas.getContext("webgl",null)||this._canvas.getContext("experimental-webgl",null),this.drawMode=!1):(this._context=this._canvas.getContext("2d"),this.drawMode=!0);this._context||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this.useWebGL&&(K.acquireWebGLContext(this),
this._glSetting={gl:this._context,branchCount:this.raster.rasterFunction?this.raster.rasterFunction.branchCount:0,pingpong:null,branches:null,drawMesh:this._drawMesh,programUniforms:{}});this.raster.rasterFunction&&(this._updateTilingEffects(),this.raster.setProcessingContext({layer:this}));this.setRenderer(this.renderer,!0);this._rasterRenderer||this.setDefaultRenderer();this.interpolation||this.setDefaultInterpolation();this._mapWidth=K.width;this._mapHeight=K.height;this._connects=[];this._connects.push(u.connect(K,
"onPan",this,this._panHandler));this._connects.push(u.connect(K,"onPanEnd",this,this._panEndHandler));"css-transforms"===K.navigationMode?this._connects.push(u.connect(K,"onScale",this,this._onScaleHandler)):(this._connects.push(u.connect(K,"onZoom",this,this._onZoomHandler)),this._connects.push(u.connect(K,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(u.connect(K,"onResize",this,this._onResizeHandler));this._connects.push(u.connect(K,"onExtentChange",this,this._extentChangeHandler));
this._connects.push(u.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(u.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:K.width,height:K.height};this.evaluateSuspension();if(this.suspended&&!K.loaded)var V=u.connect(K,"onLoad",this,function(){u.disconnect(V);V=null;this.evaluateSuspension()});return Q},_unsetMap:function(K,R){this.useWebGL&&K.releaseWebGLContext(this);m.forEach(this._connects,u.disconnect,
this);var Q=this._div;Q&&(R.removeChild(Q),c.destroy(Q));this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(K){"CancelError"!==K.name&&(this.clear(),this.onError(K))},_clonePixelData:function(K){if(null===K||K.texture)return K;var R={};K.extent&&(R.extent=n.clone(K.extent));var Q=K.pixelBlock;null!=
Q&&(R.pixelBlock=Q.clone());R.texture=K.texture;return R},_setPixelData:function(K){if(K){K=this._clonePixelData(K);this.pixelFilter&&(this.pixelFilter.filter?(this.pixelFilter.renderTexture=!0,this.pixelFilter.filter(K)):this.pixelFilter(K));this.pixelData=K;if(this._rasterReadPromise&&this._rasterReadPromise.isCanceled())return;this._drawPixelData()}this._rasterReadPromise=null},_requestData:function(K,R,Q){this._rasterReadPromise&&this._rasterReadPromise.cancel();K=n.clone(K)._normalize(!0);this._rasterReadPromise=
this.raster.read({extent:K,width:this._map.width,height:this._map.height});this._rasterReadPromise.then(n.hitch(this,function(U){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=U&&U.srcData?{extent:U.extent,src:U.srcData}:U,this.useWebGL&&this._glSetting&&(this._glSetting.hasNewTexture=!0),this._setPixelData(U))}),n.hitch(this,this._requestDataErrorHandler));return this._rasterReadPromise},_drawPixelData:function(K){a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+
"px",height:this._map.height+"px"});this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),a.set(this._canvas,d._css.names.transform,d._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});this.useWebGL&&this._rasterRenderer&&this._rasterRenderer.draw(this.pixelData);
if(this._canDraw()&&this.drawMode&&this.drawMode&&(K=K||this.pixelData)&&K.pixelBlock){var R=this.pixelFilter?this.pixelData:this._rasterRenderer?this._rasterRenderer.draw(K):K;K=R.pixelBlock;var Q=this._context,U=Q.createImageData(K.width,K.height);U.data.set(K.getAsRGBA());R=R.extent;var V=this._map.extent,Y=this.getCurrentResolution(),Z=0,aa=0;Math.abs(R.xmin-V.xmin)>Y.x&&(Z=Math.round((R.xmin-V.xmin)/Y.x));Math.abs(V.ymax-R.ymax)>Y.y&&(aa=Math.round((V.ymax-R.ymax)/Y.y));"css-transforms"===this._map.navigationMode?
(this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),a.set(this._canvas,d._css.names.transform,d._css.translate(-this._left,-this._top))):(a.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};this.tileMode?this.clear(Z,aa,K.width,K.height):this.clear();
Q.putImageData(U,Z,aa,0,0,K.width,K.height);this._fireUpdateEnd()}},hasStdTime:function(){if(!this.hasMultidimensions||"StdTime"!==this.raster.dataType)return!1;var K=this.mosaicRule&&this.mosaicRule.multidimensionalDefinition,R=K&&K.length?K[0].variableName:this._defaultMultidimensionalDefinition[0].variableName;return this.raster.rasterInfo.multidimensionalInfo.variables.some(function(Q){if(Q.name===R)return Q.dimensions.some(function(U){return"StdTime"===U.name})})},getStdTimeValue:function(K){return(new Date(864E5*
(K-25569))).toString()},_animatePan2d:function(){this._oldDelta&&this._delta.x===this._oldDelta.x&&this._delta.y===this._oldDelta.y||(this.tileManager.updateTile(this.tileManager.originalPixelData,!0),this._oldDelta={x:this._delta.x,y:this._delta.y});this._roamingAnimation&&this.tileMode&&this.useWebGL&&(this._roamingAnimation=requestAnimationFrame(this._animatePan2d))},_cancelAnimation:function(){this._animation&&(cancelAnimationFrame(this._animation),this._animation=null)},_updateAllTilesOnce:function(K,
R){return this.tileManager.updateTile(K,!0).then(n.hitch(this,function(Q){(this._hasTilingEffects||this.useWebGL||R)&&this._drawOneFrame(Q)}))},_drawOneFrame:function(K,R){if(!(this.suspended||!this._map||this.tileMode&&!this._drawTile||(this.tileMode&&this.useWebGL&&this.tileManager.originalPixelData.isEmpty&&this._context.clear(this._context.COLOR_BUFFER_BIT),this.tileMode&&this.useWebGL&&this.tileManager.xformSetting&&this.tileManager.xformSetting.requireProjection&&!this.tileManager.xformSetting.gridConfig))){if(!this._resetCss||
this._levelChange)this._levelChange=!1,this._resetDrawing();if(K&&(K.renderedPixelBlock||K.pixelBlock)&&this._canDraw()&&this.drawMode){R=K.extent;var Q=this._map.extent;if(!this._isExtentOutSide(R,Q)){var U=K.pixelBlock||K.renderedPixelBlock,V=this._context,Y=V.createImageData(U.width,U.height);Y.data.set((K.renderedPixelBlock||K.pixelBlock).getAsRGBA());K=this.getCurrentResolution();var Z=0,aa=0;Math.abs(R.xmin-Q.xmin)>K.x&&(Z=Math.round((R.xmin-Q.xmin)/K.x));Math.abs(Q.ymax-R.ymax)>K.y&&(aa=Math.round((Q.ymax-
R.ymax)/K.y));V.putImageData(Y,Z,aa,0,0,U.width,U.height)}}else this._fireUpdateEnd()}},_isExtentOutSide:function(K,R){return K.xmax<=R.xmin||K.xmin>=R.xmax||K.ymax<=R.ymin||K.ymin>=R.ymax},_resetDrawing:function(){this._resetCss=!0;if(!this.useWebGL)if(this._multiply||this._startRect.width!==this._map.width||this._startRect.height!==this._map.height)this.clear();else{var K=this._context.getImageData(0,0,this._map.width,this._map.height);this.clear();this._context.putImageData(K,this._startRect.left,
this._startRect.top)}this._dragOrigin={x:0,y:0};this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});"css-transforms"===this._map.navigationMode?(this.roaming&&this.tileMode&&this.useWebGL&&(this._delta=null),this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),a.set(this._canvas,d._css.names.transform,
d._css.translate(-this._left,-this._top))):(a.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}))},_drawAllFrames:function(){if(!this.suspended&&this._map&&(!this.tileMode||this._drawTile))if(this._resetCss){var K=this._frames,R=0,Q;for(Q=0;Q<K.length;Q++)if(K[Q].completed)R++;else if(K[Q].tileData.renderedPixelBlock){K[Q].completed=!0;var U=K[Q].tileData;break}else if(K[Q].tileData._fetched&&
!K[Q].tileData.src){K[Q].completed=!0;break}else if(K[Q].tileData.update&&K[Q].tileData.update.isFulfilled()&&!K[Q].tileData.renderedPixelBlock){K[Q].completed=!0;break}else K[Q].tileData.fetch&&(!0===K[Q].tileData.fetch||K[Q].tileData.fetch.isCanceled()||K[Q].tileData.fetch.isRejected())?(K[Q].completed=!0,R++):this._isExtentOutSide(K[Q].tileData.extent,this._map.extent)&&(K[Q].completed=!0,R++);if(U){R++;var V=U.extent,Y=this._map.extent,Z=this.getCurrentResolution(),aa=Q=0;Math.abs(V.xmin-Y.xmin)>
Z.x&&(Q=Math.round((V.xmin-Y.xmin)/Z.x));Math.abs(Y.ymax-V.ymax)>Z.y&&(aa=Math.round((Y.ymax-V.ymax)/Z.y));U.renderedPixelBlock?(V=U.renderedPixelBlock,Y=this._context.createImageData(V.width,V.height),Y.data.set(U.renderedPixelBlock.getAsRGBA()),this._context.putImageData(Y,Q,aa,0,0,V.width,V.height)):this.clear(Q,aa,U.width,U.height)}R===K.length?(this._animation=null,this._fireUpdateEnd()):this._animation=requestAnimationFrame(n.hitch(this,this._drawAllFrames))}else this._resetDrawing(),this._animation=
requestAnimationFrame(n.hitch(this,this._drawAllFrames))},_fetchTiles:function(K,R){if(!this.suspended&&this.loaded){this._cancelAnimation();var Q=this.tileManager,U=!(Q.xformSetting.requireProjection&&Q.xformSetting.requirePE)||L.load();g(U,n.hitch(this,function(){Q.updateExtent(K,this.getCurrentResolution());this._resetCss=!1;Q.fetchTiles(R);R&&(this._hasTilingEffects||this.useWebGL?this.useWebGL&&0<Q.tiles.length?(Q.fillupTiles(),Q._validateRawPixelBlocks(Q.originalPixelData)?this._updateAllTilesOnce(Q.originalPixelData):
Q.originalPixelData&&Q.originalPixelData.src&&Q.tiles.some(function(V){return V.updateCompleted})&&this._context.clear(this._context.COLOR_BUFFER_BIT),Q.tiles.forEach(n.hitch(this,function(V){V.update&&!V.updateCompleted&&V.update.then(function(Y){V.updateCompleted||(V.updateCompleted=!0);(this._hasTilingEffects||this.useWebGL)&&this._drawOneFrame(Y)}.bind(this))}))):this._hasTilingEffects&&g(Q.fetchAllCompleted.isResolved()||Q.fetchAllCompleted,n.hitch(this,function(){this._updateAllTilesOnce(Q.originalPixelData)})):
(this._frames=Q.tiles.map(function(V){return{completed:!1,tileData:V}}),this._drawAllFrames()))}))}},_redrawTiles:function(){this._fetchTiles(this._map.extent,!0)},_panHandler:function(K,R){this._drawTile=!1;"css-transforms"===this._map.navigationMode?this.roaming&&this.tileMode&&this.useWebGL?(this._delta=R,!this._roamingAnimation&&this.tileMode&&(this._roamingAnimation=requestAnimationFrame(this._animatePan2d))):(this._left=this._map.__visibleDelta.x+R.x,this._top=this._map.__visibleDelta.y+R.y,
a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top))):a.set(this._div,{left:this._startRect.left+R.x+"px",top:this._startRect.top+R.y+"px"});this.tileMode&&this._fetchTiles(K)},_panEndHandler:function(K,R){R&&(this._startRect.left+=R.x,this._startRect.top+=R.y);this.oldData=null;this._roamingAnimation&&(cancelAnimationFrame(this._roamingAnimation),this._oldDelta=this._roamingAnimation=null)},_onScaleHandler:function(K,R){var Q={},U=d._css.names;a.set(this._canvas,U.transition,
R?"none":U.transformName+" "+X+"ms ease");this._matrix=K;K=this._multiply?f.multiply(K,this._multiply):K;if(this._tdx||this._tdy)K=f.multiply(K,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});Q[U.transform]=d._css.matrix(K);a.set(this._canvas,Q)},_onZoomHandler:function(K,R,Q){var U=this._startRect;K=U.width*R;R*=U.height;var V=U.left-(K-U.width)*(Q.x-U.left)/U.width;Q=U.top-(R-U.height)*(Q.y-U.top)/U.height;a.set(this._canvas,{left:V+"px",top:Q+"px",width:K+"px",height:R+"px"});this._endRect=
{left:V,top:Q,width:K,height:R}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(K,R,Q){a.set(this._div,{width:R+"px",height:Q+"px"});a.set(this._canvas,{width:R+"px",height:Q+"px"});this._startRect.width=this._canvas.width=R;this._startRect.height=this._canvas.height=Q;this.useWebGL&&this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null)},_extentChangeHandler:function(K,R,Q,U){if(this.loaded&&!this.suspended&&(!R||0!==
R.x||0!==R.y||Q)){this._drawTile=!0;"css-transforms"===this._map.navigationMode&&(R&&(this._dragOrigin.x+=R.x,this._dragOrigin.y+=R.y),this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,this.roaming&&this.tileMode&&this.useWebGL||Q||a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),Q&&(a.set(this._canvas,d._css.names.transition,"none"),this._multiply=this._multiply?f.multiply(this._matrix,this._multiply):this._matrix,this._levelChange=!0));this._fireUpdateStart();
var V=this._map;R=this.raster.rasterFunction?this.raster.getMemberRasters().map(function(Z){return Z._rasterId}):[this.raster._rasterId];var Y={};this.tileMode?((this.roaming||this.useWebGL)&&this.tileMode||(R.forEach(function(Z,aa){Y[Z]={extent:V.extent,pixelBlock:new N({width:V.width,height:V.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}),this.tileManager.originalPixelData={extent:V.extent,src:Y}),this.projectedFullExtent?this._fetchTiles(K,!0):this._getProjectedFullExtent(V.spatialReference).then(n.hitch(this,
function(){this._fetchTiles(K,!0)}))):this._requestData(V.extent,V.width,V.height)}},_visibilityChangeHandler:function(K){K?v.show(this._div):v.hide(this._div)},_opacityChangeHandler:function(K){a.set(this._div,"opacity",K)}});e("extend-esri")&&n.setObject("layers.RasterXLayer",H,d);return H});