// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
/*
 @esri/arcgis-html-sanitizer - v2.7.0 - Wed Jul 14 2021 13:34:33 GMT-0400 (Eastern Daylight Time)
 Copyright (c) 2021 - Environmental Systems Research Institute, Inc.
 Apache-2.0

 js-xss
 Copyright (c) 2012-2017 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 http://ucdok.com
 MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details

 Lodash/isPlainObject
 Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
*/
require({cache:{"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(G,y,t,E,v,m,x,A){G=G([m,x],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(p,q){y.mixin(this,q);this.initialize(p,q)},getTitle:function(p){var q;this.info&&(q=this.titleHasRelatedFields||this.titleHasAsyncExpressions?"":this._getPopupValues(p,
this._fetchAttributes(p,null,this.getExpressionFieldsInTitle()),!0).title);return q||""},getContent:function(p){return this.info?(new A({template:this,graphic:p,chartTheme:this.chartTheme},E.create("div"))).domNode:""}});t("extend-esri")&&y.setObject("dijit.PopupTemplate",G,v);return G})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./promiseList ./ArcadeExpression ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./arcadeProfiles/popupProfile ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),
function(G,y,t,E,v,m,x,A,p,q,w,L,D,H,N,P,Q,h,f,r,z,n){G=G(null,{declaredClass:"esri.PopupInfo",_reNewline:/(\n)/ig,_reExprField:/^\s*expression\//i,_reExprFieldPattern:/\{expression\/([^\}]+)\}/ig,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",_aggregatedFeaturesVariable:"$aggregatedfeatures",initialize:function(b,d){if(b){y.mixin(this,d);this.info=b;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var g=this._fieldLabels=
{},a=this._fieldsMap={};this.info.fieldInfos&&t.forEach(this.info.fieldInfos,function(c){var e=c.fieldName.toLowerCase(),l=this._isExpressionField(e)?this.getExpressionInfo(e):null;g[e]=l?l.title:c.label;a[e]=c},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix));this.titleHasAsyncExpressions=this._titleHasAsyncExpressions();this.contentHasAsyncExpressions=this._contentHasAyncExpressions()}},toJson:function(){return E.fromJson(E.toJson(this.info))},
getTitle:function(){},getContent:function(){},getFieldInfo:function(b){var d;t.some(this.info&&this.info.fieldInfos,function(g){g.fieldName===b&&(d=g);return!!d});return d},getExpressionInfo:function(b){if(b=this._getExprField(b)){b=b.toLowerCase();var d;t.some(this.info.expressionInfos,function(g){g.name.toLowerCase()===b&&(d=g);return!!d});return d}},getExpressionFieldsInTitle:function(){return this._getExprFieldsFromTemplatedString(this.info.title)},getExpressionFieldsInContent:function(){var b=
this._collectExprFieldsFromTemplatedString(this.info.description,[]);this.info.description||t.forEach(this.info.fieldInfos,function(d){d.visible&&this._collectExprField(d.fieldName,b)},this);t.forEach(this.info.mediaInfos,function(d){this._collectExprFieldsFromTemplatedString(d.title,b);this._collectExprFieldsFromTemplatedString(d.caption,b);if(d=d.value)this._collectExprFieldsFromTemplatedString(d.linkURL,b),this._collectExprFieldsFromTemplatedString(d.sourceURL,b),t.forEach(d.fields,function(g){this._collectExprField(g,
b)},this),this._collectExprField(d.normalizeField,b),this._collectExprField(d.tooltipField,b)},this);return b},getRequiredExpressionFields:function(){return this.getExpressionFieldsInTitle().concat(this.getExpressionFieldsInContent())},hasGeometryOperations:function(){return t.some(this._getArcadeExpressions(),function(b){return b.hasGeometryOperations()})},hasAsyncExpressions:function(){return t.some(this._getArcadeExpressions(),function(b){return b.async})},initializeArcadeEngine:function(){return r.initialize(this._getArcadeExpressions())},
getComponents:function(b,d){var g=this.info,a={initArcadeEngine:this.initializeArcadeEngine()};g.fieldInfos&&(g=t.filter(g.fieldInfos,function(c){return-1!==c.fieldName.indexOf(this._relatedFieldPrefix)},this))&&0<g.length&&(a.relatedInfo=this._getRelatedRecords({graphic:b,fieldsInfo:g}));this._needFullResolutionFeature(b)&&(a.fullResolutionFeature=this._getFullResolutionFeature(b));this._needAggregatedFeaturesLayer(b)&&(a.aggregatedFeaturesLayer=this._getAggregatedFeaturesLayer(b));return H(a).then(y.hitch(this,
function(c){var e=c.fullResolutionFeature,l=d&&d.evaluateAllExpressions,F=l?null:this.getRequiredExpressionFields();c=(l?this.hasAsyncExpressions():this._hasAsyncExpressions(F))?this._fetchAttributesAsync(b,e,F,c.aggregatedFeaturesLayer):this._fetchAttributes(b,e,F);return H([c]).then(y.hitch(this,function(B){return this._getPopupValues(b,B[0])}))}))},getAttachments:function(b){var d=b.getSourceLayer();b=b.attributes;if(this.info.showAttachments&&d&&d.hasAttachments&&d.objectIdField&&(b=b&&b[d.objectIdField]))return d.queryAttachmentInfos(b)},
_needAggregatedFeaturesLayer:function(b){return b.isAggregate()?t.some(this._getArcadeExpressions(),function(d){return d.hasVariable(this._aggregatedFeaturesVariable)},this):!1},_getAggregatedFeaturesLayer:function(b){return b.getAggregationSourceLayer().getFeatureCollectionLayer(b.getChildGraphics()).always(function(d){return d instanceof Error?null:d})},_needFullResolutionFeature:function(b){return(b=b.getSourceLayer())?"function"===typeof b.getMaxAllowableOffset&&0<b.getMaxAllowableOffset()&&this.hasGeometryOperations():
!1},_getFullResolutionFeature:function(b){var d=b.getSourceLayer(),g=d.objectIdField;b=(b=b.attributes)&&g&&b[g];if(null==b)return null;var a=new P;a.where=g+"\x3d"+b;a.maxAllowableOffset=0;a.outFields=[g];d._enableCacheHint(a);return d.queryFeatures(a).then(function(c){return c.features&&c.features[0]})},_isExpressionField:function(b){return this._reExprField.test(b)},_getExprField:function(b){return this._isExpressionField(b)?b.replace(this._reExprField,""):null},_collectExprField:function(b,d){(b=
this._getExprField(b))&&d.push(b);return d},_collectExprFieldsFromTemplatedString:function(b,d){b=this._getExprFieldsFromTemplatedString(b);b.length&&Array.prototype.push.apply(d,b);return d},_getExprFieldsFromTemplatedString:function(b){b=b?b.match(this._reExprFieldPattern):null;return t.map(b,function(d){return d.replace(this._reExprFieldPattern,"$1")},this)},_titleHasAsyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInTitle())},_contentHasAyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInContent())},
_hasAsyncExpressions:function(b){return t.some(b,function(d){d=this._exprCache[d];return!(!d||!d.async)},this)},_compileExpressions:function(b){var d={};t.forEach(b,function(g){var a=g.returnType&&g.returnType.toLowerCase();d[g.name]=new N({expression:g.expression,returnType:"number"===a?"number":"string",profile:r})});return d},_getArcadeExpressions:function(){var b=[],d;for(d in this._exprCache)b.push(this._exprCache[d]);return b},_fetchAttributesAsync:function(b,d,g,a){var c=this._fetchAttributes(b,
d,g,a);b={};for(var e in c)(d=c[e])&&d.then&&(b[e]=d);return H(b).then(y.hitch(this,function(l){for(var F in l){var B=l[F];c[F]=B instanceof Error?null:this._processArcadeResult(B)}return c}))},_processArcadeResult:function(b){"string"===typeof b&&(b=q.encode(b));return b},_fetchAttributes:function(b,d,g,a){var c=y.clone(b.attributes)||{},e=d&&d.geometry,l=this._exprPrefix,F=this._exprCache;g=g||t.map(this.info.expressionInfos,function(B){return B.name});t.forEach(g,function(B){var I=l+B;B=(B=F[B])?
b.evaluateExpression(B,this._getEvalOptions(B,b,e,a)):null;c[I]=this._processArcadeResult(B)},this);return c},_getEvalOptions:function(b,d,g,a){var c=b.hasGeometryOperations(),e=d.getSourceLayer(),l=e&&(e.getMap()||e.parentLayer&&e.parentLayer.getMap());a&&(a._map=l);b=r.getEvalOptions({expression:b,feature:d,layer:e,aggregatedFeaturesLayer:a,map:l,spatialReference:l&&l.spatialReference});d=b.context.vars.$feature;c=!(!c||!g);d&&c&&(d._geometry=g);b.skipCache=c;return b},_getPopupValues:function(b,
d,g){d=d||this._fetchAttributes(b);var a=this.info,c=b.getSourceLayer(),e=y.clone(d),l="",F="",B,I,J=c&&c._getDateOpts&&c._getDateOpts().properties;J=J&&J.slice(0);var O={dateFormat:{properties:J,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)},format:null};if(this._relatedInfo)for(U in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(U)){var S=this._relatedInfo[U],X=this._relatedLayersInfo[U];S&&(t.forEach(S.relatedFeatures,function(Z){for(I in Z.attributes)if(Z.attributes.hasOwnProperty(I)&&
"esriRelCardinalityOneToOne"===X.relation.cardinality){var ea=this._toRelatedFieldName([X.relation.id,I]);d[ea]=e[ea]=Z.attributes[I]}},this),t.forEach(S.relatedStatsFeatures,function(Z){for(I in Z.attributes)if(Z.attributes.hasOwnProperty(I)){var ea=this._toRelatedFieldName([X.relation.id,I]);d[ea]=e[ea]=Z.attributes[I]}},this))}for(B in e){var U=this._fieldsMap[B.toLowerCase()];S=this._getLayerFieldInfo(c,B);U&&S&&(U.fieldName=S.name);e[B]=this._formatValue(e[B],B,O);J&&U&&U.format&&U.format.dateFormat&&
(U=t.indexOf(J,B),-1<U&&J.splice(U,1))}if(c)for(B in J=c.typeIdField,d)if(d.hasOwnProperty(B)&&-1===B.indexOf(this._relatedFieldPrefix)){var R=d[B];w.isDefined(R)&&(U=this._getDomainName(c,b,B,R),w.isDefined(U)?e[B]=U:B===J&&(U=this._getTypeName(c,b,R),w.isDefined(U)&&(e[B]=U)))}a.title&&(l=this._processFieldsInLinks(this._fixTokens(a.title,c),d),l=y.trim(this._removeEmptyHref(w.substitute(e,l,O)||"")));if(g)return{title:l};a.description&&(F=this._processFieldsInLinks(this._fixTokens(a.description,
c),d),F=y.trim(this._removeEmptyHref(w.substitute(e,F,O)||"")));if(a.fieldInfos){var W=[];t.forEach(a.fieldInfos,function(Z){(B=Z.fieldName)&&Z.visible&&W.push([this._fieldLabels[B.toLowerCase()]||B,w.substitute(e,"${"+B+"}",O)||""])},this)}var ba;if(a.mediaInfos){var fa=[];t.forEach(a.mediaInfos,function(Z){ba=0;R=Z.value;switch(Z.type){case "image":var ea=R.sourceURL;ea=ea&&y.trim(this._removeEmptyHref(w.substitute(d,this._fixTokens(ea,c))));ba=!!ea;break;case "piechart":case "linechart":case "columnchart":case "barchart":ea=
R.normalizeField;R.fields=t.map(R.fields,function(la){return(ha=this._getLayerFieldInfo(c,la))?ha.name:la},this);if(ea){var ha=this._getLayerFieldInfo(c,ea);R.normalizeField=ha?ha.name:ea}ba=t.some(R.fields,function(la){return w.isDefined(d[la])||-1!==la.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(ba){Z=y.clone(Z);R=Z.value;ea=Z.title?this._processFieldsInLinks(this._fixTokens(Z.title,c),d):"";var ra=Z.caption?this._processFieldsInLinks(this._fixTokens(Z.caption,
c),d):"";Z.title=ea?y.trim(this._removeEmptyHref(w.substitute(e,ea,O)||"")):"";Z.caption=ra?y.trim(this._removeEmptyHref(w.substitute(e,ra,O)||"")):"";if("image"===Z.type)R.sourceURL=w.substitute(d,this._fixTokens(R.sourceURL,c)),R.linkURL&&(R.linkURL=y.trim(w.substitute(d,this._fixTokens(R.linkURL,c))||""));else{var oa,ta;t.forEach(R.fields,function(la,ma){if(-1!==la.indexOf(this._relatedFieldPrefix))ta=this._getRelatedChartInfos(la,R,d,O),ta instanceof Array?R.fields=ta:R.fields[ma]=ta;else{var qa=
d[la];qa=void 0===qa?null:qa;oa=d[R.normalizeField]||0;qa&&oa&&(qa/=oa);R.fields[ma]={y:qa,tooltip:(this._fieldLabels[la.toLowerCase()]||la)+":\x3cbr/\x3e"+this._formatValue(qa,la,O,!!oa)}}},this)}fa.push(Z)}},this)}return{title:l,description:F,hasDescription:!!a.description,fields:W&&W.length?W:null,mediaInfos:fa&&fa.length?fa:null,formatted:e,editSummary:!1!==a.showLastEditInfo&&c&&c.getEditSummary?c.getEditSummary(b):""}},_getRelatedChartInfos:function(b,d,g,a){var c,e;var l=[];var F=this._fromRelatedFieldName(b);
var B=F[0];var I=this._relatedInfo[B];B=this._relatedLayersInfo[B];I&&t.forEach(I.relatedFeatures,function(J){J=J.attributes;var O;for(O in J)if(J.hasOwnProperty(O)&&O===F[1]){var S={};e=J[O];d.normalizeField&&(c=-1!==d.normalizeField.indexOf(this._relatedFieldPrefix)?J[this._fromRelatedFieldName(d.normalizeField)[1]]:g[d.normalizeField]);e&&c&&(e/=c);if(d.tooltipField)if(-1!==d.tooltipField.indexOf(this._relatedFieldPrefix)){var X=this._fromRelatedFieldName(d.tooltipField)[1],U=w.isDefined(J[X])?
this._formatValue(J[X],d.tooltipField,a,!!c):X;S.tooltip=U+":\x3cbr/\x3e"+this._formatValue(e,X,a,!!c)}else S.tooltip=(this._fieldLabels[b.toLowerCase()]||b)+":\x3cbr/\x3e"+this._formatValue(e,d.tooltipField,a,!!c);else S.tooltip=e;S.y=e;l.push(S)}},this);return"esriRelCardinalityOneToMany"===B.relation.cardinality||"esriRelCardinalityManyToMany"===B.relation.cardinality?l:l[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",
shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",
shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",longMonthDayYearShortTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longMonthDayYearShortTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longMonthDayYearLongTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",
longMonthDayYearLongTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",dayShortMonthYearShortTime:"(datePattern: 'd MMM y', timePattern: 'h:mm a', selector: 'date and time')",dayShortMonthYearShortTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm', selector: 'date and time')",dayShortMonthYearLongTime:"(datePattern: 'd MMM y', timePattern: 'h:mm:ss a', selector: 'date and time')",dayShortMonthYearLongTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm:ss', selector: 'date and time')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",longDateShortTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longDateShortTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longDateLongTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",longDateLongTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",
shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_dateFormatsJson:{shortDate:{datePattern:"M/d/y",selector:"date"},shortDateShortTime:{datePattern:"M/d/y",timePattern:"h:mm a",selector:"date and time"},shortDateShortTime24:{datePattern:"M/d/y",timePattern:"H:mm",selector:"date and time"},shortDateLongTime:{datePattern:"M/d/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLongTime24:{datePattern:"M/d/y",timePattern:"H:mm:ss",selector:"date and time"},
shortDateLE:{datePattern:"d/M/y",selector:"date"},shortDateLEShortTime:{datePattern:"d/M/y",timePattern:"h:mm a",selector:"date and time"},shortDateLEShortTime24:{datePattern:"d/M/y",timePattern:"H:mm",selector:"date and time"},shortDateLELongTime:{datePattern:"d/M/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLELongTime24:{datePattern:"d/M/y",timePattern:"H:mm:ss",selector:"date and time"},longMonthDayYear:{datePattern:"MMMM d, y",selector:"date"},longMonthDayYearShortTime:{datePattern:"MMMM d, y",
timePattern:"h:mm a",selector:"date and time"},longMonthDayYearShortTime24:{datePattern:"MMMM d, y",timePattern:"H:mm",selector:"date and time"},longMonthDayYearLongTime:{datePattern:"MMMM d, y",timePattern:"h:mm:ss a",selector:"date and time"},longMonthDayYearLongTime24:{datePattern:"MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},dayShortMonthYear:{datePattern:"d MMM y",selector:"date"},dayShortMonthYearShortTime:{datePattern:"d MMM y",timePattern:"h:mm a",selector:"date and time"},dayShortMonthYearShortTime24:{datePattern:"d MMM y",
timePattern:"H:mm",selector:"date and time"},dayShortMonthYearLongTime:{datePattern:"d MMM y",timePattern:"h:mm:ss a",selector:"date and time"},dayShortMonthYearLongTime24:{datePattern:"d MMM y",timePattern:"H:mm:ss",selector:"date and time"},longDate:{datePattern:"EEEE, MMMM d, y",selector:"date"},longDateShortTime:{datePattern:"EEEE, MMMM d, y",timePattern:"h:mm a",selector:"date and time"},longDateShortTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm",selector:"date and time"},longDateLongTime:{datePattern:"EEEE, MMMM d, y",
timePattern:"h:mm:ss a",selector:"date and time"},longDateLongTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},longMonthYear:{datePattern:"MMMM y",selector:"date"},shortMonthYear:{datePattern:"MMM y",selector:"date"},year:{datePattern:"y",selector:"date"}},_reHref:/href\s*=\s*(")([^"]+)"/ig,_reHrefApos:/href\s*=\s*(')([^']+)'/ig,_fixTokens:function(b,d){var g=this;return b.replace(/(\{([^\{\r\n]+)\})/g,function(a,c,e){a=g._getLayerFieldInfo(d,e);return"$"+(a?"{"+
a.name+"}":c)})},_encodeAttributes:function(b,d){b=y.clone(b)||{};var g,a;for(g in b)(a=b[g])&&"string"===typeof a&&(a=d?a:encodeURIComponent(a),a=a.replace(/'/g,"\x26apos;"),b[g]=a);return b},_processFieldsInLinks:function(b,d){var g=this._encodeAttributes(d),a=this._encodeAttributes(d,!0);d=y.hitch(this,this._addValuesToHref,d,g,a);b&&(b=b.replace(this._reHref,d).replace(this._reHrefApos,d));return b},_addValuesToHref:function(b,d,g,a,c,e){e=e&&y.trim(e);return a=w.substitute(e&&0===e.indexOf("${")?
"'"===c?g:b:d,a)},_getLayerFieldInfo:function(b,d){return b&&b.getField?b.getField(d):null},_formatValue:function(b,d,g,a){var c=this._fieldsMap[d.toLowerCase()],e=c&&c.format;d=-1!==t.indexOf(g.dateFormat.properties,d);var l="number"===typeof b&&!d&&(!e||!e.dateFormat);if(!w.isDefined(b)||!c||!w.isDefined(e))return this._applyFormatting(b,l);c=e.hasOwnProperty("places")||e.hasOwnProperty("digitSeparator");var F=e.hasOwnProperty("digitSeparator")?e.digitSeparator:!0;if(c&&!d)var B={formatType:"NumberFormat",
places:w.isDefined(e.places)&&(!a||0<e.places)?Number(e.places):Infinity};else if(e.dateFormat)B=y.mixin({formatType:"DateFormat",utcOffset:this.utcOffset},this._dateFormatsJson[e.dateFormat]||this._dateFormatsJson.shortDateShortTime);else return this._applyFormatting(b,l);var I=this._applyFormatFunctions(b,B,g);c&&-1<b.constructor.toString().indexOf("Array")&&(I="",t.forEach(b,y.hitch(this,function(J,O){O&&(I+=" ");I+=this._applyFormatFunctions(J,B,g)})));c&&!F&&n.group&&(I=I.replace(new RegExp("\\"+
n.group,"g"),""));d&&(I='\x3cspan class\x3d"esriDateValue"\x3e'+I+"\x3c/span\x3e");return this._applyFormatting(I,l)},_applyFormatFunctions:function(b,d,g){d&&g&&(g.format={myKey:d});b=w.substitute({myKey:b},"${myKey}",g)||"";d&&g&&(g.format=null);return b},_applyFormatting:function(b,d){return d?this._forceLTR(b):this._applyPreWrap(b)},_forceLTR:function(b){var d=A("ie");return d&&10>=d?b:"\x3cspan class\x3d'esriNumericValue'\x3e"+b+"\x3c/span\x3e"},_applyPreWrap:function(b){return"string"===typeof b?
b.replace(this._reNewline,"\x3cspan class\x3d'charNewLine'\x3e$1\x3c/span\x3e"):b},_insertOffset:function(b){b&&(b=w.isDefined(this.utcOffset)?b.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):b);return b},_getDomainName:function(b,d,g,a){return(b=b.getDomain&&b.getDomain(g,{feature:d}))&&b.codedValues?b.getName(a):null},_getTypeName:function(b,d,g){return(b=b.getType&&b.getType(d))&&b.name},_getRelatedRecords:function(b){var d=b.graphic,g;this._relatedLayersInfoPromise||(this._relatedLayersInfoPromise=
this._getRelatedLayersInfo(b).then(y.hitch(this,function(a){for(g in a)a.hasOwnProperty(g)&&a[g]&&(this._relatedLayersInfo[g].relatedLayerInfo=a[g])})));return this._relatedLayersInfoPromise.then(y.hitch(this,function(){return this._queryRelatedLayers(d)})).then(y.hitch(this,function(a){this._setRelatedRecords(d,a);return a}))},_getRelatedLayersInfo:function(b){var d=b.fieldsInfo,g,a={};var c=b.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});t.forEach(d,function(e){var l;
var F=this._fromRelatedFieldName(e.fieldName);var B=F[0];F=F[1];if(B&&(!this._relatedLayersInfo[B]&&c&&c.relationships&&(t.some(c.relationships,function(J){if(J.id==B)return l=J,!0}),l&&(this._relatedLayersInfo[B]={relation:l,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[B]&&(this._relatedLayersInfo[B].relatedFields.push(F),e.statisticType))){var I=new f;I.statisticType=e.statisticType;I.onStatisticField=F;I.outStatisticFieldName=F;this._relatedLayersInfo[B].outStatistics.push(I)}},
this);for(g in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(g)&&this._relatedLayersInfo[g]&&(b=this._relatedLayersInfo[g].relation,b=c.url.replace(/[0-9]+$/,b.relatedTableId),this._relatedLayersInfo[g].relatedLayerUrl=b,a[g]=D({url:b,content:{f:"json"},callbackParamName:"callback"}));return p(a)},_queryRelatedLayers:function(b){var d={},g;for(g in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(g)&&(d[g]=this._queryRelatedLayer({graphic:b,relatedInfo:this._relatedLayersInfo[g]}));
return p(d)},_queryRelatedLayer:function(b){var d,g;var a=b.graphic;var c=a.getSourceLayer();var e=c.url.match(/[0-9]+$/g)[0];var l=b.relatedInfo;var F=l.relatedLayerInfo;var B=l.relatedLayerUrl;var I=l.relation;b=t.filter(F.relationships,function(R){return R.relatedTableId===parseInt(e,10)});1===b.length?d=b[0]:1<b.length&&t.some(b,function(R){R.id===I.id&&(d=R);return!!d});if(d){var J=new P;t.some(F.fields,function(R){if(R.name===d.keyField)return g=-1!==t.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger",
"esriFieldTypeSingle","esriFieldTypeDouble"],R.type)?"number":"string",!0});if(d.relationshipTableId&&d.keyFieldInRelationshipTable){var O=new x;this._queryRelatedRecords(a,d).then(y.hitch(this,function(R){var W;(W=R[a.attributes[c.objectIdField]])?(R=t.map(W.features,function(ba){return ba.attributes[F.objectIdField]},this),l.outStatistics&&0<l.outStatistics.length&&F.supportsStatistics&&(X=new P,X.where=this._chunkWhereInClause(F.objectIdField,R,1E3),X.outFields=J.outFields,X.outStatistics=l.outStatistics),
X&&(U=new Q(B),U.execute(X).then(y.hitch(this,function(ba){var fa=[];fa.push(W);fa.push(ba);O.resolve(fa)})))):O.resolve()}))}else{var S="string"===g?d.keyField+"\x3d'"+a.attributes[I.keyField]+"'":d.keyField+"\x3d"+a.attributes[I.keyField];J.where=S;J.outFields=l.relatedFields;if(l.outStatistics&&0<l.outStatistics.length&&F.supportsStatistics){var X=new P;X.where=J.where;X.outFields=J.outFields;X.outStatistics=l.outStatistics}var U=new Q(B);S=[];S.push(U.execute(J));X&&S.push(U.execute(X))}}return S?
p(S):O?O.promise:void 0},_setRelatedRecords:function(b,d){this._relatedInfo=[];for(var g in d)d.hasOwnProperty(g)&&d[g]&&(b=d[g],this._relatedInfo[g]={},this._relatedInfo[g].relatedFeatures=b[0].features,w.isDefined(b[1])&&(this._relatedInfo[g].relatedStatsFeatures=b[1].features))},_handlerErrorResponse:function(b,d){b.reject(d)},_fromRelatedFieldName:function(b){var d=[];-1!==b.indexOf(this._relatedFieldPrefix)&&(b=b.split("/"),d=b.slice(1));return d},_toRelatedFieldName:function(b){var d="";b&&
0<b.length&&(d=this._relatedFieldPrefix+b[0]+"/"+b[1]);return d},_queryRelatedRecords:function(b,d){var g=b.getSourceLayer(),a=new h;a.outFields=["*"];a.relationshipId=d.id;a.objectIds=[b.attributes[g.objectIdField]];return g.queryRelatedFeatures(a)},_removeEmptyHref:function(b){return b.replace(/href=(""|'')/gi,"")},_chunkWhereInClause:function(b,d,g){for(var a=0,c=[];a<d.length;)c.push(b+" IN ("+d.slice(a,g+a)+")"),a+=g;return c.join(" OR ")}});m("extend-esri")&&(L.PopupInfo=L.PopupInfoTemplate=
G);return G})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(G){var y=G.getObject("dojox.html.entities",!0),t=function(v,m){if(m._encCache&&m._encCache.regexp&&m._encCache.mapper&&m.length==m._encCache.length){var x=m._encCache.mapper;var A=m._encCache.regexp}else{x={};A=["["];var p;for(p=0;p<m.length;p++)x[m[p][0]]="\x26"+m[p][1]+";",A.push(m[p][0]);A.push("]");A=new RegExp(A.join(""),"g");m._encCache={mapper:x,regexp:A,length:m.length}}return v=v.replace(A,function(q){return x[q]})},
E=function(v,m){if(m._decCache&&m._decCache.regexp&&m._decCache.mapper&&m.length==m._decCache.length){var x=m._decCache.mapper;var A=m._decCache.regexp}else{x={};A=["("];var p;for(p=0;p<m.length;p++){var q="\x26"+m[p][1]+";";p&&A.push("|");x[q]=m[p][0];A.push(q)}A.push(")");A=new RegExp(A.join(""),"g");m._decCache={mapper:x,regexp:A,length:m.length}}return v=v.replace(A,function(w){return x[w]})};y.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];y.latin=[["\u00a1",
"iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],
["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],
["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],
["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a",
"Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be",
"xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191",
"uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229",
"cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663",
"clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030",
"permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];y.encode=function(v,m){v&&(m?v=t(v,m):(v=t(v,y.html),v=t(v,y.latin)));return v};y.decode=function(v,m){v&&(m?v=E(v,m):(v=E(v,y.html),v=E(v,y.latin)));return v};return y})},"esri/ArcadeExpression":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./layers/support/attributeUtils ./support/expressionUtils".split(" "),function(G,y,t,E,v,m){G=G(null,{declaredClass:"esri.ArcadeExpression",expression:null,profile:null,returnType:null,
async:null,id:null,syntaxTree:null,_traits:null,_attributeDef:null,_attributeCache:null,_compiled:!1,constructor:function(x){y.mixin(this,x);this.returnType=this.returnType||"string";this.id=v.getAttributeId(this.expression);this._setSyntaxTree(this.profile.parse(this));this.async=this.async||this.profile.isAsync(this)},hasGeometryOperations:function(){var x=this._traits.geometryOperations;void 0===x&&(x=this._traits.geometryOperations=m.hasGeometryOperations(this.syntaxTree));return x},hasFeatureSetOperations:function(){var x=
this._traits.featureSetOperations;void 0===x&&(x=this._traits.featureSetOperations=m.hasFeatureSetOperations(this.syntaxTree));return x},hasVariable:function(x){var A=this._traits.variables;void 0===A[x]&&(A[x]=m.hasVariable(this.syntaxTree,x));return A[x]},hasFunction:function(x){var A=this._traits.functions;void 0===A[x]&&(A[x]=m.hasFunction(this.syntaxTree,x));return A[x]},evaluate:function(x){this._compile();var A=this._attributeCache.compiledFunc;return this.async?m.executeAsyncFunction(A,x):
m.executeFunction(A,x)},_setSyntaxTree:function(x){this.syntaxTree=x;this._compiled=!1;this._traits={variables:{},functions:{}};this._createLegacyValueObjects()},_createLegacyValueObjects:function(){this._attributeDef={valueExpression:this.expression};this._attributeCache={attributeInfo:this._attributeDef,isNumeric:"number"===this.returnType,idSource:this.expression,id:this.id,hasExpr:!0,compiledFunc:null,syntaxTree:this.syntaxTree,isScaleDriven:!1,dependsOnView:this.hasVariable("$view"),dependsOnGeometry:this.hasGeometryOperations(),
isJSFunc:!1}},_compile:function(){this._compiled||(this._attributeCache.compiledFunc=this.profile.compile(this),this._compiled=!0)}});t("extend-esri")&&(E.ArcadeExpression=G);return G})},"esri/tasks/QueryTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/DeferredList ../kernel ../sniff ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(G,y,t,E,v,m,x,A,p,q,w,L,
D,H,N){var P=p("esri-pbf"),Q=y(null,{url:null,query:null,requestOptions:null,pagination:null,pageSize:null,_fetchDfd:null,_startPage:null,_result:null,constructor:function(f){this._handleSuccess=t.hitch(this,this._handleSuccess);this._handleError=t.hitch(this,this._handleError);t.mixin(this,f);null==this.pagination&&(this.pagination=!1);null==this.pageSize&&(this.pageSize=1E3)},execute:function(){var f=new v(this._canceler);this._fetchDfd=f;this._result=null;this._sendRequest();return f.promise},
_canceler:function(f){var r=f._pendingRequest;if(!f.isFulfilled()&&r&&!r.isFulfilled()){r.cancel();var z=r.results&&r.results[1]}f._pendingRequest=null;return z},_sendRequest:function(f){var r=this.query;this.pagination&&(this._startPage=r.resultOffset=null==f?0:f,r.resultRecordCount=this.pageSize);f=this.requestOptions;this._fetchDfd._pendingRequest=q({url:this.url,content:r,handleAs:"pbf"===r.f?"arraybuffer":"json",callbackParamName:"callback",timeout:f&&f.timeout},f);this._fetchDfd._pendingRequest.then(this._handleSuccess).otherwise(this._handleError)},
_handleSuccess:function(f){this.pagination?(f.exceededTransferLimit&&this._sendRequest(this._startPage+this.pageSize),this._result?this._result.features=this._result.features.concat(f.features):this._result=f,this._fetchDfd.progress(f),f.exceededTransferLimit||this._fetchDfd.resolve(this._result)):(this._fetchDfd.progress(f),this._fetchDfd.resolve(f))},_handleError:function(f){this._fetchDfd.reject(f)}}),h=y(H,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],
"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(f,r){this._handler=t.hitch(this,this._handler);this._relationshipQueryHandler=t.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=t.hitch(this,this._executeForIdsHandler);this._countHandler=t.hitch(this,this._countHandler);this._extentHandler=t.hitch(this,this._extentHandler);this.source=r&&r.source;this.gdbVersion=r&&r.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",
c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"rawExecute",c:2,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onRawExecuteComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(f,r,z,n,b){var d=
b.assembly;f=this._encode(t.mixin({},this._url.query,{f:n&&n.format||"json"},f.toJson(d&&d[0])));var g=this._handler,a=this._errorHandler;this.source&&(n={source:this.source.toJson()},f.layer=m.toJson(n));this.gdbVersion&&(f.gdbVersion=this.gdbVersion);var c="pbf"===f.f;if(c){var e;P||(e="QueryTask.execute: 'pbf' format is not supported in your browser.");if(e)return f=new v,f.addErrback(function(l){a(l,z,b.dfd)}),f.reject(Error(e)),f}e=this.requestOptions;e=q({url:this._url.path+"/query",content:f,
callbackParamName:"callback",handleAs:c?"arraybuffer":"json",timeout:e&&e.timeout},e);f=[e];c&&f.push(h.loadPBFReader());(new x(f)).then(function(l){b.dfd.isFulfilled()||(l=l[0],l[0]?g(l[1],c,r,z,b.dfd):a(l[1],z,b.dfd))});return e},rawExecute:function(f,r,z){r=r||{};f=this._encode(t.mixin({},this._url.query,{f:r.format||"json"},f.toJson(z.assembly&&z.assembly[0])));this.source&&(f.layer=m.toJson({source:this.source.toJson()}));this.gdbVersion&&(f.gdbVersion=this.gdbVersion);return(new Q({url:this._url.path+
"/query",query:f,requestOptions:this.requestOptions,pagination:r.pagination,pageSize:r.pageSize})).execute().then(null,null,function(n){z.dfd.progress(n)}).then(t.hitch(this,function(n){this._successHandler([n],"onRawExecuteComplete",null,z.dfd)})).otherwise(t.hitch(this,function(n){this._errorHandler(n,null,z.dfd)}))},executeRelationshipQuery:function(f,r,z){f=this._encode(t.mixin({},this._url.query,{f:"json"},f.toJson()));var n=this._relationshipQueryHandler,b=this._errorHandler;this.gdbVersion&&
(f.gdbVersion=this.gdbVersion);var d=new v(w._dfdCanceller),g=this.requestOptions,a=this._url.path;this.source&&void 0!==this.source.mapLayerId&&null!==this.source.mapLayerId&&a.endsWith("/dynamicLayer")&&(a=a.slice(0,-13),a=a+"/"+this.source.mapLayerId);d._pendingDfd=q({url:a+"/queryRelatedRecords",content:f,callbackParamName:"callback",timeout:g&&g.timeout,load:function(c,e){n(c,e,r,z,d)},error:function(c){b(c,z,d)}},g);return d},executeForIds:function(f,r,z,n){var b=n.assembly;f=this._encode(t.mixin({},
this._url.query,{f:"json",returnIdsOnly:!0},f.toJson(b&&b[0])));var d=this._executeForIdsHandler,g=this._errorHandler;this.source&&(b={source:this.source.toJson()},f.layer=m.toJson(b));this.gdbVersion&&(f.gdbVersion=this.gdbVersion);b=this.requestOptions;return q({url:this._url.path+"/query",content:f,callbackParamName:"callback",timeout:b&&b.timeout,load:function(a,c){d(a,c,r,z,n.dfd)},error:function(a){g(a,z,n.dfd)}},b)},executeForCount:function(f,r,z,n){var b=n.assembly;f=this._encode(t.mixin({},
this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},f.toJson(b&&b[0])));var d=this._countHandler,g=this._errorHandler;this.source&&(b={source:this.source.toJson()},f.layer=m.toJson(b));this.gdbVersion&&(f.gdbVersion=this.gdbVersion);b=this.requestOptions;return q({url:this._url.path+"/query",content:f,callbackParamName:"callback",timeout:b&&b.timeout,load:function(a,c){d(a,c,r,z,n.dfd)},error:function(a){g(a,z,n.dfd)}},b)},executeForExtent:function(f,r,z,n){var b=n.assembly;f=this._encode(t.mixin({},
this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},f.toJson(b&&b[0])));var d=this._extentHandler,g=this._errorHandler;this.source&&(b={source:this.source.toJson()},f.layer=m.toJson(b));this.gdbVersion&&(f.gdbVersion=this.gdbVersion);b=this.requestOptions;return q({url:this._url.path+"/query",content:f,callbackParamName:"callback",timeout:b&&b.timeout,load:function(a,c){d(a,c,r,z,n.dfd)},error:function(a){g(a,z,n.dfd)}},b)},_handler:function(f,r,z,n,b){try{f&&r&&(f=h.pbfDeps.optimizedFeatures.convertToFeatureSet(h.pbfDeps.pbfQueryUtils.parsePBFFeatureQuery(f)));
var d=new N(f);this._successHandler([d],"onComplete",z,b)}catch(g){this._errorHandler(g,n,b)}},_relationshipQueryHandler:function(f,r,z,n,b){try{var d=f.geometryType,g=f.spatialReference,a={};E.forEach(f.relatedRecordGroups,function(c){var e={};e.geometryType=d;e.spatialReference=g;e.features=c.relatedRecords;e=new N(e);if(null!=c.objectId)a[c.objectId]=e;else for(var l in c)c.hasOwnProperty(l)&&"relatedRecords"!==l&&(a[c[l]]=e)});this._successHandler([a],"onExecuteRelationshipQueryComplete",z,b)}catch(c){this._errorHandler(c,
n,b)}},_executeForIdsHandler:function(f,r,z,n,b){try{this._successHandler([f.objectIds],"onExecuteForIdsComplete",z,b)}catch(d){this._errorHandler(d,n,b)}},_countHandler:function(f,r,z,n,b){try{var d=f.features,g=f.objectIds;if(g)var a=g.length;else{if(d)throw Error("Unable to perform query. Please check your parameters.");a=f.count}this._successHandler([a],"onExecuteForCountComplete",z,b)}catch(c){this._errorHandler(c,n,b)}},_extentHandler:function(f,r,z,n,b){try{f.extent&&(f.extent=new L(f.extent)),
this._successHandler([f],"onExecuteForExtentComplete",z,b)}catch(d){this._errorHandler(d,n,b)}}});h.loadPBFReader=function(){var f=new v;h.pbfDeps?f.resolve():G(["./support/pbfDeps"],function(r){h.pbfDeps=r;f.isFulfilled()||f.resolve()});return f.promise};D._createWrappers(h);p("extend-esri")&&t.setObject("tasks.QueryTask",h,A);return h})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(G,y,t){G.DeferredList=function(E,v,m,x,A){var p=[];y.call(this);
var q=this;0!==E.length||v||this.resolve([0,[]]);var w=0;t.forEach(E,function(L,D){function H(N,P){p[D]=[N,P];w++;w===E.length&&q.resolve(p)}L.then(function(N){v?q.resolve([D,N]):H(!0,N)},function(N){m?q.reject(N):H(!1,N);if(x)return null;throw N;})})};G.DeferredList.prototype=new y;G.DeferredList.prototype.gatherResults=function(E){E=new G.DeferredList(E,!1,!0,!1);E.addCallback(function(v){var m=[];t.forEach(v,function(x){m.push(x[1])});return m});return E};return G.DeferredList})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),
function(G,y,t,E,v,m,x,A){G=G(A,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(p,q){p&&y.isString(p)&&(this._url=x.urlToObject(this.url=p));q&&q.requestOptions&&(this.requestOptions=q.requestOptions);this.normalization=!0;this._errorHandler=y.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var p=this._url,q=/^http:/i;this.url&&(this.url=this.url.replace(q,"https:"));p&&p.path&&(p.path=p.path.replace(q,"https:"))},
_encode:function(p,q,w){var L={},D;for(D in p)if("declaredClass"!==D){var H=p[D];var N=typeof H;if(null!==H&&void 0!==H&&"function"!==N)if(y.isArray(H)){L[D]=[];var P=H.length;for(N=0;N<P;N++)L[D][N]=this._encode(H[N])}else"object"===N?H.toJson&&(N=H.toJson(w&&w[D]),"esri.tasks.FeatureSet"===H.declaredClass&&N.spatialReference&&(N.sr=N.spatialReference,delete N.spatialReference),L[D]=q?N:t.toJson(N)):L[D]=H}return L},_successHandler:function(p,q,w,L){q&&this[q].apply(this,p);w&&w.apply(null,p);L&&
m._resDfd(L,p)},_errorHandler:function(p,q,w){this.onError(p);q&&q(p);w&&w.errback(p)},setNormalization:function(p){this.normalization=p},onError:function(){}});E("extend-esri")&&(v.Task=G);return G})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(G,y,t,E,v,m,x,A,p,q,w,L){G=G(null,{declaredClass:"esri.tasks.FeatureSet",
constructor:function(D,H){if(D){y.mixin(this,D);var N=this.features=this.features||[],P=D.spatialReference;P=this.spatialReference=w.createInstance(A.simpleConstructor,P);var Q=w.getGeometryType(D.geometryType);this.geometryType=D.geometryType;D.fields&&(this.fields=D.fields);D=w.supportsLazyUnquantization(this.geometryType);var h=w.unquantizeFunction(this.geometryType,this.transform),f=!!(H&&D&&h),r=Q&&(f?Q.accessorConstructor:Q.simpleConstructor);t.forEach(N,function(z,n){var b=w.createInstance(x.simpleConstructor),
d=z.geometry;if(Q&&d){var g=b.geometry=w.createInstance(r,f?null:d);g.setSpatialReference(d.spatialReference?w.createInstance(A.simpleConstructor,d.spatialReference):P);f&&g.setupLazyUnquantization(h,d)}b.symbol=z.symbol?L.fromJson(z.symbol):null;b.attributes=z.attributes;N[n]=b});f||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(D){var H={};this.displayFieldName&&(H.displayFieldName=this.displayFieldName);this.fields&&
(H.fields=this.fields);this.spatialReference?H.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(H.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(H.geometryType=w.getJsonType(this.features[0].geometry)),H.features=p._encodeGraphics(this.features,D));H.geometryType=H.geometryType||this.geometryType;H.exceededTransferLimit=this.exceededTransferLimit;H.transform=this.transform;return m.fixJson(H)},
_hydrate:function(){w.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(D){if(!this.geometryType)return this.transform=null,this;var H=D.translate[0],N=D.translate[1],P=D.scale[0],Q=D.scale[1],h=this.features,f=function(b,d,g){var a,c=[];var e=0;for(a=b.length;e<a;e++){var l=b[e];if(0<e){var F=d(l[0]);l=g(l[1]);if(F!==B||l!==I){c.push([F-B,l-I]);var B=F;var I=l}}else B=d(l[0]),I=g(l[1]),c.push([B,I])}return 0<c.length?c:null},r=function(b,d,g){if("esriGeometryPoint"===
b)return function(a){a.x=d(a.x);a.y=g(a.y);return a};if("esriGeometryPolyline"===b||"esriGeometryPolygon"===b)return function(a){var c;var e=a.rings||a.paths;var l=[];var F=0;for(c=e.length;F<c;F++){var B=e[F];(B=f(B,d,g))&&l.push(B)}return 0<l.length?(a.rings?a.rings=l:a.paths=l,a):null};if("esriGeometryMultipoint"===b)return function(a){var c=f(a.points,d,g);return 0<c.length?(a.points=c,a):null};if("esriGeometryEnvelope"===b)return function(a){return a}}(this.geometryType,function(b){return Math.round((b-
H)/P)},function(b){return Math.round((N-b)/Q)}),z;var n=0;for(z=h.length;n<z;n++)h[n].geometry&&(r(h[n].geometry)||h[n].setGeometry(null));this.transform=D;return this}});G.createGraphics=function(D){var H=D.geometryType,N=w.createInstance(A.simpleConstructor,D.spatialReference),P=w.getGeometryType(H).accessorConstructor,Q=w.unquantizeFunction(H,D.transform);return t.map(D.features,function(h,f){f=w.createInstance(x.simpleConstructor);var r=h.geometry;if(r){var z=f.geometry=w.createInstance(P);z.setSpatialReference(N);
z.setupLazyUnquantization(Q,r)}f.attributes=h.attributes;return f})};G.createPolygon=function(D,H,N){if(D){var P=w.createInstance(q.accessorConstructor);P.setSpatialReference(H);H=w.unquantizeFunction("esriGeometryPolygon",N);P.setupLazyUnquantization(H,D)}return P};E("extend-esri")&&y.setObject("tasks.FeatureSet",G,v);return G})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(G,y,t,E,v){G=G(null,{declaredClass:"esri.tasks.RelationshipQuery",
definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,orderByFields:null,toJson:function(){var m={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},x=this.objectIds,A=this.outFields,p=this.outSpatialReference,q=this.orderByFields;x&&(m.objectIds=x.join(","));A&&(m.outFields=A.join(","));
p&&(m.outSR=p.wkid||t.toJson(p.toJson()));q&&(m.orderByFields=q.join(","));m._ts=this._ts;return m}});E("extend-esri")&&y.setObject("tasks.RelationshipQuery",G,v);return G})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(G,y,t,E){G=G(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,
maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});t("extend-esri")&&y.setObject("tasks.StatisticDefinition",G,E);return G})},"esri/arcadeProfiles/popupProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(G,y,t,E,v,m,x,A){G=new (G(null,{declaredClass:"esri.arcadeProfiles.PopupProfile",defaults:{globals:{featureSet:["$layer","$datastore",
"$map","$aggregatedfeatures"],async:["$layer","$datastore","$map","$aggregatedfeatures"]},context:{vars:{$feature:"any",$layer:"any",$datastore:"any",$map:"any",$aggregatedfeatures:"any"}}},initialize:function(p){var q=[];A.hasGeometryOperations(p)&&q.push(x.enableGeometryOperations());(A.hasFeatureSetOperations(p)||A.hasVariables(p,this.defaults.globals.featureSet))&&q.push(x.enableFeatureSetOperations());A.isAsync(p)&&q.push(x.enableAsyncOperations());return v(q)},isAsync:function(p){p=[p];return A.hasFeatureSetOperations(p)||
A.hasVariables(p,this.defaults.globals.async)},parse:function(p){return x.createSyntaxTree(p.expression)},compile:function(p){var q=y.clone(this.defaults.context);q.useAsync=p.async;return p.syntaxTree?x.createFunction(p.syntaxTree,q):null},getEvalOptions:function(p){var q=p.expression,w=p.feature,L=p.layer,D=p.aggregatedFeaturesLayer,H=p.map;p=p.spatialReference;w=w&&q.hasVariable("$feature")?m.createFromGraphicLikeObject(w.geometry,w.attributes,L):null;var N,P;if(L){var Q={spatialReference:p};q.hasVariable("$layer")&&
(N=L.getMap()?x.createFeatureSetFromLayer(L,Q):x.createFeatureSetFromLayerUrl(L.url,Q));if(q.hasVariable("$datastore"))var h=(h=A.getServiceUrl(L.url))?x.createFeatureSetCollectionFromServiceUrl(h,Q):null;q.hasVariable("$aggregatedfeatures")&&D&&(P=D.getMap()?x.createFeatureSetFromLayer(D,Q):null)}q=H&&q.hasVariable("$map")?x.createFeatureSetCollectionFromMap(H):null;return{context:{vars:{$feature:w,$layer:N,$datastore:h,$map:q,$aggregatedfeatures:P},spatialReference:p}}}}));t("extend-esri")&&y.setObject("arcadeProfiles.popupProfile",
G,E);return G})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style ../libs/sanitizer/Sanitizer dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),function(G,y,t,E,v,m,x,A,p,q,w,L,D,H,N,P,Q,h,f,r,z,n){var b=0,d=n.widgets.popup,
g=n.widgets.templatePicker;y=y([z,P,Q],{declaredClass:"esri.dijit._PopupRenderer",_sanitizer:new H({whiteList:{span:["class"],dd:[],dl:[],dt:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],sub:[],sup:[],animate:[],animatetransform:[],circle:[],clippath:[],defs:[],ellipse:[],g:[],image:[],line:[],lineargradient:[],marker:[],mask:[],path:[],pattern:[],polygon:[],polyline:[],radialgradient:[],rect:[],stop:[],svg:[],"switch":[],symbol:[],text:[],textpath:[],tspan:[],use:[]}},!0),constructor:function(){this._nls=
E.mixin({},d)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'statusSection hidden' dojoAttachPoint\x3d'_status'\x3e\x3c/div\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this._showStatus(g.loading);this._contentDfd=this.template.getComponents(this.graphic).then(E.hitch(this,this._handleComponentsSuccess)).otherwise(E.hitch(this,this._handleComponentsError))},destroy:function(){this._contentDfd&&this._contentDfd.cancel();this._attachmentsDfd&&this._attachmentsDfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._contentDfd=this._attachmentsDfd=null;this.inherited(arguments)},
_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var a=this._mediaInfos,c=a.length,e=this.domNode,l=this._prevMedia,F=this._nextMedia;if(1<c){var B=0,I=0;v.forEach(a,function(J){"image"===J.type?B++:-1!==J.type.indexOf("chart")&&I++});B&&(q.set(this._imageCount,"innerHTML",B),m.query(".summary .image",
e).removeClass("hidden"));I&&(q.set(this._chartCount,"innerHTML",I),m.query(".summary .chart",e).removeClass("hidden"))}else m.query(".summary",e).addClass("hidden"),w.add(l,"hidden"),w.add(F,"hidden");a=this._mediaPtr;0===a?w.add(l,"hidden"):w.remove(l,"hidden");a===c-1?w.add(F,"hidden"):w.remove(F,"hidden");this._destroyFrame()},_displayMedia:function(){var a=this._mediaInfos[this._mediaPtr],c=a.title,e=a.caption,l=m.query(".mediaSection .hzLine",this.domNode)[0];q.set(this._mediaTitle,"innerHTML",
this._sanitizer.sanitize(c));w[c?"remove":"add"](this._mediaTitle,"hidden");q.set(this._mediaCaption,"innerHTML",this._sanitizer.sanitize(e));w[e?"remove":"add"](this._mediaCaption,"hidden");w[c&&e?"remove":"add"](l,"hidden");this._rid=null;if("image"===a.type)this._showImage(a);else{var F=this;c=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"];e=a.value.theme||this.chartTheme;E.isString(e)&&(e=e.replace(/\./gi,"/"),-1===e.indexOf("/")&&(e="dojox/charting/themes/"+e));e||(e="./Rainbow");
c.push(e);try{var B=this._rid=b++;G(c,function(I,J,O){B===F._rid&&(F._rid=null,F._showChart(a.type,a.value,I,J,O))})}catch(I){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(a){return(a=a&&E.trim(a).toLowerCase())&&(0===a.indexOf("mailto:")||0===a.indexOf("tel:"))},_showImage:function(a){w.add(this._mediaFrame,"image");var c=D.get(this._gallery,"height"),e=a.value,l=N.decode(e.linkURL);e=N.decode(e.sourceURL);var F;l&&(F=L.create("a",{href:l,target:this._preventNewTab(l)?
"":"_blank"},this._mediaFrame));l=a.refreshInterval?this._addURLParameter(e,"timestamp",Date.now()):e;L.create("img",{className:"esriPopupMediaImage",src:l},F||this._mediaFrame);var B=m.query(".esriPopupMediaImage",this._mediaFrame)[0];this._imageLoadHandle=t.connect(B,"onload",this,function(){this._clearImageHandles();this._imageLoaded(B,c);this._initImageRefresh(a)})},_addURLParameter:function(a,c,e){var l=-1===a.indexOf("?")?"?":"\x26";return a+l+c+"\x3d"+e},_initImageRefresh:function(a){if(a.refreshInterval){var c=
6E4*a.refreshInterval;this._imageRefreshHandle=setTimeout(E.hitch(this,function(){this._destroyFrame();this._showImage(a)}),c)}},_clearImageHandles:function(){t.disconnect(this._imageLoadHandle);this._imageLoadHandle=null;clearTimeout(this._imageRefreshHandle);this._imageRefreshHandle=null},_showChart:function(a,c,e,l,F){w.remove(this._mediaFrame,"image");e=this._chart=new e(L.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});F&&e.setTheme(F);switch(a){case "piechart":e.addPlot("default",
{type:"Pie",labels:!1});e.addSeries("Series A",c.fields);break;case "linechart":e.addPlot("default",{type:"Markers"});e.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});e.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});v.forEach(c.fields,function(B,I){B.x=I+1});e.addSeries("Series A",c.fields);break;case "columnchart":e.addPlot("default",{type:"Columns",gap:3});e.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});e.addSeries("Series A",c.fields);break;
case "barchart":e.addPlot("default",{type:"Bars",gap:3}),e.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),e.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),e.addSeries("Series A",c.fields)}this._action=new l(e);e.render()},_destroyFrame:function(){this._rid=null;this._clearImageHandles();this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);q.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,
c){var e=a.height;e<c&&D.set(a,"marginTop",Math.round((c-e)/2)+"px")},_attListHandler:function(a,c){if(a===this._attachmentsDfd){this._attachmentsDfd=null;var e="";c instanceof Error||!c||!c.length||v.forEach(c,function(l){e+="\x3cli\x3e";e+="\x3ca href\x3d'"+r.addProxy(l.url)+"' target\x3d'_blank'\x3e"+(l.name||"[No name]")+"\x3c/a\x3e";e+="\x3c/li\x3e"});q.set(this._attachmentsList,"innerHTML",e||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_createLinkIfURI:function(a,c){var e=r.getURIInfo(a);
if(e){var l=a.match(e.pattern);a=l&&l[2];l=N.decode(l[1]);L.create("a",{target:"_blank",href:l,title:l,innerHTML:this._sanitizer.sanitize(f.substitute({appName:e.appName,hierPart:a},e.label))},c)}else q.set(c,"innerHTML",this._sanitizer.sanitize(a))},_showStatus:function(a){q.set(this._status,"innerHTML",a);w.remove(this._status,"hidden");m.query(".mainSection",this.domNode).addClass("hidden")},_hideStatus:function(){q.set(this._status,"innerHTML","");w.add(this._status,"hidden");m.query(".mainSection",
this.domNode).removeClass("hidden")},_handleComponentsSuccess:function(a){if(a){this._hideStatus();var c=this.showTitle?a.title:"",e=a.description,l=a.fields,F=a.mediaInfos,B=this.domNode,I=this._nls,J=this,O=this.template,S=this.graphic;this._prevMedia.title=I.NLS_prevMedia;this._nextMedia.title=I.NLS_nextMedia;q.set(this._title,"innerHTML",this._sanitizer.sanitize(c));c||w.add(this._title,"hidden");if(!a.hasDescription&&l&&(e="",l=v.map(l,function(U){var R=L.create("tr",{vAlign:"top"});L.create("td",
{className:"attrName",innerHTML:this._sanitizer.sanitize(U[0])},R);var W=L.create("td",{className:"attrValue"},R);this._createLinkIfURI(U[1],W);return R},this),l.length)){var X=L.create("table",{className:"attrTable",cellPadding:"0px",cellSpacing:"0px"});v.forEach(l,function(U){X.appendChild(U)})}X?(this._description.appendChild(X),e=!0):q.set(this._description,"innerHTML",this._sanitizer.sanitize(e));e||w.add(this._description,"hidden");m.query("a",this._description).forEach(function(U){J._preventNewTab(U.href)?
"_blank"===U.target&&q.remove(U,"target"):q.set(U,"target","_blank")});c&&e?m.query(".mainSection .hzLine",B).removeClass("hidden"):c||e?m.query(".mainSection .hzLine",B).addClass("hidden"):m.query(".mainSection",B).addClass("hidden");if(c=this._attachmentsDfd=O.getAttachments(S))c.addBoth(E.hitch(this,this._attListHandler,c)),q.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+I.NLS_searching+"...\x3c/li\x3e"),m.query(".attachmentsSection",B).removeClass("hidden");F&&F.length&&(m.query(".mediaSection",
B).removeClass("hidden"),p.setSelectable(this._mediaFrame,!1),this._mediaInfos=F,this._mediaPtr=0,this._updateUI(),this._displayMedia());a.editSummary&&(q.set(this._editSummary,"innerHTML",this._sanitizer.sanitize(a.editSummary)),F&&F.length&&w.remove(this._mediaBreak,"hidden"),w.remove(this._editSummarySection,"hidden"));this.emit("content-update")}else this._showStatus(d.NLS_noInfo)},_handleComponentsError:function(a){a&&"cancel"===a.dojoType||(console.log("PopupRenderer: error loading template",
a),this._showStatus(d.NLS_noInfo))}});x("extend-esri")&&E.setObject("dijit._PopupRenderer",y,h);return y})},"esri/libs/sanitizer/Sanitizer":function(){!function(G,y){"object"==typeof exports&&"undefined"!=typeof module?module.exports=y():"function"==typeof define&&define.amd?define(y):(G="undefined"!=typeof globalThis?globalThis:G||self).Sanitizer=y()}(this,function(){function G(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,
animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,
"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,
"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,
"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,
"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,
"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,
"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,
"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,
"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,
rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,
"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,
"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}}function y(k){var u=k||{},C={},K;for(K in u)C[K]=u[K];(k=C).whiteList=k.whiteList||l.whiteList;k.onAttr=k.onAttr||l.onAttr;k.onIgnoreAttr=
k.onIgnoreAttr||l.onIgnoreAttr;k.safeAttrValue=k.safeAttrValue||l.safeAttrValue;this.options=k}function t(k){return k.replace(S,"\x26lt;").replace(X,"\x26gt;")}function E(k){return k.replace(U,"\x26quot;")}function v(k){return k.replace(R,'"')}function m(k){return k.replace(W,function(u,C){return"x"===C[0]||"X"===C[0]?String.fromCharCode(parseInt(C.substr(1),16)):String.fromCharCode(parseInt(C,10))})}function x(k){return k.replace(ba,":").replace(fa," ")}function A(k){for(var u="",C=0,K=k.length;C<
K;C++)u+=32>k.charCodeAt(C)?" ":k.charAt(C);return J.trim(u)}function p(k){return k=A(k=x(k=m(k=v(k))))}function q(k){return k=t(k=E(k))}function w(k,u){for(;u<k.length;u++){var C=k[u];if(" "!==C)return"\x3d"===C?u:-1}}function L(k,u){for(;0<u;u--){var C=k[u];if(" "!==C)return"\x3d"===C?u:-1}}function D(k){return'"'===k[0]&&'"'===k[k.length-1]||"'"===k[0]&&"'"===k[k.length-1]?k.substr(1,k.length-2):k}function H(k){var u=k||{},C={},K;for(K in u)C[K]=u[K];(k=C).stripIgnoreTag&&(k.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),
k.onIgnoreTag=ma.onIgnoreTagStripAll);k.whiteList=k.whiteList||ma.whiteList;k.onTag=k.onTag||ma.onTag;k.onTagAttr=k.onTagAttr||ma.onTagAttr;k.onIgnoreTag=k.onIgnoreTag||ma.onIgnoreTag;k.onIgnoreTagAttr=k.onIgnoreTagAttr||ma.onIgnoreTagAttr;k.safeAttrValue=k.safeAttrValue||ma.safeAttrValue;k.escapeHtml=k.escapeHtml||ma.escapeHtml;this.options=k;!1===k.css?this.cssFilter=!1:(k.css=k.css||{},this.cssFilter=new la(k.css))}var N,P,Q=Object.prototype,h=Function.prototype.toString,f=Q.hasOwnProperty,r=h.call(Object),
z=Q.toString,n=(N=Object.getPrototypeOf,P=Object,function(k){return N(P(k))}),b=function(k){var u;if(!(u=!k||"object"!=typeof k||"[object Object]"!=z.call(k))&&(u=!1,null!=k&&"function"!=typeof k.toString))try{u=!!(k+"")}catch(C){}if(u)return!1;k=n(k);if(null===k)return!0;k=f.call(k,"constructor")&&k.constructor;return"function"==typeof k&&k instanceof k&&h.call(k)==r},d={exports:{}},g={};Q={exports:{}};var a={},c=/javascript\s*:/gim;a.whiteList=G();a.getDefaultWhiteList=G;a.onAttr=function(k,u,C){};
a.onIgnoreAttr=function(k,u,C){};a.safeAttrValue=function(k,u){return c.test(u)?"":u};var e={indexOf:function(k,u){var C;if(Array.prototype.indexOf)return k.indexOf(u);var K=0;for(C=k.length;K<C;K++)if(k[K]===u)return K;return-1},forEach:function(k,u,C){var K;if(Array.prototype.forEach)return k.forEach(u,C);var M=0;for(K=k.length;M<K;M++)u.call(C,k[M],M,k)},trim:function(k){return String.prototype.trim?k.trim():k.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(k){return String.prototype.trimRight?
k.trimRight():k.replace(/(\s*$)/g,"")}},l=a,F=function(k,u){function C(){if(!M){var ca=e.trim(k.slice(V,aa)),da=ca.indexOf(":");if(-1!==da){var ia=e.trim(ca.slice(0,da));da=e.trim(ca.slice(da+1));ia&&(ca=u(V,T.length,ia,da,ca))&&(T+=ca+"; ")}}V=aa+1}";"!==(k=e.trimRight(k))[k.length-1]&&(k+=";");for(var K=k.length,M=!1,V=0,aa=0,T="";aa<K;aa++){var Y=k[aa];if("/"===Y&&"*"===k[aa+1]){Y=k.indexOf("*/",aa+2);if(-1===Y)break;V=(aa=Y+1)+1;M=!1}else"("===Y?M=!0:")"===Y?M=!1:";"===Y?M||C():"\n"===Y&&C()}return e.trim(T)};
y.prototype.process=function(k){if(!(k=(k=k||"").toString()))return"";var u=this.options,C=u.whiteList,K=u.onAttr,M=u.onIgnoreAttr,V=u.safeAttrValue;return F(k,function(aa,T,Y,ca,da){var ia=C[Y],ja=!1;if(!0===ia?ja=ia:"function"==typeof ia?ja=ia(ca):ia instanceof RegExp&&(ja=ia.test(ca)),!0!==ja&&(ja=!1),ca=V(Y,ca)){var na;aa={position:T,sourcePosition:aa,source:da,isWhite:ja};return ja?null==(na=K(Y,ca,aa))?Y+":"+ca:na:null==(na=M(Y,ca,aa))?void 0:na}})};!function(k,u){for(var C in(u=k.exports=function(K,
M){return(new y(M)).process(K)}).FilterCSS=y,a)u[C]=a[C]}(Q,Q.exports);var B={indexOf:function(k,u){var C;if(Array.prototype.indexOf)return k.indexOf(u);var K=0;for(C=k.length;K<C;K++)if(k[K]===u)return K;return-1},forEach:function(k,u,C){var K;if(Array.prototype.forEach)return k.forEach(u,C);var M=0;for(K=k.length;M<K;M++)u.call(C,k[M],M,k)},trim:function(k){return String.prototype.trim?k.trim():k.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(k){return(k=/\s|\n|\t/.exec(k))?k.index:-1}},I=Q.exports.getDefaultWhiteList,
J=B,O=new Q.exports.FilterCSS,S=/</g,X=/>/g,U=/"/g,R=/&quot;/g,W=/&#([a-zA-Z0-9]*);?/gim,ba=/&colon;?/gim,fa=/&newline;?/gim,Z=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,ea=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,ha=/u\s*r\s*l\s*\(.*/gi,ra=/\x3c!--[\s\S]*?--\x3e/g;g.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:"autoplay controls crossorigin loop muted preload src".split(" "),
b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],
summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:"autoplay controls crossorigin loop muted playsinline poster preload src height width".split(" ")};g.getDefaultWhiteList=function(){return{a:["target","href","title"],abbr:["title"],address:[],
area:["shape","coords","href","alt"],article:[],aside:[],audio:"autoplay controls crossorigin loop muted preload src".split(" "),b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src",
"alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:"autoplay controls crossorigin loop muted playsinline poster preload src height width".split(" ")}};
g.onTag=function(k,u,C){};g.onIgnoreTag=function(k,u,C){};g.onTagAttr=function(k,u,C){};g.onIgnoreTagAttr=function(k,u,C){};g.safeAttrValue=function(k,u,C,K){if(C=p(C),"href"===u||"src"===u){if("#"===(C=J.trim(C)))return"#";if("http://"!==C.substr(0,7)&&"https://"!==C.substr(0,8)&&"mailto:"!==C.substr(0,7)&&"tel:"!==C.substr(0,4)&&"data:image/"!==C.substr(0,11)&&"ftp://"!==C.substr(0,6)&&"./"!==C.substr(0,2)&&"../"!==C.substr(0,3)&&"#"!==C[0]&&"/"!==C[0])return""}else if("background"===u){if(Z.lastIndex=
0,Z.test(C))return""}else if("style"===u){if((ea.lastIndex=0,ea.test(C))||(ha.lastIndex=0,ha.test(C)&&(Z.lastIndex=0,Z.test(C))))return"";!1!==K&&(C=(K=K||O).process(C))}return C=q(C)};g.escapeHtml=t;g.escapeQuote=E;g.unescapeQuote=v;g.escapeHtmlEntities=m;g.escapeDangerHtml5Entities=x;g.clearNonPrintableCharacter=A;g.friendlyAttrValue=p;g.escapeAttrValue=q;g.onIgnoreTagStripAll=function(){return""};g.StripTagBody=function(k,u){"function"!=typeof u&&(u=function(){});var C=!Array.isArray(k),K=[],M=
!1;return{onIgnoreTag:function(V,aa,T){return C||-1!==J.indexOf(k,V)?T.isClosing?(K.push([!1!==M?M:T.position,T.position+10]),M=!1,"[/removed]"):(M||(M=T.position),"[removed]"):u(V,aa,T)},remove:function(V){var aa="",T=0;return J.forEach(K,function(Y){aa+=V.slice(T,Y[0]);T=Y[1]}),aa+=V.slice(T)}}};g.stripCommentTag=function(k){return k.replace(ra,"")};g.stripBlankChar=function(k){k=k.split("");return(k=k.filter(function(u){u=u.charCodeAt(0);return 127!==u&&(!(31>=u)||10===u||13===u)})).join("")};
g.cssFilter=O;g.getDefaultCSSWhiteList=I;var oa={},ta=/[^a-zA-Z0-9_:\.\-]/gim;oa.parseTag=function(k,u,C){var K="",M=0,V=!1,aa=!1,T=0,Y=k.length,ca="",da="";T=0;a:for(;T<Y;T++)if(da=k.charAt(T),!1===V)"\x3c"===da&&(V=T);else if(!1===aa)if("\x3c"===da)K+=C(k.slice(M,T)),M=V=T;else if("\x3e"===da)K+=C(k.slice(M,V)),M=da=k.slice(V,T+1),ca=B.spaceIndex(M),M=-1===ca?M.slice(1,-1):M.slice(1,ca+1),ca=("/"===(M=B.trim(M).toLowerCase()).slice(0,1)&&(M=M.slice(1)),"/"===M.slice(-1)&&(M=M.slice(0,-1)),M),K+=
u(V,K.length,ca,da,"\x3c/"===da.slice(0,2)),M=T+1,V=!1;else{if('"'===da||"'"===da){ca=1;for(var ia=k.charAt(T-ca);""===ia.trim()||"\x3d"===ia;){if("\x3d"===ia){aa=da;continue a}ia=k.charAt(T-++ca)}}}else da===aa&&(aa=!1);return M<k.length&&(K+=C(k.substr(M))),K};oa.parseAttr=function(k,u){function C(ca,da){1>(ca=(ca=B.trim(ca)).replace(ta,"").toLowerCase()).length||(ca=u(ca,da||""))&&M.push(ca)}for(var K=0,M=[],V=!1,aa=k.length,T=0;T<aa;T++){var Y=k.charAt(T);if(!1!==V||"\x3d"!==Y)if(!1===V||T!==
K||'"'!==Y&&"'"!==Y||"\x3d"!==k.charAt(T-1))/\s|\n|\t/.test(Y)&&((k=k.replace(/\s|\n|\t/g," "),!1===V)?-1===(Y=w(k,T))?(C(B.trim(k.slice(K,T))),V=!1,K=T+1):T=Y-1:-1===(Y=L(k,T-1))&&(C(V,D(B.trim(k.slice(K,T)))),V=!1,K=T+1));else{if(-1===(Y=k.indexOf(Y,T+1)))break;C(V,B.trim(k.slice(K+1,Y)));V=!1;K=(T=Y)+1}else V=k.slice(K,T),K=T+1}return K<k.length&&(!1===V?C(k.slice(K)):C(V,D(B.trim(k.slice(K))))),B.trim(M.join(" "))};var la=Q.exports.FilterCSS,ma=g,qa=oa.parseTag,wa=oa.parseAttr;H.prototype.process=
function(k){if(!(k=(k=k||"").toString()))return"";var u=this.options,C=u.whiteList,K=u.onTag,M=u.onIgnoreTag,V=u.onTagAttr,aa=u.onIgnoreTagAttr,T=u.safeAttrValue,Y=u.escapeHtml,ca=this.cssFilter;u.stripBlankChar&&(k=ma.stripBlankChar(k));u.allowCommentTag||(k=ma.stripCommentTag(k));var da=!1;u.stripIgnoreTagBody&&(da=ma.StripTagBody(u.stripIgnoreTagBody,M),M=da.onIgnoreTag);k=qa(k,function(ia,ja,na,sa,xa){ja={sourcePosition:ia,position:ja,isClosing:xa,isWhite:C.hasOwnProperty(na)};if(null!=(ia=K(na,
sa,ja)))return ia;if(ja.isWhite){if(ja.isClosing)return"\x3c/"+na+"\x3e";ia=function(ka){var pa=B.spaceIndex(ka);if(-1===pa)return{html:"",closing:"/"===ka[ka.length-2]};pa="/"===(ka=B.trim(ka.slice(pa+1,-1)))[ka.length-1];return pa&&(ka=B.trim(ka.slice(0,-1))),{html:ka,closing:pa}}(sa);var ya=C[na];ja=wa(ia.html,function(ka,pa){var ua,va=-1!==B.indexOf(ya,ka);return null==(ua=V(na,ka,pa,va))?va?(pa=T(na,ka,pa,ca))?ka+'\x3d"'+pa+'"':ka:null==(ua=aa(na,ka,pa,va))?void 0:ua:ua});sa="\x3c"+na;return ja&&
(sa+=" "+ja),ia.closing&&(sa+=" /"),sa+="\x3e"}return null==(ia=M(na,sa,ja))?Y(sa):ia},Y);return da&&(k=da.remove(k)),k};return function(k,u){function C(V,aa){return(new K(aa)).process(V)}var K=H,M;for(M in(u=k.exports=C).filterXSS=C,u.FilterXSS=K,g)u[M]=g[M];for(M in oa)u[M]=oa[M];"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=k.exports)}(d,d.exports),function(){function k(u,C){var K,M=this;this.arcgisWhiteList=
{a:["href","target","style"],abbr:["title"],img:"src width height border alt style".split(" "),video:"autoplay controls height loop muted poster preload width".split(" "),audio:["autoplay","controls","loop","muted","preload"],source:["media","src","type"],span:["style"],table:"width height cellpadding cellspacing border style".split(" "),div:["style","align"],font:["size","color","style","face"],tr:["height","valign","align","style"],td:"height width valign align colspan rowspan nowrap style".split(" "),
th:"height width valign align colspan rowspan nowrap style".split(" "),p:["style"],b:[],strong:[],i:[],em:[],u:[],br:[],li:[],ul:[],ol:[],hr:[],tbody:[]};this.allowedProtocols="http https mailto iform tel flow lfmobile arcgis-navigator arcgis-appstudio-player arcgis-survey123 arcgis-collector arcgis-workforce arcgis-explorer arcgis-trek2there mspbi comgooglemaps pdfefile pdfehttp pdfehttps boxapp boxemm awb awbs gropen radarscope".split(" ");this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(V,
aa,T,Y){return"a"===V&&"href"===aa||("img"===V||"source"===V)&&"src"===aa?M.sanitizeUrl(T):d.exports.safeAttrValue(V,aa,T,Y)}};u&&!C?K=u:u&&C?(K=Object.create(this.arcgisFilterOptions),Object.keys(u).forEach(function(V){"whiteList"===V?K.whiteList=M._extendObjectOfArrays([M.arcgisWhiteList,u.whiteList||{}]):K[V]=u[V]})):(K=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList;this.xssFilterOptions=K;this._xssFilter=new d.exports.FilterXSS(K)}return k.prototype.sanitize=function(u,
C){switch(void 0===C&&(C={}),typeof u){case "number":return isNaN(u)||!isFinite(u)?null:u;case "boolean":return u;case "string":return this._xssFilter.process(u);case "object":return this._iterateOverObject(u,C);default:if(!C.allowUndefined||void 0!==u)return null}},k.prototype.sanitizeUrl=function(u){var C=this._trim(u.substring(0,u.indexOf(":")));return"/"===u||"#"===u||"#"===u[0]||-1<this.allowedProtocols.indexOf(C.toLowerCase())?d.exports.escapeAttrValue(u):""},k.prototype.sanitizeHTMLAttribute=
function(u,C,K,M){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(u,C,K,M):d.exports.safeAttrValue(u,C,K,M)},k.prototype.validate=function(u,C){void 0===C&&(C={});C=this.sanitize(u,C);return{isValid:u===C,sanitized:C}},k.prototype._extendObjectOfArrays=function(u){var C={};return u.forEach(function(K){Object.keys(K).forEach(function(M){Array.isArray(K[M])&&Array.isArray(C[M])?C[M]=C[M].concat(K[M]):C[M]=K[M]})}),C},k.prototype._iterateOverObject=function(u,
C){var K=this;void 0===C&&(C={});try{var M=!1,V=void 0;if(Array.isArray(u))V=u.reduce(function(aa,T){var Y=K.validate(T,C);return Y.isValid?aa.concat([T]):(M=!0,aa.concat([Y.sanitized]))},[]);else{if(!b(u))return C.allowUndefined&&void 0===u?void 0:null;V=Object.keys(u).reduce(function(aa,T){var Y=u[T],ca=K.validate(Y,C);return ca.isValid?aa[T]=Y:(M=!0,aa[T]=ca.sanitized),aa},{})}return M?V:u}catch(aa){return null}},k.prototype._trim=function(u){return String.prototype.trim?u.trim():u.replace(/(^\s*)|(\s*$)/g,
"")},k}()})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(G,y,t,E,v,m,x,A,p,q,w,L,D){function H(){}function N(P){return function(Q,h,f,r){return Q&&"string"==typeof h&&Q[h]==H?Q.on(h.substring(2).toLowerCase(),x.hitch(f,r)):P.apply(t,arguments)}}G.around(t,"connect",N);m.connect&&
G.around(m,"connect",N);G=E("dijit._Widget",[w,L,D],{onClick:H,onDblClick:H,onKeyDown:H,onKeyPress:H,onKeyUp:H,onMouseDown:H,onMouseMove:H,onMouseOut:H,onMouseOver:H,onMouseLeave:H,onMouseEnter:H,onMouseUp:H,constructor:function(P){this._toConnect={};for(var Q in P)this[Q]===H&&(this._toConnect[Q.replace(/^on/,"").toLowerCase()]=P[Q],delete P[Q])},postCreate:function(){this.inherited(arguments);for(var P in this._toConnect)this.on(P,this._toConnect[P]);delete this._toConnect},on:function(P,Q){return this[this._onMap(P)]===
H?t.connect(this.domNode,P.toLowerCase(),this,Q):this.inherited(arguments)},_setFocusedAttr:function(P){this._focused=P;this._set("focused",P)},setAttribute:function(P,Q){m.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(P,Q)},attr:function(P,Q){return 2<=arguments.length||"object"===typeof P?this.set.apply(this,arguments):this.get(P)},getDescendants:function(){m.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.",
"","2.0");return this.containerNode?A("[widgetId]",this.containerNode).map(q.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});v("dijit-legacy-requires")&&p(0,function(){require(["dijit/_base"])});return G})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(G,y,t,E,v,m,x,A,p,q,w,L,D,H,N,P,Q,h,f,r,z,n,b){function d(a){return function(c){A[c?"set":"remove"](this.domNode,a,c);this._set(a,c)}}D.add("dijit-legacy-requires",!H.isAsync);D.add("dojo-bidi",!1);D("dijit-legacy-requires")&&Q(0,function(){G(["dijit/_base/manager"])});var g={};E=m("dijit._WidgetBase",[h,z],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:d("lang"),dir:"",_setDirAttr:d("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:E.blankGif||G.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var c=a.prototype,e=a._setterAttrs=[];a=a._onMap={};for(var l in c.attributeMap)e.push(l);for(l in c)/^on/.test(l)&&(a[l.substring(2).toLowerCase()]=l),/^_set[A-Z](.*)Attr$/.test(l)&&(l=l.charAt(4).toLowerCase()+
l.substr(5,l.length-9),c.attributeMap&&l in c.attributeMap||e.push(l))}},postscript:function(a,c){this.create(a,c)},create:function(a,c){this._introspect();this.srcNodeRef=x.byId(c);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,N.mixin(this,a));this.postMixInProperties();this.id||(this.id=b.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=
this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=r.body(this.ownerDocument);b.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();if((a=this.srcNodeRef)&&a.parentNode&&this.domNode!==a){a.parentNode.replaceChild(this.domNode,a);var e=!0}this.domNode.setAttribute("widgetId",this.id)}this.postCreate();e&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},c;for(c in this.params||{})a[c]=this._get(c);y.forEach(this.constructor._setterAttrs,
function(e){if(!(e in a)){var l=this._get(e);l&&this.set(e,l)}},this);for(c in a)this.set(c,a[c])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(y.map(a,function(c){return c+"Rtl"})));p.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,y.forEach(this.getChildren(),function(a){a._started||
a._destroyed||!N.isFunction(a.startup)||(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function c(e){e.destroyRecursive?e.destroyRecursive(a):e.destroy&&e.destroy(a)}this._beingDestroyed=!0;this.uninitialize();y.forEach(this._connects,N.hitch(this,"disconnect"));y.forEach(this._supportingWidgets,c);this.domNode&&y.forEach(b.findWidgets(this.domNode,this.containerNode),c);this.destroyRendering(a);
b.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);this.domNode&&(a?A.remove(this.domNode,"widgetId"):q.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||q.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){y.forEach(this.getChildren(),function(c){c.destroyRecursive&&c.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var c=this.domNode;N.isObject(a)?
L.set(c,a):c.style.cssText=c.style.cssText?c.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,c,e){e=3<=arguments.length?e:this.attributeMap[a];y.forEach(N.isArray(e)?e:[e],function(l){var F=this[l.node||l||"domNode"];switch(l.type||"attribute"){case "attribute":N.isFunction(c)&&(c=N.hitch(this,c));l=l.attribute?l.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;F.tagName?A.set(F,l,c):F.set(l,c);break;case "innerText":F.innerHTML="";F.appendChild(this.ownerDocument.createTextNode(c));
break;case "textContent":F.textContent=c;break;case "innerHTML":F.innerHTML=c;break;case "class":p.replace(F,c,this[a]);break;case "toggleClass":p.toggle(F,l.className||a,c)}},this)},get:function(a){var c=this._getAttrNames(a);return this[c.g]?this[c.g]():this._get(a)},set:function(a,c){if("object"===typeof a){for(var e in a)this.set(e,a[e]);return this}e=this._getAttrNames(a);var l=this[e.s];if(N.isFunction(l))var F=l.apply(this,Array.prototype.slice.call(arguments,1));else{l=this.focusNode&&!N.isFunction(this.focusNode)?
"focusNode":"domNode";var B=this[l]&&this[l].tagName,I;if((I=B)&&!(I=g[B])){I=this[l];var J={};for(O in I)J[O.toLowerCase()]=!0;I=g[B]=J}var O=I;e=a in this.attributeMap?this.attributeMap[a]:e.s in this?this[e.s]:O&&e.l in O&&"function"!=typeof c||/^aria-|^data-|^role$/.test(a)?l:null;null!=e&&this._attrToDom(a,c,e);this._set(a,c)}return F||this},_attrPairNames:{},_getAttrNames:function(a){var c=this._attrPairNames;if(c[a])return c[a];var e=a.replace(/^[a-z]|-[a-zA-Z]/g,function(l){return l.charAt(l.length-
1).toUpperCase()});return c[a]={n:a+"Node",s:"_set"+e+"Attr",g:"_get"+e+"Attr",l:e.toLowerCase()}},_set:function(a,c){var e=this[a];this[a]=c;!this._created||e===c||e!==e&&c!==c||(this._watchCallbacks&&this._watchCallbacks(a,e,c),this.emit("attrmodified-"+a,{detail:{prevValue:e,newValue:c}}))},_get:function(a){return this[a]},emit:function(a,c,e){c=c||{};void 0===c.bubbles&&(c.bubbles=!0);void 0===c.cancelable&&(c.cancelable=!0);c.detail||(c.detail={});c.detail.widget=this;var l,F=this["on"+a];F&&
(l=F.apply(this,e?e:[c]));this._started&&!this._beingDestroyed&&P.emit(this.domNode,a.toLowerCase(),c);return l},on:function(a,c){var e=this._onMap(a);return e?t.after(this,e,c,!0):this.own(P(this.domNode,a,c))[0]},_onMap:function(a){var c=this.constructor,e=c._onMap;if(!e){e=c._onMap={};for(var l in c.prototype)/^on/.test(l)&&(e[l.replace(/^on/,"").toLowerCase()]=l)}return e["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},
getChildren:function(){return this.containerNode?b.findWidgets(this.containerNode):[]},getParent:function(){return b.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,c,e){return this.own(v.connect(a,c,this,e))[0]},disconnect:function(a){a.remove()},subscribe:function(a,c){return this.own(f.subscribe(a,N.hitch(this,c)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():w.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&
"none"!=L.get(this.domNode,"display")},placeAt:function(a,c){var e=!a.tagName&&b.byId(a);!e||!e.addChild||c&&"number"!==typeof c?(a=e&&"domNode"in e?e.containerNode&&!/after|before|replace/.test(c||"")?e.containerNode:e.domNode:x.byId(a,this.ownerDocument),q.place(this.domNode,a,c),!this._started&&(this.getParent()||{})._started&&this.startup()):e.addChild(this,c);return this},defer:function(a,c){var e=setTimeout(N.hitch(this,function(){e&&(e=null,this._destroyed||N.hitch(this,a)())}),c||0);return{remove:function(){e&&
(clearTimeout(e),e=null);return null}}}});D("dojo-bidi")&&E.extend(n);return E})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(G,y,t){return t("dijit.Destroyable",null,{destroy:function(E){this._destroyed=!0},own:function(){var E=["destroyRecursive","destroy","remove"];G.forEach(arguments,function(v){function m(){x.remove();G.forEach(A,function(q){q.remove()})}var x=y.before(this,"destroy",function(q){v[p](q)}),A=[];if(v.then){var p="cancel";
v.then(m,m)}else G.forEach(E,function(q){"function"===typeof v[q]&&(p||(p=q),A.push(y.after(v,q,m,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(G,y,t,E,v,m){G=E("dijit._OnDijitClickMixin",null,{connect:function(x,A,p){return this.inherited(arguments,[x,"ondijitclick"==A?m:A,p])}});G.a11yclick=m;return G})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase",
"dojo/_base/declare","dojo/_base/lang"],function(G,y,t,E){E.extend(y,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return t("dijit._FocusMixin",null,{_focusManager:G})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(G,y,t,E){t(function(){y("highcontrast")&&G.add(E.body(),"dijit_a11y")});return y})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(G,y,t,E,v,m,x){v.add("highcontrast",function(){var A=x.doc.createElement("div");try{A.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(y.blankGif||G.toUrl("./resources/blank.gif"))+'");';x.body().appendChild(A);var p=E.getComputedStyle(A),q=p.backgroundImage;return p.borderTopColor==p.borderRightColor||q&&("none"==q||"url(invalid-url:)"==q)}catch(w){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
w.toString()),!1}finally{8>=v("ie")?A.outerHTML="":x.body().removeChild(A)}});m(function(){v("highcontrast")&&t.add(x.body(),"dj_a11y")});return v})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(G,y,t,E,v,m,x){m.extend(G,{waiRole:"",waiState:""});return v("dijit._Templated",[y,t],{constructor:function(){x.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(A,p){var q=this.inherited(arguments),w=p(A,"waiRole");w&&A.setAttribute("role",w);(w=p(A,"waiState"))&&E.forEach(w.split(/\s*,\s*/),function(L){-1!=L.indexOf("-")&&(L=L.split("-"),A.setAttribute("aria-"+L[0],L[1]))});return q}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(G,y,t,E,v,m,x,A){var p=y("dijit._TemplatedMixin",A,{templateString:null,
templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(q){var w=this.declaredClass,L=this;return x.substitute(q,this,function(D,H){"!"==H.charAt(0)&&(D=E.getObject(H.substr(1),!1,L));if("undefined"==typeof D)throw Error(w+" template:"+H);return null==D?"":"!"==H.charAt(0)?D:this._escapeValue(""+D)},this)},_escapeValue:function(q){return q.replace(/["'<>&]/g,function(w){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[w]})},buildRendering:function(){if(!this._rendered){this.templateString||
(this.templateString=G(this.templatePath,{sanitize:!0}));var q=p.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument);if(E.isString(q)){var w=t.toDom(this._stringRepl(q),this.ownerDocument);if(1!=w.nodeType)throw Error("Invalid template: "+q);}else w=q.cloneNode(!0);this.domNode=w}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(q){var w=this.containerNode;if(q&&w)for(;q.hasChildNodes();)w.appendChild(q.firstChild)}});
p._templateCache={};p.getCachedTemplate=function(q,w,L){var D=p._templateCache,H=q,N=D[H];if(N){try{if(!N.ownerDocument||N.ownerDocument==(L||document))return N}catch(P){}t.destroy(N)}q=x.trim(q);if(w||q.match(/\$\{([^\}]+)\}/g))return D[H]=q;w=t.toDom(q,L);if(1!=w.nodeType)throw Error("Invalid template: "+q);return D[H]=w};m("ie")&&v(window,"unload",function(){var q=p._templateCache,w;for(w in q){var L=q[w];"object"==typeof L&&t.destroy(L);delete q[w]}});return p})},"dojo/cache":function(){define(["./_base/kernel",
"./text"],function(G){return G.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(G,y,t,E,v,m,x,A,p){var q=v.delegate(A,{mouseenter:m.enter,mouseleave:m.leave,keypress:t._keypress}),w;t=E("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);
this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(L){for(var D=L;;)if(1==D.nodeType&&(this._processTemplateNode(D,function(H,N){return H.getAttribute(N)},this._attach)||this.searchContainerNode)&&D.firstChild)D=D.firstChild;else{if(D==L)break;for(;!D.nextSibling;)if(D=D.parentNode,D==L)return;D=D.nextSibling}},_processTemplateNode:function(L,D,H){var N=!0,P=this.attachScope||this,Q=D(L,"dojoAttachPoint")||D(L,"data-dojo-attach-point");if(Q)for(var h=Q.split(/\s*,\s*/);Q=
h.shift();)v.isArray(P[Q])?P[Q].push(L):P[Q]=L,N="containerNode"!=Q,this._attachPoints.push(Q);if(D=D(L,"dojoAttachEvent")||D(L,"data-dojo-attach-event"))for(Q=D.split(/\s*,\s*/),h=v.trim;D=Q.shift();)if(D){var f=null;-1!=D.indexOf(":")?(f=D.split(":"),D=h(f[0]),f=h(f[1])):D=h(D);f||(f=D);this._attachEvents.push(H(L,D,v.hitch(P,f)))}return N},_attach:function(L,D,H){D=D.replace(/^on/,"").toLowerCase();D="dijitclick"==D?w||(w=G("./a11yclick")):q[D]||D;return x(L,D,H)},_detachTemplateNodes:function(){var L=
this.attachScope||this;y.forEach(this._attachPoints,function(D){delete L[D]});this._attachPoints=[];y.forEach(this._attachEvents,function(D){D.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});v.extend(p,{dojoAttachEvent:"",dojoAttachPoint:""});return t})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(G,y,t,E,v){return t("dijit._WidgetsInTemplateMixin",
null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var m=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);v.parse(m,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(E.hitch(this,function(x){this._startupWidgets=x;for(var A=0;A<x.length;A++)this._processTemplateNode(x[A],
function(p,q){return p[q]},function(p,q,w){return q in p?p.connect(p,q,w):p.on(q,w,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(m,x,A){return x(m,"dojoType")||x(m,"data-dojo-type")?
!0:this.inherited(arguments)},startup:function(){G.forEach(this._startupWidgets,function(m){m&&!m._started&&m.startup&&m.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(G,y,t,E,v,m,x,A,p,q,w,L,D,H,N,P){function Q(n){return eval("("+n+")")}function h(n){var b=
n._nameCaseMap,d=n.prototype;if(!b||b._extendCnt<r){b=n._nameCaseMap={};for(var g in d)"_"!==g.charAt(0)&&(b[g.toLowerCase()]=g);b._extendCnt=r}return b}function f(n,b){b||(b=G);var d=b._dojoParserCtorMap||(b._dojoParserCtorMap={}),g=n.join();if(!d[g]){for(var a=[],c=0,e=n.length;c<e;c++){var l=n[c];a[a.length]=d[l]=d[l]||t.getObject(l)||~l.indexOf("/")&&b(l)}n=a.shift();d[g]=a.length?n.createSubclass?n.createSubclass(a):n.extend.apply(n,a):n}return d[g]}new Date("X");var r=0;p.after(t,"extend",function(){r++},
!0);var z={_clearCache:function(){r++;_ctorMap={}},_functionFromScript:function(n,b){var d="",g="",a=n.getAttribute(b+"args")||n.getAttribute("args");b=n.getAttribute("with");a=(a||"").split(/\s*,\s*/);b&&b.length&&E.forEach(b.split(/\s*,\s*/),function(c){d+="with("+c+"){";g+="}"});return new Function(a,d+n.innerHTML+g)},instantiate:function(n,b,d){b=b||{};d=d||{};var g=(d.scope||y._scopeName)+"Type",a="data-"+(d.scope||y._scopeName)+"-",c=a+"type",e=a+"mixins",l=[];E.forEach(n,function(F){var B=
g in b?b[g]:F.getAttribute(c)||F.getAttribute(g);if(B){var I=F.getAttribute(e);B=I?[B].concat(I.split(/\s*,\s*/)):[B];l.push({node:F,types:B})}});return this._instantiate(l,b,d)},_instantiate:function(n,b,d,g){function a(c){b._started||d.noStart||E.forEach(c,function(e){"function"!==typeof e.startup||e._started||e.startup()});return c}n=E.map(n,function(c){var e=c.ctor||f(c.types,d.contextRequire);if(!e)throw Error("Unable to resolve constructor for: '"+c.types.join()+"'");return this.construct(e,
c.node,b,d,c.scripts,c.inherited)},this);return g?q(n).then(a):a(n)},construct:function(n,b,d,g,a,c){function e(ha){X&&t.setObject(X,ha);for(O=0;O<ba.length;O++)p[ba[O].advice||"after"](ha,ba[O].method,t.hitch(ha,ba[O].func),!0);for(O=0;O<fa.length;O++)fa[O].call(ha);for(O=0;O<Z.length;O++)ha.watch(Z[O].prop,Z[O].func);for(O=0;O<ea.length;O++)N(ha,ea[O].event,ea[O].func);return ha}var l=n&&n.prototype;g=g||{};var F={};g.defaults&&t.mixin(F,g.defaults);c&&t.mixin(F,c);if(D("dom-attributes-explicit"))var B=
b.attributes;else D("dom-attributes-specified-flag")?B=E.filter(b.attributes,function(ha){return ha.specified}):(c=(/^input$|^img$/i.test(b.nodeName)?b:b.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),B=E.map(c.split(/\s+/),function(ha){var ra=ha.toLowerCase();return{name:ha,value:"LI"==b.nodeName&&"value"==ha||"enctype"==ra?b.getAttribute(ra):b.getAttributeNode(ra).value}}));var I=g.scope||y._scopeName;c="data-"+I+"-";
var J={};"dojo"!==I&&(J[c+"props"]="data-dojo-props",J[c+"type"]="data-dojo-type",J[c+"mixins"]="data-dojo-mixins",J[I+"type"]="dojotype",J[c+"id"]="data-dojo-id");var O=0,S;I=[];for(var X,U;S=B[O++];){var R=S.name,W=R.toLowerCase();S=S.value;switch(J[W]||W){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":U=S;break;case "data-dojo-id":case "jsid":X=S;break;case "data-dojo-attach-point":case "dojoattachpoint":F.dojoAttachPoint=S;break;case "data-dojo-attach-event":case "dojoattachevent":F.dojoAttachEvent=
S;break;case "class":F["class"]=b.className;break;case "style":F.style=b.style&&b.style.cssText;break;default:if(R in l||(R=h(n)[W]||R),R in l)switch(typeof l[R]){case "string":F[R]=S;break;case "number":F[R]=S.length?Number(S):NaN;break;case "boolean":F[R]="false"!=S.toLowerCase();break;case "function":""===S||-1!=S.search(/[^\w\.]+/i)?F[R]=new Function(S):F[R]=t.getObject(S,!1)||new Function(S);I.push(R);break;default:W=l[R],F[R]=W&&"length"in W?S?S.split(/\s*,\s*/):[]:W instanceof Date?""==S?new Date(""):
"now"==S?new Date:w.fromISOString(S):W instanceof A?y.baseUrl+S:Q(S)}else F[R]=S}}for(B=0;B<I.length;B++)J=I[B].toLowerCase(),b.removeAttribute(J),b[J]=null;if(U)try{U=Q.call(g.propsThis,"{"+U+"}"),t.mixin(F,U)}catch(ha){throw Error(ha.toString()+" in data-dojo-props\x3d'"+U+"'");}t.mixin(F,d);a||(a=n&&(n._noScript||l._noScript)?[]:H("\x3e script[type^\x3d'dojo/']",b));var ba=[],fa=[],Z=[],ea=[];if(a)for(O=0;O<a.length;O++)J=a[O],b.removeChild(J),d=J.getAttribute(c+"event")||J.getAttribute("event"),
g=J.getAttribute(c+"prop"),U=J.getAttribute(c+"method"),I=J.getAttribute(c+"advice"),B=J.getAttribute("type"),J=this._functionFromScript(J,c),d?"dojo/connect"==B?ba.push({method:d,func:J}):"dojo/on"==B?ea.push({event:d,func:J}):F[d]=J:"dojo/aspect"==B?ba.push({method:U,advice:I,func:J}):"dojo/watch"==B?Z.push({prop:g,func:J}):fa.push(J);n=(a=n.markupFactory||l.markupFactory)?a(F,b,n):new n(F,b);return n.then?n.then(e):e(n)},scan:function(n,b){function d(W){if(!W.inherited){W.inherited={};var ba=W.node,
fa=d(W.parent);ba={dir:ba.getAttribute("dir")||fa.dir,lang:ba.getAttribute("lang")||fa.lang,textDir:ba.getAttribute(B)||fa.textDir};for(var Z in ba)ba[Z]&&(W.inherited[Z]=ba[Z])}return W.inherited}var g=[],a=[],c={},e=(b.scope||y._scopeName)+"Type",l="data-"+(b.scope||y._scopeName)+"-",F=l+"type",B=l+"textdir";l+="mixins";var I=n.firstChild,J=b.inherited;if(!J){J=function Z(ba,fa){return ba.getAttribute&&ba.getAttribute(fa)||ba.parentNode&&Z(ba.parentNode,fa)};J={dir:J(n,"dir"),lang:J(n,"lang"),textDir:J(n,
B)};for(var O in J)J[O]||delete J[O]}O={inherited:J};for(var S,X;;)if(I)if(1!=I.nodeType)I=I.nextSibling;else if(S&&"script"==I.nodeName.toLowerCase())(J=I.getAttribute("type"))&&/^dojo\/\w/i.test(J)&&S.push(I),I=I.nextSibling;else if(X)I=I.nextSibling;else if(J=I.getAttribute(F)||I.getAttribute(e),n=I.firstChild,J||n&&(3!=n.nodeType||n.nextSibling)){X=null;if(J){var U=I.getAttribute(l);S=U?[J].concat(U.split(/\s*,\s*/)):[J];try{X=f(S,b.contextRequire)}catch(W){}X||E.forEach(S,function(W){~W.indexOf("/")&&
!c[W]&&(c[W]=!0,a[a.length]=W)});U=X&&!X.prototype._noScript?[]:null;O={types:S,ctor:X,parent:O,node:I,scripts:U};O.inherited=d(O);g.push(O)}else O={node:I,scripts:S,parent:O};S=U;X=I.stopParser||X&&X.prototype.stopParser&&!b.template;I=n}else I=I.nextSibling;else{if(!O||!O.node)break;I=O.node.nextSibling;X=!1;O=O.parent;S=O.scripts}var R=new L;a.length?(D("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+a.join(", ")),(b.contextRequire||G)(a,function(){R.resolve(E.filter(g,
function(W){if(!W.ctor)try{W.ctor=f(W.types,b.contextRequire)}catch(Z){}for(var ba=W.parent;ba&&!ba.types;)ba=ba.parent;var fa=W.ctor&&W.ctor.prototype;W.instantiateChildren=!(fa&&fa.stopParser&&!b.template);W.instantiate=!ba||ba.instantiate&&ba.instantiateChildren;return W.instantiate}))})):R.resolve(g);return R.promise},_require:function(n,b){n=Q("{"+n.innerHTML+"}");var d=[],g=[],a=new L;b=b&&b.contextRequire||G;for(var c in n)d.push(c),g.push(n[c]);b(g,function(){for(var e=0;e<d.length;e++)t.setObject(d[e],
arguments[e]);a.resolve(arguments)});return a.promise},_scanAmd:function(n,b){var d=new L,g=d.promise;d.resolve(!0);var a=this;H("script[type\x3d'dojo/require']",n).forEach(function(c){g=g.then(function(){return a._require(c,b)});c.parentNode.removeChild(c)});return g},parse:function(n,b){!n||"string"==typeof n||"nodeType"in n||(b=n,n=b.rootNode);var d=n?m.byId(n):x.body();b=b||{};var g=b.template?{template:!0}:{},a=[],c=this;n=this._scanAmd(d,b).then(function(){return c.scan(d,b)}).then(function(e){return c._instantiate(e,
g,b,!0)}).then(function(e){return a=a.concat(e)}).otherwise(function(e){console.error("dojo/parser::parse() error",e);throw e;});t.mixin(a,n);return a}};y.parser=z;v.parseOnLoad&&P(100,z,"parse");return z})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(G,y){var t={};G.setObject("dojo.date.stamp",t);t.fromISOString=function(E,v){t._isoRegExp||(t._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);
var m=t._isoRegExp.exec(E);E=null;if(m){m.shift();m[1]&&m[1]--;m[6]&&(m[6]*=1E3);v&&(v=new Date(v),y.forEach(y.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(p){return v["get"+p]()}),function(p,q){m[q]=m[q]||p}));E=new Date(m[0]||1970,m[1]||0,m[2]||1,m[3]||0,m[4]||0,m[5]||0,m[6]||0);100>m[0]&&E.setFullYear(m[0]||1970);var x=0,A=m[7]&&m[7].charAt(0);"Z"!=A&&(x=60*(m[8]||0)+(Number(m[9])||0),"-"!=A&&(x*=-1));A&&(x-=E.getTimezoneOffset());x&&E.setTime(E.getTime()+6E4*
x)}return E};t.toISOString=function(E,v){var m=function(q){return 10>q?"0"+q:q};v=v||{};var x=[],A=v.zulu?"getUTC":"get",p="";"time"!=v.selector&&(p=E[A+"FullYear"](),p=["0000".substr((p+"").length)+p,m(E[A+"Month"]()+1),m(E[A+"Date"]())].join("-"));x.push(p);"date"!=v.selector&&(p=[m(E[A+"Hours"]()),m(E[A+"Minutes"]()),m(E[A+"Seconds"]())].join(":"),A=E[A+"Milliseconds"](),v.milliseconds&&(p+="."+(100>A?"0":"")+m(A)),v.zulu?p+="Z":"time"!=v.selector&&(E=E.getTimezoneOffset(),v=Math.abs(E),p+=(0<
E?"-":"+")+m(Math.floor(v/60))+":"+m(v%60)),x.push(p));return x.join("T")};return t})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(G,y,t,E,v,m){return G([m,v],{_onMap:function(x){var A=this.constructor._onMap;A&&A.FINAL||(delete this.constructor._onMap,A=this.registerConnectEvents(),A.FINAL=!0);x=x.toLowerCase();if(A[x])var p=this[A[x].method];else x=this._onCamelCase(x),this[x]&&(p=x);return p},
on:function(x,A){var p=this._onMap(x),q=x.replace(/\-/g,""),w="on"+q in this.domNode;return p||!w?this.inherited(arguments):this.own(E(this.domNode,q,A))[0]},emit:function(x,A,p){var q,w=x.toLowerCase(),L=this.constructor._onMap||this.registerConnectEvents();var D=this[this._onMap(w)];A=A||{};A.target||(A.target=this);if(D&&L&&L[w]){this._onObj2Arr(function(){q=Array.prototype.slice.call(arguments)},L[w].argKeys)(A);var H=y.mixin({},arguments);H[2]=q;H[0]=L[w].name.replace(/^on/,"")}return this.inherited(H||
arguments)}})})},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","../kernel"],function(G,y,t,E,v){G=G(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],queryable:!1,showPopup:!1,constructor:function(m){m&&(this.name=m.name,this.title=m.title,this.description=m.description,this.extent=m.extent,this.legendURL=m.legendURL,this.subLayers=
m.subLayers?m.subLayers:[],this.allExtents=m.allExtents?m.allExtents:[],this.spatialReferences=m.spatialReferences?m.spatialReferences:[],this.queryable=!!m.queryable,this.showPopup=!!m.showPopup)},clone:function(){var m={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL};this.extent&&(m.extent=this.extent.getExtent());m.subLayers=[];t.forEach(this.subLayers,function(A){m.subLayers.push(A.clone())});m.allExtents=[];for(x in this.allExtents){var x=parseInt(x,10);
isNaN(x)||(m.allExtents[x]=this.allExtents[x].getExtent())}m.spatialReferences=[];t.forEach(this.spatialReferences,function(A){m.spatialReferences.push(A)});m.queryable=this.queryable;m.showPopup=this.showPopup;return m}});E("extend-esri")&&y.setObject("layers.WMSLayerInfo",G,v);return G})},"*noref":1}});
define("esri/layers/WMSLayer","require dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff ../config ../graphic ../kernel ../request ../urlUtils ../dijit/PopupTemplate ../SpatialReference ../geometry/Extent ../geometry/Point ./DynamicMapServiceLayer ./WMSLayerInfo dojo/query".split(" "),function(G,y,t,E,v,m,x,A,p,q,w,L,D,H,N,P,Q){t=t([P],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,
2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,
27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],version:null,constructor:function(h,f){var r=w.urlToObject(h);r.query&&(r.query.version||r.query.Version||r.query.VERSION)&&(this.version=r.query.version||r.query.Version||r.query.VERSION);this.url=h=this._stripParameters(h,"version service request bbox format height width layers srs crs styles transparent bgcolor exceptions time elevation sld wfs".split(" "));
this._url=w.urlToObject(h);this._getCapabilitiesURL=h;this._initLayer=E.hitch(this,this._initLayer);this._parseCapabilities=E.hitch(this,this._parseCapabilities);this._getCapabilitiesError=E.hitch(this,this._getCapabilitiesError);f?(this.customParameters=f.customParameters,this.customLayerParameters=f.customLayerParameters,this.imageFormat=this._getImageFormat(f.format),this.imageTransparency=!1!==f.transparent,this.visibleLayers=f.visibleLayers?f.visibleLayers:[],this.version=f.version||this.version,
f.resourceInfo?this._readResourceInfo(f.resourceInfo):this._getCapabilities()):(this.imageFormat="image/png",this.imageTransparency=!0,this.visibleLayers=[],this._getCapabilities());this._blankImageURL=G.toUrl("../images/pixel.png");this.extentProcessor=this._createExtentProcessor(0);this._createChildLayer()},setVisibleLayers:function(h){this.visibleLayers=(h=this._checkVisibleLayersList(h))?h:[];this.refresh(!0)},setImageFormat:function(h){this.imageFormat=this._getImageFormat(h);this.refresh(!0)},
setImageTransparency:function(h){this.imageTransparency=h;this.refresh(!0)},setCustomParameters:function(h,f){this.customParameters=h;this.customLayerParameters=f;this.refresh(!0)},refresh:function(){this._refreshTS=Date.now();this.inherited(arguments);this._childLayer&&this._childLayer.refresh.apply(this._childLayer,arguments)},getImageUrl:function(h,f,r,z){if(this.visibleLayers&&0!==this.visibleLayers.length){h=this._getImageParams(h,f,r);h=this._mixinCustomLayerParameters(h);f=this.getMapURL;var n;
f+=-1===f.indexOf("?")?"?":"";for(n in h)h.hasOwnProperty(n)&&(f+="?"===f.substring(f.length-1,f.length)?"":"\x26",f+=n+"\x3d"+h[n]);f=this.addTimestampToURL(f);z(w.addProxy(f))}else z(this._blankImageURL)},_setMap:function(h,f,r){var z=this.inherited(arguments);h.wrapAround180?this._childLayer&&(this.suspended&&this._childLayer.suspend(),this._childLayer._setMap(h,z)):this._childLayer=this.extentProcessor=null;return z},_unsetMap:function(h,f){this._childLayer&&this._childLayer._unsetMap(h,this._div);
this.inherited(arguments)},onSuspend:function(){this.inherited(arguments);this._childLayer&&this._childLayer.suspend()},onResume:function(){this.inherited(arguments);this._childLayer&&this._childLayer.resume()},_createChildLayer:function(){this._childLayer=new P(null,{extentProcessor:this._createExtentProcessor(1)});this._childLayer._isChildLayer=!0;this._childLayer.getImageUrl=E.hitch(this,this.getImageUrl);this._childLayer.loaded=!0},_createExtentProcessor:function(h){return E.hitch(this,this._extentProcessor,
h)},_extentProcessor:function(h,f){var r=f.extent,z=f.width,n=0;if(r){f=r.getWidth()/z;var b=r.bisect();r=b.extents;var d=r[h];d&&(z=b.marginLeft/f,n=0===h?z:z+r[0].getWidth()/f,z=Math.ceil(d.getWidth()/f),n=Math.ceil(n));r=d}return{extent:r,width:z,marginLeft:n}},_getImageParams:function(h,f,r){var z=h.spatialReference.wkid;-1===v.indexOf(this.spatialReferences,z)&&h.spatialReference.latestWkid&&(z=h.spatialReference.latestWkid);if(v.some(this._WEB_MERCATOR,function(a){return a==z})){var n=v.filter(this.spatialReferences,
function(a){return v.some(this._WEB_MERCATOR,function(c){return c==a})},this);0===n.length&&(n=v.filter(this.spatialReferences,function(a){return v.some(this._WORLD_MERCATOR,function(c){return c==a})},this));z=0<n.length?n[0]:this._WEB_MERCATOR[1]}this.spatialReferences=v.filter(this.spatialReferences,function(a){return a!==z});this.spatialReferences.unshift(z);n=h.xmin;var b=h.xmax,d=h.ymin;h=h.ymax;var g={SERVICE:"WMS",REQUEST:"GetMap"};g.FORMAT=this.imageFormat;g.TRANSPARENT=this.imageTransparency?
"TRUE":"FALSE";g.STYLES="";g.VERSION=this.version;g.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;g.WIDTH=f;g.HEIGHT=r;this.maxWidth<f&&(g.WIDTH=this.maxWidth);this.maxHeight<r&&(g.HEIGHT=this.maxHeight);f=z?z:NaN;isNaN(f)||("1.3.0"==this.version?g.CRS="EPSG:"+f:g.SRS="EPSG:"+f);"1.3.0"==this.version&&this._useLatLong(f)?g.BBOX=d+","+n+","+h+","+b:g.BBOX=n+","+d+","+b+","+h;return g},_initLayer:function(h,f){this.spatialReference=new D(this.extent.spatialReference);this.initialExtent=
new H(this.extent);this.fullExtent=new H(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);var r=E.hitch(this,function(){this.loaded=!0;this.onLoad(this);var z=this._loadCallback;z&&(delete this._loadCallback,z(this))});m("chrome")?(h=x.defaults.io,f="with-credentials"===h.useCors?w.canUseXhr(this.getMapURL,!0):-1,(h=-1<f?h.corsEnabledServers[f]:null)&&h.withCredentials?q({url:this.getMapURL,handleAs:"text",content:{SERVICE:"WMS",REQUEST:"GetMap"}}).addBoth(function(){r()}):
r()):r()},_readResourceInfo:function(h){h.extent?h.layerInfos?(this.extent=h.extent,this.allExtents[0]=h.extent,this.layerInfos=h.layerInfos,this.description=h.description?h.description:"",this.copyright=h.copyright?h.copyright:"",this.title=h.title?h.title:"",this.getMapURL=h.getMapURL?h.getMapURL:this._getCapabilitiesURL,this.getFeatureInfoURL=h.getFeatureInfoURL,this.featureInfoFormat=h.featureInfoFormat,this.version=h.version?h.version:"1.3.0",this.maxWidth=h.maxWidth?h.maxWidth:5E3,this.maxHeight=
h.maxHeight?h.maxHeight:5E3,this.spatialReferences=h.spatialReferences?h.spatialReferences:[],this.imageFormat=this._getImageFormat(h.format),this.setScaleRange(h.minScale,h.maxScale),this.customLayerParameters=h.customLayerParameters||this.customLayerParameters,this.customParameters=h.customParameters||this.customParameters,this._initLayer()):this._errorHandler(Error("esri.layers.WMSLayer: unable to find the 'layerInfos' property in resourceInfo")):this._errorHandler(Error("esri.layers.WMSLayer: Unable to find the 'extent' property in resourceInfo."))},
_getCapabilities:function(h){var f=this._url.query?this._url.query:{};f.SERVICE="WMS";f.REQUEST="GetCapabilities";this.version&&(f.VERSION=this.version);f=this._mixinCustomParameters(f);var r=this._url.path+"?",z;for(z in f)f.hasOwnProperty(z)&&(r+="?"==r.substring(r.length-1,r.length)?"":"\x26",r+=z+"\x3d"+f[z]);q({url:r,handleAs:h||"xml",headers:{"Content-Type":null},load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:!1})},_parseCapabilities:function(h,f){if(h){if("text"===
f.handleAs){try{var r=(new DOMParser).parseFromString(h,"application/xml")}catch(c){}r&&!r.getElementsByTagName("parsererror").length||this._errorHandler(Error("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (XML Parse error.)"))}else r=h;var z=this;this.version=this._getAttributeValue("WMS_Capabilities","version",r,null);this.version||(this.version=this._getAttributeValue("WMT_MS_Capabilities","version",r,"1.3.0"));h=this._getTag("Service",r);this.title=this._getTagValue("Title",
h,"");this.title||(this.title=this._getTagValue("Name",h,""));this.copyright=this._getTagValue("AccessConstraints",h,"");this.description=this._getTagValue("Abstract",h,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",h,5E3),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",h,5E3),10);if(h=this._getTag("Layer",r)){var n=this._getLayerInfo(h),b=0,d=null;h=this._getTag("Capability",r);v.forEach(h.childNodes,function(c){"Layer"==c.nodeName&&(0===b?d=c:(1===b&&n.name&&(n.name="",n.subLayers=
[],n.subLayers.push(this._getLayerInfo(d))),n.subLayers.push(this._getLayerInfo(c))),b++)},this);if(n&&(this.layerInfos=n.subLayers,this.layerInfos&&0!==this.layerInfos.length||(this.layerInfos=[n]),this.extent=n.extent,this.extent||(n.extent=new H(this.layerInfos[0].extent.toJson()),this.extent=n.extent),this.allExtents=n.allExtents,this.allExtents&&this.allExtents.length||(n.allExtents=[],v.forEach(this.layerInfos[0].allExtents,function(c,e){c&&(n.allExtents[e]=new H(c.toJson()))}),this.allExtents=
n.allExtents),this.spatialReferences=n.spatialReferences,!this.spatialReferences.length&&0<this.layerInfos.length)){var g=function(c){var e;for(e=0;e<c.subLayers.length;e++){var l=c.subLayers[e],F=l.spatialReferences;!F.length&&l.subLayers&&0<l.subLayers.length&&(F=g(l));if(F.length)return F}return[]};for(h=0;h<this.layerInfos.length&&(f=this.layerInfos[h],this.spatialReferences=this.layerInfos[0].spatialReferences,!this.spatialReferences.length&&f.subLayers&&0<f.subLayers.length&&(this.spatialReferences=
g(f)),!this.spatialReferences.length);h++);}h=function(c){return(c=y.query("DCPType",z._getTag(c,r)))&&0<c.length&&(c=y.query("HTTP",c[0]))&&0<c.length&&(c=y.query("Get",c[0]))&&0<c.length&&(c=z._getAttributeValue("OnlineResource","xlink:href",c[0],null))?(c.indexOf("\x26")===c.length-1&&(c=c.substring(0,c.length-1)),z._stripParameters(c,["service","request"])):null};f=function(c){var e=[];0===y.query("Operation",r).length?v.forEach(y.query("Format",z._getTag(c,r)),function(l){e.push(l.text?l.text:
l.textContent)}):(v.forEach(y.query("Operation",r),function(l){l.getAttribute("name")===c&&v.forEach(y.query("Format",l),function(F){e.push(F.text?F.text:F.textContent)})}),e.length||v.forEach(y.query("Format",z._getTag(c,r)),function(l){e.push(l.text?l.text:l.textContent)}));return e};this.getMapURL=h("GetMap")||this._getCapabilitiesURL;this.getMapFormats=f("GetMap");this.getMapFormats.length&&!v.some(this.getMapFormats,function(c){return-1<c.indexOf(this.imageFormat)},this)&&(this.imageFormat=this.getMapFormats[0]);
if(this.getFeatureInfoURL=h("GetFeatureInfo"))this.getFeatureInfoFormats=f("GetFeatureInfo"),-1<v.indexOf(this.getFeatureInfoFormats,"text/html")?this.featureInfoFormat="text/html":-1<v.indexOf(this.getFeatureInfoFormats,"text/plain")&&(this.featureInfoFormat="text/plain");if(!this.featureInfoFormat){var a=function(c){if(c&&(c.queryable=!1,c.subLayers))for(var e=0;e<c.subLayers.length;e++)a(c.subLayers[e])};a(n)}this._initLayer()}else this._errorHandler(Error("esri.layers.WMSLayer: Response does not contain any layers."))}else"xml"===
f.handleAs?this._getCapabilities("text"):this._errorHandler(Error("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)"))},_getCapabilitiesError:function(h){h&&h.message&&(h.message="GetCapabilities request for "+this._getCapabilitiesURL+" failed. ("+h.message+")");this._errorHandler(h)},_getLayerInfo:function(h){if(!h)return null;var f=new Q;f.name="";f.title="";f.description="";f.allExtents=[];f.spatialReferences=[];f.queryable="1"===h.getAttribute("queryable");
f.subLayers=[];var r=this._getTag("LatLonBoundingBox",h);r&&(f.allExtents[0]=this._getExtent(r,4326));var z=this._getTag("EX_GeographicBoundingBox",h);if(z){var n=new H(0,0,0,0,new D({wkid:4326}));n.xmin=parseFloat(this._getTagValue("westBoundLongitude",z,0));n.ymin=parseFloat(this._getTagValue("southBoundLatitude",z,0));n.xmax=parseFloat(this._getTagValue("eastBoundLongitude",z,0));n.ymax=parseFloat(this._getTagValue("northBoundLatitude",z,0));f.allExtents[0]=n}r||z||(n=new H(-180,-90,180,90,new D({wkid:4326})),
f.allExtents[0]=n);f.extent=f.allExtents[0];var b=-1<v.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)?"SRS":"CRS";v.forEach(h.childNodes,function(d){if("Name"==d.nodeName)f.name=(d.text?d.text:d.textContent)||"";else if("Title"==d.nodeName)f.title=(d.text?d.text:d.textContent)||"";else if("Abstract"==d.nodeName)f.description=(d.text?d.text:d.textContent)||"";else if("BoundingBox"==d.nodeName){var g=d.getAttribute(b);g&&0===g.indexOf("EPSG:")?(g=parseInt(g.substring(5),10),0===g||isNaN(g)||(d="1.3.0"==
this.version?this._getExtent(d,g,this._useLatLong(g)):this._getExtent(d,g),f.allExtents[g]=d,f.extent||(f.extent=d))):g&&0===g.indexOf("CRS:")?(g=parseInt(g.substring(4),10),0===g||isNaN(g)||(this._CRS_TO_EPSG[g]&&(g=this._CRS_TO_EPSG[g]),f.allExtents[g]=this._getExtent(d,g))):(g=parseInt(g,10),0===g||isNaN(g)||(f.allExtents[g]=this._getExtent(d,g)))}else if(d.nodeName==b)d=(d.text?d.text:d.textContent).split(" "),v.forEach(d,function(a){a=-1<a.indexOf(":")?parseInt(a.split(":")[1],10):parseInt(a,
10);0===a||isNaN(a)||(this._CRS_TO_EPSG[a]&&(a=this._CRS_TO_EPSG[a]),-1==v.indexOf(f.spatialReferences,a)&&f.spatialReferences.push(a))},this);else if("Style"!=d.nodeName||f.legendURL)"Layer"===d.nodeName&&f.subLayers.push(this._getLayerInfo(d));else if(d=this._getTag("LegendURL",d))if(d=this._getTag("OnlineResource",d))f.legendURL=d.getAttribute("xlink:href")},this);f.title=f.title||f.name;return f},_getImageFormat:function(h){switch(h?h.toLowerCase():""){case "jpg":return"image/jpeg";case "bmp":return"image/bmp";
case "gif":return"image/gif";case "svg":return"image/svg+xml";default:return"image/png"}},getImageFormat:function(){switch(this.imageFormat?this.imageFormat.toLowerCase():""){case "image/jpeg":return"jpg";case "image/bmp":return"bmp";case "image/gif":return"gif";case "image/svg+xml":return"svg";default:return"png"}},_getExtent:function(h,f,r){if(h){var z=new H;var n=parseFloat(h.getAttribute("minx")),b=parseFloat(h.getAttribute("miny")),d=parseFloat(h.getAttribute("maxx"));h=parseFloat(h.getAttribute("maxy"));
r?(z.xmin=isNaN(b)?-1*Number.MAX_VALUE:b,z.ymin=isNaN(n)?-1*Number.MAX_VALUE:n,z.xmax=isNaN(h)?Number.MAX_VALUE:h,z.ymax=isNaN(d)?Number.MAX_VALUE:d):(z.xmin=isNaN(n)?-1*Number.MAX_VALUE:n,z.ymin=isNaN(b)?-1*Number.MAX_VALUE:b,z.xmax=isNaN(d)?Number.MAX_VALUE:d,z.ymax=isNaN(h)?Number.MAX_VALUE:h);z.spatialReference=new D({wkid:f})}return z},_useLatLong:function(h){var f;for(f=0;f<this._REVERSED_LAT_LONG_RANGES.length;f++){var r=this._REVERSED_LAT_LONG_RANGES[f];if(h>=r[0]&&h<=r[1]){var z=!0;break}}return z},
_getTag:function(h,f){return(h=y.query(h,f))&&0<h.length?h[0]:null},_getTagValue:function(h,f,r){return(h=y.query(h,f))&&0<h.length?h[0].text?h[0].text:h[0].textContent:r},_getAttributeValue:function(h,f,r,z){return(h=y.query(h,r))&&0<h.length?h[0].getAttribute(f):z},_checkVisibleLayersList:function(h){if(h&&0<h.length&&this.layerInfos&&0<this.layerInfos.length&&"number"==typeof h[0]){var f=[];v.forEach(h,function(r){r<this.layerInfos.length&&f.push(this.layerInfos[r].name)},this);h=f}return h},_stripParameters:function(h,
f){h=w.urlToObject(h);var r,z=[];for(r in h.query)h.query.hasOwnProperty(r)&&-1===v.indexOf(f,r.toLowerCase())&&z.push(r+"\x3d"+h.query[r]);return h.path+(z.length?"?"+z.join("\x26"):"")},_getPopupGraphic:function(h,f){var r=this.visibleLayers;if(!r||0===r.length)return null;var z=this._popupGraphic;z||(z=new L({title:this.title||""}),z.setContent(function(a){var c=document.createElement("div");if(a=a&&a.attributes&&a.attributes.QUERY_URL)c.style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;",
c.innerHTML='\x3ciframe sandbox src\x3d"'+a+'" width\x3d"250" height\x3d"147" frameborder\x3d"0" marginwidth\x3d"0" marginheight\x3d"0" style\x3d"position:absolute;top:0;left:0;width:100%;height:100%;border:0;background:url(\''+G.toUrl("../dijit/images/loading-throb.gif")+"') transparent center no-repeat;\" onload\x3d\"(event.target || event.srcElement).style.background \x3d 'none';\"\x3e\x3c/iframe\x3e";return c}),z=this._popupGraphic=new A(null,null,{},z),z._layer=this);var n=function(a){var c=
[];if(a&&(a.queryable&&a.showPopup&&a.name&&c.push(a.name),a.subLayers))for(var e=0;e<a.subLayers.length;e++){var l=n(a.subLayers[e]);l.length&&(c=c.concat(l))}return c},b=n({subLayers:this.layerInfos});b=v.filter(b,function(a){return-1<v.indexOf(r,a)});if(b.length){var d=this.getFeatureInfoURL;h=this._getImageParams(h.extent,h.width,h.height);h=this._mixinCustomLayerParameters(h);h.REQUEST="GetFeatureInfo";h.INFO_FORMAT=this.featureInfoFormat;h.QUERY_LAYERS=b.join();h.FEATURE_COUNT=25;"1.3.0"===
this.version?(h.I=Math.round(f.x),h.J=Math.round(f.y)):(h.X=Math.round(f.x),h.Y=Math.round(f.y));d+=-1===d.indexOf("?")?"?":"";for(var g in h)h.hasOwnProperty(g)&&(d+="?"===d.substring(d.length-1,d.length)?"":"\x26",d+=g+"\x3d"+h[g]);z.attributes.QUERY_URL=d;return z}return null},_mixinCustomParameters:function(h){if(this.customParameters)for(var f in this.customParameters)h[f]=encodeURIComponent(this.customParameters[f]);return h},_mixinCustomLayerParameters:function(h){if(this.customLayerParameters||
this.customParameters){var f=E.clone(this.customParameters||{});E.mixin(f,this.customLayerParameters||{});for(var r in f)"styles"===r.toLowerCase()&&delete h.STYLES,h[r]=encodeURIComponent(f[r])}return h}});m("extend-esri")&&E.setObject("layers.WMSLayer",t,p);return t});