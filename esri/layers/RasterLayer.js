// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/BaseRasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojox/gfx/matrix ../kernel ../config ../lang ../domUtils ../geometry/Point ./layer".split(" "),function(L,A,J,d,b,c,e,h,g,n,k,l,q,u){var r=n.defaults.map.zoomDuration;return L([u],{declaredClass:"esri.layers.BaseRasterLayer",managedSuspension:!0,opacity:1,constructor:function(p,m){this.drawMode=m&&void 0!==m.drawMode?m.drawMode:
!0;this.drawType=m&&m.drawType?m.drawType:"2d";this.pixelData=null;this._initialize(p,m)},setDrawMode:function(p){this.drawMode=p},setOpacity:function(p){this.opacity!==p&&(this.opacity=p,this.onOpacityChange(p))},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>b("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(){this._canDraw()&&"2d"===this.drawType&&
this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();if("css-transforms"===this._map.navigationMode){var p=this._map.__visibleDelta;this._left=this._tdx=p.x;this._top=this._tdy=p.y;e.set(this._div,g._css.names.transform,g._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(A.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),
0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getCurrentResolution:function(){var p=this._map.extent;return new q((p.xmax-p.xmin)/this._map.width,(p.ymax-p.ymin)/this._map.height,p.spatialReference)},setPixelFilter:function(p,m){this.pixelFilter=p;m||this.redraw()},_toggleTime:function(){},_setMap:function(p,m){this.inherited(arguments);
this._dragOrigin={x:0,y:0};var y=this._div=c.create("div",null,m),B={width:p.width+"px",height:p.height+"px",position:"absolute"};"css-transforms"===p.navigationMode?(B[g._css.names.transform]=g._css.translate(p.__visibleDelta.x,p.__visibleDelta.y),this._left=p.__visibleDelta.x,this._top=p.__visibleDelta.y):this._left=this._top=0;e.set(y,B);this._canvas=c.create("canvas",{id:"canvas",width:p.width+"px",height:p.height+"px",style:"position: absolute;"},y);k.isDefined(this.opacity)&&e.set(y,"opacity",
this.opacity);(this._context=this._canvas.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=p.width;this._mapHeight=p.height;this._connects=[];this._connects.push(J.connect(p,"onPan",this,this._panHandler));this._connects.push(J.connect(p,"onPanEnd",this,this._panEndHandler));"css-transforms"===p.navigationMode?this._connects.push(J.connect(p,"onScale",this,this._onScaleHandler)):(this._connects.push(J.connect(p,
"onZoom",this,this._onZoomHandler)),this._connects.push(J.connect(p,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(J.connect(p,"onResize",this,this._onResizeHandler));this._connects.push(J.connect(p,"onExtentChange",this,this._extentChangeHandler));this._connects.push(J.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(J.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:p.width,height:p.height};
this.evaluateSuspension();if(this.suspended&&!p.loaded)var F=J.connect(p,"onLoad",this,function(){J.disconnect(F);F=null;this.evaluateSuspension()});return y},_unsetMap:function(p,m){d.forEach(this._connects,J.disconnect,this);var y=this._div;y&&(m.removeChild(y),c.destroy(y));this.updating&&p._jobs&&p._jobs--;this._rasterReadPromise&&this._rasterReadPromise.cancel();this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},
_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(p){"CancelError"!==p.name&&(this.clear(),this.onError(p))},_drawPixelData:function(){if(this._map){this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};var p=this._useBrowserDecoding();!p&&this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,e.set(this._div,g._css.names.transform,g._css.translate(this._left,
this._top)),e.set(this._canvas,g._css.names.transform,g._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});if(this._canDraw&&this.drawMode)if(p)this._fireUpdateEnd();else if(this.drawMode)if(this.pixelData&&this.pixelData.pixelBlock){p=this.pixelData.pixelBlock;var m=this._context,y=m.createImageData(p.width,p.height);y.data.set(p.getAsRGBA());var B=this.pixelData.extent,F=this._map.extent,N=this.getCurrentResolution(),M=0,I=0;Math.abs(B.xmin-F.xmin)>N.x&&(M=Math.round((B.xmin-F.xmin)/
N.x));Math.abs(F.ymax-B.ymax)>N.y&&(I=Math.round((F.ymax-B.ymax)/N.y));this.clear();"css-transforms"===this._map.navigationMode?(this._tdx=this._left,this._tdy=this._top,this._multiply=null,e.set(this._div,g._css.names.transform,g._css.translate(this._left,this._top)),e.set(this._canvas,g._css.names.transform,g._css.translate(-this._left,-this._top))):(e.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),e.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+
"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};m.putImageData(y,M,I,0,0,p.width,p.height);this._fireUpdateEnd()}else this.clear()}},_panHandler:function(p,m){"css-transforms"===this._map.navigationMode?(this._left=this._map.__visibleDelta.x+m.x,this._top=this._map.__visibleDelta.y+m.y,e.set(this._div,g._css.names.transform,g._css.translate(this._left,this._top))):e.set(this._div,{left:this._startRect.left+m.x+"px",top:this._startRect.top+m.y+"px"})},_panEndHandler:function(p,m){m&&
(this._startRect.left+=m.x,this._startRect.top+=m.y)},_onScaleHandler:function(p,m){var y={},B=g._css.names;e.set(this._canvas,B.transition,m?"none":B.transformName+" "+r+"ms ease");this._matrix=p;p=this._multiply?h.multiply(p,this._multiply):p;if(this._tdx||this._tdy)p=h.multiply(p,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});y[B.transform]=g._css.matrix(p);e.set(this._canvas,y)},_onZoomHandler:function(p,m,y){var B=this._startRect;p=B.width*m;m*=B.height;var F=B.left-(p-B.width)*(y.x-B.left)/
B.width;y=B.top-(m-B.height)*(y.y-B.top)/B.height;e.set(this._canvas,{left:F+"px",top:y+"px",width:p+"px",height:m+"px"});this._endRect={left:F,top:y,width:p,height:m}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(p,m,y){e.set(this._div,{width:m+"px",height:y+"px"});e.set(this._canvas,{width:m+"px",height:y+"px"});this._startRect.width=this._canvas.width=m;this._startRect.height=this._canvas.height=y},_extentChangeHandler:function(p,m,y,B){this.suspended||
m&&0===m.x&&0===m.y&&!y||("css-transforms"===this._map.navigationMode&&(m&&(this._dragOrigin.x+=m.x,this._dragOrigin.y+=m.y),y||(this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,e.set(this._div,g._css.names.transform,g._css.translate(this._left,this._top))),y&&(e.set(this._canvas,g._css.names.transition,"none"),this._multiply=this._multiply?h.multiply(this._matrix,this._multiply):this._matrix)),this._fireUpdateStart(),p=this._map,this._requestData(p.extent,p.width,p.height))},
_visibilityChangeHandler:function(p){p?l.show(this._div):l.hide(this._div)},_opacityChangeHandler:function(p){e.set(this._div,"opacity",p)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query dojo/DeferredList ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ../renderers/colorRampUtils ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(L,A,J,d,b,c,e,h,g,n,k,l,q,u,r,p,m,y,B,F,N,M,I,Q,O,G,S,v,x,H,K,D){L=L(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_rasterFunctionServiceInfoProps:"bandCount pixelType hasRasterAttributeTable hasColormap hasHistograms minValues maxValues meanValues stdvValues serviceDataType".split(" "),_pixelTypeRanges:{U1:[0,1],U2:[0,3],U4:[0,15],U8:[0,255],S8:[-128,127],U16:[0,65535],S16:[-32768,32767]},_eventMap:{"rendering-change":!0,
"mosaic-rule-change":!0,"spatial-reference-change":!0,"renderer-change":!0},_cachedVariableStats:{},_cachedVariableHistogram:{},constructor:function(a,f){this.useMapTime=f&&f.hasOwnProperty("useMapTime")?!!f.useMapTime:!0},_initialize:function(a,f){this._url=p.urlToObject(a);this.raster=new Q(this._url.path);this._rasterFunctionTemplateInfos={};this._customRenderingRuleId={};this.infoTemplate=f&&f.infoTemplate;this.format=(a=f&&f.imageServiceParameters)&&a.format;this.compressionTolerance=a&&a.compressionTolerance?
a.compressionTolerance:.01;this.interpolation=a?a.interpolation:null;this.compressionQuality=a?a.compressionQuality:null;this.bandIds=a?a.bandIds:null;this.mosaicRule=a?a.mosaicRule:null;this.renderingRule=a?a.renderingRule:null;this.renderer=a?a.renderer:null;this.useMapDimensionValue=f&&f.hasOwnProperty("useMapDimensionValue")?!!f.useMapDimensionValue:!0;this.hasImageFilter=f&&f.hasImageFilter;this.activeMapDimensions=f&&f.activeMapDimensions;this._params=A.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,
format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},a?a.toJson():{});this.pixelFilter=f&&f.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=A.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=A.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=A.hitch(this,this._initLayer);this._queryVisibleRastersHandler=A.hitch(this,this._queryVisibleRastersHandler);
this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._renderingRuleColormap={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=f&&f.loadCallback;a&&a.renderer&&(a.renderer.outputUnit||a.renderer.inputUnit)&&(this.vectorFieldPixelFilter=new G,this.vectorFieldPixelFilter.setUnits(a.renderer.inputUnit,a.renderer.outputUnit));(f=f&&f.resourceInfo)?this._initLayer(f):u({url:this._url.path,content:A.mixin({f:"json"},
this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,f){if(null!==a&&void 0!==a){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();f=this.minScale;var t=this.maxScale;A.mixin(this,a);this.minScale=f;this.maxScale=t;this.initialExtent=this.fullExtent=this.extent=new m(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=
parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);var w=this.minValues,z=this.maxValues,E=this.meanValues,C=this.stdvValues,R=this.bands=[];f=0;for(t=this.bandCount;f<t;f++)R[f]={min:w[f],max:z[f],mean:E[f],stddev:C[f]};this.timeInfo=(f=this.timeInfo)&&f.timeExtent?new v(f):null;t=this.fields=[];if(w=a.fields)for(f=0;f<w.length;f++)t.push(new x(w[f]));this._updateInfoTemplateFields(this.fields);this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in
a||"timeInfo"in a?10:9.3);q.isDefined(a.minScale)&&!this._hasMin&&"Raster"!==a.cacheType&&this.setMinScale(a.minScale);q.isDefined(a.maxScale)&&!this._hasMax&&"Raster"!==a.cacheType&&this.setMaxScale(a.maxScale);f={};a.defaultMosaicMethod?(f.method=a.defaultMosaicMethod,f.operation=a.mosaicOperator,f.sortField=a.sortField,f.sortValue=a.sortValue):f.method=N.METHOD_NONE;this.defaultMosaicRule=new N(f);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===
this.serviceDataType;this._setDefaultRenderingRule(!0);this._getRenderingRuleAttributeTableAndColormap();this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(A.hitch(this,function(P){P&&(P.features&&P.fields&&(this.rasterAttributeTable=A.clone(P)),P.features&&0<P.features.length&&(this._rasterAttributeTableFeatures=
A.clone(P.features)),P.fields&&0<P.fields.length&&(this._rasterAttributeTableFields=A.clone(P.fields)),this.renderingRule||!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh())}));this._initVectorPixelFilter();this.bandIds||2!==this.bandCount||this.renderingRule||"esri.layers.ArcGISImageServiceLayer"!==this.declaredClass||this.setBandIds([0,0,0],!0);!(10.3<=this.version&&this.rasterFunctionInfos&&
this.rasterFunctionInfos.length)||this._url.query&&this._url.query.raster||this.getRasterFunctionInfos().then(A.hitch(this,function(P){if(P&&P.length){this.rasterFunctionInfos=P;var W=[],X;d.forEach(P,function(V){if(V){var T=V.functionType;X=X||1===T||2===T;W.push(V.name)}},this);this._hasItemLevelRFT=X;this._rasterFunctionNames=W;X&&(this._initVectorPixelFilter(),this.refresh())}}));this.loaded=!0;this._setDefaultFilter();this.onLoad(this);if(a=this._loadCallback)delete this._loadCallback,a(this)}},
_updateInfoTemplateFields:function(a){if(a&&!(1>a.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var f,t;var w=this.infoTemplate.info.fieldInfos;for(f=0;f<a.length;f++){var z=a[f];for(t=0;t<w.length;t++)if(w[t].fieldName.toLowerCase()===z.name.toLowerCase()&&w[t].fieldName!==z.name){w[t].fieldName=z.name;break}}}},getKeyProperties:function(a){var f=this._url.path+"/keyProperties",t=new J(r._dfdCanceller),w={f:"json"};
a&&a.renderingRule&&(w.renderingRule=b.toJson(a.renderingRule.toJson()));10<this.version?(t._pendingDfd=u({url:f,content:w,handleAs:"json",callbackParamName:"callback"}),t._pendingDfd.then(function(z){t.callback(z)},function(z){t.errback(z)})):(a=Error("Layer does not have key properties"),a.log=!!c.isDebug,t.errback(a));return t},getRasterAttributeTable:function(a){var f=this._url.path+"/rasterAttributeTable",t=new J(r._dfdCanceller),w={f:"json"},z=this.hasRasterAttributeTable;a&&a.renderingRule&&
(w.renderingRule=b.toJson(a.renderingRule.toJson()),z=!0);!this.loaded||10<this.version&&z?(t._pendingDfd=u({url:f,content:w,handleAs:"json",callbackParamName:"callback"}),t._pendingDfd.then(function(E){t.callback(E)},function(E){t.errback(E)})):(a=Error("Layer does not support raster attribute table"),a.log=!!c.isDebug,t.errback(a));return t},getRenderingRuleAttributeTable:function(a){var f=new J(r._dfdCanceller);if(!a||!a.renderingRule)return f.errback(Error("Rendering rule is not specified")),
f;a=a.renderingRule;var t=this._getRenderingRuleId(a);this._renderingRuleAttributeTable&&t&&this._renderingRuleAttributeTable.hasOwnProperty(t)?f.resolve(this._renderingRuleAttributeTable[t]):f=this.getRasterAttributeTable({renderingRule:a}).then(A.hitch(this,function(w){if(w&&w.features&&w.features.length&&w.fields&&w.fields.length){var z={features:A.clone(w.features),fields:A.clone(w.fields)};t&&(this._renderingRuleAttributeTable[t]=z)}return z}));return f},_initVectorPixelFilter:function(){var a;
this._hasItemLevelRFT&&this.renderingRule&&(a=this._getItemLevelRenderingRule(this.renderingRule));if(a=a||this.renderingRule)return this.getRenderingRuleServiceInfo(a).then(A.hitch(this,function(f){!f||!this._isVectorData(f)&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass||q.isDefined(this.pixelFilter)||(this.vectorFieldPixelFilter=this.vectorFieldPixelFilter||new G,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===f.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,
this.getKeyProperties().then(A.hitch(this,this._setFlowRepresentation)),this._applyVectorResamplingType(f.serviceDataType))}))},_applyVectorResamplingType:function(a){if(a){var f=this.renderingRule;f&&"Resample"===f.functionName&&((f.functionArguments||{}).ResamplingType="esriImageServiceDataTypeVector-UV"===a?7:10,this.setRenderingRule(new M(f.toJson())))}},_getRasterAttributeTableFeatures:function(){var a=new J;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),
a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(A.hitch(this,function(f){f&&f.features&&0<f.features.length&&(this._rasterAttributeTableFeatures=A.clone(f.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},_getRenderingRuleAttributeTableFeatures:function(a){a=a&&a.renderingRule;return a?this.getRenderingRuleAttributeTable({renderingRule:a}).then(function(f){return f&&f.features}):(a=new J,a.errback(Error("Rendering rule is not specified")),
a)},_getRenderingRuleAttributeTableAndColormap:function(){this.renderingRule&&this.getRenderingRuleServiceInfo(this.renderingRule).then(A.hitch(this,function(a){a.hasRasterAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:this.renderingRule}).then(A.hitch(this,function(){!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh()}));a.hasColormap&&this.getRenderingRuleColormap({renderingRule:this.renderingRule}).then(A.hitch(this,
function(){this.renderer&&"esri.renderer.ColormapRenderer"===this.renderer.declaredClass&&this.refresh()}))}))},getCustomRasterFields:function(a){var f=a?a.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;a=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var t={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:a},w={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,
length:50,type:a},z={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},E=this.fields?A.clone(this.fields):[];a=E.length;E[a]=w;10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRenderingRuleAProcessingTemplate({functionName:"none"}))&&(a++,E[a]=z);if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||
this.fields&&0<this.fields.length)a++,E[a]=t;!q.isDefined(this.pixelFilter)||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(t={name:this._rasterFieldPrefix+"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},w={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},a++,E[a]=t,a++,E[a]=w);a=this._rasterAttributeTableFields;(t=this.renderingRule&&
this._getRenderingRuleId(this.renderingRule))&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(t)&&(a=this._renderingRuleAttributeTable[t].fields);a&&0<a.length&&(a=d.filter(a,function(R){return"esriFieldTypeOID"!==R.type&&"value"!==R.name.toLowerCase()}),a=d.map(a,function(R){var P=A.clone(R);P.name=f+R.name;return P}),E=E.concat(a));var C=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&d.forEach(this.rasterFunctionInfos,
function(R){R&&R.name&&"none"!==R.name.toLowerCase()&&(R={name:C+R.name.replace(/ /gi,"_"),alias:R.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},E.push(R))});return E},_applyTimeToMultidimensionalCRF:function(a,f){var t=this._isTimeSupportedOnCRF();if(t&&(!a||!a.multidimensionalDefinition))return a;var w=this.timeInfo&&this.timeInfo.startTimeField;if((f=f||this._params.time)&&w&&this._isMultidimensionalCRF()){a=A.clone(a||this.defaultMosaicRule)||new N;a.multidimensionalDefinition=a.multidimensionalDefinition||
[];var z=a.multidimensionalDefinition.filter(function(C){return C.dimensionName===w}),E=f.split(",").map(function(C){return parseInt(C,10)});2===E.length&&E[0]===E[1]&&(E.length=1);0<z.length?t?a.multidimensionalDefinition.forEach(function(C){C.dimensionName===w&&(C.dimensionName=null,C.isSlice=null,C.values=null)}):a.multidimensionalDefinition.forEach(function(C){C.dimensionName===w&&(C.isSlice=1===E.length,C.values=1===E.length?E:[E])}):t||(a.multidimensionalDefinition.some(function(C){return null!=
C.variableName&&null==C.dimensionName})?a.multidimensionalDefinition.forEach(function(C){null!=C.variableName&&null==C.dimensionName&&(C.dimensionName=w,C.isSlice=1===E.length,C.values=1===E.length?E:[E])}):a.multidimensionalDefinition.push(new I({variableName:"",dimensionName:w,isSlice:1===E.length,values:1===E.length?E:[E]})));this._cleanupMultidimensionalDefinition(a)}return a},_prepareGetImageParameters:function(a,f,t,w){w=q.isDefined(w)?w:this._params;if(this.renderer||this._hasItemLevelRFT&&
this.renderingRule){var z=this.getExportImageRenderingRule();w.renderingRule=z?b.toJson(z.toJson()):null}z=this.getExportImageMosaicRule(w);w.mosaicRule=z?b.toJson(z.toJson()):null;z=a.spatialReference.wkid||b.toJson(a.spatialReference.toJson(!1));delete w._ts;A.mixin(w,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:z,bboxSR:z,size:f+","+t},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete w.compressionTolerance;w.format&&"LERC"===w.format.toUpperCase()&&(w.compressionTolerance=
this.compressionTolerance);w.token=this._getToken()},getImageUrl:function(a,f,t,w,z){z=q.isDefined(z)?z:this._params;this._prepareGetImageParameters(a,f,t,z);a=A.clone(z);this._cleanupRequestParams(a);f=this._url.path+"/exportImage?";t=p.addProxy(f+g.objectToQuery(A.mixin(a,{f:"image"})));var E=a.token;t.length>l.defaults.io.postLength||this.useMapImage?this._jsonRequest=u({url:f,content:A.mixin(a,{f:"json"}),callbackParamName:"callback",load:function(C,R){C=C.href;E&&(C+=-1===C.indexOf("?")?"?token\x3d"+
E:"\x26token\x3d"+E);w(p.addProxy(C))},error:this._errorHandler}):w(t)},onRenderingChange:function(){},onMosaicRuleChange:function(){},onRendererChange:function(){},setInterpolation:function(a,f){this.interpolation=this._params.interpolation=a;f||this.refresh(!0)},setCompressionQuality:function(a,f){this.compressionQuality=this._params.compressionQuality=a;f||this.refresh(!0)},setCompressionTolerance:function(a,f){this.compressionTolerance=a;f||this.refresh(!0)},setBandIds:function(a,f){var t=!1;
this.bandIds!==a&&(t=!0);this.bandIds=a;this._params.bandIds=a?a.join(","):null;if(t&&!f)this.onRenderingChange();f||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,f){var t=!1;this.mosaicRule!==a&&(t=!0);this.mosaicRule=a;this._params.mosaicRule=b.toJson(a.toJson());if(t&&!f)this.onMosaicRuleChange();f||this.refresh(!0)},getRasterFunctionInfos:function(){if(10.3>
this.version||!this.rasterFunctionInfos||!this.rasterFunctionInfos.length)console.log("Layer doesn't support /rasterFunctionInfos resource.");else return u({url:this._url.path+"/rasterFunctionInfos",content:{f:"json"},handleAs:"json",load:function(a){return a&&a.rasterFunctionInfos}})},setRenderingRule:function(a,f){var t=!1;this.renderingRule!==a&&(t=!0);this.renderingRule=a;this._params.renderingRule=a?b.toJson(a.toJson()):null;this._useRenderingRuleAttributeTable?this.getRenderingRuleAttributeTable({renderingRule:a}):
"esri.layers.RasterXLayer"!==this.declaredClass&&this._getRenderingRuleAttributeTableAndColormap();if(t)this.onRenderingChange();this._setDefaultFilter();f||this.refresh(!0)},setImageFormat:function(a,f){this.format=this._params.format=a;this._setDefaultFilter();f||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=a;this._updateInfoTemplateFields(this.fields)},setDefinitionExpression:function(a,f){var t=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?
t=this.defaultMosaicRule.toJson():t.method=N.METHOD_NONE);t.where=a;a=new N(t);this.setMosaicRule(a,f);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(a){this.pixelFilter=a;this._isDefaultPixelFilter=!1},getPixelData:function(a){return a?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):
this.pixelData},getExportImageRenderingRule:function(){var a;this._hasItemLevelRFT&&this.renderingRule&&(a=this._getServiceLevelRenderingRule(this.renderingRule));a=a||this.renderingRule;this._isItemLevelRasterFunction(this.renderingRule)&&(a=void 0);return this._combineRenderingRule(this._convertRendererToRenderingRule(this.renderer),a)},getExportImageMosaicRule:function(){var a=this.mosaicRule,f;this._hasItemLevelRFT&&this.renderingRule&&(f=this._getItemLevelRenderingRule(this.renderingRule));f&&
(a=a||this.defaultMosaicRule||new N,a.itemRenderingRule=f);return a=this._applyTimeToMultidimensionalCRF(a)},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getHistograms:function(a){var f=new J(r._dfdCanceller);if(a&&this._cachedVariableHistogram[a])return f.resolve(this._cachedVariableHistogram[a]),f;if(this.hasHistograms){var t={f:"json"};a&&(t.variable=a);f._pendingDfd=u({url:this._url.path+"/histograms",content:t,handleAs:"json",callbackParamName:"callback"});
f._pendingDfd.then(A.hitch(this,function(w){a&&(this._cachedVariableHistogram[a]=w);f.callback(w)}),function(w){f.errback(w)})}else t=Error("Layer does not have histograms."),t.log=!!c.isDebug,f.errback(t);return f},computeHistograms:function(a){var f=new J(r._dfdCanceller);if(10.1<=this.currentVersion){a=a||{};var t=a.geometry||this.fullExtent,w=(a.geometry||this.fullExtent).toJson();t="extent"===t.type?"esriGeometryEnvelope":"esriGeometryPolygon";var z=a.renderingRule||this.renderingRule||this.defaultRenderingRule;
z=z?z.toJson():null;var E=a.mosaicRule||this.mosaicRule||this.defaultMosaicRule;E=E?E.toJson():null;a=a.pixelSize||{x:this.pixelSizeX,y:this.pixelSizeY};f._pendingDfd=u({url:this._url.path+"/computeHistograms",content:A.mixin({f:"json",geometry:JSON.stringify(w),geometryType:t,renderingRule:JSON.stringify(z),mosaicRule:JSON.stringify(E),pixelSize:JSON.stringify(a),callbackParamName:"callback"}),handleAs:"json"});f._pendingDfd.then(function(C){f.callback(C)},function(C){f.errback(C)})}else w=Error("Layer doesn't support computeHistograms."),
w.log=!!c.isDebug,f.errback(w);return f},getRenderingRuleServiceInfo:function(a,f){function t(E){return E.name&&E.arguments&&E.function&&E.hasOwnProperty("functionType")}var w=new r._fixDfd(new J(r._dfdCanceller));if(!a)return w.errback(Error("Rendering rule is not specified")),w;if(t(a))"ClipFunction"===a.function.type&&(a=this._handleClipFunctionInRenderingRule(a));else{var z=this._getRenderingRuleId(a);if(z&&this._rasterFunctionTemplateInfos[z])return w.resolve(this._rasterFunctionTemplateInfos[z]),
w}return u({url:this._url.path,content:A.mixin(A.mixin({f:"json",renderingRule:JSON.stringify(a.toJson())},this._url.query)),callbackParamName:"callback",load:A.hitch(this,function(E){var C={};d.forEach(this._rasterFunctionServiceInfoProps,function(R){C[R]=E[R]});t(a)||(this._rasterFunctionTemplateInfos[z]=C);return C}),error:f||this._errorHandler})},queryVisibleRasters:function(a,f,t,w){var z=this._map,E=r._fixDfd(new J(r._dfdCanceller));this._visibleRasters=[];var C,R,P=!0,W=!0,X=null,V=this.infoTemplate?
this.infoTemplate.info:null,T=V?A.clone(this.infoTemplate.info.fieldInfos):null;f=f||{};if(V&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var Y=[];d.forEach(this.infoTemplate.info.mediaInfos,function(U){Y=Y.concat(U&&U.value&&U.value.fields||[])});Y.length&&d.forEach(T,function(U){U&&-1<Y.indexOf(U.fieldName)&&(U.visible=!0)})}var ea=function(U){var ja=V&&V.title&&-1<V.title.toLowerCase().indexOf(U.toLowerCase());U=V&&V.description&&-1<V.description.toLowerCase().indexOf(U.toLowerCase());
return ja||U};if(T&&0<T.length)for(P=!1,C=0;C<T.length;C++)if((R=T[C])&&R.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(R.visible||ea(R.fieldName))){P=!0;break}this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("returnTopmostRaster")&&(X=this.infoTemplate.info.layerOptions.returnTopmostRaster?1:null);T&&0<T.length&&(W=!1,d.some(T,function(U){if(U&&U.fieldName.toLowerCase()===this._rasterFieldPrefix.toLowerCase()+
"itempixelvalue"&&U.visible)return W=!0},this),ea(this._rasterFieldPrefix.toLowerCase()+"itempixelvalue")&&(W=!0));var fa=(R=this._removeVisualizationStretchFunction(this.renderingRule))&&R.functionName,ha=[];if(10.4<=this.version){var aa=!1;if(this.rasterFunctionInfos&&T){var ia=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;d.forEach(this.rasterFunctionInfos,function(U){var ja=ia+U.name.replace(/ /gi,"_");d.some(T,function(qa){return qa.visible&&qa.fieldName===ja})&&(aa=aa||fa&&fa===
U.name,ha.push(new M({rasterFunction:U.name})))})}R&&!aa&&ha.push(R)}C=new D;C.geometry=a.geometry;C.returnGeometry=this._map.spatialReference.equals(this.spatialReference);C.returnCatalogItems=P;C.timeExtent=this.timeInfo?a.timeExtent:null;C.returnPixelValues=W;C.maxItemCount=X||a.maxItemCount;this._params.time&&this.mosaicRule?(a=A.clone(this.mosaicRule),a=this._filterOutTimeDimension(a),C.mosaicRule=a):C.mosaicRule=this.mosaicRule||null;this._isMultidimensionalCRF()&&C.timeExtent&&(C.mosaicRule=
this._applyTimeToMultidimensionalCRF(C.mosaicRule,C.timeExtent.toJson().join(",")),this._isTimeSupportedOnCRF()||delete C.timeExtent);C.renderingRule=10.4>this.version&&R||null;C.renderingRules=ha||null;10.8>this.version&&(C.returnPixelValues=void 0,C.maxItemCount=void 0);z&&(z=new y((z.extent.xmax-z.extent.xmin)/z.width,(z.extent.ymax-z.extent.ymin)/z.height,z.extent.spatialReference),C.pixelSize=z);f.requestParams=C;var Z=this;z=new K(this.url);(E._pendingDfd=z.execute(C)).addCallbacks(function(U){Z._queryVisibleRastersHandler(U,
f,t,w,E)},function(U){Z._resolve([U],null,w,E,!0)});return E},_queryVisibleRastersHandler:function(a,f,t,w,z){function E(){var ba=this.getCustomRasterFields(f),ma=this._getDomainFields(ba),ua=f?f.returnDomainValues:!1,Ba=f&&f.rasterAttributeTableFieldPrefix,ka,va,ra,wa,la,sa,Ca,xa,ya,za;ba=(ba=this._getRenderingRuleId(this.renderingRule))&&this._rasterFunctionTemplateInfos[ba];this.renderingRule&&(this._useRenderingRuleAttributeTable||ba)?(ba=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),
this.hasRasterAttributeTable||(za=C)):ba=this._getRasterAttributeTableFeatures();ba.then(A.hitch(this,function(Aa){for(ka=0;ka<Z.length;ka++){da=Z[ka];da.setInfoTemplate(this.infoTemplate);da._layer=this;if(C){ya=C.replace(/ /gi,"").split(",");va=C;ra=ya;U&&U.length>=ka&&(va=U[ka].replace(/ /gi,", "),ra=U[ka].split(" "));da.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=ra;da.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=ya;R&&(da.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=
R.replace(/ /gi,"").split(","));if(this.pixelFilter){var ta=new O({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});d.forEach(ra,function(ca){ta.addData({pixels:[ca],statistics:{minValue:ca,maxValue:ca,noDataValue:null}})});this.pixelFilter({pixelBlock:ta,extent:new m(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)da.attributes[this._rasterFieldPrefix+"Magnitude"]=ta.pixels[0][0],
da.attributes[this._rasterFieldPrefix+"Direction"]=ta.pixels[1][0]}d.forEach(T,function(ca){da.attributes[ca.name]=ca.value});var Da=0<this.fields.length?za||va:za||R;if(Aa&&0<Aa.length&&(wa=d.filter(Aa,function(ca){if(ca&&ca.attributes)return ca.attributes.hasOwnProperty("Value")?ca.attributes.Value==Da:ca.attributes.VALUE==Da}),0<wa.length&&(la=A.clone(wa[0]),Ba&&la))){xa={};for(sa in la.attributes)la.attributes.hasOwnProperty(sa)&&(Ca=Ba+sa,xa[Ca]=la.attributes[sa]);la.attributes=xa;da.attributes=
A.mixin(da.attributes,la.attributes)}}ua&&ma&&0<ma.length&&d.forEach(ma,function(ca){if(ca){var na=da.attributes[ca.name];q.isDefined(na)&&(na=this._getDomainValue(ca.domain,na),q.isDefined(na)&&(da.attributes[ca.name]=na))}},this);oa.push(da);this._visibleRasters.push(da)}this._resolve([oa,null,!0],null,t,z)}))}var C=a.value,R=a.value,P=0,W=0,X=this,V=this.objectIdField,T=[];w=f.requestParams.renderingRules;var Y=a.processedValues,ea=this.renderingRule&&b.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());
if(w&&Y&&w.length===Y.length){var fa=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;d.forEach(w,function(ba,ma){if(ba.functionName){var ua={name:fa+ba.functionName.replace(/ /gi,"_"),value:Y[ma].replace(/ /gi,"").split(",")};T.push(ua);ea&&ea===b.toJson(ba.toJson())&&(C=Y[ma])}})}w=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;
if(a.catalogItems){var ha=0,aa=a.catalogItems.features.length;var ia=0;var Z=Array(aa);var U=Array(aa);var ja=Array(aa);if(a.properties&&a.properties.Values){aa=a.properties.Values.length;for(P=0;P<aa;P++)-1<a.properties.Values[P].toLowerCase().indexOf("nodata")&&ia++;var qa=aa-ia;for(P=0;P<aa;P++){ia=!0;if(-1<a.properties.Values[P].toLowerCase().indexOf("nodata")){var pa=qa++;w||(ia=!1,Z.length--,U.length--,ja.length--)}else pa=ha++;ia&&(Z[pa]=a.catalogItems.features[P],U[pa]=a.properties.Values[P],
ja[pa]=Z[pa].attributes[V])}}else{for(P=0;P<aa;P++)Z[P]=a.catalogItems.features[P],ja[P]=Z[P].attributes[V];U=null}}this._visibleRasters=[];(a=-1<C.toLowerCase().indexOf("nodata"))&&!w&&(Z=[],U=[],ja=[]);if(C&&!Z&&!a){V="ObjectId";Z=[];var da=new H(new m(this.fullExtent),null,{ObjectId:0});Z.push(da)}var oa=[];Z?!this._map.spatialReference.equals(this.spatialReference)&&ja&&0<ja.length?u({url:this._url.path+"/query",content:{f:"json",objectIds:ja.join(","),returnGeometry:!0,outSR:b.toJson(X._map.spatialReference.toJson()),
outFields:V},handleAs:"json",callbackParamName:"callback",load:function(ba){if(0===ba.features.length)X._resolve([oa,null,null],null,t,z);else{for(P=0;P<ba.features.length;P++)for(W=0;W<Z.length;W++)Z[W].attributes[V]==ba.features[P].attributes[V]&&(Z[W].geometry=new B(ba.features[P].geometry),Z[W].geometry.setSpatialReference(X._map.spatialReference));E.call(X)}},error:function(ba){X._resolve([oa,null,null],null,t,z)}}):E.call(this):this._resolve([oa,null,null],null,t,z)},getVisibleRasters:function(){var a=
this._visibleRasters,f=[],t;for(t in a)a.hasOwnProperty(t)&&f.push(a[t]);return f},_getDomainFields:function(a){if(a){var f=[];d.forEach(a,function(t){if(t.domain){var w={};w.name=t.name;w.domain=t.domain;f.push(w)}});return f}},_getDomainValue:function(a,f){if(a&&a.codedValues){var t;d.some(a.codedValues,function(w){return w.code===f?(t=w.name,!0):!1});return t}},_requestData:function(a,f,t){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=A.clone(a);var w=a._normalize(!0);this._prepareGetImageParameters(w,
f,t);f=A.clone(this._params);this._cleanupRequestParams(f);f.extent=a;f.format=f.format||(10.3<=this.version?"lerc":"jpgpng");"lerc"===f.format.toLowerCase()&&!f.lercVersion&&10.5<=this.version&&(f.lercVersion=2);this._params.time&&this._isMultidimensionalCRF()&&!this._isTimeSupportedOnCRF()&&delete f.time;t=null;this._useBrowserDecoding()&&(t=new S({ctx:this._context}));f={imageServiceParameters:f,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:t?A.hitch(t,"decode"):null};this._rasterReadPromise=
this.raster.read(f,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=a,this.hasDataChanged=!0,this._setPixelData(a))},_setPixelData:function(a){a=this._clonePixelData(a);this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this._drawPixelData(),this._rasterReadPromise=null)},_clonePixelData:function(a){if(null===
a||void 0===a)return a;var f={};a.extent&&(f.extent=A.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return f;f.pixelBlock=a.clone();return f},_setDefaultFilter:function(){},_getPixelBlockFromCanvas:function(a,f,t){a=a.getImageData(0,0,f,t).data;var w=f*t,z=0,E=0,C=new Uint8Array(w),R=new Uint8Array(w),P=new Uint8Array(w),W=new Uint8Array(w),X=Infinity,V=Infinity,T=Infinity,Y=-Infinity,ea=-Infinity,fa=-Infinity;for(z=0;z<w;z++){var ha=a[E++];var aa=a[E++];var ia=a[E++];X=X<ha?X:ha;Y=Y>ha?
Y:ha;V=V<aa?V:aa;ea=ea>aa?ea:aa;T=T<ia?T:ia;fa=fa>ia?fa:ia;C[z]=ha;R[z]=aa;P[z]=ia;W[z]=a[E++]&1}return new O({width:f,height:t,pixels:[C,R,P],pixelType:"U8",mask:W,statistics:[{minValue:X,maxValue:Y},{minValue:V,maxValue:ea},{minValue:T,maxValue:fa}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var a=
this._url.path+"/multiDimensionalInfo",f=new J(r._dfdCanceller);if(this._multidimensionalInfo)return f.resolve(this._multidimensionalInfo),f;!this.loaded||10.3<=this.version&&this.hasMultidimensions?(f._pendingDfd=u({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),f._pendingDfd.then(A.hitch(this,function(t){this._multidimensionalInfo=t.multidimensionalInfo;f.callback(t.multidimensionalInfo)}),function(t){f.errback(t)})):(a=Error("Layer does not support multidimensional info"),
a.log=!!c.isDebug,f.errback(a));return f},getStatistics:function(a){var f=new J(r._dfdCanceller);if(a&&this._cachedVariableStats[a])f.resolve(this._cachedVariableStats[a]);else{var t={f:"json"};a&&(t.variable=a);f._pendingDfd=u({url:this._url.path+"/statistics",content:t,handleAs:"json",callbackParamName:"callback"});f._pendingDfd.then(A.hitch(this,function(w){w=w.statistics||w.statitsics;var z=[];w&&w[0]&&null!=w[0].min?w.forEach(function(E){z.push([E.min,E.max,E.mean,E.standardDeviation])}):z=this.minValues&&
this.minValues.length?this.minValues.map(function(E,C){return[E,this.maxValues[C],this.meanValues[C],this.stdvValues[C]]}.bind(this)):w;a&&(this._cachedVariableStats[a]=z);f.callback(z)}),function(w){f.errback(w)})}return f},getDefaultMultidimensionalDefinition:function(){var a=new J(r._dfdCanceller);if(this._defaultMultidimensionalDefinition)return a.resolve(A.clone(this._defaultMultidimensionalDefinition)),a;a._pendingDfd=this.getMultidimensionalInfo();a._pendingDfd.then(A.hitch(this,function(f){f=
this._getDefaultMultidimensionalDefinition(f);a.callback(f)}),function(f){a.errback(f)});return a},_getDefaultMultidimensionalDefinition:function(a,f,t){var w,z=[],E=this.defaultVariable||"",C=E.length?a.variables.filter(function(R){return R.name===E})[0].dimensions:a.variables[0].dimensions;t&&(E=this.defaultVariable||a.variables[0].name);for(w in C)C.hasOwnProperty(w)&&(f||"StdTime"!==C[w].name)&&(a=C[w],z.push(new I({variableName:E,dimensionName:a.name,isSlice:!a.hasRanges,values:[this._getDefaultDimensionValue(a)]})));
this._defaultMultidimensionalDefinition=z;return A.clone(z)},_getDefaultDimensionValue:function(a){if(a&&a.values&&a.values.length){var f=Infinity,t;if(a.hasRanges)return a.values[0];if(a.name&&"stdz"===a.name.toLowerCase()){for(t=0;t<a.values.length;t++){var w=a.values[t];var z=Math.abs(w-0);if(z<f){f=z;var E=w}if(0===z)break}return E}return a.extent[0]}},_setDefaultMultidimensionalDefinition:function(a){var f,t={};this.getDefaultMultidimensionalDefinition().then(A.hitch(this,function(w){f=w;0<f.length&&
(this.mosaicRule?(t=A.clone(this.mosaicRule),t.multidimensionalDefinition=f):this.defaultMosaicRule?(t=A.clone(this.defaultMosaicRule),t.multidimensionalDefinition=f):t=new N({multidimensionalDefinition:f}),this.setMosaicRule(t,a))}))},_setDefaultRenderingRule:function(a){var f={},t=this.renderingRule;if(!t&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&!this.bandIds&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())f.rasterFunction=
this.rasterFunctionInfos[0].name;else if("esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version&&(!t||"Resample"!==t.functionName)){var w="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;f.rasterFunction="Resample";f.rasterFunctionArguments={ResamplingType:w,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}};t&&(f.rasterFunctionArguments.Raster=t.toJson())}f.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new M(f),this.setRenderingRule(this.defaultRenderingRule,
a))},_cleanupRequestParams:function(a){if(!a)return a;if(a.time&&a.mosaicRule){var f=new N(b.fromJson(a.mosaicRule));f=this._filterOutTimeDimension(f);a.mosaicRule=b.toJson(f.toJson())}f="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent renderer".split(" ");for(var t in f)a.hasOwnProperty(f[t])&&delete a[f[t]];return a},_filterOutTimeDimension:function(a){if(this._isMultidimensionalCRF())return a;if(a&&a.multidimensionalDefinition&&0<a.multidimensionalDefinition.length){var f=
d.filter(a.multidimensionalDefinition,function(t){return"StdTime"!==t.dimensionName});a.multidimensionalDefinition=f}return a},_removeVisualizationStretchFunction:function(a){var f=a&&a.functionName;if(!f||"stretch"!==f.toLowerCase())return a;var t=a.functionArguments.Raster;return t&&t.functionName&&d.some(this.rasterFunctionInfos,function(w){return t.functionName===w.name})?t:a},_isMultidimensionalCRF:function(){return 10.71<=this.version&&this.hasMultidimensions&&this.timeInfo&&!(this.objectIdField&&
this.fields&&1<this.fields.length)},_isTimeSupportedOnCRF:function(){return 10.8<=this.version},_cleanupMultidimensionalDefinition:function(a){a&&a.multidimensionalDefinition&&(a.multidimensionalDefinition=a.multidimensionalDefinition.filter(function(f){return!(!f.variableName&&!f.dimensionName)}),0===a.multidimensionalDefinition.length&&(a.multidimensionalDefinition=null))},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===
this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType||this.hasMultidimensions},_isVectorData:function(a){a=(a=a||this)&&a.serviceDataType;return"esriImageServiceDataTypeVector-UV"===a||"esriImageServiceDataTypeVector-MagDir"===a},_isRenderingRuleAProcessingTemplate:function(a){var f=a&&a.functionName;return!f||a.functionArguments?!1:d.some(f&&(this.rasterFunctionInfos||[]),function(t){return t&&t.name&&t.name.toLowerCase()===f.toLowerCase()})},_getRenderingRuleId:function(a){var f=
a&&a.functionName;if(f){if(this._isRenderingRuleAProcessingTemplate(a))return f;var t=this._customRenderingRuleId[f];if(t){if(t!==a){for(var w in this._customRenderingRuleId)if(this._customRenderingRuleId[w]===a)return w;for(t=0;this._customRenderingRuleId[z];)t+=1;var z;this._customRenderingRuleId[f+t]=a}}else this._customRenderingRuleId[f]=a;return f}},_createPixelData:function(a){a=new O({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});var f=this.fullExtent.getCenter();f=new m(f.x,
f.y,f.x+this.pixelSizeX,f.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:a,extent:f}},_convertRendererToRenderingRule:function(a){var f=a&&a.declaredClass;if(!f||"esri.renderer.UniqueValueRenderer"!==f&&"esri.renderer.ClassBreaksRenderer"!==f&&"esri.renderer.StretchRenderer"!==f&&"esri.renderer.ShadedReliefRenderer"!==f&&"esri.renderer.ColormapRenderer"!==f)return null;var t=null;"esri.renderer.StretchRenderer"===f?t=a.toRenderingRule({convertToColormap:10.6>this.version}):"esri.renderer.ClassBreaksRenderer"===
f?t=this._convertClassifyRenderer(a):"esri.renderer.UniqueValueRenderer"===f?t=this._convertUniqueValueRenderer(a):"esri.renderer.ShadedReliefRenderer"===f?t=this._convertShadedReliefRenderer(a):"esri.renderer.ColormapRenderer"===f&&(t=this._convertColormapRenderer(a));return t},_getValueField:function(a){if(a&&a.length){var f,t;d.some(a,function(w){if((t=w.name)&&"value"===t.toLowerCase())return f=t,!0});return f}},_convertColormapRenderer:function(a){var f=new M;f.functionName="Colormap";f.functionArguments=
{};a=a.colormapInfos.map(function(t){return[t.value].concat(t.color)});f.functionArguments.Colormap=a;return f},_convertShadedReliefRenderer:function(a){var f=new M;f.functionName="Hillshade";var t="traditional"===a.hillshadeType?0:1,w="none"===a.scalingType?1:3,z={HillshadeType:t,SlopeType:w,ZFactor:a.zFactor};0===t&&(z.Azimuth=a.azimuth,z.Altitude=a.altitude);3===w&&(z.PSPower=a.pixelSizePower,z.PSZFactor=a.pixelSizeFactor);f.functionArguments=z;f.variableName="Raster";a.colorRamp&&(f.functionName=
"ShadedRelief",z.Colormap=F.convertColorRampToColormap(a.colorRamp,256));return f},_convertClassifyRenderer:function(a){var f=[],t=[],w=[],z=[],E;var C=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);var R=this.hasRasterAttributeTable;if(C){R=this._rasterFunctionTemplateInfos[C]?this._rasterFunctionTemplateInfos[C].hasRasterAttributeTable:this.hasRasterAttributeTable;var P=this._renderingRuleAttributeTable[C];var W=this._rasterFunctionTemplateInfos[C]}var X=P&&P.features?P.features:
this._rasterAttributeTableFeatures;var V=this._getValueField(P&&P.fields?P.fields:this._rasterAttributeTableFields);R&&X?(d.forEach(a.infos,function(T,Y){var ea,fa=T.symbol.color;fa.a&&d.forEach(X,function(ha){ea=ha.attributes[a.attributeField];(ea>=T.minValue&&ea<T.maxValue||Y===a.infos.length-1&&ea>=T.minValue)&&z.push([ha.attributes[V],fa.r,fa.g,fa.b])},this)},this),C=W&&W.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(z,C),C=new M,C.functionName="Colormap",C.functionArguments=
{},C.functionArguments.Colormap=z,C.variableName="Raster"):(d.forEach(a.infos,function(T,Y){E=T.symbol&&T.symbol.color;E.a?(0===Y?f.push.call(f,T.minValue,T.maxValue+1E-4):f.push.call(f,T.minValue+1E-4,T.maxValue+1E-4),t.push(Y),z.push([Y,E.r,E.g,E.b])):w.push(T.minValue,T.maxValue)}),C=W&&W.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(z,C),C=new M,C.functionName="Remap",C.functionArguments={InputRanges:f,OutputValues:t,NoDataRanges:w},C.variableName="Raster",P=new M,P.functionName=
"Colormap",P.functionArguments={Colormap:z,Raster:C},C=P);return C},_convertUniqueValueRenderer:function(a){var f=[],t=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);if(t){var w=this._renderingRuleAttributeTable[t];var z=this._rasterFunctionTemplateInfos[t]}var E=w&&w.features?w.features:this._rasterAttributeTableFeatures;var C=(t=w&&w.fields?w.fields:this._rasterAttributeTableFields)&&t.length?this._getValueField(t):"Value";d.forEach(a.infos,function(R){var P=R.symbol.color;P.a&&
(a.attributeField!==C&&E?d.forEach(E,function(W){W.attributes[a.attributeField]==R.value&&f.push([W.attributes[C],P.r,P.g,P.b])},this):f.push([R.value,P.r,P.g,P.b]))},this);this._adjustColormapToPixelTypeRange(f,z&&z.pixelType||this.pixelType);z=new M;z.functionName="Colormap";z.functionArguments={};z.functionArguments.Colormap=f;z.variableName="Raster";return z},_adjustColormapToPixelTypeRange:function(a,f){(f=this._pixelTypeRanges[f])&&a.push([Math.floor(f[0]-1),0,0,0],[Math.ceil(f[1]+1),0,0,0]);
return a},_combineRenderingRule:function(a,f){if(!a||!f)return a||f;var t=function(w){var z=w.Raster;return z=z&&"esri.layers.RasterFunction"===z.declaredClass?t(z.functionArguments):w};a=A.clone(a);"none"!==f.functionName.toLocaleLowerCase()&&(t(a.functionArguments).Raster=f);return a},_isItemLevelRasterFunction:function(a){var f=a&&a.functionName;if(!f||!this._hasItemLevelRFT)return!1;var t=!1;d.some(this.rasterFunctionInfos,function(w){if(w&&w.name===f){if(1===w.functionType||2===w.functionType)t=
!0;return!0}});return t},_getServiceLevelRenderingRule:function(a){if(!this._hasItemLevelRFT||!a)return a;a=new M(a.toJson());var f=a.functionArguments;for(var t;;)if((t=f&&f.Raster)&&t.functionArguments&&t.functionArguments.Raster)f=t,f=f.functionArguments;else{this._isItemLevelRasterFunction(t)&&delete f.Raster;break}return a},_getItemLevelRenderingRule:function(a){if(!this._hasItemLevelRFT||!a)return null;if(this._isItemLevelRasterFunction(a))return a;a=new M(a.toJson());for(a=a.functionArguments;;)if((a=
a&&a.Raster)&&a.functionArguments&&a.functionArguments.Raster)a=a.functionArguments;else{if(this._isItemLevelRasterFunction(a))return a;break}},_resolve:function(a,f,t,w,z){f&&this[f].apply(this,a);t&&t.apply(null,a);w&&r._resDfd(w,a,z)},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=e.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(e.disconnect(this._timeConnect),
this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,f){this.useMapTime=a;this._toggleTime();!f&&this._map&&this.refresh(!0)},_setTime:function(a){this._params&&(this._params.time=a?a.toJson().join(","):null)},_onTimeExtentChangeHandler:function(a){this.suspended||(this._setTime(a),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()},getColormap:function(a){var f=this._url.path+"/colormap",t=new J(r._dfdCanceller),w={f:"json"};a&&a.renderingRule&&
(w.renderingRule=b.toJson(a.renderingRule.toJson()));this.hasColormap?(t._pendingDfd=u({url:f,content:w,handleAs:"json",callbackParamName:"callback"}),t._pendingDfd.then(function(z){t.callback(z)},function(z){t.errback(z)})):(a=Error("Layer does not support colormap"),a.log=!!c.isDebug,t.errback(a));return t},getRenderingRuleColormap:function(a){var f=new J(r._dfdCanceller);if(!a||!a.renderingRule)return f.errback(Error("Rendering rule is not specified")),f;a=a.renderingRule;var t=this._getRenderingRuleId(a);
this._renderingRuleColormap&&t&&this._renderingRuleColormap.hasOwnProperty(t)?f.resolve(this._renderingRuleColormap[t]):f=this.getColormap({renderingRule:a}).then(A.hitch(this,function(w){w=w&&w.colormap;t&&(this._renderingRuleColormap[t]=w);return w}));return f},_handleClipFunctionInRenderingRule:function(a){a=A.clone(a);var f=a.arguments,t=f.ClippingGeometry&&f.ClippingGeometry.value,w=f.Extent&&f.Extent.value;f.ClippingRaster&&f.ClippingRaster.value||t||w||(f=this._map.extent.toJson(),a.arguments.Extent.value=
f,a.functionArguments.Extent.value=f,a._isTemplate&&(a._templateJson.arguments.Extent.value=f));return a}});h("extend-esri")&&A.setObject("layers.ImageServiceLayerMixin",L,k);return L})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(L,A,J){L.DeferredList=function(d,b,c,e,h){var g=[];A.call(this);var n=this;0!==d.length||b||this.resolve([0,[]]);var k=0;J.forEach(d,function(l,q){function u(r,p){g[q]=[r,p];k++;k===d.length&&n.resolve(g)}l.then(function(r){b?
n.resolve([q,r]):u(!0,r)},function(r){c?n.reject(r):u(!1,r);if(e)return null;throw r;})})};L.DeferredList.prototype=new A;L.DeferredList.prototype.gatherResults=function(d){d=new L.DeferredList(d,!1,!0,!1);d.addCallback(function(b){var c=[];J.forEach(b,function(e){c.push(e[1])});return c});return d};return L.DeferredList})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point ./RasterFunction".split(" "),function(L,A,J,d,b,c,e){var h=
L(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],itemRenderingRule:null,constructor:function(g){A.isObject(g)&&(A.mixin(this,g),g.mosaicMethod&&(this.method=g.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),g.mosaicOperation&&(this.operation=g.mosaicOperation),this.operation&&
"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),g.fids&&(this.objectIds=g.fids),g.viewpoint&&(this.viewpoint=new c(g.viewpoint)),g.itemRenderingRule&&(this.itemRenderingRule=new e(g.itemRenderingRule)),this.multidimensionalDefinition=g.multidimensionalDefinition||[])},toJson:function(){var g=null,n=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(n){g=[];for(var k=0;k<n;k++)g.push("esri.layers.DimensionalDefinition"===
this.multidimensionalDefinition[k].declaredClass?this.multidimensionalDefinition[k].toJson():this.multidimensionalDefinition[k])}g={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:A.clone(this.lockRasterIds),viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:A.clone(this.objectIds),mosaicOperation:this.operation,multidimensionalDefinition:g,itemRenderingRule:this.itemRenderingRule?this.itemRenderingRule.toJson():
null};return b.filter(g,function(l){if(null!==l)return!0})},_getMethodEnum:function(g){if(g){var n=h.METHOD_NONE;switch(g.toLowerCase()){case "byattribute":n=h.METHOD_ATTRIBUTE;break;case "center":n=h.METHOD_CENTER;break;case "lockraster":n=h.METHOD_LOCKRASTER;break;case "nadir":n=h.METHOD_NADIR;break;case "northwest":n=h.METHOD_NORTHWEST;break;case "seamline":n=h.METHOD_SEAMLINE;break;case "viewpoint":n=h.METHOD_VIEWPOINT}return n}},_getOperatorEnum:function(g){if(g)switch(g.toLowerCase()){case "first":return h.OPERATION_FIRST;
case "last":return h.OPERATION_LAST;case "max":return h.OPERATION_MAX;case "min":return h.OPERATION_MIN;case "blend":return h.OPERATION_BLEND;case "mean":return h.OPERATION_MEAN;case "sum":return h.OPERATION_SUM}}});A.mixin(h,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",
OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});J("extend-esri")&&A.setObject("layers.MosaicRule",h,d);return h})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(L,A,J,d,b){L=L(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,
constructor:function(c){A.isObject(c)&&A.mixin(this,c)},toJson:function(){var c={variableName:this.variableName,dimensionName:this.dimensionName,values:A.clone(this.values),isSlice:this.isSlice};return b.filter(c,function(e){return null!==e})}});J("extend-esri")&&A.setObject("layers.DimensionalDefinition",L,d);return L})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),
function(L,A,J,d,b,c,e,h,g,n,k,l,q,u,r,p,m){var y,B,F,N,M,I;A=A(n,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(v){this.imageServiceUrl=v;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(v,x,H){var K=this,D=new d(u._dfdCanceller);if(10>h("ie"))throw"This browser is not supported.";
if(!v.imageServiceParameters)throw"Insufficient parameters to read data";var a=J.clone(v.imageServiceParameters),f=v.pixelType;b.some(this.validPixelTypes,function(R){return R===f})||(a.pixelType="F32");b.some(this.validFormats,function(R){return R.toLowerCase()===a.format.toLowerCase()})||(a.format="lerc");var t=v.decodeFunc,w;this._prepareGetImageParameters(a);var z=a.width,E=a.height,C=a.extent;delete a.width;delete a.height;delete a.extent;D._pendingDfd=k({url:this.imageServiceUrl+"/exportImage",
handleAs:"arraybuffer",content:J.mixin(a,{f:"image"}),load:function(R){K.decode(R,{width:z,height:E,planes:null,pixelType:f,noDataValue:a.noData,format:a.format,decodeFunc:t}).then(function(P){w={pixelBlock:P,extent:C};K._resolve([w,a],"onRasterReadComplete",x,D)},function(P){K._resolve([P],null,H,D,!0)})},error:function(R){K._resolve([R],null,H,D,!0)}});return D.promise},decode:function(v,x){if(void 0===x||null===x)throw"missing decode options";var H;x.format&&(H=x.format.toUpperCase());"BSQ"!==
H&&"BIP"!==H&&(H=this._getFormat(v));var K=x.decodeFunc;if(void 0===K||null===K)K=this._getFormatDecoderDfd(H);return K(v,x)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(v){if(v.size&&v.bbox){var x=v.size.split(",");v.width=parseFloat(x[0]);v.height=parseFloat(x[1]);v.extent||(x=v.bbox.split(","),v.extent=new l(parseFloat(x[0]),parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3]),new q(v.bboxSR)))}else{if(!v.width||Math.floor(v.width)!==v.width||!v.height||Math.floor(v.height)!==
v.height)throw"Incorrect Image Dimensions";if(!v.extent||"esri.geometry.Extent"!==v.extent.declaredClass)throw"Incorrect extent";x=v.extent;var H=x.spatialReference.wkid||e.toJson(x.spatialReference.toJson());delete v._ts;J.mixin(v,{bbox:x.xmin+","+x.ymin+","+x.xmax+","+x.ymax,imageSR:H,bboxSR:H,size:v.width+","+v.height},v.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(v,x,H){var K=v.ymax-v.ymin,D=v.xmax-v.xmin;H>=x?v.ymax=v.ymin+D*x/H:v.xmax=v.xmin+K*H/x;return v},
_resolve:function(v,x,H,K,D){x&&this[x].apply(this,v);H&&H.apply(null,v);K&&u._resDfd(K,v,D)},_getFormatDecoderDfd:function(v){var x=null;switch(v){case "LERC":x=this._decodeLerc;break;case "LERC2":x=this._decodeLerc2;break;case "JPEG":x=this._decodeJpeg;break;case "PNG":x=this._decodePng;break;case "BSQ":x=this._decodeBsq;break;case "BIP":x=this._decodeBip;break;case "TIFF":x=this._decodeTiff;break;default:x=function(H,K){throw"The raster format is not supported";}}x=J.hitch(this,x);return function(H,
K){var D=new d;try{if("LERC"===v||!0===M){var a=x(H,K);D.resolve(a)}else I.then(function(){a=x(H,K);D.resolve(a)})}catch(f){D.reject(f)}return D}},_getFormat:function(v){v=new Uint8Array(v,0,10);var x="";if(255===v[0]&&216===v[1])x="JPEG";else if(137===v[0]&&80===v[1]&&78===v[2]&&71===v[3])x="PNG";else if(67===v[0]&&110===v[1]&&116===v[2]&&90===v[3]&&73===v[4]&&109===v[5]&&97===v[6]&&103===v[7]&&101===v[8]&&32===v[9])x="LERC";else if(76===v[0]&&101===v[1]&&114===v[2]&&99===v[3]&&50===v[4]&&32===v[5])x=
"LERC2";else if(-1<String.fromCharCode.apply(null,v).toLowerCase().indexOf("error"))x="ERROR";else if(73===v[0]&&73===v[1]&&42===v[2]&&0===v[3]||77===v[0]&&77===v[1]&&0===v[2]&&42===v[3])x="TIFF";return x},_validateDecodeParams:function(v){if(!v.height||Math.floor(v.height)!==v.height)throw"Height not provided.";if(!v.width||Math.floor(v.width)!==v.width)throw"Width not provided.";},_decodeJpeg:function(v,x){if(!y)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(x);v=(new y).decode(v);
if(!S(v,x))throw"The decoded image dimensions are incorrect.";x=[];var H;for(H=0;H<v.pixels.length;H++){var K=v.pixels[H];x.push(this._calculateBandStatistics(K))}return new r({width:v.width,height:v.height,pixels:v.pixels,pixelType:"U8",mask:v.mask,statistics:x})},_decodePng:function(v,x){if(!B)throw"The png decoder module is not loaded.";this._validateDecodeParams(x);v=new Uint8Array(v);var H=new B(v);v=new Uint8Array(x.width*x.height*4);H.copyToImageData(v,H.decodePixels());var K=H=0;K=new Uint8Array(x.width*
x.height);for(H=0;H<x.width*x.height;H++)K[H]=v[4*H+3];var D=new r({width:x.width,height:x.height,pixels:[],pixelType:"U8",mask:K,statistics:[]});for(H=0;3>H;H++){var a=new Uint8Array(x.width*x.height);for(K=0;K<x.width*x.height;K++)a[K]=v[4*K+H];D.addData({pixels:a,statistics:this._calculateBandStatistics(a)})}return D},_decodeBsq:function(v,x){if(!F)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(x);O=x.noDataValue;x.pixelType=G(x.pixelType);v=F.decodeBSQ(v,{bandCount:x.planes,
width:x.width,height:x.height,pixelType:Q,noDataValue:O});var H=[],K,D=null;for(K=0;K<v.pixels.length;K++)D=v.pixels[K],H.push(this._calculateBandStatistics(D));return new r({width:x.width,height:x.height,pixels:v.pixels,pixelType:x.pixelType,mask:v.maskData,statistics:H})},_decodeBip:function(v,x){this._validateDecodeParams(x);O=x.noDataValue;x.pixelType=G(x.pixelType);v=F.decodeBIP(v,{bandCount:x.planes,width:x.width,height:x.height,pixelType:Q,noDataValue:O});var H=[],K,D=null;for(K=0;K<v.pixels.length;K++)D=
v.pixels[K],H.push(this._calculateBandStatistics(D));return new r({width:x.width,height:x.height,pixels:v.pixels,pixelType:x.pixelType,mask:v.maskData,statistics:H})},_decodeTiff:function(v,x){this._validateDecodeParams(x);O=x.noDataValue;x.pixelType=G(x.pixelType);v=N.decode(v);x=[];var H,K=null;for(H=0;H<v.pixels.length;H++)K=v.pixels[H],x.push(this._calculateBandStatistics(K,v.maskData));return new r({width:v.width,height:v.height,pixels:v.pixels,pixelType:v.pixelType,mask:v.maskData,statistics:x})},
_decodeLerc:function(v,x){this._validateDecodeParams(x);O=x.noDataValue;x.pixelType=G(x.pixelType);for(var H=0,K,D=0,a,f=v.byteLength-10;D<f;){var t=p.decode(v,{inputOffset:D,encodedMaskData:K,returnMask:0===H?!0:!1,returnEncodedMask:0===H?!0:!1,returnFileInfo:!0,pixelType:Q,noDataValue:O});D=t.fileInfo.eofOffset;0===H&&(K=t.encodedMaskData,a=new r({width:x.width,height:x.height,pixels:[],pixelType:x.pixelType,mask:t.maskData,statistics:[]}));H++;if(!S(t,x))throw"The decoded image dimensions are incorrect";
a.addData({pixels:t.pixelData,statistics:{minValue:t.minValue,maxValue:t.maxValue,noDataValue:t.noDataValue}})}return a},_decodeLerc2:function(v,x){this._validateDecodeParams(x);O=x.noDataValue;x.pixelType=G(x.pixelType);for(var H=0,K,D,a=0,f,t=v.byteLength-10,w=[];a<t;){D=m.decode(v,{inputOffset:a,maskData:K,returnFileInfo:!0});a=D.fileInfo.eofOffset;0===H&&(K=D.maskData,f=new r({width:x.width,height:x.height,pixels:[],pixelType:D.fileInfo.pixelType,mask:D.maskData,statistics:[]}));D.fileInfo.mask&&
0<D.fileInfo.mask.numBytes&&w.push(D.maskData);H++;if(!S(D,x))throw"The decoded image dimensions are incorrect";if(1<D.dimCount&&D.pixelData&&D.pixelData.length===D.width*D.height*D.dimCount){D.pixelData=D.pixelData.slice(-D.width*D.height);var z=D.dimStats&&D.dimStats.minValues&&D.dimStats.minValues[D.dimCount-1],E=D.dimStats&&D.dimStats.maxValues&&D.dimStats.maxValues[D.dimCount-1];null!=z&&null!=E&&(D.minValue=z,D.maxValue=E)}f.addData({pixels:D.pixelData,statistics:{minValue:D.minValue,maxValue:D.maxValue,
noDataValue:D.noDataValue}})}if(1<w.length){D=f.width*f.height;f.bandMasks=w;K=new Uint8Array(D);K.set(w[0]);for(x=1;x<w.length;x++)for(v=w[x],H=0;H<D;H++)K[H]&=v[H];f.maskData=K}return f},_calculateBandStatistics:function(v,x){var H=Infinity,K=-Infinity,D=v.length,a,f=0;if(x)for(a=0;a<D;a++)x[a]&&(f=v[a],H=f<H?f:H,K=f>K?f:K);else for(a=0;a<D;a++)f=v[a],H=f<H?f:H,K=f>K?f:K;return{minValue:H,maxValue:K}},_loadRasterFormatModules:function(){M||(I||(I=new d),10>h("ie")?I.isRejected()||I.reject("unsupported browser version"):
L(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(v,x,H,K){y=v;B=x;F=H;N=K;M=!0;I.isResolved()||I.resolve(!0)}))}});var Q=null,O=null,G=function(v){if("U1"===v||"U2"===v||"U4"===v||"U8"===v)return O=Math.pow(2,8)-1,Q=Uint8Array,"U8";"U16"===v?(O=O||Math.pow(2,16)-1,Q=Uint16Array):"U32"===v?(O=O||Math.pow(2,32)-1,Q=Uint32Array):"S8"===v?(O=O||0-Math.pow(2,7),Q=Int8Array):"S16"===v?(O=O||0-Math.pow(2,15),Q=Int16Array):
"S32"===v?(O=O||0-Math.pow(2,31),Q=Int32Array):Q=Float32Array;return v},S=function(v,x){return v.height!==x.height||v.width!==x.width?!1:!0};h("extend-esri")&&J.setObject("layers.Raster",A,g);return A})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(L,A,J,d){L=L([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],maskIsAlpha:!1,validPixelCount:null,constructor:function(b){if(b){if(!b.width||
Math.floor(b.width)!==b.width)throw"PixelBlock: incorrect width";if(!b.height||Math.floor(b.height)!==b.height)throw"PixelBlock: incorrect height";if(!b.pixels)throw"PixelBlock: pixel data not present";this.width=b.width;this.height=b.height;this.pixels=b.pixels;this.pixelType=b.pixelType||null;this.statistics=b.statistics;this.mask=b.mask||null;this.maskIsAlpha=b.maskIsAlpha||!1;b=b.validPixelCount;null==b&&(b=this.mask?this._getValidPixelCount(this.mask):this.width*this.height);this.validPixelCount=
b}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(b){if(!b.pixels||!b.statistics)throw"Pixel data or statistics are not present";if(b.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(b.statistics);this.pixels.push(b.pixels)},getAsRGBA:function(){var b=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(b);
break;default:this._fillFrom8Bit(b)}return new Uint8ClampedArray(b)},getAsRGBAFloat:function(){var b=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(b);return b},clone:function(b){b=b||this;var c=new this.constructor;c.width=b.width;c.height=b.height;c.pixelType=b.pixelType;c.maskIsAlpha=b.maskIsAlpha;b.mask&&(c.mask=new Uint8Array(b.mask));var e,h;if(b.pixels){c.pixels=[];var g=(h=b.pixels.length)&&b.pixels[0].slice;for(e=0;e<h;e++)c.pixels[e]=g?b.pixels[e].slice(0,b.pixels[e].length):
new b.pixels[e].constructor(b.pixels[e])}if(b.statistics)for(c.statistics=[],h=b.statistics.length,e=0;e<h;e++)c.statistics[e]=A.clone(b.statistics[e]);b=b.validPixelCount;null==b&&(b=c.mask?this._getValidPixelCount(c.mask):c.width*c.height);return c},clamp:function(b){if("F64"!==b&&"F32"!==b){switch(b){case "U8":var c=[0,255];break;case "U16":c=[0,65535];break;case "U32":c=[0,4294967295];break;case "S8":c=[-128,127];break;case "S16":c=[-32768,32767];break;case "S32":c=[-2147483648,2147483647];break;
default:c=[-3.4*1E39,3.4*1E39]}var e=c[0];c=c[1];var h=this.pixels,g=this.width*this.height,n=h.length,k,l,q=[];for(k=0;k<n;k++){var u=this._createEmptyBand(b,g);var r=h[k];for(l=0;l<g;l++){var p=r[l];u[l]=p>c?c:p<e?e:p}q.push(u)}this.pixels=q;this.pixelType=b}},calculateStatistics:function(){var b,c=[],e=this.mask;for(b=0;b<this.pixels.length;b++){var h=this.pixels[b];c.push(this._calculateBandStatistics(h,e))}this.statistics=c},_getValidPixelCount:function(b){var c,e=0;for(c=0;c<b.length;c++)b[c]&&
e++;return e},_createEmptyBand:function(b,c){switch(b){case "U8":b=new Uint8Array(c);break;case "U16":b=new Uint16Array(c);break;case "U32":b=new Uint32Array(c);break;case "S8":b=new Int8Array(c);break;case "S16":b=new Int16Array(c);break;case "S32":b=new Int32Array(c);break;case "U32":b=new Uint32Array(c);break;case "F32":b=new Float32Array(c);break;case "F64":b=new Float64Array(c);break;default:b=new Float32Array(c)}return b},_fillFrom8Bit:function(b){var c=this.pixels,e=this.mask;if(!b||!c||!c.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var h,g;var n=h=g=c[0];3<=c.length&&(h=c[1],g=c[2]);c=new Uint32Array(b);var k=this.width*this.height;if(n.length!==k)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(e&&e.length===k)if(this.maskIsAlpha)for(b=0;b<k;b++)e[b]&&(c[b]=e[b]<<24|g[b]<<16|h[b]<<8|n[b]);else for(b=0;b<k;b++)e[b]&&(c[b]=-16777216|g[b]<<16|h[b]<<8|n[b]);else for(b=0;b<k;b++)c[b]=-16777216|g[b]<<16|h[b]<<8|n[b]},_fillFromNon8Bit:function(b){var c=this.pixels,e=this.mask,h=this.statistics;if(!b||
!c||!c.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var g=1,n=0;g=1;h&&0<h.length?(n=h.map(function(u){return u.minValue}).reduce(function(u,r){return Math.min(u,r)}),g=h.map(function(u){return u.maxValue-u.minValue}).reduce(function(u,r){return Math.max(u,r)}),g=255/g):(g=255,"S8"===this.pixelType?(n=-128,g=127):"U16"===this.pixelType?g=65535:"S16"===this.pixelType?(n=-32768,g=32767):"U32"===this.pixelType?g=4294967295:"S32"===this.pixelType?(n=-2147483648,
g=2147483647):"F32"===this.pixelType?(n=-3.4*1E39,g=3.4*1E39):"F64"===this.pixelType&&(n=-Number.MAX_VALUE,g=Number.MAX_VALUE),g=255/(g-n));b=new Uint32Array(b);h=this.width*this.height;var k=c[0];if(k.length!==h)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=c.length){var l=c[1];var q=c[2];if(e&&e.length===h)for(c=0;c<h;c++)e[c]&&(b[c]=-16777216|(q[c]-n)*g<<16|(l[c]-n)*g<<8|(k[c]-n)*g);else for(c=0;c<h;c++)b[c]=-16777216|(q[c]-n)*g<<16|(l[c]-n)*g<<8|(k[c]-n)*
g}else if(e&&e.length===h)for(c=0;c<h;c++)l=(k[c]-n)*g,e[c]&&(b[c]=-16777216|l<<16|l<<8|l);else for(c=0;c<h;c++)l=(k[c]-n)*g,b[c]=-16777216|l<<16|l<<8|l},_fillFrom32Bit:function(b){var c=this.pixels,e=this.mask;if(!b||!c||!c.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var h,g;var n=h=g=c[0];3<=c.length&&(h=c[1],g=c[2]);var k=this.width*this.height;if(n.length!==k)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var l=0;if(e&&
e.length===k)for(c=0;c<k;c++)b[l++]=n[c],b[l++]=h[c],b[l++]=g[c],b[l++]=e[c]&1;else for(c=0;c<k;c++)b[l++]=n[c],b[l++]=h[c],b[l++]=g[c],b[l++]=1},_calculateBandStatistics:function(b,c){var e=Infinity,h=-Infinity,g=b.length,n,k=0;if(c)for(n=0;n<g;n++)c[n]&&(k=b[n],e=k<e?k:e,h=k>h?k:h);else for(n=0;n<g;n++)k=b[n],e=k<e?k:e,h=k>h?k:h;return{minValue:e,maxValue:h}}});J("extend-esri")&&A.setObject("layers.PixelBlock",L,d);return L})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var L=
{defaultNoDataValue:-3.4027999387901484E38,decode:function(J,d){d=d||{};var b=d.inputOffset||0,c=d.encodedMaskData||null===d.encodedMaskData,e={},h=new Uint8Array(J,b,10);e.fileIdentifierString=String.fromCharCode.apply(null,h);if("CntZImage"!=e.fileIdentifierString.trim())throw"Unexpected file identifier string: "+e.fileIdentifierString;b+=10;h=new DataView(J,b,24);e.fileVersion=h.getInt32(0,!0);e.imageType=h.getInt32(4,!0);e.height=h.getUint32(8,!0);e.width=h.getUint32(12,!0);e.maxZError=h.getFloat64(16,
!0);b+=24;if(!c)if(h=new DataView(J,b,16),e.mask={},e.mask.numBlocksY=h.getUint32(0,!0),e.mask.numBlocksX=h.getUint32(4,!0),e.mask.numBytes=h.getUint32(8,!0),e.mask.maxValue=h.getFloat32(12,!0),b+=16,0<e.mask.numBytes){c=new Uint8Array(Math.ceil(e.width*e.height/8));h=new DataView(J,b,e.mask.numBytes);var g=h.getInt16(0,!0),n=2,k=0;do{if(0<g)for(;g--;)c[k++]=h.getUint8(n++);else{var l=h.getUint8(n++);for(g=-g;g--;)c[k++]=l}g=h.getInt16(n,!0);n+=2}while(n<e.mask.numBytes);if(-32768!==g||k<c.length)throw"Unexpected end of mask RLE encoding";
e.mask.bitset=c;b+=e.mask.numBytes}else 0===(e.mask.numBytes|e.mask.numBlocksY|e.mask.maxValue)&&(c=new Uint8Array(Math.ceil(e.width*e.height/8)),e.mask.bitset=c);h=new DataView(J,b,16);e.pixels={};e.pixels.numBlocksY=h.getUint32(0,!0);e.pixels.numBlocksX=h.getUint32(4,!0);e.pixels.numBytes=h.getUint32(8,!0);e.pixels.maxValue=h.getFloat32(12,!0);b+=16;c=e.pixels.numBlocksX;h=e.pixels.numBlocksY;c+=0<e.width%c?1:0;g=h+(0<e.height%h?1:0);e.pixels.blocks=Array(c*g);for(k=n=0;k<g;k++)for(l=0;l<c;l++){var q=
0;h=new DataView(J,b,Math.min(10,J.byteLength-b));var u={};e.pixels.blocks[n++]=u;var r=h.getUint8(0);q++;u.encoding=r&63;if(3<u.encoding)throw"Invalid block encoding ("+u.encoding+")";if(2===u.encoding)b++;else{if(0!==r&&2!==r){r>>=6;u.offsetType=r;if(2===r)u.offset=h.getInt8(1),q++;else if(1===r)u.offset=h.getInt16(1,!0),q+=2;else if(0===r)u.offset=h.getFloat32(1,!0),q+=4;else throw"Invalid block offset type";if(1===u.encoding)if(r=h.getUint8(q),q++,u.bitsPerPixel=r&63,r>>=6,u.numValidPixelsType=
r,2===r)u.numValidPixels=h.getUint8(q),q++;else if(1===r)u.numValidPixels=h.getUint16(q,!0),q+=2;else if(0===r)u.numValidPixels=h.getUint32(q,!0),q+=4;else throw"Invalid valid pixel count type";}b+=q;if(3!=u.encoding)if(0===u.encoding){r=(e.pixels.numBytes-1)/4;if(r!==Math.floor(r))throw"uncompressed block has invalid length";h=new ArrayBuffer(4*r);q=new Uint8Array(h);q.set(new Uint8Array(J,b,4*r));h=new Float32Array(h);u.rawData=h;b+=4*r}else 1===u.encoding&&(r=Math.ceil(u.numValidPixels*u.bitsPerPixel/
8),h=new ArrayBuffer(4*Math.ceil(r/4)),q=new Uint8Array(h),q.set(new Uint8Array(J,b,r)),u.stuffedData=new Uint32Array(h),b+=r)}}e.eofOffset=b;J=null!=d.noDataValue?d.noDataValue:L.defaultNoDataValue;c=d.encodedMaskData;r=d.returnMask;g=0;n=e.pixels.numBlocksX;k=e.pixels.numBlocksY;l=Math.floor(e.width/n);u=Math.floor(e.height/k);q=2*e.maxZError;b=Number.MAX_VALUE;c=c||(e.mask?e.mask.bitset:null);var p;h=new (d.pixelType||Float32Array)(e.width*e.height);r&&c&&(p=new Uint8Array(e.width*e.height));r=
new Float32Array(l*u);for(var m,y,B=0;B<=k;B++){var F=B!==k?u:e.height%k;if(0!==F)for(var N=0;N<=n;N++){var M=N!==n?l:e.width%n;if(0!==M){var I=B*e.width*u+N*l,Q=e.width-M,O=e.pixels.blocks[g],G;if(2>O.encoding){if(0===O.encoding)var S=O.rawData;else{var v=G=S=void 0;m=O.stuffedData;y=O.bitsPerPixel;var x=O.numValidPixels,H=O.offset,K=q,D=r,a=e.pixels.maxValue,f=(1<<y)-1,t=0,w=0,z=Math.ceil((a-H)/K);m[m.length-1]<<=8*(4*m.length-Math.ceil(y*x/8));for(v=0;v<x;v++)0===w&&(S=m[t++],w=32),w>=y?(G=S>>>
w-y&f,w-=y):(w=y-w,G=(S&f)<<w&f,S=m[t++],w=32-w,G+=S>>>w),D[v]=G<z?H+G*K:a;S=r}G=0}else var E=2===O.encoding?0:O.offset;if(c)for(y=0;y<F;y++){if(I&7){var C=c[I>>3];C<<=I&7}for(m=0;m<M;m++)I&7||(C=c[I>>3]),C&128?(p&&(p[I]=1),v=2>O.encoding?S[G++]:E,b=b>v?v:b,h[I++]=v):(p&&(p[I]=0),h[I++]=J),C<<=1;I+=Q}else if(2>O.encoding)for(y=0;y<F;y++){for(m=0;m<M;m++)v=S[G++],b=b>v?v:b,h[I++]=v;I+=Q}else for(b=b>E?E:b,y=0;y<F;y++){for(m=0;m<M;m++)h[I++]=E;I+=Q}if(1===O.encoding&&G!==O.numValidPixels)throw"Block and Mask do not match";
g++}}}E=p;p={width:e.width,height:e.height,pixelData:h,minValue:b,maxValue:e.pixels.maxValue,noDataValue:J};E&&(p.maskData=E);d.returnEncodedMask&&e.mask&&(p.encodedMaskData=e.mask.bitset?e.mask.bitset:null);if(d.returnFileInfo&&(p.fileInfo=A(e),d.computeUsedBitDepths)){d=p.fileInfo;E=e.pixels.numBlocksX*e.pixels.numBlocksY;C={};for(S=0;S<E;S++)G=e.pixels.blocks[S],0===G.encoding?C.float32=!0:1===G.encoding?C[G.bitsPerPixel]=!0:C[0]=!0;e=Object.keys(C);d.bitDepths=e}return p}},A=function(J){return{fileIdentifierString:J.fileIdentifierString,
fileVersion:J.fileVersion,imageType:J.imageType,height:J.height,width:J.width,maxZError:J.maxZError,eofOffset:J.eofOffset,mask:J.mask?{numBlocksX:J.mask.numBlocksX,numBlocksY:J.mask.numBlocksY,numBytes:J.mask.numBytes,maxValue:J.mask.maxValue}:null,pixels:{numBlocksX:J.pixels.numBlocksX,numBlocksY:J.pixels.numBlocksY,numBytes:J.pixels.numBytes,maxValue:J.pixels.maxValue,noDataValue:this.noDataValue}}};return L})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var L={unstuff:function(d,
b,c,e,h,g,n,k){var l=(1<<c)-1,q=0,u,r=0;d[d.length-1]<<=8*(4*d.length-Math.ceil(c*e/8));if(h)for(u=0;u<e;u++){if(0===r){var p=d[q++];r=32}if(r>=c){var m=p>>>r-c&l;r-=c}else r=c-r,m=(p&l)<<r&l,p=d[q++],r=32-r,m+=p>>>r;b[u]=h[m]}else for(h=Math.ceil((k-g)/n),u=0;u<e;u++)0===r&&(p=d[q++],r=32),r>=c?(m=p>>>r-c&l,r-=c):(r=c-r,m=(p&l)<<r&l,p=d[q++],r=32-r,m+=p>>>r),b[u]=m<h?g+m*n:k},unstuffLUT:function(d,b,c,e,h,g){var n=(1<<b)-1,k=0,l=0,q=0,u=q=0,r=[];d[d.length-1]<<=8*(4*d.length-Math.ceil(b*c/8));var p=
Math.ceil((g-e)/h);for(l=0;l<c;l++){if(0===q){var m=d[k++];q=32}q>=b?(u=m>>>q-b&n,q-=b):(q=b-q,u=(m&n)<<q&n,m=d[k++],q=32-q,u+=m>>>q);r[l]=u<p?e+u*h:g}r.unshift(e);return r},unstuff2:function(d,b,c,e,h,g,n,k){var l=(1<<c)-1,q=0,u,r=0,p=0;if(h)for(u=0;u<e;u++){if(0===r){var m=d[q++];r=32;p=0}if(r>=c){var y=m>>>p&l;r-=c;p+=c}else{var B=c-r;y=m>>>p&l;m=d[q++];r=32-B;y|=(m&(1<<B)-1)<<c-B;p=B}b[u]=h[y]}else for(h=Math.ceil((k-g)/n),u=0;u<e;u++)0===r&&(m=d[q++],r=32,p=0),r>=c?(y=m>>>p&l,r-=c,p+=c):(B=c-
r,y=m>>>p&l,m=d[q++],r=32-B,y|=(m&(1<<B)-1)<<c-B,p=B),b[u]=y<h?g+y*n:k;return b},unstuffLUT2:function(d,b,c,e,h,g){var n=(1<<b)-1,k=0,l=0,q=0,u=0,r=0,p=0,m=[],y=Math.ceil((g-e)/h);for(l=0;l<c;l++){if(0===u){var B=d[k++];u=32;p=0}u>=b?(r=B>>>p&n,u-=b,p+=b):(q=b-u,r=B>>>p&n,B=d[k++],u=32-q,r|=(B&(1<<q)-1)<<b-q,p=q);m[l]=r<y?e+r*h:g}m.unshift(e);return m},originalUnstuff:function(d,b,c,e){var h=(1<<c)-1,g=0,n,k=0;d[d.length-1]<<=8*(4*d.length-Math.ceil(c*e/8));for(n=0;n<e;n++){if(0===k){var l=d[g++];
k=32}if(k>=c){var q=l>>>k-c&h;k-=c}else k=c-k,q=(l&h)<<k&h,l=d[g++],k=32-k,q+=l>>>k;b[n]=q}return b},originalUnstuff2:function(d,b,c,e){var h=(1<<c)-1,g=0,n,k=0,l=0;for(n=0;n<e;n++){if(0===k){var q=d[g++];k=32;l=0}if(k>=c){var u=q>>>l&h;k-=c;l+=c}else{var r=c-k;u=q>>>l&h;q=d[g++];k=32-r;u|=(q&(1<<r)-1)<<c-r;l=r}b[n]=u}return b}},A={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(d){for(var b=65535,c=65535,e=d.length,h=Math.floor(e/2),g=0;h;){var n=359<=h?359:h;h-=n;do b+=d[g++]<<8,c+=b+=
d[g++];while(--n);b=(b&65535)+(b>>>16);c=(c&65535)+(c>>>16)}e&1&&(c+=b+=d[g]<<8);return((c&65535)+(c>>>16)<<16|(b&65535)+(b>>>16))>>>0},readHeaderInfo:function(d,b){var c=b.ptr,e=new Uint8Array(d,c,6),h={};h.fileIdentifierString=String.fromCharCode.apply(null,e);if(0!==h.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+h.fileIdentifierString;c+=6;e=new DataView(d,c,8);var g=e.getInt32(0,!0);h.fileVersion=g;c+=4;3<=g&&(h.checksum=e.getUint32(4,
!0),c+=4);e=new DataView(d,c,12);h.height=e.getUint32(0,!0);h.width=e.getUint32(4,!0);c+=8;4<=g?(h.numDims=e.getUint32(8,!0),c+=4):h.numDims=1;e=new DataView(d,c,40);h.numValidPixel=e.getUint32(0,!0);h.microBlockSize=e.getInt32(4,!0);h.blobSize=e.getInt32(8,!0);h.imageType=e.getInt32(12,!0);h.maxZError=e.getFloat64(16,!0);h.zMin=e.getFloat64(24,!0);h.zMax=e.getFloat64(32,!0);c+=40;b.headerInfo=h;b.ptr=c;if(3<=g&&(d=this.computeChecksumFletcher32(new Uint8Array(d,c-(4<=g?52:48),h.blobSize-14)),d!==
h.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(d,b){var c=b.headerInfo,e=this.getDataTypeArray(c.imageType),h=c.numDims*this.getDataTypeSize(c.imageType),g=this.readSubArray(d,b.ptr,e,h);d=this.readSubArray(d,b.ptr+h,e,h);b.ptr+=2*h;h=!0;for(b=0;b<c.numDims;b++)if(g[b]!==d[b]){h=!1;break}c.minValues=g;c.maxValues=d;return h},readSubArray:function(d,b,c,e){if(c===Uint8Array)d=new Uint8Array(d,b,e);else{var h=new ArrayBuffer(e);(new Uint8Array(h)).set(new Uint8Array(d,b,e));
d=new c(h)}return d},readMask:function(d,b){var c=b.ptr,e=b.headerInfo,h=e.width*e.height,g=e.numValidPixel,n=new DataView(d,c,4);e={};e.numBytes=n.getUint32(0,!0);c+=4;if((0===g||h===g)&&0!==e.numBytes)throw"invalid mask";if(0===g)g=new Uint8Array(Math.ceil(h/8)),e.bitset=g,n=new Uint8Array(h),b.pixels.resultMask=n,c+=e.numBytes;else if(0<e.numBytes){g=new Uint8Array(Math.ceil(h/8));n=new DataView(d,c,e.numBytes);d=n.getInt16(0,!0);var k=2,l=0,q=0;do{if(0<d)for(;d--;)g[l++]=n.getUint8(k++);else for(q=
n.getUint8(k++),d=-d;d--;)g[l++]=q;d=n.getInt16(k,!0);k+=2}while(k<e.numBytes);if(-32768!==d||l<g.length)throw"Unexpected end of mask RLE encoding";n=new Uint8Array(h);for(k=k=d=0;k<h;k++)k&7?(d=g[k>>3],d<<=k&7):d=g[k>>3],d&128&&(n[k]=1);b.pixels.resultMask=n;e.bitset=g;c+=e.numBytes}b.ptr=c;b.mask=e;return!0},readDataOneSweep:function(d,b,c,e){var h=b.ptr,g=b.headerInfo,n=g.numDims,k=g.width*g.height;g=g.numValidPixel*A.getDataTypeSize(g.imageType)*n;var l=b.pixels.resultMask;if(c===Uint8Array)d=
new Uint8Array(d,h,g);else{var q=new ArrayBuffer(g);(new Uint8Array(q)).set(new Uint8Array(d,h,g));d=new c(q)}if(d.length===k*n)b.pixels.resultPixels=e?A.swapDimensionOrder(d,k,n,c,!0):d;else{b.pixels.resultPixels=new c(k*n);var u=q=c=0,r=0;if(1<n)if(e)for(q=0;q<k;q++){if(l[q])for(r=q,u=0;u<n;u++,r+=k)b.pixels.resultPixels[r]=d[c++]}else for(q=0;q<k;q++){if(l[q])for(r=q*n,u=0;u<n;u++)b.pixels.resultPixels[r+u]=d[c++]}else for(q=0;q<k;q++)l[q]&&(b.pixels.resultPixels[q]=d[c++])}b.ptr=h+g;return!0},
readHuffmanTree:function(d,b){var c=this.HUFFMAN_LUT_BITS_MAX,e=new DataView(d,b.ptr,16);b.ptr+=16;if(2>e.getInt32(0,!0))throw"unsupported Huffman version";var h=e.getInt32(4,!0),g=e.getInt32(8,!0);e=e.getInt32(12,!0);if(g>=e)return!1;var n=new Uint32Array(e-g);A.decodeBits(d,b,n);var k=[],l;for(l=g;l<e;l++){var q=l-(l<h?0:h);k[q]={first:n[l-g],second:null}}l=d.byteLength-b.ptr;n=new ArrayBuffer(4*Math.ceil(l/4));(new Uint8Array(n)).set(new Uint8Array(d,b.ptr,l));d=new Uint32Array(n);b=0;n=0;var u=
d[0];for(l=g;l<e;l++){q=l-(l<h?0:h);var r=k[q].first;0<r&&(k[q].second=u<<b>>>32-r,32-b>=r?(b+=r,32===b&&(b=0,n++,u=d[n])):(b+=r-32,n++,u=d[n],k[q].second|=u>>>32-b))}var p=u=0,m=new J;for(l=0;l<k.length;l++)void 0!==k[l]&&(u=Math.max(u,k[l].first));p=u>=c?c:u;c=[];var y;for(l=g;l<e;l++)if(q=l-(l<h?0:h),r=k[q].first,0<r)if(g=[r,q],r<=p){q=k[q].second<<p-r;var B=1<<p-r;for(r=0;r<B;r++)c[q|r]=g}else for(q=k[q].second,B=m,--r;0<=r;r--)(y=q>>>r&1)?(B.right||(B.right=new J),B=B.right):(B.left||(B.left=
new J),B=B.left),0!==r||B.val||(B.val=g[1]);return{decodeLut:c,numBitsLUTQick:p,numBitsLUT:u,tree:m,stuffedData:d,srcPtr:n,bitPos:b}},readHuffman:function(d,b,c,e){var h=b.headerInfo.numDims,g=b.headerInfo.height,n=b.headerInfo.width,k=n*g,l=this.readHuffmanTree(d,b);d=l.decodeLut;var q=l.tree,u=l.stuffedData,r=l.srcPtr,p=l.bitPos,m=l.numBitsLUTQick;l=l.numBitsLUT;var y=0===b.headerInfo.imageType?128:0,B=b.pixels.resultMask,F,N,M,I,Q,O,G=0;0<p&&(r++,p=0);var S=u[r],v=1===b.encodeMode,x=new c(k*h),
H=x,K;if(2>h||v)for(K=0;K<h;K++)if(1<h&&(H=new c(x.buffer,k*K,k),G=0),b.headerInfo.numValidPixel===n*g)for(M=Q=0;M<g;M++)for(I=0;I<n;I++,Q++){var D=0;var a=F=S<<p>>>32-m;32-p<m&&(a=F|=u[r+1]>>>64-p-m);if(d[a])D=d[a][1],p+=d[a][0];else for(a=F=S<<p>>>32-l,32-p<l&&(a=F|=u[r+1]>>>64-p-l),a=q,O=0;O<l;O++)if(a=(N=F>>>l-O-1&1)?a.right:a.left,!a.left&&!a.right){D=a.val;p=p+O+1;break}32<=p&&(p-=32,r++,S=u[r]);D-=y;v?(D=0<I?D+G:0<M?D+H[Q-n]:D+G,D&=255,G=H[Q]=D):H[Q]=D}else for(M=Q=0;M<g;M++)for(I=0;I<n;I++,
Q++){if(B[Q]){D=0;a=F=S<<p>>>32-m;32-p<m&&(a=F|=u[r+1]>>>64-p-m);if(d[a])D=d[a][1],p+=d[a][0];else for(a=F=S<<p>>>32-l,32-p<l&&(a=F|=u[r+1]>>>64-p-l),a=q,O=0;O<l;O++)if(a=(N=F>>>l-O-1&1)?a.right:a.left,!a.left&&!a.right){D=a.val;p=p+O+1;break}32<=p&&(p-=32,r++,S=u[r]);D-=y;v?(D=0<I&&B[Q-1]?D+G:0<M&&B[Q-n]?D+H[Q-n]:D+G,D&=255,G=H[Q]=D):H[Q]=D}}else for(M=Q=0;M<g;M++)for(I=0;I<n;I++)if(Q=M*n+I,!B||B[Q])for(K=0;K<h;K++,Q+=k){D=0;a=F=S<<p>>>32-m;32-p<m&&(a=F|=u[r+1]>>>64-p-m);if(d[a])D=d[a][1],p+=d[a][0];
else for(a=F=S<<p>>>32-l,32-p<l&&(a=F|=u[r+1]>>>64-p-l),a=q,O=0;O<l;O++)if(a=(N=F>>>l-O-1&1)?a.right:a.left,!a.left&&!a.right){D=a.val;p=p+O+1;break}32<=p&&(p-=32,r++,S=u[r]);D-=y;H[Q]=D}b.ptr=b.ptr+4*(r+1)+(0<p?4:0);b.pixels.resultPixels=x;1<h&&!e&&(b.pixels.resultPixels=A.swapDimensionOrder(x,k,h,c))},decodeBits:function(d,b,c,e,h){var g=b.headerInfo,n=g.fileVersion,k=0,l=new DataView(d,b.ptr,5<=d.byteLength-b.ptr?5:d.byteLength-b.ptr),q=l.getUint8(0);k++;var u=q>>6,r=0===u?4:3-u,p=0<(q&32)?!0:
!1;u=q&31;q=0;if(1===r)q=l.getUint8(k),k++;else if(2===r)q=l.getUint16(k,!0),k+=2;else if(4===r)q=l.getUint32(k,!0),k+=4;else throw"Invalid valid pixel count type";r=2*g.maxZError;h=1<g.numDims?g.maxValues[h]:g.zMax;if(p){b.counter.lut++;p=l.getUint8(k);k++;g=Math.ceil((p-1)*u/8);var m=Math.ceil(g/4);m=new ArrayBuffer(4*m);var y=new Uint8Array(m);b.ptr+=k;y.set(new Uint8Array(d,b.ptr,g));k=new Uint32Array(m);b.ptr+=g;for(l=0;p-1>>>l;)l++;g=Math.ceil(q*l/8);m=Math.ceil(g/4);m=new ArrayBuffer(4*m);
y=new Uint8Array(m);y.set(new Uint8Array(d,b.ptr,g));d=new Uint32Array(m);b.ptr+=g;b=3<=n?L.unstuffLUT2(k,u,p-1,e,r,h):L.unstuffLUT(k,u,p-1,e,r,h);3<=n?L.unstuff2(d,c,l,q,b):L.unstuff(d,c,l,q,b)}else b.counter.bitstuffer++,l=u,b.ptr+=k,0<l&&(g=Math.ceil(q*l/8),m=Math.ceil(g/4),m=new ArrayBuffer(4*m),y=new Uint8Array(m),y.set(new Uint8Array(d,b.ptr,g)),d=new Uint32Array(m),b.ptr+=g,3<=n?null==e?L.originalUnstuff2(d,c,l,q):L.unstuff2(d,c,l,q,!1,e,r,h):null==e?L.originalUnstuff(d,c,l,q):L.unstuff(d,
c,l,q,!1,e,r,h))},readTiles:function(d,b,c,e){var h=b.headerInfo,g=h.width,n=h.height,k=g*n,l=h.microBlockSize,q=h.imageType,u=A.getDataTypeSize(q),r=Math.ceil(g/l),p=Math.ceil(n/l);b.pixels.numBlocksY=p;b.pixels.numBlocksX=r;var m=b.pixels.ptr=0,y=0,B=0,F=0,N=0,M=0,I=0,Q=0,O=m=0,G=0,S=0,v=I=0;I=I=0;var x=new c(l*l);n=n%l||l;var H=g%l||l,K=h.numDims,D,a=b.pixels.resultMask,f=b.pixels.resultPixels,t=5<=h.fileVersion?14:15,w=h.zMax;for(B=0;B<p;B++)for(N=B!==p-1?l:n,F=0;F<r;F++)for(M=F!==r-1?l:H,G=B*
g*l+F*l,S=g-M,D=0;D<K;D++){1<K?(v=f,G=B*g*l+F*l,f=new c(b.pixels.resultPixels.buffer,k*D*u,k),w=h.maxValues[D]):v=null;I=d.byteLength-b.ptr;y=new DataView(d,b.ptr,Math.min(10,I));var z={};I=0;Q=y.getUint8(0);I++;var E=5<=h.fileVersion?Q&4:0;m=Q>>6&255;O=Q>>2&t;if(O!==(F*l>>3&t))throw"integrity issue";if(E&&0===D)throw"integrity issue";Q&=3;if(3<Q)throw b.ptr+=I,"Invalid block encoding ("+Q+")";if(2===Q){if(E)if(a)for(m=0;m<N;m++)for(y=0;y<M;y++)a[G]&&(f[G]=v[G]),G++;else for(m=0;m<N;m++)for(y=0;y<
M;y++)f[G]=v[G],G++;b.counter.constant++;b.ptr+=I}else if(0===Q){if(E)throw"integrity issue";b.counter.uncompressed++;b.ptr+=I;I=N*M*u;v=d.byteLength-b.ptr;I=I<v?I:v;v=new ArrayBuffer(0===I%u?I:I+u-I%u);E=new Uint8Array(v);E.set(new Uint8Array(d,b.ptr,I));v=new c(v);I=0;if(a)for(m=0;m<N;m++){for(y=0;y<M;y++)a[G]&&(f[G]=v[I++]),G++;G+=S}else for(m=0;m<N;m++){for(y=0;y<M;y++)f[G++]=v[I++];G+=S}b.ptr+=I*u}else if(m=A.getDataTypeUsed(E&&6>q?4:q,m),z=A.getOnePixel(z,I,m,y),I+=A.getDataTypeSize(m),3===
Q)if(b.ptr+=I,b.counter.constantoffset++,a)for(m=0;m<N;m++){for(y=0;y<M;y++)a[G]&&(f[G]=E?Math.min(w,v[G]+z):z),G++;G+=S}else for(m=0;m<N;m++){for(y=0;y<M;y++)f[G]=E?Math.min(w,v[G]+z):z,G++;G+=S}else if(b.ptr+=I,A.decodeBits(d,b,x,z,D),I=0,E)if(a)for(m=0;m<N;m++){for(y=0;y<M;y++)a[G]&&(f[G]=x[I++]+v[G]),G++;G+=S}else for(m=0;m<N;m++){for(y=0;y<M;y++)f[G]=x[I++]+v[G],G++;G+=S}else if(a)for(m=0;m<N;m++){for(y=0;y<M;y++)a[G]&&(f[G]=x[I++]),G++;G+=S}else for(m=0;m<N;m++){for(y=0;y<M;y++)f[G++]=x[I++];
G+=S}}1<K&&!e&&(b.pixels.resultPixels=A.swapDimensionOrder(b.pixels.resultPixels,k,K,c))},formatFileInfo:function(d){return{fileIdentifierString:d.headerInfo.fileIdentifierString,fileVersion:d.headerInfo.fileVersion,imageType:d.headerInfo.imageType,height:d.headerInfo.height,width:d.headerInfo.width,numValidPixel:d.headerInfo.numValidPixel,microBlockSize:d.headerInfo.microBlockSize,blobSize:d.headerInfo.blobSize,maxZError:d.headerInfo.maxZError,pixelType:A.getPixelType(d.headerInfo.imageType),eofOffset:d.eofOffset,
mask:d.mask?{numBytes:d.mask.numBytes}:null,pixels:{numBlocksX:d.pixels.numBlocksX,numBlocksY:d.pixels.numBlocksY,maxValue:d.headerInfo.zMax,minValue:d.headerInfo.zMin,noDataValue:d.noDataValue}}},constructConstantSurface:function(d,b){var c=d.headerInfo.zMax,e=d.headerInfo.zMin,h=d.headerInfo.maxValues,g=d.headerInfo.numDims,n=d.headerInfo.height*d.headerInfo.width,k=0,l=0,q=0,u=d.pixels.resultMask;d=d.pixels.resultPixels;if(u)if(1<g)if(b)for(k=0;k<g;k++)for(q=k*n,c=h[k],l=0;l<n;l++)u[l]&&(d[q+l]=
c);else for(l=0;l<n;l++){if(u[l])for(q=l*g,k=0;k<g;k++)d[q+g]=h[k]}else for(l=0;l<n;l++)u[l]&&(d[l]=c);else if(1<g&&e!==c)if(b)for(k=0;k<g;k++)for(q=k*n,c=h[k],l=0;l<n;l++)d[q+l]=c;else for(l=0;l<n;l++)for(q=l*g,k=0;k<g;k++)d[q+k]=h[k];else for(l=0;l<n*g;l++)d[l]=c},getDataTypeArray:function(d){switch(d){case 0:d=Int8Array;break;case 1:d=Uint8Array;break;case 2:d=Int16Array;break;case 3:d=Uint16Array;break;case 4:d=Int32Array;break;case 5:d=Uint32Array;break;case 6:d=Float32Array;break;case 7:d=Float64Array;
break;default:d=Float32Array}return d},getPixelType:function(d){switch(d){case 0:d="S8";break;case 1:d="U8";break;case 2:d="S16";break;case 3:d="U16";break;case 4:d="S32";break;case 5:d="U32";break;case 6:d="F32";break;case 7:d="F64";break;default:d="F32"}return d},isValidPixelValue:function(d,b){if(null==b)return!1;switch(d){case 0:d=-128<=b&&127>=b;break;case 1:d=0<=b&&255>=b;break;case 2:d=-32768<=b&&32767>=b;break;case 3:d=0<=b&&65536>=b;break;case 4:d=-2147483648<=b&&2147483647>=b;break;case 5:d=
0<=b&&4294967296>=b;break;case 6:d=-3.4027999387901484E38<=b&&3.4027999387901484E38>=b;break;case 7:d=4.9E-324<=b&&1.7976931348623157E308>=b;break;default:d=!1}return d},getDataTypeSize:function(d){var b=0;switch(d){case 0:case 1:b=1;break;case 2:case 3:b=2;break;case 4:case 5:case 6:b=4;break;case 7:b=8;break;default:b=d}return b},getDataTypeUsed:function(d,b){var c=d;switch(d){case 2:case 4:c=d-b;break;case 3:case 5:c=d-2*b;break;case 6:c=0===b?d:1===b?2:1;break;case 7:c=0===b?d:d-2*b+1;break;default:c=
d}return c},getOnePixel:function(d,b,c,e){d=0;switch(c){case 0:d=e.getInt8(b);break;case 1:d=e.getUint8(b);break;case 2:d=e.getInt16(b,!0);break;case 3:d=e.getUint16(b,!0);break;case 4:d=e.getInt32(b,!0);break;case 5:d=e.getUInt32(b,!0);break;case 6:d=e.getFloat32(b,!0);break;case 7:d=e.getFloat64(b,!0);break;default:throw"the decoder does not understand this pixel type";}return d},swapDimensionOrder:function(d,b,c,e,h){var g=0,n=0,k=0,l=0,q=d;if(1<c)if(q=new e(b*c),h)for(g=0;g<b;g++)for(l=g,k=0;k<
c;k++,l+=b)q[l]=d[n++];else for(g=0;g<b;g++)for(l=g,k=0;k<c;k++,l+=b)q[n++]=d[l];return q}},J=function(d,b,c){this.val=d;this.left=b;this.right=c};return{decode:function(d,b){b=b||{};var c=b.noDataValue,e=0,h={};h.ptr=b.inputOffset||0;h.pixels={};if(A.readHeaderInfo(d,h)){e=h.headerInfo;var g=e.fileVersion,n=A.getDataTypeArray(e.imageType);if(5<g)throw"unsupported lerc version 2."+g;A.readMask(d,h);e.numValidPixel===e.width*e.height||h.pixels.resultMask||(h.pixels.resultMask=b.maskData);var k=e.width*
e.height;h.pixels.resultPixels=new n(k*e.numDims);h.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var l=!b.returnPixelInterleavedDims;if(0!==e.numValidPixel)if(e.zMax===e.zMin)A.constructConstantSurface(h,l);else if(4<=g&&A.checkMinMaxRanges(d,h))A.constructConstantSurface(h,l);else{var q=new DataView(d,h.ptr,2),u=q.getUint8(0);h.ptr++;if(u)A.readDataOneSweep(d,h,n,l);else if(1<g&&1>=e.imageType&&1E-5>Math.abs(e.maxZError-.5)){q=q.getUint8(1);h.ptr++;h.encodeMode=
q;if(2<q||4>g&&1<q)throw"Invalid Huffman flag "+q;q?A.readHuffman(d,h,n,l):A.readTiles(d,h,n,l)}else A.readTiles(d,h,n,l)}h.eofOffset=h.ptr;b.inputOffset?(d=h.headerInfo.blobSize+b.inputOffset-h.ptr,1<=Math.abs(d)&&(h.eofOffset=b.inputOffset+h.headerInfo.blobSize)):(d=h.headerInfo.blobSize-h.ptr,1<=Math.abs(d)&&(h.eofOffset=h.headerInfo.blobSize));d={width:e.width,height:e.height,pixelData:h.pixels.resultPixels,minValue:e.zMin,maxValue:e.zMax,validPixelCount:e.numValidPixel,dimCount:e.numDims,dimStats:{minValues:e.minValues,
maxValues:e.maxValues},maskData:h.pixels.resultMask};if(h.pixels.resultMask&&A.isValidPixelValue(e.imageType,c)){g=h.pixels.resultMask;for(e=0;e<k;e++)g[e]||(d.pixelData[e]=c);d.noDataValue=c}h.noDataValue=c;b.returnFileInfo&&(d.fileInfo=A.formatFileInfo(h));return d}},getBandCount:function(d){for(var b=0,c=0,e={ptr:0,pixels:{}};c<d.byteLength-58;)A.readHeaderInfo(d,e),c+=e.headerInfo.blobSize,b++,e.ptr=c;return b}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),
function(L,A,J,d,b,c){L=L(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(e){A.mixin(this,e);this.isDataUV=e&&e.isDataUV?e.isDataUV:!1;this.computeMagnitudeAndDirection=A.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(e,h){this.inputUnit=e;this.outputUnit=h;this.unitConversionFactor=
1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var e=c.indexOf(this.speedUnits,this.inputUnit),h=c.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=e&&0<=h){var g=[1,.277778,.514444,.3048,.44704,0];this.unitConversionFactor=g[e]/g[h]}},computeMagnitudeAndDirection:function(e){if(!b.isDefined(e))throw"Could not compute magnitude and direction. No pixel data is available.";var h=e.pixelBlock;if(!b.isDefined(h)||2!==h.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";
var g=e.extent,n=(g.xmax-g.xmin)/h.width,k=(g.ymax-g.ymin)/h.height,l=g.xmin+n/2;g=g.ymax-k/2;h.statistics[0].minValue=0;h.statistics[0].maxValue=0;var q=180/Math.PI,u=[],r=0,p=0,m=0,y=!b.isDefined(h.mask),B,F,N,M;var I=N=Infinity;var Q=M=-Infinity;for(r=0;r<h.height;r++)for(p=0;p<h.width;p++,m++)if(u.push([l+n*p,g-k*r]),y||h.mask[m]){var O=B=h.pixels[0][m];var G=F=h.pixels[1][m];this.isDataUV&&(O=Math.sqrt(B*B+F*F),G=90-q*Math.atan2(F,B));h.pixels[0][m]=O*this.unitConversionFactor;h.pixels[1][m]=
G;O>Q&&(Q=O);O<I&&(I=O);G>M&&(M=G);G<N&&(N=G)}h.statistics[0].maxValue=Q;h.statistics[0].minValue=I;h.statistics[1].maxValue=M;h.statistics[1].minValue=N;e.locations=u;return e}});J("extend-esri")&&A.setObject("layers.pixelFilters.VectorFieldPixelFilter",L,d);return L})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(L,A,J,d){var b;return A(null,{constructor:function(c){this.ctx=c.ctx;this._loadRasterFormatModule()},
decode:function(c,e){if(!e.width||!e.height)throw"Native decoding requires the image format, width and height";var h=new J,g,n=new Uint8Array(c);c=this._getFormat(c);if("error"===c)throw"invalid format";"jpeg"===c&&(g=this._getMask(n,e));var k="",l;for(l=0;l<n.length;l+=65535){var q=n.subarray(l,l+65535>n.length-1?n.length-1:l+65535);k+=String.fromCharCode.apply(null,q)}n="data:image/"+c+";base64,"+window.btoa(k);var u=new Image,r;u.src=n;var p=this;u.onload=function(){p.ctx.clearRect(0,0,e.width,
e.height);p.ctx.drawImage(u,0,0);var m=p.ctx.getImageData(0,0,u.width,u.height);r=m.data;if(g)for(l=0;l<g.length;l++)r[4*l+3]=g[l]?255:0;p.ctx.putImageData(m,0,0);h.resolve(null)};u.onerror=function(){h.reject("cannot load image")};return h},_getFormat:function(c){c=new Uint8Array(c,0,10);var e="error";255===c[0]&&216===c[1]?e="jpeg":137===c[0]&&80===c[1]&&78===c[2]&&71===c[3]&&(e="png");return e},_getMask:function(c,e){try{if(!b)throw"The zlib decoder module is not loaded.";var h=0,g=0,n=Math.round(c.length/
2);1===n%2&&(n+=1);var k=c.length-2;for(h=n;h<k&&(255!==c[h]||217!==c[h+1]);h++);n=h+=2;if(n<c.length-1){var l=(new b(c.subarray(n))).getBytes();var q=new Uint8Array(e.width*e.height);for(h=c=0;h<l.length;h++)for(g=7;0<=g;g--)q[c++]=l[h]>>g&1}}catch(u){}return q},_loadRasterFormatModule:function(){10>d("ie")||L(["./Zlib"],function(c){b=c})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),
function(L,A,J,d,b,c,e,h){L=L(e,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(g){this._url.path+="/identify";this._handler=A.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(g,n,k,l,q){try{var u=new h(g);this._successHandler([u],"onComplete",k,q)}catch(r){this._errorHandler(r,l,q)}},execute:function(g,n,k,l){var q=l.assembly;g=this._encode(A.mixin({},this._url.query,{f:"json"},g.toJson(q&&q[0])));var u=this._handler,
r=this._errorHandler;return b({url:this._url.path,content:g,callbackParamName:"callback",load:function(p,m){u(p,m,n,k,l.dfd)},error:function(p){r(p,k,l.dfd)}})},onComplete:function(){}});c._createWrappers(L);J("extend-esri")&&A.setObject("tasks.ImageServiceIdentifyTask",L,d);return L})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(L,A,J,d,b,c,e,h){L=L(h,{declaredClass:"esri.tasks._Task",
_eventMap:{error:["error"],complete:["result"]},constructor:function(g,n){g&&A.isString(g)&&(this._url=e.urlToObject(this.url=g));n&&n.requestOptions&&(this.requestOptions=n.requestOptions);this.normalization=!0;this._errorHandler=A.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var g=this._url,n=/^http:/i;this.url&&(this.url=this.url.replace(n,"https:"));g&&g.path&&(g.path=g.path.replace(n,"https:"))},_encode:function(g,n,k){var l={},q;for(q in g)if("declaredClass"!==
q){var u=g[q];var r=typeof u;if(null!==u&&void 0!==u&&"function"!==r)if(A.isArray(u)){l[q]=[];var p=u.length;for(r=0;r<p;r++)l[q][r]=this._encode(u[r])}else"object"===r?u.toJson&&(r=u.toJson(k&&k[q]),"esri.tasks.FeatureSet"===u.declaredClass&&r.spatialReference&&(r.sr=r.spatialReference,delete r.spatialReference),l[q]=n?r:J.toJson(r)):l[q]=u}return l},_successHandler:function(g,n,k,l){n&&this[n].apply(this,g);k&&k.apply(null,g);l&&c._resDfd(l,g)},_errorHandler:function(g,n,k){this.onError(g);n&&n(g);
k&&k.errback(g)},setNormalization:function(g){this.normalization=g},onError:function(){}});d("extend-esri")&&(b.Task=L);return L})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(L,A,J,d,b,c){L=L(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(e){e.catalogItems&&(this.catalogItems=new c(e.catalogItems));e.location&&(this.location=b.fromJson(e.location));
this.catalogItemVisibilities=e.catalogItemVisibilities;this.name=e.name;this.objectId=e.objectId;this.value=e.value;this.processedValues=e.processedValues;this.properties=e.properties}});J("extend-esri")&&A.setObject("tasks.ImageServiceIdentifyResult",L,d);return L})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),
function(L,A,J,d,b,c,e,h,g,n,k,l){L=L(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(q,u){if(q){A.mixin(this,q);var r=this.features=this.features||[],p=q.spatialReference;p=this.spatialReference=k.createInstance(h.simpleConstructor,p);var m=k.getGeometryType(q.geometryType);this.geometryType=q.geometryType;q.fields&&(this.fields=q.fields);q=k.supportsLazyUnquantization(this.geometryType);var y=k.unquantizeFunction(this.geometryType,this.transform),B=!!(u&&q&&y),F=m&&(B?m.accessorConstructor:
m.simpleConstructor);J.forEach(r,function(N,M){var I=k.createInstance(e.simpleConstructor),Q=N.geometry;if(m&&Q){var O=I.geometry=k.createInstance(F,B?null:Q);O.setSpatialReference(Q.spatialReference?k.createInstance(h.simpleConstructor,Q.spatialReference):p);B&&O.setupLazyUnquantization(y,Q)}I.symbol=N.symbol?l.fromJson(N.symbol):null;I.attributes=N.attributes;r[M]=I});B||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(q){var u=
{};this.displayFieldName&&(u.displayFieldName=this.displayFieldName);this.fields&&(u.fields=this.fields);this.spatialReference?u.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(u.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(u.geometryType=k.getJsonType(this.features[0].geometry)),u.features=g._encodeGraphics(this.features,q));u.geometryType=u.geometryType||this.geometryType;u.exceededTransferLimit=
this.exceededTransferLimit;u.transform=this.transform;return c.fixJson(u)},_hydrate:function(){k.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(q){if(!this.geometryType)return this.transform=null,this;var u=q.translate[0],r=q.translate[1],p=q.scale[0],m=q.scale[1],y=this.features,B=function(I,Q,O){var G,S=[];var v=0;for(G=I.length;v<G;v++){var x=I[v];if(0<v){var H=Q(x[0]);x=O(x[1]);if(H!==K||x!==D){S.push([H-K,x-D]);var K=H;var D=x}}else K=Q(x[0]),
D=O(x[1]),S.push([K,D])}return 0<S.length?S:null},F=function(I,Q,O){if("esriGeometryPoint"===I)return function(G){G.x=Q(G.x);G.y=O(G.y);return G};if("esriGeometryPolyline"===I||"esriGeometryPolygon"===I)return function(G){var S;var v=G.rings||G.paths;var x=[];var H=0;for(S=v.length;H<S;H++){var K=v[H];(K=B(K,Q,O))&&x.push(K)}return 0<x.length?(G.rings?G.rings=x:G.paths=x,G):null};if("esriGeometryMultipoint"===I)return function(G){var S=B(G.points,Q,O);return 0<S.length?(G.points=S,G):null};if("esriGeometryEnvelope"===
I)return function(G){return G}}(this.geometryType,function(I){return Math.round((I-u)/p)},function(I){return Math.round((r-I)/m)}),N;var M=0;for(N=y.length;M<N;M++)y[M].geometry&&(F(y[M].geometry)||y[M].setGeometry(null));this.transform=q;return this}});L.createGraphics=function(q){var u=q.geometryType,r=k.createInstance(h.simpleConstructor,q.spatialReference),p=k.getGeometryType(u).accessorConstructor,m=k.unquantizeFunction(u,q.transform);return J.map(q.features,function(y,B){B=k.createInstance(e.simpleConstructor);
var F=y.geometry;if(F){var N=B.geometry=k.createInstance(p);N.setSpatialReference(r);N.setupLazyUnquantization(m,F)}B.attributes=y.attributes;return B})};L.createPolygon=function(q,u,r){if(q){var p=k.createInstance(n.accessorConstructor);p.setSpatialReference(u);u=k.unquantizeFunction("esriGeometryPolygon",r);p.setupLazyUnquantization(u,q)}return p};d("extend-esri")&&A.setObject("tasks.FeatureSet",L,b);return L})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),
function(L,A,J,d,b,c,e,h){L=L(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,maxItemCount:null,returnPixelValues:!0,toJson:function(g){var n=g&&g.geometry||this.geometry;g={geometry:n,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?J.toJson(this.mosaicRule.toJson()):
null,renderingRule:this.renderingRule?J.toJson(this.renderingRule.toJson()):null};n&&(g.geometryType=h.getJsonType(n));n=this.timeExtent;g.time=n?n.toJson().join(","):null;e.isDefined(this.pixelSizeX)&&e.isDefined(this.pixelSizeY)?g.pixelSize=J.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(g.pixelSize=this.pixelSize?J.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(g.renderingRules=J.toJson(d.map(this.renderingRules,function(k){return k.toJson()})));
e.isDefined(this.returnPixelValues)&&(g.returnPixelValues=this.returnPixelValues);e.isDefined(this.maxItemCount)&&(g.maxItemCount=this.maxItemCount);return g}});b("extend-esri")&&A.setObject("tasks.ImageServiceIdentifyParameters",L,c);return L})},"esri/layers/pixelFilters/StretchFilter":function(){define(["dojo/_base/declare","dojo/_base/lang","../PixelBlock"],function(L,A,J){var d;return L(null,{stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,
maxPercent:.5,useGamma:!1,gamma:null,raster:null,outputPixelType:"U8",computeGamma:!1,constructor:function(b){this.stretchType=b.stretchType||b.StretchType||this.stretchType;this.min=b.min||b.Min||this.min;this.max=b.max||b.Max||this.max;this.numberOfStandardDeviations=b.numberOfStandardDeviations||b.NumberOfStandardDeviations||this.numberOfStandardDeviations;this.statistics=b.statistics||b.Statistics||this.statistics;this.dra=b.dra||b.DRA||b.dRA||this.dra;this.minPercent=b.minPercent||b.MinPercent||
this.minPercent;this.maxPercent=b.maxPercent||b.MaxPercent||this.maxPercent;this.useGamma=b.useGamma||b.UseGamma||this.useGamma;this.gamma=b.gamma||b.Gamma||this.gamma;this.computeGamma=b.computeGamma||b.ComputeGamma||this.computeGamma;this.raster=b.raster||b.Raster||this.raster;this.outputPixelType=b.outputPixelType||b.OutputPixelType||this.outputPixelType;this.raster=b.raster||b.Raster||this.raster;d=this},filter:function(b){if(void 0!==b&&null!==b&&null!==b.pixelBlock&&null!==b.pixelBlock.pixels){var c=
b.pixelBlock,e=c.pixels,h=c.width*c.height,g=e.length,n;(n=6===d.stretchType||3===d.stretchType&&d.dra)&&d._calculateStatisticsHistograms(b);if(d.dra)if(n)d._statistics=c.statistics,d._histograms=c.histograms;else{var k=c.statistics;d._statistics=[];for(n=0;n<g;n++)d._statistics[n]=[k[n].minValue,k[n].maxValue,0,0]}else d._statistics=d.statistics,d._histograms=d.histograms;d.computeGamma&&(d.gamma=d._computeGammaValues(c.pixelType),d.useGamma=!0);d._createLUT(b);if(void 0===d.LUT||null===d.LUT)return d._filterNoLUT(b);
k=d.LUT;var l=d.LUTOffset;for(n=0;n<g;n++){var q=k[n];for(c=0;c<h;c++){var u=e[n][c];e[n][c]=q[u-l]}}b.pixelBlock.pixelType="U8";return b}},_calculateStatisticsHistograms:function(b){b=b.pixelBlock;var c=b.pixelType,e=b.pixels,h=b.mask,g=e.length,n,k,l=function(M){this.min=-.5;this.max=255.5;this.size=256;A.mixin(this,M);this.counts=this.counts||new Uint32Array(this.size)},q=[],u,r;for(n=0;n<g;n++){var p=new l;var m=p.counts;var y=e[n];if("U8"===c)if(h)for(k=0;k<b.width*b.height;k++)h[k]&&m[y[k]]++;
else for(k=0;k<b.width*b.height;k++)m[y[k]]++;else{var B=b.statistics[n].minValue;var F=b.statistics[n].maxValue;p.min=B;p.max=F;F=(F-B)/256;var N=new Uint32Array(257);if(h)for(k=0;k<b.width*b.height;k++)h[k]&&N[Math.floor((y[k]-B)/F)]++;else for(k=0;k<b.width*b.height;k++)N[Math.floor((y[k]-B)/F)]++;for(k=0;255>k;k++)m[k]=N[k];m[255]=N[255]+N[256]}q.push(p);y=[];B=b.statistics[n].minValue;F=b.statistics[n].maxValue;for(k=r=u=N=0;k<p.size;k++)N+=m[k],u+=k*m[k];u/=N;for(k=0;k<p.size;k++)r+=m[k]*Math.pow(k-
u,2);m=Math.sqrt(r/(N-1));k=(u+.5)*(p.max-p.min)/p.size+p.min;p=m*(p.max-p.min)/p.size;y.push(B);y.push(F);y.push(k);y.push(p);b.statistics[n]=y}b.histograms=q},_getCutOffPoints:function(b){b=b.pixelBlock.pixels.length;var c=[],e=[],h,g,n;switch(d.stretchType){case 5:for(g=0;g<b;g++)c[g]=d._statistics[g][0],e[g]=d._statistics[g][1];break;case 3:for(g=0;g<b;g++)c[g]=d._statistics[g][2]-d.numberOfStandardDeviations*d._statistics[g][3],e[g]=d._statistics[g][2]+d.numberOfStandardDeviations*d._statistics[g][3],
c[g]<d._statistics[g][0]&&(c[g]=d._statistics[g][0]),e[g]>d._statistics[g][1]&&(e[g]=d._statistics[g][1]);break;case 6:for(g=0;g<b;g++){var k=d._histograms[g];var l=new Uint32Array(k.size);var q=k.counts;for(n=h=0;n<k.size;n++)h+=q[n],l[n]=h;q=d.minPercent*h/100;for(n=1;n<k.size;n++)if(l[n]>q){c[g]=k.min+(k.max-k.min)/k.size*(n-.5);break}q=(1-d.maxPercent/100)*h;for(n=k.size-2;0<=n;n--)if(l[n]<q){e[g]=k.min+(k.max-k.min)/k.size*(n+.5);break}}break;default:for(g=0;g<b;g++)c[g]=0,e[g]=255}return{minCutOff:c,
maxCutOff:e}},_createLUT:function(b){var c=b.pixelBlock,e=c.pixelType;if("U8"===e||"U16"===e||"S8"===e||"S16"===e){if(d._LUTSignature&&(e=d._computeLutSignature(),e.length===d._LUTSignature.length&&!e.some(function(I,Q){return I!==d._LUTSignature[Q]})))return;e=c.pixels.length;var h=[],g=[],n=[],k,l=d.max,q=d.min,u=d.gamma,r=l-q,p=d._getCutOffPoints(b);b=p.minCutOff;p=p.maxCutOff;var m=0,y=256;"S8"===c.pixelType?m=-127:"S16"===c.pixelType&&(m=-32767);if("U16"===c.pixelType||"S16"===c.pixelType)y=
65536;for(c=0;c<e;c++)h[c]=p[c]-b[c];if(d.useGamma&&null!==u&&u.length===e)for(c=0;c<e;c++)n[c]=1<u[c]?2<u[c]?6.5+Math.pow(u[c]-2,2.5):6.5+100*Math.pow(2-u[c],4):1;if(d.useGamma)for(c=0;c<e;c++){var B=[];for(k=0;k<y;k++){var F=k+m;var N=(F-b[c])/h[c];var M=1;1<u[c]&&(M-=Math.pow(1/r,N*n[c]));F<p[c]&&F>b[c]?B[k]=Math.floor(M*r*Math.pow(N,1/u[c]))+q:F>p[c]?B[k]=l:F<b[c]&&(B[k]=q)}g[c]=B}else for(c=0;c<e;c++){B=[];for(k=0;k<y;k++)F=k+m,B[k]=F<b[c]?q:F>p[c]?l:Math.floor((F-b[c])/h[c]*r)+q;g[c]=B}d.LUT=
g;d.LUTOffset=m;d._LUTSignature=d._computeLutSignature()}},_computeLutSignature:function(){var b=[],c,e;b.push(d.stretchType);b.push(d.min);b.push(d.max);b.push(d.numberOfStandardDeviations);if(d._statistics)for(c=0;c<d._statistics.length;c++)for(e=0;e<d._statistics[c].length;e++)b.push(d._statistics[c][e]);b.push(d.dra?1:0);b.push(d.minPercent);b.push(d.maxPercent);if(d.gamma)for(c=0;c<d._statistics.length;c++)b.push(d.gamma[c]);b.push(d.useGamma?1:0);return b},_filterNoLUT:function(b){if(null!==
b&&null!==b.pixelBlock&&null!==b.pixelBlock.pixels){var c=b.pixelBlock,e=c.pixels,h=c.mask;c=c.width*c.height;var g=e.length,n=[],k=[],l,q=d.max,u=d.min,r=d.gamma,p=q-u;var m=d._getCutOffPoints(b);var y=m.minCutOff,B=m.maxCutOff;for(m=0;m<g;m++)n[m]=B[m]-y[m];if(d.useGamma&&null!==r&&r.length===g)for(m=0;m<g;m++)k[m]=1<r[m]?2<r[m]?6.5+Math.pow(r[m]-2,2.5):6.5+100*Math.pow(2-r[m],4):1;if(d.useGamma)if(void 0!==h&&null!==h)for(l=0;l<c;l++){if(h[l])for(m=0;m<g;m++){var F=e[m][l];var N=(F-y[m])/n[m];
var M=1;1<r[m]&&(M-=Math.pow(1/p,N*k[m]));F<B[m]&&F>y[m]?e[m][l]=Math.floor(M*p*Math.pow(N,1/r[m]))+u:F>B[m]?e[m][l]=q:F<y[m]&&(e[m][l]=u)}}else for(l=0;l<c;l++)for(m=0;m<g;m++)F=e[m][l],N=(F-y[m])/n[m],M=1,1<r[m]&&(M-=Math.pow(1/p,N*k[m])),F<B[m]&&F>y[m]?e[m][l]=Math.floor(M*p*Math.pow(N,1/r[m]))+u:F>B[m]?e[m][l]=q:F<y[m]&&(e[m][l]=u);else if(void 0!==h&&null!==h)for(l=0;l<c;l++){if(h[l])for(m=0;m<g;m++)F=e[m][l],F<B[m]&&F>y[m]?e[m][l]=Math.floor((F-y[m])/n[m]*p)+u:F>B[m]?e[m][l]=q:F<y[m]&&(e[m][l]=
u)}else for(l=0;l<c;l++)for(m=0;m<g;m++)F=e[m][l],F<B[m]&&F>y[m]?e[m][l]=Math.floor((F-y[m])/n[m]*p)+u:F>B[m]?e[m][l]=q:F<y[m]&&(e[m][l]=u);b.pixelBlock.pixelType="U8";return b}},_computeGammaValues:function(b){var c=this._statistics.length,e,h=[];for(e=0;e<c;e++){var g=this._statistics[e][2];"U8"!==b&&(g=255*(g-this._statistics[e][0])/(this._statistics[e][1]-this._statistics[e][0]));h.push(this._computeGammaValue(g))}return h},_computeGammaValue:function(b){if(0!==b&&!(255<b||0>b)){var c=0;0<b&&
150!=b&&255>b&&(c=150>=b?45*Math.cos(.01047*b):17*Math.sin(.021*b));c=Math.log((b+c)/255);if(0!==c&&(b=Math.log(b/255)/c,!isNaN(b)))return Math.min(9.9,Math.max(.01,b))}}})})},"*noref":1}});
define("esri/layers/RasterLayer","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../kernel ../lang ../domUtils ./BaseRasterLayer ./ImageServiceLayerMixin ./pixelFilters/StretchFilter ../SpatialReference ../geometry/Point".split(" "),function(L,A,J,d,b,c,e,h,g,n,k,l,q,u,r,p){L=L([l,q],{declaredClass:"esri.layers.RasterLayer",constructor:function(m,y){this.pixelData=null;null!==this.format&&void 0!==this.format||this.setImageFormat("LERC",
!0)},_setDefaultFilter:function(){if(this.loaded&&this.drawType&&!this._isVectorData()&&(!this.pixelFilter||this._isDefaultPixelFilter))if("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))this._isDefaultPixelFilter&&(this.pixelFilter=null,this._isDefaultPixelFilter=!1);else{var m;if(this.minValues&&this.maxValues&&this.stdvValues&&this.meanValues){var y=[];for(m=0;m<this.minValues.length;m++)y.push([this.minValues[m],this.maxValues[m],
this.meanValues[m],this.stdvValues[m]]);this.bandCount!==y.length&&(y=null)}m=0;var B=!1;"U8"===this.pixelType?(m=5,B=y?!1:!0):y?(m=5,B=!1):(m=6,B=!0);this.renderingRule&&(m=5,B=!0);this.pixelFilter=(new u({stretchType:m,min:0,max:255,dra:B,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,statistics:y,numberOfStandardDeviations:2.5})).filter;this._isDefaultPixelFilter=!0}}});b("extend-esri")&&A.setObject("layers.RasterLayer",L,g);return L});