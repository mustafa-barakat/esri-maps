// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
/*
 @esri/arcgis-html-sanitizer - v2.7.0 - Wed Jul 14 2021 13:34:33 GMT-0400 (Eastern Daylight Time)
 Copyright (c) 2021 - Environmental Systems Research Institute, Inc.
 Apache-2.0

 js-xss
 Copyright (c) 2012-2017 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 http://ucdok.com
 MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details

 Lodash/isPlainObject
 Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
*/
require({cache:{"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(L,J,q,K,E,w,x,A){var n=J("dijit._TemplatedMixin",A,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(g){var m=this.declaredClass,l=this;return x.substitute(g,this,function(f,b){"!"==b.charAt(0)&&(f=K.getObject(b.substr(1),!1,l));if("undefined"==typeof f)throw Error(m+
" template:"+b);return null==f?"":"!"==b.charAt(0)?f:this._escapeValue(""+f)},this)},_escapeValue:function(g){return g.replace(/["'<>&]/g,function(m){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[m]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=L(this.templatePath,{sanitize:!0}));var g=n.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument);if(K.isString(g)){var m=q.toDom(this._stringRepl(g),
this.ownerDocument);if(1!=m.nodeType)throw Error("Invalid template: "+g);}else m=g.cloneNode(!0);this.domNode=m}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(g){var m=this.containerNode;if(g&&m)for(;g.hasChildNodes();)m.appendChild(g.firstChild)}});n._templateCache={};n.getCachedTemplate=function(g,m,l){var f=n._templateCache,b=g,c=f[b];if(c){try{if(!c.ownerDocument||c.ownerDocument==(l||document))return c}catch(a){}q.destroy(c)}g=
x.trim(g);if(m||g.match(/\$\{([^\}]+)\}/g))return f[b]=g;m=q.toDom(g,l);if(1!=m.nodeType)throw Error("Invalid template: "+g);return f[b]=m};w("ie")&&E(window,"unload",function(){var g=n._templateCache,m;for(m in g){var l=g[m];"object"==typeof l&&q.destroy(l);delete g[m]}});return n})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(L){return L.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),
function(L,J,q,K,E,w,x,A,n){var g=E.delegate(A,{mouseenter:w.enter,mouseleave:w.leave,keypress:q._keypress}),m;q=K("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(l){for(var f=l;;)if(1==f.nodeType&&(this._processTemplateNode(f,function(b,c){return b.getAttribute(c)},this._attach)||
this.searchContainerNode)&&f.firstChild)f=f.firstChild;else{if(f==l)break;for(;!f.nextSibling;)if(f=f.parentNode,f==l)return;f=f.nextSibling}},_processTemplateNode:function(l,f,b){var c=!0,a=this.attachScope||this,e=f(l,"dojoAttachPoint")||f(l,"data-dojo-attach-point");if(e)for(var d=e.split(/\s*,\s*/);e=d.shift();)E.isArray(a[e])?a[e].push(l):a[e]=l,c="containerNode"!=e,this._attachPoints.push(e);if(f=f(l,"dojoAttachEvent")||f(l,"data-dojo-attach-event"))for(e=f.split(/\s*,\s*/),d=E.trim;f=e.shift();)if(f){var h=
null;-1!=f.indexOf(":")?(h=f.split(":"),f=d(h[0]),h=d(h[1])):f=d(f);h||(h=f);this._attachEvents.push(b(l,f,E.hitch(a,h)))}return c},_attach:function(l,f,b){f=f.replace(/^on/,"").toLowerCase();f="dijitclick"==f?m||(m=L("./a11yclick")):g[f]||f;return x(l,f,b)},_detachTemplateNodes:function(){var l=this.attachScope||this;J.forEach(this._attachPoints,function(f){delete l[f]});this._attachPoints=[];J.forEach(this._attachEvents,function(f){f.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();
this.inherited(arguments)}});E.extend(n,{dojoAttachEvent:"",dojoAttachPoint:""});return q})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(L,J,
q,K,E,w,x,A,n,g,m,l,f,b,c,a,e,d,h,y,I,H,u){function G(t){return function(F){A[F?"set":"remove"](this.domNode,t,F);this._set(t,F)}}f.add("dijit-legacy-requires",!b.isAsync);f.add("dojo-bidi",!1);f("dijit-legacy-requires")&&e(0,function(){L(["dijit/_base/manager"])});var v={};K=w("dijit._WidgetBase",[d,I],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:G("lang"),dir:"",_setDirAttr:G("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",
srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(t){this._set("ownerDocument",t)},attributeMap:{},_blankGif:K.blankGif||L.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var t=this.constructor;if(!t._setterAttrs){var F=t.prototype,B=t._setterAttrs=[];t=t._onMap={};for(var O in F.attributeMap)B.push(O);for(O in F)/^on/.test(O)&&(t[O.substring(2).toLowerCase()]=O),/^_set[A-Z](.*)Attr$/.test(O)&&(O=O.charAt(4).toLowerCase()+O.substr(5,
O.length-9),F.attributeMap&&O in F.attributeMap||B.push(O))}},postscript:function(t,F){this.create(t,F)},create:function(t,F){this._introspect();this.srcNodeRef=x.byId(F);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);t&&(this.params=t,c.mixin(this,t));this.postMixInProperties();this.id||(this.id=u.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=
this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=y.body(this.ownerDocument);u.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();if((t=this.srcNodeRef)&&t.parentNode&&this.domNode!==t){t.parentNode.replaceChild(this.domNode,t);var B=!0}this.domNode.setAttribute("widgetId",this.id)}this.postCreate();B&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var t={},F;for(F in this.params||{})t[F]=this._get(F);J.forEach(this.constructor._setterAttrs,
function(B){if(!(B in t)){var O=this._get(B);O&&this.set(B,O)}},this);for(F in t)this.set(F,t[F])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var t=this.baseClass.split(" ");this.isLeftToRight()||(t=t.concat(J.map(t,function(F){return F+"Rtl"})));n.add(this.domNode,t)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,J.forEach(this.getChildren(),function(t){t._started||
t._destroyed||!c.isFunction(t.startup)||(t.startup(),t._started=!0)}))},destroyRecursive:function(t){this._beingDestroyed=!0;this.destroyDescendants(t);this.destroy(t)},destroy:function(t){function F(B){B.destroyRecursive?B.destroyRecursive(t):B.destroy&&B.destroy(t)}this._beingDestroyed=!0;this.uninitialize();J.forEach(this._connects,c.hitch(this,"disconnect"));J.forEach(this._supportingWidgets,F);this.domNode&&J.forEach(u.findWidgets(this.domNode,this.containerNode),F);this.destroyRendering(t);
u.remove(this.id);this._destroyed=!0},destroyRendering:function(t){this.bgIframe&&(this.bgIframe.destroy(t),delete this.bgIframe);this.domNode&&(t?A.remove(this.domNode,"widgetId"):g.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(t||g.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(t){J.forEach(this.getChildren(),function(F){F.destroyRecursive&&F.destroyRecursive(t)})},uninitialize:function(){return!1},_setStyleAttr:function(t){var F=this.domNode;c.isObject(t)?
l.set(F,t):F.style.cssText=F.style.cssText?F.style.cssText+("; "+t):t;this._set("style",t)},_attrToDom:function(t,F,B){B=3<=arguments.length?B:this.attributeMap[t];J.forEach(c.isArray(B)?B:[B],function(O){var M=this[O.node||O||"domNode"];switch(O.type||"attribute"){case "attribute":c.isFunction(F)&&(F=c.hitch(this,F));O=O.attribute?O.attribute:/^on[A-Z][a-zA-Z]*$/.test(t)?t.toLowerCase():t;M.tagName?A.set(M,O,F):M.set(O,F);break;case "innerText":M.innerHTML="";M.appendChild(this.ownerDocument.createTextNode(F));
break;case "textContent":M.textContent=F;break;case "innerHTML":M.innerHTML=F;break;case "class":n.replace(M,F,this[t]);break;case "toggleClass":n.toggle(M,O.className||t,F)}},this)},get:function(t){var F=this._getAttrNames(t);return this[F.g]?this[F.g]():this._get(t)},set:function(t,F){if("object"===typeof t){for(var B in t)this.set(B,t[B]);return this}B=this._getAttrNames(t);var O=this[B.s];if(c.isFunction(O))var M=O.apply(this,Array.prototype.slice.call(arguments,1));else{O=this.focusNode&&!c.isFunction(this.focusNode)?
"focusNode":"domNode";var C=this[O]&&this[O].tagName,W;if((W=C)&&!(W=v[C])){W=this[O];var Y={};for(R in W)Y[R.toLowerCase()]=!0;W=v[C]=Y}var R=W;B=t in this.attributeMap?this.attributeMap[t]:B.s in this?this[B.s]:R&&B.l in R&&"function"!=typeof F||/^aria-|^data-|^role$/.test(t)?O:null;null!=B&&this._attrToDom(t,F,B);this._set(t,F)}return M||this},_attrPairNames:{},_getAttrNames:function(t){var F=this._attrPairNames;if(F[t])return F[t];var B=t.replace(/^[a-z]|-[a-zA-Z]/g,function(O){return O.charAt(O.length-
1).toUpperCase()});return F[t]={n:t+"Node",s:"_set"+B+"Attr",g:"_get"+B+"Attr",l:B.toLowerCase()}},_set:function(t,F){var B=this[t];this[t]=F;!this._created||B===F||B!==B&&F!==F||(this._watchCallbacks&&this._watchCallbacks(t,B,F),this.emit("attrmodified-"+t,{detail:{prevValue:B,newValue:F}}))},_get:function(t){return this[t]},emit:function(t,F,B){F=F||{};void 0===F.bubbles&&(F.bubbles=!0);void 0===F.cancelable&&(F.cancelable=!0);F.detail||(F.detail={});F.detail.widget=this;var O,M=this["on"+t];M&&
(O=M.apply(this,B?B:[F]));this._started&&!this._beingDestroyed&&a.emit(this.domNode,t.toLowerCase(),F);return O},on:function(t,F){var B=this._onMap(t);return B?q.after(this,B,F,!0):this.own(a(this.domNode,t,F))[0]},_onMap:function(t){var F=this.constructor,B=F._onMap;if(!B){B=F._onMap={};for(var O in F.prototype)/^on/.test(O)&&(B[O.replace(/^on/,"").toLowerCase()]=O)}return B["string"==typeof t&&t.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},
getChildren:function(){return this.containerNode?u.findWidgets(this.containerNode):[]},getParent:function(){return u.getEnclosingWidget(this.domNode.parentNode)},connect:function(t,F,B){return this.own(E.connect(t,F,this,B))[0]},disconnect:function(t){t.remove()},subscribe:function(t,F){return this.own(h.subscribe(t,c.hitch(this,F)))[0]},unsubscribe:function(t){t.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():m.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&
"none"!=l.get(this.domNode,"display")},placeAt:function(t,F){var B=!t.tagName&&u.byId(t);!B||!B.addChild||F&&"number"!==typeof F?(t=B&&"domNode"in B?B.containerNode&&!/after|before|replace/.test(F||"")?B.containerNode:B.domNode:x.byId(t,this.ownerDocument),g.place(this.domNode,t,F),!this._started&&(this.getParent()||{})._started&&this.startup()):B.addChild(this,F);return this},defer:function(t,F){var B=setTimeout(c.hitch(this,function(){B&&(B=null,this._destroyed||c.hitch(this,t)())}),F||0);return{remove:function(){B&&
(clearTimeout(B),B=null);return null}}}});f("dojo-bidi")&&K.extend(H);return K})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(L,J,q){return q("dijit.Destroyable",null,{destroy:function(K){this._destroyed=!0},own:function(){var K=["destroyRecursive","destroy","remove"];L.forEach(arguments,function(E){function w(){x.remove();L.forEach(A,function(g){g.remove()})}var x=J.before(this,"destroy",function(g){E[n](g)}),A=[];if(E.then){var n="cancel";
E.then(w,w)}else L.forEach(K,function(g){"function"===typeof E[g]&&(n||(n=g),A.push(J.after(E,g,w,!0)))})},this);return arguments}})})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a,e,d,h){function y(H){return function(u){this._isLoaded?this.inherited(H,arguments):this.loadDropDown(A.hitch(this,H,u))}}var I=J("dijit.form._SelectMenu",f,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(n(this.domNode,"selectstart",function(H){H.preventDefault();H.stopPropagation()}))},focus:function(){var H=!1,u=this.parentWidget.value;
A.isArray(u)&&(u=u[u.length-1]);u&&L.forEach(this.parentWidget._getChildren(),function(G){G.option&&u===G.option.value&&(H=!0,this.focusChild(G,!1))},this);H||this.inherited(arguments)}});E=J("dijit.form.Select"+(g("dojo-bidi")?"_NoBidi":""),[m,l,e],{baseClass:"dijitSelect dijitValidationTextBox",templateString:h,_buttonInputDisabled:g("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var H=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=H?H:0].value)}this.dropDown=new I({id:this.id+"_menu",parentWidget:this});K.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(H){if(H.value||H.label){var u=A.hitch(this,"_setValueAttr",H);H=new b({option:H,label:("text"===this.labelType?(H.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):H.label)||this.emptyLabel,
onClick:u,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:H.disabled||!1});H.focusNode.setAttribute("role","option");return H}return new c({ownerDocument:this.ownerDocument})},_addOptionItem:function(H){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(H))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(H){}},focusChild:function(H){H&&this.set("value",
H.option)},_getFirst:function(){var H=this._getChildren();return H.length?H[0]:null},_getLast:function(){var H=this._getChildren();return H.length?H[H.length-1]:null},childSelector:function(H){return(H=d.byNode(H))&&H.getParent()==this.dropDown},onKeyboardSearch:function(H,u,G,v){H&&this.focusChild(H)},_loadChildren:function(H){if(!0===H)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{L.forEach(this._getChildren(),function(G){G.destroyRecursive()});
var u=new b({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(u)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(H){this.inherited(arguments);q.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",
_setDisabledAttr:function(H){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(H){this._set("required",H);this.focusNode.setAttribute("aria-required",H);this._refreshState()},_setOptionsAttr:function(H){this._isLoaded=!1;this._set("options",H)},_setDisplay:function(H){H=("text"===this.labelType?(H||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):H)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+H+"\x3c/span\x3e"},validate:function(H){H=this.disabled||this.isValid(H);this._set("state",H?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",H?"false":"true");var u=H?"":this._missingMsg;u&&this.focused&&this._hasBeenBlurred?a.show(u,this.domNode,this.tooltipPosition,!this.isLeftToRight()):a.hide(this.domNode);this._set("message",u);return H},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);a.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=w.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(n(this.domNode,"selectstart",function(u){u.preventDefault();u.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var H=this._keyNavCodes;delete H[x.LEFT_ARROW];delete H[x.RIGHT_ARROW]},_setStyleAttr:function(H){this.inherited(arguments);
K.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(H){this._loadChildren(!0);this._isLoaded=!0;H()},destroy:function(H){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(H),delete this.dropDown);a.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){a.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
g("dojo-bidi")&&(E=J("dijit.form.Select",E,{_setDisplay:function(H){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));E._Menu=I;E.prototype._onContainerKeydown=y("_onContainerKeydown");E.prototype._onContainerKeypress=y("_onContainerKeypress");return E})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f){return E("dijit.form._FormSelectWidget",f,{multiple:!1,options:null,store:null,_setStoreAttr:function(b){this._created&&this._deprecatedSetStore(b)},query:null,_setQueryAttr:function(b){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:b})},queryOptions:null,_setQueryOptionsAttr:function(b){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:b})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(b){var c=this.options||[];if(null==b)return c;if(n.isArrayLike(b))return L.map(b,"return this.getOptions(item);",this);n.isString(b)&&(b={value:b});n.isObject(b)&&(L.some(c,function(a,e){for(var d in b)if(!(d in a)||a[d]!=b[d])return!1;b=e;return!0})||(b=-1));return 0<=b&&b<c.length?c[b]:null},addOption:function(b){L.forEach(n.isArrayLike(b)?b:[b],function(c){c&&n.isObject(c)&&this.options.push(c)},this);this._loadChildren()},removeOption:function(b){b=this.getOptions(n.isArrayLike(b)?
b:[b]);L.forEach(b,function(c){c&&(this.options=L.filter(this.options,function(a){return a.value!==c.value||a.label!==c.label}),this._removeOptionItem(c))},this);this._loadChildren()},updateOption:function(b){L.forEach(n.isArrayLike(b)?b:[b],function(c){var a=this.getOptions({value:c.value}),e;if(a)for(e in c)a[e]=c[e]},this);this._loadChildren()},setStore:function(b,c,a){A.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(b,c,a)},_deprecatedSetStore:function(b,c,a){var e=this.store;a=a||{};if(e!==b){for(var d;d=this._notifyConnections.pop();)d.remove();b.get||(n.mixin(b,{_oldAPI:!0,get:function(h){var y=new J;this.fetchItemByIdentity({identity:h,onItem:function(I){y.resolve(I)},onError:function(I){y.reject(I)}});return y.promise},query:function(h,y){var I=new J(function(){H.abort&&H.abort()});I.total=new J;var H=this.fetch(n.mixin({query:h,onBegin:function(u){I.total.resolve(u)},
onComplete:function(u){I.resolve(u)},onError:function(u){I.reject(u)}},y));return new l(I)}}),b.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[q.after(b,"onNew",n.hitch(this,"_onNewItem"),!0),q.after(b,"onDelete",n.hitch(this,"_onDeleteItem"),!0),q.after(b,"onSet",n.hitch(this,"_onSetItem"),!0)]));this._set("store",b)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);a.query&&this._set("query",a.query);a.queryOptions&&this._set("queryOptions",a.queryOptions);b&&b.query&&(this._loadingStore=!0,this.onLoadDeferred=new J,this._queryRes=b.query(this.query,this.queryOptions),m(this._queryRes,n.hitch(this,function(h){if(this.sortByLabel&&!a.sort&&h.length)if(b.getValue)h.sort(K.createSortFunction([{attribute:b.getLabelAttributes(h[0])[0]}],b));else{var y=this.labelAttr;h.sort(function(I,H){return I[y]>H[y]?1:H[y]>
I[y]?-1:0})}a.onFetch&&(h=a.onFetch.call(this,h,a));L.forEach(h,function(I){this._addOptionForItem(I)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(n.hitch(this,function(I,H,u){H==u?this._onSetItem(I):(-1!=H&&this._onDeleteItem(I),-1!=u&&this._onNewItem(I))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:c);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(h):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),n.hitch(this,function(h){console.error("dijit.form.Select: "+h.toString());this.onLoadDeferred.reject(h)})));return e},_setValueAttr:function(b,c){this._onChangeActive||(c=null);if(this._loadingStore)this._pendingValue=b;else if(null!=b){b=n.isArrayLike(b)?L.map(b,function(d){return n.isObject(d)?d:{value:d}}):n.isObject(b)?[b]:[{value:b}];b=L.filter(this.getOptions(b),function(d){return d&&d.value});var a=this.getOptions()||[];this.multiple||b[0]&&b[0].value||!a.length||(b[0]=
a[0]);L.forEach(a,function(d){d.selected=L.some(b,function(h){return h.value===d.value})});a=L.map(b,function(d){return d.value});if("undefined"!=typeof a&&"undefined"!=typeof a[0]){var e=L.map(b,function(d){return d.label});this._setDisplay(this.multiple?e:e[0]);this.inherited(arguments,[this.multiple?a:a[0],c]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var b=L.map([].concat(this.get("selectedOptions")),function(c){return c&&"label"in c?c.label:c?c.value:null},this);return this.multiple?
b:b[0]},_setDisplayedValueAttr:function(b){this.set("value",this.getOptions("string"==typeof b?{label:b}:b))},_loadChildren:function(){this._loadingStore||(L.forEach(this._getChildren(),function(b){b.destroyRecursive()}),L.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var b=[].concat(this.value);if(b&&b[0]){var c=this;L.forEach(this._getChildren(),function(a){var e=L.some(b,function(d){return a.option&&
d===a.option.value});e&&!c.multiple&&(c.focusedChild=a);x.toggle(a.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),e);a.domNode.setAttribute("aria-selected",e?"true":"false")},this)}},_getValueFromOpts:function(){var b=this.getOptions()||[];if(!this.multiple&&b.length){var c=L.filter(b,function(a){return a.selected})[0];if(c&&c.value)return c.value;b[0].selected=!0;return b[0].value}return this.multiple?L.map(L.filter(b,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(b,c){c&&c.parent||this._addOptionForItem(b)},_onDeleteItem:function(b){this.removeOption({value:this.store.getIdentity(b)})},_onSetItem:function(b){this.updateOption(this._getOptionObjForItem(b))},_getOptionObjForItem:function(b){var c=this.store,a=this.labelAttr&&this.labelAttr in b?b[this.labelAttr]:c.getLabel(b);return{value:a?c.getIdentity(b):null,label:a,item:b}},_addOptionForItem:function(b){var c=this.store;c.isItemLoaded&&!c.isItemLoaded(b)?c.loadItem({item:b,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(b=this._getOptionObjForItem(b),this.addOption(b))},constructor:function(b){this._oValue=(b||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);w.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?g("\x3e *",this.srcNodeRef).map(function(b){return"separator"===b.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:b.getAttribute("data-"+A._scopeName+"-value")||b.getAttribute("value"),
label:String(b.innerHTML),selected:b.getAttribute("selected")||!1,disabled:b.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);q.after(this,"onChange",n.hitch(this,"_updateSelection"));var b=this.store;b&&(b.getIdentity||b.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(b,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var b;b=this._notifyConnections.pop();)b.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(L){var J={};L.setObject("dojo.data.util.sorter",J);J.basicComparator=function(q,K){var E=-1;null===q&&(q=void 0);null===K&&(K=void 0);if(q==K)E=0;else if(q>K||null==q)E=1;return E};J.createSortFunction=function(q,K){function E(f,b,c,a){return function(e,d){e=a.getValue(e,f);d=a.getValue(d,f);
return b*c(e,d)}}for(var w=[],x,A=K.comparatorMap,n=J.basicComparator,g=0;g<q.length;g++){x=q[g];var m=x.attribute;if(m){x=x.descending?-1:1;var l=n;A&&("string"!==typeof m&&"toString"in m&&(m=m.toString()),l=A[m]||n);w.push(E(m,x,l,K))}}return function(f,b){for(var c=0;c<w.length;){var a=w[c++](f,b);if(0!==a)return a}return 0}};return J})},"dijit/form/_FormValueWidget":function(){define(["dojo/_base/declare","dojo/sniff","./_FormWidget","./_FormValueMixin"],function(L,J,q,K){return L("dijit.form._FormValueWidget",
[q,K],{_layoutHackIE7:function(){if(7==J("ie"))for(var E=this.domNode,w=E.parentNode,x=E.firstChild||E,A=x.style.filter,n=this;w&&0==w.clientHeight;)(function(){var g=n.connect(w,"onscroll",function(){n.disconnect(g);x.style.filter=(new Date).getMilliseconds();n.defer(function(){x.style.filter=A})})})(),w=w.parentNode}})})},"dijit/form/_FormWidget":function(){define("dojo/_base/declare dojo/sniff dojo/_base/kernel dojo/ready ../_Widget ../_CssStateMixin ../_TemplatedMixin ./_FormWidgetMixin".split(" "),
function(L,J,q,K,E,w,x,A){J("dijit-legacy-requires")&&K(0,function(){require(["dijit/form/_FormValueWidget"])});return L("dijit.form._FormWidget",[E,x,w,A],{setDisabled:function(n){q.deprecated("setDisabled("+n+") is deprecated. Use set('disabled',"+n+") instead.","","2.0");this.set("disabled",n)},setValue:function(n){q.deprecated("dijit.form._FormWidget:setValue("+n+") is deprecated.  Use set('value',"+n+") instead.","","2.0");this.set("value",n)},getValue:function(){q.deprecated(this.declaredClass+
"::getValue() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},postMixInProperties:function(){this.nameAttrSetting=this.name&&!J("msapp")?'name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"";this.inherited(arguments)}})})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f){function b(){}function c(a){return function(e,d,h,y){return e&&"string"==typeof d&&e[d]==b?e.on(d.substring(2).toLowerCase(),x.hitch(h,y)):a.apply(q,arguments)}}L.around(q,"connect",c);w.connect&&L.around(w,"connect",c);L=K("dijit._Widget",[m,l,f],{onClick:b,onDblClick:b,onKeyDown:b,onKeyPress:b,onKeyUp:b,onMouseDown:b,onMouseMove:b,onMouseOut:b,onMouseOver:b,onMouseLeave:b,onMouseEnter:b,onMouseUp:b,constructor:function(a){this._toConnect={};for(var e in a)this[e]===
b&&(this._toConnect[e.replace(/^on/,"").toLowerCase()]=a[e],delete a[e])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,e){return this[this._onMap(a)]===b?q.connect(this.domNode,a.toLowerCase(),this,e):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,e){w.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(a,e)},attr:function(a,e){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){w.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?A("[widgetId]",this.containerNode).map(g.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});E("dijit-legacy-requires")&&n(0,function(){require(["dijit/_base"])});
return L})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(L,J,q,K,E,w){L=K("dijit._OnDijitClickMixin",null,{connect:function(x,A,n){return this.inherited(arguments,[x,"ondijitclick"==A?w:A,n])}});L.a11yclick=w;return L})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(L,J,q,K){K.extend(J,{focused:!1,onFocus:function(){},onBlur:function(){},
_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return q("dijit._FocusMixin",null,{_focusManager:L})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(L,J,q,K){q(function(){J("highcontrast")&&L.add(K.body(),"dijit_a11y")});return J})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(L,J,q,K,E,w,x){E.add("highcontrast",function(){var A=
x.doc.createElement("div");try{A.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(J.blankGif||L.toUrl("./resources/blank.gif"))+'");';x.body().appendChild(A);var n=K.getComputedStyle(A),g=n.backgroundImage;return n.borderTopColor==n.borderRightColor||g&&("none"==g||"url(invalid-url:)"==g)}catch(m){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+m.toString()),!1}finally{8>=
E("ie")?A.outerHTML="":x.body().removeChild(A)}});w(function(){E("highcontrast")&&q.add(x.body(),"dj_a11y")});return E})},"dijit/_CssStateMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-class dojo/has dojo/_base/lang dojo/on dojo/domReady dojo/touch dojo/_base/window ./a11yclick ./registry".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,l){J=J("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);L.forEach("disabled readOnly checked selected focused state hovering active _opened".split(" "),
function(b){this.watch(b,w.hitch(this,"_setStateClass"))},this);for(var f in this.cssStateNodes||{})this._trackMouseState(this[f],this.cssStateNodes[f]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(f){if(!this.disabled)switch(f.type){case "mouseover":case "MSPointerOver":case "pointerover":this._set("hovering",!0);this._set("active",this._mouseDown);break;case "mouseout":case "MSPointerOut":case "pointerout":this._set("hovering",!1);this._set("active",
!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":this._set("active",!0);break;case "mouseup":case "dojotouchend":case "MSPointerUp":case "pointerup":case "keyup":this._set("active",!1)}},_setStateClass:function(){function f(h){b=b.concat(L.map(b,function(y){return y+h}),"dijit"+h)}var b=this.baseClass.split(" ");this.isLeftToRight()||f("Rtl");var c="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&f(c);this.state&&f(this.state);
this.selected&&f("Selected");this._opened&&f("Opened");this.disabled?f("Disabled"):this.readOnly?f("ReadOnly"):this.active?f("Active"):this.hovering&&f("Hover");this.focused&&f("Focused");c=this.stateNode||this.domNode;var a={};L.forEach(c.className.split(" "),function(h){a[h]=!0});"_stateClasses"in this&&L.forEach(this._stateClasses,function(h){delete a[h]});L.forEach(b,function(h){a[h]=!0});var e=[],d;for(d in a)e.push(d);c.className=e.join(" ");this._stateClasses=b},_subnodeCssMouseEvent:function(f,
b,c){function a(e){K.toggle(f,b+"Active",e)}if(!this.disabled&&!this.readOnly)switch(c.type){case "mouseover":case "MSPointerOver":case "pointerover":K.toggle(f,b+"Hover",!0);break;case "mouseout":case "MSPointerOut":case "pointerout":K.toggle(f,b+"Hover",!1);a(!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":a(!0);break;case "mouseup":case "MSPointerUp":case "pointerup":case "dojotouchend":case "keyup":a(!1);break;case "focus":case "focusin":K.toggle(f,
b+"Focused",!0);break;case "blur":case "focusout":K.toggle(f,b+"Focused",!1)}},_trackMouseState:function(f,b){f._cssState=b}});A(function(){function f(a,e,d){if(!d||!q.isDescendant(d,e))for(;e&&e!=d;e=e.parentNode)if(e._cssState){var h=l.getEnclosingWidget(e);h&&(e==h.domNode?h._cssMouseEvent(a):h._subnodeCssMouseEvent(e,e._cssState,a))}}var b=g.body(),c;x(b,n.over,function(a){f(a,a.target,a.relatedTarget)});x(b,n.out,function(a){f(a,a.target,a.relatedTarget)});x(b,m.press,function(a){c=a.target;
f(a,c)});x(b,m.release,function(a){f(a,c);c=null});x(b,"focusin, focusout",function(a){var e=a.target;if(e._cssState&&!e.getAttribute("widgetId")){var d=l.getEnclosingWidget(e);d&&d._subnodeCssMouseEvent(e,e._cssState,a)}})});return J})},"dijit/form/_FormWidgetMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff dojo/window ../a11y".split(" "),function(L,J,q,K,E,w,x,A,n,g){return J("dijit.form._FormWidgetMixin",null,
{name:"",alt:"",value:"",type:"text","aria-label":"focusNode",tabIndex:"0",_setTabIndexAttr:"focusNode",disabled:!1,intermediateChanges:!1,scrollOnFocus:!0,_setIdAttr:"focusNode",_setDisabledAttr:function(m){this._set("disabled",m);/^(button|input|select|textarea|optgroup|option|fieldset)$/i.test(this.focusNode.tagName)?(q.set(this.focusNode,"disabled",m),A("trident")&&"readOnly"in this&&q.set(this.focusNode,"readonly",m||this.readOnly)):this.focusNode.setAttribute("aria-disabled",m?"true":"false");
this.valueNode&&q.set(this.valueNode,"disabled",m);m?(this._set("hovering",!1),this._set("active",!1),m="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"_setTabIndexAttr"in this?this._setTabIndexAttr:"focusNode",L.forEach(E.isArray(m)?m:[m],function(l){l=this[l];A("webkit")||g.hasDefaultTabStop(l)?l.setAttribute("tabIndex","-1"):l.removeAttribute("tabIndex")},this)):""!=this.tabIndex&&this.set("tabIndex",this.tabIndex)},_onFocus:function(m){if("mouse"==m&&this.isFocusable())var l=this.own(x(this.focusNode,
"focus",function(){b.remove();l.remove()}))[0],f=A("pointer-events")?"pointerup":A("MSPointer")?"MSPointerUp":A("touch-events")?"touchend, mouseup":"mouseup",b=this.own(x(this.ownerDocumentBody,f,E.hitch(this,function(c){b.remove();l.remove();this.focused&&("touchend"==c.type?this.defer("focus"):this.focus())})))[0];this.scrollOnFocus&&this.defer(function(){n.scrollIntoView(this.domNode)});this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&"none"!=K.get(this.domNode,
"display")},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(m){}},compare:function(m,l){return"number"==typeof m&&"number"==typeof l?isNaN(m)&&isNaN(l)?0:m-l:m>l?1:m<l?-1:0},onChange:function(){},_onChangeActive:!1,_handleOnChange:function(m,l){void 0!=this._lastValueReported||null!==l&&this._onChangeActive||(this._resetValue=this._lastValueReported=m);this._pendingOnChange=this._pendingOnChange||typeof m!=typeof this._lastValueReported||0!=this.compare(m,
this._lastValueReported);(this.intermediateChanges||l||void 0===l)&&this._pendingOnChange&&(this._lastValueReported=m,this._pendingOnChange=!1,this._onChangeActive&&(this._onChangeHandle&&this._onChangeHandle.remove(),this._onChangeHandle=this.defer(function(){this._onChangeHandle=null;this.onChange(m)})))},create:function(){this.inherited(arguments);this._onChangeActive=!0},destroy:function(){this._onChangeHandle&&(this._onChangeHandle.remove(),this.onChange(this._lastValueReported));this.inherited(arguments)}})})},
"dijit/form/_FormValueMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormWidgetMixin".split(" "),function(L,J,q,K,E,w,x){return L("dijit.form._FormValueMixin",x,{readOnly:!1,_setReadOnlyAttr:function(A){w("trident")&&"disabled"in this?J.set(this.focusNode,"readOnly",A||this.disabled):J.set(this.focusNode,"readOnly",A);this._set("readOnly",A)},postCreate:function(){this.inherited(arguments);void 0===this._resetValue&&(this._lastValueReported=
this._resetValue=this.value)},_setValueAttr:function(A,n){this._handleOnChange(A,n)},_handleOnChange:function(A,n){this._set("value",A);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,!1)},reset:function(){this._hasBeenBlurred=!1;this._setValueAttr(this._resetValue,!0)}})})},"dijit/_HasDropDown":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on dojo/touch ./registry ./focus ./popup ./_FocusMixin".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a){return L("dijit._HasDropDown",a,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(e){this.disabled||this.readOnly||("MSPointerDown"!=e.type&&e.preventDefault(),this.own(m.once(this.ownerDocument,l.release,g.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(e){var d=
this.dropDown,h=!1;if(e&&this._opened){var y=w.position(this._buttonNode,!0);if(!(e.pageX>=y.x&&e.pageX<=y.x+y.w&&e.pageY>=y.y&&e.pageY<=y.y+y.h)){for(y=e.target;y&&!h;)E.contains(y,"dijitPopup")?h=!0:y=y.parentNode;if(h){y=e.target;if(d.onItemClick){for(var I;y&&!(I=f.byNode(y));)y=y.parentNode;if(I&&I.onClick&&I.getParent)I.getParent().onItemClick(I,e)}return}}}this._opened?d.focus&&(!1!==d.autoFocus||"mouseup"==e.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){d.focus();
delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(e){this._stopClickEvents&&(e.stopPropagation(),e.preventDefault())},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var e={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||
this.dropDownPosition[0]||"Down";E.add(this._arrowWrapperNode||this._buttonNode,"dijit"+e+"ArrowButton")},postCreate:function(){this.inherited(arguments);var e=this.focusNode||this.domNode;this.own(m(this._buttonNode,l.press,g.hitch(this,"_onDropDownMouseDown")),m(this._buttonNode,"click",g.hitch(this,"_onDropDownClick")),m(e,"keydown",g.hitch(this,"_onKey")),m(e,"keyup",g.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),
delete this.dropDown);this.inherited(arguments)},_onKey:function(e){if(!this.disabled&&!this.readOnly){var d=this.dropDown,h=e.target;d&&this._opened&&d.handleKey&&!1===d.handleKey(e)?(e.stopPropagation(),e.preventDefault()):d&&this._opened&&e.keyCode==n.ESCAPE?(this.closeDropDown(),e.stopPropagation(),e.preventDefault()):!this._opened&&(e.keyCode==n.DOWN_ARROW||(e.keyCode==n.ENTER||e.keyCode==n.SPACE&&(!this._searchTimer||e.ctrlKey||e.altKey||e.metaKey))&&("input"!==(h.tagName||"").toLowerCase()||
h.type&&"text"!==h.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,e.stopPropagation(),e.preventDefault())}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var e=this.dropDown;e&&e.focus&&this.defer(g.hitch(e,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(e){e()},loadAndOpenDropDown:function(){var e=new J,d=g.hitch(this,function(){this.openDropDown();e.resolve(this.dropDown)});
this.isLoaded()?d():this.loadDropDown(d);return e},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var e=this.dropDown,d=e.domNode,h=this._aroundNode||this.domNode,y=this,I=c.open({parent:this,popup:e,around:h,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){y.closeDropDown(!0)},onCancel:function(){y.closeDropDown(!0)},onClose:function(){K.set(y._popupStateNode,"popupActive",
!1);E.remove(y._popupStateNode,"dijitHasDropDownOpen");y._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&h.offsetWidth>e._popupWrapper.offsetWidth){h=h.offsetWidth-e._popupWrapper.offsetWidth;var H={w:e.domNode.offsetWidth+h};this._origStyle=d.style.cssText;g.isFunction(e.resize)?e.resize(H):w.setMarginBox(d,H);"R"==I.corner[1]&&(e._popupWrapper.style.left=e._popupWrapper.style.left.replace("px","")-h+"px")}K.set(this._popupStateNode,"popupActive","true");E.add(this._popupStateNode,"dijitHasDropDownOpen");
this._set("_opened",!0);this._popupStateNode.setAttribute("aria-expanded","true");this._popupStateNode.setAttribute("aria-owns",e.id);"presentation"===d.getAttribute("role")||d.getAttribute("aria-labelledby")||d.setAttribute("aria-labelledby",this.id);return I},closeDropDown:function(e){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer);this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),e&&this.focus&&this.focus(),c.close(this.dropDown),
this._opened=!1);this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})})},"dijit/popup":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main dojo/touch".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a){function e(){this._popupWrapper&&(w.destroy(this._popupWrapper),delete this._popupWrapper)}
q=q(null,{_stack:[],_beginZIndex:1E3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var d=this._firstAroundPosition,h=x.position(this._firstAroundNode,!0),y=h.x-d.x;d=h.y-d.y;if(y||d)for(this._firstAroundPosition=h,h=0;h<this._stack.length;h++){var I=this._stack[h].wrapper.style;I.top=parseFloat(I.top)+d+"px";"auto"==I.right?I.left=parseFloat(I.left)+y+"px":I.right=parseFloat(I.right)-y+"px"}this._aroundMoveListener=setTimeout(m.hitch(this,"_repositionAll"),y||d?10:50)}},_createWrapper:function(d){var h=
d._popupWrapper,y=d.domNode;h||(h=w.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":d["aria-label"]||d.label||d.name||d.id},d.ownerDocumentBody),h.appendChild(y),y=y.style,y.display="",y.visibility="",y.position="",y.top="0px",d._popupWrapper=h,J.after(d,"destroy",e,!0),"ontouchend"in document&&l(h,"touchend",function(I){/^(input|button|textarea)$/i.test(I.target.tagName)||I.preventDefault()}),h.dojoClick=!0);return h},moveOffScreen:function(d){var h=this._createWrapper(d);
d=x.isBodyLtr(d.ownerDocument);var y={visibility:"hidden",top:"-9999px",display:""};y[d?"left":"right"]="-9999px";y[d?"right":"left"]="auto";A.set(h,y);return h},hide:function(d){var h=this._createWrapper(d);A.set(h,{display:"none",height:"auto",overflowY:"visible",border:""});d=d.domNode;"_originalStyle"in d&&(d.style.cssText=d._originalStyle)},getTopPopup:function(){for(var d=this._stack,h=d.length-1;0<h&&d[h].parent===d[h-1].widget;h--);return d[h]},open:function(d){for(var h=this._stack,y=d.popup,
I=y.domNode,H=d.orient||["below","below-alt","above","above-alt"],u=d.parent?d.parent.isLeftToRight():x.isBodyLtr(y.ownerDocument),G=d.around,v=d.around&&d.around.id?d.around.id+"_dropdown":"popup_"+this._idGen++;h.length&&(!d.parent||!K.isDescendant(d.parent.domNode,h[h.length-1].widget.domNode));)this.close(h[h.length-1].widget);var t=this.moveOffScreen(y);y.startup&&!y._started&&y.startup();var F=x.position(I);if("maxHeight"in d&&-1!=d.maxHeight)var B=d.maxHeight||Infinity;else{B=c.getEffectiveBox(this.ownerDocument);
var O=G?x.position(G,!1):{y:d.y-(d.padding||0),h:2*(d.padding||0)};B=Math.floor(Math.max(O.y,B.h-(O.y+O.h)))}F.h>B&&(F=A.getComputedStyle(I),A.set(t,{overflowY:"scroll",height:B+"px",border:F.borderLeftWidth+" "+F.borderLeftStyle+" "+F.borderLeftColor}),I._originalStyle=I.style.cssText,I.style.border="none");E.set(t,{id:v,style:{zIndex:this._beginZIndex+h.length},"class":"dijitPopup "+(y.baseClass||y["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:d.parent?d.parent.id:""});0==h.length&&G&&(this._firstAroundNode=
G,this._firstAroundPosition=x.position(G,!0),this._aroundMoveListener=setTimeout(m.hitch(this,"_repositionAll"),50));n("config-bgIframe")&&!y.bgIframe&&(y.bgIframe=new b(t));v=y.orient?m.hitch(y,"orient"):null;H=G?f.around(t,G,H,u,v):f.at(t,d,"R"==H?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],d.padding,v);t.style.visibility="visible";I.style.visibility="visible";I=[];I.push(l(t,"keydown",m.hitch(this,function(M){if(M.keyCode==g.ESCAPE&&d.onCancel)M.stopPropagation(),M.preventDefault(),d.onCancel();
else if(M.keyCode==g.TAB&&(M.stopPropagation(),M.preventDefault(),(M=this.getTopPopup())&&M.onCancel))M.onCancel()})));y.onCancel&&d.onCancel&&I.push(y.on("cancel",d.onCancel));I.push(y.on(y.onExecute?"execute":"change",m.hitch(this,function(){var M=this.getTopPopup();if(M&&M.onExecute)M.onExecute()})));h.push({widget:y,wrapper:t,parent:d.parent,onExecute:d.onExecute,onCancel:d.onCancel,onClose:d.onClose,handlers:I});if(y.onOpen)y.onOpen(H);return H},close:function(d){for(var h=this._stack;d&&L.some(h,
function(G){return G.widget==d})||!d&&h.length;){var y=h.pop(),I=y.widget,H=y.onClose;I.bgIframe&&(I.bgIframe.destroy(),delete I.bgIframe);if(I.onClose)I.onClose();for(var u;u=y.handlers.pop();)u.remove();I&&I.domNode&&this.hide(I);H&&H()}0==h.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=this._aroundMoveListener=null)}});return a.popup=new q})},"dijit/place":function(){define("dojo/_base/array dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/_base/window ./Viewport ./main".split(" "),
function(L,J,q,K,E,w,x){function A(g,m,l,f){var b=w.getEffectiveBox(g.ownerDocument);g.parentNode&&"body"==String(g.parentNode.tagName).toLowerCase()||E.body(g.ownerDocument).appendChild(g);var c=null;L.some(m,function(d){var h=d.corner,y=d.pos,I=0,H={w:{L:b.l+b.w-y.x,R:y.x-b.l,M:b.w}[h.charAt(1)],h:{T:b.t+b.h-y.y,B:y.y-b.t,M:b.h}[h.charAt(0)]},u=g.style;u.left=u.right="auto";l&&(I=l(g,d.aroundCorner,h,H,f),I="undefined"==typeof I?0:I);var G=g.style,v=G.display,t=G.visibility;"none"==G.display&&(G.visibility=
"hidden",G.display="");u=J.position(g);G.display=v;G.visibility=t;v={L:y.x,R:y.x-u.w,M:Math.max(b.l,Math.min(b.l+b.w,y.x+(u.w>>1))-u.w)}[h.charAt(1)];t={T:y.y,B:y.y-u.h,M:Math.max(b.t,Math.min(b.t+b.h,y.y+(u.h>>1))-u.h)}[h.charAt(0)];y=Math.max(b.l,v);G=Math.max(b.t,t);v=Math.min(b.l+b.w,v+u.w)-y;t=Math.min(b.t+b.h,t+u.h)-G;I+=u.w-v+(u.h-t);if(null==c||I<c.overflow)c={corner:h,aroundCorner:d.aroundCorner,x:y,y:G,w:v,h:t,overflow:I,spaceAvailable:H};return!I});c.overflow&&l&&l(g,c.aroundCorner,c.corner,
c.spaceAvailable,f);m=c.y;var a=c.x,e=E.body(g.ownerDocument);/relative|absolute/.test(q.get(e,"position"))&&(m-=q.get(e,"marginTop"),a-=q.get(e,"marginLeft"));e=g.style;e.top=m+"px";e.left=a+"px";e.right="auto";return c}var n={TL:"BR",TR:"BL",BL:"TR",BR:"TL"};return x.place={at:function(g,m,l,f,b){l=L.map(l,function(c){var a={corner:c,aroundCorner:n[c],pos:{x:m.x,y:m.y}};f&&(a.pos.x+="L"==c.charAt(1)?f.x:-f.x,a.pos.y+="T"==c.charAt(0)?f.y:-f.y);return a});return A(g,l,b)},around:function(g,m,l,f,
b){function c(F,B){t.push({aroundCorner:F,corner:B,pos:{x:{L:H,R:H+G,M:H+(G>>1)}[F.charAt(1)],y:{T:u,B:u+v,M:u+(v>>1)}[F.charAt(0)]}})}if("string"==typeof m||"offsetWidth"in m||"ownerSVGElement"in m){var a=J.position(m,!0);if(/^(above|below)/.test(l[0])){var e=J.getBorderExtents(m),d=m.firstChild?J.getBorderExtents(m.firstChild):{t:0,l:0,b:0,r:0},h=J.getBorderExtents(g),y=g.firstChild?J.getBorderExtents(g.firstChild):{t:0,l:0,b:0,r:0};a.y+=Math.min(e.t+d.t,h.t+y.t);a.h-=Math.min(e.t+d.t,h.t+y.t)+
Math.min(e.b+d.b,h.b+y.b)}}else a=m;if(m.parentNode)for(e="absolute"==q.getComputedStyle(m).position,m=m.parentNode;m&&1==m.nodeType&&"BODY"!=m.nodeName;){d=J.position(m,!0);h=q.getComputedStyle(m);/relative|absolute/.test(h.position)&&(e=!1);if(!e&&/hidden|auto|scroll/.test(h.overflow)){y=Math.min(a.y+a.h,d.y+d.h);var I=Math.min(a.x+a.w,d.x+d.w);a.x=Math.max(a.x,d.x);a.y=Math.max(a.y,d.y);a.h=y-a.y;a.w=I-a.x}"absolute"==h.position&&(e=!0);m=m.parentNode}var H=a.x,u=a.y,G="w"in a?a.w:a.w=a.width,
v="h"in a?a.h:(K.deprecated("place.around: dijit/place.__Rectangle: { x:"+H+", y:"+u+", height:"+a.height+", width:"+G+" } has been deprecated.  Please use { x:"+H+", y:"+u+", h:"+a.height+", w:"+G+" }","","2.0"),a.h=a.height),t=[];L.forEach(l,function(F){var B=f;switch(F){case "above-centered":c("TM","BM");break;case "below-centered":c("BM","TM");break;case "after-centered":B=!B;case "before-centered":c(B?"ML":"MR",B?"MR":"ML");break;case "after":B=!B;case "before":c(B?"TL":"TR",B?"TR":"TL");c(B?
"BL":"BR",B?"BR":"BL");break;case "below-alt":B=!B;case "below":c(B?"BL":"BR",B?"TL":"TR");c(B?"BR":"BL",B?"TR":"TL");break;case "above-alt":B=!B;case "above":c(B?"TL":"TR",B?"BL":"BR");c(B?"TR":"TL",B?"BR":"BL");break;default:c(F.aroundCorner,F.corner)}});g=A(g,t,b,{w:G,h:v});g.aroundNodePos=a;return g}}})},"dijit/Viewport":function(){define(["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],function(L,J,q,K,E){var w=new L,x;q(function(){var A=E.getBox();w._rlh=J(window,"resize",
function(){var g=E.getBox();if(A.h!=g.h||A.w!=g.w)A=g,w.emit("resize")});if(8==K("ie")){var n=screen.deviceXDPI;setInterval(function(){screen.deviceXDPI!=n&&(n=screen.deviceXDPI,w.emit("resize"))},500)}K("ios")&&(J(document,"focusin",function(g){x=g.target}),J(document,"focusout",function(g){x=null}))});w.getEffectiveBox=function(A){A=E.getBox(A);var n=x&&x.tagName&&x.tagName.toLowerCase();K("ios")&&x&&!x.readOnly&&("textarea"==n||"input"==n&&/^(color|email|number|password|search|tel|text|url)$/.test(x.type))&&
(A.h*=0==orientation||180==orientation?.66:.4,n=x.getBoundingClientRect(),A.h=Math.max(A.h,n.top+n.height));return A};return w})},"dijit/BackgroundIframe":function(){define("require ./main dojo/_base/config dojo/dom-construct dojo/dom-style dojo/_base/lang dojo/on dojo/sniff".split(" "),function(L,J,q,K,E,w,x,A){A.add("config-bgIframe",(A("ie")||A("trident"))&&!/IEMobile\/10\.0/.test(navigator.userAgent));var n=new function(){var g=[];this.pop=function(){if(g.length){var m=g.pop();m.style.display=
""}else 9>A("ie")?(m=q.dojoBlankHtmlUrl||L.toUrl("dojo/resources/blank.html")||'javascript:""',m=document.createElement("\x3ciframe src\x3d'"+m+"' role\x3d'presentation' style\x3d'position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity\x3d\"0\");'\x3e")):(m=K.create("iframe"),m.src='javascript:""',m.className="dijitBackgroundIframe",m.setAttribute("role","presentation"),E.set(m,"opacity",.1)),m.tabIndex=-1;return m};this.push=function(m){m.style.display="none";g.push(m)}};J.BackgroundIframe=
function(g){if(!g.id)throw Error("no id");if(A("config-bgIframe")){var m=this.iframe=n.pop();g.appendChild(m);7>A("ie")||A("quirks")?(this.resize(g),this._conn=x(g,"resize",w.hitch(this,"resize",g))):E.set(m,{width:"100%",height:"100%"})}};w.extend(J.BackgroundIframe,{resize:function(g){this.iframe&&E.set(this.iframe,{width:g.offsetWidth+"px",height:g.offsetHeight+"px"})},destroy:function(){this._conn&&(this._conn.remove(),this._conn=null);this.iframe&&(this.iframe.parentNode.removeChild(this.iframe),
n.push(this.iframe),delete this.iframe)}});return J.BackgroundIframe})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(L,J,q,K){return L("dijit.DropDownMenu",K,{templateString:q,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(E){this._moveToPopup(E);E.stopPropagation();E.preventDefault()},_onLeftArrow:function(E){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();
else this.onCancel(!1);else E.stopPropagation(),E.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c){return J("dijit._MenuBase",[l,c,b,f],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),
this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){E.toggle(this.domNode,"dijitMenuActive",a);E.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var e=m.byNode(a);return a.parentNode==this.containerNode&&e&&e.focus},postCreate:function(){var a=this,e="string"==typeof this.childSelector?this.childSelector:
w.hitch(this,"childSelector");this.own(A(this.containerNode,A.selector(e,x.enter),function(){a.onItemHover(m.byNode(this))}),A(this.containerNode,A.selector(e,x.leave),function(){a.onItemUnhover(m.byNode(this))}),A(this.containerNode,A.selector(e,g),function(d){a.onItemClick(m.byNode(this),d);d.stopPropagation()}),A(this.containerNode,A.selector(e,"focusin"),function(){a._onItemFocus(m.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,e,d,h){this.inherited(arguments);if(a&&(-1==
h||a.popup&&1==h))this.onItemClick(a,e)},_keyboardSearchCompare:function(a,e){return a.shortcutKey?e==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},
onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==
a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&
(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,e){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),e=/^key/.test(e._origType||e.type)||0==e.clientX&&0==e.clientY,this._openItemPopup(a,e)):(this.onExecute(),a._onClick?a._onClick(e):a.onClick(e))},_openItemPopup:function(a,e){if(a!=
this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var d=a.popup;d.parentMenu=this;this.own(this._mouseoverHandle=A.once(d.domNode,"mouseover",w.hitch(this,"_onPopupHover")));var h=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){e&&h.focusChild(a);h._cleanUp()},onExecute:w.hitch(this,"_cleanUp",!0),onClose:function(){h._mouseoverHandle&&(h._mouseoverHandle.remove(),delete h._mouseoverHandle)}},
e);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(K.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=
a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),function(L,J,q,K,E,w,x,A,n,g){return J("dijit._KeyNavContainer",
[n,g,A],{connectKeyNavHandlers:function(m,l){var f=this._keyNavCodes={},b=w.hitch(this,"focusPrev"),c=w.hitch(this,"focusNext");L.forEach(m,function(a){f[a]=b});L.forEach(l,function(a){f[a]=c});f[E.HOME]=w.hitch(this,"focusFirstChild");f[E.END]=w.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){K.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);L.forEach(this.getChildren(),w.hitch(this,"_startupChild"))},addChild:function(m,
l){this.inherited(arguments);this._startupChild(m)},_startupChild:function(m){m.set("tabIndex","-1")},_getFirst:function(){var m=this.getChildren();return m.length?m[0]:null},_getLast:function(){var m=this.getChildren();return m.length?m[m.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(m){return(m=x.byNode(m))&&m.getParent()==this}})})},
"dijit/_Container":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/_base/kernel"],function(L,J,q,K){return J("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode)},addChild:function(E,w){var x=this.containerNode;if(0<w){for(x=x.firstChild;0<w;)1==x.nodeType&&w--,x=x.nextSibling;x?w="before":(x=this.containerNode,w="last")}q.place(E.domNode,x,w);this._started&&!E._started&&E.startup()},
removeChild:function(E){"number"==typeof E&&(E=this.getChildren()[E]);E&&(E=E.domNode)&&E.parentNode&&E.parentNode.removeChild(E)},hasChildren:function(){return 0<this.getChildren().length},_getSiblingOfChild:function(E,w){var x=this.getChildren();E=L.indexOf(x,E);return x[E+w]},getIndexOfChild:function(E){return L.indexOf(this.getChildren(),E)}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),
function(L,J,q,K,E,w,x,A){return J("dijit._KeyNavMixin",A,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);q.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var n=this._keyNavCodes={};n[K.HOME]=E.hitch(this,"focusFirstChild");n[K.END]=E.hitch(this,"focusLastChild");n[this.isLeftToRight()?K.LEFT_ARROW:K.RIGHT_ARROW]=E.hitch(this,"_onLeftArrow");n[this.isLeftToRight()?K.RIGHT_ARROW:K.LEFT_ARROW]=E.hitch(this,"_onRightArrow");n[K.UP_ARROW]=E.hitch(this,
"_onUpArrow");n[K.DOWN_ARROW]=E.hitch(this,"_onDownArrow")}var g=this;n="string"==typeof this.childSelector?this.childSelector:E.hitch(this,"childSelector");this.own(w(this.domNode,"keypress",E.hitch(this,"_onContainerKeypress")),w(this.domNode,"keydown",E.hitch(this,"_onContainerKeydown")),w(this.domNode,"focus",E.hitch(this,"_onContainerFocus")),w(this.containerNode,w.selector(n,"focusin"),function(m){g._onChildFocus(x.getEnclosingWidget(this),m)}))},_onLeftArrow:function(){},_onRightArrow:function(){},
_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(n,g){n&&(this.focusedChild&&n!==this.focusedChild&&this._onChildBlur(this.focusedChild),
n.set("tabIndex",this.tabIndex),n.focus(g?"end":"start"))},_onContainerFocus:function(n){n.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){q.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(n){q.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(n){n&&n!=this.focusedChild&&
(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),n.set("tabIndex",this.tabIndex),this.lastFocused=n,this._set("focusedChild",n))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(n,g,m,l){n&&this.focusChild(n)},_keyboardSearchCompare:function(n,g){var m=n.domNode;n=(n.label||(m.focusNode?m.focusNode.label:"")||m.innerText||m.textContent||"").replace(/^\s+/,"").substr(0,g.length).toLowerCase();return g.length&&n==g?-1:0},_isFormElement:function(n){return"INPUT"===
n.tagName||"TEXTAREA"===n.tagName||"SELECT"===n.tagName||"BUTTON"===n.tagName},_onContainerKeydown:function(n){if(!this._isFormElement(document.activeElement)){var g=this._keyNavCodes[n.keyCode];g?(g(n,this.focusedChild),n.stopPropagation(),n.preventDefault(),this._searchString=""):n.keyCode!=K.SPACE||!this._searchTimer||n.ctrlKey||n.altKey||n.metaKey||(n.stopImmediatePropagation(),n.preventDefault(),this._keyboardSearch(n," "))}},_onContainerKeypress:function(n){this._isFormElement(document.activeElement)||
n.charCode<=K.SPACE||n.ctrlKey||n.altKey||n.metaKey||(n.preventDefault(),n.stopPropagation(),this._keyboardSearch(n,String.fromCharCode(n.charCode).toLowerCase()))},_keyboardSearch:function(n,g){var m=null,l,f=0;E.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=g;var b=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;l=this._searchString.substr(0,b);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);
var c=this.focusedChild||null;if(1==b||!c)if(c=this._getNextFocusableChild(c,1),!c)return;b=c;do{var a=this._keyboardSearchCompare(c,l);a&&0==f++&&(m=c);if(-1==a){f=-1;break}c=this._getNextFocusableChild(c,1)}while(c&&c!=b)})();this.onKeyboardSearch(m,n,l,f)},_onChildBlur:function(){},_getNextFocusableChild:function(n,g){var m=n;do{if(n)n=this._getNext(n,g);else if(n=this[0<g?"_getFirst":"_getLast"](),!n)break;if(null!=n&&n!=m&&n.isFocusable())return n}while(n!=m);return null},_getFirst:function(){return null},
_getLast:function(){return null},_getNext:function(n,g){if(n)for(n=n.domNode;n;)if((n=n[0>g?"previousSibling":"nextSibling"])&&"getAttribute"in n){var m=x.byNode(n);if(m)return m}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,l){x=L("dijit.MenuItem"+(w("dojo-bidi")?
"_NoBidi":""),[A,n,g,m],{templateString:l,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(f){this._set("label",f);var b="";var c=f.search(/{\S}/);if(0<=c){b=f.charAt(c+1);var a=f.substr(0,c);f=f.substr(c+3);c=a+b+f;f=a+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+f}else c=f;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=f;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},
accelKey:"",disabled:!1,_fillContent:function(f){!f||"label"in this.params||this._set("label",f.innerHTML)},buildRendering:function(){this.inherited(arguments);q.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&q.set(this.accelKeyNode,"id",this.id+"_accel");J.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==w("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(f){}},_setSelected:function(f){K.toggle(this.domNode,"dijitMenuItemSelected",f)},setLabel:function(f){E.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.",
"","2.0");this.set("label",f)},setDisabled:function(f){E.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",f)},_setDisabledAttr:function(f){this.focusNode.setAttribute("aria-disabled",f?"true":"false");this._set("disabled",f)},_setAccelKeyAttr:function(f){this.accelKeyNode&&(this.accelKeyNode.style.display=f?"":"none",this.accelKeyNode.innerHTML=f,q.set(this.containerNode,"colSpan",f?"1":"2"));this._set("accelKey",f)}});w("dojo-bidi")&&
(x=L("dijit.MenuItem",x,{_setLabelAttr:function(f){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return x})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(L,J){return L("dijit._Contained",null,{_getSibling:function(q){var K=this.getParent();return K&&K._getSiblingOfChild&&K._getSiblingOfChild(this,"previous"==q?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},
getIndexInParent:function(){var q=this.getParent();return q&&q.getIndexOfChild?q.getIndexOfChild(this):-1}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(L,J,q,K,E,w){return L("dijit.MenuSeparator",[q,K,E],{templateString:w,buildRendering:function(){this.inherited(arguments);J.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/Tooltip":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff ./_base/manager ./place ./_Widget ./_TemplatedMixin ./BackgroundIframe dojo/text!./templates/Tooltip.html ./main".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a,e,d){function h(){}var y=J("dijit._MasterTooltip",[b,c],{duration:l.defaultDuration,templateString:e,postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.bgIframe=new a(this.domNode);this.fadeIn=q.fadeIn({node:this.domNode,duration:this.duration,onEnd:A.hitch(this,"_onShow")});this.fadeOut=q.fadeOut({node:this.domNode,duration:this.duration,onEnd:A.hitch(this,"_onHide")})},show:function(H,u,G,v,t,F,B){if(!this.aroundNode||this.aroundNode!==
u||this.containerNode.innerHTML!=H)if("playing"==this.fadeOut.status())this._onDeck=arguments;else{this.containerNode.innerHTML=H;t&&this.set("textDir",t);this.containerNode.align=v?"right":"left";var O=f.around(this.domNode,u,G&&G.length?G:I.defaultPosition,!v,A.hitch(this,"orient")),M=O.aroundNodePos;"M"==O.corner.charAt(0)&&"M"==O.aroundCorner.charAt(0)?(this.connectorNode.style.top=M.y+(M.h-this.connectorNode.offsetHeight>>1)-O.y+"px",this.connectorNode.style.left=""):"M"==O.corner.charAt(1)&&
"M"==O.aroundCorner.charAt(1)?this.connectorNode.style.left=M.x+(M.w-this.connectorNode.offsetWidth>>1)-O.x+"px":(this.connectorNode.style.left="",this.connectorNode.style.top="");x.set(this.domNode,"opacity",0);this.fadeIn.play();this.isShowingNow=!0;this.aroundNode=u;this.onMouseEnter=F||h;this.onMouseLeave=B||h}},orient:function(H,u,G,v,t){this.connectorNode.style.top="";var F=v.h;v=v.w;H.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove",
"BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[u+"-"+G];this.domNode.style.width="auto";var B=w.position(this.domNode);if(m("ie")||m("trident"))B.w+=2;w.setMarginBox(this.domNode,{w:Math.min(Math.max(v,1),B.w)});"B"==G.charAt(0)&&"B"==u.charAt(0)?(H=w.position(H),u=this.connectorNode.offsetHeight,
H.h>F?(this.connectorNode.style.top=F-(t.h+u>>1)+"px",this.connectorNode.style.bottom=""):(this.connectorNode.style.bottom=Math.min(Math.max(t.h/2-u/2,0),H.h-u)+"px",this.connectorNode.style.top="")):(this.connectorNode.style.top="",this.connectorNode.style.bottom="");return Math.max(0,B.w-v)},_onShow:function(){m("ie")&&(this.domNode.style.filter="")},hide:function(H){this._onDeck&&this._onDeck[1]==H?this._onDeck=null:this.aroundNode===H&&(this.fadeIn.stop(),this.isShowingNow=!1,this.aroundNode=
null,this.fadeOut.play());this.onMouseEnter=this.onMouseLeave=h},_onHide:function(){this.domNode.style.cssText="";this.containerNode.innerHTML="";this._onDeck&&(this.show.apply(this,this._onDeck),this._onDeck=null)}});m("dojo-bidi")&&y.extend({_setAutoTextDir:function(H){this.applyTextDir(H);L.forEach(H.children,function(u){this._setAutoTextDir(u)},this)},_setTextDirAttr:function(H){this._set("textDir",H);"auto"==H?this._setAutoTextDir(this.containerNode):this.containerNode.dir=this.textDir}});d.showTooltip=
function(H,u,G,v,t,F,B){G&&(G=L.map(G,function(O){return{after:"after-centered",before:"before-centered"}[O]||O}));I._masterTT||(d._masterTT=I._masterTT=new y);return I._masterTT.show(H,u,G,v,t,F,B)};d.hideTooltip=function(H){return I._masterTT&&I._masterTT.hide(H)};var I=J("dijit.Tooltip",b,{label:"",showDelay:400,hideDelay:400,connectId:[],position:[],selector:"",_setConnectIdAttr:function(H){L.forEach(this._connections||[],function(u){L.forEach(u,function(G){G.remove()})},this);this._connectIds=
L.filter(A.isArrayLike(H)?H:H?[H]:[],function(u){return K.byId(u,this.ownerDocument)},this);this._connections=L.map(this._connectIds,function(u){u=K.byId(u,this.ownerDocument);var G=this.selector,v=G?function(F){return g.selector(G,F)}:function(F){return F},t=this;return[g(u,v(n.enter),function(){t._onHover(this)}),g(u,v("focusin"),function(){t._onHover(this)}),g(u,v(n.leave),A.hitch(t,"_onUnHover")),g(u,v("focusout"),A.hitch(t,"set","state","DORMANT"))]},this);this._set("connectId",H)},addTarget:function(H){H=
H.id||H;-1==L.indexOf(this._connectIds,H)&&this.set("connectId",this._connectIds.concat(H))},removeTarget:function(H){H=L.indexOf(this._connectIds,H.id||H);0<=H&&(this._connectIds.splice(H,1),this.set("connectId",this._connectIds))},buildRendering:function(){this.inherited(arguments);E.add(this.domNode,"dijitTooltipData")},startup:function(){this.inherited(arguments);var H=this.connectId;L.forEach(A.isArrayLike(H)?H:[H],this.addTarget,this)},getContent:function(H){return this.label||this.domNode.innerHTML},
state:"DORMANT",_setStateAttr:function(H){if(!(this.state==H||"SHOW TIMER"==H&&"SHOWING"==this.state||"HIDE TIMER"==H&&"DORMANT"==this.state)){this._hideTimer&&(this._hideTimer.remove(),delete this._hideTimer);this._showTimer&&(this._showTimer.remove(),delete this._showTimer);switch(H){case "DORMANT":this._connectNode&&(I.hide(this._connectNode),delete this._connectNode,this.onHide());break;case "SHOW TIMER":"SHOWING"!=this.state&&(this._showTimer=this.defer(function(){this.set("state","SHOWING")},
this.showDelay));break;case "SHOWING":var u=this.getContent(this._connectNode);if(!u){this.set("state","DORMANT");return}I.show(u,this._connectNode,this.position,!this.isLeftToRight(),this.textDir,A.hitch(this,"set","state","SHOWING"),A.hitch(this,"set","state","HIDE TIMER"));this.onShow(this._connectNode,this.position);break;case "HIDE TIMER":this._hideTimer=this.defer(function(){this.set("state","DORMANT")},this.hideDelay)}this._set("state",H)}},_onHover:function(H){this._connectNode&&H!=this._connectNode&&
this.set("state","DORMANT");this._connectNode=H;this.set("state","SHOW TIMER")},_onUnHover:function(H){this.set("state","HIDE TIMER")},open:function(H){this.set("state","DORMANT");this._connectNode=H;this.set("state","SHOWING")},close:function(){this.set("state","DORMANT")},onShow:function(){},onHide:function(){},destroy:function(){this.set("state","DORMANT");L.forEach(this._connections||[],function(H){L.forEach(H,function(u){u.remove()})},this);this.inherited(arguments)}});I._MasterTooltip=y;I.show=
d.showTooltip;I.hide=d.hideTooltip;I.defaultPosition=["after-centered","before-centered"];return I})},"dijit/form/ValidationTextBox":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/i18n ./TextBox ../Tooltip dojo/text!./templates/ValidationTextBox.html dojo/i18n!./nls/validate".split(" "),function(L,J,q,K,E,w,x){var A=L("dijit.form.ValidationTextBox",E,{templateString:x,required:!1,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},
pattern:".*",regExp:"",regExpGen:function(){},state:"",tooltipPosition:[],_deprecateRegExp:function(n,g){g!=A.prototype[n]&&(J.deprecated("ValidationTextBox id\x3d"+this.id+", set('"+n+"', ...) is deprecated.  Use set('pattern', ...) instead.","","2.0"),this.set("pattern",g))},_setRegExpGenAttr:function(n){this._deprecateRegExp("regExpGen",n);this._set("regExpGen",this._computeRegexp)},_setRegExpAttr:function(n){this._deprecateRegExp("regExp",n)},_setValueAttr:function(){this.inherited(arguments);
this._refreshState()},validator:function(n,g){return(new RegExp("^(?:"+this._computeRegexp(g)+")"+(this.required?"":"?")+"$")).test(n)&&(!this.required||!this._isEmpty(n))&&(this._isEmpty(n)||void 0!==this.parse(n,g))},_isValidSubset:function(){return 0==this.textbox.value.search(this._partialre)},isValid:function(){return this.validator(this.textbox.value,this.get("constraints"))},_isEmpty:function(n){return(this.trim?/^\s*$/:/^$/).test(n)},getErrorMessage:function(){var n="$_unset_$"==this.invalidMessage?
this.messages.invalidMessage:this.invalidMessage?this.invalidMessage:this.promptMessage,g="$_unset_$"==this.missingMessage?this.messages.missingMessage:this.missingMessage?this.missingMessage:n;return this.required&&this._isEmpty(this.textbox.value)?g:n},getPromptMessage:function(){return this.promptMessage},_maskValidSubsetError:!0,validate:function(n){var g="",m=this.disabled||this.isValid(n);m&&(this._maskValidSubsetError=!0);var l=this._isEmpty(this.textbox.value),f=!m&&n&&this._isValidSubset();
this._set("state",m?"":((!this._hasBeenBlurred||n)&&l||f)&&(this._maskValidSubsetError||f&&!this._hasBeenBlurred&&n)?"Incomplete":"Error");this.focusNode.setAttribute("aria-invalid","Error"==this.state?"true":"false");"Error"==this.state?(this._maskValidSubsetError=n&&f,g=this.getErrorMessage(n)):"Incomplete"==this.state?(g=this.getPromptMessage(n),this._maskValidSubsetError=!this._hasBeenBlurred||n):l&&(g=this.getPromptMessage(n));this.set("message",g);return m},displayMessage:function(n){n&&this.focused?
w.show(n,this.domNode,this.tooltipPosition,!this.isLeftToRight()):w.hide(this.domNode)},_refreshState:function(){this._created&&this.validate(this.focused);this.inherited(arguments)},constructor:function(n){this.constraints=q.clone(this.constraints);this.baseClass+=" dijitValidationTextBox"},startup:function(){this.inherited(arguments);this._refreshState()},_setConstraintsAttr:function(n){!n.locale&&this.lang&&(n.locale=this.lang);this._set("constraints",n);this._refreshState()},_setPatternAttr:function(n){this._set("pattern",
n);this._refreshState()},_computeRegexp:function(n){var g=this.pattern;"function"==typeof g&&(g=g.call(this,n));if(g!=this._lastRegExp){var m="";this._lastRegExp=g;".*"!=g&&g.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(l){switch(l.charAt(0)){case "{":case "+":case "?":case "*":case "^":case "$":case "|":case "(":m+=l;break;case ")":m+="|$)";break;default:m+="(?:"+l+"|$)"}});try{"".search(m)}catch(l){m=this.pattern,console.warn("RegExp error in "+this.declaredClass+": "+this.pattern)}this._partialre=
"^(?:"+m+")$"}return g},postMixInProperties:function(){this.inherited(arguments);this.messages=K.getLocalization("dijit.form","validate",this.lang);this._setConstraintsAttr(this.constraints)},_setDisabledAttr:function(n){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(n){this._set("required",n);this.focusNode.setAttribute("aria-required",n);this._refreshState()},_setMessageAttr:function(n){this._set("message",n);this.displayMessage(n)},reset:function(){this._maskValidSubsetError=
!0;this.inherited(arguments)},_onBlur:function(){this.displayMessage("");this.inherited(arguments)},destroy:function(){w.hide(this.domNode);this.inherited(arguments)}});return A})},"dijit/form/TextBox":function(){define("dojo/_base/declare dojo/dom-construct dojo/dom-style dojo/_base/kernel dojo/_base/lang dojo/on dojo/sniff ./_FormValueWidget ./_TextBoxMixin dojo/text!./templates/TextBox.html ../main".split(" "),function(L,J,q,K,E,w,x,A,n,g,m){A=L("dijit.form.TextBox"+(x("dojo-bidi")?"_NoBidi":""),
[A,n],{templateString:g,_singleNodeTemplate:'\x3cinput class\x3d"dijit dijitReset dijitLeft dijitInputField" data-dojo-attach-point\x3d"textbox,focusNode" autocomplete\x3d"off" type\x3d"${type}" ${!nameAttrSetting} /\x3e',_buttonInputDisabled:x("ie")?"disabled":"",baseClass:"dijitTextBox",postMixInProperties:function(){var l=this.type.toLowerCase();if(this.templateString&&"input"==this.templateString.toLowerCase()||("hidden"==l||"file"==l)&&this.templateString==this.constructor.prototype.templateString)this.templateString=
this._singleNodeTemplate;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);9>x("ie")&&this.defer(function(){try{var l=q.getComputedStyle(this.domNode);if(l){var f=l.fontFamily;if(f){var b=this.domNode.getElementsByTagName("INPUT");if(b)for(l=0;l<b.length;l++)b[l].style.fontFamily=f}}}catch(c){}})},_setPlaceHolderAttr:function(l){this._set("placeHolder",l);this._phspan||(this._attachPoints.push("_phspan"),this._phspan=J.create("span",{className:"dijitPlaceHolder dijitInputField"},
this.textbox,"after"),this.own(w(this._phspan,"mousedown",function(f){f.preventDefault()}),w(this._phspan,"touchend, pointerup, MSPointerUp",E.hitch(this,function(){this.focus()}))));this._phspan.innerHTML="";this._phspan.appendChild(this._phspan.ownerDocument.createTextNode(l));this._updatePlaceHolder()},_onInput:function(l){this.inherited(arguments);this._updatePlaceHolder()},_updatePlaceHolder:function(){this._phspan&&(this._phspan.style.display=this.placeHolder&&!this.textbox.value?"":"none")},
_setValueAttr:function(l,f,b){this.inherited(arguments);this._updatePlaceHolder()},getDisplayedValue:function(){K.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use get('displayedValue') instead.","","2.0");return this.get("displayedValue")},setDisplayedValue:function(l){K.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");this.set("displayedValue",l)},_onBlur:function(l){this.disabled||(this.inherited(arguments),
this._updatePlaceHolder(),x("mozilla")&&this.selectOnClick&&(this.textbox.selectionStart=this.textbox.selectionEnd=void 0))},_onFocus:function(l){this.disabled||this.readOnly||(this.inherited(arguments),this._updatePlaceHolder())}});9>x("ie")&&(A.prototype._isTextSelected=function(){var l=this.ownerDocument.selection.createRange();return l.parentElement()==this.textbox&&0<l.text.length},m._setSelectionRange=n._setSelectionRange=function(l,f,b){l.createTextRange&&(l=l.createTextRange(),l.collapse(!0),
l.moveStart("character",-99999),l.moveStart("character",f),l.moveEnd("character",b-f),l.select())});x("dojo-bidi")&&(A=L("dijit.form.TextBox",A,{_setPlaceHolderAttr:function(l){this.inherited(arguments);this.applyTextDir(this._phspan)}}));return A})},"dijit/form/_TextBoxMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/sniff dojo/keys dojo/_base/lang dojo/on ../main".split(" "),function(L,J,q,K,E,w,x,A){var n=J("dijit.form._TextBoxMixin"+(K("dojo-bidi")?"_NoBidi":""),null,
{trim:!1,uppercase:!1,lowercase:!1,propercase:!1,maxLength:"",selectOnClick:!1,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(g,m,l){if(void 0!==g){var f=this.filter(g);"string"!=typeof l&&(l=null===f||"number"==typeof f&&isNaN(f)?"":this.filter(this.format(f,this.constraints)),0!=this.compare(f,this.filter(this.parse(l,this.constraints)))&&(l=null))}null==l||"number"==typeof l&&isNaN(l)||this.textbox.value==l||(this.textbox.value=
l,this._set("displayedValue",this.get("displayedValue")));this.inherited(arguments,[f,m])},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},_setDisplayedValueAttr:function(g){null==g?g="":"string"!=typeof g&&(g=String(g));this.textbox.value=g;this._setValueAttr(this.get("value"),void 0);this._set("displayedValue",this.get("displayedValue"))},format:function(g){return null==g?"":g.toString?g.toString():g},parse:function(g){return g},_refreshState:function(){},
onInput:function(){},_onInput:function(g){this._lastInputEventValue=this.textbox.value;this._processInput(this._lastInputProducingEvent||g);delete this._lastInputProducingEvent;this.intermediateChanges&&this._handleOnChange(this.get("value"),!1)},_processInput:function(){this._refreshState();this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);this.own(x(this.textbox,"keydown, keypress, paste, cut, compositionend",
w.hitch(this,function(g){if("keydown"==g.type&&229!=g.keyCode){var m=g.keyCode;switch(m){case E.SHIFT:case E.ALT:case E.CTRL:case E.META:case E.CAPS_LOCK:case E.NUM_LOCK:case E.SCROLL_LOCK:return}if(!g.ctrlKey&&!g.metaKey&&!g.altKey){switch(m){case E.NUMPAD_0:case E.NUMPAD_1:case E.NUMPAD_2:case E.NUMPAD_3:case E.NUMPAD_4:case E.NUMPAD_5:case E.NUMPAD_6:case E.NUMPAD_7:case E.NUMPAD_8:case E.NUMPAD_9:case E.NUMPAD_MULTIPLY:case E.NUMPAD_PLUS:case E.NUMPAD_ENTER:case E.NUMPAD_MINUS:case E.NUMPAD_PERIOD:case E.NUMPAD_DIVIDE:return}if(65<=
m&&90>=m||48<=m&&57>=m||m==E.SPACE)return;m=!1;for(var l in E)if(E[l]===g.keyCode){m=!0;break}if(!m)return}}(m=32<=g.charCode?String.fromCharCode(g.charCode):g.charCode)||(m=65<=g.keyCode&&90>=g.keyCode||48<=g.keyCode&&57>=g.keyCode||g.keyCode==E.SPACE?String.fromCharCode(g.keyCode):g.keyCode);m||(m=229);if("keypress"==g.type){if("string"!=typeof m)return;if("a"<=m&&"z">=m||"A"<=m&&"Z">=m||"0"<=m&&"9">=m||" "===m)if(g.ctrlKey||g.metaKey||g.altKey)return}var f={faux:!0},b;for(b in g)/^(layer[XY]|returnValue|keyLocation)$/.test(b)||
(l=g[b],"function"!=typeof l&&"undefined"!=typeof l&&(f[b]=l));w.mixin(f,{charOrCode:m,_wasConsumed:!1,preventDefault:function(){f._wasConsumed=!0;g.preventDefault()},stopPropagation:function(){g.stopPropagation()}});this._lastInputProducingEvent=f;!1===this.onInput(f)&&(f.preventDefault(),f.stopPropagation());if(!f._wasConsumed&&9>=K("ie"))switch(g.keyCode){case E.TAB:case E.ESCAPE:case E.DOWN_ARROW:case E.UP_ARROW:case E.LEFT_ARROW:case E.RIGHT_ARROW:break;default:g.keyCode==E.ENTER&&"textarea"!=
this.textbox.tagName.toLowerCase()||this.defer(function(){this.textbox.value!==this._lastInputEventValue&&x.emit(this.textbox,"input",{bubbles:!0})})}})),x(this.textbox,"input",w.hitch(this,"_onInput")),x(this.domNode,"keypress",function(g){g.stopPropagation()}))},_blankValue:"",filter:function(g){if(null===g)return this._blankValue;if("string"!=typeof g)return g;this.trim&&(g=w.trim(g));this.uppercase&&(g=g.toUpperCase());this.lowercase&&(g=g.toLowerCase());this.propercase&&(g=g.replace(/[^\s]+/g,
function(m){return m.substring(0,1).toUpperCase()+m.substring(1)}));return g},_setBlurValue:function(){this._setValueAttr(this.get("value"),!0)},_onBlur:function(g){this.disabled||(this._setBlurValue(),this.inherited(arguments))},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd},_onFocus:function(g){this.disabled||this.readOnly||(this.selectOnClick&&"mouse"==g&&(this._selectOnClickHandle=x.once(this.domNode,"mouseup, touchend",w.hitch(this,function(m){this._isTextSelected()||
n.selectInputText(this.textbox)})),this.own(this._selectOnClickHandle),this.defer(function(){this._selectOnClickHandle&&(this._selectOnClickHandle.remove(),this._selectOnClickHandle=null)},500)),this.inherited(arguments),this._refreshState())},reset:function(){this.textbox.value="";this.inherited(arguments)}});K("dojo-bidi")&&(n=J("dijit.form._TextBoxMixin",n,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_setDisplayedValueAttr:function(){this.inherited(arguments);
this.applyTextDir(this.focusNode)},_onInput:function(){this.applyTextDir(this.focusNode);this.inherited(arguments)}}));n._setSelectionRange=A._setSelectionRange=function(g,m,l){g.setSelectionRange&&g.setSelectionRange(m,l)};n.selectInputText=A.selectInputText=function(g,m,l){g=q.byId(g);isNaN(m)&&(m=0);isNaN(l)&&(l=g.value?g.value.length:0);try{g.focus(),n._setSelectionRange(g,m,l)}catch(f){}};return n})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],
function(L,J,q){return L("dijit.form.DateTextBox",q,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",popupClass:J,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),function(L,J,q,
K,E,w,x,A,n,g,m,l,f,b,c,a,e){var d=K("dijit.Calendar",[f,b,c],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(h){A.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",h)},_createMonthWidget:function(){return new d._MonthDropDownButton({id:this.id+"_mddb",tabIndex:-1,
onMonthSelect:g.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(m(this.domNode,"keydown",g.hitch(this,"_onKeyDown")),m(this.dateRowsNode,"mouseover",g.hitch(this,"_onDayMouseOver")),m(this.dateRowsNode,"mouseout",g.hitch(this,"_onDayMouseOut")),m(this.dateRowsNode,"mousedown",g.hitch(this,"_onDayMouseDown")),m(this.dateRowsNode,"mouseup",g.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(h){var y=
new this.dateClassObj(this.currentFocus);y.setDate(1);y.setMonth(h);h=this.dateModule.getDaysInMonth(y);var I=this.currentFocus.getDate();y.setDate(Math.min(I,h));this._setCurrentFocusAttr(y)},_onDayMouseOver:function(h){(h=w.contains(h.target,"dijitCalendarDateLabel")?h.target.parentNode:h.target)&&(h.dijitDateValue&&!w.contains(h,"dijitCalendarDisabledDate")||h==this.previousYearLabelNode||h==this.nextYearLabelNode)&&(w.add(h,"dijitCalendarHoveredDate"),this._currentNode=h)},_onDayMouseOut:function(h){!this._currentNode||
h.relatedTarget&&h.relatedTarget.parentNode==this._currentNode||(h="dijitCalendarHoveredDate",w.contains(this._currentNode,"dijitCalendarActiveDate")&&(h+=" dijitCalendarActiveDate"),w.remove(this._currentNode,h),this._currentNode=null)},_onDayMouseDown:function(h){(h=h.target.parentNode)&&h.dijitDateValue&&!w.contains(h,"dijitCalendarDisabledDate")&&(w.add(h,"dijitCalendarActiveDate"),this._currentNode=h)},_onDayMouseUp:function(h){(h=h.target.parentNode)&&h.dijitDateValue&&w.remove(h,"dijitCalendarActiveDate")},
handleKey:function(h){var y=-1,I=this.currentFocus;switch(h.keyCode){case n.RIGHT_ARROW:y=1;case n.LEFT_ARROW:var H="day";this.isLeftToRight()||(y*=-1);break;case n.DOWN_ARROW:y=1;case n.UP_ARROW:H="week";break;case n.PAGE_DOWN:y=1;case n.PAGE_UP:H=h.ctrlKey||h.altKey?"year":"month";break;case n.END:I=this.dateModule.add(I,"month",1),H="day";case n.HOME:I=new this.dateClassObj(I);I.setDate(1);break;default:return!0}H&&(I=this.dateModule.add(I,H,y));this._setCurrentFocusAttr(I);return!1},_onKeyDown:function(h){this.handleKey(h)||
(h.stopPropagation(),h.preventDefault())},onValueSelected:function(){},onChange:function(h){this.onValueSelected(h)},getClassForDate:function(){}});d._MonthDropDownButton=K("dijit.Calendar._MonthDropDownButton",e,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new d._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(h){var y=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,h);this.dropDown.set("months",
y);this.containerNode.innerHTML=(6==l("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+y[h.getMonth()]+"\x3c/div\x3e"}});d._MonthDropDown=K("dijit.Calendar._MonthDropDown",[b,a,c],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(h){this.domNode.innerHTML=
"";L.forEach(h,function(y,I){x.create("div",{className:"dijitCalendarMonthLabel",month:I,innerHTML:y},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(h){this.onChange(E.get(h.target,"month"))},onChange:function(){}});return d})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a){var e=J("dijit.CalendarLite",[b,c],{templateString:a,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(d){return d&&!isNaN(d)&&"object"==typeof d&&d.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var d=this._get("value");if(d&&!isNaN(d)){var h=
new this.dateClassObj(d);h.setHours(0,0,0,0);h.getDate()<d.getDate()&&(h=this.dateModule.add(h,"hour",1));return h}return null},_setValueAttr:function(d,h){"string"==typeof d&&(d=w.fromISOString(d));d=this._patchDate(d);if(this._isValidDate(d)&&!this.isDisabledDate(d,this.lang)){if(this._set("value",d),this.set("currentFocus",d),this._markSelectedDates([d]),this._created&&(h||"undefined"==typeof h))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(d){if(d||
0===d)d=new this.dateClassObj(d),d.setHours(1,0,0,0);return d},_setText:function(d,h){for(;d.firstChild;)d.removeChild(d.firstChild);d.appendChild(d.ownerDocument.createTextNode(h))},_populateGrid:function(){var d=new this.dateClassObj(this.currentFocus);d.setDate(1);d=this._patchDate(d);var h=d.getDay(),y=this.dateModule.getDaysInMonth(d),I=this.dateModule.getDaysInMonth(this.dateModule.add(d,"month",-1)),H=new this.dateClassObj,u=0<=this.dayOffset?this.dayOffset:q.getFirstDayOfWeek(this.lang);u>
h&&(u-=7);if(!this.summary){var G=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,d);this.gridNode.setAttribute("summary",G[d.getMonth()])}this._date2cell={};L.forEach(this.dateCells,function(v,t){var F=t+u,B=new this.dateClassObj(d),O="dijitCalendar",M=0;F<h?(F=I-h+F+1,M=-1,O+="Previous"):F>=h+y?(F=F-h-y+1,M=1,O+="Next"):(F=F-h+1,O+="Current");M&&(B=this.dateModule.add(B,"month",M));B.setDate(F);this.dateModule.compare(B,H,"date")||(O="dijitCalendarCurrentDate "+O);this.isDisabledDate(B,
this.lang)?(O="dijitCalendarDisabledDate "+O,v.setAttribute("aria-disabled","true")):(O="dijitCalendarEnabledDate "+O,v.removeAttribute("aria-disabled"),v.setAttribute("aria-selected","false"));(M=this.getClassForDate(B,this.lang))&&(O=M+" "+O);v.className=O+"Month dijitCalendarDateTemplate";O=B.valueOf();this._date2cell[O]=v;v.dijitDateValue=O;O=B.getDateLocalized?B.getDateLocalized(this.lang):B.getDate();this._setText(this.dateLabels[t],O);n.set(v,"aria-label",E.format(B,{selector:"date",formatLength:"long"}))},
this)},_populateControls:function(){var d=new this.dateClassObj(this.currentFocus);d.setDate(1);this.monthWidget.set("month",d);var h=d.getFullYear()-1,y=new this.dateClassObj;L.forEach(["previous","current","next"],function(I){y.setFullYear(h++);this._setText(this[I+"YearLabelNode"],this.dateLocaleModule.format(y,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(d){this.dateModule=d.datePackage?g.getObject(d.datePackage,
!1):K;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=d.datePackage?g.getObject(d.datePackage+".locale",!1):E},_createMonthWidget:function(){return e._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var d=this.dowTemplateString,h=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),y=0<=this.dayOffset?this.dayOffset:q.getFirstDayOfWeek(this.lang);this.dayCellsHtml=f.substitute([d,
d,d,d,d,d,d].join(""),{d:""},function(){return h[y++%7]});d=f.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[d,d,d,d,d,d].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);x.setSelectable(this.domNode,!1);d=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",d,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var d=g.hitch(this,function(h,
y,I){this[h].dojoClick=!0;return m(this[h],"click",g.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,y,I))}))});this.own(d("incrementMonth","month",1),d("decrementMonth","month",-1),d("nextYearLabelNode","year",1),d("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(d,h){var y=this.currentFocus,I=this._getNodeByDate(y);d=this._patchDate(d);this._set("currentFocus",d);this._date2cell&&0==this.dateModule.difference(y,d,"month")||(this._populateGrid(),
this._populateControls(),this._markSelectedDates([this.value]));d=this._getNodeByDate(d);d.setAttribute("tabIndex",this.tabIndex);(this.focused||h)&&d.focus();I&&I!=d&&(l("webkit")?I.setAttribute("tabIndex","-1"):I.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(d){d.stopPropagation();d.preventDefault();for(d=d.target;d&&!d.dijitDateValue&&0!==d.dijitDateValue;d=d.parentNode);d&&!A.contains(d,"dijitCalendarDisabledDate")&&this.set("value",
d.dijitDateValue)},_getNodeByDate:function(d){return(d=this._patchDate(d))&&this._date2cell?this._date2cell[d.valueOf()]:null},_markSelectedDates:function(d){function h(y,I){A.toggle(I,"dijitCalendarSelectedDate",y);I.setAttribute("aria-selected",y?"true":"false")}L.forEach(this._selectedCells||[],g.partial(h,!1));this._selectedCells=L.filter(L.map(d,this._getNodeByDate,this),function(y){return y});L.forEach(this._selectedCells,g.partial(h,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});
e._MonthWidget=J("dijit.CalendarLite._MonthWidget",b,{_setMonthAttr:function(d){var h=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,d),y=6==l("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+L.map(h,function(I){return"\x3cdiv\x3e"+I+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=y+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+h[d.getMonth()]+"\x3c/div\x3e"}});return e})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],
function(L,J){var q={};L.setObject("dojo.date.stamp",q);q.fromISOString=function(K,E){q._isoRegExp||(q._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var w=q._isoRegExp.exec(K);K=null;if(w){w.shift();w[1]&&w[1]--;w[6]&&(w[6]*=1E3);E&&(E=new Date(E),J.forEach(J.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(n){return E["get"+n]()}),function(n,g){w[g]=w[g]||n}));K=new Date(w[0]||1970,w[1]||
0,w[2]||1,w[3]||0,w[4]||0,w[5]||0,w[6]||0);100>w[0]&&K.setFullYear(w[0]||1970);var x=0,A=w[7]&&w[7].charAt(0);"Z"!=A&&(x=60*(w[8]||0)+(Number(w[9])||0),"-"!=A&&(x*=-1));A&&(x-=K.getTimezoneOffset());x&&K.setTime(K.getTime()+6E4*x)}return K};q.toISOString=function(K,E){var w=function(g){return 10>g?"0"+g:g};E=E||{};var x=[],A=E.zulu?"getUTC":"get",n="";"time"!=E.selector&&(n=K[A+"FullYear"](),n=["0000".substr((n+"").length)+n,w(K[A+"Month"]()+1),w(K[A+"Date"]())].join("-"));x.push(n);"date"!=E.selector&&
(n=[w(K[A+"Hours"]()),w(K[A+"Minutes"]()),w(K[A+"Seconds"]())].join(":"),A=K[A+"Milliseconds"](),E.milliseconds&&(n+="."+(100>A?"0":"")+w(A)),E.zulu?n+="Z":"time"!=E.selector&&(K=K.getTimezoneOffset(),E=Math.abs(K),n+=(0<K?"-":"+")+w(Math.floor(E/60))+":"+w(E%60)),x.push(n));return x.join("T")};return q})},"dijit/form/DropDownButton":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/query ../registry ../popup ./Button ../_Container ../_HasDropDown dojo/text!./templates/DropDownButton.html ../a11yclick".split(" "),
function(L,J,q,K,E,w,x,A,n,g){return L("dijit.form.DropDownButton",[x,A,n],{baseClass:"dijitDropDownButton",templateString:g,_fillContent:function(){var m=this.srcNodeRef,l=this.containerNode;if(m&&l)for(;m.hasChildNodes();){var f=m.firstChild;f.hasAttribute&&(f.hasAttribute("data-dojo-type")||f.hasAttribute("dojoType")||f.hasAttribute("data-"+J._scopeName+"-type")||f.hasAttribute(J._scopeName+"Type"))?(this.dropDownContainer=this.ownerDocument.createElement("div"),this.dropDownContainer.appendChild(f)):
l.appendChild(f)}},startup:function(){this._started||(!this.dropDown&&this.dropDownContainer&&(this.dropDown=E.byNode(this.dropDownContainer.firstChild),delete this.dropDownContainer),this.dropDown&&w.hide(this.dropDown),this.inherited(arguments))},isLoaded:function(){var m=this.dropDown;return!!m&&(!m.href||m.isLoaded)},loadDropDown:function(m){var l=this.dropDown,f=l.on("load",q.hitch(this,function(){f.remove();m()}));l.refresh()},isFocusable:function(){return this.inherited(arguments)&&!this._mouseDown}})})},
"dijit/form/Button":function(){define("require dojo/_base/declare dojo/dom-class dojo/has dojo/_base/kernel dojo/_base/lang dojo/ready ./_FormWidget ./_ButtonMixin dojo/text!./templates/Button.html ../a11yclick".split(" "),function(L,J,q,K,E,w,x,A,n,g){K("dijit-legacy-requires")&&x(0,function(){L(["dijit/form/DropDownButton","dijit/form/ComboButton","dijit/form/ToggleButton"])});x=J("dijit.form.Button"+(K("dojo-bidi")?"_NoBidi":""),[A,n],{showLabel:!0,iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",
type:"class"},baseClass:"dijitButton",templateString:g,_setValueAttr:"valueNode",_setNameAttr:function(m){this.valueNode&&this.valueNode.setAttribute("name",m)},postCreate:function(){this.inherited(arguments);this._setLabelFromContainer()},_setLabelFromContainer:function(){this.containerNode&&!this.label&&(this.label=w.trim(this.containerNode.innerHTML),this.onLabelSet())},_setShowLabelAttr:function(m){this.containerNode&&q.toggle(this.containerNode,"dijitDisplayNone",!m);this._set("showLabel",m)},
setLabel:function(m){E.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",m)},onLabelSet:function(){this.inherited(arguments);this.showLabel||"title"in this.params||(this.titleNode.title=w.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});K("dojo-bidi")&&(x=J("dijit.form.Button",x,{onLabelSet:function(){this.inherited(arguments);this.titleNode.title&&this.applyTextDir(this.titleNode,this.titleNode.title)},_setTextDirAttr:function(m){this._created&&
this.textDir!=m&&(this._set("textDir",m),this._setLabelAttr(this.label))}}));return x})},"dijit/form/_ButtonMixin":function(){define(["dojo/_base/declare","dojo/dom","dojo/has","../registry"],function(L,J,q,K){var E=L("dijit.form._ButtonMixin"+(q("dojo-bidi")?"_NoBidi":""),null,{label:"",type:"button",__onClick:function(w){w.stopPropagation();w.preventDefault();this.disabled||this.valueNode.click(w);return!1},_onClick:function(w){if(this.disabled)return w.stopPropagation(),w.preventDefault(),!1;!1===
this.onClick(w)&&w.preventDefault();var x=w.defaultPrevented;if(!x&&"submit"==this.type&&!(this.valueNode||this.focusNode).form)for(var A=this.domNode;A.parentNode;A=A.parentNode){var n=K.byNode(A);if(n&&"function"==typeof n._onSubmit){n._onSubmit(w);w.preventDefault();x=!0;break}}return!x},postCreate:function(){this.inherited(arguments);J.setSelectable(this.focusNode,!1)},onClick:function(){return!0},_setLabelAttr:function(w){this._set("label",w);(this.containerNode||this.focusNode).innerHTML=w;
this.onLabelSet()},onLabelSet:function(){}});q("dojo-bidi")&&(E=L("dijit.form._ButtonMixin",E,{onLabelSet:function(){this.inherited(arguments);this.applyTextDir(this.containerNode||this.focusNode)}}));return E})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),function(L,J,q,K,E,w,x,A){new Date("X");return K("dijit.form._DateTimeTextBox",
[w,x],{templateString:A,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:J.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(n,g){var m=this._isInvalidDate(n),l=this._isInvalidDate(g);if(m||l)return m&&l?0:m?-1:1;n=this.format(n,this._unboundedConstraints);g=this.format(g,this._unboundedConstraints);m=this.parse(n,this._unboundedConstraints);l=this.parse(g,this._unboundedConstraints);
return n==g?0:L.compare(m,l,this._selector)},autoWidth:!0,format:function(n,g){return n?this.dateLocaleModule.format(n,g):""},parse:function(n,g){return this.dateLocaleModule.parse(n,g)||(this._isEmpty(n)?null:void 0)},serialize:function(n,g){n.toGregorian&&(n=n.toGregorian());return q.toISOString(n,g)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(n){n=n||{};this.dateModule=n.datePackage?E.getObject(n.datePackage,!1):L;this.dateClassObj=
this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=n.datePackage?E.getObject(n.datePackage+".locale",!1):J;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},
_setConstraintsAttr:function(n){n.selector=this._selector;n.fullYear=!0;var g=q.fromISOString;"string"==typeof n.min&&(n.min=g(n.min),this.dateClassObj instanceof Date||(n.min=new this.dateClassObj(n.min)));"string"==typeof n.max&&(n.max=g(n.max),this.dateClassObj instanceof Date||(n.max=new this.dateClassObj(n.max)));this.inherited(arguments);this._unboundedConstraints=E.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(n){return!n||isNaN(n)||"object"!=typeof n||n.toString()==
this._invalidDate},_setValueAttr:function(n,g,m){void 0!==n&&("string"==typeof n&&(n=q.fromISOString(n)),this._isInvalidDate(n)&&(n=null),n instanceof Date&&!(this.dateClassObj instanceof Date)&&(n=new this.dateClassObj(n)));this.inherited(arguments,[n,g,m]);this.value instanceof Date&&(this.filterString="");!1!==g&&this.dropDown&&this.dropDown.set("value",n,!1)},_set:function(n,g){if("value"==n){g instanceof Date&&!(this.dateClassObj instanceof Date)&&(g=new this.dateClassObj(g));var m=this._get("value");
if(m instanceof this.dateClassObj&&0==this.compare(g,m))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(n){this._isInvalidDate(n)&&(n=new this.dateClassObj);this._set("dropDownDefaultValue",n)},openDropDown:function(n){this.dropDown&&this.dropDown.destroy();var g=E.isString(this.popupClass)?E.getObject(this.popupClass,!1):this.popupClass,m=this,l=this.get("value");this.dropDown=new g({onChange:function(f){m.set("value",f,!0)},id:this.id+"_popup",dir:m.dir,lang:m.lang,value:l,
textDir:m.textDir,currentFocus:this._isInvalidDate(l)?this.dropDownDefaultValue:l,constraints:m.constraints,filterString:m.filterString,datePackage:m.datePackage,isDisabledDate:function(f){return!m.rangeCheck(f,m.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(n,g){this._setValueAttr(this.parse(n,this.constraints),g,n)}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox",
"dojo/i18n!./nls/validate"],function(L,J,q){return L("dijit.form.RangeBoundTextBox",q,{rangeMessage:"",rangeCheck:function(K,E){return("min"in E?0<=this.compare(K,E.min):!0)&&("max"in E?0>=this.compare(K,E.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var K=this.get("value");if(null==K)return!1;var E=!1;"min"in this.constraints&&(E=this.constraints.min,E=0>this.compare(K,"number"==typeof E&&0<=E&&0!=K?0:E));!E&&"max"in
this.constraints&&(E=this.constraints.max,E=0<this.compare(K,"number"!=typeof E||0<E?E:0));return E},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(K){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(K))},getErrorMessage:function(K){var E=this.get("value");return null==E||""===E||"number"==typeof E&&isNaN(E)||this.isInRange(K)?this.inherited(arguments):this.rangeMessage},postMixInProperties:function(){this.inherited(arguments);
this.rangeMessage||(this.messages=J.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(L,J,q,K){return L("dijit.form.MappedTextBox",K,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(E){return E.toString?E.toString():""},toString:function(){var E=
this.filter(this.get("value"));return null!=E?"string"==typeof E?E:this.serialize(E,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=q.place("\x3cinput type\x3d'hidden'"+(this.name&&!J("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/TimeTextBox":function(){define("dojo/_base/declare dojo/keys dojo/query dojo/_base/lang ../_TimePicker ./_DateTimeTextBox".split(" "),
function(L,J,q,K,E,w){return L("dijit.form.TimeTextBox",w,{baseClass:"dijitTextBox dijitComboBox dijitTimeTextBox",popupClass:E,_selector:"time",value:new Date(""),maxHeight:-1,openDropDown:function(x){this.inherited(arguments);var A=q(".dijitTimePickerItemSelected",this.dropDown.domNode),n=this.dropDown.domNode.parentNode;n.scrollTop=A[0]?A[0].offsetTop-(n.clientHeight-A[0].clientHeight)/2:(n.scrollHeight-n.clientHeight)/2;this.dropDown.on("input",K.hitch(this,function(){this.set("value",this.dropDown.get("value"),
!1)}))},_onInput:function(){this.inherited(arguments);var x=this.get("displayedValue");this.filterString=x&&!this.parse(x,this.constraints)?x.toLowerCase():"";this._opened&&this.closeDropDown();this.openDropDown()}})})},"dijit/_TimePicker":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/sniff dojo/query dojo/mouse dojo/on ./_WidgetBase ./form/_ListMouseMixin".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a){return E("dijit._TimePicker",[c,a],{baseClass:"dijitTimePicker",pickerMin:"T00:00:00",pickerMax:"T23:59:59",clickableIncrement:"T00:15:00",visibleIncrement:"T01:00:00",value:new Date,_visibleIncrement:2,_clickableIncrement:1,_totalIncrements:10,constraints:{},serialize:K.toISOString,buildRendering:function(){this.inherited(arguments);this.timeMenu=this.containerNode=this.domNode},setValue:function(e){A.deprecated("dijit._TimePicker:setValue() is deprecated.  Use set('value', ...) instead.",
"","2.0");this.set("value",e)},_setValueAttr:function(e){this._set("value",e);this._showText()},_setFilterStringAttr:function(e){this._set("filterString",e);this._showText()},isDisabledDate:function(){return!1},_getFilteredNodes:function(e,d,h,y){e=this.ownerDocument.createDocumentFragment();for(d=0;d<this._maxIncrement;d++)(h=this._createOption(d))&&e.appendChild(h);return e},_showText:function(){var e=K.fromISOString;this.domNode.innerHTML="";this._clickableIncrementDate=e(this.clickableIncrement);
this._visibleIncrementDate=e(this.visibleIncrement);var d=function(y){return 3600*y.getHours()+60*y.getMinutes()+y.getSeconds()},h=d(this._clickableIncrementDate);d=d(this._visibleIncrementDate);(this.value||this.currentFocus).getTime();this._refDate=e(this.pickerMin);this._refDate.setFullYear(1970,0,1);this._clickableIncrement=1;this._visibleIncrement=d/h;e=e(this.pickerMax);e.setFullYear(1970,0,1);e=.001*(e.getTime()-this._refDate.getTime());this._maxIncrement=Math.ceil((e+1)/h);h=this._getFilteredNodes();
!h.firstChild&&this.filterString?(this.filterString="",this._showText()):this.domNode.appendChild(h)},constructor:function(){this.constraints={}},postMixInProperties:function(){this.inherited(arguments);this._setConstraintsAttr(this.constraints)},_setConstraintsAttr:function(e){for(var d in{clickableIncrement:1,visibleIncrement:1,pickerMin:1,pickerMax:1})d in e&&(this[d]=e[d]);e.locale||(e.locale=this.lang)},_createOption:function(e){var d=new Date(this._refDate),h=this._clickableIncrementDate;d.setHours(d.getHours()+
h.getHours()*e,d.getMinutes()+h.getMinutes()*e,d.getSeconds()+h.getSeconds()*e);"time"==this.constraints.selector&&d.setFullYear(1970,0,1);var y=q.format(d,this.constraints);if(this.filterString&&0!==y.toLowerCase().indexOf(this.filterString))return null;h=this.ownerDocument.createElement("div");h.className=this.baseClass+"Item";h.date=d;h.idx=e;x.create("div",{"class":this.baseClass+"ItemInner",innerHTML:y},h);y=1>e%this._visibleIncrement&&-1<e%this._visibleIncrement;e=!y&&!(e%this._clickableIncrement);
y?h.className+=" "+this.baseClass+"Marker":e&&(h.className+=" "+this.baseClass+"Tick");this.isDisabledDate(d)&&(h.className+=" "+this.baseClass+"ItemDisabled");this.value&&!J.compare(this.value,d,this.constraints.selector)&&(h.selected=!0,h.className+=" "+this.baseClass+"ItemSelected",this._selectedDiv=h,y?h.className+=" "+this.baseClass+"MarkerSelected":e&&(h.className+=" "+this.baseClass+"TickSelected"),this._highlightOption(h,!0));return h},onOpen:function(){this.inherited(arguments);this.set("selected",
this._selectedDiv)},_onOptionSelected:function(e,d){(e=e.target.date||e.target.parentNode.date)&&!this.isDisabledDate(e)&&(this._set("value",e),this.emit("input"),d&&(this._highlighted_option=null,this.set("value",e),this.onChange(e)))},onChange:function(){},_highlightOption:function(e,d){if(e){if(d)this._highlighted_option&&this._highlightOption(this._highlighted_option,!1),this._highlighted_option=e;else{if(this._highlighted_option!==e)return;this._highlighted_option=null}w.toggle(e,this.baseClass+
"ItemHover",d);w.contains(e,this.baseClass+"Marker")?w.toggle(e,this.baseClass+"MarkerHover",d):w.toggle(e,this.baseClass+"TickHover",d)}},handleKey:function(e){if(e.keyCode==n.DOWN_ARROW)return this.selectNextNode(),this._onOptionSelected({target:this._highlighted_option},!1),e.stopPropagation(),e.preventDefault(),!1;if(e.keyCode==n.UP_ARROW)return this.selectPreviousNode(),this._onOptionSelected({target:this._highlighted_option},!1),e.stopPropagation(),e.preventDefault(),!1;if(e.keyCode==n.ENTER||
e.keyCode===n.TAB){if(!this._keyboardSelected&&e.keyCode===n.TAB)return!0;this._highlighted_option&&this._onOptionSelected({target:this._highlighted_option},!0);return e.keyCode===n.TAB}},onHover:function(e){this._highlightOption(e,!0)},onUnhover:function(e){this._highlightOption(e,!1)},onSelect:function(e){this._highlightOption(e,!0)},onDeselect:function(e){this._highlightOption(e,!1)},onClick:function(e){this._onOptionSelected({target:e},!0)}})})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare",
"dojo/on","dojo/touch","./_ListBase"],function(L,J,q,K){return L("dijit.form._ListMouseMixin",K,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover","_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(E,w){this._setSelectedAttr(w,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=
this.defer(function(){this._deferredClick=null;this.onClick(w)})},_onMouseDown:function(E,w){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(w,!1)},_onMouseUp:function(E,w){this._isDragging=!1;var x=this.selected,A=this._hoveredNode;x&&w==x?this.defer(function(){this._onClick(E,x)}):A&&this.defer(function(){this._onClick(E,A)})},_onMouseOut:function(E,w){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=
null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(E,w){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=w;this.onHover(w);this._isDragging&&this._setSelectedAttr(w,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on","dojo/window"],function(L,J,q){return L("dijit.form._ListBase",null,{selected:null,_listConnect:function(K,E){var w=this;return w.own(J(w.containerNode,
J.selector(function(x,A,n){return x.parentNode==n},K),function(x){w[E](x,this)}))},selectFirstNode:function(){for(var K=this.containerNode.firstChild;K&&"none"==K.style.display;)K=K.nextSibling;this._setSelectedAttr(K,!0)},selectLastNode:function(){for(var K=this.containerNode.lastChild;K&&"none"==K.style.display;)K=K.previousSibling;this._setSelectedAttr(K,!0)},selectNextNode:function(){var K=this.selected;if(K){for(K=K.nextSibling;K&&"none"==K.style.display;)K=K.nextSibling;K?this._setSelectedAttr(K,
!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var K=this.selected;if(K){for(K=K.previousSibling;K&&"none"==K.style.display;)K=K.previousSibling;K?this._setSelectedAttr(K,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(K,E){if(this.selected!=K){var w=this.selected;if(w)this.onDeselect(w);K&&(E&&q.scrollIntoView(K),this.onSelect(K));this._set("selected",K)}else if(K)this.onSelect(K)}})})},"dojo/data/ObjectStore":function(){define("../_base/lang ../Evented ../_base/declare ../_base/Deferred ../promise/all ../_base/array ../_base/connect ../regexp".split(" "),
function(L,J,q,K,E,w,x,A){function n(g){return"*"==g?".*":"?"==g?".":g}return q("dojo.data.ObjectStore",[J],{objectStore:null,constructor:function(g){this._dirtyObjects=[];g.labelAttribute&&(g.labelProperty=g.labelAttribute);L.mixin(this,g)},labelProperty:"label",getValue:function(g,m,l){return"function"===typeof g.get?g.get(m):m in g?g[m]:l},getValues:function(g,m){g=this.getValue(g,m);return g instanceof Array?g:void 0===g?[]:[g]},getAttributes:function(g){var m=[],l;for(l in g)!g.hasOwnProperty(l)||
"_"==l.charAt(0)&&"_"==l.charAt(1)||m.push(l);return m},hasAttribute:function(g,m){return m in g},containsValue:function(g,m,l){return-1<w.indexOf(this.getValues(g,m),l)},isItem:function(g){return"object"==typeof g&&g&&!(g instanceof Date)},isItemLoaded:function(g){return g&&"function"!==typeof g.load},loadItem:function(g){var m;"function"===typeof g.item.load?K.when(g.item.load(),function(l){m=l;var f=l instanceof Error?g.onError:g.onItem;f&&f.call(g.scope,l)}):g.onItem&&g.onItem.call(g.scope,g.item);
return m},close:function(g){return g&&g.abort&&g.abort()},fetch:function(g){function m(d){g.onError&&g.onError.call(f,d,g)}g=L.delegate(g,g&&g.queryOptions);var l=this,f=g.scope||l,b=g.query;if("object"==typeof b){b=L.delegate(b);for(var c in b){var a=b[c];"string"==typeof a&&(b[c]=RegExp("^"+A.escapeString(a,"*?\\").replace(/\\.|\*|\?/g,n)+"$",g.ignoreCase?"mi":"m"),b[c].toString=function(d){return function(){return d}}(a))}}var e=this.objectStore.query(b,g);K.when(e.total,function(d){K.when(e,function(h){g.onBegin&&
g.onBegin.call(f,d||h.length,g);if(g.onItem)for(var y=0;y<h.length;y++)g.onItem.call(f,h[y],g);g.onComplete&&g.onComplete.call(f,g.onItem?null:h,g);return h},m)},m);g.abort=function(){e.cancel&&e.cancel()};e.observe&&(this.observing&&this.observing.cancel(),this.observing=e.observe(function(d,h,y){if(-1==w.indexOf(l._dirtyObjects,d))if(-1==h)l.onNew(d);else if(-1==y)l.onDelete(d);else for(var I in d)if(I!=l.objectStore.idProperty)l.onSet(d,I,null,d[I])},!0));this.onFetch(e);g.store=this;return g},
getFeatures:function(){return{"dojo.data.api.Read":!!this.objectStore.get,"dojo.data.api.Identity":!0,"dojo.data.api.Write":!!this.objectStore.put,"dojo.data.api.Notification":!0}},getLabel:function(g){if(this.isItem(g))return this.getValue(g,this.labelProperty)},getLabelAttributes:function(g){return[this.labelProperty]},getIdentity:function(g){return this.objectStore.getIdentity?this.objectStore.getIdentity(g):g[this.objectStore.idProperty||"id"]},getIdentityAttributes:function(g){return[this.objectStore.idProperty]},
fetchItemByIdentity:function(g){var m;K.when(this.objectStore.get(g.identity),function(l){m=l;g.onItem.call(g.scope,l)},function(l){g.onError.call(g.scope,l)});return m},newItem:function(g,m){if(m){var l=this.getValue(m.parent,m.attribute,[]);l=l.concat([g]);g.__parent=l;this.setValue(m.parent,m.attribute,l)}this._dirtyObjects.push({object:g,save:!0});this.onNew(g);return g},deleteItem:function(g){this.changing(g,!0);this.onDelete(g)},setValue:function(g,m,l){var f=g[m];this.changing(g);g[m]=l;this.onSet(g,
m,f,l)},setValues:function(g,m,l){if(!L.isArray(l))throw Error("setValues expects to be passed an Array object as its value");this.setValue(g,m,l)},unsetAttribute:function(g,m){this.changing(g);var l=g[m];delete g[m];this.onSet(g,m,l,void 0)},changing:function(g,m){g.__isDirty=!0;for(var l=0;l<this._dirtyObjects.length;l++){var f=this._dirtyObjects[l];if(g==f.object){m&&(f.object=!1,this._saveNotNeeded||(f.save=!0));return}}f=g instanceof Array?[]:{};for(l in g)g.hasOwnProperty(l)&&(f[l]=g[l]);this._dirtyObjects.push({object:!m&&
g,old:f,save:!this._saveNotNeeded})},save:function(g){g=g||{};var m=[],l=[],f=this,b=this._dirtyObjects;try{x.connect(g,"onError",function(){if(!1!==g.revertOnError){var I=b;b=l;f.revert();f._dirtyObjects=I}else f._dirtyObjects=b.concat(l)});var c;this.objectStore.transaction&&(c=this.objectStore.transaction());for(var a=0;a<b.length;a++){var e=b[a],d=e.object,h=e.old;delete d.__isDirty;if(d){var y=this.objectStore.put(d,{overwrite:!!h});m.push(y)}else"undefined"!=typeof h&&(y=this.objectStore.remove(this.getIdentity(h)),
m.push(y));l.push(e);b.splice(a--,1)}E(m).then(function(I){g.onComplete&&g.onComplete.call(g.scope,I)},function(I){g.onError&&g.onError.call(g.scope,I)});c&&c.commit()}catch(I){g.onError.call(g.scope,value)}},revert:function(){for(var g=this._dirtyObjects,m=g.length;0<m;){m--;var l=g[m],f=l.object;l=l.old;if(f&&l){for(var b in l)l.hasOwnProperty(b)&&f[b]!==l[b]&&(this.onSet(f,b,f[b],l[b]),f[b]=l[b]);for(b in f)l.hasOwnProperty(b)||(this.onSet(f,b,f[b]),delete f[b])}else if(l)this.onNew(l);else this.onDelete(f);
delete (f||l).__isDirty;g.splice(m,1)}},isDirty:function(g){return g?g.__isDirty:!!this._dirtyObjects.length},onSet:function(){},onNew:function(){},onDelete:function(){},onFetch:function(g){}})})},"esri/dijit/Search":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Evented dojo/Deferred dojo/keys dojo/on dojo/query dojo/uacss dojo/regexp dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/date/locale dojo/i18n!../nls/jsapi dojo/text!./Search/templates/Search.html dijit/_WidgetBase dijit/_TemplatedMixin dijit/_FocusMixin dijit/a11yclick dijit/focus ../lang ../InfoTemplate ../kernel ../SpatialReference ../graphic ../promiseList ../symbols/PictureMarkerSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/TextSymbol ../symbols/Font ../geometry/Point ../geometry/Extent ../geometry/normalizeUtils ../geometry/scaleUtils ../tasks/locator ../tasks/query ../Color ../styles/basic".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a,e,d,h,y,I,H,u,G,v,t,F,B,O,M,C,W,Y,R,S,T,Z,qa,ta,Ba,Oa,Ia,Ra,Va){function ab(Q,ba){Q&&ba&&(Q._layer=ba,Q._sourceLayer=ba)}J=J([y,I,H,E],{declaredClass:"esri.dijit.Search",templateString:h,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,constructor:function(Q,ba){this.css={searchGroup:"searchGroup",searchInput:"searchInput",searchInputGroup:"searchInputGroup",searchBtn:"searchBtn",searchSubmit:"searchSubmit",searchIcon:"searchIcon esri-icon-search",searchButtonText:"searchButtonText",
searchToggle:"searchToggle",searchToggleIcon:"searchIcon esri-icon-down-arrow",searchMenu:"searchMenu",searchMenuHeader:"menuHeader",searchClear:"searchClear",searchClearIcon:"searchIcon esri-icon-close searchClose",searchSpinner:"searchIcon esri-icon-loading-indicator searchSpinner",searchSourceName:"sourceName",suggestionsMenu:"suggestionsMenu",sourcesMenu:"sourcesMenu",activeSource:"active",hasValue:"hasValue",hasButtonMode:"hasButtonMode",hasMultipleSources:"hasMultipleSources",showSuggestions:"showSuggestions",
showSources:"showSources",showNoResults:"showNoResults",searchLoading:"searchLoading",latLonHeader:"searchLatLongHeader",searchMoreResults:"moreResults",searchMoreResultsList:"resultsList",searchMoreResultsHeader:"moreHeader",searchMoreResultsItem:"moreItem",searchMoreResultsListHeader:"popupHeader",searchShowMoreResults:"showMoreResults",searchNoResultsMenu:"noResultsMenu",searchNoResultsBody:"noResultsBody",searchNoResultsHeader:"noResultsHeader",searchNoValueIcon:"noValueIcon esri-icon-notice-triangle",
searchNoValueText:"noValueText",searchNoResultsText:"noResultsText",searchExpandContainer:"searchExpandContainer",searchAnimateContainer:"searchAnimate",searchExpanded:"searchExpanded",searchCollapsed:"searchCollapsed",searchClearFloat:"searchClearFloat"};this._allIndex="all";this._objectIdIdentifier="_objectId";this._deferreds=[];this._sourceNames=[];this.defaultSource={locator:new Oa("//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),singleLineFieldName:"SingleLine",outFields:["Addr_type",
"Match_addr","StAddr","City"],name:d.widgets.Search.main.esriLocatorName,localSearchOptions:{minScale:3E5,distance:5E4},placeholder:d.widgets.Search.main.placeholder,highlightSymbol:(new C(L.toUrl("./Search/images/search-pointer.png"),36,36)).setOffset(9,18)};this.options={map:null,theme:"arcgisSearch",visible:!0,value:"",allPlaceholder:"",sources:[this.defaultSource],activeSourceIndex:0,suggestionDelay:350,enableSourcesMenu:!0,enableSuggestionsMenu:!0,enableInfoWindow:!0,showInfoWindowOnSelect:!0,
enableSuggestions:!0,enableButtonMode:!1,autoNavigate:!0,autoSelect:!0,addLayersFromMap:!1,zoomScale:1E3,graphicsLayer:null,enableHighlight:!0,highlightGraphic:null,enableLabel:!1,labelSymbol:(new S).setColor(new Ra([181,56,46,.9])).setFont(new T("14px",T.STYLE_NORMAL,T.VARIANT_NORMAL,T.WEIGHT_BOLD,"Arial")),labelGraphic:null,infoTemplate:new t(d.widgets.Search.main.searchResult,'\x3cdiv class\x3d"${searchTheme}"\x3e\x3cdiv id\x3d"${searchMoreResultsId}" class\x3d"${searchMoreResults}"\x3e\x3cdiv class\x3d"${searchMoreResultsItem}"\x3e${searchResult}\x3c/div\x3e\x3cdiv\x3e${searchMoreResultsHtml}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'),
searchResults:null,suggestResults:null,selectedResult:null,magicKey:null,selectedFeatureId:null,expanded:!1,maxLength:128,maxResults:6,maxSuggestions:6,locationToAddressDistance:1500,minCharacters:3,enableSearchingAll:!0};Q=q.mixin({},this.options,Q);this.set(Q);this._updateActiveSource();this._i18n=d;this._defaultSR=new B(4326);this.domNode=ba},startup:function(){this.inherited(arguments);this.sources||(this.sources=[]);this._mapLoaded().then(q.hitch(this,this._init))},postCreate:function(){var Q=
this;this.inherited(arguments);this._moreResultsId=this.id+"_more_results";this.own(A(this.submitNode,u,q.hitch(this,this._searchButton)));this.own(A(this.sourcesBtnNode,u,q.hitch(this,this._toggleSourcesMenu)));this.own(A(this.inputNode,u,q.hitch(this,this._inputClick)));this.own(A(this.clearNode,u,q.hitch(this,this._clearButton)));this.own(A(this.formNode,"submit",q.hitch(this,function(ba){ba.preventDefault();this._cancelSuggest();this.search()})));this.own(A(this.inputNode,"keyup",q.hitch(this,
function(ba){this._inputKey(ba)})));this.own(A(this.sourcesBtnNode,"keyup",q.hitch(this,function(ba){this._sourceBtnKey(ba)})));this.own(A(this.suggestionsNode,"li:click, li:keyup",function(ba){Q._suggestionsEvent(ba,this)}));this.own(A(this.sourcesNode,"li:click, li:keyup",function(ba){Q._sourcesEvent(ba,this)}));this.own(A(this.inputNode,"input, paste",q.hitch(this,function(){this._suggestDelay()})));this.map&&this.map.infoWindow&&this.map.infoWindow.domNode&&this.enableInfoWindow&&(this.own(A(this.map.infoWindow.domNode,
"#"+this._moreResultsId+"_show:click",q.hitch(this,function(ba){this._showMoreResultsClick(ba)}))),this.own(A(this.map.infoWindow.domNode,"#"+this._moreResultsId+"_list li a:click",q.hitch(this,function(ba){this._moreResultsClick(ba)}))),this.own(A(this.map.infoWindow.domNode,"#"+this._moreResultsId+" [data-switch-coordinates]:click",q.hitch(this,function(ba){this._switchCoordinatesClick(ba)}))));this.value&&this._checkStatus();this._hideMenus();this._updateVisible();this._insertSources(this.sources);
this._setPlaceholder(this.activeSourceIndex);this._updateButtonMode(this.enableButtonMode);this.toggle(this.expanded)},destroy:function(){this.clear();a.empty(this.domNode);this.inherited(arguments)},clear:function(){this.clearGraphics();f.get(this.inputNode,"value")&&f.set(this.inputNode,"value","");this._changeAttrValue("value","");this.set("searchResults",null);this.set("suggestResults",null);this.set("selectedResult",null);this.set("magicKey",null);this.set("selectedFeatureId",null);b.remove(this.containerNode,
this.css.hasValue);f.set(this.clearNode,"title","");this._hideMenus();this._closePopup();this._hideLoading();this.emit("clear-search")},show:function(){c.set(this.domNode,"display","block")},hide:function(){c.set(this.domNode,"display","none")},expand:function(){this.enableButtonMode&&(b.add(this.containerNode,this.css.searchExpanded),b.remove(this.containerNode,this.css.searchCollapsed),this._hideMenus(),this.set("expanded",!0))},collapse:function(){this.enableButtonMode&&(b.remove(this.containerNode,
this.css.searchExpanded),b.add(this.containerNode,this.css.searchCollapsed),this._hideMenus(),this.set("expanded",!1))},toggle:function(Q){this.enableButtonMode&&("undefined"===typeof Q&&(Q=!this.expanded),Q?this.expand():this.collapse())},search:function(Q){var ba=new w;this._mapLoaded().then(q.hitch(this,function(){this._searchDeferred(Q).then(q.hitch(this,function(ia){var ha=ia.results;this.set("searchResults",ha);0===ia.numResults&&(this._noResults(ia.value),this._showNoResultsMenu());this._hideLoading();
this.emit("search-results",ia);this._selectFirstResult(ha,ia.activeSourceIndex);ba.resolve(ha)}),q.hitch(this,function(ia){ba.reject(ia)}))}));return ba.promise},suggest:function(Q){var ba=new w;this._mapLoaded().then(q.hitch(this,function(){this._suggestDeferred(Q).then(q.hitch(this,function(ia){if(ia){var ha=ia.results;this.set("suggestResults",ha);this._insertSuggestions(ha,ia.value);this.emit("suggest-results",ia);ba.resolve(ha)}}),q.hitch(this,function(ia){ba.reject(ia)}))}));return ba.promise},
select:function(Q){var ba=this._getDefaultSymbol(Q),ia=this.labelSymbol,ha=this.sources,ua=this.activeSourceIndex,Ga=this.enableHighlight,ea=this.enableLabel,va=this.autoNavigate,xa=this.showInfoWindowOnSelect,Da=this.enableInfoWindow,ya=this.infoTemplate,Ja=Q.feature?new O(Q.feature.toJson()):null,Qa=Ja?Q.feature._sourceLayer:null;ab(Ja,Qa);if(ua===this._allIndex){var Ma=this._getSourceIndexOfResult(Q);if(null!==Ma){var Na=ha[Ma];ua=Ma}}else Na=ha[ua];Na&&(Na.hasOwnProperty("highlightSymbol")&&(ba=
Na.highlightSymbol),Na.hasOwnProperty("labelSymbol")&&(ia=Na.labelSymbol),Na.hasOwnProperty("enableHighlight")&&(Ga=Na.enableHighlight),Na.hasOwnProperty("enableLabel")&&(ea=Na.enableLabel),Na.hasOwnProperty("autoNavigate")&&(va=Na.autoNavigate),Na.hasOwnProperty("showInfoWindowOnSelect")&&(xa=Na.showInfoWindowOnSelect),Na.hasOwnProperty("enableInfoWindow")&&(Da=Na.enableInfoWindow),Na.hasOwnProperty("infoTemplate")?ya=Na.infoTemplate:Na.featureLayer&&Na.featureLayer.infoTemplate&&(ya=Na.featureLayer.infoTemplate));
this._hideMenus();this._hideLoading();if(Ja){ha=this.highlightGraphic;var Xa=this.graphicsLayer;Ma=this.labelGraphic;var bb=q.mixin({},Ja.attributes,{searchTheme:this.theme,searchResult:this._searchResultHTML(Q),searchMoreResults:this.css.searchMoreResults,searchMoreResultsItem:this.css.searchMoreResultsItem,searchMoreResultsId:this._moreResultsId,searchMoreResultsHtml:this._moreResultsHTML(Q)}),fb=null;Da&&(fb=ya);Ma?(Ma.setGeometry(Ja.geometry),Ma.setAttributes(bb),Ma.setSymbol(ia),ia&&"textsymbol"===
ia.type&&Ma.symbol.setText(Q.name)):(Ma=new O(Ja.geometry,ia,bb),ab(Ma,Qa),ia&&"textsymbol"===ia.type&&Ma.symbol.setText(Q.name),ea&&(Xa?Xa.add(Ma):this.map&&this.map.graphics&&this.map.graphics.add(Ma)));ha?(ha.setGeometry(Ja.geometry),ha.setAttributes(bb),ha.setInfoTemplate(fb),ha.setSymbol(ba)):(ha=new O(Ja.geometry,ba,bb,fb),ab(ha,Qa),Ga&&(Xa?Xa.add(ha):this.map&&this.map.graphics&&this.map.graphics.add(ha)));ha&&ha.symbol&&"textsymbol"===ha.symbol.type&&ha.symbol.setText(Q.name);this.map&&this.map.infoWindow&&
Da&&xa&&(this.map.infoWindow.setFeatures([ha]),ba=this._getPointFromGeometry(ha.geometry),this.map.infoWindow.show(ba));this.map&&va&&Q&&Q.hasOwnProperty("extent")&&"function"===typeof this.map.setExtent&&this.map.setExtent(Q.extent,!0);this.set("highlightGraphic",ha);this.set("labelGraphic",Ma)}this.set("selectedResult",Q);this.emit("select-result",{result:Q,source:Na,sourceIndex:ua})},focus:function(){G.focus(this.inputNode)},blur:function(){this.inputNode.blur();G.curNode&&G.curNode.blur()},clearGraphics:function(){var Q=
this.highlightGraphic,ba=this.graphicsLayer,ia=this.labelGraphic;Q&&(ba?ba.remove(Q):this.map&&this.map.graphics&&this.map.graphics.remove(Q));ia&&(ba?ba.remove(ia):this.map&&this.map.graphics&&this.map.graphics.remove(ia));this.set("labelGraphic",null);this.set("highlightGraphic",null)},_mapLoaded:function(){var Q=new w;if(this.map)if(this.map.loaded)Q.resolve();else A.once(this.map,"load",q.hitch(this,function(){Q.resolve()}));else Q.resolve();return Q.promise},_init:function(){this._getMapLayers().then(q.hitch(this,
function(){this.set("loaded",!0);this.emit("load")}))},_clearButton:function(){this.clear();G.focus(this.inputNode)},_error:function(Q){return Error(this.declaredClass+" "+Q)},_searchDeferred:function(Q){var ba=new w,ia=this.value,ha=this.activeSourceIndex;Q&&Q.hasOwnProperty("index")&&(ha=Q.index);this._showLoading();this._hideMenus();this._closePopup();this.clearGraphics();var ua={magicKey:this.magicKey,text:ia};Q?"string"===typeof Q?(ua.text=Q,Q=this._searchQueries(ua)):Q="object"===typeof Q&&
Q.hasOwnProperty("magicKey")?this._searchQueries(Q):"object"===typeof Q&&Q.hasOwnProperty("geometry")?this._searchQueries({geometry:Q}):"object"===typeof Q&&Q.hasOwnProperty(this._objectIdIdentifier)?this._searchQueries(Q):"object"===typeof Q&&"point"===Q.type?this._searchQueries({point:Q}):Q instanceof Array&&2===Q.length?this._searchQueries({latlon:Q}):this._searchQueries(ua):Q=this._searchQueries(ua);Q.always(q.hitch(this,function(Ga){Ga=this._formatResults(Ga,ha,ia);ba.resolve(Ga)}));return ba.promise},
_suggestDeferred:function(Q){var ba=new w;this._deferreds.push(ba);Q||(Q=this.value);var ia=this.activeSourceIndex;this._suggestQueries({text:Q}).always(q.hitch(this,function(ha){var ua;if(ha)for(var Ga=0;Ga<ha.length;Ga++)ha[Ga]&&(ua=!0);ua?(ha=this._formatResults(ha,ia,Q),ba.resolve(ha)):ba.resolve()}));return ba.promise},_getDefaultSymbol:function(Q){var ba;this.map&&(ba=this.map.getBasemap());ba||(ba="topo");if(Q&&Q.feature&&Q.feature.geometry)var ia=Q.feature.geometry.type;"polyline"===ia?ia=
"line":"circle"===ia||"extent"===ia?ia="polygon":"multipoint"===ia&&(ia="point");if(ia){if(Q=Va.getSchemes({theme:"default",basemap:ba,geometryType:ia}))var ha=Q.primaryScheme;if(ha){ha.color&&ha.hasOwnProperty("opacity")&&(ha.color.a=ha.opacity);var ua=ha;Q=ha.color;ha=ha.size;switch(ia){case "point":var Ga=new W;Ga.setColor(Q);Ga.setSize(null!==ha?ha:ua.size);ia=new Y;ia.setColor(ua.outline.color);ia.setWidth(ua.outline.width);Ga.setOutline(ia);break;case "line":Ga=new Y;Ga.setColor(Q);Ga.setWidth(null!==
ha?ha:ua.width);break;case "polygon":Ga=new R,Ga.setColor(Q),ia=new Y,ia.setColor(ua.outline.color),ia.setWidth(ua.outline.width),Ga.setOutline(ia)}ua=Ga}}return ua},_selectFirstResult:function(Q,ba){if(this.autoSelect&&Q){var ia;ba===this._allIndex?ia=this._getFirstResult(Q):Q[ba]&&Q[ba][0]&&(ia=Q[ba][0]);ia&&this.select(ia)}},_getSourceIndexOfResult:function(Q){var ba=this.searchResults;if(ba)for(var ia in ba)if(ba[ia]&&ba[ia].length)for(var ha=0;ha<ba[ia].length;ha++)if(ba[ia][ha]===Q)return parseInt(ia,
10);return null},_getFirstResult:function(Q){if(Q)for(var ba in Q)if(Q[ba]&&Q[ba][0])return Q[ba][0];return!1},_onFocus:function(){this.map&&"function"===typeof this.map.disableKeyboardNavigation&&this.map.disableKeyboardNavigation();this.emit("focus");this.inherited(arguments)},_onBlur:function(){this._hideMenus();this.map&&"function"===typeof this.map.enableKeyboardNavigation&&this.map.enableKeyboardNavigation();this.enableButtonMode&&this.loaded&&this.collapse();this.emit("blur");this.inherited(arguments)},
_getMapLayers:function(){var Q=new w;if(this.addLayersFromMap&&this.map){var ba=[],ia=this.map.graphicsLayerIds;if(ia&&ia.length){for(var ha=0;ha<ia.length;ha++){var ua=this.map.getLayer(ia[ha]);ua&&ba.push(this._featureLayerLoaded(ua))}M(ba).always(q.hitch(this,function(Ga){for(var ea,va=this.sources,xa=0;xa<Ga.length;xa++)Ga[xa]&&Ga[xa].loaded&&"Feature Layer"===Ga[xa].type&&(va.push({featureLayer:Ga[xa],enableSuggestions:!0}),ea=!0);ea&&this.set("sources",va);Q.resolve()}))}else Q.resolve()}else Q.resolve();
return Q.promise},_switchCoordinatesClick:function(Q){Q.preventDefault();if(Q=f.get(Q.target,"data-switch-coordinates"))this._cancelSuggest(),this.set("value",Q),this.search()},_moreResultsClick:function(Q){Q.preventDefault();var ba=Q.target;Q=parseInt(f.get(ba,"data-source-index"),10);ba=parseInt(f.get(ba,"data-index"),10);var ia=this.searchResults;ia&&ia[Q]&&(Q=ia[Q][ba])&&this.select(Q)},_showMoreResultsClick:function(Q){Q.preventDefault();if(Q=l.byId(this._moreResultsId)){b.toggle(Q,this.css.searchShowMoreResults);
var ba=l.byId(this._moreResultsId+"_show");ba&&(b.contains(Q,this.css.searchShowMoreResults)?f.set(ba,"textContent",d.widgets.Search.main.hideMoreResults):f.set(ba,"textContent",d.widgets.Search.main.showMoreResults))}},_featureLayerLoaded:function(Q){var ba=new w;if(Q.loaded)ba.resolve(Q);else if(Q.loadError)ba.reject(this._error("Layer failed to load."));else{var ia=A.once(Q,"load",q.hitch(this,function(){ha.remove();ba.resolve(Q)}));var ha=A.once(Q,"error",q.hitch(this,function(){ia.remove();ba.reject(this._error("Layer could not be loaded."))}))}return ba.promise},
_getObjectSize:function(Q){var ba=0,ia;for(ia in Q)Q.hasOwnProperty(ia)&&ba++;return ba},_sourcesEvent:function(Q,ba){var ia=f.get(ba,"data-index"),ha=n("li",this.sourcesNode);ba=K.indexOf(ha,ba);ia!==this._allIndex&&(ia=parseInt(ia,10));"click"===Q.type||Q.keyCode===x.ENTER?(this.set("activeSourceIndex",ia),G.focus(this.inputNode),this._hideSourcesMenu()):Q.keyCode===x.UP_ARROW?(Q.stopPropagation(),Q.preventDefault(),Q=ba-1,0>Q?G.focus(this.sourcesBtnNode):G.focus(ha[Q])):Q.keyCode===x.DOWN_ARROW?
(Q.stopPropagation(),Q.preventDefault(),Q=ba+1,Q>=ha.length?G.focus(this.sourcesBtnNode):G.focus(ha[Q])):Q.keyCode===x.ESCAPE&&(this._hideSourcesMenu(),G.focus(this.inputNode))},_suggestionsEvent:function(Q,ba){var ia=f.get(ba,"data-source-index"),ha=parseInt(f.get(ba,"data-index"),10),ua=n("li",this.suggestionsNode),Ga=this.sources;ba=K.indexOf(ua,ba);ia!==this._allIndex&&(ia=parseInt(ia,10));var ea;this._clearQueryTimeout();"click"===Q.type||Q.keyCode===x.ENTER?((ua=this.suggestResults)&&ua[ia]&&
ua[ia][ha]&&(ea=ua[ia][ha]),ea&&(ea.index=ia,Ga[ia].featureLayer?(ia=Ga[ia].featureLayer.objectIdField,ea[this._objectIdIdentifier]=ea.feature.attributes[ia],this.set("value",this._getSuggestionName(ea)),this.set("selectedFeatureId",ea.feature.attributes[ia])):ea.magicKey&&ea.text&&(this.set("value",ea.text),this.set("magicKey",ea.magicKey)),this.search(ea),G.focus(this.inputNode))):Q.keyCode===x.BACKSPACE||Q.keyCode===x.DELETE?G.focus(this.inputNode):Q.keyCode===x.UP_ARROW?(Q.stopPropagation(),Q.preventDefault(),
ea=ba-1,0>ea?G.focus(this.inputNode):G.focus(ua[ea])):Q.keyCode===x.DOWN_ARROW?(Q.stopPropagation(),Q.preventDefault(),ea=ba+1,ea>=ua.length?G.focus(this.inputNode):G.focus(ua[ea])):Q.keyCode===x.ESCAPE&&(this._hideMenus(),G.focus(this.inputNode))},_getResultName:function(Q){var ba;Q.hasOwnProperty("name")&&null!==Q.name&&(ba=Q.name.toString());ba||(ba=d.widgets.Search.main.untitledResult);return ba},_getSuggestionName:function(Q){var ba;Q.hasOwnProperty("name")&&null!==Q.name&&(ba=Q.name.toString());
Q=Q.text||ba;Q||(Q=d.widgets.Search.main.untitledResult);return Q},_searchResultHTML:function(Q){var ba="";if(Q.feature&&Q.feature.attributes&&Q.feature.attributes.Addr_type&&"LatLong"===Q.feature.attributes.Addr_type){var ia=Q.name.split(" ");if(2===ia.length){var ha=ia[0];var ua=ia[1]}ua&&ha?(Q=parseFloat(ha),ua=parseFloat(ua),ia=ua+", "+Q,ba+='\x3cdiv class\x3d"'+this.css.searchMoreResultsItem+'"\x3e',ba+='\x3cdiv class\x3d"'+this.css.latLonHeader+'"\x3e'+d.widgets.Search.main.lonlat+"\x3c/div\x3e",
ba=ba+(Q+", "+ua)+'\x3c/div\x3e\x3cdiv class\x3d"'+(this.css.searchMoreResultsItem+'"\x3e'),Q===ua||90<Q||-90>Q||180<ua||-180>ua||(ba+='\x3cdiv class\x3d"'+this.css.latLonHeader+'"\x3e'+d.widgets.Search.main.reverseLonLatHeader+"\x3c/div\x3e",ba+='\x3ca data-switch-coordinates\x3d"'+ia+'" tabindex\x3d"0" href\x3d"#"\x3e'+ia+"\x3c/a\x3e\x3c/div\x3e")):ba=Q.name}else ba=Q.name;return ba},_moreResultsHTML:function(Q){var ba="",ia="",ha=this.searchResults,ua=this.sources,Ga=0;if(ha){ia+='\x3cdiv class\x3d"'+
this.css.searchMoreResultsItem+'"\x3e';ia+='\x3ca href\x3d"#" id\x3d"'+this._moreResultsId+'_show"\x3e'+d.widgets.Search.main.showMoreResults+"\x3c/a\x3e";ia=ia+'\x3c/div\x3e\x3cdiv class\x3d"'+(this.css.searchMoreResultsList+'"\x3e');ia+='\x3cdiv id\x3d"'+this._moreResultsId+'_list"\x3e';for(var ea in ha)if(ha[ea]){var va=ha[ea].length;if(va){var xa=1===va&&ha[ea][0]===Q;if(1<this._getObjectSize(ha)&&!xa){var Da=this._getSourceName(ea);ia+='\x3cdiv class\x3d"'+this.css.searchMoreResultsListHeader+
'"\x3e'+Da+"\x3c/div\x3e"}if(va&&!xa){ia+="\x3cul\x3e";Da=ua[ea].maxResults||this.maxResults;for(xa=0;xa<va&&xa<Da;++xa)if(ha[ea][xa]!==Q){var ya=this._getResultName(ha[ea][xa]);ia+='\x3cli\x3e\x3ca tabindex\x3d"0" data-index\x3d"'+xa+'" data-source-index\x3d"'+ea+'" href\x3d"#"\x3e'+ya+"\x3c/a\x3e\x3c/li\x3e";Ga++}ia+="\x3c/ul\x3e"}}}ia+="\x3c/div\x3e\x3c/div\x3e"}Ga&&(ba+=ia);return ba},_validField:function(Q,ba){return Q.getField(ba)},_validFields:function(Q,ba){if(Q&&ba&&ba.length){for(var ia=
0;ia<ba.length;ia++)if(!this._validField(Q,ba[ia]))return!1;return!0}return!1},_getCodedName:function(Q,ba){if(Q&&Q.length)for(var ia=0,ha=Q.length;ia<ha;ia++){var ua=Q[ia];if(ua.code===ba)return ua.name}},_getCodedValue:function(Q,ba,ia){if(Q&&Q.length)for(var ha=0,ua=Q.length;ha<ua;ha++){var Ga=Q[ha],ea=Ga.name,va=ba;ia||(ea=ea.toLowerCase(),va=va.toLowerCase());if(ea===va)return Ga.code}return!1},_whereClause:function(Q,ba,ia,ha,ua){var Ga=null;if(Q){var ea="",va=this.reHostedFS.test(ba.url);va&&
this._containsNonLatinCharacter(Q)&&(ea="N");if(ia&&ia.length)for(var xa=0,Da=ia.length;xa<Da;xa++){var ya="";ya=Q.replace(/'/g,"''");var Ja=ia[xa],Qa=ba.getField(Ja),Ma=ba.getDomain(Ja);Ma&&"codedValue"===Ma.type&&(ya=this._getCodedValue(Ma.codedValues,ya,ha));!1!==ya&&(Qa=Qa.type,"esriFieldTypeString"===Qa||"esriFieldTypeDate"===Qa?ha&&"search"===ua?ya=Ja+" \x3d "+ea+"'"+ya+"'":(Ja=va?Ja:"UPPER("+Ja+")",ya=va?ya:ya.toUpperCase(),ya=Ja+" LIKE "+ea+"'"+(ha?ya+"%":"%"+ya+"%")+"'"):"esriFieldTypeOID"===
Qa||"esriFieldTypeSmallInteger"===Qa||"esriFieldTypeInteger"===Qa||"esriFieldTypeSingle"===Qa||"esriFieldTypeDouble"===Qa?(ya=parseFloat(ya),ya=isNaN(ya)?!1:Ja+" \x3d "+ya):ya=Ja+" \x3d "+ya,ya&&(Ga=Ga?Ga+" or ":"",Ga+=ya))}}return Ga},_suggest:function(Q){Q||(Q={index:this.activeSourceIndex,text:this.value});var ba=new w,ia=Q.index,ha=this.sources[ia],ua=this.enableSuggestions;ha.hasOwnProperty("enableSuggestions")&&(ua=ha.enableSuggestions);var Ga=0;if(Q.hasOwnProperty("text")&&Q.text){var ea=q.trim(Q.text);
Ga=Q.text.length}Q=ha.minCharacters||this.minCharacters;if(ua&&ea&&Ga>=Q&&this._supportsPagination(ha)){var va="";ha.prefix&&(va+=ha.prefix);va+=ea;ha.suffix&&(va+=ha.suffix);var xa=this._defaultSR;this.map&&(xa=this.map.spatialReference);ua={};ha.locator?(ha.categories&&(ua.categories=ha.categories),ha.locator.outSpatialReference=xa,this.map&&ha.localSearchOptions&&ha.localSearchOptions.hasOwnProperty("distance")&&ha.localSearchOptions.hasOwnProperty("minScale")&&(Ga=this._getScale(),!ha.localSearchOptions.minScale||
Ga&&Ga<=parseFloat(ha.localSearchOptions.minScale))&&(ua.location=this.map.extent.getCenter(),ua.distance=ha.localSearchOptions.distance),ua.text=va,ha.useMapExtent&&this.map&&this.map.extent&&(ua.searchExtent=this.map.extent),ha.searchExtent&&(ua.searchExtent=ha.searchExtent),ua.maxSuggestions=ha.maxSuggestions||this.maxSuggestions,ha.sourceCountry&&(ua.countryCode=ha.sourceCountry),ha.countryCode&&(ua.countryCode=ha.countryCode),ha.locator.suggestLocations(ua).then(q.hitch(this,function(Da){ba.resolve(Da)}),
q.hitch(this,function(Da){Da||(Da=this._error("Locator suggestLocations could not be performed."));ba.reject(Da)}))):ha.featureLayer?this._featureLayerLoaded(ha.featureLayer).then(q.hitch(this,function(){var Da=this._getDisplayField(ha),ya=ha.searchFields||[Da],Ja=[];ha.suggestionTemplate?ha.suggestionTemplate.replace(/(?:\$\{([^}]+)\})/g,function(Xa,bb){Ja.push(bb)}):Ja=[Da];-1===K.indexOf(Ja,ha.featureLayer.objectIdField)&&Ja.push(ha.featureLayer.objectIdField);Da=this._validField(ha.featureLayer,
Da);var Qa=this._validFields(ha.featureLayer,Ja),Ma=this._validFields(ha.featureLayer,ya);if(Da&&Qa&&Ma){Da=new Ia;ha.hasOwnProperty("suggestQueryParams")&&q.mixin(Da,ha.suggestQueryParams);Da.outSpatialReference=xa;Da.returnGeometry=!1;Da.num=ha.maxSuggestions||this.maxSuggestions;Da.outFields=Ja;ha.useMapExtent&&this.map&&this.map.extent&&(Da.geometry=this.map.extent);ha.searchExtent&&(Da.geometry=ha.searchExtent);if(ya=this._whereClause(va,ha.featureLayer,ya,ha.exactMatch,"suggest")){Da.where=
ya;var Na=!0}Na?ha.featureLayer.queryFeatures(Da,q.hitch(this,function(Xa){var bb;(Xa=Xa.features)&&(bb=this._hydrateResults(Xa,ia,!0));ba.resolve(bb)}),q.hitch(this,function(Xa){Xa||(Xa=this._error("FeatureLayer queryFeatures errored with suggestions"));ba.reject(Xa)})):ba.resolve()}else ba.reject(this._error("Invalid FeatureLayer field"))})):ba.reject(this._error("Invalid source"))}else ba.resolve();return ba.promise},_supportsPagination:function(Q){var ba;Q.locator?ba=!0:Q.featureLayer&&Q.featureLayer.advancedQueryCapabilities&&
Q.featureLayer.advancedQueryCapabilities.supportsPagination&&(ba=!0);return ba},_suggestQueries:function(Q){var ba=this.sources,ia=this.activeSourceIndex,ha=[];if(ia===this._allIndex)for(ia=0;ia<ba.length;ia++){var ua=Q;ua.index=ia;ua=this._suggest(ua);ha.push(ua)}else Q.index=ia,ua=this._suggest(Q),ha.push(ua);return M(ha)},_getPointFromGeometry:function(Q){switch(Q.type){case "extent":var ba=Q.getCenter();break;case "multipoint":ba=Q.getPoint(0);break;case "point":ba=Q;break;case "polygon":ba=Q.getCentroid();
break;case "polyline":ba=Q.getPoint(0,0)}return ba},_searchQueries:function(Q){Q.hasOwnProperty("index")||(Q.index=this.activeSourceIndex);var ba=[];if(Q.index===this._allIndex)for(var ia=this.sources,ha=0;ha<ia.length;ha++){var ua=Q;ua.index=ha;ua=this._search(ua);ba.push(ua)}else Q=this._search(Q),ba.push(Q);return M(ba)},_searchButton:function(){this.enableButtonMode&&!this.expanded?(this.expand(),G.focus(this.inputNode)):(this._cancelSuggest(),this.search())},_search:function(Q){Q||(Q={text:this.value,
magicKey:null,geometry:null,point:null,index:this.activeSourceIndex,latlon:null});this.selectedFeatureId&&(Q.text=null,Q[this._objectIdIdentifier]=this.selectedFeatureId);var ba,ia=new w,ha=Q.index,ua=this.sources[ha],Ga;Q.hasOwnProperty("text")&&Q.text&&(Ga=q.trim(Q.text));if(ua){var ea="";ua.prefix&&!Q.magicKey&&(ea+=ua.prefix);ea+=Ga;ua.suffix&&!Q.magicKey&&(ea+=ua.suffix);var va=this._defaultSR;this.map&&(va=this.map.spatialReference);if(ua.locator)if(Q.hasOwnProperty("text")&&Ga){var xa={};ua.categories&&
(xa.categories=ua.categories);ua.locationType&&(xa.locationType=ua.locationType);va&&(ua.locator.outSpatialReference=va);if(this.map&&ua.localSearchOptions&&ua.localSearchOptions.hasOwnProperty("distance")&&ua.localSearchOptions.hasOwnProperty("minScale")){var Da=this._getScale();if(!ua.localSearchOptions.minScale||Da&&Da<=parseFloat(ua.localSearchOptions.minScale))xa.location=this.map.extent.getCenter(),xa.distance=ua.localSearchOptions.distance}xa.address={};xa.maxLocations=ua.maxResults||this.maxResults;
ua.useMapExtent&&this.map&&this.map.extent&&(xa.searchExtent=this.map.extent);ua.searchExtent&&(xa.searchExtent=ua.searchExtent);ua.sourceCountry&&(xa.countryCode=ua.sourceCountry);ua.countryCode&&(xa.countryCode=ua.countryCode);Q.magicKey&&(xa.magicKey=Q.magicKey);ua.singleLineFieldName?xa.address[ua.singleLineFieldName]=ea:xa.address["Single Line Input"]=ea;ua.outFields&&(xa.outFields=ua.outFields);ua.locator.addressToLocations(xa).then(q.hitch(this,function(ya){ya=this._hydrateResults(ya,ha,!1);
ia.resolve(ya)}),q.hitch(this,function(ya){ya||(ya=this._error("Locator addressToLocations could not be performed"));ia.reject(ya)}))}else Q.geometry?(ba=this._getPointFromGeometry(Q.geometry.geometry))?this._reverseGeocodePoint(ha,ba).then(function(ya){ia.resolve(ya)},function(ya){ia.reject(ya)}):ia.reject(this._error("Invalid point to reverse geocode")):Q.point?this._reverseGeocodePoint(ha,Q.point).then(function(ya){ia.resolve(ya)},function(ya){ia.reject(ya)}):Q.latlon?(xa=new Z(Q.latlon,this._defaultSR),
this._reverseGeocodePoint(ha,xa).then(function(ya){ia.resolve(ya)},function(ya){ia.reject(ya)})):Q.hasOwnProperty("text")&&!Ga?ia.resolve([]):ia.reject(this._error("Invalid query type for Locator"));else ua.featureLayer?this._featureLayerLoaded(ua.featureLayer).then(q.hitch(this,function(){var ya=this._getDisplayField(ua),Ja=ua.searchFields||[ya];ya=this._validField(ua.featureLayer,ya);var Qa=this._validFields(ua.featureLayer,Ja);if(ya&&Qa){ya=new Ia;ua.hasOwnProperty("searchQueryParams")&&q.mixin(ya,
ua.searchQueryParams);va&&(ya.outSpatialReference=va,Qa=this.map&&this.map.getMaxResolution()||1/Ba.getUnitValueForSR(va))&&(ya.maxAllowableOffset=Qa);ya.returnGeometry=!0;ua.outFields&&(ya.outFields=ua.outFields);if(!Q.hasOwnProperty(this._objectIdIdentifier)){this._supportsPagination(ua)&&(ya.num=ua.maxResults||this.maxResults);ua.useMapExtent&&this.map&&this.map.extent&&(ya.geometry=this.map.extent);ua.searchExtent&&(ya.geometry=ua.searchExtent);var Ma=ua.exactMatch}Q.hasOwnProperty("text")&&Ga?
(Ja=this._whereClause(ea,ua.featureLayer,Ja,Ma,"search"))?(ya.where=Ja,Ja=!0):Ja=!1:Q.hasOwnProperty(this._objectIdIdentifier)?(ya.objectIds=[Q[this._objectIdIdentifier]],Ja=!0):Q.geometry?(ya.geometry=Q.geometry,Ja=!0):Q.point?(ya.geometry=Q.point,Ja=!0):Q.latlon?(ba=new Z(Q.latlon,this._defaultSR),ya.geometry=ba,Ja=!0):(Q.hasOwnProperty("text")&&!Ga?ia.resolve([]):ia.reject(this._error("Invalid query type for FeatureLayer")),Ja=!1);Ja?ua.featureLayer.queryFeatures(ya,q.hitch(this,function(Na){Na=
Na.features;var Xa;Na&&(Xa=this._hydrateResults(Na,ha,!1));ia.resolve(Xa)}),q.hitch(this,function(Na){Na||(Na=this._error("FeatureLayer queryFeatures could not be performed"));ia.reject(Na)})):ia.resolve()}else ia.reject(this._error("Invalid FeatureLayer field"))})):ia.reject(this._error("Invalid source"))}else ia.reject(this._error("Source is undefined"));return ia.promise},_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},_formatResults:function(Q,ba,ia){ia={activeSourceIndex:ba,
value:ia,numResults:0,numErrors:0,errors:null,results:null};var ha={},ua={};if(Q)if(ba===this._allIndex)for(ba=0;ba<Q.length;ba++)Q[ba]&&(Q[ba]instanceof Error?(ha[ba]=Q[ba],ia.numErrors++):(ua[ba]=Q[ba],ia.numResults+=Q[ba].length));else Q[0]&&(Q[0]instanceof Error?(ha[ba]=Q[0],ia.numErrors++):(ua[ba]=Q[0],ia.numResults+=Q[0].length));ia.numErrors&&(ia.errors=ha);ia.numResults&&(ia.results=ua);return ia},_reverseGeocodePoint:function(Q,ba){var ia=new w,ha=this.sources[Q];if(ba&&ha){var ua=ha.locationToAddressDistance||
this.locationToAddressDistance;ha.locator.outSpatialReference=this._defaultSR;this.map&&(ha.locator.outSpatialReference=this.map.spatialReference);ha.locator.locationToAddress(ba,ua,q.hitch(this,function(Ga){Ga=this._hydrateResults([Ga],Q,!1);ia.resolve(Ga)}),q.hitch(this,function(Ga){Ga||(Ga=this._error("Locator locationToAddress could not be performed"));ia.reject(Ga)}))}else ia.reject(this._error("No point or source defined for reverse geocoding"));return ia.promise},_cancelDeferreds:function(){if(this._deferreds&&
this._deferreds.length)for(var Q=0;Q<this._deferreds.length;Q++)this._deferreds[Q].cancel(this.declaredClass+" cancelling request");this._deferreds=[]},_sourceBtnKey:function(Q){if(Q){var ba=n("li",this.sourcesNode);Q.keyCode===x.UP_ARROW?(Q.stopPropagation(),Q.preventDefault(),this._showSourcesMenu(),(Q=ba.length)&&G.focus(ba[Q-1])):Q.keyCode===x.DOWN_ARROW&&(Q.stopPropagation(),Q.preventDefault(),this._showSourcesMenu(),ba[0]&&G.focus(ba[0]))}},_inputKey:function(Q){if(Q){var ba=n("li",this.suggestionsNode),
ia=this.suggestResults;if(Q.keyCode===x.TAB||Q.keyCode===x.ESCAPE)this._cancelSuggest(),this._hideMenus();else if(Q.keyCode===x.UP_ARROW)Q.stopPropagation(),Q.preventDefault(),this._cancelSuggest(),ia&&this._showSuggestionsMenu(),(Q=ba.length)&&G.focus(ba[Q-1]);else if(Q.keyCode===x.DOWN_ARROW)Q.stopPropagation(),Q.preventDefault(),this._cancelSuggest(),ia&&this._showSuggestionsMenu(),ba[0]&&G.focus(ba[0]);else{if(Q.ctrlKey||Q.metaKey||Q.keyCode===x.copyKey||Q.keyCode===x.LEFT_ARROW||Q.keyCode===
x.RIGHT_ARROW||Q.keyCode===x.ENTER)return Q;this._suggestDelay()}}},_cancelSuggest:function(){this._cancelDeferreds();this._clearQueryTimeout()},_suggestDelay:function(){this._cancelSuggest();this._changeValue();this._queryTimer=setTimeout(q.hitch(this,function(){this.suggest()}),this.suggestionDelay)},_changeValue:function(){this.set("magicKey",null);this.set("selectedFeatureId",null);this._changeAttrValue("value",this.inputNode.value);this._checkStatus()},_inputClick:function(){this._hideSourcesMenu();
this._hideNoResultsMenu()},_getSourceName:function(Q){return this._sourceNames[Q]},_loadSources:function(Q){Q=K.filter(Q,function(ba){return!!ba.featureLayer});Q=K.map(Q,function(ba){return this._featureLayerLoaded(ba.featureLayer)},this);return M(Q)},_createSourceNameMap:function(Q){return this._loadSources(Q).then(q.hitch(this,function(){var ba=K.map(Q,function(ia){return ia.name||ia.featureLayer&&ia.featureLayer.name||d.widgets.Search.main.untitledSource});this._preventDuplicateSourceNames(Q,ba);
return ba}))},_getDuplicateSourceNameIndexes:function(Q){var ba={},ia=[];K.forEach(Q,function(ha,ua){ba.hasOwnProperty(ha)?(-1===ia.indexOf(ba[ha])&&ia.push(ba[ha]),ia.push(ua)):Q.lastIndexOf(ha)!==ua&&(ba[ha]=ua)});return ia},_preventDuplicateSourceNames:function(Q,ba){if(ba&&1<ba.length){var ia=this._getDuplicateSourceNameIndexes(ba);K.forEach(ia,function(ha){ba[ha]+=this._getFieldsString(Q[ha])},this)}},_getFieldsString:function(Q){var ba="",ia=Q.featureLayer;if(ia){Q=Q.searchFields||[this._getDisplayField(Q)];
for(var ha=0;ha<Q.length;ha++){ba=0===ha?ba+": ":ba+", ";var ua=Q[ha],Ga=ia.getFieldLabel(ua);ba+=Ga||ua}}return ba},_splitResult:function(Q,ba){ba=m.escapeString(ba);return Q.replace(new RegExp("(^|)("+ba+")(|$)","ig"),"$1|$2|$3").split("|")},_insertSuggestions:function(Q,ba){if(this.enableSuggestionsMenu&&this.suggestionsNode){this._hideSourcesMenu();this._hideNoResultsMenu();var ia=this.sources;if(Q){var ha=a.create("div");for(var ua in Q)if(Q[ua]&&Q[ua].length){var Ga=this._getSourceName(ua);
1<ia.length&&this.activeSourceIndex===this._allIndex&&a.create("div",{className:this.css.searchMenuHeader,textContent:Ga},ha);Ga=a.create("ul",{role:"menu"},ha);for(var ea=ia[ua].maxSuggestions||this.maxSuggestions,va=0;va<Q[ua].length&&va<ea;++va){var xa=a.create("li",{"data-index":va,"data-source-index":ua,role:"menuitem",tabindex:0},Ga),Da=this._getSuggestionName(Q[ua][va]);Da=this._splitResult(Da,ba);for(var ya=Da.length,Ja=0;Ja<ya;Ja++){var Qa=Da[Ja];Qa.toLowerCase()===ba.toLowerCase()?a.create("strong",
{textContent:Qa},xa):(Qa=document.createTextNode(Qa),a.place(Qa,xa))}}}}ha?(a.place(ha,this.suggestionsNode,"only"),this._showSuggestionsMenu()):(a.empty(this.suggestionsNode),this._hideSuggestionsMenu())}},_insertSources:function(Q){if(this.enableSourcesMenu&&Q&&1<Q.length){var ba,ia=this.activeSourceIndex,ha=a.create("ul",{role:"menu"});if(this.enableSearchingAll){var ua="";ia===this._allIndex&&(ua="active");a.create("li",{"data-index":this._allIndex,role:"menuitem",className:ua,tabIndex:0,textContent:d.widgets.Search.main.all},
ha)}for(ba=0;ba<Q.length;ba++){ua="";ba===ia&&(ua=this.css.activeSource);var Ga=this._getSourceName(ba);a.create("li",{"data-index":ba,role:"menuitem",className:ua,tabIndex:0,textContent:Ga},ha)}b.add(this.containerNode,this.css.hasMultipleSources);a.place(ha,this.sourcesNode,"only")}else b.remove(this.containerNode,this.css.hasMultipleSources),a.empty(this.sourcesNode)},_showLoading:function(){b.add(this.containerNode,this.css.searchLoading)},_hideLoading:function(){b.remove(this.containerNode,this.css.searchLoading)},
_checkStatus:function(){this.value?(b.add(this.containerNode,this.css.hasValue),f.set(this.clearNode,"title",d.widgets.Search.main.clearButtonTitle)):this.clear()},_closePopup:function(){this.enableInfoWindow&&this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_noResults:function(Q){var ba;Q&&(ba=q.trim(Q));var ia=a.create("div",{className:this.css.searchNoResultsBody});Q&&ba?(a.create("div",{className:this.css.searchNoResultsHeader,textContent:d.widgets.Search.main.noResults},ia),a.create("div",
{className:this.css.searchNoResultsText,textContent:v.substitute({value:'"'+Q+'"'},d.widgets.Search.main.noResultsFound)},ia)):(Q=a.create("div",{},ia),a.create("span",{"aria-hidden":"true",className:this.css.searchNoValueIcon},Q),a.create("span",{className:this.css.searchNoValueText,textContent:d.widgets.Search.main.emptyValue},Q));a.place(ia,this.noResultsMenuNode,"only")},_hideMenus:function(){this._hideSourcesMenu();this._hideSuggestionsMenu();this._hideNoResultsMenu()},_hideNoResultsMenu:function(){b.remove(this.containerNode,
this.css.showNoResults)},_showNoResultsMenu:function(){this._hideSourcesMenu();this._hideSuggestionsMenu();b.add(this.containerNode,this.css.showNoResults)},_hideSourcesMenu:function(){b.remove(this.containerNode,this.css.showSources)},_hideSuggestionsMenu:function(){b.remove(this.containerNode,this.css.showSuggestions)},_showSourcesMenu:function(){this._hideSuggestionsMenu();this._hideNoResultsMenu();b.add(this.containerNode,this.css.showSources)},_showSuggestionsMenu:function(){this._hideSourcesMenu();
this._hideNoResultsMenu();b.add(this.containerNode,this.css.showSuggestions)},_toggleSourcesMenu:function(){this._hideSuggestionsMenu();this._hideNoResultsMenu();b.toggle(this.containerNode,this.css.showSources)},_getFirstStringField:function(Q){if(Q&&(Q=Q.fields)&&Q.length)for(var ba=0;ba<Q.length;ba++){var ia=Q[ba];if("esriFieldTypeString"===ia.type)return ia.name}return""},_getDisplayField:function(Q){return Q.displayField||Q.featureLayer.displayField||this._getFirstStringField(Q.featureLayer)},
_validLocation:function(Q){return Q&&"number"===typeof Q.x&&"number"===typeof Q.y},_validExtent:function(Q){return Q&&"number"===typeof Q.xmin&&"number"===typeof Q.ymin&&"number"===typeof Q.xmax&&"number"===typeof Q.ymax},_hydrateResult:function(Q,ba,ia){var ha={},ua=this._defaultSR;ba=this.sources[ba];this.map&&(ua=this.map.spatialReference);if(Q.hasOwnProperty("text")&&Q.hasOwnProperty("magicKey"))return Q;if(Q.hasOwnProperty("geometry")){var Ga=new O(Q.toJson());ha.feature=Ga;(Ga=ha.feature.geometry)&&
Ga.setSpatialReference(ua)}else if(Q.hasOwnProperty("location")&&this._validLocation(Q.location)){var ea=new Z(Q.location.x,Q.location.y,ua);Ga={};Q.hasOwnProperty("attributes")&&(Ga=Q.attributes);Q.hasOwnProperty("address")&&"object"===typeof Q.address&&q.mixin(Ga,Q.address);Q.hasOwnProperty("score")&&(Ga.score=Q.score);ha.feature=new O(ea,null,Ga,null)}!ha.feature&&ia&&(Ga={},Q.hasOwnProperty("attributes")&&(Ga=Q.attributes),Q.hasOwnProperty("score")&&(Ga.score=Q.score),ha.feature=new O(null,null,
Ga,null));if(ha.feature){if(Q.hasOwnProperty("extent")&&this._validExtent(Q.extent))ha.extent=new qa(Q.extent),ha.extent.setSpatialReference(ua);else if(ha.feature&&ha.feature.geometry)switch(ha.feature.geometry.type){case "extent":ha.extent=ha.feature.geometry;break;case "multipoint":ha.extent=ta.getDenormalizedExtent(ha.feature.geometry);break;case "polygon":ha.extent=ta.getDenormalizedExtent(ha.feature.geometry);break;case "polyline":ha.extent=ta.getDenormalizedExtent(ha.feature.geometry);break;
case "point":this.map?(ua=this.zoomScale,ba&&ba.zoomScale&&(ua=ba.zoomScale),this._getScale()>ua?ha.extent=Ba.getExtentForScale(this.map,ua).centerAt(ha.feature.geometry):ha.extent=this.map.extent.centerAt(ha.feature.geometry)):ha.extent=new qa({xmin:ha.feature.geometry.x-.25,ymin:ha.feature.geometry.y-.25,xmax:ha.feature.geometry.x+.25,ymax:ha.feature.geometry.y+.25,spatialReference:this._defaultSR})}else ha.extent=null;ha.name="";ba.featureLayer?ba.suggestionTemplate&&ia?ha.name=v.substitute(Q.attributes,
ba.suggestionTemplate):ba.searchTemplate?ha.name=v.substitute(Q.attributes,ba.searchTemplate):(Ga=this._getDisplayField(ba),ia=ba.featureLayer.getField(Ga),ua=ba.featureLayer.getDomain(Ga),Ga&&Q.hasOwnProperty("attributes")&&Q.attributes.hasOwnProperty(Ga)&&(Q=Q.attributes[Ga],ua&&"codedValue"===ua.type?ha.name=this._getCodedName(ua.codedValues,Q):ia&&"esriFieldTypeDate"===ia.type&&!isNaN(Q)?ha.name=e.format(new Date(Q)):ha.name=Q)):Q.address&&ba.searchTemplate?ha.name=v.substitute(Q.address,ba.searchTemplate):
Q.hasOwnProperty("name")?ha.name=Q.name:Q.hasOwnProperty("attributes")&&"object"===typeof Q.attributes&&Q.attributes.LongLabel?ha.name=Q.attributes.LongLabel:Q.hasOwnProperty("attributes")&&"object"===typeof Q.attributes&&Q.attributes.Match_addr?(ha.name=Q.attributes.Match_addr,Q.attributes.Addr_type&&"POI"===Q.attributes.Addr_type&&Q.attributes.StAddr&&Q.attributes.City?ha.name+=" - "+Q.attributes.StAddr+", "+Q.attributes.City:Q.attributes.Addr_type&&"POI"===Q.attributes.Addr_type&&Q.attributes.City&&
(ha.name+=" - "+Q.attributes.City)):Q.hasOwnProperty("address")&&"string"===typeof Q.address?ha.name=Q.address:Q.hasOwnProperty("address")&&"object"===typeof Q.address&&Q.address.hasOwnProperty("Address")?Q.address.hasOwnProperty("Match_addr")?ha.name=Q.address.Match_addr:Q.address.hasOwnProperty("Address")&&(ha.name=Q.address.Address):ha.feature&&ha.feature.geometry&&(ha.name=ha.feature.geometry.x+","+ha.feature.geometry.y);ba.featureLayer&&ha.feature&&ab(ha.feature,ba.featureLayer);return ha}},
_getScale:function(){var Q;this.map&&"function"===typeof this.map.getScale&&(Q=this.map.getScale());return Q},_hydrateResults:function(Q,ba,ia,ha){ha=[];var ua=0;if(Q&&Q.length)for(ua;ua<Q.length;ua++){var Ga=this._hydrateResult(Q[ua],ba,ia);Ga&&ha.push(Ga)}return ha},_containsNonLatinCharacter:function(Q){for(var ba=0;ba<Q.length;ba++)if(255<Q.charCodeAt(ba))return!0;return!1},_setPlaceholder:function(Q){var ba="",ia=this.sources[Q];Q===this._allIndex?ba=this.allPlaceholder||d.widgets.Search.main.allPlaceholder:
ia&&ia.placeholder&&(ba=ia.placeholder);var ha=d.widgets.Search.main.all;ia&&(ha=this._getSourceName(Q));f.set(this.sourceNameNode,"textContent",ha);f.set(this.inputNode,"placeholder",ba);f.set(this.inputNode,"title",ba)},_updateActiveSource:function(){var Q=this.sources,ba=this.activeSourceIndex,ia;Q&&Q[ba]&&(ia=Q[ba]);ia?this.set("activeSource",ia):this.set("activeSource",null)},_updateVisible:function(){this.visible?this.show():this.hide()},_updateButtonMode:function(Q){Q?(b.toggle(this.containerNode,
this.css.searchExpanded,this.expanded),b.toggle(this.containerNode,this.css.searchCollapsed,!this.expanded),b.add(this.containerNode,this.css.hasButtonMode)):(b.remove(this.containerNode,this.css.searchExpanded),b.remove(this.containerNode,this.css.searchCollapsed),b.remove(this.containerNode,this.css.hasButtonMode))},_setDefaultActiveSourceIndex:function(Q){Q&&1===Q.length||!this.enableSearchingAll?this.set("activeSourceIndex",0):this.set("activeSourceIndex",this._allIndex)},_setEnableSourcesMenuAttr:function(Q){this._set("enableSourcesMenu",
Q);this._created&&this._insertSources(this.sources)},_setEnableSearchingAllAttr:function(Q){this._set("enableSearchingAll",Q);this._created&&(this._setDefaultActiveSourceIndex(this.sources),this._hideMenus(),this._insertSources(this.sources))},_setSourcesAttr:function(Q){this._createSourceNameMap(Q).then(q.hitch(this,function(ba){this._sourceNames=ba;this._created&&(this._setDefaultActiveSourceIndex(Q),this._hideMenus(),this._insertSources(Q))}));this._set("sources",Q)},_setAllPlaceholderAttr:function(Q){this._set("allPlaceholder",
Q);this._created&&this._setPlaceholder(this.activeSourceIndex)},_setActiveSourceIndexAttr:function(Q){this._set("activeSourceIndex",Q);this._updateActiveSource();this._created&&(this._setPlaceholder(Q),this._hideMenus(),this._insertSources(this.sources))},_setMaxLengthAttr:function(Q){this._set("maxLength",Q);this._created&&f.set(this.inputNode,"maxLength",Q)},_setValueAttr:function(Q){this.set("magicKey",null);this.set("selectedFeatureId",null);this._set("value",Q);this._created&&(f.set(this.inputNode,
"value",Q),this._checkStatus())},_setVisibleAttr:function(Q){this._set("visible",Q);this._created&&this._updateVisible()},_setEnableButtonModeAttr:function(Q){this._set("enableButtonMode",Q);this._created&&this._updateButtonMode(Q)},_setThemeAttr:function(Q){this._created&&(b.remove(this.domNode,this.theme),b.add(this.domNode,Q));this._set("theme",Q)}});g("extend-esri")&&q.setObject("dijit.Search",J,F);return J})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m){L=L(g,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(l){this._geocodeHandler=J.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=J.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=J.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},
outSpatialReference:null,setOutSpatialReference:function(l){this.outSpatialReference=l},_geocodeHandler:function(l,f,b,c,a){try{var e=l.candidates;f=[];var d,h=e.length,y=l.spatialReference,I;for(d=0;d<h;d++){var H=e[d];if(I=H.location)I.spatialReference=y;f[d]=new m(H)}this._successHandler([f],"onAddressToLocationsComplete",b,a)}catch(u){this._errorHandler(u,c,a)}},_geocodeAddressesHandler:function(l,f,b,c,a){try{var e=l.locations;f=[];var d,h=e.length,y=l.spatialReference,I;for(d=0;d<h;d++){if(I=
e[d].location)I.spatialReference=y;f[d]=new m(e[d])}this._successHandler([f],"onAddressesToLocationsComplete",b,a)}catch(H){this._errorHandler(H,c,a)}},addressToLocations:function(l,f,b,c,a){var e;if(l.address){c=b;b=f;f=l.outFields;a=l.searchExtent;var d=l.countryCode;var h=l.magicKey;var y=l.distance;var I=l.categories;l.location&&this.normalization&&(e=l.location.normalize());var H=l.locationType;var u=l.maxLocations;var G=l.forStorage;l=l.address}a&&(a=a.shiftCentralMeridian());var v=this.outSpatialReference;
l=this._encode(J.mixin({},this._url.query,l,{f:"json",outSR:v&&E.toJson(v.toJson()),outFields:f&&f.join(",")||null,searchExtent:a&&E.toJson(a.toJson()),category:I&&I.join(",")||null,countryCode:d||null,magicKey:h||null,distance:y||null,location:e||null,locationType:H||null,maxLocations:u||null,forStorage:G||null}));var t=this._geocodeHandler,F=this._errorHandler,B=new K(n._dfdCanceller);B._pendingDfd=A({url:this._url.path+"/findAddressCandidates",content:l,callbackParamName:"callback",load:function(O,
M){t(O,M,b,c,B)},error:function(O){F(O,c,B)}});return B},suggestLocations:function(l){var f=new K(n._dfdCanceller);l.hasOwnProperty("location")&&this.normalization&&(l.location=l.location.normalize());l.searchExtent&&(l.searchExtent=l.searchExtent.shiftCentralMeridian());l=this._encode(J.mixin({},this._url.query,{f:"json",text:l.text,maxSuggestions:l.maxSuggestions,searchExtent:l.searchExtent&&E.toJson(l.searchExtent.toJson()),category:l.categories&&l.categories.join(",")||null,countryCode:l.countryCode||
null,location:l.location||null,distance:l.distance||null},{f:"json"}));l=A({url:this._url.path+"/suggest",content:l,callbackParamName:"callback"});f._pendingDfd=l;l.then(J.hitch(this,function(b){b=b.suggestions||[];this.onSuggestLocationsComplete(b);f.resolve(b)}),J.hitch(this,function(b){this._errorHandler(b);f.reject(b)}));return f},addressesToLocations:function(l,f,b){var c=this.outSpatialReference,a=[],e=l.categories,d=l.locationType,h=l.countryCode;q.forEach(l.addresses,function(u,G){a.push({attributes:u})});
l=this._encode(J.mixin({},this._url.query,{category:e&&e.join(",")||null,locationType:d||null,sourceCountry:h||null},{addresses:E.toJson({records:a})},{f:"json",outSR:c&&E.toJson(c.toJson())}));var y=this._geocodeAddressesHandler,I=this._errorHandler,H=new K(n._dfdCanceller);H._pendingDfd=A({url:this._url.path+"/geocodeAddresses",content:l,callbackParamName:"callback",load:function(u,G){y(u,G,f,b,H)},error:function(u){I(u,b,H)}});return H},_reverseGeocodeHandler:function(l,f,b,c,a){try{var e=new m({address:l.address,
location:l.location,score:100});this._successHandler([e],"onLocationToAddressComplete",b,a)}catch(d){this._errorHandler(d,c,a)}},locationToAddress:function(l,f,b,c){l&&this.normalization&&(l=l.normalize());var a=this.outSpatialReference;l=this._encode(J.mixin({},this._url.query,{outSR:a&&E.toJson(a.toJson()),location:l&&E.toJson(l.toJson()),distance:f,f:"json"}));var e=this._reverseGeocodeHandler,d=this._errorHandler,h=new K(n._dfdCanceller);h._pendingDfd=A({url:this._url.path+"/reverseGeocode",content:l,
callbackParamName:"callback",load:function(y,I){e(y,I,b,c,h)},error:function(y){d(y,c,h)}});return h},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});w("extend-esri")&&J.setObject("tasks.Locator",L,x);return L})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(L,
J,q,K,E,w,x,A){L=L(A,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(n,g){n&&J.isString(n)&&(this._url=x.urlToObject(this.url=n));g&&g.requestOptions&&(this.requestOptions=g.requestOptions);this.normalization=!0;this._errorHandler=J.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var n=this._url,g=/^http:/i;this.url&&(this.url=this.url.replace(g,"https:"));n&&n.path&&(n.path=n.path.replace(g,"https:"))},_encode:function(n,
g,m){var l={},f;for(f in n)if("declaredClass"!==f){var b=n[f];var c=typeof b;if(null!==b&&void 0!==b&&"function"!==c)if(J.isArray(b)){l[f]=[];var a=b.length;for(c=0;c<a;c++)l[f][c]=this._encode(b[c])}else"object"===c?b.toJson&&(c=b.toJson(m&&m[f]),"esri.tasks.FeatureSet"===b.declaredClass&&c.spatialReference&&(c.sr=c.spatialReference,delete c.spatialReference),l[f]=g?c:q.toJson(c)):l[f]=b}return l},_successHandler:function(n,g,m,l){g&&this[g].apply(this,n);m&&m.apply(null,n);l&&w._resDfd(l,n)},_errorHandler:function(n,
g,m){this.onError(n);g&&g(n);m&&m.errback(n)},setNormalization:function(n){this.normalization=n},onError:function(){}});K("extend-esri")&&(E.Task=L);return L})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(L,J,q,K,E){L=L(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(w){J.mixin(this,w);this.location=new E(this.location)}});q("extend-esri")&&J.setObject("tasks.AddressCandidate",L,
K);return L})},"esri/styles/basic":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/has","../kernel","../Color"],function(L,J,q,K,E){function w(m,l){if(m){var f={};f.color=new E(m.color);f.opacity=m.opacity||1;switch(l){case "point":f.outline={color:new E(m.outline.color),width:m.outline.width};f.size=m.size;break;case "line":f.width=m.width;break;case "polygon":f.outline={color:new E(m.outline.color),width:m.outline.width}}}return f}function x(m){if("esriGeometryPoint"===m||"esriGeometryMultipoint"===
m)m="point";else if("esriGeometryPolyline"===m)m="line";else if("esriGeometryPolygon"===m||"esriGeometryMultiPatch"===m)m="polygon";return m}var A={"default":{name:"default",label:"Default",description:"Default theme for basic visualization of features.",basemapGroups:{light:"streets gray topo terrain national-geographic oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector".split(" "),dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]},
pointSchemes:{light:{primary:{color:[77,77,77,1],outline:{color:[255,255,255,.25],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,.25],width:1},size:8},{color:[255,255,255,1],outline:{color:[51,51,51,.25],width:1},size:8}]},dark:{primary:{color:[255,255,255,1],outline:{color:[92,92,92,.25],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,.25],width:1},size:8},{color:[26,26,26,1],outline:{color:[178,178,178,.25],width:1},size:8}]}},lineSchemes:{light:{primary:{color:[77,
77,77,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[255,255,255,1],width:2}]},dark:{primary:{color:[255,255,255,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[26,26,26,1],width:2}]}},polygonSchemes:{light:{primary:{color:[227,139,79,1],outline:{color:[255,255,255,.25],width:1},opacity:.8},secondary:[{color:[128,128,128,1],outline:{color:[255,255,255,.25],width:1},opacity:.8},{color:[255,255,255,1],outline:{color:[128,128,128,.25],width:1},opacity:.8}]},dark:{primary:{color:[227,
139,79,1],outline:{color:[92,92,92,.25],width:1},opacity:.8},secondary:[{color:[178,178,178,1],outline:{color:[92,92,92,.25],width:1},opacity:.8},{color:[26,26,26,1],outline:{color:[128,128,128,.25],width:1},opacity:.8}]}}}},n={};(function(){var m,l,f;for(m in A){var b=A[m];var c=b.basemapGroups;var a=n[m]={basemaps:[].concat(c.light).concat(c.dark),point:{},line:{},polygon:{}};for(l in c){var e=c[l];for(f=0;f<e.length;f++){var d=e[f];b.pointSchemes&&(a.point[d]=b.pointSchemes[l]);b.lineSchemes&&
(a.line[d]=b.lineSchemes[l]);b.polygonSchemes&&(a.polygon[d]=b.polygonSchemes[l])}}}})();var g={getAvailableThemes:function(m){var l=[],f;for(f in A){var b=A[f];var c=n[f];m&&-1===L.indexOf(c.basemaps,m)||l.push({name:b.name,label:b.label,description:b.description,basemaps:c.basemaps.slice(0)})}return l},getSchemes:function(m){var l=m.theme,f=m.basemap,b=x(m.geometryType);m=n[l];var c;(m=(m=m&&m[b])&&m[f])&&(c={primaryScheme:w(m.primary,b),secondarySchemes:L.map(m.secondary,function(a){return w(a,
b)})});return c},cloneScheme:function(m){if(m){var l=J.mixin({},m);l.color&&(l.color=new E(l.color));l.outline&&(l.outline={color:l.outline.color&&new E(l.outline.color),width:l.outline.width})}return l}};q("extend-esri")&&J.setObject("styles.basic",g,K);return g})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,l){q.isAsync||
A(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var f=J("dojo.dnd.Source",m,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(b,c){K.mixin(this,K.mixin({},c));b=this.accept;if(b.length)for(this.accept={},c=0;c<b.length;++c)this.accept[b[c]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState=
"";this.isSource&&E.add(this.node,"dojoDndSource");this.targetState="";this.accept&&E.add(this.node,"dojoDndTarget");this.horizontal&&E.add(this.node,"dojoDndHorizontal");this.topics=[n.subscribe("/dnd/source/over",K.hitch(this,"onDndSourceOver")),n.subscribe("/dnd/start",K.hitch(this,"onDndStart")),n.subscribe("/dnd/drop",K.hitch(this,"onDndDrop")),n.subscribe("/dnd/cancel",K.hitch(this,"onDndCancel"))]},checkAcceptance:function(b,c){if(this==b)return!this.copyOnly||this.selfAccept;for(var a=0;a<
c.length;++a){for(var e=b.getItem(c[a].id).type,d=!1,h=0;h<e.length;++h)if(e[h]in this.accept){d=!0;break}if(!d)return!1}return!0},copyState:function(b,c){if(b)return!0;2>arguments.length&&(c=this==l.manager().target);if(c){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){f.superclass.destroy.call(this);L.forEach(this.topics,function(b){b.remove()});this.targetAnchor=null},onMouseMove:function(b){if(!this.isDragging||"Disabled"!=this.targetState){f.superclass.onMouseMove.call(this,
b);var c=l.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(b.pageX-this._lastX)>this.delay||Math.abs(b.pageY-this._lastY)>this.delay)){var a=this.getSelectedNodes();a.length&&c.startDrag(this,a,this.copyState(g.getCopyKeyState(b),!0))}this.isDragging&&(a=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=w.position(this.current,!0)),a=this.horizontal?b.pageX-this.targetBox.x<this.targetBox.w/2==w.isBodyLtr(this.current.ownerDocument):b.pageY-
this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||a!=this.before)&&(this._markTargetAnchor(a),c.canDrop(!this.current||c.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(b){this.mouseDown||!this._legalMouseDown(b)||this.skipForm&&g.isFormElement(b)||(this.mouseDown=!0,this._lastX=b.pageX,this._lastY=b.pageY,f.superclass.onMouseDown.call(this,b))},onMouseUp:function(b){this.mouseDown&&(this.mouseDown=!1,f.superclass.onMouseUp.call(this,b))},onDndSourceOver:function(b){this!==
b?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(b=l.manager(),b.canDrop("Disabled"!=this.targetState&&(!this.current||b.source!=this||!(this.current.id in this.selection))))},onDndStart:function(b,c,a){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==b?a?"Copied":"Moved":"");c=this.accept&&this.checkAcceptance(b,c);this._changeState("Target",c?"":"Disabled");this==b&&l.manager().overSource(this);this.isDragging=!0},onDndDrop:function(b,
c,a,e){if(this==e)this.onDrop(b,c,a);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(b,c,a){if(this!=b)this.onDropExternal(b,c,a);else this.onDropInternal(c,a)},onDropExternal:function(b,c,a){var e=this._normalizedCreator;this._normalizedCreator=this.creator?function(d,h){return e.call(this,b.getItem(d.id).data,
h)}:a?function(d){var h=b.getItem(d.id);d=d.cloneNode(!0);d.id=g.getUniqueId();return{node:d,data:h.data,type:h.type}}:function(d){var h=b.getItem(d.id);b.delItem(d.id);return{node:d,data:h.data,type:h.type}};this.selectNone();a||this.creator||b.selectNone();this.insertNodes(!0,c,this.before,this.current);!a&&this.creator&&b.deleteSelectedNodes();this._normalizedCreator=e},onDropInternal:function(b,c){var a=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(c)this._normalizedCreator=
this.creator?function(e,d){return a.call(this,this.getItem(e.id).data,d)}:function(e){var d=this.getItem(e.id);e=e.cloneNode(!0);e.id=g.getUniqueId();return{node:e,data:d.data,type:d.type}};else{if(!this.current)return;this._normalizedCreator=function(e){var d=this.getItem(e.id);return{node:e,data:d.data,type:d.type}}}this._removeSelection();this.insertNodes(!0,b,this.before,this.current);this._normalizedCreator=a}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){f.superclass.onOverEvent.call(this);
l.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){f.superclass.onOutEvent.call(this);l.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(b){if(this.current!=this.targetAnchor||this.before!=b)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=b,this.targetAnchor&&
this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(b){this._changeState("Source",b?"Copied":"Moved")},_legalMouseDown:function(b){if("touchstart"!=b.type&&!x.isLeft(b))return!1;if(!this.withHandles)return!0;for(b=b.target;b&&b!==this.node;b=b.parentNode){if(E.contains(b,"dojoDndHandle"))return!0;
if(E.contains(b,"dojoDndItem")||E.contains(b,"dojoDndIgnore"))break}return!1}});return f})},"dojo/dnd/common":function(){define(["../sniff","../_base/kernel","../_base/lang","../dom"],function(L,J,q,K){var E=q.getObject("dojo.dnd",!0);E.getCopyKeyState=function(w){return w[L("mac")?"metaKey":"ctrlKey"]};E._uniqueId=0;E.getUniqueId=function(){do var w=J._scopeName+"Unique"+ ++E._uniqueId;while(K.byId(w));return w};E._empty={};E.isFormElement=function(w){w=w.target;3==w.nodeType&&(w=w.parentNode);return 0<=
" a button textarea input select option ".indexOf(" "+w.tagName.toLowerCase()+" ")};return E})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,l){var f=J("dojo.dnd.Selector",l,{constructor:function(b,c){c||(c={});this.singular=c.singular;this.autoSync=c.autoSync;this.selection={};this.anchor=null;this.simpleSelection=
!1;this.events.push(n(this.node,g.press,K.hitch(this,"onMouseDown")),n(this.node,g.release,K.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var b=new A,c=m._empty,a;for(a in this.selection)a in c||b.push(E.byId(a));return b},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(b,c){this._addItemClass(E.byId(c),"Selected");this.selection[c]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var b=m._empty,
c;for(c in this.selection)if(!(c in b)){var a=E.byId(c);this.delItem(c);w.destroy(a)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(b,c){c=c||q.global;var a=this.selection,e=m._empty,d;for(d in a)d in e||b.call(c,this.getItem(d),d,this)},sync:function(){f.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var b=[],c=m._empty,a;for(a in this.selection)a in c||this.getItem(a)||b.push(a);L.forEach(b,function(e){delete this.selection[e]},
this);return this},insertNodes:function(b,c,a,e){var d=this._normalizedCreator;this._normalizedCreator=function(h,y){h=d.call(this,h,y);b?(this.anchor?this.anchor!=h.node&&(this._removeItemClass(h.node,"Anchor"),this._addItemClass(h.node,"Selected")):(this.anchor=h.node,this._removeItemClass(h.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[h.node.id]=1):(this._removeItemClass(h.node,"Selected"),this._removeItemClass(h.node,"Anchor"));return h};f.superclass.insertNodes.call(this,
c,a,e);this._normalizedCreator=d;return this},destroy:function(){f.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(b){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!m.getCopyKeyState(b)&&!b.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,x.isLeft(b)&&(b.stopPropagation(),b.preventDefault());else{if(!this.singular&&b.shiftKey){m.getCopyKeyState(b)||this._removeSelection();var c=this.getAllNodes();if(c.length&&(this.anchor||(this.anchor=
c[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var a=0,e;a<c.length&&(e=c[a],e!=this.anchor&&e!=this.current);++a);for(++a;a<c.length;++a){e=c[a];if(e==this.anchor||e==this.current)break;this._addItemClass(e,"Selected");this.selection[e.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?m.getCopyKeyState(b)&&this.selectNone():(this.selectNone(),this.anchor=
this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):m.getCopyKeyState(b)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=
1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);b.stopPropagation();b.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=n(this.node,
g.move,K.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var b=m._empty,c;for(c in this.selection)if(!(c in b)){var a=E.byId(c);a&&this._removeItemClass(a,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return f})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b){J=J("dojo.dnd.Container",n,{skipForm:!1,allowNested:!1,constructor:function(c,a){this.node=w.byId(c);a||(a={});this.creator=a.creator||null;this.skipForm=a.skipForm;this.parent=a.dropParent&&w.byId(a.dropParent);this.map={};this.current=null;this.containerState="";x.add(this.node,"dojoDndContainer");a&&a._skipStartup||this.startup();this.events=[m(this.node,f.over,K.hitch(this,"onMouseOver")),m(this.node,f.out,K.hitch(this,"onMouseOut")),m(this.node,"dragstart",
K.hitch(this,"onSelectStart")),m(this.node,"selectstart",K.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(c){return this.map[c]},setItem:function(c,a){this.map[c]=a},delItem:function(c){delete this.map[c]},forInItems:function(c,a){a=a||q.global;var e=this.map,d=b._empty,h;for(h in e)h in d||c.call(a,e[h],h,this);return a},clearItems:function(){this.map={}},getAllNodes:function(){return l((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var c={};this.getAllNodes().forEach(function(a){if(a.id){var e=
this.getItem(a.id);if(e){c[a.id]=e;return}}else a.id=b.getUniqueId();e=a.getAttribute("dndType");var d=a.getAttribute("dndData");c[a.id]={data:d||a.innerHTML,type:e?e.split(/\s*,\s*/):["text"]}},this);this.map=c;return this},insertNodes:function(c,a,e){this.parent.firstChild?a?e||(e=this.parent.firstChild):e&&(e=e.nextSibling):e=null;if(e)for(a=0;a<c.length;++a){var d=this._normalizedCreator(c[a]);this.setItem(d.node.id,{data:d.data,type:d.type});e.parentNode.insertBefore(d.node,e)}else for(a=0;a<
c.length;++a)d=this._normalizedCreator(c[a]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);return this},destroy:function(){L.forEach(this.events,function(c){c.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(c,a,e){c._skipStartup=!0;return new e(a,c)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var c=this.parent.getElementsByTagName("tbody");c&&c.length&&(this.parent=
c[0])}this.defaultCreator=b._defaultCreator(this.parent);this.sync()},onMouseOver:function(c){for(var a=c.relatedTarget;a&&a!=this.node;)try{a=a.parentNode}catch(e){a=null}a||(this._changeState("Container","Over"),this.onOverEvent());a=this._getChildByEvent(c);this.current!=a&&(this.current&&this._removeItemClass(this.current,"Over"),a&&this._addItemClass(a,"Over"),this.current=a)},onMouseOut:function(c){for(c=c.relatedTarget;c;){if(c==this.node)return;try{c=c.parentNode}catch(a){c=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(c){this.withHandles||this.skipForm&&b.isFormElement(c)||(c.stopPropagation(),c.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(c,a){var e="dojoDnd"+c;c=c.toLowerCase()+"State";x.replace(this.node,e+a,e+this[c]);this[c]=a},_addItemClass:function(c,a){x.add(c,"dojoDndItem"+a)},_removeItemClass:function(c,a){x.remove(c,"dojoDndItem"+
a)},_getChildByEvent:function(c){if(c=c.target)for(var a=c.parentNode;a;c=a,a=c.parentNode)if((a==this.parent||this.allowNested)&&x.contains(c,"dojoDndItem"))return c;return null},_normalizedCreator:function(c,a){c=(this.creator||this.defaultCreator).call(this,c,a);K.isArray(c.type)||(c.type=["text"]);c.node.id||(c.node.id=b.getUniqueId());x.add(c.node,"dojoDndItem");return c}});b._createNode=function(c){return c?function(a){return A.create(c,{innerHTML:a})}:b._createSpan};b._createTrTd=function(c){var a=
A.create("tr");A.create("td",{innerHTML:c},a);return a};b._createSpan=function(c){return A.create("span",{innerHTML:c})};b._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};b._defaultCreator=function(c){c=c.tagName.toLowerCase();var a="tbody"==c||"thead"==c?b._createTrTd:b._createNode(b._defaultCreatorNodes[c]);return function(e,d){var h=e&&K.isObject(e);if(h&&e.tagName&&e.nodeType&&e.getAttribute){var y=e.getAttribute("dndData")||e.innerHTML;h=(h=e.getAttribute("dndType"))?h.split(/\s*,\s*/):
["text"]}else y=h&&e.data?e.data:e,h=h&&e.type?e.type:["text"],e=("avatar"==d?b._createSpan:a)(String(y));e.id||(e.id=b.getUniqueId());return{node:e,data:y,type:h}}};return J})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,l,f,b){var c=J("dojo.dnd.Manager",[w],{constructor:function(){this.source=this.avatar=
null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:x("touch")?4:16,OFFSET_Y:x("touch")?4:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());g.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),g.publish("/dnd/source/over",null)):g.publish("/dnd/source/over",null)},startDrag:function(a,
e,d){function h(y){y.preventDefault();y.stopPropagation()}f.autoScrollStart(K.doc);this.source=a;this.nodes=e;this.copy=!!d;this.avatar=this.makeAvatar();K.body().appendChild(this.avatar.node);g.publish("/dnd/start",a,e,this.copy);this.events=[n(K.doc,m.move,q.hitch(this,"onMouseMove")),n(K.doc,m.release,q.hitch(this,"onMouseUp")),n(K.doc,"keydown",q.hitch(this,"onKeyDown")),n(K.doc,"keyup",q.hitch(this,"onKeyUp")),n(K.doc,"dragstart",h),n(K.body(),"selectstart",h)];a="dojoDnd"+(d?"Copy":"Move");
E.add(K.body(),a)},canDrop:function(a){a=!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){E.remove(K.body(),["dojoDndCopy","dojoDndMove"]);L.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new b(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var e=this.avatar;e&&(f.autoScrollNodes(a),e=e.node.style,
e.left=a.pageX+this.OFFSET_X+"px",e.top=a.pageY+this.OFFSET_Y+"px",e=!!this.source.copyState(l.getCopyKeyState(a)),this.copy!=e&&this._setCopyStatus(e));x("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var e=!!this.source.copyState(l.getCopyKeyState(a));g.publish("/dnd/drop/before",this.source,this.nodes,e,this.target,a);g.publish("/dnd/drop",this.source,this.nodes,e,this.target,a)}else g.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case A.CTRL:a=
!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case A.ESCAPE:g.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==A.CTRL&&(a=!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();E.replace(K.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});l._manager=null;c.manager=l.manager=function(){l._manager||
(l._manager=new c);return l._manager};return c})},"dojo/dnd/autoscroll":function(){define("../_base/lang ../sniff ../_base/window ../dom-geometry ../dom-style ../window".split(" "),function(L,J,q,K,E,w){var x={};L.setObject("dojo.dnd.autoscroll",x);x.getViewport=w.getBox;x.V_TRIGGER_AUTOSCROLL=32;x.H_TRIGGER_AUTOSCROLL=32;x.V_AUTOSCROLL_VALUE=16;x.H_AUTOSCROLL_VALUE=16;var A,n=q.doc,g=Infinity,m=Infinity;x.autoScrollStart=function(l){n=l;A=w.getBox(n);l=q.body(n).parentNode;g=Math.max(l.scrollHeight-
A.h,0);m=Math.max(l.scrollWidth-A.w,0)};x.autoScroll=function(l){var f=A||w.getBox(n),b=q.body(n).parentNode,c=0,a=0;l.clientX<x.H_TRIGGER_AUTOSCROLL?c=-x.H_AUTOSCROLL_VALUE:l.clientX>f.w-x.H_TRIGGER_AUTOSCROLL&&(c=Math.min(x.H_AUTOSCROLL_VALUE,m-b.scrollLeft));l.clientY<x.V_TRIGGER_AUTOSCROLL?a=-x.V_AUTOSCROLL_VALUE:l.clientY>f.h-x.V_TRIGGER_AUTOSCROLL&&(a=Math.min(x.V_AUTOSCROLL_VALUE,g-b.scrollTop));window.scrollBy(c,a)};x._validNodes={div:1,p:1,td:1};x._validOverflow={auto:1,scroll:1};x.autoScrollNodes=
function(l){for(var f,b,c,a,e,d=0,h=0,y=l.target;y;){if(1==y.nodeType&&y.tagName.toLowerCase()in x._validNodes){c=E.getComputedStyle(y);e=c.overflowX.toLowerCase()in x._validOverflow;a=c.overflowY.toLowerCase()in x._validOverflow;if(e||a)f=K.getContentBox(y,c),b=K.position(y,!0);if(e){c=Math.min(x.H_TRIGGER_AUTOSCROLL,f.w/2);e=l.pageX-b.x;if(J("webkit")||J("opera"))e+=q.body().scrollLeft;d=0;0<e&&e<f.w&&(e<c?d=-c:e>f.w-c&&(d=c),y.scrollLeft+=d)}if(a){a=Math.min(x.V_TRIGGER_AUTOSCROLL,f.h/2);c=l.pageY-
b.y;if(J("webkit")||J("opera"))c+=q.body().scrollTop;h=0;0<c&&c<f.h&&(c<a?h=-a:c>f.h-a&&(h=a),y.scrollTop+=h)}if(d||h)return}try{y=y.parentNode}catch(I){y=null}}x.autoScroll(l)};return x})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(L,J,q,K,E,w,x,A){return L("dojo.dnd.Avatar",null,{constructor:function(n){this.manager=n;this.construct()},construct:function(){var n=w.create("table",{"class":"dojoDndAvatar",
style:{position:"absolute",zIndex:"1999",margin:"0px"}}),g=this.manager.source,m=w.create("tbody",null,n),l=w.create("tr",null,m),f=w.create("td",null,l),b=Math.min(5,this.manager.nodes.length),c=0;x("highcontrast")&&w.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},f);w.create("span",{innerHTML:g.generateText?this._generateText():""},f);for(K.set(l,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});c<b;++c){if(g.creator)var a=g._normalizedCreator(g.getItem(this.manager.nodes[c].id).data,
"avatar").node;else a=this.manager.nodes[c].cloneNode(!0),"tr"==a.tagName.toLowerCase()&&(l=w.create("table"),w.create("tbody",null,l).appendChild(a),a=l);a.id="";l=w.create("tr",null,m);f=w.create("td",null,l);f.appendChild(a);K.set(l,{"class":"dojoDndAvatarItem",style:{opacity:(9-c)/10}})}this.node=n},destroy:function(){w.destroy(this.node);this.node=!1},update:function(){E.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(x("highcontrast")){var n=q.byId("a11yIcon"),g="+";this.manager.canDropFlag&&
!this.manager.copy?g="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(g="x"):g="o";n.innerHTML=g}A("tr.dojoDndAvatarHeader td span"+(x("highcontrast")?" span":""),this.node).forEach(function(m){m.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"esri/arcgis/utils":function(){define("require dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/on dojo/DeferredList dojo/dom-construct dojo/sniff dojox/gfx/_base ../kernel ../config ../Color ../lang ../request ../SpatialReference ../map ../urlUtils ../geometry/Point ../geometry/ScreenPoint ../geometry/Extent ../geometry/webMercatorUtils ../symbols/jsonUtils ../renderers/jsonUtils ../dijit/PopupTemplate ../dijit/Popup ../tasks/query ../tasks/GeometryService ../layers/ArcGISTiledMapServiceLayer ../layers/FeatureLayer dojo/i18n!../nls/jsapi".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a,e,d,h,y,I,H,u,G,v,t,F,B,O,M,C,W,Y){function R(D){return!(!D||"BingMapsAerial"!==D.layerType&&"BingMapsAerial"!==D.type)}function S(D){return!(!D||"BingMapsRoad"!==D.layerType&&"BingMapsRoad"!==D.type)}function T(D){return R(D)||S(D)||!(!D||"BingMapsHybrid"!==D.layerType&&"BingMapsHybrid"!==D.type)}function Z(D){return!(!D||"OpenStreetMap"!==D.layerType&&"OpenStreetMap"!==D.type)}function qa(D){return!!(D&&D.url&&(-1<"ArcGISFeatureLayer ArcGISImageServiceLayer ArcGISImageServiceVectorLayer ArcGISMapServiceLayer ArcGISStreamLayer ArcGISTiledImageServiceLayer ArcGISTiledMapServiceLayer".split(" ").indexOf(D.layerType)||
!D.layerType&&!D.type))}function ta(D){return e({url:rb.arcgisUrl+"/"+D.itemId+"/data",content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:!0,_preLookup:!0})}function Ba(D,pa){var oa={f:"json"};pa&&(oa.token=pa);return e({url:D,content:oa,callbackParamName:"callback"},{disableIdentityLookup:!0})}function Oa(D){!D.layerDefinition||D.layerDefinition.drawingInfo&&D.layerDefinition.drawingInfo.labelingInfo||(D.showLabels=!1);D.itemProperties.layerDefinition&&(D.layerDefinition?(D.layerDefinition.drawingInfo||
(D.layerDefinition.drawingInfo=D.itemProperties.layerDefinition.drawingInfo),a.isDefined(D.layerDefinition.definitionExpression)||(D.layerDefinition.definitionExpression=D.itemProperties.layerDefinition.definitionExpression),a.isDefined(D.layerDefinition.minScale)||(D.layerDefinition.minScale=D.itemProperties.layerDefinition.minScale),a.isDefined(D.layerDefinition.maxScale)||(D.layerDefinition.maxScale=D.itemProperties.layerDefinition.maxScale)):D.layerDefinition=D.itemProperties.layerDefinition);
!D.itemProperties.popupInfo||D.popupInfo||D.disablePopup||(D.popupInfo=D.itemProperties.popupInfo);a.isDefined(D.itemProperties.showLabels)&&!a.isDefined(D.showLabels)&&(D.showLabels=D.itemProperties.showLabels);a.isDefined(D.itemProperties.showLegend)&&!a.isDefined(D.showLegend)&&(D.showLegend=D.itemProperties.showLegend);a.isDefined(D.itemProperties.refreshInterval)&&!a.isDefined(D.refreshInterval)&&(D.refreshInterval=D.itemProperties.refreshInterval)}function Ia(D){Oa(D);D.itemProperties.layerDefinition&&
D.layerDefinition&&(!a.isDefined(D.layerDefinition.maximumTrackPoints)&&a.isDefined(D.itemProperties.layerDefinition.maximumTrackPoints)&&(D.layerDefinition.maximumTrackPoints=D.itemProperties.layerDefinition.maximumTrackPoints),!D.layerDefinition.definitionGeometry&&D.itemProperties.layerDefinition.definitionGeometry&&(D.layerDefinition.definitionGeometry=D.itemProperties.layerDefinition.definitionGeometry));D.itemProperties.purgeOptions&&!D.purgeOptions&&(D.purgeOptions=D.itemProperties.purgeOptions)}
function Ra(D,pa){var oa=new E;pa=D.itemData;var fa=[],la=[];q.forEach(pa.operationalLayers,function(sa){if(sa.itemId&&qa(sa)){var na=sa.url.toLowerCase();-1<na.indexOf("/featureserver")||-1<na.indexOf("/mapserver/")?(la.push(sa),fa.push(ta(sa))):-1<na.indexOf("/mapserver")&&-1===na.indexOf("/mapserver/")&&(!sa.layers||!a.isDefined(sa.minScale)&&!a.isDefined(sa.maxScale))?(la.push(sa),fa.push(ta(sa))):-1<na.indexOf("/imageserver")?(la.push(sa),fa.push(ta(sa))):-1<na.indexOf("/streamserver")&&(la.push(sa),
fa.push(ta(sa)))}});pa.baseMap&&pa.baseMap.baseMapLayers&&q.forEach(pa.baseMap.baseMapLayers,function(sa){sa.itemId&&"VectorTileLayer"!==sa.layerType&&(la.push(sa),fa.push(ta(sa)))});if(0<fa.length){var wa={};(new n(fa)).addCallback(function(sa){q.forEach(la,function(na,za){if((za=sa[za][1])&&!(za instanceof Error)&&(wa[na.itemId]=za,qa(na))){var Ea=na.url.toLowerCase();(-1<Ea.indexOf("/featureserver")||-1<Ea.indexOf("/mapserver/"))&&za.layers?q.forEach(za.layers,function(La){var Ua="/featureserver/"+
La.id;(Ua=Ea.match(Ua+"$")==Ua)||(Ua="/mapserver/"+La.id,Ua=Ea.match(Ua+"$")==Ua);Ua&&(na.itemProperties=La,Oa(na))}):-1<Ea.indexOf("/streamserver")?(na.itemProperties=za,Ia(na)):-1<Ea.indexOf("/mapserver")?(za.layers&&!na.layers&&(na.layers=za.layers),a.isDefined(za.minScale)&&!a.isDefined(na.minScale)&&(na.minScale=za.minScale),a.isDefined(za.maxScale)&&!a.isDefined(na.maxScale)&&(na.maxScale=za.maxScale),a.isDefined(za.refreshInterval)&&!a.isDefined(na.refreshInterval)&&(na.refreshInterval=za.refreshInterval),
za.visibleLayers&&!na.visibleLayers&&(na.visibleLayers=za.visibleLayers)):-1<Ea.indexOf("/imageserver")&&(a.isDefined(za.minScale)&&!a.isDefined(na.minScale)&&(na.minScale=za.minScale),a.isDefined(za.maxScale)&&!a.isDefined(na.maxScale)&&(na.maxScale=za.maxScale),a.isDefined(za.refreshInterval)&&!a.isDefined(na.refreshInterval)&&(na.refreshInterval=za.refreshInterval),!za.popupInfo||na.popupInfo||na.disablePopup||(na.popupInfo=za.popupInfo),za.renderingRule&&!na.renderingRule&&(na.renderingRule=za.renderingRule,
za.renderingRule.functionName&&(na.renderingRule.rasterFunction=za.renderingRule.functionName)),za.bandIds&&!na.bandIds&&(na.bandIds=za.bandIds),za.mosaicRule&&!na.mosaicRule&&(na.mosaicRule=za.mosaicRule),za.format&&!na.format&&(na.format=za.format),a.isDefined(za.compressionQuality)&&!a.isDefined(na.compressionQuality)&&(na.compressionQuality=za.compressionQuality),!za.layerDefinition||!za.layerDefinition.definitionExpression||a.isDefined(na.layerDefinition)&&a.isDefined(na.layerDefinition.definitionExpression)||
(na.layerDefinition=na.layerDefinition||{},na.layerDefinition.definitionExpression=za.layerDefinition.definitionExpression),za=J.getObject("layerDefinition.drawingInfo.renderer",!1,za),null==J.getObject("layerDefinition.drawingInfo.renderer",!1,na)&&null!=za&&(na.layerDefinition=na.layerDefinition||{},na.layerDefinition.drawingInfo=na.layerDefinition.drawingInfo||{},na.layerDefinition.drawingInfo.renderer=za))}});D.relatedItemsData=wa;oa.callback(D)})}else oa.callback(D);return oa}function Va(D,pa){var oa=
new E,fa=D.itemData,la=fa.baseMap.baseMapLayers[0];if(T(la))if(la.portalUrl&&f.id)delete pa.bingMapsKey,f.id.checkSignInStatus(y.urlToObject(rb.arcgisUrl).path).then(J.hitch(null,function(sa,na,za,Ea,La){Ba(la.portalUrl,La.token).then(J.hitch(null,Q,sa,na,za,Ea),J.hitch(null,ba,sa,na,za,Ea))},D,pa,fa,oa),J.hitch(null,function(sa,na,za,Ea,La){Ba(la.portalUrl).then(J.hitch(null,Q,sa,na,za,Ea),J.hitch(null,ba,sa,na,za,Ea))},D,pa,fa,oa));else if(pa.bingMapsKey){var wa=new tb({bingMapsKey:pa.bingMapsKey,
mapStyle:tb.MAP_STYLE_AERIAL});K.connect(wa,"onLoad",J.hitch(this,function(){oa.callback([D,pa])}));K.connect(wa,"onError",function(sa){delete pa.bingMapsKey;D.itemData=ia(fa);la=D.itemData.baseMap.baseMapLayers[0];la.errors=[];la.errors.push({message:"The owner of the application has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});oa.callback([D,pa])})}else D.itemData=ia(fa),la=D.itemData.baseMap.baseMapLayers[0],la.errors=[],la.errors.push({message:"The owner of the application has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."}),
oa.callback([D,pa]);else oa.callback([D,pa]);return oa}function ab(D){var pa=new E;D=D.itemData;var oa=D.baseMap&&D.baseMap.baseMapLayers;if(mb&&!mb.supported())for(D=0;D<oa.length;D++){var fa=oa[D];if(!fa.isReference){if("VectorTileLayer"===fa.layerType){var la=fa.itemId;var wa=D}break}}la?ob(la,!1).addBoth(function(sa){var na=/^https?:\/\/basemaps(dev)?\.arcgis\.com\/arcgis\/rest\/services\/World_Basemap\/VectorTileServer/i;sa&&sa.item&&na.test(sa.item.url)&&(oa[wa]={id:"FB_"+fa.id,layerType:"ArcGISTiledMapServiceLayer",
opacity:"opacity"in fa?fa.opacity:1,visibility:"visibility"in fa?fa.visibility:!0,url:"https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer"});pa.resolve()}):pa.resolve();return pa}function Q(D,pa,oa,fa,la){la.bingKey?(pa.bingMapsKey=la.bingKey,la=new tb({bingMapsKey:pa.bingMapsKey,mapStyle:tb.MAP_STYLE_AERIAL}),K.connect(la,"onLoad",J.hitch(this,function(){fa.callback([D,pa])})),K.connect(la,"onError",function(wa){delete pa.bingMapsKey;D.itemData=ia(oa);wa=D.itemData.baseMap.baseMapLayers[0];
wa.errors=[];wa.errors.push({message:"The owner of the map has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});fa.callback([D,pa])})):ba(D,pa,oa,fa)}function ba(D,pa,oa,fa){delete pa.bingMapsKey;D.itemData=ia(oa);oa=D.itemData.baseMap.baseMapLayers[0];oa.errors=[];oa.errors.push({message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."});fa.callback([D,pa])}function ia(D){R(D.baseMap.baseMapLayers[0])?
D.baseMap={title:"Imagery",baseMapLayers:[{id:"World_Imagery_2017",visibility:!0,opacity:1,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]}:S(D.baseMap.baseMapLayers[0])?D.baseMap={title:"Streets",baseMapLayers:[{id:"World_Street_Map_8421",opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}:D.baseMap={title:"Imagery with Labels",baseMapLayers:[{id:"World_Imagery_6611",opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},
{id:"World_Boundaries_and_Places_1145",isReference:!0,opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer"}]};return D}function ha(D,pa,oa,fa){var la=D.dynamicLayerInfos||D.layerInfos,wa=pa.layers;if(wa&&la)if(fa.usePopupManager){var sa;q.forEach(la,function(Ta){var Sa=Ta.id;if(!Ta.subLayerIds)for(Ta=0;Ta<wa.length;Ta++){var db=wa[Ta];if(db.id===Sa&&db.popupInfo&&!db.disablePopup){sa||(sa={});sa[Sa]={infoTemplate:new oa(db.popupInfo),
layerUrl:db.layerUrl};break}}});sa&&D.setInfoTemplates(sa)}else{var na=[],za=[],Ea=[],La=[],Ua=[],Fa=[];q.forEach(la,function(Ta){var Sa=Ta.id;if(!Ta.subLayerIds&&-1!==q.indexOf(D.visibleLayers,Sa))for(Ta=0;Ta<wa.length;Ta++){var db=wa[Ta];if(db.id===Sa){za.push(Sa);na.push(db.popupInfo);Ea.push(db.layerUrl||"");db.layerDefinition&&db.layerDefinition.definitionExpression?La.push(db.layerDefinition.definitionExpression):La.push("");Ua.push(a.isDefined(db.minScale)?db.minScale:null);Fa.push(a.isDefined(db.maxScale)?
db.maxScale:null);break}}});na.length&&(D.__popups=na,D.__popupIds=za,D.__popupUrls=Ea,D.__popupWhereClauses=La,D.__popupMinScales=Ua,D.__popupMaxScales=Fa,D.__resourceInfo=pa.resourceInfo)}}function ua(D){if(!D)return!1;var pa=(new x(rb.arcgisUrl)).authority;return-1!==D.indexOf(".arcgis.com/")||-1!==D.indexOf(pa)}function Ga(D){return D?-1!==D.indexOf("/services.arcgisonline.com/")||-1!==D.indexOf("/server.arcgisonline.com/"):!1}function ea(D){"https:"===location.protocol&&(ua(D)||Ga(D))&&(D=D.replace("http:",
"https:"));return D}function va(D,pa,oa){var fa=[];D.displayLevels||(fa=q.map(D.resourceInfo.tileInfo.lods,function(sa){return sa.level}));if(D.exclusionAreas){var la=J.clone(D.exclusionAreas);la=q.map(la,function(sa){sa.geometry=new u(sa.geometry);return sa})}var wa=D.resourceInfo&&"Raster"===D.resourceInfo.cacheType;wa?(fa=D.layerDefinition&&D.layerDefinition.drawingInfo&&D.layerDefinition.drawingInfo.renderer,fa=new $a(ea(D.url),{resourceInfo:D.resourceInfo,opacity:D.opacity,visible:D.visibility,
id:D.id,minScale:D.minScale,maxScale:D.maxScale,refreshInterval:D.refreshInterval,multidimensionalDefinition:D.multidimensionalDefinition,bandIds:D.bandIds,renderer:fa||null})):fa=new C(ea(D.url),{resourceInfo:D.resourceInfo,opacity:D.opacity,visible:D.visibility,displayLevels:D.displayLevels||fa,id:D.id,minScale:D.minScale,maxScale:D.maxScale,refreshInterval:D.refreshInterval,exclusionAreas:la});oa.ignorePopups||(wa&&D.popupInfo&&!D.disablePopup?fa.setInfoTemplate(new pa(D.popupInfo)):ha(fa,D,pa,
oa));return fa}function xa(D,pa){if(!D||!pa||0===pa.length)return[];pa=","+pa+",";var oa=[],fa,la=",";for(fa=0;fa<D.length;fa++)if(null!==D[fa].subLayerIds){if(-1===pa.indexOf(","+D[fa].id+",")||-1<la.indexOf(","+D[fa].id+","))la+=D[fa].subLayerIds.toString()+","}else-1<pa.indexOf(","+D[fa].id+",")&&-1===la.indexOf(","+D[fa].id+",")&&oa.push(D[fa].id);return oa}function Da(D,pa,oa){var fa=new qb;fa.format="png24";D.resourceInfo&&D.resourceInfo.supportedImageFormatTypes&&-1<D.resourceInfo.supportedImageFormatTypes.indexOf("PNG32")&&
(fa.format="png32");fa=new kb(ea(D.url),{resourceInfo:D.resourceInfo,opacity:D.opacity,visible:D.visibility,id:D.id,imageParameters:fa,minScale:D.minScale,maxScale:D.maxScale,refreshInterval:D.refreshInterval});var la=D.visibleLayers;if(!D.visibleLayers){var wa="";q.forEach(fa.layerInfos,function(Fa){Fa.defaultVisibility&&(wa+=(0<wa.length?",":"")+Fa.id)});la=wa}if(D.layers&&0<D.layers.length){var sa=[],na=[],za,Ea=[],La,Ua;q.forEach(D.layers,function(Fa){var Ta=Fa.layerDefinition;Ta&&Ta.definitionExpression&&
(sa[Fa.id]=Ta.definitionExpression);if(Ta&&Ta.source){za=null;Ua=Ta.source;if("mapLayer"===Ua.type){var Sa=q.filter(D.resourceInfo.layers,function(db){return db.id===Ua.mapLayerId});Sa.length&&(za=J.mixin(Sa[0],Fa))}else za=J.mixin({},Fa);za&&(za.source=Ua,delete za.popupInfo,za=new eb(za),D.visibleLayers&&(Sa="string"==typeof D.visibleLayers?D.visibleLayers.split(","):D.visibleLayers,-1<q.indexOf(Sa,Fa.id)?za.defaultVisibility=!0:za.defaultVisibility=!1),na.push(za))}Ta&&null!=Ta.transparency&&(Sa=
Ta.drawingInfo||{},null==Sa.transparency&&(Sa.transparency=Ta.transparency,Ta.drawingInfo=Sa));Ta&&Ta.source&&Ta.drawingInfo&&(La=new yb(Ta.drawingInfo),Ea[Fa.id]=La)},this);0<sa.length&&fa.setLayerDefinitions(sa);0<na.length?(fa.setDynamicLayerInfos(na,!0),0<Ea.length&&fa.setLayerDrawingOptions(Ea,!0)):(la=xa(fa.layerInfos,la),fa.setVisibleLayers(la))}else la=xa(fa.layerInfos,la),fa.setVisibleLayers(la);oa.ignorePopups||ha(fa,D,pa,oa);return fa}function ya(D,pa,oa){var fa=new ub;fa.bandIds=D.bandIds;
null!=D.format&&(fa.format=D.format,null!=D.compressionQuality&&(fa.compressionQuality=D.compressionQuality));if(D.renderingRule&&D.renderingRule.rasterFunction){var la=new Cb(D.renderingRule);fa.renderingRule=la}D.mosaicRule&&(la=new zb(D.mosaicRule),fa.mosaicRule=la);a.isDefined(D.noData)&&(fa.noData=D.noData);a.isDefined(D.noDataInterpretation)&&(fa.noDataInterpretation=D.noDataInterpretation);a.isDefined(D.interpolation)&&(fa.interpolation=D.interpolation);la=D.layerType?"ArcGISImageServiceVectorLayer"===
D.layerType:!1;a.isDefined(D.layerType)||(la=D.resourceInfo.hasMultidimensions&&("esriImageServiceDataTypeVector-UV"===D.resourceInfo.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===D.resourceInfo.serviceDataType));fa={resourceInfo:D.resourceInfo,opacity:D.opacity,visible:D.visibility,id:D.id,imageServiceParameters:fa,minScale:D.minScale,maxScale:D.maxScale,refreshInterval:D.refreshInterval};fa=la?new hb(ea(D.url),fa):new jb(ea(D.url),fa);D.layerDefinition&&(D.layerDefinition.drawingInfo&&
D.layerDefinition.drawingInfo.renderer&&(la=t.fromJson(D.layerDefinition.drawingInfo.renderer),fa.setRenderer(la)),D.layerDefinition.definitionExpression&&fa.setDefinitionExpression(D.layerDefinition.definitionExpression,!0));oa.ignorePopups||!D.popupInfo||D.disablePopup||fa.setInfoTemplate(new pa(D.popupInfo));return fa}function Ja(D,pa,oa){var fa=[102113,102100,3857],la=oa||new d(pa[0].layerObject.fullExtent.spatialReference),wa=new d(D.resourceInfo.fullExtent.spatialReference);return la.wkt==wa.wkt&&
(la.wkid==wa.wkid||a.isDefined(la.latestWkid)&&la.latestWkid==wa.wkid||a.isDefined(wa.latestWkid)&&la.wkid==wa.latestWkid||a.isDefined(la.latestWkid)&&la.latestWkid==wa.latestWkid)||la.wkid&&wa.wkid&&q.some(fa,function(sa){return sa===wa.wkid})&&q.some(fa,function(sa){return sa===la.wkid})?!0:!1}function Qa(D,pa,oa){if(!pa[0].layerObject.tileInfo)return!1;D=D.resourceInfo.tileInfo;pa=pa[0].layerObject.tileInfo;oa=oa.width>oa.height?oa.width:oa.height;for(var fa=!1,la=!1,wa=0;wa<D.lods.length;wa++){for(var sa=
D.lods[wa].scale/D.dpi,na=0;na<pa.lods.length;na++){var za=pa.lods[na].scale/pa.dpi;if(Math.abs(za-sa)/za<1/oa)if(fa){la=!0;break}else fa=!0}if(la)break}return la||fa&&(1===D.lods.length||1===pa.lods.length)?!0:!1}function Ma(D,pa,oa,fa,la,wa){var sa=oa._clazz;if(Z(D))var na=new Ab({id:D.id,opacity:D.opacity,visible:null!==D.visibility&&void 0!==D.visibility?D.visibility:!0});else if(D&&("WFS"===D.layerType||"WFS"===D.type)){var za={customParameters:D.wfsInfo.customParameters,geometryType:D.layerDefinition.geometryType,
id:D.id,labelingInfo:D.layerDefinition.drawingInfo.labelingInfo,maxFeatures:D.wfsInfo.maxFeatures,mode:D.mode,name:D.wfsInfo.name,showLabels:!0,swapXY:D.wfsInfo.swapXY,title:D.title,url:D.url,version:D.wfsInfo.version,visible:D.visibility,wkid:D.layerDefinition.spatialReference.wkid};na=new Fb;na.fromJson(za,function(){a.isDefined(D.opacity)&&na.setOpacity(D.opacity);a.isDefined(D.visibility)&&na.setVisibility(D.visibility);(D.minScale||D.maxScale)&&na.setScaleRange(D.minScale,D.maxScale);na.renderer=
t.fromJson(D.layerDefinition.drawingInfo.renderer,{geometryType:za.geometryType});!oa.ignorePopups&&D.popupInfo&&na.setInfoTemplate(new sa(D.popupInfo));na.emit("fromJsonComplete")})}else if(D&&("WMS"===D.layerType||"WMS"===D.type)){var Ea=[],La=[];q.forEach(D.layers,function(Sa){La.push(new Gb({name:Sa.name,title:Sa.title,legendURL:Sa.legendURL||Sa.legendUrl,queryable:Sa.queryable,showPopup:Sa.showPopup}));Ea.push(Sa.name)},this);D.visibleLayers&&(Ea=D.visibleLayers);fa=new u(D.extent[0][0],D.extent[0][1],
D.extent[1][0],D.extent[1][1],new d({wkid:4326}));fa={customLayerParameters:D.customLayerParameters,customParameters:D.customParameters,extent:fa,layerInfos:La,version:D.version,maxWidth:D.maxWidth,maxHeight:D.maxHeight,featureInfoFormat:D.featureInfoFormat,getFeatureInfoURL:D.featureInfoUrl,getMapURL:D.mapUrl,spatialReferences:D.spatialReferences,title:D.title,copyright:D.copyright,minScale:D.minScale||0,maxScale:D.maxScale||0,format:D.format};na=new Hb(D.url,{id:D.id,visibleLayers:Ea,format:"png",
transparent:D.firstLayer?!1:!0,opacity:D.opacity,visible:null!==D.visibility?D.visibility:!0,resourceInfo:fa,refreshInterval:D.refreshInterval});na.spatialReference.wkid=fa.spatialReferences[0]}else if(D&&("KML"===D.layerType||"KML"===D.type)){var Ua=D.url;if(f.id){var Fa=f.id.findCredential(y.urlToObject(rb.arcgisUrl).path);Fa&&(pa=rb.arcgisUrl.substring(rb.arcgisUrl.indexOf("//")+2,rb.arcgisUrl.indexOf("/",rb.arcgisUrl.indexOf("//")+3)),la=pa.split("."),la=la[la.length-2]+"."+la[la.length-1],wa=
Ua.indexOf(la),-1<wa&&(Ua="https://"+pa+Ua.substring(wa+la.length),Ua+="?token\x3d"+Fa.token))}na=new Bb(Ua,{id:D.id,visible:null!==D.visibility?D.visibility:!0,outSR:fa,refreshInterval:D.refreshInterval});K.connect(na,"onLoad",function(){(D.opacity||0===D.opacity)&&na.setOpacity(D.opacity);a.isDefined(D.minScale)&&a.isDefined(D.maxScale)&&na.setScaleRange(D.minScale,D.maxScale);D.visibleFolders&&q.forEach(na.folders,function(Sa){-1<q.indexOf(D.visibleFolders,Sa.id)?na.setFolderVisibility(Sa,!0):
na.setFolderVisibility(Sa,!1)},this)})}else if(!D||"WebTiledLayer"!==D.layerType&&"WebTiledLayer"!==D.type)if(!D||"GeoRSS"!==D.layerType&&"GeoRSS"!==D.type)if(D&&("CSV"===D.layerType||"CSV"===D.type)&&D.url)fa={layerDefinition:D.layerDefinition,columnDelimiter:D.columnDelimiter,id:D.id?D.id:null,visible:null!==D.visibility?D.visibility:!0,opacity:D.opacity,refreshInterval:D.refreshInterval},D.locationInfo&&(fa.latitudeFieldName=D.locationInfo.latitudeFieldName,fa.longitudeFieldName=D.locationInfo.longitudeFieldName),
!oa.ignorePopups&&D.popupInfo&&(fa.infoTemplate=new sa(D.popupInfo)),na=new cb(D.url,fa);else if("VectorTileLayer"!==D.layerType||!D.styleUrl||D.resourceInfo&&D.resourceInfo instanceof Error)if(D.layerDefinition&&!D.url)fa=w.fromJson(w.toJson(D)),delete fa.id,delete fa.opacity,delete fa.visibility,na=new W(fa,{id:D.id,opacity:D.opacity,visible:D.visibility,outFields:["*"],autoGeneralize:!0}),oa.ignorePopups||!fa.popupInfo||fa.disablePopup||na.setInfoTemplate(new sa(fa.popupInfo)),fb(na);else if(T(D))oa.bingMapsKey?
(fa=tb.MAP_STYLE_AERIAL_WITH_LABELS,R(D)?fa=tb.MAP_STYLE_AERIAL:S(D)&&(fa=tb.MAP_STYLE_ROAD),na=new tb({bingMapsKey:oa.bingMapsKey,mapStyle:fa,opacity:D.opacity,id:D.id}),K.connect(na,"onError",J.hitch(this,function(Sa){Sa.errors=Sa.errors||[];Sa.errors.push({message:"This application does not have a valid Bing Key for the Bing layer that is included in this map. [type:"+(Sa?Sa.layerType||Sa.type:"")+"]"})},D))):(D.errors=D.errors||[],D.errors.push({message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+
(D?D.layerType||D.type:"")+"]"}));else if(D.resourceInfo&&(D.resourceInfo.mapName||""===D.resourceInfo.mapName))na=!0===D.resourceInfo.singleFusedMapCache&&(D.baseMapLayer||Ja(D,pa,fa)&&Qa(D,la,wa))?va(D,sa,oa):Da(D,sa,oa);else if(D.resourceInfo&&D.resourceInfo.pixelSizeX)na=!0===D.resourceInfo.singleFusedMapCache&&"ArcGISImageServiceLayer"!==D.layerType&&(D.baseMapLayer||"Raster"===D.resourceInfo.cacheType||Ja(D,pa,fa)&&Qa(D,la,wa))?va(D,sa,oa):ya(D,sa,oa);else if(D.resourceInfo&&"Feature Layer"===
D.resourceInfo.type){D.capabilities&&(D.resourceInfo.capabilities=D.capabilities);var Ta;!1===oa.editable?Ta=!1:oa.privileges&&-1===q.indexOf(oa.privileges,"features:user:edit")&&f.id&&f.id.findCredential(D.url)&&(Ta=!1);na=new W(ea(D.url),{resourceInfo:D.resourceInfo,opacity:D.opacity,visible:D.visibility,id:D.id,mode:D.mode===W.MODE_SELECTION?W.MODE_SELECTION:W.MODE_AUTO,editable:Ta,outFields:["*"],autoGeneralize:!0,refreshInterval:D.refreshInterval});oa.ignorePopups||!D.popupInfo||D.disablePopup||
na.setInfoTemplate(new sa(D.popupInfo));D.layerDefinition&&(D.layerDefinition.drawingInfo&&D.layerDefinition.drawingInfo.renderer&&(fa=t.fromJson(D.layerDefinition.drawingInfo.renderer,{geometryType:na.geometryType}),fa.isMaxInclusive=!0,na.setRenderer(fa)),D.layerDefinition.drawingInfo&&D.layerDefinition.drawingInfo.labelingInfo&&(fa=q.map(D.layerDefinition.drawingInfo.labelingInfo,function(Sa){return new vb(Sa)}),na.setLabelingInfo(fa)),D.layerDefinition.definitionExpression&&na.setDefinitionExpression(D.layerDefinition.definitionExpression),
a.isDefined(D.layerDefinition.minScale)&&na.setMinScale(D.layerDefinition.minScale),a.isDefined(D.layerDefinition.maxScale)&&na.setMaxScale(D.layerDefinition.maxScale));fb(na)}else D.resourceInfo&&D.resourceInfo.streamUrls&&(fa={resourceInfo:D.resourceInfo,opacity:D.opacity,visible:D.visibility,id:D.id},D.layerDefinition&&(Ua=D.layerDefinition.drawingInfo,D.layerDefinition.definitionGeometry&&(Fa=Fa||{},Fa.geometry=D.layerDefinition.definitionGeometry),a.isDefined(D.layerDefinition.definitionExpression)&&
(Fa=Fa||{},Fa.where=D.layerDefinition.definitionExpression),a.isDefined(D.layerDefinition.maximumTrackPoints)&&(fa.maximumTrackPoints=D.layerDefinition.maximumTrackPoints)),Fa&&(fa.filter=Fa),D.purgeOptions&&(fa.purgeOptions=D.purgeOptions),na=new gb(ea(D.url),fa),Ua&&Ua.renderer&&(fa=Ua.renderer,na.setRenderer(t.fromJson(fa,{geometryType:D.resourceInfo.geometryType}))),Ua&&Ua.labelingInfo&&(fa=q.map(Ua.labelingInfo,function(Sa){return new vb(Sa)}),na.setLabelingInfo(fa)),oa.ignorePopups||!D.popupInfo||
D.disablePopup||na.setInfoTemplate(new sa(D.popupInfo)),D.layerDefinition&&(a.isDefined(D.layerDefinition.minScale)&&na.setMinScale(D.layerDefinition.minScale),a.isDefined(D.layerDefinition.maxScale)&&na.setMaxScale(D.layerDefinition.maxScale)),A.once(na,"error",function(Sa){D.errors.push({message:"Error loading stream layer. Check websocket url"})}));else na=new mb(D.styleUrl,{id:D.id,minScale:D.minScale,maxScale:D.maxScale,opacity:D.opacity,visible:D.visibility,resourceInfo:D.resourceInfo});else na=
new nb(D.url,{id:D.id,opacity:D.opacity,outSpatialReference:fa,refreshInterval:D.refreshInterval}),K.connect(na,"onLoad",function(){!1===D.visibility&&na.hide();a.isDefined(D.minScale)&&a.isDefined(D.maxScale)&&na.setScaleRange(D.minScale,D.maxScale);var Sa=na.getFeatureLayers();q.forEach(Sa,function(db){D.pointSymbol&&"esriGeometryPoint"===db.geometryType?(db.renderer.symbol=v.fromJson(D.pointSymbol),1===Sa.length&&(na.pointSymbol=v.fromJson(D.pointSymbol))):D.lineSymbol&&"esriGeometryPolyline"===
db.geometryType?(db.renderer.symbol=v.fromJson(D.lineSymbol),1===Sa.length&&(na.polylineSymbol=v.fromJson(D.lineSymbol))):D.polygonSymbol&&"esriGeometryPolygon"===db.geometryType&&(db.renderer.symbol=v.fromJson(D.polygonSymbol),1===Sa.length&&(na.polygonSymbol=v.fromJson(D.polygonSymbol)))})});else if(na=new Ib(D.templateUrl,{id:D.id,visible:null!==D.visibility?D.visibility:!0,opacity:D.opacity,copyright:D.copyright,fullExtent:D.fullExtent&&new u(D.fullExtent),initialExtent:D.fullExtent&&new u(D.fullExtent),
subDomains:D.subDomains,tileInfo:D.tileInfo?new lb(D.tileInfo):null,refreshInterval:D.refreshInterval,wmtsInfo:D.wmtsInfo}),a.isDefined(D.minScale)||a.isDefined(D.maxScale))na.loaded?na.setScaleRange(D.minScale,D.maxScale):K.connect(na,"onLoad",function(){na.setScaleRange(D.minScale,D.maxScale)});na&&(na.arcgisProps={title:D.title},D.baseMapLayer&&(D.isReference?(na.attr("data-reference",!0),na._basemapGalleryLayerType="reference"):na._basemapGalleryLayerType="basemap"),na instanceof W&&D.layerDefinition&&
D.layerDefinition.featureReduction&&"cluster"===D.layerDefinition.featureReduction.type&&(fa=D.layerDefinition.featureReduction,fa.clusterSize&&(fa.clusterSize=l.pt2px(fa.clusterSize)),fa.clusterRadius&&(fa.clusterRadius=l.pt2px(fa.clusterRadius)),fa.popupInfo&&(fa.infoTemplate=new F(fa.popupInfo),delete fa.popupInfo),na.setFeatureReduction(fa)));return na}function Na(D,pa,oa,fa,la){q.forEach(D,function(na){na.layerObject=Ma(na,D,pa,oa,fa,la)});var wa=q.filter(D,function(na){return!na.isReference}),
sa=q.filter(D,function(na){return!!na.isReference});return D=wa.concat(sa)}function Xa(D){var pa=null;D=D[0];D.url&&qa(D)&&D.resourceInfo.spatialReference&&(pa=new d,D.resourceInfo.spatialReference.wkid&&(pa.wkid=D.resourceInfo.spatialReference.wkid),D.resourceInfo.spatialReference.wkt&&(pa.wkt=D.resourceInfo.spatialReference.wkt));T(D)||Z(D)?pa=new d({wkid:102100}):D&&("WMS"===D.layerType||"WMS"===D.type)&&(pa=new d({wkid:D.spatialReferences[0]}));return pa}function bb(D,pa,oa,fa,la,wa,sa,na){q.forEach(pa,
function(za){if(qa(za)||za&&"VectorTileLayer"===za.layerType)za.resourceInfo=D[za.deferredsPos][1],delete za.deferredsPos});wa=wa||Xa(pa);pa=Na(pa,oa,wa,sa,na);la.callback(pa);return la}function fb(D){!window.CanvasRenderingContext2D&&D.renderer&&"esri.renderer.HeatmapRenderer"===D.renderer.declaredClass&&D.setRenderer(t.fromJson({type:"simple",symbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",
style:"esriSLSSolid"}}}))}function Pa(D,pa,oa){D.message=D.message?D.message+(" [url:"+pa+"]"):"[url:"+pa+"]";oa.push(D);b.defaults.io.errorHandler(D)}function r(D,pa){var oa=ea(D);return e({url:oa,content:{f:"json"},callbackParamName:"callback",error:function(fa,la){Pa(fa,oa,pa)}})}function N(D){var pa=rb.arcgisUrl+"/"+D.itemId+"/data";return e({url:pa,content:{f:"json"},callbackParamName:"callback",error:function(oa,fa){D.errors=D.errors||[];Pa(oa,pa,D.errors)}})}function X(D,pa){return xb.loadMetadata(D).otherwise(function(oa){Pa(oa,
D,pa);return oa})}function ca(D,pa,oa){var fa=new E;if(!(oa.featureCollection&&oa.featureCollection.layers||oa.layers))return console.log("Invalid Feature Collection item data [item id: "+D.itemId+"]: ",oa),D.errors=D.errors||[],D.errors.push({message:"Invalid Feature Collection item data. [item id: "+D.itemId+"]"}),fa.errback(),fa;oa.layers&&(oa.featureCollection={layers:oa.layers},delete oa.layers,a.isDefined(oa.showLegend)&&(oa.featureCollection.showLegend=oa.showLegend,delete oa.showLegend));
ka(D,oa.featureCollection,pa).then(function(la){oa.featureCollection=la;D.featureCollection&&D.featureCollection.layers?q.forEach(oa.featureCollection.layers,function(wa,sa){sa=D.featureCollection.layers[sa];sa.popupInfo||sa.layerDefinition?sa.layerDefinition?(a.isDefined(sa.layerDefinition.minScale)&&a.isDefined(sa.layerDefinition.maxScale)&&(sa.layerDefinition.minScale!==wa.layerDefinition.minScale||sa.layerDefinition.maxScale!==wa.layerDefinition.maxScale)&&(delete wa.layerDefinition.minScale,
delete wa.layerDefinition.maxScale),sa.layerDefinition.drawingInfo&&w.toJson(sa.layerDefinition.drawingInfo)!==w.toJson(wa.layerDefinition.drawingInfo)&&delete wa.layerDefinition.drawingInfo,sa.layerDefinition.showLegend!==wa.layerDefinition.showLegend&&delete wa.layerDefinition.showLegend,sa.layerDefinition=J.mixin(sa.layerDefinition,wa.layerDefinition)):sa.layerDefinition=wa.layerDefinition:(sa.popupInfo=wa.popupInfo,sa.layerDefinition=wa.layerDefinition);sa.featureSet=wa.featureSet;sa.nextObjectId=
wa.nextObjectId}):(D.featureCollection=D.featureCollection||{},D.featureCollection=J.mixin(D.featureCollection,oa.featureCollection));fa.callback(D)});return fa}function ka(D,pa,oa){var fa=new E;L(["./csv"],function(la){var wa=[];q.forEach(pa.layers,function(sa){sa.featureSet&&sa.featureSet.features&&sa.featureSet.features.length&&sa.featureSet.features[0].geometry&&sa.featureSet.features[0].geometry.spatialReference&&(sa.deferredsPos=wa.length,wa.push(la.projectFeatureCollection(sa,oa,sa.featureSet.features[0].geometry.spatialReference)))});
(new n(wa)).addCallback(function(){q.forEach(pa.layers,function(sa){a.isDefined(sa.deferredsPos)&&(wa[sa.deferredsPos].results&&wa[sa.deferredsPos].results.length?sa=wa[sa.deferredsPos].results[0]:(console.log("Errors projecting feature collection. ["+D.title+" - "+sa.layerDefinition.name+"]"),sa.errors=sa.errors||[],sa.errors.push({message:"Errors projecting feature collection. ["+D.title+" - "+sa.layerDefinition.name+"]"})),delete sa.deferredsPos)});fa.callback(pa)})});return fa}function ra(D,pa,
oa,fa,la){var wa=new E,sa=new E,na=[];q.forEach(D.operationalLayers,function(Ea){Ea.itemId&&"Feature Collection"==Ea.type&&na.push(N(Ea).then(J.hitch(null,ca,Ea,oa)))});if(0===na.length)k(D,pa,oa,fa,sa,la);else{var za=new n(na);za.addCallback(function(Ea){k(D,pa,oa,fa,sa,la)})}sa.then(function(Ea){na=[];q.forEach(Ea,function(Ua){Ua=Ua.layerObject;if(Ua instanceof W&&!Ua.loaded&&!Ua.loadError){var Fa=new E;A.once(Ua,"load, error",function(){Fa.callback(Ua)});na.push(Fa)}else Ua&&"esri.layers.WFSLayer"===
Ua.declaredClass&&!Ua.loadError&&(Fa=new E,A.once(Ua,"fromJsonComplete, error",function(Ta){Fa.callback(Ua)}),na.push(Fa))});if(na.length){var La=new E;za=new n(na);za.addCallback(function(){La.callback(Ea)});return La.promise}return Ea}).then(function(Ea){var La=[];q.forEach(Ea,function(Ua){var Fa=Ua.layerObject;Fa&&(Fa instanceof W||"esri.layers.StreamLayer"===Fa.declaredClass)?Fa.loaded&&Fa.labelingInfo&&(Ua.showLabels||Fa._collection?La.push(Fa):Fa.setShowLabels&&Fa.setShowLabels(!1)):Fa&&"esri.layers.WFSLayer"===
Fa.declaredClass&&Fa.loaded&&Fa.labelingInfo&&La.push(Fa)});La.length?L(["../layers/LabelLayer"],function(Ua){var Fa=new Ua;q.forEach(La,function(Ta){Fa.addFeatureLayer(Ta)});Ea.push({layerObject:Fa});wa.callback(Ea)}):wa.callback(Ea)});return wa}function k(D,pa,oa,fa,la,wa){var sa=[],na=[],za=[];q.forEach(D.operationalLayers,function(Ea,La){if(Ea.featureCollection&&Ea.featureCollection.layers){var Ua=Ea.featureCollection.layers.length;q.forEach(Ea.featureCollection.layers,function(Fa,Ta){var Sa=
!0;Ea.visibleLayers&&-1==q.indexOf(Ea.visibleLayers,Ta)&&(Sa=!1);Fa.visibility=(null!=Ea.visibility?!!Ea.visibility:!0)&&Sa;Fa.opacity=Ea.opacity;Fa.id=(Ea.id||"operational"+La)+"_"+Ta;Ea.title&&(Fa.title=1!==Ua&&Fa.layerDefinition.name&&Ea.title!==Fa.layerDefinition.name?Ea.title+" - "+Fa.layerDefinition.name:Ea.title);null==Fa.disablePopup&&(Fa.disablePopup=Ea.disablePopup);za.push(Fa)},this)}else za.push(Ea)});q.forEach(D.baseMap.baseMapLayers,function(Ea,La){Ea.baseMapLayer=!0;Ea.id=Ea.id||"base"+
La;sa.push(Ea)});q.forEach(za,function(Ea,La){Ea.id=Ea.id||"operational"+La;sa.push(Ea)});q.forEach(sa,function(Ea){if(qa(Ea)||Ea&&"VectorTileLayer"===Ea.layerType)Ea.deferredsPos=na.length,Ea.errors=Ea.errors||[],Ea.url?na.push(r(Ea.url,Ea.errors)):na.push(X(Ea.styleUrl,Ea.errors))});0===na.length?(oa=oa||Xa(sa),sa=Na(sa,pa,oa,fa,wa),la.callback(sa)):(new n(na)).addCallback(function(Ea){bb(Ea,sa,pa,na,la,oa,fa,wa)});return la}function z(D,pa,oa,fa){var la=D.minScale,wa=D.maxScale;if(10.1>=oa.version&&
pa)for(D=pa.length-1;0<=D;D--){if(pa[D].id==fa)if(0==la&&0<pa[D].minScale?la=pa[D].minScale:0<la&&0==pa[D].minScale?la=oa.minScale:0<la&&0<pa[D].minScale&&(la=Math.min(la,pa[D].minScale)),wa=Math.max(oa.maxScale||0,pa[D].maxScale||0),oa.setScaleRange(la,wa),-1<pa[D].parentLayerId)fa=pa[D].parentLayerId;else break}else 10.1<oa.version&&(q.forEach(D.layerInfos,function(sa){sa.id==fa&&(0==la&&0<sa.minScale?la=sa.minScale:0<la&&0==sa.minScale||0<la&&0<sa.minScale&&(la=Math.min(la,sa.minScale)),wa=Math.max(wa||
0,sa.maxScale||0))}),oa.setScaleRange(la,wa))}function P(D,pa,oa,fa){var la=D.url,wa=D.__popupIds,sa=D.__popupUrls,na=D.__popupWhereClauses,za=D.__popupMinScales,Ea=D.__popupMaxScales,La=D.__resourceInfo,Ua=[];q.forEach(D.__popups,function(Fa,Ta){if(Fa){var Sa=[];q.forEach(Fa.fieldInfos,function(pb){"shape"!==pb.fieldName.toLowerCase()&&Sa.push(pb.fieldName)});if(D.dynamicLayerInfos&&0<D.dynamicLayerInfos.length){var db=q.filter(D.dynamicLayerInfos,function(pb){return wa[Ta]==pb.id})[0].source;var sb=
new W(la+"/dynamicLayer",{parentLayer:D,id:D.id+"_"+wa[Ta],source:db,outFields:Sa,mode:W.MODE_SELECTION,infoTemplate:Fa&&new oa(Fa),drawMode:!1,visible:D.visible,autoGeneralize:!0});var Jb=function(pb,Db){0<na[pb].length&&Db.setDefinitionExpression(na[pb]);if(a.isDefined(za[pb])||a.isDefined(Ea[pb]))if(a.isDefined(D.minScale)||a.isDefined(D.maxScale)){var wb=D.minScale,Eb=D.maxScale;0==wb&&0<za[pb]?wb=za[pb]:0<wb&&0==za[pb]||0<wb&&0<za[pb]&&(wb=Math.min(wb,za[pb]));Eb=Math.max(Eb||0,Ea[pb]||0);Db.setScaleRange(wb,
Eb)}else Db.setScaleRange(za[pb],Ea[pb]);else z(D,pa||La.layers,Db,wa[pb])};sb.loaded?Jb(Ta,sb):K.connect(sb,"onLoad",function(pb){Jb(Ta,sb)})}else{var Kb=null,Lb=la+"/"+wa[Ta];if(sa[Ta].length)Lb=sa[Ta];else if(pa)for(db=0;db<pa.length;db++)if(pa[db].id===wa[Ta]){Kb=pa[db];break}sb=new W(ea(Lb),{parentLayer:D,id:D.id+"_"+wa[Ta],outFields:Sa,mode:W.MODE_SELECTION,infoTemplate:Fa&&new oa(Fa),drawMode:!1,visible:D.visible,resourceInfo:Kb,autoGeneralize:!0});sb.loaded?(0<na[Ta].length&&sb.setDefinitionExpression(na[Ta]),
z(D,pa||La.layers,sb,wa[Ta])):K.connect(sb,"onLoad",function(pb){0<na[Ta].length&&sb.setDefinitionExpression(na[Ta]);z(D,pa||La.layers,pb,wa[Ta])})}Ua.push(sb)}});0<Ua.length&&(K.connect(D,"onVisibilityChange",J.hitch(this,function(Fa,Ta){q.forEach(Fa,function(Sa){Ta?Sa.show():Sa.hide()})},Ua)),K.connect(fa,"onLayerRemove",J.hitch(this,function(Fa,Ta,Sa){Fa.id===Sa.id&&q.forEach(Ta,function(db){fa.removeLayer(db)})},D,Ua)));delete D.__popups;delete D.__popupIds;delete D.__popupUrls;delete D.__popupWhereClauses;
delete D.__popupMinScales;delete D.__popupMaxScales;delete D.__resourceInfo;return Ua}function V(D){return e({url:ea(D.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}})}function U(D,pa,oa){var fa=[];q.forEach(D,function(wa){var sa=wa.__popups;sa&&1<sa.length&&10<=wa.version&&(wa.__deferredsPos=fa.length,fa.push(V(wa)))});var la=[];0<fa.length?(new n(fa)).addCallback(function(wa){q.forEach(D,function(sa){sa.__popups&&0<sa.__popups.length&&(sa.__deferredsPos||0===sa.__deferredsPos?
(la=la.concat(P(sa,wa[sa.__deferredsPos][1].layers,oa,pa)),delete sa.__deferredsPos):la=la.concat(P(sa,null,oa,pa)))});pa.addLayers(la)}):(q.forEach(D,function(wa){wa.__popups&&0<wa.__popups.length&&(la=la.concat(P(wa,null,oa,pa)))}),pa.addLayers(la))}function aa(D){q.forEach(D,function(pa){var oa=pa.layer;oa.toJson&&(pa=oa.toJson(),pa.featureSet&&oa.name&&-1<oa.name.indexOf("Text")&&q.forEach(pa.featureSet.features,function(fa,la){fa.attributes.TEXT&&(la=oa.graphics[la],la.symbol.setText(fa.attributes.TEXT),
fa.symbol.horizontalAlignment&&(la.symbol.align=fa.symbol.horizontalAlignment),la.setSymbol(la.symbol),la.setAttributes(fa.attributes))},this))})}function da(D){var pa=6;q.forEach(D,function(oa){if(oa=oa.renderer)"esri.renderer.SimpleRenderer"===oa.declaredClass?((oa=oa.symbol)&&oa.xoffset&&(pa=Math.max(pa,Math.abs(oa.xoffset))),oa&&oa.yoffset&&(pa=Math.max(pa,Math.abs(oa.yoffset)))):"esri.renderer.UniqueValueRenderer"!==oa.declaredClass&&"esri.renderer.ClassBreaksRenderer"!==oa.declaredClass||q.forEach(oa.infos,
function(fa){(fa=fa.symbol)&&fa.xoffset&&(pa=Math.max(pa,Math.abs(fa.xoffset)));fa&&fa.yoffset&&(pa=Math.max(pa,Math.abs(fa.yoffset)))})});return pa}function ja(D){var pa=this,oa=pa.infoWindow,fa=D.graphic;if(pa.loaded){oa.hide();oa.clearFeatures();var la=[];q.forEach(pa.graphicsLayerIds,function(Fa){(Fa=pa.getLayer(Fa))&&Fa instanceof W&&Fa.loaded&&Fa.visible&&(Fa.clearSelection(),Fa.infoTemplate&&!Fa.suspended&&la.push(Fa))});q.forEach(pa.layerIds,function(Fa){(Fa=pa.getLayer(Fa))&&(-1!==Fa.declaredClass.indexOf("ArcGISImageServiceLayer")||
-1!==Fa.declaredClass.indexOf("RasterXLayer"))&&Fa.loaded&&Fa.visible&&Fa.infoTemplate&&la.push(Fa)});fa=fa&&fa.getInfoTemplate()?fa:null;if(la.length||fa){var wa=da(la),sa=D.screenPoint,na=pa.toMap(new H(sa.x-wa,sa.y+wa));wa=pa.toMap(new H(sa.x+wa,sa.y-wa));var za=new u(na.x,na.y,wa.x,wa.y,pa.spatialReference),Ea=new O;Ea.geometry=za;Ea.timeExtent=pa.timeExtent;var La=!0;na=q.map(la,function(Fa){Fa=Fa&&Fa.isFeatureReductionActive&&Fa.isFeatureReductionActive()?Fa.getFeatureReductionLayer():Fa;if(-1!==
Fa.declaredClass.indexOf("ArcGISImageServiceLayer")){Ea.geometry=D.mapPoint;La=!1;var Ta=Fa.queryVisibleRasters(Ea,{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0});Ta.addCallback(function(){return Fa.getVisibleRasters()})}else if(-1!==Fa.declaredClass.indexOf("RasterXLayer"))Ta=Fa.fetchPopupFromTiles({geometry:D.mapPoint});else if("function"===typeof Fa.selectFeatures)Ta=Fa.selectFeatures(Ea),Ta.addCallback(function(){return Fa.getSelectedFeatures()});else{Ta=new E;var Sa=q.filter(Fa.graphics,
function(db){return db&&db.visible&&za.intersects(db.geometry)});Ta.resolve(Sa)}return Ta});fa&&(wa=new E,wa.callback([fa]),na.splice(0,0,wa));if(!q.some(na,function(Fa){return-1===Fa.fired})){var Ua=fa?1:0;q.forEach(la,function(Fa){Ua=-1!==Fa.declaredClass.indexOf("ArcGISImageServiceLayer")?Ua+Fa.getVisibleRasters().length:-1!==Fa.declaredClass.indexOf("RasterXLayer")?Ua+Fa.getPopupFromTiles().length:Ua+Fa.getSelectedFeatures().length});if(!Ua)return}oa.setFeatures(na);oa.show(D.mapPoint,{closestFirst:La})}}}
function ma(D,pa){var oa=pa.mapOptions||{};if(!oa.infoWindow){var fa=new B({visibleWhenEmpty:!1},g.create("div"));oa.infoWindow=fa}a.isDefined(oa.showInfoWindowOnClick)||pa.usePopupManager||(oa.showInfoWindowOnClick=!1);D=new h(D,oa);K.connect(D,"onLayersAddResult",aa);return D}function Aa(D,pa,oa,fa,la,wa){if(fa.map){var sa=fa.map;var na=fa.clickEventHandle;var za=fa.clickEventListener;var Ea=fa.errors}else{var La=oa.itemData;!la.mapOptions.backgroundColor&&La.background&&La.background.color&&null!=
La.background.color[0]&&(la.mapOptions.backgroundColor=c.toDojoColor(La.background.color));sa=ma(fa,la);la.ignorePopups||la.disableClickBehavior||la.usePopupManager||(na=K.connect(sa,"onClick",ja),za=ja)}sa.addLayers(D);la.ignorePopups||la.usePopupManager||U(D,sa,la._clazz);var Ua=Ea||[];q.forEach(pa,function(Fa){Fa.errors&&(Ua=Ua.concat(Fa.errors))},this);sa.loaded?wa.callback({map:sa,itemInfo:oa,errors:Ua,clickEventHandle:na,clickEventListener:za}):K.connect(sa,"onLoad",function(){wa.callback({map:sa,
itemInfo:oa,errors:Ua,clickEventHandle:na,clickEventListener:za})})}function Ca(D,pa,oa,fa,la){var wa=[];q.forEach(la,function(za){J.isArray(za.layerObject)?q.forEach(za.layerObject,function(Ea){wa.push(Ea)}):wa.push(za.layerObject)});if(T(la[0]))var sa=setInterval(function(){if(la[0].layerObject&&la[0].layerObject.loaded)clearInterval(sa),Ha(D,pa,oa,fa,la,wa);else if(la[0].errors){clearInterval(sa);var za="";la[0].errors&&la[0].errors.length&&(za=" ("+la[0].errors[0].message+")");fa.errback(Error(Y.arcgis.utils.baseLayerError+
za))}},10);else if(!wa[0]&&la[0].baseMapLayer){var na="";la[0].errors&&la[0].errors.length&&(na=" ("+la[0].errors[0].message+")");fa.errback(Error(Y.arcgis.utils.baseLayerError+na))}else Ha(D,pa,oa,fa,la,wa)}function Ha(D,pa,oa,fa,la,wa){try{var sa=oa.mapOptions||{};oa.mapOptions=sa;wa=q.filter(wa,a.isDefined);if(pa.map||sa.extent)Aa(wa,la,D,pa,oa,fa);else{var na=wa[0].spatialReference;if(sa.center&&(null!=sa.zoom||sa.scale)&&(J.isArray(sa.center)&&(sa.center=new I(sa.center)),G.canProject(sa.center,
na))){Aa(wa,la,D,pa,oa,fa);return}var za=D.item;if(za&&za.extent&&za.extent.length){var Ea=new u(za.extent[0][0],za.extent[0][1],za.extent[1][0],za.extent[1][1],new d({wkid:4326}));4326===na.wkid?(sa.extent=Ea,Aa(wa,la,D,pa,oa,fa)):900913===na.wkid||102100===na.wkid||102113===na.wkid||3857===na.wkid?(Ea.xmin=Math.max(Ea.xmin,-180),Ea.xmax=Math.min(Ea.xmax,180),Ea.ymin=Math.max(Ea.ymin,-89.99),Ea.ymax=Math.min(Ea.ymax,89.99),sa.extent=G.geographicToWebMercator(Ea),Aa(wa,la,D,pa,oa,fa)):oa.geometryServiceURL||
b.defaults.geometryService?(oa.geometryServiceURL?new M(oa.geometryServiceURL):b.defaults.geometryService).project([Ea],na,function(La){La=La[0];sa.extent=sa.extent||La;Aa(wa,la,D,pa,oa,fa)},function(){Aa(wa,la,D,pa,oa,fa)}):fa.errback(Error(Y.arcgis.utils.geometryServiceError))}else Aa(wa,la,D,pa,oa,fa)}}catch(La){fa.errback(La)}}function Ka(D){var pa=[];q.forEach(D.operationalLayers,function(oa){oa.featureCollection?pa.push({featureCollection:oa.featureCollection,visibility:null!=oa.visibility?
!!oa.visibility:!0,title:oa.title}):oa.layerObject&&pa.push({layer:oa.layerObject,visibility:null!=oa.visibility?!!oa.visibility:!0,title:oa.title})});return pa}function Ya(D){var pa=[],oa=D.baseMap.baseMapLayers;D.operationalLayers&&(oa=oa.concat(D.operationalLayers));q.forEach(oa,function(fa){var la={};if(fa.featureCollection&&(!fa||"CSV"!==fa.layerType&&"CSV"!==fa.type))!0===fa.featureCollection.showLegend&&q.forEach(fa.featureCollection.layers,function(na){if(!1!==na.showLegend){var za=na.layerObject.renderer;
la={layer:na.layerObject,title:fa.title,defaultSymbol:za&&za.defaultSymbol&&za.defaultLabel?!0:!1};1<fa.featureCollection.layers.length&&(la.title+=" - "+na.layerDefinition.name);pa.push(la)}});else if(fa.baseMapLayer&&!0===fa.showLegend&&fa.layerObject||!fa.baseMapLayer&&!1!==fa.showLegend&&fa.layerObject&&!(fa.layerObject instanceof W&&fa.layerObject.mode===W.MODE_SELECTION)){var wa=fa.layerObject.renderer,sa=fa.layerObject.declaredClass;wa=!wa||wa&&wa.defaultSymbol&&wa.defaultLabel?!0:!1;if(10.1>
fa.layerObject.version&&("esri.layers.ArcGISDynamicMapServiceLayer"===sa||"esri.layers.ArcGISTiledMapServiceLayer"===sa)||"esri.layers.ArcGISImageServiceLayer"===sa)wa=!0;la={layer:fa.layerObject,title:fa.title,defaultSymbol:wa};fa.layers&&(sa=q.map(q.filter(fa.layers,function(na){return!1===na.showLegend}),function(na){return na.id}),sa.length&&(la.hideLayers=sa));pa.push(la)}});return pa}function Wa(D,pa){function oa(na,za){q.forEach(na,function(Ea,La){switch(Ea){case "../layers/ArcGISDynamicMapServiceLayer":kb=
za[La];break;case "../layers/ArcGISImageServiceLayer":jb=za[La];break;case "../layers/ArcGISImageServiceVectorLayer":hb=za[La];break;case "../layers/CSVLayer":cb=za[La];break;case "../layers/DynamicLayerInfo":eb=za[La];break;case "../layers/GeoRSSLayer":nb=za[La];break;case "../layers/ImageParameters":qb=za[La];break;case "../layers/ImageServiceParameters":ub=za[La];break;case "../layers/KMLLayer":Bb=za[La];break;case "../layers/LabelClass":vb=za[La];break;case "../layers/LayerDrawingOptions":yb=
za[La];break;case "../layers/MosaicRule":zb=za[La];break;case "../layers/OpenStreetMapLayer":Ab=za[La];break;case "../layers/RasterFunction":Cb=za[La];break;case "../layers/RasterXLayer":$a=za[La];break;case "../layers/StreamLayer":gb=za[La];break;case "../layers/TileInfo":lb=za[La];break;case "../layers/VectorTileLayer":mb=za[La];break;case "../layers/vectorTiles/layers/support/vectorTileLayerLoader":xb=za[La];break;case "../virtualearth/VETiledLayer":tb=za[La];break;case "../layers/WebTiledLayer":Ib=
za[La];break;case "../layers/WFSLayer":Fb=za[La];break;case "../layers/WMSLayer":Hb=za[La];break;case "../layers/WMSLayerInfo":Gb=za[La]}})}var fa=new E;D=D.itemData;pa=[];D.baseMap&&D.baseMap.baseMapLayers&&(pa=pa.concat(D.baseMap.baseMapLayers));D.operationalLayers&&(pa=pa.concat(D.operationalLayers));D=q.map(pa,function(na){return na&&na.layerType});var la=[],wa=[];pa=!1;for(var sa=0;sa<D.length;sa++){switch(D[sa]){case "ArcGISFeatureLayer":-1===q.indexOf(la,"../layers/LabelClass")&&la.push("../layers/LabelClass");
break;case "ArcGISImageServiceLayer":case "ArcGISTiledImageServiceLayer":-1===q.indexOf(la,"../layers/ArcGISImageServiceLayer")&&(la.push("../layers/ArcGISImageServiceLayer"),wa.push("../layers/ImageServiceParameters"),wa.push("../layers/MosaicRule"),wa.push("../layers/RasterFunction"),la.push("../layers/RasterXLayer"));break;case "ArcGISImageServiceVectorLayer":-1===q.indexOf(la,"../layers/ArcGISImageServiceVectorLayer")&&(la.push("../layers/ArcGISImageServiceVectorLayer"),wa.push("../layers/ImageServiceParameters"),
wa.push("../layers/MosaicRule"),wa.push("../layers/RasterFunction"));break;case "ArcGISMapServiceLayer":case "ArcGISTiledMapServiceLayer":-1===q.indexOf(la,"../layers/ArcGISDynamicMapServiceLayer")&&(la.push("../layers/ArcGISDynamicMapServiceLayer"),wa.push("../layers/DynamicLayerInfo"),wa.push("../layers/ImageParameters"),wa.push("../layers/LayerDrawingOptions"));break;case "ArcGISStreamLayer":-1===q.indexOf(la,"../layers/StreamLayer")&&la.push("../layers/StreamLayer");-1===q.indexOf(la,"../layers/LabelClass")&&
la.push("../layers/LabelClass");break;case "BingMapsAerial":case "BingMapsHybrid":case "BingMapsRoad":-1===q.indexOf(la,"../virtualearth/VETiledLayer")&&la.push("../virtualearth/VETiledLayer");break;case "CSV":-1===q.indexOf(la,"../layers/CSVLayer")&&(la.push("../layers/CSVLayer"),wa.push("./csv"));break;case "GeoRSS":-1===q.indexOf(la,"../layers/GeoRSSLayer")&&la.push("../layers/GeoRSSLayer");break;case "KML":-1===q.indexOf(la,"../layers/KMLLayer")&&la.push("../layers/KMLLayer");break;case "OpenStreetMap":-1===
q.indexOf(la,"../layers/OpenStreetMapLayer")&&la.push("../layers/OpenStreetMapLayer");break;case "VectorTileLayer":-1===q.indexOf(la,"../layers/VectorTileLayer")&&la.push("../layers/VectorTileLayer");-1===q.indexOf(wa,"../layers/vectorTiles/layers/support/vectorTileLayerLoader")&&wa.push("../layers/vectorTiles/layers/support/vectorTileLayerLoader");break;case "WebTiledLayer":-1===q.indexOf(la,"../layers/WebTiledLayer")&&(la.push("../layers/WebTiledLayer"),wa.push("../layers/TileInfo"));break;case "WFS":-1===
q.indexOf(la,"../layers/WFSLayer")&&la.push("../layers/WFSLayer");break;case "WMS":-1===q.indexOf(la,"../layers/WMSLayer")&&(la.push("../layers/WMSLayer"),wa.push("../layers/WMSLayerInfo"));break;default:pa=!0}if(pa)break}pa&&(la=Mb,wa=Nb);la.length?L(la,function(){oa(la,arguments);wa.length?L(wa,function(){oa(wa,arguments);fa.resolve()}):fa.resolve()}):fa.resolve();return fa}function Za(D){D=D.itemData;var pa=function(fa,la){"GroupLayer"===fa.layerType?q.forEach(fa.layers,function(wa){wa.visibility=
!1===fa.visibility?!1:wa.visibility;wa.opacity=a.isDefined(fa.opacity)?a.isDefined(wa.opacity)?wa.opacity*fa.opacity:fa.opacity:wa.opacity;pa(wa,la)}):la.push(fa)},oa=[];q.forEach(D.operationalLayers,function(fa){pa(fa,oa)});D.operationalLayers=oa}function ib(D,pa,oa,fa){Za(fa);var la=fa.itemData;la.baseMap&&la.baseMap.baseMapLayers&&la.baseMap.baseMapLayers.length&&(la.baseMap.baseMapLayers[0].firstLayer=!0);var wa=pa.layerMixins,sa=wa&&wa.length;if(sa){var na=function(za){for(var Ea=0;Ea<sa;Ea++){var La=
wa[Ea];if(La.mixin)if(La.hasOwnProperty("id")){if(za.id===La.id){J.mixin(za,La.mixin);break}}else if(za.url===La.url){J.mixin(za,La.mixin);break}}};q.forEach(la.baseMap&&la.baseMap.baseMapLayers,na);q.forEach(la.operationalLayers,na)}Wa(fa,pa).then(function(){return ab(fa,pa)}).then(function(){return Va(fa,pa)}).then(function(za){var Ea=za[0],La=za[1];if(Ea.itemData.operationalLayers&&0!==Ea.itemData.operationalLayers.length){var Ua=new E,Fa=Ea.itemData.baseMap.baseMapLayers.slice(),Ta=q.filter(Ea.itemData.baseMap.baseMapLayers,
function(Sa){return!Sa.isReference});za={item:Ea.item,itemData:{baseMap:{baseMapLayers:Ta},background:J.clone(Ea.itemData.background)}};Ea.itemData.baseMap.baseMapLayers=q.filter(Ea.itemData.baseMap.baseMapLayers,function(Sa){return Sa.isReference});Ra(za,La).addCallback(function(Sa){ra(Sa.itemData,La).addCallback(J.hitch(null,Ca,Sa,D,La,Ua))});Ua.then(function(Sa){Ra(Ea,La).addCallback(function(db){ra(db.itemData,La,Sa.map.spatialReference,Ta,Sa.map).addCallback(function(sb){db.itemData.baseMap.baseMapLayers=
Fa;Ca(db,Sa,La,oa,sb)})})},J.hitch(oa,oa.errback))}else Ra(Ea,La).addCallback(function(Sa){ra(Sa.itemData,La).addCallback(J.hitch(null,Ca,Sa,D,La,oa))})})}function ob(D,pa){"undefined"===typeof pa&&(pa=!0);rb._arcgisUrl&&0<rb._arcgisUrl.length&&(rb.arcgisUrl=rb._arcgisUrl);var oa={},fa=new E;e({url:rb.arcgisUrl+"/"+D,content:{f:"json"},callbackParamName:"callback",load:function(la){oa.item=la;pa?e({url:rb.arcgisUrl+"/"+D+"/data",content:{f:"json"},callbackParamName:"callback",load:function(wa){oa.itemData=
wa;fa.callback(oa)},error:function(wa){fa.errback(wa)}}):fa.callback(oa)},error:function(la){fa.errback(la)}});return fa}var kb,jb,hb,cb,eb,nb,qb,ub,Bb,vb,yb,zb,Ab,Cb,$a,gb,lb,mb,xb,tb,Ib,Fb,Hb,Gb,Mb="../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/ArcGISImageServiceVectorLayer ../layers/CSVLayer ../layers/GeoRSSLayer ../layers/KMLLayer ../layers/LabelClass ../layers/OpenStreetMapLayer ../layers/RasterXLayer ../layers/StreamLayer ../layers/VectorTileLayer ../virtualearth/VETiledLayer ../layers/WebTiledLayer ../layers/WFSLayer ../layers/WMSLayer".split(" "),
Nb="./csv ../layers/DynamicLayerInfo ../layers/ImageParameters ../layers/ImageServiceParameters ../layers/LayerDrawingOptions ../layers/MosaicRule ../layers/RasterFunction ../layers/TileInfo ../layers/vectorTiles/layers/support/vectorTileLayerLoader ../layers/WMSLayerInfo".split(" ");var rb={arcgisUrl:y.getProtocolForWebResource()+"//www.arcgis.com/sharing/rest/content/items",getItem:ob,createMap:function(D,pa,oa){var fa=new E;oa=oa||{};var la=oa.infoTemplateClass;oa._clazz=la&&(J.isObject(la)?la:
J.getObject(la))||F;J.isString(D)?ob(D).addCallback(J.hitch(null,ib,pa,oa,fa)).addErrback(J.hitch(fa,fa.errback)):ib(pa,oa,fa,D);fa.addCallback(function(wa){var sa=wa.map;sa&&(sa.tables=J.getObject("itemInfo.itemData.tables",!1,wa)||[])});return fa},getLayerList:function(D){return D&&D.itemInfo&&D.itemInfo.itemData?Ka(D.itemInfo.itemData):[]},getLegendLayers:function(D){return D&&D.itemInfo&&D.itemInfo.itemData?Ya(D.itemInfo.itemData):[]},_arcgisUrl:null,_getItemProps:Ra,_getItemData:ta,_getBingKey:Ba,
_portalUrlResponse:Q,_portalUrlFailure:ba,_processFSItemProperties:Oa,_processSSItemProperties:Ia,_getLayers:ra,_preBuildLayerObjects:bb,_buildLayerObjects:Na,_preCreateMap:Ca,_getMapSR:Xa,_createMap:Aa,_addSelectionLayers:U,_createSelectionFeatureLayers:P,_getServiceInfo:r,_getFeatureCollectionItem:N,_mergeFeatureCollectionItem:ca,_projectFeatureCollection:ka,_getLayersInfo:V,_initLayer:Ma,_loadAsCached:va,_loadAsDynamic:Da,_processPopups:ha,_onLayersAddResult:aa,_sameSpatialReferenceAsBasemap:Ja,
_sameTilingSchemeAsBasemap:Qa,_showPopup:ja,_calculateClickTolerance:da,_getVisibleFeatureLayers:xa,_updateLayerScaleInfo:z,_checkUrl:ea,_isHostedService:ua,_isAgolService:Ga,_getLegendLayers:Ya};J.setObject("arcgis.utils",rb,f);return rb})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(L,J,q){L.DeferredList=function(K,E,w,x,A){var n=[];J.call(this);var g=this;0!==K.length||E||this.resolve([0,[]]);var m=0;q.forEach(K,function(l,f){function b(c,
a){n[f]=[c,a];m++;m===K.length&&g.resolve(n)}l.then(function(c){E?g.resolve([f,c]):b(!0,c)},function(c){w?g.reject(c):b(!1,c);if(x)return null;throw c;})})};L.DeferredList.prototype=new J;L.DeferredList.prototype.gatherResults=function(K){K=new L.DeferredList(K,!1,!0,!1);K.addCallback(function(E){var w=[];q.forEach(E,function(x){w.push(x[1])});return w});return K};return L.DeferredList})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),
function(L,J,q,K,E,w,x,A){L=L([w,x],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(n,g){J.mixin(this,g);this.initialize(n,g)},getTitle:function(n){var g;this.info&&(g=this.titleHasRelatedFields||this.titleHasAsyncExpressions?"":this._getPopupValues(n,this._fetchAttributes(n,null,this.getExpressionFieldsInTitle()),!0).title);return g||""},getContent:function(n){return this.info?(new A({template:this,graphic:n,chartTheme:this.chartTheme},
K.create("div"))).domNode:""}});q("extend-esri")&&J.setObject("dijit.PopupTemplate",L,E);return L})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./promiseList ./ArcadeExpression ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./arcadeProfiles/popupProfile ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a,e,d,h,y,I,H){L=L(null,{declaredClass:"esri.PopupInfo",_reNewline:/(\n)/ig,_reExprField:/^\s*expression\//i,_reExprFieldPattern:/\{expression\/([^\}]+)\}/ig,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",_aggregatedFeaturesVariable:"$aggregatedfeatures",initialize:function(u,G){if(u){J.mixin(this,G);this.info=u;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var v=this._fieldLabels=
{},t=this._fieldsMap={};this.info.fieldInfos&&q.forEach(this.info.fieldInfos,function(F){var B=F.fieldName.toLowerCase(),O=this._isExpressionField(B)?this.getExpressionInfo(B):null;v[B]=O?O.title:F.label;t[B]=F},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix));this.titleHasAsyncExpressions=this._titleHasAsyncExpressions();this.contentHasAsyncExpressions=this._contentHasAyncExpressions()}},toJson:function(){return K.fromJson(K.toJson(this.info))},
getTitle:function(){},getContent:function(){},getFieldInfo:function(u){var G;q.some(this.info&&this.info.fieldInfos,function(v){v.fieldName===u&&(G=v);return!!G});return G},getExpressionInfo:function(u){if(u=this._getExprField(u)){u=u.toLowerCase();var G;q.some(this.info.expressionInfos,function(v){v.name.toLowerCase()===u&&(G=v);return!!G});return G}},getExpressionFieldsInTitle:function(){return this._getExprFieldsFromTemplatedString(this.info.title)},getExpressionFieldsInContent:function(){var u=
this._collectExprFieldsFromTemplatedString(this.info.description,[]);this.info.description||q.forEach(this.info.fieldInfos,function(G){G.visible&&this._collectExprField(G.fieldName,u)},this);q.forEach(this.info.mediaInfos,function(G){this._collectExprFieldsFromTemplatedString(G.title,u);this._collectExprFieldsFromTemplatedString(G.caption,u);if(G=G.value)this._collectExprFieldsFromTemplatedString(G.linkURL,u),this._collectExprFieldsFromTemplatedString(G.sourceURL,u),q.forEach(G.fields,function(v){this._collectExprField(v,
u)},this),this._collectExprField(G.normalizeField,u),this._collectExprField(G.tooltipField,u)},this);return u},getRequiredExpressionFields:function(){return this.getExpressionFieldsInTitle().concat(this.getExpressionFieldsInContent())},hasGeometryOperations:function(){return q.some(this._getArcadeExpressions(),function(u){return u.hasGeometryOperations()})},hasAsyncExpressions:function(){return q.some(this._getArcadeExpressions(),function(u){return u.async})},initializeArcadeEngine:function(){return y.initialize(this._getArcadeExpressions())},
getComponents:function(u,G){var v=this.info,t={initArcadeEngine:this.initializeArcadeEngine()};v.fieldInfos&&(v=q.filter(v.fieldInfos,function(F){return-1!==F.fieldName.indexOf(this._relatedFieldPrefix)},this))&&0<v.length&&(t.relatedInfo=this._getRelatedRecords({graphic:u,fieldsInfo:v}));this._needFullResolutionFeature(u)&&(t.fullResolutionFeature=this._getFullResolutionFeature(u));this._needAggregatedFeaturesLayer(u)&&(t.aggregatedFeaturesLayer=this._getAggregatedFeaturesLayer(u));return b(t).then(J.hitch(this,
function(F){var B=F.fullResolutionFeature,O=G&&G.evaluateAllExpressions,M=O?null:this.getRequiredExpressionFields();F=(O?this.hasAsyncExpressions():this._hasAsyncExpressions(M))?this._fetchAttributesAsync(u,B,M,F.aggregatedFeaturesLayer):this._fetchAttributes(u,B,M);return b([F]).then(J.hitch(this,function(C){return this._getPopupValues(u,C[0])}))}))},getAttachments:function(u){var G=u.getSourceLayer();u=u.attributes;if(this.info.showAttachments&&G&&G.hasAttachments&&G.objectIdField&&(u=u&&u[G.objectIdField]))return G.queryAttachmentInfos(u)},
_needAggregatedFeaturesLayer:function(u){return u.isAggregate()?q.some(this._getArcadeExpressions(),function(G){return G.hasVariable(this._aggregatedFeaturesVariable)},this):!1},_getAggregatedFeaturesLayer:function(u){return u.getAggregationSourceLayer().getFeatureCollectionLayer(u.getChildGraphics()).always(function(G){return G instanceof Error?null:G})},_needFullResolutionFeature:function(u){return(u=u.getSourceLayer())?"function"===typeof u.getMaxAllowableOffset&&0<u.getMaxAllowableOffset()&&this.hasGeometryOperations():
!1},_getFullResolutionFeature:function(u){var G=u.getSourceLayer(),v=G.objectIdField;u=(u=u.attributes)&&v&&u[v];if(null==u)return null;var t=new a;t.where=v+"\x3d"+u;t.maxAllowableOffset=0;t.outFields=[v];G._enableCacheHint(t);return G.queryFeatures(t).then(function(F){return F.features&&F.features[0]})},_isExpressionField:function(u){return this._reExprField.test(u)},_getExprField:function(u){return this._isExpressionField(u)?u.replace(this._reExprField,""):null},_collectExprField:function(u,G){(u=
this._getExprField(u))&&G.push(u);return G},_collectExprFieldsFromTemplatedString:function(u,G){u=this._getExprFieldsFromTemplatedString(u);u.length&&Array.prototype.push.apply(G,u);return G},_getExprFieldsFromTemplatedString:function(u){u=u?u.match(this._reExprFieldPattern):null;return q.map(u,function(G){return G.replace(this._reExprFieldPattern,"$1")},this)},_titleHasAsyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInTitle())},_contentHasAyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInContent())},
_hasAsyncExpressions:function(u){return q.some(u,function(G){G=this._exprCache[G];return!(!G||!G.async)},this)},_compileExpressions:function(u){var G={};q.forEach(u,function(v){var t=v.returnType&&v.returnType.toLowerCase();G[v.name]=new c({expression:v.expression,returnType:"number"===t?"number":"string",profile:y})});return G},_getArcadeExpressions:function(){var u=[],G;for(G in this._exprCache)u.push(this._exprCache[G]);return u},_fetchAttributesAsync:function(u,G,v,t){var F=this._fetchAttributes(u,
G,v,t);u={};for(var B in F)(G=F[B])&&G.then&&(u[B]=G);return b(u).then(J.hitch(this,function(O){for(var M in O){var C=O[M];F[M]=C instanceof Error?null:this._processArcadeResult(C)}return F}))},_processArcadeResult:function(u){"string"===typeof u&&(u=g.encode(u));return u},_fetchAttributes:function(u,G,v,t){var F=J.clone(u.attributes)||{},B=G&&G.geometry,O=this._exprPrefix,M=this._exprCache;v=v||q.map(this.info.expressionInfos,function(C){return C.name});q.forEach(v,function(C){var W=O+C;C=(C=M[C])?
u.evaluateExpression(C,this._getEvalOptions(C,u,B,t)):null;F[W]=this._processArcadeResult(C)},this);return F},_getEvalOptions:function(u,G,v,t){var F=u.hasGeometryOperations(),B=G.getSourceLayer(),O=B&&(B.getMap()||B.parentLayer&&B.parentLayer.getMap());t&&(t._map=O);u=y.getEvalOptions({expression:u,feature:G,layer:B,aggregatedFeaturesLayer:t,map:O,spatialReference:O&&O.spatialReference});G=u.context.vars.$feature;F=!(!F||!v);G&&F&&(G._geometry=v);u.skipCache=F;return u},_getPopupValues:function(u,
G,v){G=G||this._fetchAttributes(u);var t=this.info,F=u.getSourceLayer(),B=J.clone(G),O="",M="",C,W,Y=F&&F._getDateOpts&&F._getDateOpts().properties;Y=Y&&Y.slice(0);var R={dateFormat:{properties:Y,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)},format:null};if(this._relatedInfo)for(Z in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(Z)){var S=this._relatedInfo[Z],T=this._relatedLayersInfo[Z];S&&(q.forEach(S.relatedFeatures,function(Ia){for(W in Ia.attributes)if(Ia.attributes.hasOwnProperty(W)&&
"esriRelCardinalityOneToOne"===T.relation.cardinality){var Ra=this._toRelatedFieldName([T.relation.id,W]);G[Ra]=B[Ra]=Ia.attributes[W]}},this),q.forEach(S.relatedStatsFeatures,function(Ia){for(W in Ia.attributes)if(Ia.attributes.hasOwnProperty(W)){var Ra=this._toRelatedFieldName([T.relation.id,W]);G[Ra]=B[Ra]=Ia.attributes[W]}},this))}for(C in B){var Z=this._fieldsMap[C.toLowerCase()];S=this._getLayerFieldInfo(F,C);Z&&S&&(Z.fieldName=S.name);B[C]=this._formatValue(B[C],C,R);Y&&Z&&Z.format&&Z.format.dateFormat&&
(Z=q.indexOf(Y,C),-1<Z&&Y.splice(Z,1))}if(F)for(C in Y=F.typeIdField,G)if(G.hasOwnProperty(C)&&-1===C.indexOf(this._relatedFieldPrefix)){var qa=G[C];m.isDefined(qa)&&(Z=this._getDomainName(F,u,C,qa),m.isDefined(Z)?B[C]=Z:C===Y&&(Z=this._getTypeName(F,u,qa),m.isDefined(Z)&&(B[C]=Z)))}t.title&&(O=this._processFieldsInLinks(this._fixTokens(t.title,F),G),O=J.trim(this._removeEmptyHref(m.substitute(B,O,R)||"")));if(v)return{title:O};t.description&&(M=this._processFieldsInLinks(this._fixTokens(t.description,
F),G),M=J.trim(this._removeEmptyHref(m.substitute(B,M,R)||"")));if(t.fieldInfos){var ta=[];q.forEach(t.fieldInfos,function(Ia){(C=Ia.fieldName)&&Ia.visible&&ta.push([this._fieldLabels[C.toLowerCase()]||C,m.substitute(B,"${"+C+"}",R)||""])},this)}var Ba;if(t.mediaInfos){var Oa=[];q.forEach(t.mediaInfos,function(Ia){Ba=0;qa=Ia.value;switch(Ia.type){case "image":var Ra=qa.sourceURL;Ra=Ra&&J.trim(this._removeEmptyHref(m.substitute(G,this._fixTokens(Ra,F))));Ba=!!Ra;break;case "piechart":case "linechart":case "columnchart":case "barchart":Ra=
qa.normalizeField;qa.fields=q.map(qa.fields,function(ia){return(Va=this._getLayerFieldInfo(F,ia))?Va.name:ia},this);if(Ra){var Va=this._getLayerFieldInfo(F,Ra);qa.normalizeField=Va?Va.name:Ra}Ba=q.some(qa.fields,function(ia){return m.isDefined(G[ia])||-1!==ia.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(Ba){Ia=J.clone(Ia);qa=Ia.value;Ra=Ia.title?this._processFieldsInLinks(this._fixTokens(Ia.title,F),G):"";var ab=Ia.caption?this._processFieldsInLinks(this._fixTokens(Ia.caption,
F),G):"";Ia.title=Ra?J.trim(this._removeEmptyHref(m.substitute(B,Ra,R)||"")):"";Ia.caption=ab?J.trim(this._removeEmptyHref(m.substitute(B,ab,R)||"")):"";if("image"===Ia.type)qa.sourceURL=m.substitute(G,this._fixTokens(qa.sourceURL,F)),qa.linkURL&&(qa.linkURL=J.trim(m.substitute(G,this._fixTokens(qa.linkURL,F))||""));else{var Q,ba;q.forEach(qa.fields,function(ia,ha){if(-1!==ia.indexOf(this._relatedFieldPrefix))ba=this._getRelatedChartInfos(ia,qa,G,R),ba instanceof Array?qa.fields=ba:qa.fields[ha]=
ba;else{var ua=G[ia];ua=void 0===ua?null:ua;Q=G[qa.normalizeField]||0;ua&&Q&&(ua/=Q);qa.fields[ha]={y:ua,tooltip:(this._fieldLabels[ia.toLowerCase()]||ia)+":\x3cbr/\x3e"+this._formatValue(ua,ia,R,!!Q)}}},this)}Oa.push(Ia)}},this)}return{title:O,description:M,hasDescription:!!t.description,fields:ta&&ta.length?ta:null,mediaInfos:Oa&&Oa.length?Oa:null,formatted:B,editSummary:!1!==t.showLastEditInfo&&F&&F.getEditSummary?F.getEditSummary(u):""}},_getRelatedChartInfos:function(u,G,v,t){var F,B;var O=[];
var M=this._fromRelatedFieldName(u);var C=M[0];var W=this._relatedInfo[C];C=this._relatedLayersInfo[C];W&&q.forEach(W.relatedFeatures,function(Y){Y=Y.attributes;var R;for(R in Y)if(Y.hasOwnProperty(R)&&R===M[1]){var S={};B=Y[R];G.normalizeField&&(F=-1!==G.normalizeField.indexOf(this._relatedFieldPrefix)?Y[this._fromRelatedFieldName(G.normalizeField)[1]]:v[G.normalizeField]);B&&F&&(B/=F);if(G.tooltipField)if(-1!==G.tooltipField.indexOf(this._relatedFieldPrefix)){var T=this._fromRelatedFieldName(G.tooltipField)[1],
Z=m.isDefined(Y[T])?this._formatValue(Y[T],G.tooltipField,t,!!F):T;S.tooltip=Z+":\x3cbr/\x3e"+this._formatValue(B,T,t,!!F)}else S.tooltip=(this._fieldLabels[u.toLowerCase()]||u)+":\x3cbr/\x3e"+this._formatValue(B,G.tooltipField,t,!!F);else S.tooltip=B;S.y=B;O.push(S)}},this);return"esriRelCardinalityOneToMany"===C.relation.cardinality||"esriRelCardinalityManyToMany"===C.relation.cardinality?O:O[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",
shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",
shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",longMonthDayYearShortTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longMonthDayYearShortTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longMonthDayYearLongTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",
longMonthDayYearLongTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",dayShortMonthYearShortTime:"(datePattern: 'd MMM y', timePattern: 'h:mm a', selector: 'date and time')",dayShortMonthYearShortTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm', selector: 'date and time')",dayShortMonthYearLongTime:"(datePattern: 'd MMM y', timePattern: 'h:mm:ss a', selector: 'date and time')",dayShortMonthYearLongTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm:ss', selector: 'date and time')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",longDateShortTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longDateShortTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longDateLongTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",longDateLongTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",
shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_dateFormatsJson:{shortDate:{datePattern:"M/d/y",selector:"date"},shortDateShortTime:{datePattern:"M/d/y",timePattern:"h:mm a",selector:"date and time"},shortDateShortTime24:{datePattern:"M/d/y",timePattern:"H:mm",selector:"date and time"},shortDateLongTime:{datePattern:"M/d/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLongTime24:{datePattern:"M/d/y",timePattern:"H:mm:ss",selector:"date and time"},
shortDateLE:{datePattern:"d/M/y",selector:"date"},shortDateLEShortTime:{datePattern:"d/M/y",timePattern:"h:mm a",selector:"date and time"},shortDateLEShortTime24:{datePattern:"d/M/y",timePattern:"H:mm",selector:"date and time"},shortDateLELongTime:{datePattern:"d/M/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLELongTime24:{datePattern:"d/M/y",timePattern:"H:mm:ss",selector:"date and time"},longMonthDayYear:{datePattern:"MMMM d, y",selector:"date"},longMonthDayYearShortTime:{datePattern:"MMMM d, y",
timePattern:"h:mm a",selector:"date and time"},longMonthDayYearShortTime24:{datePattern:"MMMM d, y",timePattern:"H:mm",selector:"date and time"},longMonthDayYearLongTime:{datePattern:"MMMM d, y",timePattern:"h:mm:ss a",selector:"date and time"},longMonthDayYearLongTime24:{datePattern:"MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},dayShortMonthYear:{datePattern:"d MMM y",selector:"date"},dayShortMonthYearShortTime:{datePattern:"d MMM y",timePattern:"h:mm a",selector:"date and time"},dayShortMonthYearShortTime24:{datePattern:"d MMM y",
timePattern:"H:mm",selector:"date and time"},dayShortMonthYearLongTime:{datePattern:"d MMM y",timePattern:"h:mm:ss a",selector:"date and time"},dayShortMonthYearLongTime24:{datePattern:"d MMM y",timePattern:"H:mm:ss",selector:"date and time"},longDate:{datePattern:"EEEE, MMMM d, y",selector:"date"},longDateShortTime:{datePattern:"EEEE, MMMM d, y",timePattern:"h:mm a",selector:"date and time"},longDateShortTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm",selector:"date and time"},longDateLongTime:{datePattern:"EEEE, MMMM d, y",
timePattern:"h:mm:ss a",selector:"date and time"},longDateLongTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},longMonthYear:{datePattern:"MMMM y",selector:"date"},shortMonthYear:{datePattern:"MMM y",selector:"date"},year:{datePattern:"y",selector:"date"}},_reHref:/href\s*=\s*(")([^"]+)"/ig,_reHrefApos:/href\s*=\s*(')([^']+)'/ig,_fixTokens:function(u,G){var v=this;return u.replace(/(\{([^\{\r\n]+)\})/g,function(t,F,B){t=v._getLayerFieldInfo(G,B);return"$"+(t?"{"+
t.name+"}":F)})},_encodeAttributes:function(u,G){u=J.clone(u)||{};var v,t;for(v in u)(t=u[v])&&"string"===typeof t&&(t=G?t:encodeURIComponent(t),t=t.replace(/'/g,"\x26apos;"),u[v]=t);return u},_processFieldsInLinks:function(u,G){var v=this._encodeAttributes(G),t=this._encodeAttributes(G,!0);G=J.hitch(this,this._addValuesToHref,G,v,t);u&&(u=u.replace(this._reHref,G).replace(this._reHrefApos,G));return u},_addValuesToHref:function(u,G,v,t,F,B){B=B&&J.trim(B);return t=m.substitute(B&&0===B.indexOf("${")?
"'"===F?v:u:G,t)},_getLayerFieldInfo:function(u,G){return u&&u.getField?u.getField(G):null},_formatValue:function(u,G,v,t){var F=this._fieldsMap[G.toLowerCase()],B=F&&F.format;G=-1!==q.indexOf(v.dateFormat.properties,G);var O="number"===typeof u&&!G&&(!B||!B.dateFormat);if(!m.isDefined(u)||!F||!m.isDefined(B))return this._applyFormatting(u,O);F=B.hasOwnProperty("places")||B.hasOwnProperty("digitSeparator");var M=B.hasOwnProperty("digitSeparator")?B.digitSeparator:!0;if(F&&!G)var C={formatType:"NumberFormat",
places:m.isDefined(B.places)&&(!t||0<B.places)?Number(B.places):Infinity};else if(B.dateFormat)C=J.mixin({formatType:"DateFormat",utcOffset:this.utcOffset},this._dateFormatsJson[B.dateFormat]||this._dateFormatsJson.shortDateShortTime);else return this._applyFormatting(u,O);var W=this._applyFormatFunctions(u,C,v);F&&-1<u.constructor.toString().indexOf("Array")&&(W="",q.forEach(u,J.hitch(this,function(Y,R){R&&(W+=" ");W+=this._applyFormatFunctions(Y,C,v)})));F&&!M&&H.group&&(W=W.replace(new RegExp("\\"+
H.group,"g"),""));G&&(W='\x3cspan class\x3d"esriDateValue"\x3e'+W+"\x3c/span\x3e");return this._applyFormatting(W,O)},_applyFormatFunctions:function(u,G,v){G&&v&&(v.format={myKey:G});u=m.substitute({myKey:u},"${myKey}",v)||"";G&&v&&(v.format=null);return u},_applyFormatting:function(u,G){return G?this._forceLTR(u):this._applyPreWrap(u)},_forceLTR:function(u){var G=A("ie");return G&&10>=G?u:"\x3cspan class\x3d'esriNumericValue'\x3e"+u+"\x3c/span\x3e"},_applyPreWrap:function(u){return"string"===typeof u?
u.replace(this._reNewline,"\x3cspan class\x3d'charNewLine'\x3e$1\x3c/span\x3e"):u},_insertOffset:function(u){u&&(u=m.isDefined(this.utcOffset)?u.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):u);return u},_getDomainName:function(u,G,v,t){return(u=u.getDomain&&u.getDomain(v,{feature:G}))&&u.codedValues?u.getName(t):null},_getTypeName:function(u,G,v){return(u=u.getType&&u.getType(G))&&u.name},_getRelatedRecords:function(u){var G=u.graphic,v;this._relatedLayersInfoPromise||(this._relatedLayersInfoPromise=
this._getRelatedLayersInfo(u).then(J.hitch(this,function(t){for(v in t)t.hasOwnProperty(v)&&t[v]&&(this._relatedLayersInfo[v].relatedLayerInfo=t[v])})));return this._relatedLayersInfoPromise.then(J.hitch(this,function(){return this._queryRelatedLayers(G)})).then(J.hitch(this,function(t){this._setRelatedRecords(G,t);return t}))},_getRelatedLayersInfo:function(u){var G=u.fieldsInfo,v,t={};var F=u.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});q.forEach(G,function(B){var O;
var M=this._fromRelatedFieldName(B.fieldName);var C=M[0];M=M[1];if(C&&(!this._relatedLayersInfo[C]&&F&&F.relationships&&(q.some(F.relationships,function(Y){if(Y.id==C)return O=Y,!0}),O&&(this._relatedLayersInfo[C]={relation:O,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[C]&&(this._relatedLayersInfo[C].relatedFields.push(M),B.statisticType))){var W=new h;W.statisticType=B.statisticType;W.onStatisticField=M;W.outStatisticFieldName=M;this._relatedLayersInfo[C].outStatistics.push(W)}},
this);for(v in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(v)&&this._relatedLayersInfo[v]&&(u=this._relatedLayersInfo[v].relation,u=F.url.replace(/[0-9]+$/,u.relatedTableId),this._relatedLayersInfo[v].relatedLayerUrl=u,t[v]=f({url:u,content:{f:"json"},callbackParamName:"callback"}));return n(t)},_queryRelatedLayers:function(u){var G={},v;for(v in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(v)&&(G[v]=this._queryRelatedLayer({graphic:u,relatedInfo:this._relatedLayersInfo[v]}));
return n(G)},_queryRelatedLayer:function(u){var G,v;var t=u.graphic;var F=t.getSourceLayer();var B=F.url.match(/[0-9]+$/g)[0];var O=u.relatedInfo;var M=O.relatedLayerInfo;var C=O.relatedLayerUrl;var W=O.relation;u=q.filter(M.relationships,function(qa){return qa.relatedTableId===parseInt(B,10)});1===u.length?G=u[0]:1<u.length&&q.some(u,function(qa){qa.id===W.id&&(G=qa);return!!G});if(G){var Y=new a;q.some(M.fields,function(qa){if(qa.name===G.keyField)return v=-1!==q.indexOf(["esriFieldTypeSmallInteger",
"esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],qa.type)?"number":"string",!0});if(G.relationshipTableId&&G.keyFieldInRelationshipTable){var R=new x;this._queryRelatedRecords(t,G).then(J.hitch(this,function(qa){var ta;(ta=qa[t.attributes[F.objectIdField]])?(qa=q.map(ta.features,function(Ba){return Ba.attributes[M.objectIdField]},this),O.outStatistics&&0<O.outStatistics.length&&M.supportsStatistics&&(T=new a,T.where=this._chunkWhereInClause(M.objectIdField,qa,1E3),T.outFields=Y.outFields,
T.outStatistics=O.outStatistics),T&&(Z=new e(C),Z.execute(T).then(J.hitch(this,function(Ba){var Oa=[];Oa.push(ta);Oa.push(Ba);R.resolve(Oa)})))):R.resolve()}))}else{var S="string"===v?G.keyField+"\x3d'"+t.attributes[W.keyField]+"'":G.keyField+"\x3d"+t.attributes[W.keyField];Y.where=S;Y.outFields=O.relatedFields;if(O.outStatistics&&0<O.outStatistics.length&&M.supportsStatistics){var T=new a;T.where=Y.where;T.outFields=Y.outFields;T.outStatistics=O.outStatistics}var Z=new e(C);S=[];S.push(Z.execute(Y));
T&&S.push(Z.execute(T))}}return S?n(S):R?R.promise:void 0},_setRelatedRecords:function(u,G){this._relatedInfo=[];for(var v in G)G.hasOwnProperty(v)&&G[v]&&(u=G[v],this._relatedInfo[v]={},this._relatedInfo[v].relatedFeatures=u[0].features,m.isDefined(u[1])&&(this._relatedInfo[v].relatedStatsFeatures=u[1].features))},_handlerErrorResponse:function(u,G){u.reject(G)},_fromRelatedFieldName:function(u){var G=[];-1!==u.indexOf(this._relatedFieldPrefix)&&(u=u.split("/"),G=u.slice(1));return G},_toRelatedFieldName:function(u){var G=
"";u&&0<u.length&&(G=this._relatedFieldPrefix+u[0]+"/"+u[1]);return G},_queryRelatedRecords:function(u,G){var v=u.getSourceLayer(),t=new d;t.outFields=["*"];t.relationshipId=G.id;t.objectIds=[u.attributes[v.objectIdField]];return v.queryRelatedFeatures(t)},_removeEmptyHref:function(u){return u.replace(/href=(""|'')/gi,"")},_chunkWhereInClause:function(u,G,v){for(var t=0,F=[];t<G.length;)F.push(u+" IN ("+G.slice(t,v+t)+")"),t+=v;return F.join(" OR ")}});w("extend-esri")&&(l.PopupInfo=l.PopupInfoTemplate=
L);return L})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(L){var J=L.getObject("dojox.html.entities",!0),q=function(E,w){if(w._encCache&&w._encCache.regexp&&w._encCache.mapper&&w.length==w._encCache.length){var x=w._encCache.mapper;var A=w._encCache.regexp}else{x={};A=["["];var n;for(n=0;n<w.length;n++)x[w[n][0]]="\x26"+w[n][1]+";",A.push(w[n][0]);A.push("]");A=new RegExp(A.join(""),"g");w._encCache={mapper:x,regexp:A,length:w.length}}return E=E.replace(A,function(g){return x[g]})},
K=function(E,w){if(w._decCache&&w._decCache.regexp&&w._decCache.mapper&&w.length==w._decCache.length){var x=w._decCache.mapper;var A=w._decCache.regexp}else{x={};A=["("];var n;for(n=0;n<w.length;n++){var g="\x26"+w[n][1]+";";n&&A.push("|");x[g]=w[n][0];A.push(g)}A.push(")");A=new RegExp(A.join(""),"g");w._decCache={mapper:x,regexp:A,length:w.length}}return E=E.replace(A,function(m){return x[m]})};J.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];J.latin=[["\u00a1",
"iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],
["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],
["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],
["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a",
"Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be",
"xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191",
"uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229",
"cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663",
"clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030",
"permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];J.encode=function(E,w){E&&(w?E=q(E,w):(E=q(E,J.html),E=q(E,J.latin)));return E};J.decode=function(E,w){E&&(w?E=K(E,w):(E=K(E,J.html),E=K(E,J.latin)));return E};return J})},"esri/ArcadeExpression":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./layers/support/attributeUtils ./support/expressionUtils".split(" "),function(L,J,q,K,E,w){L=L(null,{declaredClass:"esri.ArcadeExpression",expression:null,profile:null,returnType:null,
async:null,id:null,syntaxTree:null,_traits:null,_attributeDef:null,_attributeCache:null,_compiled:!1,constructor:function(x){J.mixin(this,x);this.returnType=this.returnType||"string";this.id=E.getAttributeId(this.expression);this._setSyntaxTree(this.profile.parse(this));this.async=this.async||this.profile.isAsync(this)},hasGeometryOperations:function(){var x=this._traits.geometryOperations;void 0===x&&(x=this._traits.geometryOperations=w.hasGeometryOperations(this.syntaxTree));return x},hasFeatureSetOperations:function(){var x=
this._traits.featureSetOperations;void 0===x&&(x=this._traits.featureSetOperations=w.hasFeatureSetOperations(this.syntaxTree));return x},hasVariable:function(x){var A=this._traits.variables;void 0===A[x]&&(A[x]=w.hasVariable(this.syntaxTree,x));return A[x]},hasFunction:function(x){var A=this._traits.functions;void 0===A[x]&&(A[x]=w.hasFunction(this.syntaxTree,x));return A[x]},evaluate:function(x){this._compile();var A=this._attributeCache.compiledFunc;return this.async?w.executeAsyncFunction(A,x):
w.executeFunction(A,x)},_setSyntaxTree:function(x){this.syntaxTree=x;this._compiled=!1;this._traits={variables:{},functions:{}};this._createLegacyValueObjects()},_createLegacyValueObjects:function(){this._attributeDef={valueExpression:this.expression};this._attributeCache={attributeInfo:this._attributeDef,isNumeric:"number"===this.returnType,idSource:this.expression,id:this.id,hasExpr:!0,compiledFunc:null,syntaxTree:this.syntaxTree,isScaleDriven:!1,dependsOnView:this.hasVariable("$view"),dependsOnGeometry:this.hasGeometryOperations(),
isJSFunc:!1}},_compile:function(){this._compiled||(this._attributeCache.compiledFunc=this.profile.compile(this),this._compiled=!0)}});q("extend-esri")&&(K.ArcadeExpression=L);return L})},"esri/tasks/QueryTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/DeferredList ../kernel ../sniff ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,l,
f,b,c){var a=n("esri-pbf"),e=J(null,{url:null,query:null,requestOptions:null,pagination:null,pageSize:null,_fetchDfd:null,_startPage:null,_result:null,constructor:function(h){this._handleSuccess=q.hitch(this,this._handleSuccess);this._handleError=q.hitch(this,this._handleError);q.mixin(this,h);null==this.pagination&&(this.pagination=!1);null==this.pageSize&&(this.pageSize=1E3)},execute:function(){var h=new E(this._canceler);this._fetchDfd=h;this._result=null;this._sendRequest();return h.promise},
_canceler:function(h){var y=h._pendingRequest;if(!h.isFulfilled()&&y&&!y.isFulfilled()){y.cancel();var I=y.results&&y.results[1]}h._pendingRequest=null;return I},_sendRequest:function(h){var y=this.query;this.pagination&&(this._startPage=y.resultOffset=null==h?0:h,y.resultRecordCount=this.pageSize);h=this.requestOptions;this._fetchDfd._pendingRequest=g({url:this.url,content:y,handleAs:"pbf"===y.f?"arraybuffer":"json",callbackParamName:"callback",timeout:h&&h.timeout},h);this._fetchDfd._pendingRequest.then(this._handleSuccess).otherwise(this._handleError)},
_handleSuccess:function(h){this.pagination?(h.exceededTransferLimit&&this._sendRequest(this._startPage+this.pageSize),this._result?this._result.features=this._result.features.concat(h.features):this._result=h,this._fetchDfd.progress(h),h.exceededTransferLimit||this._fetchDfd.resolve(this._result)):(this._fetchDfd.progress(h),this._fetchDfd.resolve(h))},_handleError:function(h){this._fetchDfd.reject(h)}}),d=J(b,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],
"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(h,y){this._handler=q.hitch(this,this._handler);this._relationshipQueryHandler=q.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=q.hitch(this,this._executeForIdsHandler);this._countHandler=q.hitch(this,this._countHandler);this._extentHandler=q.hitch(this,this._extentHandler);this.source=y&&y.source;this.gdbVersion=y&&y.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",
c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"rawExecute",c:2,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onRawExecuteComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(h,y,I,H,u){var G=
u.assembly;h=this._encode(q.mixin({},this._url.query,{f:H&&H.format||"json"},h.toJson(G&&G[0])));var v=this._handler,t=this._errorHandler;this.source&&(H={source:this.source.toJson()},h.layer=w.toJson(H));this.gdbVersion&&(h.gdbVersion=this.gdbVersion);var F="pbf"===h.f;if(F){var B;a||(B="QueryTask.execute: 'pbf' format is not supported in your browser.");if(B)return h=new E,h.addErrback(function(O){t(O,I,u.dfd)}),h.reject(Error(B)),h}B=this.requestOptions;B=g({url:this._url.path+"/query",content:h,
callbackParamName:"callback",handleAs:F?"arraybuffer":"json",timeout:B&&B.timeout},B);h=[B];F&&h.push(d.loadPBFReader());(new x(h)).then(function(O){u.dfd.isFulfilled()||(O=O[0],O[0]?v(O[1],F,y,I,u.dfd):t(O[1],I,u.dfd))});return B},rawExecute:function(h,y,I){y=y||{};h=this._encode(q.mixin({},this._url.query,{f:y.format||"json"},h.toJson(I.assembly&&I.assembly[0])));this.source&&(h.layer=w.toJson({source:this.source.toJson()}));this.gdbVersion&&(h.gdbVersion=this.gdbVersion);return(new e({url:this._url.path+
"/query",query:h,requestOptions:this.requestOptions,pagination:y.pagination,pageSize:y.pageSize})).execute().then(null,null,function(H){I.dfd.progress(H)}).then(q.hitch(this,function(H){this._successHandler([H],"onRawExecuteComplete",null,I.dfd)})).otherwise(q.hitch(this,function(H){this._errorHandler(H,null,I.dfd)}))},executeRelationshipQuery:function(h,y,I){h=this._encode(q.mixin({},this._url.query,{f:"json"},h.toJson()));var H=this._relationshipQueryHandler,u=this._errorHandler;this.gdbVersion&&
(h.gdbVersion=this.gdbVersion);var G=new E(m._dfdCanceller),v=this.requestOptions,t=this._url.path;this.source&&void 0!==this.source.mapLayerId&&null!==this.source.mapLayerId&&t.endsWith("/dynamicLayer")&&(t=t.slice(0,-13),t=t+"/"+this.source.mapLayerId);G._pendingDfd=g({url:t+"/queryRelatedRecords",content:h,callbackParamName:"callback",timeout:v&&v.timeout,load:function(F,B){H(F,B,y,I,G)},error:function(F){u(F,I,G)}},v);return G},executeForIds:function(h,y,I,H){var u=H.assembly;h=this._encode(q.mixin({},
this._url.query,{f:"json",returnIdsOnly:!0},h.toJson(u&&u[0])));var G=this._executeForIdsHandler,v=this._errorHandler;this.source&&(u={source:this.source.toJson()},h.layer=w.toJson(u));this.gdbVersion&&(h.gdbVersion=this.gdbVersion);u=this.requestOptions;return g({url:this._url.path+"/query",content:h,callbackParamName:"callback",timeout:u&&u.timeout,load:function(t,F){G(t,F,y,I,H.dfd)},error:function(t){v(t,I,H.dfd)}},u)},executeForCount:function(h,y,I,H){var u=H.assembly;h=this._encode(q.mixin({},
this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},h.toJson(u&&u[0])));var G=this._countHandler,v=this._errorHandler;this.source&&(u={source:this.source.toJson()},h.layer=w.toJson(u));this.gdbVersion&&(h.gdbVersion=this.gdbVersion);u=this.requestOptions;return g({url:this._url.path+"/query",content:h,callbackParamName:"callback",timeout:u&&u.timeout,load:function(t,F){G(t,F,y,I,H.dfd)},error:function(t){v(t,I,H.dfd)}},u)},executeForExtent:function(h,y,I,H){var u=H.assembly;h=this._encode(q.mixin({},
this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},h.toJson(u&&u[0])));var G=this._extentHandler,v=this._errorHandler;this.source&&(u={source:this.source.toJson()},h.layer=w.toJson(u));this.gdbVersion&&(h.gdbVersion=this.gdbVersion);u=this.requestOptions;return g({url:this._url.path+"/query",content:h,callbackParamName:"callback",timeout:u&&u.timeout,load:function(t,F){G(t,F,y,I,H.dfd)},error:function(t){v(t,I,H.dfd)}},u)},_handler:function(h,y,I,H,u){try{h&&y&&(h=d.pbfDeps.optimizedFeatures.convertToFeatureSet(d.pbfDeps.pbfQueryUtils.parsePBFFeatureQuery(h)));
var G=new c(h);this._successHandler([G],"onComplete",I,u)}catch(v){this._errorHandler(v,H,u)}},_relationshipQueryHandler:function(h,y,I,H,u){try{var G=h.geometryType,v=h.spatialReference,t={};K.forEach(h.relatedRecordGroups,function(F){var B={};B.geometryType=G;B.spatialReference=v;B.features=F.relatedRecords;B=new c(B);if(null!=F.objectId)t[F.objectId]=B;else for(var O in F)F.hasOwnProperty(O)&&"relatedRecords"!==O&&(t[F[O]]=B)});this._successHandler([t],"onExecuteRelationshipQueryComplete",I,u)}catch(F){this._errorHandler(F,
H,u)}},_executeForIdsHandler:function(h,y,I,H,u){try{this._successHandler([h.objectIds],"onExecuteForIdsComplete",I,u)}catch(G){this._errorHandler(G,H,u)}},_countHandler:function(h,y,I,H,u){try{var G=h.features,v=h.objectIds;if(v)var t=v.length;else{if(G)throw Error("Unable to perform query. Please check your parameters.");t=h.count}this._successHandler([t],"onExecuteForCountComplete",I,u)}catch(F){this._errorHandler(F,H,u)}},_extentHandler:function(h,y,I,H,u){try{h.extent&&(h.extent=new l(h.extent)),
this._successHandler([h],"onExecuteForExtentComplete",I,u)}catch(G){this._errorHandler(G,H,u)}}});d.loadPBFReader=function(){var h=new E;d.pbfDeps?h.resolve():L(["./support/pbfDeps"],function(y){d.pbfDeps=y;h.isFulfilled()||h.resolve()});return h.promise};f._createWrappers(d);n("extend-esri")&&q.setObject("tasks.QueryTask",d,A);return d})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l){L=L(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(f,b){if(f){J.mixin(this,f);var c=this.features=this.features||[],a=f.spatialReference;a=this.spatialReference=m.createInstance(A.simpleConstructor,a);var e=m.getGeometryType(f.geometryType);this.geometryType=f.geometryType;f.fields&&(this.fields=f.fields);f=m.supportsLazyUnquantization(this.geometryType);var d=m.unquantizeFunction(this.geometryType,this.transform),h=!!(b&&f&&d),y=e&&(h?e.accessorConstructor:
e.simpleConstructor);q.forEach(c,function(I,H){var u=m.createInstance(x.simpleConstructor),G=I.geometry;if(e&&G){var v=u.geometry=m.createInstance(y,h?null:G);v.setSpatialReference(G.spatialReference?m.createInstance(A.simpleConstructor,G.spatialReference):a);h&&v.setupLazyUnquantization(d,G)}u.symbol=I.symbol?l.fromJson(I.symbol):null;u.attributes=I.attributes;c[H]=u});h||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(f){var b=
{};this.displayFieldName&&(b.displayFieldName=this.displayFieldName);this.fields&&(b.fields=this.fields);this.spatialReference?b.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(b.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(b.geometryType=m.getJsonType(this.features[0].geometry)),b.features=n._encodeGraphics(this.features,f));b.geometryType=b.geometryType||this.geometryType;b.exceededTransferLimit=
this.exceededTransferLimit;b.transform=this.transform;return w.fixJson(b)},_hydrate:function(){m.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(f){if(!this.geometryType)return this.transform=null,this;var b=f.translate[0],c=f.translate[1],a=f.scale[0],e=f.scale[1],d=this.features,h=function(u,G,v){var t,F=[];var B=0;for(t=u.length;B<t;B++){var O=u[B];if(0<B){var M=G(O[0]);O=v(O[1]);if(M!==C||O!==W){F.push([M-C,O-W]);var C=M;var W=O}}else C=G(O[0]),
W=v(O[1]),F.push([C,W])}return 0<F.length?F:null},y=function(u,G,v){if("esriGeometryPoint"===u)return function(t){t.x=G(t.x);t.y=v(t.y);return t};if("esriGeometryPolyline"===u||"esriGeometryPolygon"===u)return function(t){var F;var B=t.rings||t.paths;var O=[];var M=0;for(F=B.length;M<F;M++){var C=B[M];(C=h(C,G,v))&&O.push(C)}return 0<O.length?(t.rings?t.rings=O:t.paths=O,t):null};if("esriGeometryMultipoint"===u)return function(t){var F=h(t.points,G,v);return 0<F.length?(t.points=F,t):null};if("esriGeometryEnvelope"===
u)return function(t){return t}}(this.geometryType,function(u){return Math.round((u-b)/a)},function(u){return Math.round((c-u)/e)}),I;var H=0;for(I=d.length;H<I;H++)d[H].geometry&&(y(d[H].geometry)||d[H].setGeometry(null));this.transform=f;return this}});L.createGraphics=function(f){var b=f.geometryType,c=m.createInstance(A.simpleConstructor,f.spatialReference),a=m.getGeometryType(b).accessorConstructor,e=m.unquantizeFunction(b,f.transform);return q.map(f.features,function(d,h){h=m.createInstance(x.simpleConstructor);
var y=d.geometry;if(y){var I=h.geometry=m.createInstance(a);I.setSpatialReference(c);I.setupLazyUnquantization(e,y)}h.attributes=d.attributes;return h})};L.createPolygon=function(f,b,c){if(f){var a=m.createInstance(g.accessorConstructor);a.setSpatialReference(b);b=m.unquantizeFunction("esriGeometryPolygon",c);a.setupLazyUnquantization(b,f)}return a};K("extend-esri")&&J.setObject("tasks.FeatureSet",L,E);return L})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/_base/json","dojo/has","../kernel"],function(L,J,q,K,E){L=L(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,orderByFields:null,toJson:function(){var w={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},x=this.objectIds,A=this.outFields,
n=this.outSpatialReference,g=this.orderByFields;x&&(w.objectIds=x.join(","));A&&(w.outFields=A.join(","));n&&(w.outSR=n.wkid||q.toJson(n.toJson()));g&&(w.orderByFields=g.join(","));w._ts=this._ts;return w}});K("extend-esri")&&J.setObject("tasks.RelationshipQuery",L,E);return L})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(L,J,q,K){L=L(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,
onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});q("extend-esri")&&J.setObject("tasks.StatisticDefinition",L,K);return L})},"esri/arcadeProfiles/popupProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(L,J,q,K,E,w,x,A){L=new (L(null,{declaredClass:"esri.arcadeProfiles.PopupProfile",
defaults:{globals:{featureSet:["$layer","$datastore","$map","$aggregatedfeatures"],async:["$layer","$datastore","$map","$aggregatedfeatures"]},context:{vars:{$feature:"any",$layer:"any",$datastore:"any",$map:"any",$aggregatedfeatures:"any"}}},initialize:function(n){var g=[];A.hasGeometryOperations(n)&&g.push(x.enableGeometryOperations());(A.hasFeatureSetOperations(n)||A.hasVariables(n,this.defaults.globals.featureSet))&&g.push(x.enableFeatureSetOperations());A.isAsync(n)&&g.push(x.enableAsyncOperations());
return E(g)},isAsync:function(n){n=[n];return A.hasFeatureSetOperations(n)||A.hasVariables(n,this.defaults.globals.async)},parse:function(n){return x.createSyntaxTree(n.expression)},compile:function(n){var g=J.clone(this.defaults.context);g.useAsync=n.async;return n.syntaxTree?x.createFunction(n.syntaxTree,g):null},getEvalOptions:function(n){var g=n.expression,m=n.feature,l=n.layer,f=n.aggregatedFeaturesLayer,b=n.map;n=n.spatialReference;m=m&&g.hasVariable("$feature")?w.createFromGraphicLikeObject(m.geometry,
m.attributes,l):null;var c,a;if(l){var e={spatialReference:n};g.hasVariable("$layer")&&(c=l.getMap()?x.createFeatureSetFromLayer(l,e):x.createFeatureSetFromLayerUrl(l.url,e));if(g.hasVariable("$datastore"))var d=(d=A.getServiceUrl(l.url))?x.createFeatureSetCollectionFromServiceUrl(d,e):null;g.hasVariable("$aggregatedfeatures")&&f&&(a=f.getMap()?x.createFeatureSetFromLayer(f,e):null)}g=b&&g.hasVariable("$map")?x.createFeatureSetCollectionFromMap(b):null;return{context:{vars:{$feature:m,$layer:c,$datastore:d,
$map:g,$aggregatedfeatures:a},spatialReference:n}}}}));q("extend-esri")&&J.setObject("arcadeProfiles.popupProfile",L,K);return L})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style ../libs/sanitizer/Sanitizer dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a,e,d,h,y,I,H){var u=0,G=H.widgets.popup,v=H.widgets.templatePicker;J=J([I,a,e],{declaredClass:"esri.dijit._PopupRenderer",_sanitizer:new b({whiteList:{span:["class"],dd:[],dl:[],dt:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],sub:[],sup:[],animate:[],animatetransform:[],circle:[],clippath:[],defs:[],ellipse:[],g:[],image:[],line:[],lineargradient:[],marker:[],mask:[],path:[],pattern:[],polygon:[],polyline:[],radialgradient:[],rect:[],stop:[],svg:[],"switch":[],symbol:[],
text:[],textpath:[],tspan:[],use:[]}},!0),constructor:function(){this._nls=K.mixin({},G)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'statusSection hidden' dojoAttachPoint\x3d'_status'\x3e\x3c/div\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this._showStatus(v.loading);this._contentDfd=this.template.getComponents(this.graphic).then(K.hitch(this,this._handleComponentsSuccess)).otherwise(K.hitch(this,this._handleComponentsError))},destroy:function(){this._contentDfd&&this._contentDfd.cancel();this._attachmentsDfd&&this._attachmentsDfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._contentDfd=this._attachmentsDfd=null;this.inherited(arguments)},
_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var t=this._mediaInfos,F=t.length,B=this.domNode,O=this._prevMedia,M=this._nextMedia;if(1<F){var C=0,W=0;E.forEach(t,function(Y){"image"===Y.type?C++:-1!==Y.type.indexOf("chart")&&W++});C&&(g.set(this._imageCount,"innerHTML",C),w.query(".summary .image",
B).removeClass("hidden"));W&&(g.set(this._chartCount,"innerHTML",W),w.query(".summary .chart",B).removeClass("hidden"))}else w.query(".summary",B).addClass("hidden"),m.add(O,"hidden"),m.add(M,"hidden");t=this._mediaPtr;0===t?m.add(O,"hidden"):m.remove(O,"hidden");t===F-1?m.add(M,"hidden"):m.remove(M,"hidden");this._destroyFrame()},_displayMedia:function(){var t=this._mediaInfos[this._mediaPtr],F=t.title,B=t.caption,O=w.query(".mediaSection .hzLine",this.domNode)[0];g.set(this._mediaTitle,"innerHTML",
this._sanitizer.sanitize(F));m[F?"remove":"add"](this._mediaTitle,"hidden");g.set(this._mediaCaption,"innerHTML",this._sanitizer.sanitize(B));m[B?"remove":"add"](this._mediaCaption,"hidden");m[F&&B?"remove":"add"](O,"hidden");this._rid=null;if("image"===t.type)this._showImage(t);else{var M=this;F=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"];B=t.value.theme||this.chartTheme;K.isString(B)&&(B=B.replace(/\./gi,"/"),-1===B.indexOf("/")&&(B="dojox/charting/themes/"+B));B||(B="./Rainbow");
F.push(B);try{var C=this._rid=u++;L(F,function(W,Y,R){C===M._rid&&(M._rid=null,M._showChart(t.type,t.value,W,Y,R))})}catch(W){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(t){return(t=t&&K.trim(t).toLowerCase())&&(0===t.indexOf("mailto:")||0===t.indexOf("tel:"))},_showImage:function(t){m.add(this._mediaFrame,"image");var F=f.get(this._gallery,"height"),B=t.value,O=c.decode(B.linkURL);B=c.decode(B.sourceURL);var M;O&&(M=l.create("a",{href:O,target:this._preventNewTab(O)?
"":"_blank"},this._mediaFrame));O=t.refreshInterval?this._addURLParameter(B,"timestamp",Date.now()):B;l.create("img",{className:"esriPopupMediaImage",src:O},M||this._mediaFrame);var C=w.query(".esriPopupMediaImage",this._mediaFrame)[0];this._imageLoadHandle=q.connect(C,"onload",this,function(){this._clearImageHandles();this._imageLoaded(C,F);this._initImageRefresh(t)})},_addURLParameter:function(t,F,B){var O=-1===t.indexOf("?")?"?":"\x26";return t+O+F+"\x3d"+B},_initImageRefresh:function(t){if(t.refreshInterval){var F=
6E4*t.refreshInterval;this._imageRefreshHandle=setTimeout(K.hitch(this,function(){this._destroyFrame();this._showImage(t)}),F)}},_clearImageHandles:function(){q.disconnect(this._imageLoadHandle);this._imageLoadHandle=null;clearTimeout(this._imageRefreshHandle);this._imageRefreshHandle=null},_showChart:function(t,F,B,O,M){m.remove(this._mediaFrame,"image");B=this._chart=new B(l.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});M&&B.setTheme(M);switch(t){case "piechart":B.addPlot("default",
{type:"Pie",labels:!1});B.addSeries("Series A",F.fields);break;case "linechart":B.addPlot("default",{type:"Markers"});B.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});B.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});E.forEach(F.fields,function(C,W){C.x=W+1});B.addSeries("Series A",F.fields);break;case "columnchart":B.addPlot("default",{type:"Columns",gap:3});B.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});B.addSeries("Series A",F.fields);break;
case "barchart":B.addPlot("default",{type:"Bars",gap:3}),B.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),B.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),B.addSeries("Series A",F.fields)}this._action=new O(B);B.render()},_destroyFrame:function(){this._rid=null;this._clearImageHandles();this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);g.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(t,
F){var B=t.height;B<F&&f.set(t,"marginTop",Math.round((F-B)/2)+"px")},_attListHandler:function(t,F){if(t===this._attachmentsDfd){this._attachmentsDfd=null;var B="";F instanceof Error||!F||!F.length||E.forEach(F,function(O){B+="\x3cli\x3e";B+="\x3ca href\x3d'"+y.addProxy(O.url)+"' target\x3d'_blank'\x3e"+(O.name||"[No name]")+"\x3c/a\x3e";B+="\x3c/li\x3e"});g.set(this._attachmentsList,"innerHTML",B||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_createLinkIfURI:function(t,F){var B=y.getURIInfo(t);
if(B){var O=t.match(B.pattern);t=O&&O[2];O=c.decode(O[1]);l.create("a",{target:"_blank",href:O,title:O,innerHTML:this._sanitizer.sanitize(h.substitute({appName:B.appName,hierPart:t},B.label))},F)}else g.set(F,"innerHTML",this._sanitizer.sanitize(t))},_showStatus:function(t){g.set(this._status,"innerHTML",t);m.remove(this._status,"hidden");w.query(".mainSection",this.domNode).addClass("hidden")},_hideStatus:function(){g.set(this._status,"innerHTML","");m.add(this._status,"hidden");w.query(".mainSection",
this.domNode).removeClass("hidden")},_handleComponentsSuccess:function(t){if(t){this._hideStatus();var F=this.showTitle?t.title:"",B=t.description,O=t.fields,M=t.mediaInfos,C=this.domNode,W=this._nls,Y=this,R=this.template,S=this.graphic;this._prevMedia.title=W.NLS_prevMedia;this._nextMedia.title=W.NLS_nextMedia;g.set(this._title,"innerHTML",this._sanitizer.sanitize(F));F||m.add(this._title,"hidden");if(!t.hasDescription&&O&&(B="",O=E.map(O,function(Z){var qa=l.create("tr",{vAlign:"top"});l.create("td",
{className:"attrName",innerHTML:this._sanitizer.sanitize(Z[0])},qa);var ta=l.create("td",{className:"attrValue"},qa);this._createLinkIfURI(Z[1],ta);return qa},this),O.length)){var T=l.create("table",{className:"attrTable",cellPadding:"0px",cellSpacing:"0px"});E.forEach(O,function(Z){T.appendChild(Z)})}T?(this._description.appendChild(T),B=!0):g.set(this._description,"innerHTML",this._sanitizer.sanitize(B));B||m.add(this._description,"hidden");w.query("a",this._description).forEach(function(Z){Y._preventNewTab(Z.href)?
"_blank"===Z.target&&g.remove(Z,"target"):g.set(Z,"target","_blank")});F&&B?w.query(".mainSection .hzLine",C).removeClass("hidden"):F||B?w.query(".mainSection .hzLine",C).addClass("hidden"):w.query(".mainSection",C).addClass("hidden");if(F=this._attachmentsDfd=R.getAttachments(S))F.addBoth(K.hitch(this,this._attListHandler,F)),g.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+W.NLS_searching+"...\x3c/li\x3e"),w.query(".attachmentsSection",C).removeClass("hidden");M&&M.length&&(w.query(".mediaSection",
C).removeClass("hidden"),n.setSelectable(this._mediaFrame,!1),this._mediaInfos=M,this._mediaPtr=0,this._updateUI(),this._displayMedia());t.editSummary&&(g.set(this._editSummary,"innerHTML",this._sanitizer.sanitize(t.editSummary)),M&&M.length&&m.remove(this._mediaBreak,"hidden"),m.remove(this._editSummarySection,"hidden"));this.emit("content-update")}else this._showStatus(G.NLS_noInfo)},_handleComponentsError:function(t){t&&"cancel"===t.dojoType||(console.log("PopupRenderer: error loading template",
t),this._showStatus(G.NLS_noInfo))}});x("extend-esri")&&K.setObject("dijit._PopupRenderer",J,d);return J})},"esri/libs/sanitizer/Sanitizer":function(){!function(L,J){"object"==typeof exports&&"undefined"!=typeof module?module.exports=J():"function"==typeof define&&define.amd?define(J):(L="undefined"!=typeof globalThis?globalThis:L||self).Sanitizer=J()}(this,function(){function L(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,
animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,
"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,
"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,
"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,
"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,
"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,
"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,
"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,
"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,
rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,
"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,
"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}}function J(ea){var va=ea||{},xa={},Da;for(Da in va)xa[Da]=va[Da];(ea=xa).whiteList=ea.whiteList||O.whiteList;ea.onAttr=ea.onAttr||
O.onAttr;ea.onIgnoreAttr=ea.onIgnoreAttr||O.onIgnoreAttr;ea.safeAttrValue=ea.safeAttrValue||O.safeAttrValue;this.options=ea}function q(ea){return ea.replace(S,"\x26lt;").replace(T,"\x26gt;")}function K(ea){return ea.replace(Z,"\x26quot;")}function E(ea){return ea.replace(qa,'"')}function w(ea){return ea.replace(ta,function(va,xa){return"x"===xa[0]||"X"===xa[0]?String.fromCharCode(parseInt(xa.substr(1),16)):String.fromCharCode(parseInt(xa,10))})}function x(ea){return ea.replace(Ba,":").replace(Oa,
" ")}function A(ea){for(var va="",xa=0,Da=ea.length;xa<Da;xa++)va+=32>ea.charCodeAt(xa)?" ":ea.charAt(xa);return Y.trim(va)}function n(ea){return ea=A(ea=x(ea=w(ea=E(ea))))}function g(ea){return ea=q(ea=K(ea))}function m(ea,va){for(;va<ea.length;va++){var xa=ea[va];if(" "!==xa)return"\x3d"===xa?va:-1}}function l(ea,va){for(;0<va;va--){var xa=ea[va];if(" "!==xa)return"\x3d"===xa?va:-1}}function f(ea){return'"'===ea[0]&&'"'===ea[ea.length-1]||"'"===ea[0]&&"'"===ea[ea.length-1]?ea.substr(1,ea.length-
2):ea}function b(ea){var va=ea||{},xa={},Da;for(Da in va)xa[Da]=va[Da];(ea=xa).stripIgnoreTag&&(ea.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),ea.onIgnoreTag=ha.onIgnoreTagStripAll);ea.whiteList=ea.whiteList||ha.whiteList;ea.onTag=ea.onTag||ha.onTag;ea.onTagAttr=ea.onTagAttr||ha.onTagAttr;ea.onIgnoreTag=ea.onIgnoreTag||ha.onIgnoreTag;ea.onIgnoreTagAttr=ea.onIgnoreTagAttr||ha.onIgnoreTagAttr;ea.safeAttrValue=ea.safeAttrValue||
ha.safeAttrValue;ea.escapeHtml=ea.escapeHtml||ha.escapeHtml;this.options=ea;!1===ea.css?this.cssFilter=!1:(ea.css=ea.css||{},this.cssFilter=new ia(ea.css))}var c,a,e=Object.prototype,d=Function.prototype.toString,h=e.hasOwnProperty,y=d.call(Object),I=e.toString,H=(c=Object.getPrototypeOf,a=Object,function(ea){return c(a(ea))}),u=function(ea){var va;if(!(va=!ea||"object"!=typeof ea||"[object Object]"!=I.call(ea))&&(va=!1,null!=ea&&"function"!=typeof ea.toString))try{va=!!(ea+"")}catch(xa){}if(va)return!1;
ea=H(ea);if(null===ea)return!0;ea=h.call(ea,"constructor")&&ea.constructor;return"function"==typeof ea&&ea instanceof ea&&d.call(ea)==y},G={exports:{}},v={};e={exports:{}};var t={},F=/javascript\s*:/gim;t.whiteList=L();t.getDefaultWhiteList=L;t.onAttr=function(ea,va,xa){};t.onIgnoreAttr=function(ea,va,xa){};t.safeAttrValue=function(ea,va){return F.test(va)?"":va};var B={indexOf:function(ea,va){var xa;if(Array.prototype.indexOf)return ea.indexOf(va);var Da=0;for(xa=ea.length;Da<xa;Da++)if(ea[Da]===
va)return Da;return-1},forEach:function(ea,va,xa){var Da;if(Array.prototype.forEach)return ea.forEach(va,xa);var ya=0;for(Da=ea.length;ya<Da;ya++)va.call(xa,ea[ya],ya,ea)},trim:function(ea){return String.prototype.trim?ea.trim():ea.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(ea){return String.prototype.trimRight?ea.trimRight():ea.replace(/(\s*$)/g,"")}},O=t,M=function(ea,va){function xa(){if(!ya){var Xa=B.trim(ea.slice(Ja,Qa)),bb=Xa.indexOf(":");if(-1!==bb){var fb=B.trim(Xa.slice(0,bb));bb=B.trim(Xa.slice(bb+
1));fb&&(Xa=va(Ja,Ma.length,fb,bb,Xa))&&(Ma+=Xa+"; ")}}Ja=Qa+1}";"!==(ea=B.trimRight(ea))[ea.length-1]&&(ea+=";");for(var Da=ea.length,ya=!1,Ja=0,Qa=0,Ma="";Qa<Da;Qa++){var Na=ea[Qa];if("/"===Na&&"*"===ea[Qa+1]){Na=ea.indexOf("*/",Qa+2);if(-1===Na)break;Ja=(Qa=Na+1)+1;ya=!1}else"("===Na?ya=!0:")"===Na?ya=!1:";"===Na?ya||xa():"\n"===Na&&xa()}return B.trim(Ma)};J.prototype.process=function(ea){if(!(ea=(ea=ea||"").toString()))return"";var va=this.options,xa=va.whiteList,Da=va.onAttr,ya=va.onIgnoreAttr,
Ja=va.safeAttrValue;return M(ea,function(Qa,Ma,Na,Xa,bb){var fb=xa[Na],Pa=!1;if(!0===fb?Pa=fb:"function"==typeof fb?Pa=fb(Xa):fb instanceof RegExp&&(Pa=fb.test(Xa)),!0!==Pa&&(Pa=!1),Xa=Ja(Na,Xa)){var r;Qa={position:Ma,sourcePosition:Qa,source:bb,isWhite:Pa};return Pa?null==(r=Da(Na,Xa,Qa))?Na+":"+Xa:r:null==(r=ya(Na,Xa,Qa))?void 0:r}})};!function(ea,va){for(var xa in(va=ea.exports=function(Da,ya){return(new J(ya)).process(Da)}).FilterCSS=J,t)va[xa]=t[xa]}(e,e.exports);var C={indexOf:function(ea,va){var xa;
if(Array.prototype.indexOf)return ea.indexOf(va);var Da=0;for(xa=ea.length;Da<xa;Da++)if(ea[Da]===va)return Da;return-1},forEach:function(ea,va,xa){var Da;if(Array.prototype.forEach)return ea.forEach(va,xa);var ya=0;for(Da=ea.length;ya<Da;ya++)va.call(xa,ea[ya],ya,ea)},trim:function(ea){return String.prototype.trim?ea.trim():ea.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(ea){return(ea=/\s|\n|\t/.exec(ea))?ea.index:-1}},W=e.exports.getDefaultWhiteList,Y=C,R=new e.exports.FilterCSS,S=/</g,T=/>/g,
Z=/"/g,qa=/&quot;/g,ta=/&#([a-zA-Z0-9]*);?/gim,Ba=/&colon;?/gim,Oa=/&newline;?/gim,Ia=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,Ra=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Va=/u\s*r\s*l\s*\(.*/gi,ab=/\x3c!--[\s\S]*?--\x3e/g;v.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:"autoplay controls crossorigin loop muted preload src".split(" "),b:[],bdi:["dir"],bdo:["dir"],
big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],
strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:"autoplay controls crossorigin loop muted playsinline poster preload src height width".split(" ")};v.getDefaultWhiteList=function(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href",
"alt"],article:[],aside:[],audio:"autoplay controls crossorigin loop muted preload src".split(" "),b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],
ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:"autoplay controls crossorigin loop muted playsinline poster preload src height width".split(" ")}};
v.onTag=function(ea,va,xa){};v.onIgnoreTag=function(ea,va,xa){};v.onTagAttr=function(ea,va,xa){};v.onIgnoreTagAttr=function(ea,va,xa){};v.safeAttrValue=function(ea,va,xa,Da){if(xa=n(xa),"href"===va||"src"===va){if("#"===(xa=Y.trim(xa)))return"#";if("http://"!==xa.substr(0,7)&&"https://"!==xa.substr(0,8)&&"mailto:"!==xa.substr(0,7)&&"tel:"!==xa.substr(0,4)&&"data:image/"!==xa.substr(0,11)&&"ftp://"!==xa.substr(0,6)&&"./"!==xa.substr(0,2)&&"../"!==xa.substr(0,3)&&"#"!==xa[0]&&"/"!==xa[0])return""}else if("background"===
va){if(Ia.lastIndex=0,Ia.test(xa))return""}else if("style"===va){if((Ra.lastIndex=0,Ra.test(xa))||(Va.lastIndex=0,Va.test(xa)&&(Ia.lastIndex=0,Ia.test(xa))))return"";!1!==Da&&(xa=(Da=Da||R).process(xa))}return xa=g(xa)};v.escapeHtml=q;v.escapeQuote=K;v.unescapeQuote=E;v.escapeHtmlEntities=w;v.escapeDangerHtml5Entities=x;v.clearNonPrintableCharacter=A;v.friendlyAttrValue=n;v.escapeAttrValue=g;v.onIgnoreTagStripAll=function(){return""};v.StripTagBody=function(ea,va){"function"!=typeof va&&(va=function(){});
var xa=!Array.isArray(ea),Da=[],ya=!1;return{onIgnoreTag:function(Ja,Qa,Ma){return xa||-1!==Y.indexOf(ea,Ja)?Ma.isClosing?(Da.push([!1!==ya?ya:Ma.position,Ma.position+10]),ya=!1,"[/removed]"):(ya||(ya=Ma.position),"[removed]"):va(Ja,Qa,Ma)},remove:function(Ja){var Qa="",Ma=0;return Y.forEach(Da,function(Na){Qa+=Ja.slice(Ma,Na[0]);Ma=Na[1]}),Qa+=Ja.slice(Ma)}}};v.stripCommentTag=function(ea){return ea.replace(ab,"")};v.stripBlankChar=function(ea){ea=ea.split("");return(ea=ea.filter(function(va){va=
va.charCodeAt(0);return 127!==va&&(!(31>=va)||10===va||13===va)})).join("")};v.cssFilter=R;v.getDefaultCSSWhiteList=W;var Q={},ba=/[^a-zA-Z0-9_:\.\-]/gim;Q.parseTag=function(ea,va,xa){var Da="",ya=0,Ja=!1,Qa=!1,Ma=0,Na=ea.length,Xa="",bb="";Ma=0;a:for(;Ma<Na;Ma++)if(bb=ea.charAt(Ma),!1===Ja)"\x3c"===bb&&(Ja=Ma);else if(!1===Qa)if("\x3c"===bb)Da+=xa(ea.slice(ya,Ma)),ya=Ja=Ma;else if("\x3e"===bb)Da+=xa(ea.slice(ya,Ja)),ya=bb=ea.slice(Ja,Ma+1),Xa=C.spaceIndex(ya),ya=-1===Xa?ya.slice(1,-1):ya.slice(1,
Xa+1),Xa=("/"===(ya=C.trim(ya).toLowerCase()).slice(0,1)&&(ya=ya.slice(1)),"/"===ya.slice(-1)&&(ya=ya.slice(0,-1)),ya),Da+=va(Ja,Da.length,Xa,bb,"\x3c/"===bb.slice(0,2)),ya=Ma+1,Ja=!1;else{if('"'===bb||"'"===bb){Xa=1;for(var fb=ea.charAt(Ma-Xa);""===fb.trim()||"\x3d"===fb;){if("\x3d"===fb){Qa=bb;continue a}fb=ea.charAt(Ma-++Xa)}}}else bb===Qa&&(Qa=!1);return ya<ea.length&&(Da+=xa(ea.substr(ya))),Da};Q.parseAttr=function(ea,va){function xa(Xa,bb){1>(Xa=(Xa=C.trim(Xa)).replace(ba,"").toLowerCase()).length||
(Xa=va(Xa,bb||""))&&ya.push(Xa)}for(var Da=0,ya=[],Ja=!1,Qa=ea.length,Ma=0;Ma<Qa;Ma++){var Na=ea.charAt(Ma);if(!1!==Ja||"\x3d"!==Na)if(!1===Ja||Ma!==Da||'"'!==Na&&"'"!==Na||"\x3d"!==ea.charAt(Ma-1))/\s|\n|\t/.test(Na)&&((ea=ea.replace(/\s|\n|\t/g," "),!1===Ja)?-1===(Na=m(ea,Ma))?(xa(C.trim(ea.slice(Da,Ma))),Ja=!1,Da=Ma+1):Ma=Na-1:-1===(Na=l(ea,Ma-1))&&(xa(Ja,f(C.trim(ea.slice(Da,Ma)))),Ja=!1,Da=Ma+1));else{if(-1===(Na=ea.indexOf(Na,Ma+1)))break;xa(Ja,C.trim(ea.slice(Da+1,Na)));Ja=!1;Da=(Ma=Na)+1}else Ja=
ea.slice(Da,Ma),Da=Ma+1}return Da<ea.length&&(!1===Ja?xa(ea.slice(Da)):xa(Ja,f(C.trim(ea.slice(Da))))),C.trim(ya.join(" "))};var ia=e.exports.FilterCSS,ha=v,ua=Q.parseTag,Ga=Q.parseAttr;b.prototype.process=function(ea){if(!(ea=(ea=ea||"").toString()))return"";var va=this.options,xa=va.whiteList,Da=va.onTag,ya=va.onIgnoreTag,Ja=va.onTagAttr,Qa=va.onIgnoreTagAttr,Ma=va.safeAttrValue,Na=va.escapeHtml,Xa=this.cssFilter;va.stripBlankChar&&(ea=ha.stripBlankChar(ea));va.allowCommentTag||(ea=ha.stripCommentTag(ea));
var bb=!1;va.stripIgnoreTagBody&&(bb=ha.StripTagBody(va.stripIgnoreTagBody,ya),ya=bb.onIgnoreTag);ea=ua(ea,function(fb,Pa,r,N,X){Pa={sourcePosition:fb,position:Pa,isClosing:X,isWhite:xa.hasOwnProperty(r)};if(null!=(fb=Da(r,N,Pa)))return fb;if(Pa.isWhite){if(Pa.isClosing)return"\x3c/"+r+"\x3e";fb=function(ka){var ra=C.spaceIndex(ka);if(-1===ra)return{html:"",closing:"/"===ka[ka.length-2]};ra="/"===(ka=C.trim(ka.slice(ra+1,-1)))[ka.length-1];return ra&&(ka=C.trim(ka.slice(0,-1))),{html:ka,closing:ra}}(N);
var ca=xa[r];Pa=Ga(fb.html,function(ka,ra){var k,z=-1!==C.indexOf(ca,ka);return null==(k=Ja(r,ka,ra,z))?z?(ra=Ma(r,ka,ra,Xa))?ka+'\x3d"'+ra+'"':ka:null==(k=Qa(r,ka,ra,z))?void 0:k:k});N="\x3c"+r;return Pa&&(N+=" "+Pa),fb.closing&&(N+=" /"),N+="\x3e"}return null==(fb=ya(r,N,Pa))?Na(N):fb},Na);return bb&&(ea=bb.remove(ea)),ea};return function(ea,va){function xa(Ja,Qa){return(new Da(Qa)).process(Ja)}var Da=b,ya;for(ya in(va=ea.exports=xa).filterXSS=xa,va.FilterXSS=Da,v)va[ya]=v[ya];for(ya in Q)va[ya]=
Q[ya];"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=ea.exports)}(G,G.exports),function(){function ea(va,xa){var Da,ya=this;this.arcgisWhiteList={a:["href","target","style"],abbr:["title"],img:"src width height border alt style".split(" "),video:"autoplay controls height loop muted poster preload width".split(" "),audio:["autoplay","controls","loop","muted","preload"],source:["media","src","type"],span:["style"],
table:"width height cellpadding cellspacing border style".split(" "),div:["style","align"],font:["size","color","style","face"],tr:["height","valign","align","style"],td:"height width valign align colspan rowspan nowrap style".split(" "),th:"height width valign align colspan rowspan nowrap style".split(" "),p:["style"],b:[],strong:[],i:[],em:[],u:[],br:[],li:[],ul:[],ol:[],hr:[],tbody:[]};this.allowedProtocols="http https mailto iform tel flow lfmobile arcgis-navigator arcgis-appstudio-player arcgis-survey123 arcgis-collector arcgis-workforce arcgis-explorer arcgis-trek2there mspbi comgooglemaps pdfefile pdfehttp pdfehttps boxapp boxemm awb awbs gropen radarscope".split(" ");
this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(Ja,Qa,Ma,Na){return"a"===Ja&&"href"===Qa||("img"===Ja||"source"===Ja)&&"src"===Qa?ya.sanitizeUrl(Ma):G.exports.safeAttrValue(Ja,Qa,Ma,Na)}};va&&!xa?Da=va:va&&xa?(Da=Object.create(this.arcgisFilterOptions),Object.keys(va).forEach(function(Ja){"whiteList"===Ja?Da.whiteList=ya._extendObjectOfArrays([ya.arcgisWhiteList,va.whiteList||{}]):Da[Ja]=va[Ja]})):(Da=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList;this.xssFilterOptions=
Da;this._xssFilter=new G.exports.FilterXSS(Da)}return ea.prototype.sanitize=function(va,xa){switch(void 0===xa&&(xa={}),typeof va){case "number":return isNaN(va)||!isFinite(va)?null:va;case "boolean":return va;case "string":return this._xssFilter.process(va);case "object":return this._iterateOverObject(va,xa);default:if(!xa.allowUndefined||void 0!==va)return null}},ea.prototype.sanitizeUrl=function(va){var xa=this._trim(va.substring(0,va.indexOf(":")));return"/"===va||"#"===va||"#"===va[0]||-1<this.allowedProtocols.indexOf(xa.toLowerCase())?
G.exports.escapeAttrValue(va):""},ea.prototype.sanitizeHTMLAttribute=function(va,xa,Da,ya){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(va,xa,Da,ya):G.exports.safeAttrValue(va,xa,Da,ya)},ea.prototype.validate=function(va,xa){void 0===xa&&(xa={});xa=this.sanitize(va,xa);return{isValid:va===xa,sanitized:xa}},ea.prototype._extendObjectOfArrays=function(va){var xa={};return va.forEach(function(Da){Object.keys(Da).forEach(function(ya){Array.isArray(Da[ya])&&
Array.isArray(xa[ya])?xa[ya]=xa[ya].concat(Da[ya]):xa[ya]=Da[ya]})}),xa},ea.prototype._iterateOverObject=function(va,xa){var Da=this;void 0===xa&&(xa={});try{var ya=!1,Ja=void 0;if(Array.isArray(va))Ja=va.reduce(function(Qa,Ma){var Na=Da.validate(Ma,xa);return Na.isValid?Qa.concat([Ma]):(ya=!0,Qa.concat([Na.sanitized]))},[]);else{if(!u(va))return xa.allowUndefined&&void 0===va?void 0:null;Ja=Object.keys(va).reduce(function(Qa,Ma){var Na=va[Ma],Xa=Da.validate(Na,xa);return Xa.isValid?Qa[Ma]=Na:(ya=
!0,Qa[Ma]=Xa.sanitized),Qa},{})}return ya?Ja:va}catch(Qa){return null}},ea.prototype._trim=function(va){return String.prototype.trim?va.trim():va.replace(/(^\s*)|(\s*$)/g,"")},ea}()})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(L,J,q,K,E,w,x){w.extend(L,{waiRole:"",waiState:""});return E("dijit._Templated",[J,q],{constructor:function(){x.deprecated(this.declaredClass+
": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0")},_processNode:function(A,n){var g=this.inherited(arguments),m=n(A,"waiRole");m&&A.setAttribute("role",m);(m=n(A,"waiState"))&&K.forEach(m.split(/\s*,\s*/),function(l){-1!=l.indexOf("-")&&(l=l.split("-"),A.setAttribute("aria-"+l[0],l[1]))});return g}})})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],
function(L,J,q,K,E){return q("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var w=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);E.parse(w,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(K.hitch(this,
function(x){this._startupWidgets=x;for(var A=0;A<x.length;A++)this._processTemplateNode(x[A],function(n,g){return n[g]},function(n,g,m){return g in n?n.connect(n,g,m):n.on(g,m,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");
}},_processTemplateNode:function(w,x,A){return x(w,"dojoType")||x(w,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){L.forEach(this._startupWidgets,function(w){w&&!w._started&&w.startup&&w.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(L,
J,q,K,E,w,x,A,n,g,m,l,f,b,c,a){function e(H){return eval("("+H+")")}function d(H){var u=H._nameCaseMap,G=H.prototype;if(!u||u._extendCnt<y){u=H._nameCaseMap={};for(var v in G)"_"!==v.charAt(0)&&(u[v.toLowerCase()]=v);u._extendCnt=y}return u}function h(H,u){u||(u=L);var G=u._dojoParserCtorMap||(u._dojoParserCtorMap={}),v=H.join();if(!G[v]){for(var t=[],F=0,B=H.length;F<B;F++){var O=H[F];t[t.length]=G[O]=G[O]||q.getObject(O)||~O.indexOf("/")&&u(O)}H=t.shift();G[v]=t.length?H.createSubclass?H.createSubclass(t):
H.extend.apply(H,t):H}return G[v]}new Date("X");var y=0;n.after(q,"extend",function(){y++},!0);var I={_clearCache:function(){y++;_ctorMap={}},_functionFromScript:function(H,u){var G="",v="",t=H.getAttribute(u+"args")||H.getAttribute("args");u=H.getAttribute("with");t=(t||"").split(/\s*,\s*/);u&&u.length&&K.forEach(u.split(/\s*,\s*/),function(F){G+="with("+F+"){";v+="}"});return new Function(t,G+H.innerHTML+v)},instantiate:function(H,u,G){u=u||{};G=G||{};var v=(G.scope||J._scopeName)+"Type",t="data-"+
(G.scope||J._scopeName)+"-",F=t+"type",B=t+"mixins",O=[];K.forEach(H,function(M){var C=v in u?u[v]:M.getAttribute(F)||M.getAttribute(v);if(C){var W=M.getAttribute(B);C=W?[C].concat(W.split(/\s*,\s*/)):[C];O.push({node:M,types:C})}});return this._instantiate(O,u,G)},_instantiate:function(H,u,G,v){function t(F){u._started||G.noStart||K.forEach(F,function(B){"function"!==typeof B.startup||B._started||B.startup()});return F}H=K.map(H,function(F){var B=F.ctor||h(F.types,G.contextRequire);if(!B)throw Error("Unable to resolve constructor for: '"+
F.types.join()+"'");return this.construct(B,F.node,u,G,F.scripts,F.inherited)},this);return v?g(H).then(t):t(H)},construct:function(H,u,G,v,t,F){function B(Va){T&&q.setObject(T,Va);for(R=0;R<Ba.length;R++)n[Ba[R].advice||"after"](Va,Ba[R].method,q.hitch(Va,Ba[R].func),!0);for(R=0;R<Oa.length;R++)Oa[R].call(Va);for(R=0;R<Ia.length;R++)Va.watch(Ia[R].prop,Ia[R].func);for(R=0;R<Ra.length;R++)c(Va,Ra[R].event,Ra[R].func);return Va}var O=H&&H.prototype;v=v||{};var M={};v.defaults&&q.mixin(M,v.defaults);
F&&q.mixin(M,F);if(f("dom-attributes-explicit"))var C=u.attributes;else f("dom-attributes-specified-flag")?C=K.filter(u.attributes,function(Va){return Va.specified}):(F=(/^input$|^img$/i.test(u.nodeName)?u:u.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),C=K.map(F.split(/\s+/),function(Va){var ab=Va.toLowerCase();return{name:Va,value:"LI"==u.nodeName&&"value"==Va||"enctype"==ab?u.getAttribute(ab):u.getAttributeNode(ab).value}}));
var W=v.scope||J._scopeName;F="data-"+W+"-";var Y={};"dojo"!==W&&(Y[F+"props"]="data-dojo-props",Y[F+"type"]="data-dojo-type",Y[F+"mixins"]="data-dojo-mixins",Y[W+"type"]="dojotype",Y[F+"id"]="data-dojo-id");var R=0,S;W=[];for(var T,Z;S=C[R++];){var qa=S.name,ta=qa.toLowerCase();S=S.value;switch(Y[ta]||ta){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":Z=S;break;case "data-dojo-id":case "jsid":T=S;break;case "data-dojo-attach-point":case "dojoattachpoint":M.dojoAttachPoint=
S;break;case "data-dojo-attach-event":case "dojoattachevent":M.dojoAttachEvent=S;break;case "class":M["class"]=u.className;break;case "style":M.style=u.style&&u.style.cssText;break;default:if(qa in O||(qa=d(H)[ta]||qa),qa in O)switch(typeof O[qa]){case "string":M[qa]=S;break;case "number":M[qa]=S.length?Number(S):NaN;break;case "boolean":M[qa]="false"!=S.toLowerCase();break;case "function":""===S||-1!=S.search(/[^\w\.]+/i)?M[qa]=new Function(S):M[qa]=q.getObject(S,!1)||new Function(S);W.push(qa);
break;default:ta=O[qa],M[qa]=ta&&"length"in ta?S?S.split(/\s*,\s*/):[]:ta instanceof Date?""==S?new Date(""):"now"==S?new Date:m.fromISOString(S):ta instanceof A?J.baseUrl+S:e(S)}else M[qa]=S}}for(C=0;C<W.length;C++)Y=W[C].toLowerCase(),u.removeAttribute(Y),u[Y]=null;if(Z)try{Z=e.call(v.propsThis,"{"+Z+"}"),q.mixin(M,Z)}catch(Va){throw Error(Va.toString()+" in data-dojo-props\x3d'"+Z+"'");}q.mixin(M,G);t||(t=H&&(H._noScript||O._noScript)?[]:b("\x3e script[type^\x3d'dojo/']",u));var Ba=[],Oa=[],Ia=
[],Ra=[];if(t)for(R=0;R<t.length;R++)Y=t[R],u.removeChild(Y),G=Y.getAttribute(F+"event")||Y.getAttribute("event"),v=Y.getAttribute(F+"prop"),Z=Y.getAttribute(F+"method"),W=Y.getAttribute(F+"advice"),C=Y.getAttribute("type"),Y=this._functionFromScript(Y,F),G?"dojo/connect"==C?Ba.push({method:G,func:Y}):"dojo/on"==C?Ra.push({event:G,func:Y}):M[G]=Y:"dojo/aspect"==C?Ba.push({method:Z,advice:W,func:Y}):"dojo/watch"==C?Ia.push({prop:v,func:Y}):Oa.push(Y);H=(t=H.markupFactory||O.markupFactory)?t(M,u,H):
new H(M,u);return H.then?H.then(B):B(H)},scan:function(H,u){function G(ta){if(!ta.inherited){ta.inherited={};var Ba=ta.node,Oa=G(ta.parent);Ba={dir:Ba.getAttribute("dir")||Oa.dir,lang:Ba.getAttribute("lang")||Oa.lang,textDir:Ba.getAttribute(C)||Oa.textDir};for(var Ia in Ba)Ba[Ia]&&(ta.inherited[Ia]=Ba[Ia])}return ta.inherited}var v=[],t=[],F={},B=(u.scope||J._scopeName)+"Type",O="data-"+(u.scope||J._scopeName)+"-",M=O+"type",C=O+"textdir";O+="mixins";var W=H.firstChild,Y=u.inherited;if(!Y){Y=function Ia(Ba,
Oa){return Ba.getAttribute&&Ba.getAttribute(Oa)||Ba.parentNode&&Ia(Ba.parentNode,Oa)};Y={dir:Y(H,"dir"),lang:Y(H,"lang"),textDir:Y(H,C)};for(var R in Y)Y[R]||delete Y[R]}R={inherited:Y};for(var S,T;;)if(W)if(1!=W.nodeType)W=W.nextSibling;else if(S&&"script"==W.nodeName.toLowerCase())(Y=W.getAttribute("type"))&&/^dojo\/\w/i.test(Y)&&S.push(W),W=W.nextSibling;else if(T)W=W.nextSibling;else if(Y=W.getAttribute(M)||W.getAttribute(B),H=W.firstChild,Y||H&&(3!=H.nodeType||H.nextSibling)){T=null;if(Y){var Z=
W.getAttribute(O);S=Z?[Y].concat(Z.split(/\s*,\s*/)):[Y];try{T=h(S,u.contextRequire)}catch(ta){}T||K.forEach(S,function(ta){~ta.indexOf("/")&&!F[ta]&&(F[ta]=!0,t[t.length]=ta)});Z=T&&!T.prototype._noScript?[]:null;R={types:S,ctor:T,parent:R,node:W,scripts:Z};R.inherited=G(R);v.push(R)}else R={node:W,scripts:S,parent:R};S=Z;T=W.stopParser||T&&T.prototype.stopParser&&!u.template;W=H}else W=W.nextSibling;else{if(!R||!R.node)break;W=R.node.nextSibling;T=!1;R=R.parent;S=R.scripts}var qa=new l;t.length?
(f("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+t.join(", ")),(u.contextRequire||L)(t,function(){qa.resolve(K.filter(v,function(ta){if(!ta.ctor)try{ta.ctor=h(ta.types,u.contextRequire)}catch(Ia){}for(var Ba=ta.parent;Ba&&!Ba.types;)Ba=Ba.parent;var Oa=ta.ctor&&ta.ctor.prototype;ta.instantiateChildren=!(Oa&&Oa.stopParser&&!u.template);ta.instantiate=!Ba||Ba.instantiate&&Ba.instantiateChildren;return ta.instantiate}))})):qa.resolve(v);return qa.promise},_require:function(H,
u){H=e("{"+H.innerHTML+"}");var G=[],v=[],t=new l;u=u&&u.contextRequire||L;for(var F in H)G.push(F),v.push(H[F]);u(v,function(){for(var B=0;B<G.length;B++)q.setObject(G[B],arguments[B]);t.resolve(arguments)});return t.promise},_scanAmd:function(H,u){var G=new l,v=G.promise;G.resolve(!0);var t=this;b("script[type\x3d'dojo/require']",H).forEach(function(F){v=v.then(function(){return t._require(F,u)});F.parentNode.removeChild(F)});return v},parse:function(H,u){!H||"string"==typeof H||"nodeType"in H||
(u=H,H=u.rootNode);var G=H?w.byId(H):x.body();u=u||{};var v=u.template?{template:!0}:{},t=[],F=this;H=this._scanAmd(G,u).then(function(){return F.scan(G,u)}).then(function(B){return F._instantiate(B,v,u,!0)}).then(function(B){return t=t.concat(B)}).otherwise(function(B){console.error("dojo/parser::parse() error",B);throw B;});q.mixin(t,H);return t}};J.parser=I;E.parseOnLoad&&a(100,I,"parse");return I})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),
function(L,J,q,K,E,w){return L([w,E],{_onMap:function(x){var A=this.constructor._onMap;A&&A.FINAL||(delete this.constructor._onMap,A=this.registerConnectEvents(),A.FINAL=!0);x=x.toLowerCase();if(A[x])var n=this[A[x].method];else x=this._onCamelCase(x),this[x]&&(n=x);return n},on:function(x,A){var n=this._onMap(x),g=x.replace(/\-/g,""),m="on"+g in this.domNode;return n||!m?this.inherited(arguments):this.own(K(this.domNode,g,A))[0]},emit:function(x,A,n){var g,m=x.toLowerCase(),l=this.constructor._onMap||
this.registerConnectEvents();var f=this[this._onMap(m)];A=A||{};A.target||(A.target=this);if(f&&l&&l[m]){this._onObj2Arr(function(){g=Array.prototype.slice.call(arguments)},l[m].argKeys)(A);var b=J.mixin({},arguments);b[2]=g;b[0]=l[m].name.replace(/^on/,"")}return this.inherited(b||arguments)}})})},"esri/tasks/GeometryService":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ./Task ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/jsonUtils".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c){L=L(g,{declaredClass:"esri.tasks.GeometryService",_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"densify-complete":["geometries"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],
"offset-complete":["geometries"],"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]},constructor:function(a){a=J.hitch;this._projectHandler=a(this,this._projectHandler);this._simplifyHandler=a(this,this._simplifyHandler);this._bufferHandler=a(this,this._bufferHandler);this._areasAndLengthsHandler=a(this,this._areasAndLengthsHandler);this._lengthsHandler=
a(this,this._lengthsHandler);this._labelPointsHandler=a(this,this._labelPointsHandler);this._relationHandler=a(this,this._relationHandler);this._convexHullHandler=a(this,this._convexHullHandler);this._unionHandler=a(this,this._unionHandler);this._autoCompleteHandler=a(this,this._autoCompleteHandler);this._reshapeHandler=a(this,this._reshapeHandler);this._cutHandler=a(this,this._cutHandler);this._intersectHandler=a(this,this._intersectHandler);this._differenceHandler=a(this,this._differenceHandler);
this._trimExtendHandler=a(this,this._trimExtendHandler);this._densifyHandler=a(this,this._densifyHandler);this._generalizeHandler=a(this,this._densifyHandler);this._offsetHandler=a(this,this._offsetHandler);this._distanceHandler=a(this,this._distanceHandler);this._toGeoCoordinateHandler=a(this,this._toGeoCoordinateHandler);this._fromGeoCoordinateHandler=a(this,this._fromGeoCoordinateHandler);this.registerConnectEvents()},_encodeGeometries:function(a){var e=[],d,h=a.length;for(d=0;d<h;d++)e.push(a[d].toJson());
return{geometryType:c.getJsonType(a[0]),geometries:e}},_decodeGeometries:function(a,e,d){var h=c.getGeometryType(e);a=a.geometries;var y=[],I={spatialReference:d.toJson()},H=J.mixin;q.forEach(a,function(u,G){y[G]=new h(H(u,I))});return y},_toProjectGeometry:function(a){var e=a.spatialReference.toJson();return a instanceof m?new f({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:e}):new l({paths:[[].concat(a.points)],spatialReference:e})},
_fromProjectedGeometry:function(a,e,d){return"esriGeometryEnvelope"===e?(a=a.rings[0],new m(a[0][0],a[0][1],a[2][0],a[2][1],d)):new b({points:a.paths[0],spatialReference:d.toJson()})},project:function(a,e,d,h){var y=J.mixin({},this._url.query,{f:"json"});if(a.geometries){h=d;d=e;e=a.outSR;var I=a.geometries[0];y=J.mixin(y,a.toJson())}else I=a[0],y=J.mixin(y,{outSR:e.wkid||K.toJson(e.toJson()),inSR:I.spatialReference.wkid||K.toJson(I.spatialReference.toJson()),geometries:K.toJson(this._encodeGeometries(a))});
var H=c.getJsonType(I),u=this._projectHandler,G=this._errorHandler,v=new E(n._dfdCanceller);v._pendingDfd=A({url:this._url.path+"/project",content:y,callbackParamName:"callback",load:function(t,F){u(t,F,H,e,d,h,v)},error:function(t){G(t,h,v)}});return v},_projectHandler:function(a,e,d,h,y,I,H){try{var u=this._decodeGeometries(a,d,h);this._successHandler([u],"onProjectComplete",y,H)}catch(G){this._errorHandler(G,I,H)}},onProjectComplete:function(){},simplify:function(a,e,d){var h=a[0].spatialReference,
y=J.mixin({},this._url.query,{f:"json",sr:h.wkid?h.wkid:K.toJson(h.toJson()),geometries:K.toJson(this._encodeGeometries(a))}),I=c.getJsonType(a[0]),H=this._simplifyHandler,u=this._errorHandler,G=new E(n._dfdCanceller);G._pendingDfd=A({url:this._url.path+"/simplify",content:y,callbackParamName:"callback",load:function(v,t){H(v,t,I,h,e,d,G)},error:function(v){u(v,d,G)}});return G},_simplifyHandler:function(a,e,d,h,y,I,H){try{var u=this._decodeGeometries(a,d,h);this._successHandler([u],"onSimplifyComplete",
y,H)}catch(G){this._errorHandler(G,I,H)}},onSimplifyComplete:function(){},convexHull:function(a,e,d){var h=a[0].spatialReference;a=J.mixin({},this._url.query,{f:"json",sr:K.toJson(h.toJson()),geometries:K.toJson(this._encodeGeometries(a))});var y=this._convexHullHandler,I=this._errorHandler,H=new E(n._dfdCanceller);H._pendingDfd=A({url:this._url.path+"/convexHull",content:a,callbackParamName:"callback",load:function(u,G){y(u,G,h,e,d,H)},error:function(u){I(u,d,H)}});return H},_convexHullHandler:function(a,
e,d,h,y,I){try{var H=c.fromJson(a.geometry).setSpatialReference(d);this._successHandler([H],"onConvexHullComplete",h,I)}catch(u){this._errorHandler(u,y,I)}},onConvexHullComplete:function(){},union:function(a,e,d){var h=a[0].spatialReference;a=J.mixin({},this._url.query,{f:"json",sr:K.toJson(h.toJson()),geometries:K.toJson(this._encodeGeometries(a))});var y=this._unionHandler,I=this._errorHandler,H=new E(n._dfdCanceller);H._pendingDfd=A({url:this._url.path+"/union",content:a,callbackParamName:"callback",
load:function(u,G){y(u,G,h,e,d,H)},error:function(u){I(u,d,H)}});return H},_unionHandler:function(a,e,d,h,y,I){try{var H=c.fromJson(a.geometry).setSpatialReference(d);this._successHandler([H],"onUnionComplete",h,I)}catch(u){this._errorHandler(u,y,I)}},onUnionComplete:function(){},autoComplete:function(a,e,d,h){var y=a[0].spatialReference;a=J.mixin({},this._url.query,{f:"json",sr:K.toJson(y.toJson()),polygons:K.toJson(this._encodeGeometries(a).geometries),polylines:K.toJson(this._encodeGeometries(e).geometries)});
var I=this._autoCompleteHandler,H=this._errorHandler,u=new E(n._dfdCanceller);u._pendingDfd=A({url:this._url.path+"/autoComplete",content:a,callbackParamName:"callback",load:function(G,v){I(G,v,y,d,h,u)},error:function(G){H(G,h,u)}});return u},_autoCompleteHandler:function(a,e,d,h,y,I){try{var H=a.geometries;a=[];var u,G=H.length;for(u=0;u<G;u++)a[u]=new f({spatialReference:d,rings:H[u].rings});this._successHandler([a],"onAutoCompleteComplete",h,I)}catch(v){this._errorHandler(v,y,I)}},onAutoCompleteComplete:function(){},
reshape:function(a,e,d,h){var y=a.spatialReference;a=J.mixin({},this._url.query,{f:"json",sr:K.toJson(y.toJson()),target:K.toJson({geometryType:c.getJsonType(a),geometry:a.toJson()}),reshaper:K.toJson(e.toJson())});var I=this._reshapeHandler,H=this._errorHandler,u=new E(n._dfdCanceller);u._pendingDfd=A({url:this._url.path+"/reshape",content:a,callbackParamName:"callback",load:function(G,v){I(G,v,y,d,h,u)},error:function(G){H(G,h,u)}});return u},_reshapeHandler:function(a,e,d,h,y,I){try{var H=c.fromJson(a.geometry).setSpatialReference(d);
this._successHandler([H],"onReshapeComplete",h,I)}catch(u){this._errorHandler(u,y,I)}},onReshapeComplete:function(){},cut:function(a,e,d,h){var y=a[0].spatialReference,I=q.map(a,function(v){return v.toJson()});a=J.mixin({},this._url.query,{f:"json",sr:K.toJson(y.toJson()),target:K.toJson({geometryType:c.getJsonType(a[0]),geometries:I}),cutter:K.toJson(e.toJson())});var H=this._cutHandler,u=this._errorHandler,G=new E(n._dfdCanceller);G._pendingDfd=A({url:this._url.path+"/cut",content:a,callbackParamName:"callback",
load:function(v,t){H(v,t,y,d,h,G)},error:function(v){u(v,h,G)}});return G},_cutHandler:function(a,e,d,h,y,I){try{var H=a.geometries,u={};u.cutIndexes=a.cutIndexes;u.geometries=[];q.forEach(H,function(G){u.geometries.push(c.fromJson(G).setSpatialReference(d))});this._successHandler([u],"onCutComplete",h,I)}catch(G){this._errorHandler(G,y,I)}},onCutComplete:function(){},intersect:function(a,e,d,h){var y=a[0].spatialReference;a=J.mixin({},this._url.query,{f:"json",sr:K.toJson(y.toJson()),geometries:K.toJson(this._encodeGeometries(a)),
geometry:K.toJson({geometryType:c.getJsonType(e),geometry:e.toJson()})});var I=this._intersectHandler,H=this._errorHandler,u=new E(n._dfdCanceller);u._pendingDfd=A({url:this._url.path+"/intersect",content:a,callbackParamName:"callback",load:function(G,v){I(G,v,y,d,h,u)},error:function(G){H(G,h,u)}});return u},_intersectHandler:function(a,e,d,h,y,I){try{var H=[];q.forEach(a.geometries,function(u){H.push(c.fromJson(u).setSpatialReference(d))});this._successHandler([H],"onIntersectComplete",h,I)}catch(u){this._errorHandler(u,
y,I)}},onIntersectComplete:function(){},difference:function(a,e,d,h){var y=a[0].spatialReference;a=J.mixin({},this._url.query,{f:"json",sr:K.toJson(y.toJson()),geometries:K.toJson(this._encodeGeometries(a)),geometry:K.toJson({geometryType:c.getJsonType(e),geometry:e.toJson()})});var I=this._differenceHandler,H=this._errorHandler,u=new E(n._dfdCanceller);u._pendingDfd=A({url:this._url.path+"/difference",content:a,callbackParamName:"callback",load:function(G,v){I(G,v,y,d,h,u)},error:function(G){H(G,
h,u)}});return u},_differenceHandler:function(a,e,d,h,y,I){try{var H=[];q.forEach(a.geometries,function(u){H.push(c.fromJson(u).setSpatialReference(d))});this._successHandler([H],"onDifferenceComplete",h,I)}catch(u){this._errorHandler(u,y,I)}},onDifferenceComplete:function(){},buffer:function(a,e,d){var h=J.mixin({},this._url.query,{f:"json"},a.toJson()),y=a.outSpatialReference||a.geometries[0].spatialReference,I=this._bufferHandler,H=this._errorHandler,u=new E(n._dfdCanceller);u._pendingDfd=A({url:this._url.path+
"/buffer",content:h,callbackParamName:"callback",load:function(G,v){I(G,v,y,e,d,u)},error:function(G){H(G,d,u)}});return u},_bufferHandler:function(a,e,d,h,y,I){try{var H=a.geometries;a=[];var u,G=H.length;for(u=0;u<G;u++)a[u]=new f({spatialReference:d,rings:H[u].rings});this._successHandler([a],"onBufferComplete",h,I)}catch(v){this._errorHandler(v,y,I)}},onBufferComplete:function(){},areasAndLengths:function(a,e,d){a=J.mixin({},this._url.query,{f:"json"},a.toJson());var h=this._areasAndLengthsHandler,
y=this._errorHandler,I=new E(n._dfdCanceller);I._pendingDfd=A({url:this._url.path+"/areasAndLengths",content:a,callbackParamName:"callback",load:function(H,u){h(H,u,e,d,I)},error:function(H){y(H,d,I)}});return I},_areasAndLengthsHandler:function(a,e,d,h,y){try{this._successHandler([a],"onAreasAndLengthsComplete",d,y)}catch(I){this._errorHandler(I,h,y)}},onAreasAndLengthsComplete:function(){},lengths:function(a,e,d){a=J.mixin({},this._url.query,{f:"json"},a.toJson());var h=this._lengthsHandler,y=this._errorHandler,
I=new E(n._dfdCanceller);I._pendingDfd=A({url:this._url.path+"/lengths",content:a,callbackParamName:"callback",load:function(H,u){h(H,u,e,d,I)},error:function(H){y(H,d,I)}});return I},_lengthsHandler:function(a,e,d,h,y){try{this._successHandler([a],"onLengthsComplete",d,y)}catch(I){this._errorHandler(I,h,y)}},onLengthsComplete:function(){},labelPoints:function(a,e,d){var h=q.map(a,function(G){return G.toJson()}),y=a[0].spatialReference;h=J.mixin({},this._url.query,{f:"json",sr:y.wkid?y.wkid:K.toJson(y.toJson()),
polygons:K.toJson(h)});var I=this._labelPointsHandler,H=this._errorHandler,u=new E(n._dfdCanceller);u._pendingDfd=A({url:this._url.path+"/labelPoints",content:h,callbackParamName:"callback",load:function(G,v){I(G,v,a,y,e,d,u)},error:function(G){H(G,d,u)}});return u},_labelPointsHandler:function(a,e,d,h,y,I,H){try{var u=[];q.forEach(a.labelPoints,function(G){u.push(c.fromJson(G).setSpatialReference(h))});this._successHandler([u],"onLabelPointsComplete",y,H)}catch(G){this._errorHandler(G,I,H)}},onLabelPointsComplete:function(){},
relation:function(a,e,d){a=J.mixin({},this._url.query,{f:"json"},a.toJson());var h=this._relationHandler,y=this._errorHandler,I=new E(n._dfdCanceller);I._pendingDfd=A({url:this._url.path+"/relation",content:a,callbackParamName:"callback",load:function(H,u){h(H,u,e,d,I)},error:function(H){y(H,d,I)}});return I},_relationHandler:function(a,e,d,h,y){try{this._successHandler([a.relations],"onRelationComplete",d,y)}catch(I){this._errorHandler(I,h,y)}},onRelationComplete:function(){},trimExtend:function(a,
e,d){var h=J.mixin({},this._url.query,{f:"json"},a.toJson()),y=a.sr,I=this._trimExtendHandler,H=this._errorHandler,u=new E(n._dfdCanceller);u._pendingDfd=A({url:this._url.path+"/trimExtend",content:h,callbackParamName:"callback",load:function(G,v){I(G,v,y,e,d,u)},error:function(G){H(G,d,u)}});return u},_trimExtendHandler:function(a,e,d,h,y,I){try{var H=a.geometries;a=[];var u,G=H.length;for(u=0;u<G;u++)a[u]=new l({spatialReference:d,paths:H[u].paths});this._successHandler([a],"onTrimExtendComplete",
h,I)}catch(v){this._errorHandler(v,y,I)}},onTrimExtendComplete:function(){},densify:function(a,e,d){var h=J.mixin({},this._url.query,{f:"json"},a.toJson()),y=a.geometries[0].spatialReference,I=this._densifyHandler,H=this._errorHandler,u=new E(n._dfdCanceller);u._pendingDfd=A({url:this._url.path+"/densify",content:h,callbackParamName:"callback",load:function(G,v){I(G,v,y,e,d,u)},error:function(G){H(G,d,u)}});return u},_densifyHandler:function(a,e,d,h,y,I){try{var H=[];q.forEach(a.geometries,function(u){H.push(c.fromJson(u).setSpatialReference(d))});
this._successHandler([H],"onDensifyComplete",h,I)}catch(u){this._errorHandler(u,y,I)}},onDensifyComplete:function(){},generalize:function(a,e,d){var h=J.mixin({},this._url.query,{f:"json"},a.toJson()),y=a.geometries[0].spatialReference,I=this._generalizeHandler,H=this._errorHandler,u=new E(n._dfdCanceller);u._pendingDfd=A({url:this._url.path+"/generalize",content:h,callbackParamName:"callback",load:function(G,v){I(G,v,y,e,d,u)},error:function(G){H(G,d,u)}});return u},_generalizeHandler:function(a,
e,d,h,y,I){try{var H=[];q.forEach(a.geometries,function(u){H.push(c.fromJson(u).setSpatialReference(d))});this._successHandler([H],"onGeneralizeComplete",h,I)}catch(u){this._errorHandler(u,y,I)}},onGeneralizeComplete:function(){},offset:function(a,e,d){var h=J.mixin({},this._url.query,{f:"json"},a.toJson()),y=a.geometries[0].spatialReference,I=this._offsetHandler,H=this._errorHandler,u=new E(n._dfdCanceller);u._pendingDfd=A({url:this._url.path+"/offset",content:h,callbackParamName:"callback",load:function(G,
v){I(G,v,y,e,d,u)},error:function(G){H(G,d,u)}});return u},_offsetHandler:function(a,e,d,h,y,I){try{var H=[];q.forEach(a.geometries,function(u){H.push(c.fromJson(u).setSpatialReference(d))});this._successHandler([H],"onOffsetComplete",h,I)}catch(u){this._errorHandler(u,y,I)}},onOffsetComplete:function(){},distance:function(a,e,d){var h=J.mixin({},this._url.query,{f:"json"},a.toJson()),y=a.geometry1.spatialReference,I=this._distanceHandler,H=this._errorHandler,u=new E(n._dfdCanceller);u._pendingDfd=
A({url:this._url.path+"/distance",content:h,callbackParamName:"callback",load:function(G,v){I(G,v,y,e,d,u)},error:function(G){H(G,d,u)}});return u},_distanceHandler:function(a,e,d,h,y,I){try{a=a&&a.distance,this._successHandler([a],"onDistanceComplete",h,I)}catch(H){this._errorHandler(H,y,I)}},onDistanceComplete:function(){},toGeoCoordinateString:function(a,e,d){var h={};J.isObject(a.sr)?h.sr=a.sr.wkid||K.toJson(a.sr.toJson()):h.sr=a.sr;h.coordinates=K.toJson(a.coordinates);h.conversionType=a.conversionType||
"MGRS";h.conversionMode=a.conversionMode;h.numOfDigits=a.numOfDigits;h.rounding=a.rounding;h.addSpaces=a.addSpaces;a=J.mixin({},this._url.query,{f:"json"},h);var y=this._toGeoCoordinateHandler,I=this._errorHandler,H=new E(n._dfdCanceller);H._pendingDfd=A({url:this._url.path+"/toGeoCoordinateString",content:a,callbackParamName:"callback",load:function(u,G){y(u,G,e,d,H)},error:function(u){I(u,d,H)}});return H},_toGeoCoordinateHandler:function(a,e,d,h,y){try{this._successHandler([a.strings],"onToGeoCoordinateStringComplete",
d,y)}catch(I){this._errorHandler(I,h,y)}},onToGeoCoordinateStringComplete:function(){},fromGeoCoordinateString:function(a,e,d){var h={};J.isObject(a.sr)?h.sr=a.sr.wkid||K.toJson(a.sr.toJson()):h.sr=a.sr;h.strings=K.toJson(a.strings);h.conversionType=a.conversionType||"MGRS";h.conversionMode=a.conversionMode;a=J.mixin({},this._url.query,{f:"json"},h);var y=this._fromGeoCoordinateHandler,I=this._errorHandler,H=new E(n._dfdCanceller);H._pendingDfd=A({url:this._url.path+"/fromGeoCoordinateString",content:a,
callbackParamName:"callback",load:function(u,G){y(u,G,e,d,H)},error:function(u){I(u,d,H)}});return H},_fromGeoCoordinateHandler:function(a,e,d,h,y){try{this._successHandler([a.coordinates],"onToGeoCoordinateStringComplete",d,y)}catch(I){this._errorHandler(I,h,y)}},onFromGeoCoordinateStringComplete:function(){}});J.mixin(L,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,
UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,
UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,
UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",
UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});w("extend-esri")&&J.setObject("tasks.GeometryService",L,x);return L})},"esri/layers/FeatureLayer":function(){define("require module dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/global dojo/promise/all ../sniff ../kernel ../lang ../request ../config ../deferredUtils ../promiseList ../SpatialReference ../urlUtils ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/jsonUtils ../support/expressionUtils ../arcadeProfiles/labelingProfile ../tasks/QueryTask ../tasks/query ../tasks/FeatureSet ../tasks/StatisticDefinition ../geometry/Extent ../geometry/jsonUtils ../geometry/normalizeUtils ../geometry/scaleUtils ./GraphicsLayer ./Field ./TimeInfo ./TimeReference ./FeatureType ./FeatureTemplate ./FeatureSubtype ./FeatureEditResult ./LabelClass ./support/domainUtils ./SnapshotMode ./OnDemandMode ./SelectionMode ./StreamMode ./GridLayout ./TrackManager ./HeatmapManager ./clustering/ClusterManager dojo/i18n!../nls/jsapi dojo/has!extend-esri?./agscommon".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a,e,d,h,y,I,H,u,G,v,t,F,B,O,M,C,W,Y,R,S,T,Z,qa,ta,Ba,Oa,Ia,Ra,Va,ab,Q,ba,ia,ha,ua,Ga,ea,va,xa,Da,ya,Ja,Qa,Ma,Na){var Xa=y.defaults,bb=!!a("esri-pbf"),fb=!!a("esri-featurelayer-pbf"),Pa=q(Ia,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reSQLCurrentTimestamp:/current_timestamp|current_date|current_time/i,reHostedFS:/(https?:)?\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4E3,maxRecordCountForAuto:2E3,
maxVertexCountForAuto:25E4,generalizeForScale:4E3,_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error",
"info"]},constructor:function(r,N){this._preventInit||this._initFeatureLayer(r,N)},_initFeatureLayer:function(r,N){N=N||{};this._tileWidth=N.tileWidth||512;this._tileHeight=N.tileHeight||512;this.i18n=Na;this._featureReduction=this._featureReduction||N.featureReduction;this._featureReductionEnabled=null!=N.featureReductionEnabled?N.featureReductionEnabled:!0;this._featureUpdatesCheckEnabled=null!=N.featureUpdatesCheckEnabled?N.featureUpdatesCheckEnabled:!0;this.showLabels=null!=N.showLabels?N.showLabels:
!0;this._outFields=N.outFields;this._defnExpr=N.definitionExpression;this._loadCallback=N.loadCallback;this._trackIdField=N.trackIdField;this.objectIdField=N.objectIdField;var X=null!=N.resolution,ca=null!=N.maxAllowableOffset;this._maxOffset=this._optMaxOffset=X||ca?X?N.resolution:N.maxAllowableOffset:this.maxAllowableOffset;this.quantize=null!=N.quantize?N.quantize:!0;this._optEditable=N.editable;this._optAutoGen=N.autoGeneralize;this.editSummaryCallback=N.editSummaryCallback;this.userId=N.userId;
this.userIsAdmin=N.userIsAdmin;this.useMapTime=N.hasOwnProperty("useMapTime")?!!N.useMapTime:!0;this.source=N.source;this.gdbVersion=N.gdbVersion;this.orderByFields=N.orderByFields;this.maxPointCountForAuto=null!=N.maxPointCountForAuto?N.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=N.maxRecordCountForAuto?N.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=N.maxVertexCountForAuto?N.maxVertexCountForAuto:this.maxVertexCountForAuto;
this.generalizeForScale=null!=N.generalizeForScale?N.generalizeForScale:this.generalizeForScale;this.queryPagination=this._optQueryPagination=null!=N.queryPagination?N.queryPagination:!0;this.multipatchOption=N.multipatchOption;this.subtypeSublayerInfo=N.subtypeSublayerInfo;this._selectedFeatures={};this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();X=d.isDefined(N.mode)?N.mode:Pa.MODE_ONDEMAND;this._isStream&&(X=Pa.MODE_STREAM);this.mode=X;switch(X){case Pa.MODE_SNAPSHOT:this.currentMode=
Pa.MODE_SNAPSHOT;this._mode=new ea(this);break;case Pa.MODE_ONDEMAND:case Pa.MODE_AUTO:this.currentMode=Pa.MODE_ONDEMAND;this._mode=new va(this);this.latticeTiling=N.latticeTiling;break;case Pa.MODE_SELECTION:this.currentMode=Pa.MODE_SELECTION;this._mode=new xa(this);this._isSelOnly=!0;break;case Pa.MODE_STREAM:this.currentMode=Pa.MODE_STREAM,this._mode=new Da(this),this._isStream=!0}this._initLayer=E.hitch(this,this._initLayer);this._selectHandler=E.hitch(this,this._selectHandler);this._editable=
!1;if(E.isObject(r)&&r.layerDefinition)return this._collection=!0,this.mode=this._isStream?Pa.MODE_STREAM:Pa.MODE_SNAPSHOT,this._isStream||this._outFields||(this._outFields=["*"]),this._initLayer(r),this;this.source&&(r={source:this.source.toJson()},this._url.query=E.mixin(this._url.query,{layer:x.toJson(r)}));this.gdbVersion&&(this._url.query=E.mixin(this._url.query,{gdbVersion:this.gdbVersion}));this._task=new R(this.url,{source:this.source,gdbVersion:this.gdbVersion});r=this._url.path;this._fserver=
!1;-1!==r.search(/\/FeatureServer\//i)&&(this._fserver=!0);this._checkFeatureLimit();(N=N.resourceInfo)?this._initLayer(N):h({url:r,content:E.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},_initLayer:function(r,N){if(r||N){this._json=r;N=this.subtypeSublayerInfo;this._findCredential();if(this.credential&&this.credential.ssl||r&&r._ssl)this._useSSL(),this._task._useSSL();this._collection&&(this._isStream||
(this.currentMode=Pa.MODE_SNAPSHOT,this._mode=new ea(this)),this._featureSet=r.featureSet,this._nextId=r.nextObjectId,r=r.layerDefinition);this.version=r.currentVersion;this.version||(this.version="capabilities"in r||"drawingInfo"in r||"hasAttachments"in r||"htmlPopupType"in r||"relationships"in r||"timeInfo"in r||"typeIdField"in r||"types"in r?10:9.3);this.geometryType=r.geometryType;r.bandCount&&r.fields&&1<r.fields.length&&(this.geometryType="esriGeometryPolygon",this._isImageService=!0);"string"!==
typeof this.multipatchOption&&"esriGeometryMultiPatch"===this.geometryType&&(this.multipatchOption="xyFootprint");if(r.hasOwnProperty("capabilities")){var X=this.capabilities=r.capabilities;X&&-1!==X.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1}else this._collection||(this._editable=this._fserver);d.isDefined(this._optEditable)?(this._editable=this._optEditable,delete this._optEditable):"esriGeometryMultiPatch"===this.geometryType&&(this._editable=!1);this._isImageService&&
(this._editable=!1);this._json=x.toJson(this._json);this.isEditable()?this._setMaxOffset(null):this._canAutoGeneralize()&&(this._autoGeneralize=d.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===Pa.MODE_ONDEMAND||this.mode===Pa.MODE_AUTO,delete this._optAutoGen);X=r.effectiveMinScale||r.minScale;var ca=r.effectiveMaxScale||r.maxScale;!this._hasMin&&X&&this.setMinScale(X);!this._hasMax&&ca&&this.setMaxScale(ca);this.layerId=r.id;this.name=N&&N.title||r.name;this.description=r.description;this.copyright=
r.copyrightText;this.type=r.type;this.displayField=r.displayField;this.defaultDefinitionExpression=r.definitionExpression||(r.isView?r.viewDefinitionQuery:r.definitionQuery);this.fullExtent=new qa(r.extent);this.initialExtent=new qa(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new u(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=r.defaultVisibility;this.editingInfo=r.editingInfo;this.supportsLastEditDate=!(!this.editingInfo||null==this.editingInfo.lastEditDate);
if("esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.hasM=r.hasM||!1;this.hasZ=r.hasZ||!1;this.indexedFields=r.indexedFields;this.indexes=r.indexes;this.maxRecordCount=r.maxRecordCount;this.canModifyLayer=r.canModifyLayer;this.supportsStatistics=r.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:r.supportsAdvancedQueries;this.supportsCalculate=r.supportsCalculate;this.supportsASyncCalculate=r.supportsASyncCalculate;
this.supportsAttachmentsByUploadId=r.supportsAttachmentsByUploadId;this.supportsCoordinatesQuantization=r.supportsCoordinatesQuantization;this.supportsQuantizationEditMode=r.supportsQuantizationEditMode;this.supportsFieldDescription=r.supportsFieldDescriptionProperty;this.supportsFormatPBF=r.supportedQueryFormats?-1!==w.map(r.supportedQueryFormats.toLowerCase().split(","),E.trim).indexOf("pbf"):!1;this.quantize=this.quantize&&this.supportsCoordinatesQuantization;this.hasLabels=r.hasLabels;this.canScaleSymbols=
r.canScaleSymbols;this.supportsRollbackOnFailureParameter=this.supportsRollbackOnFailure=r.supportsRollbackOnFailure;this.syncCanReturnChanges=r.syncCanReturnChanges;this.isDataVersioned=r.isDataVersioned;this.editFieldsInfo=r.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=r.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=r.relationships;this.allowGeometryUpdates=
d.isDefined(r.allowGeometryUpdates)?r.allowGeometryUpdates:!0;this.allowUpdateWithoutMValues=!!r.allowUpdateWithoutMValues;this.enableZDefaults=!!r.enableZDefaults;this.zDefault=d.isDefined(r.zDefault)?r.zDefault:null;this.advancedQueryCapabilities=r.advancedQueryCapabilities||{supportsStatistics:this.supportsStatistics,supportsOrderBy:this.supportsAdvancedQueries,supportsDistinct:this.supportsAdvancedQueries};this.geometryProperties=r.hasGeometryProperties&&r.geometryProperties||null;this.url&&(this.advancedQueryCapabilities.supportsPagination=
this.advancedQueryCapabilities.supportsPagination&&(this.reHostedFS.test(this.url)||10.3<this.version));this.queryPagination=this._optQueryPagination&&this.advancedQueryCapabilities.supportsPagination;this.useStandardizedQueries=r.useStandardizedQueries;this.tileMaxRecordCount=r.tileMaxRecordCount;this.standardMaxRecordCount=r.standardMaxRecordCount;if(X=r.dateFieldsTimeReference)this.dateFieldsTimeReference=new ab(X);this._setMaxOffset(this._maxOffset,!0);this._isTable="Table"===this.type;ca=r.fields;
this._createFields(ca);if(!this.objectIdField){this.objectIdField=r.objectIdField;if(!this.objectIdField)for(ca=r.fields,X=0;X<ca.length;X++){var ka=ca[X];if("esriFieldTypeOID"===ka.type){this.objectIdField=ka.name;break}}this.objectIdField||this._isStream||console.debug("esri.layers.FeatureLayer: "+d.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!d.isDefined(this._nextId)){ca=this.objectIdField;ka=-1;if(this._collection&&ca){var ra=(X=this._featureSet)&&X.features,k=ra?
ra.length:0;for(X=0;X<k;X++){var z=(z=ra[X].attributes)&&z[ca];z>ka&&(ka=z)}}this._nextId=ka+1}this.globalIdField=r.globalIdField;if(X=this.typeIdField=r.typeIdField)if(X=!this._getField(X)&&this._getField(X,!0))this.typeIdField=X.name;this.visibilityField=r.visibilityField;if(ca=r.defaultSymbol)this.defaultSymbol=B.fromJson(ca);var P=this.types=[],V=r.types;ka=(X=this.editFieldsInfo)&&X.creatorField;ra=X&&X.editorField;z=ka||ra;k=[];if(V)for(X=0;X<V.length;X++){var U=new Q(V[X]);var aa=U.templates;
z&&aa&&aa.length&&(k=k.concat(aa));P.push(U)}V=r.templates;U=this.templates=[];if(V)for(X=0;X<V.length;X++)P=new ba(V[X]),z&&k.push(P),U.push(P);for(X=0;X<k.length;X++)if(z=E.getObject("prototype.attributes",!1,k[X]))ka&&delete z[ka],ra&&delete z[ra];if(X=r.subtypeField)this.subtypeField=(X=this.getField(X))?X.name:null;this.defaultSubtypeCode=r.defaultSubtypeCode;this.subtypes=w.map(r.subtypes,function(Ha){return new ia(Ha)});this._applySTSublayerInfo(N);if(N=r.timeInfo)this.timeInfo=new Va(N),this._startTimeField=
N.startTimeField,this._endTimeField=N.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?N.trackIdField=this._trackIdField:this._trackIdField=N.trackIdField;this.hasAttachments=!this._collection&&r.hasAttachments?!0:!1;this.htmlPopupType=r.htmlPopupType;N=r.drawingInfo;(X=N&&N.labelingInfo)&&!this.labelingInfo&&(this.labelingInfo=w.map(X,function(Ha){return new ua(Ha)}),this._fixLabelExpr());if(!this.renderer)if(N&&N.renderer){var da=N.renderer;this.setRenderer(C.fromJson(da,
{geometryType:this.geometryType}));"classBreaks"===da.type&&this.renderer.setMaxInclusive(!0);if(!this._collection){var ja=da.type;X=[];da=this.renderer;switch(ja){case "simple":X.push(da.symbol);break;case "uniqueValue":case "classBreaks":X.push(da.defaultSymbol),X=X.concat(w.map(da.infos,function(Ha){return Ha.symbol}))}X=w.filter(X,d.isDefined);var ma=this._url.path+"/images/",Aa=this._getToken();w.forEach(X,function(Ha){var Ka=Ha.url;Ka&&(-1===Ka.search(/https?:/)&&-1===Ka.indexOf("data:")&&(Ha.url=
ma+Ka),Aa&&-1!==Ha.url.search(/https?:/)&&(Ha.url+="?token\x3d"+Aa))})}}else if(ca)V=this.types,0<V.length?(da=new M(this.defaultSymbol,this.typeIdField),w.forEach(V,function(Ha){da.addValue(Ha.id,Ha.symbol)})):da=new O(this.defaultSymbol),this.setRenderer(da);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":ja=new v;break;case "esriGeometryPolyline":ja=new t;break;case "esriGeometryPolygon":ja=new F;break;default:this.hasXYFootprint()&&(ja=
new F)}this.setRenderer(ja?new O(ja):null)}ja=N&&N.transparency||0;!this.hasOwnProperty("opacity")&&0<ja&&(this.opacity=1-ja/100);(a("ie")||7<=a("trident")||a("safari"))&&this.isEditable()&&10.02>this.version&&(this._ts=!0);this.statistics=r.statistics;this._fixRendererFields();this._updateRequiredFieldsFromLabelingInfo();this._checkFields();this._updateCaps();var Ca=function(){null==this._maxOffset||this._isFractionalOffsetAllowed()||this._setMaxOffset(this._maxOffset);this.loaded=!0;this.setFeatureReduction(this.getFeatureReduction());
this.currentMode!==Pa.MODE_SNAPSHOT&&(this.queryPagination=!1);this.onLoad(this);var Ha=this._loadCallback;Ha&&(delete this._loadCallback,Ha(this))};r=[];this._collection?(ja=this._featureSet,this._featureSet=null,this._mode._drawFeatures(new T(ja)),this._fcAdded=!0):(r.push(this._forceIdentity()),this._limitPromise&&r.push(this._limitPromise));r.push(this._evalArcadeSupport());r.length?H(r).then(E.hitch(this,function(){Ca.call(this)})):Ca.call(this)}},_applySTSublayerInfo:function(r){r&&this.subtypeField&&
(this.subtypeCode=r.subtypeCode,this._applySTSublayerDefinitionExpression(r),this._filterSubtypes(r),this._applySTTemplates(r),this._applySTFieldOverrides(r))},_applySTSublayerDefinitionExpression:function(r){var N=[],X=this.getDefinitionExpression();X&&N.push(X);(r=r.layerDefinition&&r.layerDefinition.definitionExpression)&&N.push(r);1<N.length&&(N=w.map(N,function(ca){return"("+ca+")"}));this.setDefinitionExpression(N.length?N.join(" AND "):null)},_applySTTemplates:function(r){if(r=r.layerDefinition&&
r.layerDefinition.templates)this.templates=w.map(r,function(N){return new ba(N)})},_filterSubtypes:function(){this.subtypes&&(this.subtypes=w.filter(this.subtypes,function(r){return r.code===this.subtypeCode},this))},_applySTFieldOverrides:function(r){var N=r.layerDefinition&&r.layerDefinition.fieldOverrides;if(N){this.fields=w.filter(this.fields,function(ca){return w.some(N,function(ka){return ka.name===ca.name})});var X=this.getSubtypeByCode(this.subtypeCode).domains;this.fields.forEach(function(ca){var ka=
w.filter(N,function(ra){return ra.name===ca.name})[0];ka.alias&&(ca.alias=ka.alias);if(!1===ka.editable||ca.name===this.subtypeField)ca.editable=!1;X&&(ka=X[ca.name])&&"inherited"!==ka.type&&(ca.domain=Ga.fromJson(ka.toJson()))},this)}},setShowLabels:function(r){var N=this.showLabels;this.showLabels=r;N!==this.showLabels&&(this._evalSurfaceType(),this.onShowLabelsChange())},onShowLabelsChange:function(){},onRendererChange:function(r){this.inherited(arguments);var N=this._map;this._ager=!!(r&&r.observationAger&&
r.observationRenderer);r&&"colors"in r&&"blurRadius"in r&&"maxPixelIntensity"in r?(this._evalSurfaceType(!0),"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&N&&(this._heatmapManager=new Qa(this),this._heatmapManager.initialize(N))):this.renderer&&this.renderer.getRendererInfo?w.some(this.renderer.rendererInfos,function(ka){return ka.renderer&&"colors"in ka.renderer&&"blurRadius"in ka.renderer})||(this._heatmapManager=null):this._heatmapManager=null;this.timeInfo&&N&&(r&&(r.latestObservationRenderer||
r.trackRenderer)?this._trackManager||(this._trackManager=new Ja(this),this._trackManager.initialize(N),this._childLayer=this._trackManager.container,this._mode._applyTimeFilter()):this._trackManager&&!this._isStream&&(this._trackManager.destroy(),this._trackManager=null));if(r){var X=[];N=w.filter([r,r.observationRenderer,r.latestObservationRenderer,r.trackRenderer],d.isDefined);var ca=function(ka){return null!=ka&&"function"!=typeof ka&&ka};w.forEach(N,function(ka){var ra=ca(ka.attributeField),k=
ca(ka.attributeField2);ka=ca(ka.attributeField3);!1!==ra&&X.push(ra);!1!==k&&X.push(k);!1!==ka&&X.push(ka)});this._requiredFields=X}else this._requiredFields=[];this.loaded&&(this._fixRendererFields(),this._checkFields(this._requiredFields),this._collection&&(this._typesDirty=!0))},setFeatureReduction:function(r){r&&(r=E.mixin({},r),null!=r.clusterSize&&null==r.clusterRadius&&(r.clusterRadius=r.clusterSize),delete r.clusterSize);this.loaded?this._isFeatureReductionSupported(r)?this._featureReduction=
r:(this._featureReduction=null,r&&console.log("Clustering is not supported for this layer: "+this.url)):this._featureReduction=r;this._evalFeatureReduction(this._featureReduction)},hasFeatureReduction:function(){return!!this._featureReduction},getFeatureReduction:function(){var r=this._featureReduction;if(r){r=E.mixin({},r);var N=this._clusterManager;if(N=N&&N.aggregationInfo)r.clusterRadius=N.clusterRadius,r.infoTemplate=N.infoTemplate}return r},isFeatureReductionActive:function(){var r=this._clusterManager;
return!!(r&&r.isClusteringEnabled()&&r.isClusteringActive())},isFeatureReductionEnabled:function(){return this._featureReductionEnabled},enableFeatureReduction:function(){this._featureReductionEnabled||(this._featureReductionEnabled=!0,this._evalFeatureReduction(this._featureReduction))},disableFeatureReduction:function(){this._featureReductionEnabled&&(this._featureReductionEnabled=!1,this._evalFeatureReduction(this._featureReduction))},isFeatureReductionApplied:function(){return this.hasFeatureReduction()&&
this.isFeatureReductionEnabled()&&this._canCluster(this.getFeatureReduction())},getAggregateGraphics:function(){return this._clusterManager?this._clusterManager.getAggregateGraphics():[]},getChildGraphics:function(r){return this._clusterManager?this._clusterManager.getFeaturesInCluster(r):[]},getSingleGraphics:function(){return this._clusterManager?this._clusterManager.getSingleGraphics():[]},getFeatureReductionRenderer:function(){return this.isFeatureReductionActive()?this._clusterManager.getClusterRenderer():
null},getFeatureReductionLayer:function(){return this._clusterManager?this._clusterManager.container:null},getFeatureReductionField:function(r){var N,X=this._clusterManager?this._clusterManager.getClusterFields():null;r=r?r.toLowerCase():"";w.some(X,function(ca){r===ca.name.toLowerCase()&&(N=ca);return!!N});return N},_isFeatureReductionSupported:function(r){return r&&"cluster"===r.type&&"esriGeometryPoint"===this.geometryType&&(this._collection||this._isStream||this._optQueryPagination&&this.advancedQueryCapabilities.supportsPagination)},
_isReductionCompatibleRenderer:function(r){r=r&&r.declaredClass||"";r=r.toLowerCase();return-1<r.indexOf("simplerenderer")||-1<r.indexOf("classbreaksrenderer")||-1<r.indexOf("uniquevaluerenderer")},_evalFeatureReduction:function(r){this.loaded&&this.getMap()&&(r=r||this.getFeatureReduction(),this._evalModeFromFReduction(r),r&&this.isFeatureReductionEnabled()?this._canCluster(r)?this._clusterManager?this._updateClusterManager(r):(this._clusterManager=this._createClusterManager(r),this.onFeatureReductionChange()):
(console.log("Clustering is supported only for point layers where map spatial reference is WGS84 or Web Mercator"),this._destroyClusterManager()):this._destroyClusterManager())},_canCluster:function(r){var N=this._map;if(!N)return!1;N=N.spatialReference;return this._isFeatureReductionSupported(r)&&this._isReductionCompatibleRenderer(this.renderer)&&(N.isWebMercator()||4326===N.wkid)},_createClusterManager:function(r){r=new Ma({layer:this,aggregationInfo:r});this._clusterHandles=[r.on("renderer-change",
E.hitch(this,function(){this.onFeatureReductionRendererChange()}))];r.initialize(this._map);return r},_updateClusterManager:function(r){var N=this._clusterManager;N&&N.setAggregationInfo(r)},_destroyClusterManager:function(r){w.forEach(this._clusterHandles,function(N){N.remove()});this._clusterHandles=null;this._clusterManager&&(this._clusterManager.destroy(r),this._clusterManager=null,this.onFeatureReductionChange())},redraw:function(){this.inherited(arguments);this._clusterManager&&this._clusterManager.redraw();
this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(r){this.inherited(arguments);var N=this._getRenderer();this._ager=!!(N&&N.observationAger&&N.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(N&&N.trackRenderer);r&&this._evalFeatureReduction()},_graphicVisibilityChanged:function(r){this._clusterManager?this._clusterManager.toggleFeatureVisibility(r):this._heatmapManager&&
this._heatmapManager.redraw()},setWebGLFetchOptions:function(r){this._hasOnDemandDrillMode()&&(r=r||{},null!=r.maxDrillLevel&&(this._mode.maxDrillLevel=r.maxDrillLevel),null!=r.maxRecordCountFactor&&(this._mode.maxRecordCountFactor=r.maxRecordCountFactor),null!=r.enablePBFQuery&&(this._mode.enablePBFQuery=r.enablePBFQuery))},_isWebGLCompatible:function(){return this.loaded&&!this.isEditable()&&!this.isFeatureReductionApplied()&&(!this.labelingInfo||!1===this.showLabels)&&!this._isGeometryOperationsUsed()&&
this._isRendererSupportedInWebGL()&&this.supportsCoordinatesQuantization&&("esriGeometryPolygon"!==this.geometryType||this.advancedQueryCapabilities.supportsReturningGeometryCentroid)&&this.currentMode===Pa.MODE_ONDEMAND&&(!this._preSurfaceChangeState||this._preSurfaceChangeState.currentMode===Pa.MODE_ONDEMAND)},_isRendererSupportedInWebGL:function(){if(!this.renderer)return!1;var r=this.renderer,N=r.declaredClass?r.declaredClass.toLowerCase():"";return(-1<N.indexOf("simplerenderer")||-1<N.indexOf("classbreaksrenderer")||
-1<N.indexOf("uniquevaluerenderer"))&&this._hasWebGLCompatibleSymbols(r)&&this._hasWebGLCompatibleVVs(r)},_hasWebGLCompatibleSymbols:function(r){r=this._getAllSymbolsInRenderer(r);return!(this._hasSLSWithMarker(r)||this._hasIncompatibleSMSStyles(r)||this._hasGIFMarker(r))},_hasWebGLCompatibleVVs:function(r){return!w.some(r&&r.visualVariables,function(N){var X=N.type;return("colorInfo"===X||"opacityInfo"===X)&&N.stops&&8<N.stops.length||"sizeInfo"===X&&(N.field||N.valueExpression&&"$view.scale"!==
N.valueExpression||N.expression&&"view.scale"!==N.expression)&&N.stops&&6<N.stops.length?!0:!1})},_hasSLSWithMarker:function(r){return w.some(r,function(N){return N&&"simplelinesymbol"===N.type&&!!N.marker})},_hasIncompatibleSMSStyles:function(r){var N=void 0===a("ie")&&7==a("trident");return w.some(r,function(X){return X&&"simplemarkersymbol"===X.type&&("triangle"===X.style||"path"===X.style&&N)})},_hasGIFMarker:function(r){var N=/\.gif$/,X=/^image\/gif$/;return w.some(r,function(ca){return ca&&
"picturemarkersymbol"===ca.type?N.test(ca.url)||X.test(ca.contentType):!1})},_getAllSymbolsInRenderer:function(r){var N=[];r&&(N.push(r.symbol),N.push(r.defaultSymbol),w.forEach(r.infos,function(X){N.push(X.symbol)}),N=w.filter(N,function(X){return!!X}));return N},_setMap:function(r){var N=this.inherited(arguments),X=this._mode,ca=this;X&&r.loaded&&X.initialize(r);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());this._addHandle=this.on("graphic-node-add",
function(ka){ka=ka.graphic.attributes;(ka=ca._selectedFeatures[ka&&ka[ca.objectIdField]])&&ka.attr("data-selected","")});return N},_unsetMap:function(r){this._suspendImpl(!0);this._destroyClusterManager(!1);this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);K.disconnect(this._zoomConnect);K.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this.inherited("_unsetMap",arguments)},onAttach:function(){this._evalModeFromSurface()},onRefreshTick:function(){this.isFeatureUpdatesCheckActive()&&
this._evalFeatureUpdates()},refresh:function(r){!this._needsRefresh&&r&&r.scheduled&&this.isFeatureUpdatesCheckActive()||(this._needsRefresh=!1,(r=this._mode)&&r.refresh())},setFeatureUpdatesCheckEnabled:function(r){this._featureUpdatesCheckEnabled=r},isFeatureUpdatesCheckEnabled:function(){return!!this._featureUpdatesCheckEnabled},isFeatureUpdatesCheckActive:function(){return this.supportsLastEditDate&&this.isFeatureUpdatesCheckEnabled()&&!!this.refreshInterval&&!!E.getObject("onFeatureUpdatesResult.after",
!1,this)},hasFeatureUpdates:function(){var r=new A;if(!this.supportsLastEditDate)return r.reject(Error("FeatureLayer does not support supportsLastEditDate")),r.promise;if(!this._fetchMetadataPromise||this._fetchMetadataPromise.isFulfilled())this._fetchMetadataPromise=h({url:this._url.path,content:E.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(E.hitch(this,function(N){N=N.editingInfo.lastEditDate;var X=this.editingInfo.lastEditDate!==N;this.editingInfo.lastEditDate=N;return X}));
this._fetchMetadataPromise.then(function(N){r.isFulfilled()||r.resolve(N)}).otherwise(function(N){r.isFulfilled()||r.reject(N)});return r.promise},hasXYFootprint:function(){return"esriGeometryMultiPatch"===this.geometryType&&"xyFootprint"===this.multipatchOption},getOutFields:function(){return w.filter(this._getOutFields(),function(r){return"*"===r||!!this._getField(r)},this)},getField:function(r){return this._getField(r,!0)},isOutField:function(r){r=this.getField(r);if(!r)return!1;var N=this.getOutFields();
return-1<w.indexOf(N,"*")||-1<w.indexOf(N,r.name)},getFieldLabel:function(r){var N=this.infoTemplate;N=N&&N.getFieldInfo&&N.getFieldInfo(r);r=E.isFunction(r)?null:this.getField(r);var X=N||r,ca="";X&&(ca=N&&N.label||r&&r.alias||X.name||X.fieldName);return ca},getDomain:function(r,N){var X,ca,ka=(N=N&&N.feature)&&this.typeIdField&&N.attributes&&N.attributes[this.typeIdField];null!=ka&&w.some(this.types,function(ra){return ra.id==ka?((X=ra.domains&&ra.domains[r])&&"inherited"===X.type&&(X=this._getLayerDomain(r),
ca=!0),!0):!1},this);ca||X||(X=this._getLayerDomain(r));return X},_getLayerDomain:function(r){this._createFieldsIndex();var N=this._fieldsIndex;if(N)return N=N.caseSensitive,(N=N.get(r))?N.domain:null;var X;w.some(this.fields,function(ca){ca.name===r&&(X=ca.domain);return!!X});return X},getType:function(r){return this.getTypeById(r&&this.typeIdField&&r.attributes&&r.attributes[this.typeIdField])},getTypeById:function(r){var N;w.some(this.types,function(X){X.id==r&&(N=X);return!!N});return N},getSubtypeByCode:function(r){var N;
w.some(this.subtypes,function(X){X.code==r&&(N=X);return!!N});return N},setEditable:function(r){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(this._isImageService)return this;if(!this.loaded)return this._optEditable=r,this;var N=this._editable;this._editable=r;this._updateCaps();if(N!==r)this.onCapabilitiesChange();return this},getEditCapabilities:function(r){var N={canCreate:!1,canUpdate:!1,canDelete:!1,
canUpdateGeometry:!1};if(!this.loaded||!this.isEditable())return N;var X=r&&r.feature;r=r&&r.userId||this.getUserId();var ca=w.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],E.trim),ka=(N=-1<w.indexOf(ca,"editing"))&&-1<w.indexOf(ca,"create"),ra=N&&-1<w.indexOf(ca,"update");ca=N&&-1<w.indexOf(ca,"delete");var k=this.ownershipBasedAccessControlForFeatures,z=this.editFieldsInfo,P=z&&z.creatorField;z=z&&z.realm;X=(X=X&&X.attributes)&&P?X[P]:void 0;var V=!!this.userIsAdmin;P=!k||
V||!(!k.allowOthersToUpdate&&!k.allowUpdateToOthers);var U=!k||V||!(!k.allowOthersToDelete&&!k.allowDeleteToOthers),aa=!k||V||!k.hasOwnProperty("allowAnonymousToUpdate")||k.allowAnonymousToUpdate;k=!k||V||!k.hasOwnProperty("allowAnonymousToDelete")||k.allowAnonymousToDelete;r&&z&&(r=r+"@"+z);if(V||N&&!(ka||ra||ca))ka=ra=ca=!0;N={canCreate:ka,canUpdate:ra,canDelete:ca,canUpdateGeometry:V||this.allowGeometryUpdates};r||(N.canUpdate=N.canUpdate&&aa,N.canDelete=N.canDelete&&k);null===X?(N.canUpdate=N.canUpdate&&
P,N.canDelete=N.canDelete&&U):""!==X&&X&&r.toLowerCase()!==X.toLowerCase()&&(N.canUpdate=N.canUpdate&&P,N.canDelete=N.canDelete&&U);return N},getUserId:function(){var r;this.loaded&&(r=this.credential&&this.credential.userId||this.userId||"");return r},setUserIsAdmin:function(r){this.userIsAdmin=r},setEditSummaryCallback:function(r){this.editSummaryCallback=r},getEditSummary:function(r,N,X){X=d.isDefined(X)?X:(new Date).getTime();var ca="";X=this.getEditInfo(r,N,X);(N=N&&N.callback||this.editSummaryCallback)&&
(X=N(r,X)||"");if(E.isString(X))ca=X;else{if(X){r=X.action;N=X.userId;var ka=X.timeValue,ra=0;r&&ra++;N&&ra++;d.isDefined(ka)&&ra++;1<ra&&(ca=("edit"===r?"edit":"create")+(N?"User":"")+(d.isDefined(ka)?X.displayPattern:""))}ca=ca&&d.substitute(X,this.i18n.layers.FeatureLayer[ca])}return ca},getEditInfo:function(r,N,X){if(this.loaded){X=d.isDefined(X)?X:(new Date).getTime();N=N&&N.action||"last";var ca=this.editFieldsInfo,ka=ca&&ca.creatorField,ra=ca&&ca.creationDateField,k=ca&&ca.editorField;ca=ca&&
ca.editDateField;k=(r=r&&r.attributes)&&k?r[k]:void 0;ca=r&&ca?r[ca]:null;ka=this._getEditData(r&&ka?r[ka]:void 0,r&&ra?r[ra]:null,X);X=this._getEditData(k,ca,X);switch(N){case "creation":var z=ka;break;case "edit":z=X;break;case "last":z=X||ka}z&&(z.action=z===X?"edit":"creation");return z}},_getEditData:function(r,N,X){if(d.isDefined(N)){var ca=X-N;var ka=0>ca?"Full":6E4>ca?"Seconds":12E4>ca?"Minute":36E5>ca?"Minutes":72E5>ca?"Hour":864E5>ca?"Hours":6048E5>ca?"WeekDay":"Full"}if(void 0!==r||ka){var ra=
ra||{};ra.userId=r;ka&&(r=n.format,X=new Date(N),ra.minutes=Math.floor(ca/6E4),ra.hours=Math.floor(ca/36E5),ra.weekDay=r(X,{datePattern:"EEEE",selector:"date"}),ra.formattedDate=r(X,{selector:"date"}),ra.formattedTime=r(X,{selector:"time"}),ra.displayPattern=ka,ra.timeValue=N)}return ra},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},isQueryable:function(){var r=w.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],E.trim);return this._isStream||this.userIsAdmin||
this._collection||-1!==w.indexOf(r,"query")||-1!==w.indexOf(r,"catalog")},setResolution:function(r){return this.setMaxAllowableOffset(r)},setMaxAllowableOffset:function(r){this.isEditable()||(this._optMaxOffset=r,this._setMaxOffset(r,!0));return this},_resetMaxAllowableOffset:function(){this.setMaxAllowableOffset(this._optMaxOffset);this._prevScale=null;this._refreshMaxAllowableOffset()},_refreshMaxAllowableOffset:function(){this._calcMaxOffsetForAutoSnapshot();this._updateMaxOffset();this._needsRefresh=
!1},getResolution:function(){return this.getMaxAllowableOffset()},getMaxAllowableOffset:function(){var r=this._quantizationParameters?this._quantizationParameters.tolerance:void 0;return null!=this._maxOffset?this._maxOffset:r},_setMaxOffset:function(r,N){if(null==r)return delete this._maxOffset,delete this._quantizationParameters,this;this.quantize&&this.supportsCoordinatesQuantization?("esriGeometryPolyline"===this.geometryType?this._maxOffset=r:delete this._maxOffset,this._quantizationParameters=
r?{mode:"view",originPosition:"upperLeft",tolerance:r,extent:this.fullExtent}:null):(this._isFractionalOffsetAllowed()&&N||(r=Math.floor(r)),isNaN(r)||0===r?delete this._maxOffset:this._maxOffset=r,delete this._quantizationParameters);return this},_isFractionalOffsetAllowed:function(){return null==this.version||10.1<=this.version||navigator.languages&&this._isLangWithDot(navigator.languages[0])},_isLangWithDot:function(r){r=(r=r&&r.split("-"))&&r[0]&&r[0].toLowerCase();return-1!==w.indexOf(this._langsWithDot,
r)},_langsWithDot:"ar en et fr he ja ko th vi zh".split(" "),setAutoGeneralize:function(r){this.loaded?this._canAutoGeneralize()&&((this._autoGeneralize=r)?(this._isAutoSnapshotMode()&&(this._prevScale=null),this._updateMaxOffset()):this._setMaxOffset(null)):this._optAutoGen=r;return this},_canAutoGeneralize:function(){return!this.isEditable()&&this.mode!==Pa.MODE_SNAPSHOT},setGDBVersion:function(r){this._collection||r===this.gdbVersion||!r&&!this.gdbVersion||(this.gdbVersion=r,this._task.gdbVersion=
r,this._url.query=E.mixin(this._url.query,{gdbVersion:r}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange());return this},hasAllFeatures:function(){return this._mode?this._mode.hasAllFeatures():!0},hasUpdateError:function(){return this._mode?this._mode.hasUpdateError():!1},setDefinitionExpression:function(r){this._defnExpr=r;this._hasPendingLimitQuery()||((r=this._checkFeatureLimit())?this._evalModeAndApplyDefnExpr(r):this._applyDefnExpr());return this},_applyDefnExpr:function(){var r=
this._mode;r&&r.propertyChangeHandler(1)},_evalModeAndApplyDefnExpr:function(r){r.then(E.hitch(this,function(N){N&&(N instanceof Error||!N.modeChanged)&&this._applyDefnExpr()}))},getDefinitionExpression:function(){return this._defnExpr},hasDefinitionExpressionWithCurrentTimestamp:function(){return this.reSQLCurrentTimestamp.test(this.getDefinitionExpression())},setTimeDefinition:function(r){this._isSnapshotMode()?(this._timeDefn=r,(r=this._mode)&&r.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+
this.id+", Layer URL \x3d "+this.url);return this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(r,N){this._timeOffset=r;this._timeOffsetUnits=N;(r=this._mode)&&r.propertyChangeHandler(0);return this},setUseMapTime:function(r){this.useMapTime=r;this._toggleTime(!this.suspended);(r=this._mode)&&r.propertyChangeHandler(0)},selectFeatures:function(r,N,X,ca){N=N||Pa.SELECTION_NEW;this._hasSelectionError=this._hasPartialSelectedFeatures=!1;r=this._getShallowClone(r);var ka=
this._map,ra=this,k=I._fixDfd(new A(I._dfdCanceller));r.outFields=this.getOutFields();r.returnGeometry=!0;r.multipatchOption=this.multipatchOption;ka&&(r.outSpatialReference=new u(ka.spatialReference.toJson()));if(!this._applyQueryFilters(r,!0)){var z={features:[]};this._selectHandler(z,N,X,ca,k);return k}if(ka=this._canDoClientSideQuery(r))k._pendingDfd=f(this._doQuery(r,ka)),k._pendingDfd.then(function(V){z={features:V};ra._selectHandler(z,N,X,ca,k)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+
this.invalidParams)],null,ca,k,!0),k;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,ca,k,!0),k;var P=this;this._ts&&(r._ts=(new Date).getTime());ka=this._canFetchPBFForQuery(r);this._enableEditModeQuantization(r,ka);(k._pendingDfd=this._task.execute(r,null,null,ka?{format:"pbf"}:null)).addCallbacks(function(V){P._selectHandler(V,N,X,ca,k)},function(V){P._hasPartialSelectedFeatures=!0;P._hasSelectionError=!0;P._resolve([V],null,ca,
k,!0)})}return k},getSelectedFeatures:function(){var r=this._selectedFeatures,N=[],X;for(X in r)r.hasOwnProperty(X)&&N.push(r[X]);return N},clearSelection:function(r){var N=this._selectedFeatures,X=this._mode,ca;for(ca in N)N.hasOwnProperty(ca)&&(this._unSelectFeatureIIf(ca,X),X._removeFeatureIIf(ca));this._selectedFeatures={};this._isSelOnly&&X._applyTimeFilter(!0);if(!r)this.onSelectionClear();return this},setSelectionSymbol:function(r){if(this._selectionSymbol=r){var N=this._selectedFeatures,X;
for(X in N)N.hasOwnProperty(X)&&N[X].setSymbol(r)}return this},getSelectionSymbol:function(){return this._selectionSymbol},setLabelingInfo:function(r){r?(this.labelingInfo=r,this._fixLabelExpr()):delete this.labelingInfo;this._collection&&(this._typesDirty=!0);this._evalSurfaceType();this.onLabelingInfoChange()},_fixLabelExpr:function(){var r=/\[([^\[\]]+)\]/ig,N,X=this,ca=function(ka,ra){ka=X._getField(ra,!0);return"["+(ka&&ka.name||ra)+"]"};w.forEach(this.labelingInfo,function(ka){if(N=ka.labelExpression)ka.labelExpression=
N.replace(r,ca)})},_updateRequiredFieldsFromLabelingInfo:function(){var r=[];w.forEach(this.labelingInfo,function(N){var X=N.labelExpressionInfo;if(N.labelExpression){var ca=/[\[\]]/ig;N=N.labelExpression.match(/\[[^\[\]]+\]/ig);(N=w.map(N,function(ra){return ra.replace(ca,"")}))&&(r=r.concat(N))}if(X){if(X.value){var ka=/[\{\}]/ig;N=X.value.match(/\{[^\{\}]+\}/ig);(N=w.map(N,function(ra){return ra.replace(ka,"")}))&&(r=r.concat(N))}X.expression&&(N=w.map(this.fields,function(ra){return ra.name},
this),r=r.concat(W.extractFieldNames(X.expression,N)))}},this);r=w.map(r,function(N){var X=this.getField(N);return X?X.name:N},this);this._requiredFields&&(this._requiredFields=this._requiredFields.concat(r))},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(r,N,X,ca,ka,ra){var k=ra.assembly,z=ra.dfd;this._applyNormalized(r,k&&k[0]);this._applyNormalized(N,k&&k[1]);this.onBeforeApplyEdits(r,N,X);var P={},V=this.objectIdField;k={f:"json"};var U=!1;if(this._collection)ra=
{},ra.addResults=r?w.map(r,function(){U=!0;return{objectId:this._nextId++,success:!0}},this):null,ra.updateResults=N?w.map(N,function(ja){U=!0;var ma=ja.attributes[V];P[ma]=ja;return{objectId:ma,success:!0}},this):null,ra.deleteResults=X?w.map(X,function(ja){U=!0;return{objectId:ja.attributes[V],success:!0}},this):null,U?this._editHandler(ra,r,P,ca,ka,z):this._resolve([ra.addResults,ra.updateResults,ra.deleteResults],null,ca,z);else{r&&0<r.length&&(k.adds=this._convertFeaturesToJson(r,0,1),U=!0);
if(N&&0<N.length){for(ra=0;ra<N.length;ra++){var aa=N[ra];P[aa.attributes[V]]=aa}k.updates=this._convertFeaturesToJson(N,0,0,1);U=!0}if(X&&0<X.length){N=[];for(ra=0;ra<X.length;ra++)N.push(X[ra].attributes[V]);k.deletes=N.join(",");U=!0}if(U){var da=this;return h({url:this._url.path+"/applyEdits",content:E.mixin(k,this._url.query),callbackParamName:"callback",load:function(ja){da._editHandler(ja,r,P,ca,ka,z)},error:function(ja){da._resolve([ja],null,ka,z,!0)}},{usePost:!0})}this._resolve([],null,
ca,z)}},queryFeatures:function(r,N,X,ca){return this._query("execute","onQueryFeaturesComplete",r,N,X,ca)},queryRelatedFeatures:function(r,N,X){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",r,N,X)},queryIds:function(r,N,X,ca){return this._query("executeForIds","onQueryIdsComplete",r,N,X,ca)},queryCount:function(r,N,X,ca){return this._query("executeForCount","onQueryCountComplete",r,N,X,ca)},queryExtent:function(r,N,X,ca){return this._query("executeForExtent","onQueryExtentComplete",
r,N,X,ca)},queryAttachmentInfos:function(r,N,X){var ca=this._url.path+"/"+r+"/attachments",ka=new A(I._dfdCanceller),ra=this;ca=G.normalize(ca);ka._pendingDfd=h({url:ca,content:E.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(k){k=k.attachmentInfos;var z;w.forEach(k,function(P){z=g.objectToQuery({gdbVersion:ra._url.query&&ra._url.query.gdbVersion,layer:ra._url.query&&ra._url.query.layer,token:ra._getToken()});P.url=ca+"/"+P.id+(z?"?"+z:"");P.objectId=r});ra._resolve([k],
"onQueryAttachmentInfosComplete",N,ka)},error:function(k){ra._resolve([k],null,X,ka,!0)}});return ka},addAttachment:function(r,N,X,ca){return this._sendAttachment("add",r,N,X,ca)},updateAttachment:function(r,N,X,ca,ka){X.appendChild(m.create("input",{type:"hidden",name:"attachmentId",value:N}));return this._sendAttachment("update",r,X,ca,ka)},deleteAttachments:function(r,N,X,ca){var ka=this._url.path+"/"+r+"/deleteAttachments",ra=new A(I._dfdCanceller),k=this;N={f:"json",attachmentIds:N.join(",")};
ra._pendingDfd=h({url:ka,content:E.mixin(N,this._url.query),callbackParamName:"callback",load:E.hitch(this,function(z){z=z.deleteAttachmentResults;z=w.map(z,function(P){P=new ha(P);P.attachmentId=P.objectId;P.objectId=r;return P});k._resolve([z],"onDeleteAttachmentsComplete",X,ra)}),error:function(z){k._resolve([z],null,ca,ra,!0)}},{usePost:!0});return ra},addType:function(r){var N=this.types;if(N){if(w.some(N,function(X){return X.id==r.id?!0:!1}))return!1;N.push(r)}else this.types=[r];return this._typesDirty=
!0},deleteType:function(r){if(this._collection){var N=this.types;if(N){var X=-1;w.some(N,function(ca,ka){return ca.id==r?(X=ka,!0):!1});if(-1<X)return this._typesDirty=!0,N.splice(X,1)[0]}}},toJson:function(){var r=this._cloneJson();if(r){r=r.layerDefinition?r:{layerDefinition:r};var N=r.layerDefinition,X=this._collection;this._updateLayerDefinition(N);var ca=null;if(!X||this._fcAdded)ca={geometryType:N.geometryType,features:this._convertFeaturesToJson(this.graphics,!0)};r.featureSet=E.mixin({},r.featureSet||
{},ca);if(r.featureSet.transform){var ka=r.featureSet.transform;delete r.featureSet.transform;ca=new T(r.featureSet);ca.quantize(ka);r.featureSet=ca.toJson()}X&&(r.nextObjectId=this._nextId,N.capabilities=this.capabilities);return r}},getLayerDefinition:function(){var r=this._cloneJson();(r=r?r.layerDefinition||r:null)&&this._updateLayerDefinition(r);return r},getFeatureCollectionLayer:function(r){var N=new A,X=this.getLayerDefinition();if(!X)return N.reject(Error("layerDefinition not available")),
N.promise;r=r||[];var ca=new Pa({layerDefinition:X,featureSet:{geometryType:X.geometryType,features:w.map(r,function(k){return k.toJson()})}}),ka=ca.on("load",function(){ka.remove();ra.remove();N.resolve(ca)}),ra=ca.on("error",function(){ca.loaded||(ka.remove(),ra.remove(),N.reject(ca.loadError))});return N.promise},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},
onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},onLabelingInfoChange:function(){},onFeatureReductionRendererChange:function(){},onFeatureReductionChange:function(){},onFeatureUpdatesResult:function(){},
_cloneJson:function(){var r=this._json;return E.isString(r)?x.fromJson(r):E.clone(r)},_updateLayerDefinition:function(r){if(this._collection&&this._typesDirty){r.types=w.map(this.types||[],function(ka){return ka.toJson()});var N=this.renderer,X=this.labelingInfo,ca=r.drawingInfo;!N&&!X||ca||(ca=r.drawingInfo={});ca&&N&&-1===N.declaredClass.indexOf("TemporalRenderer")&&(ca.renderer=N.toJson());X&&(ca.labelingInfo=w.map(X,function(ka){return ka.toJson()}))}},_evalFeatureUpdates:function(){if(!this._featureUpdatesPromise||
this._featureUpdatesPromise.isFulfilled())this._featureUpdatesPromise=this.hasFeatureUpdates().otherwise(function(r){return!(r&&"cancel"===r.dojoType)}).always(E.hitch(this,function(r){this._featureUpdatesPromise=null;this.onFeatureUpdatesResult({hasUpdates:r})}))},_evalRefresh:function(r){(r.hasUpdates||this.hasDefinitionExpressionWithCurrentTimestamp())&&this.refresh()},_evalArcadeSupport:function(){var r=new A;setTimeout(E.hitch(this,function(){this._initializeArcadeEngine().always(function(){r.resolve()})}),
0);return r.promise},_initializeArcadeEngine:function(){var r=[],N=this.infoTemplate;N&&N.initializeArcadeEngine&&r.push(N.initializeArcadeEngine());(N=this.renderer)&&N.initializeArcadeEngine&&r.push(N.initializeArcadeEngine());var X=[];w.forEach(this.labelingInfo,function(ca){(ca=ca.labelExpressionInfo)&&ca.expression&&X.push(ca.expression)});r.push(Y.initialize(X));return H(r)},_isGeometryOperationsUsed:function(){var r=this.infoTemplate,N=this.renderer,X=this.labelingInfo;return r&&r.hasGeometryOperations&&
r.hasGeometryOperations()||N&&N.hasGeometryOperations&&N.hasGeometryOperations()||w.some(X,function(ca){return W.hasGeometryOperations(ca.labelExpressionInfo&&ca.labelExpressionInfo.expression)})?!0:!1},_forceIdentity:function(){var r=new A,N=this,X=this._url&&this._url.path;var ca=X&&X.toLowerCase().indexOf("/rest/services");var ka=this.editFieldsInfo;ka=ka&&(ka.creatorField||ka.editorField);(this.userIsAdmin||ka)&&!this._getToken()&&-1<ca&&e.id?(ca=X.substring(0,ca)+"/rest/info",h({url:ca,content:{f:"json"},
handleAs:"json",callbackParamName:"callback"}).then(function(ra){if(ra.owningSystemUrl)return e.id.checkSignInStatus(ra.owningSystemUrl+"/sharing")}).then(function(ra){if(ra)return e.id.getCredential(X)}).then(function(ra){ra&&N._findCredential()}).always(function(){r.resolve()})):r.resolve();return r.promise},_isSnapshotMode:function(){return this._mode?this._mode.isInstanceOf(ea):!1},_isOnDemandMode:function(){return this._mode?this._mode.isInstanceOf(va):!1},_isAutoSnapshotMode:function(){return this._isAutoModeEnabled()&&
this.currentMode===Pa.MODE_SNAPSHOT},_getMaxFeaturesForAutoSnapshotMode:function(){var r=this.geometryType;if("esriGeometryPolyline"===r||"esriGeometryPolygon"===r||"esriGeometryMultipoint"===r||this.hasXYFootprint())var N=this.maxRecordCountForAuto;else"esriGeometryPoint"===r&&(N=this.maxPointCountForAuto);return N},getLastExceedsLimitResult:function(){return this._lastExceedsLimitResult},_canUseSnapshotMode:function(r){this._lastExceedsLimitResult=r=(r=r&&r.features&&r.features[0])&&r.attributes&&
r.attributes.exceedslimit;return!(this.mode!==Pa.MODE_AUTO||this.isEditable()||0!==r||!(this._isPaginationAllowed()||this.maxRecordCount>=this._getMaxFeaturesForAutoSnapshotMode()))},_evalModeFromFLimit:function(r){this._canUseSnapshotMode(r)?this._enableAutoSnapshotMode():this._enableAutoOnDemandMode()},_enableAutoSnapshotMode:function(){var r=Pa.MODE_SNAPSHOT;this.isFeatureReductionApplied()?this._updatePreFReductionState(r):this._preSurfaceChangeState?(this._updatePreSurfaceChangeState(r),this._evalSurfaceType(!0)):
this.currentMode!==r&&this._setFetchMode(Pa.MODE_AUTO,r)},_enableAutoOnDemandMode:function(){var r=Pa.MODE_ONDEMAND;this.isFeatureReductionApplied()?this._updatePreFReductionState(r):this._preSurfaceChangeState?this._updatePreSurfaceChangeState(r):this.currentMode!==r&&(this._setFetchMode(Pa.MODE_AUTO,r),this._evalSurfaceType())},_evalModeFromFReduction:function(r){this.loaded&&(r&&this.isFeatureReductionEnabled()&&this._canCluster(r)?this._enableFReductionMode():this._disableFReductionMode())},_enableFReductionMode:function(){this._evalSurfaceType(!0);
if(!this._preFReductionState){var r=this.currentMode;r!==Pa.MODE_SNAPSHOT&&r!==Pa.MODE_STREAM&&r!==Pa.MODE_SELECTION&&(this._preFReductionState={mode:this.mode,currentMode:this.currentMode},this._setFetchMode(this.mode===Pa.MODE_AUTO?Pa.MODE_AUTO:Pa.MODE_SNAPSHOT,Pa.MODE_SNAPSHOT))}},_disableFReductionMode:function(){var r=this._preFReductionState;this._preFReductionState=null;!r||r.mode===this.mode&&r.currentMode===this.currentMode||(this._setFetchMode(r.mode,r.currentMode),this._evalSurfaceType())},
_updatePreFReductionState:function(r){this._preFReductionState=this._preFReductionState||{};this._preFReductionState.mode=Pa.MODE_AUTO;this._preFReductionState.currentMode=r},_evalModeFromSurface:function(){this.hasWebGLSurface()?this._enableWebGLSurfaceMode():this._disableWebGLSurfaceMode()},_enableWebGLSurfaceMode:function(){this._preSurfaceChangeState||(this._preSurfaceChangeState={mode:this.mode,currentMode:this.currentMode},this._setFetchMode(this.mode===Pa.MODE_AUTO?Pa.MODE_AUTO:Pa.MODE_ONDEMAND,
Pa.MODE_ONDEMAND,this.webglDeps.OnDemandDrillMode))},_disableWebGLSurfaceMode:function(){var r=this._preSurfaceChangeState;r&&(this._preSurfaceChangeState=null,this._setFetchMode(r.mode,r.currentMode))},_updatePreSurfaceChangeState:function(r){this._preSurfaceChangeState=this._preSurfaceChangeState||{};this._preSurfaceChangeState.mode=Pa.MODE_AUTO;this._preSurfaceChangeState.currentMode=r},_setFetchMode:function(r,N,X){this.clearSelection();this._mode.suspend();this._mode.destroy();this.mode=r;this.currentMode=
N;X=X||this._getModeConstructor(N);this._mode=new X(this);this.queryPagination=N===Pa.MODE_ONDEMAND&&-1===X.prototype.declaredClass.toLowerCase().indexOf("ondemanddrillmode")?!1:this._isPaginationAllowed();(r=this.getMap())&&r.loaded&&(this._resetMaxAllowableOffset(),this._mode.initialize(r),this._mode.startup())},_isPaginationAllowed:function(){return!(!this._optQueryPagination||this.loaded&&!this.advancedQueryCapabilities.supportsPagination)},_getModeConstructor:function(r){var N;r===Pa.MODE_SNAPSHOT?
N=ea:r===Pa.MODE_ONDEMAND&&(N=va);return N},_hasOnDemandDrillMode:function(){var r=this._mode;r=r&&r.declaredClass;return!!(r&&-1<r.toLowerCase().indexOf("ondemanddrillmode"))},_checkFeatureLimit:function(){this._limitPromise&&(this._limitPromise.cancel(),this._limitPromise=null);var r=this._queryLimit();r&&(this._lastExceedsLimitResult=null,this._limitPromise=r.then(E.hitch(this,function(N){var X=this.currentMode;this._evalModeFromFLimit(N);return{modeChanged:this.currentMode!==X}})).always(E.hitch(this,
function(N){this._limitPromise=null;return N})));return this._limitPromise},_hasPendingLimitQuery:function(){return!!this._exceedsLimitTimer},_queryLimit:function(){if(this._isAutoModeEnabled()){var r,N,X=new A(function(){clearTimeout(r);r=null;N&&!N.isFulfilled()&&N.cancel();N=null});this._exceedsLimitTimer=r=setTimeout(E.hitch(this,function(){this._exceedsLimitTimer=null;var ca=new S,ka=new Z;ka.statisticType="exceedslimit";ka.maxPointCount=this.maxPointCountForAuto;ka.maxRecordCount=this.maxRecordCountForAuto;
ka.maxVertexCount=this.maxVertexCountForAuto;ka.outStatisticFieldName="exceedslimit";ca.outStatistics=[ka];N=this.queryFeatures(ca).promise.then(function(ra){X.resolve(ra)}).otherwise(function(ra){X.reject(ra)})}),0);return X.promise}},_isAutoModeEnabled:function(){return this.mode===Pa.MODE_AUTO&&this.reHostedFS.test(this.url)},_updateCaps:function(){var r=this._editable,N=E.trim(this.capabilities||""),X=w.map(N?N.split(","):[],E.trim),ca=w.map(N?N.toLowerCase().split(","):[],E.trim);N=w.indexOf(ca,
"editing");var ka;ca={Create:w.indexOf(ca,"create"),Update:w.indexOf(ca,"update"),Delete:w.indexOf(ca,"delete")};if(r&&-1===N)X.push("Editing");else if(!r&&-1<N){r=[N];for(ka in ca)-1<ca[ka]&&r.push(ca[ka]);r.sort();for(ka=r.length-1;0<=ka;ka--)X.splice(r[ka],1)}this.capabilities=X.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._suspendImpl()},_suspendImpl:function(r){this._toggleTime(!1);this._refreshHandle&&
(this._refreshHandle.remove(),this._refreshHandle=null);var N=this._mode;N&&(N.suspend(),r&&N.destroy())},onResume:function(r){this.inherited(arguments);this._toggleTime(!0);this._refreshHandle=this.on("feature-updates-result",E.hitch(this,this._evalRefresh));var N=this._map,X=this._getRenderer();if(r.firstOccurrence){if(this._fixRendererFields(),this._updateRequiredFieldsFromLabelingInfo(),this._checkFields(),this.clearSelection(),this._evalFeatureReduction(),this.timeInfo&&!this._trackManager&&
(this._trackIdField||X&&(X.latestObservationRenderer||X.trackRenderer))&&(this._trackManager=new Ja(this),this._trackManager.initialize(N),this._childLayer=this._trackManager.container),X&&"colors"in X&&"blurRadius"in X&&"maxPixelIntensity"in X&&"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&(this._heatmapManager=new Qa(this),this._heatmapManager.initialize(N)),this._zoomConnect=K.connect(N,"onZoomEnd",this,this._zoomEndHandler),this._refreshMaxAllowableOffset(),X=this._mode)X._init||
X.initialize(N),X.startup()}else this._zoomEndHandler(),this._mode&&this._mode.resume()},_zoomEndHandler:function(){var r=this._map;this._updateMaxOffset();this._prevScale=r.getScale();!this.suspended&&this._needsRefresh&&this.refresh()},_updateMaxOffset:function(){var r=this._map;r&&r.loaded&&this._autoGeneralize&&(this._isAutoSnapshotMode()?(r=this.getMaxAllowableOffset(),this._setMaxOffset(this._getMaxOffsetForScale(),!0),this._needsRefresh||(this._needsRefresh=r!=this.getMaxAllowableOffset())):
this._setMaxOffset(r.extent.getWidth()/r.width,!r.extent.spatialReference.isWebMercator()))},_getMaxOffsetForScale:function(){if(this._map){var r=this._map.getScale(),N=this._calculatedScale,X=this._calcMaxOffset,ca=this._prevScale;return r>=N&&(null==ca||ca<N)?X:r<N&&(null==ca||ca>=N)?null:this.getMaxAllowableOffset()}},_calcMaxOffsetForAutoSnapshot:function(){var r=this._map;if(r&&this._canAutoGeneralize()&&this._isAutoSnapshotMode()&&this._autoGeneralize&&null==this.getMaxAllowableOffset()){var N=
this.generalizeForScale;this._calculatedScale=N=this.maxScale?this.maxScale:this.minScale?Math.min(N,this.minScale):Math.min(N,Oa.getScale(r,this.initialExtent));this._calcMaxOffset=r.extent.getWidth()/r.width/r.getScale()*N}else this._calculatedScale=this._calcMaxOffset=void 0},_toggleTime:function(r){var N=this._map;r&&this.timeInfo&&this.useMapTime&&N?(this._mapTimeExtent=N.timeExtent,this._timeConnect||(this._timeConnect=K.connect(N,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=
null,K.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(r){this._mapTimeExtent=r;(r=this._mode)&&r.propertyChangeHandler(0)},_getOffsettedTE:function(r){var N=this._timeOffset,X=this._timeOffsetUnits;return r&&N&&X?r.offset(-1*N,X):r},_getTimeOverlap:function(r,N){return r&&N?r.intersection(N):r||N},_getTimeFilter:function(r){var N=this.getTimeDefinition();if(N){var X=this._getTimeOverlap(N,null);if(!X)return[!1]}if(r){if(r=X?this._getTimeOverlap(r,X):r,!r)return[!1]}else r=
X;return[!0,r]},_getAttributeFilter:function(r){var N=[],X=this.getDefinitionExpression();X&&N.push(X);r&&N.push(r);this.subtypeField&&this.subtypeCode&&N.push(this.subtypeField+" \x3d "+this.subtypeCode);1<N.length&&(N=w.map(N,function(ca){return"("+ca+")"}));return N.length?N.join(" AND "):null},_applyQueryFilters:function(r,N){r.where=this._getAttributeFilter(r.where);r.returnGeometry&&null==r.maxAllowableOffset&&!r.quantizationParameters&&(r.maxAllowableOffset=this._maxOffset,r.quantizationParameters=
this._quantizationParameters);N&&this.supportsAdvancedQueries&&(r.orderByFields=r.orderByFields||this.getOrderByFields());if(this.timeInfo)if(N=this._getTimeFilter(r.timeExtent),N[0])r.timeExtent=N[1];else return!1;return!0},_add:function(r){var N=this._selectionSymbol,X=r.attributes,ca=this.visibilityField;N&&this._isSelOnly&&r.setSymbol(N);if(ca&&X&&X.hasOwnProperty(ca))r[X[ca]?"show":"hide"]();return this.add.apply(this,arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(r,
N){var X=[],ca=this._map,ka;if((this._collection||!this._isTable&&ca)&&!(r.text||r.where&&r.where!==this.getDefinitionExpression()||r.orderByFields&&r.orderByFields.length&&(ka=this.getOrderByFields()||[])&&r.orderByFields.join()!==ka.join()||r.outStatistics||r.returnDistinctValues)){ka=this._isSnapshotMode();var ra=this._isSelOnly;N=ka?null:N?this._getExtentOfTiles(ca.extent):ca.extent;if(ca=r.geometry){if(ra||r.spatialRelationship!==S.SPATIAL_REL_INTERSECTS||"extent"!==ca.type||!ka&&!N.contains(ca))return;
X.push(1)}if(N=r.objectIds)if(ka)X.push(2);else{ca=N.length;var k=this._mode,z=0,P;for(P=0;P<ca;P++)k._getFeature(N[P])&&z++;if(z===ca)X.push(2);else return}if(this.timeInfo)if(r=r.timeExtent,N=this._mapTimeExtent,ka)r&&X.push(3);else if(ra){if(r)return}else if(N)if(-1!==w.indexOf(X,2))r&&X.push(3);else if(-1!==w.indexOf(X,1))r==N&&X.push(3);else return;else if(0<X.length)r&&X.push(3);else if(r)return;return 0<X.length?X:null}},_getAbsMid:function(r){return L.toAbsMid?L.toAbsMid(r):J.id.replace(/\/[^\/]*$/ig,
"/")+r},_doQuery:function(r,N,X){var ca=[],ka=this.objectIdField,ra=this,k=new A,z=new A,P=this.graphics;if(-1!==w.indexOf(N,1)){var V=this.spatialIndex||this._map&&this._map.spatialIndex,U,aa=r.geometry._normalize(null,!0);null==V&&Xa.autoSpatialIndexing?U=(this._map||this).addPlugin(this._getAbsMid("../plugins/spatialIndex")).then(E.hitch(this,E.partial(this._getFromIndex,aa,V)),function(da){z.resolve(E.hitch(this,E.partial(this._filterByExtent,P,aa)))}):V&&(U=this._getFromIndex(aa,V));U?U.then(function(da){for(var ja=
0;ja<da.length;ja++)da[ja].results&&(ca=ca.concat(da[ja].results));z.resolve(ca)}).otherwise(function(da){z.reject(da)}):z.resolve(this._filterByExtent(P,aa))}else z.resolve(P);z.then(function(da){ca=da;if(-1!==w.indexOf(N,2)){var ja=r.objectIds;ca=w.filter(ca,function(ma){return-1<w.indexOf(ja,ma.attributes[ka])})}-1!==w.indexOf(N,3)&&ra.timeInfo&&(da=r.timeExtent,ca=ra._filterByTime(ca,da.startTime,da.endTime).match);X&&(ca=w.map(ca,function(ma){return ma.attributes[ka]},this));k.resolve(ca)});
return k},_getFromIndex:function(r,N){N=N||this.spatialIndex||this._map.spatialIndex;r instanceof Array||(r=[r]);var X=this.id;return c(w.map(r,function(ca){return N.intersects(ca,X)}))},_filterByExtent:function(r,N){for(var X=[],ca=0,ka=r.length;ca<ka;ca++){var ra=r[ca],k=ra.geometry;k&&(this.normalization&&N.length?(N[0].intersects(k)||N[1].intersects(k))&&X.push(ra):N.intersects(k)&&X.push(ra))}return X},_filterByTime:function(r,N,X){var ca=this._startTimeField,ka=this._endTimeField,ra;this._twoTimeFields||
(ra=ca||ka);var k=d.isDefined,z=[],P=[],V,U=r.length;N=N?N.getTime():-Infinity;X=X?X.getTime():Infinity;if(ra)for(V=0;V<U;V++){var aa=r[V];var da=aa.attributes;ca=da[ra];ca>=N&&ca<=X?z.push(aa):P.push(aa)}else for(V=0;V<U;V++)aa=r[V],da=aa.attributes,ra=da[ca],da=da[ka],ra=k(ra)?ra:-Infinity,da=k(da)?da:Infinity,ra>=N&&ra<=X||da>=N&&da<=X||N>=ra&&X<=da?z.push(aa):P.push(aa);return{match:z,noMatch:P}},_getSizeVariables:function(r){return r&&w.filter(r.getVisualVariablesForType("sizeInfo",!1),function(N){return!(!N.field&&
!N.valueExpression)})},_needClientSideSorting:function(r){return this._collection?!(!r||!r.length):w.some(r,function(N){return!!N.valueExpression})},_sortFeatures:function(r){var N=this.renderer,X=this._getSizeVariables(N);if(r&&1<r.length&&this._needClientSideSorting(X)){var ca=X[0],ka=this;r.sort(function(ra,k){ra._layer||(ra._layer=ka);k._layer||(k._layer=ka);ra=N._getDataValue(ra,ca,"sizeInfo");k=N._getDataValue(k,ca,"sizeInfo");return null==ra?-1:null==k?1:k-ra})}return r},_resolve:function(r,
N,X,ca,ka){N&&this[N].apply(this,r);X&&X.apply(null,r);ca&&I._resDfd(ca,r,ka)},_getShallowClone:function(r){var N=new S,X;for(X in r)r.hasOwnProperty(X)&&(N[X]=r[X]);return N},_canFetchPBF:function(){return!!(bb&&fb&&this.supportsFormatPBF)},_canFetchPBFForQuery:function(r){return!(!this._canFetchPBF()||!this._isCacheHintEnabled(r)&&this._isAutoSnapshotMode()||!(r.quantizationParameters||!this.isEditable()&&this.supportsQuantizationEditMode)||r.outStatistics)},_enableEditModeQuantization:function(r,
N){r&&N&&!r.quantizationParameters&&(r.quantizationParameters={mode:"edit"})},_enableCacheHint:function(r,N){var X=this.advancedQueryCapabilities;X&&X.supportsQueryWithCacheHint?null==r.cacheHint&&(r.cacheHint=!0):X&&X.supportsQueryWithResultType&&this.reHostedFS.test(this.url)&&!r.resultType&&(r.resultType=N||"coherent")},_isCacheHintSupported:function(){var r=this.advancedQueryCapabilities;return r?!!(r.supportsQueryWithCacheHint||r.supportsQueryWithResultType&&this.reHostedFS.test(this.url)):!1},
_isCacheHintEnabled:function(r){var N=this.advancedQueryCapabilities;return r&&N?!!(N.supportsQueryWithCacheHint&&r.cacheHint||N.supportsQueryWithResultType&&this.reHostedFS.test(this.url)&&("coherent"===r.resultType||"tile"===r.resultType)):!1},_query:function(r,N,X,ca,ka,ra){var k=this,z=this._map;ra=ra&&ra.snapToTiles;var P=new A(I._dfdCanceller),V=X,U,aa,da;if("executeRelationshipQuery"!==r){V=this._getShallowClone(X);var ja=this.getOutFields();V.outFields||(V.outFields=ja);V.outFields&&V.outFields.length&&
(aa=-1<w.indexOf(ja,"*")?!1:!w.every(V.outFields,function(Aa){return-1<w.indexOf(ja,Aa)}));V.returnGeometry=X.hasOwnProperty("returnGeometry")?X.returnGeometry:!X.outStatistics;V.returnGeometry&&(V.multipatchOption=this.multipatchOption,null!=V.maxAllowableOffset||V.quantizationParameters)&&(X=null!=V.maxAllowableOffset?V.maxAllowableOffset:V.quantizationParameters.tolerance,null!=X&&X!==this.getMaxAllowableOffset()&&(da=!0));z&&(z=z&&z.spatialReference,(X=V.outSpatialReference)?U=!X.equals(z):V.outSpatialReference=
new u(z.toJson()));ra&&(z=V.geometry)&&"extent"===z.type&&(V.geometry=this._getExtentOfTiles(z),z!==V.geometry&&this._enableCacheHint(V));if(!this._applyQueryFilters(V,"execute"===r&&!V.outStatistics)){switch(r){case "execute":var ma=new T({features:[]});break;case "executeForIds":ma=[];break;case "executeForCount":ma=0;break;case "executeForExtent":ma={}}this._resolve([ma],N,ca,P);return P}if(ra="executeForExtent"!==r&&!U&&!aa&&!da&&this._canDoClientSideQuery(V,ra))return P._pendingDfd=f(this._doQuery(V,
ra,"executeForIds"===r||"executeForCount"===r)),P._pendingDfd.then(function(Aa){switch(r){case "execute":ma=new T;ma.features=Aa;break;case "executeForIds":ma=Aa;break;case "executeForCount":ma=Aa.length}k._resolve([ma],N,ca,P)}),P}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,ka,P,!0),P;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,ka,P,!0),P;this._ts&&(V._ts=(new Date).getTime());
ra="execute"===r&&this._canFetchPBFForQuery(V);this._enableEditModeQuantization(V,ra);(P._pendingDfd=this._task[r](V,null,null,ra?{format:"pbf"}:null)).addCallbacks(function(Aa){var Ca=!!V.outStatistics||U||aa||da;if("execute"===r||"executeRelationshipQuery"===r)if("execute"===r){var Ha=Aa.features;var Ka=Ha.length;for(--Ka;0<=Ka;Ka--)if(Ha[Ka]._layer=k,!Ca&&!k._isTable){var Ya=k._mode._getFeature(Ha[Ka].attributes[k.objectIdField]);Ya&&Ha.splice(Ka,1,Ya)}}else for(Ya in Aa)if(Aa.hasOwnProperty(Ya))for(Ha=
Aa[Ya].features,Ka=Ha.length,--Ka;0<=Ka;Ka--)Ha[Ka]._layer=k;k._resolve([Aa],N,ca,P)},function(Aa){k._resolve([Aa],null,ka,P,!0)});return P},_getExtentOfTiles:function(r){var N=this._isOnDemandMode()&&this._mode._gridLayer||ya.createFromFeatureLayer({layer:this}),X=this.getMap();X=X&&X.getTargetExtent(r);return N&&X&&N.getExtentOfIntersectingCells(X)||r},_convertFeaturesToJson:function(r,N,X,ca){var ka=[],ra=this._selectionSymbol,k=this.visibilityField,z,P=this.objectIdField;this.loaded&&(X||ca)&&
(z=w.filter(this.fields,function(ma){return!1===ma.editable&&(!ca||ma.name!==P)}));for(X=0;X<r.length;X++){var V=r[X],U={},aa=V.geometry,da=V.attributes,ja=V.symbol;!aa||ca&&this.loaded&&!this.allowGeometryUpdates||(U.geometry=aa.toJson());k?(U.attributes=da=E.mixin({},da),da[k]=V.visible?1:0):da&&(U.attributes=E.mixin({},da));U.attributes&&z&&z.length&&w.forEach(z,function(ma){delete U.attributes[ma.name]});ja&&ja!==ra&&(U.symbol=ja.toJson());ka.push(U)}return N?ka:x.toJson(ka)},_selectHandler:function(r,
N,X,ca,ka){switch(N){case Pa.SELECTION_NEW:this.clearSelection(!0);var ra=!0;break;case Pa.SELECTION_ADD:ra=!0;break;case Pa.SELECTION_SUBTRACT:ra=!1}ca=r.features;var k=this._mode,z=[],P=this.objectIdField;if(ra)for(ra=0;ra<ca.length;ra++){var V=ca[ra];var U=V.attributes[P];V=k._addFeatureIIf(U,V);z.push(V);this._selectFeatureIIf(U,V,k)}else for(ra=0;ra<ca.length;ra++)V=ca[ra],U=V.attributes[P],this._unSelectFeatureIIf(U,k),U=k._removeFeatureIIf(U),z.push(U||V);this._isSelOnly&&k._applyTimeFilter(!0);
this._isImageService&&10.7>this.version&&void 0===r.exceededTransferLimit&&(r.exceededTransferLimit=ca.length===this.maxRecordCount);this._hasPartialSelectedFeatures=!!r.exceededTransferLimit;this._resolve([z,N,r.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",X,ka);if(r.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(r,N,X){var ca=this._selectedFeatures,ka=ca[r];ka||(X._incRefCount(r),ca[r]=N,this._isTable||(this._setSelectSymbol(N),N.attr("data-selected",
"")));return ka||N},_unSelectFeatureIIf:function(r,N){var X=this._selectedFeatures[r];X&&(N._decRefCount(r),delete this._selectedFeatures[r],this._isTable||(this._setUnSelectSymbol(X),X.attr("data-selected")));return X},_setSelectSymbol:function(r){var N=this._selectionSymbol;N&&!this._isSelOnly&&r.setSymbol(N)},_setUnSelectSymbol:function(r){var N=this._selectionSymbol;N&&!this._isSelOnly&&N===r.symbol&&r.setSymbol(null,!0)},_getOutFields:function(){var r=[this.objectIdField,this.typeIdField,this.creatorField,
this._startTimeField,this._endTimeField,this._trackIdField].concat(this._requiredFields).concat(this.dataAttributes);r=w.filter(r,function(X,ca,ka){return!!X&&w.indexOf(ka,X)===ca});var N=E.clone(this._outFields);if(N){if(-1!==w.indexOf(N,"*"))return N;w.forEach(r,function(X){-1===w.indexOf(N,X)&&N.push(X)});return N}return r},_checkFields:function(r){var N=r||this._getOutFields();w.forEach(N,function(X){"*"!==X&&(this._getField(X)||console.debug("esri.layers.FeatureLayer: "+d.substitute({url:this.url,
field:X},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);r||this._isTable||this._fserver||this._collection||this._isStream||w.some(this.fields,function(X){return X&&"esriFieldTypeGeometry"===X.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+d.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]"))},
_fixFieldCase:function(r,N,X){var ca=r&&r[N],ka;if(ca&&!E.isFunction(ca)){if(ka=!this._getField(ca)&&this._getField(ca,!0))ca=r[N]=ka.name;X&&X.push(ca)}return ca},_fixRendererFields:function(){var r=this.renderer;this._orderBy=null;this._requiredFields=[];if(r&&0<this.fields.length){var N=[],X;r=w.filter([r,r.observationRenderer,r.latestObservationRenderer,r.trackRenderer],d.isDefined);var ca=[].concat(r);w.forEach(r,function(ka){w.forEach(ka.rendererInfos,function(ra){ra.renderer&&ca.push(ra.renderer)})});
w.forEach(ca,function(ka){this._fixFieldCase(ka,"attributeField",N);this._fixFieldCase(ka,"attributeField2",N);this._fixFieldCase(ka,"attributeField3",N);this._fixFieldCase(ka.rotationInfo,"field",N);(X=this._fixFieldCase(ka.sizeInfo,"field",N))&&!this._orderBy&&(this._orderBy=[X+" DESC"]);this._fixFieldCase(ka.sizeInfo,"normalizationField",N);this._fixFieldCase(ka.colorInfo,"field",N);this._fixFieldCase(ka.colorInfo,"normalizationField",N);this._fixFieldCase(ka.field,"field",N);this._fixFieldCase(ka.opacityInfo,
"field",N);this._fixFieldCase(ka.opacityInfo,"normalizationField",N);w.forEach(ka.visualVariables,function(k){X=this._fixFieldCase(k,"field",N);"sizeInfo"===k.type&&X&&!this._orderBy&&(this._orderBy=[X+" DESC"]);this._fixFieldCase(k,"normalizationField",N)},this);var ra=w.map(this.fields,function(k){return k.name},this);ra=w.map(ka.getFieldsUsedInExpressions(ra),function(k){var z=this.getField(k);return z?z.name:k},this);N=N.concat(ra);this._orderBy||!ka.addBreak||E.isFunction(ka.attributeField)||
!ka.backgroundFillSymbol&&!this._hasSizeDiff(ka)||(this._orderBy=[ka.attributeField+" DESC"])},this);this._requiredFields=w.filter(N,d.isDefined)}},_hasSizeDiff:function(r){var N=Number.MAX_VALUE,X=-Number.MAX_VALUE,ca,ka;w.forEach(r.infos,function(ra){if(ka=ra.symbol){ca=0;switch(ka.type){case "simplemarkersymbol":ca=ka.size;break;case "picturemarkersymbol":ca=(ka.width+ka.height)/2;break;case "simplelinesymbol":case "cartographiclinesymbol":ca=ka.width;break;case "simplefillsymbol":case "picturefillsymbol":ca=
ka.outline&&ka.outline.width}ca&&(N=Math.min(N,ca),X=Math.max(X,ca))}});return N!==Number.MAX_VALUE&&X!==-Number.MAX_VALUE&&1<Math.abs(X-N)},getOrderByFields:function(){var r=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&r?w.filter(r,function(N){N=N.split(" ")[0];return!!this._getField(N,!0)},this):null},_createFields:function(r){var N=r?r.length:0,X,ca=[];for(X=0;X<N;X++)ca.push(new Ra(r[X]));this.fields=ca},_createFieldsIndex:function(){if(this._fieldsIndexDirty){var r=
this.fields,N=r?r.length:0;if(50<N&&this._canUseFieldsIndex()){var X=new Map;for(var ca=new Map,ka=0;ka<N;ka++){var ra=r[ka];X.set(ra.name,ra);ca.set(ra.name.toLowerCase(),ra)}X={caseSensitive:X,caseInsensitive:ca}}this._fieldsIndex=X;this._fieldsIndexDirty=!1}},_canUseFieldsIndex:function(){var r=b.Map;return!("function"!==typeof b.Proxy||"function"!==typeof b.Proxy.revocable||"function"!==typeof r||!r.prototype||"function"!==typeof r.prototype.set)},_getField:function(r,N){var X=this.fields;if(!X||
0===X.length)return null;N&&(r=r.toLowerCase());this._createFieldsIndex();var ca=this._fieldsIndex;if(ca)return ca=N?ca.caseInsensitive:ca.caseSensitive,ca.get(r);var ka;w.some(X,function(ra){var k=!1;(k=N?ra&&ra.name.toLowerCase()===r?!0:!1:ra&&ra.name===r?!0:!1)&&(ka=ra);return k});return ka},_getDateOpts:function(){this._dtOpts||(this._dtOpts={properties:w.map(w.filter(this.fields,function(r){return!(!r||"esriFieldTypeDate"!==r.type)}),function(r){return r.name})});return this._dtOpts},_applyNormalized:function(r,
N){r&&N&&w.forEach(r,function(X,ca){X&&N[ca]&&X.setGeometry(N[ca])})},_editHandler:function(r,N,X,ca,ka,ra){ka=r.addResults;var k=r.updateResults;r=r.deleteResults;var z,P=this.objectIdField,V=this._mode,U=this._isTable;var aa=this.editFieldsInfo;var da=this.getOutFields()||[];var ja=aa&&aa.creatorField,ma=aa&&aa.creationDateField,Aa=aa&&aa.editorField,Ca=aa&&aa.editDateField;aa=aa&&aa.realm;-1===w.indexOf(da,"*")&&(ja&&-1===w.indexOf(da,ja)&&(ja=null),ma&&-1===w.indexOf(da,ma)&&(ma=null),Aa&&-1===
w.indexOf(da,Aa)&&(Aa=null),Ca&&-1===w.indexOf(da,Ca)&&(Ca=null));var Ha=ma||Ca?(new Date).getTime():null,Ka=ja||Aa?this.getUserId():void 0;Ka&&aa&&(Ka=Ka+"@"+aa);if(ka){var Ya=this.globalIdField;for(aa=0;aa<ka.length;aa++)if(ka[aa]=new ha(ka[aa]),!U){var Wa=ka[aa];if(Wa.success){var Za=Wa.objectId;da=N[aa];(z=da._graphicsLayer)&&z!==this&&z.remove(da);z=da.attributes||{};z[P]=Za;Za=Wa.globalId;Ya&&Za&&(z[Ya]=Za);ja&&(z[ja]=Ka);Aa&&(z[Aa]=Ka);ma&&(z[ma]=Ha);Ca&&(z[Ca]=Ha);da.setAttributes(z);V._init&&
V.drawFeature(da)}}}if(k)for(aa=0;aa<k.length;aa++)if(k[aa]=new ha(k[aa]),!U&&(Wa=k[aa],Wa.success)){Za=Wa.objectId;da=X[Za];if(N=V._getFeature(Za))N.geometry!==da.geometry&&da.geometry&&N.setGeometry(ta.fromJson(da.geometry.toJson())),N.attributes!==da.attributes&&da.attributes&&N.setAttributes(E.mixin(N.attributes,da.attributes)),this._repaint(N,Za);da=N||da;z=da.attributes||{};Aa&&(z[Aa]=Ka);Ca&&(z[Ca]=Ha);da.setAttributes(z)}if(r){X=[];for(aa=0;aa<r.length;aa++)if(r[aa]=new ha(r[aa]),!U&&(Wa=
r[aa],Wa.success&&(Za=Wa.objectId,da=V._getFeature(Za))))this._unSelectFeatureIIf(Za,V)&&X.push(da),da._count=0,V._removeFeatureIIf(Za);if(0<X.length)this.onSelectionComplete(X,Pa.SELECTION_SUBTRACT)}this._resolve([ka,k,r],"onEditsComplete",ca,ra)},_sendAttachment:function(r,N,X,ca,ka){var ra=this;return h({url:this._url.path+"/"+N+"/"+("add"===r?"addAttachment":"updateAttachment"),form:X,content:E.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",
handleAs:"json"}).addCallback(function(k){var z="add"===r?"onAddAttachmentComplete":"onUpdateAttachmentComplete";k=new ha(k["add"===r?"addAttachmentResult":"updateAttachmentResult"]);k.attachmentId=k.objectId;k.objectId=N;ra._resolve([k],z,ca);return k}).addErrback(function(k){ra._resolve([k],null,ka,null,!0)})},_repaint:function(r,N,X){N=d.isDefined(N)?N:r.attributes[this.objectIdField];N in this._selectedFeatures&&this._selectionSymbol||r.setSymbol(r.symbol,X)},_getKind:function(r){var N=this._trackManager;
return N?N.isLatestObservation(r)?1:0:0}});E.mixin(Pa,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,MODE_AUTO:6,MODE_STREAM:7,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});Ba._createWrappers(Pa);Object.defineProperty(Pa.prototype,"graphics",{get:function(){return this._hasOnDemandDrillMode()?this._mode.graphics:this._graphicsVal},set:function(r){this._graphicsVal=
r}});Object.defineProperty(Pa.prototype,"name",{get:function(){return this.arcgisProps&&this.arcgisProps.title?this.arcgisProps.title:this._name},set:function(r){this._name=r;this.loaded&&this.arcgisProps&&(this.arcgisProps.title=null)}});Object.defineProperty(Pa.prototype,"fields",{get:function(){return this._fields},set:function(r){r&&this._canUseFieldsIndex()&&(r=new Proxy(r,{set:E.hitch(this,function(N,X,ca){if(X)if("length"===X)this._fieldsIndexDirty=!0;else{var ka=Number(X);"number"!==typeof ka||
isNaN(ka)||(this._fieldsIndexDirty=!0)}N[X]=ca;return!0})}));this._fields=r;this._fieldsIndexDirty=!0}});a("extend-esri")&&E.setObject("layers.FeatureLayer",Pa,e);return Pa})},"esri/arcadeProfiles/labelingProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(L,J,q,K,E,w,x,A){L=new (L(null,{declaredClass:"esri.arcadeProfiles.LabelingProfile",defaults:{context:{vars:{$feature:"any"}}},
initialize:function(n){var g=[];A.hasGeometryOperations(n)&&g.push(x.enableGeometryOperations());return E(g)},isAsync:function(n){return!1},parse:function(n){return x.createSyntaxTree(n.expression)},compile:function(n){var g=J.clone(this.defaults.context);return n.syntaxTree?x.createFunction(n.syntaxTree,g):null},getEvalOptions:function(n){var g=n.feature;return{context:{vars:{$feature:g&&n.expression.hasVariable("$feature")?w.createFromGraphicLikeObject(g.geometry,g.attributes,n.layer):null},spatialReference:n.spatialReference}}}}));
q("extend-esri")&&J.setObject("arcadeProfiles.labelingProfile",L,K);return L})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../symbols/jsonUtils ./FeatureTemplate ./support/domainUtils".split(" "),function(L,J,q,K,E,w,x,A,n){L=L(null,{declaredClass:"esri.layers.FeatureType",constructor:function(g){if(g&&J.isObject(g)){this.id=g.id;this.name=g.name;var m=g.symbol;m&&(this.symbol=x.fromJson(m));m=g.domains;var l=this.domains=
{};for(f in m)m.hasOwnProperty(f)&&(l[f]=n.fromJson(m[f]));if(g=g.templates){var f=this.templates=[];for(m=0;m<g.length;m++)f.push(new A(g[m]))}}},toJson:function(){var g={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},m,l=this.domains,f=this.templates,b=w.fixJson;if(l){var c=g.domains={};for(m in l)l.hasOwnProperty(m)&&(c[m]=l[m]&&l[m].toJson());b(c)}f&&(g.templates=q.map(f,function(a){return a.toJson()}));return b(g)}});K("extend-esri")&&J.setObject("layers.FeatureType",L,E);
return L})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../graphic".split(" "),function(L,J,q,K,E,w){L=L(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(x){x&&J.isObject(x)&&(this.name=x.name,this.description=x.description,this.drawingTool=x.drawingTool,this.thumbnail=x.thumbnail,x=x.prototype,this.prototype=new w(x.geometry,null,x.attributes))},toJson:function(){return E.fixJson({name:this.name,description:this.description,
drawingTool:this.drawingTool,thumbnail:E.fixJson(J.clone(this.thumbnail)),prototype:this.prototype&&this.prototype.toJson()})}});J.mixin(L,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",
TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});q("extend-esri")&&J.setObject("layers.FeatureTemplate",L,K);return L})},"esri/layers/support/domainUtils":function(){define("dojo/_base/lang dojo/has ../../kernel ../RangeDomain ../CodedValueDomain ../InheritedDomain".split(" "),function(L,
J,q,K,E,w){var x={fromJson:function(A){if(A)switch(A.type){case "range":var n=new K(A);break;case "codedValue":n=new E(A);break;case "inherited":n=new w(A)}return n}};J("extend-esri")&&L.setObject("layers.support.domainUtils",x,q);return x})},"esri/layers/FeatureSubtype":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./support/domainUtils".split(" "),function(L,J,q,K,E,w){L=L(null,{declaredClass:"esri.layers.FeatureSubtype",constructor:function(x){if(x&&J.isObject(x)){this.code=
x.code;this.name=x.name;this.defaultValues=x.defaultValues;x=x.domains;var A=this.domains={},n;for(n in x)x.hasOwnProperty(n)&&(A[n]=w.fromJson(x[n]))}},toJson:function(){var x=E.fixJson,A={code:this.code,name:this.name,defaultValues:x(J.clone(this.defaultValues))},n=this.domains;if(n){var g=A.domains={},m;for(m in n)n.hasOwnProperty(m)&&(g[m]=n[m]&&n[m].toJson());x(g)}return x(A)}});q("extend-esri")&&J.setObject("layers.FeatureSubtype",L,K);return L})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(L,J,q,K){L=L(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(E){E&&J.isObject(E)&&(this.objectId=E.objectId,this.globalId=E.globalId,this.success=E.success,E.success||(E=E.error,this.error=Error(),this.error.code=E.code,this.error.message=E.description))}});q("extend-esri")&&J.setObject("layers.FeatureEditResult",L,K);return L})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ../srUtils ../tasks/query ./RenderMode ./support/ParallelSnapshot".split(" "),
function(L,J,q,K,E,w,x,A,n){L=L([A],{declaredClass:"esri.layers._SnapshotMode",maxFeatures:5E4,maxRecordCountFactor:1,scaleToTileFactor:1,_isSuspendedAtStartup:!1,_pendingRefresh:!1,constructor:function(g){this.featureLayer=g;this._featureMap={};this._hasUpdateError=this._hasPartialFeatures=!1;this._drawFeatures=J.hitch(this,this._drawFeatures);this._queryErrorHandler=J.hitch(this,this._queryErrorHandler);this._handleSuccess=J.hitch(this,this._handleSuccess);this._handleError=J.hitch(this,this._handleError);
this._handleProgress=J.hitch(this,this._handleProgress)},startup:function(){if(!this._started||this._isSuspendedAtStartup){this.inherited(arguments);var g=this.featureLayer,m=g.reHostedFS.test(g.url);this.pagination=g.queryPagination&&null!=g.maxRecordCount;this._cacheHintSupported=g._isCacheHintSupported();this.scaleToTileFactor=this._getScaleToTileFactor();m&&this.pagination&&(this._parallelSnapshot=new n({layer:g,mode:this,queryTask:g._task}));this._isSuspendedAtStartup=g.suspended;this._startup()}},
propertyChangeHandler:function(g){this._init&&(g?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},destroy:function(){this._isSuspendedAtStartup=this._pendingRefresh=!1;this._cancelPendingRequest(this._pendingRequest);this._parallelSnapshot&&this._parallelSnapshot.destroy();this.inherited(arguments)},
drawFeature:function(g){var m=g.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(m,g);this._incRefCount(m)},resume:function(){this._isSuspendedAtStartup||this._pendingRefresh?(this._isSuspendedAtStartup=!1,this._startup()):this.propertyChangeHandler(0)},refresh:function(){var g=this.featureLayer;g._collection?(g._fireUpdateStart(),g._refresh(!0),g._fireUpdateEnd()):this._fetchAll()},hasAllFeatures:function(){return!this._hasPartialFeatures},hasUpdateError:function(){return this._hasUpdateError},
canFetchPBF:function(g){return this.inherited(arguments)&&this.featureLayer._canFetchPBFForQuery(g)},_startup:function(){this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},_fetchAll:function(){var g=this.featureLayer;g._collection||g.suspended||!g.isQueryable()?this._pendingRefresh=g.suspended:(this._pendingRefresh=!1,g._fireUpdateStart(),this._clearIIf(),this._hasUpdateError=this._hasPartialFeatures=!1,this._parallelSnapshot?this._parallelSnapshot.fetch().then(this._handleSuccess,
this._handleError,this._handleProgress):this._sendRequest())},_handleSuccess:function(g){this._hasPartialFeatures=g.hasPartialFeatures;this._hasUpdateError=g.hasUpdateError;this.featureLayer._fireUpdateEnd(null)},_handleError:function(g){this._queryErrorHandler(g)},_handleProgress:function(g){g.isError?this.featureLayer._errorHandler(g.error):this._addFeatures(g.features)},_getScaleToTileFactor:function(){var g=this.featureLayer.tileMaxRecordCount,m=this.featureLayer.maxRecordCount,l=1;null!=g&&null!=
m&&(l=Number((g/m).toFixed(2)));return l},_getPageSize:function(g){var m=this.featureLayer.tileMaxRecordCount;m="tile"===g.resultType&&m?m:this.featureLayer.maxRecordCount;g.maxRecordCountFactor&&(m=Math.floor(m*g.maxRecordCountFactor));return m},_sendRequest:function(g){var m=this.featureLayer,l=this._createQueryInfo(),f=l.query;this.pagination&&(this._pageSize=this._getPageSize(f),this._start=f.start=null==g?0:g,f.num=this._pageSize);this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);
this._pendingRequest=m._task.execute(f,this._drawFeatures,this._queryErrorHandler,l.pbf?{format:"pbf"}:null)},_drawFeatures:function(g){this._pendingRequest=null;this.featureLayer._isImageService&&10.7>this.featureLayer.version&&void 0===g.exceededTransferLimit&&(g.exceededTransferLimit=g.features.length===this.featureLayer.maxRecordCount);var m=this.featureLayer,l=g.exceededTransferLimit,f=l&&!m._collection;g=this._checkMaxLimit(g.features);var b=g.maxLimitReached;this._addFeatures(g.features);this.pagination&&
f&&!b||(this._hasPartialFeatures=!!l,m._fireUpdateEnd(null,l?{queryLimitExceeded:!0}:null));f&&(this.pagination&&!b&&this._sendRequest(this._start+this._pageSize),m.onQueryLimitExceeded())},_queryErrorHandler:function(g){this._pendingRequest=null;this._hasUpdateError=this._hasPartialFeatures=!0;var m=this.featureLayer;m._errorHandler(g);m._fireUpdateEnd(g)},_checkMaxLimit:function(g){var m=g?g.length:0,l=this.featureLayer.graphics.length+m,f=l>=this.maxFeatures;if(f){var b=l-this.maxFeatures;b&&g.splice(m-
b,b)}return{maxLimitReached:f,featuresDiscarded:l>this.maxFeatures,features:g}},_createQueryInfo:function(){var g=this.featureLayer,m=new x;m.outFields=g.getOutFields();m.where=g._getAttributeFilter()||"1\x3d1";m.returnGeometry=!0;m.outSpatialReference=w.createSpatialReference(this.map.spatialReference.toJson());m.timeExtent=g.getTimeDefinition();m.maxAllowableOffset=g._maxOffset;m.quantizationParameters=g._quantizationParameters;m.orderByFields=g.supportsAdvancedQueries?g.getOrderByFields():null;
m.multipatchOption=g.multipatchOption;g._ts&&(m._ts=(new Date).getTime());this._cacheHintSupported&&g._enableCacheHint(m);var l=this.canFetchPBF(m);g._enableEditModeQuantization(m,l);this._applyMaxRecordCountFactor(m,l);return{query:m,pbf:l}},_applyMaxRecordCountFactor:function(g,m){var l=this.featureLayer.advancedQueryCapabilities;this.featureLayer._isCacheHintEnabled(g)&&l&&l.supportsMaxRecordCountFactor&&("tile"!==g.resultType&&1<this.scaleToTileFactor&&(g.maxRecordCountFactor=this.scaleToTileFactor),
m&&1<this.maxRecordCountFactor&&(g.maxRecordCountFactor=this.maxRecordCountFactor),5<g.maxRecordCountFactor&&(g.maxRecordCountFactor=5))},_addFeatures:function(g){var m=this.featureLayer,l=m.objectIdField,f=g.length,b=m._selectedFeatures,c=m.mode===m.constructor.MODE_AUTO;m._fireUpdateStart();m._sortFeatures(g);for(m=0;m<f;m++){var a=g[m];var e=a.attributes[l];var d=this._addFeatureIIf(e,a);this._incRefCount(e);c&&d!==a&&b[e]&&(d.setGeometry(a.geometry),d.setAttributes(a.attributes))}this._applyTimeFilter(!0)}});
q("extend-esri")&&J.setObject("layers._SnapshotMode",L,K);return L})},"esri/layers/RenderMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","../sniff","../kernel"],function(L,J,q,K,E){var w=!!K("esri-pbf"),x=!!K("esri-featurelayer-pbf");L=L(null,{declaredClass:"esri.layers._RenderMode",enablePBFQuery:w&&x,initialize:function(A){this.map=A;this._init=!0},startup:function(){this._started=!0},propertyChangeHandler:function(A){},destroy:function(){this._init=this._started=
!1},drawFeature:function(A){},suspend:function(){},resume:function(){},refresh:function(){},hasAllFeatures:function(){return!0},hasUpdateError:function(){return!1},canFetchPBF:function(A){return!(!this.featureLayer._canFetchPBF()||!this.enablePBFQuery)},_incRefCount:function(A){(A=this._featureMap[A])&&A._count++},_decRefCount:function(A){(A=this._featureMap[A])&&A._count--},_getFeature:function(A){return this._featureMap[A]},_addFeatureIIf:function(A,n){var g=this._featureMap,m=g[A],l=this.featureLayer;
m||(g[A]=n,l._add(n),n._count=0);return m||n},_removeFeatureIIf:function(A){var n=this._featureMap[A],g=this.featureLayer;if(n){if(n._count)return;delete this._featureMap[A];g._remove(n)}return n},_registerFeature:function(A,n){var g=this._featureMap,m=g[A];m?(m.attributes=n.attributes,m.geometry=n.geometry):(g[A]=n,n._count=0,n._layer=n._graphicsLayer=n._sourceLayer=this.featureLayer);return m||n},_unregisterFeature:function(A){var n=this._featureMap,g=n[A];g&&!g._count&&(delete n[A],g._graphicsLayer=
null)},_clearIIf:function(){var A=this.featureLayer;var n=A.graphics,g=A._selectedFeatures,m=A.getSelectedFeatures().length,l=A.objectIdField;if(m)for(A=n.length-1;0<=A;A--){m=n[A];var f=m.attributes[l];f in g?m._count=1:(m._count=0,this._removeFeatureIIf(f))}else A.clear(),this._featureMap={}},_cancelPendingRequest:function(A){if(A)try{A.cancel()}catch(n){}},_toggleVisibility:function(A){var n=this.featureLayer,g=n.graphics,m=A?"show":"hide",l,f=g.length;A=A&&n._ager;for(l=0;l<f;l++){var b=g[l];
b[m]();A&&n._repaint(b)}},_applyTimeFilter:function(A){var n=this.featureLayer;if(n.timeInfo&&!n.suspended){A||n._fireUpdateStart();var g=n._trackManager;g&&g.clearTracks();var m=n.getTimeDefinition(),l=n._getOffsettedTE(n._mapTimeExtent);l?(l=n._getTimeOverlap(m,l))?(m=n._filterByTime(n.graphics,l.startTime,l.endTime),g&&g.addFeatures(m.match),q.forEach(m.match,function(f){var b=f._shape;f.visible||(f.show(),(b=f._shape)&&b._moveToFront());n._ager&&b&&n._repaint(f)}),q.forEach(m.noMatch,function(f){f.visible&&
f.hide()})):this._toggleVisibility(!1):(g&&g.addFeatures(n.graphics),this._toggleVisibility(!0));g&&(g.moveLatestToFront(),g.drawTracks());A||n._fireUpdateEnd()}}});K("extend-esri")&&J.setObject("layers._RenderMode",L,E);return L})},"esri/layers/support/ParallelSnapshot":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/Deferred ../../kernel".split(" "),function(L,J,q,K,E,w){L=L(null,{declaredClass:"esri.layers.support.ParallelSnapshot",layer:null,mode:null,queryTask:null,
batchSize:5,_queryInfo:null,_fetchDfd:null,_startPage:null,_lastPage:null,_pageSize:null,_maxPages:null,_requests:null,constructor:function(x){J.mixin(this,x);this._requests={}},destroy:function(){this.cancel()},fetch:function(){var x=new E;this.cancel(!0);this._queryInfo=this.mode._createQueryInfo();this._pageSize=this.mode._getPageSize(this._queryInfo.query);this._maxPages=Math.ceil(this._getFeatureCount()/this._pageSize);this._fetchDfd=x;this._sendRequests();return x.promise},cancel:function(x){this._cancelPendingRequests(x);
this._reset()},_reset:function(){this._startPage=this._lastPage=null;this._requests={}},_getFeatureCount:function(){return this.layer.mode===this.layer.constructor.MODE_AUTO&&0===this.layer.getLastExceedsLimitResult()?this.layer._getMaxFeaturesForAutoSnapshotMode():this.mode.maxFeatures},_sendRequests:function(x){var A=this._queryInfo.query,n=this.queryTask,g=this._requests;x=null==x?1:x;var m=x+this.batchSize-1;m>this._maxPages&&(m=this._maxPages);if(!(x>m))for(this._startPage=x,this._lastPage=m;x<=
m;x++)A.start=(x-1)*this._pageSize,A.num=this._pageSize,g[x]=n.execute(A,null,null,this._queryInfo.pbf?{format:"pbf"}:null),g[x].then(J.hitch(this,this._handleSuccess,x)).otherwise(J.hitch(this,this._handleError,x))},_evalNextBatch:function(x){x===this._lastPage&&this._sendRequests(this._lastPage+1)},_handleSuccess:function(x,A){A.exceededTransferLimit||this._cancelLaterRequests(x,!0);var n=this.mode._checkMaxLimit(A.features);this._fetchDfd.progress({features:n.features,isError:!1});n.maxLimitReached?
((x=n.featuresDiscarded||this._hasRejectedRequests())||(x=!!this._getResult(this._getLastSuccessfulRequest()).exceededTransferLimit),this._resolveFetch(x)):(A.exceededTransferLimit&&this._evalNextBatch(x),this._evalResolution())},_handleError:function(x,A){var n=this._requests;n&&n[x]&&(1===x?this._rejectFetch(A):(this._evalNextBatch(x),this._fetchDfd.progress({error:A,isError:!0}),this._evalResolution()))},_evalResolution:function(){this._hasPendingRequests()||this._resolveFetch(this._hasRejectedRequests())},
_resolveFetch:function(x){var A=this._hasRejectedRequests();this.cancel(!0);this._fetchDfd.resolve({hasPartialFeatures:x,hasUpdateError:A})},_rejectFetch:function(x){this.cancel(!0);this._fetchDfd.reject(x)},_getResult:function(x){return x&&x.dfd.results[0]},_hasPendingRequests:function(){return!!this._getPendingRequests().length},_getPendingRequests:function(){var x=this._requests,A,n=[];for(A in x){var g=x[A];g.isFulfilled()||n.push({pageId:Number(A),dfd:g})}return n},_getLastSuccessfulRequest:function(){var x=
this._getResolvedRequests(),A=-Infinity,n;x=q.filter(x,function(g){return!!this._getResult(g).features.length||1===g.pageId},this);q.forEach(x,function(g){g.pageId>A&&(A=g.pageId,n=g)});return n},_getResolvedRequests:function(){var x=this._requests,A,n=[];for(A in x){var g=x[A];g.isResolved()&&n.push({pageId:Number(A),dfd:g})}return n},_hasRejectedRequests:function(){var x=this._getRejectedRequests(),A=this._getLastSuccessfulRequest(),n=this._getResult(A);n&&!n.exceededTransferLimit&&(x=q.filter(x,
function(g){return g.pageId<=A.pageId}));return!!x.length},_getRejectedRequests:function(){var x=this._requests,A,n=[];for(A in x){var g=x[A];g.isRejected()&&n.push({pageId:Number(A),dfd:g})}return n},_cancelPendingRequests:function(x){this._cancelRequests(this._getPendingRequests(),x)},_cancelLaterRequests:function(x,A){var n=q.filter(this._getPendingRequests(),function(g){return g.pageId>x});this._cancelRequests(n,A)},_cancelRequests:function(x,A){var n=this.mode,g=this._requests;q.forEach(x,function(m){A&&
delete g[m.pageId];n._cancelPendingRequest(m.dfd)})}});K("extend-esri")&&J.setObject("layers.support.ParallelSnapshot",L,w);return L})},"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../tasks/query ./RenderMode ./GridLayout".split(" "),function(L,J,q,K,E,w,x,A,n,g){L=L([n],{declaredClass:"esri.layers._OnDemandMode",constructor:function(m){this.featureLayer=m;this._featureMap={}},initialize:function(m){this.inherited(arguments);
this._cellMap={};this._gridLayer=g.createFromFeatureLayer({layer:this.featureLayer,map:m})},startup:function(){if(!this._started||this._isSuspendedAtStartup)this.inherited(arguments),this._ioQueue=[],this._isSuspendedAtStartup=this.featureLayer.suspended,this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(m){this._init&&(2>m?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+
this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this._processIOQueue(!0);this.inherited(arguments)},drawFeature:function(m){var l=m.geometry,f=[];if(l){f=this._gridLayer.getCellsInExtent("point"===l.type?{xmin:l.x,ymin:l.y,xmax:l.x,ymax:l.y}:l.getExtent(),!1).cells;l=this._cellMap;var b,c=m.attributes[this.featureLayer.objectIdField];for(b=0;b<f.length;b++){var a=f[b];var e=a.latticeID;var d=a.row;var h=a.col;e?a=l[e]=l[e]||a:(l[d]=l[d]||
{},a=l[d][h]=l[d][h]||a);a.features=a.features||[];a.features.push(m);this._addFeatureIIf(c,m);this._incRefCount(c)}}},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},hasAllFeatures:function(){var m=!1,l=this._getCurrentCells(),f;for(f=0;f<l.length;f++)if(l[f].hasPartialFeatures){m=!0;break}return!m},hasUpdateError:function(){var m=!1,l=this._getCurrentCells(),f;for(f=0;f<
l.length;f++)if(l[f].hasUpdateError){m=!0;break}return m},canFetchPBF:function(m){return this.inherited(arguments)&&this.featureLayer._canFetchPBFForQuery(m)},_enableConnectors:function(){var m=this.map;this._zoomConnect=J.connect(m,"onZoomEnd",this,this._zoomHandler);this._panConnect=J.connect(m,"onPanEnd",this,this._panHandler);this._resizeConnect=J.connect(m,"onResize",this,this._panHandler)},_disableConnectors:function(){J.disconnect(this._zoomConnect);J.disconnect(this._panConnect);J.disconnect(this._resizeConnect)},
_zoomHandler:function(){this._processIOQueue(!0);var m=this.featureLayer,l=this.map;!m.suspended&&m.isQueryable()&&(m._fireUpdateStart(),this._clearIIf(),(m=m._trackManager)&&m.clearTracks(),this._cellMap={},this._gridLayer.setResolution(l.extent),this._sendRequest())},_panHandler:function(m){if(this.featureLayer.isQueryable()){this.featureLayer._fireUpdateStart();var l=this.featureLayer._resized;m=l?m:null;l&&this._gridLayer.setMapState(m,this.map.width,this.map.height);this._sendRequest(m)}},_sendRequest:function(m){this._exceeds=
!1;var l=this.featureLayer,f=this.map;m=m||f.extent;f=this._gridLayer.getCellsInExtent(m,l.latticeTiling).cells;if(!l.isEditable()){var b=this._cellMap;f=K.filter(f,function(d){if(d.lattice){if(b[d.latticeID])return!1}else if(b[d.row]&&b[d.row][d.col])return!1;return!0})}this._pending=this._pending||0;var c;for(c=0;c<f.length;c++){var a=f[c],e=this._createQueryInfo(a);this._pending++;this._ioQueue.push(l._task.execute(e.query,q.hitch(this,this._drawFeatures,a),q.hitch(this,this._queryErrorHandler,
a),e.pbf?{format:"pbf"}:null))}this._removeOldCells(m);this._endCheck()},_drawFeatures:function(m,l){this.featureLayer._isImageService&&10.7>this.featureLayer.version&&void 0===l.exceededTransferLimit&&(l.exceededTransferLimit=l.features.length===this.featureLayer.maxRecordCount);m.hasPartialFeatures=!!l.exceededTransferLimit;m.hasUpdateError=!1;this._exceeds=this._exceeds||l.exceededTransferLimit;this._finalizeIO();var f=this.featureLayer,b=this.map.extent,c=m.extent,a=m.row,e=m.col,d=f.objectIdField;
l=l.features;var h=this._gridLayer,y=this._cellMap,I=m.latticeID;y=I?y[I]:y[a]&&y[a][e];if(m.resolution==h.resolution&&(I?I===h.getLatticeID(b):h.intersects(c,b)))if(y)f._sortFeatures(l),this._updateCell(y,l);else for(f._sortFeatures(l),m.features=l,this._addCellToCellMap(m),f=l.length,m=0;m<f;m++)b=l[m],c=b.attributes[d],this._addFeatureIIf(c,b),this._incRefCount(c);else y&&this._removeCell(a,e,I);this._endCheck()},_queryErrorHandler:function(m,l){this._finalizeIO();m.hasPartialFeatures=!0;m.hasUpdateError=
!0;this._addCellToCellMap(m);this.featureLayer._errorHandler(l);this._endCheck(l)},_finalizeIO:function(){this._pending--},_endCheck:function(m){if(0===this._pending){this._processIOQueue();var l=this.featureLayer,f=l._trackManager;f&&(f.clearTracks(),f.addFeatures(l.graphics),l._ager&&K.forEach(l.graphics,function(b){b._shape&&l._repaint(b)}),f.moveLatestToFront(),f.drawTracks());this.featureLayer._fireUpdateEnd(!!m&&Error("FeatureLayer: "+(m.message||"an error occurred while updating the layer.")),
this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)l.onQueryLimitExceeded()}},_processIOQueue:function(m){this._ioQueue=K.filter(this._ioQueue,function(l){return-1<l.fired?!1:!0});m&&K.forEach(this._ioQueue,this._cancelPendingRequest)},_createQueryInfo:function(m){var l=this.featureLayer,f=new A;f.outFields=l.getOutFields();f.where=l._getAttributeFilter();f.returnGeometry=!0;f.geometry=m.extent||m.lattice;l.latticeTiling&&m.extent&&(f.spatialRelationship=A.SPATIAL_REL_CONTAINS);f.timeExtent=
l._getOffsettedTE(l._mapTimeExtent);f.maxAllowableOffset=l._maxOffset;f.quantizationParameters=l._quantizationParameters;f.orderByFields=l.supportsAdvancedQueries?l.getOrderByFields():null;f.multipatchOption=l.multipatchOption;l._ts&&(f._ts=(new Date).getTime());(m=l.advancedQueryCapabilities)&&m.supportsQueryWithResultType&&(f.resultType="tile");m=this.canFetchPBF(f);l._enableEditModeQuantization(f,m);return{query:f,pbf:m}},_getCurrentCells:function(m){var l=[];m=m||this._cellMap;for(var f in m)if(m.hasOwnProperty(f)){var b=
m[f];b&&(b.hasOwnProperty("row")||b.hasOwnProperty("latticeID")?l.push(b):"object"===typeof b&&l.push.apply(l,this._getCurrentCells(b)))}return l},_addCellToCellMap:function(m){var l=this._cellMap;if(m.latticeID)l[m.latticeID]=m;else{var f=m.row,b=m.col;l[f]=l[f]||{};l[f][b]=m}},_removeOldCells:function(m){var l=this._cellMap,f=this._gridLayer,b,c;for(b in l)if(l[b]){var a=l[b],e=a.latticeID,d=0,h=0;if(e)d++,e!==f.getLatticeID(m)&&(this._removeCell(null,null,e),h++);else for(c in a)a[c]&&(d++,f.intersects(a[c].extent,
m)||(this._removeCell(b,c),h++));h===d&&delete l[b]}},_updateCell:function(m,l){var f=this.featureLayer,b=f.objectIdField;f=f._selectedFeatures;var c,a=l.length;m.features=m.features||[];for(c=0;c<a;c++){var e=l[c],d=e.attributes[b],h=this._addFeatureIIf(d,e);h===e?(this._incRefCount(d),m.features.push(h)):d in f||(h.setGeometry(e.geometry),h.setAttributes(e.attributes))}},_removeCell:function(m,l,f){var b=this._cellMap,c=this.featureLayer,a=c.objectIdField,e=f?b[f]:b[m]&&b[m][l];if(e&&(f?delete b[f]:
delete b[m][l],m=e.features))for(l=0;l<m.length;l++)f=m[l].attributes[a],this._decRefCount(f),f in c._selectedFeatures||this._removeFeatureIIf(f)}});E("extend-esri")&&q.setObject("layers._OnDemandMode",L,w);return L})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/normalizeUtils ../srUtils".split(" "),function(L,J,q,K,E,w,x,A,n,g,m){var l=L(null,
{declaredClass:"esri.layers._GridLayout",constructor:function(f,b,c,a){this.origin=f;this.cellWidth=b.width;this.cellHeight=b.height;this.mapWidth=c.width;this.mapHeight=c.height;this.srInfo=a},setResolution:function(f){this.resolution=(f.xmax-f.xmin)/this.mapWidth;this.srInfo&&(f=Math.round(Math.round(2*this.srInfo.valid[1]/this.resolution)/this.cellWidth),this._frameStats=[f,0,f-1])},setMapState:function(f,b,c){this.mapWidth=b;this.mapHeight=c;this.setResolution(f)},getCellCoordinates:function(f){var b=
this.resolution,c=this.origin;return{row:Math.floor((c.y-f.y)/(this.cellHeight*b)),col:Math.floor((f.x-c.x)/(this.cellWidth*b))}},normalize:function(f){var b=this._frameStats;if(b){var c=b[0],a=b[1];b=b[2];f<a?(f%=c,f=f<a?f+c:f):f>b&&(f%=c)}return f},intersects:function(f,b){var c=this.srInfo;return c?q.some(b._getParts(c),function(a){return f.intersects(a.extent)}):f.intersects(b)},getCellExtent:function(f,b){var c=this.resolution,a=this.origin,e=this.cellWidth,d=this.cellHeight;return new x(b*e*
c+a.x,a.y-(f+1)*d*c,(b+1)*e*c+a.x,a.y-f*d*c,m.createSpatialReference(a.spatialReference.toJson()))},getLatticeID:function(f){var b=this.getCellCoordinates({x:f.xmin,y:f.ymax}),c=this.getCellCoordinates({x:f.xmax,y:f.ymin});f=b.row;var a=c.row;b=this.normalize(b.col);c=this.normalize(c.col);return f+"_"+a+"_"+b+"_"+c},sorter:function(f,b){return f<b?-1:1},getCellsInExtent:function(f,b){var c=this.getCellCoordinates({x:f.xmin,y:f.ymax}),a=this.getCellCoordinates({x:f.xmax,y:f.ymin}),e=c.row,d=a.row;
c=c.col;a=a.col;var h=[],y,I,H=[],u=[],G=[];for(y=e;y<=d;y++)for(I=c;I<=a;I++){var v=this.normalize(I);f=this.getCellExtent(y,v);q.some(h,function(B){return B.row===y&&B.col===v})||h.push({row:y,col:v,extent:f,resolution:this.resolution});b&&(H.push(f.xmin,f.xmax),u.push(f.ymin,f.ymax))}c=this.normalize(c);a=this.normalize(a);H.sort(this.sorter);u.sort(this.sorter);b=H.length;for(y=b-1;0<=y;y--)y<b-1&&H[y]===H[y+1]&&H.splice(y,1);b=u.length;for(y=b-1;0<=y;y--)y<b-1&&u[y]===u[y+1]&&u.splice(y,1);if(H.length&&
u.length){f=H[0];I=H[H.length-1];var t=u[0];var F=u[u.length-1];b=H.length;for(y=0;y<b;y++)G.push([[H[y],F],[H[y],t]]);b=u.length;for(y=0;y<b;y++)G.push([[f,u[y]],[I,u[y]]]);H=new A({paths:G,spatialReference:this.origin.spatialReference.toJson()});h.push({latticeID:e+"_"+d+"_"+c+"_"+a,lattice:H,resolution:this.resolution})}return{minRow:e,maxRow:d,minCol:c,maxCol:a,topRow:e,bottomRow:d,leftCol:c,rightCol:a,cells:h}},_findCell:function(f,b,c){var a;q.some(f,function(e){e.row===b&&e.col===c&&(a=e);
return!!a});return a},getExtentOfIntersectingCells:function(f){var b=this.getCellsInExtent(f),c=b&&b.cells;if(c&&c.length){var a=b.topRow,e=b.leftCol,d=0;q.forEach(c,function(H){H.row===a&&d++});var h=this._findCell(c,a,e).extent,y=this.srInfo;if(!y||d!==this._frameStats[0]&&e!==b.rightCol){var I=h.xmin;y=I+d*h.getWidth()}else I=y.valid[0],y=y.valid[1];b=this._findCell(c,b.bottomRow,e).extent.ymin;(f=(new x(I,b,y,h.ymax,f.spatialReference))._normalize(!1,!1))&&f.rings&&(f=new n(f),f=g.getDenormalizedExtent(f));
return f}}});l.createFromFeatureLayer=function(f){var b=f.layer;f=b.getMap()||f.map;var c=b._srInfo;(b=f&&f.loaded?new l(new w(c?c.valid[0]:f.extent.xmin,c?c.valid[1]:f.extent.ymax,f.spatialReference),{width:b._tileWidth,height:b._tileHeight},{width:f.width,height:f.height},c):null)&&b.setResolution(f.extent);return b};K("extend-esri")&&J.setObject("layers._GridLayout",l,E);return l})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./RenderMode"],
function(L,J,q,K,E){L=L([E],{declaredClass:"esri.layers._SelectionMode",constructor:function(w){this.featureLayer=w;this._featureMap={}},propertyChangeHandler:function(w){this._init&&0===w&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)},hasAllFeatures:function(){return!this.featureLayer._hasPartialSelectedFeatures},hasUpdateError:function(){return this.featureLayer._hasSelectionError}});q("extend-esri")&&J.setObject("layers._SelectionMode",L,K);return L})},"esri/layers/StreamMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/has ../kernel ../SpatialReference ../tasks/query ../tasks/QueryTask ../geometry/jsonUtils ./RenderMode".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m){L=L([m],{declaredClass:"esri.layers._StreamMode",constructor:function(l,f){this.featureLayer=l;this._featureMap={};this._setRefreshRate();this._drawBuffer={adds:[],updates:[]};this._timeoutId=null;this._flushDrawBuffer=J.hitch(this,this._flushDrawBuffer);this._featuresByTime={};this._lastEndTimeCheck=null;this._maxFeatureAge=0;l.purgeOptions&&l.purgeOptions.age&&"number"===typeof l.purgeOptions.age&&(this._maxFeatureAge=1E3*Math.ceil(60*l.purgeOptions.age));this._drawFeatures=
J.hitch(this,this._drawFeatures);this._queryErrorHandler=J.hitch(this,this._queryErrorHandler)},startup:function(){this._started||this.inherited(arguments)},propertyChangeHandler:function(l){this._init&&(0===l?this._applyTimeFilter():3===l?this._redrawAllTracks():console.debug("StreamLayer: Stream Layer only supports changing map time or maximumTrackPoints. Layer id \x3d "+this.featureLayer.id))},destroy:function(){this.inherited(arguments);clearTimeout(this._timeoutId);this._featuresByTime=this._drawBuffer=
this._featureMap=null},drawFeature:function(l){var f=this.featureLayer,b=f.objectIdField;this._timeoutId||(this._timeoutId=setTimeout(this._flushDrawBuffer,this._refreshRate));f._joinField&&this._getFeature(l.attributes[b])?this._drawBuffer.updates.push({oid:l.attributes[b],updates:l}):this._drawBuffer.adds.push(l)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);var l=this.featureLayer;l&&(l._relatedUrl||l._keepLatestUrl?
(l._fireUpdateStart(),l._refreshing=!0,l.disconnect(),l.clear(),l._relatedQueried=!1,l._keepLatestQueried=!1,l.connect()):(l._fireUpdateStart(),l.clear(),l._fireUpdateEnd()))},_drawFeatures:function(l,f){var b=this.featureLayer;b._create(l.features||[]);b._fireUpdateEnd(null,f)},_applyTimeFilter:function(l){this.inherited(arguments);this._redrawAllTracks()},_removeFeatures:function(l){var f=this.featureLayer,b=f.objectIdField;l&&q.forEach(l,function(c){c=c.attributes[b];f._unSelectFeatureIIf(c,this);
this._decRefCount(c);this._removeFeatureIIf(c)},this)},_addFeatures:function(l){var f=this.featureLayer,b=f._endTimeField,c=f._startTimeField,a,e=[],d=[],h=[];var y=f._trackManager;var I=f.objectIdField;if(y)for(a in l=y.addFeatures(l),l)l.hasOwnProperty(a)&&(e.push(a),l[a].adds&&(d=d.concat(l[a].adds)),l[a].deletes&&(h=h.concat(l[a].deletes)));else d=l;q.forEach(d,function(H){var u=H.attributes[I];var G=b&&H.attributes[b];!G&&this._maxFeatureAge&&(G=c&&H.attributes[c]?H.attributes[c]+this._maxFeatureAge:
Date.now()+this._maxFeatureAge);G&&(G=1E3*Math.ceil(G/1E3),this._featuresByTime[G]?this._featuresByTime[G].push(u):this._featuresByTime[G]=[u]);this._addFeatureIIf(u,H);this._incRefCount(u)},this);h.length&&this._removeFeatures(h);y&&y.refreshTracks(e)},_updateFeatures:function(l){var f=this.featureLayer,b=[];var c=f._trackManager;var a=f._trackIdField;q.forEach(l,function(e){var d=e.updates;e=this._getFeature(e.oid);var h;if(e){d.geometry&&e.setGeometry(d.geometry);d=d.attributes||{};for(h in d)d.hasOwnProperty(h)&&
(e.attributes[h]=d[h]);e.setAttributes(e.attributes);e.visible=this._checkFeatureTimeIntersects(e);c&&e.attributes[a]?b.push(e.attributes[a]):f._repaint(e,null,!0)}},this);b.length&&c.refreshTracks(b)},_redrawAllTracks:function(){var l=this.featureLayer._trackManager,f;l&&(f=l.trimTracks())&&0<f.length&&(this._removeFeatures(f),l.refreshTracks())},_flushDrawBuffer:function(){clearTimeout(this._timeoutId);var l=this._drawBuffer,f=l.adds.splice(0,l.adds.length),b=l.updates.splice(0,l.updates.length);
l=this.featureLayer;if(!l)return!1;l.updating||l._fireUpdateStart();this._addFeatures(f);this._updateFeatures(b);(f=this._getExpiredFeatures())&&f.length&&(this._removeFeatures(f),l._trackManager&&l._trackManager.removeFeatures(f));l._purge();l._fireUpdateEnd();this._timeoutId=null},_clearDrawBuffer:function(){var l=this._timeoutId,f=this._drawBuffer,b=f.adds;f=f.updates;l&&clearTimeout(l);b.splice(0,b.length);f.splice(0,f.length);this._timeoutId=null},_clearTimeBin:function(){this._featuresByTime=
{};this._lastEndTimeCheck=1E3*Math.ceil(Date.now()/1E3)},_clearFeatureMap:function(){this._featureMap={}},_setRefreshRate:function(l){l=l||0===l?l:200;0>l&&(l=200);this._refreshRate=l},_checkFeatureTimeIntersects:function(l){var f=this.featureLayer,b=f.getMap();return(b=b?b.timeExtent:null)&&f.timeInfo&&(f.timeInfo.startTimeField||f.timeInfo.endTimeField)?0<f._filterByTime([l],b.startTime,b.endTime).match.length:!0},_fetchArchive:function(l){var f=new K,b=this.featureLayer;this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);
b._fireUpdateStart();if(l&&this.map){l=new n(l);var c=new A;var a=this.map;var e=b.getFilter()||{};var d=e.where||"1\x3d1";var h=e.geometry?g.fromJson(e.geometry):null;e=e.outFields?e.outFields.split(","):["*"];c.geometry=h;c.where=d;c.outFields=e;c.returnGeometry=!0;c.outSpatialReference=new x(a.spatialReference.toJson());this._pendingRequest=l.execute(c).then(function(y){this._pendingRequest=null;var I=this._fixFieldNameCasing(b,y);y.features=I;this._drawFeatures(y);b._fireUpdateEnd();f.resolve()}.bind(this)).otherwise(function(y){this._pendingRequest=
null;b._errorHandler(y);b._fireUpdateEnd(y);f.reject(y)}.bind(this))}else f.resolve();return f.promise},_queryErrorHandler:function(l){var f=this.featureLayer;f._errorHandler(l);f._fireUpdateEnd(l)},_fixFieldNameCasing:function(l,f){var b=f.features||[],c=f.fields;if(!c||!b.length)return b;l=this._mapFieldNameDifferences(l.fields,c);c=[];for(var a,e=0,d=f.features.length;e<d;e++)f=b[e],a=this._swizzleResponseAttributes(f.attributes,l),c.push({geometry:f.geometry,attributes:a});return c},_mapFieldNameDifferences:function(l,
f){var b=[],c={},a;var e=0;for(a=f.length;e<a;e++)b.push(f[e].name);e=0;for(a=l.length;e<a;e++){f=l[e].name;var d=this._checkForStreamFieldName(f,b);d&&(c[d]=f)}return c},_checkForStreamFieldName:function(l,f){l=l.toLowerCase();for(var b,c=0,a=f.length;c<a;c++)if(f[c].toLowerCase()===l){b=f[c];break}return b},_swizzleResponseAttributes:function(l,f){var b={},c;for(c in l)if(l.hasOwnProperty(c)){var a=l[c];f.hasOwnProperty(c)?b[f[c]]=a:b[c]=a}return b},_getExpiredFeatures:function(){var l,f,b=[],c=
[];if(!this.featureLayer._endTimeField&&!this._maxFeatureAge)return c;var a=1E3*Math.floor(this._lastEndTimeCheck/1E3);this._lastEndTimeCheck=l=1E3*Math.ceil(Date.now()/1E3);if(a&&a!==l)for(f=this._featuresByTime;a<=l;a+=1E3)f[a]&&(b=b.concat(f[a]),delete f[a]);q.forEach(b,function(e){(e=this._getFeature(e))&&c.push(e)},this);return c}});E("extend-esri")&&J.setObject("layers._StreamMode",L,w);return L})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/dom-construct dojox/gfx ../kernel ../graphic ../geometry/Polyline ./GraphicsLayer".split(" "),
function(L,J,q,K,E,w,x,A,n,g){var m=-1!==w.renderer.toLowerCase().indexOf("canvas");L=L(null,{declaredClass:"esri.layers._TrackManager",constructor:function(l){this.layer=l;this.trackMap={};this.trackLineMap={}},initialize:function(l){this.map=l;l=this.layer;this.createTracklineContainer()&&(this._handles=[l.on("visibility-change",J.hitch(this,function(f){this.container.setVisibility(f.visible);this.container.evaluateSuspension()})),l.on("scale-range-change",J.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,
this.layer.maxScale)}))])},createTracklineContainer:function(){var l=this.layer;if("esriGeometryPoint"!==l.geometryType)return null;var f=this.map,b=l._getRenderer();b=b&&b.trackRenderer;var c=this.container=new g._GraphicsLayer({id:l.id+"_tracks",_child:!0,visible:l.visible,minScale:l.minScale,maxScale:l.maxScale});c.loaded=!0;c.onLoad(c);c._setMap(f,l._div);m||(f=c._div.getNode(),l=l._div.getNode(),f&&l&&E.place(f,l,"first"));c.setRenderer(b);return c},addFeatures:function(l){var f=this.trackMap,
b=this.layer,c=b._trackIdField,a=[];q.forEach(l,function(y){var I=y.attributes[c];(f[I]=f[I]||[]).push(y);-1===q.indexOf(a,I)&&a.push(I)});var e=b._startTimeField,d=b.objectIdField,h=function(y,I){var H=y.attributes[e],u=I.attributes[e];return H===u?y.attributes[d]<I.attributes[d]?-1:1:H<u?-1:1};q.forEach(a,function(y){f[y].sort(h)})},trimTracks:function(l){function f(d){for(d=b[d]||[];d.length>c;)a.push(d.shift())}var b=this.trackMap,c=this.layer.maximumTrackPoints||0,a=[],e;if(!c)return a;if(l)q.forEach(l,
function(d){f(d)});else for(e in b)b.hasOwnProperty(e)&&f(e);return a},drawTracks:function(l){function f(y){var I=e[y],H,u;var G=b.trackLineMap[y];c.remove(G);delete b.trackLineMap[y];G=null;if(!I||2>I.length)return!1;G=[];for(H=I.length-1;0<=H;H--)(u=I[H].geometry)&&G.push([u.x,u.y]);I={};I[h]=y;1<G.length&&(G=new A(new n({paths:[G],spatialReference:d}),null,I),c.add(G),b.trackLineMap[y]=G)}var b=this,c=this.container,a;if(c){var e=this.trackMap;var d=this.map.spatialReference;var h=this.layer._trackIdField;
if(l)q.forEach(l,function(y){f(y)});else for(a in e)e.hasOwnProperty(a)&&f(a)}},refreshTracks:function(l){function f(h){var y;b.drawTracks([h]);if(e&&e.latestObservationRenderer){h=c[h]||[];var I=h.length;for(y=0;y<I;y++)a._repaint(h[y],null,!0)}}var b=this,c=this.trackMap,a=this.layer,e=a._getRenderer(),d;if(l)q.forEach(l,function(h){f(h)});else for(d in c)c.hasOwnProperty(d)&&f(d);this.moveLatestToFront()},moveLatestToFront:function(l){q.forEach(this.getLatestObservations(l),function(f){var b=f._shape;
b&&b._moveToFront();this._repaint(f,null,!0)},this.layer)},getLatestObservations:function(l){function f(d){d=a[d];return d[d.length-1]}var b=[],c=this.layer._getRenderer(),a=this.trackMap,e;if(!c.latestObservationRenderer)return b;if(l)q.forEach(l,function(d){b.push(f(d))});else for(e in a)a.hasOwnProperty(e)&&b.push(f(e));return b},clearTracks:function(l){var f=this.getLatestObservations(l),b=this.container,c=this.trackMap,a;if(l)q.forEach(l,function(d){delete this.trackMap[d];b&&(e=this.trackLineMap[d],
b.remove(e),delete this.trackLineMap[d])},this);else{if(b)for(a in c){var e=this.trackLineMap[a];b.remove(e)}this.trackMap={};this.trackLineMap={}}q.forEach(f,function(d){this._repaint(d,null,!0)},this.layer)},isLatestObservation:function(l){var f=this.trackMap[l.attributes[this.layer._trackIdField]];return f?f[f.length-1]===l:!1},destroy:function(){q.forEach(this._handles,function(f){f.remove()});var l=this.container;l&&(l.clear(),l._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=
this.container=null}});K("extend-esri")&&J.setObject("layers._TrackManager",L,x);return L})},"esri/layers/HeatmapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/_base/array require ../kernel ../sniff ../geometry/Point ../geometry/webMercatorUtils ./MapImage ../renderers/HeatmapRenderer ../tasks/query dojo/_base/fx".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,l,f){function b(){}function c(a){var e=a.layer;return{geometry:a.geometry,attributes:a.attributes,getLayer:function(){return e}}}
L=L(null,{declaredClass:"esri.layers.HeatmapManager",heatmapRenderer:null,sourceLayer:null,imageLayer:null,useTiles:!0,useWorker:!1,map:null,constructor:function(a){this.sourceLayer=a;this._hndls=[]},initialize:function(a){this.map=a;var e=this.sourceLayer,d=e.renderer;e.setDrawMode(!1);this.imageLayer=a._getMapImageLyr();var h=this;this.heatmapRenderer=d instanceof m?d:(d.getRendererInfoByZoom(a.getZoom())||d.getRendererInfoByScale(a.getScale())).renderer;this.redraw=this.redraw.bind(this);this.recalculateHeatmap=
this.recalculateHeatmap.bind(this);this._removeRenderer=this._removeRenderer.bind(this);this._handleRendererChange=this._handleRendererChange.bind(this);this._rendererChangeHandle=this.sourceLayer.on("renderer-change",this._handleRendererChange);this._handleOpacityChange=this._handleOpacityChange.bind(this);this._reprojectFeature=this._reprojectFeature.bind(this);E(["../workers/heatmapCalculator"],function(y){h._calculator=new y(J.mixin({width:h.map.width,height:h.map.height},h._getOptions()));h._setupRenderer();
h.heatmapRenderer.getStats=y.calculateStats;h.heatmapRenderer.getHistogramData=y.getHistogramData})},destroy:function(){this._removeHandlers();this._rendererChangeHandle&&this._rendererChangeHandle.remove();this._rendererChangeHandle=this.sourceLayer=this.imageLayer=this.map=this.heatmapRenderer=this._hndls=null},_handleRendererChange:function(a){var e=a.renderer,d=e instanceof m;this.heatmapRenderer?d?this.heatmapRenderer=e:this._removeRenderer(a):d&&(this.heatmapRenderer=e,this.sourceLayer&&this.map&&
this._setupRenderer())},_handleOpacityChange:function(a){a=a.opacity;var e=this._getImageBySourceId(this.sourceLayer.id);e&&e.setOpacity(a)},_setupRenderer:function(){var a=this._hndls,e=this.sourceLayer,d=this.map,h=this;e._originalDraw=e._draw;e._draw=b;e._div.clear();clearTimeout(this._resetTimer);this._resetTimer=setTimeout(this._resetGraphics.bind(this),250);a.push(e.on("update-end",this.redraw));a.push(e.on("suspend",function(y){(y=h._getImageBySourceId(h.sourceLayer.id))&&y.hide()}));a.push(e.on("resume",
function(y){(y=h._getImageBySourceId(h.sourceLayer.id))&&y.show()}));a.push(q.after(e,"redraw",this.redraw));a.push(d.on("layer-remove",function(y){y.layer==e&&((y=h._getImageBySourceId(h.sourceLayer.id))&&h.imageLayer.removeImage(y),h._removeRenderer({target:e}))}));e._collection&&a.push(e.on("graphic-add",function(y){h._reprojectFeature(y.graphic);h.redraw()}));1!==e.mode&&(a.push(d.on("resize, pan-end",this.redraw)),a.push(d.on("zoom-end",this.redraw)));a.push(e.on("opacity-change",this._handleOpacityChange));
this.imageLayer.suspended&&this.imageLayer.resume();e.graphics&&e.graphics.length&&(e.graphics[0].geometry&&!d.spatialReference.equals(e.graphics[0].geometry.spatialReference)&&K.forEach(e.graphics,function(y){this._reprojectFeature(y)}.bind(this)),this.redraw())},redraw:function(){if(!this._drawTimer){var a=this;this._drawTimer=setTimeout(function(){clearTimeout(a._drawTimer);a._drawTimer=null;a.sourceLayer._getRenderer().isInstanceOf(m)&&a.recalculateHeatmap()},16)}},_removeRenderer:function(a){var e=
a.target;e._draw=e._originalDraw;delete e._originalDraw;e.setDrawMode(!0);this._removeHandlers();this._hndls=[];var d=this._getImageBySourceId(this.sourceLayer.id);d&&this.imageLayer.removeImage(d);clearTimeout(this._drawTimer);clearTimeout(this._resetTimer);this._drawTimer=this._resetTimer=null;e.renderer!=a.renderer&&e.renderer.getRendererInfo?this.heatmapRenderer=null:(this.destroy(),e.renderer&&e.renderer.getRendererInfo&&e.redraw())},recalculateHeatmap:function(){this._calculator?this._doMainCalculation():
this._calculatorClient&&this._doWorkerCalculation()},_reprojectFeature:function(a){if(a&&a.geometry){var e=a.geometry,d=this.map.spatialReference;d.equals(e.spatialReference)||(e=n.project(e,d),null==e?console.log("Unable to reproject features to map's spatial reference. Please convert feature geometry before adding to layer"):a.geometry=e)}},_doWorkerCalculation:function(){},_doMainCalculation:function(){var a=this.sourceLayer,e=this.map,d=this.heatmapRenderer,h=this.map.extent,y=this.map.width,
I=this.map.height,H=this._calculator,u=this,G=function(t){t=u._getScreenPoints(t.features,e,a);t=H.calculateImageData(J.mixin({screenPoints:t,mapinfo:{extent:[h.xmin,h.ymin,h.xmax,h.ymax],resolution:e.getResolution()},width:y,height:I},u._getOptions()));t=d.getSymbol(c({geometry:e.extent,attributes:{size:[y,I],imageData:t},layer:a}));t=new g({extent:e.extent,href:t.url,opacity:0,sourceId:a.id});u._swapMapImages(t,u._getImageBySourceId(a.id));a.suspended&&t.hide()},v={geometry:e.extent,timeExtent:a.useMapTime?
e.timeExtent:void 0,spatialRelationship:l.SPATIAL_REL_INTERSECTS};null!=a._canDoClientSideQuery(v)?a.queryFeatures(v,G):G({features:a.graphics})},_getScreenPoints:function(a,e,d){var h=[],y=a.length,I=0,H=0,u=new A(e.extent.xmin,e.extent.ymax,e.spatialReference),G=e.toScreen(u),v=G.x;G=G.y;var t=e.getResolution(),F;for((H=e.extent.getCacheValue("_parts"))&&(F=K.map(H,function(O){return d._intersects(e,O.extent)[0]}));y--;)if(H=a[y],H.geometry&&H.visible){var B={x:Math.ceil((H.geometry.x-u.x)/t+v),
y:Math.floor((u.y-H.geometry.y)/t-G),attributes:H.attributes};F&&(H=1<F.length&&B.x<-F[0]?F[1]:F[0],B.x+=H);h[I++]=B}return h},_getImageBySourceId:function(a){var e=this.imageLayer.getImages();e=K.filter(e,function(d){return d.sourceId==a});if(e.length)return e[e.length-1]},_swapMapImages:function(a,e){function d(){h.removeImage(e)}var h=this.imageLayer,y=this.sourceLayer.opacity;h.addImage(a);f.anim(a._node,{opacity:y},null,null,function(){a.opacity=y});null!=e&&f.anim(e._node,{opacity:0},null,null,
d)},_removeHandlers:function(){if(null!=this._hndls)for(var a=this._hndls.length;a--;)this._hndls[a].remove()},_getOptions:function(){var a=this.heatmapRenderer;return{blurRadius:a.blurRadius,gradient:a.gradient,maxPixelIntensity:a.maxPixelIntensity,minPixelIntensity:a.minPixelIntensity,field:a.field,fieldOffset:a.fieldOffset}},_resetGraphics:function(){clearTimeout(this._resetTimer);this._resetTimer=null;for(var a=this.sourceLayer.graphics,e=a.length,d;e--;)d=a[e],d._shape=d._offsets=void 0}});x("extend-esri")&&
J.setObject("layers.HeatmapManager",L,w);return L})},"esri/layers/clustering/ClusterManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../kernel ../../Evented ../../graphic ../../lang ../../Color ../../graphicsUtils ../../dijit/PopupTemplate ../../dijit/Legend/utils ../../renderers/ClassBreaksRenderer ../../symbols/SimpleMarkerSymbol ../support/attributeUtils ../GraphicsLayer ../Field ./GeohashAggregation ./statUtils dojo/i18n!../../nls/jsapi".split(" "),function(L,
J,q,K,E,w,x,A,n,g,m,l,f,b,c,a,e,d,h,y){var I=y.layers.clusters,H=y.widgets.popup,u=I.numFeatures,G=Math.pow(2,53)-1;L=L(w,{declaredClass:"esri.layers.clustering.ClusterManager",layer:null,aggregationInfo:null,container:null,defaults:{clusterRadius:80,markerSymbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",style:"esriSLSSolid"}}},_initialized:!1,_map:null,_eventHandles:null,_clusterRadius:null,
_renderer:null,_statisticInfos:null,_fields:null,_infoTemplate:null,_clusterGenerator:null,_singleGraphics:null,constructor:function(v){this._eventHandles=[];this.layer=v.layer;this.setAggregationInfo(v.aggregationInfo)},initialize:function(v){this._initialized=!0;this._map=v;this._removeFromPopup(this.layer);this.container=this._createContainer();this._clusterGenerator=this._createClusterGenerator();this._initClusterGenerator();this._createLayerEventListeners();this._createMapEventListeners();this._createPopupEventListeners()},
destroy:function(v){this._clearSingleGraphics();this._removeClusterBoundary();this._destroyEventListeners();this._removeFromPopup(this.container);this._removeFromPopup(this.layer);this._resetClusterNav();this._destroyClusterGenerator(v);this._destroyContainer();this.layer=this.aggregationInfo=this._map=null},setAggregationInfo:function(v){this.aggregationInfo=v?J.mixin({},v):null;this._applyAggregationInfo()},getClusterRenderer:function(){return this._renderer},getClusterFields:function(){return this._fields||
[]},getFeaturesInCluster:function(v){v=v&&v.getAggregationInfo();return this._clusterGenerator?this._clusterGenerator.getFeaturesInCluster(v):[]},getAggregateGraphics:function(){return this.container?this.container.graphics.slice(0):[]},getSingleGraphics:function(){return this._singleGraphics?this._singleGraphics.slice(0):[]},redraw:function(){this.container&&this.container.redraw()},isClusteringEnabled:function(){return!(!this._clusterGenerator||!this._clusterGenerator.clustersEnabled)},isClusteringActive:function(){return!!(this._clusterGenerator&&
0<this._clusterGenerator.getNumFeatures())},toggleFeatureVisibility:function(v){this._clusterGenerator&&this._clusterGenerator.toggleFeatureVisibility(v)},_createContainer:function(){var v=this.layer,t=new a._GraphicsLayer({_child:!0,id:v.id+"_clusters",visible:v.visible,minScale:v.minScale,maxScale:v.maxScale,infoTemplate:this._infoTemplate});t.fields=this._fields;t.setRenderer(this._renderer);t.loaded=!0;t.onLoad(t);t._setMap(this._map,v._div);return v._childLayer=t},_destroyContainer:function(){var v=
this.container;v&&(v.clear(),v._unsetMap(this._map,this.layer._div),this.layer._childLayer=null);this.container=null},_createClusterGenerator:function(){return new d({map:this._map,layer:this.layer,clusterRadius:this._clusterRadius,statisticInfos:this._statisticInfos})},_initClusterGenerator:function(){var v=this._clusterGenerator;v.loaded?this._awaitClusterGenerator():this._eventHandles.push(v.on("load",J.hitch(this,function(){this._awaitClusterGenerator()})),v.on("load-error",J.hitch(this,function(t){console.log(t.error)})))},
_destroyClusterGenerator:function(v){this._clusterGenerator&&this._clusterGenerator.destroy(v);this._clusterGenerator=null},_awaitClusterGenerator:function(){var v=this._clusterGenerator;v.started?(this._applyRenderer(),this._initClusterUpdates()):this._eventHandles.push(v.on("start",J.hitch(this,function(){this._applyRenderer();this._initClusterUpdates()})))},_applyAggregationInfo:function(){this._applyClusterRadius();this._applyRenderer();this._clusterGenerator&&!this._clusterGenerator.isUpdateScheduled()&&
this.redraw()},_applyClusterRadius:function(){var v=this.aggregationInfo;this._clusterRadius=v&&v.clusterRadius||this.defaults.clusterRadius;this._clusterGenerator&&this._clusterGenerator.setClusterRadius(this._clusterRadius);this._computeClusterRadius()},_computeClusterRadius:function(){var v=this.aggregationInfo||{};v.clusterRadius=this._clusterRadius;this.aggregationInfo=v},_applyRenderer:function(){var v=this.container,t=this._getClusterRendererInfo(),F=this._compareStatInfos(this._statisticInfos,
t.statisticInfos);F&&(this._statisticInfos=t.statisticInfos,this._clusterGenerator&&(this._clusterGenerator.setStatisticInfos(q.map(this._statisticInfos,function(B){return{attributeInfo:B.attributeInfo,statisticType:B.statisticType}})),v&&q.forEach(v.graphics,function(B){this._applyClusterAttributes(B,B.getAggregationInfo())},this)));this._renderer=t.renderer;this._applyFields();this._applyInfoTemplate(!!F&&this._initialized);v&&(v.setRenderer(this._renderer),this.emit("renderer-change"))},_applyFields:function(){this._fields=
this._getFields(this._statisticInfos);this.container&&(this.container.fields=this._fields)},_applyInfoTemplate:function(v){var t=this.aggregationInfo,F=t&&t.disablePopup;this.layer.infoTemplate&&!F?(t=t&&t.infoTemplate||this._infoTemplate,v=v||!t?this._createInfoTemplate():this._updateInfoTemplate(t)):v=null;this._infoTemplate=v;this.container&&this.container.setInfoTemplate(this._infoTemplate);this._computeInfoTemplate()},_computeInfoTemplate:function(){var v=this.aggregationInfo||{};v.infoTemplate=
this._infoTemplate;this.aggregationInfo=v},_getClusterRendererInfo:function(){var v=this.layer&&this.layer.renderer;return v?this._createClusterRenderer(v):this._getDefaultClusterRenderer()},_getDefaultClusterRenderer:function(){var v=this._createContinuousCountRenderer();this._addSizeByCountVariable(v);return{renderer:v,statisticInfos:[]}},_createContinuousCountRenderer:function(v){var t=new f(null,"cluster_count");t.addBreak({minValue:-G,maxValue:G,symbol:v?new v.constructor(v.toJson()):new b(J.clone(this.defaults.markerSymbol))});
return t},_createClusterRenderer:function(v){if(!this._isSupportedRenderer(v))return this._getDefaultClusterRenderer();var t=[];if(this._isSimpleRenderer(v))var F=this._createContinuousCountRenderer(v.symbol);else{F=new v.constructor(v.toJson());var B=this._getRendererAttributeInfo(v);if(this._isCBRenderer(F)){var O=h.getClusterField(B,"avg");t.push(this._getStatInfo(B,"avg"));F.normalizationType=null;F.normalizationField=null;F.normalizationTotal=null}else this._isUVRenderer(F)&&(O=h.getClusterField(B,
"type"),t.push(this._getStatInfo(B,"type")));F.attributeField=O;F.setValueExpression(null);F.valueExpressionTitle=null;F.setVisualVariables(null);this._setRendererTitle(F,v)}v=this._getSupportedVariables(v);B=this._createClusterVariables(v.allVars,t);F.setVisualVariables(B);v.sizeVars.length||this._isCBSizeRenderer(F)||this._addSizeByCountVariable(F);return{renderer:F,statisticInfos:t}},_isSupportedRenderer:function(v){if(this._isSimpleRenderer(v))return!0;if(this._isCBRenderer(v)){var t=v.normalizationType;
return"function"===typeof v.attributeField||t&&"field"!==t?!1:!0}return this._isUVRenderer(v)?"function"===typeof v.attributeField||v.attributeField2?!1:!0:!1},_isSimpleRenderer:function(v){return-1<v.declaredClass.toLowerCase().indexOf("simplerenderer")},_isCBRenderer:function(v){return-1<v.declaredClass.toLowerCase().indexOf("classbreaksrenderer")},_isUVRenderer:function(v){return-1<v.declaredClass.toLowerCase().indexOf("uniquevaluerenderer")},_isCBSizeRenderer:function(v){var t=v.infos;if(!this._isCBRenderer(v)||
!t||2>t.length)return!1;var F=Infinity,B=-Infinity;q.forEach(t,function(O){if(O=O.symbol){var M=0;switch(O.type){case "simplemarkersymbol":M=O.size;break;case "picturemarkersymbol":M=(O.width+O.height)/2}F=Math.min(F,M);B=Math.max(B,M)}});return Infinity!==F&&-Infinity!==B&&F!==B},_getRendererAttributeInfo:function(v){var t=v.attributeField,F=t?this.layer.getField(t):null;return{field:t,attributeType:F&&"esriFieldTypeDate"===F.type?"date":null,rotationType:null,valueExpression:v.valueExpression,valueExpressionTitle:v.valueExpressionTitle,
normalizationField:v.normalizationField}},_setRendererTitle:function(v,t){v.legendOptions=J.clone(t.legendOptions);v.legendOptions&&v.legendOptions.title||(v.legendOptions=v.legendOptions||{},v.legendOptions.title=l.getRendererTitle(t,this.layer))},_getSupportedVariables:function(v){var t=v.getVisualVariablesForType("colorInfo",!1)||[],F=v.getVisualVariablesForType("sizeInfo",!1)||[],B=v.getVisualVariablesForType("opacityInfo",!1)||[];v=v.getVisualVariablesForType("rotationInfo",!1)||[];t=q.filter(t,
this._variableFilter);F=q.filter(F,this._variableFilter);B=q.filter(B,this._variableFilter);v=q.filter(v,this._variableFilter);return{sizeVars:F,allVars:t.concat(F).concat(B).concat(v)}},_variableFilter:function(v){return"function"!==typeof v.field&&!c.viewScaleRE.test(v.valueExpression)},_createClusterVariables:function(v,t){return q.map(v,function(F){return this._createVarForAvg(F,t)},this)},_createVarForAvg:function(v,t){var F=J.clone(v),B=this._getVariableAttributeInfo(v);F.field=h.getClusterField(B,
"avg");F.normalizationField=null;F.valueExpression=null;F.valueExpressionTitle=null;B=this._getStatInfo(B,"avg");this._addStatInfo(t,B);this._setVariableTitle(F,v);return F},_getVariableAttributeInfo:function(v){var t="rotationInfo"===v.type,F=t?"angle":null;t=t?v.rotationType:null;var B=v.legendOptions&&v.legendOptions.title,O=v.field,M=O?this.layer.getField(O):null;M&&"esriFieldTypeDate"===M.type&&(F="date");return{field:O,attributeType:F,rotationType:t,valueExpression:v.valueExpression,valueExpressionTitle:v.valueExpressionTitle||
v.valueExpression&&B,normalizationField:v.normalizationField}},_setVariableTitle:function(v,t){v.legendOptions&&v.legendOptions.title||(v.legendOptions=v.legendOptions||{},v.legendOptions.title=l.getVisualVariableTitle(t,this.layer))},_getStatInfo:function(v,t){return{statisticHash:h.getStatisticHash(v,t),attributeInfo:v,statisticType:t}},_addStatInfo:function(v,t){var F=this._findStatInfo(v,t);F?F.attributeInfo.valueExpressionTitle||(F.attributeInfo.valueExpressionTitle=t.attributeInfo.valueExpressionTitle):
v.push(t)},_findStatInfo:function(v,t){var F;q.some(v,function(B){B.statisticHash===t.statisticHash&&(F=B);return!!F});return F},_compareStatInfos:function(v,t){var F=q.filter(v,function(O){return!this._findStatInfo(t,O)},this),B=q.filter(t,function(O){return!this._findStatInfo(v,O)},this);return B.length||F.length?{added:B,removed:F}:null},_addSizeByCountVariable:function(v){var t=this._createSizeByCountVariable();t&&this._addVariable(v,t)},_getSizeByCountVariable:function(v){v=v.getVisualVariablesForType("sizeInfo",
!1)||[];return q.filter(v,function(t){return"cluster_count"===t.field})[0]},_updateSizeByCountVariable:function(){var v=this._renderer,t=this._getSizeByCountVariable(v);if(t){var F=this._createSizeByCountVariable();F&&this._replaceVariable(v,t,F)}},_createSizeByCountVariable:function(){var v=this._clusterGenerator;if(v){var t=v.getCurrentLodStats();if(t){var F=v.getNumFeatures();v=v.clusters;var B=t.min,O=t.max;1===t.count&&B===F||1===v.length&&v[0].count===F?(B=1,O=F):B&&B===O&&(O=2*B);F={type:"sizeInfo",
field:"cluster_count",valueUnit:"unknown",minSize:12,maxSize:50,minDataValue:B,maxDataValue:O,legendOptions:{title:u}}}}return F},_addVariable:function(v,t){var F=v.visualVariables||[];F.push(t);v.setVisualVariables(F)},_replaceVariable:function(v,t,F){var B=v.visualVariables;t=q.indexOf(B,t);-1<t&&B.splice(t,1);B.push(F);v.setVisualVariables(B)},_getFields:function(v){var t=[new e({name:"cluster_count",type:"esriFieldTypeInteger"})];q.forEach(v,function(F){var B=F.statisticType;F=F.attributeInfo;
var O;"avg"===B?O="date"===F.attributeType?"esriFieldTypeDate":"esriFieldTypeDouble":"type"===B&&(O=F.field?this.layer.getField(F.field).type:"esriFieldTypeString");t.push(new e({name:h.getClusterField(F,B),type:O}))},this);return t},_createInfoTemplate:function(){var v=this._statisticInfos,t=this._renderer,F=[{fieldName:"cluster_count",label:u,visible:!0,format:{digitSeparator:!0,places:0}}],B=[],O=[A.substitute({count:"{cluster_count}"},I.countSummary)],M=this._isUVRenderer(t)?t.infos:[];q.forEach(v,
function(C){var W=C.statisticType,Y=C.attributeInfo,R=h.getClusterField(Y,W),S=this._getFieldLabel(C);if("avg"===W){var T={fieldName:R,label:S,visible:!0,format:"date"===Y.attributeType?{dateFormat:"shortDateShortTime"}:{digitSeparator:!0,places:1}};var Z=this._getFieldSummary(C,R)}else"type"===W&&(Z="expression/"+R,T={fieldName:Z,visible:!0},B.push({name:R,title:S,returnType:"string",expression:this._getExpression(M,R)}),Z=this._getFieldSummary(C,Z));T&&F.push(T);Z&&O.push(Z)},this);return this._createPopupTemplate({fieldInfos:F,
expressionInfos:B,description:O.join("\x3cbr/\x3e\x3cbr/\x3e")})},_updateInfoTemplate:function(v){var t=v.toJson(),F=this._isUVRenderer(this._renderer)?this._renderer.infos:[];q.forEach(this._statisticInfos,function(B){var O=B.statisticType;B=h.getClusterField(B.attributeInfo,O);"type"===O&&(O=this._findExpressionInfo(B,t))&&(O.expression=this._getExpression(F,B))},this);return this._createPopupTemplate(t)},_createPopupTemplate:function(v){var t=new m(v),F=t.title;t.setTitle(J.hitch(this,function(B){var O=
this._map&&this._map.infoWindow;if("esri.dijit.PopupMobile"!==(O&&O.declaredClass)||t.info.title)return F.call(t,B);B=(B=B.attributes)&&B.cluster_count;return null==B?"":A.substitute({count:B},I.countTitle)}));return t},_findExpressionInfo:function(v,t){var F;q.some(t.expressionInfos,function(B){B.name===v&&(F=B);return!!F});return F},_escapeDoubleQuotes:function(v){return v?v.replace(/"/g,'\\"'):""},_getExpression:function(v,t){return["var uvInfos \x3d ["+this._getObjects(v).join(", ")+"];",'var predominantType \x3d Text($feature["'+
t+'"]);','var label \x3d "'+this._escapeDoubleQuotes(I.predominantNoneValue)+'";',"for (var i \x3d 0; i \x3c Count(uvInfos); i++) {\nif (uvInfos[i].value \x3d\x3d predominantType) {\nlabel \x3d uvInfos[i].label;\nbreak;\n}\n}\nreturn label;"].join("\n")},_getObjects:function(v){return q.map(v,function(t){return'{"value": "'+String(t.value)+'","label": "'+this._escapeDoubleQuotes(String(t.label))+'"}'},this)},_getFieldLabel:function(v){var t=v.statisticType,F=v.attributeInfo,B=F.field;v=F.normalizationField;
var O="";if("avg"===t)var M=v?I.avgNormFieldLabel:I.avgFieldLabel;else"type"===t&&(M=I.predominantFieldLabel);M&&(t=F.valueExpression?F.valueExpressionTitle:this.layer.getFieldLabel(B),v=v&&this.layer.getFieldLabel(v),O=A.substitute({fieldLabel:t||"",normFieldLabel:v||""},M));return O},_getFieldSummary:function(v,t){var F=v.statisticType,B=v.attributeInfo,O=B.field;v=B.normalizationField;var M="";if("avg"===F)var C=v?I.avgNormFieldSummary:I.avgFieldSummary;else"type"===F&&(C=I.predominantFieldSummary);
C&&(F=B.valueExpression?B.valueExpressionTitle:this.layer.getFieldLabel(O),v=v&&this.layer.getFieldLabel(v),M=A.substitute({fieldLabel:F||"",normFieldLabel:v||"",fieldValue:"{"+t+"}"},C));return M},_removeFromPopup:function(v){var t=this._map.infoWindow,F=t.features;if(F&&F.length){var B=q.filter(F,function(O){return O.getLayer()!==v});B.length<F.length&&(B.length?t.setFeatures(B):(t.clearFeatures(),t.hide()))}},_resetClusterNav:function(){this._resetClusterNavPartial();this._popupClusterGraphic=
null},_resetClusterNavPartial:function(){this._map.infoWindow.removeActions&&this._map.infoWindow.removeActions(this._popupActions);this._hideSingleGraphic(this._popupSingleGraphic);this._popupSingleGraphic=null},_addClusterBoundary:function(v,t){(t=t.clusterFillSymbol)&&(t=new t.constructor(t.toJson()));v=new x(v,t);this._map.graphics.add(v);this._clusterBoundary=v},_removeClusterBoundary:function(){this._map.graphics.remove(this._clusterBoundary);this._clusterBoundary=null},_createBrowseFeaturesAction:function(){return this._map.infoWindow.addActions([{title:H.NLS_browseFeatures,
className:"browseFeatures",callback:J.hitch(this,function(v){v.preventDefault();v=this._map.infoWindow;var t=v.getSelectedFeature(),F=t.getChildGraphics(),B=v.getCurrentAnchor();v.setFeatures(F,{anchor:B});if(F=g.graphicsExtent(F))this._addClusterBoundary(F,v),v.show(this._getPopupLocation(F,B));this._popupClusterGraphic=t})}])[0]},_getPopupLocation:function(v,t){var F=v.getCenter();t=t.toLowerCase();-1<t.indexOf("top")?F.update(F.x,v.ymax):-1<t.indexOf("bottom")?F.update(F.x,v.ymin):-1<t.indexOf("left")?
F.update(v.xmin,F.y):F.update(v.xmax,F.y);return F},_createViewSummaryAction:function(){return this._map.infoWindow.addActions([{title:H.NLS_viewSummary,className:"viewSummary",callback:J.hitch(this,function(v){v.preventDefault();v=this._popupClusterGraphic;var t=this._map.infoWindow;t.setFeatures([v]);t.show(v.geometry);this._popupClusterGraphic=null})}])[0]},_initClusterUpdates:function(){this._updateSizeVariable();this._updateClusterGraphics();this._eventHandles.push(this._clusterGenerator.on("update-end",
J.hitch(this,function(v){(v.mapLevelChange||v.indexChange)&&this._updateSizeVariable();this._updateClusterGraphics()})),this._clusterGenerator.on("index-complete",J.hitch(this,function(){this._updateSizeVariable()})))},_updateClusterGraphics:function(){this._hideSingleGraphics();var v=[],t=[];q.forEach(this._clusterGenerator.clusters,function(F){var B=new x(F.centroid);B.setAggregationSourceLayer(this.layer);B.setAggregationInfo(F);this._applyClusterAttributes(B,F);1===F.count?(F=this._getSingleGraphic(B),
t.push(F)):v.push(B)},this);this._showSingleGraphics(t);this._addGraphics(v)},_addGraphics:function(v){var t=this.container;t.clear();q.forEach(v,function(F){t.add(F)})},_getSingleGraphic:function(v){var t=this._clusterGenerator.getCell(v.getAggregationInfo().primary).features[0],F=this.layer.renderer;F=F&&F.getSymbol(t);var B=this._getSizeByCountVariable(this._renderer);F&&B&&(v=B?this._renderer.getSize(v,{sizeInfo:B,shape:F.style,resolution:this._map.getResolutionInMeters(),scale:this._map.getScale()}):
null,t.setSize(v));return t},_showSingleGraphics:function(v){q.forEach(v,this._showSingleGraphic);this._singleGraphics=v},_hideSingleGraphics:function(){q.forEach(this._singleGraphics,function(v){v.setSize(null);this._hideSingleGraphic(v)},this);this._singleGraphics=null},_clearSingleGraphics:function(){q.forEach(this._singleGraphics,function(v){v.setSize(null)});this._singleGraphics=null},_showSingleGraphic:function(v){v&&v._resume()},_hideSingleGraphic:function(v){v&&v._suspend()},_updateSizeVariable:function(){this.isClusteringEnabled()&&
(this._updateSizeByCountVariable(),this.emit("renderer-change"))},_applyClusterAttributes:function(v,t){v.setAttributes(t.attributes)},_createLayerEventListeners:function(){var v=this.layer;this._eventHandles.push(v.on("visibility-change",J.hitch(this,function(t){this.container.setVisibility(t.visible)})),v.on("scale-range-change",J.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)})),v.on("renderer-change",J.hitch(this,function(){this._applyRenderer()})),
v.on("info-template-change",J.hitch(this,function(){this._applyInfoTemplate()})))},_createMapEventListeners:function(){this._eventHandles.push(this._map.on("zoom-start",J.hitch(this,function(){this._removeClusterBoundary();this._removeFromPopup(this.container);this._removeFromPopup(this.layer);this._resetClusterNav();this.container.clear();this._hideSingleGraphics()})))},_createPopupEventListeners:function(){var v=this._map.infoWindow;this._eventHandles.push(v.on("selection-change",J.hitch(this,function(){this._resetClusterNavPartial();
var t=this._map.infoWindow.getSelectedFeature(),F=t&&t.getLayer();if(F){var B;F===this.container?(this._removeClusterBoundary(),this._map.infoWindow.addActions&&(B=this._createBrowseFeaturesAction())):F===this.layer&&t._isSuspended()?(this._map.infoWindow.addActions&&(B=this._createViewSummaryAction()),this._popupSingleGraphic=t,this._showSingleGraphic(this._popupSingleGraphic)):this._removeClusterBoundary();this._popupActions=B?[B]:null}})),v.on("clear-features",J.hitch(this,function(t){this._resetClusterNav();
t.isIntermediate||this._removeClusterBoundary()})),v.on("hide",J.hitch(this,function(){this._popupSingleGraphic&&this._popupSingleGraphic._suspend();this._clusterBoundary&&this._clusterBoundary.hide()})),v.on("show",J.hitch(this,function(){this._popupSingleGraphic&&this._popupSingleGraphic._resume();this._clusterBoundary&&this._clusterBoundary.show()})))},_destroyEventListeners:function(){q.forEach(this._eventHandles,function(v){v.remove()})}});K("extend-esri")&&J.setObject("layers.clustering.ClusterManager",
L,E);return L})},"esri/dijit/Legend/utils":function(){define(["dojo/_base/lang","../../lang","dojo/i18n!../../nls/jsapi"],function(L,J,q){var K=q.widgets.legend;return{getVisualVariableTitle:function(E,w){var x=E.field,A=E.normalizationField,n=!1,g=!1,m=!1;x=L.isFunction(x)?null:x;A=L.isFunction(A)?null:A;if(E.legendOptions&&E.legendOptions.title)var l=E.legendOptions.title;else if(E.valueExpressionTitle)l=E.valueExpressionTitle;else{if(w.renderer&&w.renderer.authoringInfo&&w.renderer.authoringInfo.visualVariables){var f=
w.renderer.authoringInfo.visualVariables;for(E=0;E<f.length;E++){var b=f[E];if("colorInfo"===b.type&&"ratio"===b.style){n=!0;break}else if("colorInfo"===b.type&&"percent"===b.style){g=!0;break}else if("colorInfo"===b.type&&"percentTotal"===b.style){m=!0;break}}}(n=m&&"showRatioPercentTotal"||g&&"showRatioPercent"||n&&"showRatio"||A&&"showNormField"||x&&"showField"||null)&&(l=J.substitute({field:x&&w.getFieldLabel(x),normField:A&&w.getFieldLabel(A)},"showField"===n?"${field}":K[n]))}return l},getRendererTitle:function(E,
w){if(E){if("esri.renderer.ClassBreaksRenderer"===E.declaredClass){var x=E.attributeField;var A=E.normalizationField;var n="percent-of-total"===E.normalizationType}x=L.isFunction(x)?null:x;A=L.isFunction(A)?null:A;if(E.legendOptions&&E.legendOptions.title)var g=E.legendOptions.title;else E.valueExpressionTitle?g=E.valueExpressionTitle:(E=A&&"showNormField"||(n?"showNormPct":null)||x&&"showField"||null)&&(g=J.substitute({field:x&&w.getFieldLabel(x),normField:A&&w.getFieldLabel(A)},"showField"===E?
"${field}":K[E]))}return g}}})},"esri/layers/clustering/GeohashAggregation":function(){define("dojo/has dojo/_base/declare dojo/_base/lang dojo/_base/array ../../kernel ../../Evented ../../geometry/Point ../../geometry/Extent ../../geometry/mathUtils ../../support/expressionUtils ../../core/timerUtils ../support/attributeUtils ./geohashUtils ./statUtils".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,l,f,b){J=J(w,{loaded:!1,started:!1,map:null,layer:null,lod:null,tolerance:null,clusterMode:null,clusterRadius:null,
sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0,clusters:null,clustersEnabled:!0,statisticInfos:null,defaults:{lod:1,tolerance:0,clusterMode:"auto",clusterRadius:80,sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0},_eventHandles:null,_updateHandle:null,_indexHandle:null,_cellIndex:null,_globalIndex:null,_perfProfile:null,_indexUpdated:!1,_cellSizeScaleFactor:1.5,_extentScaleFactor:1.25,_maxGeohashLength:12,_minClusterRadius:15,_levelChange:!0,_clusterFieldPrefix:"cluster_",
_mapLevelChange:!1,constructor:function(c){this._update=q.hitch(this,this._update);this._indexFeatures=q.hitch(this,this._indexFeatures);this._eventHandles=[];this._globalIndex={numFeatures:null,fullExtent:null,lodStats:null};this._perfProfile={lastIndex:{total:null,numFeatures:0},lastUpdate:{cells:null,clusters:null,total:null}};this.clusters=[];this.map=c.map;this.layer=c.layer;this.setLod(c.lod);this.setTolerance(c.tolerance);this.setClusterMode(c.clusterMode);this.setClusterRadius(c.clusterRadius);
this.setSortEnabled(c.sortEnabled);this.setFilterEnabled(c.filterEnabled);this.setBufferEnabled(c.bufferEnabled);this.setUpdateEnabled(c.updateEnabled);this.setStatisticInfos(c.statisticInfos);this._load();this.loaded?this._startup():this._eventHandles.push(this.on("load",q.hitch(this,this._startup)))},destroy:function(c){this._displayFeatures(!0,c);K.forEach(this._eventHandles,function(a){a.remove()});m.clearTimeout(this._updateHandle);m.clearTimeout(this._indexHandle);this._cellIndex=this._globalIndex=
this._eventHandles=this._updateHandle=this._indexHandle=this.map=this.layer=this.clusters=null},setLod:function(c){var a=this.lod;this.lod=c||this.defaults.lod;a!==this.lod&&this.update()},setTolerance:function(c){var a=this.tolerance;this.tolerance=c||this.defaults.tolerance;a!==this.tolerance&&this.update()},setClusterMode:function(c){var a=this.clusterMode;this.clusterMode=c||this.defaults.clusterMode;this._evalClusterParams();a!==this.clusterMode&&this.update()},setClusterRadius:function(c){var a=
this.clusterRadius;this.clusterRadius=null!=c?c:this.defaults.clusterRadius;this._evalClusterParams();a!==this.clusterRadius&&this.update()},setSortEnabled:function(c){var a=this.sortEnabled;this.sortEnabled=null!=c?!!c:this.defaults.sortEnabled;a!==this.sortEnabled&&this.update()},setFilterEnabled:function(c){var a=this.filterEnabled;this.filterEnabled=null!=c?!!c:this.defaults.filterEnabled;a!==this.filterEnabled&&this.update()},setBufferEnabled:function(c){var a=this.bufferEnabled;this.bufferEnabled=
null!=c?!!c:this.defaults.bufferEnabled;a!==this.bufferEnabled&&this.update()},setUpdateEnabled:function(c){var a=this.updateEnabled;(this.updateEnabled=null!=c?!!c:this.defaults.updateEnabled)&&a!==this.updateEnabled&&(this._mapLevelChange=!0,this.update())},setStatisticInfos:function(c){this.statisticInfos=c||[];this.loaded&&this._applyStatInfos(this.statisticInfos)},update:function(){this.loaded&&null==this._updateHandle&&(this._updateHandle=m.setTimeout(this._update,m.priority.HIGH))},isUpdateScheduled:function(){return null!=
this._updateHandle},index:function(){this.loaded&&null==this._indexHandle&&(this._indexHandle=m.setTimeout(this._indexFeatures,m.priority.HIGH))},getCell:function(c){return this._cellIndex[c.length][c]},getCluster:function(c){var a;K.some(this.clusters,function(e){-1<K.indexOf(e.geohashes,c)&&(a=e);return!!a});return a},getCellsInCluster:function(c){var a=[];K.forEach(c&&c.geohashes,function(e){(e=this.getCell(e))&&a.push(e)},this);return a},getFeaturesInCluster:function(c){var a=[];c=this.getCellsInCluster(c);
K.forEach(c,function(e){Array.prototype.push.apply(a,e.features)});return a},toggleFeatureVisibility:function(c){this.index()},getCurrentLodStats:function(){var c=this._globalIndex.lodStats;return c&&c[this.lod]},getNumFeatures:function(){return this._globalIndex.numFeatures},getFullExtent:function(){var c=this._globalIndex.fullExtent;return c&&Infinity!==c.xmin?new A(c):null},_load:function(){this._displayFeatures(!1);this._checkLoadStatus();this.map.loaded||this._eventHandles.push(this.map.on("load",
q.hitch(this,this._checkLoadStatus)));this.layer.loaded||this._eventHandles.push(this.layer.on("load",q.hitch(this,this._checkLoadStatus)))},_checkLoadStatus:function(){if(this.map.loaded&&this.layer.loaded){if("esriGeometryPoint"!==this.layer.geometryType)var c=Error("GeohashAggregation is supported only for points");else{var a=this.map.spatialReference;a.isWebMercator()||4326===a.wkid||(c=Error("GeohashAggregation is supported only when map spatial reference is WGS84 or WebMercator"))}c?(this.loadError=
c,this.emit("load-error",{error:c})):(this.loaded=!0,this.emit("load"))}},_startup:function(){this._evalUpdateStatus();this.index();this._processExtentChange();this._eventHandles.push(this.layer.on("update-end",q.hitch(this,this.index)),this.layer.on("edits-complete",q.hitch(this,this.index)),this.layer.on("graphics-clear",q.hitch(this,this.index)),this.layer.on("suspend",q.hitch(this,this._evalUpdateStatus)),this.layer.on("resume",q.hitch(this,this._evalUpdateStatus)),this.map.on("extent-change",
q.hitch(this,this._processExtentChange)))},_evalUpdateStatus:function(){this.setUpdateEnabled(!this.layer.suspended)},_processExtentChange:function(c){this._mapLevelChange=!(!c||!c.levelChange);this._evalClusterParams();this.update()},_update:function(){this._updateHandle=null;if(this.updateEnabled){this.emit("update-start");if(this.clustersEnabled){var c=this.map.geographicExtent;if(c){var a=this._getIntersectingCells(c);c=this._getClusters(a.cells,c);this.clusters=c.clusters;this._applyStatInfosToClusters();
a=a.profile;c=c.profile;var e=a.total+c.total;a.total=this._getElapsedTime(a.total);c.total=this._getElapsedTime(c.total);var d=this._perfProfile.lastUpdate={};d.cells=a;d.clusters=c;d.total=this._getElapsedTime(e)}}else this.clusters=[],this._perfProfile.lastUpdate=null;a=this._indexUpdated;this._indexUpdated=!1;c=this._mapLevelChange;this._mapLevelChange=!1;this.emit("update-end",{levelChange:this._levelChange,mapLevelChange:c,indexChange:a})}},_displayFeatures:function(c,a){var e=this.layer;c=
!c;e.suspendGraphics(c);!1!==a&&(c?e.clearNodes():e.redraw())},_indexFeatures:function(){this._indexHandle=null;var c=this._getTime();this._initializeIndexing();var a=0,e=this._globalIndex.fullExtent;K.forEach(this.layer.graphics,function(y){if(y.visible){var I=y.geometry,H=this._getLngLat(I);if(H){var u=I.getCacheValue("_geohash");void 0===u&&(u=f.pointToGeohash(H),I.setCacheValue("_geohash",u||null))}u&&(this._addGeohashToIndex(u,y,H),a++,this._updateExtent(e,H))}},this);this._applyStatInfosToIndex();
this._globalIndex.numFeatures=a;for(var d=this._globalIndex.lodStats,h=1;h<=this._maxGeohashLength;h++)d[h]=this._getLODStats(h,a);this._perfProfile.lastIndex.total=this._getElapsedTime(c,this._getTime());this._perfProfile.lastIndex.numFeatures=a;this._indexUpdated=!0;this.emit("index-complete");this.started||(this.started=!0,this.emit("start"));this.update()},_initializeIndexing:function(){this._globalIndex={numFeatures:0,fullExtent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},lodStats:{}};
for(var c=this._cellIndex=[],a=1;a<=this._maxGeohashLength;a++)c[a]={}},_getLngLat:function(c){if(c){var a=c.getLongitude();c=c.getLatitude();c=null!=a&&null!=c?{x:a,y:c}:null}return c},_addGeohashToIndex:function(c,a,e){for(var d=this._cellIndex,h="",y=0;y<this._maxGeohashLength;y++){h+=c[y];var I=d[h.length],H=I[h];H||(H=I[h]={count:0,centroid:{x:null,y:null},extent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},features:[],geohash:h,statistics:null});this._updateItem(H,1,e,!0);H.features.push(a)}},
_getLODStats:function(c,a){var e=this._cellIndex[c],d=0,h=Infinity,y=-Infinity,I=null,H;for(H in e){var u=e[H];d++;u.count<h&&(h=u.count);u.count>y&&(y=u.count)}0<d&&(I=Number((a/d).toFixed(2)));return{lod:c,count:d,min:Infinity===h?null:h,max:-Infinity===y?null:y,avg:I}},_evalClusterParams:function(){if(this.loaded&&"auto"===this.clusterMode){var c=this._getClusterParams(this.map.getResolutionInMeters(),this.clusterRadius,this._minClusterRadius);this._levelChange=this.lod!==c.lod;this.lod=c.lod;
this.tolerance=c.tolerance}},_getClusterParams:function(c,a,e){a<e&&(a=e);c=Math.ceil(c*a);a=this._getClosestLODRange(c).max;do e=this._getCellSize(a),(e=c>=this._cellSizeScaleFactor*e||1===e)||(a+=1);while(!e);e=c/this._getCellSize(a);return{lod:a,tolerance:c,multiplier:Number(e.toFixed(2))}},_getClosestLODRange:function(c){for(var a,e=this._maxGeohashLength;1<=e;e--)if(this._getCellSize(e)>=c){a=e;break}null==a&&(a=1);c=a+1;c>this._maxGeohashLength&&(c=this._maxGeohashLength);return{min:a,max:c}},
_getCellSize:function(c){c=f.getCellSizeInMeters(c);return Math.ceil(Math.min(c.width,c.height))},_sorter:function(c,a){var e=c.centroid,d=a.centroid;return c.count>a.count?-1:c.count<a.count?1:e.x>d.x?-1:e.x<d.x?1:0},_getIntersectingCells:function(c){var a=this._getTime();this.bufferEnabled&&(c=c.expand(this._extentScaleFactor));var e=f.getIntersecting(c,this.lod,this.bufferEnabled?this.tolerance:0);c=this._getTime();var d=[],h=this.tolerance,y=this.sortEnabled;K.forEach(e,function(I){(I=this.getCell(I))&&
d.push(I)},this);h&&y&&d.sort(this._sorter);e=this._getTime();return{cells:d,profile:{findCells:this._getElapsedTime(a,c),scanAndSortCells:this._getElapsedTime(c,e),total:e-a}}},_getClusters:function(c,a){var e=this._getTime(),d=[],h={},y={findCells:0};K.forEach(c,function(I,H){(I=this._createCluster(I,h,y))&&d.push(I)},this);this._markIntersecting(d,a);this.filterEnabled&&(d=this._getIntersectingClusters(d));c=this._getTime();return{clusters:d,profile:{findCellsInCluster:this._getElapsedTime(y.findCells),
total:c-e}}},_markIntersecting:function(c,a){var e=a.normalize();K.forEach(c,function(d){var h=d.centroid.x,y=d.centroid.y;d.isIntersecting=K.some(e,function(I){return h>=I.xmin&&h<=I.xmax&&y>=I.ymin&&y<=I.ymax})})},_getIntersectingClusters:function(c){return K.filter(c,function(a){return a.isIntersecting})},_createCluster:function(c,a,e){if(!a[c.geohash]){var d=[{cell:c,distance:0}];if(this.tolerance){var h=this._getTime(),y=f.getNeighborsWithinDistance(c.centroid,this.lod,this.tolerance);e.findCells+=
this._getTime()-h;K.forEach(y,function(I){if(I!==c.geohash&&(I=this.getCell(I))){var H=this._calculateDistance(c.centroid,I.centroid);H<=this.tolerance&&d.push({cell:I,distance:H})}},this)}return this._mergeCells(d,a)}},_calculateDistance:function(c,a){return n.getLength(f.geographicToWebMercator(c),f.geographicToWebMercator(a))},_mergeCells:function(c,a){var e=this._initializeCluster({},c[0].cell.geohash);K.forEach(c,function(d){var h=d.cell,y=h.geohash;d=d.distance;var I=a[y];if(I)if(d<I.distance)this._removeCellFromCluster(y,
a);else return;a[y]={cluster:e,distance:d};this._updateItem(e,h.count,h.centroid);e.geohashes.push(y)},this);return e},_removeCellFromCluster:function(c,a){var e=a[c].cluster;delete a[c];c=K.indexOf(e.geohashes,c);-1<c&&e.geohashes.splice(c,1);this._reevaluateCluster(e)},_reevaluateCluster:function(c){var a=c.geohashes;c=this._initializeCluster(c,c.primary);K.forEach(a,function(e){var d=this.getCell(e);d&&(this._updateItem(c,d.count,d.centroid),c.geohashes.push(e))},this)},_initializeCluster:function(c,
a){c.count=0;c.centroid=new x(null,null);c.geohashes=[];c.primary=a;c.statistics=null;return c},_applyStatInfos:function(c){c=this._getValidStatInfos(c);this._applyStatInfosToIndex(c);this._applyStatInfosToClusters(c)},_getValidStatInfos:function(c){var a=[];K.forEach(c,function(e){var d=e.attributeInfo;e=e.statisticType;var h="angle"===d.attributeType;if(b.isSupportedStatisticType(e)&&(!h||"avg"===e)){var y="arithmetic"===d.rotationType;a.push({attributeCache:l.createAttributeCache(d,"type"===e),
identifier:b.getStatisticId(d,e),statFunctions:b.getStatisticFunctions(e),isAngular:h,isDate:"date"===d.attributeType,isArithmetic:y})}});return a},_applyStatInfosToIndex:function(c){c=c||this._getValidStatInfos(this.statisticInfos);var a=this._cellIndex;if(a)for(var e=1;e<=this._maxGeohashLength;e++){var d=a[e],h;for(h in d)this._applyStatInfosToCell(d[h],c)}},_applyStatInfosToCell:function(c,a){var e=this._initializeStats(c,a);K.forEach(c.features,function(d){this._calcFeatureStats(d,a,e)},this);
this._summarizeStats(c,e,a)},_calcFeatureStats:function(c,a,e){c.attributes&&K.forEach(a,function(d){var h=e[d.identifier],y=d.attributeCache;y=y?c._getDataValue(y.attributeInfo,y,g):null;d.statFunctions.updateCellStat(h,y,d)})},_applyStatInfosToClusters:function(c){c=c||this._getValidStatInfos(this.statisticInfos);var a=this._clusterFieldPrefix;K.forEach(this.clusters,function(e){var d=this._initializeStats(e,c);K.forEach(this.getCellsInCluster(e),function(h){this._calcCellStats(h,c,d)},this);this._summarizeStats(e,
d,c,a);e.attributes[a+"id"]=e.primary},this)},_calcCellStats:function(c,a,e){var d=c.statistics;K.forEach(a,function(h){var y=h.identifier;h.statFunctions.updateClusterStat(e[y],d[y],h)})},_initializeStats:function(c,a){var e=c.statistics={};K.forEach(a,function(d){e[d.identifier]=d.statFunctions.initialize(d)});return e},_summarizeStats:function(c,a,e,d){var h=c.attributes={};d=d||"";h[d+"count"]=c.count;K.forEach(e,function(y){var I=this._getStatFieldName(y,d);h[I]=y.statFunctions.summarize(a[y.identifier],
y)},this)},_getStatFieldName:function(c,a){return(a||"")+c.identifier},_updateItem:function(c,a,e,d){var h=e.y,y=c.centroid,I=c.count;y.x=(I*y.x+a*e.x)/(I+a);y.y=(I*y.y+a*h)/(I+a);c.count+=a;d&&this._updateExtent(c.extent,e)},_updateExtent:function(c,a){var e=a.x;a=a.y;e<c.xmin&&(c.xmin=e);e>c.xmax&&(c.xmax=e);a<c.ymin&&(c.ymin=a);a>c.ymax&&(c.ymax=a)},_getTime:function(){return window.performance?window.performance.now():(new Date).getTime()},_getElapsedTime:function(c,a){c=null!=c&&null!=a?a-c:
c;if(null!=c){var e="millisecond";1E3<=c&&(c/=1E3,e="second",60<=c&&(c/=60,e="minute"));e={value:Number(c.toFixed(2)),unit:e}}return e}});L("extend-esri")&&q.setObject("layers.clustering.GeohashAggregation",J,E);return J})},"esri/core/timerUtils":function(){define([],function(){function L(w){var x,A=w.length;for(x=0;x<A;x++)w[x]()}var J={LOW:1,HIGH:2},q,K={};K[J.LOW]=[];K[J.HIGH]=[];var E=function(){clearTimeout(q);q=null;var w=K[J.HIGH];K[J.HIGH]=[];L(w);w=K[J.LOW];K[J.LOW]=[];L(w)};return{priority:J,
callbackQueue:K,setTimeout:function(w,x){w=[x,K[x].push(w)-1];q||(q=setTimeout(E,0));return w},clearTimeout:function(w){w&&K[w[0]].splice(w[1],1)}}})},"esri/layers/clustering/geohashUtils":function(){define("dojo/has dojo/string dojo/_base/lang dojo/_base/array ../../kernel ../../geometry/Point ../../geometry/Extent ../../SpatialReference ../../geometry/webMercatorUtils".split(" "),function(L,J,q,K,E,w,x,A,n){function g(M){var C=M.spatialReference;if(!C)return{x:M.x,y:M.y};var W=C.isWebMercator(),
Y;4326===C.wkid?Y={x:M.x,y:M.y}:W&&(Y={x:M.getLongitude(),y:M.getLatitude()});return Y}function m(M){var C=M.spatialReference,W=!(!C||!C.isWebMercator()),Y;C&&4326===C.wkid?Y=new x(M.toJson()):W&&(Y=n.webMercatorToGeographic(M,!0));return Y}function l(M,C){C.x=w.prototype._normalizeX(M.x,A.prototype._info[4326]);C.y=M.y;return C}function f(M){M=B.decimals[M].toString(2);return J.pad(M,B.bitsPerBase32Char,"0")}function b(M,C){C=C.slice();C.splice(1,0,0);for(var W=C[0],Y=C[2],R=0;R<M.length;R++){Number(M[R])?
C[0]=C[1]:C[2]=C[1];var S=C[1]=(C[0]+C[2])/2;W=C[0];Y=C[2]}return{value:S,min:W,max:Y}}function c(M,C,W){var Y=[];C=C.slice();C.splice(1,0,0);for(var R=C[0],S=C[2],T=0;T<W;T++)M>=C[1]?(C[0]=C[1],R=1):(C[2]=C[1],R=0),C[1]=(C[0]+C[2])/2,Y.push(R),R=C[0],S=C[2];return{value:Y.join(""),min:R,max:S}}function a(M){var C=M*B.bitsPerBase32Char;0===C%2?M=C/=2:(M=(C+1)/2,C-=M);return{lon:M,lat:C}}function e(M){var C=0;M=M.split("").reverse().join("");for(var W=0;W<M.length;W++)C+=Number(M[W])*Math.pow(2,W);
return B.base32[C]}function d(M,C){var W={x:M.xmin,y:M.ymax},Y={x:M.xmax,y:M.ymin},R={x:M.xmax,y:M.ymax};return{sw:O.pointToGeohash({x:M.xmin,y:M.ymin},C),nw:O.pointToGeohash(W,C),se:O.pointToGeohash(Y,C),ne:O.pointToGeohash(R,C)}}function h(M,C,W,Y,R){var S=M;do R[S]||(R[S]=!0,Y.push(S)),(M=S===C)||(S=F(S,W));while(!M)}function y(M,C,W,Y){var R=d(M,C);M=[];h(R.sw,R.nw,"n",M,{});C=[];h(R.se,R.ne,"n",C,{});for(R=0;R<M.length;R++)h(M[R],C[R],"e",W,Y)}function I(M){return K.filter(M,function(C){return 180===
C.xmax?!0:!1})[0]}function H(M){return K.filter(M,function(C){return-180===C.xmin?!0:!1})[0]}function u(M,C,W,Y){var R=O.geographicToWebMercator(M);M={x:R.x-C,y:R.y-C};C=O.webMercatorToGeographic({x:R.x+C,y:R.y+C},!0);M=O.webMercatorToGeographic(M,!0);return new x(null!=W?W:M.x,M.y,null!=Y?Y:C.x,C.y)}function G(M,C,W,Y){M=d(M,C);var R,S;"min"===Y?S=180:"max"===Y&&(R=-180);var T=R;Y=S;var Z=O.geohashToCell(M.sw).extent;C=O.geohashToCell(M.ne).extent;M=null!=T?T:Z.xmin;Z=Z.ymin;Y=null!=Y?Y:C.xmax;C=
C.ymax;M=u({x:M,y:Z},W,R,S);W=u({x:Y,y:C},W,R,S);return new x(M.xmin,M.ymin,W.xmax,W.ymax)}function v(M,C,W){var Y=M,R=0;do R++,(M=Y===C)||(Y=F(Y,W));while(!M);return R}function t(M,C){M=d(M,C);C=v(M.nw,M.ne,"e");return{rows:v(M.nw,M.sw,"s"),cols:C}}function F(M,C){var W=M.length%2,Y=M.slice(-1),R=B.decimals[Y];M=M.slice(0,-1);-1!=B.borders[C][W].indexOf(Y)&&M&&(M=F(M,C));return M+B.neighbors[C][W][R]}var B={base32:"0123456789bcdefghjkmnpqrstuvwxyz",decimals:function(){for(var M={},C=0;32>C;C++)M["0123456789bcdefghjkmnpqrstuvwxyz"[C]]=
C;return M}(),neighbors:{n:[null,"238967debc01fg45kmstqrwxuvhjyznp"],s:[null,"bc01fg45238967deuvhjyznpkmstqrwx"],e:[null,"14365h7k9dcfesgujnmqp0r2twvyx8zb"],w:[null,"p0r21436x8zb9dcf5h7kjnmqesgutwvy"]},borders:{n:[null,"bcfguvyz"],s:[null,"0145hjnp"],e:[null,"prxz"],w:[null,"028b"]},bitsPerBase32Char:5,maxGeohashLength:12,longitudeRange:[-180,180],latitudeRange:[-90,90]};B.neighbors.n[0]="14365h7k9dcfesgujnmqp0r2twvyx8zb";B.neighbors.s[0]="p0r21436x8zb9dcf5h7kjnmqesgutwvy";B.neighbors.e[0]="238967debc01fg45kmstqrwxuvhjyznp";
B.neighbors.w[0]="bc01fg45238967deuvhjyznpkmstqrwx";B.borders.n[0]="prxz";B.borders.s[0]="028b";B.borders.e[0]="bcfguvyz";B.borders.w[0]="0145hjnp";var O={geographicToWebMercator:function(M){M=w.lngLatToXY(M.x,M.y);return{x:M[0],y:M[1]}},webMercatorToGeographic:function(M,C){M=w.xyToLngLat(M.x,M.y,C);return{x:M[0],y:M[1]}},geohashToCell:function(M){var C;var W=[];for(C=0;C<M.length;C++)W.push(f(M[C]));W=W.join("");C=[];for(var Y=[],R=0;R<W.length;R++)0===R%2?C.push(W[R]):Y.push(W[R]);C=C.join("");
Y=Y.join("");C=[C,Y];W=b(C[0],B.longitudeRange);Y=b(C[1],B.latitudeRange);C=W.value;return{point:{x:C,y:Y.value},extent:{xmin:W.min,xmax:W.max,ymin:Y.min,ymax:Y.max},geohash:M}},pointToCell:function(M,C){C=C||B.maxGeohashLength;if(M=g(M)){M=l(M,M);var W=a(C);C=c(M.x,B.longitudeRange,W.lon);var Y=c(M.y,B.latitudeRange,W.lat);W=C.value;var R=Y.value;C={xmin:C.min,xmax:C.max,ymin:Y.min,ymax:Y.max};Y=[];for(var S=Math.ceil((W.length+R.length)/B.bitsPerBase32Char),T=0,Z=0,qa=0;qa<S*B.bitsPerBase32Char;qa++){var ta=
0===qa%2?W[T++]:R[Z++];null==ta&&(ta=0);Y.push(ta)}W=Y.join("");R=B.bitsPerBase32Char;Y=W.length/R;S=[];for(T=0;T<Y;T++)Z=W.substr(T*R,R),S.push(e(Z));W=S.join("");return{point:M,extent:C,geohash:W}}},geohashToPoint:function(M){return O.geohashToCell(M).point},pointToGeohash:function(M,C){return(M=O.pointToCell(M,C))&&M.geohash},getCells:function(M){return K.map(M,function(C){return O.geohashToCell(C)})},getCellSize:function(M){var C=B.longitudeRange,W=B.latitudeRange;C=Math.abs(C[1]-C[0]);W=Math.abs(W[1]-
W[0]);M=a(M||1);return{width:C/Math.pow(2,M.lon),height:W/Math.pow(2,M.lat)}},getCellSizeInMeters:function(M){M=O.getCellSize(M);var C=n.metersPerDegree;M.width*=C;M.height*=C;return M},getIntersecting:function(M,C,W){C=C||1;W=W||0;var Y=[],R=m(M);if(R){W&&(R=O.expandExtent(M,C,W));M=R.normalize();var S={};K.forEach(M,function(T){y(T,C,Y,S)})}return Y},countIntersecting:function(M,C,W){C=C||1;W=W||0;var Y=0,R=m(M);if(R){W&&(R=O.expandExtent(M,C,W));M=R.normalize();if(2===M.length){Y=I(M);R=H(M);W=
t(Y,C);var S=t(R,C);M=W.rows;W=W.cols+S.cols;Y={x:Y.xmin,y:Y.ymax};R={x:R.xmax,y:R.ymax};Y=l(Y,{});R=l(R,{});Y=O.pointToGeohash(Y,C);C=O.pointToGeohash(R,C);Y===C&&W--;C={rows:M,cols:W}}else C=t(M[0],C);Y=C.cols*C.rows}return Y},getChildren:function(M){M=M||"";var C=[],W;for(W in B.decimals)C.push(M+W);return C},getNeighbors:function(M){var C=F(M,"n"),W=F(M,"s");return[C,F(C,"e"),F(C,"w"),W,F(W,"e"),F(W,"w"),F(M,"e"),F(M,"w")]},getExtentFromDistance:function(M,C){C=C||1E3;var W;(M=g(M))&&(W=u(M,C));
return W},expandExtent:function(M,C,W){C=C||1;W=W||0;if(M=m(M)){if(W){M=M.normalize();if(2===M.length){var Y=W;W=I(M);M=H(M);W=G(W,C,Y,"min");M=G(M,C,Y,"max");360<=W.getWidth()+M.getWidth()?(C=-180,M=180):(C=W.xmin,M=M.xmax);return new x(C,W.ymin,M,W.ymax)}return G(M[0],C,W)}return M}},getNeighborsWithinDistance:function(M,C,W){W=W||1E3;C=C||1;var Y=[];if(M=g(M)){W=u(M,W).normalize();var R={};K.forEach(W,function(S){y(S,C,Y,R)})}return Y}};L("extend-esri")&&q.setObject("layers.clustering.geohashUtils",
O,E);return O})},"esri/layers/clustering/statUtils":function(){define(["dojo/_base/lang","../support/attributeUtils"],function(L,J){function q(w){return"number"===typeof w&&!isNaN(w)&&Infinity!==w&&-Infinity!==w}var K={sum:{initialize:function(){return{count:0,sum:null}},updateCellStat:function(w,x){q(x)&&(w.count++,w.sum+=x)},updateClusterStat:function(w,x){x.count&&(w.count+=x.count,w.sum+=x.sum)},summarize:function(w){return w.sum}},avg:{initialize:function(w){return{count:0,sum:null,avg:null,
sum_cosine:null,sum_sine:null}},updateCellStat:function(w,x,A){q(x)&&(w.count++,A.isAngular?(A.isArithmetic||(x=-1*x+90),w.sum_cosine+=Math.cos(x*Math.PI/180),w.sum_sine+=Math.sin(x*Math.PI/180)):w.sum+=x)},updateClusterStat:function(w,x,A){x.count&&(w.count+=x.count,A.isAngular?(w.sum_cosine+=x.sum_cosine,w.sum_sine+=x.sum_sine):w.sum+=x.sum)},summarize:function(w,x){if(0<w.count){var A=w.count;x.isAngular?(A=180*Math.atan2(w.sum_sine/A,w.sum_cosine/A)/Math.PI,x.isArithmetic||(A=-1*(A-90)),w.avg=
0>A?A+360:A):(w.avg=w.sum/A,x.isDate&&(w.avg=Math.ceil(w.avg)))}return w.avg}},type:{initialize:function(){return{uvInfos:{}}},updateCellStat:function(w,x){if(null==x||""===x||"string"===typeof x&&""===L.trim(x))x=null;w=w.uvInfos;null==w[x]?w[x]={count:1,value:x}:w[x].count++},updateClusterStat:function(w,x){w=w.uvInfos;x=x.uvInfos;for(var A in x){var n=x[A];null==w[A]?w[A]={count:n.count,value:n.value}:w[A].count+=n.count}},summarize:function(w){w=w.uvInfos;var x,A=-Infinity;for(x in w){var n=w[x];
if(n.count>A){A=n.count;var g=n.value}else n.count===A&&(g=null)}return g}}},E={isSupportedStatisticType:function(w){return K.hasOwnProperty(w)},getStatisticFunctions:function(w){return K[w]},getStatisticId:function(w,x){var A=J.getAttributeIdSource(w);w=A&&J.getAttributeId(A)||w.field;return x+"_"+w},getClusterField:function(w,x){return"cluster_"+E.getStatisticId(w,x)},getStatisticHash:function(w,x){x=[E.getStatisticId(w,x)];w.attributeType&&x.push(w.attributeType.toLowerCase());w.rotationType&&
x.push(w.rotationType.toLowerCase());return x.join("_")}};return E})},"esri/tasks/RouteTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../request ../geometry/normalizeUtils ./Task ./RouteResult ./NAMessage ./NAServiceDescription".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,l){L=L([n,l],{declaredClass:"esri.tasks.RouteTask",_eventMap:{"solve-complete":["result"]},constructor:function(f){this._url.orig=this._url.path;this._url.path+="/solve";
this._handler=J.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(f,b,c,a,e){try{var d=[],h=[],y=f.directions||[],I=f.routes?f.routes.features:[],H=f.stops?f.stops.features:[],u=f.barriers?f.barriers.features:[],G=f.polygonBarriers?f.polygonBarriers.features:[],v=f.polylineBarriers?f.polylineBarriers.features:[],t=f.messages,F=q.forEach,B=
q.indexOf,O=!0,M,C,W=f.routes&&f.routes.spatialReference||f.stops&&f.stops.spatialReference||f.barriers&&f.barriers.spatialReference||f.polygonBarriers&&f.polygonBarriers.spatialReference||f.polylineBarriers&&f.polylineBarriers.spatialReference;this._chk=f.checksum;F(y,function(S){d.push(M=S.routeName);h[M]={directions:S}});F(I,function(S){-1===B(d,M=S.attributes.Name)&&(d.push(M),h[M]={});h[M].route=S});F(H,function(S){C=S.attributes;-1===B(d,M=C.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&
(d.push(M),h[M]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==M&&(O=!1);void 0===h[M].stops&&(h[M].stops=[]);h[M].stops.push(S)});0<H.length&&!0===O&&(h[d[0]].stops=h["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete h["esri.tasks.RouteTask.NULL_ROUTE_NAME"],d.splice(q.indexOf(d,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));var Y=[];F(d,function(S,T){h[S].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===S?null:S;h[S].spatialReference=W;Y.push(new g(h[S]))});f=function(S){F(S,function(T,Z){T.geometry&&
(T.geometry.spatialReference=W);S[Z]=new w(T)});return S};F(t,function(S,T){t[T]=new m(S)});var R={routeResults:Y,barriers:f(u),polygonBarriers:f(G),polylineBarriers:f(v),messages:t};this._successHandler([R],"onSolveComplete",c,e)}catch(S){this._errorHandler(S,a,e)}},solve:function(f,b,c,a){var e=a.assembly;f=this._encode(J.mixin({},this._url.query,{f:"json"},f.toJson(e&&e[0]),this._chk?{checksum:this._chk}:{}));var d=this._handler,h=this._errorHandler;return x({url:this._url.path,timeout:25E4,content:f,
callbackParamName:"callback",load:function(y,I){d(y,I,b,c,a.dfd)},error:function(y){h(y,c,a.dfd)}})},onSolveComplete:function(){}});A._createWrappers(L);K("extend-esri")&&J.setObject("tasks.RouteTask",L,E);return L})},"esri/tasks/RouteResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ./DirectionsFeatureSet".split(" "),function(L,J,q,K,E,w,x){L=L(null,{declaredClass:"esri.tasks.RouteResult",constructor:function(A){var n=A.spatialReference,
g=A.route;if(A.directions){var m=[],l=[],f=[];q.forEach(A.directions.features,function(c,a){l[a]=c.compressedGeometry;m[a]=c.strings;f[a]=c.events});A.directions.strings=m;A.directions.events=f;this.directions=new x(A.directions,l)}this.routeName=A.routeName;g&&(g.geometry&&(g.geometry.spatialReference=n),this.route=new w(g));if(A.stops){var b=this.stops=[];q.forEach(A.stops,function(c,a){c.geometry&&(c.geometry.spatialReference=n);b[c.attributes.Sequence-1]=new w(c)})}},routeName:null,directions:null,
route:null,stops:null});K("extend-esri")&&J.setObject("tasks.RouteResult",L,E);return L})},"esri/tasks/DirectionsFeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/json ../kernel ../geometry/Extent ../geometry/Polyline ../geometry/Point ../graphic ./FeatureSet".split(" "),function(L,J,q,K,E,w,x,A,n,g,m){L=L(m,{declaredClass:"esri.tasks.DirectionsFeatureSet",constructor:function(l,f){this.routeId=l.routeId;this.routeName=l.routeName;J.mixin(this,l.summary);
this.extent=new x(this.envelope);var b=this._fromCompressedGeometry,c=this.features,a=this.extent.spatialReference,e=[];q.forEach(f,function(d,h){c[h].setGeometry(e[h]=d?b(d,a):c[h].geometry)});this.mergedGeometry=this._mergePolylinesToSinglePath(e,a);this.geometryType="esriGeometryPolyline";q.forEach(l.events,function(d,h){q.forEach(d,function(y,I){d[I]=new g(new n(y.point.x,y.point.y,a),null,{ETA:y.ETA,strings:E.stringify(y.strings),arriveTimeUTC:y.arriveTimeUTC})});l.events[h]=d});delete this.envelope},
_fromCompressedGeometry:function(l,f){var b=0,c=0,a=0,e=0,d=[],h=0,y=0,I=0;(l=l.match(/((\+|\-)[^\+\-\|]+|\|)/g))||(l=[]);if(0===parseInt(l[h],32)){h=2;var H=parseInt(l[h],32);h++;var u=parseInt(l[h],32);h++;if(H&1){y=q.indexOf(l,"|")+1;var G=parseInt(l[y],32);y++}if(H&2){I=q.indexOf(l,"|",y)+1;var v=parseInt(l[I],32);I++}}else u=parseInt(l[h],32),h++;for(;h<l.length&&"|"!==l[h];){H=parseInt(l[h],32)+b;h++;b=H;var t=parseInt(l[h],32)+c;h++;c=t;H=[H/u,t/u];y&&(t=parseInt(l[y],32)+a,y++,a=t,H.push(t/
G));I&&(t=parseInt(l[I],32)+e,I++,e=t,H.push(t/v));d.push(H)}b=new A({paths:[d],hasZ:0<y,hasM:0<I});b.setSpatialReference(f);return b},_mergePolylinesToSinglePath:function(l,f){var b=[],c=!1;q.forEach(l,function(d){q.forEach(d.paths,function(h){c=c||d.hasM;b=b.concat(h)})});var a=[],e=[0,0];q.forEach(b,function(d){if(d[0]!==e[0]||d[1]!==e[1])a.push(d),e=d});return new A({paths:[a],spatialReference:f,hasM:c})}});K("extend-esri")&&J.setObject("tasks.DirectionsFeatureSet",L,w);return L})},"esri/tasks/NAMessage":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(L,J,q,K){L=L(null,{declaredClass:"esri.tasks.NAMessage",constructor:function(E){J.mixin(this,E)}});J.mixin(L,{TYPE_INFORMATIVE:0,TYPE_PROCESS_DEFINITION:1,TYPE_PROCESS_START:2,TYPE_PROCESS_STOP:3,TYPE_WARNING:50,TYPE_ERROR:100,TYPE_EMPTY:101,TYPE_ABORT:200});q("extend-esri")&&J.setObject("tasks.NAMessage",L,K);return L})},"esri/tasks/NAServiceDescription":function(){define(["dojo/_base/declare","dojo/json","dojo/Deferred","dojo/_base/lang","../request"],
function(L,J,q,K,E){return L(null,{declaredClass:"esri.tasks._NAServiceDescription",_sd:null,getServiceDescription:function(w,x){var A=new q;if(this._sd)A.resolve(this._sd);else if(this._url&&this._url.orig){var n=this._url.orig,g=(this._url.path.match(/\/solve$/)||[]).length?"Route":(this._url.path.match(/\/solveClosestFacility$/)||[]).length?"ClosestFacility":"ServiceAreas",m,l=function(f){E({url:f+("/"===f[f.length-1]?"":"/")+"GetTravelModes/execute",content:{f:"json",serviceName:g},callbackParamName:"callback"}).then(function(b){var c=
[],a=null;if(b&&b.results&&b.results.length)for(var e=0;e<b.results.length;e++)if("supportedTravelModes"===b.results[e].paramName){if(b.results[e].value&&b.results[e].value.features)for(var d=0;d<b.results[e].value.features.length;d++)if(b.results[e].value.features[d].attributes){var h=J.parse(b.results[e].value.features[d].attributes.TravelMode);c.push(h)}}else"defaultTravelMode"===b.results[e].paramName&&(a=b.results[e].value);m.supportedTravelModes=c;m.defaultTravelMode=a;A.resolve(m)},function(b){console.log("Could not read from the routingUtilities service.");
A.reject(b)})};E({url:n,content:{f:"json"},callbackParamName:"callback"}).then(function(f){m=f;m.supportedTravelModes||(m.supportedTravelModes=[]);for(f=0;f<m.supportedTravelModes.length;f++)m.supportedTravelModes[f].id||(m.supportedTravelModes[f].id=m.supportedTravelModes[f].itemId);x?A.resolve(m):w?l(w):10.4<=m.currentVersion?E({url:n+("/"===n[n.length-1]?"":"/")+"retrieveTravelModes",content:{f:"json"},callbackParamName:"callback"}).then(function(b){m.supportedTravelModes=b.supportedTravelModes;
m.defaultTravelMode=b.defaultTravelMode;A.resolve(m)},function(b){console.log("Could not get to the NAServer's retrieveTravelModes.");A.reject(b)}):E({url:n.substring(0,n.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).then(function(b){b.owningSystemUrl?(n=b.owningSystemUrl,E({url:n+("/"===n[n.length-1]?"":"/")+"sharing/rest/portals/self",content:{f:"json"},callbackParamName:"callback"}).then(function(c){c&&c.helperServices&&c.helperServices.routingUtilities&&c.helperServices.routingUtilities.url?
l(c.helperServices.routingUtilities.url):(console.log("Portal does not have helperServices.routingUtilities defined."),A.resolve(m))},function(c){console.log("Could not get to the portal's self.");A.reject(c)})):A.resolve(m)},function(b){console.log("Could not get to the NAServer service description.");A.reject(b)})},function(f){A.reject(f)})}else A.reject("NA Task has no URL specified.");A.then(K.hitch(this,function(f){this._sd=f}),K.hitch(this,function(){this._sd=null}));return A.promise},getOwningSystemUrl:function(){var w=
new q;if(this._url&&this._url.orig){var x=this._url.orig;E({url:x.substring(0,x.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).promise.always(function(A){w.resolve(A.owningSystemUrl)})}else w.resolve(void 0);return w.promise}})})},"esri/tasks/RouteParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../graphicsUtils ./NATypes".split(" "),function(L,J,q,K,E,w,x,A){L=L(null,{declaredClass:"esri.tasks.RouteParameters",
accumulateAttributes:null,attributeParameterValues:null,barriers:null,directionsLanguage:null,directionsLengthUnits:null,directionsOutputType:null,directionsStyleName:null,directionsTimeAttribute:null,doNotLocateOnRestrictedElements:!0,findBestSequence:null,ignoreInvalidLocations:null,impedanceAttribute:null,outputLines:"esriNAOutputLineTrueShape",outputGeometryPrecision:null,outputGeometryPrecisionUnits:null,outSpatialReference:null,overrides:null,polygonBarriers:null,polylineBarriers:null,preserveFirstStop:null,
preserveLastStop:null,restrictionAttributes:null,restrictUTurns:null,returnBarriers:!1,returnDirections:!1,returnPolygonBarriers:!1,returnPolylineBarriers:!1,returnRoutes:!0,returnStops:!1,returnZ:!0,startTime:null,startTimeIsUTC:null,timeWindowsAreUTC:null,stops:null,useHierarchy:null,useTimeWindows:null,travelMode:null,toJson:function(n){var g={returnDirections:this.returnDirections,returnRoutes:this.returnRoutes,returnZ:this.returnZ,returnStops:this.returnStops,returnBarriers:this.returnBarriers,
returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,attributeParameterValues:this.attributeParameterValues&&q.toJson(this.attributeParameterValues),outSR:this.outSpatialReference?this.outSpatialReference.wkid||q.toJson(this.outSpatialReference.toJson()):null,outputLines:this.outputLines,overrides:this.overrides,findBestSequence:this.findBestSequence,preserveFirstStop:this.preserveFirstStop,preserveLastStop:this.preserveLastStop,useTimeWindows:this.useTimeWindows,
startTime:this.startTime?this.startTime.getTime():null,startTimeIsUTC:this.startTimeIsUTC,timeWindowsAreUTC:this.timeWindowsAreUTC,accumulateAttributeNames:this.accumulateAttributes?this.accumulateAttributes.join(","):null,ignoreInvalidLocations:this.ignoreInvalidLocations,impedanceAttributeName:this.impedanceAttribute,restrictionAttributeNames:this.restrictionAttributes?this.restrictionAttributes.join(","):null,restrictUTurns:this.restrictUTurns,useHierarchy:this.useHierarchy,directionsLanguage:this.directionsLanguage,
outputGeometryPrecision:this.outputGeometryPrecision,outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,directionsLengthUnits:A.LengthUnit[this.directionsLengthUnits],directionsTimeAttributeName:this.directionsTimeAttribute,directionsStyleName:this.directionsStyleName,travelMode:"object"===typeof this.travelMode?q.toJson(this.travelMode):this.travelMode},m=this.stops;"esri.tasks.FeatureSet"===m.declaredClass&&0<m.features.length?g.stops=q.toJson({type:"features",features:x._encodeGraphics(m.features,
n&&n["stops.features"]),doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}):"esri.tasks.DataLayer"===m.declaredClass?g.stops=m:"esri.tasks.DataFile"===m.declaredClass&&(g.stops=q.toJson({type:"features",url:m.url,doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}));if(this.directionsOutputType)switch(this.directionsOutputType.toLowerCase()){case "complete":g.directionsOutputType="esriDOTComplete";break;case "complete-no-events":g.directionsOutputType="esriDOTCompleteNoEvents";
break;case "instructions-only":g.directionsOutputType="esriDOTInstructionsOnly";break;case "standard":g.directionsOutputType="esriDOTStandard";break;case "summary-only":g.directionsOutputType="esriDOTSummaryOnly";break;default:g.directionsOutputType=this.directionsOutputType}m=function(l,f){return l?"esri.tasks.FeatureSet"===l.declaredClass?0<l.features.length?q.toJson({type:"features",features:x._encodeGraphics(l.features,n&&n[f])}):null:"esri.tasks.DataLayer"===l.declaredClass?l:"esri.tasks.DataFile"===
l.declaredClass?q.toJson({type:"features",url:l.url}):q.toJson(l):null};this.barriers&&(g.barriers=m(this.barriers,"barriers.features"));this.polygonBarriers&&(g.polygonBarriers=m(this.polygonBarriers,"polygonBarriers.features"));this.polylineBarriers&&(g.polylineBarriers=m(this.polylineBarriers,"polylineBarriers.features"));return w.filter(g,function(l){if(null!==l)return!0})}});K("extend-esri")&&J.setObject("tasks.RouteParameters",L,E);return L})},"esri/tasks/NATypes":function(){define(["dojo/_base/lang",
"dojo/has","../kernel"],function(L,J,q){var K={esriFeet:"esriNAUFeet",esriKilometers:"esriNAUKilometers",esriMeters:"esriNAUMeters",esriMiles:"esriNAUMiles",esriNauticalMiles:"esriNAUNauticalMiles",esriYards:"esriNAUYards"},E={NONE:"esriNAOutputLineNone",STRAIGHT:"esriNAOutputLineStraight",TRUE_SHAPE:"esriNAOutputLineTrueShape",TRUE_SHAPE_WITH_MEASURE:"esriNAOutputLineTrueShapeWithMeasure"},w={ALLOW_BACKTRACK:"esriNFSBAllowBacktrack",AT_DEAD_ENDS_ONLY:"esriNFSBAtDeadEndsOnly",NO_BACKTRACK:"esriNFSBNoBacktrack",
AT_DEAD_ENDS_AND_INTERSECTIONS:"esriNFSBAtDeadEndsAndIntersections"},x={NONE:"esriNAOutputPolygonNone",SIMPLIFIED:"esriNAOutputPolygonSimplified",DETAILED:"esriNAOutputPolygonDetailed"},A={FROM_FACILITY:"esriNATravelDirectionFromFacility",TO_FACILITY:"esriNATravelDirectionToFacility"},n={LengthUnit:K,OutputLine:E,UTurn:w,OutputPolygon:x,TravelDirection:A};J("extend-esri")&&(L.setObject("tasks._NALengthUnit",K,q),L.setObject("tasks.NAOutputLine",E,q),L.setObject("tasks.NAUTurn",w,q),L.setObject("tasks.NAOutputPolygon",
x,q),L.setObject("tasks.NATravelDirection",A,q));return n})},"esri/tasks/DistanceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(L,J,q,K,E,w){L=L(null,{declaredClass:"esri.tasks.DistanceParameters",geometry1:null,geometry2:null,distanceUnit:null,geodesic:null,toJson:function(){var x={},A=this.geometry1;A&&(x.geometry1=q.toJson({geometryType:w.getJsonType(A),geometry:A}));if(A=this.geometry2)x.geometry2=
q.toJson({geometryType:w.getJsonType(A),geometry:A});x.sr=q.toJson(this.geometry1.spatialReference.toJson());this.distanceUnit&&(x.distanceUnit=this.distanceUnit);this.geodesic&&(x.geodesic=this.geodesic);return x}});K("extend-esri")&&J.setObject("tasks.DistanceParameters",L,E);return L})},"esri/tasks/PrintTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ../request ../urlUtils ../geometry/Polygon ../renderers/SimpleRenderer ../symbols/FillSymbol ./Geoprocessor ./PrintTemplate ./Task dojo/dom-attr dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query dojo/has!extend-esri?./PrintParameters dojo/has!extend-esri?./LegendLayer".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a,e,d,h,y,I,H,u,G){L=L(h,{declaredClass:"esri.tasks.PrintTask",constructor:function(v,t){this.url=v;this.printGp=new e(this.url);this._handler=J.hitch(this,this._handler);t&&t.async&&(this.async=!0);this._colorEvaluator=G("$..color")},async:!1,_vtlExtent:null,_cimVersion:null,_is11xService:!1,_loadGpServerMetadata:!0,execute:function(v,t,F){if(!this._loadGpServerMetadata)return this._execute(v,t,F);var B=new E(g._dfdCanceller),O=this._url.path,M=O.lastIndexOf("/GPServer/");
0<M&&(O=O.slice(0,M+9));B._pendingDfd=l({url:O,callbackParamName:"callback",content:J.mixin({},this._url.query,{f:"json"})}).then(J.hitch(this,function(C){this._loadGpServerMetadata=!1;this.async="esriExecutionTypeAsynchronous"===C.executionType;this._cimVersion=C.cimVersion;this._is11xService=!!this._cimVersion;B._pendingDfd=this._execute(v);return B._pendingDfd})).then(J.hitch(this,function(C){this._successHandler([C],null,t,B)})).otherwise(function(C){F&&F(C);B.errback(C)});return B},_handler:function(v,
t,F,B,O){try{if(this.async)"esriJobSucceeded"===v.jobStatus?this.printGp.getResultData(v.jobId,"Output_File",J.hitch(this,function(C){M=C.value;this._successHandler([M],"onComplete",F,O)})):this._errorHandler(Error(v.jobStatus),B,O);else{var M=v[0].value;this._successHandler([M],"onComplete",F,O)}}catch(C){this._errorHandler(C,B,O)}},_execute:function(v,t,F){var B=this._handler,O=this._errorHandler,M=v.template||new d;M.hasOwnProperty("showLabels")||(M.showLabels=!0);var C=M.exportOptions,W;C&&(W=
{outputSize:[C.width,C.height],dpi:C.dpi});C=M.layoutOptions;var Y=[];if(C){this.legendAll=!1;C.legendLayers?q.forEach(C.legendLayers,function(Va){var ab={};ab.id=Va.layerId;Va.subLayerIds&&(ab.subLayerIds=Va.subLayerIds);Y.push(ab)}):this.legendAll=!0;if("Miles"===C.scalebarUnit||"Kilometers"===C.scalebarUnit){var R="esriKilometers";var S="esriMiles"}else if("Meters"===C.scalebarUnit||"Feet"===C.scalebarUnit)R="esriMeters",S="esriFeet";var T={esriMiles:"mi",esriKilometers:"km",esriFeet:"ft",esriMeters:"m"};
T={titleText:C.titleText,authorText:C.authorText,copyrightText:C.copyrightText,customTextElements:C.customTextElements,scaleBarOptions:{metricUnit:R,metricLabel:T[R],nonMetricUnit:S,nonMetricLabel:T[S]},legendOptions:{operationalLayers:Y}}}R=this._getPrintDefinition(v.map,M);v.outSpatialReference&&(R.mapOptions.spatialReference=v.outSpatialReference.toJson());v.template&&A.isDefined(v.template.showAttribution)&&(R.mapOptions.showAttribution=v.template.showAttribution);J.mixin(R,{exportOptions:W,layoutOptions:T});
this.allLayerslegend&&J.mixin(R.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}});if(R.operationalLayers){W=R.operationalLayers;var Z=function(Va){return A.fixJson(J.mixin(Va,{type:"esriSLS",cap:void 0,join:void 0,meterLimit:void 0}))},qa=/[\u4E00-\u9FFF\u0E00-\u0E7F\u0900-\u097F\u3040-\u309F\u30A0-\u30FF\u31F0-\u31FF]/,ta=/[\u0600-\u06FF]/,Ba=function(Va){var ab=Va.text,Q=(Va=Va.font)&&Va.family&&Va.family.toLowerCase();ab&&Va&&("arial"===Q||"arial unicode ms"===Q)&&(Va.family=
qa.test(ab)?"Arial Unicode MS":"Arial","normal"!==Va.style&&ta.test(ab)&&(Va.family="Arial Unicode MS"))};for(T=0;T<W.length;T++)if(W[T].featureCollection&&W[T].featureCollection.layers)for(S=0;S<W[T].featureCollection.layers.length;S++){var Oa=W[T].featureCollection.layers[S];if(Oa.layerDefinition&&Oa.layerDefinition.drawingInfo&&Oa.layerDefinition.drawingInfo.renderer&&Oa.layerDefinition.drawingInfo.renderer.symbol){var Ia=Oa.layerDefinition.drawingInfo.renderer;"esriCLS"===Ia.symbol.type?Ia.symbol=
Z(Ia.symbol):"esriTS"===Ia.symbol.type?Ba(Ia.symbol):Ia.symbol.outline&&"esriCLS"===Ia.symbol.outline.type&&(Ia.symbol.outline=Z(Ia.symbol.outline))}if(Oa.featureSet&&Oa.featureSet.features)for(C=0;C<Oa.featureSet.features.length;C++)Ia=Oa.featureSet.features[C],Ia.symbol&&("esriCLS"===Ia.symbol.type?Ia.symbol=Z(Ia.symbol):"esriTS"===Ia.symbol.type?Ba(Ia.symbol):Ia.symbol.outline&&"esriCLS"===Ia.symbol.outline.type&&(Ia.symbol.outline=Z(Ia.symbol.outline)))}}M={Web_Map_as_JSON:K.toJson(A.fixJson(R)),
Format:M.format,Layout_Template:M.layout};v.extraParameters&&(M=J.mixin(M,v.extraParameters));var Ra=new E(g._dfdCanceller);v=function(Va,ab){B(Va,ab,t,F,Ra)};R=function(Va){O(Va,F,Ra)};Ra._pendingDfd=this.async?this.printGp.submitJob(M,v,null,R):this.printGp.execute(M,v,R);return Ra},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",
features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",
drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}},_convertSvgSymbol:function(v){if(!(8>=w("ie")||!v.path&&"image/svg+xml"!==v.contentType)){var t=u.createSurface(I.create("div"),1024,1024);var F="image/svg+xml"===v.contentType?t.createObject(u.Image,{src:"data:image/svg+xml;base64,"+v.imageData,width:H.pt2px(v.width),height:H.pt2px(v.height),x:0,y:0}):t.createObject(u.Path,v.path).setFill(v.color).setStroke(v.outline);"pendingRender"in t&&t._render(!0);var B=
t.rawNode.getContext("2d"),O=Math.ceil(F.getBoundingBox().width),M=Math.ceil(F.getBoundingBox().height);F=B.getImageData(F.getBoundingBox().x,F.getBoundingBox().y,O,M);B.canvas.width=O;B.canvas.height=M;B.putImageData(F,0,0);B=B.canvas.toDataURL("image/png");v={type:"esriPMS",imageData:B.substr(22,B.length),angle:v.angle,contentType:"image/png",height:v.size?v.size:H.px2pt(M),width:v.size?O/M*v.size:H.px2pt(O),xoffset:v.xoffset,yoffset:v.yoffset};t.destroy();return v}},_convertSvgRenderer:function(v){"simple"===
v.type&&v.symbol&&(v.symbol.path||"image/svg+xml"===v.symbol.contentType)?v.symbol=this._convertSvgSymbol(v.symbol):"uniqueValue"===v.type?(v.defaultSymbol&&(v.defaultSymbol.path||"image/svg+xml"===v.defaultSymbol.contentType)&&(v.defaultSymbol=this._convertSvgSymbol(v.defaultSymbol)),v.uniqueValueInfos&&q.forEach(v.uniqueValueInfos,function(t){if(t.symbol.path||"image/svg+xml"===t.symbol.contentType)t.symbol=this._convertSvgSymbol(t.symbol)},this)):"classBreaks"===v.type&&(v.defaultSymbol&&(v.defaultSymbol.path||
"image/svg+xml"===v.defaultSymbol.contentType)&&(v.defaultSymbol=this._convertSvgSymbol(v.defaultSymbol)),v.classBreakInfos&&q.forEach(v.classBreakInfos,function(t){if(t.symbol.path||"image/svg+xml"===t.symbol.contentType)t.symbol=this._convertSvgSymbol(t.symbol)},this))},_createFeatureCollection:function(v,t,F,B){var O=this._createPolygonLayer(),M=this._createPolylineLayer(),C=this._createPointLayer(),W=this._createMultipointLayer(),Y=this._createPointLayer();Y.layerDefinition.name="textLayer";delete Y.layerDefinition.drawingInfo;
if("esri.layers.FeatureLayer"===v.declaredClass||"esri.layers.StreamLayer"===v.declaredClass)O.layerDefinition.name=M.layerDefinition.name=C.layerDefinition.name=W.layerDefinition.name=J.getObject("arcgisProps.title",!1,v)||v.name||v.id;var R=v.renderer&&"esri.renderer.SimpleRenderer"===v.renderer.declaredClass;if(!v.renderer||v.renderer.valueExpression||J.isFunction(v.renderer.attributeField))delete O.layerDefinition.drawingInfo,delete M.layerDefinition.drawingInfo,delete C.layerDefinition.drawingInfo,
delete W.layerDefinition.drawingInfo;else{var S=v.renderer.toJson({useLegacyRotationProperties:!0});if("temporal"===S.type){S={latestObservationRenderer:S.latestObservationRenderer,trackLinesRenderer:S.trackRenderer,observationAger:S.observationAger,renderer:S.observationRenderer};var T={};v._trackIdField&&(T.trackIdField=v._trackIdField);v._startTimeField&&(T.startTimeField=v._startTimeField);v._endTimeField&&(T.endTimeField=v._endTimeField);O.layerDefinition.drawingInfo=S;O.layerDefinition.timeInfo=
T;M.layerDefinition.drawingInfo=S;M.layerDefinition.timeInfo=T;C.layerDefinition.drawingInfo=S;C.layerDefinition.timeInfo=T;W.layerDefinition.drawingInfo=S;W.layerDefinition.timeInfo=T}else O.layerDefinition.drawingInfo.renderer=S,M.layerDefinition.drawingInfo.renderer=S,C.layerDefinition.drawingInfo.renderer=S,W.layerDefinition.drawingInfo.renderer=S}S=v.fields;S||!v.renderer||v.renderer.valueExpression||J.isFunction(v.renderer.attributeField)||("esri.renderer.ClassBreaksRenderer"===v.renderer.declaredClass?
(S=[{name:v.renderer.attributeField,type:"esriFieldTypeDouble"}],v.renderer.normalizationField&&S.push({name:v.renderer.normalizationField,type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===v.renderer.declaredClass&&(S=[{name:v.renderer.attributeField,type:"esriFieldTypeString"}],v.renderer.attributeField2&&S.push({name:v.renderer.attributeField2,type:"esriFieldTypeString"}),v.renderer.attributeField3&&S.push({name:v.renderer.attributeField3,type:"esriFieldTypeString"})));S&&(O.layerDefinition.fields=
S,M.layerDefinition.fields=S,C.layerDefinition.fields=S,W.layerDefinition.fields=S);S=v.graphics;v.isFeatureReductionActive&&v.isFeatureReductionActive()&&(S=v.getSingleGraphics());T=S.length;var Z;for(Z=0;Z<T;Z++){var qa=S[Z];if(!1!==qa.visible&&qa.geometry){var ta=qa.toJson();ta.symbol&&ta.symbol.outline&&ta.symbol.outline.color&&ta.symbol.outline.color[3]&&!this._is11xService&&(ta.symbol.outline.color[3]=255);if(v.renderer&&!ta.symbol&&(J.isFunction(v.renderer.attributeField)||v.renderer.valueExpression||
this._isFeatureCollectionRequired(v.renderer,v)||"esri.renderer.DotDensityRenderer"===v.renderer.declaredClass||F)){F=F||v.renderer;var Ba=null;try{Ba=F.getSymbol(qa)}catch(Oa){}if(!Ba)continue;ta.symbol=Ba.toJson();this._isFeatureCollectionRequired(F,v)&&this._applyVisualVariables(ta.symbol,{renderer:F,graphic:qa,symbol:Ba,mapResolution:t&&t.getResolutionInMeters(),mapScale:t&&t.getScale()})}ta.symbol&&(ta.symbol.path||"image/svg+xml"===ta.symbol.contentType?ta.symbol=this._convertSvgSymbol(ta.symbol):
ta.symbol.text&&delete ta.attributes);switch(qa.geometry.type){case "polygon":O.featureSet.features.push(ta);break;case "polyline":M.featureSet.features.push(ta);break;case "point":ta.symbol&&ta.symbol.text?Y.featureSet.features.push(ta):C.featureSet.features.push(ta);break;case "multipoint":W.featureSet.features.push(ta);break;case "extent":ta.geometry=b.fromExtent(qa.geometry).toJson(),O.featureSet.features.push(ta)}}}t=[];0<O.featureSet.features.length&&t.push(O);0<M.featureSet.features.length&&
t.push(M);0<W.featureSet.features.length&&t.push(W);0<C.featureSet.features.length&&t.push(C);0<Y.featureSet.features.length&&t.push(Y);if(!t.length)return null;q.forEach(t,function(Oa){var Ia=q.every(Oa.featureSet.features,function(Ra){return Ra.symbol});if(R||Ia)B&&B.forceFeatureAttributes||q.forEach(Oa.featureSet.features,function(Ra){delete Ra.attributes}),B.forceFeatureAttributes||delete Oa.layerDefinition.fields;Ia&&delete Oa.layerDefinition.drawingInfo});q.forEach(t,function(Oa){Oa.layerDefinition.drawingInfo&&
Oa.layerDefinition.drawingInfo.renderer&&this._convertSvgRenderer(Oa.layerDefinition.drawingInfo.renderer)},this);return{id:v.id,opacity:v.opacity,minScale:v.minScale||0,maxScale:v.maxScale||0,featureCollection:{layers:t}}},_getPrintDefinition:function(v,t){var F={operationalLayers:this._createOperationalLayers(v,t)},B=this._vtlExtent||v.extent,O=v.spatialReference;this._vtlExtent=null;v.spatialReference._isWrappable()&&(B=B._normalize(!0),O=B.spatialReference);B={mapOptions:{showAttribution:v.showAttribution,
extent:B.toJson(),spatialReference:O.toJson()}};t.preserveScale&&J.mixin(B.mapOptions,{scale:t.outScale||v.getScale()});v.timeExtent&&J.mixin(B.mapOptions,{time:[v.timeExtent.startTime.getTime(),v.timeExtent.endTime.getTime()]});v={};J.mixin(v,B,F);return v},_createOperationalLayers:function(v,t){var F,B=[],O=0;t.preserveScale&&(O=t.outScale||v.getScale());this.allLayerslegend=this.legendAll?[]:null;this._vtlExtent=null;var M=q.map(v.layerIds,v.getLayer,v);v._mapImageLyr&&M.push(v._mapImageLyr);for(F=
0;F<M.length;F++){var C=M[F];if(C.loaded&&C.visible&&(!O||C.isVisibleAtScale(O))){var W=C.declaredClass;var Y={id:C.id,title:J.getObject("arcgisProps.title",!1,C)||C.id,opacity:C.opacity,minScale:C.minScale||0,maxScale:C.maxScale||0};Y=J.mixin(Y,this._getUrlAndToken(C));C.getNode()&&y.get(C.getNode(),"data-reference")&&(Y._isRefLayer=!0);switch(W){case "esri.layers.ArcGISDynamicMapServiceLayer":var R=[];W=!!C._params.layers;if(C._params.dynamicLayers)W=t.outScale?C._getDynLayerObjs(t.outScale):K.fromJson(C._params.dynamicLayers),
q.forEach(W,function(ta){R.push({id:ta.id,name:ta.name,layerDefinition:ta});delete ta.id;delete ta.name;delete ta.maxScale;delete ta.minScale}),0===R.length&&(Y.visibleLayers=[-1]);else if(C.supportsDynamicLayers){if(W||C.layerDefinitions||C.layerTimeOptions){var S=C.createDynamicLayerInfosFromLayerInfos(),T=null;W&&(T=C.visibleLayers);T=n._getVisibleLayers(S,T);var Z=n._getLayersForScale(t.outScale||v.getScale(),S);q.forEach(S,function(ta){if(!ta.subLayerIds){var Ba=ta.id;-1<q.indexOf(T,Ba)&&-1<
q.indexOf(Z,Ba)&&(ta={source:ta.source.toJson()},C.layerDefinitions&&C.layerDefinitions[Ba]&&(ta.definitionExpression=C.layerDefinitions[Ba]),C.layerTimeOptions&&C.layerTimeOptions[Ba]&&(ta.layerTimeOptions=C.layerTimeOptions[Ba].toJson()),R.push({id:Ba,layerDefinition:ta}))}});0===R.length&&(Y.visibleLayers=[-1])}}else q.forEach(C.layerInfos,function(ta){var Ba={id:ta.id,layerDefinition:{}};C.layerDefinitions&&C.layerDefinitions[ta.id]&&(Ba.layerDefinition.definitionExpression=C.layerDefinitions[ta.id]);
C.layerTimeOptions&&C.layerTimeOptions[ta.id]&&(Ba.layerDefinition.layerTimeOptions=C.layerTimeOptions[ta.id].toJson());(Ba.layerDefinition.definitionExpression||Ba.layerDefinition.layerTimeOptions)&&R.push(Ba)}),W&&(Y.visibleLayers=C.visibleLayers.length?C.visibleLayers:[-1]);R.length&&(Y.layers=R);B.push(Y);this.allLayerslegend&&this.allLayerslegend.push({id:C.id,subLayerIds:C.visibleLayers});break;case "esri.layers.ArcGISImageServiceLayer":Y=J.mixin(Y,{url:C.url,bandIds:C.bandIds,compressionQuality:C.compressionQuality,
format:C.format,interpolation:C.interpolation});C.mosaicRule&&J.mixin(Y,{mosaicRule:C.mosaicRule.toJson()});if(C.renderingRule||C.renderer)this._is11xService?(C.renderingRule&&(Y.renderingRule=C.renderingRule.toJson()),C.renderer&&(Y.layerDefinition=Y.layerDefinition||{},Y.layerDefinition.drawingInfo=Y.layerDefinition.drawingInfo||{},Y.layerDefinition.drawingInfo.renderer=C.renderer.toJson())):(W=C.getExportImageRenderingRule())&&J.mixin(Y,{renderingRule:W.toJson()});B.push(Y);this.allLayerslegend&&
this.allLayerslegend.push({id:C.id});break;case "esri.layers.RasterXLayer":this._is11xService&&(Y=J.mixin(Y,{url:C.url,bandIds:C.bandIds,interpolation:C.interpolation}),C.renderer&&(Y.layerDefinition=Y.layerDefinition||{},Y.layerDefinition.drawingInfo=Y.layerDefinition.drawingInfo||{},Y.layerDefinition.drawingInfo.renderer=C.renderer.toJson()),B.push(Y),this.allLayerslegend&&this.allLayerslegend.push({id:C.id}));break;case "esri.layers.WMSLayer":Y=J.mixin(Y,{url:C.url,title:C.title,type:"wms",version:C.version,
transparentBackground:C.imageTransparency,visibleLayers:C.visibleLayers});B.push(Y);this.allLayerslegend&&this.allLayerslegend.push({id:C.id,subLayerIds:C.visibleLayers});break;case "esri.virtualearth.VETiledLayer":W=C.mapStyle;"roadOnDemand"===W?W="Road":"aerialWithLabelsOnDemand"===W&&(W="Hybrid");Y=J.mixin(Y,{visibility:C.visible,type:"BingMaps"+W,culture:C.culture,key:C.bingMapsKey});B.push(Y);break;case "esri.layers.OpenStreetMapLayer":Y=J.mixin(Y,{credits:C.copyright,type:"OpenStreetMap",url:f.getAbsoluteUrl(C.tileServers[0])});
B.push(Y);break;case "esri.layers.WMTSLayer":Y=J.mixin(Y,{url:C.url,type:"wmts",layer:C._identifier,style:C._style,format:C.format,tileMatrixSet:C._tileMatrixSetId});B.push(Y);break;case "esri.layers.MapImageLayer":W=C.getImages();q.forEach(W,function(ta,Ba){ta.visible&&ta.href&&(Y={id:C.id+"_image"+Ba,type:"image",title:C.id,minScale:C.minScale||0,maxScale:C.maxScale||0,opacity:C.opacity*ta.opacity,extent:ta.extent.toJson()},"data:image/png;base64,"===ta.href.substr(0,22)?Y.imageData=ta.href.substr(22):
Y.url=ta.href,B.push(Y))});break;case "esri.layers.VectorTileLayer":delete Y.url;delete Y.token;if(this._is11xService&&C.currentStyleInfo.serviceUrl&&C.currentStyleInfo.styleUrl&&(W=x.id&&x.id.findCredential(C.currentStyleInfo.styleUrl),S=x.id&&x.id.findCredential(C.currentStyleInfo.serviceUrl),!W&&!S||"2.1.0"!==this._cimVersion)){Y.type="VectorTileLayer";Y.styleUrl=C.currentStyleInfo.styleUrl;W&&(Y.token=W.token);S&&S.token!==Y.token&&(Y.additionalTokens=[{url:C.currentStyleInfo.serviceUrl,token:S.token}]);
B.push(Y);break}Y.type="image";W=this._vtlExtent||v.extent.offset(0,0);var qa=t.exportOptions&&t.exportOptions.dpi||96;S={format:"png",pixelRatio:qa/96};"MAP_ONLY"!==t.layout||!t.preserveScale||t.outScale&&t.outScale!==v.getScale()||96!==qa||!t.exportOptions||t.exportOptions.width%2===v.width%2&&t.exportOptions.height%2===v.height%2||(S.area={x:0,y:0,width:v.width,height:v.height},t.exportOptions.width%2!==v.width%2&&--S.area.width,t.exportOptions.height%2!==v.height%2&&--S.area.height,this._vtlExtent||
(qa=v.toMap({x:S.area.width,y:S.area.height}),W.update(W.xmin,qa.y,qa.x,W.ymax,W.spatialReference),this._vtlExtent=W));Y.extent=W._normalize(!0).toJson();W=C.takeScreenshot(S);W.isResolved()?W.then(function(ta){"data:image/png;base64,"===ta.dataURL.substr(0,22)&&(Y.imageData=ta.dataURL.substr(22))}):console.error("PrintTask: VectorTileLayer.takeScreenshot() returned an unresolved Promise");Y.imageData&&B.push(Y);break;case "esri.layers.WebTiledLayer":W=C.url.replace(/\$\{/g,"{");Y=J.mixin(Y,{type:"WebTiledLayer",
urlTemplate:W,credits:C.copyright});C.subDomains&&0<C.subDomains.length&&(Y.subDomains=C.subDomains);C._wmtsInfo&&(Y.wmtsInfo=C._wmtsInfo);delete Y.url;B.push(Y);break;default:if(C.getTileUrl||C.getImageUrl)Y=J.mixin(Y,{url:C.url}),B.push(Y)}}}M=q.map(v.graphicsLayerIds,v.getLayer,v);for(F=0;F<M.length;F++)C=M[F],C.isFeatureReductionActive&&C.isFeatureReductionActive()&&(C.getSingleGraphics().length?M.splice(++F,0,C.getFeatureReductionLayer()):M[F]=C.getFeatureReductionLayer());for(F=0;F<M.length;F++)if(C=
M[F],C.loaded&&C.visible&&(!O||C.isVisibleAtScale(O)))switch(W=C.declaredClass,W){case "esri.layers.CSVLayer":if(this._is11xService){Y={id:C.id,url:C.url,title:C.title,opacity:C.opacity,minScale:C.minScale||0,maxScale:C.maxScale||0,type:"CSV",locationInfo:{latitudeFieldName:C.latitudeFieldName,longitudeFieldName:C.longitudeFieldName},layerDefinition:{drawingInfo:{renderer:C.renderer&&C.renderer.toJson({useLegacyRotationProperties:!0})}}};B.push(Y);break}case "esri.layers.FeatureLayer":case "esri.layers.LabelLayer":case "esri.layers.StreamLayer":if("esri.layers.LabelLayer"===
W&&!t.showLabels||C.renderer&&"esri.renderer.HeatmapRenderer"===C.renderer.declaredClass)continue;W=null;C.url&&C.renderer&&("esri.renderer.ScaleDependentRenderer"===C.renderer.declaredClass?"scale"===C.renderer.rangeType?W=C.renderer.getRendererInfoByScale(v.getScale())&&C.renderer.getRendererInfoByScale(v.getScale()).renderer:"zoom"===C.renderer.rangeType&&(W=C.renderer.getRendererInfoByZoom(v.getZoom())&&C.renderer.getRendererInfoByZoom(v.getZoom()).renderer):W=C.renderer);S=W&&"esri.layers.CSVLayer"!==
C.declaredClass&&!this._isFeatureCollectionRequired(W,C)&&!W.valueExpression;qa=C.isFeatureReductionActive&&C.isFeatureReductionActive();if(W&&!qa&&"esri.renderer.DotDensityRenderer"!==W.declaredClass&&"esri.layers.StreamLayer"!==C.declaredClass&&(this._is11xService||S)&&("esri.renderer.SimpleRenderer"===W.declaredClass||"esri.renderer.TemporalRenderer"===W.declaredClass||null==W.attributeField||J.isString(W.attributeField)&&C._getField(W.attributeField,!0)))if(Y={id:C.id,title:J.getObject("arcgisProps.title",
!1,C)||C.id,opacity:C.opacity,minScale:C.minScale||0,maxScale:C.maxScale||0,layerDefinition:{drawingInfo:{renderer:W.toJson({useLegacyRotationProperties:!0})}}},Y=J.mixin(Y,this._getUrlAndToken(C)),"esri.renderer.TemporalRenderer"===W.declaredClass&&(S=Y.layerDefinition.drawingInfo,S.latestObservationRenderer=S.renderer.latestObservationRenderer,S.trackLinesRenderer=S.renderer.trackRenderer,S.observationAger=S.renderer.observationAger,S.renderer=S.renderer.observationRenderer,C._trackIdField&&(Y.layerDefinition.timeInfo=
{trackIdField:C._trackIdField})),this._convertSvgRenderer(Y.layerDefinition.drawingInfo.renderer),this._is11xService||1>C.opacity||"esri.renderer.TemporalRenderer"===W.declaredClass||this._updateLayerOpacity(Y))if(C._params.source&&(W=C._params.source.toJson(),J.mixin(Y.layerDefinition,{source:W})),C.getDefinitionExpression()&&J.mixin(Y.layerDefinition,{definitionExpression:C.getDefinitionExpression()}),2!==C.mode)0<C.getSelectedFeatures().length&&(W=q.map(C.getSelectedFeatures(),function(ta){return ta.attributes[C.objectIdField]}),
0<W.length&&C.getSelectionSymbol()&&J.mixin(Y,{selectionObjectIds:W,selectionSymbol:C.getSelectionSymbol().toJson()}));else{W=q.map(C.getSelectedFeatures(),function(ta){return ta.attributes[C.objectIdField]});if(0===W.length||!C._params.drawMode)break;J.mixin(Y.layerDefinition,{objectIds:W});W=null;C.getSelectionSymbol()&&(W=new c(C.getSelectionSymbol()));J.mixin(Y.layerDefinition.drawingInfo,{renderer:W&&W.toJson()})}else Y=this._createFeatureCollection(C,v,null,t);else Y=W&&(W.valueExpression||
this._isFeatureCollectionRequired(W,C)||"esri.renderer.DotDensityRenderer"===W.declaredClass)?this._createFeatureCollection(C,v,W,t):this._createFeatureCollection(C,v,null,t);if(!Y)continue;B.push(Y);this.allLayerslegend&&this.allLayerslegend.push({id:C.id});break;case "esri.layers._GraphicsLayer":case "esri.layers.GraphicsLayer":case "esri.layers.WFSLayer":Y=this._createFeatureCollection(C,v,null,t);if(!Y)continue;B.push(Y);this.allLayerslegend&&this.allLayerslegend.push({id:C.id});break;case "esri.layers.ArcGISImageServiceVectorLayer":Y=
{id:C.id,title:J.getObject("arcgisProps.title",!1,C)||C.id,opacity:C.opacity,minScale:C.minScale||0,maxScale:C.maxScale||0,visibility:C.visible,symbolTileSize:C.symbolTileSize,layerDefinition:{drawingInfo:{renderer:C.renderer.toJson({useLegacyRotationProperties:!0})}}},Y=J.mixin(Y,this._getUrlAndToken(C)),C.mosaicRule&&J.mixin(Y,{mosaicRule:C.mosaicRule.toJson()}),B.push(Y),this.allLayerslegend&&this.allLayerslegend.push({id:C.id})}O&&q.forEach(B,function(ta){ta.minScale=0;ta.maxScale=0});v.graphics&&
0<v.graphics.graphics.length&&(Y=this._createFeatureCollection(v.graphics,v,null,t))&&B.push(Y);v._labels&&t.showLabels&&(Y=this._createFeatureCollection(v._labels,v,null,t))&&B.push(Y);q.forEach(B,function(ta,Ba,Oa){ta._isRefLayer&&(delete ta._isRefLayer,Oa.splice(Ba,1),Oa.push(ta))});return B},_getUrlAndToken:function(v){return{token:v._getToken(),url:v._url?v._url.path:null}},_updateLayerOpacity:function(v){var t=this._colorEvaluator(v);t=q.filter(t,function(M){return J.isArray(M)&&4===M.length});
var F=!0;if(t.length){var B=t[0][3],O;for(O=1;O<t.length;O++)if(B!==t[O][3]){F=!1;break}if(F)for(v.opacity=B/255,O=0;O<t.length;O++)t[O][3]=255}return F},_isFeatureCollectionRequired:function(v,t){if(t&&t.isFeatureReductionActive&&t.isFeatureReductionActive())return!0;var F=!1;if(t=this._getVariable(v,"rotationInfo",!1))F=(F=t.field)&&J.isFunction(F)||t.valueExpression;return v.hasVisualVariables("sizeInfo")||v.hasVisualVariables("colorInfo")||v.hasVisualVariables("opacityInfo")||F},_getVariable:function(v,
t,F){if(v)var B=(v=v.getVisualVariablesForType(t,F))&&v[0];return B},_applyVisualVariables:function(v,t){var F=t.renderer,B=t.graphic,O=t.symbol,M=t.mapResolution,C=t.mapScale,W=O.type;if("textsymbol"!==W&&"shieldlabelsymbol"!==W){var Y=this._getVariable(F,"sizeInfo",!1),R=this._getVariable(F,"colorInfo",!1),S=this._getVariable(F,"opacityInfo",!1);t=this._getVariable(F,"rotationInfo",!1);O instanceof a&&(Y=this._getVariable(F,"sizeInfo","outline")||Y);M=Y?F.getSize(B,{sizeInfo:Y,shape:"simplemarkersymbol"===
W?O.style:null,resolution:M,scale:C}):B.size;null!=M&&("simplemarkersymbol"===W?v.size=H.px2pt(M):"picturemarkersymbol"===W?(C=O.width/O.height*M,v.width=H.px2pt(C),v.height=H.px2pt(M),0!==O.xoffset&&(v.xoffset=H.px2pt(O.xoffset/O.width*C)),0!==O.yoffset&&(v.yoffset=H.px2pt(O.yoffset/O.height*M))):"simplelinesymbol"===W?v.width=H.px2pt(M):v.outline&&(v.outline.width=H.px2pt(M)));R&&(!(O=F.getColor(B,{colorInfo:R}))||"simplemarkersymbol"!==W&&"simplelinesymbol"!==W&&"simplefillsymbol"!==W||(v.color=
m.toJsonColor(O)));S&&(O=F.getOpacity(B,{opacityInfo:S}),null!=O&&v.color&&(v.color[3]=Math.round(255*O)));t&&(F=F.getRotationAngle(B,{rotationInfo:t}))&&(v.angle=-F)}}});w("extend-esri")&&J.setObject("tasks.PrintTask",L,x);return L})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a,e,d,h,y,I,H,u){L=L(l,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(G){this._jobUpdateHandler=J.hitch(this,this._jobUpdateHandler);this._getJobStatus=J.hitch(this,this._getJobStatus);this._getResultDataHandler=
J.hitch(this,this._getResultDataHandler);this._getResultImageHandler=J.hitch(this,this._getResultImageHandler);this._executeHandler=J.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(G){this.updateDelay=G},setProcessSpatialReference:function(G){this.processSpatialReference=G},setOutputSpatialReference:function(G){this._setOutSR(G)},setOutSpatialReference:function(G){this._setOutSR(G)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(G){this.outSpatialReference=this.outputSpatialReference=G},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(G,v,t){for(var F in G){var B=G[F];J.isArray(B)?G[F]=E.toJson(q.map(B,function(O){return this._gpEncode({item:O},!0).item},this)):B instanceof Date&&(G[F]=B.getTime())}return this._encode(G,v,t)},_decode:function(G){var v=G.dataType,
t=new y(G);if(-1!==q.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],v))return t;if("GPLinearUnit"===v)t.value=new a(t.value);else if("GPFeatureRecordSetLayer"===v||"GPRecordSet"===v)t.value=new f(t.value);else if("GPDataFile"===v)t.value=new e(t.value);else if("GPDate"===v)G=t.value,J.isString(G)?t.value=new h({date:G}):t.value=new Date(G);else if("GPRasterData"===v||"GPRasterDataLayer"===v)G=G.value.mapImage,t.value=G?new u(G):new d(t.value);else if(-1!==v.indexOf("GPMultiValue:")){var F=v.split(":")[1];
G=t.value;t.value=q.map(G,function(B){return this._decode({paramName:"_name",dataType:F,value:B}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+t.dataType),t=null;return t},submitJob:function(G,v,t,F,B){var O=this._getOutSR(),M=B.assembly;G=this._gpEncode(J.mixin({},this._url.query,{f:"json","env:outSR":O?O.wkid||E.toJson(O.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||E.toJson(this.processSpatialReference.toJson()):
null},G),null,M&&M[0]);var C=this._jobUpdateHandler,W=this._errorHandler;return n({url:this._url.path+"/submitJob",content:G,callbackParamName:"callback",load:function(Y,R){C(Y,R,!1,v,t,B.dfd)},error:function(Y){W(Y,F,B.dfd)}})},_jobUpdateHandler:function(G,v,t,F,B,O){var M=G.jobId;v=new b(G);this._successHandler([v],"onStatusUpdate",B,t&&O);if(!t)switch(clearTimeout(this._updateTimers[M]),this._updateTimers[M]=null,O&&O.progress(v),G.jobStatus){case b.STATUS_SUBMITTED:case b.STATUS_EXECUTING:case b.STATUS_WAITING:case b.STATUS_NEW:var C=
this._getJobStatus;this._updateTimers[M]=setTimeout(function(){C(M,t,F,B,O)},this.updateDelay);break;default:this._successHandler([v],"onJobComplete",F,O)}},_getJobStatus:function(G,v,t,F,B){var O=this._jobUpdateHandler;n({url:this._url.path+"/jobs/"+G,content:J.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(M,C){O(M,C,v,t,F,B)},error:this._errorHandler})},_getResultDataHandler:function(G,v,t,F,B){try{var O=this._decode(G);this._successHandler([O],"onGetResultDataComplete",
t,B)}catch(M){this._errorHandler(M,F,B)}},getResultData:function(G,v,t,F){var B=this._getResultDataHandler,O=this._errorHandler,M=new K(g._dfdCanceller);M._pendingDfd=n({url:this._url.path+"/jobs/"+G+"/results/"+v,content:J.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(C,W){B(C,W,t,F,M)},error:function(C){O(C,F,M)}});return M},checkJobStatus:function(G,v,t){var F=this._jobUpdateHandler,B=this._errorHandler,O=new K(g._dfdCanceller);O._pendingDfd=
n({url:this._url.path+"/jobs/"+G,content:J.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(M,C){F(M,C,!0,null,v,O)},error:function(M){B(M,t,O)}});return O},cancelJob:function(G,v,t){var F=this._errorHandler,B=new K(g._dfdCanceller);B._pendingDfd=n({url:this._url.path+"/jobs/"+G+"/cancel",content:J.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:J.hitch(this,function(O,M){this._successHandler([O],"onJobCancel",v,B)}),error:function(O){F(O,t,B)}});
return B},execute:function(G,v,t,F){var B=this._getOutSR(),O=F.assembly;G=this._gpEncode(J.mixin({},this._url.query,{f:"json","env:outSR":B?B.wkid||E.toJson(B.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||E.toJson(this.processSpatialReference.toJson()):null},G),null,O&&O[0]);var M=this._executeHandler,C=this._errorHandler;return n({url:this._url.path+"/execute",content:G,callbackParamName:"callback",load:function(W,Y){M(W,Y,v,t,F.dfd)},error:function(W){C(W,
t,F.dfd)}})},_executeHandler:function(G,v,t,F,B){try{var O=G.results,M,C=G.messages;var W=0;for(M=O.length;W<M;W++)O[W]=this._decode(O[W]);W=0;for(M=C.length;W<M;W++)C[W]=new c(C[W]);this._successHandler([O,C],"onExecuteComplete",t,B)}catch(Y){this._errorHandler(Y,F,B)}},_getResultImageHandler:function(G,v,t,F,B){try{var O=this._decode(G);this._successHandler([O],"onGetResultImageComplete",t,B)}catch(M){this._errorHandler(M,F,B)}},getResultImage:function(G,v,t,F,B){var O=this._getResultImageHandler,
M=this._errorHandler;t=this._gpEncode(J.mixin({},this._url.query,{f:"json"},t.toJson()));var C=new K(g._dfdCanceller);C._pendingDfd=n({url:this._url.path+"/jobs/"+G+"/results/"+v,content:t,callbackParamName:"callback",load:function(W,Y){O(W,Y,F,B,C)},error:function(W){M(W,B,C)}});return C},cancelJobStatusUpdates:function(G){clearTimeout(this._updateTimers[G]);this._updateTimers[G]=null},getResultImageLayer:function(G,v,t,F){if(null==v){var B=this._url.path.indexOf("/GPServer/");G=this._url.path.substring(0,
B)+"/MapServer/jobs/"+G}else G=this._url.path+"/jobs/"+G+"/results/"+v;this._url.query&&(G+="?"+x.objectToQuery(this._url.query));v=null==v?new H(G,{imageParameters:t}):new I(G,{imageParameters:t},!0);this.onGetResultImageLayerComplete(v);F&&F(v);return v},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});m._createWrappers(L);
w("extend-esri")&&J.setObject("tasks.Geoprocessor",L,A);return L})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(L,J,q,K,E){L=L(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(w){this.messages=[];J.mixin(this,w);w=this.messages;var x,A=w.length;for(x=0;x<A;x++)w[x]=new E(w[x])},jobId:"",jobStatus:""});J.mixin(L,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",
STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});q("extend-esri")&&J.setObject("tasks.JobInfo",L,K);return L})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(L,J,q,K){L=L(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(E){J.mixin(this,
E)}});J.mixin(L,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});q("extend-esri")&&J.setObject("tasks.GPMessage",L,K);return L})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(L,J,q,K){L=L(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(E){E&&J.mixin(this,E)},distance:0,units:null,toJson:function(){var E={};this.distance&&(E.distance=this.distance);this.units&&(E.units=this.units);return E}});q("extend-esri")&&J.setObject("tasks.LinearUnit",L,K);return L})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(L,J,q,K){L=L(null,{declaredClass:"esri.tasks.DataFile",
constructor:function(E){E&&J.mixin(this,E)},url:null,itemID:null,toJson:function(){var E={};this.url&&(E.url=this.url);this.itemID&&(E.itemID=this.itemID);return E}});q("extend-esri")&&J.setObject("tasks.DataFile",L,K);return L})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(L,J,q,K){L=L(null,{declaredClass:"esri.tasks.RasterData",constructor:function(E){E&&J.mixin(this,E)},url:null,format:null,itemID:null,toJson:function(){var E=
{};this.url&&(E.url=this.url);this.format&&(E.format=this.format);this.itemID&&(E.itemID=this.itemID);return E}});q("extend-esri")&&J.setObject("tasks.RasterData",L,K);return L})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(L,J,q,K,E){L=L(null,{declaredClass:"esri.tasks.Date",constructor:function(w){w&&(w.format&&(this.format=w.format),this.date=q.parse(w.date,{selector:"date",datePattern:this.format}))},date:new Date,
format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:q.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});K("extend-esri")&&J.setObject("tasks.Date",L,E);return L})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(L,J,q,K){L=L(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(E){J.mixin(this,E)}});q("extend-esri")&&J.setObject("tasks.ParameterValue",L,K);return L})},
"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(L,J,q,K,E,w,x){L=L(x,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(A,n){n&&n.imageParameters&&n.imageParameters.extent&&(this.initialExtent=this.fullExtent=n.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=J.hitch(this,this.getImageUrl);
this.loaded=!0;this.onLoad(this)},getImageUrl:function(A,n,g,m){var l=A.spatialReference.wkid;m(this._url.path+"?"+E.objectToQuery(J.mixin(this._params,{f:"image",bbox:q.toJson(A.toJson()),bboxSR:l,imageSR:l,size:n+","+g})))}});K("extend-esri")&&J.setObject("tasks._GPResultImageLayer",L,w);return L})},"esri/tasks/PrintTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(L,J,q,K){L=L(null,{declaredClass:"esri.tasks.PrintTemplate",label:null,exportOptions:{width:800,
height:1100,dpi:96},layoutOptions:null,format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,forceFeatureAttributes:!1,showAttribution:null,showLabels:!0});q("extend-esri")&&J.setObject("tasks.PrintTemplate",L,K);return L})},"dojox/gfx/canvas":function(){define("./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,l,f){function b(R,S,T,Z,qa,
ta,Ba,Oa,Ia,Ra){var Va=S.length,ab=0;if(Ra){var Q=Ra.l/qa;ab=Ra.i}else Q=S[0]/qa;for(;ta<Ba;){if(ta+Q>Ba){var ba={l:(ta+Q-Ba)*qa,i:ab};Q=Ba-ta}ab%2||(R.beginPath(),R.arc(T,Z,qa,ta,ta+Q,Oa),Ia&&R.stroke());ta+=Q;++ab;Q=S[ab%Va]/qa}return ba}function c(R,S,T,Z){var qa=0,ta=0,Ba=0;if(Z){var Oa=Z.l;Ba=Z.i}else Oa=S[0];for(;1>ta;)ta=f.tAtLength(R,Oa),1==ta&&(qa=f.computeLength(R),qa={l:Oa-qa,i:Ba}),R=f.splitBezierAtT(R,ta),Ba%2||T.push(R[0]),R=R[1],++Ba,Oa=S[Ba%S.length];return qa}function a(R,S,T,Z){var qa=
[S.last.x,S.last.y].concat(T),ta=!(R instanceof Array);T=4===T.length?"quadraticCurveTo":"bezierCurveTo";var Ba=[];S=c(qa,S.canvasDash,Ba,Z);for(Z=0;Z<Ba.length;++Z)qa=Ba[Z],ta?(R.moveTo(qa[0],qa[1]),R[T].apply(R,qa.slice(2))):(R.push("moveTo",[qa[0],qa[1]]),R.push(T,qa.slice(2)));return S}function e(R,S,T,Z,qa,ta,Ba){var Oa=0,Ia=0,Ra=0,Va=f.distance(T,Z,qa,ta),ab=0;S=S.canvasDash;var Q=T,ba=Z,ia=!(R instanceof Array);Ba?(Ra=Ba.l,ab=Ba.i):Ra+=S[0];for(;.01<Math.abs(1-Ia);){Ra>Va&&(Oa={l:Ra-Va,i:ab},
Ra=Va);Ia=Ra/Va;Ba=T+(qa-T)*Ia;var ha=Z+(ta-Z)*Ia;ab++%2||(ia?(R.moveTo(Q,ba),R.lineTo(Ba,ha)):(R.push("moveTo",[Q,ba]),R.push("lineTo",[Ba,ha])));Q=Ba;ba=ha;Ra+=S[ab%S.length]}return Oa}var d=L.canvas={},h=null,y=m.multiplyPoint,I=Math.PI,H=2*I,u=I/2;l=J.extend;if(E.global.CanvasRenderingContext2D){E=E.doc.createElement("canvas").getContext("2d");var G="function"==typeof E.setLineDash,v="function"==typeof E.fillText}var t={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,
1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};d.Shape=K("dojox.gfx.canvas.Shape",A.Shape,{_render:function(R){R.save();this._renderTransform(R);this._renderClip(R);this._renderShape(R);this._renderFill(R,!0);this._renderStroke(R,!0);R.restore()},_renderClip:function(R){this.canvasClip&&(this.canvasClip.render(R),R.clip())},_renderTransform:function(R){if("canvasTransform"in this){var S=this.canvasTransform;R.translate(S.dx,S.dy);
R.rotate(S.angle2);R.scale(S.sx,S.sy);R.rotate(S.angle1)}},_renderShape:function(R){},_renderFill:function(R,S){if("canvasFill"in this){var T=this.fillStyle;if("canvasFillImage"in this){var Z=T.width,qa=T.height,ta=this.canvasFillImage.width,Ba=this.canvasFillImage.height,Oa=Math.min(Z==ta?1:Z/ta,qa==Ba?1:qa/Ba),Ia=(Z-Oa*ta)/2,Ra=(qa-Oa*Ba)/2;h.width=Z;h.height=qa;var Va=h.getContext("2d");Va.clearRect(0,0,Z,qa);Va.drawImage(this.canvasFillImage,0,0,ta,Ba,Ia,Ra,Oa*ta,Oa*Ba);this.canvasFill=R.createPattern(h,
"repeat");delete this.canvasFillImage}R.fillStyle=this.canvasFill;S&&("pattern"!==T.type||0===T.x&&0===T.y||R.translate(T.x,T.y),R.fill())}else R.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(R,S){var T=this.strokeStyle;T?(R.strokeStyle=T.color.toString(),R.lineWidth=T.width,R.lineCap=T.cap,"number"==typeof T.join?(R.lineJoin="miter",R.miterLimit=T.join):R.lineJoin=T.join,this.canvasDash?G?(R.setLineDash(this.canvasDash),S&&R.stroke()):this._renderDashedStroke(R,S):S&&R.stroke()):S||(R.strokeStyle=
"rgba(0,0,0,0.0)")},_renderDashedStroke:function(R,S){},getEventSource:function(){return null},on:function(){},connect:function(){},disconnect:function(){},canvasClip:null,setClip:function(R){this.inherited(arguments);var S=R?"width"in R?"rect":"cx"in R?"ellipse":"points"in R?"polyline":"d"in R?"path":null:null;if(R&&!S)return this;this.canvasClip=R?F(S,R):null;this.parent&&this.parent._makeDirty();return this}});var F=function(R,S){switch(R){case "ellipse":return{canvasEllipse:C({shape:S}),render:function(T){return d.Ellipse.prototype._renderShape.call(this,
T)}};case "rect":return{shape:J.delegate(S,{r:0}),render:function(T){return d.Rect.prototype._renderShape.call(this,T)}};case "path":return{canvasPath:B(S),render:function(T){this.canvasPath._renderShape(T)}};case "polyline":return{canvasPolyline:S.points,render:function(T){return d.Polyline.prototype._renderShape.call(this,T)}}}return null},B=function(R){var S=new dojox.gfx.canvas.Path;S.canvasPath=[];S._setPath(R.d);return S},O=function(R,S,T){var Z=R.prototype[S];R.prototype[S]=T?function(){this.parent&&
this.parent._makeDirty();Z.apply(this,arguments);T.call(this);return this}:function(){this.parent&&this.parent._makeDirty();return Z.apply(this,arguments)}};O(d.Shape,"setTransform",function(){this.matrix?this.canvasTransform=L.decompose(this.matrix):delete this.canvasTransform});O(d.Shape,"setFill",function(){var R=this.fillStyle;if(R){if("object"==typeof R&&"type"in R){var S=this.surface.rawNode.getContext("2d");switch(R.type){case "linear":case "radial":var T="linear"==R.type?S.createLinearGradient(R.x1,
R.y1,R.x2,R.y2):S.createRadialGradient(R.cx,R.cy,0,R.cx,R.cy,R.r);q.forEach(R.colors,function(Z){T.addColorStop(Z.offset,L.normalizeColor(Z.color).toString())});break;case "pattern":h||(h=document.createElement("canvas")),S=new Image,this.surface.downloadImage(S,R.src),this.canvasFillImage=S}}else T=R.toString();this.canvasFill=T}else delete this.canvasFill});O(d.Shape,"setStroke",function(){var R=this.strokeStyle;if(R){var S=this.strokeStyle.style.toLowerCase();S in t&&(S=t[S]);if(S instanceof Array){this.canvasDash=
S=S.slice();var T;for(T=0;T<S.length;++T)S[T]*=R.width;if("butt"!=R.cap){for(T=0;T<S.length;T+=2)S[T]-=R.width,1>S[T]&&(S[T]=1);for(T=1;T<S.length;T+=2)S[T]+=R.width}}else delete this.canvasDash}else delete this.canvasDash;this._needsDash=!G&&!!this.canvasDash});O(d.Shape,"setShape");d.Group=K("dojox.gfx.canvas.Group",d.Shape,{constructor:function(){A.Container._init.call(this)},_render:function(R){R.save();this._renderTransform(R);this._renderClip(R);for(var S=0;S<this.children.length;++S)this.children[S]._render(R);
R.restore()},destroy:function(){A.Container.clear.call(this,!0);d.Shape.prototype.destroy.apply(this,arguments)}});d.Rect=K("dojox.gfx.canvas.Rect",[d.Shape,A.Rect],{_renderShape:function(R){var S=this.shape,T=Math.min(S.r,S.height/2,S.width/2),Z=S.x,qa=Z+S.width,ta=S.y;S=ta+S.height;var Ba=Z+T,Oa=qa-T,Ia=ta+T,Ra=S-T;R.beginPath();R.moveTo(Ba,ta);T?(R.arc(Oa,Ia,T,-u,0,!1),R.arc(Oa,Ra,T,0,u,!1),R.arc(Ba,Ra,T,u,I,!1),R.arc(Ba,Ia,T,I,I+u,!1)):(R.lineTo(Oa,ta),R.lineTo(qa,Ra),R.lineTo(Ba,S),R.lineTo(Z,
Ia));R.closePath()},_renderDashedStroke:function(R,S){var T=this.shape,Z=Math.min(T.r,T.height/2,T.width/2),qa=T.x,ta=qa+T.width,Ba=T.y,Oa=Ba+T.height,Ia=qa+Z,Ra=ta-Z,Va=Ba+Z,ab=Oa-Z;Z?(R.beginPath(),T=e(R,this,Ia,Ba,Ra,Ba),S&&R.stroke(),T=b(R,this.canvasDash,Ra,Va,Z,-u,0,!1,S,T),R.beginPath(),T=e(R,this,ta,Va,ta,ab,T),S&&R.stroke(),T=b(R,this.canvasDash,Ra,ab,Z,0,u,!1,S,T),R.beginPath(),T=e(R,this,Ra,Oa,Ia,Oa,T),S&&R.stroke(),T=b(R,this.canvasDash,Ia,ab,Z,u,I,!1,S,T),R.beginPath(),T=e(R,this,qa,
ab,qa,Va,T),S&&R.stroke(),b(R,this.canvasDash,Ia,Va,Z,I,I+u,!1,S,T)):(R.beginPath(),T=e(R,this,Ia,Ba,Ra,Ba),T=e(R,this,Ra,Ba,ta,ab,T),T=e(R,this,ta,ab,Ia,Oa,T),e(R,this,Ia,Oa,qa,Va,T),S&&R.stroke())}});var M=[];(function(){var R=g.curvePI4;M.push(R.s,R.c1,R.c2,R.e);for(var S=45;360>S;S+=45){var T=m.rotateg(S);M.push(y(T,R.c1),y(T,R.c2),y(T,R.e))}})();var C=function(R){var S=[],T=R.shape,Z=m.normalize([m.translate(T.cx,T.cy),m.scale(T.rx,T.ry)]);var qa=y(Z,M[0]);S.push([qa.x,qa.y]);for(T=1;T<M.length;T+=
3){var ta=y(Z,M[T]);var Ba=y(Z,M[T+1]);qa=y(Z,M[T+2]);S.push([ta.x,ta.y,Ba.x,Ba.y,qa.x,qa.y])}if(R._needsDash){qa=[];ta=S[0];for(T=1;T<S.length;++T)Ba=[],c(ta.concat(S[T]),R.canvasDash,Ba),ta=[S[T][4],S[T][5]],qa.push(Ba);R._dashedPoints=qa}return S};d.Ellipse=K("dojox.gfx.canvas.Ellipse",[d.Shape,A.Ellipse],{setShape:function(){this.inherited(arguments);this.canvasEllipse=C(this);return this},setStroke:function(){this.inherited(arguments);G||(this.canvasEllipse=C(this));return this},_renderShape:function(R){var S=
this.canvasEllipse,T;R.beginPath();R.moveTo.apply(R,S[0]);for(T=1;T<S.length;++T)R.bezierCurveTo.apply(R,S[T]);R.closePath()},_renderDashedStroke:function(R,S){var T=this._dashedPoints;R.beginPath();for(var Z=0;Z<T.length;++Z)for(var qa=T[Z],ta=0;ta<qa.length;++ta){var Ba=qa[ta];R.moveTo(Ba[0],Ba[1]);R.bezierCurveTo(Ba[2],Ba[3],Ba[4],Ba[5],Ba[6],Ba[7])}S&&R.stroke()}});d.Circle=K("dojox.gfx.canvas.Circle",[d.Shape,A.Circle],{_renderShape:function(R){var S=this.shape;R.beginPath();R.arc(S.cx,S.cy,
S.r,0,H,1)},_renderDashedStroke:function(R,S){var T=this.shape,Z=0,qa=this.canvasDash.length;for(i=0;Z<H;){var ta=this.canvasDash[i%qa]/T.r;i%2||(R.beginPath(),R.arc(T.cx,T.cy,T.r,Z,Z+ta,0),S&&R.stroke());Z+=ta;++i}}});d.Line=K("dojox.gfx.canvas.Line",[d.Shape,A.Line],{_renderShape:function(R){var S=this.shape;R.beginPath();R.moveTo(S.x1,S.y1);R.lineTo(S.x2,S.y2)},_renderDashedStroke:function(R,S){var T=this.shape;R.beginPath();e(R,this,T.x1,T.y1,T.x2,T.y2);S&&R.stroke()}});d.Polyline=K("dojox.gfx.canvas.Polyline",
[d.Shape,A.Polyline],{setShape:function(){this.inherited(arguments);var R=this.shape.points,S=R[0],T;this.bbox=null;this._normalizePoints();if(R.length)if("number"==typeof S)S=R;else for(S=[],T=0;T<R.length;++T){var Z=R[T];S.push(Z.x,Z.y)}else S=[];this.canvasPolyline=S;return this},_renderShape:function(R){var S=this.canvasPolyline;if(S.length){R.beginPath();R.moveTo(S[0],S[1]);for(var T=2;T<S.length;T+=2)R.lineTo(S[T],S[T+1])}},_renderDashedStroke:function(R,S){var T=this.canvasPolyline,Z=0;R.beginPath();
for(var qa=0;qa<T.length;qa+=2)Z=e(R,this,T[qa],T[qa+1],T[qa+2],T[qa+3],Z);S&&R.stroke()}});d.Image=K("dojox.gfx.canvas.Image",[d.Shape,A.Image],{setShape:function(){this.inherited(arguments);var R=new Image;this.surface.downloadImage(R,this.shape.src);this.canvasImage=R;return this},_renderShape:function(R){var S=this.shape;R.drawImage(this.canvasImage,S.x,S.y,S.width,S.height)}});d.Text=K("dojox.gfx.canvas.Text",[d.Shape,A.Text],{_setFont:function(){this.fontStyle?this.canvasFont=L.makeFontString(this.fontStyle):
delete this.canvasFont},getTextWidth:function(){var R=this.shape,S=0;if(R.text){var T=this.surface.rawNode.getContext("2d");T.save();this._renderTransform(T);this._renderFill(T,!1);this._renderStroke(T,!1);this.canvasFont&&(T.font=this.canvasFont);S=T.measureText(R.text).width;T.restore()}return S},_render:function(R){R.save();this._renderTransform(R);this._renderFill(R,!1);this._renderStroke(R,!1);this._renderShape(R);R.restore()},_renderShape:function(R){var S=this.shape;S.text&&(R.textAlign="middle"===
S.align?"center":S.align,this.canvasFont&&(R.font=this.canvasFont),this.canvasFill&&R.fillText(S.text,S.x,S.y),this.strokeStyle&&(R.beginPath(),R.strokeText(S.text,S.x,S.y),R.closePath()))}});O(d.Text,"setFont");v||d.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var W={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",
Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};d.Path=K("dojox.gfx.canvas.Path",[d.Shape,n.Path],{constructor:function(){this.lastControl={}},setShape:function(){this.canvasPath=[];this._dashedPath=[];return this.inherited(arguments)},setStroke:function(){this.inherited(arguments);G||(this.segmented=!1,this._confirmSegmented());return this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(R){var S=
J.clone(this.last);this[W[R.action]](this.canvasPath,R.action,R.args,this._needsDash?this._dashedPath:null);this.last=S;this.inherited(arguments)},_renderShape:function(R){var S=this.canvasPath;R.beginPath();for(var T=0;T<S.length;T+=2)R[S[T]].apply(R,S[T+1])},_renderDashedStroke:G?function(){}:function(R,S){var T=this._dashedPath;R.beginPath();for(var Z=0;Z<T.length;Z+=2)R[T[Z]].apply(R,T[Z+1]);S&&R.stroke()},_moveToA:function(R,S,T,Z){R.push("moveTo",[T[0],T[1]]);Z&&Z.push("moveTo",[T[0],T[1]]);
for(S=2;S<T.length;S+=2)R.push("lineTo",[T[S],T[S+1]]),Z&&(this._dashResidue=e(Z,this,T[S-2],T[S-1],T[S],T[S+1],this._dashResidue));this.last.x=T[T.length-2];this.last.y=T[T.length-1];this.lastControl={}},_moveToR:function(R,S,T,Z){S="x"in this.last?[this.last.x+=T[0],this.last.y+=T[1]]:[this.last.x=T[0],this.last.y=T[1]];R.push("moveTo",S);Z&&Z.push("moveTo",S);for(S=2;S<T.length;S+=2)R.push("lineTo",[this.last.x+=T[S],this.last.y+=T[S+1]]),Z&&(this._dashResidue=e(Z,this,Z[Z.length-1][0],Z[Z.length-
1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_lineToA:function(R,S,T,Z){for(S=0;S<T.length;S+=2)Z&&(this._dashResidue=e(Z,this,this.last.x,this.last.y,T[S],T[S+1],this._dashResidue)),R.push("lineTo",[T[S],T[S+1]]);this.last.x=T[T.length-2];this.last.y=T[T.length-1];this.lastControl={}},_lineToR:function(R,S,T,Z){for(S=0;S<T.length;S+=2)R.push("lineTo",[this.last.x+=T[S],this.last.y+=T[S+1]]),Z&&(this._dashResidue=e(Z,this,Z[Z.length-1][0],Z[Z.length-1][1],this.last.x,this.last.y,
this._dashResidue));this.lastControl={}},_hLineToA:function(R,S,T,Z){for(S=0;S<T.length;++S)R.push("lineTo",[T[S],this.last.y]),Z&&(this._dashResidue=e(Z,this,Z[Z.length-1][0],Z[Z.length-1][1],T[S],this.last.y,this._dashResidue));this.last.x=T[T.length-1];this.lastControl={}},_hLineToR:function(R,S,T,Z){for(S=0;S<T.length;++S)R.push("lineTo",[this.last.x+=T[S],this.last.y]),Z&&(this._dashResidue=e(Z,this,Z[Z.length-1][0],Z[Z.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl=
{}},_vLineToA:function(R,S,T,Z){for(S=0;S<T.length;++S)R.push("lineTo",[this.last.x,T[S]]),Z&&(this._dashResidue=e(Z,this,Z[Z.length-1][0],Z[Z.length-1][1],this.last.x,T[S],this._dashResidue));this.last.y=T[T.length-1];this.lastControl={}},_vLineToR:function(R,S,T,Z){for(S=0;S<T.length;++S)R.push("lineTo",[this.last.x,this.last.y+=T[S]]),Z&&(this._dashResidue=e(Z,this,Z[Z.length-1][0],Z[Z.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(R,S,T,Z){for(S=
0;S<T.length;S+=6)R.push("bezierCurveTo",T.slice(S,S+6)),Z&&(this._dashResidue=a(Z,this,R[R.length-1],this._dashResidue));this.last.x=T[T.length-2];this.last.y=T[T.length-1];this.lastControl.x=T[T.length-4];this.lastControl.y=T[T.length-3];this.lastControl.type="C"},_curveToR:function(R,S,T,Z){for(S=0;S<T.length;S+=6)R.push("bezierCurveTo",[this.last.x+T[S],this.last.y+T[S+1],this.lastControl.x=this.last.x+T[S+2],this.lastControl.y=this.last.y+T[S+3],this.last.x+T[S+4],this.last.y+T[S+5]]),Z&&(this._dashResidue=
a(Z,this,R[R.length-1],this._dashResidue)),this.last.x+=T[S+4],this.last.y+=T[S+5];this.lastControl.type="C"},_smoothCurveToA:function(R,S,T,Z){for(S=0;S<T.length;S+=4){var qa="C"==this.lastControl.type;R.push("bezierCurveTo",[qa?2*this.last.x-this.lastControl.x:this.last.x,qa?2*this.last.y-this.lastControl.y:this.last.y,T[S],T[S+1],T[S+2],T[S+3]]);Z&&(this._dashResidue=a(Z,this,R[R.length-1],this._dashResidue));this.lastControl.x=T[S];this.lastControl.y=T[S+1];this.lastControl.type="C"}this.last.x=
T[T.length-2];this.last.y=T[T.length-1]},_smoothCurveToR:function(R,S,T,Z){for(S=0;S<T.length;S+=4){var qa="C"==this.lastControl.type;R.push("bezierCurveTo",[qa?2*this.last.x-this.lastControl.x:this.last.x,qa?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+T[S],this.last.y+T[S+1],this.last.x+T[S+2],this.last.y+T[S+3]]);Z&&(this._dashResidue=a(Z,this,R[R.length-1],this._dashResidue));this.lastControl.x=this.last.x+T[S];this.lastControl.y=this.last.y+T[S+1];this.lastControl.type="C";this.last.x+=
T[S+2];this.last.y+=T[S+3]}},_qCurveToA:function(R,S,T,Z){for(S=0;S<T.length;S+=4)R.push("quadraticCurveTo",T.slice(S,S+4));Z&&(this._dashResidue=a(Z,this,R[R.length-1],this._dashResidue));this.last.x=T[T.length-2];this.last.y=T[T.length-1];this.lastControl.x=T[T.length-4];this.lastControl.y=T[T.length-3];this.lastControl.type="Q"},_qCurveToR:function(R,S,T,Z){for(S=0;S<T.length;S+=4)R.push("quadraticCurveTo",[this.lastControl.x=this.last.x+T[S],this.lastControl.y=this.last.y+T[S+1],this.last.x+T[S+
2],this.last.y+T[S+3]]),Z&&(this._dashResidue=a(Z,this,R[R.length-1],this._dashResidue)),this.last.x+=T[S+2],this.last.y+=T[S+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(R,S,T,Z){for(S=0;S<T.length;S+=2){var qa="Q"==this.lastControl.type;R.push("quadraticCurveTo",[this.lastControl.x=qa?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=qa?2*this.last.y-this.lastControl.y:this.last.y,T[S],T[S+1]]);Z&&(this._dashResidue=a(Z,this,R[R.length-1],this._dashResidue));this.lastControl.type=
"Q"}this.last.x=T[T.length-2];this.last.y=T[T.length-1]},_qSmoothCurveToR:function(R,S,T,Z){for(S=0;S<T.length;S+=2){var qa="Q"==this.lastControl.type;R.push("quadraticCurveTo",[this.lastControl.x=qa?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=qa?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+T[S],this.last.y+T[S+1]]);Z&&(this._dashResidue=a(Z,this,R[R.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=T[S];this.last.y+=T[S+1]}},_arcTo:function(R,S,
T,Z){S="a"==S;for(var qa=0;qa<T.length;qa+=7){var ta=T[qa+5],Ba=T[qa+6];S&&(ta+=this.last.x,Ba+=this.last.y);var Oa=g.arcAsBezier(this.last,T[qa],T[qa+1],T[qa+2],T[qa+3]?1:0,T[qa+4]?1:0,ta,Ba);q.forEach(Oa,function(Ia){R.push("bezierCurveTo",Ia)});Z&&(this._dashResidue=a(Z,this,p,this._dashResidue));this.last.x=ta;this.last.y=Ba}this.lastControl={}},_closePath:function(R,S,T,Z){R.push("closePath",[]);Z&&(this._dashResidue=e(Z,this,this.last.x,this.last.y,Z[1][0],Z[1][1],this._dashResidue));this.lastControl=
{}}});q.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),function(R){O(d.Path,R)});d.TextPath=K("dojox.gfx.canvas.TextPath",[d.Shape,n.TextPath],{_renderShape:function(R){},_setText:function(){},_setFont:function(){}});d.Surface=K("dojox.gfx.canvas.Surface",A.Surface,{constructor:function(){A.Container._init.call(this);this.pendingImageCount=0;this.makeDirty()},destroy:function(){A.Container.clear.call(this,!0);this.inherited(arguments)},
setDimensions:function(R,S){this.width=L.normalizedLength(R);this.height=L.normalizedLength(S);if(!this.rawNode)return this;R=!1;this.rawNode.width!=this.width&&(this.rawNode.width=this.width,R=!0);this.rawNode.height!=this.height&&(this.rawNode.height=this.height,R=!0);R&&this.makeDirty();return this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(R){!this.rawNode||!R&&this.pendingImageCount||(R=this.rawNode.getContext("2d"),
R.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(R),"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender))},render:function(R){R.save();for(var S=0;S<this.children.length;++S)this.children[S]._render(R);R.restore()},makeDirty:function(){this.pendingImagesCount||"pendingRender"in this||this._batch||(this.pendingRender=setTimeout(J.hitch(this,this._render),0))},downloadImage:function(R,S){var T=J.hitch(this,this.onImageLoad);!this.pendingImageCount++&&
"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);R.onload=T;R.onerror=T;R.onabort=T;R.src=S},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}});d.createSurface=function(R,S,T){if(!S&&!T){var Z=w.position(R);S=S||Z.w;T=T||Z.h}"number"==typeof S&&(S+="px");"number"==typeof T&&(T+="px");Z=new d.Surface;
R=x.byId(R);var qa=R.ownerDocument.createElement("canvas");qa.width=L.normalizedLength(S);qa.height=L.normalizedLength(T);R.appendChild(qa);Z.rawNode=qa;Z._parent=R;return Z.surface=Z};var Y=A.Container;K={openBatch:function(){++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this._makeDirty();return this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(R){this._makeDirty();return Y.add.apply(this,arguments)},remove:function(R,S){this._makeDirty();
return Y.remove.apply(this,arguments)},clear:function(){this._makeDirty();return Y.clear.apply(this,arguments)},getBoundingBox:Y.getBoundingBox,_moveChildToFront:function(R){this._makeDirty();return Y._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(R){this._makeDirty();return Y._moveChildToBack.apply(this,arguments)}};n={createObject:function(R,S){R=new R;R.surface=this.surface;R.setShape(S);this.add(R);return R}};l(d.Group,K);l(d.Group,A.Creator);l(d.Group,n);l(d.Surface,K);l(d.Surface,
A.Creator);l(d.Surface,n);d.fixTarget=function(R,S){return!0};return d})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),function(L,J,q,K,E,w,x,A,n,g){function m(f,b){for(var c=f.length-1;b<c;)f[b]=f[++b];f.length=c}var l=L.shape={};l.Shape=q("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=
this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(E("gfxRegistry")){var f=l.register(this);this.getUID=function(){return f}}},destroy:function(){E("gfxRegistry")&&l.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},
getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var f=this.getBoundingBox();if(!f)return null;var b=this._getRealMatrix();return[g.multiplyPoint(b,f.x,f.y),g.multiplyPoint(b,f.x+f.width,f.y),g.multiplyPoint(b,f.x+f.width,f.y+f.height),g.multiplyPoint(b,f.x,f.y+f.height)]},getEventSource:function(){return this.rawNode},setClip:function(f){this.clip=f},getClip:function(){return this.clip},setShape:function(f){this.shape=L.makeParameters(this.shape,f);this.bbox=null;
return this},setFill:function(f){if(!f)return this.fillStyle=null,this;var b=null;if("object"==typeof f&&"type"in f)switch(f.type){case "linear":b=L.makeParameters(L.defaultLinearGradient,f);break;case "radial":b=L.makeParameters(L.defaultRadialGradient,f);break;case "pattern":b=L.makeParameters(L.defaultPattern,f)}else b=L.normalizeColor(f);this.fillStyle=b;return this},setStroke:function(f){if(!f)return this.strokeStyle=null,this;if("string"==typeof f||J.isArray(f)||f instanceof n)f={color:f};f=
this.strokeStyle=L.makeParameters(L.defaultStroke,f);f.color=L.normalizeColor(f.color);return this},setTransform:function(f){this.matrix=g.clone(f?g.normalize(f):g.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var f=this.getParent();f&&(f._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var f=this.getParent();f&&(f._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},
applyRightTransform:function(f){return f?this.setTransform([this.matrix,f]):this},applyLeftTransform:function(f){return f?this.setTransform([f,this.matrix]):this},applyTransform:function(f){return f?this.setTransform([this.matrix,f]):this},removeShape:function(f){this.parent&&this.parent.remove(this,f);return this},_setParent:function(f,b){this.parent=f;return this._updateParentMatrix(b)},_updateParentMatrix:function(f){this.parentMatrix=f?g.clone(f):null;return this._applyTransform()},_getRealMatrix:function(){for(var f=
this.matrix,b=this.parent;b;)b.matrix&&(f=g.multiply(b.matrix,f)),b=b.parent;return f}});l._eventsProcessing={on:function(f,b){return w(this.getEventSource(),f,l.fixCallback(this,L.fixTarget,b))},connect:function(f,b,c){"on"==f.substring(0,2)&&(f=f.substring(2));return this.on(f,c?J.hitch(b,c):b)},disconnect:function(f){return f.remove()}};l.fixCallback=function(f,b,c,a){a||(a=c,c=null);if(J.isString(a)){c=c||K.global;if(!c[a])throw['dojox.gfx.shape.fixCallback: scope["',a,'"] is null (scope\x3d"',
c,'")'].join("");return function(e){return b(e,f)?c[a].apply(c,arguments||[]):void 0}}return c?function(e){return b(e,f)?a.apply(c,arguments||[]):void 0}:function(e){return b(e,f)?a.apply(c,arguments):void 0}};J.extend(l.Shape,l._eventsProcessing);l.Container={_init:function(){this.children=[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(f){var b=f.getParent();b&&b.remove(f,!0);this.children.push(f);return f._setParent(this,this._getRealMatrix())},
remove:function(f,b){for(var c=0;c<this.children.length;++c)if(this.children[c]==f){b||(f.parent=null,f.parentMatrix=null);m(this.children,c);break}return this},clear:function(f){for(var b,c=0;c<this.children.length;++c)b=this.children[c],b.parent=null,b.parentMatrix=null,f&&b.destroy();this.children=[];return this},getBoundingBox:function(){if(this.children){var f=null;x.forEach(this.children,function(b){var c=b.getBoundingBox();c&&((b=b.getTransform())&&(c=g.multiplyRectangle(b,c)),f?(f.x=Math.min(f.x,
c.x),f.y=Math.min(f.y,c.y),f.endX=Math.max(f.endX,c.x+c.width),f.endY=Math.max(f.endY,c.y+c.height)):f={x:c.x,y:c.y,endX:c.x+c.width,endY:c.y+c.height})});f&&(f.width=f.endX-f.x,f.height=f.endY-f.y);return f}return null},_moveChildToFront:function(f){for(var b=0;b<this.children.length;++b)if(this.children[b]==f){m(this.children,b);this.children.push(f);break}return this},_moveChildToBack:function(f){for(var b=0;b<this.children.length;++b)if(this.children[b]==f){m(this.children,b);this.children.unshift(f);
break}return this}};l.Surface=q("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){x.forEach(this._nodes,A.destroy);this._nodes=[];x.forEach(this._events,function(f){f&&f.remove()});this._events=[];this.rawNode=null;if(E("ie"))for(;this._parent.lastChild;)A.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},
isLoaded:!0,onLoad:function(f){},whenLoaded:function(f,b){var c=J.hitch(f,b);if(this.isLoaded)c(this);else w.once(this,"load",function(a){c(a)})}});J.extend(l.Surface,l._eventsProcessing);l.Rect=q("dojox.gfx.shape.Rect",l.Shape,{constructor:function(f){this.shape=L.getDefault("Rect");this.rawNode=f},getBoundingBox:function(){return this.shape}});l.Ellipse=q("dojox.gfx.shape.Ellipse",l.Shape,{constructor:function(f){this.shape=L.getDefault("Ellipse");this.rawNode=f},getBoundingBox:function(){if(!this.bbox){var f=
this.shape;this.bbox={x:f.cx-f.rx,y:f.cy-f.ry,width:2*f.rx,height:2*f.ry}}return this.bbox}});l.Circle=q("dojox.gfx.shape.Circle",l.Shape,{constructor:function(f){this.shape=L.getDefault("Circle");this.rawNode=f},getBoundingBox:function(){if(!this.bbox){var f=this.shape;this.bbox={x:f.cx-f.r,y:f.cy-f.r,width:2*f.r,height:2*f.r}}return this.bbox}});l.Line=q("dojox.gfx.shape.Line",l.Shape,{constructor:function(f){this.shape=L.getDefault("Line");this.rawNode=f},getBoundingBox:function(){if(!this.bbox){var f=
this.shape;this.bbox={x:Math.min(f.x1,f.x2),y:Math.min(f.y1,f.y2),width:Math.abs(f.x2-f.x1),height:Math.abs(f.y2-f.y1)}}return this.bbox}});l.Polyline=q("dojox.gfx.shape.Polyline",l.Shape,{constructor:function(f){this.shape=L.getDefault("Polyline");this.rawNode=f},setShape:function(f,b){f&&f instanceof Array?(this.inherited(arguments,[{points:f}]),b&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[f]);return this},_normalizePoints:function(){var f=
this.shape.points,b=f&&f.length;if(b&&"number"==typeof f[0]){for(var c=[],a=0;a<b;a+=2)c.push({x:f[a],y:f[a+1]});this.shape.points=c}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var f=this.shape.points,b=f.length,c=f[0],a=c.x,e=c.y,d=c.x,h=c.y,y=1;y<b;++y)c=f[y],a>c.x&&(a=c.x),d<c.x&&(d=c.x),e>c.y&&(e=c.y),h<c.y&&(h=c.y);this.bbox={x:a,y:e,width:d-a,height:h-e}}return this.bbox}});l.Image=q("dojox.gfx.shape.Image",l.Shape,{constructor:function(f){this.shape=L.getDefault("Image");
this.rawNode=f},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});l.Text=q(l.Shape,{constructor:function(f){this.fontStyle=null;this.shape=L.getDefault("Text");this.rawNode=f},getFont:function(){return this.fontStyle},setFont:function(f){this.fontStyle="string"==typeof f?L.splitFontString(f):L.makeParameters(L.defaultFont,f);this._setFont();return this},getBoundingBox:function(){var f=null;this.getShape().text&&(f=L._base._computeTextBoundingBox(this));
return f}});l.Creator={createShape:function(f){switch(f.type){case L.defaultPath.type:return this.createPath(f);case L.defaultRect.type:return this.createRect(f);case L.defaultCircle.type:return this.createCircle(f);case L.defaultEllipse.type:return this.createEllipse(f);case L.defaultLine.type:return this.createLine(f);case L.defaultPolyline.type:return this.createPolyline(f);case L.defaultImage.type:return this.createImage(f);case L.defaultText.type:return this.createText(f);case L.defaultTextPath.type:return this.createTextPath(f)}return null},
createGroup:function(){return this.createObject(L.Group)},createRect:function(f){return this.createObject(L.Rect,f)},createEllipse:function(f){return this.createObject(L.Ellipse,f)},createCircle:function(f){return this.createObject(L.Circle,f)},createLine:function(f){return this.createObject(L.Line,f)},createPolyline:function(f){return this.createObject(L.Polyline,f)},createImage:function(f){return this.createObject(L.Image,f)},createText:function(f){return this.createObject(L.Text,f)},createPath:function(f){return this.createObject(L.Path,
f)},createTextPath:function(f){return this.createObject(L.TextPath,{}).setText(f)},createObject:function(f,b){return null}};return l})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang","dojo/_base/declare","./matrix","./shape"],function(L,J,q,K,E){E=q("dojox.gfx.path.Path",E.Shape,{constructor:function(w){this.shape=J.clone(L.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=w;this.segmented=!1},setAbsoluteMode:function(w){this._confirmSegmented();
this.absolute="string"==typeof w?"absolute"==w:w;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var w=this.bbox,x=this._getRealMatrix();this.bbox=null;for(var A=0,n=this.segments.length;A<n;++A)this._updateWithSegment(this.segments[A],
x);x=this.bbox;this.bbox=w;return this.tbbox=x?[{x:x.l,y:x.t},{x:x.r,y:x.t},{x:x.r,y:x.b},{x:x.l,y:x.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(w,x,A){A&&(x=K.multiplyPoint(A,w,x),w=x.x,x=x.y);this.bbox&&"l"in this.bbox?(this.bbox.l>w&&(this.bbox.l=w),this.bbox.r<w&&(this.bbox.r=w),this.bbox.t>x&&(this.bbox.t=x),this.bbox.b<x&&(this.bbox.b=x)):
this.bbox={l:w,b:x,r:w,t:x}},_updateWithSegment:function(w,x){var A=w.args,n=A.length,g;switch(w.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(g=0;g<n;g+=2)this._updateBBox(A[g],A[g+1],x);this.last.x=A[n-2];this.last.y=A[n-1];this.absolute=!0;break;case "H":for(g=0;g<n;++g)this._updateBBox(A[g],this.last.y,x);this.last.x=A[n-1];this.absolute=!0;break;case "V":for(g=0;g<n;++g)this._updateBBox(this.last.x,A[g],x);this.last.y=A[n-1];this.absolute=!0;break;case "m":g=0;"x"in this.last||
(this._updateBBox(this.last.x=A[0],this.last.y=A[1],x),g=2);for(;g<n;g+=2)this._updateBBox(this.last.x+=A[g],this.last.y+=A[g+1],x);this.absolute=!1;break;case "l":case "t":for(g=0;g<n;g+=2)this._updateBBox(this.last.x+=A[g],this.last.y+=A[g+1],x);this.absolute=!1;break;case "h":for(g=0;g<n;++g)this._updateBBox(this.last.x+=A[g],this.last.y,x);this.absolute=!1;break;case "v":for(g=0;g<n;++g)this._updateBBox(this.last.x,this.last.y+=A[g],x);this.absolute=!1;break;case "c":for(g=0;g<n;g+=6)this._updateBBox(this.last.x+
A[g],this.last.y+A[g+1],x),this._updateBBox(this.last.x+A[g+2],this.last.y+A[g+3],x),this._updateBBox(this.last.x+=A[g+4],this.last.y+=A[g+5],x);this.absolute=!1;break;case "s":case "q":for(g=0;g<n;g+=4)this._updateBBox(this.last.x+A[g],this.last.y+A[g+1],x),this._updateBBox(this.last.x+=A[g+2],this.last.y+=A[g+3],x);this.absolute=!1;break;case "A":for(g=0;g<n;g+=7)this._updateBBox(A[g+5],A[g+6],x);this.last.x=A[n-2];this.last.y=A[n-1];this.absolute=!0;break;case "a":for(g=0;g<n;g+=7)this._updateBBox(this.last.x+=
A[g+5],this.last.y+=A[g+6],x);this.absolute=!1}w=[w.action];for(g=0;g<n;++g)w.push(L.formatNumber(A[g],!0));if("string"==typeof this.shape.path)this.shape.path+=w.join("");else for(g=0,n=w.length;g<n;++g)this.shape.path.push(w[g])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(w,x){this.tbbox=null;var A=this._validSegments[w.toLowerCase()];"number"==typeof A&&(A?x.length>=A&&(w={action:w,args:x.slice(0,x.length-x.length%A)},this.segments.push(w),this._updateWithSegment(w)):
(w={action:w,args:[]},this.segments.push(w),this._updateWithSegment(w)))},_collectArgs:function(w,x){for(var A=0;A<x.length;++A){var n=x[A];"boolean"==typeof n?w.push(n?1:0):"number"==typeof n?w.push(n):n instanceof Array?this._collectArgs(w,n):"x"in n&&"y"in n&&w.push(n.x,n.y)}},moveTo:function(){this._confirmSegmented();var w=[];this._collectArgs(w,arguments);this._pushSegment(this.absolute?"M":"m",w);return this},lineTo:function(){this._confirmSegmented();var w=[];this._collectArgs(w,arguments);
this._pushSegment(this.absolute?"L":"l",w);return this},hLineTo:function(){this._confirmSegmented();var w=[];this._collectArgs(w,arguments);this._pushSegment(this.absolute?"H":"h",w);return this},vLineTo:function(){this._confirmSegmented();var w=[];this._collectArgs(w,arguments);this._pushSegment(this.absolute?"V":"v",w);return this},curveTo:function(){this._confirmSegmented();var w=[];this._collectArgs(w,arguments);this._pushSegment(this.absolute?"C":"c",w);return this},smoothCurveTo:function(){this._confirmSegmented();
var w=[];this._collectArgs(w,arguments);this._pushSegment(this.absolute?"S":"s",w);return this},qCurveTo:function(){this._confirmSegmented();var w=[];this._collectArgs(w,arguments);this._pushSegment(this.absolute?"Q":"q",w);return this},qSmoothCurveTo:function(){this._confirmSegmented();var w=[];this._collectArgs(w,arguments);this._pushSegment(this.absolute?"T":"t",w);return this},arcTo:function(){this._confirmSegmented();var w=[];this._collectArgs(w,arguments);this._pushSegment(this.absolute?"A":
"a",w);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var w=this.shape.path;this.shape.path=[];this._setPath(w);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(w){w=J.isArray(w)?w:w.match(L.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(w){for(var x="",A=[],n=w.length,g=0;g<n;++g){var m=w[g],l=parseFloat(m);isNaN(l)?(x&&this._pushSegment(x,
A),A=[],x=m):A.push(l)}this._pushSegment(x,A)}},setShape:function(w){this.inherited(arguments,["string"==typeof w?{path:w}:w]);this.segmented=!1;this.segments=[];L.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});q=q("dojox.gfx.path.TextPath",E,{constructor:function(w){"text"in this||(this.text=J.clone(L.defaultTextPath));"fontStyle"in this||(this.fontStyle=J.clone(L.defaultFont))},getText:function(){return this.text},setText:function(w){this.text=L.makeParameters(this.text,
"string"==typeof w?{text:w}:w);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(w){this.fontStyle="string"==typeof w?L.splitFontString(w):L.makeParameters(L.defaultFont,w);this._setFont();return this}});return L.path={Path:E,TextPath:q}})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],function(L,J,q){function K(g){var m=Math.cos(g);g=Math.sin(g);var l={x:m+4/3*(1-m),y:g-4/3*m*(1-m)/g};return{s:{x:m,y:-g},c1:{x:l.x,y:-l.y},c2:l,e:{x:m,
y:g}}}var E=2*Math.PI,w=Math.PI/4,x=Math.PI/8,A=w+x,n=K(x);return L.arc={unitArcAsBezier:K,curvePI4:n,arcAsBezier:function(g,m,l,f,b,c,a,e){b=!!b;c=!!c;var d=q._degToRad(f);f=m*m;var h=l*l,y=q.multiplyPoint(q.rotate(-d),{x:(g.x-a)/2,y:(g.y-e)/2}),I=y.x*y.x,H=y.y*y.y;f=Math.sqrt((f*h-f*H-h*I)/(f*H+h*I));isNaN(f)&&(f=0);f={x:f*m*y.y/l,y:-f*l*y.x/m};b==c&&(f={x:-f.x,y:-f.y});f=q.multiplyPoint([q.translate((g.x+a)/2,(g.y+e)/2),q.rotate(d)],f);m=q.normalize([q.translate(f.x,f.y),q.rotate(d),q.scale(m,
l)]);f=q.invert(m);g=q.multiplyPoint(f,g);e=q.multiplyPoint(f,a,e);a=Math.atan2(g.y,g.x);f=a-Math.atan2(e.y,e.x);c&&(f=-f);0>f?f+=E:f>E&&(f-=E);l=x;e=n;l=c?l:-l;g=[];for(b=f;0<b;b-=w)b<A&&(l=b/2,e=K(l),l=c?l:-l,b=0),y=q.normalize([m,q.rotate(a+l)]),c?(f=q.multiplyPoint(y,e.c1),d=q.multiplyPoint(y,e.c2),y=q.multiplyPoint(y,e.e)):(f=q.multiplyPoint(y,e.c2),d=q.multiplyPoint(y,e.c1),y=q.multiplyPoint(y,e.s)),g.push([f.x,f.y,d.x,d.y,y.x,y.y]),a+=2*l;return g}}})},"dojox/gfx/decompose":function(){define(["./_base",
"dojo/_base/lang","./matrix"],function(L,J,q){function K(n,g){return Math.abs(n-g)<=1E-6*(Math.abs(n)+Math.abs(g))}function E(n,g,m,l){if(!isFinite(n))return m;if(!isFinite(m))return n;g=Math.abs(g);l=Math.abs(l);return(g*n+l*m)/(g+l)}function w(n){n=q.normalize(n);var g=-n.xx-n.yy,m=n.xx*n.yy-n.xy*n.yx,l=Math.sqrt(g*g-4*m);g=-(g+(0>g?-l:l))/2;m/=g;l=n.xy/(g-n.xx);var f=1,b=n.xy/(m-n.xx),c=1;K(g,m)&&(l=1,b=f=0,c=1);isFinite(l)||(l=1,f=(g-n.xx)/n.xy,isFinite(f)||(l=(g-n.yy)/n.yx,f=1,isFinite(l)||(l=
1,f=n.yx/(g-n.yy))));isFinite(b)||(b=1,c=(m-n.xx)/n.xy,isFinite(c)||(b=(m-n.yy)/n.yx,c=1,isFinite(b)||(b=1,c=n.yx/(m-n.yy))));n=Math.sqrt(l*l+f*f);var a=Math.sqrt(b*b+c*c);isFinite(l/=n)||(l=0);isFinite(f/=n)||(f=0);isFinite(b/=a)||(b=0);isFinite(c/=a)||(c=0);return{value1:g,value2:m,vector1:{x:l,y:f},vector2:{x:b,y:c}}}function x(n,g){var m=0>n.xx*n.yy||0<n.xy*n.yx?-1:1,l=g.angle1=(Math.atan2(n.yx,n.yy)+Math.atan2(-m*n.xy,m*n.xx))/2;m=Math.cos(l);l=Math.sin(l);g.sx=E(n.xx/m,m,-n.xy/l,l);g.sy=E(n.yy/
m,m,n.yx/l,l);return g}function A(n,g){var m=0>n.xx*n.yy||0<n.xy*n.yx?-1:1,l=g.angle2=(Math.atan2(m*n.yx,m*n.xx)+Math.atan2(-n.xy,n.yy))/2;m=Math.cos(l);l=Math.sin(l);g.sx=E(n.xx/m,m,n.yx/l,l);g.sy=E(n.yy/m,m,-n.xy/l,l);return g}return L.decompose=function(n){var g=q.normalize(n);n={dx:g.dx,dy:g.dy,sx:1,sy:1,angle1:0,angle2:0};if(K(g.xy,0)&&K(g.yx,0))return J.mixin(n,{sx:g.xx,sy:g.yy});if(K(g.xx*g.yx,-g.xy*g.yy))return x(g,n);if(K(g.xx*g.xy,-g.yx*g.yy))return A(g,n);var m=new q.Matrix2D(g);var l=
J.mixin(m,{dx:0,dy:0,xy:m.yx,yx:m.xy});m=w([g,l]);l=w([l,g]);m=new q.Matrix2D({xx:m.vector1.x,xy:m.vector2.x,yx:m.vector1.y,yy:m.vector2.y});l=new q.Matrix2D({xx:l.vector1.x,xy:l.vector1.y,yx:l.vector2.x,yy:l.vector2.y});g=new q.Matrix2D([q.invert(m),g,q.invert(l)]);x(l,n);g.xx*=n.sx;g.yy*=n.sy;A(m,n);g.xx*=n.sx;g.yy*=n.sy;return J.mixin(n,{sx:g.xx,sy:g.yy})}})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(L){L=L.bezierutils={};L.tAtLength=function(x,A){var n=0,g=6==x.length,m=0,
l=0,f=g?K:w,b=function(c,a){for(var e=0,d=0;d<c.length-2;d+=2)e+=q(c[d],c[d+1],c[d+2],c[d+3]);d=g?q(x[0],x[1],x[4],x[5]):q(x[0],x[1],x[6],x[7]);e-d>a||m+e>A+a?(++l,c=f(c,.5),b(c[0],a),Math.abs(m-A)<=a||b(c[1],a)):(m+=e,n+=1/(1<<l))};A&&b(x,.5);return n};var J=L.computeLength=function(x){for(var A=6==x.length,n=0,g=0;g<x.length-2;g+=2)n+=q(x[g],x[g+1],x[g+2],x[g+3]);g=A?q(x[0],x[1],x[4],x[5]):q(x[0],x[1],x[6],x[7]);return.1<n-g?(x=A?K(x,.5):E(x,.5),n=J(x[0],A),n+=J(x[1],A)):n},q=L.distance=function(x,
A,n,g){return Math.sqrt((n-x)*(n-x)+(g-A)*(g-A))},K=function(x,A){var n=1-A,g=n*n,m=A*A,l=x[0],f=x[1],b=x[2],c=x[3],a=x[4];x=x[5];var e=g*l+2*n*A*b+m*a;g=g*f+2*n*A*c+m*x;return[[l,f,n*l+A*b,n*f+A*c,e,g],[e,g,n*b+A*a,n*c+A*x,a,x]]},E=function(x,A){var n=1-A,g=n*n,m=g*n,l=A*A,f=l*A,b=x[0],c=x[1],a=x[2],e=x[3],d=x[4],h=x[5],y=x[6];x=x[7];var I=m*b+3*g*A*a+3*n*l*d+f*y;m=m*c+3*g*A*e+3*n*l*h+f*x;return[[b,c,n*b+A*a,n*c+A*e,g*b+2*n*A*a+l*d,g*c+2*n*A*e+l*h,I,m],[I,m,g*a+2*n*A*d+l*y,g*e+2*n*A*h+l*x,n*d+A*
y,n*h+A*x,y,x]]},w=L.splitBezierAtT=function(x,A){return 6==x.length?K(x,A):E(x,A)};return L})},"dojox/json/query":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojox","dojo/_base/array"],function(L,J,q){J.getObject("json",!0,q);q.json._slice=function(K,E,w,x){var A=K.length,n=[];w=w||A;E=0>E?Math.max(0,E+A):Math.min(A,E);for(w=0>w?Math.max(0,w+A):Math.min(A,w);E<w;E+=x)n.push(K[E]);return n};q.json._find=function(K,E){function w(n){E&&(!0!==E||n instanceof Array?n[E]&&x.push(n[E]):x.push(n));
for(var g in n){var m=n[g];E?m&&"object"==typeof m&&w(m):x.push(m)}}var x=[];if(E instanceof Array){if(1==E.length)return K[E[0]];for(var A=0;A<E.length;A++)x.push(K[E[A]])}else w(K);return x};q.json._distinctFilter=function(K,E){for(var w=[],x={},A=0,n=K.length;A<n;++A){var g=K[A];E(g,A,K)&&("object"==typeof g&&g?g.__included||(g.__included=!0,w.push(g)):x[g+typeof g]||(x[g+typeof g]=!0,w.push(g)))}A=0;for(n=w.length;A<n;++A)w[A]&&delete w[A].__included;return w};return q.json.query=function(K,E){function w(l,
f,b,c,a,e,d,h){return A[h].match(/[\*\?]/)||"~"==d?"/^"+A[h].substring(1,A[h].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+("~"==d?"$/i":"$/")+".test("+f+")":l}var x=0,A=[];K=K.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(l){x+="["==l?1:"]"==l?-1:0;return"]"==l&&0<x?"`]":'"'==l.charAt(0)||"'"==l.charAt(0)?"`"+(A.push(l)-1):l});var n="";K.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");
});K=K.replace(/([^<>=]=)([^=])/g,"$1\x3d$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(l){return"."==l.charAt(0)?l:"@"==l?"$obj":(l.match(/:|^(\$|Math|true|false|null)$/)?"":"$obj.")+l}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(l,f,b){return(f=l.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?(b="",l.match(/^\./)&&(n="dojox.json._find("+n,b=",true)"),n=(f[1].match(/=/)?"dojo.map":f[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter")+"("+n,b+",function($obj){return "+
f[2]+"})"):(f=l.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+f[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(c,a,e){return"var av\x3d "+e.replace(/\$obj/,"a")+",bv\x3d "+e.replace(/\$obj/,"b")+";if(av\x3ebv||bv\x3d\x3dnull){return "+("/"==a?1:-1)+";}\nif(bv\x3eav||av\x3d\x3dnull){return "+("/"==a?-1:1)+";}\n"})+"return 0;})":(f=l.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?(n="dojox.json._slice("+n,","+(f[1]||0)+","+(f[2]||0)+","+(f[3]||1)+")"):l.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?
(n="dojox.json._find("+n,("."==l.charAt(1)?",'"+b+"'":l.match(/,/)?","+l:"")+")"):l}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,w).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(l,f,b,c,a,e,d,h){return w(l,c,a,e,d,h,b,f)});K=n+("$"==K.charAt(0)?"":"$")+K.replace(/`([0-9]+|\])/g,function(l,f){return"]"==f?"]":A[f]});for(var g=eval("1\x26\x26function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj\x3d$;return "+K+"}"),m=0;m<
arguments.length-1;m++)arguments[m]=arguments[m+1];return E?g.apply(this,arguments):g}})},"dojox/main":function(){define(["dojo/_base/kernel"],function(L){return L.dojox})},"esri/tasks/PrintParameters":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(L,J,q,K){L=L(null,{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,extraParameters:null});q("extend-esri")&&J.setObject("tasks.PrintParameters",L,K);return L})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a,e,d,h,y,I){var H=J(f,{declaredClass:"esri.toolbars.Edit",constructor:function(u,G){this._map=u;this._tool=0;if(this._map.loaded)this._scratchGL=u.graphics;else var v=K.connect(this._map,"onLoad",this,function(){K.disconnect(v);v=null;this._scratchGL=this._map.graphics});u=x("esri-mobile");this._defaultOptions=q.mixin({vertexSymbol:new d(d.STYLE_CIRCLE,u?20:12,new h(h.STYLE_SOLID,new w([0,0,0,.5]),1),new w([128,128,128])),ghostVertexSymbol:new d(d.STYLE_CIRCLE,
u?18:10,new h(h.STYLE_SOLID,new w([0,0,0,.5]),1),new w([255,255,255,.75])),ghostLineSymbol:new h(h.STYLE_DOT,new w([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:u?24:16,boxLineSymbol:new h(h.STYLE_DASH,new w([64,64,64]),1),boxHandleSymbol:new d(d.STYLE_SQUARE,u?16:9,new h(h.STYLE_SOLID,new w([0,0,0,.5]),1),new w([255,255,255,.75])),textAnchorSymbol:new d(d.STYLE_CIRCLE,10,null,new w([255,0,0]))},G||{})},activate:function(u,G,v){this.deactivate();this._graphic=G;this._options=
q.mixin(q.mixin({},this._defaultOptions),v||{});var t=H.MOVE;v=H.EDIT_VERTICES;var F=H.SCALE,B=H.ROTATE,O=H.EDIT_TEXT,M=!1,C=!1,W=!1,Y=this._map,R=Y.spatialReference,S=G.geometry.spatialReference;this._geo=!(!R||!S||R.equals(S)||!R.isWebMercator()||4326!==S.wkid);this._isTextPoint=this._prepareTextSymbolEditing(G,u);(u&t)===t&&(M=this._enableMove(G));t=(u&F)===F;B=(u&B)===B;if(t||B)W=this._enableBoxEditing(G,t,B);(u&v)===v&&(C=this._enableVertexEditing(G));(u&O)===O&&this._enableTextEditing(G);if(!(M||
C||W))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=u)this._mapPanEndHandle=K.connect(Y,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=K.connect(Y,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,G);Y.snappingManager&&(M||C)&&Y.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var u=this._tool,G=this._graphic;if(u){var v=
!!this._modified;this._clear();K.disconnect(this._mapPanEndHandle);K.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(u,G,{isModified:v});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(u,G){},onDeactivate:function(u,G,v){},
onGraphicMoveStart:function(u){},onGraphicFirstMove:function(u){this._modified=!0},onGraphicMove:function(u,G){},onGraphicMoveStop:function(u,G){},onGraphicClick:function(u,G){},onVertexMoveStart:function(u,G){},onVertexFirstMove:function(u,G){this._modified=!0},onVertexMove:function(u,G,v){},onVertexMoveStop:function(u,G,v){},onVertexAdd:function(u,G){this._modified=!0},onVertexClick:function(u,G){},onVertexMouseOver:function(u,G){},onVertexMouseOut:function(u,G){},onVertexDelete:function(u,G){this._modified=
!0},onTextEditStart:function(u,G){},onTextEditEnd:function(u){},onScaleStart:function(u){},onScaleFirstMove:function(u){this._modified=!0},onScale:function(u,G){},onScaleStop:function(u,G){},onRotateStart:function(u){},onRotateFirstMove:function(u){this._modified=!0},onRotate:function(u,G){},onRotateStop:function(u,G){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(u,G){if("point"===u.geometry.type||"multipoint"===u.geometry.type){var v=u.getLayer(),t=v.renderer;v=u.symbol||v._getSymbol(u);!v&&(t.hasVisualVariables("sizeInfo",!1)||t.hasVisualVariables("colorInfo",!1)||t.hasVisualVariables("opacityInfo",!1))&&t.addBreak&&
t.infos&&1===t.infos.length&&(v=t.infos[0].symbol||t.defaultSymbol);if(v&&"textsymbol"===v.type){if((G&H.SCALE)===H.SCALE||(G&H.ROTATE)===H.ROTATE||(G&H.EDIT_TEXT)===H.EDIT_TEXT){u.setSymbol(new y(v.toJson()));var F=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(u),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){F._boxEditor&&F._boxEditor.refresh()})):
L(["../dijit/SymbolEditor"],function(B){if(!F._textSymbolEditor){var O=F._options.textSymbolEditorHolder?A.create("div",null,F._options.textSymbolEditorHolder):A.create("div",null,F._map.root);F._textSymbolEditor=new B({graphic:u},O);B=F._textSymbolEditor.domNode.parentNode.id;n.set(F._textSymbolEditor.domNode,{position:"map_root"===B?"absolute":"relative",left:"map_root"===B?F._map.width/2-100+"px":"5px",top:"20px","z-index":50});F._textSymbolEditor.startup();F._textSymbolEditor.createForm(u);F._textSymbolEditor.show();
F._textSymbolEditor.on("symbol-change",function(){F._boxEditor&&F._boxEditor.refresh()})}})}if((G&H.MOVE)===H.MOVE||(G&H.ROTATE)===H.ROTATE||(G&H.SCALE)===H.SCALE)this._textAnchor=new I(u.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(u){var G=this._map;switch(u.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new c(u,G,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(u){var G=
this._map;switch(u.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=a.create(u,G,this),!0}return!1},_enableBoxEditing:function(u,G,v){var t=this._map,F=u.geometry.type;return"polyline"===F||"polygon"===F||this._isTextPoint?(this._boxEditor=new b(u,t,this,G,v,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(u){return this._isTextPoint?(this._textEditor=new e(u,this._map,this),K.connect(this._textEditor,"onEditStart",q.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var u=this._graphicMover;u&&(u.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var u=this._vertexEditor;u&&(u.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var u=this._boxEditor;u&&(u.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(u,G,v){v&&this._refreshMoveables()},_refreshMoveables:function(u){var G=E.filter([this._graphicMover,this._vertexEditor,this._boxEditor],m.isDefined);E.forEach(G,function(v){v.refresh(u)})},_beginOperation:function(u){E.forEach(this._getAffectedTools(u),function(G){G.suspend()})},_endOperation:function(u){E.forEach(this._getAffectedTools(u),function(G){G.resume()})},_getAffectedTools:function(u){var G=[];switch(u){case "MOVE":G=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":G=[this._boxEditor];break;case "BOX":G=[this._vertexEditor]}return G=E.filter(G,m.isDefined)}});q.mixin(H,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});x("extend-esri")&&q.setObject("toolbars.Edit",H,g);return H})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(L,J,q,K,E){L=L([E],{declaredClass:"esri.toolbars._Toolbar",constructor:function(w){this.map=w},_cursors:{move:"pointer","move-v":"pointer",
"move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(w,x,A,n){var g=this.map;w&&(this._mapNavState={isDoubleClickZoom:g.isDoubleClickZoom,isClickRecenter:g.isClickRecenter,isPan:g.isPan,isRubberBandZoom:g.isRubberBandZoom,isKeyboardNavigation:g.isKeyboardNavigation,isScrollWheelZoom:g.isScrollWheelZoom},g.disableDoubleClickZoom(),g.disableClickRecenter(),
g.disablePan(),g.disableRubberBandZoom(),g.disableKeyboardNavigation());x&&g.hideZoomSlider();A&&g.hidePanArrows();n&&g.graphics.disableMouseEvents()},_activateMapTools:function(w,x,A,n){var g=this.map,m=this._mapNavState;w&&m&&(m.isDoubleClickZoom&&g.enableDoubleClickZoom(),m.isClickRecenter&&g.enableClickRecenter(),m.isPan&&g.enablePan(),m.isRubberBandZoom&&g.enableRubberBandZoom(),m.isKeyboardNavigation&&g.enableKeyboardNavigation(),m.isScrollWheelZoom&&g.enableScrollWheelZoom());x&&g.showZoomSlider();
A&&g.showPanArrows();n&&g.graphics.enableMouseEvents()},_deactivateScrollWheel:function(){var w=this.map;this._scrollWheelState={isScrollWheelZoom:w.isScrollWheelZoom,isScrollWheelPan:w.isScrollWheelPan};w.disableScrollWheelZoom();w.disableScrollWheelPan()},_activateScrollWheel:function(){var w=this.map,x=this._scrollWheelState;x&&(x.isScrollWheelZoom&&w.enableScrollWheelZoom(),x.isScrollWheelPan&&w.enableScrollWheelPan())}});q("extend-esri")&&J.setObject("toolbars._Toolbar",L,K);return L})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a,e){L=L(null,{declaredClass:"esri.toolbars._Box",constructor:function(d,h,y,I,H,u,G){this._graphic=d;this._map=h;this._toolbar=y;this._scale=I;this._rotate=H;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=u;d=y._options;this._markerSymbol=d.boxHandleSymbol;this._lineSymbol=d.boxLineSymbol;this._moveStartHandler=J.hitch(this,this._moveStartHandler);this._firstMoveHandler=J.hitch(this,this._firstMoveHandler);
this._moveStopHandler=J.hitch(this,this._moveStopHandler);this._moveHandler=J.hitch(this,this._moveHandler);this._isTextPoint=G;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){q.forEach(this._getAllGraphics(),function(d){d.hide()})},resume:function(){q.forEach(this._getAllGraphics(),function(d){d.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
q.forEach(this._connects,K.disconnect);var d=this._toolbar._scratchGL;this._anchors&&q.forEach(this._anchors,function(h){d.remove(h.graphic);(h=h.moveable)&&h.destroy()});this._box&&d.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var d=this._map,h=this._toolbar._scratchGL,y=this._getBoxCoords(),I=new f(d.spatialReference),H=J.clone(q.filter(y,function(u,G){return 8!==G&&0===G%2}));H[0]&&H.push([H[0][0],H[0][1]]);I.addPath(H);this._rotate&&
I.addPath([y[1],y[8]]);this._box?this._box.setGeometry(I):(this._box=new e(I,this._lineSymbol),h.add(this._box));this._anchors?q.forEach(this._anchors,function(u,G){this._scale||(G=8);var v=new l(y[G],d.spatialReference);u.graphic.setGeometry(v);v=u.moveable;var t=u.graphic.getDojoShape();t&&(v?t!==v.shape&&(v.destroy(),u.moveable=this._getMoveable(u.graphic,G)):u.moveable=this._getMoveable(u.graphic,G))},this):(this._anchors=[],this._connects=[],q.forEach(y,function(u,G){!this._scale&&8>G||(u=new l(u,
d.spatialReference),u=new e(u,this._markerSymbol),this._isTextPoint&&1===G%2&&u.hide(),h.add(u),this._anchors.push({graphic:u,moveable:this._getMoveable(u,G)}))},this))}else this._cleanUp()},_getBoxCoords:function(d){var h=this._map,y=[],I,H,u;if(this._isTextPoint){var G=this._graphic.getNode().getBoundingClientRect();var v=h.__container.getBoundingClientRect();G=[{x:G.left-v.left,y:G.top-v.top},{x:G.right-v.left,y:G.top-v.top},{x:G.right-v.left,y:G.bottom-v.top},{x:G.left-v.left,y:G.bottom-v.top}]}else G=
this._getTransformedBoundingBox(this._graphic);q.forEach(G,function(t,F,B){I=t;(H=B[F+1])||(H=B[0]);u={x:(I.x+H.x)/2,y:(I.y+H.y)/2};d||(I=h.toMap(I),u=h.toMap(u));y.push([I.x,I.y]);y.push([u.x,u.y])});this._rotate&&(G=J.clone(y[1]),G=d?{x:G[0],y:G[1]}:h.toScreen({x:G[0],y:G[1],spatialReference:h.spatialReference}),G.y-=this._toolbar._options.rotateHandleOffset,d||(G=h.toMap(G)),y.push([G.x,G.y]));return y},_getTransformedBoundingBox:function(d){var h=this._map,y=d.geometry.getExtent(),I=d.geometry.spatialReference;
d=new l(y.xmin,y.ymax,I);y=new l(y.xmax,y.ymin,I);d=h.toScreen(d);y=h.toScreen(y);return[{x:d.x,y:d.y},{x:y.x,y:d.y},{x:y.x,y:y.y},{x:d.x,y:y.y}]},_getAllGraphics:function(){var d=[this._box];this._anchors&&q.forEach(this._anchors,function(h){d.push(h.graphic)});return d=q.filter(d,m.isDefined)},_getMoveable:function(d,h){var y=d.getDojoShape();if(y)return d=new A(y),d._index=h,this._connects.push(K.connect(d,"onMoveStart",this._moveStartHandler)),this._connects.push(K.connect(d,"onFirstMove",this._firstMoveHandler)),
this._connects.push(K.connect(d,"onMoveStop",this._moveStopHandler)),d.onMove=this._moveHandler,(y=y.getEventSource())&&x.set(y,"cursor",this._toolbar._cursors["box"+h]),d},_moveStartHandler:function(d){this._toolbar["on"+(8===d.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(d){this._toolbar._deactivateScrollWheel();var h=d.host._index,y=this._wrapOffset=d.host.shape._wrapOffsets[0]||0,I=this._graphic.getLayer().getNavigationTransform();d=q.map(this._getBoxCoords(!0),
function(u){return{x:u[0]+y,y:u[1]}});var H=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:d[1].x,y:d[3].y};this._centerCoord=n.multiplyPoint(n.invert(I),H);if(8===h)H=n.multiplyPoint(n.invert(I),d[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,H)),this._startLine=[this._centerCoord,H],this._moveLine=J.clone(this._startLine);else if(H=n.multiplyPoint(n.invert(I),d[h]),I=n.multiplyPoint(n.invert(I),d[(h+4)%8]),this._isTextPoint&&(this._centerCoord=
this._deNormalizePoint(this._centerCoord,H)),this._firstMoverToAnchor=Math.sqrt((H.x-this._centerCoord.x)*(H.x-this._centerCoord.x)+(H.y-this._centerCoord.y)*(H.y-this._centerCoord.y)),this._startBox=I,this._startBox.width=d[4].x-d[0].x,this._startBox.height=d[4].y-d[0].y,this._moveBox=J.clone(this._startBox),this._xfactor=H.x>I.x?1:-1,this._yfactor=H.y>I.y?1:-1,1===h||5===h)this._xfactor=0;else if(3===h||7===h)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===h?this._rotateEvent:
this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(d,h){d=d.host._index;var y=this._defaultEventArgs;y.angle=0;y.scaleX=1;y.scaleY=1;if(8===d){var I=this._startLine;var H=this._moveLine;var u=H[1];u.x+=h.dx;u.y+=h.dy;h=this._getAngle(I,H);this._isTextPoint&&(h+=this._graphic.symbol.angle);H=n.rotategAt(h,I[0]);this._graphic.getDojoShape().setTransform(H);y.transform=H;y.angle=h;y.around=I[0]}else{I=this._startBox;H=this._moveBox;H.width+=h.dx*this._xfactor;H.height+=h.dy*this._yfactor;
this._uniformScaling||this._isTextPoint?(I=H.x+this._xfactor*H.width,H=H.y+this._yfactor*H.height,I=Math.sqrt((I-this._centerCoord.x)*(I-this._centerCoord.x)+(H-this._centerCoord.y)*(H-this._centerCoord.y)),this._scaleRatio=h=u=I/this._firstMoverToAnchor,I=this._centerCoord):(h=H.width/I.width,u=H.height/I.height,I={x:I.x,y:I.y});if(isNaN(h)||Infinity===h||-Infinity===h)h=1;if(isNaN(u)||Infinity===u||-Infinity===u)u=1;H=n.scaleAt(h,u,I);if(this._isTextPoint){var G=n.rotategAt(this._graphic.symbol.angle,
I);this._graphic.getDojoShape().setTransform([G,H])}else this._graphic.getDojoShape().setTransform(H);y.transform=H;y.scaleX=h;y.scaleY=u;y.around=I}this._toolbar["on"+(8===d?this._rotateEvent:this._scaleEvent)](this._graphic,y)},_moveStopHandler:function(d){this._toolbar._activateScrollWheel();var h=this._graphic,y=this._toolbar,I=y._geo?c.geographicToWebMercator(h.geometry):h.geometry,H=I.spatialReference,u=h.getDojoShape(),G=u.getTransform(),v=h.getLayer().getNavigationTransform();this._isTextPoint?
(h=this._graphic.symbol,8===d.host._index?h.angle+=this._getAngle(this._startLine,this._moveLine):h.font.setSize(Math.round(h.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(h)):(I=I.toJson(),this._updateSegments(I.paths||I.rings,G,v,H),u.setTransform(null),I=a.fromJson(I),h.setGeometry(y._geo?c.webMercatorToGeographic(I,!0):I));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;y._endOperation("BOX");this._defaultEventArgs.transform=
G;y["on"+(8===d.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(d,h,y,I){var H=this._map,u=this._wrapOffset||0;q.forEach(d,function(G){q.forEach(G,function(v){this._updatePoint(v,I,u,n,H,y,h)},this)},this)},_updatePoint:function(d,h,y,I,H,u,G){h=H.toScreen({x:d[0],y:d[1],spatialReference:h},!0);h.x+=y;h=I.multiplyPoint([u,G,I.invert(u)],h);h.x-=y;y=H.toMap(h);d[0]=y.x;d[1]=y.y},_getAngle:function(d,h){return 180*Math.atan2(h[0].y-
h[1].y,h[0].x-h[1].x)/Math.PI-180*Math.atan2(d[0].y-d[1].y,d[0].x-d[1].x)/Math.PI},_deNormalizePoint:function(d,h){var y=this._map._getFrameWidth();if(-1===y)return d;for(d={x:d.x,y:d.y};Math.abs(d.x-h.x)>=y;)d.x=d.x<h.x?d.x+y:d.x-y;var I=Math.abs(d.x-h.x);Math.abs(d.x-h.x+y)<I?d.x+=y:Math.abs(d.x-h.x-y)<I&&(d.x-=y);return d}});w("extend-esri")&&J.setObject("toolbars._Box",L,g);return L})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(L,J,q,K,E,w,x,A,n,g){return J("dojox.gfx.Moveable",null,{constructor:function(m,l){this.shape=m;this.delay=l&&0<l.delay?l.delay:0;this.mover=l&&l.mover?l.mover:n;this.leftButtonOnly=l&&l.leftButtonOnly;this.events=[this.shape.on(w.press,L.hitch(this,"onMouseDown"))]},destroy:function(){q.forEach(this.events,function(m){m.remove()});this.events=this.shape=null},onMouseDown:function(m){this.delay?(this.events.push(this.shape.on(w.move,L.hitch(this,"onMouseMove")),this.shape.on(w.release,L.hitch(this,
"onMouseUp"))),this._lastX=m.clientX,this._lastY=m.clientY):this.leftButtonOnly&&!g.isLeft(m)||new this.mover(this.shape,m,this);K.stop(m)},onMouseMove:function(m){var l=m.clientY;if(Math.abs(m.clientX-this._lastX)>this.delay||Math.abs(l-this._lastY)>this.delay)this.onMouseUp(m),new this.mover(this.shape,m,this);K.stop(m)},onMouseUp:function(m){this.events.pop().remove()},onMoveStart:function(m){E.publish("/gfx/move/start",m);x.add(A.body(),"dojoMove")},onMoveStop:function(m){E.publish("/gfx/move/stop",
m);x.remove(A.body(),"dojoMove")},onFirstMove:function(m){},onMove:function(m,l,f){this.onMoving(m,l,f);this.shape.applyLeftTransform(l);this.onMoved(m,l)},onMoving:function(m,l){},onMoved:function(m,l){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(L,J,q,K,E,w){return q("dojox.gfx.Mover",null,{constructor:function(x,A,n){this.shape=x;this.lastX=A.clientX;this.lastY=A.clientY;x=this.host=n;A=
document;n=K(A,E.move,L.hitch(this,"onFirstMove"));this.events=[K(A,E.move,L.hitch(this,"onMouseMove")),K(A,E.release,L.hitch(this,"destroy")),K(A,"dragstart",L.hitch(w,"stop")),K(A,"selectstart",L.hitch(w,"stop")),n];if(x&&x.onMoveStart)x.onMoveStart(this)},onMouseMove:function(x){var A=x.clientX,n=x.clientY;this.host.onMove(this,{dx:A-this.lastX,dy:n-this.lastY},x);this.lastX=A;this.lastY=n;w.stop(x)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){J.forEach(this.events,
function(A){A.remove()});var x=this.host;if(x&&x.onMoveStop)x.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,l,f,b){var c=L(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(a,e,d,h){this.graphic=a;this.map=e;this.toolbar=d;this.tempPt=h;this._enableGraphicMover();this._moved=!1},refresh:function(a){var e=this.graphic.getDojoShape();!e||!a&&e._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var a=this.graphic,e=a.getDojoShape();e&&(e._hostGraphic=a,this._moveable=new w(e,{mover:c.Mover}),this._moveStartHandle=
q.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=q.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=q.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=q.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(a=e.getEventSource())&&E.set(a,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var a=this._moveable;if(a){q.disconnect(this._moveStartHandle);q.disconnect(this._firstMoveHandle);
q.disconnect(this._movingHandle);q.disconnect(this._moveStopHandle);var e=a.shape;e&&(e._hostGraphic=null,(e=e.getEventSource())&&E.set(e,"cursor","inherit"));a.destroy()}this._moveable=null},_moveStartHandler:function(){var a=this.graphic,e=this.map;this._startTx=a.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&e.snappingManager&&e.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(a)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(a,e,d){a=a.shape.getTransform();e=this.map;var h;m("esri-pointer")?h=e.navigationManager.pointerEvents._processTouchEvent(d,d):d&&"pointermove"===d.type&&(h=g.prototype._processTouchEvent.call({map:e},d,d));h&&e.snappingManager&&e.snappingManager._onSnappingMouseMoveHandler(h);this.tempPt&&this.tempPt.getDojoShape().setTransform(a);this.toolbar.onGraphicMove(this.graphic,a)},_moveStopHandler:function(a){var e=this.graphic,d=this.toolbar,h=this.map,y=d._geo?l.geographicToWebMercator(e.geometry):
e.geometry,I=y.type,H=e.getDojoShape(),u=H.getTransform();if(K.toJson(u)!==K.toJson(this._startTx)){this._moved=!0;switch(I){case "point":I=[u,A.invert(this._startTx)];if(h.snappingManager)var G=h.snappingManager._snappingPoint;y=G||h.toMap(A.multiplyPoint(I,h.toScreen(y,!0)));h.snappingManager&&h.snappingManager._killOffSnapping();break;case "polyline":y=this._updatePolyGeometry(y,y.paths,u);break;case "polygon":y=this._updatePolyGeometry(y,y.rings,u)}H.setTransform(null);e.setGeometry(d._geo?l.webMercatorToGeographic(y,
!0):y);this.tempPt&&this.tempPt.setGeometry(new b(e.geometry.toJson()))}else this._moved=!1;d._endOperation("MOVE");d.onGraphicMoveStop(e,u);this._moved||(a=a.__e,h=this.map.position,a=new f(a.pageX-h.x,a.pageY-h.y),d.onGraphicClick(e,{screenPoint:a,mapPoint:this.map.toMap(a)}))},_updatePolyGeometry:function(a,e,d){var h=this.map,y=a.getPoint(0,0);h=h.toMap(h.toScreen(y).offset(d.dx,d.dy));d=h.x-y.x;y=h.y-y.y;var I;for(h=0;h<e.length;h++){var H=e[h];for(I=0;I<H.length;I++){var u=a.getPoint(h,I);a.setPoint(h,
I,u.offset(d,y))}}return a}});c.Mover=L(x,{declaredClass:"esri.toolbars._Mover",constructor:function(a,e,d){this.__e=e}});m("extend-esri")&&(J.setObject("toolbars._GraphicMover",c,n),J.setObject("toolbars._Mover",c.Mover,n));return c})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(L,
J,q,K,E,w,x,A,n,g,m,l){var f=L(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(b,c,a){this.graphic=b;this.map=c;this.toolbar=a;b=a._options;this._symbol1=b.vertexSymbol;this._symbol2=b.ghostVertexSymbol;c=b.ghostLineSymbol;this._lineStroke={style:c.style,width:c.width,color:c.color};this._canDel=b.allowDeleteVertices;this._canAdd=b.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(b){b?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=q.connect(n,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=q.connect(n,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var b=this._getGraphicsLayer();this._mouseOverHandle=q.connect(b,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=q.connect(b,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new w({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),b=this._ctxDelete=new x({label:l.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
q.connect(b,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(b),this._ctxMenu.startup())},_removeControllers:function(){q.disconnect(this._firstMoveHandle);q.disconnect(this._moveStopHandle);q.disconnect(this._mouseOverHandle);q.disconnect(this._mouseOutHandle);q.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(b,c,a){var e,d,h=this.graphic,y=[];for(e=0;e<b.length;e++){var I=b[e],H=[];for(d=0;d<I.length;d++)H.push(new n(I[d],c,h,e,d,I.length,this,a));y.push(H)}return y},_remove:function(b){b&&K.forEach(b,function(c){K.forEach(c,function(a){a.destroy()})})},_refresh:function(b){b&&K.forEach(b,function(c){K.forEach(c,function(a){a.refresh()})})},_isNew:function(b){return-1===K.indexOf(this._vertexMovers[b.segIndex],b)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(b){b=this._selectedMover;this._updateRelatedGraphic(b,b.relatedGraphic,b.graphic.geometry,b.segIndex,b.ptIndex,b.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(b);this._deleteVertex(b);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(b){b=b.graphic;var c=this._findMover(b);c&&(this.toolbar.onVertexMouseOver(this.graphic,c._getInfo()),c._placeholder||(this._selectedMover=c,this._canDel&&this._bindCtxNode(b.getDojoShape().getNode())))},_mouseOutHandler:function(b){if(b=
this._findMover(b.graphic))this.toolbar.onVertexMouseOut(this.graphic,b._getInfo())},_bindCtxNode:function(b){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(b);this._bindNode=b},_unbindCtxNode:function(){var b=this._bindNode;b&&this._ctxMenu.unBindDomNode(b)},_findMover:function(b){var c=[];var a=this._mpVertexMovers;K.forEach(this._vertexMovers,function(d){c=c.concat(d)});a&&K.forEach(a,function(d){c=c.concat(d)});
for(a=0;a<c.length;a++){var e=c[a];if(e.graphic===b)return e}},_firstMoveHandler:function(b){!this._isNew(b)&&this._canAdd&&this._hideRelatedMidpoints(b);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(b,c){var a=this._isNew(b);c&&(c.dx||c.dy)?(this._updateRelatedGraphic(b,b.relatedGraphic,b.graphic.geometry,b.segIndex,b.ptIndex,b.segLength,a),this._canAdd&&(a?this._addMidpoints(b):(this._repositionRelatedMidpoints(b),this._showRelatedMidpoints(b))),this.toolbar._endOperation("VERTICES")):
!a&&this._canAdd&&this._showRelatedMidpoints(b)},_showRelatedMidpoints:function(b){var c=this._getAdjacentMidpoints(b.ptIndex,b.segLength),a=this._mpVertexMovers[b.segIndex];for(b=0;b<c.length;b++){var e=a[c[b]];e.graphic.show();e.refresh()}},_hideRelatedMidpoints:function(b){var c=this._getAdjacentMidpoints(b.ptIndex,b.segLength),a=this._mpVertexMovers[b.segIndex];for(b=0;b<c.length;b++)a[c[b]].graphic.hide()},_repositionRelatedMidpoints:function(b){var c,a=this._getAdjacentMidpoints(b.ptIndex,b.segLength),
e=this._mpVertexMovers[b.segIndex];for(c=0;c<a.length;c++){var d=this._getAdjacentVertices(a[c],b.segLength),h=b.relatedGraphic.geometry.getPoint(b.segIndex,d[0]);d=b.relatedGraphic.geometry.getPoint(b.segIndex,d[1]);h=new g({x:(h.x+d.x)/2,y:(h.y+d.y)/2,spatialReference:h.spatialReference.toJson()});e[a[c]].graphic.setGeometry(h)}},_addMidpoints:function(b){var c=b.segIndex,a=b.ptIndex,e=b.segLength,d=a+1,h,y=e+1;this._mpVertexMovers[c].splice(a,1);var I=this._vertexMovers[c];for(h=0;h<d;h++)I[h].segLength+=
1;for(h=d;h<I.length;h++)I[h].ptIndex+=1,I[h].segLength+=1;b.ptIndex=d;b.segLength=I.length+1;I.splice(d,0,b);b.graphic.setSymbol(this._symbol1);I=this._mpVertexMovers[c];for(h=0;h<a;h++)I[h].segLength+=1;for(h=a;h<e-1;h++)I[h].ptIndex+=1,I[h].segLength+=1;d=this._getAdjacentVertices(a,y);c=this._getAdjacentVertices(a+1,y);e=b.relatedGraphic.geometry.getPoint(b.segIndex,d[0]);h=b.relatedGraphic.geometry.getPoint(b.segIndex,d[1]);d=new g({x:(e.x+h.x)/2,y:(e.y+h.y)/2,spatialReference:e.spatialReference.toJson()});
e=b.relatedGraphic.geometry.getPoint(b.segIndex,c[0]);h=b.relatedGraphic.geometry.getPoint(b.segIndex,c[1]);c=new g({x:(e.x+h.x)/2,y:(e.y+h.y)/2,spatialReference:e.spatialReference.toJson()});e=new n(d,this._symbol2,this.graphic,b.segIndex,a,y,this,!0);b=new n(c,this._symbol2,this.graphic,b.segIndex,a+1,y,this,!0);I.splice(a,0,e,b)},_deleteVertex:function(b){var c,a=b.ptIndex,e=this._vertexMovers[b.segIndex];for(c=0;c<a;c++)--e[c].segLength;for(c=a+1;c<e.length;c++){var d=e[c];--d.ptIndex;--d.segLength}e.splice(a,
1);c=b._getInfo();b.destroy();this.toolbar.onVertexDelete(this.graphic,c)}});J.mixin(f,{create:function(b,c,a){switch(b.geometry.type){case "multipoint":return new f.MultipointVertexEditor(b,c,a);case "polyline":return new f.PolylineVertexEditor(b,c,a);case "polygon":return new f.PolygonVertexEditor(b,c,a)}}});f.MultipointVertexEditor=L(f,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=q.connect(n,"onMoveStart",this,this._moveStartHandler);
q.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);q.disconnect(this._moveStartHandle)},_getSegments:function(b){var c=b.points,a=[],e=b.spatialReference;for(b=0;b<c.length;b++){var d=c[b];a.push(new g({x:d[0],y:d[1],spatialReference:e.toJson()}))}return[a]},_getMidpointSegments:function(b){return[]},_getControlPoints:function(b,c,a,e,d){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(b){var c=b.graphic;if(b=this._findMover(b))this.toolbar.onVertexMouseOver(c,
b._getInfo()),this._selectedMover=b,this._canDel&&this._bindCtxNode(b.graphic.getDojoShape().getNode())},_mouseOutHandler:function(b){var c=b.graphic;if(b=this._findMover(b))this.toolbar.onVertexMouseOut(c,b._getInfo())},_findMover:function(b){var c=[].concat(this._vertexMovers[0]),a=b.target;for(b=0;b<c.length;b++){var e=c[b];if(e.graphic.getDojoShape().getNode()===a)return e}},_moveStartHandler:function(b){var c=b.ptIndex,a=b.segLength-1,e=b.relatedGraphic.geometry.points;b=e.splice(c,1);e.push(b[0]);
e=this._vertexMovers[0];for(b=a;b>c;b--)--e[b].ptIndex;b=e.splice(c,1);e.push(b[0]);b[0].ptIndex=a},_moveStopHandler:function(b){this._updateRelatedGraphic(b,b.relatedGraphic,b.graphic.geometry,b.segIndex,b.ptIndex,b.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(b,c,a,e,d,h,y,I){b=c.geometry;I?b.removePoint(d):b.setPoint(d,a);c.setGeometry(b)},_deleteMidpoints:function(b){}});f.PolylineVertexEditor=L(f,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(b){var c,a,e=b.paths,d=[];for(c=0;c<e.length;c++){var h=e[c],y=[];for(a=0;a<h.length;a++)y.push(b.getPoint(c,a));d.push(y)}return d},_getMidpointSegments:function(b){var c,a,e=b.paths,d=[],h=b.spatialReference;for(c=0;c<e.length;c++){var y=e[c],I=[];for(a=0;a<y.length-1;a++){var H=b.getPoint(c,a),u=b.getPoint(c,a+1);H=new g({x:(H.x+u.x)/2,y:(H.y+u.y)/2,spatialReference:h.toJson()});I.push(H)}d.push(I)}return d},_getControlPoints:function(b,c,a,e,d){var h=this.map,y,I;this._isNew(b)?
(b=e,e+=1,0<=b&&(y=h.toScreen(c.getPoint(a,b))),e<=d&&(I=h.toScreen(c.getPoint(a,e)))):(b=e-1,e+=1,0<=b&&(y=h.toScreen(c.getPoint(a,b))),e<d&&(I=h.toScreen(c.getPoint(a,e))));return[y,I]},_getAdjacentMidpoints:function(b,c){var a=[],e=b-1;0<=e&&a.push(e);b<c-1&&a.push(b);return a},_getAdjacentVertices:function(b,c){return[b,b+1]},_deleteMidpoints:function(b){var c=this._mpVertexMovers[b.segIndex],a=c.length-1,e=this._getAdjacentMidpoints(b.ptIndex,b.segLength).sort(),d,h=e[0];for(d=0;d<h;d++)--c[d].segLength;
for(d=h+1;d<c.length;d++){var y=c[d];--y.ptIndex;--y.segLength}if(1===e.length)c.splice(h,1)[0].destroy();else for(y=this._getAdjacentVertices(h,a),d=b.relatedGraphic.geometry.getPoint(b.segIndex,y[0]),y=b.relatedGraphic.geometry.getPoint(b.segIndex,y[1]),d=new g({x:(d.x+y.x)/2,y:(d.y+y.y)/2,spatialReference:d.spatialReference.toJson()}),b=new n(d,this._symbol2,this.graphic,b.segIndex,h,a,this,!0),c=c.splice(h,e.length,b),d=0;d<c.length;d++)c[d].destroy()},_updateRelatedGraphic:function(b,c,a,e,d,
h,y,I){b=c.geometry;y?b.insertPoint(e,d+1,m.fromJson(a.toJson())):I?b.removePoint(e,d):b.setPoint(e,d,m.fromJson(a.toJson()));c.setGeometry(b)}});f.PolygonVertexEditor=L(f,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(b){var c,a,e=b.rings,d=[];for(c=0;c<e.length;c++){var h=e[c],y=[];for(a=0;a<h.length-1;a++)y.push(b.getPoint(c,a));d.push(y)}return d},_getMidpointSegments:function(b){var c,a,e=b.rings,d=[],h=b.spatialReference;for(c=0;c<e.length;c++){var y=e[c],
I=[];for(a=0;a<y.length-1;a++){var H=b.getPoint(c,a),u=b.getPoint(c,a+1);H=new g({x:(H.x+u.x)/2,y:(H.y+u.y)/2,spatialReference:h.toJson()});I.push(H)}d.push(I)}return d},_getControlPoints:function(b,c,a,e,d){var h=this.map;this._isNew(b)?b=e:(b=e-1,b=0>b?(d+b)%d:b);e=(e+1)%d;d=h.toScreen(c.getPoint(a,b));c=h.toScreen(c.getPoint(a,e));return[d,c]},_getAdjacentMidpoints:function(b,c){var a=b-1;return[0>a?(c+a)%c:a,b]},_getAdjacentVertices:function(b,c){return[b,(b+1)%c]},_deleteMidpoints:function(b){var c=
b.ptIndex,a=this._mpVertexMovers[b.segIndex],e=a.length-1,d=this._getAdjacentMidpoints(c,b.segLength).sort();var h=d[0];var y=d[d.length-1];if(0===c){var I=this._getAdjacentVertices(e-1,e);c=b.relatedGraphic.geometry.getPoint(b.segIndex,I[0]);I=b.relatedGraphic.geometry.getPoint(b.segIndex,I[1]);c=new g({x:(c.x+I.x)/2,y:(c.y+I.y)/2,spatialReference:c.spatialReference.toJson()});b=new n(c,this._symbol2,this.graphic,b.segIndex,e-1,e,this,!0);a.splice(y,1,b)[0].destroy();a.splice(h,1)[0].destroy();for(d=
0;d<a.length-1;d++)h=a[d],--h.ptIndex,--h.segLength}else{I=this._getAdjacentVertices(h,e);c=b.relatedGraphic.geometry.getPoint(b.segIndex,I[0]);I=b.relatedGraphic.geometry.getPoint(b.segIndex,I[1]);c=new g({x:(c.x+I.x)/2,y:(c.y+I.y)/2,spatialReference:c.spatialReference.toJson()});b=new n(c,this._symbol2,this.graphic,b.segIndex,h,e,this,!0);y=a.splice(h,d.length,b);for(d=0;d<y.length;d++)y[d].destroy();for(d=0;d<h;d++)--a[d].segLength;for(d=h+1;d<a.length;d++)h=a[d],--h.ptIndex,--h.segLength}},_updateRelatedGraphic:function(b,
c,a,e,d,h,y,I){b=c.geometry;y?b.insertPoint(e,d+1,m.fromJson(a.toJson())):I?(b.removePoint(e,d),0===d&&b.setPoint(e,h-1,m.fromJson(b.getPoint(e,0).toJson()))):(b.setPoint(e,d,m.fromJson(a.toJson())),0===d&&b.setPoint(e,h,m.fromJson(a.toJson())));c.setGeometry(b)}});E("extend-esri")&&(J.setObject("toolbars._GraphicVertexEditor",f,A),J.setObject("toolbars._MultipointVertexEditor",f.MultipointVertexEditor,A),J.setObject("toolbars._PolylineVertexEditor",f.PolylineVertexEditor,A),J.setObject("toolbars._PolygonVertexEditor",
f.PolygonVertexEditor,A));return f})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a){m("dijit-legacy-requires")&&a(0,function(){L(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return q("dijit.Menu",c,{constructor:function(){this._bindings=
[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):J.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(e){return f.get(this._iframeContentDocument(e))||this._iframeContentDocument(e).__parent__||e.name&&document.frames[e.name]||null},_iframeContentDocument:function(e){return e.contentDocument||e.contentWindow&&e.contentWindow.document||
e.name&&document.frames[e.name]&&document.frames[e.name].document||null},bindDomNode:function(e){e=K.byId(e,this.ownerDocument);if("iframe"==e.tagName.toLowerCase()){var d=e;var h=this._iframeContentWindow(d);h=l.body(h.document)}else h=e==l.body(this.ownerDocument)?this.ownerDocument.documentElement:e;var y={node:e,iframe:d};E.set(e,"_dijitMenu"+this.id,this._bindings.push(y));var I=n.hitch(this,function(H){var u=this.selector,G=u?function(t){return g.selector(u,t)}:function(t){return t},v=this;
return[g(H,G(this.leftClickToOpen?"click":"contextmenu"),function(t){t.stopPropagation();t.preventDefault();(new Date).getTime()<v._lastKeyDown+500||v._scheduleOpen(this,d,{x:t.pageX,y:t.pageY},t.target)}),g(H,G("keydown"),function(t){if(93==t.keyCode||t.shiftKey&&t.keyCode==A.F10||v.leftClickToOpen&&t.keyCode==A.SPACE)t.stopPropagation(),t.preventDefault(),v._scheduleOpen(this,d,null,t.target),v._lastKeyDown=(new Date).getTime()})]});y.connects=h?I(h):[];d&&(y.onloadHandler=n.hitch(this,function(){var H=
this._iframeContentWindow(d);H=l.body(H.document);y.connects=I(H)}),d.addEventListener?d.addEventListener("load",y.onloadHandler,!1):d.attachEvent("onload",y.onloadHandler))},unBindDomNode:function(e){try{var d=K.byId(e,this.ownerDocument)}catch(H){return}e="_dijitMenu"+this.id;if(d&&E.has(d,e)){for(var h=E.get(d,e)-1,y=this._bindings[h],I;I=y.connects.pop();)I.remove();(I=y.iframe)&&(I.removeEventListener?I.removeEventListener("load",y.onloadHandler,!1):I.detachEvent("onload",y.onloadHandler));E.remove(d,
e);delete this._bindings[h]}},_scheduleOpen:function(e,d,h,y){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:y,delegatedTarget:e,iframe:d,coords:h})},1))},_openMyself:function(e){function d(){t.refocus&&F&&F.focus();b.close(t)}var h=e.target,y=e.iframe,I=e.coords,H=!I;this.currentTarget=e.delegatedTarget;if(I){if(y){e=w.position(y,!0);h=this._iframeContentWindow(y);h=w.docScroll(h.document);var u=x.getComputedStyle(y),G=x.toPixelValue,v=(m("ie")&&
m("quirks")?0:G(y,u.paddingLeft))+(m("ie")&&m("quirks")?G(y,u.borderLeftWidth):0);y=(m("ie")&&m("quirks")?0:G(y,u.paddingTop))+(m("ie")&&m("quirks")?G(y,u.borderTopWidth):0);I.x+=e.x+v-h.x;I.y+=e.y+y-h.y}}else I=w.position(h,!0),I.x+=10,I.y+=10;var t=this;y=this._focusManager.get("prevNode");e=this._focusManager.get("curNode");var F=!e||K.isDescendant(e,this.domNode)?y:e;b.open({popup:this,x:I.x,y:I.y,onExecute:d,onCancel:d,orient:this.isLeftToRight()?"L":"R"});this.focus();H||this.defer(function(){this._cleanUp(!0)});
this._onBlur=function(){this.inherited("_onBlur",arguments);b.close(this)}},destroy:function(){J.forEach(this._bindings,function(e){e&&this.unBindDomNode(e.node)},this);this.inherited(arguments)}})})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(L,J,q,K,E,w,x,A,n,g,m,
l,f){L=L(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(b,c,a,e,d,h,y,I){this.point=b;this.symbol=c;this.relatedGraphic=a;this.segIndex=e;this.ptIndex=d;this.segLength=h;this.editor=y;this.map=y.map;this._scratchGL=y.toolbar._scratchGL;this._placeholder=I||!1;this._type=a.geometry.type;this._init();this._enable()},refresh:function(b){if(b||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);
this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var b=new m(this.point.toJson());b=new l(b,this.symbol);switch(this._type){case "multipoint":b._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(b)}this.graphic=b},_enable:function(){var b=this.graphic.getDojoShape();b&&(b._hasMover=!0,this._moveable=this._getMoveable(b),
(b=b.getEventSource())&&E.set(b,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var b=this._moveable;if(b){q.disconnect(this._startHandle);q.disconnect(this._firstHandle);q.disconnect(this._movingHandle);q.disconnect(this._stopHandle);var c=b.shape;c&&(c=c.getEventSource())&&E.set(c,"cursor","inherit");b.destroy();this._moveable=null}},_needRefresh:function(){var b=this.graphic.getDojoShape(),c=!1;if(b)switch(this._type){case "multipoint":var a=this.relatedGraphic.getDojoShape();
a&&(a=a.children[this.ptIndex],b!==a&&(this.graphic._shape=a,c=!0));break;case "polyline":case "polygon":c=!b._hasMover}return c},_getMoveable:function(b){b=new w(b,K("mac")&&K("ff")&&!g("esri-touch")&&{leftButtonOnly:!0});this._startHandle=q.connect(b,"onMoveStart",this,this._moveStartHandler);this._firstHandle=q.connect(b,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=q.connect(b,"onMoving",this,this._movingHandler);this._stopHandle=q.connect(b,"onMoveStop",this,this._moveStopHandler);
return b},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(b){var c=this.map;c.snappingManager&&c.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();b.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,
this._getInfo())},_firstMoveHandler:function(b){var c=b.shape,a=this._getControlEdges(),e=this._scratchGL._div,d,h=[],y=b.host.shape._wrapOffsets[0]||0;for(d=0;d<a.length;d++){var I=a[d];I.x1+=y;I.x2+=y;h.push([e.createLine({x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2}).setStroke(this.editor._lineStroke),I.x1,I.y1,I.x2,I.y2])}c._lines=h;b.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(b,c,a){c=this.map;
var e;g("esri-pointer")?e=c.navigationManager.pointerEvents._processTouchEvent(a,a):a&&"pointermove"===a.type&&(e=n.prototype._processTouchEvent.call({map:c},a,a));e&&c.snappingManager&&c.snappingManager._onSnappingMouseMoveHandler(e);a=b.shape;b=a.getTransform();a=a._lines;for(e=0;e<a.length;e++)c=a[e],c[0].setShape({x1:c[1]+b.dx,y1:c[2]+b.dy,x2:c[3],y2:c[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),b)},_moveStopHandler:function(b){b=b.shape;var c=this.editor.toolbar,
a=b.getTransform(),e=this.map,d=this.graphic,h=c._geo?f.geographicToWebMercator(d.geometry):d.geometry;c._activateScrollWheel();var y,I=b._lines;if(I){for(y=0;y<I.length;y++)I[y][0].removeShape();b._lines=null}y=!1;I=!0;var H=this._getInfo();a&&(a.dx||a.dy)?this._placeholder&&(this._placeholder=!1,y=!0):I=!1;if(e.snappingManager)var u=e.snappingManager._snappingPoint;var G=[a,x.invert(this._startTx)];u=u||e.toMap(x.multiplyPoint(G,e.toScreen(h,!0)));e.snappingManager&&e.snappingManager._killOffSnapping();
b.setTransform(null);d.setGeometry(c._geo?f.webMercatorToGeographic(u,!0):u);this.constructor.onMoveStop(this,a);c.onVertexMoveStop(this.relatedGraphic,H,a);if(!I)c.onVertexClick(this.relatedGraphic,H);if(y)c.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var b=this.map,c=this.relatedGraphic.geometry,a=this.segIndex,e=this.ptIndex,d=this.segLength,h=this._scratchGL.getNavigationTransform(),y=h.dx;h=h.dy;var I=b.toScreen(this.graphic.geometry);b=I.x-y;I=I.y-h;var H=[];
c=this.editor._getControlPoints(this,c,a,e,d);c[0]&&H.push({x1:b,y1:I,x2:c[0].x-y,y2:c[0].y-h});c[1]&&H.push({x1:b,y1:I,x2:c[1].x-y,y2:c[1].y-h});return H}});g("extend-esri")&&J.setObject("toolbars.VertexMover",L,A);J.mixin(L,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return L})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),
function(L,J,q,K,E,w,x,A,n,g){L=L(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(m,l,f){this._graphic=m;this._map=l;this._toolbar=f;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(m){this._editBox?(q.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=q.connect(m.getLayer(),"onDblClick",this,function(l){this._map.navigationManager.setImmediateClick(!1);
l.graphic==m&&(K.stop(l),q.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(m))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(q.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(m,l){if(!this._editBox){if(!m.symbol.text){m.symbol.text="Tempt text";m.setSymbol(m.symbol);var f=""}var b=this._createInputTextStyle(m,
this._map);""!==f&&(f=l||m.symbol.text);this._editBox=w.create("input",{type:"text",value:f});A.set(this._editBox,b);x.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=q.connect(this._editBox,"onkeyup",J.hitch(this,function(a){a.keyCode!=n.ENTER&&a.keyCode!==n.TAB||this._disable()}));this._editBoxBlurHandler=q.connect(this._editBox,"onblur",J.hitch(this,function(a){this._disable()}));m.symbol.text="";m.setSymbol(m.symbol);
m.hide();var c=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",J.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(a){A.set(c,{left:this._editBoxLeft+a.delta.x+"px",top:this._editBoxTop+a.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(A.get(c,"left"));this._editBoxTop=parseFloat(A.get(c,"top"))});this.onEditStart(m,this._editBox);this._toolbar.onTextEditStart(m,
this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(q.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&
(q.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(m,l){l=m.getDojoShape().getTransformedBoundingBox();var f=m.getLayer();f=f.hasLocalNavigationTransform()?{dx:0,dy:0}:f.getNavigationTransform();var b=m.symbol.font;return{"font-family":b.family,"font-size":b.size+"px","font-style":b.style,"font-variant":b.variant,"font-weight":b.weight,left:l[0].x+f.dx+"px",top:l[0].y+f.dy+"px",width:Math.abs(l[0].x-l[1].x)/Math.cos(m.symbol.angle/180*Math.PI)+"px"}},
_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var m=this._graphic.symbol;m.text=this._editBox.value;this._graphic.setSymbol(m)}else this._graphic.getLayer().remove(this._graphic)}});E("extend-esri")&&J.setObject("toolbars.TextEditor",L,g);return L})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(L,J,q,K,E,w,x,A,n,g,m,l,f,b,c,a,e,d,h,y,I,H,u,G,v,t){var F=L(c,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(B,O){this.markerSymbol=new a(a.STYLE_SOLID,10,new e(e.STYLE_SOLID,new E([255,0,0]),2),new E([0,0,0,.25]));this.lineSymbol=new e(e.STYLE_SOLID,new E([255,0,0]),2);this.fillSymbol=new d(d.STYLE_SOLID,new e(e.STYLE_SOLID,new E([255,0,0]),2),new E([0,0,0,.25]));this._points=[];this._mouse=!x("esri-touch")&&!x("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=J.mixin(J.mixin({},this._defaultOptions),O||{});if(A("ios")||A("android"))this._options.showTooltips=!1;this._onKeyDownHandler=J.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=J.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=J.hitch(this,this._onMouseUpHandler);this._onClickHandler=J.hitch(this,this._onClickHandler);this._onMouseMoveHandler=J.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=J.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=J.hitch(this,this._onDblClickHandler);this._updateTooltip=J.hitch(this,this._updateTooltip);this._hideTooltip=J.hitch(this,this._hideTooltip);this._redrawGraphic=J.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(B){this.respectDrawingVertexOrder=B},setMarkerSymbol:function(B){this.markerSymbol=B},setLineSymbol:function(B){this.lineSymbol=B},
setFillSymbol:function(B){this.fillSymbol=B},activate:function(B,O){this._geometryType&&this.deactivate();var M=this.map,C=K.connect,W=F;this._options=J.mixin(J.mixin({},this._options),O||{});M.navigationManager.setImmediateClick(!1);switch(B){case W.ARROW:case W.LEFT_ARROW:case W.RIGHT_ARROW:case W.UP_ARROW:case W.DOWN_ARROW:case W.TRIANGLE:case W.CIRCLE:case W.ELLIPSE:case W.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=C(M,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=C(M,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=C(M,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=C(M,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=C(M,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=C(M,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=C(M,"onMouseDragEnd",this._onMouseUpHandler));x("esri-touch")&&(this._onMouseDownHandler2_connect=
C(M,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=C(M,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=C(M,"onSwipeEnd",this._onMouseUpHandler));break;case W.POINT:this._onClickHandler_connect=C(M,"onClick",this._onClickHandler);break;case W.LINE:case W.EXTENT:case W.FREEHAND_POLYLINE:case W.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=C(M,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=
C(M,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=C(M,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=C(M,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=C(M,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=C(M,"onMouseDragEnd",this._onMouseUpHandler));x("esri-touch")&&(this._onMouseDownHandler2_connect=C(M,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=C(M,"onSwipeMove",
this._onMouseDragHandler),this._onMouseUpHandler2_connect=C(M,"onSwipeEnd",this._onMouseUpHandler));break;case W.POLYLINE:case W.POLYGON:case W.MULTI_POINT:M.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=C(M,"onClick",this._onClickHandler);this._onDblClickHandler_connect=C(M,"onDblClick",this._onDblClickHandler);this._dblClickZoom=M.isDoubleClickZoom;M.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+B);return}this._onKeyDown_connect=C(M,"onKeyDown",
this._onKeyDownHandler);this._redrawConnect=C(M,"onExtentChange",this._redrawGraphic);this._geometryType=B;this._toggleTooltip(!0);M.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(M.snappingManager._startSelectionLayerQuery(),M.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var B=this.map;this._clear();var O=K.disconnect;O(this._onMouseMoveHandler_connect);O(this._onMouseDownHandler_connect);O(this._onMouseDragHandler_connect);
O(this._onMouseUpHandler_connect);O(this._onMouseDownHandler2_connect);O(this._onMouseDragHandler2_connect);O(this._onMouseUpHandler2_connect);O(this._onClickHandler_connect);O(this._onDblClickHandler_connect);O(this._onKeyDown_connect);O(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=this._onMouseUpHandler2_connect=this._onClickHandler_connect=
this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;B.snappingManager&&(B.snappingManager._stopSelectionLayerQuery(),B.snappingManager._killOffSnapping());switch(this._geometryType){case F.CIRCLE:case F.ELLIPSE:case F.TRIANGLE:case F.ARROW:case F.LEFT_ARROW:case F.RIGHT_ARROW:case F.UP_ARROW:case F.DOWN_ARROW:case F.RECTANGLE:case F.LINE:case F.EXTENT:case F.FREEHAND_POLYLINE:case F.FREEHAND_POLYGON:this._activateMapTools(!0,!1,!1,!0);break;case F.POLYLINE:case F.POLYGON:case F.MULTI_POINT:this._dblClickZoom&&
B.enableDoubleClickZoom()}O=this._geometryType;this._geometryType=null;B.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(O)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._graphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},finishDrawing:function(){var B=this._points,O=this.map.spatialReference,M=F;B=B.slice(0,B.length);switch(this._geometryType){case M.POLYLINE:if(!this._graphic||2>
B.length)return;var C=new H(O);C.addPath([].concat(B));break;case M.POLYGON:if(!this._graphic||3>B.length)return;C=new u(O);B=[].concat(B,[B[0].offset(0,0)]);u.prototype.isClockwise(B)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),B.reverse());C.addRing(B);break;case M.MULTI_POINT:C=new G(O),q.forEach(B,function(W){C.addPoint(W)})}K.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);
this._drawEnd(C)},_drawEnd:function(B){if(B){var O=this.map.spatialReference,M;this.onDrawEnd(B);O&&(O.isWebMercator()?M=I.webMercatorToGeographic(B,!0):4326===O.wkid&&(M=y.fromJson(B.toJson())));this.onDrawComplete({geometry:B,geographicGeometry:M})}},_normalizeRect:function(B,O,M){var C=B.x;B=B.y;var W=O.x;O=O.y;return{x:Math.min(C,W),y:Math.max(B,O),width:Math.abs(C-W),height:Math.abs(B-O),spatialReference:M}},_onMouseDownHandler:function(B){this._dragged=!1;if(this.map.snappingManager)var O=this.map.snappingManager._snappingPoint;
var M=O||B.mapPoint,C=F;O=this.map;var W=O.spatialReference;this._points.push(M.offset(0,0));switch(this._geometryType){case C.LINE:this._graphic=O.graphics.add(new h(new H({paths:[[[M.x,M.y],[M.x,M.y]]],spatialReference:W}),this.lineSymbol),!0);O.snappingManager&&O.snappingManager._setGraphic(this._graphic);break;case C.FREEHAND_POLYLINE:this._oldPoint=B.screenPoint;M=new H(W);M.addPath(this._points);this._graphic=O.graphics.add(new h(M,this.lineSymbol),!0);O.snappingManager&&O.snappingManager._setGraphic(this._graphic);
break;case C.CIRCLE:case C.ELLIPSE:case C.TRIANGLE:case C.ARROW:case C.LEFT_ARROW:case C.RIGHT_ARROW:case C.UP_ARROW:case C.DOWN_ARROW:case C.RECTANGLE:case C.FREEHAND_POLYGON:this._oldPoint=B.screenPoint,M=new u(W),M.addRing(this._points),this._graphic=O.graphics.add(new h(M,this.fillSymbol),!0),O.snappingManager&&O.snappingManager._setGraphic(this._graphic)}x("esri-touch")&&B.preventDefault();if(1===this._points.length)this.onDrawStart()},_onMouseMoveHandler:function(B){if(this.map.snappingManager)var O=
this.map.snappingManager._snappingPoint;B=O||B.mapPoint;O=this._graphic.geometry;switch(this._geometryType){case F.POLYLINE:case F.POLYGON:var M=this._points.length,C=!!O.getPoint(0,M);B=B.offset(0,0);C?O.setPoint(0,M,B):O.insertPoint(0,M,B);this._graphic.setGeometry(O)}},_onMouseDragHandler:function(B){if(this._graphic||this._points.length)if(x("esri-touch")&&!this._points.length)B.preventDefault();else{this._dragged=!0;if(this.map.snappingManager)var O=this.map.snappingManager._snappingPoint;var M=
this._points[0],C=O||B.mapPoint,W=this.map,Y=W.spatialReference;O=this._graphic;var R=F,S=W.toScreen(M),T=W.toScreen(C),Z=[];Z=T.x-S.x;T=T.y-S.y;var qa=Math.sqrt(Z*Z+T*T);switch(this._geometryType){case R.CIRCLE:this._hideTooltip();O.geometry=u.createCircle({center:S,r:qa,numberOfPoints:60,map:W});O.setGeometry(O.geometry);break;case R.ELLIPSE:this._hideTooltip();O.geometry=u.createEllipse({center:S,longAxis:Z,shortAxis:T,numberOfPoints:60,map:W});O.setGeometry(O.geometry);break;case R.TRIANGLE:this._hideTooltip();
Z=[[0,-qa],[.8660254037844386*qa,.5*qa],[-.8660254037844386*qa,.5*qa],[0,-qa]];O.geometry=this._toPolygon(Z,S.x,S.y);O.setGeometry(O.geometry);break;case R.ARROW:this._hideTooltip();M=T/qa;W=Z/qa;C=.25*W*qa;Y=.25*qa/(T/Z);qa*=.25*M;Z=[[Z,T],[Z-C*(1+24/Y),T+24*W-qa],[Z-C*(1+12/Y),T+12*W-qa],[-12*M,12*W],[12*M,-12*W],[Z-C*(1-12/Y),T-12*W-qa],[Z-C*(1-24/Y),T-24*W-qa],[Z,T]];O.geometry=this._toPolygon(Z,S.x,S.y);O.setGeometry(O.geometry);break;case R.LEFT_ARROW:this._hideTooltip();Z=0>=Z?[[Z,0],[.75*
Z,T],[.75*Z,.5*T],[0,.5*T],[0,-.5*T],[.75*Z,-.5*T],[.75*Z,-T],[Z,0]]:[[0,0],[.25*Z,T],[.25*Z,.5*T],[Z,.5*T],[Z,-.5*T],[.25*Z,-.5*T],[.25*Z,-T],[0,0]];O.geometry=this._toPolygon(Z,S.x,S.y);O.setGeometry(O.geometry);break;case R.RIGHT_ARROW:this._hideTooltip();Z=0<=Z?[[Z,0],[.75*Z,T],[.75*Z,.5*T],[0,.5*T],[0,-.5*T],[.75*Z,-.5*T],[.75*Z,-T],[Z,0]]:[[0,0],[.25*Z,T],[.25*Z,.5*T],[Z,.5*T],[Z,-.5*T],[.25*Z,-.5*T],[.25*Z,-T],[0,0]];O.geometry=this._toPolygon(Z,S.x,S.y);O.setGeometry(O.geometry);break;case R.UP_ARROW:this._hideTooltip();
Z=0>=T?[[0,T],[-Z,.75*T],[-.5*Z,.75*T],[-.5*Z,0],[.5*Z,0],[.5*Z,.75*T],[Z,.75*T],[0,T]]:[[0,0],[-Z,.25*T],[-.5*Z,.25*T],[-.5*Z,T],[.5*Z,T],[.5*Z,.25*T],[Z,.25*T],[0,0]];O.geometry=this._toPolygon(Z,S.x,S.y);O.setGeometry(O.geometry);break;case R.DOWN_ARROW:this._hideTooltip();Z=0<=T?[[0,T],[-Z,.75*T],[-.5*Z,.75*T],[-.5*Z,0],[.5*Z,0],[.5*Z,.75*T],[Z,.75*T],[0,T]]:[[0,0],[-Z,.25*T],[-.5*Z,.25*T],[-.5*Z,T],[.5*Z,T],[.5*Z,.25*T],[Z,.25*T],[0,0]];O.geometry=this._toPolygon(Z,S.x,S.y);O.setGeometry(O.geometry);
break;case R.RECTANGLE:this._hideTooltip();Z=[[0,0],[Z,0],[Z,T],[0,T],[0,0]];O.geometry=this._toPolygon(Z,S.x,S.y);O.setGeometry(O.geometry);break;case R.LINE:O.setGeometry(J.mixin(O.geometry,{paths:[[[M.x,M.y],[C.x,C.y]]]}));break;case R.EXTENT:O&&W.graphics.remove(O,!0);O=new v(this._normalizeRect(M,C,Y));O._originOnly=!0;this._graphic=W.graphics.add(new h(O,this.fillSymbol),!0);W.snappingManager&&W.snappingManager._setGraphic(this._graphic);break;case R.FREEHAND_POLYLINE:this._hideTooltip();if(!1===
this._canDrawFreehandPoint(B)){x("esri-touch")&&B.preventDefault();return}this._points.push(B.mapPoint.offset(0,0));O.geometry._insertPoints([C.offset(0,0)],0);O.setGeometry(O.geometry);break;case R.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(B)){x("esri-touch")&&B.preventDefault();return}this._points.push(B.mapPoint.offset(0,0));O.geometry._insertPoints([C.offset(0,0)],0);O.setGeometry(O.geometry)}x("esri-touch")&&B.preventDefault()}},_canDrawFreehandPoint:function(B){if(!this._oldPoint)return!1;
var O=this._oldPoint.x-B.screenPoint.x,M=this._oldPoint.y-B.screenPoint.y,C=this._options.tolerance;if((0>O?-1*O:O)<C&&(0>M?-1*M:M)<C)return!1;O=new Date;if(O-this._startTime<this._options.drawTime)return!1;this._startTime=O;this._oldPoint=B.screenPoint;return!0},_onMouseUpHandler:function(B){if(this._dragged&&this._graphic){0===this._points.length&&this._points.push(B.mapPoint.offset(0,0));if(this.map.snappingManager)var O=this.map.snappingManager._snappingPoint;var M=this._points[0];O=O||B.mapPoint;
var C=this.map.spatialReference,W=F;switch(this._geometryType){case W.CIRCLE:case W.ELLIPSE:case W.TRIANGLE:case W.ARROW:case W.LEFT_ARROW:case W.RIGHT_ARROW:case W.UP_ARROW:case W.DOWN_ARROW:case W.RECTANGLE:var Y=this._graphic.geometry;break;case W.LINE:Y=new H({paths:[[[M.x,M.y],[O.x,O.y]]],spatialReference:C});break;case W.EXTENT:Y=(new v(this._normalizeRect(M,O,C))).getExtent();break;case W.FREEHAND_POLYLINE:Y=new H(C);Y.addPath([].concat(this._points,[O.offset(0,0)]));break;case W.FREEHAND_POLYGON:Y=
new u(C),M=[].concat(this._points,[O.offset(0,0),this._points[0].offset(0,0)]),u.prototype.isClockwise(M)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),M.reverse()),Y.addRing(M)}x("esri-touch")&&B.preventDefault();this._clear();this._drawEnd(Y)}else this._clear()},_isPointToPointTool:function(B){switch(B){case F.POLYLINE:case F.POLYGON:case F.MULTI_POINT:return!0;default:return!1}},_onClickHandler:function(B){if(this.map.snappingManager)var O=
this.map.snappingManager._snappingPoint;O=O||B.mapPoint;B=this.map;var M=B.toScreen(O),C=F;if(this._isPointToPointTool(this._geometryType)){var W=this._points[this._points.length-1];if(O&&W&&O.x===W.x&&O.y===W.y)return;this._points.push(O.offset(0,0))}switch(this._geometryType){case C.POINT:this.onDrawStart();this._drawEnd(O.offset(0,0));this._setTooltipMessage(0);break;case C.POLYLINE:1===this._points.length?(O=new H(B.spatialReference),O.addPath(this._points),this._graphic=B.graphics.add(new h(O,
this.lineSymbol),!0),B.snappingManager&&B.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=K.connect(B,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,O.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol));break;case C.POLYGON:1===this._points.length?(O=new u(B.spatialReference),O.addRing(this._points),this._graphic=B.graphics.add(new h(O,this.fillSymbol),
!0),B.snappingManager&&B.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=K.connect(B,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,O.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol));break;case C.MULTI_POINT:O=this._points;1===O.length?(M=new G(B.spatialReference),M.addPoint(O[O.length-1]),this._graphic=B.graphics.add(new h(M,this.markerSymbol),
!0),B.snappingManager&&B.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(O[O.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case C.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],M.x,M.y);break;case C.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],M.x,M.y);break;case C.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,
12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],M.x,M.y);break;case C.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],M.x,M.y);break;case C.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],M.x,M.y);break;case C.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],M.x,M.y);break;case C.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],M.x-48,M.y+48);break;case C.CIRCLE:this._clear();
this.onDrawStart();this._drawEnd(u.createCircle({center:M,r:48,numberOfPoints:60,map:B}));break;case C.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(u.createEllipse({center:M,longAxis:48,shortAxis:24,numberOfPoints:60,map:B}))}this._setTooltipMessage(this._points.length)},_addShape:function(B,O,M){this._setTooltipMessage(0);this._clear();this.onDrawStart();this._drawEnd(this._toPolygon(B,O,M))},_toPolygon:function(B,O,M){var C=this.map,W=new u(C.spatialReference);W.addRing(q.map(B,function(Y){return C.toMap({x:Y[0]+
O,y:Y[1]+M})}));return W},_onDblClickHandler:function(B){var O=this._points,M=this.map.spatialReference,C=F;x("esri-touch")&&O.push(B.mapPoint);var W=O[O.length-1],Y=O[O.length-2];O=W&&Y&&W.x===Y.x&&W.y===Y.y?O.slice(0,O.length-1):O.slice(0,O.length);switch(this._geometryType){case C.POLYLINE:if(!this._graphic||2>O.length){K.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(B);return}var R=new H(M);R.addPath([].concat(O));break;case C.POLYGON:if(!this._graphic||3>O.length)return;
R=new u(M);B=[].concat(O,[O[0].offset(0,0)]);u.prototype.isClockwise(B)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),B.reverse());R.addRing(B);break;case C.MULTI_POINT:R=new G(M),q.forEach(O,function(S){R.addPoint(S)})}K.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(R)},_onKeyDownHandler:function(B){B.keyCode===n.ESCAPE&&(K.disconnect(this._onMouseMoveHandler_connect),
this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(B){this._options.showTooltips&&(B?this._tooltip||(this._tooltip=g.create("div",{"class":"esriMapTooltip"},this.map.container),l.isBodyLtr()||m.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=K.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=K.connect(this.map,
"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=K.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(K.disconnect(this._onTooltipMouseEnterHandler_connect),K.disconnect(this._onTooltipMouseLeaveHandler_connect),K.disconnect(this._onTooltipMouseMoveHandler_connect),g.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var B=this._tooltip;B&&(B.style.display="none")},_setTooltipMessage:function(B){var O=this._tooltip;if(O){var M="";switch(this._geometryType){case F.POINT:M=
t.toolbars.draw.addPoint;break;case F.ARROW:case F.LEFT_ARROW:case F.RIGHT_ARROW:case F.UP_ARROW:case F.DOWN_ARROW:case F.TRIANGLE:case F.RECTANGLE:case F.CIRCLE:case F.ELLIPSE:M=t.toolbars.draw.addShape;break;case F.LINE:case F.EXTENT:case F.FREEHAND_POLYLINE:case F.FREEHAND_POLYGON:M=t.toolbars.draw.freehand;break;case F.POLYLINE:case F.POLYGON:M=t.toolbars.draw.start;1===B?M=t.toolbars.draw.resume:2<=B&&(M=t.toolbars.draw.complete);break;case F.MULTI_POINT:M=t.toolbars.draw.addMultipoint,1<=B&&
(M=t.toolbars.draw.finish)}O.innerHTML=M}},_updateTooltip:function(B){var O=this._tooltip;if(O){if(B.clientX||B.pageY){var M=B.clientX;B=B.clientY}else M=B.clientX+w.body().scrollLeft-w.body().clientLeft,B=B.clientY+w.body().scrollTop-w.body().clientTop;O.style.display="none";m.set(O,{left:M+this._options.tooltipOffset+"px",top:B+"px"});O.style.display=""}},_redrawGraphic:function(B,O,M,C){(M||this.map.wrapAround180)&&(B=this._graphic)&&B.setGeometry(B.geometry)},onActivate:function(){},onDeactivate:function(){},
onDrawComplete:function(){},onDrawStart:function(){},onDrawEnd:function(){}});J.mixin(F,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});x("extend-esri")&&J.setObject("toolbars.Draw",F,f);return F})},
"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(L,J,q,K,E,w,x,A){L=L(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var n=q.map(this.geometries,function(m){return m.toJson()}),g={};g.outSR=this.outSR.wkid||K.toJson(this.outSR.toJson());g.inSR=this.geometries[0].spatialReference.wkid||
K.toJson(this.geometries[0].spatialReference.toJson());g.geometries=K.toJson({geometryType:A.getJsonType(this.geometries[0]),geometries:n});this.transformation&&(g.transformation=this.transformation.wkid||K.toJson(this.transformation));x.isDefined(this.transformForward)&&(g.transformForward=this.transformForward);return g}});E("extend-esri")&&J.setObject("tasks.ProjectParameters",L,w);return L})},"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/Tooltip.html":'\x3cdiv class\x3d"dijitTooltip dijitTooltipLeft" id\x3d"dojoTooltip" data-dojo-attach-event\x3d"mouseenter:onMouseEnter,mouseleave:onMouseLeave"\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipConnector" data-dojo-attach-point\x3d"connectorNode"\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipContainer dijitTooltipContents" data-dojo-attach-point\x3d"containerNode" role\x3d\'alert\'\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/TextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/ValidationTextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/form/templates/Button.html":'\x3cspan class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonNode"\r\n\t\tdata-dojo-attach-event\x3d"ondijitclick:__onClick" role\x3d"presentation"\r\n\t\t\x3e\x3cspan class\x3d"dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode,focusNode"\r\n\t\t\trole\x3d"button" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitToggleButtonIconChar"\x3e\x26#x25CF;\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tid\x3d"${id}_label"\r\n\t\t\t\tdata-dojo-attach-point\x3d"containerNode"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\x3e\x3c/span\r\n\t\x3e\x3c/span\r\n\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" class\x3d"dijitOffScreen"\r\n\t\tdata-dojo-attach-event\x3d"onclick:_onClick"\r\n\t\ttabIndex\x3d"-1" aria-hidden\x3d"true" data-dojo-attach-point\x3d"valueNode"\r\n/\x3e\x3c/span\x3e\r\n',
"url:dijit/form/templates/DropDownButton.html":'\x3cspan class\x3d"dijit dijitReset dijitInline"\r\n\t\x3e\x3cspan class\x3d\'dijitReset dijitInline dijitButtonNode\'\r\n\t\tdata-dojo-attach-event\x3d"ondijitclick:__onClick" data-dojo-attach-point\x3d"_buttonNode"\r\n\t\t\x3e\x3cspan class\x3d"dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"focusNode,titleNode,_arrowWrapperNode,_popupStateNode"\r\n\t\t\trole\x3d"button" aria-haspopup\x3d"true" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitIcon"\r\n\t\t\t\tdata-dojo-attach-point\x3d"iconNode"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tdata-dojo-attach-point\x3d"containerNode"\r\n\t\t\t\tid\x3d"${id}_label"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitArrowButtonInner"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitArrowButtonChar"\x3e\x26#9660;\x3c/span\r\n\t\t\x3e\x3c/span\r\n\t\x3e\x3c/span\r\n\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" class\x3d"dijitOffScreen" tabIndex\x3d"-1"\r\n\t\tdata-dojo-attach-event\x3d"onclick:_onClick" data-dojo-attach-point\x3d"valueNode" aria-hidden\x3d"true"\r\n/\x3e\x3c/span\x3e\r\n',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/templates/Directions.html":'\x3cdiv class\x3d"${options.theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_widgetContainer" class\x3d"${_css.widgetContainerClass}" role\x3d"presentation"\x3e\r\n        \x3cdiv class\x3d"${_css.stopsContainerClass}" role\x3d"presentation"\x3e\r\n            \x3cdiv id\x3d"search-source-container" class\x3d"${_css.searchSourceContainerClass}" data-dojo-attach-point\x3d"_searchSourceContainerNode"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_searchSourceSelectorContainer"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsTableContainerClass}"\x3e\r\n                \x3ctable class\x3d"${_css.stopsClass}" data-dojo-attach-point\x3d"_dndNode"\x3e\x3c/table\x3e\r\n                \x3cdiv class\x3d"${_css.stopsTableCoverClass}" data-dojo-attach-point\x3d"_stopsTableCover"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsButtonContainerClass}"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsAddDestinationClass}"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_activateButtonNode" title\x3d"${_i18n.widgets.directions.activate}" class\x3d"${_css.activateButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_lineBarrierButtonNode" title\x3d"${_i18n.widgets.directions.lineBarrier}" class\x3d"${_css.lineBarrierButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"${_css.linkButtonClass} ${_css.stopsAddDestinationBtnClass}" data-dojo-attach-point\x3d"_addDestinationNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.addDestination}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.travelModesContainerClass}" data-dojo-attach-point\x3d"_travelModeContainerNode"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_travelModeSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} startTimeMenuButton" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_startTimeButtonNodeContainer"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_startTimeButtonNode"\x3e\r\n                        \x3cspan data-dojo-attach-point\x3d"_startTimeButtonLabel"\x3e${_i18n.widgets.directions.leaveNow}\x3c/span\x3e\r\n                        \x3cdiv data-dojo-attach-point\x3d"_startTimeDDLArrow" class\x3d"esriDirectionsDDLArrow"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"startTimeMenu" data-dojo-attach-point\x3d"_startTimeMenu"\x3e\r\n                        \x3cul role\x3d"menu"\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuLeaveNow" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio" aria-checked\x3d"true"\x3e${_i18n.widgets.directions.leaveNow}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuDepartAt" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.departAt}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuNone" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.noStartTime}\x3c/li\x3e\r\n                        \x3c/ul\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsOptionsButtonClass}" data-dojo-attach-point\x3d"_optionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.showOptions}\x3c/div\x3e\r\n            \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3cdiv class\x3d"departAtContainer" data-dojo-attach-point\x3d"_departAtContainer"\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtTime" data-dojo-attach-point\x3d"_departAtTimeContainer"\x3e\x3c/div\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtDate" data-dojo-attach-point\x3d"_departAtDateContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass}" data-dojo-attach-point\x3d"_optionsMenuNode"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsCheckboxesClass}"\x3e\r\n                    \x3cul\x3e\r\n                        \x3cli class\x3d"${_css.stopsFindOptimalOrderClass}" data-dojo-attach-point\x3d"_findOptimalOrderItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_findOptimalOrderNode" type\x3d"checkbox" id\x3d"${id}_find_optimal_order" /\x3e\x3clabel for\x3d"${id}_find_optimal_order"\x3e${_i18n.widgets.directions.findOptimalOrder}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsReturnToStartClass}" data-dojo-attach-point\x3d"_returnToStartItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_returnToStartNode" type\x3d"checkbox" id\x3d"${id}_stopsReturnToStart" /\x3e\x3clabel for\x3d"${id}_stopsReturnToStart"\x3e${_i18n.widgets.directions.returnToStart}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsUseTrafficClass}" data-dojo-attach-point\x3d"_useTrafficItemNode" title\x3d"${_i18n.widgets.directions.trafficLabelLive}"\x3e\r\n                            \x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_useTrafficNode" type\x3d"checkbox" id\x3d"${id}_stopsUseTraffic" /\x3e\x3clabel for\x3d"${id}_stopsUseTraffic"\x3e${_i18n.widgets.directions.useTraffic}\x3c/label\x3e\r\n                            \x3ca data-dojo-attach-point\x3d"_trafficAvailabilityButton" style\x3d"display: none;" href\x3d"http://www.arcgis.com/home/item.html?id\x3db7a893e8e1e04311bd925ea25cb8d7c7" target\x3d"_blank"\x3e\x3cdiv class\x3d"esriTrafficAvailabilityButton" title\x3d"${_i18n.widgets.directions.seeTrafficAvailability}"\x3e\x3c/div\x3e\x3c/a\x3e\r\n                        \x3c/li\x3e\r\n                    \x3c/ul\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsToggleContainerClass}"\x3e\r\n                    \x3cdiv class\x3d"${_css.stopsOptionsUnitsContainerClass}"  data-dojo-attach-point\x3d"_agolDistanceUnitsNode"\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsMiClass} ${_css.stopsButtonClass}" data-dojo-attach-point\x3d"_useMilesNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriMiles.abbr}\x3c/div\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsKmClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabLastClass} ${_css.stopsPressedButtonClass}" data-dojo-attach-point\x3d"_useKilometersNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriKilometers.abbr}\x3c/div\x3e\r\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsGetDirectionsContainerClass}"\x3e\r\n                \x3cdiv class\x3d"getDirectionsBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} ${_css.stopsGetDirectionsClass} esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_getDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.getDirections}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsClearDirectionsClass}" data-dojo-attach-point\x3d"_clearDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.clearDirections}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"savePrintBtnContainer" data-dojo-attach-point\x3d"_savePrintBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsSaveClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_saveMenuButton" title\x3d"${_i18n.widgets.directions.saveTitle}" \x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsPrintClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_printButton" title\x3d"${_i18n.widgets.directions.print}" \x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass} esriSaveContainer" data-dojo-attach-point\x3d"_saveMenuNode"\x3e\r\n                \x3cdiv class\x3d"esriLayerNameLabel"\x3e${_i18n.widgets.directions.layerName}\x3c/div\x3e\r\n                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"_outputLayerContainer"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_folderSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} esriSaveButton esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_saveButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.save}\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriLinkButton esriSaveAsButton" data-dojo-attach-point\x3d"_saveAsButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.saveAs}\x3c/div\x3e\r\n            \x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n    \t\x3cdiv data-dojo-attach-point\x3d"_msgNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" role\x3d"presentation"\x3e\r\n        \t\x3cdiv class\x3d"${_css.routesContainerClass}" data-dojo-attach-point\x3d"_resultsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/Search/templates/Search.html":'\x3cdiv role\x3d"presentation" class\x3d"${theme}"\x3e\r\n  \x3cdiv role\x3d"presentation" class\x3d"${css.searchGroup}" data-dojo-attach-point\x3d"containerNode"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"expandNode" class\x3d"${css.searchExpandContainer}"\x3e\r\n      \x3cdiv class\x3d"${css.searchAnimateContainer}"\x3e\r\n        \x3cdiv role\x3d"button" title\x3d"${_i18n.widgets.Search.main.searchIn}" id\x3d"${id}_menu_button" class\x3d"${css.searchBtn} ${css.searchToggle}" tabindex\x3d"0" data-dojo-attach-point\x3d"sourcesBtnNode"\x3e\r\n          \x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${css.searchToggleIcon}"\x3e\x3c/span\x3e\x3cspan class\x3d"${css.searchSourceName}" data-dojo-attach-point\x3d"sourceNameNode"\x3e\x3c/span\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"${css.searchInputGroup}"\x3e\r\n          \x3cform data-dojo-attach-point\x3d"formNode"\x3e\r\n            \x3cinput maxlength\x3d"${maxLength}" autocomplete\x3d"off" type\x3d"text" tabindex\x3d"0" class\x3d"${css.searchInput}" value\x3d"${value}" aria-haspopup\x3d"true" id\x3d"${id}_input" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\r\n          \x3c/form\x3e\r\n          \x3cdiv role\x3d"button" class\x3d"${css.searchClear}" tabindex\x3d"0" data-dojo-attach-point\x3d"clearNode"\x3e\x3cspan aria-hidden\x3d"true" class\x3d"${css.searchClearIcon}"\x3e\x3c/span\x3e\x3cspan aria-hidden\x3d"true" class\x3d"${css.searchSpinner}"\x3e\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"suggestionsNode" class\x3d"${css.searchMenu} ${css.suggestionsMenu}"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv role\x3d"button" title\x3d"${_i18n.widgets.Search.main.searchButtonTitle}" class\x3d"${css.searchBtn} ${css.searchSubmit}" tabindex\x3d"0" data-dojo-attach-point\x3d"submitNode"\x3e\r\n      \x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${css.searchIcon}"\x3e\x3c/span\x3e\r\n      \x3cspan class\x3d"${css.searchButtonText}"\x3e${_i18n.widgets.Search.main.searchButtonTitle}\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"sourcesNode" class\x3d"${css.searchMenu} ${css.sourcesMenu}"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"noResultsMenuNode" class\x3d"${css.searchMenu} ${css.searchNoResultsMenu}"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"${css.searchClearFloat}"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"*now":function(L){L(['dojo/i18n!*preload*esri/dijit/nls/Directions*["ar","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("esri/dijit/Directions","require dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/array dojo/_base/Color dijit/a11yclick dijit/_TemplatedMixin dijit/form/Select dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/TimeTextBox dojo/store/Memory dojo/data/ObjectStore dojo/keys dojo/has dojo/on dojo/mouse dojo/dom dojo/dom-geometry dojo/dom-style dojo/dom-class dojo/dom-attr dojo/query dojo/number dojo/i18n!../nls/jsapi dojo/text!./templates/Directions.html ./Search dojo/dom-construct dojo/promise/all dojo/Deferred dojo/dnd/Source dojo/json ../kernel ../urlUtils ../graphic ../units ../TimeExtent ../InfoTemplate ../SpatialReference ../layers/ArcGISDynamicMapServiceLayer ../layers/GraphicsLayer ../geometry/webMercatorUtils ../geometry/geodesicUtils ../arcgis/utils ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/mathUtils ../symbols/SimpleMarkerSymbol ../symbols/PictureMarkerSymbol ../symbols/CartographicLineSymbol ../symbols/TextSymbol ../renderers/UniqueValueRenderer ../symbols/Font ./_EventedWidget ../tasks/FeatureSet ../tasks/RouteTask ../tasks/RouteParameters ../tasks/GeometryService ../tasks/DistanceParameters ../tasks/PrintTask ../tasks/PrintParameters ../tasks/PrintTemplate ../toolbars/edit ../toolbars/draw ../config ../tasks/ProjectParameters dojo/uacss".split(" "),function(L,
J,q,K,E,w,x,A,n,g,m,l,f,b,c,a,e,d,h,y,I,H,u,G,v,t,F,B,O,M,C,W,Y,R,S,T,Z,qa,ta,Ba,Oa,Ia,Ra,Va,ab,Q,ba,ia,ha,ua,Ga,ea,va,xa,Da,ya,Ja,Qa,Ma,Na,Xa,bb,fb,Pa,r,N,X,ca){var ka=S.getProtocolForWebResource(),ra=B.createSubclass({_setSourcesAttr:function(k){k&&(k=k.map(function(z){z.locator&&null==z.locationType&&(z=q.mixin({locationType:"street"},z));return z}));this.inherited(arguments,[k])}});J=J("esri.dijit.Directions",[ya,A],{templateString:F,mapClickActive:!1,barrierToolActive:!1,_eventMap:{activate:!0,
deactivate:!1,load:!0,"directions-start":!0,"directions-finish":["result"],"directions-clear":!0,"segment-select":["graphic"],"segment-highlight":["graphic"],error:["error"],"stops-update":["stops"],"route-item-created":!0,"route-item-updated":!0,"feature-collection-created":!0},_emptyStop:{name:""},constructor:function(k,z){if(!k.map)throw Error('Required "map" parameter is missing. Cannot instantiate Directions Widget.');if(!z)throw Error('Required "srcNodeRef" parameter is missing. Cannot instantiate Directions Widget.');
this._i18n=t;this._css={widgetContainerClass:"esriDirectionsContainer",searchSourceContainerClass:"esriSearchSourceContainer",stopsContainerClass:"esriStopsContainer",stopsTableContainerClass:"esriStopsTableContainer",stopsTableCoverClass:"esriStopsTableCover",reverseStopsClass:"esriStopsReverse",addStopsClass:"esriStopsAdd",stopsClass:"esriStops",stopsRemovableClass:"esriStopsRemovable",stopsButtonContainerClass:"esriStopsButtons",stopsOptionsButtonClass:"esriStopsOptionsButton",stopsAddDestinationClass:"esriStopsAddDestination",
stopsAddDestinationBtnClass:"esriStopsAddDestinationBtn",stopsGetDirectionsContainerClass:"esriStopsGetDirectionsContainer",stopsGetDirectionsClass:"esriStopsGetDirections",stopsClearDirectionsClass:"esriStopsClearDirections",stopsInnerGeocoderClass:"esriInnerGeocoder",stopsOptionsOptionsEnabledClass:"esriStopsOptionsEnabled",stopsOptionsMenuClass:"esriStopsOptionsMenu",stopsFindOptimalOrderClass:"esriFindOptimalOrderOption",stopsUseTrafficClass:"esriUseTrafficOption",stopsReturnToStartClass:"esriReturnToStartOption",
stopsOptionsCheckboxesClass:"esriOptionsCheckboxes",stopsOptionsToggleContainerClass:"esriOptionsToggleContainer",stopsOptionsUnitsContainerClass:"esriOptionsUnitsContainer",stopsOptionsUnitsMiClass:"esriOptionsUnitsMi",stopsOptionsUnitsKmClass:"esriOptionsUnitsKm",stopsOptionsImpedanceContainerClass:"esriOptionsImpedanceContainer",stopsOptionsImpedanceTimeClass:"esriOptionsImpedanceTime",stopsOptionsImpedanceDistanceClass:"esriOptionsImpedanceDistance",stopClass:"esriStop",stopOriginClass:"esriStopOrigin",
stopDestinationClass:"esriStopDestination",stopUnreachedFirstOrLastClass:"esriStopUnreachedFirstOrLast",stopUnreachedClass:"esriStopUnreached",esriStopGeocoderColumnClass:"esriStopGeocoderColumn",esriStopReverseColumnClass:"esriStopReverseColumn",stopDnDHandleClass:"esriStopDnDHandle",stopDnDHandleClassHidden:"esriStopDnDHandleHidden",stopIconColumnClass:"esriStopIconColumn",stopIconClass:"esriStopIcon",stopIconRemoveColumnClass:"esriStopIconRemoveColumn",stopIconRemoveClass:"esriStopIconRemove",
stopIconRemoveClassHidden:"esriStopIconRemoveHidden",resultsContainerClass:"esriResultsContainer",resultsLoadingClass:"esriResultsLoading",resultsPrintClass:"esriResultsPrint",resultsSaveClass:"esriResultsSave",resultsSummaryClass:"esriResultsSummary",routesContainerClass:"esriRoutesContainer",routesClass:"esriRoutes",routesErrorClass:"esriRoutesError",routesInfoClass:"esriRoutesInfo",routeClass:"esriRoute",routeTextColumnClass:"esriRouteTextColumn",routeTextClass:"esriRouteText",routeLengthClass:"esriRouteLength",
routeOriginClass:"esriDMTStopOrigin",routeDestinationClass:"esriDMTStopDestination",routeInfoClass:"esriRouteInfo",routeIconColumnClass:"esriRouteIconColumn",routeIconClass:"esriRouteIcon",infoWindowRouteClass:"esriInfoWindowRoute",routeZoomClass:"esriRouteZoom",esriPrintPageClass:"esriPrintPage",esriPrintBarClass:"esriPrintBar",esriPrintButtonClass:"esriPrintButton",esriCloseButtonClass:"esriCloseButton",esriPrintMainClass:"esriPrintMain",esriPrintHeaderClass:"esriPrintHeader",esriPrintLogoClass:"esriPrintLogo",
esriPrintMapClass:"esriPrintMap",esriPrintNameClass:"esriPrintName",esriPrintNotesClass:"esriPrintNotes",esriPrintLengthClass:"esriPrintLength",esriPrintDirectionsClass:"esriPrintDirections",esriPrintFooterClass:"esriPrintFooter",esriPrintStopLabelClass:"esriPrintStopLabel",clearClass:"esriClear",dndDragBodyClass:"esriDndDragDirection",stopsButtonClass:"esriDirectionsButton",stopsButtonTabClass:"esriDirectionsTabButton",stopsButtonTabLastClass:"esriDirectionsTabLastButton",stopsPressedButtonClass:"esriDirectionsPressedButton",
linkButtonClass:"esriLinkButton",activateButtonClass:"esriActivateButton",lineBarrierButtonClass:"esriLineBarrierButton",travelModesContainerClass:"esriTravelModesContainer"};this.options={map:null,autoSolve:!0,minStops:2,maxStops:20,theme:"simpleDirections",alphabet:"1234567890",directions:null,returnToStart:!1,optimalRoute:!1,routeTaskUrl:ka+"//route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",printTaskUrl:ka+"//utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",
geometryTaskUrl:ka+"//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",routeParams:{},stops:["",""],searchOptions:{},stopsInfoTemplate:new ta(t.widgets.directions.stop,"${address}${error}"),waypointInfoTemplate:new ta(t.widgets.directions.maneuver,t.widgets.directions.waypoint),segmentInfoTemplate:new ta(t.widgets.directions.maneuver,'\x3cdiv class\x3d"${maneuverType}"\x3e\x3cdiv class\x3d"'+this._css.routeIconClass+" "+this._css.infoWindowRouteClass+'"\x3e\x3cstrong\x3e${step}.\x3c/strong\x3e ${formattedText}\x3c/div\x3e\x3c/div\x3e'),
textSymbolFont:new Da("11px",Da.STYLE_NORMAL,Da.VARIANT_NORMAL,Da.WEIGHT_NORMAL,"Arial, Helvetica, sans-serif"),textSymbolColor:new w([255,255,255]),textSymbolOffset:{x:0,y:10.875},fromSymbol:(new Ga({url:L.toUrl("./images/Directions/greenPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),fromSymbolDrag:(new Ga({url:L.toUrl("./images/Directions/greenPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbol:(new Ga({url:L.toUrl("./images/Directions/bluePoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbolDrag:(new Ga({url:L.toUrl("./images/Directions/bluePointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbol:(new Ga({url:L.toUrl("./images/Directions/redPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbolDrag:(new Ga({url:L.toUrl("./images/Directions/redPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbol:(new Ga({url:L.toUrl("./images/Directions/grayPoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbolDrag:(new Ga({url:L.toUrl("./images/Directions/grayPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),waypointSymbol:new ua({color:[255,255,255,255],size:10,type:"esriSMS",style:"esriSMSCircle",outline:{color:[20,89,127,255],width:2.5,type:"esriSLS",style:"esriSLSSolid"}}),maneuverSymbol:new ua({color:[255,255,255,255],size:4,type:"esriSMS",style:"esriSMSCircle",outline:{color:[30,99,137,255],
width:1,type:"esriSLS",style:"esriSLSSolid"}}),routeSymbol:(new ea).setColor(new w([20,89,127,.75])).setWidth(10).setCap(ea.CAP_ROUND).setJoin(ea.JOIN_ROUND),segmentSymbol:(new ea).setColor(new w([255,255,255,1])).setWidth(6).setCap(ea.CAP_ROUND).setJoin(ea.JOIN_ROUND),barrierRenderer:new xa({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjIyIiBoZWlnaHQ9IjIyMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z181IiByeD0iMTAwIiByeT0iMTAwIi8+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z182IiByeD0iOTUiIHJ5PSI5NSIvPgo8cmVjdCBmaWxsPSIjZmYwMDAwIiBzdHJva2Utd2lkdGg9IjIwIiB4PSI2NC41IiB5PSIxMDIiIHdpZHRoPSI5NSIgaGVpZ2h0PSIxOCIgaWQ9InN2Z183IiBzdHJva2U9IiNmZmZmZmYiLz4KPC9nPgo8L3N2Zz4\x3d",
contentType:"image/svg+xml",width:18,height:18},uniqueValueInfos:[{value:"2",symbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjg2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZS13aWR0aD0iMTAiIGQ9Im04Ljc0OTk5MiwyNTEuNzQ5OTk3bDEzNC45OTk5OTgsLTI0MS45OTk5OThsMTM0Ljk5OTk5OCwyNDEuOTk5OTk4bC0yNjkuOTk5OTk1LDBsLTAuMDAwMDAxLDB6IiBpZD0ic3ZnXzEiIHN0cm9rZT0iIzAwMCIvPgo8cGF0aCBzdHJva2U9IiNmZmYiIGZpbGw9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMTUiIGQ9Im0yMy41MDAwMDQsMjQyLjUwMDAwNWwxMTkuOTk5OTkyLC0yMTUuOTk5OTk5bDExOS45OTk5OTIsMjE1Ljk5OTk5OWwtMjM5Ljk5OTk4MywwbC0wLjAwMDAwMSwweiIgaWQ9InN2Z18yIi8+Cjx0ZXh0IGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjZmZmZmZmIiBzdHJva2U9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMCIgeD0iMTA5IiB5PSIyMjIuNzUiIGlkPSJzdmdfNSIgZm9udC1zaXplPSIxODAiIGZvbnQtZmFtaWx5PSJHZW9yZ2lhLCBUaW1lcywgJ1RpbWVzIE5ldyBSb21hbicsIHNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiPiE8L3RleHQ+CjwvZz4KPC9zdmc+",
contentType:"image/svg+xml",width:19,height:18}}]}),polylineBarrierRenderer:new xa({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,85,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"}}]}),polygonBarrierRenderer:new xa({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,156],outline:{color:[255,0,0,153],width:2.4,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",
style:"esriSFSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,170,0,156],outline:{color:[255,0,0,153],width:7.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]}),printPage:"",printTemplate:"",focusOnNewStop:!0,dragging:!0,canModifyStops:!0,canModifyWaypoints:!0,directionsLengthUnits:null,directionsLanguage:null,traffic:!1,trafficLayer:null,showPrintPage:!0,showSaveButton:!1,showSegmentPopup:!1,showSegmentHighlight:!0,showReverseStopsButton:!0,showReturnToStartOption:!0,
showOptimalRouteOption:!0,showTravelModesOption:!0,showMilesKilometersOption:!0,showClearButton:!1,showActivateButton:!0,showBarriersButton:!0,loaded:!1,routeLayer:{itemId:null,title:null,isItemOwner:!0,ownerFolder:null},startTime:"now"};this.userOptions=k;this.defaults=q.mixin({},this.options,k,{_waypointName:"DWWP",_userDefinedStopName:"UserDefinedStopName",_solveInProgress:!1,_moveInProgress:!1,_stopSequence:1E3});if(!this.defaults.minStops||2>this.defaults.minStops)this.defaults.minStops=2;if(2<
this.defaults.minStops&&this.defaults.stops&&","===this.defaults.stops.toString())for(k=2;k<this.defaults.minStops;k++)this.defaults.stops.splice(0,0,"");this.domNode=z},postCreate:function(){this.inherited(arguments);this.own(e(this._activateButtonNode,x,q.hitch(this,function(){this.mapClickActive?this.deactivate():this.activate()})));this.own(e(this._lineBarrierButtonNode,x,q.hitch(this,function(){this.barrierToolActive?this.deactivateBarrierTool():this.activateBarrierTool()})));this.own(e(this._addDestinationNode,
x,q.hitch(this,this._addStopButton)));this.own(e(this._optionsButtonNode,x,q.hitch(this,this._toggleOptionsMenu)));this.own(e(this._saveMenuButton,x,q.hitch(this,this._toggleSaveMenu)));this.own(e(this._saveButton,x,q.hitch(this,function(){this._saveButton._enabled&&this._storeRouteUI()})));this.own(e(this._saveAsButton,x,q.hitch(this,function(){q.mixin(this.routeLayer,{itemId:null,title:null,ownerFolder:null});this._storeRouteUI()})));this.own(e(this._findOptimalOrderNode,x,q.hitch(this,this._toggleCheckbox)));
this.own(e(this._returnToStartNode,x,q.hitch(this,this._toggleCheckbox)));this.own(e(this._useTrafficNode,x,q.hitch(this,this._toggleCheckbox)));this.own(e(this._useMilesNode,x,q.hitch(this,this._toggleUnits)));this.own(e(this._useKilometersNode,x,q.hitch(this,this._toggleUnits)));this.own(e(this._getDirectionsButtonNode,x,q.hitch(this,this.getDirections)));this.own(e(this._clearDirectionsButtonNode,x,q.hitch(this,function(){this.clearDirections()})));var k=q.hitch(this,function(){clearTimeout(this._startTimeMenu._hideTimer);
this._startTimeMenu._hideTimer=setTimeout(q.hitch(this,function(){I.set(this._startTimeMenu,"display","none")}),100)});this.own(e(this._startTimeButtonNode,x,q.hitch(this,function(){this._startTimeButtonNode.disabled||"block"===I.get(this._startTimeMenu,"display")?I.set(this._startTimeMenu,"display","none"):(I.set(this._startTimeMenu,"display","block"),this["now"===this.startTime?"_startTimeMenuLeaveNow":"none"===this.startTime?"_startTimeMenuNone":"_startTimeMenuDepartAt"].focus())})));this.own(e(this._startTimeMenuLeaveNow,
"blur",k));this.own(e(this._startTimeMenuDepartAt,"blur",k));this.own(e(this._startTimeMenuNone,"blur",k));this.own(e(this._startTimeMenuLeaveNow,"mousedown",q.hitch(this,function(){this.startTime="now";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(e(this._startTimeMenuDepartAt,"mousedown",q.hitch(this,function(){this.startTime=(new Date).getTime();this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(e(this._startTimeMenuNone,"mousedown",q.hitch(this,function(){this.startTime=
"none";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this._symbolEventPaddingDirections=(new ea).setColor(new w([0,255,0,0])).setWidth(20).setCap(ea.CAP_ROUND);this._stopLayer=new Ia({id:"directions_stopLayer_"+this.id,displayOnPan:!0});this._routeLayer=new Ia({id:"directions_routeLayer_"+this.id,displayOnPan:!0});this._waypointsEventLayer=new Ia({id:"directions_waypointsEventLayer_"+this.id,displayOnPan:!0});this._barriersLayer=new Ia({id:"directions_barriersLayer_"+this.id,displayOnPan:!0});
this._polylineBarriersLayer=new Ia({id:"directions_polylineBarriersLayer_"+this.id,displayOnPan:!0});this._polygonBarriersLayer=new Ia({id:"directions_polygonBarriersLayer_"+this.id,displayOnPan:!0});this._barriersLayer.setRenderer(this.defaults.barrierRenderer);this._polylineBarriersLayer.setRenderer(this.defaults.polylineBarrierRenderer);this._polygonBarriersLayer.setRenderer(this.defaults.polygonBarrierRenderer);this.map&&(this.map.addLayer(this._routeLayer),this.map.addLayer(this._polygonBarriersLayer),
this.map.addLayer(this._polylineBarriersLayer),this.map.addLayer(this._barriersLayer),this.map.addLayer(this._stopLayer),this._externalTimeExtent=this.map.timeExtent);this._snappingManager=this.map.enableSnapping({layerInfos:[{layer:this._waypointsEventLayer,snapToVertex:!1,snapToPoint:!0,snapToEdge:!0}],tolerance:15});this._setWidgetProperties();var z=new T(null,this.waypointSymbol,{});k=q.hitch(this,function(){this._moveInProgress||this._solveInProgress||!z._isShown()||(this.editToolbar.deactivate(),
this._stopLayer.remove(z),clearTimeout(z._solveTimeout),z._solveTimeout=null,z.attributes.isWaypoint=!0,z._isStopIcon&&this.stopGraphics[z._index]&&(this._stopLayer.add(this.stopGraphics[z._index]),this._stopLayer.add(this.textGraphics[z._index])));z._showTooltip()});this._handle=q.mixin(z,{_isHandle:!0,_tooltip:O.create("div",{className:this.theme+" esriDirectionsRouteTooltip",onmouseover:k},this.map.container),_showTooltip:q.hitch(this,function(P){z._tooltip.style.display=!P||P instanceof MouseEvent?
"none":"inline";P&&(P="string"===typeof P?P:"\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(P)+"\x3c/table\x3e",z._tooltip.innerHTML!==P&&(z._tooltip.innerHTML=P))}),_isShown:q.hitch(this,function(){return-1<E.indexOf(this._stopLayer.graphics,z)}),_remove:k});this._activate(this.mapClickActive)},startup:function(){this.inherited(arguments);return this._enqueue(this._init)},destroy:function(){this.deactivate();this.map.removeLayer(this._barriersLayer);this.map.removeLayer(this._polylineBarriersLayer);
this.map.removeLayer(this._polygonBarriersLayer);this.map.removeLayer(this._routeLayer);this.map.removeLayer(this._stopLayer);this.map.removeLayer(this._waypointsEventLayer);this._disconnectEvents();O.empty(this.domNode);this.inherited(arguments)},activate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(q.hitch(this,function(){this.set("mapClickActive",!0)}))})},deactivate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(q.hitch(this,function(){this.set("mapClickActive",
!1)}))})},activateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!0)})},deactivateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!1)})},clearDirections:function(){return this._enqueue(function(){this.clearMessages();return this._clearDirections()})},reset:function(){return this._enqueue(this._reset)},modifyStopSequence:function(k,z){return this._enqueue(function(){return this._modifyStopSequence(k,
z)})},onActivate:function(){},onDeactivate:function(){},onActivateBarrierTool:function(){},onDeactivateBarrierTool:function(){},onLoad:function(){this._enableButton(this._getDirectionsButtonNode)},onDirectionsStart:function(){this._clearDisplayBeforeSolve();this.set("solving",!0);this._showLoadingSpinner(!0)},onDirectionsFinish:function(){this._showLoadingSpinner(!1);this.set("solving",!1)},onDirectionsClear:function(){},onSegmentSelect:function(){},onSegmentHighlight:function(){},onStopsUpdate:function(){},
onRouteItemCreated:function(){},onRouteItemUpdated:function(){},onFeatureCollectionCreated:function(){},onError:function(){},removeStops:function(){return this.reset()},removeStop:function(k,z,P){return this._enqueue(function(){this.clearMessages();return this._removeStop(k,z,P)})},updateStops:function(k){return this._enqueue(function(){return this._updateStops(k)})},addStops:function(k,z){return this._enqueue(function(){return this._addStops(k,z)}).then(q.hitch(this,this.zoomToFullRoute))},addStop:function(k,
z){return this._enqueue(function(){return this._addStop(k,z)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},updateStop:function(k,z,P){return this._enqueue(function(){return this._updateStop(k,z,P)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},setBarriers:function(k){this.routeParams.barriers=k;return this._getDirections().then(q.hitch(this,function(){this.zoomToFullRoute()}))},setPolylineBarriers:function(k){this.routeParams.polylineBarriers=k;return this._getDirections().then(q.hitch(this,
function(){this.zoomToFullRoute()}))},setPolygonBarriers:function(k){this.routeParams.polygonBarriers=k;return this._getDirections().then(q.hitch(this,function(){this.zoomToFullRoute()}))},clearMessages:function(){this.messages=[];this._msgNode&&(this._msgNode.innerHTML="")},getDirections:function(k){return this._enqueue(function(){return this._getDirections().then(q.hitch(this,function(){!0!==k&&this.zoomToFullRoute()}))})},selectSegment:function(k){if(!(!this.directions||!this.directions.features||
0>k||k>=this.directions.features.length))for(var z=G("[data-segment]",this._resultsNode),P=0;P<z.length;P++){var V=parseInt(u.get(z[P],"data-segment"),10);if(k===V&&z[P]!==this._focusedDirectionsItem){this._focusedDirectionsItem=z[P];this.centerAtSegmentStart(k);this.onSegmentSelect(this.directions.features[k]);z[P].focus();break}}},unhighlightSegment:function(k){var z=this._segmentGraphics;if(z&&(!this._focusedDirectionsItem||k)){for(k=0;k<z.length;k++)this._routeLayer.remove(z[k]);this._segmentGraphics=
[]}},highlightSegment:function(k,z){if(!(this._focusedDirectionsItem&&!z||k>=this.directions.features.length)){k=k||0;var P=q.hitch(this,function(Ya){var Wa=this.map.toMap({x:0,y:0});return this.map.toScreen(Wa.offset(Ya,0)).x}),V=q.hitch(this,function(Ya){for(var Wa=0,Za=0;Za<Ya.length;Za++)for(var ib=1;ib<Ya[Za].length;ib++){var ob=Ya[Za][ib-1],kb=Ya[Za][ib];Wa+=P(Math.sqrt((ob[0]-kb[0])*(ob[0]-kb[0])+(ob[1]-kb[1])*(ob[1]-kb[1])))}return Wa}),U=q.hitch(this,function(Ya){var Wa=this.map.toMap({x:0,
y:0});return this.map.toMap({x:Ya,y:0}).x-Wa.x}),aa=function(Ya,Wa,Za){Wa=Math.max(1,Wa);for(var ib=Za?Ya[0].length-1:0,ob=0,kb,jb,hb,cb=[[Ya[0][Za?ib:0]]];Za&&0<ib||!Za&&ib<Ya[0].length-1;){jb=Ya[0][Za?ib-1:ib];hb=Ya[0][Za?ib:ib+1];if(kb=P(Math.sqrt((jb[0]-hb[0])*(jb[0]-hb[0])+(jb[1]-hb[1])*(jb[1]-hb[1]))))if(ob+kb<Wa)Za?cb[0].splice(0,0,jb):cb[0].push(hb),ob+=kb;else{Wa=(Wa-ob)/kb;Za?cb[0].splice(0,0,[hb[0]-(hb[0]-jb[0])*Wa,hb[1]-(hb[1]-jb[1])*Wa]):cb[0].push([jb[0]+(hb[0]-jb[0])*Wa,jb[1]+(hb[1]-
jb[1])*Wa]);break}ib+=Za?-1:1}return 0<ob+kb?cb:Ya};z=this.get("directions").features[k];var da=new ia(z.geometry),ja=40*Math.PI/180;q.mixin(z.attributes,{_index:k});if(k){var ma=aa(this.get("directions").features[k-1].geometry.paths,25,!0),Aa="esriDMTStop"!==z.attributes.maneuverType?aa(da.paths,25,!1):ma;ma=Aa!==ma?[ma[0].concat(Aa[0])]:Aa;var Ca=(new ia(Aa)).getExtent();if(1<Aa[0].length&&15<=P(Math.max(Ca.getWidth(),Ca.getHeight()))){aa=15*Math.cos(ja/2);V=15*Math.sin(ja/2);var Ha=Aa[0].length-
2;ja=Aa[0][Ha+1];for(Ca=0;0<=Ha&&!Ca;){var Ka=Aa[0][Ha];Ca=P(Math.sqrt((Ka[0]-ja[0])*(Ka[0]-ja[0])+(Ka[1]-ja[1])*(Ka[1]-ja[1])));Ha--}22>Ca&&(Aa=Ca+(22-Ca)/3,Ha=Ca+2*(22-Ca)/3,Ha=[Ka[0]+Ha/Ca*(ja[0]-Ka[0]),Ka[1]+Ha/Ca*(ja[1]-Ka[1])],Ka=[ja[0]-Aa/Ca*(ja[0]-Ka[0]),ja[1]-Aa/Ca*(ja[1]-Ka[1])],ja=Ha,Ca=22);aa/=Ca;Aa=[ja[0]-(ja[0]-Ka[0])*aa,ja[1]-(ja[1]-Ka[1])*aa];Ka[1]!==ja[1]?(aa=(ja[0]-Ka[0])/(ja[1]-Ka[1]),Ka=U(V/Math.sqrt(1+aa*aa)),U=aa*Ka):(Ka=0,U=U(V));Infinity===Math.abs(Ka)||Infinity===Math.abs(U)||
isNaN(Ka)||isNaN(U)||(ma[0].push(ja),ma[0].push([Aa[0]-Ka,Aa[1]+U]),ma[0].push([Aa[0]+Ka,Aa[1]-U]),ma[0].push(ja))}else ma=aa(ma,2*V(Aa),!0);da.paths=ma}this.unhighlightSegment(this._segmentGraphics&&this._segmentGraphics.length);U=q.clone(this.routeSymbol).setWidth(this.segmentSymbol.width).setColor(new w([parseInt(.9*this.segmentSymbol.color.r),parseInt(.9*this.segmentSymbol.color.g),parseInt(.9*this.segmentSymbol.color.b)]));this._segmentGraphics=[new T(z.geometry,U,z.attributes,this.get("segmentInfoTemplate")),
new T(da,this.routeSymbol,z.attributes,this.get("segmentInfoTemplate")),new T(da,this.segmentSymbol,z.attributes,this.get("segmentInfoTemplate"))];this.get("showSegmentHighlight")&&(this._routeLayer.add(this._segmentGraphics[0]),this._routeLayer.add(this._segmentGraphics[1]),this._routeLayer.add(this._segmentGraphics[2]));z=q.hitch(this,function(Ya){if(0<Ya&&Ya<this.directions.features.length){Ya=this.directions.features[Ya]._associatedFeaturesWithWaypoints;for(var Wa=0;Wa<Ya.length;Wa++)Ya[Wa]._associatedSnapFeature&&
Ya[Wa]._associatedSnapFeature.getDojoShape()&&Ya[Wa]._associatedSnapFeature.getDojoShape().moveToFront()}});z(k-1);z(k);this.onSegmentHighlight(this.directions.features[k])}},zoomToSegment:function(k){var z=new C;if(this.directions&&this.directions.features){var P=Math.max(0,Math.min(this.directions.features.length-1,k||0));this.map.setExtent(this.get("directions").features[P].geometry.getExtent(),!0).promise.always(q.hitch(this,function(){this.highlightSegment(P);z.resolve()}))}else z.reject(Error("No directions."));
return z.promise},centerAtSegmentStart:function(k){var z=new C;if(this.directions&&this.directions.features){var P=Math.max(0,Math.min(this.directions.features.length-1,k||0));var V=this.directions.features[P];this.map.centerAt(V.geometry.getPoint(0,0)).promise.always(q.hitch(this,function(){this.highlightSegment(P,!0);this._showSegmentPopup(V,P);z.resolve()}))}else z.reject(Error("No directions."));return z.promise},zoomToFullRoute:function(){var k=new C;this.directions&&this.directions.features?
(this._clearInfoWindow(),this.unhighlightSegment(),this.get("map").setExtent(this.get("directions").extent,!0).promise.always(k.resolve)):k.resolve();return k.promise},setListIcons:function(){var k,z=this._dnd.getAllNodes();for(k=0;k<z.length;k++){var P=G("."+this._css.stopIconClass,z[k])[0];P&&(P.innerHTML=this._getLetter(k));H.remove(z[k],this._css.stopOriginClass+" "+this._css.stopDestinationClass+" "+this._css.stopUnreachedClass+" "+this._css.stopUnreachedFirstOrLastClass);P=this._getStopSymbol(this.stops[k]);
P===this.fromSymbol?H.add(z[k],this._css.stopOriginClass):P===this.toSymbol?H.add(z[k],this._css.stopDestinationClass):P===this.unreachedSymbol&&H.add(z[k],this._css.stopUnreachedClass)}k=G("[data-reverse-td]",this._dndNode)[0];O.destroy(k);this.get("showReverseStopsButton")&&O.create("td",{"data-reverse-td":"true",rowspan:z.length,className:this._css.esriStopReverseColumnClass,innerHTML:'\x3cdiv role\x3d"button" class\x3d"'+this._css.reverseStopsClass+'" data-reverse-stops\x3d"true" title\x3d"'+
t.widgets.directions.reverseDirections+'"\x3e\x3c/div\x3e',onmouseover:function(V){V.stopPropagation()},onmouseout:function(V){V.stopPropagation()}},z[0])},addRouteSymbols:function(){if(this.stopGraphics.length){this._moveLayersToFront();for(var k=0;k<this.stopGraphics.length;k++)if(this.stopGraphics[k]&&(!this._handle._isShown()||this._handle._isShown()&&this._handle._index!==k)){this._stopLayer.add(this.stopGraphics[k]);var z=this.stopGraphics[k].getDojoShape();z&&z.moveToFront();this._stopLayer.add(this.textGraphics[k]);
(z=this.textGraphics[k].getDojoShape())&&z.moveToFront()}this._moveInProgress&&!this._handle.attributes.isWaypoint&&this._handle.getDojoShape()&&this._handle.getDojoShape().moveToFront()}},createRouteSymbols:function(){this._clearStopGraphics();for(var k=this.stops,z=function(ja){var ma={},Aa;for(Aa in ja)ja.hasOwnProperty(Aa)&&0===Aa.indexOf("Attr_")&&(ma[Aa]=ja[Aa]);return ma},P=0;P<k.length;P++){var V=k[P];if(V&&V.feature){var U=V.feature.attributes,aa=U?U.Status:void 0,da=null;this._isStopAWaypoint(V)||
(da=new va(this._getLetter(P),this.get("textSymbolFont"),this.get("textSymbolColor")),this.get("textSymbolOffset")&&da.setOffset(this.get("textSymbolOffset").x,this.get("textSymbolOffset").y));da=new T(V.feature.geometry,da,{address:V.name},this.get("stopsInfoTemplate"));da._isStopLabel=!0;da._index=P;V=new T(V.feature.geometry,this._getStopSymbol(V),q.mixin({address:V.name,Status:void 0===aa?0:aa,CurbApproach:U&&U.CurbApproach?U.CurbApproach:null,TimeWindowStart:U&&U.TimeWindowStart?U.TimeWindowStart:
null,TimeWindowEnd:U&&U.TimeWindowEnd?U.TimeWindowEnd:null,isWaypoint:this._isStopAWaypoint(V)},z(U)),this.get(this._isStopAWaypoint(V)?"waypointInfoTemplate":"stopsInfoTemplate"));V._isStopIcon=!0;V._index=P;this.stopGraphics[P]=V;this.textGraphics[P]=da}}this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this._showBarriers();this.addRouteSymbols();this.setListIcons()},setTravelMode:function(k){return this._enqueue(function(){this.clearMessages();this._travelModeSelector.setValue(k);
return this._setTravelMode(k)})},getSupportedTravelModeNames:function(){var k=[],z=this.serviceDescription;if(z&&z.supportedTravelModes&&z.supportedTravelModes.length){z=z.supportedTravelModes;for(var P=0;P<z.length;P++)k.push(z[P].name)}return k},setDirectionsLengthUnits:function(){var k=1===arguments.length?arguments[0]:this.get("directionsLengthUnits");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLengthUnits(k)})},setDirectionsLanguage:function(){var k=1===arguments.length?
arguments[0]:this.get("directionsLanguage");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLanguage(k)})},useMyCurrentLocation:function(k){this.clearMessages();return this._createLocateButton(this.geocoders[k],!0,!0)},loadRoute:function(k){return this._enqueue(q.hitch(this,function(){return this._loadRoute(k)}))},_getStopsAttr:function(){return this.returnToStart&&this._returnToStartStop?this.stops.concat(this._returnToStartStop):this.stops},_getTravelModeNameAttr:function(){return this.routeParams&&
this.routeParams.travelMode&&this.routeParams.travelMode.name},_reset:function(){var k=this.mapClickActive||this.barrierToolActive;this._clearBarriersGraphics();this._setWidgetProperties();return this._init().then(q.hitch(this,function(){this.mapClickActive=!k;this.set("mapClickActive",k);this._searchSourceSelector&&this._searchSourceSelector.setValue("all")}))},_activate:function(){var k=this.get("mapClickActive"),z=q.hitch(this,function(P){for(var V=P?[this.textGraphics,this.stopGraphics,this.displayedManeuverPointGraphics,
this.displayedRouteGraphics]:[this.displayedRouteGraphics,this.displayedManeuverPointGraphics,this.stopGraphics,this.textGraphics],U=0;U<V.length;U++)for(var aa=V[U],da=0;da<aa.length;da++){var ja=aa[da].getDojoShape();ja&&ja[P?"moveToBack":"moveToFront"].call(ja)}});this.drawToolbar&&(this.barrierToolActive=!1,this.drawToolbar.deactivate(),H.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass));this._addStopOnMapClickListener&&this._addStopOnMapClickListener.remove();k?(this.map.activeDirectionsWidget&&
this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this._addStopOnMapClickListener=e(this.map,"click",q.hitch(this,function(P){this.canModifyStops&&!this._solveInProgress&&(this.map.infoWindow.hide(),this.addStop(new T(P.mapPoint)))})),this.map.addLayer(this._waypointsEventLayer),this._moveLayersToFront(),H.add(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onActivate()):(this.map.removeLayer(this._waypointsEventLayer),
H.remove(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onDeactivate());z(!k);this.emit("map-click-active",{mapClickActive:this.mapClickActive})},_activateBarrierTool:function(){this.get("barrierToolActive")?(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this.drawToolbar.activate(N.FREEHAND_POLYLINE),H.add(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onActivateBarrierTool()):
(this.drawToolbar.deactivate(),H.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onDeactivateBarrierTool());this.emit("barrier-tool-active",{barrierToolActive:this.barrierToolActive})},_moveLayersToFront:function(){var k=this.get("map"),z=k.graphicsLayerIds.length-1;k.reorderLayer(this._routeLayer,z);k.reorderLayer(this._polygonBarriersLayer,z);k.reorderLayer(this._polylineBarriersLayer,z);k.reorderLayer(this._barriersLayer,z);k.reorderLayer(this._waypointsEventLayer,z);
k.reorderLayer(this._stopLayer,z)},_destroyGeocoders:function(){for(;this.geocoders&&this.geocoders.length;){if(this.geocoders[0])try{this.geocoders[0].destroy()}catch(k){}this.geocoders.splice(0,1)}this.geocoders=[]},_disconnectEvents:function(){var k=this._clearDirections(!0),z;if(this._watchEvents&&this._watchEvents.length)for(z=0;z<this._watchEvents.length;z++)this._watchEvents[z].unwatch();if(this._onEvents&&this._onEvents.length)for(z=0;z<this._onEvents.length;z++)this._onEvents[z].remove();
if(this._geocoderEvents)for(z=0;z<this._geocoderEvents.length;z++)this._geocoderEvents[z].value.unwatch(),this._geocoderEvents[z].blur.remove(),this._geocoderEvents[z].select.remove(),this._geocoderEvents[z].suggest.remove();this._onEvents=[];this._watchEvents=[];this._geocoderEvents=[];this._disconnectResults();this._destroyGeocoders();this._destroyGlobalGeocoder();this._destroyDnD();return k},_getDirections:function(){var k=new C;this._removeEmptyStops();1<this._getStopCount()+this._getWaypointCount()&&
this.loaded?(this.onDirectionsStart(),this.clearMessages(),this._dnd.sync(),this._sortGeocoders(),this._getCandidates(this.stops).then(q.hitch(this,function(z){this.stops=z;this._setStops();this._configureRoute().always(q.hitch(this,function(P){k.resolve(P)}))}),q.hitch(this,function(z){this.set("directions",null);this._clearRouteGraphics();k.reject(z);this.onDirectionsFinish(z)}))):this._clearDirections(!0).always(q.hitch(this,function(){this.createRouteSymbols();k.resolve()}));return k.promise},
_clearDirections:function(){var k=new C;this._handle&&this._handle._remove();this.get("routeParams")&&this.get("routeParams").stops?this.get("routeParams").stops.features.length?(this.get("routeParams").stops.features=[],this.onDirectionsClear(),k.resolve()):arguments.length?k.resolve():this._reset().then(k.resolve,k.reject):k.resolve();this.set("directions",null);this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this._routeLayer.clear();this._waypointsEventLayer.clear();this._stopLayer.clear();
return k.promise},_setTravelMode:function(k){var z=new C,P=this.serviceDescription,V=function(){z.resolve(k)};if(P&&P.supportedTravelModes&&P.supportedTravelModes.length){var U=P.supportedTravelModes,aa=!1;for(P=0;P<U.length;P++)if(U[P].name===k){aa=!0;!this.routeParams.travelMode||this.routeParams.travelMode&&this.routeParams.travelMode.name!==k?(this.routeParams.travelMode=U[P].impedanceAttributeName?U[P]:U[P].itemId,this._checkStartTimeUIAvailability(),this._solveAndZoom().always(V)):V();this._travelModeSelector&&
this._travelModeSelector.domNode&&(this._travelModeSelector.domNode.title=U[P].description);break}aa||z.reject(k)}else z.reject(k);return z.promise},_setDirectionsLengthUnits:function(k){this._clearDisplayBeforeSolve();var z=new C;H.remove(this._useMilesNode,this._css.stopsPressedButtonClass);H.remove(this._useKilometersNode,this._css.stopsPressedButtonClass);k===Z.KILOMETERS?H.add(this._useKilometersNode,this._css.stopsPressedButtonClass):k===Z.MILES&&H.add(this._useMilesNode,this._css.stopsPressedButtonClass);
k===Z.KILOMETERS||k===Z.METERS||k===Z.MILES||k===Z.FEET||k===Z.YARDS||k===Z.NAUTICAL_MILES?(this.directionsLengthUnits=k,z.resolve(k)):z.reject(k);return z.promise},_setDirectionsLanguage:function(k){this._clearDisplayBeforeSolve();var z=new C;k=this._setDirectionsLanguageByLocale(k);this._solveAndZoom().always(function(){z.resolve(k)},z.reject);return z.promise},_showLoadingSpinner:function(k){void 0===k&&(k=this._requestQueueTail&&!this._requestQueueTail.isFulfilled()||this._moveInProgress);k?(H.add(this._widgetContainer,
this._css.resultsLoadingClass),H.add(this._resultsNode,"esriRoutesContainerBusy")):(H.remove(this._widgetContainer,this._css.resultsLoadingClass),H.remove(this._resultsNode,"esriRoutesContainerBusy"))},_enqueue:function(k,z){var P=new C;this._requestQueueTail||(this._requestQueueTail=new C,this._requestQueueTail.resolve());this._requestQueueTail.promise.always(q.hitch(this,function(){try{q.mixin(this,{_incrementalSolveStopRange:null},z);var V=k.call(this);V&&"object"===typeof V&&V.hasOwnProperty("isFulfilled")?
V.then(q.hitch(this,function(U){P.resolve(U);this._showLoadingSpinner()}),q.hitch(this,function(U){P.reject(U);this._showLoadingSpinner()})):(P.resolve(V),this._showLoadingSpinner())}catch(U){P.reject(U),this._showLoadingSpinner()}}));this._requestQueueTail=P;this._showLoadingSpinner();return P.promise},_createDnD:function(){this._dnd=new W(this._dndNode,{skipForm:!0,withHandles:!0})},_destroyDnD:function(){O.empty(this._dndNode);this._dnd&&(this._dnd.destroy(),this._dnd=null)},_createDepartAtControls:function(){if(this._departAtTime)this.map&&
this._restoreMapTimeExtent(),this._useTrafficItemNode.title=t.widgets.directions.trafficLabelLive,H.remove(this._departAtContainer,"departAtContainerVisible"),this.startTime="now",this._updateStartTimeUI();else{var k=this,z=function(){this._keepDirections||k._clearDisplayBeforeSolve();this._keepDirections=!1},P=q.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),V=q.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()});this._departAtTime=new l({required:!0,value:new Date,
onChange:z,onFocus:P,onBlur:V},this._departAtTimeContainer);this._departAtDate=new m({required:!0,value:new Date,onChange:z,onFocus:P,onBlur:V,constraints:{min:new Date(864E5)}},this._departAtDateContainer)}},_setStartTime:function(k,z,P){if(isNaN(P))this.startTime="now"===P?P:"none";else{z=P instanceof Date?P:new Date(P);P=this.directions&&this.directions.features&&this.directions.features[0]&&this.directions.features[0].attributes;var V=6E4*-z.getTimezoneOffset();z=new Date(z-V+(P&&P.arriveTimeUTC?
P.ETA-P.arriveTimeUTC:V));this._departAtTime._keepDirections=!k;this._departAtDate._keepDirections=!k;this._departAtTime.setValue(z);this._departAtDate.setValue(z)}this._updateStartTimeUI()},_checkStartTimeUIAvailability:function(){var k=this._getImpedanceAttribute();k=this._isTimeUnits(k?k.units:"")||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion;this._startTimeButtonNode.disabled=!k;H[k?"remove":"add"].apply(this,[this._startTimeButtonNodeContainer,"esriLinkButtonDisabled"]);
H[k?"remove":"add"].apply(this,[this._startTimeDDLArrow,"esriDirectionsDDLArrowDisabled"]);k||this.set("startTime","now")},_usingAGOL:function(k){k||(k=this.routeTaskUrl);return-1<k.search(/^(https?:)*\/\/*[^.]*\.arcgis\.com.*$/i)},_usingRouteAGOL:function(){return-1<this.get("routeTaskUrl").search(/^(https?:)*\/\/route*[^.]*\.arcgis\.com.*$/i)},_setSearchOptions:function(){var k={map:this.get("map"),autoNavigate:!1,enableInfoWindow:!1,enableHighlight:!1,enableSourcesMenu:!1};this.searchOptions=q.mixin({maxResults:1,
locationToAddressDistance:100},this.defaults.searchOptions,k)},_setDefaultUnits:function(){if(!this.get("directionsLengthUnits")){var k="EN-US"===K.locale.toUpperCase()?Z.MILES:Z.KILOMETERS;this.defaults.directionsLengthUnits?k=this.defaults.directionsLengthUnits:this.userOptions.routeParams&&this.userOptions.routeParams.directionsLengthUnits&&(k=this.userOptions.routeParams.directionsLengthUnits);this.set("directionsLengthUnits",k)}this._setDirectionsLengthUnits(this.directionsLengthUnits)},_setTrafficOptions:function(){this._usingRouteAGOL()&&
!this.trafficLayer&&(this.trafficLayer=new Oa(ka+"//traffic.arcgis.com/arcgis/rest/services/World/Traffic/MapServer",{opacity:.4}));this.trafficLayer&&this.trafficLayer.url&&this._usingAGOL(this.trafficLayer.url)&&(this._trafficAvailabilityButton.style.display="inline-block");this.set("showTrafficOption",(this.defaults.showTrafficOption||!this.defaults.hasOwnProperty("showTrafficOption"))&&!!this.trafficLayer);this._optionsMenu()},_updateCanModifyStops:function(k,z){this.canModifyStops||this.canModifyWaypoints||
this.set("mapClickActive",!1);z||!this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!0);this._showAddDestination();this._showMapClickActiveButton();this._stopsTableCover.style.display=this.canModifyStops?"none":"inline"},_updateCanAddWaypoints:function(k,z){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);z||this.canModifyStops||!this.canModifyWaypoints||this.set("mapClickActive",!0);this._showMapClickActiveButton();this._handle._remove()},_updateStartTimeUI:function(){isNaN(this.startTime)?
(this._startTimeButtonLabel.innerHTML="now"==this.startTime?this._i18n.widgets.directions.leaveNow:this._i18n.widgets.directions.noStartTime,H.remove(this._startTimeButtonNodeContainer,"departAtButton"),H.remove(this._departAtContainer,"departAtContainerVisible")):(H.add(this._startTimeButtonNodeContainer,"departAtButton"),H.add(this._departAtContainer,"departAtContainerVisible"),this._startTimeButtonLabel.innerHTML=this._i18n.widgets.directions.departAt)},_setWidgetProperties:function(){this._disconnectEvents();
this.set(this.defaults);this.routeLayer=q.clone(this.defaults.routeLayer);this._folderSelector&&(this._outputLayer.setValue(""),this._outputLayer.set("disabled",!0),this._folderSelector.set("disabled",!0));this.set("stops",[]);this._updateCanModifyStops()},_updateStops:function(k){var z=new C;k?this.get("loaded")?this._reset().then(q.hitch(this,function(){this._addStops(k).then(z.resolve,z.reject)}),z.reject):this._addStops(k).then(z.resolve,z.reject):z.reject();return z.promise},_removeStop:function(k,
z,P,V){var U=new C,aa=q.hitch(this,function(ja){this.stops.splice(ja,1);var ma=this._dnd.getAllNodes()[ja],Aa=this.get("geocoders");this._geocoderEvents[ma.id]&&(this._geocoderEvents[ma.id].blur.remove(),this._geocoderEvents[ma.id].select.remove(),this._geocoderEvents[ma.id].suggest.remove(),this._geocoderEvents[ma.id].value.unwatch());Aa[ja].destroy();Aa.splice(ja,1);this.set("geocoders",Aa);O.destroy(ma);this._dnd.sync();this._stopsRemovable();this._optionsMenu();this._checkMaxStops();this.setListIcons();
this._sortGeocoders()});if(0>k||k>=this.stops.length||void 0===k)k=this.stops.length-1;var da=!1;for(V=this.stopGraphics[k]&&this._isStopAWaypoint(this.stops[k])||V;!da;)aa(k),V?da=!0:(k-=0>=k||k<this.stops.length&&this._isStopAWaypoint(this.stops[k])?0:1,da=!this._isStopAWaypoint(this.stops[k]));for(;this.stops.length-this._getWaypointCount()<this.minStops;)this._addStop();this._clearStopsStatusAttr();this._setStops();this.createRouteSymbols();P?(this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve(),
this.createRouteSymbols(),U.resolve()):this._solveAndZoom(z).then(U.resolve,U.reject);return U.promise},_removeTrafficLayer:function(){this.trafficLayer&&this.map&&this.map.removeLayer(this.trafficLayer);this._trafficLayerAdded=!1},_addStops:function(k,z){var P=new C,V=[],U=this.autoSolve;this.autoSolve=!1;void 0===z&&(z=this._getStopCount());for(var aa=0;aa<Math.min(k.length,this.maxStops-this._getStopCount());aa++){var da=new C;this._addStop(k[aa],z+aa,!0).always(da.resolve);V.push(da)}M(V).always(q.hitch(this,
function(){this.autoSolve=U;this._getDirections().always(function(){P.resolve(k)})}));return P.promise},_addStop:function(k,z,P){var V=new C;this._checkMaxStops();this.maxStopsReached?(this._showMessage(t.widgets.directions.error.maximumStops),V.reject(Error(t.widgets.directions.error.maximumStops))):(void 0===k&&void 0===z&&(z=this.stops.length),k instanceof T&&k.attributes&&k.attributes.isWaypoint&&(!z||z===this.stops.length||2>this._getStopCount())&&!P?(this._showMessage(t.widgets.directions.error.waypointShouldBeInBetweenStops),
V.reject(Error(t.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(k).then(q.hitch(this,function(U){this._isStopAWaypoint(U)&&U&&U.feature&&(U.feature.attributes=q.mixin({},U.feature.attributes,{isWaypoint:!0,CurbApproach:3}));this._insertStop(U,z);this.autoSolve&&""!==U.name?this._getDirections().always(function(){V.resolve(U,z)}):V.resolve(U,z)}),q.hitch(this,function(U){V.reject(U)})));return V.promise},_removeEmptyStops:function(){for(var k=0,z=this.stops.length-this._getWaypointCount()-
this.minStops;k<this.stops.length&&0<z;)this.stops[k]&&this.stops[k].name?k++:(this._removeStop(k,!0,!0,!0),z--,this._moveInProgress&&this._handle._index>=k&&this._handle._isStopIcon&&this._handle._index--)},_setReverseGeocode:function(k,z,P){if(k.feature.geometry&&-1<P){var V={address:k.name};this.stopGraphics[P]&&(q.mixin(this.stopGraphics[P].attributes,V),this.stopGraphics[P].setGeometry(z));this.textGraphics[P]&&(q.mixin(this.textGraphics[P].attributes,V),this.textGraphics[P].setGeometry(z));
this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);(V=this.geocoders[P])&&V.inputNode&&(V.value=k.name,V.inputNode.value=k.name);q.mixin(k.feature.attributes,this.stops[P].feature.attributes);this.stops[P]=k;this.stops[P].feature.setGeometry(z);this._setStops();return this._enqueue(function(){return this._getDirections()})}},_insertStop:function(k,z){var P;if(void 0===z)for(P=0;P<this.geocoders.length;P++){if(!this.geocoders[P].get("value")){var V=this.geocoders[P];
break}}else P=z,this.geocoders[P]&&!this.geocoders[P].get("value")&&(V=this.geocoders[P]);!V||void 0!==z&&z!==P||this._isStopAWaypoint(k)?(void 0===z&&(z=this.geocoders.length),this.stops.splice(z,0,k),this._createGeocoder(k,z)):(this.stops[P]=k,V.set("value",k.name),V._stopReference=k);this._optionsMenu()},_createGeocoder:function(k,z){var P=this._dnd.getAllNodes(),V=!1,U=!1,aa=P.length;P[z]?(U=P[z],V=!0):V=U=!1;var da=q.hitch(this,function(Ca,Ha){var Ka=Ha?this._css.stopDnDHandleClass:this._css.stopDnDHandleClassHidden,
Ya=Ha?this._css.stopDnDHandleClassHidden:this._css.stopDnDHandleClass;H.replace(Ca.children[0],Ka,Ya);2<this.geocoders.length&&(Ka=Ha?this._css.stopIconRemoveClass:this._css.stopIconRemoveClassHidden,Ya=Ha?this._css.stopIconRemoveClassHidden:this._css.stopIconRemoveClass,H.replace(Ca.children[3].children[0],Ka,Ya))}),ja=O.create("tr",{className:this._css.stopClass,style:this._isStopAWaypoint(k)?"display:none;":"",onmouseover:function(){da(this,!0)},onmouseout:function(){da(this,!1)}});O.create("td",
{className:this._css.stopDnDHandleClassHidden+" dojoDndHandle"},ja);P=O.create("td",{className:this._css.stopIconColumnClass},ja);O.create("div",{className:this._css.stopIconClass+" dojoDndHandle",innerHTML:this._getLetter(aa),"data-center-at":"true"},P);aa=O.create("td",{className:this._css.esriStopGeocoderColumnClass},ja);aa=O.create("div",{},aa);P=O.create("td",{className:this._css.stopIconRemoveColumnClass},ja);O.create("div",{className:this._css.stopIconRemoveClassHidden,role:"button","data-remove":"true"},
P);this._dnd.insertNodes(!1,[ja],V,U);V=q.mixin({},this.get("searchOptions"),{value:k.name,activeSourceIndex:this._globalGeocoder.activeSourceIndex});var ma=new ra(V,aa),Aa=q.hitch(this,function(Ca,Ha){this._enqueue(function(){if(Ha!==Ca&&ma._stopReference&&ma._stopReference.name!==Ha){var Ka=E.indexOf(this.stops,ma._stopReference);this.stops[Ka]={name:Ha};this._handle._remove();this._removeSomeWaypoints(this._markWPsForRemovalAfterUserChangedStopSequence(Ka));this._setStops();this._clearDisplayBeforeSolve();
this._clearDisplayAfterSolve();this.createRouteSymbols()}})});ma._tr=ja;ma._stopReference=k;ma.startup();this.geocoders.splice(z,0,ma);this._geocoderEvents[ja.id]={blur:ma.on("blur",function(){""!==this.value&&this._stopReference&&!this._stopReference.feature&&this.search()}),select:ma.on("select-result",q.hitch(this,function(Ca){var Ha=!0;if(Ca&&(Ca.results||Ca.result)){var Ka=this._dnd.getAllNodes();Ka=E.indexOf(Ka,ja);var Ya=ma.value,Wa=Ca.results&&Ca.results.results&&Ca.results.results.length?
Ca.results.results[0]:Ca.result;Wa?(Wa.name=Ya,this.stops[Ka]=this._toPointGeometry(Wa),this.geocoders[Ka]._stopReference=this.stops[Ka],Aa("",Ya)):(this.removeStop(Ka),this.set("directions",null),this._showMessage(t.widgets.directions.error.unknownStop.replace("\x3cname\x3e",Ca.target.get("value"))),this._clearRouteGraphics(),Ha=!1);Ha&&this.getDirections()}})),suggest:ma.on("suggest-results",function(){if(document.activeElement===this.inputNode)for(var Ca=G("LI[role\x3d'menuitem']",this.suggestionsNode),
Ha=0;Ha<Ca.length;Ha++)u.set(Ca[Ha],"tabindex",-1);else this._hideSuggestionsMenu()}),value:ma.watch("value",function(Ca,Ha,Ka){Aa(Ha,Ka)})};this._checkMaxStops();this.setListIcons();this._stopsRemovable();this._optionsMenu();this._sortGeocoders()},_blurGeocoders:function(){if(document.activeElement)for(var k=0;k<this.geocoders.length;k++)if(this.geocoders[k].inputNode===document.activeElement){this.geocoders[k]._hideSuggestionsMenu();this.geocoders[k].inputNode.blur();1<this._getStopCount()+this._getWaypointCount()&&
this.getDirections(!0);break}},_decorateEmptyAGOLGeocoderResponse:function(k){k&&", , "===k.name&&(k.name=k.feature&&k.feature.attributes&&k.feature.attributes.Match_addr?k.feature.attributes.Match_addr+("POI"===k.feature.attributes.Addr_type&&k.feature.attributes.City&&-1===k.feature.attributes.Match_addr.indexOf(k.feature.attributes.City)?", "+k.feature.attributes.City:""):"");return k},_toPointGeometry:function(k){var z=k.feature.geometry;z&&(z.getCentroid?k.feature.geometry=z.getCentroid():z.getExtent&&
(z=z.getExtent())&&(k.feature.geometry=z.getCenter()));return k},_removeLocateButtonVisibilityEvents:function(){for(var k=0;k<this.geocoders.length;k++){var z=this.geocoders[k];z._onMouseEnter&&z._onMouseEnter.remove();z._onMouseOut&&z._onMouseOut.remove();z._onKeyPress&&z._onKeyPress.remove();z._locateButton&&(z._locateButton._onMouseEnter&&z._locateButton._onMouseEnter.remove(),z._locateButton._onMouseOut&&z._locateButton._onMouseOut.remove())}},_setLocateButtonVisibilityEvents:function(){this._removeLocateButtonVisibilityEvents();
for(var k=this,z=function(ma){ma instanceof FocusEvent?this._geocoder._lbShown_f=!0:this._geocoder._lbShown_g=!0;k._createLocateButton(this._geocoder,!0)},P=function(ma){ma instanceof FocusEvent?this._geocoder._lbShown_f=!1:this._geocoder._lbShown_g=!1;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(q.hitch(this,function(){this._geocoder._lbShown_lb||this._geocoder._lbShown_f||k._destroyLocateButton(this._locateButton)}),400)},V=function(){this._geocoder._lbShown_g=!0;clearTimeout(this._destroyTimeout);
this._destroyTimeout=setTimeout(q.hitch(this,function(){""===this.value?k._createLocateButton(this._geocoder,!0):k._destroyLocateButton(this._locateButton)}),400)},U=function(){this._geocoder._lbShown_lb=!0;clearTimeout(this._geocoder._destroyTimeout)},aa=function(){this._geocoder._lbShown_lb=!1;clearTimeout(this._geocoder._destroyTimeout);this._geocoder._destroyTimeout=setTimeout(q.hitch(this,function(){this._geocoder._lbShown_g||this._geocoder._lbShown_f||k._destroyLocateButton(this._geocoder.inputNode._locateButton)}),
400)},da=0;da<this.geocoders.length;da++){var ja=this.geocoders[da];ja&&ja.inputNode&&(ja.inputNode._geocoder=ja,ja._onMouseEnter=e(ja.inputNode,d.enter,z),ja._onMouseOut=e(ja.inputNode,[d.leave,"blur"],P),ja._onKeyPress=e(ja.inputNode,"keydown",V),ja.inputNode._locateButton&&(ja=ja.inputNode._locateButton,ja._onMouseEnter=e(ja.domNode,d.enter,U),ja._onMouseOut=e(ja.domNode,d.leave,aa)))}},_createLocateButton:function(k,z,P){var V=new C;k.inputNode._locateButton&&k.inputNode._locateButton._locating?
V.resolve():L(["./LocateButton"],q.hitch(this,function(U){this._destroyLocateButton(k.inputNode._locateButton);if(k&&!this._solveInProgress){var aa=O.create("div",{},k.domNode);H.add(k.domNode,this._css.stopsInnerGeocoderClass);var da=new U({map:this.map,highlightLocation:!1,centerAt:!1,setScale:!1,useTracking:!1},aa);da.startup();k.inputNode._locateButton=da;da.domNode._geocoder=k;this._setLocateButtonVisibilityEvents();U=q.hitch(this,function(){da._locating=!0;k.set("value","");k.inputNode.placeholder=
t.widgets.directions.retrievingMyLocation.toUpperCase()});da._onBeforeLocate=e(da._locateNode,x,U);da._onLocate=e(da,"locate",q.hitch(this,function(ja){da._locating=!1;ja.graphic?(z&&this._destroyLocateButton(k.inputNode._locateButton),this.updateStop(new T(ja.graphic.geometry),E.indexOf(this.geocoders,k)).then(q.hitch(this,function(){1<this.stopGraphics.length?this.getDirections().always(function(){V.resolve(ja)}):V.resolve(ja)}))):(k.set("value",""),k.inputNode.placeholder=t.widgets.directions.myLocationError.toUpperCase(),
console.error(ja.error),V.reject(ja.error))}));P?(U(),da.locate().then(null,V.reject)):V.resolve()}else V.resolve()}));return V.promise},_destroyLocateButton:function(k){if(k){var z=k.domNode._geocoder;clearTimeout(z._destroyTimeout);k._locating?z._destroyTimeout=setTimeout(q.hitch(this,function(){z._lbShown_lb||z._lbShown_f||this._destroyLocateButton(k)}),100):(k.clear(),k._onBeforeLocate.remove(),k._onLocate.remove(),k._onMouseEnter&&k._onMouseEnter.remove(),k._onMouseOut&&k._onMouseOut.remove(),
k.destroy(),z.inputNode&&(z.inputNode._locateButton=null,z._setPlaceholder(z.activeSourceIndex)))}},_sortStops:function(){this.stops.length&&(this.stops.sort(q.hitch(this,function(k,z){for(var P,V,U=0;U<this.get("geocoders").length;U++)this.geocoders[U]._stopReference===k?P=U:this.geocoders[U]._stopReference===z&&(V=U);return P>V?1:V>P?-1:0})),this._setStops())},_getCandidate:function(k){var z=new C,P=typeof k;k?"object"===P&&k.hasOwnProperty("feature")&&k.hasOwnProperty("name")?(k.feature.attributes&&
void 0!==k.feature.attributes.displayName&&!this._isStopAWaypoint(k)&&(k.name=k.feature.attributes.displayName,k.feature.attributes.Name=this._userDefinedStopName),k.name=this._isStopAWaypoint(k)?this._waypointName:String(k.name),"point"!==k.feature.geometry.type&&(k.feature.geometry=new Q([k.feature.geometry.x,k.feature.geometry.y],this.map.spatialReference)),z.resolve(k)):"object"===P&&k.hasOwnProperty("address")&&k.hasOwnProperty("location")?(k=this._globalGeocoder._hydrateResult(k),z.resolve(k)):
"object"!==P||!k.hasOwnProperty("name")||null!==k.name&&""!==k.name?k instanceof T&&k.attributes&&(void 0!==k.attributes.Name||k.attributes.isWaypoint)?(P=this._addStopWrapperToGraphic(k,k.attributes.isWaypoint?this._waypointName:String(k.attributes.Name)),String(k.attributes.Name)&&(P.feature.attributes.Name=this._userDefinedStopName),z.resolve(P)):("object"===P&&k.hasOwnProperty("name")&&(k=String(k.name)),this._reverseGeocode(k).then(z.resolve,z.reject)):z.resolve(q.clone(this._emptyStop)):z.resolve(q.clone(this._emptyStop));
return z.promise},_reverseGeocode:function(k){var z=new C,P,V=k.geometry?k.geometry:k;if(this._globalGeocoder){var U=q.hitch(this,function(ma){var Aa=new C,Ca=500;if(this.map){var Ha=this.map.toScreen(V);Ha.x+=ab._calculateClickTolerance([ma]);this.map.spatialReference.isWebMercator()?(Ca=Math.abs(this.map.toMap(Ha).x-V.x),Aa.resolve(Ca)):4326===this.map.spatialReference.wkid?(Ca=Math.abs(Ra.geographicToWebMercator(this.map.toMap(Ha)).x-Ra.geographicToWebMercator(V).x),Aa.resolve(Ca)):this._geometryService&&
(ma=new Xa,ma.distanceUnit=Na.UNIT_METER,ma.geometry1=V,ma.geometry2=this.map.toMap(Ha),this._geometryService.distance(ma,function(Ka){Ca=Ka;Aa.resolve(Ca)},function(){Aa.resolve(Ca)}))}return Aa.promise}),aa=[],da=this._globalGeocoder.sources,ja=function(){da[P].featureLayer&&aa.push(U(da[P].featureLayer).then(q.hitch(da[P],function(ma){this.searchQueryParams=q.mixin(this.searchQueryParams,{distance:ma})})))};if("all"===this._globalGeocoder.activeSourceIndex)for(P=0;P<da.length;P++)ja();else P=this._globalGeocoder.activeSourceIndex,
ja();M(aa).always(q.hitch(this,function(){this._globalGeocoder.search(V).then(q.hitch(this,function(ma){var Aa=!1;if(ma){var Ca=null;for(P=0;P<this._globalGeocoder.sources.length;P++)if(ma[P]&&ma[P].length){var Ha=ma[P];break}if(Ha.length&&(Aa=!0,Ca=Ha[0],this._globalGeocoder.sources[P].featureLayer))for(ma=Number.POSITIVE_INFINITY,P=0;P<Ha.length;P++){Ha[P]=this._toPointGeometry(Ha[P]);var Ka=Va.geodesicLengths([new ia({paths:[[Ra.xyToLngLat(V.x,V.y),Ra.xyToLngLat(Ha[P].feature.geometry.x,Ha[P].feature.geometry.y)]],
spatialReference:{wkid:this.map.spatialReference.wkid}})],"esriMeters")[0];ma>Ka&&(ma=Ka,Ca=Ha[P])}(Ca=this._decorateEmptyAGOLGeocoderResponse(Ca))&&""!==Ca.name&&null!==Ca.name&&void 0!==Ca.name?(Ca.name=String(Ca.name),isNaN(V.x)||isNaN(V.y)||this.map.spatialReference.wkid!==V.spatialReference.wkid?!Ca.feature.geometry||isNaN(Ca.feature.geometry.x)||isNaN(Ca.feature.geometry.y)?(this._showMessage(t.widgets.directions.error.locator),z.reject(Error(t.widgets.directions.error.locator))):z.resolve(Ca):
(Ca.feature.geometry=V,z.resolve(Ca))):Aa=!1}Aa||(k instanceof Q?k=new T(k):k instanceof Array&&(k=new T(new Q(k[0],k[1]))),k instanceof T?this._decorateUngeocodedStop(k).then(z.resolve,z.reject):(this._showMessage(t.widgets.directions.error.unknownStop.replace("\x3cname\x3e",k.toString())),z.reject(Error(t.widgets.directions.error.unknownStop.replace("\x3cname\x3e",k.toString())))))}))}))}else this._showMessage(t.widgets.directions.error.locatorUndefined),z.reject(Error(t.widgets.directions.error.locatorUndefined));
return z.promise},_updateStop:function(k,z,P){var V=new C;this.stops&&this.stops[z]?k instanceof T&&k.attributes&&k.attributes.isWaypoint&&(!z||z===this.stops.length-1||2>this._getStopCount())?(this._showMessage(t.widgets.directions.error.waypointShouldBeInBetweenStops),V.reject(Error(t.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(k).then(q.hitch(this,function(U){var aa=U.feature;aa=aa?aa.geometry:null;var da=this.stops[z].feature;da=da?da.geometry:null;aa=aa&&da&&
(aa.x!==da.x||aa.y!==da.y)||!aa&&da;this.stops[z]=U;this.geocoders[z]||this._createGeocoder(U,z);da=this.geocoders[z];da._stopReference=U;da._tr.style.display=this._isStopAWaypoint(U)?"none":"";da.value=U.name;da.inputNode&&(da.inputNode.value=U.name);aa&&this.autoSolve&&1<this._getStopCount()+this._getWaypointCount()||P?this._getDirections().then(V.resolve,V.reject):(this._setStops(),V.resolve(U))}),q.hitch(this,function(U){V.reject(U)})):(this._showMessage(t.widgets.directions.error.couldNotUpdateStop),
V.reject(Error(t.widgets.directions.error.couldNotUpdateStop)));this._optionsMenu();return V.promise},_renderDirections:function(){var k=this.get("directions");if(this._resultsNode){var z='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';z+=this._renderDirectionsSummary(k);z+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';z+='\x3cdiv class\x3d"'+this._css.routesClass+'"\x3e';z+=this._renderDirectionsTable(k);z+="\x3cdiv class\x3d'esriPrintFooter'\x3e"+t.widgets.directions.printDisclaimer+
"\x3c/div\x3e";z+="\x3c/div\x3e";this._resultsNode&&(this._resultsNode.innerHTML=z);this._disconnectResults();(k=G("[data-segment]",this._resultsNode))&&k.length&&E.forEach(k,q.hitch(this,function(P){this._resultEvents.push(e(P,d.enter,q.hitch(this,function(){if(!this._focusedDirectionsItem){var V=parseInt(u.get(P,"data-segment"),10);this.highlightSegment(V)}})));this._resultEvents.push(e(P,"focusout",q.hitch(this,function(){this._focusedDirectionsItem=null;this.unhighlightSegment(!0)})));this._resultEvents.push(e(P,
d.leave,this.unhighlightSegment));this._resultEvents.push(e(P,"click, keydown",q.hitch(this,function(V){V&&("click"===V.type||"keydown"===V.type&&V.keyCode===c.ENTER)&&(this._focusedDirectionsItem!==P?this.selectSegment(parseInt(u.get(P,"data-segment"),10)):(P.blur(),this.map.infoWindow.hide(),this._focusedDirectionsItem=null,this.unhighlightSegment(!0)))})))}))}},_renderDirectionsSummary:function(k){var z="",P=q.hitch(this,function(){for(var da={},ja=this._getDirectionsTimeAttribute()||{},ma=this._getTimeNeutralAttribute()||
{},Aa=0,Ca=0,Ha=this.get("stops"),Ka=Ha.length-1;0<=Ka;Ka--)if(null!==Ha[Ka].feature.attributes.ArriveCurbApproach){da=Ha[Ka].feature.attributes;break}for(var Ya in da)da.hasOwnProperty(Ya)&&(Ya==="Cumul_"+ja.name&&(Aa=da[Ya]),Ya==="Cumul_"+ma.name&&(Ca=da[Ya]));da="esriTrafficLabelHidden";Ha=t.widgets.directions.noTraffic;Ka=k.totalTime-k.totalDriveTime;Ka=(Ca-this._convertCostValue(Ka,ja.units,ma.units))/(Aa-Ka||1);0<Ka&&.8>Ka?(da="esriTrafficLabelHeavy",Ha=t.widgets.directions.heavyTraffic):1===
Ka?(da="esriTrafficLabelNone",Ha=t.widgets.directions.noTraffic):1.25<Ka&&(da="esriTrafficLabelLight",Ha=t.widgets.directions.ligthTraffic);ma=this._formatTime(Ca,!1,ma.units);return{label:Ha,labelClass:da,ratio:Ka,noTrafficCostStr:1!==Ka&&ma?ma+" "+t.widgets.directions.onAverage+"\x3cbr\x3e":"",trafficCost:Aa,noTrafficCost:Ca,timeAtt:ja}});if(k.totalLength||k.totalTime){P=P();var V=this._getImpedanceAttribute();z+="\x3cdiv class\x3d'"+this._css.resultsSummaryClass+"' data-full-route\x3d'true'\x3e\x3cdiv class\x3d'esriImpedanceCost'\x3e";
if(this._isTimeUnits(V.units))z+=this._formatTime(P.trafficCost,!0,P.timeAtt.units)+"\x3cdiv class\x3d'esriImpedanceCostHrMin'\x3e\x3cdiv class\x3d'esriImpedanceCostHr'\x3e"+t.widgets.directions.time.hr+"\x3c/div\x3e\x3cdiv class\x3d'esriImpedanceCostMin'\x3e"+t.widgets.directions.time.min+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(P.noTrafficCost?"\x3cdiv class\x3d'esriTrafficLabel "+P.labelClass+"'\x3e"+P.label+"\x3c/div\x3e"+P.noTrafficCostStr:"")+this._formatDistance(k.totalLength);
else{V=(V=t.widgets.directions.units[this.directionsLengthUnits])?V.name:"";var U=this.serviceDescription&&10.6<=this.serviceDescription.currentVersion,aa=this.directions.features[0].attributes;z+=v.format(k.totalLength,{places:1})+"\x3cdiv class\x3d'esriImpedanceCostDist'\x3e"+V+"\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(P.noTrafficCost&&U?"\x3cdiv class\x3d'esriTrafficLabel "+P.labelClass+"'\x3e"+P.label+"\x3c/div\x3e"+P.noTrafficCostStr:"")+this._formatTime(k.totalTime)+" "+
("none"!==this.startTime&&P.noTrafficCost&&U?t.widgets.directions.atTheMoment+" "+this._toSpatiallyLocalTimeString(aa.arriveTimeUTC,aa.ETA):"")}z+="\x3c/div\x3e\x3c/div\x3e"}return z},_renderDirectionsTable:function(k){for(var z=0,P=0,V=0,U='\x3ctable summary\x3d"'+k.routeName+'"\x3e\x3ctbody role\x3d"menu"\x3e',aa=0;aa<k.features.length;aa++){var da=k.features[aa].attributes;"esriDMTDepart"===da.maneuverType&&(P=V=0);V+=da.length;P+=da.time;z+=da.time;U+=this._renderDirectionsItemTR(k.features[aa],
V,P,z)}return U+"\x3c/tbody\x3e\x3c/table\x3e"},_renderDirectionsItemTR:function(k,z,P,V){var U=this.directions,aa=U?E.indexOf(U.features,k):-1;V="";var da=this._css.routeClass,ja=k._associatedStopWithReturnToStart&&k._associatedStopWithReturnToStart.attributes,ma=k.attributes;if(-1<aa){ma&&(ma.step=aa+1);ma.maneuverType&&(da+=" "+ma.maneuverType);ja&&null===ja.ArriveCurbApproach&&null!==ja.DepartCurbApproach?da+=" "+this._css.routeOriginClass:ja&&null!==ja.ArriveCurbApproach&&null===ja.DepartCurbApproach&&
(da+=" "+this._css.routeDestinationClass+" "+this._css.routeLastClass);V+='\x3ctr tabindex\x3d"0" role\x3d"menuitem" class\x3d"'+da+" "+this._css.routeZoomClass+'" data-segment\x3d"'+aa+'"\x3e';V+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';V+='\x3cdiv class\x3d"'+this._css.routeIconClass+'"\x3e';V+=this._getLetter(k._associatedStop);V=V+'\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"'+(this._css.routeTextColumnClass+'"\x3e');V+='\x3cdiv class\x3d"'+this._css.routeInfoClass+'"\x3e';V+='\x3cdiv class\x3d"'+
this._css.routeTextClass+'"\x3e';k=(U.strings[aa]||[]).slice();if("esriDMTDepart"===ma.maneuverType||"esriDMTStop"===ma.maneuverType)for(U=0;U<this.stops.length;U++)this.stops[U]&&this.stops[U].name&&k.push({string:this.stops[U].name});if(k){da=ma.text;for(U=0;U<k.length;U++)da=this._boldText(da,k[U].string);ma.formattedText=da}else ma.formattedText=ma.text;if("esriDMTStop"===ma.maneuverType&&(z||P)||"esriDMTDepart"===ma.maneuverType&&0===aa)z=this._formatDistance(z-ma.length,!0),P=this._formatTime(P-
ma.time),aa=this._formatTime(ma.time),k=this._formatDistance(ma.length,!0),ma.formattedText+="\x3cdiv class\x3d'esriRouteTextColumnCumulative'\x3e"+z+(z&&P?" \x26middot; ":"")+P+(z||P?"\x3cbr\x3e":"")+(aa?t.widgets.directions.serviceTime+":\x26nbsp;"+aa:"")+(aa&&k?"\x3cbr\x3e":"")+(k?t.widgets.directions.serviceDistance+":\x26nbsp;"+k:"")+"\x3c/div\x3e";V+="\x3cstrong\x3e"+v.format(ma.step)+".\x3c/strong\x3e "+ma.formattedText;V+="\x3c/div\x3e";z=this._formatDistance(ma.length,!0);P=this._formatTime(ma.time);
"esriDMTStop"!==ma.maneuverType&&"esriDMTDepart"!==ma.maneuverType||!this.routeParams.startTime||-22091616E5===ma.ETA?z&&(V+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e',V+=z,P&&(V+="\x26nbsp;\x26middot;\x3cwbr\x3e\x26nbsp;"+P),V+="\x3c/div\x3e"):V+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e'+this._toSpatiallyLocalTimeString(ma.arriveTimeUTC,ma.ETA)+"\x3c/div\x3e";V+="\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e"}return V},_toSpatiallyLocalTimeString:function(k,z){var P=new Date(z),V=
new Date(P.getTime()+6E4*P.getTimezoneOffset());V=K.date.locale.format(V,{selector:"time"});var U="";k?(z=(z-k)/1E3/60/60,k=Math.floor(z),z=60*(z-k),k=t.widgets.directions.GMT+(0>k?"":"+")+v.format(k,{pattern:"00"})+v.format(z,{pattern:"00"}),U=V+" "+k):U="now"===this.startTime?K.date.locale.format(P,{selector:"time"}):V;return U},_addStopWrapperToGraphic:function(k,z){return{extent:new ba({xmin:k.geometry.x-.25,ymin:k.geometry.y-.25,xmax:k.geometry.x+.25,ymax:k.geometry.y+.25,spatialReference:k.geometry.spatialReference}),
feature:k,name:z}},_clearBarriersGraphics:function(){this._barriersLayer.clear();this._polylineBarriersLayer.clear();this._polygonBarriersLayer.clear()},_showBarriers:function(){this._clearBarriersGraphics();var k=this.routeParams,z=k.polylineBarriers&&k.polylineBarriers.features||[],P=k.polygonBarriers&&k.polygonBarriers.features||[];E.forEach(k.barriers&&k.barriers.features||[],q.hitch(this,function(V){this._barriersLayer.add(V)}));E.forEach(z,q.hitch(this,function(V){this._polylineBarriersLayer.add(V)}));
E.forEach(P,q.hitch(this,function(V){this._polygonBarriersLayer.add(V)}));this._barriersLayer.refresh();this._polylineBarriersLayer.refresh();this._polygonBarriersLayer.refresh()},_showRoute:function(k){this._clearDisplayAfterSolve();var z=k.routeResults[0].directions,P=new C;if(z){this.set("solveResult",k);this.set("directions",z);var V=k.routeResults[0].stops,U,aa;if(V&&V.length){var da=[];for(U=0;U<V.length;U++){var ja=V[U];ja.attributes.isWaypoint=ja.attributes.Name===this._waypointName||ja.attributes.isWaypoint;
ja=this._addStopWrapperToGraphic(ja,ja.attributes.Name);this.stops[U]&&this.stops[U].feature&&this.stops[U].feature.attributes&&this.stops[U].feature.attributes.Name===this._userDefinedStopName&&(ja.feature.attributes.Name=this._userDefinedStopName);this._returnToStartStop&&this._returnToStartStop._resultsStopIndex===U?this._returnToStartStop=ja:da.push(ja)}if(this.stops.length>da.length)for(U=0;U<this.stops.length;U++)this.stops[U].feature||""!==this.stops[U].name||da.splice(U,0,this._emptyStop);
this.stops=da;for(U=0;U<this.stops.length;U++)this._updateStop(this.stops[U],U);this._setStops();this._setMenuNodeValues()}this.set("mergedRouteGraphic",new T(z.mergedGeometry,this.get("routeSymbol")));V=[];da=[];for(U=ja=0;U<z.featuresWithWaypoints.length;U++){var ma=z.featuresWithWaypoints[U];if("esriDMTDepart"===ma.attributes.maneuverType)for(aa=0;aa<this.stops.length;aa++)if(this.stops[aa].feature===ma._associatedStop){ja=aa+1;break}ma.setSymbol(this.get("routeSymbol"));this._routeLayer.add(ma);
V.push(ma);(aa=ma.getDojoShape())&&aa.moveToBack();aa=new T(ma.geometry,this._symbolEventPaddingDirections,ma.attributes);aa._nextStopIndex=ja-.5;aa._isSnapFeature=!0;ma._associatedSnapFeature=aa;this._waypointsEventLayer.add(aa);"esriDMTDepart"!==ma.attributes.maneuverType&&(aa=ma.geometry.getPoint(0,0))&&(aa=new T(aa,this.maneuverSymbol),aa._directionsFeature=ma._associatedFeatureNoWaypoints,da.push(aa),this._waypointsEventLayer.add(da[da.length-1]))}this.set("displayedRouteGraphics",V);this.set("displayedManeuverPointGraphics",
da);this._renderDirections();for(U=0;U<this.stops.length;U++)if(this._isStopAWaypoint(this.stops[U])&&this._modifiedWaypointIndex===U){for(aa=0;aa<z.featuresWithWaypoints.length;aa++)if(V=z.featuresWithWaypoints[aa],V._associatedStop===this.stops[U].feature){if("esriDMTStop"===V.attributes.maneuverType||"esriDMTDepart"===V.attributes.maneuverType)this.stops[U].feature.geometry.x=V.geometry.paths[0][0][0],this.stops[U].feature.geometry.y=V.geometry.paths[0][0][1];break}this._modifiedWaypointIndex=
null;break}I.set(this._savePrintBtnContainer,"display","inline-block");this.onDirectionsFinish(k)}else k=k.routeResults[0].route,k.setSymbol(this.routeSymbol),this._routeLayer.add(k),this._incrementalRouteSegment=k;P.resolve();this._moveLayersToFront();this.createRouteSymbols();return P.promise},_setGeocodersStopReference:function(){if(this.geocoders)for(var k=0;k<this.geocoders.length;k++)this.geocoders[k]&&this.stops[k]&&(this.geocoders[k]._stopReference=this.stops[k])},_setStops:function(){this._setGeocodersStopReference();
this.createRouteSymbols();this._set("stops",this.stops);this.onStopsUpdate(this.stops)},_getCandidates:function(k){var z=[];if(k&&k.length){for(var P=0;P<k.length;P++)z.push(this._getCandidate(k[P]));return M(z)}k=new C;k.resolve([]);return k.promise},_clearResultsHTML:function(){this._resultsNode.innerHTML="";I.set(this._savePrintBtnContainer,"display","none")},_showSegmentPopup:function(k){if(k&&this.get("showSegmentPopup")&&this.get("map").infoWindow){var z=k.geometry.getPoint(0,0);k=new T(z,null,
k.attributes,this.get("segmentInfoTemplate"));var P=this.get("map").infoWindow;P.setFeatures([k]);P.show(z)}},_addStopButton:function(){this.addStop().then(q.hitch(this,function(){this.get("focusOnNewStop")&&this.geocoders[this.stops.length-1].focus()}))},_sortGeocoders:function(){var k=this._dnd.getAllNodes();this.geocoders.sort(q.hitch(this,function(P,V){return P.domNode&&P.domNode.parentNode&&P.domNode.parentNode.parentNode&&V.domNode&&V.domNode.parentNode&&V.domNode.parentNode.parentNode?E.indexOf(k,
P.domNode.parentNode.parentNode)>E.indexOf(k,V.domNode.parentNode.parentNode)?1:-1:0}));this.stops.length===this.geocoders.length&&this._sortStops();for(var z=0;z<this.geocoders.length;z++)this.geocoders[z]&&this.geocoders[z].inputNode&&(this.geocoders[z].inputNode.title=t.widgets.directions.stopNoTitle+(z+1));this._setLocateButtonVisibilityEvents()},_disconnectResults:function(){if(this._resultEvents&&this._resultEvents.length)for(var k=0;k<this._resultEvents.length;k++)this._resultEvents[k]&&this._resultEvents[k].remove();
this._resultEvents=[]},_formatArbitraryCostsForRouteTooltip:function(k){var z="",P;for(P in k)if(0===P.indexOf("Total_")&&k.hasOwnProperty(P)){var V=this._getCostAttribute(P.substr(6));V&&(z+=this._isTimeUnits(V.units)?this._formatTime(k[P],!1,V.units):this._formatDistance(k[P],!0,V.units),z+=z?" \x26middot; ":"")}z&&(z=t.widgets.directions.toNearbyStops+": \x3cb\x3e"+z.substr(0,z.length-10)+"\x3c/b\x3e");return z},_formatTime:function(k,z,P){P||(P=(this._getDirectionsTimeAttribute()||{}).units);
var V="";P=Math.round(this._convertCostValue(k,P,"esriNAUMinutes"));k=Math.floor(P/60);P=Math.floor(P%60);z?V=v.format(k,{pattern:100>k?"00":"000"})+":"+v.format(P,{pattern:"00"}):(k&&(V+=k+" "+t.widgets.directions.time.hr+" "),V+=k||P?P+" "+t.widgets.directions.time.min:"");return V},_formatDistance:function(k,z,P){P||(P=this.directionsLengthUnits);var V=this.directionsLengthUnits,U=t.widgets.directions.units[V],aa=V.replace("esri","").toLowerCase();k=this._convertCostValue(k,P,V);U&&(aa=z?U.abbr:
U.name);return k?v.format(k,{locale:"root",places:2})+" "+aa:""},_projectToGeographic:function(k){var z=new C;if(!k)return z.reject("Directions:: 'geometry' is not defined.",{geometry:k}),z.promise;if(4326==k.spatialReference.wkid)return z.resolve(k),z.promise;if(!this._geometryService)return z.reject("Directions:: Geometry service is not defined."),z.promise;var P=new ca;P.outSR=new Ba(4326);P.geometries=[k];this._geometryService.project(P).then(function(V){z.resolve(V&&V[0])},z.reject);return z.promise},
_createToolbars:function(){this.editToolbar||(this.editToolbar=new r(this.map));this.drawToolbar||(this.drawToolbar=new N(this.map),t.toolbars.draw.freehand=t.widgets.directions.lineBarrierFreehand,this.drawToolbar.onDrawComplete=q.hitch(this,function(k){var z=new T(k.geometry,null,{BarrierType:0});this._projectToGeographic(k.geographicGeometry||k.geometry).then(q.hitch(this,function(P){1<Va.geodesicLengths([P],Z.METERS)[0]&&(this._polylineBarriersLayer.add(z),this.routeParams.polylineBarriers||(this.routeParams.polylineBarriers=
new Ja),this.routeParams.polylineBarriers.features.push(z),this._clearStopsStatusAttr(),this.getDirections(!0))}))}))},_destroyGlobalGeocoder:function(){this._globalGeocoder&&(this._globalGeocoder.destroy(),this._globalGeocoder=null)},_createGlobalGeocoder:function(){var k=new C;this._globalGeocoder=new ra(this.get("searchOptions"));e.once(this._globalGeocoder,"load",k.resolve,k.reject);this._globalGeocoder.startup();return k.promise},_init:function(){var k=new C;this.set("loaded",!1);this._enableButton(this._getDirectionsButtonNode,
!1);I.set(this._saveAsButton,"display","none");this.clearMessages();if(this.get("map").loaded)this._configure().always(k.resolve);else e.once(this.get("map"),"load",q.hitch(this,function(){this._configure().always(k.resolve)}));return k.promise},_setDefaultStops:function(){var k=new C;this.defaults.stops&&this.defaults.stops.length?this._updateStops(this.defaults.stops).then(q.hitch(this,function(){this._removeEmptyStops();k.resolve()}),k.reject):k.resolve();return k.promise},_configure:function(){var k=
new C;this._handle&&this._handle._remove();this._createDnD();this._createDepartAtControls();this._setSearchOptions();this._createGlobalGeocoder().then(q.hitch(this,function(){this._createToolbars();this._usingAGOL()||(this.printTaskUrl=this.geometryTaskUrl=null);this._createGeometryTask();this._createPrintTask();this._showActivateButton();this._showBarriersButton();this._createTravelModesDDL();this._createSearchSourceDDL();var z=[this._createRouteTask(),this._setDefaultStops()];M(z).then(q.hitch(this,
function(){this._setDefaultUnits();this._setTrafficOptions();this._setMenuNodeValues();this._setupEvents();var P=this.directionsLanguage||this.userOptions.routeParams&&this.userOptions.routeParams.directionsLanguage||K.locale.toLowerCase();this._setDirectionsLanguageByLocale(P);this._setupTravelModes().then(q.hitch(this,function(){this.set("loaded",!0);this.onLoad();k.resolve(!0)}),function(V){k.reject(V)})}),function(P){k.reject(P)})}),function(z){k.reject(z)});this._naRouteSharing=null;return k.promise},
_setDirectionsLanguageByLocale:function(k){var z=this.serviceDescription.directionsSupportedLanguages,P=function(U){if(z)for(var aa=0;aa<z.length;aa++)if(z[aa].toLowerCase().substr(0,2)===U)return z[aa];return null},V=P(k);V||(k=k.substr(0,2),V=P(k));this.directionsLanguage=V;return this.routeParams.directionsLanguage=V},_getStopSymbol:function(k,z){var P=k&&(k.feature&&k.feature.attributes||k.attributes),V=this.stopSymbol;P&&(V=this._isStopAWaypoint(k)?this.waypointSymbol:void 0===P.Status||0===
P.Status||6===P.Status?null===P.ArriveCurbApproach&&null!==P.DepartCurbApproach?this.get(z?"fromSymbolDrag":"fromSymbol"):null!==P.ArriveCurbApproach&&null===P.DepartCurbApproach?this.get(z?"toSymbolDrag":"toSymbol"):this.get(z?"stopSymbolDrag":"stopSymbol"):this.get(z?"unreachedSymbolDrag":"unreachedSymbol"));return V},_addTrafficLayer:function(){this.trafficLayer&&!this._trafficLayerAdded&&this.map&&(this.map.addLayer(this.trafficLayer),this.trafficLayer.show(),this._trafficLayerAdded=!0)},_toggleUnits:function(k){k.target===
this._useMilesNode?this.setDirectionsLengthUnits(Z.MILES):k.target===this._useKilometersNode&&this.setDirectionsLengthUnits(Z.KILOMETERS)},_toggleCheckbox:function(k){var z=u.get(k.target,"checked");k.target===this._findOptimalOrderNode?this.set("optimalRoute",z):k.target===this._useTrafficNode?this.set("traffic",z):k.target===this._returnToStartNode&&this.set("returnToStart",z)},_isStopLocated:function(k){return k&&k.feature&&k.feature.attributes&&(!k.feature.attributes.Status||6===k.feature.attributes.Status)},
_configureRouteOptions:function(){var k=this.get("routeParams"),z;this.get("directionsLengthUnits")?k.directionsLengthUnits=this.get("directionsLengthUnits"):this.set("directionsLengthUnits",k.directionsLengthUnits);k.findBestSequence=this.get("optimalRoute");if(k.findBestSequence)for(k.preserveFirstStop=this._isStopLocated(this.stops[0]),k.preserveLastStop=!this.returnToStart&&this._isStopLocated(this.stops[this.stops.length-1])||this.returnToStart&&this._isStopLocated(this.stops[0]),z=0;z<this.stops.length;)this._isStopAWaypoint(this.stops[z])?
this._removeStop(z,!0,!0):z++;if(!this.returnToStart&&this.stops.length&&this._isStopAWaypoint(this.stops[this.stops.length-1]))for(z=this.stops.length-1;0<z;)this._isStopAWaypoint(this.stops[z])&&this._removeStop(z,!0,!0),z--;if(this._isTimeUnits(this._getImpedanceAttribute().units)||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion)if(k.useTimeWindows=!0,"now"===this.startTime)k.timeWindowsAreUTC=!0,k.startTimeIsUTC=!0,k.startTime=new Date;else if("none"===this.startTime)k.startTime=
null;else{k.timeWindowsAreUTC=!1;k.startTimeIsUTC=!1;var P=this._departAtTime,V=6E4*P.getValue().getTimezoneOffset();P=new Date(P.getValue().getTime()+this._departAtDate.getValue().getTime()-V);P=new Date(P.getTime()-6E4*P.getTimezoneOffset());k.startTime=P}else k.startTime=null,k.useTimeWindows=!1;P=this._getImpedanceAttribute();V=this._getTimeNeutralAttribute();var U=this._getDirectionsTimeAttribute();z=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames;V&&-1===
E.indexOf(z,V.name)&&z.push(V.name);!this._isTimeUnits(P.units)&&this.serviceDescription&&10.6<=this.serviceDescription.currentVersion&&U&&-1===E.indexOf(z,U.name)&&z.push(U.name);this.routeParams.accumulateAttributes=z;k.returnStops=!0;U=[];for(z=0;z<this.stopGraphics.length;z++)if(this.stopGraphics[z]&&(U.push(new T(this.stopGraphics[z].toJson())),z)){var aa=U[0].attributes,da=U[z].attributes;for(ja in da)da.hasOwnProperty(ja)&&!aa.hasOwnProperty(ja)&&(aa[ja]=null)}if(this.get("returnToStart")&&
this.stopGraphics.length&&this._isStopLocated(this.stops[0])){var ja=new T(this.stopGraphics[0].toJson());this._returnToStartStop=this._addStopWrapperToGraphic(ja,ja.attributes.Name);U.push(ja)}else this._returnToStartStop=null;k.stops.features=U;if(V)for(z=0;z<U.length;z++)U[z].attributes["Attr_"+V.name]=this._convertCostValue(U[z].attributes["Attr_"+P.name],P.units,V.units);this.set("routeParams",k)},_configureRoute:function(){var k=new C;k.promise.always(q.hitch(this,function(){this._checkMaxStops()}));
this.createRouteSymbols();this._configureRouteOptions();if(this.routeParams.returnRoutes&&this._incrementalSolveStopRange){var z=this._incrementalSolveStopRange;z.start<z.end?this.routeParams.stops.features=this.routeParams.stops.features.slice(z.start,z.end+1):z.start>z.end&&(this.routeParams.stops.features=this.routeParams.stops.features.slice(z.start,this.routeParams.stops.features.length-1).concat(this.routeParams.stops.features.slice(0,z.end+1)))}else this._incrementalSolveStopRange=null;var P=
{},V=this.routeParams.stops.features;for(z=0;z<V.length;z++){var U=V[z].attributes.address;var aa=(z===this._handle._index&&!this._handle.attributes.isWaypoint&&this._incrementalSolveStopRange?this._waypointName:U)+"_"+this._stopSequence++;V[z].attributes.Name=aa;P[aa]=U;delete V[z].attributes.address;delete V[z].attributes.isWaypoint;delete V[z].attributes.Status}this._solveInProgress=!0;var da={_incrementalSolveStopRange:this._incrementalSolveStopRange};this.routeTask.solve(this.routeParams,q.hitch(this,
function(ja){this._solveResultProcessing(ja,P,da).then(k.resolve,k.reject)}),q.hitch(this,function(ja){q.mixin(this,da);this._solveInProgress=!1;for(var ma=0;ma<this.stops.length;ma++)this.stops[ma].feature&&(this.stops[ma].feature.attributes=q.mixin(this.stops[ma].feature.attributes,{Status:5}));this.set("directions",null);this._clearDisplayAfterSolve();this.createRouteSymbols();this._routeTaskError(ja);k.reject(ja)}));return k.promise},_solveResultProcessing:function(k,z,P){var V=new C;q.mixin(this,
P);this._solveInProgress=!1;P=k.routeResults[0];var U=P.directions;P=P.stops;if(U){this._solverMessages=k.messages;var aa=function(Ca){for(var Ha in z)if(Ca&&0===U.routeName.indexOf(Ha)||!Ca&&0<U.routeName.indexOf(Ha))return z[Ha];return""};var da=aa(!0);aa=aa(!1);U.routeName=(da!==this._waypointName?da:t.widgets.directions.waypoint)+" \u2014 "+(aa!==this._waypointName?aa:t.widgets.directions.waypoint);for(da=0;da<U.features.length;da++)if(aa=U.features[da].attributes,"esriDMTDepart"===aa.maneuverType||
"esriDMTStop"===aa.maneuverType)for(var ja in z)if(z.hasOwnProperty(ja)&&-1<aa.text.indexOf(ja)){aa.text=aa.text.replace(ja,z[ja]);for(var ma=0;ma<P.length;ma++){var Aa=P[ma].attributes;if(Aa.Name===ja){q.mixin(U.features[da],{_associatedStop:P[this.returnToStart&&ma===P.length-1?0:ma],_associatedStopWithReturnToStart:P[ma]});if(!Aa.ArriveTime&&!Aa.ArriveTimeUTC&&aa.ETA&&aa.arriveTimeUTC){Aa.ArriveTime=aa.ETA;Aa.ArriveTimeUTC=aa.arriveTimeUTC;ma=0;if(0==da&&"esriDMTDepart"===aa.maneuverType||0<da&&
"esriDMTStop"===aa.maneuverType)ma=this._convertCostValue(aa.time,(this._getDirectionsTimeAttribute()||{}).units,"milliseconds");Aa.DepartTime=Aa.ArriveTime+ma;Aa.DepartTimeUTC=Aa.ArriveTimeUTC+ma}break}}}for(da=0;da<P.length;da++)this._returnToStartStop&&P[da].attributes.Name===this._returnToStartStop.feature.attributes.Name&&(this._returnToStartStop._resultsStopIndex=da),P[da].attributes.Name=z[P[da].attributes.Name];this._directionsPostprocessing(U);this.traffic&&this._updateMapTimeExtent()}this._showRoute(k).always(q.hitch(this,
function(){this._incrementalSolveStopRange=null;V.resolve(k)}));return V.promise},_directionsPostprocessing:function(k){var z,P=function(aa,da){var ja=k.features[aa]._associatedFeaturesWithWaypoints||[];ja.push(k.featuresWithWaypoints[da]);k.features[aa]._associatedFeaturesWithWaypoints=ja;k.featuresWithWaypoints[da]._associatedFeatureNoWaypoints=k.features[aa]};var V=q.hitch(this,function(aa){return"\x3cdiv class\x3d'"+this.theme+"'\x3e\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(aa._associatedFeatureNoWaypoints)+
"\x3c/table\x3e\x3c/div\x3e"});k.featuresWithWaypoints=[];for(z=0;z<k.features.length;z++){var U=new T(k.features[z].toJson());U.setInfoTemplate(new ta({title:this._i18n.widgets.directions.maneuver,content:V}));k.featuresWithWaypoints.push(U);k.featuresWithWaypoints[z]._associatedStop=k.features[z]._associatedStop;k.featuresWithWaypoints[z]._associatedStopWithReturnToStart=k.features[z]._associatedStopWithReturnToStart}k.stringsWithWaypoints=q.mixin([],k.strings);k.eventsWithWaypoints=q.mixin([],
k.events);for(V=z=0;z<k.features.length;)k.features[z]._associatedStop&&k.features[z]._associatedStop.attributes.Name===this._waypointName?(k.features.splice(z,z?2:1),k.strings.splice(z,z?2:1),k.events.splice(z,z?2:1),z&&k.features[z]&&"esriDMTStraight"===k.features[z].attributes.maneuverType?(U=k.features.splice(z,1)[0],k.strings[z-1]=(k.strings[z-1]||[]).concat(k.strings.splice(z,1)[0]||[]),k.strings[z-1].length||(k.strings[z-1]=void 0),k.events[z-1]=(k.events[z-1]||[]).concat(k.events.splice(z,
1)[0]||[]),k.events[z-1].length||(k.events[z-1]=void 0),k.features[z-1].attributes.length+=U.attributes.length,k.features[z-1].attributes.time+=U.attributes.time,k.features[z-1].geometry.paths[0]=k.features[z-1].geometry.paths[0].concat(U.geometry.paths[0]),P(z-1,V++),P(z-1,V++),P(z-1,V++)):(z&&P(z-1,V++),z<k.features.length&&P(z,V++))):(P(z,V++),z++)},_boldText:function(k,z){try{var P=new RegExp("[^\x3cstrong\x3e\x26nbsp;]"+z.replace(/(\||\$|\^|\(|\)|\[|\]|\{|\}|\/|\.|\+|\*|\?|\?)/g,"\\$1")+"[^\x26nbsp;\x3c/strong\x3e]",
"g");k=(" "+k+" ").replace(P,"\x3cstrong\x3e\x26nbsp;"+z+"\x26nbsp;\x3c/strong\x3e");k=k.trim()}catch(V){}return k},_clearStopGraphics:function(){if(this.stopGraphics&&this.stopGraphics.length)for(var k=0;k<this.stopGraphics.length;k++)this._stopLayer.remove(this.stopGraphics[k]),this._stopLayer.remove(this.textGraphics[k]);this.set("stopGraphics",[]);this.set("textGraphics",[])},_updateMapTimeExtent:function(){if(this.map){var k=this.directions&&this.directions.features[0]&&this.directions.features[0].attributes||
{},z=(new Date).getTime();z="none"==this.startTime?z:k.arriveTimeUTC||z;this._useTrafficItemNode.title="none"!==this.startTime&&k.arriveTimeUTC?t.widgets.directions.trafficLabelDepartAt+": "+this._toSpatiallyLocalTimeString(k.arriveTimeUTC,k.ETA):"";this._myTimeExtentUpdate=!0;k=new Date(z);this.map.setTimeExtent(new qa(k,k))}},_restoreMapTimeExtent:function(){this.map&&(this._myTimeExtentUpdate=!0,this.map.setTimeExtent(this._externalTimeExtent))},_clearRouteGraphics:function(){for(var k=this.displayedRouteGraphics,
z=this.displayedManeuverPointGraphics,P=this._routeLayer,V=this._waypointsEventLayer,U=0,aa=0,da=this._incrementalSolveStopRange?this._incrementalSolveStopRange:{start:0,end:this.stops?this.stops.length:-1};k&&aa<k.length;){if(k[aa]._associatedStop)for(var ja=0;ja<this.stops.length;ja++)if(this.stops[ja].feature===k[aa]._associatedStop){U=ja;break}U>=da.start&&U<da.end||da.start>=da.end&&(U>=da.start||U<da.end)?(P.remove(k[aa]),k.splice(aa,1)):aa++}P.remove(this._incrementalRouteSegment);this.set("displayedRouteGraphics",
k?k:[]);z&&z.length&&E.forEach(z,function(ma){V.remove(ma)});this.set("displayedManeuverPointGraphics",[]);this._waypointsEventLayer.clear();this.unhighlightSegment(!0)},_clearInfoWindow:function(){var k=this.get("map").infoWindow;k&&(k.hide(),k.clearFeatures())},_clearDisplayBeforeSolve:function(){this._toggleSaveMenu(!1);this._clearInfoWindow();this._clearResultsHTML()},_clearDisplayAfterSolve:function(){this._clearStopGraphics();this._clearRouteGraphics();this._clearBarriersGraphics();this.clearMessages()},
_getLetter:function(k){var z=this.alphabet,P="",V=function(da){var ja="";"0123456789"===z||"1234567890"===z?ja=String(da+1):(da=da||0,da>=z.length&&(ja=V(Math.floor(da/z.length)-1),da%=z.length),ja+=z[da]);return ja},U=k instanceof T?q.hitch(this,function(){for(var da=this.get("returnToStart")?0:-1,ja=0;ja<this.stops.length;ja++)if(this.stops[ja].feature===k){da=ja;break}return da})():k;if(-1<U&&z&&z.length){z instanceof Array&&(z=z.toString().replace(/,/g,""));P=-1;for(var aa=0;aa<=U;aa++)P+=this._isStopAWaypoint(this.stops[aa])?
0:1;P=V(P)}return P},_solveAndZoom:function(k){if(this.autoSolve)return this._getDirections().then(q.hitch(this,function(){k||this.zoomToFullRoute()}));var z=new C;z.resolve();return z.promise},_setupEvents:function(){this._onEvents.push(e(this.domNode,"[data-blur-on-click]:click",function(){this.blur()}));this._onEvents.push(e(this._dndNode,"[data-reverse-stops]:click, [data-reverse-stops]:keydown",q.hitch(this,function(U){U&&("click"===U.type||"keydown"===U.type&&U.keyCode===c.ENTER)&&this.modifyStopSequence()})));
this._onEvents.push(e(this._printButton,"click, keydown",q.hitch(this,function(U){U&&("click"===U.type||"keydown"===U.type&&U.keyCode===c.ENTER)&&this._printDirections()})));this._onEvents.push(e(this._resultsNode,"[data-full-route]:click, [data-full-route]:keydown",q.hitch(this,function(U){U&&("click"===U.type||"keydown"===U.type&&U.keyCode===c.ENTER)&&this.zoomToFullRoute()})));this._onEvents.push(e(this._dndNode,"[data-remove]:click, [data-remove]:keydown",q.hitch(this,function(U){if(U&&("click"===
U.type||"keydown"===U.type&&U.keyCode===c.ENTER)){var aa=G("[data-remove]",this._dndNode);U=E.indexOf(aa,U.target);this.removeStop(U)}})));this._onEvents.push(e(this._dndNode,"[data-center-at]:click, [data-center-at]:keydown",q.hitch(this,function(U){if(U&&("click"===U.type||"keydown"===U.type&&U.keyCode===c.ENTER)){var aa=G("[data-center-at]",this._dndNode);U=E.indexOf(aa,U.target);this.stops[U]&&this.stops[U].feature&&this.stops[U].feature.geometry&&this.map.centerAndZoom(this.stops[U].feature.geometry)}})));
this._onEvents.push(e(this.map,"zoom-end",q.hitch(this,function(){var U=this._segmentGraphics;U&&U[0]&&void 0!==U[0].attributes._index&&this.highlightSegment(U[0].attributes._index,!0)})));this._onEvents.push(e(this._dnd,"Drop",q.hitch(this,function(){this._dnd.sync();this.set("optimalRoute",!1);var U,aa=!1,da=[],ja=this._dnd.getAllNodes();for(U=0;U<this.geocoders.length;U++){var ma=E.indexOf(ja,this.geocoders[U]._tr);if(-1<ma&&U!==ma&&U!==ma-1){for(;0<ma&&this._isStopAWaypoint(this.stops[ma]);)ma--;
aa=!0;break}}aa&&(da=this._markWPsForRemovalAfterUserChangedStopSequence(U,ma));this._sortGeocoders();this.setListIcons();this._removeSomeWaypoints(da);this.stops[ma].name&&this.getDirections()})));this._onEvents.push(e(this._dnd,"DndStart",q.hitch(this,function(){var U=G("body")[0];H.add(U,this._css.dndDragBodyClass);this._removeLocateButtonVisibilityEvents()})));this._onEvents.push(e(this._dnd,"DndDrop, DndCancel",q.hitch(this,function(){var U=G("body")[0];H.remove(U,this._css.dndDragBodyClass);
this._setLocateButtonVisibilityEvents()})));var k=this._handle,z=q.hitch(this,function(U){var aa=q.hitch(this,function(ja,ma,Aa,Ca,Ha){var Ka=k._isShown();k.setGeometry(ja);k._tooltip.style.left=U.screenPoint.x+"px";k._tooltip.style.top=U.screenPoint.y+"px";!Ka||k._index===Aa&&k.attributes.isWaypoint===Ca||(k._remove(),Ka=!1);k.setSymbol(ma);k._index=Aa;k._isStopIcon=k._index===Math.floor(k._index);k.attributes.isWaypoint=Ca;k._isStopIcon&&(k.attributes.address=this.stopGraphics[Aa].attributes.address,
k.setInfoTemplate(this.stopGraphics[Aa].infoTemplate));if(this.canModifyWaypoints||k._isStopIcon)Ka||(this._stopLayer.add(k),(ja=k.getDojoShape())&&ja[Ca?"moveToBack":"moveToFront"].call(ja)),this.editToolbar.activate(r.MOVE,k);Ca=Ca?k._isStopIcon?t.widgets.directions.dragWaypoint:this.canModifyWaypoints?t.widgets.directions.dragRoute:"":t.widgets.directions.dragStop;k._showTooltip(Ha||Ca)});this.unhighlightSegment();if(this.mapClickActive&&this.dragging&&!this._solveInProgress&&!this._moveInProgress&&
!k._solveTimeout)if(clearTimeout(k._removeTimeout),(U.graphic._isStopIcon||U.graphic._isStopLabel)&&!U.graphic.attributes.isWaypoint&&this.canModifyStops||U.graphic._isStopIcon&&U.graphic.attributes.isWaypoint&&this.canModifyWaypoints){var da=U.graphic._isStopLabel?this.stopGraphics[U.graphic._index]:U.graphic;aa(da.geometry,this._getStopSymbol(this.stops[da._index],!0),da._index,!0===da.attributes.isWaypoint);this._stopLayer.remove(this.stopGraphics[da._index]);this._stopLayer.remove(this.textGraphics[da._index])}else if(U.graphic._isSnapFeature||
U.graphic._isHandle&&!U.graphic._isStopIcon)this._snappingManager||(this._snappingManager=this.map.snappingManager),this._snappingManager.getSnappingPoint(U.screenPoint).then(q.hitch(this,function(ja){if(!this.maxStopsReached&&!this._moveInProgress&&ja){for(var ma=this.displayedManeuverPointGraphics,Aa=null,Ca=0;Ca<ma.length;Ca++)if(ma[Ca].geometry.x===ja.x&&ma[Ca].geometry.y===ja.y){Aa=ma[Ca]._directionsFeature;ma=E.indexOf(this.directions.features,Aa);-1<ma&&this.highlightSegment(ma);break}aa(ja,
U.graphic._isHandle?k.symbol:this.waypointSymbol,U.graphic._isHandle?k._index:U.graphic._nextStopIndex,U.graphic._isHandle?k.attributes.isWaypoint:!0,Aa)}}))}),P=q.hitch(this,function(){clearTimeout(k._removeTimeout);k._removeTimeout=setTimeout(k._remove,100);this.unhighlightSegment()}),V=q.hitch(this,function(U){if(this.barrierToolActive){U=U.graphic;var aa=this.routeParams,da=aa.barriers?E.indexOf(aa.barriers.features,U):-1,ja=aa.polygonBarriers?E.indexOf(aa.polygonBarriers.features,U):-1,ma=aa.polylineBarriers?
E.indexOf(aa.polylineBarriers.features,U):-1;-1<da&&aa.barriers.features.splice(da,1);-1<ja&&aa.polygonBarriers.features.splice(ja,1);-1<ma&&aa.polylineBarriers.features.splice(ma,1);this._barriersLayer.remove(U);this._polygonBarriersLayer.remove(U);this._polylineBarriersLayer.remove(U);this._clearStopsStatusAttr();this.getDirections(!0)}});this._onEvents.push(this._waypointsEventLayer.on("mouse-move",z));this._onEvents.push(this._waypointsEventLayer.on("mouse-out",P));this._onEvents.push(this._stopLayer.on("mouse-move",
z));this._onEvents.push(this._stopLayer.on("mouse-out",P));this._onEvents.push(this._barriersLayer.on("click",V));this._onEvents.push(this._polylineBarriersLayer.on("click",V));this._onEvents.push(this._polygonBarriersLayer.on("click",V));this._editToolbarEvents();this._watchEvents.push(this.watch("theme",this._updateThemeWatch));this._watchEvents.push(this.watch("canModifyStops",this._updateCanModifyStops));this._watchEvents.push(this.watch("canModifyWaypoints",this._updateCanAddWaypoints));this._watchEvents.push(this.watch("showReturnToStartOption",
this._optionsMenu));this._watchEvents.push(this.watch("showOptimalRouteOption",this._optionsMenu));this._watchEvents.push(this.watch("returnToStart",this._setMenuNodeValues));this._watchEvents.push(this.watch("optimalRoute",this._setMenuNodeValues));this._watchEvents.push(this.watch("startTime",this._setStartTime));this._watchEvents.push(this.watch("traffic",this._setMenuNodeValues));this._watchEvents.push(this.watch("trafficLayer",this._trafficLayerUpdate));this._watchEvents.push(this.watch("routeTaskUrl",
q.hitch(this,function(){this._createRouteTask();this._setTrafficOptions()})));this._watchEvents.push(this.watch("printTaskUrl",q.hitch(this,function(){this._createPrintTask()})));this._watchEvents.push(this.watch("geometryTaskUrl",q.hitch(this,function(){this._createGeometryTask()})));this._watchEvents.push(this.watch("routeParams",q.hitch(this,function(){this._createRouteParams();this._setDefaultUnits()})));this._watchEvents.push(this.watch("searchOptions",q.hitch(this,function(){this._setSearchOptions();
this._createGlobalGeocoder();var U=this.get("searchOptions").sources;if(U)for(var aa=0;aa<this.geocoders.length;aa++)this.geocoders[aa].set("sources",U)})));this._watchEvents.push(this.watch("showReverseStopsButton",this.setListIcons));this._watchEvents.push(this.watch("editToolbar",this._editToolbarEvents));this._watchEvents.push(this.watch("showTravelModesOption",this._showTravelModesOption));this._watchEvents.push(this.watch("showMilesKilometersOption",this._showMilesKilometersOption));this._watchEvents.push(this.watch("showClearButton",
this._showClearButton));this._watchEvents.push(this.watch("directionsLengthUnits",this.setDirectionsLengthUnits));this._watchEvents.push(this.watch("directionsLanguage",this.setDirectionsLanguage));this._watchEvents.push(this.watch("mapClickActive",this._activate));this._watchEvents.push(this.watch("barrierToolActive",this._activateBarrierTool));this._watchEvents.push(this.watch("showActivateButton",this._showActivateButton));this._watchEvents.push(this.watch("showBarriersButton",this._showBarriersButton));
this._watchEvents.push(this.watch("showPrintPage",function(){I.set(this._printButton,"display",this.showPrintPage?"inline-block":"none")}));this._watchEvents.push(this.watch("showSaveButton",function(){I.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none")}))},_editToolbarEvents:function(){var k=q.hitch(this,function(P){var V="";if((P=P.routeResults?P.routeResults[0]:null)&&P.route){P=P.route.attributes;var U=this.routeParams.travelMode;if(U){V+="\x3cb\x3e"+
U.name+"\x3c/b\x3e "+t.widgets.directions.toNearbyStops+": ";var aa=void 0!==P["Total_"+U.timeAttributeName]?this._formatTime(P["Total_"+U.timeAttributeName],!1,(this._getCostAttribute(U.timeAttributeName)||{}).units):"";V+=(void 0!==P["Total_"+U.distanceAttributeName]?this._formatDistance(P["Total_"+U.distanceAttributeName],!0,(this._getCostAttribute(U.distanceAttributeName)||{}).units):"")+(aa?" \x26middot; "+aa:"")}else V=this._formatArbitraryCostsForRouteTooltip(P)}this._handle._showTooltip(V)}),
z=q.hitch(this,function(P,V){var U=new C,aa=this._handle,da=this.map.toScreen(aa._origPoint).offset(P.transform.dx+aa.symbol.xoffset,P.transform.dy+aa.symbol.yoffset);P.origMapPoint||(P.origMapPoint=this.map.toMap(da));I.set(aa._tooltip,"left",da.x+"px");I.set(aa._tooltip,"top",da.y+"px");clearTimeout(aa._solveTimeout);if(this._solveInProgress||!this._requestQueueTail.isFulfilled())aa._solveTimeout=setTimeout(function(){z(P,V).always(U.resolve)},100);else if(aa._isStopIcon){da=P.graphic._index;var ja=
this.stops[da];(ja=ja?{name:ja.name,extent:ja.extent,feature:new T(ja.feature.toJson())}:null)?(ja.feature.setGeometry(P.origMapPoint),this._modifiedWaypointIndex=this._isStopAWaypoint(this.stops[da])?da:null,this._incrementalSolveStopRange={start:this.returnToStart?(this.stops.length+da-1)%this.stops.length:Math.max(0,da-1),end:this.returnToStart?(da+1)%this.stops.length:Math.min(this.stops.length-1,da+1)},this.updateStop(ja,da,V).always(q.hitch(this,function(ma){aa._solveTimeout=null;ma.routeResults&&
k(ma);U.resolve()}))):U.resolve()}else U.resolve();return U.promise});this._onEvents.push(e(this.editToolbar,"graphic-click",q.hitch(this,function(P){if(P.graphic.attributes.isWaypoint)!P.graphic._isStopIcon||this._moveInProgress||this._solveInProgress||(this._handle._remove(),this._moveInProgress=!0,this.removeStop(P.graphic._index,!0).always(q.hitch(this,function(){this._moveInProgress=!1})));else{var V=this.get("map").infoWindow;V&&(V.setFeatures([P.graphic]),V.show(P.graphic.geometry))}})));this._onEvents.push(e(this.editToolbar,
"graphic-move-start",q.hitch(this,function(P){this._blurGeocoders();this._moveInProgress=!0;this._removeEmptyStops();this.routeParams.returnDirections=!1;this.routeParams.returnRoutes=!0;P=P.graphic;P._origPoint=new Q(P.geometry.toJson());P._maxDeviation=0;P._solveHasHappened=!1;this.map.disableMapNavigation()})));this._onEvents.push(e(this.editToolbar,"graphic-move-stop",q.hitch(this,function(P){this.map.enableMapNavigation();this.routeParams.returnDirections=!0;this.routeParams.returnRoutes=!1;
if(this._handle._isStopIcon)if(this._handle._solveHasHappened)if(this._handle.attributes.isWaypoint)z(P,!0).always(q.hitch(this,function(){this._moveInProgress=!1;this._handle._isStopIcon=!0;this._handle._remove();this._showLoadingSpinner()}));else{clearTimeout(this._handle._solveTimeout);this._handle._solveTimeout=null;var V=this.stops[P.graphic._index],U=(V&&V.feature&&V.feature.attributes&&V.feature.attributes.Name)===this._userDefinedStopName,aa=V&&V.name;this._reverseGeocode(new T(P.graphic.toJson())).then(q.hitch(this,
function(da){U&&(da.name=aa,da.feature.attributes.Name=this._userDefinedStopName);this._setReverseGeocode(da,da.feature.geometry,P.graphic._index).always(q.hitch(this,function(){this._moveInProgress=!1;this._handle._remove();this._showLoadingSpinner()}))}))}else this._moveInProgress=!1;else this._moveInProgress=!1})));this._onEvents.push(e(this.editToolbar,"graphic-move",q.hitch(this,function(P){var V=this._handle,U=P.transform;U.dx&&U.dy&&(P.graphic._maxDeviation=Math.max(V._maxDeviation,Math.sqrt(U.dx*
U.dx+U.dy*U.dy)));10<V._maxDeviation&&(V._solveHasHappened=!0,P.graphic===V&&V.attributes.isWaypoint&&!V._isStopIcon?(this.set("optimalRoute",!1),V._index+=.5,V._isStopIcon=!0,P.graphic._stopIndex=V._index,this._incrementalSolveStopRange={start:this.returnToStart?(this.stops.length+V._index-1)%this.stops.length:Math.max(0,V._index-1),end:this.returnToStart?(V._index+1)%(this.stops.length+1):Math.min(this.stops.length,V._index+1)},this.addStop({name:this._waypointName,feature:new T(V.geometry,V.symbol,
{isWaypoint:!0,CurbApproach:3})},P.graphic._stopIndex)):((V=P.graphic.getDojoShape())&&V.moveToFront(),z(P)))})))},_isStopAWaypoint:function(k){return k&&k.feature&&k.feature.attributes&&k.feature.attributes.isWaypoint},_getStopCount:function(){var k=0,z;for(z=0;z<this.stops.length;z++)k+=!this._isStopAWaypoint(this.stops[z])&&this.stops[z].name?1:0;return k},_getWaypointCount:function(){var k=0,z;for(z=0;z<this.stops.length;z++)k+=this._isStopAWaypoint(this.stops[z])?1:0;return k},_decorateUngeocodedStop:function(k){var z=
new C,P=function(U,aa){z.resolve({name:void 0===U?t.widgets.directions.unlocatedStop:U.toFixed(6)+" "+aa.toFixed(6),feature:k})};if(k.geometry)if(k.geometry.spatialReference&&4326!==k.geometry.spatialReference.wkid)if(this.map&&this.map.spatialReference&&this.map.spatialReference.isWebMercator()){var V=Ra.xyToLngLat(k.geometry.x,k.geometry.y);P(V[0],V[1])}else this._geometryService?(V=new ca,V.outSR=new Ba(4326),V.geometries=[k.geometry],this._geometryService.project(V).then(q.hitch(this,function(U){U&&
U.length?P(U[0].x,U[0].y):P(k.geometry.x,k.geometry.y)}),q.hitch(this,function(){P()}))):P(k.geometry.x,k.geometry.y);else P(k.geometry.x,k.geometry.y);else P();return z.promise},_trafficLayerUpdate:function(k,z,P){k=this.get("map");z&&this._trafficLayerAdded&&(k.removeLayer(z),this._trafficLayerAdded=!1);P&&this.get("traffic")&&!this._trafficLayerAdded&&(k.addLayer(P),P.show(),this._trafficLayerAdded=!0)},_routeTaskError:function(k){var z=t.widgets.directions.error.routeTask,P=k.details,V=function(U){return(res=
U.match(/(\d+)/))?": "+res[0]:"."};P&&1===P.length&&("The distance between any inputs must be less than 50 miles (80 kilometers) when walking."===P[0]?z=t.widgets.directions.error.maxWalkingDistance:"Driving a truck is currently not supported outside of North America and Central America."===P[0]?z=t.widgets.directions.error.nonNAmTruckingMode:0===P[0].indexOf("The number of input locations loaded into Barriers")?z=t.widgets.directions.error.tooManyBarriers+V(P[0]):0===P[0].indexOf("The number of input locations loaded into PolygonBarriers")?
z=t.widgets.directions.error.tooManyPolygonBarriers+V(P[0]):0===P[0].indexOf("The number of input locations loaded into PolylineBarriers")&&(z=t.widgets.directions.error.tooManyPolylineBarriers+V(P[0])));this._showMessage(z);this.onDirectionsFinish(k)},_showMessage:function(k,z){var P="";this.messages.push({msg:k,error:!z});if(this.messages.length){P+="\x3cul\x3e";for(var V=0;V<this.messages.length;V++)P+='\x3cli class\x3d"'+(this.messages[V].error?this._css.routesErrorClass:this._css.routesInfoClass)+
'"\x3e'+this.messages[V].msg+"\x3c/li\x3e";P+="\x3c/ul\x3e"}this._msgNode&&(this._msgNode.innerHTML=P);if(!z)this.onError(k)},_isTimeUnits:function(k){return"milliseconds"===k||"esriNAUSeconds"===k||"esriNAUMinutes"===k||"esriNAUHours"===k||"esriNAUDays"===k},_getImpedanceAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.impedanceAttributeName||this.routeParams.impedanceAttribute||this.serviceDescription.impedance)},_getDirectionsTimeAttribute:function(){return this._getCostAttribute(this.routeParams&&
this.routeParams.travelMode&&this.routeParams.travelMode.timeAttributeName||this.routeParams.directionsTimeAttribute||this.serviceDescription.directionsTimeAttribute)},_getTimeNeutralAttribute:function(){var k=(this._getDirectionsTimeAttribute()||{}).timeNeutralAttributeName;return this._getCostAttribute(k)},_getCostAttribute:function(k){for(var z=this.serviceDescription&&this.serviceDescription.networkDataset.networkAttributes||[],P,V=0;V<z.length;V++)if(z[V].name===k&&"esriNAUTCost"===z[V].usageType){P=
z[V];break}return P},_convertCostValue:function(k,z,P){var V=this._isTimeUnits(z),U=this._isTimeUnits(P);z=V?this._toMinutes(k,z):this._toMeters(k,z);return V===U?U?this._fromMinutes(z,P):this._fromMeters(z,P):k},_toMinutes:function(k,z,P){k=k||0;switch(z){case "milliseconds":k/=Math.pow(6E4,P?-1:1);break;case "esriNAUSeconds":k/=Math.pow(60,P?-1:1);break;case "esriNAUHours":k*=Math.pow(60,P?-1:1);break;case "esriNAUDays":k*=Math.pow(1440,P?-1:1)}return k},_fromMinutes:function(k,z){return this._toMinutes(k,
z,!0)},_toMeters:function(k,z,P){k=k||0;switch((z||"").replace("esriNAU","esri")){case "esriInches":k*=Math.pow(.0254,P?-1:1);break;case "esriFeet":k*=Math.pow(.3048,P?-1:1);break;case "esriYards":k*=Math.pow(.9144,P?-1:1);break;case "esriMiles":k*=Math.pow(1609.344,P?-1:1);break;case "esriNauticalMiles":k*=Math.pow(1851.995396854,P?-1:1);break;case "esriMillimeters":k/=Math.pow(1E3,P?-1:1);break;case "esriCentimeters":k/=Math.pow(100,P?-1:1);break;case "esriKilometers":k*=Math.pow(1E3,P?-1:1);break;
case "esriDecimeters":k/=Math.pow(10,P?-1:1)}return k},_fromMeters:function(k,z){return this._toMeters(k,z,!0)},_createRouteTask:function(){var k=new C;this.set("routeTask",new Qa(this.get("routeTaskUrl")));this._createRouteParams();this.routeTask.getServiceDescription(this.travelModesServiceUrl,this.doNotFetchTravelModesFromOwningSystem).then(q.hitch(this,function(z){z.networkDataset?(this.set("serviceDescription",z),this.set("maxStops",parseInt(this.userOptions.maxStops||z.serviceLimits&&z.serviceLimits.Route_MaxStops||
this.defaults.maxStops)),this.defaults.portalUrl?(this.owningSystemUrl=this.defaults.portalUrl,k.resolve()):this.routeTask.getOwningSystemUrl().then(q.hitch(this,function(P){this.owningSystemUrl=P;k.resolve()}),k.reject)):(this._showMessage(t.widgets.directions.error.cantFindRouteServiceDescription),k.reject(Error(t.widgets.directions.error.cantFindRouteServiceDescription)))}),q.hitch(this,function(){this._showMessage(t.widgets.directions.error.cantFindRouteServiceDescription);k.reject(Error(t.widgets.directions.error.cantFindRouteServiceDescription));
this.mapClickActive=!1;this._activate()}));return k.promise},_createSearchSourceDDL:function(){if(this._globalGeocoder&&this._globalGeocoder.sources&&1<this._globalGeocoder.sources.length){var k=q.hitch(this,function(V){this._searchSourceSelector.domNode.blur();this._globalGeocoder.set("activeSourceIndex",V);for(var U=0;U<this.geocoders.length;U++)this.geocoders[U].set("activeSourceIndex",V);this._truncateSearchSourceIfNeeded()});if(!this._searchSourceSelector){for(var z=[{value:"all",label:t.widgets.Search.main.all,
selected:!0}],P=0;P<this._globalGeocoder.sources.length;P++)z.push({value:String(P),label:this._globalGeocoder.sources[P].name});this._searchSourceSelector=new n({className:"esriSearchSourcesDDL",style:"width:100%;",options:z},this._searchSourceSelectorContainer);this._searchSourceSelector.startup();this._searchSourceSelector.on("change",k);this._searchSourceSelector.domNode.style.width=""}k("all")}else 2>this._globalGeocoder.sources.length&&(this._searchSourceContainerNode.style.display="none")},
_createTravelModesDDL:function(){this._travelModeSelector||(this._travelModeSelector=new n({className:"esriTravelModesDDL",style:"width:100%;"},this._travelModeSelectorContainer),this._travelModeSelector.startup(),this._travelModeSelector._interractive=!0,this._travelModeSelector.on("change",q.hitch(this,function(k){this._travelModeSelector._interractive?this._enqueue(function(){return this._setTravelMode(k).always(q.hitch(this,function(){this._travelModeSelector._interractive=!0}))}):this._travelModeSelector._interractive=
!0})))},_setupTravelModes:function(){var k=this.get("serviceDescription"),z=k.supportedTravelModes,P=new C;if(z&&z.length&&this._travelModeSelector){for(var V=z[0].name,U=[],aa=0;aa<z.length;aa++){for(var da="AUTOMOBILE"===z[aa].type?"Driving":"TRUCK"===z[aa].type?"Trucking":"WALK"===z[aa].type?"Walking":"Other",ja="",ma=k.networkDataset.networkAttributes,Aa=0;Aa<ma.length;Aa++){var Ca=ma[Aa];if(Ca.name===z[aa].impedanceAttributeName){if("esriNAUCentimeters"===Ca.units||"esriNAUDecimalDegrees"===
Ca.units||"esriNAUDecimeters"===Ca.units||"esriNAUFeet"===Ca.units||"esriNAUInches"===Ca.units||"esriNAUKilometers"===Ca.units||"esriNAUMeters"===Ca.units||"esriNAUMiles"===Ca.units||"esriNAUMillimeters"===Ca.units||"esriNAUNauticalMiles"===Ca.units||"esriNAUYards"===Ca.units)ja="Distance";else if("esriNAUDays"===Ca.units||"esriNAUHours"===Ca.units||"esriNAUMinutes"===Ca.units||"esriNAUSeconds"===Ca.units)ja="Time";break}}U.push({id:z[aa].name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+
da+ja+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName" title\x3d"'+z[aa].description+'"\x3e'+z[aa].name+"\x3c/div\x3e"});!k.defaultTravelMode||z[aa].id!==k.defaultTravelMode&&z[aa].itemId!==k.defaultTravelMode||(V=z[aa].name)}this._showTravelModesOption();this._travelModeSelector.setStore(new b({objectStore:new f({data:U})}));this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(V);this._setTravelMode(V).always(P.resolve)}else this._checkStartTimeUIAvailability(),
this.set("showTravelModesOption",!1),P.resolve();return P.promise},_createPrintTask:function(){this._printService=(this.printTaskUrl=this._usingAGOL()?this.printTaskUrl:this.defaults.printTaskUrl)?new bb(this.printTaskUrl,{async:!1}):null;var k=new Pa;k.exportOptions={width:670,height:750,dpi:96};k.format="PNG32";k.layout="MAP_ONLY";k.preserveScale=!1;k.showAttribution=!1;var z=new fb;z.map=this.map;z.outSpatialReference=this.map.spatialReference;z.template=k;this._printParams=z},_createGeometryTask:function(){this._geometryService=
null;this._usingAGOL()?this._geometryService=new Na(this.geometryTaskUrl):this.geometryTaskUrl=(this._geometryService=this.defaults.geometryTaskUrl?new Na(this.defaults.geometryTaskUrl):X.defaults.geometryService)?this._geometryService.url:null},_showTravelModesOption:function(){var k=this.get("serviceDescription");I.set(this._travelModeContainerNode,"display",this.showTravelModesOption&&k&&k.supportedTravelModes&&k.supportedTravelModes.length&&!this.doNotFetchTravelModesFromOwningSystem?"block":
"none")},_showMilesKilometersOption:function(){I.set(this._agolDistanceUnitsNode,"display",this.showMilesKilometersOption?"block":"none")},_showClearButton:function(){I.set(this._clearDirectionsButtonNode,"display",this.showClearButton?"inline-block":"none")},_showActivateButton:function(){I.set(this._activateButtonNode,"display",this.showActivateButton?"inline-block":"none");this.showActivateButton||this.deactivate()},_showBarriersButton:function(){I.set(this._lineBarrierButtonNode,"display",this.showBarriersButton?
"inline-block":"none");this.showBarriersButton||this.deactivateBarrierTool()},_createRouteParams:function(){var k={returnDirections:!0,returnRoutes:!1,outputLines:"esriNAOutputLineTrueShape",preserveFirstStop:!0,preserveLastStop:!0,directionsOutputType:"complete",stops:new Ja,ignoreInvalidLocations:!0,doNotLocateOnRestrictedElements:!0,outSpatialReference:this.get("map").spatialReference};this.get("routeParams")||(this.routeParams={});var z=new Ma;this.routeParams=q.mixin(z,{outputGeometryPrecision:0,
outputGeometryPrecisionUnits:"esriMeters",restrictUTurns:"esriNFSBAtDeadEndsOnly"},this.get("routeParams"),k)},_markWPsForRemovalAfterUserChangedStopSequence:function(k,z){for(var P=k-1,V=[];0<=P&&this._isStopAWaypoint(this.stops[P]);)V.push(this.stops[P]),P--;for(P=k+1;P<this.stops.length&&this._isStopAWaypoint(this.stops[P]);)V.push(this.stops[P]),P++;if(z>k)for(P=z+1;P<this.stops.length&&this._isStopAWaypoint(this.stops[P]);)V.push(this.stops[P]),P++;else if(void 0!==z)for(P=z-1;0<=P&&this._isStopAWaypoint(this.stops[P]);)V.push(this.stops[P]),
P--;else if(this.returnToStart&&0===k)for(P=this.stops.length-1;0<=P&&this._isStopAWaypoint(this.stops[P]);)V.push(this.stops[P]),P--;return V},_removeSomeWaypoints:function(k){for(var z=new C,P=[],V=0;V<k.length;V++){var U=E.indexOf(this.stops,k[V]);-1<U&&P.push(this._removeStop(U,!0,!0))}M(P).always(z.resolve);return z.promise},_modifyStopSequence:function(k,z){var P=this._dnd.getAllNodes(),V=new C,U,aa=[];if(P.length)if(this._removeLocateButtonVisibilityEvents(),arguments.length&&void 0!==k)if(0<=
k&&0<=z&&k<this.stops.length&&z<this.stops.length&&k!==z){P=this._markWPsForRemovalAfterUserChangedStopSequence(k,z);var da=this.stops.splice(k,1);this.stops.splice(z,0,da[0]);for(U=0;U<this.stops.length;U++)aa.push(this._updateStop(this.stops[U],U));aa.push(this._removeSomeWaypoints(P));M(aa).always(q.hitch(this,function(){this._solveAndZoom().always(V.resolve)}))}else V.reject("Invalid From and To values.");else{for(U=0;U<this.stops.length;)this._isStopAWaypoint(this.stops[U])?aa.push(this._removeStop(U,
!0,!0)):U++;M(aa).always(q.hitch(this,function(){aa=[];this.stops.reverse();for(U=0;U<this.stops.length;U++)aa.push(this._updateStop(this.stops[U],U));M(aa).always(q.hitch(this,function(){this._solveAndZoom().always(V.resolve)}))}))}else V.resolve();return V.promise},_setMenuNodeValues:function(k){"traffic"!==k&&this._clearDisplayBeforeSolve();k=this.get("optimalRoute");this._findOptimalOrderNode&&u.set(this._findOptimalOrderNode,"checked",k);this._returnToStartNode&&(k=this.returnToStart&&!this.maxStopsReached&&
this.stops[0]&&(!this.stops[0].feature||this._isStopLocated(this.stops[0])),u.set(this._returnToStartNode,"checked",k),this.set("returnToStart",k),this.maxStopsReached&&this.returnToStart&&this._showMessage(t.widgets.directions.error.maximumStops));if(!this.returnToStart&&!this._incrementalSolveStopRange&&this.directions)for(this._incrementalSolveStopRange={start:this.stops.length-1,end:this.stops.length},this._clearRouteGraphics(),this._incrementalSolveStopRange=null,k=this.stops.length;0<k--&&this._isStopAWaypoint(this.stops[k]);)this._removeSomeWaypoints([this.stops[k]]);
this._useTrafficNode&&(u.set(this._useTrafficNode,"checked",this.traffic),this.traffic?(this._updateMapTimeExtent(),this._addTrafficLayer()):(this._removeTrafficLayer(),this._restoreMapTimeExtent()));switch(this.get("directionsLengthUnits")){case Z.KILOMETERS:u.set(this._useKilometersNode,"checked",!0);u.set(this._useMilesNode,"checked",!1);break;case Z.MILES:u.set(this._useKilometersNode,"checked",!1),u.set(this._useMilesNode,"checked",!0)}I.set(this._printButton,"display",this.showPrintPage?"inline-block":
"none");I.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none");this._showMilesKilometersOption();this._showClearButton()},_optionsMenu:function(){this._useTrafficItemNode&&I.set(this._useTrafficItemNode,"display",this.get("showTrafficOption")?"block":"none");this._returnToStartItemNode&&I.set(this._returnToStartItemNode,"display",this.get("showReturnToStartOption")?"block":"none");this._findOptimalOrderItemNode&&I.set(this._findOptimalOrderItemNode,"display",
this.get("showOptimalRouteOption")&&3<this._getStopCount()?"block":"none");this.stops.length>=this.get("minStops")?H.add(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass):(H.remove(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass),this._optionsMenuNode&&"block"===I.get(this._optionsMenuNode,"display")&&this._toggleOptionsMenu())},_stopsRemovable:function(){2<this._dnd.getAllNodes().length-this._getWaypointCount()?H.add(this._widgetContainer,this._css.stopsRemovableClass):
H.remove(this._widgetContainer,this._css.stopsRemovableClass)},_checkMaxStops:function(){this.set("maxStopsReached",this._getStopCount()+this._getWaypointCount()+(this.returnToStart?1:0)>=this.maxStops);this._showAddDestination()},_updateThemeWatch:function(k,z,P){H.remove(this.domNode,z);H.add(this.domNode,P)},_toggleOptionsMenu:function(){"block"===I.get(this._optionsMenuNode,"display")?(I.set(this._optionsMenuNode,"display","none"),H.remove(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=
t.widgets.directions.showOptions):(I.set(this._optionsMenuNode,"display","block"),H.add(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=t.widgets.directions.hideOptions)},_toggleSaveMenu:function(k){"block"===I.get(this._saveMenuNode,"display")||!1===k?(I.set(this._saveMenuNode,"display","none"),H.remove(this._saveMenuButton,this._css.stopsPressedButtonClass)):(this.clearMessages(),I.set(this._saveMenuNode,"display","block"),H.add(this._saveMenuButton,this._css.stopsPressedButtonClass),
this._enableSharing().then(q.hitch(this,function(){this._outputLayer.setValue(this.routeLayer.title?this.routeLayer.title:this.directions&&this.directions.routeName);if(this.routeLayer.ownerFolder)for(var z=this._folderSelector.store.objectStore.data,P=0;P<z.length;P++)if(z[P].folderId===this.routeLayer.ownerFolder){this._folderSelector.getValue()!==z[P].id&&(this._folderSelector._interractive=!1,this._folderSelector.setValue(z[P].id));break}this._enableButton(this._saveButton,this.routeLayer.isItemOwner||
!this._userCanCreatePortalItem);this._outputLayer.set("disabled",!1)})))},_showToolbar:function(){H[this.stops.length<this.maxStops&&this.canModifyStops||this.canModifyWaypoints?"add":"remove"].call(O,this._widgetContainer,this._css.addStopsClass)},_showAddDestination:function(){this._showToolbar();this._addDestinationNode.style.display=this.stops.length<this.maxStops&&this.canModifyStops?"inline":"none"},_showMapClickActiveButton:function(){this._showToolbar();this._activateButtonNode.style.display=
this.canModifyStops||this.canModifyWaypoints?"inline-block":"none"},_getAbsoluteUrl:function(k){k=L.toUrl(k);return/^https?:/i.test(k)?k:/^\/\//i.test(k)?ka+k:/^\//i.test(k)?ka+"//"+window.location.host+k:k},_getManeuverImage:function(k){return k?"esriDMTStop"===k||"esriDMTDepart"===k?"":this._getAbsoluteUrl("./images/Directions/maneuvers/"+k+".png"):""},_loadPrintDirections:function(k){var z=this.get("printTemplate"),P=new C;this.directionsLengthUnits!==this.routeParams.directionsLengthUnits?this.getDirections().then(P.resolve,
P.reject):P.resolve();P.then(q.hitch(this,function(){if(!z&&this.directions){var V=this._getAbsoluteUrl("./css/Directions.css"),U=this._getAbsoluteUrl("./css/DirectionsPrint.css"),aa=this._getAbsoluteUrl("./images/Directions/print-logo.png");var da=y.isBodyLtr()?"ltr":"rtl";z="";z+="\x3c!DOCTYPE HTML\x3e";z+='\x3chtml lang\x3d"en" class\x3d"'+this.get("theme")+'" dir\x3d"'+da+'"\x3e';z+="\x3chead\x3e";z+='\x3cmeta charset\x3d"utf-8"\x3e';z+='\x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e';
z+="\x3ctitle\x3e"+this.get("directions").routeName+"\x3c/title\x3e";z+='\x3clink rel\x3d"stylesheet" media\x3d"screen" type\x3d"text/css" href\x3d"'+V+'" /\x3e';z+='\x3clink rel\x3d"stylesheet" media\x3d"print" type\x3d"text/css" href\x3d"'+U+'" /\x3e';z+="\x3c/head\x3e";z+='\x3cbody class\x3d"'+this._css.esriPrintPageClass+'"\x3e';z+='\x3cdiv class\x3d"'+this._css.esriPrintBarClass+'"\x3e';z+='\x3cdiv class\x3d"'+this._css.esriCloseButtonClass+'" title\x3d"'+t.common.close+'" onclick\x3d"window.close();"\x3e'+
t.common.close+"\x3c/div\x3e";z+='\x3cdiv id\x3d"printButton" class\x3d"'+this._css.esriPrintButtonClass+'" title\x3d"'+t.widgets.directions.print+'" onclick\x3d"window.print();"\x3e'+t.widgets.directions.print+"\x3c/div\x3e";z+="\x3c/div\x3e";z+='\x3cdiv class\x3d"'+this._css.esriPrintMainClass+'"\x3e';z+='\x3cdiv class\x3d"'+this._css.esriPrintHeaderClass+'"\x3e';z+='\x3cimg class\x3d"'+this._css.esriPrintLogoClass+'" src\x3d"'+aa+'" /\x3e';z+='\x3cdiv class\x3d"'+this._css.esriPrintNameClass+'"\x3e'+
this.get("directions").routeName+"\x3c/div\x3e";z+=this._renderDirectionsSummary(this.directions);k&&(z+='\x3cdiv id\x3d"divMap" class\x3d"esriPrintMap esriPrintWait"\x3e\x3c/div\x3e',z+='\x3chr class\x3d"esriNoPrint"/\x3e');z+='\x3cdiv id\x3d"print_helper"\x3e\x3c/div\x3e';z+='\x3ctextarea onkeyup\x3d"document.getElementById(\'print_helper\').innerHTML\x3dthis.value;" id\x3d"print_area" class\x3d"'+this._css.esriPrintNotesClass+'" placeholder\x3d"'+t.widgets.directions.printNotes+'"\x3e\x3c/textarea\x3e';
z+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';z+="\x3c/div\x3e";z+='\x3cdiv class\x3d"'+this._css.esriPrintDirectionsClass+'"\x3e';z+=this._renderDirectionsTable(this.directions);z+="\x3c/div\x3e";z+='\x3cdiv class\x3d"'+this._css.esriPrintFooterClass+'"\x3e';z+="\x3cp\x3e"+t.widgets.directions.printDisclaimer+"\x3c/p\x3e";z+="\x3c/div\x3e";z+="\x3c/div\x3e";z+="\x3c/body\x3e";z+="\x3c/html\x3e"}this._printWindow.document.open("text/html","replace");this._printWindow.document.write(z);
this._printWindow.document.close()}))},resize:function(){this._truncateSearchSourceIfNeeded()},_truncateSearchSourceIfNeeded:function(){var k=this._searchSourceSelector,z=k.containerNode.firstChild;k.domNode.clientWidth>this.domNode.clientWidth?I.set(z,"width",this._searchSourceContainerNode.clientWidth-20+"px"):I.set(z,"width","")},_printDirections:function(){if(this.directions){var k=screen.width/2,z=screen.height/1.5;k="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno, scrollbars\x3dyes, resizable\x3dyes, width\x3d"+
k+", height\x3d"+z+", top\x3d"+(screen.height/2-z/2)+", left\x3d"+(screen.width/2-k/2);this.get("printPage")?(window.directions=this.get("directions"),window.open(this.get("printPage"),"directions_widget_print",k,!0)):(this._printWindow=window.open("","directions_widget_print",k,!0),this._loadPrintDirections(!!this._printService),this._printService&&L(["dojo/_base/window"],q.hitch(this,function(P){this.zoomToFullRoute().then(q.hitch(this,function(){this._printService.execute(this._printParams,q.hitch(this,
function(V){P.withDoc(this._printWindow.document,function(){var U=h.byId("divMap");U&&(H.remove(U,"esriPrintWait"),H.add(U,"esriPageBreak"),O.create("img",{src:V.url,"class":"esriPrintMapImg"},U))})}),q.hitch(this,function(V){P.withDoc(this._printWindow.document,function(){var U=h.byId("divMap");U&&H.remove(U,"esriPrintWait")});console.error("Error while calling print service:\n "+V)}))}))})))}},_enableButton:function(k,z){z=z||void 0===z;H[z?"remove":"add"].apply(this,[k,"esriDisabledDirectionsButton"]);
k._enabled=z},_clearStopsStatusAttr:function(){for(var k=0;k<this.stops.length;k++)this.stops[k].feature&&this.stops[k].feature.attributes&&(this.stops[k].feature.attributes.Status=void 0)},_enableSharing:function(){var k=new C;!this._naRouteSharing&&this.owningSystemUrl?L(["../tasks/NARouteSharing"],q.hitch(this,function(z){this._naRouteSharing=new z(this.owningSystemUrl,this.map.spatialReference);this._folderSelector||(this._folderSelector=new n({className:"esriFoldersDDL",style:"width: 100%;",
sortByLabel:!1,disabled:!0,_interractive:!0,onChange:q.hitch(this,function(){this._folderSelector._interractive?this._enableButton(this._saveButton,!this.routeLayer.itemId):this._folderSelector._interractive=!0})},this._folderSelectorContainer),this._folderSelector.startup(),this._outputLayer=new g({style:"width: 100%",required:!0,trim:!0,regExp:'[^\x26|\x3c|\x3e|%|#|?|\\|"|/|+]+',maxLength:98,disabled:!0,onKeyPress:q.hitch(this,function(){this._enableButton(this._saveButton,!this.routeLayer.itemId||
!this._userCanCreatePortalItem)}),onFocus:q.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),onBlur:q.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()})},this._outputLayerContainer),this._outputLayer.startup());this._naRouteSharing.getFolders().then(q.hitch(this,function(P){for(var V=[],U=0;U<P.length;U++)V.push({id:P[U].url,folderId:P[U].id,label:P[U].title});this._folderSelector.setStore(new b({objectStore:new f({data:V})}));this._naRouteSharing.canCreateItem().then(q.hitch(this,
function(aa){this._folderSelector.set("disabled",!aa);this._userCanCreatePortalItem=aa}));this._enableButton(this._saveButton);k.resolve()}),q.hitch(this,function(P){console.log(P);this._naRouteSharing=null;this._toggleSaveMenu(!1);k.reject(P)}))})):this.owningSystemUrl?k.resolve():(k.reject(Error("Owning system is not defined, or the Directions widget is not done initializing.")),this._naRouteSharing=null);return k.promise},_storeRouteUI:function(){var k=new C;this._outputLayer&&this._outputLayer.isValid()?
this._storeRoute(this._outputLayer.getValue(),this._folderSelector.getValue(),this._folderSelector.store.objectStore.get(this._folderSelector.getValue()).folderId).then(k.resolve,k.reject):(this._outputLayer&&this._outputLayer.focus(),k.reject(Error("Need result layer name specified.")));return k.promise},_storeRoute:function(k,z,P){var V=new C,U=this.directions;if(this._savingRoute||!this._naRouteSharing)return this._saveButton.blur(),V.reject(Error("Not ready to store route.")),V.promise;this.clearMessages();
V.then(null,q.hitch(this,function($a){console.log("ERR",$a);this._showMessage(t.widgets.directions.error.cantSaveRoute)}));V.promise.always(q.hitch(this,function(){this._enableButton(this._saveButton);I.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._showLoadingSpinner();this._savingRoute=!1}));if(U&&U.features&&U.features.length&&this.stops&&this.stops.length)if(this.owningSystemUrl)if(this.routeParams&&this.routeParams.travelMode)if(k&&
z){var aa=q.hitch(this,function($a){return this._naRouteSharing.getAttributeUnits($a,this.serviceDescription)});var da=this.routeParams.travelMode.timeAttributeName;var ja=this.routeParams.travelMode.distanceAttributeName,ma=aa(da),Aa=aa(ja),Ca=this.routeParams.directionsLengthUnits||this.serviceDescription.directionsLengthUnits,Ha=this._naRouteSharing.toMeters,Ka=this._naRouteSharing.toMinutes,Ya=function($a,gb,lb){var mb;for(mb in $a)if($a.hasOwnProperty(mb)&&0===mb.indexOf(gb)&&-1===E.indexOf(lb,
mb.substr(gb.length))){var xb=xb||{};xb[mb.substr(gb.length)]=$a[mb]}return xb},Wa=[],Za=[],ib=[];if(da&&ma&&ja&&Aa){var ob=[],kb=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames||[],jb=this.serviceDescription.networkDataset.networkAttributes;for(aa=0;aa<jb.length;aa++)"esriNAUTCost"===jb[aa].usageType&&-1===E.indexOf(kb,jb[aa].name)&&jb[aa].name!==da&&jb[aa].name!==ja&&ob.push(jb[aa].name);kb=this.get("stops");var hb={xmin:Infinity,ymin:Infinity,xmax:-Infinity,
ymax:-Infinity};for(aa=0;aa<kb.length;aa++)if(kb[aa].feature&&kb[aa].feature.toJson){jb=kb[aa].feature.toJson();var cb=jb.attributes;var eb=jb.geometry,nb=this._naRouteSharing.getUTCOffset(cb.ArriveTime,cb.ArriveTimeUTC),qb=this._naRouteSharing.getUTCOffset(cb.DepartTime,cb.DepartTimeUTC);q.mixin(hb,{xmin:hb.xmin>eb.x?eb.x:hb.xmin,ymin:hb.ymin>eb.y?eb.y:hb.ymin,xmax:hb.xmax<eb.x?eb.x:hb.xmax,ymax:hb.ymax<eb.y?eb.y:hb.ymax});jb.attributes={__OBJECTID:aa+1,CurbApproach:cb.CurbApproach,ArrivalCurbApproach:cb.ArriveCurbApproach,
DepartureCurbApproach:cb.DepartCurbApproach,Name:cb.Name===this._waypointName?t.widgets.directions.waypoint:cb.Name===this._userDefinedStopName?kb[aa].name:cb.Name,RouteName:U.routeName,Sequence:cb.Sequence,Status:cb.Status,LocationType:cb.isWaypoint?1:0,TimeWindowStart:cb.TimeWindowStart,TimeWindowEnd:cb.TimeWindowEnd,TimeWindowStartUTCOffset:nb,TimeWindowEndUTCOffset:nb,ServiceMinutes:Ka(cb["Attr_"+da],ma),ServiceMeters:Ha(cb["Attr_"+ja],Aa),ServiceCosts:Y.stringify(Ya(cb,"Attr_",ob)),CumulativeMinutes:Ka(cb["Cumul_"+
da],ma),CumulativeMeters:Ha(cb["Cumul_"+ja],Aa),CumulativeCosts:Y.stringify(Ya(cb,"Cumul_",ob)),LateMinutes:Ka(cb["Violation_"+da],ma),WaitMinutes:Ka(cb["Wait_"+da],ma),ArrivalTime:this._naRouteSharing.toUTCTime(cb.ArriveTime,nb),DepartureTime:this._naRouteSharing.toUTCTime(cb.DepartTime,qb),ArrivalUTCOffset:nb,DepartureUTCOffset:qb};Wa.push(jb)}ja=0;Aa=function($a){try{$a.strings=Y.parse($a.strings)}catch(lb){vb.strings=void 0}if($a.strings&&$a.strings.length)for(var gb=0;gb<$a.strings.length;gb++)if("esriDSTGeneral"===
$a.strings[gb].stringType)return $a.strings[gb].string};kb=function($a,gb){for(var lb=[],mb=0;mb<($a||[]).length;mb++)$a[mb].stringType!==gb&&gb||lb.push($a[mb].string);return lb.length?lb.toString():void 0};jb=function($a){switch($a){case "esriDMTStop":return"esriDPTManeuverArrive";case "esriDMTDepart":return"esriDPTManeuverDepart";case "esriDMTDoorPassage":return"esriDPTManeuverDoor";case "esriDMTBearLeft":return"esriDPTManeuverBearLeft";case "esriDMTBearRight":return"esriDPTManeuverBearRight";
case "esriDMTElevator":return"esriDPTManeuverElevator";case "esriDMTEscalator":return"esriDPTManeuverEscalator";case "esriDMTFerry":return"esriDPTManeuverFerryOn";case "esriDMTEndOfFerry":return"esriDPTManeuverFerryOff";case "esriDMTForkCenter":return"esriDPTManeuverForkCenter";case "esriDMTForkLeft":return"esriDPTManeuverForkLeft";case "esriDMTForkRight":return"esriDPTManeuverForkRight";case "esriDMTPedestrianRamp":return"esriDPTManeuverPedestrianRamp";case "esriDMTRampLeft":return"esriDPTManeuverRampLeft";
case "esriDMTRampRight":return"esriDPTManeuverRampRight";case "esriDMTRoundabout":return"esriDPTManeuverRoundabout";case "esriDMTTurnLeft":return"esriDPTManeuverTurnLeft";case "esriDMTLeftLeft":return"esriDPTManeuverTurnLeftLeft";case "esriDMTLeftRight":return"esriDPTManeuverTurnLeftRight";case "esriDMTTurnRight":return"esriDPTManeuverTurnRight";case "esriDMTRightLeft":return"esriDPTManeuverTurnRightLeft";case "esriDMTRightRight":return"esriDPTManeuverTurnRightRight";case "esriDMTSharpLeft":return"esriDPTManeuverSharpLeft";
case "esriDMTSharpRight":return"esriDPTManeuverSharpRight";case "esriDMTStraight":return"esriDPTManeuverStraight";case "esriDMTStrairs":return"esriDPTManeuverStairs";case "esriDMTUTurn":return"esriDPTManeuverUTurn"}return"esriDPTUnknown"};for(aa=0;aa<U.featuresWithWaypoints.length;aa++){var ub=U.featuresWithWaypoints[aa];eb=ub.toJson();nb=eb.attributes;qb=eb.geometry&&eb.geometry.paths&&eb.geometry.paths[0]||[];var Bb=eb.geometry.hasM||qb[0]&&3===qb[0].length;cb=this._naRouteSharing.getUTCOffset(nb.ETA,
nb.arriveTimeUTC);eb.attributes={__OBJECTID:aa+1,Sequence:++ja,StopID:function(){var $a=void 0,gb=ub._associatedStopWithReturnToStart&&ub._associatedStopWithReturnToStart.attributes.Sequence;if(gb)for(var lb=0;lb<Wa.length;lb++)if(Wa[lb].attributes.Sequence===gb){$a=Wa[lb].attributes.__OBJECTID;break}return $a}(),DirectionPointType:jb(nb.maneuverType),DisplayText:ub._associatedStopWithReturnToStart&&ub._associatedStopWithReturnToStart.attributes.isWaypoint?nb.text.replace(this._waypointName,t.widgets.directions.waypoint):
nb.text,ArrivalTime:this._naRouteSharing.toUTCTime(nb.ETA,cb),ArrivalUTCOffset:cb,Azimuth:void 0,Name:kb(U.stringsWithWaypoints[aa],"esriDSTStreetName"),AlternateName:kb(U.stringsWithWaypoints[aa],"esriDSTAltName"),ExitName:kb(U.stringsWithWaypoints[aa],"esriDSTExit"),IntersectingName:kb(U.stringsWithWaypoints[aa],"esriDSTCrossStreet"),BranchName:kb(U.stringsWithWaypoints[aa],"esriDSTBranch"),TowardName:kb(U.stringsWithWaypoints[aa],"esriDSTToward"),ShortVoiceInstruction:void 0,VoiceInstruction:void 0,
Level:void 0};delete eb.symbol;delete eb.infoTemplate;qb.length?(eb.geometry={x:qb[0][0],y:qb[0][1],spatialReference:eb.geometry.spatialReference},Bb&&q.mixin(eb.geometry,{m:qb[0][2]})):delete eb.geometry;Za.push(eb);eb=ub.toJson();nb=eb.attributes;qb=eb.geometry&&eb.geometry.paths&&eb.geometry.paths[0]||[];cb=!0;for(da=0;da<qb.length-1;da++)if(qb[da][0]!==qb[da+1][0]||qb[da][1]!==qb[da+1][1]){cb=!1;break}cb||(eb.attributes={DirectionPointID:aa+1,DirectionLineType:"esriDLTSegment",Meters:Ha(nb.length,
Ca),Minutes:Ka(nb.time,ma),FromLevel:void 0,ToLevel:void 0},eb.geometry.hasM=Bb,delete eb.symbol,delete eb.infoTemplate,ib.push(eb));var vb=U.eventsWithWaypoints[eb.attributes.Sequence]||[];for(da=0;da<vb.length;da++)eb=vb[da].toJson(),nb=eb.attributes,cb=this._naRouteSharing.getUTCOffset(nb.ETA,nb.arriveTimeUTC),eb.attributes={Sequence:++ja,DirectionPointType:"esriDPTEvent",DisplayText:Aa(nb),ArrivalTime:this._naRouteSharing.toUTCTime(nb.ETA,cb),ArrivalUTCOffset:cb,Name:nb.strings},Za.push(eb)}da=
this.routeParams.barriers&&this.routeParams.barriers.features||[];var yb=[];for(aa=0;aa<da.length;aa++)ja=da[aa].toJson(),Aa=ja.attributes,ja.attributes={BarrierType:Aa.BarrierType||0,FullEdge:Aa.FullEdge||!1,AddedCost:Aa["Attr_"+this._getImpedanceAttribute().name]||0,Costs:Y.stringify(Ya(Aa,"Attr_",ob)),CurbApproach:Aa.CurbApproach||0,Name:Aa.Name},yb.push(ja);da=this.routeParams.polylineBarriers&&this.routeParams.polylineBarriers.features||[];var zb=[];for(aa=0;aa<da.length;aa++)ja=da[aa].toJson(),
Aa=ja.attributes,ja.attributes={BarrierType:Aa.BarrierType||0,ScaleFactor:Aa["Attr_"+this._getImpedanceAttribute().name]||1,Costs:Y.stringify(Ya(Aa,"Attr_",ob)),Name:Aa.Name},zb.push(ja);da=this.routeParams.polygonBarriers&&this.routeParams.polygonBarriers.features||[];var Ab=[];for(aa=0;aa<da.length;aa++)ja=da[aa].toJson(),Aa=ja.attributes,ja.attributes={BarrierType:Aa.BarrierType||0,ScaleFactor:Aa["Attr_"+this._getImpedanceAttribute().name]||1,Costs:Y.stringify(Ya(Aa,"Attr_",ob)),Name:Aa.Name},
Ab.push(ja);var Cb={geometry:U.mergedGeometry,attributes:{RouteName:U.routeName,TotalMinutes:Ka(U.totalTime,ma),TotalMeters:Ha(U.totalLength,Ca),TotalLateMinutes:function(){for(var $a=0,gb=0;gb<Wa.length;gb++)$a+=Wa[gb].attributes.LateMinutes||0;return $a}(),TotalWaitMinutes:function(){for(var $a=0,gb=0;gb<Wa.length;gb++)$a+=Wa[gb].attributes.WaitMinutes||0;return $a}(),TotalCosts:Wa[Wa.length-1].attributes.CumulativeCosts,StartTime:"none"!==this.startTime?Wa[0].attributes.ArrivalTime:null,EndTime:"none"!==
this.startTime?Wa[Wa.length-1].attributes.DepartureTime:null,StartUTCOffset:Wa[0].attributes.ArrivalUTCOffset,EndUTCOffset:Wa[Wa.length-1].attributes.DepartureUTCOffset,Messages:Y.stringify(this._solverMessages),AnalysisSettings:Y.stringify({travelMode:q.hitch(this,function(){var $a=q.clone(this.routeParams.travelMode);"\x26lt;"===$a.name.substr(0,4)&&"\x26gt;"===$a.name.substr($a.name.length-4,4)&&($a.name=$a.name.substr(4,$a.name.length-8));return $a})(),directionsLanguage:this.routeParams.directionsLanguage||
this.serviceDescription.directionsLanguage,startTimeIsUTC:this.routeParams.startTimeIsUTC,timeWindowsAreUTC:this.routeParams.timeWindowsAreUTC,findBestSequence:this.routeParams.findBestSequence,preserveFirstStop:this.routeParams.preserveFirstStop,preserveLastStop:this.routeParams.preserveLastStop,accumulateAttributeNames:this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames})}};this._enableButton(this._saveButton,!1);this._savingRoute=!0;this._showLoadingSpinner(!0);
q.hitch(this,function(){var $a=new C;this._printService?this.zoomToFullRoute().then(q.hitch(this,function(){var gb=this._printParams.template,lb=gb.exportOptions;gb.exportOptions={width:200,height:133,dpi:96};this._printService.execute(this._printParams,function(mb){gb.exportOptions=lb;$a.resolve(mb.url)},function(mb){gb.exportOptions=lb;console.error("Error while calling print service:\n "+mb);$a.resolve()})})):$a.resolve();return $a.promise})().then(q.hitch(this,function($a){var gb={folder:z,name:k,
stops:Wa,directionPoints:Za,directionLines:ib,barriers:yb,polylineBarriers:zb,polygonBarriers:Ab,extent:q.mixin(q.clone(U.extent),{xmin:hb.xmin>U.extent.xmin?U.extent.xmin:hb.xmin,ymin:hb.ymin>U.extent.ymin?U.extent.ymin:hb.ymin,xmax:hb.xmax<U.extent.xmax?U.extent.xmax:hb.xmax,ymax:hb.ymax<U.extent.ymax?U.extent.ymax:hb.ymax}),routeInfo:Cb,thumbnail:$a};this._userCanCreatePortalItem?this._naRouteSharing.store(gb,this.routeLayer.itemId,"1.0.0").then(q.hitch(this,function(lb){if(lb.success){var mb=
this._naRouteSharing.portal;mb="//"+(mb.isPortal?mb.portalHostname:mb.urlKey+"."+mb.customBaseUrl);this._toggleSaveMenu();this._showMessage(t.widgets.directions.routeIsSaved+"\x3cbr/\x3e\x3ca class\x3d'esriLinkButton' target\x3d'_blank' href\x3d'"+mb+"/home/item.html?id\x3d"+lb.id+"'\x3e"+t.widgets.directions.share+"\x3c/a\x3e",!0);if(this.routeLayer.itemId)this.onRouteItemUpdated(lb.id);else this.onRouteItemCreated(lb.id);q.mixin(this.routeLayer,{itemId:lb.id,title:gb.name,isItemOwner:!0,ownerFolder:P});
V.resolve(lb)}else V.reject(lb)}),V.reject):this._naRouteSharing.createFeatureCollection(gb,"1.0.0").then(q.hitch(this,function(lb){V.resolve(lb);this._toggleSaveMenu();this.onFeatureCollectionCreated(lb)}),V.reject)}))}else V.reject(Error("Cannot deduce the impedance used."))}else V.reject(Error("Missing required parameter: layerName, folder must be specified."));else V.reject(Error("Shared route must be built using a Travel Mode."));else V.reject(Error("Cannot store route: owning system to store routes is not defined. Please specify Portal or ArcGIS Online Url in constructor."));
else V.reject(Error("No route to share. Build a route first."));return V.promise},_loadRoute:function(k){var z=new C;z.promise.always(q.hitch(this,function(){this._showLoadingSpinner(!1);I.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._enableButton(this._saveButton,this.routeLayer.isItemOwner)}));this._reset().then(q.hitch(this,function(){this._showLoadingSpinner(!0);this._enableSharing().then(q.hitch(this,function(){var P=q.clone(this.serviceDescription),
V=q.hitch(this,function(ma){q.mixin(this.routeLayer,{itemId:k,title:ma.title,isItemOwner:ma.isItemOwner,ownerFolder:ma.ownerFolder})}),U,aa,da,ja;P.directionsLengthUnits=this.directionsLengthUnits;this._naRouteSharing.load(k,P).then(q.hitch(this,function(ma){if(ma.routeParameters){q.mixin(this.routeParams,ma.routeParameters);this.routeParams.accumulateAttributes=ma.routeParameters.accumulateAttributeNames;this.set("optimalRoute",this.routeParams.findBestSequence);this.startTime=this.routeParams.startTime?
this.routeParams.startTime:"none";this._setStartTime(void 0,void 0,this.startTime);var Aa=ma.routeParameters.travelMode,Ca=Aa?this._getCostAttribute(Aa.impedanceAttributeName):void 0;Ca=Ca?this._isTimeUnits(Ca.units)?"Time":"Distance":"";ja=P.supportedTravelModes&&P.supportedTravelModes.length?this._travelModeSelector.store.objectStore.data.slice():[];if(canUseRouteLayerTM=1!==ma.successCode&&Ca){var Ha="AUTOMOBILE"===Aa.type?"Driving":"TRUCK"===Aa.type?"Trucking":"WALK"===Aa.type?"Walking":"Other";
Aa.name="\x26lt;"+Aa.name+"\x26gt;";this.serviceDescription.supportedTravelModes=(P.supportedTravelModes||[]).concat(Aa);ja.push({id:Aa.name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+Ha+Ca+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName"\x3e'+Aa.name+"\x3c/div\x3e"});this._travelModeSelector.setStore(new b({objectStore:new f({data:ja})}));this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(Aa.name)}else{Ca=!1;if(Aa&&Aa.name)for(ja=
P.supportedTravelModes||[],U=0;U<ja.length;U++)if(ja[U].name===Aa.name){Ca=!0;this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(Aa.name);this.routeParams.travelMode=ja[U].impedanceAttributeName?ja[U]:ja[U].itemId;ma.loadMessages.push({message:t.widgets.directions.error.tmFromPortalSameName+" "+Aa.name,messageType:"Warning"});break}if(!Ca)if((Aa=P.defaultTravelMode)&&ja)for(U=0;U<ja.length;U++){if(ja[U].id===Aa){this.routeParams.travelMode=ja[U].impedanceAttributeName?ja[U]:
ja[U].itemId;ma.loadMessages.push({message:t.widgets.directions.error.tmFromPortalDefault+" "+(ja[U].name?ja[U].name:ja[U].itemId),messageType:"Warning"});break}}else this.routeParams.travelMode=null}this._checkStartTimeUIAvailability()}if(ma.solveResult&&ma.solveResult.routeResults){var Ka=Infinity,Ya=-Infinity;Aa=ma.solveResult.routeResults[0].stops;var Wa=ma.solveResult.routeResults[0].directions.features;Ca={};for(U=0;U<Aa.length;U++){var Za=Aa[U].attributes;if(Za.isWaypoint)for(aa=0;aa<Wa.length;aa++)Ha=
Wa[aa].attributes,Ha._stopSequence===Za.Sequence&&(Ha.text=Ha.text.replace(Za.Name,this._waypointName));da=Za.Name+"_"+this._stopSequence++;Ca[da]=Za.isWaypoint?this._waypointName:Za.Name;Za.Name=da;if(Za.Sequence<Ka&&(null!==Za.ArriveCurbApproach||null!==Za.DepartCurbApproach)){var ib=Za.Name;Ka=Za.Sequence}if(Za.Sequence>Ya&&(null!==Za.ArriveCurbApproach||null!==Za.DepartCurbApproach)){var ob=Za.Name;Ya=Za.Sequence}}da=ib+" - "+ob;ma.solveResult.routeResults[0].routeName=da;ma.solveResult.routeResults[0].directions.routeName=
da;for(U=0;U<Wa.length;U++)if(Ha=Wa[U].attributes,void 0!==Ha._stopSequence)for(aa=0;aa<Aa.length;aa++)if(Ha._stopSequence===Aa[aa].attributes.Sequence){da=Aa[aa].attributes.Name;Ha.text=(Ha.text||"").replace(Ca[da],da);delete Ha._stopSequence;break}ib=Aa[Aa.length-1];Aa[0].geometry.x===ib.geometry.x&&Aa[0].geometry.y===ib.geometry.y&&(this._returnToStartStop=this._addStopWrapperToGraphic(new T(ib.geometry,null,ib.attributes),Ca[ib.attributes.Name]),this.set("returnToStart",!0));this._solveResultProcessing(ma.solveResult,
Ca).then(q.hitch(this,function(){this._setStartTime(void 0,void 0,this.startTime);V(ma);this.zoomToFullRoute();z.resolve(ma)}),z.reject)}else{if(ma.routeParameters){ib=ma.routeParameters.stops.features;this.stops=[];for(U=0;U<ib.length;U++)this.stops.push(this._addStopWrapperToGraphic(ib[U],ib[U].attributes.Name)),this._updateStop(this.stops[U],U);this._setStops();ma.loadMessages.push({message:t.widgets.directions.routeLayerStopsOnly,messageType:"Warning"})}else ma.loadMessages.push({message:t.widgets.directions.routeLayerEmpty,
messageType:"Warning"});V(ma);z.resolve(ma)}for(U=0;U<ma.loadMessages.length;U++)this._showMessage(ma.loadMessages[U].message)}),q.hitch(this,function(ma){z.reject(ma);this._showMessage("GWM_0003"===ma.messageCode?t.widgets.directions.error.accessDenied+this._naRouteSharing.portal.getPortalUser().username:t.widgets.directions.error.loadError)}))}),z.reject)}),z.reject);return z.promise}});a("extend-esri")&&q.setObject("dijit.Directions",J,R);return J});