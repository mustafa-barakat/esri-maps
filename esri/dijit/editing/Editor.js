// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
/*
 @esri/arcgis-html-sanitizer - v2.7.0 - Wed Jul 14 2021 13:34:33 GMT-0400 (Eastern Daylight Time)
 Copyright (c) 2021 - Environmental Systems Research Institute, Inc.
 Apache-2.0

 js-xss
 Copyright (c) 2012-2017 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 http://ucdok.com
 MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details

 Lodash/isPlainObject
 Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
*/
require({cache:{"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(G,B,A){G.DeferredList=function(w,q,h,p,e){var l=[];B.call(this);var b=this;0!==w.length||q||this.resolve([0,[]]);var a=0;A.forEach(w,function(f,n){function m(d,c){l[n]=[d,c];a++;a===w.length&&b.resolve(l)}f.then(function(d){q?b.resolve([n,d]):m(!0,d)},function(d){h?b.reject(d):m(!1,d);if(p)return null;throw d;})})};G.DeferredList.prototype=new B;G.DeferredList.prototype.gatherResults=
function(w){w=new G.DeferredList(w,!1,!0,!1);w.addCallback(function(q){var h=[];A.forEach(q,function(p){h.push(p[1])});return h});return w};return G.DeferredList})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f,n){function m(){}function d(c){return function(g,
k,t,y){return g&&"string"==typeof k&&g[k]==m?g.on(k.substring(2).toLowerCase(),p.hitch(t,y)):c.apply(A,arguments)}}G.around(A,"connect",d);h.connect&&G.around(h,"connect",d);G=w("dijit._Widget",[a,f,n],{onClick:m,onDblClick:m,onKeyDown:m,onKeyPress:m,onKeyUp:m,onMouseDown:m,onMouseMove:m,onMouseOut:m,onMouseOver:m,onMouseLeave:m,onMouseEnter:m,onMouseUp:m,constructor:function(c){this._toConnect={};for(var g in c)this[g]===m&&(this._toConnect[g.replace(/^on/,"").toLowerCase()]=c[g],delete c[g])},postCreate:function(){this.inherited(arguments);
for(var c in this._toConnect)this.on(c,this._toConnect[c]);delete this._toConnect},on:function(c,g){return this[this._onMap(c)]===m?A.connect(this.domNode,c.toLowerCase(),this,g):this.inherited(arguments)},_setFocusedAttr:function(c){this._focused=c;this._set("focused",c)},setAttribute:function(c,g){h.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(c,g)},attr:function(c,g){return 2<=arguments.length||"object"===typeof c?this.set.apply(this,
arguments):this.get(c)},getDescendants:function(){h.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?e("[widgetId]",this.containerNode).map(b.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});q("dijit-legacy-requires")&&l(0,function(){require(["dijit/_base"])});return G})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k,t,y,K,C,r){function E(u){return function(D){e[D?"set":"remove"](this.domNode,u,D);this._set(u,D)}}n.add("dijit-legacy-requires",!m.isAsync);n.add("dojo-bidi",!1);n("dijit-legacy-requires")&&g(0,function(){G(["dijit/_base/manager"])});var F={};w=h("dijit._WidgetBase",[k,K],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:E("lang"),dir:"",_setDirAttr:E("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(u){this._set("ownerDocument",u)},attributeMap:{},_blankGif:w.blankGif||G.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var u=this.constructor;if(!u._setterAttrs){var D=u.prototype,z=u._setterAttrs=[];u=u._onMap={};for(var M in D.attributeMap)z.push(M);for(M in D)/^on/.test(M)&&(u[M.substring(2).toLowerCase()]=M),/^_set[A-Z](.*)Attr$/.test(M)&&(M=M.charAt(4).toLowerCase()+
M.substr(5,M.length-9),D.attributeMap&&M in D.attributeMap||z.push(M))}},postscript:function(u,D){this.create(u,D)},create:function(u,D){this._introspect();this.srcNodeRef=p.byId(D);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);u&&(this.params=u,d.mixin(this,u));this.postMixInProperties();this.id||(this.id=r.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=
this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=y.body(this.ownerDocument);r.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();if((u=this.srcNodeRef)&&u.parentNode&&this.domNode!==u){u.parentNode.replaceChild(this.domNode,u);var z=!0}this.domNode.setAttribute("widgetId",this.id)}this.postCreate();z&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var u={},D;for(D in this.params||{})u[D]=this._get(D);B.forEach(this.constructor._setterAttrs,
function(z){if(!(z in u)){var M=this._get(z);M&&this.set(z,M)}},this);for(D in u)this.set(D,u[D])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var u=this.baseClass.split(" ");this.isLeftToRight()||(u=u.concat(B.map(u,function(D){return D+"Rtl"})));l.add(this.domNode,u)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,B.forEach(this.getChildren(),function(u){u._started||
u._destroyed||!d.isFunction(u.startup)||(u.startup(),u._started=!0)}))},destroyRecursive:function(u){this._beingDestroyed=!0;this.destroyDescendants(u);this.destroy(u)},destroy:function(u){function D(z){z.destroyRecursive?z.destroyRecursive(u):z.destroy&&z.destroy(u)}this._beingDestroyed=!0;this.uninitialize();B.forEach(this._connects,d.hitch(this,"disconnect"));B.forEach(this._supportingWidgets,D);this.domNode&&B.forEach(r.findWidgets(this.domNode,this.containerNode),D);this.destroyRendering(u);
r.remove(this.id);this._destroyed=!0},destroyRendering:function(u){this.bgIframe&&(this.bgIframe.destroy(u),delete this.bgIframe);this.domNode&&(u?e.remove(this.domNode,"widgetId"):b.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(u||b.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(u){B.forEach(this.getChildren(),function(D){D.destroyRecursive&&D.destroyRecursive(u)})},uninitialize:function(){return!1},_setStyleAttr:function(u){var D=this.domNode;d.isObject(u)?
f.set(D,u):D.style.cssText=D.style.cssText?D.style.cssText+("; "+u):u;this._set("style",u)},_attrToDom:function(u,D,z){z=3<=arguments.length?z:this.attributeMap[u];B.forEach(d.isArray(z)?z:[z],function(M){var H=this[M.node||M||"domNode"];switch(M.type||"attribute"){case "attribute":d.isFunction(D)&&(D=d.hitch(this,D));M=M.attribute?M.attribute:/^on[A-Z][a-zA-Z]*$/.test(u)?u.toLowerCase():u;H.tagName?e.set(H,M,D):H.set(M,D);break;case "innerText":H.innerHTML="";H.appendChild(this.ownerDocument.createTextNode(D));
break;case "textContent":H.textContent=D;break;case "innerHTML":H.innerHTML=D;break;case "class":l.replace(H,D,this[u]);break;case "toggleClass":l.toggle(H,M.className||u,D)}},this)},get:function(u){var D=this._getAttrNames(u);return this[D.g]?this[D.g]():this._get(u)},set:function(u,D){if("object"===typeof u){for(var z in u)this.set(z,u[z]);return this}z=this._getAttrNames(u);var M=this[z.s];if(d.isFunction(M))var H=M.apply(this,Array.prototype.slice.call(arguments,1));else{M=this.focusNode&&!d.isFunction(this.focusNode)?
"focusNode":"domNode";var x=this[M]&&this[M].tagName,J;if((J=x)&&!(J=F[x])){J=this[M];var L={};for(N in J)L[N.toLowerCase()]=!0;J=F[x]=L}var N=J;z=u in this.attributeMap?this.attributeMap[u]:z.s in this?this[z.s]:N&&z.l in N&&"function"!=typeof D||/^aria-|^data-|^role$/.test(u)?M:null;null!=z&&this._attrToDom(u,D,z);this._set(u,D)}return H||this},_attrPairNames:{},_getAttrNames:function(u){var D=this._attrPairNames;if(D[u])return D[u];var z=u.replace(/^[a-z]|-[a-zA-Z]/g,function(M){return M.charAt(M.length-
1).toUpperCase()});return D[u]={n:u+"Node",s:"_set"+z+"Attr",g:"_get"+z+"Attr",l:z.toLowerCase()}},_set:function(u,D){var z=this[u];this[u]=D;!this._created||z===D||z!==z&&D!==D||(this._watchCallbacks&&this._watchCallbacks(u,z,D),this.emit("attrmodified-"+u,{detail:{prevValue:z,newValue:D}}))},_get:function(u){return this[u]},emit:function(u,D,z){D=D||{};void 0===D.bubbles&&(D.bubbles=!0);void 0===D.cancelable&&(D.cancelable=!0);D.detail||(D.detail={});D.detail.widget=this;var M,H=this["on"+u];H&&
(M=H.apply(this,z?z:[D]));this._started&&!this._beingDestroyed&&c.emit(this.domNode,u.toLowerCase(),D);return M},on:function(u,D){var z=this._onMap(u);return z?A.after(this,z,D,!0):this.own(c(this.domNode,u,D))[0]},_onMap:function(u){var D=this.constructor,z=D._onMap;if(!z){z=D._onMap={};for(var M in D.prototype)/^on/.test(M)&&(z[M.replace(/^on/,"").toLowerCase()]=M)}return z["string"==typeof u&&u.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},
getChildren:function(){return this.containerNode?r.findWidgets(this.containerNode):[]},getParent:function(){return r.getEnclosingWidget(this.domNode.parentNode)},connect:function(u,D,z){return this.own(q.connect(u,D,this,z))[0]},disconnect:function(u){u.remove()},subscribe:function(u,D){return this.own(t.subscribe(u,d.hitch(this,D)))[0]},unsubscribe:function(u){u.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():a.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&
"none"!=f.get(this.domNode,"display")},placeAt:function(u,D){var z=!u.tagName&&r.byId(u);!z||!z.addChild||D&&"number"!==typeof D?(u=z&&"domNode"in z?z.containerNode&&!/after|before|replace/.test(D||"")?z.containerNode:z.domNode:p.byId(u,this.ownerDocument),b.place(this.domNode,u,D),!this._started&&(this.getParent()||{})._started&&this.startup()):z.addChild(this,D);return this},defer:function(u,D){var z=setTimeout(d.hitch(this,function(){z&&(z=null,this._destroyed||d.hitch(this,u)())}),D||0);return{remove:function(){z&&
(clearTimeout(z),z=null);return null}}}});n("dojo-bidi")&&w.extend(C);return w})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(G,B,A){return A("dijit.Destroyable",null,{destroy:function(w){this._destroyed=!0},own:function(){var w=["destroyRecursive","destroy","remove"];G.forEach(arguments,function(q){function h(){p.remove();G.forEach(e,function(b){b.remove()})}var p=B.before(this,"destroy",function(b){q[l](b)}),e=[];if(q.then){var l="cancel";
q.then(h,h)}else G.forEach(w,function(b){"function"===typeof q[b]&&(l||(l=b),e.push(B.after(q,b,h,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(G,B,A,w,q,h){G=w("dijit._OnDijitClickMixin",null,{connect:function(p,e,l){return this.inherited(arguments,[p,"ondijitclick"==e?h:e,l])}});G.a11yclick=h;return G})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase",
"dojo/_base/declare","dojo/_base/lang"],function(G,B,A,w){w.extend(B,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return A("dijit._FocusMixin",null,{_focusManager:G})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(G,B,A,w){A(function(){B("highcontrast")&&G.add(w.body(),"dijit_a11y")});return B})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(G,B,A,w,q,h,p){q.add("highcontrast",function(){var e=p.doc.createElement("div");try{e.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(B.blankGif||G.toUrl("./resources/blank.gif"))+'");';p.body().appendChild(e);var l=w.getComputedStyle(e),b=l.backgroundImage;return l.borderTopColor==l.borderRightColor||b&&("none"==b||"url(invalid-url:)"==b)}catch(a){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
a.toString()),!1}finally{8>=q("ie")?e.outerHTML="":p.body().removeChild(e)}});h(function(){q("highcontrast")&&A.add(p.body(),"dj_a11y")});return q})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(G,B,A,w,q,h,p){h.extend(G,{waiRole:"",waiState:""});return q("dijit._Templated",[B,A],{constructor:function(){p.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(e,l){var b=this.inherited(arguments),a=l(e,"waiRole");a&&e.setAttribute("role",a);(a=l(e,"waiState"))&&w.forEach(a.split(/\s*,\s*/),function(f){-1!=f.indexOf("-")&&(f=f.split("-"),e.setAttribute("aria-"+f[0],f[1]))});return b}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(G,B,A,w,q,h,p,e){var l=B("dijit._TemplatedMixin",e,{templateString:null,
templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(b){var a=this.declaredClass,f=this;return p.substitute(b,this,function(n,m){"!"==m.charAt(0)&&(n=w.getObject(m.substr(1),!1,f));if("undefined"==typeof n)throw Error(a+" template:"+m);return null==n?"":"!"==m.charAt(0)?n:this._escapeValue(""+n)},this)},_escapeValue:function(b){return b.replace(/["'<>&]/g,function(a){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[a]})},buildRendering:function(){if(!this._rendered){this.templateString||
(this.templateString=G(this.templatePath,{sanitize:!0}));var b=l.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument);if(w.isString(b)){var a=A.toDom(this._stringRepl(b),this.ownerDocument);if(1!=a.nodeType)throw Error("Invalid template: "+b);}else a=b.cloneNode(!0);this.domNode=a}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(b){var a=this.containerNode;if(b&&a)for(;b.hasChildNodes();)a.appendChild(b.firstChild)}});
l._templateCache={};l.getCachedTemplate=function(b,a,f){var n=l._templateCache,m=b,d=n[m];if(d){try{if(!d.ownerDocument||d.ownerDocument==(f||document))return d}catch(c){}A.destroy(d)}b=p.trim(b);if(a||b.match(/\$\{([^\}]+)\}/g))return n[m]=b;a=A.toDom(b,f);if(1!=a.nodeType)throw Error("Invalid template: "+b);return n[m]=a};h("ie")&&q(window,"unload",function(){var b=l._templateCache,a;for(a in b){var f=b[a];"object"==typeof f&&A.destroy(f);delete b[a]}});return l})},"dojo/cache":function(){define(["./_base/kernel",
"./text"],function(G){return G.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(G,B,A,w,q,h,p,e,l){var b=q.delegate(e,{mouseenter:h.enter,mouseleave:h.leave,keypress:A._keypress}),a;A=w("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);
this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(f){for(var n=f;;)if(1==n.nodeType&&(this._processTemplateNode(n,function(m,d){return m.getAttribute(d)},this._attach)||this.searchContainerNode)&&n.firstChild)n=n.firstChild;else{if(n==f)break;for(;!n.nextSibling;)if(n=n.parentNode,n==f)return;n=n.nextSibling}},_processTemplateNode:function(f,n,m){var d=!0,c=this.attachScope||this,g=n(f,"dojoAttachPoint")||n(f,"data-dojo-attach-point");if(g)for(var k=g.split(/\s*,\s*/);g=
k.shift();)q.isArray(c[g])?c[g].push(f):c[g]=f,d="containerNode"!=g,this._attachPoints.push(g);if(n=n(f,"dojoAttachEvent")||n(f,"data-dojo-attach-event"))for(g=n.split(/\s*,\s*/),k=q.trim;n=g.shift();)if(n){var t=null;-1!=n.indexOf(":")?(t=n.split(":"),n=k(t[0]),t=k(t[1])):n=k(n);t||(t=n);this._attachEvents.push(m(f,n,q.hitch(c,t)))}return d},_attach:function(f,n,m){n=n.replace(/^on/,"").toLowerCase();n="dijitclick"==n?a||(a=G("./a11yclick")):b[n]||n;return p(f,n,m)},_detachTemplateNodes:function(){var f=
this.attachScope||this;B.forEach(this._attachPoints,function(n){delete f[n]});this._attachPoints=[];B.forEach(this._attachEvents,function(n){n.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});q.extend(l,{dojoAttachEvent:"",dojoAttachPoint:""});return A})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(G,B,A,w,q){return A("dijit._WidgetsInTemplateMixin",
null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var h=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);q.parse(h,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(w.hitch(this,function(p){this._startupWidgets=p;for(var e=0;e<p.length;e++)this._processTemplateNode(p[e],
function(l,b){return l[b]},function(l,b,a){return b in l?l.connect(l,b,a):l.on(b,a,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(h,p,e){return p(h,"dojoType")||p(h,"data-dojo-type")?
!0:this.inherited(arguments)},startup:function(){G.forEach(this._startupWidgets,function(h){h&&!h._started&&h.startup&&h.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c){function g(C){return eval("("+C+")")}function k(C){var r=
C._nameCaseMap,E=C.prototype;if(!r||r._extendCnt<y){r=C._nameCaseMap={};for(var F in E)"_"!==F.charAt(0)&&(r[F.toLowerCase()]=F);r._extendCnt=y}return r}function t(C,r){r||(r=G);var E=r._dojoParserCtorMap||(r._dojoParserCtorMap={}),F=C.join();if(!E[F]){for(var u=[],D=0,z=C.length;D<z;D++){var M=C[D];u[u.length]=E[M]=E[M]||A.getObject(M)||~M.indexOf("/")&&r(M)}C=u.shift();E[F]=u.length?C.createSubclass?C.createSubclass(u):C.extend.apply(C,u):C}return E[F]}new Date("X");var y=0;l.after(A,"extend",function(){y++},
!0);var K={_clearCache:function(){y++;_ctorMap={}},_functionFromScript:function(C,r){var E="",F="",u=C.getAttribute(r+"args")||C.getAttribute("args");r=C.getAttribute("with");u=(u||"").split(/\s*,\s*/);r&&r.length&&w.forEach(r.split(/\s*,\s*/),function(D){E+="with("+D+"){";F+="}"});return new Function(u,E+C.innerHTML+F)},instantiate:function(C,r,E){r=r||{};E=E||{};var F=(E.scope||B._scopeName)+"Type",u="data-"+(E.scope||B._scopeName)+"-",D=u+"type",z=u+"mixins",M=[];w.forEach(C,function(H){var x=
F in r?r[F]:H.getAttribute(D)||H.getAttribute(F);if(x){var J=H.getAttribute(z);x=J?[x].concat(J.split(/\s*,\s*/)):[x];M.push({node:H,types:x})}});return this._instantiate(M,r,E)},_instantiate:function(C,r,E,F){function u(D){r._started||E.noStart||w.forEach(D,function(z){"function"!==typeof z.startup||z._started||z.startup()});return D}C=w.map(C,function(D){var z=D.ctor||t(D.types,E.contextRequire);if(!z)throw Error("Unable to resolve constructor for: '"+D.types.join()+"'");return this.construct(z,
D.node,r,E,D.scripts,D.inherited)},this);return F?b(C).then(u):u(C)},construct:function(C,r,E,F,u,D){function z(V){T&&A.setObject(T,V);for(N=0;N<Q.length;N++)l[Q[N].advice||"after"](V,Q[N].method,A.hitch(V,Q[N].func),!0);for(N=0;N<W.length;N++)W[N].call(V);for(N=0;N<aa.length;N++)V.watch(aa[N].prop,aa[N].func);for(N=0;N<R.length;N++)d(V,R[N].event,R[N].func);return V}var M=C&&C.prototype;F=F||{};var H={};F.defaults&&A.mixin(H,F.defaults);D&&A.mixin(H,D);if(n("dom-attributes-explicit"))var x=r.attributes;
else n("dom-attributes-specified-flag")?x=w.filter(r.attributes,function(V){return V.specified}):(D=(/^input$|^img$/i.test(r.nodeName)?r:r.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),x=w.map(D.split(/\s+/),function(V){var ba=V.toLowerCase();return{name:V,value:"LI"==r.nodeName&&"value"==V||"enctype"==ba?r.getAttribute(ba):r.getAttributeNode(ba).value}}));var J=F.scope||B._scopeName;D="data-"+J+"-";var L={};"dojo"!==J&&
(L[D+"props"]="data-dojo-props",L[D+"type"]="data-dojo-type",L[D+"mixins"]="data-dojo-mixins",L[J+"type"]="dojotype",L[D+"id"]="data-dojo-id");var N=0,P;J=[];for(var T,S;P=x[N++];){var Z=P.name,da=Z.toLowerCase();P=P.value;switch(L[da]||da){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":S=P;break;case "data-dojo-id":case "jsid":T=P;break;case "data-dojo-attach-point":case "dojoattachpoint":H.dojoAttachPoint=P;break;case "data-dojo-attach-event":case "dojoattachevent":H.dojoAttachEvent=
P;break;case "class":H["class"]=r.className;break;case "style":H.style=r.style&&r.style.cssText;break;default:if(Z in M||(Z=k(C)[da]||Z),Z in M)switch(typeof M[Z]){case "string":H[Z]=P;break;case "number":H[Z]=P.length?Number(P):NaN;break;case "boolean":H[Z]="false"!=P.toLowerCase();break;case "function":""===P||-1!=P.search(/[^\w\.]+/i)?H[Z]=new Function(P):H[Z]=A.getObject(P,!1)||new Function(P);J.push(Z);break;default:da=M[Z],H[Z]=da&&"length"in da?P?P.split(/\s*,\s*/):[]:da instanceof Date?""==
P?new Date(""):"now"==P?new Date:a.fromISOString(P):da instanceof e?B.baseUrl+P:g(P)}else H[Z]=P}}for(x=0;x<J.length;x++)L=J[x].toLowerCase(),r.removeAttribute(L),r[L]=null;if(S)try{S=g.call(F.propsThis,"{"+S+"}"),A.mixin(H,S)}catch(V){throw Error(V.toString()+" in data-dojo-props\x3d'"+S+"'");}A.mixin(H,E);u||(u=C&&(C._noScript||M._noScript)?[]:m("\x3e script[type^\x3d'dojo/']",r));var Q=[],W=[],aa=[],R=[];if(u)for(N=0;N<u.length;N++)L=u[N],r.removeChild(L),E=L.getAttribute(D+"event")||L.getAttribute("event"),
F=L.getAttribute(D+"prop"),S=L.getAttribute(D+"method"),J=L.getAttribute(D+"advice"),x=L.getAttribute("type"),L=this._functionFromScript(L,D),E?"dojo/connect"==x?Q.push({method:E,func:L}):"dojo/on"==x?R.push({event:E,func:L}):H[E]=L:"dojo/aspect"==x?Q.push({method:S,advice:J,func:L}):"dojo/watch"==x?aa.push({prop:F,func:L}):W.push(L);C=(u=C.markupFactory||M.markupFactory)?u(H,r,C):new C(H,r);return C.then?C.then(z):z(C)},scan:function(C,r){function E(da){if(!da.inherited){da.inherited={};var Q=da.node,
W=E(da.parent);Q={dir:Q.getAttribute("dir")||W.dir,lang:Q.getAttribute("lang")||W.lang,textDir:Q.getAttribute(x)||W.textDir};for(var aa in Q)Q[aa]&&(da.inherited[aa]=Q[aa])}return da.inherited}var F=[],u=[],D={},z=(r.scope||B._scopeName)+"Type",M="data-"+(r.scope||B._scopeName)+"-",H=M+"type",x=M+"textdir";M+="mixins";var J=C.firstChild,L=r.inherited;if(!L){L=function aa(Q,W){return Q.getAttribute&&Q.getAttribute(W)||Q.parentNode&&aa(Q.parentNode,W)};L={dir:L(C,"dir"),lang:L(C,"lang"),textDir:L(C,
x)};for(var N in L)L[N]||delete L[N]}N={inherited:L};for(var P,T;;)if(J)if(1!=J.nodeType)J=J.nextSibling;else if(P&&"script"==J.nodeName.toLowerCase())(L=J.getAttribute("type"))&&/^dojo\/\w/i.test(L)&&P.push(J),J=J.nextSibling;else if(T)J=J.nextSibling;else if(L=J.getAttribute(H)||J.getAttribute(z),C=J.firstChild,L||C&&(3!=C.nodeType||C.nextSibling)){T=null;if(L){var S=J.getAttribute(M);P=S?[L].concat(S.split(/\s*,\s*/)):[L];try{T=t(P,r.contextRequire)}catch(da){}T||w.forEach(P,function(da){~da.indexOf("/")&&
!D[da]&&(D[da]=!0,u[u.length]=da)});S=T&&!T.prototype._noScript?[]:null;N={types:P,ctor:T,parent:N,node:J,scripts:S};N.inherited=E(N);F.push(N)}else N={node:J,scripts:P,parent:N};P=S;T=J.stopParser||T&&T.prototype.stopParser&&!r.template;J=C}else J=J.nextSibling;else{if(!N||!N.node)break;J=N.node.nextSibling;T=!1;N=N.parent;P=N.scripts}var Z=new f;u.length?(n("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+u.join(", ")),(r.contextRequire||G)(u,function(){Z.resolve(w.filter(F,
function(da){if(!da.ctor)try{da.ctor=t(da.types,r.contextRequire)}catch(aa){}for(var Q=da.parent;Q&&!Q.types;)Q=Q.parent;var W=da.ctor&&da.ctor.prototype;da.instantiateChildren=!(W&&W.stopParser&&!r.template);da.instantiate=!Q||Q.instantiate&&Q.instantiateChildren;return da.instantiate}))})):Z.resolve(F);return Z.promise},_require:function(C,r){C=g("{"+C.innerHTML+"}");var E=[],F=[],u=new f;r=r&&r.contextRequire||G;for(var D in C)E.push(D),F.push(C[D]);r(F,function(){for(var z=0;z<E.length;z++)A.setObject(E[z],
arguments[z]);u.resolve(arguments)});return u.promise},_scanAmd:function(C,r){var E=new f,F=E.promise;E.resolve(!0);var u=this;m("script[type\x3d'dojo/require']",C).forEach(function(D){F=F.then(function(){return u._require(D,r)});D.parentNode.removeChild(D)});return F},parse:function(C,r){!C||"string"==typeof C||"nodeType"in C||(r=C,C=r.rootNode);var E=C?h.byId(C):p.body();r=r||{};var F=r.template?{template:!0}:{},u=[],D=this;C=this._scanAmd(E,r).then(function(){return D.scan(E,r)}).then(function(z){return D._instantiate(z,
F,r,!0)}).then(function(z){return u=u.concat(z)}).otherwise(function(z){console.error("dojo/parser::parse() error",z);throw z;});A.mixin(u,C);return u}};B.parser=K;q.parseOnLoad&&c(100,K,"parse");return K})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(G,B){var A={};G.setObject("dojo.date.stamp",A);A.fromISOString=function(w,q){A._isoRegExp||(A._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);
var h=A._isoRegExp.exec(w);w=null;if(h){h.shift();h[1]&&h[1]--;h[6]&&(h[6]*=1E3);q&&(q=new Date(q),B.forEach(B.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(l){return q["get"+l]()}),function(l,b){h[b]=h[b]||l}));w=new Date(h[0]||1970,h[1]||0,h[2]||1,h[3]||0,h[4]||0,h[5]||0,h[6]||0);100>h[0]&&w.setFullYear(h[0]||1970);var p=0,e=h[7]&&h[7].charAt(0);"Z"!=e&&(p=60*(h[8]||0)+(Number(h[9])||0),"-"!=e&&(p*=-1));e&&(p-=w.getTimezoneOffset());p&&w.setTime(w.getTime()+6E4*
p)}return w};A.toISOString=function(w,q){var h=function(b){return 10>b?"0"+b:b};q=q||{};var p=[],e=q.zulu?"getUTC":"get",l="";"time"!=q.selector&&(l=w[e+"FullYear"](),l=["0000".substr((l+"").length)+l,h(w[e+"Month"]()+1),h(w[e+"Date"]())].join("-"));p.push(l);"date"!=q.selector&&(l=[h(w[e+"Hours"]()),h(w[e+"Minutes"]()),h(w[e+"Seconds"]())].join(":"),e=w[e+"Milliseconds"](),q.milliseconds&&(l+="."+(100>e?"0":"")+h(e)),q.zulu?l+="Z":"time"!=q.selector&&(w=w.getTimezoneOffset(),q=Math.abs(w),l+=(0<
w?"-":"+")+h(Math.floor(q/60))+":"+h(q%60)),p.push(l));return p.join("T")};return A})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented dojo/has!extend-esri?./OperationBase".split(" "),function(G,B,A,w,q,h){G=G([h],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},
constructor:function(p){p=p||{};p.maxOperations&&(this.maxOperations=p.maxOperations);this._historyStack=[]},add:function(p){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,0,p);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var p=this.peekUndo();this.position--;p?(p=p.performUndo(),this.onUndo(),this._checkAvailability(),w(p).then(B.hitch(this,
this.onUndoComplete))):(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var p=this.peekRedo();this.position++;p?(p=p.performRedo(),this.onRedo(),this._checkAvailability(),w(p).then(B.hitch(this,this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===
this.length?(this.canUndo=!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&
this.position<this._historyStack.length)return this.get(this.position)},get:function(p){return this._historyStack[p]},remove:function(p){0<this._historyStack.length&&(this._historyStack.splice(p,1),0<this.position&&p<this.position&&this.position--,this._checkAvailability())},destroy:function(){this._historyStack=null}});A("extend-esri")&&(q.UndoManager=G);return G})},"esri/layers/FeatureLayer":function(){define("require module dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/global dojo/promise/all ../sniff ../kernel ../lang ../request ../config ../deferredUtils ../promiseList ../SpatialReference ../urlUtils ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/jsonUtils ../support/expressionUtils ../arcadeProfiles/labelingProfile ../tasks/QueryTask ../tasks/query ../tasks/FeatureSet ../tasks/StatisticDefinition ../geometry/Extent ../geometry/jsonUtils ../geometry/normalizeUtils ../geometry/scaleUtils ./GraphicsLayer ./Field ./TimeInfo ./TimeReference ./FeatureType ./FeatureTemplate ./FeatureSubtype ./FeatureEditResult ./LabelClass ./support/domainUtils ./SnapshotMode ./OnDemandMode ./SelectionMode ./StreamMode ./GridLayout ./TrackManager ./HeatmapManager ./clustering/ClusterManager dojo/i18n!../nls/jsapi dojo/has!extend-esri?./agscommon".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k,t,y,K,C,r,E,F,u,D,z,M,H,x,J,L,N,P,T,S,Z,da,Q,W,aa,R,V,ba,ha,qa,va,sa,Ba,Aa,X,ea,ia,la,ma,ua,xa,ta,ya){var Ca=y.defaults,Fa=!!c("esri-pbf"),Ga=!!c("esri-featurelayer-pbf"),na=A(aa,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reSQLCurrentTimestamp:/current_timestamp|current_date|current_time/i,reHostedFS:/(https?:)?\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4E3,maxRecordCountForAuto:2E3,
maxVertexCountForAuto:25E4,generalizeForScale:4E3,_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error",
"info"]},constructor:function(v,I){this._preventInit||this._initFeatureLayer(v,I)},_initFeatureLayer:function(v,I){I=I||{};this._tileWidth=I.tileWidth||512;this._tileHeight=I.tileHeight||512;this.i18n=ya;this._featureReduction=this._featureReduction||I.featureReduction;this._featureReductionEnabled=null!=I.featureReductionEnabled?I.featureReductionEnabled:!0;this._featureUpdatesCheckEnabled=null!=I.featureUpdatesCheckEnabled?I.featureUpdatesCheckEnabled:!0;this.showLabels=null!=I.showLabels?I.showLabels:
!0;this._outFields=I.outFields;this._defnExpr=I.definitionExpression;this._loadCallback=I.loadCallback;this._trackIdField=I.trackIdField;this.objectIdField=I.objectIdField;var O=null!=I.resolution,U=null!=I.maxAllowableOffset;this._maxOffset=this._optMaxOffset=O||U?O?I.resolution:I.maxAllowableOffset:this.maxAllowableOffset;this.quantize=null!=I.quantize?I.quantize:!0;this._optEditable=I.editable;this._optAutoGen=I.autoGeneralize;this.editSummaryCallback=I.editSummaryCallback;this.userId=I.userId;
this.userIsAdmin=I.userIsAdmin;this.useMapTime=I.hasOwnProperty("useMapTime")?!!I.useMapTime:!0;this.source=I.source;this.gdbVersion=I.gdbVersion;this.orderByFields=I.orderByFields;this.maxPointCountForAuto=null!=I.maxPointCountForAuto?I.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=I.maxRecordCountForAuto?I.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=I.maxVertexCountForAuto?I.maxVertexCountForAuto:this.maxVertexCountForAuto;
this.generalizeForScale=null!=I.generalizeForScale?I.generalizeForScale:this.generalizeForScale;this.queryPagination=this._optQueryPagination=null!=I.queryPagination?I.queryPagination:!0;this.multipatchOption=I.multipatchOption;this.subtypeSublayerInfo=I.subtypeSublayerInfo;this._selectedFeatures={};this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();O=k.isDefined(I.mode)?I.mode:na.MODE_ONDEMAND;this._isStream&&(O=na.MODE_STREAM);this.mode=O;switch(O){case na.MODE_SNAPSHOT:this.currentMode=
na.MODE_SNAPSHOT;this._mode=new X(this);break;case na.MODE_ONDEMAND:case na.MODE_AUTO:this.currentMode=na.MODE_ONDEMAND;this._mode=new ea(this);this.latticeTiling=I.latticeTiling;break;case na.MODE_SELECTION:this.currentMode=na.MODE_SELECTION;this._mode=new ia(this);this._isSelOnly=!0;break;case na.MODE_STREAM:this.currentMode=na.MODE_STREAM,this._mode=new la(this),this._isStream=!0}this._initLayer=q.hitch(this,this._initLayer);this._selectHandler=q.hitch(this,this._selectHandler);this._editable=
!1;if(q.isObject(v)&&v.layerDefinition)return this._collection=!0,this.mode=this._isStream?na.MODE_STREAM:na.MODE_SNAPSHOT,this._isStream||this._outFields||(this._outFields=["*"]),this._initLayer(v),this;this.source&&(v={source:this.source.toJson()},this._url.query=q.mixin(this._url.query,{layer:p.toJson(v)}));this.gdbVersion&&(this._url.query=q.mixin(this._url.query,{gdbVersion:this.gdbVersion}));this._task=new N(this.url,{source:this.source,gdbVersion:this.gdbVersion});v=this._url.path;this._fserver=
!1;-1!==v.search(/\/FeatureServer\//i)&&(this._fserver=!0);this._checkFeatureLimit();(I=I.resourceInfo)?this._initLayer(I):t({url:v,content:q.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},_initLayer:function(v,I){if(v||I){this._json=v;I=this.subtypeSublayerInfo;this._findCredential();if(this.credential&&this.credential.ssl||v&&v._ssl)this._useSSL(),this._task._useSSL();this._collection&&(this._isStream||
(this.currentMode=na.MODE_SNAPSHOT,this._mode=new X(this)),this._featureSet=v.featureSet,this._nextId=v.nextObjectId,v=v.layerDefinition);this.version=v.currentVersion;this.version||(this.version="capabilities"in v||"drawingInfo"in v||"hasAttachments"in v||"htmlPopupType"in v||"relationships"in v||"timeInfo"in v||"typeIdField"in v||"types"in v?10:9.3);this.geometryType=v.geometryType;v.bandCount&&v.fields&&1<v.fields.length&&(this.geometryType="esriGeometryPolygon",this._isImageService=!0);"string"!==
typeof this.multipatchOption&&"esriGeometryMultiPatch"===this.geometryType&&(this.multipatchOption="xyFootprint");if(v.hasOwnProperty("capabilities")){var O=this.capabilities=v.capabilities;O&&-1!==O.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1}else this._collection||(this._editable=this._fserver);k.isDefined(this._optEditable)?(this._editable=this._optEditable,delete this._optEditable):"esriGeometryMultiPatch"===this.geometryType&&(this._editable=!1);this._isImageService&&
(this._editable=!1);this._json=p.toJson(this._json);this.isEditable()?this._setMaxOffset(null):this._canAutoGeneralize()&&(this._autoGeneralize=k.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===na.MODE_ONDEMAND||this.mode===na.MODE_AUTO,delete this._optAutoGen);O=v.effectiveMinScale||v.minScale;var U=v.effectiveMaxScale||v.maxScale;!this._hasMin&&O&&this.setMinScale(O);!this._hasMax&&U&&this.setMaxScale(U);this.layerId=v.id;this.name=I&&I.title||v.name;this.description=v.description;this.copyright=
v.copyrightText;this.type=v.type;this.displayField=v.displayField;this.defaultDefinitionExpression=v.definitionExpression||(v.isView?v.viewDefinitionQuery:v.definitionQuery);this.fullExtent=new Z(v.extent);this.initialExtent=new Z(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new r(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=v.defaultVisibility;this.editingInfo=v.editingInfo;this.supportsLastEditDate=!(!this.editingInfo||null==this.editingInfo.lastEditDate);
if("esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.hasM=v.hasM||!1;this.hasZ=v.hasZ||!1;this.indexedFields=v.indexedFields;this.indexes=v.indexes;this.maxRecordCount=v.maxRecordCount;this.canModifyLayer=v.canModifyLayer;this.supportsStatistics=v.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:v.supportsAdvancedQueries;this.supportsCalculate=v.supportsCalculate;this.supportsASyncCalculate=v.supportsASyncCalculate;
this.supportsAttachmentsByUploadId=v.supportsAttachmentsByUploadId;this.supportsCoordinatesQuantization=v.supportsCoordinatesQuantization;this.supportsQuantizationEditMode=v.supportsQuantizationEditMode;this.supportsFieldDescription=v.supportsFieldDescriptionProperty;this.supportsFormatPBF=v.supportedQueryFormats?-1!==h.map(v.supportedQueryFormats.toLowerCase().split(","),q.trim).indexOf("pbf"):!1;this.quantize=this.quantize&&this.supportsCoordinatesQuantization;this.hasLabels=v.hasLabels;this.canScaleSymbols=
v.canScaleSymbols;this.supportsRollbackOnFailureParameter=this.supportsRollbackOnFailure=v.supportsRollbackOnFailure;this.syncCanReturnChanges=v.syncCanReturnChanges;this.isDataVersioned=v.isDataVersioned;this.editFieldsInfo=v.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=v.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=v.relationships;this.allowGeometryUpdates=
k.isDefined(v.allowGeometryUpdates)?v.allowGeometryUpdates:!0;this.allowUpdateWithoutMValues=!!v.allowUpdateWithoutMValues;this.enableZDefaults=!!v.enableZDefaults;this.zDefault=k.isDefined(v.zDefault)?v.zDefault:null;this.advancedQueryCapabilities=v.advancedQueryCapabilities||{supportsStatistics:this.supportsStatistics,supportsOrderBy:this.supportsAdvancedQueries,supportsDistinct:this.supportsAdvancedQueries};this.geometryProperties=v.hasGeometryProperties&&v.geometryProperties||null;this.url&&(this.advancedQueryCapabilities.supportsPagination=
this.advancedQueryCapabilities.supportsPagination&&(this.reHostedFS.test(this.url)||10.3<this.version));this.queryPagination=this._optQueryPagination&&this.advancedQueryCapabilities.supportsPagination;this.useStandardizedQueries=v.useStandardizedQueries;this.tileMaxRecordCount=v.tileMaxRecordCount;this.standardMaxRecordCount=v.standardMaxRecordCount;if(O=v.dateFieldsTimeReference)this.dateFieldsTimeReference=new ba(O);this._setMaxOffset(this._maxOffset,!0);this._isTable="Table"===this.type;U=v.fields;
this._createFields(U);if(!this.objectIdField){this.objectIdField=v.objectIdField;if(!this.objectIdField)for(U=v.fields,O=0;O<U.length;O++){var Y=U[O];if("esriFieldTypeOID"===Y.type){this.objectIdField=Y.name;break}}this.objectIdField||this._isStream||console.debug("esri.layers.FeatureLayer: "+k.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!k.isDefined(this._nextId)){U=this.objectIdField;Y=-1;if(this._collection&&U){var ca=(O=this._featureSet)&&O.features,fa=ca?ca.length:
0;for(O=0;O<fa;O++){var ja=(ja=ca[O].attributes)&&ja[U];ja>Y&&(Y=ja)}}this._nextId=Y+1}this.globalIdField=v.globalIdField;if(O=this.typeIdField=v.typeIdField)if(O=!this._getField(O)&&this._getField(O,!0))this.typeIdField=O.name;this.visibilityField=v.visibilityField;if(U=v.defaultSymbol)this.defaultSymbol=z.fromJson(U);var pa=this.types=[],ka=v.types;Y=(O=this.editFieldsInfo)&&O.creatorField;ca=O&&O.editorField;ja=Y||ca;fa=[];if(ka)for(O=0;O<ka.length;O++){var wa=new ha(ka[O]);var ra=wa.templates;
ja&&ra&&ra.length&&(fa=fa.concat(ra));pa.push(wa)}ka=v.templates;wa=this.templates=[];if(ka)for(O=0;O<ka.length;O++)pa=new qa(ka[O]),ja&&fa.push(pa),wa.push(pa);for(O=0;O<fa.length;O++)if(ja=q.getObject("prototype.attributes",!1,fa[O]))Y&&delete ja[Y],ca&&delete ja[ca];if(O=v.subtypeField)this.subtypeField=(O=this.getField(O))?O.name:null;this.defaultSubtypeCode=v.defaultSubtypeCode;this.subtypes=h.map(v.subtypes,function(Ea){return new va(Ea)});this._applySTSublayerInfo(I);if(I=v.timeInfo)this.timeInfo=
new V(I),this._startTimeField=I.startTimeField,this._endTimeField=I.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?I.trackIdField=this._trackIdField:this._trackIdField=I.trackIdField;this.hasAttachments=!this._collection&&v.hasAttachments?!0:!1;this.htmlPopupType=v.htmlPopupType;I=v.drawingInfo;(O=I&&I.labelingInfo)&&!this.labelingInfo&&(this.labelingInfo=h.map(O,function(Ea){return new Ba(Ea)}),this._fixLabelExpr());if(!this.renderer)if(I&&I.renderer){var oa=
I.renderer;this.setRenderer(x.fromJson(oa,{geometryType:this.geometryType}));"classBreaks"===oa.type&&this.renderer.setMaxInclusive(!0);if(!this._collection){var za=oa.type;O=[];oa=this.renderer;switch(za){case "simple":O.push(oa.symbol);break;case "uniqueValue":case "classBreaks":O.push(oa.defaultSymbol),O=O.concat(h.map(oa.infos,function(Ea){return Ea.symbol}))}O=h.filter(O,k.isDefined);var Da=this._url.path+"/images/",Ha=this._getToken();h.forEach(O,function(Ea){var Ia=Ea.url;Ia&&(-1===Ia.search(/https?:/)&&
-1===Ia.indexOf("data:")&&(Ea.url=Da+Ia),Ha&&-1!==Ea.url.search(/https?:/)&&(Ea.url+="?token\x3d"+Ha))})}}else if(U)ka=this.types,0<ka.length?(oa=new H(this.defaultSymbol,this.typeIdField),h.forEach(ka,function(Ea){oa.addValue(Ea.id,Ea.symbol)})):oa=new M(this.defaultSymbol),this.setRenderer(oa);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":za=new F;break;case "esriGeometryPolyline":za=new u;break;case "esriGeometryPolygon":za=new D;break;
default:this.hasXYFootprint()&&(za=new D)}this.setRenderer(za?new M(za):null)}za=I&&I.transparency||0;!this.hasOwnProperty("opacity")&&0<za&&(this.opacity=1-za/100);(c("ie")||7<=c("trident")||c("safari"))&&this.isEditable()&&10.02>this.version&&(this._ts=!0);this.statistics=v.statistics;this._fixRendererFields();this._updateRequiredFieldsFromLabelingInfo();this._checkFields();this._updateCaps();var Ja=function(){null==this._maxOffset||this._isFractionalOffsetAllowed()||this._setMaxOffset(this._maxOffset);
this.loaded=!0;this.setFeatureReduction(this.getFeatureReduction());this.currentMode!==na.MODE_SNAPSHOT&&(this.queryPagination=!1);this.onLoad(this);var Ea=this._loadCallback;Ea&&(delete this._loadCallback,Ea(this))};v=[];this._collection?(za=this._featureSet,this._featureSet=null,this._mode._drawFeatures(new T(za)),this._fcAdded=!0):(v.push(this._forceIdentity()),this._limitPromise&&v.push(this._limitPromise));v.push(this._evalArcadeSupport());v.length?C(v).then(q.hitch(this,function(){Ja.call(this)})):
Ja.call(this)}},_applySTSublayerInfo:function(v){v&&this.subtypeField&&(this.subtypeCode=v.subtypeCode,this._applySTSublayerDefinitionExpression(v),this._filterSubtypes(v),this._applySTTemplates(v),this._applySTFieldOverrides(v))},_applySTSublayerDefinitionExpression:function(v){var I=[],O=this.getDefinitionExpression();O&&I.push(O);(v=v.layerDefinition&&v.layerDefinition.definitionExpression)&&I.push(v);1<I.length&&(I=h.map(I,function(U){return"("+U+")"}));this.setDefinitionExpression(I.length?I.join(" AND "):
null)},_applySTTemplates:function(v){if(v=v.layerDefinition&&v.layerDefinition.templates)this.templates=h.map(v,function(I){return new qa(I)})},_filterSubtypes:function(){this.subtypes&&(this.subtypes=h.filter(this.subtypes,function(v){return v.code===this.subtypeCode},this))},_applySTFieldOverrides:function(v){var I=v.layerDefinition&&v.layerDefinition.fieldOverrides;if(I){this.fields=h.filter(this.fields,function(U){return h.some(I,function(Y){return Y.name===U.name})});var O=this.getSubtypeByCode(this.subtypeCode).domains;
this.fields.forEach(function(U){var Y=h.filter(I,function(ca){return ca.name===U.name})[0];Y.alias&&(U.alias=Y.alias);if(!1===Y.editable||U.name===this.subtypeField)U.editable=!1;O&&(Y=O[U.name])&&"inherited"!==Y.type&&(U.domain=Aa.fromJson(Y.toJson()))},this)}},setShowLabels:function(v){var I=this.showLabels;this.showLabels=v;I!==this.showLabels&&(this._evalSurfaceType(),this.onShowLabelsChange())},onShowLabelsChange:function(){},onRendererChange:function(v){this.inherited(arguments);var I=this._map;
this._ager=!!(v&&v.observationAger&&v.observationRenderer);v&&"colors"in v&&"blurRadius"in v&&"maxPixelIntensity"in v?(this._evalSurfaceType(!0),"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&I&&(this._heatmapManager=new xa(this),this._heatmapManager.initialize(I))):this.renderer&&this.renderer.getRendererInfo?h.some(this.renderer.rendererInfos,function(Y){return Y.renderer&&"colors"in Y.renderer&&"blurRadius"in Y.renderer})||(this._heatmapManager=null):this._heatmapManager=null;this.timeInfo&&
I&&(v&&(v.latestObservationRenderer||v.trackRenderer)?this._trackManager||(this._trackManager=new ua(this),this._trackManager.initialize(I),this._childLayer=this._trackManager.container,this._mode._applyTimeFilter()):this._trackManager&&!this._isStream&&(this._trackManager.destroy(),this._trackManager=null));if(v){var O=[];I=h.filter([v,v.observationRenderer,v.latestObservationRenderer,v.trackRenderer],k.isDefined);var U=function(Y){return null!=Y&&"function"!=typeof Y&&Y};h.forEach(I,function(Y){var ca=
U(Y.attributeField),fa=U(Y.attributeField2);Y=U(Y.attributeField3);!1!==ca&&O.push(ca);!1!==fa&&O.push(fa);!1!==Y&&O.push(Y)});this._requiredFields=O}else this._requiredFields=[];this.loaded&&(this._fixRendererFields(),this._checkFields(this._requiredFields),this._collection&&(this._typesDirty=!0))},setFeatureReduction:function(v){v&&(v=q.mixin({},v),null!=v.clusterSize&&null==v.clusterRadius&&(v.clusterRadius=v.clusterSize),delete v.clusterSize);this.loaded?this._isFeatureReductionSupported(v)?this._featureReduction=
v:(this._featureReduction=null,v&&console.log("Clustering is not supported for this layer: "+this.url)):this._featureReduction=v;this._evalFeatureReduction(this._featureReduction)},hasFeatureReduction:function(){return!!this._featureReduction},getFeatureReduction:function(){var v=this._featureReduction;if(v){v=q.mixin({},v);var I=this._clusterManager;if(I=I&&I.aggregationInfo)v.clusterRadius=I.clusterRadius,v.infoTemplate=I.infoTemplate}return v},isFeatureReductionActive:function(){var v=this._clusterManager;
return!!(v&&v.isClusteringEnabled()&&v.isClusteringActive())},isFeatureReductionEnabled:function(){return this._featureReductionEnabled},enableFeatureReduction:function(){this._featureReductionEnabled||(this._featureReductionEnabled=!0,this._evalFeatureReduction(this._featureReduction))},disableFeatureReduction:function(){this._featureReductionEnabled&&(this._featureReductionEnabled=!1,this._evalFeatureReduction(this._featureReduction))},isFeatureReductionApplied:function(){return this.hasFeatureReduction()&&
this.isFeatureReductionEnabled()&&this._canCluster(this.getFeatureReduction())},getAggregateGraphics:function(){return this._clusterManager?this._clusterManager.getAggregateGraphics():[]},getChildGraphics:function(v){return this._clusterManager?this._clusterManager.getFeaturesInCluster(v):[]},getSingleGraphics:function(){return this._clusterManager?this._clusterManager.getSingleGraphics():[]},getFeatureReductionRenderer:function(){return this.isFeatureReductionActive()?this._clusterManager.getClusterRenderer():
null},getFeatureReductionLayer:function(){return this._clusterManager?this._clusterManager.container:null},getFeatureReductionField:function(v){var I,O=this._clusterManager?this._clusterManager.getClusterFields():null;v=v?v.toLowerCase():"";h.some(O,function(U){v===U.name.toLowerCase()&&(I=U);return!!I});return I},_isFeatureReductionSupported:function(v){return v&&"cluster"===v.type&&"esriGeometryPoint"===this.geometryType&&(this._collection||this._isStream||this._optQueryPagination&&this.advancedQueryCapabilities.supportsPagination)},
_isReductionCompatibleRenderer:function(v){v=v&&v.declaredClass||"";v=v.toLowerCase();return-1<v.indexOf("simplerenderer")||-1<v.indexOf("classbreaksrenderer")||-1<v.indexOf("uniquevaluerenderer")},_evalFeatureReduction:function(v){this.loaded&&this.getMap()&&(v=v||this.getFeatureReduction(),this._evalModeFromFReduction(v),v&&this.isFeatureReductionEnabled()?this._canCluster(v)?this._clusterManager?this._updateClusterManager(v):(this._clusterManager=this._createClusterManager(v),this.onFeatureReductionChange()):
(console.log("Clustering is supported only for point layers where map spatial reference is WGS84 or Web Mercator"),this._destroyClusterManager()):this._destroyClusterManager())},_canCluster:function(v){var I=this._map;if(!I)return!1;I=I.spatialReference;return this._isFeatureReductionSupported(v)&&this._isReductionCompatibleRenderer(this.renderer)&&(I.isWebMercator()||4326===I.wkid)},_createClusterManager:function(v){v=new ta({layer:this,aggregationInfo:v});this._clusterHandles=[v.on("renderer-change",
q.hitch(this,function(){this.onFeatureReductionRendererChange()}))];v.initialize(this._map);return v},_updateClusterManager:function(v){var I=this._clusterManager;I&&I.setAggregationInfo(v)},_destroyClusterManager:function(v){h.forEach(this._clusterHandles,function(I){I.remove()});this._clusterHandles=null;this._clusterManager&&(this._clusterManager.destroy(v),this._clusterManager=null,this.onFeatureReductionChange())},redraw:function(){this.inherited(arguments);this._clusterManager&&this._clusterManager.redraw();
this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(v){this.inherited(arguments);var I=this._getRenderer();this._ager=!!(I&&I.observationAger&&I.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(I&&I.trackRenderer);v&&this._evalFeatureReduction()},_graphicVisibilityChanged:function(v){this._clusterManager?this._clusterManager.toggleFeatureVisibility(v):this._heatmapManager&&
this._heatmapManager.redraw()},setWebGLFetchOptions:function(v){this._hasOnDemandDrillMode()&&(v=v||{},null!=v.maxDrillLevel&&(this._mode.maxDrillLevel=v.maxDrillLevel),null!=v.maxRecordCountFactor&&(this._mode.maxRecordCountFactor=v.maxRecordCountFactor),null!=v.enablePBFQuery&&(this._mode.enablePBFQuery=v.enablePBFQuery))},_isWebGLCompatible:function(){return this.loaded&&!this.isEditable()&&!this.isFeatureReductionApplied()&&(!this.labelingInfo||!1===this.showLabels)&&!this._isGeometryOperationsUsed()&&
this._isRendererSupportedInWebGL()&&this.supportsCoordinatesQuantization&&("esriGeometryPolygon"!==this.geometryType||this.advancedQueryCapabilities.supportsReturningGeometryCentroid)&&this.currentMode===na.MODE_ONDEMAND&&(!this._preSurfaceChangeState||this._preSurfaceChangeState.currentMode===na.MODE_ONDEMAND)},_isRendererSupportedInWebGL:function(){if(!this.renderer)return!1;var v=this.renderer,I=v.declaredClass?v.declaredClass.toLowerCase():"";return(-1<I.indexOf("simplerenderer")||-1<I.indexOf("classbreaksrenderer")||
-1<I.indexOf("uniquevaluerenderer"))&&this._hasWebGLCompatibleSymbols(v)&&this._hasWebGLCompatibleVVs(v)},_hasWebGLCompatibleSymbols:function(v){v=this._getAllSymbolsInRenderer(v);return!(this._hasSLSWithMarker(v)||this._hasIncompatibleSMSStyles(v)||this._hasGIFMarker(v))},_hasWebGLCompatibleVVs:function(v){return!h.some(v&&v.visualVariables,function(I){var O=I.type;return("colorInfo"===O||"opacityInfo"===O)&&I.stops&&8<I.stops.length||"sizeInfo"===O&&(I.field||I.valueExpression&&"$view.scale"!==
I.valueExpression||I.expression&&"view.scale"!==I.expression)&&I.stops&&6<I.stops.length?!0:!1})},_hasSLSWithMarker:function(v){return h.some(v,function(I){return I&&"simplelinesymbol"===I.type&&!!I.marker})},_hasIncompatibleSMSStyles:function(v){var I=void 0===c("ie")&&7==c("trident");return h.some(v,function(O){return O&&"simplemarkersymbol"===O.type&&("triangle"===O.style||"path"===O.style&&I)})},_hasGIFMarker:function(v){var I=/\.gif$/,O=/^image\/gif$/;return h.some(v,function(U){return U&&"picturemarkersymbol"===
U.type?I.test(U.url)||O.test(U.contentType):!1})},_getAllSymbolsInRenderer:function(v){var I=[];v&&(I.push(v.symbol),I.push(v.defaultSymbol),h.forEach(v.infos,function(O){I.push(O.symbol)}),I=h.filter(I,function(O){return!!O}));return I},_setMap:function(v){var I=this.inherited(arguments),O=this._mode,U=this;O&&v.loaded&&O.initialize(v);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());this._addHandle=this.on("graphic-node-add",function(Y){Y=
Y.graphic.attributes;(Y=U._selectedFeatures[Y&&Y[U.objectIdField]])&&Y.attr("data-selected","")});return I},_unsetMap:function(v){this._suspendImpl(!0);this._destroyClusterManager(!1);this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);w.disconnect(this._zoomConnect);w.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this.inherited("_unsetMap",arguments)},onAttach:function(){this._evalModeFromSurface()},onRefreshTick:function(){this.isFeatureUpdatesCheckActive()&&
this._evalFeatureUpdates()},refresh:function(v){!this._needsRefresh&&v&&v.scheduled&&this.isFeatureUpdatesCheckActive()||(this._needsRefresh=!1,(v=this._mode)&&v.refresh())},setFeatureUpdatesCheckEnabled:function(v){this._featureUpdatesCheckEnabled=v},isFeatureUpdatesCheckEnabled:function(){return!!this._featureUpdatesCheckEnabled},isFeatureUpdatesCheckActive:function(){return this.supportsLastEditDate&&this.isFeatureUpdatesCheckEnabled()&&!!this.refreshInterval&&!!q.getObject("onFeatureUpdatesResult.after",
!1,this)},hasFeatureUpdates:function(){var v=new e;if(!this.supportsLastEditDate)return v.reject(Error("FeatureLayer does not support supportsLastEditDate")),v.promise;if(!this._fetchMetadataPromise||this._fetchMetadataPromise.isFulfilled())this._fetchMetadataPromise=t({url:this._url.path,content:q.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(q.hitch(this,function(I){I=I.editingInfo.lastEditDate;var O=this.editingInfo.lastEditDate!==I;this.editingInfo.lastEditDate=I;return O}));
this._fetchMetadataPromise.then(function(I){v.isFulfilled()||v.resolve(I)}).otherwise(function(I){v.isFulfilled()||v.reject(I)});return v.promise},hasXYFootprint:function(){return"esriGeometryMultiPatch"===this.geometryType&&"xyFootprint"===this.multipatchOption},getOutFields:function(){return h.filter(this._getOutFields(),function(v){return"*"===v||!!this._getField(v)},this)},getField:function(v){return this._getField(v,!0)},isOutField:function(v){v=this.getField(v);if(!v)return!1;var I=this.getOutFields();
return-1<h.indexOf(I,"*")||-1<h.indexOf(I,v.name)},getFieldLabel:function(v){var I=this.infoTemplate;I=I&&I.getFieldInfo&&I.getFieldInfo(v);v=q.isFunction(v)?null:this.getField(v);var O=I||v,U="";O&&(U=I&&I.label||v&&v.alias||O.name||O.fieldName);return U},getDomain:function(v,I){var O,U,Y=(I=I&&I.feature)&&this.typeIdField&&I.attributes&&I.attributes[this.typeIdField];null!=Y&&h.some(this.types,function(ca){return ca.id==Y?((O=ca.domains&&ca.domains[v])&&"inherited"===O.type&&(O=this._getLayerDomain(v),
U=!0),!0):!1},this);U||O||(O=this._getLayerDomain(v));return O},_getLayerDomain:function(v){this._createFieldsIndex();var I=this._fieldsIndex;if(I)return I=I.caseSensitive,(I=I.get(v))?I.domain:null;var O;h.some(this.fields,function(U){U.name===v&&(O=U.domain);return!!O});return O},getType:function(v){return this.getTypeById(v&&this.typeIdField&&v.attributes&&v.attributes[this.typeIdField])},getTypeById:function(v){var I;h.some(this.types,function(O){O.id==v&&(I=O);return!!I});return I},getSubtypeByCode:function(v){var I;
h.some(this.subtypes,function(O){O.code==v&&(I=O);return!!I});return I},setEditable:function(v){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(this._isImageService)return this;if(!this.loaded)return this._optEditable=v,this;var I=this._editable;this._editable=v;this._updateCaps();if(I!==v)this.onCapabilitiesChange();return this},getEditCapabilities:function(v){var I={canCreate:!1,canUpdate:!1,canDelete:!1,
canUpdateGeometry:!1};if(!this.loaded||!this.isEditable())return I;var O=v&&v.feature;v=v&&v.userId||this.getUserId();var U=h.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],q.trim),Y=(I=-1<h.indexOf(U,"editing"))&&-1<h.indexOf(U,"create"),ca=I&&-1<h.indexOf(U,"update");U=I&&-1<h.indexOf(U,"delete");var fa=this.ownershipBasedAccessControlForFeatures,ja=this.editFieldsInfo,pa=ja&&ja.creatorField;ja=ja&&ja.realm;O=(O=O&&O.attributes)&&pa?O[pa]:void 0;var ka=!!this.userIsAdmin;pa=
!fa||ka||!(!fa.allowOthersToUpdate&&!fa.allowUpdateToOthers);var wa=!fa||ka||!(!fa.allowOthersToDelete&&!fa.allowDeleteToOthers),ra=!fa||ka||!fa.hasOwnProperty("allowAnonymousToUpdate")||fa.allowAnonymousToUpdate;fa=!fa||ka||!fa.hasOwnProperty("allowAnonymousToDelete")||fa.allowAnonymousToDelete;v&&ja&&(v=v+"@"+ja);if(ka||I&&!(Y||ca||U))Y=ca=U=!0;I={canCreate:Y,canUpdate:ca,canDelete:U,canUpdateGeometry:ka||this.allowGeometryUpdates};v||(I.canUpdate=I.canUpdate&&ra,I.canDelete=I.canDelete&&fa);null===
O?(I.canUpdate=I.canUpdate&&pa,I.canDelete=I.canDelete&&wa):""!==O&&O&&v.toLowerCase()!==O.toLowerCase()&&(I.canUpdate=I.canUpdate&&pa,I.canDelete=I.canDelete&&wa);return I},getUserId:function(){var v;this.loaded&&(v=this.credential&&this.credential.userId||this.userId||"");return v},setUserIsAdmin:function(v){this.userIsAdmin=v},setEditSummaryCallback:function(v){this.editSummaryCallback=v},getEditSummary:function(v,I,O){O=k.isDefined(O)?O:(new Date).getTime();var U="";O=this.getEditInfo(v,I,O);
(I=I&&I.callback||this.editSummaryCallback)&&(O=I(v,O)||"");if(q.isString(O))U=O;else{if(O){v=O.action;I=O.userId;var Y=O.timeValue,ca=0;v&&ca++;I&&ca++;k.isDefined(Y)&&ca++;1<ca&&(U=("edit"===v?"edit":"create")+(I?"User":"")+(k.isDefined(Y)?O.displayPattern:""))}U=U&&k.substitute(O,this.i18n.layers.FeatureLayer[U])}return U},getEditInfo:function(v,I,O){if(this.loaded){O=k.isDefined(O)?O:(new Date).getTime();I=I&&I.action||"last";var U=this.editFieldsInfo,Y=U&&U.creatorField,ca=U&&U.creationDateField,
fa=U&&U.editorField;U=U&&U.editDateField;fa=(v=v&&v.attributes)&&fa?v[fa]:void 0;U=v&&U?v[U]:null;Y=this._getEditData(v&&Y?v[Y]:void 0,v&&ca?v[ca]:null,O);O=this._getEditData(fa,U,O);switch(I){case "creation":var ja=Y;break;case "edit":ja=O;break;case "last":ja=O||Y}ja&&(ja.action=ja===O?"edit":"creation");return ja}},_getEditData:function(v,I,O){if(k.isDefined(I)){var U=O-I;var Y=0>U?"Full":6E4>U?"Seconds":12E4>U?"Minute":36E5>U?"Minutes":72E5>U?"Hour":864E5>U?"Hours":6048E5>U?"WeekDay":"Full"}if(void 0!==
v||Y){var ca=ca||{};ca.userId=v;Y&&(v=l.format,O=new Date(I),ca.minutes=Math.floor(U/6E4),ca.hours=Math.floor(U/36E5),ca.weekDay=v(O,{datePattern:"EEEE",selector:"date"}),ca.formattedDate=v(O,{selector:"date"}),ca.formattedTime=v(O,{selector:"time"}),ca.displayPattern=Y,ca.timeValue=I)}return ca},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},isQueryable:function(){var v=h.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],q.trim);return this._isStream||this.userIsAdmin||
this._collection||-1!==h.indexOf(v,"query")||-1!==h.indexOf(v,"catalog")},setResolution:function(v){return this.setMaxAllowableOffset(v)},setMaxAllowableOffset:function(v){this.isEditable()||(this._optMaxOffset=v,this._setMaxOffset(v,!0));return this},_resetMaxAllowableOffset:function(){this.setMaxAllowableOffset(this._optMaxOffset);this._prevScale=null;this._refreshMaxAllowableOffset()},_refreshMaxAllowableOffset:function(){this._calcMaxOffsetForAutoSnapshot();this._updateMaxOffset();this._needsRefresh=
!1},getResolution:function(){return this.getMaxAllowableOffset()},getMaxAllowableOffset:function(){var v=this._quantizationParameters?this._quantizationParameters.tolerance:void 0;return null!=this._maxOffset?this._maxOffset:v},_setMaxOffset:function(v,I){if(null==v)return delete this._maxOffset,delete this._quantizationParameters,this;this.quantize&&this.supportsCoordinatesQuantization?("esriGeometryPolyline"===this.geometryType?this._maxOffset=v:delete this._maxOffset,this._quantizationParameters=
v?{mode:"view",originPosition:"upperLeft",tolerance:v,extent:this.fullExtent}:null):(this._isFractionalOffsetAllowed()&&I||(v=Math.floor(v)),isNaN(v)||0===v?delete this._maxOffset:this._maxOffset=v,delete this._quantizationParameters);return this},_isFractionalOffsetAllowed:function(){return null==this.version||10.1<=this.version||navigator.languages&&this._isLangWithDot(navigator.languages[0])},_isLangWithDot:function(v){v=(v=v&&v.split("-"))&&v[0]&&v[0].toLowerCase();return-1!==h.indexOf(this._langsWithDot,
v)},_langsWithDot:"ar en et fr he ja ko th vi zh".split(" "),setAutoGeneralize:function(v){this.loaded?this._canAutoGeneralize()&&((this._autoGeneralize=v)?(this._isAutoSnapshotMode()&&(this._prevScale=null),this._updateMaxOffset()):this._setMaxOffset(null)):this._optAutoGen=v;return this},_canAutoGeneralize:function(){return!this.isEditable()&&this.mode!==na.MODE_SNAPSHOT},setGDBVersion:function(v){this._collection||v===this.gdbVersion||!v&&!this.gdbVersion||(this.gdbVersion=v,this._task.gdbVersion=
v,this._url.query=q.mixin(this._url.query,{gdbVersion:v}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange());return this},hasAllFeatures:function(){return this._mode?this._mode.hasAllFeatures():!0},hasUpdateError:function(){return this._mode?this._mode.hasUpdateError():!1},setDefinitionExpression:function(v){this._defnExpr=v;this._hasPendingLimitQuery()||((v=this._checkFeatureLimit())?this._evalModeAndApplyDefnExpr(v):this._applyDefnExpr());return this},_applyDefnExpr:function(){var v=
this._mode;v&&v.propertyChangeHandler(1)},_evalModeAndApplyDefnExpr:function(v){v.then(q.hitch(this,function(I){I&&(I instanceof Error||!I.modeChanged)&&this._applyDefnExpr()}))},getDefinitionExpression:function(){return this._defnExpr},hasDefinitionExpressionWithCurrentTimestamp:function(){return this.reSQLCurrentTimestamp.test(this.getDefinitionExpression())},setTimeDefinition:function(v){this._isSnapshotMode()?(this._timeDefn=v,(v=this._mode)&&v.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+
this.id+", Layer URL \x3d "+this.url);return this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(v,I){this._timeOffset=v;this._timeOffsetUnits=I;(v=this._mode)&&v.propertyChangeHandler(0);return this},setUseMapTime:function(v){this.useMapTime=v;this._toggleTime(!this.suspended);(v=this._mode)&&v.propertyChangeHandler(0)},selectFeatures:function(v,I,O,U){I=I||na.SELECTION_NEW;this._hasSelectionError=this._hasPartialSelectedFeatures=!1;v=this._getShallowClone(v);var Y=this._map,
ca=this,fa=K._fixDfd(new e(K._dfdCanceller));v.outFields=this.getOutFields();v.returnGeometry=!0;v.multipatchOption=this.multipatchOption;Y&&(v.outSpatialReference=new r(Y.spatialReference.toJson()));if(!this._applyQueryFilters(v,!0)){var ja={features:[]};this._selectHandler(ja,I,O,U,fa);return fa}if(Y=this._canDoClientSideQuery(v))fa._pendingDfd=n(this._doQuery(v,Y)),fa._pendingDfd.then(function(ka){ja={features:ka};ca._selectHandler(ja,I,O,U,fa)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+
this.invalidParams)],null,U,fa,!0),fa;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,U,fa,!0),fa;var pa=this;this._ts&&(v._ts=(new Date).getTime());Y=this._canFetchPBFForQuery(v);this._enableEditModeQuantization(v,Y);(fa._pendingDfd=this._task.execute(v,null,null,Y?{format:"pbf"}:null)).addCallbacks(function(ka){pa._selectHandler(ka,I,O,U,fa)},function(ka){pa._hasPartialSelectedFeatures=!0;pa._hasSelectionError=!0;pa._resolve([ka],
null,U,fa,!0)})}return fa},getSelectedFeatures:function(){var v=this._selectedFeatures,I=[],O;for(O in v)v.hasOwnProperty(O)&&I.push(v[O]);return I},clearSelection:function(v){var I=this._selectedFeatures,O=this._mode,U;for(U in I)I.hasOwnProperty(U)&&(this._unSelectFeatureIIf(U,O),O._removeFeatureIIf(U));this._selectedFeatures={};this._isSelOnly&&O._applyTimeFilter(!0);if(!v)this.onSelectionClear();return this},setSelectionSymbol:function(v){if(this._selectionSymbol=v){var I=this._selectedFeatures,
O;for(O in I)I.hasOwnProperty(O)&&I[O].setSymbol(v)}return this},getSelectionSymbol:function(){return this._selectionSymbol},setLabelingInfo:function(v){v?(this.labelingInfo=v,this._fixLabelExpr()):delete this.labelingInfo;this._collection&&(this._typesDirty=!0);this._evalSurfaceType();this.onLabelingInfoChange()},_fixLabelExpr:function(){var v=/\[([^\[\]]+)\]/ig,I,O=this,U=function(Y,ca){Y=O._getField(ca,!0);return"["+(Y&&Y.name||ca)+"]"};h.forEach(this.labelingInfo,function(Y){if(I=Y.labelExpression)Y.labelExpression=
I.replace(v,U)})},_updateRequiredFieldsFromLabelingInfo:function(){var v=[];h.forEach(this.labelingInfo,function(I){var O=I.labelExpressionInfo;if(I.labelExpression){var U=/[\[\]]/ig;I=I.labelExpression.match(/\[[^\[\]]+\]/ig);(I=h.map(I,function(ca){return ca.replace(U,"")}))&&(v=v.concat(I))}if(O){if(O.value){var Y=/[\{\}]/ig;I=O.value.match(/\{[^\{\}]+\}/ig);(I=h.map(I,function(ca){return ca.replace(Y,"")}))&&(v=v.concat(I))}O.expression&&(I=h.map(this.fields,function(ca){return ca.name},this),
v=v.concat(J.extractFieldNames(O.expression,I)))}},this);v=h.map(v,function(I){var O=this.getField(I);return O?O.name:I},this);this._requiredFields&&(this._requiredFields=this._requiredFields.concat(v))},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(v,I,O,U,Y,ca){var fa=ca.assembly,ja=ca.dfd;this._applyNormalized(v,fa&&fa[0]);this._applyNormalized(I,fa&&fa[1]);this.onBeforeApplyEdits(v,I,O);var pa={},ka=this.objectIdField;fa={f:"json"};var wa=!1;if(this._collection)ca=
{},ca.addResults=v?h.map(v,function(){wa=!0;return{objectId:this._nextId++,success:!0}},this):null,ca.updateResults=I?h.map(I,function(za){wa=!0;var Da=za.attributes[ka];pa[Da]=za;return{objectId:Da,success:!0}},this):null,ca.deleteResults=O?h.map(O,function(za){wa=!0;return{objectId:za.attributes[ka],success:!0}},this):null,wa?this._editHandler(ca,v,pa,U,Y,ja):this._resolve([ca.addResults,ca.updateResults,ca.deleteResults],null,U,ja);else{v&&0<v.length&&(fa.adds=this._convertFeaturesToJson(v,0,1),
wa=!0);if(I&&0<I.length){for(ca=0;ca<I.length;ca++){var ra=I[ca];pa[ra.attributes[ka]]=ra}fa.updates=this._convertFeaturesToJson(I,0,0,1);wa=!0}if(O&&0<O.length){I=[];for(ca=0;ca<O.length;ca++)I.push(O[ca].attributes[ka]);fa.deletes=I.join(",");wa=!0}if(wa){var oa=this;return t({url:this._url.path+"/applyEdits",content:q.mixin(fa,this._url.query),callbackParamName:"callback",load:function(za){oa._editHandler(za,v,pa,U,Y,ja)},error:function(za){oa._resolve([za],null,Y,ja,!0)}},{usePost:!0})}this._resolve([],
null,U,ja)}},queryFeatures:function(v,I,O,U){return this._query("execute","onQueryFeaturesComplete",v,I,O,U)},queryRelatedFeatures:function(v,I,O){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",v,I,O)},queryIds:function(v,I,O,U){return this._query("executeForIds","onQueryIdsComplete",v,I,O,U)},queryCount:function(v,I,O,U){return this._query("executeForCount","onQueryCountComplete",v,I,O,U)},queryExtent:function(v,I,O,U){return this._query("executeForExtent","onQueryExtentComplete",
v,I,O,U)},queryAttachmentInfos:function(v,I,O){var U=this._url.path+"/"+v+"/attachments",Y=new e(K._dfdCanceller),ca=this;U=E.normalize(U);Y._pendingDfd=t({url:U,content:q.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(fa){fa=fa.attachmentInfos;var ja;h.forEach(fa,function(pa){ja=b.objectToQuery({gdbVersion:ca._url.query&&ca._url.query.gdbVersion,layer:ca._url.query&&ca._url.query.layer,token:ca._getToken()});pa.url=U+"/"+pa.id+(ja?"?"+ja:"");pa.objectId=v});ca._resolve([fa],
"onQueryAttachmentInfosComplete",I,Y)},error:function(fa){ca._resolve([fa],null,O,Y,!0)}});return Y},addAttachment:function(v,I,O,U){return this._sendAttachment("add",v,I,O,U)},updateAttachment:function(v,I,O,U,Y){O.appendChild(a.create("input",{type:"hidden",name:"attachmentId",value:I}));return this._sendAttachment("update",v,O,U,Y)},deleteAttachments:function(v,I,O,U){var Y=this._url.path+"/"+v+"/deleteAttachments",ca=new e(K._dfdCanceller),fa=this;I={f:"json",attachmentIds:I.join(",")};ca._pendingDfd=
t({url:Y,content:q.mixin(I,this._url.query),callbackParamName:"callback",load:q.hitch(this,function(ja){ja=ja.deleteAttachmentResults;ja=h.map(ja,function(pa){pa=new sa(pa);pa.attachmentId=pa.objectId;pa.objectId=v;return pa});fa._resolve([ja],"onDeleteAttachmentsComplete",O,ca)}),error:function(ja){fa._resolve([ja],null,U,ca,!0)}},{usePost:!0});return ca},addType:function(v){var I=this.types;if(I){if(h.some(I,function(O){return O.id==v.id?!0:!1}))return!1;I.push(v)}else this.types=[v];return this._typesDirty=
!0},deleteType:function(v){if(this._collection){var I=this.types;if(I){var O=-1;h.some(I,function(U,Y){return U.id==v?(O=Y,!0):!1});if(-1<O)return this._typesDirty=!0,I.splice(O,1)[0]}}},toJson:function(){var v=this._cloneJson();if(v){v=v.layerDefinition?v:{layerDefinition:v};var I=v.layerDefinition,O=this._collection;this._updateLayerDefinition(I);var U=null;if(!O||this._fcAdded)U={geometryType:I.geometryType,features:this._convertFeaturesToJson(this.graphics,!0)};v.featureSet=q.mixin({},v.featureSet||
{},U);if(v.featureSet.transform){var Y=v.featureSet.transform;delete v.featureSet.transform;U=new T(v.featureSet);U.quantize(Y);v.featureSet=U.toJson()}O&&(v.nextObjectId=this._nextId,I.capabilities=this.capabilities);return v}},getLayerDefinition:function(){var v=this._cloneJson();(v=v?v.layerDefinition||v:null)&&this._updateLayerDefinition(v);return v},getFeatureCollectionLayer:function(v){var I=new e,O=this.getLayerDefinition();if(!O)return I.reject(Error("layerDefinition not available")),I.promise;
v=v||[];var U=new na({layerDefinition:O,featureSet:{geometryType:O.geometryType,features:h.map(v,function(fa){return fa.toJson()})}}),Y=U.on("load",function(){Y.remove();ca.remove();I.resolve(U)}),ca=U.on("error",function(){U.loaded||(Y.remove(),ca.remove(),I.reject(U.loadError))});return I.promise},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},
onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},onLabelingInfoChange:function(){},onFeatureReductionRendererChange:function(){},onFeatureReductionChange:function(){},onFeatureUpdatesResult:function(){},
_cloneJson:function(){var v=this._json;return q.isString(v)?p.fromJson(v):q.clone(v)},_updateLayerDefinition:function(v){if(this._collection&&this._typesDirty){v.types=h.map(this.types||[],function(Y){return Y.toJson()});var I=this.renderer,O=this.labelingInfo,U=v.drawingInfo;!I&&!O||U||(U=v.drawingInfo={});U&&I&&-1===I.declaredClass.indexOf("TemporalRenderer")&&(U.renderer=I.toJson());O&&(U.labelingInfo=h.map(O,function(Y){return Y.toJson()}))}},_evalFeatureUpdates:function(){if(!this._featureUpdatesPromise||
this._featureUpdatesPromise.isFulfilled())this._featureUpdatesPromise=this.hasFeatureUpdates().otherwise(function(v){return!(v&&"cancel"===v.dojoType)}).always(q.hitch(this,function(v){this._featureUpdatesPromise=null;this.onFeatureUpdatesResult({hasUpdates:v})}))},_evalRefresh:function(v){(v.hasUpdates||this.hasDefinitionExpressionWithCurrentTimestamp())&&this.refresh()},_evalArcadeSupport:function(){var v=new e;setTimeout(q.hitch(this,function(){this._initializeArcadeEngine().always(function(){v.resolve()})}),
0);return v.promise},_initializeArcadeEngine:function(){var v=[],I=this.infoTemplate;I&&I.initializeArcadeEngine&&v.push(I.initializeArcadeEngine());(I=this.renderer)&&I.initializeArcadeEngine&&v.push(I.initializeArcadeEngine());var O=[];h.forEach(this.labelingInfo,function(U){(U=U.labelExpressionInfo)&&U.expression&&O.push(U.expression)});v.push(L.initialize(O));return C(v)},_isGeometryOperationsUsed:function(){var v=this.infoTemplate,I=this.renderer,O=this.labelingInfo;return v&&v.hasGeometryOperations&&
v.hasGeometryOperations()||I&&I.hasGeometryOperations&&I.hasGeometryOperations()||h.some(O,function(U){return J.hasGeometryOperations(U.labelExpressionInfo&&U.labelExpressionInfo.expression)})?!0:!1},_forceIdentity:function(){var v=new e,I=this,O=this._url&&this._url.path;var U=O&&O.toLowerCase().indexOf("/rest/services");var Y=this.editFieldsInfo;Y=Y&&(Y.creatorField||Y.editorField);(this.userIsAdmin||Y)&&!this._getToken()&&-1<U&&g.id?(U=O.substring(0,U)+"/rest/info",t({url:U,content:{f:"json"},
handleAs:"json",callbackParamName:"callback"}).then(function(ca){if(ca.owningSystemUrl)return g.id.checkSignInStatus(ca.owningSystemUrl+"/sharing")}).then(function(ca){if(ca)return g.id.getCredential(O)}).then(function(ca){ca&&I._findCredential()}).always(function(){v.resolve()})):v.resolve();return v.promise},_isSnapshotMode:function(){return this._mode?this._mode.isInstanceOf(X):!1},_isOnDemandMode:function(){return this._mode?this._mode.isInstanceOf(ea):!1},_isAutoSnapshotMode:function(){return this._isAutoModeEnabled()&&
this.currentMode===na.MODE_SNAPSHOT},_getMaxFeaturesForAutoSnapshotMode:function(){var v=this.geometryType;if("esriGeometryPolyline"===v||"esriGeometryPolygon"===v||"esriGeometryMultipoint"===v||this.hasXYFootprint())var I=this.maxRecordCountForAuto;else"esriGeometryPoint"===v&&(I=this.maxPointCountForAuto);return I},getLastExceedsLimitResult:function(){return this._lastExceedsLimitResult},_canUseSnapshotMode:function(v){this._lastExceedsLimitResult=v=(v=v&&v.features&&v.features[0])&&v.attributes&&
v.attributes.exceedslimit;return!(this.mode!==na.MODE_AUTO||this.isEditable()||0!==v||!(this._isPaginationAllowed()||this.maxRecordCount>=this._getMaxFeaturesForAutoSnapshotMode()))},_evalModeFromFLimit:function(v){this._canUseSnapshotMode(v)?this._enableAutoSnapshotMode():this._enableAutoOnDemandMode()},_enableAutoSnapshotMode:function(){var v=na.MODE_SNAPSHOT;this.isFeatureReductionApplied()?this._updatePreFReductionState(v):this._preSurfaceChangeState?(this._updatePreSurfaceChangeState(v),this._evalSurfaceType(!0)):
this.currentMode!==v&&this._setFetchMode(na.MODE_AUTO,v)},_enableAutoOnDemandMode:function(){var v=na.MODE_ONDEMAND;this.isFeatureReductionApplied()?this._updatePreFReductionState(v):this._preSurfaceChangeState?this._updatePreSurfaceChangeState(v):this.currentMode!==v&&(this._setFetchMode(na.MODE_AUTO,v),this._evalSurfaceType())},_evalModeFromFReduction:function(v){this.loaded&&(v&&this.isFeatureReductionEnabled()&&this._canCluster(v)?this._enableFReductionMode():this._disableFReductionMode())},_enableFReductionMode:function(){this._evalSurfaceType(!0);
if(!this._preFReductionState){var v=this.currentMode;v!==na.MODE_SNAPSHOT&&v!==na.MODE_STREAM&&v!==na.MODE_SELECTION&&(this._preFReductionState={mode:this.mode,currentMode:this.currentMode},this._setFetchMode(this.mode===na.MODE_AUTO?na.MODE_AUTO:na.MODE_SNAPSHOT,na.MODE_SNAPSHOT))}},_disableFReductionMode:function(){var v=this._preFReductionState;this._preFReductionState=null;!v||v.mode===this.mode&&v.currentMode===this.currentMode||(this._setFetchMode(v.mode,v.currentMode),this._evalSurfaceType())},
_updatePreFReductionState:function(v){this._preFReductionState=this._preFReductionState||{};this._preFReductionState.mode=na.MODE_AUTO;this._preFReductionState.currentMode=v},_evalModeFromSurface:function(){this.hasWebGLSurface()?this._enableWebGLSurfaceMode():this._disableWebGLSurfaceMode()},_enableWebGLSurfaceMode:function(){this._preSurfaceChangeState||(this._preSurfaceChangeState={mode:this.mode,currentMode:this.currentMode},this._setFetchMode(this.mode===na.MODE_AUTO?na.MODE_AUTO:na.MODE_ONDEMAND,
na.MODE_ONDEMAND,this.webglDeps.OnDemandDrillMode))},_disableWebGLSurfaceMode:function(){var v=this._preSurfaceChangeState;v&&(this._preSurfaceChangeState=null,this._setFetchMode(v.mode,v.currentMode))},_updatePreSurfaceChangeState:function(v){this._preSurfaceChangeState=this._preSurfaceChangeState||{};this._preSurfaceChangeState.mode=na.MODE_AUTO;this._preSurfaceChangeState.currentMode=v},_setFetchMode:function(v,I,O){this.clearSelection();this._mode.suspend();this._mode.destroy();this.mode=v;this.currentMode=
I;O=O||this._getModeConstructor(I);this._mode=new O(this);this.queryPagination=I===na.MODE_ONDEMAND&&-1===O.prototype.declaredClass.toLowerCase().indexOf("ondemanddrillmode")?!1:this._isPaginationAllowed();(v=this.getMap())&&v.loaded&&(this._resetMaxAllowableOffset(),this._mode.initialize(v),this._mode.startup())},_isPaginationAllowed:function(){return!(!this._optQueryPagination||this.loaded&&!this.advancedQueryCapabilities.supportsPagination)},_getModeConstructor:function(v){var I;v===na.MODE_SNAPSHOT?
I=X:v===na.MODE_ONDEMAND&&(I=ea);return I},_hasOnDemandDrillMode:function(){var v=this._mode;v=v&&v.declaredClass;return!!(v&&-1<v.toLowerCase().indexOf("ondemanddrillmode"))},_checkFeatureLimit:function(){this._limitPromise&&(this._limitPromise.cancel(),this._limitPromise=null);var v=this._queryLimit();v&&(this._lastExceedsLimitResult=null,this._limitPromise=v.then(q.hitch(this,function(I){var O=this.currentMode;this._evalModeFromFLimit(I);return{modeChanged:this.currentMode!==O}})).always(q.hitch(this,
function(I){this._limitPromise=null;return I})));return this._limitPromise},_hasPendingLimitQuery:function(){return!!this._exceedsLimitTimer},_queryLimit:function(){if(this._isAutoModeEnabled()){var v,I,O=new e(function(){clearTimeout(v);v=null;I&&!I.isFulfilled()&&I.cancel();I=null});this._exceedsLimitTimer=v=setTimeout(q.hitch(this,function(){this._exceedsLimitTimer=null;var U=new P,Y=new S;Y.statisticType="exceedslimit";Y.maxPointCount=this.maxPointCountForAuto;Y.maxRecordCount=this.maxRecordCountForAuto;
Y.maxVertexCount=this.maxVertexCountForAuto;Y.outStatisticFieldName="exceedslimit";U.outStatistics=[Y];I=this.queryFeatures(U).promise.then(function(ca){O.resolve(ca)}).otherwise(function(ca){O.reject(ca)})}),0);return O.promise}},_isAutoModeEnabled:function(){return this.mode===na.MODE_AUTO&&this.reHostedFS.test(this.url)},_updateCaps:function(){var v=this._editable,I=q.trim(this.capabilities||""),O=h.map(I?I.split(","):[],q.trim),U=h.map(I?I.toLowerCase().split(","):[],q.trim);I=h.indexOf(U,"editing");
var Y;U={Create:h.indexOf(U,"create"),Update:h.indexOf(U,"update"),Delete:h.indexOf(U,"delete")};if(v&&-1===I)O.push("Editing");else if(!v&&-1<I){v=[I];for(Y in U)-1<U[Y]&&v.push(U[Y]);v.sort();for(Y=v.length-1;0<=Y;Y--)O.splice(v[Y],1)}this.capabilities=O.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._suspendImpl()},_suspendImpl:function(v){this._toggleTime(!1);this._refreshHandle&&(this._refreshHandle.remove(),
this._refreshHandle=null);var I=this._mode;I&&(I.suspend(),v&&I.destroy())},onResume:function(v){this.inherited(arguments);this._toggleTime(!0);this._refreshHandle=this.on("feature-updates-result",q.hitch(this,this._evalRefresh));var I=this._map,O=this._getRenderer();if(v.firstOccurrence){if(this._fixRendererFields(),this._updateRequiredFieldsFromLabelingInfo(),this._checkFields(),this.clearSelection(),this._evalFeatureReduction(),this.timeInfo&&!this._trackManager&&(this._trackIdField||O&&(O.latestObservationRenderer||
O.trackRenderer))&&(this._trackManager=new ua(this),this._trackManager.initialize(I),this._childLayer=this._trackManager.container),O&&"colors"in O&&"blurRadius"in O&&"maxPixelIntensity"in O&&"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&(this._heatmapManager=new xa(this),this._heatmapManager.initialize(I)),this._zoomConnect=w.connect(I,"onZoomEnd",this,this._zoomEndHandler),this._refreshMaxAllowableOffset(),O=this._mode)O._init||O.initialize(I),O.startup()}else this._zoomEndHandler(),
this._mode&&this._mode.resume()},_zoomEndHandler:function(){var v=this._map;this._updateMaxOffset();this._prevScale=v.getScale();!this.suspended&&this._needsRefresh&&this.refresh()},_updateMaxOffset:function(){var v=this._map;v&&v.loaded&&this._autoGeneralize&&(this._isAutoSnapshotMode()?(v=this.getMaxAllowableOffset(),this._setMaxOffset(this._getMaxOffsetForScale(),!0),this._needsRefresh||(this._needsRefresh=v!=this.getMaxAllowableOffset())):this._setMaxOffset(v.extent.getWidth()/v.width,!v.extent.spatialReference.isWebMercator()))},
_getMaxOffsetForScale:function(){if(this._map){var v=this._map.getScale(),I=this._calculatedScale,O=this._calcMaxOffset,U=this._prevScale;return v>=I&&(null==U||U<I)?O:v<I&&(null==U||U>=I)?null:this.getMaxAllowableOffset()}},_calcMaxOffsetForAutoSnapshot:function(){var v=this._map;if(v&&this._canAutoGeneralize()&&this._isAutoSnapshotMode()&&this._autoGeneralize&&null==this.getMaxAllowableOffset()){var I=this.generalizeForScale;this._calculatedScale=I=this.maxScale?this.maxScale:this.minScale?Math.min(I,
this.minScale):Math.min(I,W.getScale(v,this.initialExtent));this._calcMaxOffset=v.extent.getWidth()/v.width/v.getScale()*I}else this._calculatedScale=this._calcMaxOffset=void 0},_toggleTime:function(v){var I=this._map;v&&this.timeInfo&&this.useMapTime&&I?(this._mapTimeExtent=I.timeExtent,this._timeConnect||(this._timeConnect=w.connect(I,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,w.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(v){this._mapTimeExtent=
v;(v=this._mode)&&v.propertyChangeHandler(0)},_getOffsettedTE:function(v){var I=this._timeOffset,O=this._timeOffsetUnits;return v&&I&&O?v.offset(-1*I,O):v},_getTimeOverlap:function(v,I){return v&&I?v.intersection(I):v||I},_getTimeFilter:function(v){var I=this.getTimeDefinition();if(I){var O=this._getTimeOverlap(I,null);if(!O)return[!1]}if(v){if(v=O?this._getTimeOverlap(v,O):v,!v)return[!1]}else v=O;return[!0,v]},_getAttributeFilter:function(v){var I=[],O=this.getDefinitionExpression();O&&I.push(O);
v&&I.push(v);this.subtypeField&&this.subtypeCode&&I.push(this.subtypeField+" \x3d "+this.subtypeCode);1<I.length&&(I=h.map(I,function(U){return"("+U+")"}));return I.length?I.join(" AND "):null},_applyQueryFilters:function(v,I){v.where=this._getAttributeFilter(v.where);v.returnGeometry&&null==v.maxAllowableOffset&&!v.quantizationParameters&&(v.maxAllowableOffset=this._maxOffset,v.quantizationParameters=this._quantizationParameters);I&&this.supportsAdvancedQueries&&(v.orderByFields=v.orderByFields||
this.getOrderByFields());if(this.timeInfo)if(I=this._getTimeFilter(v.timeExtent),I[0])v.timeExtent=I[1];else return!1;return!0},_add:function(v){var I=this._selectionSymbol,O=v.attributes,U=this.visibilityField;I&&this._isSelOnly&&v.setSymbol(I);if(U&&O&&O.hasOwnProperty(U))v[O[U]?"show":"hide"]();return this.add.apply(this,arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(v,I){var O=[],U=this._map,Y;if((this._collection||!this._isTable&&U)&&!(v.text||
v.where&&v.where!==this.getDefinitionExpression()||v.orderByFields&&v.orderByFields.length&&(Y=this.getOrderByFields()||[])&&v.orderByFields.join()!==Y.join()||v.outStatistics||v.returnDistinctValues)){Y=this._isSnapshotMode();var ca=this._isSelOnly;I=Y?null:I?this._getExtentOfTiles(U.extent):U.extent;if(U=v.geometry){if(ca||v.spatialRelationship!==P.SPATIAL_REL_INTERSECTS||"extent"!==U.type||!Y&&!I.contains(U))return;O.push(1)}if(I=v.objectIds)if(Y)O.push(2);else{U=I.length;var fa=this._mode,ja=
0,pa;for(pa=0;pa<U;pa++)fa._getFeature(I[pa])&&ja++;if(ja===U)O.push(2);else return}if(this.timeInfo)if(v=v.timeExtent,I=this._mapTimeExtent,Y)v&&O.push(3);else if(ca){if(v)return}else if(I)if(-1!==h.indexOf(O,2))v&&O.push(3);else if(-1!==h.indexOf(O,1))v==I&&O.push(3);else return;else if(0<O.length)v&&O.push(3);else if(v)return;return 0<O.length?O:null}},_getAbsMid:function(v){return G.toAbsMid?G.toAbsMid(v):B.id.replace(/\/[^\/]*$/ig,"/")+v},_doQuery:function(v,I,O){var U=[],Y=this.objectIdField,
ca=this,fa=new e,ja=new e,pa=this.graphics;if(-1!==h.indexOf(I,1)){var ka=this.spatialIndex||this._map&&this._map.spatialIndex,wa,ra=v.geometry._normalize(null,!0);null==ka&&Ca.autoSpatialIndexing?wa=(this._map||this).addPlugin(this._getAbsMid("../plugins/spatialIndex")).then(q.hitch(this,q.partial(this._getFromIndex,ra,ka)),function(oa){ja.resolve(q.hitch(this,q.partial(this._filterByExtent,pa,ra)))}):ka&&(wa=this._getFromIndex(ra,ka));wa?wa.then(function(oa){for(var za=0;za<oa.length;za++)oa[za].results&&
(U=U.concat(oa[za].results));ja.resolve(U)}).otherwise(function(oa){ja.reject(oa)}):ja.resolve(this._filterByExtent(pa,ra))}else ja.resolve(pa);ja.then(function(oa){U=oa;if(-1!==h.indexOf(I,2)){var za=v.objectIds;U=h.filter(U,function(Da){return-1<h.indexOf(za,Da.attributes[Y])})}-1!==h.indexOf(I,3)&&ca.timeInfo&&(oa=v.timeExtent,U=ca._filterByTime(U,oa.startTime,oa.endTime).match);O&&(U=h.map(U,function(Da){return Da.attributes[Y]},this));fa.resolve(U)});return fa},_getFromIndex:function(v,I){I=
I||this.spatialIndex||this._map.spatialIndex;v instanceof Array||(v=[v]);var O=this.id;return d(h.map(v,function(U){return I.intersects(U,O)}))},_filterByExtent:function(v,I){for(var O=[],U=0,Y=v.length;U<Y;U++){var ca=v[U],fa=ca.geometry;fa&&(this.normalization&&I.length?(I[0].intersects(fa)||I[1].intersects(fa))&&O.push(ca):I.intersects(fa)&&O.push(ca))}return O},_filterByTime:function(v,I,O){var U=this._startTimeField,Y=this._endTimeField,ca;this._twoTimeFields||(ca=U||Y);var fa=k.isDefined,ja=
[],pa=[],ka,wa=v.length;I=I?I.getTime():-Infinity;O=O?O.getTime():Infinity;if(ca)for(ka=0;ka<wa;ka++){var ra=v[ka];var oa=ra.attributes;U=oa[ca];U>=I&&U<=O?ja.push(ra):pa.push(ra)}else for(ka=0;ka<wa;ka++)ra=v[ka],oa=ra.attributes,ca=oa[U],oa=oa[Y],ca=fa(ca)?ca:-Infinity,oa=fa(oa)?oa:Infinity,ca>=I&&ca<=O||oa>=I&&oa<=O||I>=ca&&O<=oa?ja.push(ra):pa.push(ra);return{match:ja,noMatch:pa}},_getSizeVariables:function(v){return v&&h.filter(v.getVisualVariablesForType("sizeInfo",!1),function(I){return!(!I.field&&
!I.valueExpression)})},_needClientSideSorting:function(v){return this._collection?!(!v||!v.length):h.some(v,function(I){return!!I.valueExpression})},_sortFeatures:function(v){var I=this.renderer,O=this._getSizeVariables(I);if(v&&1<v.length&&this._needClientSideSorting(O)){var U=O[0],Y=this;v.sort(function(ca,fa){ca._layer||(ca._layer=Y);fa._layer||(fa._layer=Y);ca=I._getDataValue(ca,U,"sizeInfo");fa=I._getDataValue(fa,U,"sizeInfo");return null==ca?-1:null==fa?1:fa-ca})}return v},_resolve:function(v,
I,O,U,Y){I&&this[I].apply(this,v);O&&O.apply(null,v);U&&K._resDfd(U,v,Y)},_getShallowClone:function(v){var I=new P,O;for(O in v)v.hasOwnProperty(O)&&(I[O]=v[O]);return I},_canFetchPBF:function(){return!!(Fa&&Ga&&this.supportsFormatPBF)},_canFetchPBFForQuery:function(v){return!(!this._canFetchPBF()||!this._isCacheHintEnabled(v)&&this._isAutoSnapshotMode()||!(v.quantizationParameters||!this.isEditable()&&this.supportsQuantizationEditMode)||v.outStatistics)},_enableEditModeQuantization:function(v,I){v&&
I&&!v.quantizationParameters&&(v.quantizationParameters={mode:"edit"})},_enableCacheHint:function(v,I){var O=this.advancedQueryCapabilities;O&&O.supportsQueryWithCacheHint?null==v.cacheHint&&(v.cacheHint=!0):O&&O.supportsQueryWithResultType&&this.reHostedFS.test(this.url)&&!v.resultType&&(v.resultType=I||"coherent")},_isCacheHintSupported:function(){var v=this.advancedQueryCapabilities;return v?!!(v.supportsQueryWithCacheHint||v.supportsQueryWithResultType&&this.reHostedFS.test(this.url)):!1},_isCacheHintEnabled:function(v){var I=
this.advancedQueryCapabilities;return v&&I?!!(I.supportsQueryWithCacheHint&&v.cacheHint||I.supportsQueryWithResultType&&this.reHostedFS.test(this.url)&&("coherent"===v.resultType||"tile"===v.resultType)):!1},_query:function(v,I,O,U,Y,ca){var fa=this,ja=this._map;ca=ca&&ca.snapToTiles;var pa=new e(K._dfdCanceller),ka=O,wa,ra,oa;if("executeRelationshipQuery"!==v){ka=this._getShallowClone(O);var za=this.getOutFields();ka.outFields||(ka.outFields=za);ka.outFields&&ka.outFields.length&&(ra=-1<h.indexOf(za,
"*")?!1:!h.every(ka.outFields,function(Ha){return-1<h.indexOf(za,Ha)}));ka.returnGeometry=O.hasOwnProperty("returnGeometry")?O.returnGeometry:!O.outStatistics;ka.returnGeometry&&(ka.multipatchOption=this.multipatchOption,null!=ka.maxAllowableOffset||ka.quantizationParameters)&&(O=null!=ka.maxAllowableOffset?ka.maxAllowableOffset:ka.quantizationParameters.tolerance,null!=O&&O!==this.getMaxAllowableOffset()&&(oa=!0));ja&&(ja=ja&&ja.spatialReference,(O=ka.outSpatialReference)?wa=!O.equals(ja):ka.outSpatialReference=
new r(ja.toJson()));ca&&(ja=ka.geometry)&&"extent"===ja.type&&(ka.geometry=this._getExtentOfTiles(ja),ja!==ka.geometry&&this._enableCacheHint(ka));if(!this._applyQueryFilters(ka,"execute"===v&&!ka.outStatistics)){switch(v){case "execute":var Da=new T({features:[]});break;case "executeForIds":Da=[];break;case "executeForCount":Da=0;break;case "executeForExtent":Da={}}this._resolve([Da],I,U,pa);return pa}if(ca="executeForExtent"!==v&&!wa&&!ra&&!oa&&this._canDoClientSideQuery(ka,ca))return pa._pendingDfd=
n(this._doQuery(ka,ca,"executeForIds"===v||"executeForCount"===v)),pa._pendingDfd.then(function(Ha){switch(v){case "execute":Da=new T;Da.features=Ha;break;case "executeForIds":Da=Ha;break;case "executeForCount":Da=Ha.length}fa._resolve([Da],I,U,pa)}),pa}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,Y,pa,!0),pa;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,Y,pa,!0),pa;this._ts&&
(ka._ts=(new Date).getTime());ca="execute"===v&&this._canFetchPBFForQuery(ka);this._enableEditModeQuantization(ka,ca);(pa._pendingDfd=this._task[v](ka,null,null,ca?{format:"pbf"}:null)).addCallbacks(function(Ha){var Ja=!!ka.outStatistics||wa||ra||oa;if("execute"===v||"executeRelationshipQuery"===v)if("execute"===v){var Ea=Ha.features;var Ia=Ea.length;for(--Ia;0<=Ia;Ia--)if(Ea[Ia]._layer=fa,!Ja&&!fa._isTable){var Ma=fa._mode._getFeature(Ea[Ia].attributes[fa.objectIdField]);Ma&&Ea.splice(Ia,1,Ma)}}else for(Ma in Ha)if(Ha.hasOwnProperty(Ma))for(Ea=
Ha[Ma].features,Ia=Ea.length,--Ia;0<=Ia;Ia--)Ea[Ia]._layer=fa;fa._resolve([Ha],I,U,pa)},function(Ha){fa._resolve([Ha],null,Y,pa,!0)});return pa},_getExtentOfTiles:function(v){var I=this._isOnDemandMode()&&this._mode._gridLayer||ma.createFromFeatureLayer({layer:this}),O=this.getMap();O=O&&O.getTargetExtent(v);return I&&O&&I.getExtentOfIntersectingCells(O)||v},_convertFeaturesToJson:function(v,I,O,U){var Y=[],ca=this._selectionSymbol,fa=this.visibilityField,ja,pa=this.objectIdField;this.loaded&&(O||
U)&&(ja=h.filter(this.fields,function(Da){return!1===Da.editable&&(!U||Da.name!==pa)}));for(O=0;O<v.length;O++){var ka=v[O],wa={},ra=ka.geometry,oa=ka.attributes,za=ka.symbol;!ra||U&&this.loaded&&!this.allowGeometryUpdates||(wa.geometry=ra.toJson());fa?(wa.attributes=oa=q.mixin({},oa),oa[fa]=ka.visible?1:0):oa&&(wa.attributes=q.mixin({},oa));wa.attributes&&ja&&ja.length&&h.forEach(ja,function(Da){delete wa.attributes[Da.name]});za&&za!==ca&&(wa.symbol=za.toJson());Y.push(wa)}return I?Y:p.toJson(Y)},
_selectHandler:function(v,I,O,U,Y){switch(I){case na.SELECTION_NEW:this.clearSelection(!0);var ca=!0;break;case na.SELECTION_ADD:ca=!0;break;case na.SELECTION_SUBTRACT:ca=!1}U=v.features;var fa=this._mode,ja=[],pa=this.objectIdField;if(ca)for(ca=0;ca<U.length;ca++){var ka=U[ca];var wa=ka.attributes[pa];ka=fa._addFeatureIIf(wa,ka);ja.push(ka);this._selectFeatureIIf(wa,ka,fa)}else for(ca=0;ca<U.length;ca++)ka=U[ca],wa=ka.attributes[pa],this._unSelectFeatureIIf(wa,fa),wa=fa._removeFeatureIIf(wa),ja.push(wa||
ka);this._isSelOnly&&fa._applyTimeFilter(!0);this._isImageService&&10.7>this.version&&void 0===v.exceededTransferLimit&&(v.exceededTransferLimit=U.length===this.maxRecordCount);this._hasPartialSelectedFeatures=!!v.exceededTransferLimit;this._resolve([ja,I,v.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",O,Y);if(v.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(v,I,O){var U=this._selectedFeatures,Y=U[v];Y||(O._incRefCount(v),U[v]=I,this._isTable||
(this._setSelectSymbol(I),I.attr("data-selected","")));return Y||I},_unSelectFeatureIIf:function(v,I){var O=this._selectedFeatures[v];O&&(I._decRefCount(v),delete this._selectedFeatures[v],this._isTable||(this._setUnSelectSymbol(O),O.attr("data-selected")));return O},_setSelectSymbol:function(v){var I=this._selectionSymbol;I&&!this._isSelOnly&&v.setSymbol(I)},_setUnSelectSymbol:function(v){var I=this._selectionSymbol;I&&!this._isSelOnly&&I===v.symbol&&v.setSymbol(null,!0)},_getOutFields:function(){var v=
[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._requiredFields).concat(this.dataAttributes);v=h.filter(v,function(O,U,Y){return!!O&&h.indexOf(Y,O)===U});var I=q.clone(this._outFields);if(I){if(-1!==h.indexOf(I,"*"))return I;h.forEach(v,function(O){-1===h.indexOf(I,O)&&I.push(O)});return I}return v},_checkFields:function(v){var I=v||this._getOutFields();h.forEach(I,function(O){"*"!==O&&(this._getField(O)||console.debug("esri.layers.FeatureLayer: "+
k.substitute({url:this.url,field:O},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);v||this._isTable||this._fserver||this._collection||this._isStream||h.some(this.fields,function(O){return O&&"esriFieldTypeGeometry"===O.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+k.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]"))},
_fixFieldCase:function(v,I,O){var U=v&&v[I],Y;if(U&&!q.isFunction(U)){if(Y=!this._getField(U)&&this._getField(U,!0))U=v[I]=Y.name;O&&O.push(U)}return U},_fixRendererFields:function(){var v=this.renderer;this._orderBy=null;this._requiredFields=[];if(v&&0<this.fields.length){var I=[],O;v=h.filter([v,v.observationRenderer,v.latestObservationRenderer,v.trackRenderer],k.isDefined);var U=[].concat(v);h.forEach(v,function(Y){h.forEach(Y.rendererInfos,function(ca){ca.renderer&&U.push(ca.renderer)})});h.forEach(U,
function(Y){this._fixFieldCase(Y,"attributeField",I);this._fixFieldCase(Y,"attributeField2",I);this._fixFieldCase(Y,"attributeField3",I);this._fixFieldCase(Y.rotationInfo,"field",I);(O=this._fixFieldCase(Y.sizeInfo,"field",I))&&!this._orderBy&&(this._orderBy=[O+" DESC"]);this._fixFieldCase(Y.sizeInfo,"normalizationField",I);this._fixFieldCase(Y.colorInfo,"field",I);this._fixFieldCase(Y.colorInfo,"normalizationField",I);this._fixFieldCase(Y.field,"field",I);this._fixFieldCase(Y.opacityInfo,"field",
I);this._fixFieldCase(Y.opacityInfo,"normalizationField",I);h.forEach(Y.visualVariables,function(fa){O=this._fixFieldCase(fa,"field",I);"sizeInfo"===fa.type&&O&&!this._orderBy&&(this._orderBy=[O+" DESC"]);this._fixFieldCase(fa,"normalizationField",I)},this);var ca=h.map(this.fields,function(fa){return fa.name},this);ca=h.map(Y.getFieldsUsedInExpressions(ca),function(fa){var ja=this.getField(fa);return ja?ja.name:fa},this);I=I.concat(ca);this._orderBy||!Y.addBreak||q.isFunction(Y.attributeField)||
!Y.backgroundFillSymbol&&!this._hasSizeDiff(Y)||(this._orderBy=[Y.attributeField+" DESC"])},this);this._requiredFields=h.filter(I,k.isDefined)}},_hasSizeDiff:function(v){var I=Number.MAX_VALUE,O=-Number.MAX_VALUE,U,Y;h.forEach(v.infos,function(ca){if(Y=ca.symbol){U=0;switch(Y.type){case "simplemarkersymbol":U=Y.size;break;case "picturemarkersymbol":U=(Y.width+Y.height)/2;break;case "simplelinesymbol":case "cartographiclinesymbol":U=Y.width;break;case "simplefillsymbol":case "picturefillsymbol":U=
Y.outline&&Y.outline.width}U&&(I=Math.min(I,U),O=Math.max(O,U))}});return I!==Number.MAX_VALUE&&O!==-Number.MAX_VALUE&&1<Math.abs(O-I)},getOrderByFields:function(){var v=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&v?h.filter(v,function(I){I=I.split(" ")[0];return!!this._getField(I,!0)},this):null},_createFields:function(v){var I=v?v.length:0,O,U=[];for(O=0;O<I;O++)U.push(new R(v[O]));this.fields=U},_createFieldsIndex:function(){if(this._fieldsIndexDirty){var v=this.fields,
I=v?v.length:0;if(50<I&&this._canUseFieldsIndex()){var O=new Map;for(var U=new Map,Y=0;Y<I;Y++){var ca=v[Y];O.set(ca.name,ca);U.set(ca.name.toLowerCase(),ca)}O={caseSensitive:O,caseInsensitive:U}}this._fieldsIndex=O;this._fieldsIndexDirty=!1}},_canUseFieldsIndex:function(){var v=m.Map;return!("function"!==typeof m.Proxy||"function"!==typeof m.Proxy.revocable||"function"!==typeof v||!v.prototype||"function"!==typeof v.prototype.set)},_getField:function(v,I){var O=this.fields;if(!O||0===O.length)return null;
I&&(v=v.toLowerCase());this._createFieldsIndex();var U=this._fieldsIndex;if(U)return U=I?U.caseInsensitive:U.caseSensitive,U.get(v);var Y;h.some(O,function(ca){var fa=!1;(fa=I?ca&&ca.name.toLowerCase()===v?!0:!1:ca&&ca.name===v?!0:!1)&&(Y=ca);return fa});return Y},_getDateOpts:function(){this._dtOpts||(this._dtOpts={properties:h.map(h.filter(this.fields,function(v){return!(!v||"esriFieldTypeDate"!==v.type)}),function(v){return v.name})});return this._dtOpts},_applyNormalized:function(v,I){v&&I&&h.forEach(v,
function(O,U){O&&I[U]&&O.setGeometry(I[U])})},_editHandler:function(v,I,O,U,Y,ca){Y=v.addResults;var fa=v.updateResults;v=v.deleteResults;var ja,pa=this.objectIdField,ka=this._mode,wa=this._isTable;var ra=this.editFieldsInfo;var oa=this.getOutFields()||[];var za=ra&&ra.creatorField,Da=ra&&ra.creationDateField,Ha=ra&&ra.editorField,Ja=ra&&ra.editDateField;ra=ra&&ra.realm;-1===h.indexOf(oa,"*")&&(za&&-1===h.indexOf(oa,za)&&(za=null),Da&&-1===h.indexOf(oa,Da)&&(Da=null),Ha&&-1===h.indexOf(oa,Ha)&&(Ha=
null),Ja&&-1===h.indexOf(oa,Ja)&&(Ja=null));var Ea=Da||Ja?(new Date).getTime():null,Ia=za||Ha?this.getUserId():void 0;Ia&&ra&&(Ia=Ia+"@"+ra);if(Y){var Ma=this.globalIdField;for(ra=0;ra<Y.length;ra++)if(Y[ra]=new sa(Y[ra]),!wa){var La=Y[ra];if(La.success){var Ka=La.objectId;oa=I[ra];(ja=oa._graphicsLayer)&&ja!==this&&ja.remove(oa);ja=oa.attributes||{};ja[pa]=Ka;Ka=La.globalId;Ma&&Ka&&(ja[Ma]=Ka);za&&(ja[za]=Ia);Ha&&(ja[Ha]=Ia);Da&&(ja[Da]=Ea);Ja&&(ja[Ja]=Ea);oa.setAttributes(ja);ka._init&&ka.drawFeature(oa)}}}if(fa)for(ra=
0;ra<fa.length;ra++)if(fa[ra]=new sa(fa[ra]),!wa&&(La=fa[ra],La.success)){Ka=La.objectId;oa=O[Ka];if(I=ka._getFeature(Ka))I.geometry!==oa.geometry&&oa.geometry&&I.setGeometry(da.fromJson(oa.geometry.toJson())),I.attributes!==oa.attributes&&oa.attributes&&I.setAttributes(q.mixin(I.attributes,oa.attributes)),this._repaint(I,Ka);oa=I||oa;ja=oa.attributes||{};Ha&&(ja[Ha]=Ia);Ja&&(ja[Ja]=Ea);oa.setAttributes(ja)}if(v){O=[];for(ra=0;ra<v.length;ra++)if(v[ra]=new sa(v[ra]),!wa&&(La=v[ra],La.success&&(Ka=
La.objectId,oa=ka._getFeature(Ka))))this._unSelectFeatureIIf(Ka,ka)&&O.push(oa),oa._count=0,ka._removeFeatureIIf(Ka);if(0<O.length)this.onSelectionComplete(O,na.SELECTION_SUBTRACT)}this._resolve([Y,fa,v],"onEditsComplete",U,ca)},_sendAttachment:function(v,I,O,U,Y){var ca=this;return t({url:this._url.path+"/"+I+"/"+("add"===v?"addAttachment":"updateAttachment"),form:O,content:q.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(fa){var ja=
"add"===v?"onAddAttachmentComplete":"onUpdateAttachmentComplete";fa=new sa(fa["add"===v?"addAttachmentResult":"updateAttachmentResult"]);fa.attachmentId=fa.objectId;fa.objectId=I;ca._resolve([fa],ja,U);return fa}).addErrback(function(fa){ca._resolve([fa],null,Y,null,!0)})},_repaint:function(v,I,O){I=k.isDefined(I)?I:v.attributes[this.objectIdField];I in this._selectedFeatures&&this._selectionSymbol||v.setSymbol(v.symbol,O)},_getKind:function(v){var I=this._trackManager;return I?I.isLatestObservation(v)?
1:0:0}});q.mixin(na,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,MODE_AUTO:6,MODE_STREAM:7,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});Q._createWrappers(na);Object.defineProperty(na.prototype,"graphics",{get:function(){return this._hasOnDemandDrillMode()?this._mode.graphics:this._graphicsVal},set:function(v){this._graphicsVal=v}});Object.defineProperty(na.prototype,
"name",{get:function(){return this.arcgisProps&&this.arcgisProps.title?this.arcgisProps.title:this._name},set:function(v){this._name=v;this.loaded&&this.arcgisProps&&(this.arcgisProps.title=null)}});Object.defineProperty(na.prototype,"fields",{get:function(){return this._fields},set:function(v){v&&this._canUseFieldsIndex()&&(v=new Proxy(v,{set:q.hitch(this,function(I,O,U){if(O)if("length"===O)this._fieldsIndexDirty=!0;else{var Y=Number(O);"number"!==typeof Y||isNaN(Y)||(this._fieldsIndexDirty=!0)}I[O]=
U;return!0})}));this._fields=v;this._fieldsIndexDirty=!0}});c("extend-esri")&&q.setObject("layers.FeatureLayer",na,g);return na})},"esri/arcadeProfiles/labelingProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(G,B,A,w,q,h,p,e){G=new (G(null,{declaredClass:"esri.arcadeProfiles.LabelingProfile",defaults:{context:{vars:{$feature:"any"}}},initialize:function(l){var b=[];e.hasGeometryOperations(l)&&
b.push(p.enableGeometryOperations());return q(b)},isAsync:function(l){return!1},parse:function(l){return p.createSyntaxTree(l.expression)},compile:function(l){var b=B.clone(this.defaults.context);return l.syntaxTree?p.createFunction(l.syntaxTree,b):null},getEvalOptions:function(l){var b=l.feature;return{context:{vars:{$feature:b&&l.expression.hasVariable("$feature")?h.createFromGraphicLikeObject(b.geometry,b.attributes,l.layer):null},spatialReference:l.spatialReference}}}}));A("extend-esri")&&B.setObject("arcadeProfiles.labelingProfile",
G,w);return G})},"esri/tasks/QueryTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/DeferredList ../kernel ../sniff ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d){var c=l("esri-pbf"),g=B(null,{url:null,query:null,requestOptions:null,pagination:null,pageSize:null,_fetchDfd:null,_startPage:null,_result:null,constructor:function(t){this._handleSuccess=
A.hitch(this,this._handleSuccess);this._handleError=A.hitch(this,this._handleError);A.mixin(this,t);null==this.pagination&&(this.pagination=!1);null==this.pageSize&&(this.pageSize=1E3)},execute:function(){var t=new q(this._canceler);this._fetchDfd=t;this._result=null;this._sendRequest();return t.promise},_canceler:function(t){var y=t._pendingRequest;if(!t.isFulfilled()&&y&&!y.isFulfilled()){y.cancel();var K=y.results&&y.results[1]}t._pendingRequest=null;return K},_sendRequest:function(t){var y=this.query;
this.pagination&&(this._startPage=y.resultOffset=null==t?0:t,y.resultRecordCount=this.pageSize);t=this.requestOptions;this._fetchDfd._pendingRequest=b({url:this.url,content:y,handleAs:"pbf"===y.f?"arraybuffer":"json",callbackParamName:"callback",timeout:t&&t.timeout},t);this._fetchDfd._pendingRequest.then(this._handleSuccess).otherwise(this._handleError)},_handleSuccess:function(t){this.pagination?(t.exceededTransferLimit&&this._sendRequest(this._startPage+this.pageSize),this._result?this._result.features=
this._result.features.concat(t.features):this._result=t,this._fetchDfd.progress(t),t.exceededTransferLimit||this._fetchDfd.resolve(this._result)):(this._fetchDfd.progress(t),this._fetchDfd.resolve(t))},_handleError:function(t){this._fetchDfd.reject(t)}}),k=B(m,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(t,y){this._handler=
A.hitch(this,this._handler);this._relationshipQueryHandler=A.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=A.hitch(this,this._executeForIdsHandler);this._countHandler=A.hitch(this,this._countHandler);this._extentHandler=A.hitch(this,this._extentHandler);this.source=y&&y.source;this.gdbVersion=y&&y.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"rawExecute",c:2,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,
p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onRawExecuteComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(t,y,K,C,r){var E=r.assembly;t=this._encode(A.mixin({},this._url.query,{f:C&&C.format||"json"},t.toJson(E&&E[0])));var F=this._handler,
u=this._errorHandler;this.source&&(C={source:this.source.toJson()},t.layer=h.toJson(C));this.gdbVersion&&(t.gdbVersion=this.gdbVersion);var D="pbf"===t.f;if(D){var z;c||(z="QueryTask.execute: 'pbf' format is not supported in your browser.");if(z)return t=new q,t.addErrback(function(M){u(M,K,r.dfd)}),t.reject(Error(z)),t}z=this.requestOptions;z=b({url:this._url.path+"/query",content:t,callbackParamName:"callback",handleAs:D?"arraybuffer":"json",timeout:z&&z.timeout},z);t=[z];D&&t.push(k.loadPBFReader());
(new p(t)).then(function(M){r.dfd.isFulfilled()||(M=M[0],M[0]?F(M[1],D,y,K,r.dfd):u(M[1],K,r.dfd))});return z},rawExecute:function(t,y,K){y=y||{};t=this._encode(A.mixin({},this._url.query,{f:y.format||"json"},t.toJson(K.assembly&&K.assembly[0])));this.source&&(t.layer=h.toJson({source:this.source.toJson()}));this.gdbVersion&&(t.gdbVersion=this.gdbVersion);return(new g({url:this._url.path+"/query",query:t,requestOptions:this.requestOptions,pagination:y.pagination,pageSize:y.pageSize})).execute().then(null,
null,function(C){K.dfd.progress(C)}).then(A.hitch(this,function(C){this._successHandler([C],"onRawExecuteComplete",null,K.dfd)})).otherwise(A.hitch(this,function(C){this._errorHandler(C,null,K.dfd)}))},executeRelationshipQuery:function(t,y,K){t=this._encode(A.mixin({},this._url.query,{f:"json"},t.toJson()));var C=this._relationshipQueryHandler,r=this._errorHandler;this.gdbVersion&&(t.gdbVersion=this.gdbVersion);var E=new q(a._dfdCanceller),F=this.requestOptions,u=this._url.path;this.source&&void 0!==
this.source.mapLayerId&&null!==this.source.mapLayerId&&u.endsWith("/dynamicLayer")&&(u=u.slice(0,-13),u=u+"/"+this.source.mapLayerId);E._pendingDfd=b({url:u+"/queryRelatedRecords",content:t,callbackParamName:"callback",timeout:F&&F.timeout,load:function(D,z){C(D,z,y,K,E)},error:function(D){r(D,K,E)}},F);return E},executeForIds:function(t,y,K,C){var r=C.assembly;t=this._encode(A.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},t.toJson(r&&r[0])));var E=this._executeForIdsHandler,F=this._errorHandler;
this.source&&(r={source:this.source.toJson()},t.layer=h.toJson(r));this.gdbVersion&&(t.gdbVersion=this.gdbVersion);r=this.requestOptions;return b({url:this._url.path+"/query",content:t,callbackParamName:"callback",timeout:r&&r.timeout,load:function(u,D){E(u,D,y,K,C.dfd)},error:function(u){F(u,K,C.dfd)}},r)},executeForCount:function(t,y,K,C){var r=C.assembly;t=this._encode(A.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},t.toJson(r&&r[0])));var E=this._countHandler,F=this._errorHandler;
this.source&&(r={source:this.source.toJson()},t.layer=h.toJson(r));this.gdbVersion&&(t.gdbVersion=this.gdbVersion);r=this.requestOptions;return b({url:this._url.path+"/query",content:t,callbackParamName:"callback",timeout:r&&r.timeout,load:function(u,D){E(u,D,y,K,C.dfd)},error:function(u){F(u,K,C.dfd)}},r)},executeForExtent:function(t,y,K,C){var r=C.assembly;t=this._encode(A.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},t.toJson(r&&r[0])));var E=this._extentHandler,F=
this._errorHandler;this.source&&(r={source:this.source.toJson()},t.layer=h.toJson(r));this.gdbVersion&&(t.gdbVersion=this.gdbVersion);r=this.requestOptions;return b({url:this._url.path+"/query",content:t,callbackParamName:"callback",timeout:r&&r.timeout,load:function(u,D){E(u,D,y,K,C.dfd)},error:function(u){F(u,K,C.dfd)}},r)},_handler:function(t,y,K,C,r){try{t&&y&&(t=k.pbfDeps.optimizedFeatures.convertToFeatureSet(k.pbfDeps.pbfQueryUtils.parsePBFFeatureQuery(t)));var E=new d(t);this._successHandler([E],
"onComplete",K,r)}catch(F){this._errorHandler(F,C,r)}},_relationshipQueryHandler:function(t,y,K,C,r){try{var E=t.geometryType,F=t.spatialReference,u={};w.forEach(t.relatedRecordGroups,function(D){var z={};z.geometryType=E;z.spatialReference=F;z.features=D.relatedRecords;z=new d(z);if(null!=D.objectId)u[D.objectId]=z;else for(var M in D)D.hasOwnProperty(M)&&"relatedRecords"!==M&&(u[D[M]]=z)});this._successHandler([u],"onExecuteRelationshipQueryComplete",K,r)}catch(D){this._errorHandler(D,C,r)}},_executeForIdsHandler:function(t,
y,K,C,r){try{this._successHandler([t.objectIds],"onExecuteForIdsComplete",K,r)}catch(E){this._errorHandler(E,C,r)}},_countHandler:function(t,y,K,C,r){try{var E=t.features,F=t.objectIds;if(F)var u=F.length;else{if(E)throw Error("Unable to perform query. Please check your parameters.");u=t.count}this._successHandler([u],"onExecuteForCountComplete",K,r)}catch(D){this._errorHandler(D,C,r)}},_extentHandler:function(t,y,K,C,r){try{t.extent&&(t.extent=new f(t.extent)),this._successHandler([t],"onExecuteForExtentComplete",
K,r)}catch(E){this._errorHandler(E,C,r)}}});k.loadPBFReader=function(){var t=new q;k.pbfDeps?t.resolve():G(["./support/pbfDeps"],function(y){k.pbfDeps=y;t.isFulfilled()||t.resolve()});return t.promise};n._createWrappers(k);l("extend-esri")&&A.setObject("tasks.QueryTask",k,e);return k})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(G,B,A,w,q,h,p,e){G=G(e,{declaredClass:"esri.tasks._Task",
_eventMap:{error:["error"],complete:["result"]},constructor:function(l,b){l&&B.isString(l)&&(this._url=p.urlToObject(this.url=l));b&&b.requestOptions&&(this.requestOptions=b.requestOptions);this.normalization=!0;this._errorHandler=B.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var l=this._url,b=/^http:/i;this.url&&(this.url=this.url.replace(b,"https:"));l&&l.path&&(l.path=l.path.replace(b,"https:"))},_encode:function(l,b,a){var f={},n;for(n in l)if("declaredClass"!==
n){var m=l[n];var d=typeof m;if(null!==m&&void 0!==m&&"function"!==d)if(B.isArray(m)){f[n]=[];var c=m.length;for(d=0;d<c;d++)f[n][d]=this._encode(m[d])}else"object"===d?m.toJson&&(d=m.toJson(a&&a[n]),"esri.tasks.FeatureSet"===m.declaredClass&&d.spatialReference&&(d.sr=d.spatialReference,delete d.spatialReference),f[n]=b?d:A.toJson(d)):f[n]=m}return f},_successHandler:function(l,b,a,f){b&&this[b].apply(this,l);a&&a.apply(null,l);f&&h._resDfd(f,l)},_errorHandler:function(l,b,a){this.onError(l);b&&b(l);
a&&a.errback(l)},setNormalization:function(l){this.normalization=l},onError:function(){}});w("extend-esri")&&(q.Task=G);return G})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f){G=G(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(n,m){if(n){B.mixin(this,
n);var d=this.features=this.features||[],c=n.spatialReference;c=this.spatialReference=a.createInstance(e.simpleConstructor,c);var g=a.getGeometryType(n.geometryType);this.geometryType=n.geometryType;n.fields&&(this.fields=n.fields);n=a.supportsLazyUnquantization(this.geometryType);var k=a.unquantizeFunction(this.geometryType,this.transform),t=!!(m&&n&&k),y=g&&(t?g.accessorConstructor:g.simpleConstructor);A.forEach(d,function(K,C){var r=a.createInstance(p.simpleConstructor),E=K.geometry;if(g&&E){var F=
r.geometry=a.createInstance(y,t?null:E);F.setSpatialReference(E.spatialReference?a.createInstance(e.simpleConstructor,E.spatialReference):c);t&&F.setupLazyUnquantization(k,E)}r.symbol=K.symbol?f.fromJson(K.symbol):null;r.attributes=K.attributes;d[C]=r});t||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(n){var m={};this.displayFieldName&&(m.displayFieldName=this.displayFieldName);this.fields&&(m.fields=this.fields);
this.spatialReference?m.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(m.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(m.geometryType=a.getJsonType(this.features[0].geometry)),m.features=l._encodeGraphics(this.features,n));m.geometryType=m.geometryType||this.geometryType;m.exceededTransferLimit=this.exceededTransferLimit;m.transform=this.transform;return h.fixJson(m)},_hydrate:function(){a.unquantize(this.features,
this.geometryType,this.transform);this.transform=null},quantize:function(n){if(!this.geometryType)return this.transform=null,this;var m=n.translate[0],d=n.translate[1],c=n.scale[0],g=n.scale[1],k=this.features,t=function(r,E,F){var u,D=[];var z=0;for(u=r.length;z<u;z++){var M=r[z];if(0<z){var H=E(M[0]);M=F(M[1]);if(H!==x||M!==J){D.push([H-x,M-J]);var x=H;var J=M}}else x=E(M[0]),J=F(M[1]),D.push([x,J])}return 0<D.length?D:null},y=function(r,E,F){if("esriGeometryPoint"===r)return function(u){u.x=E(u.x);
u.y=F(u.y);return u};if("esriGeometryPolyline"===r||"esriGeometryPolygon"===r)return function(u){var D;var z=u.rings||u.paths;var M=[];var H=0;for(D=z.length;H<D;H++){var x=z[H];(x=t(x,E,F))&&M.push(x)}return 0<M.length?(u.rings?u.rings=M:u.paths=M,u):null};if("esriGeometryMultipoint"===r)return function(u){var D=t(u.points,E,F);return 0<D.length?(u.points=D,u):null};if("esriGeometryEnvelope"===r)return function(u){return u}}(this.geometryType,function(r){return Math.round((r-m)/c)},function(r){return Math.round((d-
r)/g)}),K;var C=0;for(K=k.length;C<K;C++)k[C].geometry&&(y(k[C].geometry)||k[C].setGeometry(null));this.transform=n;return this}});G.createGraphics=function(n){var m=n.geometryType,d=a.createInstance(e.simpleConstructor,n.spatialReference),c=a.getGeometryType(m).accessorConstructor,g=a.unquantizeFunction(m,n.transform);return A.map(n.features,function(k,t){t=a.createInstance(p.simpleConstructor);var y=k.geometry;if(y){var K=t.geometry=a.createInstance(c);K.setSpatialReference(d);K.setupLazyUnquantization(g,
y)}t.attributes=k.attributes;return t})};G.createPolygon=function(n,m,d){if(n){var c=a.createInstance(b.accessorConstructor);c.setSpatialReference(m);m=a.unquantizeFunction("esriGeometryPolygon",d);c.setupLazyUnquantization(m,n)}return c};w("extend-esri")&&B.setObject("tasks.FeatureSet",G,q);return G})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(G,B,A,w){G=G(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,
onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});A("extend-esri")&&B.setObject("tasks.StatisticDefinition",G,w);return G})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../symbols/jsonUtils ./FeatureTemplate ./support/domainUtils".split(" "),function(G,B,A,w,q,h,p,e,l){G=G(null,
{declaredClass:"esri.layers.FeatureType",constructor:function(b){if(b&&B.isObject(b)){this.id=b.id;this.name=b.name;var a=b.symbol;a&&(this.symbol=p.fromJson(a));a=b.domains;var f=this.domains={};for(n in a)a.hasOwnProperty(n)&&(f[n]=l.fromJson(a[n]));if(b=b.templates){var n=this.templates=[];for(a=0;a<b.length;a++)n.push(new e(b[a]))}}},toJson:function(){var b={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},a,f=this.domains,n=this.templates,m=h.fixJson;if(f){var d=b.domains=
{};for(a in f)f.hasOwnProperty(a)&&(d[a]=f[a]&&f[a].toJson());m(d)}n&&(b.templates=A.map(n,function(c){return c.toJson()}));return m(b)}});w("extend-esri")&&B.setObject("layers.FeatureType",G,q);return G})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../graphic".split(" "),function(G,B,A,w,q,h){G=G(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(p){p&&B.isObject(p)&&(this.name=p.name,this.description=p.description,
this.drawingTool=p.drawingTool,this.thumbnail=p.thumbnail,p=p.prototype,this.prototype=new h(p.geometry,null,p.attributes))},toJson:function(){return q.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,thumbnail:q.fixJson(B.clone(this.thumbnail)),prototype:this.prototype&&this.prototype.toJson()})}});B.mixin(G,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",
TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});A("extend-esri")&&B.setObject("layers.FeatureTemplate",
G,w);return G})},"esri/layers/support/domainUtils":function(){define("dojo/_base/lang dojo/has ../../kernel ../RangeDomain ../CodedValueDomain ../InheritedDomain".split(" "),function(G,B,A,w,q,h){var p={fromJson:function(e){if(e)switch(e.type){case "range":var l=new w(e);break;case "codedValue":l=new q(e);break;case "inherited":l=new h(e)}return l}};B("extend-esri")&&G.setObject("layers.support.domainUtils",p,A);return p})},"esri/layers/FeatureSubtype":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./support/domainUtils".split(" "),
function(G,B,A,w,q,h){G=G(null,{declaredClass:"esri.layers.FeatureSubtype",constructor:function(p){if(p&&B.isObject(p)){this.code=p.code;this.name=p.name;this.defaultValues=p.defaultValues;p=p.domains;var e=this.domains={},l;for(l in p)p.hasOwnProperty(l)&&(e[l]=h.fromJson(p[l]))}},toJson:function(){var p=q.fixJson,e={code:this.code,name:this.name,defaultValues:p(B.clone(this.defaultValues))},l=this.domains;if(l){var b=e.domains={},a;for(a in l)l.hasOwnProperty(a)&&(b[a]=l[a]&&l[a].toJson());p(b)}return p(e)}});
A("extend-esri")&&B.setObject("layers.FeatureSubtype",G,w);return G})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(G,B,A,w){G=G(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(q){q&&B.isObject(q)&&(this.objectId=q.objectId,this.globalId=q.globalId,this.success=q.success,q.success||(q=q.error,this.error=Error(),this.error.code=q.code,this.error.message=q.description))}});A("extend-esri")&&B.setObject("layers.FeatureEditResult",
G,w);return G})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ../srUtils ../tasks/query ./RenderMode ./support/ParallelSnapshot".split(" "),function(G,B,A,w,q,h,p,e,l){G=G([e],{declaredClass:"esri.layers._SnapshotMode",maxFeatures:5E4,maxRecordCountFactor:1,scaleToTileFactor:1,_isSuspendedAtStartup:!1,_pendingRefresh:!1,constructor:function(b){this.featureLayer=b;this._featureMap={};this._hasUpdateError=this._hasPartialFeatures=
!1;this._drawFeatures=B.hitch(this,this._drawFeatures);this._queryErrorHandler=B.hitch(this,this._queryErrorHandler);this._handleSuccess=B.hitch(this,this._handleSuccess);this._handleError=B.hitch(this,this._handleError);this._handleProgress=B.hitch(this,this._handleProgress)},startup:function(){if(!this._started||this._isSuspendedAtStartup){this.inherited(arguments);var b=this.featureLayer,a=b.reHostedFS.test(b.url);this.pagination=b.queryPagination&&null!=b.maxRecordCount;this._cacheHintSupported=
b._isCacheHintSupported();this.scaleToTileFactor=this._getScaleToTileFactor();a&&this.pagination&&(this._parallelSnapshot=new l({layer:b,mode:this,queryTask:b._task}));this._isSuspendedAtStartup=b.suspended;this._startup()}},propertyChangeHandler:function(b){this._init&&(b?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},
destroy:function(){this._isSuspendedAtStartup=this._pendingRefresh=!1;this._cancelPendingRequest(this._pendingRequest);this._parallelSnapshot&&this._parallelSnapshot.destroy();this.inherited(arguments)},drawFeature:function(b){var a=b.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(a,b);this._incRefCount(a)},resume:function(){this._isSuspendedAtStartup||this._pendingRefresh?(this._isSuspendedAtStartup=!1,this._startup()):this.propertyChangeHandler(0)},refresh:function(){var b=this.featureLayer;
b._collection?(b._fireUpdateStart(),b._refresh(!0),b._fireUpdateEnd()):this._fetchAll()},hasAllFeatures:function(){return!this._hasPartialFeatures},hasUpdateError:function(){return this._hasUpdateError},canFetchPBF:function(b){return this.inherited(arguments)&&this.featureLayer._canFetchPBFForQuery(b)},_startup:function(){this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},_fetchAll:function(){var b=this.featureLayer;b._collection||b.suspended||!b.isQueryable()?this._pendingRefresh=
b.suspended:(this._pendingRefresh=!1,b._fireUpdateStart(),this._clearIIf(),this._hasUpdateError=this._hasPartialFeatures=!1,this._parallelSnapshot?this._parallelSnapshot.fetch().then(this._handleSuccess,this._handleError,this._handleProgress):this._sendRequest())},_handleSuccess:function(b){this._hasPartialFeatures=b.hasPartialFeatures;this._hasUpdateError=b.hasUpdateError;this.featureLayer._fireUpdateEnd(null)},_handleError:function(b){this._queryErrorHandler(b)},_handleProgress:function(b){b.isError?
this.featureLayer._errorHandler(b.error):this._addFeatures(b.features)},_getScaleToTileFactor:function(){var b=this.featureLayer.tileMaxRecordCount,a=this.featureLayer.maxRecordCount,f=1;null!=b&&null!=a&&(f=Number((b/a).toFixed(2)));return f},_getPageSize:function(b){var a=this.featureLayer.tileMaxRecordCount;a="tile"===b.resultType&&a?a:this.featureLayer.maxRecordCount;b.maxRecordCountFactor&&(a=Math.floor(a*b.maxRecordCountFactor));return a},_sendRequest:function(b){var a=this.featureLayer,f=this._createQueryInfo(),
n=f.query;this.pagination&&(this._pageSize=this._getPageSize(n),this._start=n.start=null==b?0:b,n.num=this._pageSize);this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);this._pendingRequest=a._task.execute(n,this._drawFeatures,this._queryErrorHandler,f.pbf?{format:"pbf"}:null)},_drawFeatures:function(b){this._pendingRequest=null;this.featureLayer._isImageService&&10.7>this.featureLayer.version&&void 0===b.exceededTransferLimit&&(b.exceededTransferLimit=b.features.length===this.featureLayer.maxRecordCount);
var a=this.featureLayer,f=b.exceededTransferLimit,n=f&&!a._collection;b=this._checkMaxLimit(b.features);var m=b.maxLimitReached;this._addFeatures(b.features);this.pagination&&n&&!m||(this._hasPartialFeatures=!!f,a._fireUpdateEnd(null,f?{queryLimitExceeded:!0}:null));n&&(this.pagination&&!m&&this._sendRequest(this._start+this._pageSize),a.onQueryLimitExceeded())},_queryErrorHandler:function(b){this._pendingRequest=null;this._hasUpdateError=this._hasPartialFeatures=!0;var a=this.featureLayer;a._errorHandler(b);
a._fireUpdateEnd(b)},_checkMaxLimit:function(b){var a=b?b.length:0,f=this.featureLayer.graphics.length+a,n=f>=this.maxFeatures;if(n){var m=f-this.maxFeatures;m&&b.splice(a-m,m)}return{maxLimitReached:n,featuresDiscarded:f>this.maxFeatures,features:b}},_createQueryInfo:function(){var b=this.featureLayer,a=new p;a.outFields=b.getOutFields();a.where=b._getAttributeFilter()||"1\x3d1";a.returnGeometry=!0;a.outSpatialReference=h.createSpatialReference(this.map.spatialReference.toJson());a.timeExtent=b.getTimeDefinition();
a.maxAllowableOffset=b._maxOffset;a.quantizationParameters=b._quantizationParameters;a.orderByFields=b.supportsAdvancedQueries?b.getOrderByFields():null;a.multipatchOption=b.multipatchOption;b._ts&&(a._ts=(new Date).getTime());this._cacheHintSupported&&b._enableCacheHint(a);var f=this.canFetchPBF(a);b._enableEditModeQuantization(a,f);this._applyMaxRecordCountFactor(a,f);return{query:a,pbf:f}},_applyMaxRecordCountFactor:function(b,a){var f=this.featureLayer.advancedQueryCapabilities;this.featureLayer._isCacheHintEnabled(b)&&
f&&f.supportsMaxRecordCountFactor&&("tile"!==b.resultType&&1<this.scaleToTileFactor&&(b.maxRecordCountFactor=this.scaleToTileFactor),a&&1<this.maxRecordCountFactor&&(b.maxRecordCountFactor=this.maxRecordCountFactor),5<b.maxRecordCountFactor&&(b.maxRecordCountFactor=5))},_addFeatures:function(b){var a=this.featureLayer,f=a.objectIdField,n=b.length,m=a._selectedFeatures,d=a.mode===a.constructor.MODE_AUTO;a._fireUpdateStart();a._sortFeatures(b);for(a=0;a<n;a++){var c=b[a];var g=c.attributes[f];var k=
this._addFeatureIIf(g,c);this._incRefCount(g);d&&k!==c&&m[g]&&(k.setGeometry(c.geometry),k.setAttributes(c.attributes))}this._applyTimeFilter(!0)}});A("extend-esri")&&B.setObject("layers._SnapshotMode",G,w);return G})},"esri/layers/RenderMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","../sniff","../kernel"],function(G,B,A,w,q){var h=!!w("esri-pbf"),p=!!w("esri-featurelayer-pbf");G=G(null,{declaredClass:"esri.layers._RenderMode",enablePBFQuery:h&&p,initialize:function(e){this.map=
e;this._init=!0},startup:function(){this._started=!0},propertyChangeHandler:function(e){},destroy:function(){this._init=this._started=!1},drawFeature:function(e){},suspend:function(){},resume:function(){},refresh:function(){},hasAllFeatures:function(){return!0},hasUpdateError:function(){return!1},canFetchPBF:function(e){return!(!this.featureLayer._canFetchPBF()||!this.enablePBFQuery)},_incRefCount:function(e){(e=this._featureMap[e])&&e._count++},_decRefCount:function(e){(e=this._featureMap[e])&&e._count--},
_getFeature:function(e){return this._featureMap[e]},_addFeatureIIf:function(e,l){var b=this._featureMap,a=b[e],f=this.featureLayer;a||(b[e]=l,f._add(l),l._count=0);return a||l},_removeFeatureIIf:function(e){var l=this._featureMap[e],b=this.featureLayer;if(l){if(l._count)return;delete this._featureMap[e];b._remove(l)}return l},_registerFeature:function(e,l){var b=this._featureMap,a=b[e];a?(a.attributes=l.attributes,a.geometry=l.geometry):(b[e]=l,l._count=0,l._layer=l._graphicsLayer=l._sourceLayer=
this.featureLayer);return a||l},_unregisterFeature:function(e){var l=this._featureMap,b=l[e];b&&!b._count&&(delete l[e],b._graphicsLayer=null)},_clearIIf:function(){var e=this.featureLayer;var l=e.graphics,b=e._selectedFeatures,a=e.getSelectedFeatures().length,f=e.objectIdField;if(a)for(e=l.length-1;0<=e;e--){a=l[e];var n=a.attributes[f];n in b?a._count=1:(a._count=0,this._removeFeatureIIf(n))}else e.clear(),this._featureMap={}},_cancelPendingRequest:function(e){if(e)try{e.cancel()}catch(l){}},_toggleVisibility:function(e){var l=
this.featureLayer,b=l.graphics,a=e?"show":"hide",f,n=b.length;e=e&&l._ager;for(f=0;f<n;f++){var m=b[f];m[a]();e&&l._repaint(m)}},_applyTimeFilter:function(e){var l=this.featureLayer;if(l.timeInfo&&!l.suspended){e||l._fireUpdateStart();var b=l._trackManager;b&&b.clearTracks();var a=l.getTimeDefinition(),f=l._getOffsettedTE(l._mapTimeExtent);f?(f=l._getTimeOverlap(a,f))?(a=l._filterByTime(l.graphics,f.startTime,f.endTime),b&&b.addFeatures(a.match),A.forEach(a.match,function(n){var m=n._shape;n.visible||
(n.show(),(m=n._shape)&&m._moveToFront());l._ager&&m&&l._repaint(n)}),A.forEach(a.noMatch,function(n){n.visible&&n.hide()})):this._toggleVisibility(!1):(b&&b.addFeatures(l.graphics),this._toggleVisibility(!0));b&&(b.moveLatestToFront(),b.drawTracks());e||l._fireUpdateEnd()}}});w("extend-esri")&&B.setObject("layers._RenderMode",G,q);return G})},"esri/layers/support/ParallelSnapshot":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/Deferred ../../kernel".split(" "),
function(G,B,A,w,q,h){G=G(null,{declaredClass:"esri.layers.support.ParallelSnapshot",layer:null,mode:null,queryTask:null,batchSize:5,_queryInfo:null,_fetchDfd:null,_startPage:null,_lastPage:null,_pageSize:null,_maxPages:null,_requests:null,constructor:function(p){B.mixin(this,p);this._requests={}},destroy:function(){this.cancel()},fetch:function(){var p=new q;this.cancel(!0);this._queryInfo=this.mode._createQueryInfo();this._pageSize=this.mode._getPageSize(this._queryInfo.query);this._maxPages=Math.ceil(this._getFeatureCount()/
this._pageSize);this._fetchDfd=p;this._sendRequests();return p.promise},cancel:function(p){this._cancelPendingRequests(p);this._reset()},_reset:function(){this._startPage=this._lastPage=null;this._requests={}},_getFeatureCount:function(){return this.layer.mode===this.layer.constructor.MODE_AUTO&&0===this.layer.getLastExceedsLimitResult()?this.layer._getMaxFeaturesForAutoSnapshotMode():this.mode.maxFeatures},_sendRequests:function(p){var e=this._queryInfo.query,l=this.queryTask,b=this._requests;p=
null==p?1:p;var a=p+this.batchSize-1;a>this._maxPages&&(a=this._maxPages);if(!(p>a))for(this._startPage=p,this._lastPage=a;p<=a;p++)e.start=(p-1)*this._pageSize,e.num=this._pageSize,b[p]=l.execute(e,null,null,this._queryInfo.pbf?{format:"pbf"}:null),b[p].then(B.hitch(this,this._handleSuccess,p)).otherwise(B.hitch(this,this._handleError,p))},_evalNextBatch:function(p){p===this._lastPage&&this._sendRequests(this._lastPage+1)},_handleSuccess:function(p,e){e.exceededTransferLimit||this._cancelLaterRequests(p,
!0);var l=this.mode._checkMaxLimit(e.features);this._fetchDfd.progress({features:l.features,isError:!1});l.maxLimitReached?((p=l.featuresDiscarded||this._hasRejectedRequests())||(p=!!this._getResult(this._getLastSuccessfulRequest()).exceededTransferLimit),this._resolveFetch(p)):(e.exceededTransferLimit&&this._evalNextBatch(p),this._evalResolution())},_handleError:function(p,e){var l=this._requests;l&&l[p]&&(1===p?this._rejectFetch(e):(this._evalNextBatch(p),this._fetchDfd.progress({error:e,isError:!0}),
this._evalResolution()))},_evalResolution:function(){this._hasPendingRequests()||this._resolveFetch(this._hasRejectedRequests())},_resolveFetch:function(p){var e=this._hasRejectedRequests();this.cancel(!0);this._fetchDfd.resolve({hasPartialFeatures:p,hasUpdateError:e})},_rejectFetch:function(p){this.cancel(!0);this._fetchDfd.reject(p)},_getResult:function(p){return p&&p.dfd.results[0]},_hasPendingRequests:function(){return!!this._getPendingRequests().length},_getPendingRequests:function(){var p=this._requests,
e,l=[];for(e in p){var b=p[e];b.isFulfilled()||l.push({pageId:Number(e),dfd:b})}return l},_getLastSuccessfulRequest:function(){var p=this._getResolvedRequests(),e=-Infinity,l;p=A.filter(p,function(b){return!!this._getResult(b).features.length||1===b.pageId},this);A.forEach(p,function(b){b.pageId>e&&(e=b.pageId,l=b)});return l},_getResolvedRequests:function(){var p=this._requests,e,l=[];for(e in p){var b=p[e];b.isResolved()&&l.push({pageId:Number(e),dfd:b})}return l},_hasRejectedRequests:function(){var p=
this._getRejectedRequests(),e=this._getLastSuccessfulRequest(),l=this._getResult(e);l&&!l.exceededTransferLimit&&(p=A.filter(p,function(b){return b.pageId<=e.pageId}));return!!p.length},_getRejectedRequests:function(){var p=this._requests,e,l=[];for(e in p){var b=p[e];b.isRejected()&&l.push({pageId:Number(e),dfd:b})}return l},_cancelPendingRequests:function(p){this._cancelRequests(this._getPendingRequests(),p)},_cancelLaterRequests:function(p,e){var l=A.filter(this._getPendingRequests(),function(b){return b.pageId>
p});this._cancelRequests(l,e)},_cancelRequests:function(p,e){var l=this.mode,b=this._requests;A.forEach(p,function(a){e&&delete b[a.pageId];l._cancelPendingRequest(a.dfd)})}});w("extend-esri")&&B.setObject("layers.support.ParallelSnapshot",G,h);return G})},"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../tasks/query ./RenderMode ./GridLayout".split(" "),function(G,B,A,w,q,h,p,e,l,b){G=G([l],
{declaredClass:"esri.layers._OnDemandMode",constructor:function(a){this.featureLayer=a;this._featureMap={}},initialize:function(a){this.inherited(arguments);this._cellMap={};this._gridLayer=b.createFromFeatureLayer({layer:this.featureLayer,map:a})},startup:function(){if(!this._started||this._isSuspendedAtStartup)this.inherited(arguments),this._ioQueue=[],this._isSuspendedAtStartup=this.featureLayer.suspended,this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(a){this._init&&
(2>a?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this._processIOQueue(!0);this.inherited(arguments)},drawFeature:function(a){var f=a.geometry,n=[];if(f){n=this._gridLayer.getCellsInExtent("point"===f.type?{xmin:f.x,ymin:f.y,xmax:f.x,ymax:f.y}:f.getExtent(),!1).cells;f=this._cellMap;var m,d=a.attributes[this.featureLayer.objectIdField];
for(m=0;m<n.length;m++){var c=n[m];var g=c.latticeID;var k=c.row;var t=c.col;g?c=f[g]=f[g]||c:(f[k]=f[k]||{},c=f[k][t]=f[k][t]||c);c.features=c.features||[];c.features.push(a);this._addFeatureIIf(d,a);this._incRefCount(d)}}},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},hasAllFeatures:function(){var a=!1,f=this._getCurrentCells(),n;for(n=0;n<f.length;n++)if(f[n].hasPartialFeatures){a=
!0;break}return!a},hasUpdateError:function(){var a=!1,f=this._getCurrentCells(),n;for(n=0;n<f.length;n++)if(f[n].hasUpdateError){a=!0;break}return a},canFetchPBF:function(a){return this.inherited(arguments)&&this.featureLayer._canFetchPBFForQuery(a)},_enableConnectors:function(){var a=this.map;this._zoomConnect=B.connect(a,"onZoomEnd",this,this._zoomHandler);this._panConnect=B.connect(a,"onPanEnd",this,this._panHandler);this._resizeConnect=B.connect(a,"onResize",this,this._panHandler)},_disableConnectors:function(){B.disconnect(this._zoomConnect);
B.disconnect(this._panConnect);B.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var a=this.featureLayer,f=this.map;!a.suspended&&a.isQueryable()&&(a._fireUpdateStart(),this._clearIIf(),(a=a._trackManager)&&a.clearTracks(),this._cellMap={},this._gridLayer.setResolution(f.extent),this._sendRequest())},_panHandler:function(a){if(this.featureLayer.isQueryable()){this.featureLayer._fireUpdateStart();var f=this.featureLayer._resized;a=f?a:null;f&&this._gridLayer.setMapState(a,
this.map.width,this.map.height);this._sendRequest(a)}},_sendRequest:function(a){this._exceeds=!1;var f=this.featureLayer,n=this.map;a=a||n.extent;n=this._gridLayer.getCellsInExtent(a,f.latticeTiling).cells;if(!f.isEditable()){var m=this._cellMap;n=w.filter(n,function(k){if(k.lattice){if(m[k.latticeID])return!1}else if(m[k.row]&&m[k.row][k.col])return!1;return!0})}this._pending=this._pending||0;var d;for(d=0;d<n.length;d++){var c=n[d],g=this._createQueryInfo(c);this._pending++;this._ioQueue.push(f._task.execute(g.query,
A.hitch(this,this._drawFeatures,c),A.hitch(this,this._queryErrorHandler,c),g.pbf?{format:"pbf"}:null))}this._removeOldCells(a);this._endCheck()},_drawFeatures:function(a,f){this.featureLayer._isImageService&&10.7>this.featureLayer.version&&void 0===f.exceededTransferLimit&&(f.exceededTransferLimit=f.features.length===this.featureLayer.maxRecordCount);a.hasPartialFeatures=!!f.exceededTransferLimit;a.hasUpdateError=!1;this._exceeds=this._exceeds||f.exceededTransferLimit;this._finalizeIO();var n=this.featureLayer,
m=this.map.extent,d=a.extent,c=a.row,g=a.col,k=n.objectIdField;f=f.features;var t=this._gridLayer,y=this._cellMap,K=a.latticeID;y=K?y[K]:y[c]&&y[c][g];if(a.resolution==t.resolution&&(K?K===t.getLatticeID(m):t.intersects(d,m)))if(y)n._sortFeatures(f),this._updateCell(y,f);else for(n._sortFeatures(f),a.features=f,this._addCellToCellMap(a),n=f.length,a=0;a<n;a++)m=f[a],d=m.attributes[k],this._addFeatureIIf(d,m),this._incRefCount(d);else y&&this._removeCell(c,g,K);this._endCheck()},_queryErrorHandler:function(a,
f){this._finalizeIO();a.hasPartialFeatures=!0;a.hasUpdateError=!0;this._addCellToCellMap(a);this.featureLayer._errorHandler(f);this._endCheck(f)},_finalizeIO:function(){this._pending--},_endCheck:function(a){if(0===this._pending){this._processIOQueue();var f=this.featureLayer,n=f._trackManager;n&&(n.clearTracks(),n.addFeatures(f.graphics),f._ager&&w.forEach(f.graphics,function(m){m._shape&&f._repaint(m)}),n.moveLatestToFront(),n.drawTracks());this.featureLayer._fireUpdateEnd(!!a&&Error("FeatureLayer: "+
(a.message||"an error occurred while updating the layer.")),this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)f.onQueryLimitExceeded()}},_processIOQueue:function(a){this._ioQueue=w.filter(this._ioQueue,function(f){return-1<f.fired?!1:!0});a&&w.forEach(this._ioQueue,this._cancelPendingRequest)},_createQueryInfo:function(a){var f=this.featureLayer,n=new e;n.outFields=f.getOutFields();n.where=f._getAttributeFilter();n.returnGeometry=!0;n.geometry=a.extent||a.lattice;f.latticeTiling&&a.extent&&
(n.spatialRelationship=e.SPATIAL_REL_CONTAINS);n.timeExtent=f._getOffsettedTE(f._mapTimeExtent);n.maxAllowableOffset=f._maxOffset;n.quantizationParameters=f._quantizationParameters;n.orderByFields=f.supportsAdvancedQueries?f.getOrderByFields():null;n.multipatchOption=f.multipatchOption;f._ts&&(n._ts=(new Date).getTime());(a=f.advancedQueryCapabilities)&&a.supportsQueryWithResultType&&(n.resultType="tile");a=this.canFetchPBF(n);f._enableEditModeQuantization(n,a);return{query:n,pbf:a}},_getCurrentCells:function(a){var f=
[];a=a||this._cellMap;for(var n in a)if(a.hasOwnProperty(n)){var m=a[n];m&&(m.hasOwnProperty("row")||m.hasOwnProperty("latticeID")?f.push(m):"object"===typeof m&&f.push.apply(f,this._getCurrentCells(m)))}return f},_addCellToCellMap:function(a){var f=this._cellMap;if(a.latticeID)f[a.latticeID]=a;else{var n=a.row,m=a.col;f[n]=f[n]||{};f[n][m]=a}},_removeOldCells:function(a){var f=this._cellMap,n=this._gridLayer,m,d;for(m in f)if(f[m]){var c=f[m],g=c.latticeID,k=0,t=0;if(g)k++,g!==n.getLatticeID(a)&&
(this._removeCell(null,null,g),t++);else for(d in c)c[d]&&(k++,n.intersects(c[d].extent,a)||(this._removeCell(m,d),t++));t===k&&delete f[m]}},_updateCell:function(a,f){var n=this.featureLayer,m=n.objectIdField;n=n._selectedFeatures;var d,c=f.length;a.features=a.features||[];for(d=0;d<c;d++){var g=f[d],k=g.attributes[m],t=this._addFeatureIIf(k,g);t===g?(this._incRefCount(k),a.features.push(t)):k in n||(t.setGeometry(g.geometry),t.setAttributes(g.attributes))}},_removeCell:function(a,f,n){var m=this._cellMap,
d=this.featureLayer,c=d.objectIdField,g=n?m[n]:m[a]&&m[a][f];if(g&&(n?delete m[n]:delete m[a][f],a=g.features))for(f=0;f<a.length;f++)n=a[f].attributes[c],this._decRefCount(n),n in d._selectedFeatures||this._removeFeatureIIf(n)}});q("extend-esri")&&A.setObject("layers._OnDemandMode",G,h);return G})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/normalizeUtils ../srUtils".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a){var f=G(null,{declaredClass:"esri.layers._GridLayout",constructor:function(n,m,d,c){this.origin=n;this.cellWidth=m.width;this.cellHeight=m.height;this.mapWidth=d.width;this.mapHeight=d.height;this.srInfo=c},setResolution:function(n){this.resolution=(n.xmax-n.xmin)/this.mapWidth;this.srInfo&&(n=Math.round(Math.round(2*this.srInfo.valid[1]/this.resolution)/this.cellWidth),this._frameStats=[n,0,n-1])},setMapState:function(n,m,d){this.mapWidth=m;this.mapHeight=d;this.setResolution(n)},
getCellCoordinates:function(n){var m=this.resolution,d=this.origin;return{row:Math.floor((d.y-n.y)/(this.cellHeight*m)),col:Math.floor((n.x-d.x)/(this.cellWidth*m))}},normalize:function(n){var m=this._frameStats;if(m){var d=m[0],c=m[1];m=m[2];n<c?(n%=d,n=n<c?n+d:n):n>m&&(n%=d)}return n},intersects:function(n,m){var d=this.srInfo;return d?A.some(m._getParts(d),function(c){return n.intersects(c.extent)}):n.intersects(m)},getCellExtent:function(n,m){var d=this.resolution,c=this.origin,g=this.cellWidth,
k=this.cellHeight;return new p(m*g*d+c.x,c.y-(n+1)*k*d,(m+1)*g*d+c.x,c.y-n*k*d,a.createSpatialReference(c.spatialReference.toJson()))},getLatticeID:function(n){var m=this.getCellCoordinates({x:n.xmin,y:n.ymax}),d=this.getCellCoordinates({x:n.xmax,y:n.ymin});n=m.row;var c=d.row;m=this.normalize(m.col);d=this.normalize(d.col);return n+"_"+c+"_"+m+"_"+d},sorter:function(n,m){return n<m?-1:1},getCellsInExtent:function(n,m){var d=this.getCellCoordinates({x:n.xmin,y:n.ymax}),c=this.getCellCoordinates({x:n.xmax,
y:n.ymin}),g=d.row,k=c.row;d=d.col;c=c.col;var t=[],y,K,C=[],r=[],E=[];for(y=g;y<=k;y++)for(K=d;K<=c;K++){var F=this.normalize(K);n=this.getCellExtent(y,F);A.some(t,function(z){return z.row===y&&z.col===F})||t.push({row:y,col:F,extent:n,resolution:this.resolution});m&&(C.push(n.xmin,n.xmax),r.push(n.ymin,n.ymax))}d=this.normalize(d);c=this.normalize(c);C.sort(this.sorter);r.sort(this.sorter);m=C.length;for(y=m-1;0<=y;y--)y<m-1&&C[y]===C[y+1]&&C.splice(y,1);m=r.length;for(y=m-1;0<=y;y--)y<m-1&&r[y]===
r[y+1]&&r.splice(y,1);if(C.length&&r.length){n=C[0];K=C[C.length-1];var u=r[0];var D=r[r.length-1];m=C.length;for(y=0;y<m;y++)E.push([[C[y],D],[C[y],u]]);m=r.length;for(y=0;y<m;y++)E.push([[n,r[y]],[K,r[y]]]);C=new e({paths:E,spatialReference:this.origin.spatialReference.toJson()});t.push({latticeID:g+"_"+k+"_"+d+"_"+c,lattice:C,resolution:this.resolution})}return{minRow:g,maxRow:k,minCol:d,maxCol:c,topRow:g,bottomRow:k,leftCol:d,rightCol:c,cells:t}},_findCell:function(n,m,d){var c;A.some(n,function(g){g.row===
m&&g.col===d&&(c=g);return!!c});return c},getExtentOfIntersectingCells:function(n){var m=this.getCellsInExtent(n),d=m&&m.cells;if(d&&d.length){var c=m.topRow,g=m.leftCol,k=0;A.forEach(d,function(C){C.row===c&&k++});var t=this._findCell(d,c,g).extent,y=this.srInfo;if(!y||k!==this._frameStats[0]&&g!==m.rightCol){var K=t.xmin;y=K+k*t.getWidth()}else K=y.valid[0],y=y.valid[1];m=this._findCell(d,m.bottomRow,g).extent.ymin;(n=(new p(K,m,y,t.ymax,n.spatialReference))._normalize(!1,!1))&&n.rings&&(n=new l(n),
n=b.getDenormalizedExtent(n));return n}}});f.createFromFeatureLayer=function(n){var m=n.layer;n=m.getMap()||n.map;var d=m._srInfo;(m=n&&n.loaded?new f(new h(d?d.valid[0]:n.extent.xmin,d?d.valid[1]:n.extent.ymax,n.spatialReference),{width:m._tileWidth,height:m._tileHeight},{width:n.width,height:n.height},d):null)&&m.setResolution(n.extent);return m};w("extend-esri")&&B.setObject("layers._GridLayout",f,q);return f})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/has","../kernel","./RenderMode"],function(G,B,A,w,q){G=G([q],{declaredClass:"esri.layers._SelectionMode",constructor:function(h){this.featureLayer=h;this._featureMap={}},propertyChangeHandler:function(h){this._init&&0===h&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)},hasAllFeatures:function(){return!this.featureLayer._hasPartialSelectedFeatures},hasUpdateError:function(){return this.featureLayer._hasSelectionError}});A("extend-esri")&&B.setObject("layers._SelectionMode",
G,w);return G})},"esri/layers/StreamMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/has ../kernel ../SpatialReference ../tasks/query ../tasks/QueryTask ../geometry/jsonUtils ./RenderMode".split(" "),function(G,B,A,w,q,h,p,e,l,b,a){G=G([a],{declaredClass:"esri.layers._StreamMode",constructor:function(f,n){this.featureLayer=f;this._featureMap={};this._setRefreshRate();this._drawBuffer={adds:[],updates:[]};this._timeoutId=null;this._flushDrawBuffer=B.hitch(this,
this._flushDrawBuffer);this._featuresByTime={};this._lastEndTimeCheck=null;this._maxFeatureAge=0;f.purgeOptions&&f.purgeOptions.age&&"number"===typeof f.purgeOptions.age&&(this._maxFeatureAge=1E3*Math.ceil(60*f.purgeOptions.age));this._drawFeatures=B.hitch(this,this._drawFeatures);this._queryErrorHandler=B.hitch(this,this._queryErrorHandler)},startup:function(){this._started||this.inherited(arguments)},propertyChangeHandler:function(f){this._init&&(0===f?this._applyTimeFilter():3===f?this._redrawAllTracks():
console.debug("StreamLayer: Stream Layer only supports changing map time or maximumTrackPoints. Layer id \x3d "+this.featureLayer.id))},destroy:function(){this.inherited(arguments);clearTimeout(this._timeoutId);this._featuresByTime=this._drawBuffer=this._featureMap=null},drawFeature:function(f){var n=this.featureLayer,m=n.objectIdField;this._timeoutId||(this._timeoutId=setTimeout(this._flushDrawBuffer,this._refreshRate));n._joinField&&this._getFeature(f.attributes[m])?this._drawBuffer.updates.push({oid:f.attributes[m],
updates:f}):this._drawBuffer.adds.push(f)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);var f=this.featureLayer;f&&(f._relatedUrl||f._keepLatestUrl?(f._fireUpdateStart(),f._refreshing=!0,f.disconnect(),f.clear(),f._relatedQueried=!1,f._keepLatestQueried=!1,f.connect()):(f._fireUpdateStart(),f.clear(),f._fireUpdateEnd()))},_drawFeatures:function(f,n){var m=this.featureLayer;m._create(f.features||[]);m._fireUpdateEnd(null,
n)},_applyTimeFilter:function(f){this.inherited(arguments);this._redrawAllTracks()},_removeFeatures:function(f){var n=this.featureLayer,m=n.objectIdField;f&&A.forEach(f,function(d){d=d.attributes[m];n._unSelectFeatureIIf(d,this);this._decRefCount(d);this._removeFeatureIIf(d)},this)},_addFeatures:function(f){var n=this.featureLayer,m=n._endTimeField,d=n._startTimeField,c,g=[],k=[],t=[];var y=n._trackManager;var K=n.objectIdField;if(y)for(c in f=y.addFeatures(f),f)f.hasOwnProperty(c)&&(g.push(c),f[c].adds&&
(k=k.concat(f[c].adds)),f[c].deletes&&(t=t.concat(f[c].deletes)));else k=f;A.forEach(k,function(C){var r=C.attributes[K];var E=m&&C.attributes[m];!E&&this._maxFeatureAge&&(E=d&&C.attributes[d]?C.attributes[d]+this._maxFeatureAge:Date.now()+this._maxFeatureAge);E&&(E=1E3*Math.ceil(E/1E3),this._featuresByTime[E]?this._featuresByTime[E].push(r):this._featuresByTime[E]=[r]);this._addFeatureIIf(r,C);this._incRefCount(r)},this);t.length&&this._removeFeatures(t);y&&y.refreshTracks(g)},_updateFeatures:function(f){var n=
this.featureLayer,m=[];var d=n._trackManager;var c=n._trackIdField;A.forEach(f,function(g){var k=g.updates;g=this._getFeature(g.oid);var t;if(g){k.geometry&&g.setGeometry(k.geometry);k=k.attributes||{};for(t in k)k.hasOwnProperty(t)&&(g.attributes[t]=k[t]);g.setAttributes(g.attributes);g.visible=this._checkFeatureTimeIntersects(g);d&&g.attributes[c]?m.push(g.attributes[c]):n._repaint(g,null,!0)}},this);m.length&&d.refreshTracks(m)},_redrawAllTracks:function(){var f=this.featureLayer._trackManager,
n;f&&(n=f.trimTracks())&&0<n.length&&(this._removeFeatures(n),f.refreshTracks())},_flushDrawBuffer:function(){clearTimeout(this._timeoutId);var f=this._drawBuffer,n=f.adds.splice(0,f.adds.length),m=f.updates.splice(0,f.updates.length);f=this.featureLayer;if(!f)return!1;f.updating||f._fireUpdateStart();this._addFeatures(n);this._updateFeatures(m);(n=this._getExpiredFeatures())&&n.length&&(this._removeFeatures(n),f._trackManager&&f._trackManager.removeFeatures(n));f._purge();f._fireUpdateEnd();this._timeoutId=
null},_clearDrawBuffer:function(){var f=this._timeoutId,n=this._drawBuffer,m=n.adds;n=n.updates;f&&clearTimeout(f);m.splice(0,m.length);n.splice(0,n.length);this._timeoutId=null},_clearTimeBin:function(){this._featuresByTime={};this._lastEndTimeCheck=1E3*Math.ceil(Date.now()/1E3)},_clearFeatureMap:function(){this._featureMap={}},_setRefreshRate:function(f){f=f||0===f?f:200;0>f&&(f=200);this._refreshRate=f},_checkFeatureTimeIntersects:function(f){var n=this.featureLayer,m=n.getMap();return(m=m?m.timeExtent:
null)&&n.timeInfo&&(n.timeInfo.startTimeField||n.timeInfo.endTimeField)?0<n._filterByTime([f],m.startTime,m.endTime).match.length:!0},_fetchArchive:function(f){var n=new w,m=this.featureLayer;this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);m._fireUpdateStart();if(f&&this.map){f=new l(f);var d=new e;var c=this.map;var g=m.getFilter()||{};var k=g.where||"1\x3d1";var t=g.geometry?b.fromJson(g.geometry):null;g=g.outFields?g.outFields.split(","):["*"];d.geometry=t;d.where=k;d.outFields=
g;d.returnGeometry=!0;d.outSpatialReference=new p(c.spatialReference.toJson());this._pendingRequest=f.execute(d).then(function(y){this._pendingRequest=null;var K=this._fixFieldNameCasing(m,y);y.features=K;this._drawFeatures(y);m._fireUpdateEnd();n.resolve()}.bind(this)).otherwise(function(y){this._pendingRequest=null;m._errorHandler(y);m._fireUpdateEnd(y);n.reject(y)}.bind(this))}else n.resolve();return n.promise},_queryErrorHandler:function(f){var n=this.featureLayer;n._errorHandler(f);n._fireUpdateEnd(f)},
_fixFieldNameCasing:function(f,n){var m=n.features||[],d=n.fields;if(!d||!m.length)return m;f=this._mapFieldNameDifferences(f.fields,d);d=[];for(var c,g=0,k=n.features.length;g<k;g++)n=m[g],c=this._swizzleResponseAttributes(n.attributes,f),d.push({geometry:n.geometry,attributes:c});return d},_mapFieldNameDifferences:function(f,n){var m=[],d={},c;var g=0;for(c=n.length;g<c;g++)m.push(n[g].name);g=0;for(c=f.length;g<c;g++){n=f[g].name;var k=this._checkForStreamFieldName(n,m);k&&(d[k]=n)}return d},_checkForStreamFieldName:function(f,
n){f=f.toLowerCase();for(var m,d=0,c=n.length;d<c;d++)if(n[d].toLowerCase()===f){m=n[d];break}return m},_swizzleResponseAttributes:function(f,n){var m={},d;for(d in f)if(f.hasOwnProperty(d)){var c=f[d];n.hasOwnProperty(d)?m[n[d]]=c:m[d]=c}return m},_getExpiredFeatures:function(){var f,n,m=[],d=[];if(!this.featureLayer._endTimeField&&!this._maxFeatureAge)return d;var c=1E3*Math.floor(this._lastEndTimeCheck/1E3);this._lastEndTimeCheck=f=1E3*Math.ceil(Date.now()/1E3);if(c&&c!==f)for(n=this._featuresByTime;c<=
f;c+=1E3)n[c]&&(m=m.concat(n[c]),delete n[c]);A.forEach(m,function(g){(g=this._getFeature(g))&&d.push(g)},this);return d}});q("extend-esri")&&B.setObject("layers._StreamMode",G,h);return G})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/dom-construct dojox/gfx ../kernel ../graphic ../geometry/Polyline ./GraphicsLayer".split(" "),function(G,B,A,w,q,h,p,e,l,b){var a=-1!==h.renderer.toLowerCase().indexOf("canvas");G=G(null,{declaredClass:"esri.layers._TrackManager",
constructor:function(f){this.layer=f;this.trackMap={};this.trackLineMap={}},initialize:function(f){this.map=f;f=this.layer;this.createTracklineContainer()&&(this._handles=[f.on("visibility-change",B.hitch(this,function(n){this.container.setVisibility(n.visible);this.container.evaluateSuspension()})),f.on("scale-range-change",B.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)}))])},createTracklineContainer:function(){var f=this.layer;if("esriGeometryPoint"!==
f.geometryType)return null;var n=this.map,m=f._getRenderer();m=m&&m.trackRenderer;var d=this.container=new b._GraphicsLayer({id:f.id+"_tracks",_child:!0,visible:f.visible,minScale:f.minScale,maxScale:f.maxScale});d.loaded=!0;d.onLoad(d);d._setMap(n,f._div);a||(n=d._div.getNode(),f=f._div.getNode(),n&&f&&q.place(n,f,"first"));d.setRenderer(m);return d},addFeatures:function(f){var n=this.trackMap,m=this.layer,d=m._trackIdField,c=[];A.forEach(f,function(y){var K=y.attributes[d];(n[K]=n[K]||[]).push(y);
-1===A.indexOf(c,K)&&c.push(K)});var g=m._startTimeField,k=m.objectIdField,t=function(y,K){var C=y.attributes[g],r=K.attributes[g];return C===r?y.attributes[k]<K.attributes[k]?-1:1:C<r?-1:1};A.forEach(c,function(y){n[y].sort(t)})},trimTracks:function(f){function n(k){for(k=m[k]||[];k.length>d;)c.push(k.shift())}var m=this.trackMap,d=this.layer.maximumTrackPoints||0,c=[],g;if(!d)return c;if(f)A.forEach(f,function(k){n(k)});else for(g in m)m.hasOwnProperty(g)&&n(g);return c},drawTracks:function(f){function n(y){var K=
g[y],C,r;var E=m.trackLineMap[y];d.remove(E);delete m.trackLineMap[y];E=null;if(!K||2>K.length)return!1;E=[];for(C=K.length-1;0<=C;C--)(r=K[C].geometry)&&E.push([r.x,r.y]);K={};K[t]=y;1<E.length&&(E=new e(new l({paths:[E],spatialReference:k}),null,K),d.add(E),m.trackLineMap[y]=E)}var m=this,d=this.container,c;if(d){var g=this.trackMap;var k=this.map.spatialReference;var t=this.layer._trackIdField;if(f)A.forEach(f,function(y){n(y)});else for(c in g)g.hasOwnProperty(c)&&n(c)}},refreshTracks:function(f){function n(t){var y;
m.drawTracks([t]);if(g&&g.latestObservationRenderer){t=d[t]||[];var K=t.length;for(y=0;y<K;y++)c._repaint(t[y],null,!0)}}var m=this,d=this.trackMap,c=this.layer,g=c._getRenderer(),k;if(f)A.forEach(f,function(t){n(t)});else for(k in d)d.hasOwnProperty(k)&&n(k);this.moveLatestToFront()},moveLatestToFront:function(f){A.forEach(this.getLatestObservations(f),function(n){var m=n._shape;m&&m._moveToFront();this._repaint(n,null,!0)},this.layer)},getLatestObservations:function(f){function n(k){k=c[k];return k[k.length-
1]}var m=[],d=this.layer._getRenderer(),c=this.trackMap,g;if(!d.latestObservationRenderer)return m;if(f)A.forEach(f,function(k){m.push(n(k))});else for(g in c)c.hasOwnProperty(g)&&m.push(n(g));return m},clearTracks:function(f){var n=this.getLatestObservations(f),m=this.container,d=this.trackMap,c;if(f)A.forEach(f,function(k){delete this.trackMap[k];m&&(g=this.trackLineMap[k],m.remove(g),delete this.trackLineMap[k])},this);else{if(m)for(c in d){var g=this.trackLineMap[c];m.remove(g)}this.trackMap=
{};this.trackLineMap={}}A.forEach(n,function(k){this._repaint(k,null,!0)},this.layer)},isLatestObservation:function(f){var n=this.trackMap[f.attributes[this.layer._trackIdField]];return n?n[n.length-1]===f:!1},destroy:function(){A.forEach(this._handles,function(n){n.remove()});var f=this.container;f&&(f.clear(),f._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}});w("extend-esri")&&B.setObject("layers._TrackManager",G,p);return G})},"esri/layers/HeatmapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/_base/array require ../kernel ../sniff ../geometry/Point ../geometry/webMercatorUtils ./MapImage ../renderers/HeatmapRenderer ../tasks/query dojo/_base/fx".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n){function m(){}function d(c){var g=c.layer;return{geometry:c.geometry,attributes:c.attributes,getLayer:function(){return g}}}G=G(null,{declaredClass:"esri.layers.HeatmapManager",heatmapRenderer:null,sourceLayer:null,imageLayer:null,useTiles:!0,useWorker:!1,map:null,constructor:function(c){this.sourceLayer=c;this._hndls=[]},initialize:function(c){this.map=c;var g=this.sourceLayer,k=g.renderer;g.setDrawMode(!1);this.imageLayer=c._getMapImageLyr();var t=this;this.heatmapRenderer=
k instanceof a?k:(k.getRendererInfoByZoom(c.getZoom())||k.getRendererInfoByScale(c.getScale())).renderer;this.redraw=this.redraw.bind(this);this.recalculateHeatmap=this.recalculateHeatmap.bind(this);this._removeRenderer=this._removeRenderer.bind(this);this._handleRendererChange=this._handleRendererChange.bind(this);this._rendererChangeHandle=this.sourceLayer.on("renderer-change",this._handleRendererChange);this._handleOpacityChange=this._handleOpacityChange.bind(this);this._reprojectFeature=this._reprojectFeature.bind(this);
q(["../workers/heatmapCalculator"],function(y){t._calculator=new y(B.mixin({width:t.map.width,height:t.map.height},t._getOptions()));t._setupRenderer();t.heatmapRenderer.getStats=y.calculateStats;t.heatmapRenderer.getHistogramData=y.getHistogramData})},destroy:function(){this._removeHandlers();this._rendererChangeHandle&&this._rendererChangeHandle.remove();this._rendererChangeHandle=this.sourceLayer=this.imageLayer=this.map=this.heatmapRenderer=this._hndls=null},_handleRendererChange:function(c){var g=
c.renderer,k=g instanceof a;this.heatmapRenderer?k?this.heatmapRenderer=g:this._removeRenderer(c):k&&(this.heatmapRenderer=g,this.sourceLayer&&this.map&&this._setupRenderer())},_handleOpacityChange:function(c){c=c.opacity;var g=this._getImageBySourceId(this.sourceLayer.id);g&&g.setOpacity(c)},_setupRenderer:function(){var c=this._hndls,g=this.sourceLayer,k=this.map,t=this;g._originalDraw=g._draw;g._draw=m;g._div.clear();clearTimeout(this._resetTimer);this._resetTimer=setTimeout(this._resetGraphics.bind(this),
250);c.push(g.on("update-end",this.redraw));c.push(g.on("suspend",function(y){(y=t._getImageBySourceId(t.sourceLayer.id))&&y.hide()}));c.push(g.on("resume",function(y){(y=t._getImageBySourceId(t.sourceLayer.id))&&y.show()}));c.push(A.after(g,"redraw",this.redraw));c.push(k.on("layer-remove",function(y){y.layer==g&&((y=t._getImageBySourceId(t.sourceLayer.id))&&t.imageLayer.removeImage(y),t._removeRenderer({target:g}))}));g._collection&&c.push(g.on("graphic-add",function(y){t._reprojectFeature(y.graphic);
t.redraw()}));1!==g.mode&&(c.push(k.on("resize, pan-end",this.redraw)),c.push(k.on("zoom-end",this.redraw)));c.push(g.on("opacity-change",this._handleOpacityChange));this.imageLayer.suspended&&this.imageLayer.resume();g.graphics&&g.graphics.length&&(g.graphics[0].geometry&&!k.spatialReference.equals(g.graphics[0].geometry.spatialReference)&&w.forEach(g.graphics,function(y){this._reprojectFeature(y)}.bind(this)),this.redraw())},redraw:function(){if(!this._drawTimer){var c=this;this._drawTimer=setTimeout(function(){clearTimeout(c._drawTimer);
c._drawTimer=null;c.sourceLayer._getRenderer().isInstanceOf(a)&&c.recalculateHeatmap()},16)}},_removeRenderer:function(c){var g=c.target;g._draw=g._originalDraw;delete g._originalDraw;g.setDrawMode(!0);this._removeHandlers();this._hndls=[];var k=this._getImageBySourceId(this.sourceLayer.id);k&&this.imageLayer.removeImage(k);clearTimeout(this._drawTimer);clearTimeout(this._resetTimer);this._drawTimer=this._resetTimer=null;g.renderer!=c.renderer&&g.renderer.getRendererInfo?this.heatmapRenderer=null:
(this.destroy(),g.renderer&&g.renderer.getRendererInfo&&g.redraw())},recalculateHeatmap:function(){this._calculator?this._doMainCalculation():this._calculatorClient&&this._doWorkerCalculation()},_reprojectFeature:function(c){if(c&&c.geometry){var g=c.geometry,k=this.map.spatialReference;k.equals(g.spatialReference)||(g=l.project(g,k),null==g?console.log("Unable to reproject features to map's spatial reference. Please convert feature geometry before adding to layer"):c.geometry=g)}},_doWorkerCalculation:function(){},
_doMainCalculation:function(){var c=this.sourceLayer,g=this.map,k=this.heatmapRenderer,t=this.map.extent,y=this.map.width,K=this.map.height,C=this._calculator,r=this,E=function(u){u=r._getScreenPoints(u.features,g,c);u=C.calculateImageData(B.mixin({screenPoints:u,mapinfo:{extent:[t.xmin,t.ymin,t.xmax,t.ymax],resolution:g.getResolution()},width:y,height:K},r._getOptions()));u=k.getSymbol(d({geometry:g.extent,attributes:{size:[y,K],imageData:u},layer:c}));u=new b({extent:g.extent,href:u.url,opacity:0,
sourceId:c.id});r._swapMapImages(u,r._getImageBySourceId(c.id));c.suspended&&u.hide()},F={geometry:g.extent,timeExtent:c.useMapTime?g.timeExtent:void 0,spatialRelationship:f.SPATIAL_REL_INTERSECTS};null!=c._canDoClientSideQuery(F)?c.queryFeatures(F,E):E({features:c.graphics})},_getScreenPoints:function(c,g,k){var t=[],y=c.length,K=0,C=0,r=new e(g.extent.xmin,g.extent.ymax,g.spatialReference),E=g.toScreen(r),F=E.x;E=E.y;var u=g.getResolution(),D;for((C=g.extent.getCacheValue("_parts"))&&(D=w.map(C,
function(M){return k._intersects(g,M.extent)[0]}));y--;)if(C=c[y],C.geometry&&C.visible){var z={x:Math.ceil((C.geometry.x-r.x)/u+F),y:Math.floor((r.y-C.geometry.y)/u-E),attributes:C.attributes};D&&(C=1<D.length&&z.x<-D[0]?D[1]:D[0],z.x+=C);t[K++]=z}return t},_getImageBySourceId:function(c){var g=this.imageLayer.getImages();g=w.filter(g,function(k){return k.sourceId==c});if(g.length)return g[g.length-1]},_swapMapImages:function(c,g){function k(){t.removeImage(g)}var t=this.imageLayer,y=this.sourceLayer.opacity;
t.addImage(c);n.anim(c._node,{opacity:y},null,null,function(){c.opacity=y});null!=g&&n.anim(g._node,{opacity:0},null,null,k)},_removeHandlers:function(){if(null!=this._hndls)for(var c=this._hndls.length;c--;)this._hndls[c].remove()},_getOptions:function(){var c=this.heatmapRenderer;return{blurRadius:c.blurRadius,gradient:c.gradient,maxPixelIntensity:c.maxPixelIntensity,minPixelIntensity:c.minPixelIntensity,field:c.field,fieldOffset:c.fieldOffset}},_resetGraphics:function(){clearTimeout(this._resetTimer);
this._resetTimer=null;for(var c=this.sourceLayer.graphics,g=c.length,k;g--;)k=c[g],k._shape=k._offsets=void 0}});p("extend-esri")&&B.setObject("layers.HeatmapManager",G,h);return G})},"esri/layers/clustering/ClusterManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../kernel ../../Evented ../../graphic ../../lang ../../Color ../../graphicsUtils ../../dijit/PopupTemplate ../../dijit/Legend/utils ../../renderers/ClassBreaksRenderer ../../symbols/SimpleMarkerSymbol ../support/attributeUtils ../GraphicsLayer ../Field ./GeohashAggregation ./statUtils dojo/i18n!../../nls/jsapi".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k,t,y){var K=y.layers.clusters,C=y.widgets.popup,r=K.numFeatures,E=Math.pow(2,53)-1;G=G(h,{declaredClass:"esri.layers.clustering.ClusterManager",layer:null,aggregationInfo:null,container:null,defaults:{clusterRadius:80,markerSymbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",style:"esriSLSSolid"}}},_initialized:!1,_map:null,_eventHandles:null,_clusterRadius:null,
_renderer:null,_statisticInfos:null,_fields:null,_infoTemplate:null,_clusterGenerator:null,_singleGraphics:null,constructor:function(F){this._eventHandles=[];this.layer=F.layer;this.setAggregationInfo(F.aggregationInfo)},initialize:function(F){this._initialized=!0;this._map=F;this._removeFromPopup(this.layer);this.container=this._createContainer();this._clusterGenerator=this._createClusterGenerator();this._initClusterGenerator();this._createLayerEventListeners();this._createMapEventListeners();this._createPopupEventListeners()},
destroy:function(F){this._clearSingleGraphics();this._removeClusterBoundary();this._destroyEventListeners();this._removeFromPopup(this.container);this._removeFromPopup(this.layer);this._resetClusterNav();this._destroyClusterGenerator(F);this._destroyContainer();this.layer=this.aggregationInfo=this._map=null},setAggregationInfo:function(F){this.aggregationInfo=F?B.mixin({},F):null;this._applyAggregationInfo()},getClusterRenderer:function(){return this._renderer},getClusterFields:function(){return this._fields||
[]},getFeaturesInCluster:function(F){F=F&&F.getAggregationInfo();return this._clusterGenerator?this._clusterGenerator.getFeaturesInCluster(F):[]},getAggregateGraphics:function(){return this.container?this.container.graphics.slice(0):[]},getSingleGraphics:function(){return this._singleGraphics?this._singleGraphics.slice(0):[]},redraw:function(){this.container&&this.container.redraw()},isClusteringEnabled:function(){return!(!this._clusterGenerator||!this._clusterGenerator.clustersEnabled)},isClusteringActive:function(){return!!(this._clusterGenerator&&
0<this._clusterGenerator.getNumFeatures())},toggleFeatureVisibility:function(F){this._clusterGenerator&&this._clusterGenerator.toggleFeatureVisibility(F)},_createContainer:function(){var F=this.layer,u=new c._GraphicsLayer({_child:!0,id:F.id+"_clusters",visible:F.visible,minScale:F.minScale,maxScale:F.maxScale,infoTemplate:this._infoTemplate});u.fields=this._fields;u.setRenderer(this._renderer);u.loaded=!0;u.onLoad(u);u._setMap(this._map,F._div);return F._childLayer=u},_destroyContainer:function(){var F=
this.container;F&&(F.clear(),F._unsetMap(this._map,this.layer._div),this.layer._childLayer=null);this.container=null},_createClusterGenerator:function(){return new k({map:this._map,layer:this.layer,clusterRadius:this._clusterRadius,statisticInfos:this._statisticInfos})},_initClusterGenerator:function(){var F=this._clusterGenerator;F.loaded?this._awaitClusterGenerator():this._eventHandles.push(F.on("load",B.hitch(this,function(){this._awaitClusterGenerator()})),F.on("load-error",B.hitch(this,function(u){console.log(u.error)})))},
_destroyClusterGenerator:function(F){this._clusterGenerator&&this._clusterGenerator.destroy(F);this._clusterGenerator=null},_awaitClusterGenerator:function(){var F=this._clusterGenerator;F.started?(this._applyRenderer(),this._initClusterUpdates()):this._eventHandles.push(F.on("start",B.hitch(this,function(){this._applyRenderer();this._initClusterUpdates()})))},_applyAggregationInfo:function(){this._applyClusterRadius();this._applyRenderer();this._clusterGenerator&&!this._clusterGenerator.isUpdateScheduled()&&
this.redraw()},_applyClusterRadius:function(){var F=this.aggregationInfo;this._clusterRadius=F&&F.clusterRadius||this.defaults.clusterRadius;this._clusterGenerator&&this._clusterGenerator.setClusterRadius(this._clusterRadius);this._computeClusterRadius()},_computeClusterRadius:function(){var F=this.aggregationInfo||{};F.clusterRadius=this._clusterRadius;this.aggregationInfo=F},_applyRenderer:function(){var F=this.container,u=this._getClusterRendererInfo(),D=this._compareStatInfos(this._statisticInfos,
u.statisticInfos);D&&(this._statisticInfos=u.statisticInfos,this._clusterGenerator&&(this._clusterGenerator.setStatisticInfos(A.map(this._statisticInfos,function(z){return{attributeInfo:z.attributeInfo,statisticType:z.statisticType}})),F&&A.forEach(F.graphics,function(z){this._applyClusterAttributes(z,z.getAggregationInfo())},this)));this._renderer=u.renderer;this._applyFields();this._applyInfoTemplate(!!D&&this._initialized);F&&(F.setRenderer(this._renderer),this.emit("renderer-change"))},_applyFields:function(){this._fields=
this._getFields(this._statisticInfos);this.container&&(this.container.fields=this._fields)},_applyInfoTemplate:function(F){var u=this.aggregationInfo,D=u&&u.disablePopup;this.layer.infoTemplate&&!D?(u=u&&u.infoTemplate||this._infoTemplate,F=F||!u?this._createInfoTemplate():this._updateInfoTemplate(u)):F=null;this._infoTemplate=F;this.container&&this.container.setInfoTemplate(this._infoTemplate);this._computeInfoTemplate()},_computeInfoTemplate:function(){var F=this.aggregationInfo||{};F.infoTemplate=
this._infoTemplate;this.aggregationInfo=F},_getClusterRendererInfo:function(){var F=this.layer&&this.layer.renderer;return F?this._createClusterRenderer(F):this._getDefaultClusterRenderer()},_getDefaultClusterRenderer:function(){var F=this._createContinuousCountRenderer();this._addSizeByCountVariable(F);return{renderer:F,statisticInfos:[]}},_createContinuousCountRenderer:function(F){var u=new n(null,"cluster_count");u.addBreak({minValue:-E,maxValue:E,symbol:F?new F.constructor(F.toJson()):new m(B.clone(this.defaults.markerSymbol))});
return u},_createClusterRenderer:function(F){if(!this._isSupportedRenderer(F))return this._getDefaultClusterRenderer();var u=[];if(this._isSimpleRenderer(F))var D=this._createContinuousCountRenderer(F.symbol);else{D=new F.constructor(F.toJson());var z=this._getRendererAttributeInfo(F);if(this._isCBRenderer(D)){var M=t.getClusterField(z,"avg");u.push(this._getStatInfo(z,"avg"));D.normalizationType=null;D.normalizationField=null;D.normalizationTotal=null}else this._isUVRenderer(D)&&(M=t.getClusterField(z,
"type"),u.push(this._getStatInfo(z,"type")));D.attributeField=M;D.setValueExpression(null);D.valueExpressionTitle=null;D.setVisualVariables(null);this._setRendererTitle(D,F)}F=this._getSupportedVariables(F);z=this._createClusterVariables(F.allVars,u);D.setVisualVariables(z);F.sizeVars.length||this._isCBSizeRenderer(D)||this._addSizeByCountVariable(D);return{renderer:D,statisticInfos:u}},_isSupportedRenderer:function(F){if(this._isSimpleRenderer(F))return!0;if(this._isCBRenderer(F)){var u=F.normalizationType;
return"function"===typeof F.attributeField||u&&"field"!==u?!1:!0}return this._isUVRenderer(F)?"function"===typeof F.attributeField||F.attributeField2?!1:!0:!1},_isSimpleRenderer:function(F){return-1<F.declaredClass.toLowerCase().indexOf("simplerenderer")},_isCBRenderer:function(F){return-1<F.declaredClass.toLowerCase().indexOf("classbreaksrenderer")},_isUVRenderer:function(F){return-1<F.declaredClass.toLowerCase().indexOf("uniquevaluerenderer")},_isCBSizeRenderer:function(F){var u=F.infos;if(!this._isCBRenderer(F)||
!u||2>u.length)return!1;var D=Infinity,z=-Infinity;A.forEach(u,function(M){if(M=M.symbol){var H=0;switch(M.type){case "simplemarkersymbol":H=M.size;break;case "picturemarkersymbol":H=(M.width+M.height)/2}D=Math.min(D,H);z=Math.max(z,H)}});return Infinity!==D&&-Infinity!==z&&D!==z},_getRendererAttributeInfo:function(F){var u=F.attributeField,D=u?this.layer.getField(u):null;return{field:u,attributeType:D&&"esriFieldTypeDate"===D.type?"date":null,rotationType:null,valueExpression:F.valueExpression,valueExpressionTitle:F.valueExpressionTitle,
normalizationField:F.normalizationField}},_setRendererTitle:function(F,u){F.legendOptions=B.clone(u.legendOptions);F.legendOptions&&F.legendOptions.title||(F.legendOptions=F.legendOptions||{},F.legendOptions.title=f.getRendererTitle(u,this.layer))},_getSupportedVariables:function(F){var u=F.getVisualVariablesForType("colorInfo",!1)||[],D=F.getVisualVariablesForType("sizeInfo",!1)||[],z=F.getVisualVariablesForType("opacityInfo",!1)||[];F=F.getVisualVariablesForType("rotationInfo",!1)||[];u=A.filter(u,
this._variableFilter);D=A.filter(D,this._variableFilter);z=A.filter(z,this._variableFilter);F=A.filter(F,this._variableFilter);return{sizeVars:D,allVars:u.concat(D).concat(z).concat(F)}},_variableFilter:function(F){return"function"!==typeof F.field&&!d.viewScaleRE.test(F.valueExpression)},_createClusterVariables:function(F,u){return A.map(F,function(D){return this._createVarForAvg(D,u)},this)},_createVarForAvg:function(F,u){var D=B.clone(F),z=this._getVariableAttributeInfo(F);D.field=t.getClusterField(z,
"avg");D.normalizationField=null;D.valueExpression=null;D.valueExpressionTitle=null;z=this._getStatInfo(z,"avg");this._addStatInfo(u,z);this._setVariableTitle(D,F);return D},_getVariableAttributeInfo:function(F){var u="rotationInfo"===F.type,D=u?"angle":null;u=u?F.rotationType:null;var z=F.legendOptions&&F.legendOptions.title,M=F.field,H=M?this.layer.getField(M):null;H&&"esriFieldTypeDate"===H.type&&(D="date");return{field:M,attributeType:D,rotationType:u,valueExpression:F.valueExpression,valueExpressionTitle:F.valueExpressionTitle||
F.valueExpression&&z,normalizationField:F.normalizationField}},_setVariableTitle:function(F,u){F.legendOptions&&F.legendOptions.title||(F.legendOptions=F.legendOptions||{},F.legendOptions.title=f.getVisualVariableTitle(u,this.layer))},_getStatInfo:function(F,u){return{statisticHash:t.getStatisticHash(F,u),attributeInfo:F,statisticType:u}},_addStatInfo:function(F,u){var D=this._findStatInfo(F,u);D?D.attributeInfo.valueExpressionTitle||(D.attributeInfo.valueExpressionTitle=u.attributeInfo.valueExpressionTitle):
F.push(u)},_findStatInfo:function(F,u){var D;A.some(F,function(z){z.statisticHash===u.statisticHash&&(D=z);return!!D});return D},_compareStatInfos:function(F,u){var D=A.filter(F,function(M){return!this._findStatInfo(u,M)},this),z=A.filter(u,function(M){return!this._findStatInfo(F,M)},this);return z.length||D.length?{added:z,removed:D}:null},_addSizeByCountVariable:function(F){var u=this._createSizeByCountVariable();u&&this._addVariable(F,u)},_getSizeByCountVariable:function(F){F=F.getVisualVariablesForType("sizeInfo",
!1)||[];return A.filter(F,function(u){return"cluster_count"===u.field})[0]},_updateSizeByCountVariable:function(){var F=this._renderer,u=this._getSizeByCountVariable(F);if(u){var D=this._createSizeByCountVariable();D&&this._replaceVariable(F,u,D)}},_createSizeByCountVariable:function(){var F=this._clusterGenerator;if(F){var u=F.getCurrentLodStats();if(u){var D=F.getNumFeatures();F=F.clusters;var z=u.min,M=u.max;1===u.count&&z===D||1===F.length&&F[0].count===D?(z=1,M=D):z&&z===M&&(M=2*z);D={type:"sizeInfo",
field:"cluster_count",valueUnit:"unknown",minSize:12,maxSize:50,minDataValue:z,maxDataValue:M,legendOptions:{title:r}}}}return D},_addVariable:function(F,u){var D=F.visualVariables||[];D.push(u);F.setVisualVariables(D)},_replaceVariable:function(F,u,D){var z=F.visualVariables;u=A.indexOf(z,u);-1<u&&z.splice(u,1);z.push(D);F.setVisualVariables(z)},_getFields:function(F){var u=[new g({name:"cluster_count",type:"esriFieldTypeInteger"})];A.forEach(F,function(D){var z=D.statisticType;D=D.attributeInfo;
var M;"avg"===z?M="date"===D.attributeType?"esriFieldTypeDate":"esriFieldTypeDouble":"type"===z&&(M=D.field?this.layer.getField(D.field).type:"esriFieldTypeString");u.push(new g({name:t.getClusterField(D,z),type:M}))},this);return u},_createInfoTemplate:function(){var F=this._statisticInfos,u=this._renderer,D=[{fieldName:"cluster_count",label:r,visible:!0,format:{digitSeparator:!0,places:0}}],z=[],M=[e.substitute({count:"{cluster_count}"},K.countSummary)],H=this._isUVRenderer(u)?u.infos:[];A.forEach(F,
function(x){var J=x.statisticType,L=x.attributeInfo,N=t.getClusterField(L,J),P=this._getFieldLabel(x);if("avg"===J){var T={fieldName:N,label:P,visible:!0,format:"date"===L.attributeType?{dateFormat:"shortDateShortTime"}:{digitSeparator:!0,places:1}};var S=this._getFieldSummary(x,N)}else"type"===J&&(S="expression/"+N,T={fieldName:S,visible:!0},z.push({name:N,title:P,returnType:"string",expression:this._getExpression(H,N)}),S=this._getFieldSummary(x,S));T&&D.push(T);S&&M.push(S)},this);return this._createPopupTemplate({fieldInfos:D,
expressionInfos:z,description:M.join("\x3cbr/\x3e\x3cbr/\x3e")})},_updateInfoTemplate:function(F){var u=F.toJson(),D=this._isUVRenderer(this._renderer)?this._renderer.infos:[];A.forEach(this._statisticInfos,function(z){var M=z.statisticType;z=t.getClusterField(z.attributeInfo,M);"type"===M&&(M=this._findExpressionInfo(z,u))&&(M.expression=this._getExpression(D,z))},this);return this._createPopupTemplate(u)},_createPopupTemplate:function(F){var u=new a(F),D=u.title;u.setTitle(B.hitch(this,function(z){var M=
this._map&&this._map.infoWindow;if("esri.dijit.PopupMobile"!==(M&&M.declaredClass)||u.info.title)return D.call(u,z);z=(z=z.attributes)&&z.cluster_count;return null==z?"":e.substitute({count:z},K.countTitle)}));return u},_findExpressionInfo:function(F,u){var D;A.some(u.expressionInfos,function(z){z.name===F&&(D=z);return!!D});return D},_escapeDoubleQuotes:function(F){return F?F.replace(/"/g,'\\"'):""},_getExpression:function(F,u){return["var uvInfos \x3d ["+this._getObjects(F).join(", ")+"];",'var predominantType \x3d Text($feature["'+
u+'"]);','var label \x3d "'+this._escapeDoubleQuotes(K.predominantNoneValue)+'";',"for (var i \x3d 0; i \x3c Count(uvInfos); i++) {\nif (uvInfos[i].value \x3d\x3d predominantType) {\nlabel \x3d uvInfos[i].label;\nbreak;\n}\n}\nreturn label;"].join("\n")},_getObjects:function(F){return A.map(F,function(u){return'{"value": "'+String(u.value)+'","label": "'+this._escapeDoubleQuotes(String(u.label))+'"}'},this)},_getFieldLabel:function(F){var u=F.statisticType,D=F.attributeInfo,z=D.field;F=D.normalizationField;
var M="";if("avg"===u)var H=F?K.avgNormFieldLabel:K.avgFieldLabel;else"type"===u&&(H=K.predominantFieldLabel);H&&(u=D.valueExpression?D.valueExpressionTitle:this.layer.getFieldLabel(z),F=F&&this.layer.getFieldLabel(F),M=e.substitute({fieldLabel:u||"",normFieldLabel:F||""},H));return M},_getFieldSummary:function(F,u){var D=F.statisticType,z=F.attributeInfo,M=z.field;F=z.normalizationField;var H="";if("avg"===D)var x=F?K.avgNormFieldSummary:K.avgFieldSummary;else"type"===D&&(x=K.predominantFieldSummary);
x&&(D=z.valueExpression?z.valueExpressionTitle:this.layer.getFieldLabel(M),F=F&&this.layer.getFieldLabel(F),H=e.substitute({fieldLabel:D||"",normFieldLabel:F||"",fieldValue:"{"+u+"}"},x));return H},_removeFromPopup:function(F){var u=this._map.infoWindow,D=u.features;if(D&&D.length){var z=A.filter(D,function(M){return M.getLayer()!==F});z.length<D.length&&(z.length?u.setFeatures(z):(u.clearFeatures(),u.hide()))}},_resetClusterNav:function(){this._resetClusterNavPartial();this._popupClusterGraphic=
null},_resetClusterNavPartial:function(){this._map.infoWindow.removeActions&&this._map.infoWindow.removeActions(this._popupActions);this._hideSingleGraphic(this._popupSingleGraphic);this._popupSingleGraphic=null},_addClusterBoundary:function(F,u){(u=u.clusterFillSymbol)&&(u=new u.constructor(u.toJson()));F=new p(F,u);this._map.graphics.add(F);this._clusterBoundary=F},_removeClusterBoundary:function(){this._map.graphics.remove(this._clusterBoundary);this._clusterBoundary=null},_createBrowseFeaturesAction:function(){return this._map.infoWindow.addActions([{title:C.NLS_browseFeatures,
className:"browseFeatures",callback:B.hitch(this,function(F){F.preventDefault();F=this._map.infoWindow;var u=F.getSelectedFeature(),D=u.getChildGraphics(),z=F.getCurrentAnchor();F.setFeatures(D,{anchor:z});if(D=b.graphicsExtent(D))this._addClusterBoundary(D,F),F.show(this._getPopupLocation(D,z));this._popupClusterGraphic=u})}])[0]},_getPopupLocation:function(F,u){var D=F.getCenter();u=u.toLowerCase();-1<u.indexOf("top")?D.update(D.x,F.ymax):-1<u.indexOf("bottom")?D.update(D.x,F.ymin):-1<u.indexOf("left")?
D.update(F.xmin,D.y):D.update(F.xmax,D.y);return D},_createViewSummaryAction:function(){return this._map.infoWindow.addActions([{title:C.NLS_viewSummary,className:"viewSummary",callback:B.hitch(this,function(F){F.preventDefault();F=this._popupClusterGraphic;var u=this._map.infoWindow;u.setFeatures([F]);u.show(F.geometry);this._popupClusterGraphic=null})}])[0]},_initClusterUpdates:function(){this._updateSizeVariable();this._updateClusterGraphics();this._eventHandles.push(this._clusterGenerator.on("update-end",
B.hitch(this,function(F){(F.mapLevelChange||F.indexChange)&&this._updateSizeVariable();this._updateClusterGraphics()})),this._clusterGenerator.on("index-complete",B.hitch(this,function(){this._updateSizeVariable()})))},_updateClusterGraphics:function(){this._hideSingleGraphics();var F=[],u=[];A.forEach(this._clusterGenerator.clusters,function(D){var z=new p(D.centroid);z.setAggregationSourceLayer(this.layer);z.setAggregationInfo(D);this._applyClusterAttributes(z,D);1===D.count?(D=this._getSingleGraphic(z),
u.push(D)):F.push(z)},this);this._showSingleGraphics(u);this._addGraphics(F)},_addGraphics:function(F){var u=this.container;u.clear();A.forEach(F,function(D){u.add(D)})},_getSingleGraphic:function(F){var u=this._clusterGenerator.getCell(F.getAggregationInfo().primary).features[0],D=this.layer.renderer;D=D&&D.getSymbol(u);var z=this._getSizeByCountVariable(this._renderer);D&&z&&(F=z?this._renderer.getSize(F,{sizeInfo:z,shape:D.style,resolution:this._map.getResolutionInMeters(),scale:this._map.getScale()}):
null,u.setSize(F));return u},_showSingleGraphics:function(F){A.forEach(F,this._showSingleGraphic);this._singleGraphics=F},_hideSingleGraphics:function(){A.forEach(this._singleGraphics,function(F){F.setSize(null);this._hideSingleGraphic(F)},this);this._singleGraphics=null},_clearSingleGraphics:function(){A.forEach(this._singleGraphics,function(F){F.setSize(null)});this._singleGraphics=null},_showSingleGraphic:function(F){F&&F._resume()},_hideSingleGraphic:function(F){F&&F._suspend()},_updateSizeVariable:function(){this.isClusteringEnabled()&&
(this._updateSizeByCountVariable(),this.emit("renderer-change"))},_applyClusterAttributes:function(F,u){F.setAttributes(u.attributes)},_createLayerEventListeners:function(){var F=this.layer;this._eventHandles.push(F.on("visibility-change",B.hitch(this,function(u){this.container.setVisibility(u.visible)})),F.on("scale-range-change",B.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)})),F.on("renderer-change",B.hitch(this,function(){this._applyRenderer()})),
F.on("info-template-change",B.hitch(this,function(){this._applyInfoTemplate()})))},_createMapEventListeners:function(){this._eventHandles.push(this._map.on("zoom-start",B.hitch(this,function(){this._removeClusterBoundary();this._removeFromPopup(this.container);this._removeFromPopup(this.layer);this._resetClusterNav();this.container.clear();this._hideSingleGraphics()})))},_createPopupEventListeners:function(){var F=this._map.infoWindow;this._eventHandles.push(F.on("selection-change",B.hitch(this,function(){this._resetClusterNavPartial();
var u=this._map.infoWindow.getSelectedFeature(),D=u&&u.getLayer();if(D){var z;D===this.container?(this._removeClusterBoundary(),this._map.infoWindow.addActions&&(z=this._createBrowseFeaturesAction())):D===this.layer&&u._isSuspended()?(this._map.infoWindow.addActions&&(z=this._createViewSummaryAction()),this._popupSingleGraphic=u,this._showSingleGraphic(this._popupSingleGraphic)):this._removeClusterBoundary();this._popupActions=z?[z]:null}})),F.on("clear-features",B.hitch(this,function(u){this._resetClusterNav();
u.isIntermediate||this._removeClusterBoundary()})),F.on("hide",B.hitch(this,function(){this._popupSingleGraphic&&this._popupSingleGraphic._suspend();this._clusterBoundary&&this._clusterBoundary.hide()})),F.on("show",B.hitch(this,function(){this._popupSingleGraphic&&this._popupSingleGraphic._resume();this._clusterBoundary&&this._clusterBoundary.show()})))},_destroyEventListeners:function(){A.forEach(this._eventHandles,function(F){F.remove()})}});w("extend-esri")&&B.setObject("layers.clustering.ClusterManager",
G,q);return G})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(G,B,A,w,q,h,p,e){G=G([h,p],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(l,b){B.mixin(this,b);this.initialize(l,b)},getTitle:function(l){var b;this.info&&(b=this.titleHasRelatedFields||this.titleHasAsyncExpressions?"":this._getPopupValues(l,
this._fetchAttributes(l,null,this.getExpressionFieldsInTitle()),!0).title);return b||""},getContent:function(l){return this.info?(new e({template:this,graphic:l,chartTheme:this.chartTheme},w.create("div"))).domNode:""}});A("extend-esri")&&B.setObject("dijit.PopupTemplate",G,q);return G})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./promiseList ./ArcadeExpression ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./arcadeProfiles/popupProfile ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k,t,y,K,C){G=G(null,{declaredClass:"esri.PopupInfo",_reNewline:/(\n)/ig,_reExprField:/^\s*expression\//i,_reExprFieldPattern:/\{expression\/([^\}]+)\}/ig,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",_aggregatedFeaturesVariable:"$aggregatedfeatures",initialize:function(r,E){if(r){B.mixin(this,E);this.info=r;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var F=this._fieldLabels=
{},u=this._fieldsMap={};this.info.fieldInfos&&A.forEach(this.info.fieldInfos,function(D){var z=D.fieldName.toLowerCase(),M=this._isExpressionField(z)?this.getExpressionInfo(z):null;F[z]=M?M.title:D.label;u[z]=D},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix));this.titleHasAsyncExpressions=this._titleHasAsyncExpressions();this.contentHasAsyncExpressions=this._contentHasAyncExpressions()}},toJson:function(){return w.fromJson(w.toJson(this.info))},
getTitle:function(){},getContent:function(){},getFieldInfo:function(r){var E;A.some(this.info&&this.info.fieldInfos,function(F){F.fieldName===r&&(E=F);return!!E});return E},getExpressionInfo:function(r){if(r=this._getExprField(r)){r=r.toLowerCase();var E;A.some(this.info.expressionInfos,function(F){F.name.toLowerCase()===r&&(E=F);return!!E});return E}},getExpressionFieldsInTitle:function(){return this._getExprFieldsFromTemplatedString(this.info.title)},getExpressionFieldsInContent:function(){var r=
this._collectExprFieldsFromTemplatedString(this.info.description,[]);this.info.description||A.forEach(this.info.fieldInfos,function(E){E.visible&&this._collectExprField(E.fieldName,r)},this);A.forEach(this.info.mediaInfos,function(E){this._collectExprFieldsFromTemplatedString(E.title,r);this._collectExprFieldsFromTemplatedString(E.caption,r);if(E=E.value)this._collectExprFieldsFromTemplatedString(E.linkURL,r),this._collectExprFieldsFromTemplatedString(E.sourceURL,r),A.forEach(E.fields,function(F){this._collectExprField(F,
r)},this),this._collectExprField(E.normalizeField,r),this._collectExprField(E.tooltipField,r)},this);return r},getRequiredExpressionFields:function(){return this.getExpressionFieldsInTitle().concat(this.getExpressionFieldsInContent())},hasGeometryOperations:function(){return A.some(this._getArcadeExpressions(),function(r){return r.hasGeometryOperations()})},hasAsyncExpressions:function(){return A.some(this._getArcadeExpressions(),function(r){return r.async})},initializeArcadeEngine:function(){return y.initialize(this._getArcadeExpressions())},
getComponents:function(r,E){var F=this.info,u={initArcadeEngine:this.initializeArcadeEngine()};F.fieldInfos&&(F=A.filter(F.fieldInfos,function(D){return-1!==D.fieldName.indexOf(this._relatedFieldPrefix)},this))&&0<F.length&&(u.relatedInfo=this._getRelatedRecords({graphic:r,fieldsInfo:F}));this._needFullResolutionFeature(r)&&(u.fullResolutionFeature=this._getFullResolutionFeature(r));this._needAggregatedFeaturesLayer(r)&&(u.aggregatedFeaturesLayer=this._getAggregatedFeaturesLayer(r));return m(u).then(B.hitch(this,
function(D){var z=D.fullResolutionFeature,M=E&&E.evaluateAllExpressions,H=M?null:this.getRequiredExpressionFields();D=(M?this.hasAsyncExpressions():this._hasAsyncExpressions(H))?this._fetchAttributesAsync(r,z,H,D.aggregatedFeaturesLayer):this._fetchAttributes(r,z,H);return m([D]).then(B.hitch(this,function(x){return this._getPopupValues(r,x[0])}))}))},getAttachments:function(r){var E=r.getSourceLayer();r=r.attributes;if(this.info.showAttachments&&E&&E.hasAttachments&&E.objectIdField&&(r=r&&r[E.objectIdField]))return E.queryAttachmentInfos(r)},
_needAggregatedFeaturesLayer:function(r){return r.isAggregate()?A.some(this._getArcadeExpressions(),function(E){return E.hasVariable(this._aggregatedFeaturesVariable)},this):!1},_getAggregatedFeaturesLayer:function(r){return r.getAggregationSourceLayer().getFeatureCollectionLayer(r.getChildGraphics()).always(function(E){return E instanceof Error?null:E})},_needFullResolutionFeature:function(r){return(r=r.getSourceLayer())?"function"===typeof r.getMaxAllowableOffset&&0<r.getMaxAllowableOffset()&&this.hasGeometryOperations():
!1},_getFullResolutionFeature:function(r){var E=r.getSourceLayer(),F=E.objectIdField;r=(r=r.attributes)&&F&&r[F];if(null==r)return null;var u=new c;u.where=F+"\x3d"+r;u.maxAllowableOffset=0;u.outFields=[F];E._enableCacheHint(u);return E.queryFeatures(u).then(function(D){return D.features&&D.features[0]})},_isExpressionField:function(r){return this._reExprField.test(r)},_getExprField:function(r){return this._isExpressionField(r)?r.replace(this._reExprField,""):null},_collectExprField:function(r,E){(r=
this._getExprField(r))&&E.push(r);return E},_collectExprFieldsFromTemplatedString:function(r,E){r=this._getExprFieldsFromTemplatedString(r);r.length&&Array.prototype.push.apply(E,r);return E},_getExprFieldsFromTemplatedString:function(r){r=r?r.match(this._reExprFieldPattern):null;return A.map(r,function(E){return E.replace(this._reExprFieldPattern,"$1")},this)},_titleHasAsyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInTitle())},_contentHasAyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInContent())},
_hasAsyncExpressions:function(r){return A.some(r,function(E){E=this._exprCache[E];return!(!E||!E.async)},this)},_compileExpressions:function(r){var E={};A.forEach(r,function(F){var u=F.returnType&&F.returnType.toLowerCase();E[F.name]=new d({expression:F.expression,returnType:"number"===u?"number":"string",profile:y})});return E},_getArcadeExpressions:function(){var r=[],E;for(E in this._exprCache)r.push(this._exprCache[E]);return r},_fetchAttributesAsync:function(r,E,F,u){var D=this._fetchAttributes(r,
E,F,u);r={};for(var z in D)(E=D[z])&&E.then&&(r[z]=E);return m(r).then(B.hitch(this,function(M){for(var H in M){var x=M[H];D[H]=x instanceof Error?null:this._processArcadeResult(x)}return D}))},_processArcadeResult:function(r){"string"===typeof r&&(r=b.encode(r));return r},_fetchAttributes:function(r,E,F,u){var D=B.clone(r.attributes)||{},z=E&&E.geometry,M=this._exprPrefix,H=this._exprCache;F=F||A.map(this.info.expressionInfos,function(x){return x.name});A.forEach(F,function(x){var J=M+x;x=(x=H[x])?
r.evaluateExpression(x,this._getEvalOptions(x,r,z,u)):null;D[J]=this._processArcadeResult(x)},this);return D},_getEvalOptions:function(r,E,F,u){var D=r.hasGeometryOperations(),z=E.getSourceLayer(),M=z&&(z.getMap()||z.parentLayer&&z.parentLayer.getMap());u&&(u._map=M);r=y.getEvalOptions({expression:r,feature:E,layer:z,aggregatedFeaturesLayer:u,map:M,spatialReference:M&&M.spatialReference});E=r.context.vars.$feature;D=!(!D||!F);E&&D&&(E._geometry=F);r.skipCache=D;return r},_getPopupValues:function(r,
E,F){E=E||this._fetchAttributes(r);var u=this.info,D=r.getSourceLayer(),z=B.clone(E),M="",H="",x,J,L=D&&D._getDateOpts&&D._getDateOpts().properties;L=L&&L.slice(0);var N={dateFormat:{properties:L,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)},format:null};if(this._relatedInfo)for(S in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(S)){var P=this._relatedInfo[S],T=this._relatedLayersInfo[S];P&&(A.forEach(P.relatedFeatures,function(aa){for(J in aa.attributes)if(aa.attributes.hasOwnProperty(J)&&
"esriRelCardinalityOneToOne"===T.relation.cardinality){var R=this._toRelatedFieldName([T.relation.id,J]);E[R]=z[R]=aa.attributes[J]}},this),A.forEach(P.relatedStatsFeatures,function(aa){for(J in aa.attributes)if(aa.attributes.hasOwnProperty(J)){var R=this._toRelatedFieldName([T.relation.id,J]);E[R]=z[R]=aa.attributes[J]}},this))}for(x in z){var S=this._fieldsMap[x.toLowerCase()];P=this._getLayerFieldInfo(D,x);S&&P&&(S.fieldName=P.name);z[x]=this._formatValue(z[x],x,N);L&&S&&S.format&&S.format.dateFormat&&
(S=A.indexOf(L,x),-1<S&&L.splice(S,1))}if(D)for(x in L=D.typeIdField,E)if(E.hasOwnProperty(x)&&-1===x.indexOf(this._relatedFieldPrefix)){var Z=E[x];a.isDefined(Z)&&(S=this._getDomainName(D,r,x,Z),a.isDefined(S)?z[x]=S:x===L&&(S=this._getTypeName(D,r,Z),a.isDefined(S)&&(z[x]=S)))}u.title&&(M=this._processFieldsInLinks(this._fixTokens(u.title,D),E),M=B.trim(this._removeEmptyHref(a.substitute(z,M,N)||"")));if(F)return{title:M};u.description&&(H=this._processFieldsInLinks(this._fixTokens(u.description,
D),E),H=B.trim(this._removeEmptyHref(a.substitute(z,H,N)||"")));if(u.fieldInfos){var da=[];A.forEach(u.fieldInfos,function(aa){(x=aa.fieldName)&&aa.visible&&da.push([this._fieldLabels[x.toLowerCase()]||x,a.substitute(z,"${"+x+"}",N)||""])},this)}var Q;if(u.mediaInfos){var W=[];A.forEach(u.mediaInfos,function(aa){Q=0;Z=aa.value;switch(aa.type){case "image":var R=Z.sourceURL;R=R&&B.trim(this._removeEmptyHref(a.substitute(E,this._fixTokens(R,D))));Q=!!R;break;case "piechart":case "linechart":case "columnchart":case "barchart":R=
Z.normalizeField;Z.fields=A.map(Z.fields,function(va){return(V=this._getLayerFieldInfo(D,va))?V.name:va},this);if(R){var V=this._getLayerFieldInfo(D,R);Z.normalizeField=V?V.name:R}Q=A.some(Z.fields,function(va){return a.isDefined(E[va])||-1!==va.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(Q){aa=B.clone(aa);Z=aa.value;R=aa.title?this._processFieldsInLinks(this._fixTokens(aa.title,D),E):"";var ba=aa.caption?this._processFieldsInLinks(this._fixTokens(aa.caption,
D),E):"";aa.title=R?B.trim(this._removeEmptyHref(a.substitute(z,R,N)||"")):"";aa.caption=ba?B.trim(this._removeEmptyHref(a.substitute(z,ba,N)||"")):"";if("image"===aa.type)Z.sourceURL=a.substitute(E,this._fixTokens(Z.sourceURL,D)),Z.linkURL&&(Z.linkURL=B.trim(a.substitute(E,this._fixTokens(Z.linkURL,D))||""));else{var ha,qa;A.forEach(Z.fields,function(va,sa){if(-1!==va.indexOf(this._relatedFieldPrefix))qa=this._getRelatedChartInfos(va,Z,E,N),qa instanceof Array?Z.fields=qa:Z.fields[sa]=qa;else{var Ba=
E[va];Ba=void 0===Ba?null:Ba;ha=E[Z.normalizeField]||0;Ba&&ha&&(Ba/=ha);Z.fields[sa]={y:Ba,tooltip:(this._fieldLabels[va.toLowerCase()]||va)+":\x3cbr/\x3e"+this._formatValue(Ba,va,N,!!ha)}}},this)}W.push(aa)}},this)}return{title:M,description:H,hasDescription:!!u.description,fields:da&&da.length?da:null,mediaInfos:W&&W.length?W:null,formatted:z,editSummary:!1!==u.showLastEditInfo&&D&&D.getEditSummary?D.getEditSummary(r):""}},_getRelatedChartInfos:function(r,E,F,u){var D,z;var M=[];var H=this._fromRelatedFieldName(r);
var x=H[0];var J=this._relatedInfo[x];x=this._relatedLayersInfo[x];J&&A.forEach(J.relatedFeatures,function(L){L=L.attributes;var N;for(N in L)if(L.hasOwnProperty(N)&&N===H[1]){var P={};z=L[N];E.normalizeField&&(D=-1!==E.normalizeField.indexOf(this._relatedFieldPrefix)?L[this._fromRelatedFieldName(E.normalizeField)[1]]:F[E.normalizeField]);z&&D&&(z/=D);if(E.tooltipField)if(-1!==E.tooltipField.indexOf(this._relatedFieldPrefix)){var T=this._fromRelatedFieldName(E.tooltipField)[1],S=a.isDefined(L[T])?
this._formatValue(L[T],E.tooltipField,u,!!D):T;P.tooltip=S+":\x3cbr/\x3e"+this._formatValue(z,T,u,!!D)}else P.tooltip=(this._fieldLabels[r.toLowerCase()]||r)+":\x3cbr/\x3e"+this._formatValue(z,E.tooltipField,u,!!D);else P.tooltip=z;P.y=z;M.push(P)}},this);return"esriRelCardinalityOneToMany"===x.relation.cardinality||"esriRelCardinalityManyToMany"===x.relation.cardinality?M:M[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",
shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",
shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",longMonthDayYearShortTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longMonthDayYearShortTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longMonthDayYearLongTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",
longMonthDayYearLongTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",dayShortMonthYearShortTime:"(datePattern: 'd MMM y', timePattern: 'h:mm a', selector: 'date and time')",dayShortMonthYearShortTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm', selector: 'date and time')",dayShortMonthYearLongTime:"(datePattern: 'd MMM y', timePattern: 'h:mm:ss a', selector: 'date and time')",dayShortMonthYearLongTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm:ss', selector: 'date and time')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",longDateShortTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longDateShortTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longDateLongTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",longDateLongTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",
shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_dateFormatsJson:{shortDate:{datePattern:"M/d/y",selector:"date"},shortDateShortTime:{datePattern:"M/d/y",timePattern:"h:mm a",selector:"date and time"},shortDateShortTime24:{datePattern:"M/d/y",timePattern:"H:mm",selector:"date and time"},shortDateLongTime:{datePattern:"M/d/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLongTime24:{datePattern:"M/d/y",timePattern:"H:mm:ss",selector:"date and time"},
shortDateLE:{datePattern:"d/M/y",selector:"date"},shortDateLEShortTime:{datePattern:"d/M/y",timePattern:"h:mm a",selector:"date and time"},shortDateLEShortTime24:{datePattern:"d/M/y",timePattern:"H:mm",selector:"date and time"},shortDateLELongTime:{datePattern:"d/M/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLELongTime24:{datePattern:"d/M/y",timePattern:"H:mm:ss",selector:"date and time"},longMonthDayYear:{datePattern:"MMMM d, y",selector:"date"},longMonthDayYearShortTime:{datePattern:"MMMM d, y",
timePattern:"h:mm a",selector:"date and time"},longMonthDayYearShortTime24:{datePattern:"MMMM d, y",timePattern:"H:mm",selector:"date and time"},longMonthDayYearLongTime:{datePattern:"MMMM d, y",timePattern:"h:mm:ss a",selector:"date and time"},longMonthDayYearLongTime24:{datePattern:"MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},dayShortMonthYear:{datePattern:"d MMM y",selector:"date"},dayShortMonthYearShortTime:{datePattern:"d MMM y",timePattern:"h:mm a",selector:"date and time"},dayShortMonthYearShortTime24:{datePattern:"d MMM y",
timePattern:"H:mm",selector:"date and time"},dayShortMonthYearLongTime:{datePattern:"d MMM y",timePattern:"h:mm:ss a",selector:"date and time"},dayShortMonthYearLongTime24:{datePattern:"d MMM y",timePattern:"H:mm:ss",selector:"date and time"},longDate:{datePattern:"EEEE, MMMM d, y",selector:"date"},longDateShortTime:{datePattern:"EEEE, MMMM d, y",timePattern:"h:mm a",selector:"date and time"},longDateShortTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm",selector:"date and time"},longDateLongTime:{datePattern:"EEEE, MMMM d, y",
timePattern:"h:mm:ss a",selector:"date and time"},longDateLongTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},longMonthYear:{datePattern:"MMMM y",selector:"date"},shortMonthYear:{datePattern:"MMM y",selector:"date"},year:{datePattern:"y",selector:"date"}},_reHref:/href\s*=\s*(")([^"]+)"/ig,_reHrefApos:/href\s*=\s*(')([^']+)'/ig,_fixTokens:function(r,E){var F=this;return r.replace(/(\{([^\{\r\n]+)\})/g,function(u,D,z){u=F._getLayerFieldInfo(E,z);return"$"+(u?"{"+
u.name+"}":D)})},_encodeAttributes:function(r,E){r=B.clone(r)||{};var F,u;for(F in r)(u=r[F])&&"string"===typeof u&&(u=E?u:encodeURIComponent(u),u=u.replace(/'/g,"\x26apos;"),r[F]=u);return r},_processFieldsInLinks:function(r,E){var F=this._encodeAttributes(E),u=this._encodeAttributes(E,!0);E=B.hitch(this,this._addValuesToHref,E,F,u);r&&(r=r.replace(this._reHref,E).replace(this._reHrefApos,E));return r},_addValuesToHref:function(r,E,F,u,D,z){z=z&&B.trim(z);return u=a.substitute(z&&0===z.indexOf("${")?
"'"===D?F:r:E,u)},_getLayerFieldInfo:function(r,E){return r&&r.getField?r.getField(E):null},_formatValue:function(r,E,F,u){var D=this._fieldsMap[E.toLowerCase()],z=D&&D.format;E=-1!==A.indexOf(F.dateFormat.properties,E);var M="number"===typeof r&&!E&&(!z||!z.dateFormat);if(!a.isDefined(r)||!D||!a.isDefined(z))return this._applyFormatting(r,M);D=z.hasOwnProperty("places")||z.hasOwnProperty("digitSeparator");var H=z.hasOwnProperty("digitSeparator")?z.digitSeparator:!0;if(D&&!E)var x={formatType:"NumberFormat",
places:a.isDefined(z.places)&&(!u||0<z.places)?Number(z.places):Infinity};else if(z.dateFormat)x=B.mixin({formatType:"DateFormat",utcOffset:this.utcOffset},this._dateFormatsJson[z.dateFormat]||this._dateFormatsJson.shortDateShortTime);else return this._applyFormatting(r,M);var J=this._applyFormatFunctions(r,x,F);D&&-1<r.constructor.toString().indexOf("Array")&&(J="",A.forEach(r,B.hitch(this,function(L,N){N&&(J+=" ");J+=this._applyFormatFunctions(L,x,F)})));D&&!H&&C.group&&(J=J.replace(new RegExp("\\"+
C.group,"g"),""));E&&(J='\x3cspan class\x3d"esriDateValue"\x3e'+J+"\x3c/span\x3e");return this._applyFormatting(J,M)},_applyFormatFunctions:function(r,E,F){E&&F&&(F.format={myKey:E});r=a.substitute({myKey:r},"${myKey}",F)||"";E&&F&&(F.format=null);return r},_applyFormatting:function(r,E){return E?this._forceLTR(r):this._applyPreWrap(r)},_forceLTR:function(r){var E=e("ie");return E&&10>=E?r:"\x3cspan class\x3d'esriNumericValue'\x3e"+r+"\x3c/span\x3e"},_applyPreWrap:function(r){return"string"===typeof r?
r.replace(this._reNewline,"\x3cspan class\x3d'charNewLine'\x3e$1\x3c/span\x3e"):r},_insertOffset:function(r){r&&(r=a.isDefined(this.utcOffset)?r.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):r);return r},_getDomainName:function(r,E,F,u){return(r=r.getDomain&&r.getDomain(F,{feature:E}))&&r.codedValues?r.getName(u):null},_getTypeName:function(r,E,F){return(r=r.getType&&r.getType(E))&&r.name},_getRelatedRecords:function(r){var E=r.graphic,F;this._relatedLayersInfoPromise||(this._relatedLayersInfoPromise=
this._getRelatedLayersInfo(r).then(B.hitch(this,function(u){for(F in u)u.hasOwnProperty(F)&&u[F]&&(this._relatedLayersInfo[F].relatedLayerInfo=u[F])})));return this._relatedLayersInfoPromise.then(B.hitch(this,function(){return this._queryRelatedLayers(E)})).then(B.hitch(this,function(u){this._setRelatedRecords(E,u);return u}))},_getRelatedLayersInfo:function(r){var E=r.fieldsInfo,F,u={};var D=r.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});A.forEach(E,function(z){var M;
var H=this._fromRelatedFieldName(z.fieldName);var x=H[0];H=H[1];if(x&&(!this._relatedLayersInfo[x]&&D&&D.relationships&&(A.some(D.relationships,function(L){if(L.id==x)return M=L,!0}),M&&(this._relatedLayersInfo[x]={relation:M,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[x]&&(this._relatedLayersInfo[x].relatedFields.push(H),z.statisticType))){var J=new t;J.statisticType=z.statisticType;J.onStatisticField=H;J.outStatisticFieldName=H;this._relatedLayersInfo[x].outStatistics.push(J)}},
this);for(F in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(F)&&this._relatedLayersInfo[F]&&(r=this._relatedLayersInfo[F].relation,r=D.url.replace(/[0-9]+$/,r.relatedTableId),this._relatedLayersInfo[F].relatedLayerUrl=r,u[F]=n({url:r,content:{f:"json"},callbackParamName:"callback"}));return l(u)},_queryRelatedLayers:function(r){var E={},F;for(F in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(F)&&(E[F]=this._queryRelatedLayer({graphic:r,relatedInfo:this._relatedLayersInfo[F]}));
return l(E)},_queryRelatedLayer:function(r){var E,F;var u=r.graphic;var D=u.getSourceLayer();var z=D.url.match(/[0-9]+$/g)[0];var M=r.relatedInfo;var H=M.relatedLayerInfo;var x=M.relatedLayerUrl;var J=M.relation;r=A.filter(H.relationships,function(Z){return Z.relatedTableId===parseInt(z,10)});1===r.length?E=r[0]:1<r.length&&A.some(r,function(Z){Z.id===J.id&&(E=Z);return!!E});if(E){var L=new c;A.some(H.fields,function(Z){if(Z.name===E.keyField)return F=-1!==A.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger",
"esriFieldTypeSingle","esriFieldTypeDouble"],Z.type)?"number":"string",!0});if(E.relationshipTableId&&E.keyFieldInRelationshipTable){var N=new p;this._queryRelatedRecords(u,E).then(B.hitch(this,function(Z){var da;(da=Z[u.attributes[D.objectIdField]])?(Z=A.map(da.features,function(Q){return Q.attributes[H.objectIdField]},this),M.outStatistics&&0<M.outStatistics.length&&H.supportsStatistics&&(T=new c,T.where=this._chunkWhereInClause(H.objectIdField,Z,1E3),T.outFields=L.outFields,T.outStatistics=M.outStatistics),
T&&(S=new g(x),S.execute(T).then(B.hitch(this,function(Q){var W=[];W.push(da);W.push(Q);N.resolve(W)})))):N.resolve()}))}else{var P="string"===F?E.keyField+"\x3d'"+u.attributes[J.keyField]+"'":E.keyField+"\x3d"+u.attributes[J.keyField];L.where=P;L.outFields=M.relatedFields;if(M.outStatistics&&0<M.outStatistics.length&&H.supportsStatistics){var T=new c;T.where=L.where;T.outFields=L.outFields;T.outStatistics=M.outStatistics}var S=new g(x);P=[];P.push(S.execute(L));T&&P.push(S.execute(T))}}return P?
l(P):N?N.promise:void 0},_setRelatedRecords:function(r,E){this._relatedInfo=[];for(var F in E)E.hasOwnProperty(F)&&E[F]&&(r=E[F],this._relatedInfo[F]={},this._relatedInfo[F].relatedFeatures=r[0].features,a.isDefined(r[1])&&(this._relatedInfo[F].relatedStatsFeatures=r[1].features))},_handlerErrorResponse:function(r,E){r.reject(E)},_fromRelatedFieldName:function(r){var E=[];-1!==r.indexOf(this._relatedFieldPrefix)&&(r=r.split("/"),E=r.slice(1));return E},_toRelatedFieldName:function(r){var E="";r&&
0<r.length&&(E=this._relatedFieldPrefix+r[0]+"/"+r[1]);return E},_queryRelatedRecords:function(r,E){var F=r.getSourceLayer(),u=new k;u.outFields=["*"];u.relationshipId=E.id;u.objectIds=[r.attributes[F.objectIdField]];return F.queryRelatedFeatures(u)},_removeEmptyHref:function(r){return r.replace(/href=(""|'')/gi,"")},_chunkWhereInClause:function(r,E,F){for(var u=0,D=[];u<E.length;)D.push(r+" IN ("+E.slice(u,F+u)+")"),u+=F;return D.join(" OR ")}});h("extend-esri")&&(f.PopupInfo=f.PopupInfoTemplate=
G);return G})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(G){var B=G.getObject("dojox.html.entities",!0),A=function(q,h){if(h._encCache&&h._encCache.regexp&&h._encCache.mapper&&h.length==h._encCache.length){var p=h._encCache.mapper;var e=h._encCache.regexp}else{p={};e=["["];var l;for(l=0;l<h.length;l++)p[h[l][0]]="\x26"+h[l][1]+";",e.push(h[l][0]);e.push("]");e=new RegExp(e.join(""),"g");h._encCache={mapper:p,regexp:e,length:h.length}}return q=q.replace(e,function(b){return p[b]})},
w=function(q,h){if(h._decCache&&h._decCache.regexp&&h._decCache.mapper&&h.length==h._decCache.length){var p=h._decCache.mapper;var e=h._decCache.regexp}else{p={};e=["("];var l;for(l=0;l<h.length;l++){var b="\x26"+h[l][1]+";";l&&e.push("|");p[b]=h[l][0];e.push(b)}e.push(")");e=new RegExp(e.join(""),"g");h._decCache={mapper:p,regexp:e,length:h.length}}return q=q.replace(e,function(a){return p[a]})};B.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];B.latin=[["\u00a1",
"iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],
["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],
["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],
["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a",
"Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be",
"xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191",
"uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229",
"cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663",
"clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030",
"permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];B.encode=function(q,h){q&&(h?q=A(q,h):(q=A(q,B.html),q=A(q,B.latin)));return q};B.decode=function(q,h){q&&(h?q=w(q,h):(q=w(q,B.html),q=w(q,B.latin)));return q};return B})},"esri/ArcadeExpression":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./layers/support/attributeUtils ./support/expressionUtils".split(" "),function(G,B,A,w,q,h){G=G(null,{declaredClass:"esri.ArcadeExpression",expression:null,profile:null,returnType:null,
async:null,id:null,syntaxTree:null,_traits:null,_attributeDef:null,_attributeCache:null,_compiled:!1,constructor:function(p){B.mixin(this,p);this.returnType=this.returnType||"string";this.id=q.getAttributeId(this.expression);this._setSyntaxTree(this.profile.parse(this));this.async=this.async||this.profile.isAsync(this)},hasGeometryOperations:function(){var p=this._traits.geometryOperations;void 0===p&&(p=this._traits.geometryOperations=h.hasGeometryOperations(this.syntaxTree));return p},hasFeatureSetOperations:function(){var p=
this._traits.featureSetOperations;void 0===p&&(p=this._traits.featureSetOperations=h.hasFeatureSetOperations(this.syntaxTree));return p},hasVariable:function(p){var e=this._traits.variables;void 0===e[p]&&(e[p]=h.hasVariable(this.syntaxTree,p));return e[p]},hasFunction:function(p){var e=this._traits.functions;void 0===e[p]&&(e[p]=h.hasFunction(this.syntaxTree,p));return e[p]},evaluate:function(p){this._compile();var e=this._attributeCache.compiledFunc;return this.async?h.executeAsyncFunction(e,p):
h.executeFunction(e,p)},_setSyntaxTree:function(p){this.syntaxTree=p;this._compiled=!1;this._traits={variables:{},functions:{}};this._createLegacyValueObjects()},_createLegacyValueObjects:function(){this._attributeDef={valueExpression:this.expression};this._attributeCache={attributeInfo:this._attributeDef,isNumeric:"number"===this.returnType,idSource:this.expression,id:this.id,hasExpr:!0,compiledFunc:null,syntaxTree:this.syntaxTree,isScaleDriven:!1,dependsOnView:this.hasVariable("$view"),dependsOnGeometry:this.hasGeometryOperations(),
isJSFunc:!1}},_compile:function(){this._compiled||(this._attributeCache.compiledFunc=this.profile.compile(this),this._compiled=!0)}});A("extend-esri")&&(w.ArcadeExpression=G);return G})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(G,B,A,w,q){G=G(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,
orderByFields:null,toJson:function(){var h={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},p=this.objectIds,e=this.outFields,l=this.outSpatialReference,b=this.orderByFields;p&&(h.objectIds=p.join(","));e&&(h.outFields=e.join(","));l&&(h.outSR=l.wkid||A.toJson(l.toJson()));b&&(h.orderByFields=b.join(","));h._ts=this._ts;return h}});w("extend-esri")&&
B.setObject("tasks.RelationshipQuery",G,q);return G})},"esri/arcadeProfiles/popupProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(G,B,A,w,q,h,p,e){G=new (G(null,{declaredClass:"esri.arcadeProfiles.PopupProfile",defaults:{globals:{featureSet:["$layer","$datastore","$map","$aggregatedfeatures"],async:["$layer","$datastore","$map","$aggregatedfeatures"]},context:{vars:{$feature:"any",
$layer:"any",$datastore:"any",$map:"any",$aggregatedfeatures:"any"}}},initialize:function(l){var b=[];e.hasGeometryOperations(l)&&b.push(p.enableGeometryOperations());(e.hasFeatureSetOperations(l)||e.hasVariables(l,this.defaults.globals.featureSet))&&b.push(p.enableFeatureSetOperations());e.isAsync(l)&&b.push(p.enableAsyncOperations());return q(b)},isAsync:function(l){l=[l];return e.hasFeatureSetOperations(l)||e.hasVariables(l,this.defaults.globals.async)},parse:function(l){return p.createSyntaxTree(l.expression)},
compile:function(l){var b=B.clone(this.defaults.context);b.useAsync=l.async;return l.syntaxTree?p.createFunction(l.syntaxTree,b):null},getEvalOptions:function(l){var b=l.expression,a=l.feature,f=l.layer,n=l.aggregatedFeaturesLayer,m=l.map;l=l.spatialReference;a=a&&b.hasVariable("$feature")?h.createFromGraphicLikeObject(a.geometry,a.attributes,f):null;var d,c;if(f){var g={spatialReference:l};b.hasVariable("$layer")&&(d=f.getMap()?p.createFeatureSetFromLayer(f,g):p.createFeatureSetFromLayerUrl(f.url,
g));if(b.hasVariable("$datastore"))var k=(k=e.getServiceUrl(f.url))?p.createFeatureSetCollectionFromServiceUrl(k,g):null;b.hasVariable("$aggregatedfeatures")&&n&&(c=n.getMap()?p.createFeatureSetFromLayer(n,g):null)}b=m&&b.hasVariable("$map")?p.createFeatureSetCollectionFromMap(m):null;return{context:{vars:{$feature:a,$layer:d,$datastore:k,$map:b,$aggregatedfeatures:c},spatialReference:l}}}}));A("extend-esri")&&B.setObject("arcadeProfiles.popupProfile",G,w);return G})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style ../libs/sanitizer/Sanitizer dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k,t,y,K,C){var r=0,E=C.widgets.popup,F=C.widgets.templatePicker;B=B([K,c,g],{declaredClass:"esri.dijit._PopupRenderer",_sanitizer:new m({whiteList:{span:["class"],dd:[],dl:[],dt:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],sub:[],sup:[],animate:[],animatetransform:[],circle:[],clippath:[],defs:[],ellipse:[],g:[],image:[],line:[],lineargradient:[],marker:[],mask:[],path:[],pattern:[],polygon:[],polyline:[],radialgradient:[],rect:[],stop:[],svg:[],"switch":[],symbol:[],
text:[],textpath:[],tspan:[],use:[]}},!0),constructor:function(){this._nls=w.mixin({},E)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'statusSection hidden' dojoAttachPoint\x3d'_status'\x3e\x3c/div\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this._showStatus(F.loading);this._contentDfd=this.template.getComponents(this.graphic).then(w.hitch(this,this._handleComponentsSuccess)).otherwise(w.hitch(this,this._handleComponentsError))},destroy:function(){this._contentDfd&&this._contentDfd.cancel();this._attachmentsDfd&&this._attachmentsDfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._contentDfd=this._attachmentsDfd=null;this.inherited(arguments)},
_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var u=this._mediaInfos,D=u.length,z=this.domNode,M=this._prevMedia,H=this._nextMedia;if(1<D){var x=0,J=0;q.forEach(u,function(L){"image"===L.type?x++:-1!==L.type.indexOf("chart")&&J++});x&&(b.set(this._imageCount,"innerHTML",x),h.query(".summary .image",
z).removeClass("hidden"));J&&(b.set(this._chartCount,"innerHTML",J),h.query(".summary .chart",z).removeClass("hidden"))}else h.query(".summary",z).addClass("hidden"),a.add(M,"hidden"),a.add(H,"hidden");u=this._mediaPtr;0===u?a.add(M,"hidden"):a.remove(M,"hidden");u===D-1?a.add(H,"hidden"):a.remove(H,"hidden");this._destroyFrame()},_displayMedia:function(){var u=this._mediaInfos[this._mediaPtr],D=u.title,z=u.caption,M=h.query(".mediaSection .hzLine",this.domNode)[0];b.set(this._mediaTitle,"innerHTML",
this._sanitizer.sanitize(D));a[D?"remove":"add"](this._mediaTitle,"hidden");b.set(this._mediaCaption,"innerHTML",this._sanitizer.sanitize(z));a[z?"remove":"add"](this._mediaCaption,"hidden");a[D&&z?"remove":"add"](M,"hidden");this._rid=null;if("image"===u.type)this._showImage(u);else{var H=this;D=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"];z=u.value.theme||this.chartTheme;w.isString(z)&&(z=z.replace(/\./gi,"/"),-1===z.indexOf("/")&&(z="dojox/charting/themes/"+z));z||(z="./Rainbow");
D.push(z);try{var x=this._rid=r++;G(D,function(J,L,N){x===H._rid&&(H._rid=null,H._showChart(u.type,u.value,J,L,N))})}catch(J){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(u){return(u=u&&w.trim(u).toLowerCase())&&(0===u.indexOf("mailto:")||0===u.indexOf("tel:"))},_showImage:function(u){a.add(this._mediaFrame,"image");var D=n.get(this._gallery,"height"),z=u.value,M=d.decode(z.linkURL);z=d.decode(z.sourceURL);var H;M&&(H=f.create("a",{href:M,target:this._preventNewTab(M)?
"":"_blank"},this._mediaFrame));M=u.refreshInterval?this._addURLParameter(z,"timestamp",Date.now()):z;f.create("img",{className:"esriPopupMediaImage",src:M},H||this._mediaFrame);var x=h.query(".esriPopupMediaImage",this._mediaFrame)[0];this._imageLoadHandle=A.connect(x,"onload",this,function(){this._clearImageHandles();this._imageLoaded(x,D);this._initImageRefresh(u)})},_addURLParameter:function(u,D,z){var M=-1===u.indexOf("?")?"?":"\x26";return u+M+D+"\x3d"+z},_initImageRefresh:function(u){if(u.refreshInterval){var D=
6E4*u.refreshInterval;this._imageRefreshHandle=setTimeout(w.hitch(this,function(){this._destroyFrame();this._showImage(u)}),D)}},_clearImageHandles:function(){A.disconnect(this._imageLoadHandle);this._imageLoadHandle=null;clearTimeout(this._imageRefreshHandle);this._imageRefreshHandle=null},_showChart:function(u,D,z,M,H){a.remove(this._mediaFrame,"image");z=this._chart=new z(f.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});H&&z.setTheme(H);switch(u){case "piechart":z.addPlot("default",
{type:"Pie",labels:!1});z.addSeries("Series A",D.fields);break;case "linechart":z.addPlot("default",{type:"Markers"});z.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});z.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});q.forEach(D.fields,function(x,J){x.x=J+1});z.addSeries("Series A",D.fields);break;case "columnchart":z.addPlot("default",{type:"Columns",gap:3});z.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});z.addSeries("Series A",D.fields);break;
case "barchart":z.addPlot("default",{type:"Bars",gap:3}),z.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),z.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),z.addSeries("Series A",D.fields)}this._action=new M(z);z.render()},_destroyFrame:function(){this._rid=null;this._clearImageHandles();this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);b.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(u,
D){var z=u.height;z<D&&n.set(u,"marginTop",Math.round((D-z)/2)+"px")},_attListHandler:function(u,D){if(u===this._attachmentsDfd){this._attachmentsDfd=null;var z="";D instanceof Error||!D||!D.length||q.forEach(D,function(M){z+="\x3cli\x3e";z+="\x3ca href\x3d'"+y.addProxy(M.url)+"' target\x3d'_blank'\x3e"+(M.name||"[No name]")+"\x3c/a\x3e";z+="\x3c/li\x3e"});b.set(this._attachmentsList,"innerHTML",z||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_createLinkIfURI:function(u,D){var z=y.getURIInfo(u);
if(z){var M=u.match(z.pattern);u=M&&M[2];M=d.decode(M[1]);f.create("a",{target:"_blank",href:M,title:M,innerHTML:this._sanitizer.sanitize(t.substitute({appName:z.appName,hierPart:u},z.label))},D)}else b.set(D,"innerHTML",this._sanitizer.sanitize(u))},_showStatus:function(u){b.set(this._status,"innerHTML",u);a.remove(this._status,"hidden");h.query(".mainSection",this.domNode).addClass("hidden")},_hideStatus:function(){b.set(this._status,"innerHTML","");a.add(this._status,"hidden");h.query(".mainSection",
this.domNode).removeClass("hidden")},_handleComponentsSuccess:function(u){if(u){this._hideStatus();var D=this.showTitle?u.title:"",z=u.description,M=u.fields,H=u.mediaInfos,x=this.domNode,J=this._nls,L=this,N=this.template,P=this.graphic;this._prevMedia.title=J.NLS_prevMedia;this._nextMedia.title=J.NLS_nextMedia;b.set(this._title,"innerHTML",this._sanitizer.sanitize(D));D||a.add(this._title,"hidden");if(!u.hasDescription&&M&&(z="",M=q.map(M,function(S){var Z=f.create("tr",{vAlign:"top"});f.create("td",
{className:"attrName",innerHTML:this._sanitizer.sanitize(S[0])},Z);var da=f.create("td",{className:"attrValue"},Z);this._createLinkIfURI(S[1],da);return Z},this),M.length)){var T=f.create("table",{className:"attrTable",cellPadding:"0px",cellSpacing:"0px"});q.forEach(M,function(S){T.appendChild(S)})}T?(this._description.appendChild(T),z=!0):b.set(this._description,"innerHTML",this._sanitizer.sanitize(z));z||a.add(this._description,"hidden");h.query("a",this._description).forEach(function(S){L._preventNewTab(S.href)?
"_blank"===S.target&&b.remove(S,"target"):b.set(S,"target","_blank")});D&&z?h.query(".mainSection .hzLine",x).removeClass("hidden"):D||z?h.query(".mainSection .hzLine",x).addClass("hidden"):h.query(".mainSection",x).addClass("hidden");if(D=this._attachmentsDfd=N.getAttachments(P))D.addBoth(w.hitch(this,this._attListHandler,D)),b.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+J.NLS_searching+"...\x3c/li\x3e"),h.query(".attachmentsSection",x).removeClass("hidden");H&&H.length&&(h.query(".mediaSection",
x).removeClass("hidden"),l.setSelectable(this._mediaFrame,!1),this._mediaInfos=H,this._mediaPtr=0,this._updateUI(),this._displayMedia());u.editSummary&&(b.set(this._editSummary,"innerHTML",this._sanitizer.sanitize(u.editSummary)),H&&H.length&&a.remove(this._mediaBreak,"hidden"),a.remove(this._editSummarySection,"hidden"));this.emit("content-update")}else this._showStatus(E.NLS_noInfo)},_handleComponentsError:function(u){u&&"cancel"===u.dojoType||(console.log("PopupRenderer: error loading template",
u),this._showStatus(E.NLS_noInfo))}});p("extend-esri")&&w.setObject("dijit._PopupRenderer",B,k);return B})},"esri/libs/sanitizer/Sanitizer":function(){!function(G,B){"object"==typeof exports&&"undefined"!=typeof module?module.exports=B():"function"==typeof define&&define.amd?define(B):(G="undefined"!=typeof globalThis?globalThis:G||self).Sanitizer=B()}(this,function(){function G(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,
animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,
"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,
"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,
"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,
"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,
"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,
"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,
"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,
"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,
rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,
"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,
"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}}function B(X){var ea=X||{},ia={},la;for(la in ea)ia[la]=ea[la];(X=ia).whiteList=X.whiteList||M.whiteList;X.onAttr=X.onAttr||M.onAttr;
X.onIgnoreAttr=X.onIgnoreAttr||M.onIgnoreAttr;X.safeAttrValue=X.safeAttrValue||M.safeAttrValue;this.options=X}function A(X){return X.replace(P,"\x26lt;").replace(T,"\x26gt;")}function w(X){return X.replace(S,"\x26quot;")}function q(X){return X.replace(Z,'"')}function h(X){return X.replace(da,function(ea,ia){return"x"===ia[0]||"X"===ia[0]?String.fromCharCode(parseInt(ia.substr(1),16)):String.fromCharCode(parseInt(ia,10))})}function p(X){return X.replace(Q,":").replace(W," ")}function e(X){for(var ea=
"",ia=0,la=X.length;ia<la;ia++)ea+=32>X.charCodeAt(ia)?" ":X.charAt(ia);return L.trim(ea)}function l(X){return X=e(X=p(X=h(X=q(X))))}function b(X){return X=A(X=w(X))}function a(X,ea){for(;ea<X.length;ea++){var ia=X[ea];if(" "!==ia)return"\x3d"===ia?ea:-1}}function f(X,ea){for(;0<ea;ea--){var ia=X[ea];if(" "!==ia)return"\x3d"===ia?ea:-1}}function n(X){return'"'===X[0]&&'"'===X[X.length-1]||"'"===X[0]&&"'"===X[X.length-1]?X.substr(1,X.length-2):X}function m(X){var ea=X||{},ia={},la;for(la in ea)ia[la]=
ea[la];(X=ia).stripIgnoreTag&&(X.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),X.onIgnoreTag=sa.onIgnoreTagStripAll);X.whiteList=X.whiteList||sa.whiteList;X.onTag=X.onTag||sa.onTag;X.onTagAttr=X.onTagAttr||sa.onTagAttr;X.onIgnoreTag=X.onIgnoreTag||sa.onIgnoreTag;X.onIgnoreTagAttr=X.onIgnoreTagAttr||sa.onIgnoreTagAttr;X.safeAttrValue=X.safeAttrValue||sa.safeAttrValue;X.escapeHtml=X.escapeHtml||sa.escapeHtml;this.options=X;!1===
X.css?this.cssFilter=!1:(X.css=X.css||{},this.cssFilter=new va(X.css))}var d,c,g=Object.prototype,k=Function.prototype.toString,t=g.hasOwnProperty,y=k.call(Object),K=g.toString,C=(d=Object.getPrototypeOf,c=Object,function(X){return d(c(X))}),r=function(X){var ea;if(!(ea=!X||"object"!=typeof X||"[object Object]"!=K.call(X))&&(ea=!1,null!=X&&"function"!=typeof X.toString))try{ea=!!(X+"")}catch(ia){}if(ea)return!1;X=C(X);if(null===X)return!0;X=t.call(X,"constructor")&&X.constructor;return"function"==
typeof X&&X instanceof X&&k.call(X)==y},E={exports:{}},F={};g={exports:{}};var u={},D=/javascript\s*:/gim;u.whiteList=G();u.getDefaultWhiteList=G;u.onAttr=function(X,ea,ia){};u.onIgnoreAttr=function(X,ea,ia){};u.safeAttrValue=function(X,ea){return D.test(ea)?"":ea};var z={indexOf:function(X,ea){var ia;if(Array.prototype.indexOf)return X.indexOf(ea);var la=0;for(ia=X.length;la<ia;la++)if(X[la]===ea)return la;return-1},forEach:function(X,ea,ia){var la;if(Array.prototype.forEach)return X.forEach(ea,
ia);var ma=0;for(la=X.length;ma<la;ma++)ea.call(ia,X[ma],ma,X)},trim:function(X){return String.prototype.trim?X.trim():X.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(X){return String.prototype.trimRight?X.trimRight():X.replace(/(\s*$)/g,"")}},M=u,H=function(X,ea){function ia(){if(!ma){var Ca=z.trim(X.slice(ua,xa)),Fa=Ca.indexOf(":");if(-1!==Fa){var Ga=z.trim(Ca.slice(0,Fa));Fa=z.trim(Ca.slice(Fa+1));Ga&&(Ca=ea(ua,ta.length,Ga,Fa,Ca))&&(ta+=Ca+"; ")}}ua=xa+1}";"!==(X=z.trimRight(X))[X.length-1]&&
(X+=";");for(var la=X.length,ma=!1,ua=0,xa=0,ta="";xa<la;xa++){var ya=X[xa];if("/"===ya&&"*"===X[xa+1]){ya=X.indexOf("*/",xa+2);if(-1===ya)break;ua=(xa=ya+1)+1;ma=!1}else"("===ya?ma=!0:")"===ya?ma=!1:";"===ya?ma||ia():"\n"===ya&&ia()}return z.trim(ta)};B.prototype.process=function(X){if(!(X=(X=X||"").toString()))return"";var ea=this.options,ia=ea.whiteList,la=ea.onAttr,ma=ea.onIgnoreAttr,ua=ea.safeAttrValue;return H(X,function(xa,ta,ya,Ca,Fa){var Ga=ia[ya],na=!1;if(!0===Ga?na=Ga:"function"==typeof Ga?
na=Ga(Ca):Ga instanceof RegExp&&(na=Ga.test(Ca)),!0!==na&&(na=!1),Ca=ua(ya,Ca)){var v;xa={position:ta,sourcePosition:xa,source:Fa,isWhite:na};return na?null==(v=la(ya,Ca,xa))?ya+":"+Ca:v:null==(v=ma(ya,Ca,xa))?void 0:v}})};!function(X,ea){for(var ia in(ea=X.exports=function(la,ma){return(new B(ma)).process(la)}).FilterCSS=B,u)ea[ia]=u[ia]}(g,g.exports);var x={indexOf:function(X,ea){var ia;if(Array.prototype.indexOf)return X.indexOf(ea);var la=0;for(ia=X.length;la<ia;la++)if(X[la]===ea)return la;return-1},
forEach:function(X,ea,ia){var la;if(Array.prototype.forEach)return X.forEach(ea,ia);var ma=0;for(la=X.length;ma<la;ma++)ea.call(ia,X[ma],ma,X)},trim:function(X){return String.prototype.trim?X.trim():X.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(X){return(X=/\s|\n|\t/.exec(X))?X.index:-1}},J=g.exports.getDefaultWhiteList,L=x,N=new g.exports.FilterCSS,P=/</g,T=/>/g,S=/"/g,Z=/&quot;/g,da=/&#([a-zA-Z0-9]*);?/gim,Q=/&colon;?/gim,W=/&newline;?/gim,aa=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,
R=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,V=/u\s*r\s*l\s*\(.*/gi,ba=/\x3c!--[\s\S]*?--\x3e/g;F.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:"autoplay controls crossorigin loop muted preload src".split(" "),b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],
details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan",
"colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:"autoplay controls crossorigin loop muted playsinline poster preload src height width".split(" ")};F.getDefaultWhiteList=function(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:"autoplay controls crossorigin loop muted preload src".split(" "),b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],
center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align",
"valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:"autoplay controls crossorigin loop muted playsinline poster preload src height width".split(" ")}};F.onTag=function(X,ea,ia){};F.onIgnoreTag=function(X,ea,ia){};F.onTagAttr=function(X,ea,ia){};F.onIgnoreTagAttr=function(X,ea,ia){};F.safeAttrValue=function(X,ea,
ia,la){if(ia=l(ia),"href"===ea||"src"===ea){if("#"===(ia=L.trim(ia)))return"#";if("http://"!==ia.substr(0,7)&&"https://"!==ia.substr(0,8)&&"mailto:"!==ia.substr(0,7)&&"tel:"!==ia.substr(0,4)&&"data:image/"!==ia.substr(0,11)&&"ftp://"!==ia.substr(0,6)&&"./"!==ia.substr(0,2)&&"../"!==ia.substr(0,3)&&"#"!==ia[0]&&"/"!==ia[0])return""}else if("background"===ea){if(aa.lastIndex=0,aa.test(ia))return""}else if("style"===ea){if((R.lastIndex=0,R.test(ia))||(V.lastIndex=0,V.test(ia)&&(aa.lastIndex=0,aa.test(ia))))return"";
!1!==la&&(ia=(la=la||N).process(ia))}return ia=b(ia)};F.escapeHtml=A;F.escapeQuote=w;F.unescapeQuote=q;F.escapeHtmlEntities=h;F.escapeDangerHtml5Entities=p;F.clearNonPrintableCharacter=e;F.friendlyAttrValue=l;F.escapeAttrValue=b;F.onIgnoreTagStripAll=function(){return""};F.StripTagBody=function(X,ea){"function"!=typeof ea&&(ea=function(){});var ia=!Array.isArray(X),la=[],ma=!1;return{onIgnoreTag:function(ua,xa,ta){return ia||-1!==L.indexOf(X,ua)?ta.isClosing?(la.push([!1!==ma?ma:ta.position,ta.position+
10]),ma=!1,"[/removed]"):(ma||(ma=ta.position),"[removed]"):ea(ua,xa,ta)},remove:function(ua){var xa="",ta=0;return L.forEach(la,function(ya){xa+=ua.slice(ta,ya[0]);ta=ya[1]}),xa+=ua.slice(ta)}}};F.stripCommentTag=function(X){return X.replace(ba,"")};F.stripBlankChar=function(X){X=X.split("");return(X=X.filter(function(ea){ea=ea.charCodeAt(0);return 127!==ea&&(!(31>=ea)||10===ea||13===ea)})).join("")};F.cssFilter=N;F.getDefaultCSSWhiteList=J;var ha={},qa=/[^a-zA-Z0-9_:\.\-]/gim;ha.parseTag=function(X,
ea,ia){var la="",ma=0,ua=!1,xa=!1,ta=0,ya=X.length,Ca="",Fa="";ta=0;a:for(;ta<ya;ta++)if(Fa=X.charAt(ta),!1===ua)"\x3c"===Fa&&(ua=ta);else if(!1===xa)if("\x3c"===Fa)la+=ia(X.slice(ma,ta)),ma=ua=ta;else if("\x3e"===Fa)la+=ia(X.slice(ma,ua)),ma=Fa=X.slice(ua,ta+1),Ca=x.spaceIndex(ma),ma=-1===Ca?ma.slice(1,-1):ma.slice(1,Ca+1),Ca=("/"===(ma=x.trim(ma).toLowerCase()).slice(0,1)&&(ma=ma.slice(1)),"/"===ma.slice(-1)&&(ma=ma.slice(0,-1)),ma),la+=ea(ua,la.length,Ca,Fa,"\x3c/"===Fa.slice(0,2)),ma=ta+1,ua=
!1;else{if('"'===Fa||"'"===Fa){Ca=1;for(var Ga=X.charAt(ta-Ca);""===Ga.trim()||"\x3d"===Ga;){if("\x3d"===Ga){xa=Fa;continue a}Ga=X.charAt(ta-++Ca)}}}else Fa===xa&&(xa=!1);return ma<X.length&&(la+=ia(X.substr(ma))),la};ha.parseAttr=function(X,ea){function ia(Ca,Fa){1>(Ca=(Ca=x.trim(Ca)).replace(qa,"").toLowerCase()).length||(Ca=ea(Ca,Fa||""))&&ma.push(Ca)}for(var la=0,ma=[],ua=!1,xa=X.length,ta=0;ta<xa;ta++){var ya=X.charAt(ta);if(!1!==ua||"\x3d"!==ya)if(!1===ua||ta!==la||'"'!==ya&&"'"!==ya||"\x3d"!==
X.charAt(ta-1))/\s|\n|\t/.test(ya)&&((X=X.replace(/\s|\n|\t/g," "),!1===ua)?-1===(ya=a(X,ta))?(ia(x.trim(X.slice(la,ta))),ua=!1,la=ta+1):ta=ya-1:-1===(ya=f(X,ta-1))&&(ia(ua,n(x.trim(X.slice(la,ta)))),ua=!1,la=ta+1));else{if(-1===(ya=X.indexOf(ya,ta+1)))break;ia(ua,x.trim(X.slice(la+1,ya)));ua=!1;la=(ta=ya)+1}else ua=X.slice(la,ta),la=ta+1}return la<X.length&&(!1===ua?ia(X.slice(la)):ia(ua,n(x.trim(X.slice(la))))),x.trim(ma.join(" "))};var va=g.exports.FilterCSS,sa=F,Ba=ha.parseTag,Aa=ha.parseAttr;
m.prototype.process=function(X){if(!(X=(X=X||"").toString()))return"";var ea=this.options,ia=ea.whiteList,la=ea.onTag,ma=ea.onIgnoreTag,ua=ea.onTagAttr,xa=ea.onIgnoreTagAttr,ta=ea.safeAttrValue,ya=ea.escapeHtml,Ca=this.cssFilter;ea.stripBlankChar&&(X=sa.stripBlankChar(X));ea.allowCommentTag||(X=sa.stripCommentTag(X));var Fa=!1;ea.stripIgnoreTagBody&&(Fa=sa.StripTagBody(ea.stripIgnoreTagBody,ma),ma=Fa.onIgnoreTag);X=Ba(X,function(Ga,na,v,I,O){na={sourcePosition:Ga,position:na,isClosing:O,isWhite:ia.hasOwnProperty(v)};
if(null!=(Ga=la(v,I,na)))return Ga;if(na.isWhite){if(na.isClosing)return"\x3c/"+v+"\x3e";Ga=function(Y){var ca=x.spaceIndex(Y);if(-1===ca)return{html:"",closing:"/"===Y[Y.length-2]};ca="/"===(Y=x.trim(Y.slice(ca+1,-1)))[Y.length-1];return ca&&(Y=x.trim(Y.slice(0,-1))),{html:Y,closing:ca}}(I);var U=ia[v];na=Aa(Ga.html,function(Y,ca){var fa,ja=-1!==x.indexOf(U,Y);return null==(fa=ua(v,Y,ca,ja))?ja?(ca=ta(v,Y,ca,Ca))?Y+'\x3d"'+ca+'"':Y:null==(fa=xa(v,Y,ca,ja))?void 0:fa:fa});I="\x3c"+v;return na&&(I+=
" "+na),Ga.closing&&(I+=" /"),I+="\x3e"}return null==(Ga=ma(v,I,na))?ya(I):Ga},ya);return Fa&&(X=Fa.remove(X)),X};return function(X,ea){function ia(ua,xa){return(new la(xa)).process(ua)}var la=m,ma;for(ma in(ea=X.exports=ia).filterXSS=ia,ea.FilterXSS=la,F)ea[ma]=F[ma];for(ma in ha)ea[ma]=ha[ma];"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=X.exports)}(E,E.exports),function(){function X(ea,ia){var la,ma=this;this.arcgisWhiteList=
{a:["href","target","style"],abbr:["title"],img:"src width height border alt style".split(" "),video:"autoplay controls height loop muted poster preload width".split(" "),audio:["autoplay","controls","loop","muted","preload"],source:["media","src","type"],span:["style"],table:"width height cellpadding cellspacing border style".split(" "),div:["style","align"],font:["size","color","style","face"],tr:["height","valign","align","style"],td:"height width valign align colspan rowspan nowrap style".split(" "),
th:"height width valign align colspan rowspan nowrap style".split(" "),p:["style"],b:[],strong:[],i:[],em:[],u:[],br:[],li:[],ul:[],ol:[],hr:[],tbody:[]};this.allowedProtocols="http https mailto iform tel flow lfmobile arcgis-navigator arcgis-appstudio-player arcgis-survey123 arcgis-collector arcgis-workforce arcgis-explorer arcgis-trek2there mspbi comgooglemaps pdfefile pdfehttp pdfehttps boxapp boxemm awb awbs gropen radarscope".split(" ");this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(ua,
xa,ta,ya){return"a"===ua&&"href"===xa||("img"===ua||"source"===ua)&&"src"===xa?ma.sanitizeUrl(ta):E.exports.safeAttrValue(ua,xa,ta,ya)}};ea&&!ia?la=ea:ea&&ia?(la=Object.create(this.arcgisFilterOptions),Object.keys(ea).forEach(function(ua){"whiteList"===ua?la.whiteList=ma._extendObjectOfArrays([ma.arcgisWhiteList,ea.whiteList||{}]):la[ua]=ea[ua]})):(la=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList;this.xssFilterOptions=la;this._xssFilter=new E.exports.FilterXSS(la)}return X.prototype.sanitize=
function(ea,ia){switch(void 0===ia&&(ia={}),typeof ea){case "number":return isNaN(ea)||!isFinite(ea)?null:ea;case "boolean":return ea;case "string":return this._xssFilter.process(ea);case "object":return this._iterateOverObject(ea,ia);default:if(!ia.allowUndefined||void 0!==ea)return null}},X.prototype.sanitizeUrl=function(ea){var ia=this._trim(ea.substring(0,ea.indexOf(":")));return"/"===ea||"#"===ea||"#"===ea[0]||-1<this.allowedProtocols.indexOf(ia.toLowerCase())?E.exports.escapeAttrValue(ea):""},
X.prototype.sanitizeHTMLAttribute=function(ea,ia,la,ma){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(ea,ia,la,ma):E.exports.safeAttrValue(ea,ia,la,ma)},X.prototype.validate=function(ea,ia){void 0===ia&&(ia={});ia=this.sanitize(ea,ia);return{isValid:ea===ia,sanitized:ia}},X.prototype._extendObjectOfArrays=function(ea){var ia={};return ea.forEach(function(la){Object.keys(la).forEach(function(ma){Array.isArray(la[ma])&&Array.isArray(ia[ma])?ia[ma]=
ia[ma].concat(la[ma]):ia[ma]=la[ma]})}),ia},X.prototype._iterateOverObject=function(ea,ia){var la=this;void 0===ia&&(ia={});try{var ma=!1,ua=void 0;if(Array.isArray(ea))ua=ea.reduce(function(xa,ta){var ya=la.validate(ta,ia);return ya.isValid?xa.concat([ta]):(ma=!0,xa.concat([ya.sanitized]))},[]);else{if(!r(ea))return ia.allowUndefined&&void 0===ea?void 0:null;ua=Object.keys(ea).reduce(function(xa,ta){var ya=ea[ta],Ca=la.validate(ya,ia);return Ca.isValid?xa[ta]=ya:(ma=!0,xa[ta]=Ca.sanitized),xa},{})}return ma?
ua:ea}catch(xa){return null}},X.prototype._trim=function(ea){return String.prototype.trim?ea.trim():ea.replace(/(^\s*)|(\s*$)/g,"")},X}()})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(G,B,A,w,q,h){return G([h,q],{_onMap:function(p){var e=this.constructor._onMap;e&&e.FINAL||(delete this.constructor._onMap,e=this.registerConnectEvents(),e.FINAL=!0);p=p.toLowerCase();if(e[p])var l=this[e[p].method];
else p=this._onCamelCase(p),this[p]&&(l=p);return l},on:function(p,e){var l=this._onMap(p),b=p.replace(/\-/g,""),a="on"+b in this.domNode;return l||!a?this.inherited(arguments):this.own(w(this.domNode,b,e))[0]},emit:function(p,e,l){var b,a=p.toLowerCase(),f=this.constructor._onMap||this.registerConnectEvents();var n=this[this._onMap(a)];e=e||{};e.target||(e.target=this);if(n&&f&&f[a]){this._onObj2Arr(function(){b=Array.prototype.slice.call(arguments)},f[a].argKeys)(e);var m=B.mixin({},arguments);
m[2]=b;m[0]=f[a].name.replace(/^on/,"")}return this.inherited(m||arguments)}})})},"esri/dijit/Legend/utils":function(){define(["dojo/_base/lang","../../lang","dojo/i18n!../../nls/jsapi"],function(G,B,A){var w=A.widgets.legend;return{getVisualVariableTitle:function(q,h){var p=q.field,e=q.normalizationField,l=!1,b=!1,a=!1;p=G.isFunction(p)?null:p;e=G.isFunction(e)?null:e;if(q.legendOptions&&q.legendOptions.title)var f=q.legendOptions.title;else if(q.valueExpressionTitle)f=q.valueExpressionTitle;else{if(h.renderer&&
h.renderer.authoringInfo&&h.renderer.authoringInfo.visualVariables){var n=h.renderer.authoringInfo.visualVariables;for(q=0;q<n.length;q++){var m=n[q];if("colorInfo"===m.type&&"ratio"===m.style){l=!0;break}else if("colorInfo"===m.type&&"percent"===m.style){b=!0;break}else if("colorInfo"===m.type&&"percentTotal"===m.style){a=!0;break}}}(l=a&&"showRatioPercentTotal"||b&&"showRatioPercent"||l&&"showRatio"||e&&"showNormField"||p&&"showField"||null)&&(f=B.substitute({field:p&&h.getFieldLabel(p),normField:e&&
h.getFieldLabel(e)},"showField"===l?"${field}":w[l]))}return f},getRendererTitle:function(q,h){if(q){if("esri.renderer.ClassBreaksRenderer"===q.declaredClass){var p=q.attributeField;var e=q.normalizationField;var l="percent-of-total"===q.normalizationType}p=G.isFunction(p)?null:p;e=G.isFunction(e)?null:e;if(q.legendOptions&&q.legendOptions.title)var b=q.legendOptions.title;else q.valueExpressionTitle?b=q.valueExpressionTitle:(q=e&&"showNormField"||(l?"showNormPct":null)||p&&"showField"||null)&&(b=
B.substitute({field:p&&h.getFieldLabel(p),normField:e&&h.getFieldLabel(e)},"showField"===q?"${field}":w[q]))}return b}}})},"esri/layers/clustering/GeohashAggregation":function(){define("dojo/has dojo/_base/declare dojo/_base/lang dojo/_base/array ../../kernel ../../Evented ../../geometry/Point ../../geometry/Extent ../../geometry/mathUtils ../../support/expressionUtils ../../core/timerUtils ../support/attributeUtils ./geohashUtils ./statUtils".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f,n,m){B=B(h,
{loaded:!1,started:!1,map:null,layer:null,lod:null,tolerance:null,clusterMode:null,clusterRadius:null,sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0,clusters:null,clustersEnabled:!0,statisticInfos:null,defaults:{lod:1,tolerance:0,clusterMode:"auto",clusterRadius:80,sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0},_eventHandles:null,_updateHandle:null,_indexHandle:null,_cellIndex:null,_globalIndex:null,_perfProfile:null,_indexUpdated:!1,_cellSizeScaleFactor:1.5,
_extentScaleFactor:1.25,_maxGeohashLength:12,_minClusterRadius:15,_levelChange:!0,_clusterFieldPrefix:"cluster_",_mapLevelChange:!1,constructor:function(d){this._update=A.hitch(this,this._update);this._indexFeatures=A.hitch(this,this._indexFeatures);this._eventHandles=[];this._globalIndex={numFeatures:null,fullExtent:null,lodStats:null};this._perfProfile={lastIndex:{total:null,numFeatures:0},lastUpdate:{cells:null,clusters:null,total:null}};this.clusters=[];this.map=d.map;this.layer=d.layer;this.setLod(d.lod);
this.setTolerance(d.tolerance);this.setClusterMode(d.clusterMode);this.setClusterRadius(d.clusterRadius);this.setSortEnabled(d.sortEnabled);this.setFilterEnabled(d.filterEnabled);this.setBufferEnabled(d.bufferEnabled);this.setUpdateEnabled(d.updateEnabled);this.setStatisticInfos(d.statisticInfos);this._load();this.loaded?this._startup():this._eventHandles.push(this.on("load",A.hitch(this,this._startup)))},destroy:function(d){this._displayFeatures(!0,d);w.forEach(this._eventHandles,function(c){c.remove()});
a.clearTimeout(this._updateHandle);a.clearTimeout(this._indexHandle);this._cellIndex=this._globalIndex=this._eventHandles=this._updateHandle=this._indexHandle=this.map=this.layer=this.clusters=null},setLod:function(d){var c=this.lod;this.lod=d||this.defaults.lod;c!==this.lod&&this.update()},setTolerance:function(d){var c=this.tolerance;this.tolerance=d||this.defaults.tolerance;c!==this.tolerance&&this.update()},setClusterMode:function(d){var c=this.clusterMode;this.clusterMode=d||this.defaults.clusterMode;
this._evalClusterParams();c!==this.clusterMode&&this.update()},setClusterRadius:function(d){var c=this.clusterRadius;this.clusterRadius=null!=d?d:this.defaults.clusterRadius;this._evalClusterParams();c!==this.clusterRadius&&this.update()},setSortEnabled:function(d){var c=this.sortEnabled;this.sortEnabled=null!=d?!!d:this.defaults.sortEnabled;c!==this.sortEnabled&&this.update()},setFilterEnabled:function(d){var c=this.filterEnabled;this.filterEnabled=null!=d?!!d:this.defaults.filterEnabled;c!==this.filterEnabled&&
this.update()},setBufferEnabled:function(d){var c=this.bufferEnabled;this.bufferEnabled=null!=d?!!d:this.defaults.bufferEnabled;c!==this.bufferEnabled&&this.update()},setUpdateEnabled:function(d){var c=this.updateEnabled;(this.updateEnabled=null!=d?!!d:this.defaults.updateEnabled)&&c!==this.updateEnabled&&(this._mapLevelChange=!0,this.update())},setStatisticInfos:function(d){this.statisticInfos=d||[];this.loaded&&this._applyStatInfos(this.statisticInfos)},update:function(){this.loaded&&null==this._updateHandle&&
(this._updateHandle=a.setTimeout(this._update,a.priority.HIGH))},isUpdateScheduled:function(){return null!=this._updateHandle},index:function(){this.loaded&&null==this._indexHandle&&(this._indexHandle=a.setTimeout(this._indexFeatures,a.priority.HIGH))},getCell:function(d){return this._cellIndex[d.length][d]},getCluster:function(d){var c;w.some(this.clusters,function(g){-1<w.indexOf(g.geohashes,d)&&(c=g);return!!c});return c},getCellsInCluster:function(d){var c=[];w.forEach(d&&d.geohashes,function(g){(g=
this.getCell(g))&&c.push(g)},this);return c},getFeaturesInCluster:function(d){var c=[];d=this.getCellsInCluster(d);w.forEach(d,function(g){Array.prototype.push.apply(c,g.features)});return c},toggleFeatureVisibility:function(d){this.index()},getCurrentLodStats:function(){var d=this._globalIndex.lodStats;return d&&d[this.lod]},getNumFeatures:function(){return this._globalIndex.numFeatures},getFullExtent:function(){var d=this._globalIndex.fullExtent;return d&&Infinity!==d.xmin?new e(d):null},_load:function(){this._displayFeatures(!1);
this._checkLoadStatus();this.map.loaded||this._eventHandles.push(this.map.on("load",A.hitch(this,this._checkLoadStatus)));this.layer.loaded||this._eventHandles.push(this.layer.on("load",A.hitch(this,this._checkLoadStatus)))},_checkLoadStatus:function(){if(this.map.loaded&&this.layer.loaded){if("esriGeometryPoint"!==this.layer.geometryType)var d=Error("GeohashAggregation is supported only for points");else{var c=this.map.spatialReference;c.isWebMercator()||4326===c.wkid||(d=Error("GeohashAggregation is supported only when map spatial reference is WGS84 or WebMercator"))}d?
(this.loadError=d,this.emit("load-error",{error:d})):(this.loaded=!0,this.emit("load"))}},_startup:function(){this._evalUpdateStatus();this.index();this._processExtentChange();this._eventHandles.push(this.layer.on("update-end",A.hitch(this,this.index)),this.layer.on("edits-complete",A.hitch(this,this.index)),this.layer.on("graphics-clear",A.hitch(this,this.index)),this.layer.on("suspend",A.hitch(this,this._evalUpdateStatus)),this.layer.on("resume",A.hitch(this,this._evalUpdateStatus)),this.map.on("extent-change",
A.hitch(this,this._processExtentChange)))},_evalUpdateStatus:function(){this.setUpdateEnabled(!this.layer.suspended)},_processExtentChange:function(d){this._mapLevelChange=!(!d||!d.levelChange);this._evalClusterParams();this.update()},_update:function(){this._updateHandle=null;if(this.updateEnabled){this.emit("update-start");if(this.clustersEnabled){var d=this.map.geographicExtent;if(d){var c=this._getIntersectingCells(d);d=this._getClusters(c.cells,d);this.clusters=d.clusters;this._applyStatInfosToClusters();
c=c.profile;d=d.profile;var g=c.total+d.total;c.total=this._getElapsedTime(c.total);d.total=this._getElapsedTime(d.total);var k=this._perfProfile.lastUpdate={};k.cells=c;k.clusters=d;k.total=this._getElapsedTime(g)}}else this.clusters=[],this._perfProfile.lastUpdate=null;c=this._indexUpdated;this._indexUpdated=!1;d=this._mapLevelChange;this._mapLevelChange=!1;this.emit("update-end",{levelChange:this._levelChange,mapLevelChange:d,indexChange:c})}},_displayFeatures:function(d,c){var g=this.layer;d=
!d;g.suspendGraphics(d);!1!==c&&(d?g.clearNodes():g.redraw())},_indexFeatures:function(){this._indexHandle=null;var d=this._getTime();this._initializeIndexing();var c=0,g=this._globalIndex.fullExtent;w.forEach(this.layer.graphics,function(y){if(y.visible){var K=y.geometry,C=this._getLngLat(K);if(C){var r=K.getCacheValue("_geohash");void 0===r&&(r=n.pointToGeohash(C),K.setCacheValue("_geohash",r||null))}r&&(this._addGeohashToIndex(r,y,C),c++,this._updateExtent(g,C))}},this);this._applyStatInfosToIndex();
this._globalIndex.numFeatures=c;for(var k=this._globalIndex.lodStats,t=1;t<=this._maxGeohashLength;t++)k[t]=this._getLODStats(t,c);this._perfProfile.lastIndex.total=this._getElapsedTime(d,this._getTime());this._perfProfile.lastIndex.numFeatures=c;this._indexUpdated=!0;this.emit("index-complete");this.started||(this.started=!0,this.emit("start"));this.update()},_initializeIndexing:function(){this._globalIndex={numFeatures:0,fullExtent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},lodStats:{}};
for(var d=this._cellIndex=[],c=1;c<=this._maxGeohashLength;c++)d[c]={}},_getLngLat:function(d){if(d){var c=d.getLongitude();d=d.getLatitude();d=null!=c&&null!=d?{x:c,y:d}:null}return d},_addGeohashToIndex:function(d,c,g){for(var k=this._cellIndex,t="",y=0;y<this._maxGeohashLength;y++){t+=d[y];var K=k[t.length],C=K[t];C||(C=K[t]={count:0,centroid:{x:null,y:null},extent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},features:[],geohash:t,statistics:null});this._updateItem(C,1,g,!0);C.features.push(c)}},
_getLODStats:function(d,c){var g=this._cellIndex[d],k=0,t=Infinity,y=-Infinity,K=null,C;for(C in g){var r=g[C];k++;r.count<t&&(t=r.count);r.count>y&&(y=r.count)}0<k&&(K=Number((c/k).toFixed(2)));return{lod:d,count:k,min:Infinity===t?null:t,max:-Infinity===y?null:y,avg:K}},_evalClusterParams:function(){if(this.loaded&&"auto"===this.clusterMode){var d=this._getClusterParams(this.map.getResolutionInMeters(),this.clusterRadius,this._minClusterRadius);this._levelChange=this.lod!==d.lod;this.lod=d.lod;
this.tolerance=d.tolerance}},_getClusterParams:function(d,c,g){c<g&&(c=g);d=Math.ceil(d*c);c=this._getClosestLODRange(d).max;do g=this._getCellSize(c),(g=d>=this._cellSizeScaleFactor*g||1===g)||(c+=1);while(!g);g=d/this._getCellSize(c);return{lod:c,tolerance:d,multiplier:Number(g.toFixed(2))}},_getClosestLODRange:function(d){for(var c,g=this._maxGeohashLength;1<=g;g--)if(this._getCellSize(g)>=d){c=g;break}null==c&&(c=1);d=c+1;d>this._maxGeohashLength&&(d=this._maxGeohashLength);return{min:c,max:d}},
_getCellSize:function(d){d=n.getCellSizeInMeters(d);return Math.ceil(Math.min(d.width,d.height))},_sorter:function(d,c){var g=d.centroid,k=c.centroid;return d.count>c.count?-1:d.count<c.count?1:g.x>k.x?-1:g.x<k.x?1:0},_getIntersectingCells:function(d){var c=this._getTime();this.bufferEnabled&&(d=d.expand(this._extentScaleFactor));var g=n.getIntersecting(d,this.lod,this.bufferEnabled?this.tolerance:0);d=this._getTime();var k=[],t=this.tolerance,y=this.sortEnabled;w.forEach(g,function(K){(K=this.getCell(K))&&
k.push(K)},this);t&&y&&k.sort(this._sorter);g=this._getTime();return{cells:k,profile:{findCells:this._getElapsedTime(c,d),scanAndSortCells:this._getElapsedTime(d,g),total:g-c}}},_getClusters:function(d,c){var g=this._getTime(),k=[],t={},y={findCells:0};w.forEach(d,function(K,C){(K=this._createCluster(K,t,y))&&k.push(K)},this);this._markIntersecting(k,c);this.filterEnabled&&(k=this._getIntersectingClusters(k));d=this._getTime();return{clusters:k,profile:{findCellsInCluster:this._getElapsedTime(y.findCells),
total:d-g}}},_markIntersecting:function(d,c){var g=c.normalize();w.forEach(d,function(k){var t=k.centroid.x,y=k.centroid.y;k.isIntersecting=w.some(g,function(K){return t>=K.xmin&&t<=K.xmax&&y>=K.ymin&&y<=K.ymax})})},_getIntersectingClusters:function(d){return w.filter(d,function(c){return c.isIntersecting})},_createCluster:function(d,c,g){if(!c[d.geohash]){var k=[{cell:d,distance:0}];if(this.tolerance){var t=this._getTime(),y=n.getNeighborsWithinDistance(d.centroid,this.lod,this.tolerance);g.findCells+=
this._getTime()-t;w.forEach(y,function(K){if(K!==d.geohash&&(K=this.getCell(K))){var C=this._calculateDistance(d.centroid,K.centroid);C<=this.tolerance&&k.push({cell:K,distance:C})}},this)}return this._mergeCells(k,c)}},_calculateDistance:function(d,c){return l.getLength(n.geographicToWebMercator(d),n.geographicToWebMercator(c))},_mergeCells:function(d,c){var g=this._initializeCluster({},d[0].cell.geohash);w.forEach(d,function(k){var t=k.cell,y=t.geohash;k=k.distance;var K=c[y];if(K)if(k<K.distance)this._removeCellFromCluster(y,
c);else return;c[y]={cluster:g,distance:k};this._updateItem(g,t.count,t.centroid);g.geohashes.push(y)},this);return g},_removeCellFromCluster:function(d,c){var g=c[d].cluster;delete c[d];d=w.indexOf(g.geohashes,d);-1<d&&g.geohashes.splice(d,1);this._reevaluateCluster(g)},_reevaluateCluster:function(d){var c=d.geohashes;d=this._initializeCluster(d,d.primary);w.forEach(c,function(g){var k=this.getCell(g);k&&(this._updateItem(d,k.count,k.centroid),d.geohashes.push(g))},this)},_initializeCluster:function(d,
c){d.count=0;d.centroid=new p(null,null);d.geohashes=[];d.primary=c;d.statistics=null;return d},_applyStatInfos:function(d){d=this._getValidStatInfos(d);this._applyStatInfosToIndex(d);this._applyStatInfosToClusters(d)},_getValidStatInfos:function(d){var c=[];w.forEach(d,function(g){var k=g.attributeInfo;g=g.statisticType;var t="angle"===k.attributeType;if(m.isSupportedStatisticType(g)&&(!t||"avg"===g)){var y="arithmetic"===k.rotationType;c.push({attributeCache:f.createAttributeCache(k,"type"===g),
identifier:m.getStatisticId(k,g),statFunctions:m.getStatisticFunctions(g),isAngular:t,isDate:"date"===k.attributeType,isArithmetic:y})}});return c},_applyStatInfosToIndex:function(d){d=d||this._getValidStatInfos(this.statisticInfos);var c=this._cellIndex;if(c)for(var g=1;g<=this._maxGeohashLength;g++){var k=c[g],t;for(t in k)this._applyStatInfosToCell(k[t],d)}},_applyStatInfosToCell:function(d,c){var g=this._initializeStats(d,c);w.forEach(d.features,function(k){this._calcFeatureStats(k,c,g)},this);
this._summarizeStats(d,g,c)},_calcFeatureStats:function(d,c,g){d.attributes&&w.forEach(c,function(k){var t=g[k.identifier],y=k.attributeCache;y=y?d._getDataValue(y.attributeInfo,y,b):null;k.statFunctions.updateCellStat(t,y,k)})},_applyStatInfosToClusters:function(d){d=d||this._getValidStatInfos(this.statisticInfos);var c=this._clusterFieldPrefix;w.forEach(this.clusters,function(g){var k=this._initializeStats(g,d);w.forEach(this.getCellsInCluster(g),function(t){this._calcCellStats(t,d,k)},this);this._summarizeStats(g,
k,d,c);g.attributes[c+"id"]=g.primary},this)},_calcCellStats:function(d,c,g){var k=d.statistics;w.forEach(c,function(t){var y=t.identifier;t.statFunctions.updateClusterStat(g[y],k[y],t)})},_initializeStats:function(d,c){var g=d.statistics={};w.forEach(c,function(k){g[k.identifier]=k.statFunctions.initialize(k)});return g},_summarizeStats:function(d,c,g,k){var t=d.attributes={};k=k||"";t[k+"count"]=d.count;w.forEach(g,function(y){var K=this._getStatFieldName(y,k);t[K]=y.statFunctions.summarize(c[y.identifier],
y)},this)},_getStatFieldName:function(d,c){return(c||"")+d.identifier},_updateItem:function(d,c,g,k){var t=g.y,y=d.centroid,K=d.count;y.x=(K*y.x+c*g.x)/(K+c);y.y=(K*y.y+c*t)/(K+c);d.count+=c;k&&this._updateExtent(d.extent,g)},_updateExtent:function(d,c){var g=c.x;c=c.y;g<d.xmin&&(d.xmin=g);g>d.xmax&&(d.xmax=g);c<d.ymin&&(d.ymin=c);c>d.ymax&&(d.ymax=c)},_getTime:function(){return window.performance?window.performance.now():(new Date).getTime()},_getElapsedTime:function(d,c){d=null!=d&&null!=c?c-d:
d;if(null!=d){var g="millisecond";1E3<=d&&(d/=1E3,g="second",60<=d&&(d/=60,g="minute"));g={value:Number(d.toFixed(2)),unit:g}}return g}});G("extend-esri")&&A.setObject("layers.clustering.GeohashAggregation",B,q);return B})},"esri/core/timerUtils":function(){define([],function(){function G(h){var p,e=h.length;for(p=0;p<e;p++)h[p]()}var B={LOW:1,HIGH:2},A,w={};w[B.LOW]=[];w[B.HIGH]=[];var q=function(){clearTimeout(A);A=null;var h=w[B.HIGH];w[B.HIGH]=[];G(h);h=w[B.LOW];w[B.LOW]=[];G(h)};return{priority:B,
callbackQueue:w,setTimeout:function(h,p){h=[p,w[p].push(h)-1];A||(A=setTimeout(q,0));return h},clearTimeout:function(h){h&&w[h[0]].splice(h[1],1)}}})},"esri/layers/clustering/geohashUtils":function(){define("dojo/has dojo/string dojo/_base/lang dojo/_base/array ../../kernel ../../geometry/Point ../../geometry/Extent ../../SpatialReference ../../geometry/webMercatorUtils".split(" "),function(G,B,A,w,q,h,p,e,l){function b(H){var x=H.spatialReference;if(!x)return{x:H.x,y:H.y};var J=x.isWebMercator(),
L;4326===x.wkid?L={x:H.x,y:H.y}:J&&(L={x:H.getLongitude(),y:H.getLatitude()});return L}function a(H){var x=H.spatialReference,J=!(!x||!x.isWebMercator()),L;x&&4326===x.wkid?L=new p(H.toJson()):J&&(L=l.webMercatorToGeographic(H,!0));return L}function f(H,x){x.x=h.prototype._normalizeX(H.x,e.prototype._info[4326]);x.y=H.y;return x}function n(H){H=z.decimals[H].toString(2);return B.pad(H,z.bitsPerBase32Char,"0")}function m(H,x){x=x.slice();x.splice(1,0,0);for(var J=x[0],L=x[2],N=0;N<H.length;N++){Number(H[N])?
x[0]=x[1]:x[2]=x[1];var P=x[1]=(x[0]+x[2])/2;J=x[0];L=x[2]}return{value:P,min:J,max:L}}function d(H,x,J){var L=[];x=x.slice();x.splice(1,0,0);for(var N=x[0],P=x[2],T=0;T<J;T++)H>=x[1]?(x[0]=x[1],N=1):(x[2]=x[1],N=0),x[1]=(x[0]+x[2])/2,L.push(N),N=x[0],P=x[2];return{value:L.join(""),min:N,max:P}}function c(H){var x=H*z.bitsPerBase32Char;0===x%2?H=x/=2:(H=(x+1)/2,x-=H);return{lon:H,lat:x}}function g(H){var x=0;H=H.split("").reverse().join("");for(var J=0;J<H.length;J++)x+=Number(H[J])*Math.pow(2,J);
return z.base32[x]}function k(H,x){var J={x:H.xmin,y:H.ymax},L={x:H.xmax,y:H.ymin},N={x:H.xmax,y:H.ymax};return{sw:M.pointToGeohash({x:H.xmin,y:H.ymin},x),nw:M.pointToGeohash(J,x),se:M.pointToGeohash(L,x),ne:M.pointToGeohash(N,x)}}function t(H,x,J,L,N){var P=H;do N[P]||(N[P]=!0,L.push(P)),(H=P===x)||(P=D(P,J));while(!H)}function y(H,x,J,L){var N=k(H,x);H=[];t(N.sw,N.nw,"n",H,{});x=[];t(N.se,N.ne,"n",x,{});for(N=0;N<H.length;N++)t(H[N],x[N],"e",J,L)}function K(H){return w.filter(H,function(x){return 180===
x.xmax?!0:!1})[0]}function C(H){return w.filter(H,function(x){return-180===x.xmin?!0:!1})[0]}function r(H,x,J,L){var N=M.geographicToWebMercator(H);H={x:N.x-x,y:N.y-x};x=M.webMercatorToGeographic({x:N.x+x,y:N.y+x},!0);H=M.webMercatorToGeographic(H,!0);return new p(null!=J?J:H.x,H.y,null!=L?L:x.x,x.y)}function E(H,x,J,L){H=k(H,x);var N,P;"min"===L?P=180:"max"===L&&(N=-180);var T=N;L=P;var S=M.geohashToCell(H.sw).extent;x=M.geohashToCell(H.ne).extent;H=null!=T?T:S.xmin;S=S.ymin;L=null!=L?L:x.xmax;x=
x.ymax;H=r({x:H,y:S},J,N,P);J=r({x:L,y:x},J,N,P);return new p(H.xmin,H.ymin,J.xmax,J.ymax)}function F(H,x,J){var L=H,N=0;do N++,(H=L===x)||(L=D(L,J));while(!H);return N}function u(H,x){H=k(H,x);x=F(H.nw,H.ne,"e");return{rows:F(H.nw,H.sw,"s"),cols:x}}function D(H,x){var J=H.length%2,L=H.slice(-1),N=z.decimals[L];H=H.slice(0,-1);-1!=z.borders[x][J].indexOf(L)&&H&&(H=D(H,x));return H+z.neighbors[x][J][N]}var z={base32:"0123456789bcdefghjkmnpqrstuvwxyz",decimals:function(){for(var H={},x=0;32>x;x++)H["0123456789bcdefghjkmnpqrstuvwxyz"[x]]=
x;return H}(),neighbors:{n:[null,"238967debc01fg45kmstqrwxuvhjyznp"],s:[null,"bc01fg45238967deuvhjyznpkmstqrwx"],e:[null,"14365h7k9dcfesgujnmqp0r2twvyx8zb"],w:[null,"p0r21436x8zb9dcf5h7kjnmqesgutwvy"]},borders:{n:[null,"bcfguvyz"],s:[null,"0145hjnp"],e:[null,"prxz"],w:[null,"028b"]},bitsPerBase32Char:5,maxGeohashLength:12,longitudeRange:[-180,180],latitudeRange:[-90,90]};z.neighbors.n[0]="14365h7k9dcfesgujnmqp0r2twvyx8zb";z.neighbors.s[0]="p0r21436x8zb9dcf5h7kjnmqesgutwvy";z.neighbors.e[0]="238967debc01fg45kmstqrwxuvhjyznp";
z.neighbors.w[0]="bc01fg45238967deuvhjyznpkmstqrwx";z.borders.n[0]="prxz";z.borders.s[0]="028b";z.borders.e[0]="bcfguvyz";z.borders.w[0]="0145hjnp";var M={geographicToWebMercator:function(H){H=h.lngLatToXY(H.x,H.y);return{x:H[0],y:H[1]}},webMercatorToGeographic:function(H,x){H=h.xyToLngLat(H.x,H.y,x);return{x:H[0],y:H[1]}},geohashToCell:function(H){var x;var J=[];for(x=0;x<H.length;x++)J.push(n(H[x]));J=J.join("");x=[];var L=[];for(var N=0;N<J.length;N++)0===N%2?x.push(J[N]):L.push(J[N]);x=x.join("");
L=L.join("");x=[x,L];J=m(x[0],z.longitudeRange);N=m(x[1],z.latitudeRange);x=J.value;L=N.value;return{point:{x:x,y:L},extent:{xmin:J.min,xmax:J.max,ymin:N.min,ymax:N.max},geohash:H}},pointToCell:function(H,x){x=x||z.maxGeohashLength;if(H=b(H)){H=f(H,H);var J=c(x);x=d(H.x,z.longitudeRange,J.lon);var L=d(H.y,z.latitudeRange,J.lat);J=x.value;var N=L.value;x={xmin:x.min,xmax:x.max,ymin:L.min,ymax:L.max};L=[];for(var P=Math.ceil((J.length+N.length)/z.bitsPerBase32Char),T=0,S=0,Z=0;Z<P*z.bitsPerBase32Char;Z++){var da=
0===Z%2?J[T++]:N[S++];null==da&&(da=0);L.push(da)}J=L.join("");N=z.bitsPerBase32Char;L=J.length/N;P=[];for(T=0;T<L;T++)S=J.substr(T*N,N),P.push(g(S));J=P.join("");return{point:H,extent:x,geohash:J}}},geohashToPoint:function(H){return M.geohashToCell(H).point},pointToGeohash:function(H,x){return(H=M.pointToCell(H,x))&&H.geohash},getCells:function(H){return w.map(H,function(x){return M.geohashToCell(x)})},getCellSize:function(H){var x=z.longitudeRange,J=z.latitudeRange;x=Math.abs(x[1]-x[0]);J=Math.abs(J[1]-
J[0]);H=c(H||1);return{width:x/Math.pow(2,H.lon),height:J/Math.pow(2,H.lat)}},getCellSizeInMeters:function(H){H=M.getCellSize(H);var x=l.metersPerDegree;H.width*=x;H.height*=x;return H},getIntersecting:function(H,x,J){x=x||1;J=J||0;var L=[],N=a(H);if(N){J&&(N=M.expandExtent(H,x,J));H=N.normalize();var P={};w.forEach(H,function(T){y(T,x,L,P)})}return L},countIntersecting:function(H,x,J){x=x||1;J=J||0;var L=0,N=a(H);if(N){J&&(N=M.expandExtent(H,x,J));H=N.normalize();if(2===H.length){L=K(H);N=C(H);J=
u(L,x);var P=u(N,x);H=J.rows;J=J.cols+P.cols;L={x:L.xmin,y:L.ymax};N={x:N.xmax,y:N.ymax};L=f(L,{});N=f(N,{});L=M.pointToGeohash(L,x);x=M.pointToGeohash(N,x);L===x&&J--;x={rows:H,cols:J}}else x=u(H[0],x);L=x.cols*x.rows}return L},getChildren:function(H){H=H||"";var x=[],J;for(J in z.decimals)x.push(H+J);return x},getNeighbors:function(H){var x=D(H,"n"),J=D(H,"s");return[x,D(x,"e"),D(x,"w"),J,D(J,"e"),D(J,"w"),D(H,"e"),D(H,"w")]},getExtentFromDistance:function(H,x){x=x||1E3;var J;(H=b(H))&&(J=r(H,x));
return J},expandExtent:function(H,x,J){x=x||1;J=J||0;if(H=a(H)){if(J){H=H.normalize();if(2===H.length){var L=J;J=K(H);H=C(H);J=E(J,x,L,"min");H=E(H,x,L,"max");360<=J.getWidth()+H.getWidth()?(x=-180,H=180):(x=J.xmin,H=H.xmax);return new p(x,J.ymin,H,J.ymax)}return E(H[0],x,J)}return H}},getNeighborsWithinDistance:function(H,x,J){J=J||1E3;x=x||1;var L=[];if(H=b(H)){J=r(H,J).normalize();var N={};w.forEach(J,function(P){y(P,x,L,N)})}return L}};G("extend-esri")&&A.setObject("layers.clustering.geohashUtils",
M,q);return M})},"esri/layers/clustering/statUtils":function(){define(["dojo/_base/lang","../support/attributeUtils"],function(G,B){function A(h){return"number"===typeof h&&!isNaN(h)&&Infinity!==h&&-Infinity!==h}var w={sum:{initialize:function(){return{count:0,sum:null}},updateCellStat:function(h,p){A(p)&&(h.count++,h.sum+=p)},updateClusterStat:function(h,p){p.count&&(h.count+=p.count,h.sum+=p.sum)},summarize:function(h){return h.sum}},avg:{initialize:function(h){return{count:0,sum:null,avg:null,
sum_cosine:null,sum_sine:null}},updateCellStat:function(h,p,e){A(p)&&(h.count++,e.isAngular?(e.isArithmetic||(p=-1*p+90),h.sum_cosine+=Math.cos(p*Math.PI/180),h.sum_sine+=Math.sin(p*Math.PI/180)):h.sum+=p)},updateClusterStat:function(h,p,e){p.count&&(h.count+=p.count,e.isAngular?(h.sum_cosine+=p.sum_cosine,h.sum_sine+=p.sum_sine):h.sum+=p.sum)},summarize:function(h,p){if(0<h.count){var e=h.count;p.isAngular?(e=180*Math.atan2(h.sum_sine/e,h.sum_cosine/e)/Math.PI,p.isArithmetic||(e=-1*(e-90)),h.avg=
0>e?e+360:e):(h.avg=h.sum/e,p.isDate&&(h.avg=Math.ceil(h.avg)))}return h.avg}},type:{initialize:function(){return{uvInfos:{}}},updateCellStat:function(h,p){if(null==p||""===p||"string"===typeof p&&""===G.trim(p))p=null;h=h.uvInfos;null==h[p]?h[p]={count:1,value:p}:h[p].count++},updateClusterStat:function(h,p){h=h.uvInfos;p=p.uvInfos;for(var e in p){var l=p[e];null==h[e]?h[e]={count:l.count,value:l.value}:h[e].count+=l.count}},summarize:function(h){h=h.uvInfos;var p,e=-Infinity;for(p in h){var l=h[p];
if(l.count>e){e=l.count;var b=l.value}else l.count===e&&(b=null)}return b}}},q={isSupportedStatisticType:function(h){return w.hasOwnProperty(h)},getStatisticFunctions:function(h){return w[h]},getStatisticId:function(h,p){var e=B.getAttributeIdSource(h);h=e&&B.getAttributeId(e)||h.field;return p+"_"+h},getClusterField:function(h,p){return"cluster_"+q.getStatisticId(h,p)},getStatisticHash:function(h,p){p=[q.getStatisticId(h,p)];h.attributeType&&p.push(h.attributeType.toLowerCase());h.rotationType&&
p.push(h.rotationType.toLowerCase());return p.join("_")}};return q})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k,t,y,K,C,r,E,F,u){var D=G(d,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(z,M){this.markerSymbol=new c(c.STYLE_SOLID,10,new g(g.STYLE_SOLID,new q([255,0,0]),2),new q([0,0,0,.25]));this.lineSymbol=new g(g.STYLE_SOLID,new q([255,0,0]),2);this.fillSymbol=new k(k.STYLE_SOLID,new g(g.STYLE_SOLID,new q([255,0,0]),2),new q([0,0,0,.25]));this._points=[];this._mouse=!p("esri-touch")&&!p("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=B.mixin(B.mixin({},this._defaultOptions),M||{});if(e("ios")||e("android"))this._options.showTooltips=!1;this._onKeyDownHandler=B.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=B.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=B.hitch(this,this._onMouseUpHandler);this._onClickHandler=B.hitch(this,this._onClickHandler);this._onMouseMoveHandler=B.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=B.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=B.hitch(this,this._onDblClickHandler);this._updateTooltip=B.hitch(this,this._updateTooltip);this._hideTooltip=B.hitch(this,this._hideTooltip);this._redrawGraphic=B.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(z){this.respectDrawingVertexOrder=z},setMarkerSymbol:function(z){this.markerSymbol=z},setLineSymbol:function(z){this.lineSymbol=z},
setFillSymbol:function(z){this.fillSymbol=z},activate:function(z,M){this._geometryType&&this.deactivate();var H=this.map,x=w.connect,J=D;this._options=B.mixin(B.mixin({},this._options),M||{});H.navigationManager.setImmediateClick(!1);switch(z){case J.ARROW:case J.LEFT_ARROW:case J.RIGHT_ARROW:case J.UP_ARROW:case J.DOWN_ARROW:case J.TRIANGLE:case J.CIRCLE:case J.ELLIPSE:case J.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=x(H,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=x(H,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=x(H,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=x(H,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=x(H,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=x(H,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=x(H,"onMouseDragEnd",this._onMouseUpHandler));p("esri-touch")&&(this._onMouseDownHandler2_connect=
x(H,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=x(H,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=x(H,"onSwipeEnd",this._onMouseUpHandler));break;case J.POINT:this._onClickHandler_connect=x(H,"onClick",this._onClickHandler);break;case J.LINE:case J.EXTENT:case J.FREEHAND_POLYLINE:case J.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=x(H,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=
x(H,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=x(H,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=x(H,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=x(H,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=x(H,"onMouseDragEnd",this._onMouseUpHandler));p("esri-touch")&&(this._onMouseDownHandler2_connect=x(H,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=x(H,"onSwipeMove",
this._onMouseDragHandler),this._onMouseUpHandler2_connect=x(H,"onSwipeEnd",this._onMouseUpHandler));break;case J.POLYLINE:case J.POLYGON:case J.MULTI_POINT:H.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=x(H,"onClick",this._onClickHandler);this._onDblClickHandler_connect=x(H,"onDblClick",this._onDblClickHandler);this._dblClickZoom=H.isDoubleClickZoom;H.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+z);return}this._onKeyDown_connect=x(H,"onKeyDown",
this._onKeyDownHandler);this._redrawConnect=x(H,"onExtentChange",this._redrawGraphic);this._geometryType=z;this._toggleTooltip(!0);H.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(H.snappingManager._startSelectionLayerQuery(),H.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var z=this.map;this._clear();var M=w.disconnect;M(this._onMouseMoveHandler_connect);M(this._onMouseDownHandler_connect);M(this._onMouseDragHandler_connect);
M(this._onMouseUpHandler_connect);M(this._onMouseDownHandler2_connect);M(this._onMouseDragHandler2_connect);M(this._onMouseUpHandler2_connect);M(this._onClickHandler_connect);M(this._onDblClickHandler_connect);M(this._onKeyDown_connect);M(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=this._onMouseUpHandler2_connect=this._onClickHandler_connect=
this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;z.snappingManager&&(z.snappingManager._stopSelectionLayerQuery(),z.snappingManager._killOffSnapping());switch(this._geometryType){case D.CIRCLE:case D.ELLIPSE:case D.TRIANGLE:case D.ARROW:case D.LEFT_ARROW:case D.RIGHT_ARROW:case D.UP_ARROW:case D.DOWN_ARROW:case D.RECTANGLE:case D.LINE:case D.EXTENT:case D.FREEHAND_POLYLINE:case D.FREEHAND_POLYGON:this._activateMapTools(!0,!1,!1,!0);break;case D.POLYLINE:case D.POLYGON:case D.MULTI_POINT:this._dblClickZoom&&
z.enableDoubleClickZoom()}M=this._geometryType;this._geometryType=null;z.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(M)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._graphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},finishDrawing:function(){var z=this._points,M=this.map.spatialReference,H=D;z=z.slice(0,z.length);switch(this._geometryType){case H.POLYLINE:if(!this._graphic||2>
z.length)return;var x=new C(M);x.addPath([].concat(z));break;case H.POLYGON:if(!this._graphic||3>z.length)return;x=new r(M);z=[].concat(z,[z[0].offset(0,0)]);r.prototype.isClockwise(z)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),z.reverse());x.addRing(z);break;case H.MULTI_POINT:x=new E(M),A.forEach(z,function(J){x.addPoint(J)})}w.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);
this._drawEnd(x)},_drawEnd:function(z){if(z){var M=this.map.spatialReference,H;this.onDrawEnd(z);M&&(M.isWebMercator()?H=K.webMercatorToGeographic(z,!0):4326===M.wkid&&(H=y.fromJson(z.toJson())));this.onDrawComplete({geometry:z,geographicGeometry:H})}},_normalizeRect:function(z,M,H){var x=z.x;z=z.y;var J=M.x;M=M.y;return{x:Math.min(x,J),y:Math.max(z,M),width:Math.abs(x-J),height:Math.abs(z-M),spatialReference:H}},_onMouseDownHandler:function(z){this._dragged=!1;if(this.map.snappingManager)var M=this.map.snappingManager._snappingPoint;
var H=M||z.mapPoint,x=D;M=this.map;var J=M.spatialReference;this._points.push(H.offset(0,0));switch(this._geometryType){case x.LINE:this._graphic=M.graphics.add(new t(new C({paths:[[[H.x,H.y],[H.x,H.y]]],spatialReference:J}),this.lineSymbol),!0);M.snappingManager&&M.snappingManager._setGraphic(this._graphic);break;case x.FREEHAND_POLYLINE:this._oldPoint=z.screenPoint;H=new C(J);H.addPath(this._points);this._graphic=M.graphics.add(new t(H,this.lineSymbol),!0);M.snappingManager&&M.snappingManager._setGraphic(this._graphic);
break;case x.CIRCLE:case x.ELLIPSE:case x.TRIANGLE:case x.ARROW:case x.LEFT_ARROW:case x.RIGHT_ARROW:case x.UP_ARROW:case x.DOWN_ARROW:case x.RECTANGLE:case x.FREEHAND_POLYGON:this._oldPoint=z.screenPoint,H=new r(J),H.addRing(this._points),this._graphic=M.graphics.add(new t(H,this.fillSymbol),!0),M.snappingManager&&M.snappingManager._setGraphic(this._graphic)}p("esri-touch")&&z.preventDefault();if(1===this._points.length)this.onDrawStart()},_onMouseMoveHandler:function(z){if(this.map.snappingManager)var M=
this.map.snappingManager._snappingPoint;z=M||z.mapPoint;M=this._graphic.geometry;switch(this._geometryType){case D.POLYLINE:case D.POLYGON:var H=this._points.length,x=!!M.getPoint(0,H);z=z.offset(0,0);x?M.setPoint(0,H,z):M.insertPoint(0,H,z);this._graphic.setGeometry(M)}},_onMouseDragHandler:function(z){if(this._graphic||this._points.length)if(p("esri-touch")&&!this._points.length)z.preventDefault();else{this._dragged=!0;if(this.map.snappingManager)var M=this.map.snappingManager._snappingPoint;var H=
this._points[0],x=M||z.mapPoint,J=this.map,L=J.spatialReference;M=this._graphic;var N=D,P=J.toScreen(H),T=J.toScreen(x),S=[];S=T.x-P.x;T=T.y-P.y;var Z=Math.sqrt(S*S+T*T);switch(this._geometryType){case N.CIRCLE:this._hideTooltip();M.geometry=r.createCircle({center:P,r:Z,numberOfPoints:60,map:J});M.setGeometry(M.geometry);break;case N.ELLIPSE:this._hideTooltip();M.geometry=r.createEllipse({center:P,longAxis:S,shortAxis:T,numberOfPoints:60,map:J});M.setGeometry(M.geometry);break;case N.TRIANGLE:this._hideTooltip();
S=[[0,-Z],[.8660254037844386*Z,.5*Z],[-.8660254037844386*Z,.5*Z],[0,-Z]];M.geometry=this._toPolygon(S,P.x,P.y);M.setGeometry(M.geometry);break;case N.ARROW:this._hideTooltip();H=T/Z;J=S/Z;x=.25*J*Z;L=.25*Z/(T/S);Z*=.25*H;S=[[S,T],[S-x*(1+24/L),T+24*J-Z],[S-x*(1+12/L),T+12*J-Z],[-12*H,12*J],[12*H,-12*J],[S-x*(1-12/L),T-12*J-Z],[S-x*(1-24/L),T-24*J-Z],[S,T]];M.geometry=this._toPolygon(S,P.x,P.y);M.setGeometry(M.geometry);break;case N.LEFT_ARROW:this._hideTooltip();S=0>=S?[[S,0],[.75*S,T],[.75*S,.5*
T],[0,.5*T],[0,-.5*T],[.75*S,-.5*T],[.75*S,-T],[S,0]]:[[0,0],[.25*S,T],[.25*S,.5*T],[S,.5*T],[S,-.5*T],[.25*S,-.5*T],[.25*S,-T],[0,0]];M.geometry=this._toPolygon(S,P.x,P.y);M.setGeometry(M.geometry);break;case N.RIGHT_ARROW:this._hideTooltip();S=0<=S?[[S,0],[.75*S,T],[.75*S,.5*T],[0,.5*T],[0,-.5*T],[.75*S,-.5*T],[.75*S,-T],[S,0]]:[[0,0],[.25*S,T],[.25*S,.5*T],[S,.5*T],[S,-.5*T],[.25*S,-.5*T],[.25*S,-T],[0,0]];M.geometry=this._toPolygon(S,P.x,P.y);M.setGeometry(M.geometry);break;case N.UP_ARROW:this._hideTooltip();
S=0>=T?[[0,T],[-S,.75*T],[-.5*S,.75*T],[-.5*S,0],[.5*S,0],[.5*S,.75*T],[S,.75*T],[0,T]]:[[0,0],[-S,.25*T],[-.5*S,.25*T],[-.5*S,T],[.5*S,T],[.5*S,.25*T],[S,.25*T],[0,0]];M.geometry=this._toPolygon(S,P.x,P.y);M.setGeometry(M.geometry);break;case N.DOWN_ARROW:this._hideTooltip();S=0<=T?[[0,T],[-S,.75*T],[-.5*S,.75*T],[-.5*S,0],[.5*S,0],[.5*S,.75*T],[S,.75*T],[0,T]]:[[0,0],[-S,.25*T],[-.5*S,.25*T],[-.5*S,T],[.5*S,T],[.5*S,.25*T],[S,.25*T],[0,0]];M.geometry=this._toPolygon(S,P.x,P.y);M.setGeometry(M.geometry);
break;case N.RECTANGLE:this._hideTooltip();S=[[0,0],[S,0],[S,T],[0,T],[0,0]];M.geometry=this._toPolygon(S,P.x,P.y);M.setGeometry(M.geometry);break;case N.LINE:M.setGeometry(B.mixin(M.geometry,{paths:[[[H.x,H.y],[x.x,x.y]]]}));break;case N.EXTENT:M&&J.graphics.remove(M,!0);M=new F(this._normalizeRect(H,x,L));M._originOnly=!0;this._graphic=J.graphics.add(new t(M,this.fillSymbol),!0);J.snappingManager&&J.snappingManager._setGraphic(this._graphic);break;case N.FREEHAND_POLYLINE:this._hideTooltip();if(!1===
this._canDrawFreehandPoint(z)){p("esri-touch")&&z.preventDefault();return}this._points.push(z.mapPoint.offset(0,0));M.geometry._insertPoints([x.offset(0,0)],0);M.setGeometry(M.geometry);break;case N.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(z)){p("esri-touch")&&z.preventDefault();return}this._points.push(z.mapPoint.offset(0,0));M.geometry._insertPoints([x.offset(0,0)],0);M.setGeometry(M.geometry)}p("esri-touch")&&z.preventDefault()}},_canDrawFreehandPoint:function(z){if(!this._oldPoint)return!1;
var M=this._oldPoint.x-z.screenPoint.x,H=this._oldPoint.y-z.screenPoint.y,x=this._options.tolerance;if((0>M?-1*M:M)<x&&(0>H?-1*H:H)<x)return!1;M=new Date;if(M-this._startTime<this._options.drawTime)return!1;this._startTime=M;this._oldPoint=z.screenPoint;return!0},_onMouseUpHandler:function(z){if(this._dragged&&this._graphic){0===this._points.length&&this._points.push(z.mapPoint.offset(0,0));if(this.map.snappingManager)var M=this.map.snappingManager._snappingPoint;var H=this._points[0];M=M||z.mapPoint;
var x=this.map.spatialReference,J=D;switch(this._geometryType){case J.CIRCLE:case J.ELLIPSE:case J.TRIANGLE:case J.ARROW:case J.LEFT_ARROW:case J.RIGHT_ARROW:case J.UP_ARROW:case J.DOWN_ARROW:case J.RECTANGLE:var L=this._graphic.geometry;break;case J.LINE:L=new C({paths:[[[H.x,H.y],[M.x,M.y]]],spatialReference:x});break;case J.EXTENT:L=(new F(this._normalizeRect(H,M,x))).getExtent();break;case J.FREEHAND_POLYLINE:L=new C(x);L.addPath([].concat(this._points,[M.offset(0,0)]));break;case J.FREEHAND_POLYGON:L=
new r(x),H=[].concat(this._points,[M.offset(0,0),this._points[0].offset(0,0)]),r.prototype.isClockwise(H)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),H.reverse()),L.addRing(H)}p("esri-touch")&&z.preventDefault();this._clear();this._drawEnd(L)}else this._clear()},_isPointToPointTool:function(z){switch(z){case D.POLYLINE:case D.POLYGON:case D.MULTI_POINT:return!0;default:return!1}},_onClickHandler:function(z){if(this.map.snappingManager)var M=
this.map.snappingManager._snappingPoint;M=M||z.mapPoint;z=this.map;var H=z.toScreen(M),x=D;if(this._isPointToPointTool(this._geometryType)){var J=this._points[this._points.length-1];if(M&&J&&M.x===J.x&&M.y===J.y)return;this._points.push(M.offset(0,0))}switch(this._geometryType){case x.POINT:this.onDrawStart();this._drawEnd(M.offset(0,0));this._setTooltipMessage(0);break;case x.POLYLINE:1===this._points.length?(M=new C(z.spatialReference),M.addPath(this._points),this._graphic=z.graphics.add(new t(M,
this.lineSymbol),!0),z.snappingManager&&z.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=w.connect(z,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,M.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol));break;case x.POLYGON:1===this._points.length?(M=new r(z.spatialReference),M.addRing(this._points),this._graphic=z.graphics.add(new t(M,this.fillSymbol),
!0),z.snappingManager&&z.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=w.connect(z,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,M.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol));break;case x.MULTI_POINT:M=this._points;1===M.length?(H=new E(z.spatialReference),H.addPoint(M[M.length-1]),this._graphic=z.graphics.add(new t(H,this.markerSymbol),
!0),z.snappingManager&&z.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(M[M.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case x.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],H.x,H.y);break;case x.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],H.x,H.y);break;case x.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,
12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],H.x,H.y);break;case x.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],H.x,H.y);break;case x.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],H.x,H.y);break;case x.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],H.x,H.y);break;case x.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],H.x-48,H.y+48);break;case x.CIRCLE:this._clear();
this.onDrawStart();this._drawEnd(r.createCircle({center:H,r:48,numberOfPoints:60,map:z}));break;case x.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(r.createEllipse({center:H,longAxis:48,shortAxis:24,numberOfPoints:60,map:z}))}this._setTooltipMessage(this._points.length)},_addShape:function(z,M,H){this._setTooltipMessage(0);this._clear();this.onDrawStart();this._drawEnd(this._toPolygon(z,M,H))},_toPolygon:function(z,M,H){var x=this.map,J=new r(x.spatialReference);J.addRing(A.map(z,function(L){return x.toMap({x:L[0]+
M,y:L[1]+H})}));return J},_onDblClickHandler:function(z){var M=this._points,H=this.map.spatialReference,x=D;p("esri-touch")&&M.push(z.mapPoint);var J=M[M.length-1],L=M[M.length-2];M=J&&L&&J.x===L.x&&J.y===L.y?M.slice(0,M.length-1):M.slice(0,M.length);switch(this._geometryType){case x.POLYLINE:if(!this._graphic||2>M.length){w.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(z);return}var N=new C(H);N.addPath([].concat(M));break;case x.POLYGON:if(!this._graphic||3>M.length)return;
N=new r(H);z=[].concat(M,[M[0].offset(0,0)]);r.prototype.isClockwise(z)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),z.reverse());N.addRing(z);break;case x.MULTI_POINT:N=new E(H),A.forEach(M,function(P){N.addPoint(P)})}w.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(N)},_onKeyDownHandler:function(z){z.keyCode===l.ESCAPE&&(w.disconnect(this._onMouseMoveHandler_connect),
this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(z){this._options.showTooltips&&(z?this._tooltip||(this._tooltip=b.create("div",{"class":"esriMapTooltip"},this.map.container),f.isBodyLtr()||a.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=w.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=w.connect(this.map,
"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=w.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(w.disconnect(this._onTooltipMouseEnterHandler_connect),w.disconnect(this._onTooltipMouseLeaveHandler_connect),w.disconnect(this._onTooltipMouseMoveHandler_connect),b.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var z=this._tooltip;z&&(z.style.display="none")},_setTooltipMessage:function(z){var M=this._tooltip;if(M){var H="";switch(this._geometryType){case D.POINT:H=
u.toolbars.draw.addPoint;break;case D.ARROW:case D.LEFT_ARROW:case D.RIGHT_ARROW:case D.UP_ARROW:case D.DOWN_ARROW:case D.TRIANGLE:case D.RECTANGLE:case D.CIRCLE:case D.ELLIPSE:H=u.toolbars.draw.addShape;break;case D.LINE:case D.EXTENT:case D.FREEHAND_POLYLINE:case D.FREEHAND_POLYGON:H=u.toolbars.draw.freehand;break;case D.POLYLINE:case D.POLYGON:H=u.toolbars.draw.start;1===z?H=u.toolbars.draw.resume:2<=z&&(H=u.toolbars.draw.complete);break;case D.MULTI_POINT:H=u.toolbars.draw.addMultipoint,1<=z&&
(H=u.toolbars.draw.finish)}M.innerHTML=H}},_updateTooltip:function(z){var M=this._tooltip;if(M){if(z.clientX||z.pageY){var H=z.clientX;z=z.clientY}else H=z.clientX+h.body().scrollLeft-h.body().clientLeft,z=z.clientY+h.body().scrollTop-h.body().clientTop;M.style.display="none";a.set(M,{left:H+this._options.tooltipOffset+"px",top:z+"px"});M.style.display=""}},_redrawGraphic:function(z,M,H,x){(H||this.map.wrapAround180)&&(z=this._graphic)&&z.setGeometry(z.geometry)},onActivate:function(){},onDeactivate:function(){},
onDrawComplete:function(){},onDrawStart:function(){},onDrawEnd:function(){}});B.mixin(D,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});p("extend-esri")&&B.setObject("toolbars.Draw",D,n);return D})},
"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(G,B,A,w,q){G=G([q],{declaredClass:"esri.toolbars._Toolbar",constructor:function(h){this.map=h},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(h,p,e,l){var b=this.map;h&&(this._mapNavState=
{isDoubleClickZoom:b.isDoubleClickZoom,isClickRecenter:b.isClickRecenter,isPan:b.isPan,isRubberBandZoom:b.isRubberBandZoom,isKeyboardNavigation:b.isKeyboardNavigation,isScrollWheelZoom:b.isScrollWheelZoom},b.disableDoubleClickZoom(),b.disableClickRecenter(),b.disablePan(),b.disableRubberBandZoom(),b.disableKeyboardNavigation());p&&b.hideZoomSlider();e&&b.hidePanArrows();l&&b.graphics.disableMouseEvents()},_activateMapTools:function(h,p,e,l){var b=this.map,a=this._mapNavState;h&&a&&(a.isDoubleClickZoom&&
b.enableDoubleClickZoom(),a.isClickRecenter&&b.enableClickRecenter(),a.isPan&&b.enablePan(),a.isRubberBandZoom&&b.enableRubberBandZoom(),a.isKeyboardNavigation&&b.enableKeyboardNavigation(),a.isScrollWheelZoom&&b.enableScrollWheelZoom());p&&b.showZoomSlider();e&&b.showPanArrows();l&&b.graphics.enableMouseEvents()},_deactivateScrollWheel:function(){var h=this.map;this._scrollWheelState={isScrollWheelZoom:h.isScrollWheelZoom,isScrollWheelPan:h.isScrollWheelPan};h.disableScrollWheelZoom();h.disableScrollWheelPan()},
_activateScrollWheel:function(){var h=this.map,p=this._scrollWheelState;p&&(p.isScrollWheelZoom&&h.enableScrollWheelZoom(),p.isScrollWheelPan&&h.enableScrollWheelPan())}});A("extend-esri")&&B.setObject("toolbars._Toolbar",G,w);return G})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k,t,y,K){var C=B(n,{declaredClass:"esri.toolbars.Edit",constructor:function(r,E){this._map=r;this._tool=0;if(this._map.loaded)this._scratchGL=r.graphics;else var F=w.connect(this._map,"onLoad",this,function(){w.disconnect(F);F=null;this._scratchGL=this._map.graphics});r=p("esri-mobile");this._defaultOptions=A.mixin({vertexSymbol:new k(k.STYLE_CIRCLE,r?20:12,new t(t.STYLE_SOLID,new h([0,0,0,.5]),1),new h([128,128,128])),ghostVertexSymbol:new k(k.STYLE_CIRCLE,
r?18:10,new t(t.STYLE_SOLID,new h([0,0,0,.5]),1),new h([255,255,255,.75])),ghostLineSymbol:new t(t.STYLE_DOT,new h([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:r?24:16,boxLineSymbol:new t(t.STYLE_DASH,new h([64,64,64]),1),boxHandleSymbol:new k(k.STYLE_SQUARE,r?16:9,new t(t.STYLE_SOLID,new h([0,0,0,.5]),1),new h([255,255,255,.75])),textAnchorSymbol:new k(k.STYLE_CIRCLE,10,null,new h([255,0,0]))},E||{})},activate:function(r,E,F){this.deactivate();this._graphic=E;this._options=
A.mixin(A.mixin({},this._defaultOptions),F||{});var u=C.MOVE;F=C.EDIT_VERTICES;var D=C.SCALE,z=C.ROTATE,M=C.EDIT_TEXT,H=!1,x=!1,J=!1,L=this._map,N=L.spatialReference,P=E.geometry.spatialReference;this._geo=!(!N||!P||N.equals(P)||!N.isWebMercator()||4326!==P.wkid);this._isTextPoint=this._prepareTextSymbolEditing(E,r);(r&u)===u&&(H=this._enableMove(E));u=(r&D)===D;z=(r&z)===z;if(u||z)J=this._enableBoxEditing(E,u,z);(r&F)===F&&(x=this._enableVertexEditing(E));(r&M)===M&&this._enableTextEditing(E);if(!(H||
x||J))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=r)this._mapPanEndHandle=w.connect(L,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=w.connect(L,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,E);L.snappingManager&&(H||x)&&L.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var r=this._tool,E=this._graphic;if(r){var F=
!!this._modified;this._clear();w.disconnect(this._mapPanEndHandle);w.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(r,E,{isModified:F});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(r,E){},onDeactivate:function(r,E,F){},
onGraphicMoveStart:function(r){},onGraphicFirstMove:function(r){this._modified=!0},onGraphicMove:function(r,E){},onGraphicMoveStop:function(r,E){},onGraphicClick:function(r,E){},onVertexMoveStart:function(r,E){},onVertexFirstMove:function(r,E){this._modified=!0},onVertexMove:function(r,E,F){},onVertexMoveStop:function(r,E,F){},onVertexAdd:function(r,E){this._modified=!0},onVertexClick:function(r,E){},onVertexMouseOver:function(r,E){},onVertexMouseOut:function(r,E){},onVertexDelete:function(r,E){this._modified=
!0},onTextEditStart:function(r,E){},onTextEditEnd:function(r){},onScaleStart:function(r){},onScaleFirstMove:function(r){this._modified=!0},onScale:function(r,E){},onScaleStop:function(r,E){},onRotateStart:function(r){},onRotateFirstMove:function(r){this._modified=!0},onRotate:function(r,E){},onRotateStop:function(r,E){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(r,E){if("point"===r.geometry.type||"multipoint"===r.geometry.type){var F=r.getLayer(),u=F.renderer;F=r.symbol||F._getSymbol(r);!F&&(u.hasVisualVariables("sizeInfo",!1)||u.hasVisualVariables("colorInfo",!1)||u.hasVisualVariables("opacityInfo",!1))&&u.addBreak&&
u.infos&&1===u.infos.length&&(F=u.infos[0].symbol||u.defaultSymbol);if(F&&"textsymbol"===F.type){if((E&C.SCALE)===C.SCALE||(E&C.ROTATE)===C.ROTATE||(E&C.EDIT_TEXT)===C.EDIT_TEXT){r.setSymbol(new y(F.toJson()));var D=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(r),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){D._boxEditor&&D._boxEditor.refresh()})):
G(["../dijit/SymbolEditor"],function(z){if(!D._textSymbolEditor){var M=D._options.textSymbolEditorHolder?e.create("div",null,D._options.textSymbolEditorHolder):e.create("div",null,D._map.root);D._textSymbolEditor=new z({graphic:r},M);z=D._textSymbolEditor.domNode.parentNode.id;l.set(D._textSymbolEditor.domNode,{position:"map_root"===z?"absolute":"relative",left:"map_root"===z?D._map.width/2-100+"px":"5px",top:"20px","z-index":50});D._textSymbolEditor.startup();D._textSymbolEditor.createForm(r);D._textSymbolEditor.show();
D._textSymbolEditor.on("symbol-change",function(){D._boxEditor&&D._boxEditor.refresh()})}})}if((E&C.MOVE)===C.MOVE||(E&C.ROTATE)===C.ROTATE||(E&C.SCALE)===C.SCALE)this._textAnchor=new K(r.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(r){var E=this._map;switch(r.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new d(r,E,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(r){var E=
this._map;switch(r.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=c.create(r,E,this),!0}return!1},_enableBoxEditing:function(r,E,F){var u=this._map,D=r.geometry.type;return"polyline"===D||"polygon"===D||this._isTextPoint?(this._boxEditor=new m(r,u,this,E,F,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(r){return this._isTextPoint?(this._textEditor=new g(r,this._map,this),w.connect(this._textEditor,"onEditStart",A.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var r=this._graphicMover;r&&(r.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var r=this._vertexEditor;r&&(r.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var r=this._boxEditor;r&&(r.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(r,E,F){F&&this._refreshMoveables()},_refreshMoveables:function(r){var E=q.filter([this._graphicMover,this._vertexEditor,this._boxEditor],a.isDefined);q.forEach(E,function(F){F.refresh(r)})},_beginOperation:function(r){q.forEach(this._getAffectedTools(r),function(E){E.suspend()})},_endOperation:function(r){q.forEach(this._getAffectedTools(r),function(E){E.resume()})},_getAffectedTools:function(r){var E=[];switch(r){case "MOVE":E=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":E=[this._boxEditor];break;case "BOX":E=[this._vertexEditor]}return E=q.filter(E,a.isDefined)}});A.mixin(C,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});p("extend-esri")&&A.setObject("toolbars.Edit",C,b);return C})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g){G=G(null,{declaredClass:"esri.toolbars._Box",constructor:function(k,t,y,K,C,r,E){this._graphic=k;this._map=t;this._toolbar=y;this._scale=K;this._rotate=C;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=r;k=y._options;this._markerSymbol=k.boxHandleSymbol;this._lineSymbol=k.boxLineSymbol;this._moveStartHandler=B.hitch(this,this._moveStartHandler);this._firstMoveHandler=B.hitch(this,this._firstMoveHandler);
this._moveStopHandler=B.hitch(this,this._moveStopHandler);this._moveHandler=B.hitch(this,this._moveHandler);this._isTextPoint=E;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){A.forEach(this._getAllGraphics(),function(k){k.hide()})},resume:function(){A.forEach(this._getAllGraphics(),function(k){k.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
A.forEach(this._connects,w.disconnect);var k=this._toolbar._scratchGL;this._anchors&&A.forEach(this._anchors,function(t){k.remove(t.graphic);(t=t.moveable)&&t.destroy()});this._box&&k.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var k=this._map,t=this._toolbar._scratchGL,y=this._getBoxCoords(),K=new n(k.spatialReference),C=B.clone(A.filter(y,function(r,E){return 8!==E&&0===E%2}));C[0]&&C.push([C[0][0],C[0][1]]);K.addPath(C);this._rotate&&
K.addPath([y[1],y[8]]);this._box?this._box.setGeometry(K):(this._box=new g(K,this._lineSymbol),t.add(this._box));this._anchors?A.forEach(this._anchors,function(r,E){this._scale||(E=8);var F=new f(y[E],k.spatialReference);r.graphic.setGeometry(F);F=r.moveable;var u=r.graphic.getDojoShape();u&&(F?u!==F.shape&&(F.destroy(),r.moveable=this._getMoveable(r.graphic,E)):r.moveable=this._getMoveable(r.graphic,E))},this):(this._anchors=[],this._connects=[],A.forEach(y,function(r,E){!this._scale&&8>E||(r=new f(r,
k.spatialReference),r=new g(r,this._markerSymbol),this._isTextPoint&&1===E%2&&r.hide(),t.add(r),this._anchors.push({graphic:r,moveable:this._getMoveable(r,E)}))},this))}else this._cleanUp()},_getBoxCoords:function(k){var t=this._map,y=[],K,C,r;if(this._isTextPoint){var E=this._graphic.getNode().getBoundingClientRect();var F=t.__container.getBoundingClientRect();E=[{x:E.left-F.left,y:E.top-F.top},{x:E.right-F.left,y:E.top-F.top},{x:E.right-F.left,y:E.bottom-F.top},{x:E.left-F.left,y:E.bottom-F.top}]}else E=
this._getTransformedBoundingBox(this._graphic);A.forEach(E,function(u,D,z){K=u;(C=z[D+1])||(C=z[0]);r={x:(K.x+C.x)/2,y:(K.y+C.y)/2};k||(K=t.toMap(K),r=t.toMap(r));y.push([K.x,K.y]);y.push([r.x,r.y])});this._rotate&&(E=B.clone(y[1]),E=k?{x:E[0],y:E[1]}:t.toScreen({x:E[0],y:E[1],spatialReference:t.spatialReference}),E.y-=this._toolbar._options.rotateHandleOffset,k||(E=t.toMap(E)),y.push([E.x,E.y]));return y},_getTransformedBoundingBox:function(k){var t=this._map,y=k.geometry.getExtent(),K=k.geometry.spatialReference;
k=new f(y.xmin,y.ymax,K);y=new f(y.xmax,y.ymin,K);k=t.toScreen(k);y=t.toScreen(y);return[{x:k.x,y:k.y},{x:y.x,y:k.y},{x:y.x,y:y.y},{x:k.x,y:y.y}]},_getAllGraphics:function(){var k=[this._box];this._anchors&&A.forEach(this._anchors,function(t){k.push(t.graphic)});return k=A.filter(k,a.isDefined)},_getMoveable:function(k,t){var y=k.getDojoShape();if(y)return k=new e(y),k._index=t,this._connects.push(w.connect(k,"onMoveStart",this._moveStartHandler)),this._connects.push(w.connect(k,"onFirstMove",this._firstMoveHandler)),
this._connects.push(w.connect(k,"onMoveStop",this._moveStopHandler)),k.onMove=this._moveHandler,(y=y.getEventSource())&&p.set(y,"cursor",this._toolbar._cursors["box"+t]),k},_moveStartHandler:function(k){this._toolbar["on"+(8===k.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(k){this._toolbar._deactivateScrollWheel();var t=k.host._index,y=this._wrapOffset=k.host.shape._wrapOffsets[0]||0,K=this._graphic.getLayer().getNavigationTransform();k=A.map(this._getBoxCoords(!0),
function(r){return{x:r[0]+y,y:r[1]}});var C=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:k[1].x,y:k[3].y};this._centerCoord=l.multiplyPoint(l.invert(K),C);if(8===t)C=l.multiplyPoint(l.invert(K),k[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,C)),this._startLine=[this._centerCoord,C],this._moveLine=B.clone(this._startLine);else if(C=l.multiplyPoint(l.invert(K),k[t]),K=l.multiplyPoint(l.invert(K),k[(t+4)%8]),this._isTextPoint&&(this._centerCoord=
this._deNormalizePoint(this._centerCoord,C)),this._firstMoverToAnchor=Math.sqrt((C.x-this._centerCoord.x)*(C.x-this._centerCoord.x)+(C.y-this._centerCoord.y)*(C.y-this._centerCoord.y)),this._startBox=K,this._startBox.width=k[4].x-k[0].x,this._startBox.height=k[4].y-k[0].y,this._moveBox=B.clone(this._startBox),this._xfactor=C.x>K.x?1:-1,this._yfactor=C.y>K.y?1:-1,1===t||5===t)this._xfactor=0;else if(3===t||7===t)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===t?this._rotateEvent:
this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(k,t){k=k.host._index;var y=this._defaultEventArgs;y.angle=0;y.scaleX=1;y.scaleY=1;if(8===k){var K=this._startLine;var C=this._moveLine;var r=C[1];r.x+=t.dx;r.y+=t.dy;t=this._getAngle(K,C);this._isTextPoint&&(t+=this._graphic.symbol.angle);C=l.rotategAt(t,K[0]);this._graphic.getDojoShape().setTransform(C);y.transform=C;y.angle=t;y.around=K[0]}else{K=this._startBox;C=this._moveBox;C.width+=t.dx*this._xfactor;C.height+=t.dy*this._yfactor;
this._uniformScaling||this._isTextPoint?(K=C.x+this._xfactor*C.width,C=C.y+this._yfactor*C.height,K=Math.sqrt((K-this._centerCoord.x)*(K-this._centerCoord.x)+(C-this._centerCoord.y)*(C-this._centerCoord.y)),this._scaleRatio=t=r=K/this._firstMoverToAnchor,K=this._centerCoord):(t=C.width/K.width,r=C.height/K.height,K={x:K.x,y:K.y});if(isNaN(t)||Infinity===t||-Infinity===t)t=1;if(isNaN(r)||Infinity===r||-Infinity===r)r=1;C=l.scaleAt(t,r,K);if(this._isTextPoint){var E=l.rotategAt(this._graphic.symbol.angle,
K);this._graphic.getDojoShape().setTransform([E,C])}else this._graphic.getDojoShape().setTransform(C);y.transform=C;y.scaleX=t;y.scaleY=r;y.around=K}this._toolbar["on"+(8===k?this._rotateEvent:this._scaleEvent)](this._graphic,y)},_moveStopHandler:function(k){this._toolbar._activateScrollWheel();var t=this._graphic,y=this._toolbar,K=y._geo?d.geographicToWebMercator(t.geometry):t.geometry,C=K.spatialReference,r=t.getDojoShape(),E=r.getTransform(),F=t.getLayer().getNavigationTransform();this._isTextPoint?
(t=this._graphic.symbol,8===k.host._index?t.angle+=this._getAngle(this._startLine,this._moveLine):t.font.setSize(Math.round(t.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(t)):(K=K.toJson(),this._updateSegments(K.paths||K.rings,E,F,C),r.setTransform(null),K=c.fromJson(K),t.setGeometry(y._geo?d.webMercatorToGeographic(K,!0):K));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;y._endOperation("BOX");this._defaultEventArgs.transform=
E;y["on"+(8===k.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(k,t,y,K){var C=this._map,r=this._wrapOffset||0;A.forEach(k,function(E){A.forEach(E,function(F){this._updatePoint(F,K,r,l,C,y,t)},this)},this)},_updatePoint:function(k,t,y,K,C,r,E){t=C.toScreen({x:k[0],y:k[1],spatialReference:t},!0);t.x+=y;t=K.multiplyPoint([r,E,K.invert(r)],t);t.x-=y;y=C.toMap(t);k[0]=y.x;k[1]=y.y},_getAngle:function(k,t){return 180*Math.atan2(t[0].y-
t[1].y,t[0].x-t[1].x)/Math.PI-180*Math.atan2(k[0].y-k[1].y,k[0].x-k[1].x)/Math.PI},_deNormalizePoint:function(k,t){var y=this._map._getFrameWidth();if(-1===y)return k;for(k={x:k.x,y:k.y};Math.abs(k.x-t.x)>=y;)k.x=k.x<t.x?k.x+y:k.x-y;var K=Math.abs(k.x-t.x);Math.abs(k.x-t.x+y)<K?k.x+=y:Math.abs(k.x-t.x-y)<K&&(k.x-=y);return k}});h("extend-esri")&&B.setObject("toolbars._Box",G,b);return G})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(G,B,A,w,q,h,p,e,l,b){return B("dojox.gfx.Moveable",null,{constructor:function(a,f){this.shape=a;this.delay=f&&0<f.delay?f.delay:0;this.mover=f&&f.mover?f.mover:l;this.leftButtonOnly=f&&f.leftButtonOnly;this.events=[this.shape.on(h.press,G.hitch(this,"onMouseDown"))]},destroy:function(){A.forEach(this.events,function(a){a.remove()});this.events=this.shape=null},onMouseDown:function(a){this.delay?(this.events.push(this.shape.on(h.move,G.hitch(this,"onMouseMove")),this.shape.on(h.release,G.hitch(this,
"onMouseUp"))),this._lastX=a.clientX,this._lastY=a.clientY):this.leftButtonOnly&&!b.isLeft(a)||new this.mover(this.shape,a,this);w.stop(a)},onMouseMove:function(a){var f=a.clientY;if(Math.abs(a.clientX-this._lastX)>this.delay||Math.abs(f-this._lastY)>this.delay)this.onMouseUp(a),new this.mover(this.shape,a,this);w.stop(a)},onMouseUp:function(a){this.events.pop().remove()},onMoveStart:function(a){q.publish("/gfx/move/start",a);p.add(e.body(),"dojoMove")},onMoveStop:function(a){q.publish("/gfx/move/stop",
a);p.remove(e.body(),"dojoMove")},onFirstMove:function(a){},onMove:function(a,f,n){this.onMoving(a,f,n);this.shape.applyLeftTransform(f);this.onMoved(a,f)},onMoving:function(a,f){},onMoved:function(a,f){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(G,B,A,w,q,h){return A("dojox.gfx.Mover",null,{constructor:function(p,e,l){this.shape=p;this.lastX=e.clientX;this.lastY=e.clientY;p=this.host=l;e=
document;l=w(e,q.move,G.hitch(this,"onFirstMove"));this.events=[w(e,q.move,G.hitch(this,"onMouseMove")),w(e,q.release,G.hitch(this,"destroy")),w(e,"dragstart",G.hitch(h,"stop")),w(e,"selectstart",G.hitch(h,"stop")),l];if(p&&p.onMoveStart)p.onMoveStart(this)},onMouseMove:function(p){var e=p.clientX,l=p.clientY;this.host.onMove(this,{dx:e-this.lastX,dy:l-this.lastY},p);this.lastX=e;this.lastY=l;h.stop(p)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){B.forEach(this.events,
function(e){e.remove()});var p=this.host;if(p&&p.onMoveStop)p.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f,n,m){var d=G(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(c,g,k,t){this.graphic=c;this.map=g;this.toolbar=k;this.tempPt=t;this._enableGraphicMover();this._moved=!1},refresh:function(c){var g=this.graphic.getDojoShape();!g||!c&&g._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var c=this.graphic,g=c.getDojoShape();g&&(g._hostGraphic=c,this._moveable=new h(g,{mover:d.Mover}),this._moveStartHandle=
A.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=A.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=A.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=A.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(c=g.getEventSource())&&q.set(c,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var c=this._moveable;if(c){A.disconnect(this._moveStartHandle);A.disconnect(this._firstMoveHandle);
A.disconnect(this._movingHandle);A.disconnect(this._moveStopHandle);var g=c.shape;g&&(g._hostGraphic=null,(g=g.getEventSource())&&q.set(g,"cursor","inherit"));c.destroy()}this._moveable=null},_moveStartHandler:function(){var c=this.graphic,g=this.map;this._startTx=c.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&g.snappingManager&&g.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(c)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(c,g,k){c=c.shape.getTransform();g=this.map;var t;a("esri-pointer")?t=g.navigationManager.pointerEvents._processTouchEvent(k,k):k&&"pointermove"===k.type&&(t=b.prototype._processTouchEvent.call({map:g},k,k));t&&g.snappingManager&&g.snappingManager._onSnappingMouseMoveHandler(t);this.tempPt&&this.tempPt.getDojoShape().setTransform(c);this.toolbar.onGraphicMove(this.graphic,c)},_moveStopHandler:function(c){var g=this.graphic,k=this.toolbar,t=this.map,y=k._geo?f.geographicToWebMercator(g.geometry):
g.geometry,K=y.type,C=g.getDojoShape(),r=C.getTransform();if(w.toJson(r)!==w.toJson(this._startTx)){this._moved=!0;switch(K){case "point":K=[r,e.invert(this._startTx)];if(t.snappingManager)var E=t.snappingManager._snappingPoint;y=E||t.toMap(e.multiplyPoint(K,t.toScreen(y,!0)));t.snappingManager&&t.snappingManager._killOffSnapping();break;case "polyline":y=this._updatePolyGeometry(y,y.paths,r);break;case "polygon":y=this._updatePolyGeometry(y,y.rings,r)}C.setTransform(null);g.setGeometry(k._geo?f.webMercatorToGeographic(y,
!0):y);this.tempPt&&this.tempPt.setGeometry(new m(g.geometry.toJson()))}else this._moved=!1;k._endOperation("MOVE");k.onGraphicMoveStop(g,r);this._moved||(c=c.__e,t=this.map.position,c=new n(c.pageX-t.x,c.pageY-t.y),k.onGraphicClick(g,{screenPoint:c,mapPoint:this.map.toMap(c)}))},_updatePolyGeometry:function(c,g,k){var t=this.map,y=c.getPoint(0,0);t=t.toMap(t.toScreen(y).offset(k.dx,k.dy));k=t.x-y.x;y=t.y-y.y;var K;for(t=0;t<g.length;t++){var C=g[t];for(K=0;K<C.length;K++){var r=c.getPoint(t,K);c.setPoint(t,
K,r.offset(k,y))}}return c}});d.Mover=G(p,{declaredClass:"esri.toolbars._Mover",constructor:function(c,g,k){this.__e=g}});a("extend-esri")&&(B.setObject("toolbars._GraphicMover",d,l),B.setObject("toolbars._Mover",d.Mover,l));return d})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(G,
B,A,w,q,h,p,e,l,b,a,f){var n=G(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(m,d,c){this.graphic=m;this.map=d;this.toolbar=c;m=c._options;this._symbol1=m.vertexSymbol;this._symbol2=m.ghostVertexSymbol;d=m.ghostLineSymbol;this._lineStroke={style:d.style,width:d.width,color:d.color};this._canDel=m.allowDeleteVertices;this._canAdd=m.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(m){m?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=A.connect(l,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=A.connect(l,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var m=this._getGraphicsLayer();this._mouseOverHandle=A.connect(m,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=A.connect(m,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new h({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),m=this._ctxDelete=new p({label:f.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
A.connect(m,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(m),this._ctxMenu.startup())},_removeControllers:function(){A.disconnect(this._firstMoveHandle);A.disconnect(this._moveStopHandle);A.disconnect(this._mouseOverHandle);A.disconnect(this._mouseOutHandle);A.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(m,d,c){var g,k,t=this.graphic,y=[];for(g=0;g<m.length;g++){var K=m[g],C=[];for(k=0;k<K.length;k++)C.push(new l(K[k],d,t,g,k,K.length,this,c));y.push(C)}return y},_remove:function(m){m&&w.forEach(m,function(d){w.forEach(d,function(c){c.destroy()})})},_refresh:function(m){m&&w.forEach(m,function(d){w.forEach(d,function(c){c.refresh()})})},_isNew:function(m){return-1===w.indexOf(this._vertexMovers[m.segIndex],m)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(m){m=this._selectedMover;this._updateRelatedGraphic(m,m.relatedGraphic,m.graphic.geometry,m.segIndex,m.ptIndex,m.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(m);this._deleteVertex(m);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(m){m=m.graphic;var d=this._findMover(m);d&&(this.toolbar.onVertexMouseOver(this.graphic,d._getInfo()),d._placeholder||(this._selectedMover=d,this._canDel&&this._bindCtxNode(m.getDojoShape().getNode())))},_mouseOutHandler:function(m){if(m=
this._findMover(m.graphic))this.toolbar.onVertexMouseOut(this.graphic,m._getInfo())},_bindCtxNode:function(m){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(m);this._bindNode=m},_unbindCtxNode:function(){var m=this._bindNode;m&&this._ctxMenu.unBindDomNode(m)},_findMover:function(m){var d=[];var c=this._mpVertexMovers;w.forEach(this._vertexMovers,function(k){d=d.concat(k)});c&&w.forEach(c,function(k){d=d.concat(k)});
for(c=0;c<d.length;c++){var g=d[c];if(g.graphic===m)return g}},_firstMoveHandler:function(m){!this._isNew(m)&&this._canAdd&&this._hideRelatedMidpoints(m);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(m,d){var c=this._isNew(m);d&&(d.dx||d.dy)?(this._updateRelatedGraphic(m,m.relatedGraphic,m.graphic.geometry,m.segIndex,m.ptIndex,m.segLength,c),this._canAdd&&(c?this._addMidpoints(m):(this._repositionRelatedMidpoints(m),this._showRelatedMidpoints(m))),this.toolbar._endOperation("VERTICES")):
!c&&this._canAdd&&this._showRelatedMidpoints(m)},_showRelatedMidpoints:function(m){var d=this._getAdjacentMidpoints(m.ptIndex,m.segLength),c=this._mpVertexMovers[m.segIndex];for(m=0;m<d.length;m++){var g=c[d[m]];g.graphic.show();g.refresh()}},_hideRelatedMidpoints:function(m){var d=this._getAdjacentMidpoints(m.ptIndex,m.segLength),c=this._mpVertexMovers[m.segIndex];for(m=0;m<d.length;m++)c[d[m]].graphic.hide()},_repositionRelatedMidpoints:function(m){var d,c=this._getAdjacentMidpoints(m.ptIndex,m.segLength),
g=this._mpVertexMovers[m.segIndex];for(d=0;d<c.length;d++){var k=this._getAdjacentVertices(c[d],m.segLength),t=m.relatedGraphic.geometry.getPoint(m.segIndex,k[0]);k=m.relatedGraphic.geometry.getPoint(m.segIndex,k[1]);t=new b({x:(t.x+k.x)/2,y:(t.y+k.y)/2,spatialReference:t.spatialReference.toJson()});g[c[d]].graphic.setGeometry(t)}},_addMidpoints:function(m){var d=m.segIndex,c=m.ptIndex,g=m.segLength,k=c+1,t,y=g+1;this._mpVertexMovers[d].splice(c,1);var K=this._vertexMovers[d];for(t=0;t<k;t++)K[t].segLength+=
1;for(t=k;t<K.length;t++)K[t].ptIndex+=1,K[t].segLength+=1;m.ptIndex=k;m.segLength=K.length+1;K.splice(k,0,m);m.graphic.setSymbol(this._symbol1);K=this._mpVertexMovers[d];for(t=0;t<c;t++)K[t].segLength+=1;for(t=c;t<g-1;t++)K[t].ptIndex+=1,K[t].segLength+=1;k=this._getAdjacentVertices(c,y);d=this._getAdjacentVertices(c+1,y);g=m.relatedGraphic.geometry.getPoint(m.segIndex,k[0]);t=m.relatedGraphic.geometry.getPoint(m.segIndex,k[1]);k=new b({x:(g.x+t.x)/2,y:(g.y+t.y)/2,spatialReference:g.spatialReference.toJson()});
g=m.relatedGraphic.geometry.getPoint(m.segIndex,d[0]);t=m.relatedGraphic.geometry.getPoint(m.segIndex,d[1]);d=new b({x:(g.x+t.x)/2,y:(g.y+t.y)/2,spatialReference:g.spatialReference.toJson()});g=new l(k,this._symbol2,this.graphic,m.segIndex,c,y,this,!0);m=new l(d,this._symbol2,this.graphic,m.segIndex,c+1,y,this,!0);K.splice(c,0,g,m)},_deleteVertex:function(m){var d,c=m.ptIndex,g=this._vertexMovers[m.segIndex];for(d=0;d<c;d++)--g[d].segLength;for(d=c+1;d<g.length;d++){var k=g[d];--k.ptIndex;--k.segLength}g.splice(c,
1);d=m._getInfo();m.destroy();this.toolbar.onVertexDelete(this.graphic,d)}});B.mixin(n,{create:function(m,d,c){switch(m.geometry.type){case "multipoint":return new n.MultipointVertexEditor(m,d,c);case "polyline":return new n.PolylineVertexEditor(m,d,c);case "polygon":return new n.PolygonVertexEditor(m,d,c)}}});n.MultipointVertexEditor=G(n,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=A.connect(l,"onMoveStart",this,this._moveStartHandler);
A.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);A.disconnect(this._moveStartHandle)},_getSegments:function(m){var d=m.points,c=[],g=m.spatialReference;for(m=0;m<d.length;m++){var k=d[m];c.push(new b({x:k[0],y:k[1],spatialReference:g.toJson()}))}return[c]},_getMidpointSegments:function(m){return[]},_getControlPoints:function(m,d,c,g,k){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(m){var d=m.graphic;if(m=this._findMover(m))this.toolbar.onVertexMouseOver(d,
m._getInfo()),this._selectedMover=m,this._canDel&&this._bindCtxNode(m.graphic.getDojoShape().getNode())},_mouseOutHandler:function(m){var d=m.graphic;if(m=this._findMover(m))this.toolbar.onVertexMouseOut(d,m._getInfo())},_findMover:function(m){var d=[].concat(this._vertexMovers[0]),c=m.target;for(m=0;m<d.length;m++){var g=d[m];if(g.graphic.getDojoShape().getNode()===c)return g}},_moveStartHandler:function(m){var d=m.ptIndex,c=m.segLength-1,g=m.relatedGraphic.geometry.points;m=g.splice(d,1);g.push(m[0]);
g=this._vertexMovers[0];for(m=c;m>d;m--)--g[m].ptIndex;m=g.splice(d,1);g.push(m[0]);m[0].ptIndex=c},_moveStopHandler:function(m){this._updateRelatedGraphic(m,m.relatedGraphic,m.graphic.geometry,m.segIndex,m.ptIndex,m.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(m,d,c,g,k,t,y,K){m=d.geometry;K?m.removePoint(k):m.setPoint(k,c);d.setGeometry(m)},_deleteMidpoints:function(m){}});n.PolylineVertexEditor=G(n,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(m){var d,c,g=m.paths,k=[];for(d=0;d<g.length;d++){var t=g[d],y=[];for(c=0;c<t.length;c++)y.push(m.getPoint(d,c));k.push(y)}return k},_getMidpointSegments:function(m){var d,c,g=m.paths,k=[],t=m.spatialReference;for(d=0;d<g.length;d++){var y=g[d],K=[];for(c=0;c<y.length-1;c++){var C=m.getPoint(d,c),r=m.getPoint(d,c+1);C=new b({x:(C.x+r.x)/2,y:(C.y+r.y)/2,spatialReference:t.toJson()});K.push(C)}k.push(K)}return k},_getControlPoints:function(m,d,c,g,k){var t=this.map,y,K;this._isNew(m)?
(m=g,g+=1,0<=m&&(y=t.toScreen(d.getPoint(c,m))),g<=k&&(K=t.toScreen(d.getPoint(c,g)))):(m=g-1,g+=1,0<=m&&(y=t.toScreen(d.getPoint(c,m))),g<k&&(K=t.toScreen(d.getPoint(c,g))));return[y,K]},_getAdjacentMidpoints:function(m,d){var c=[],g=m-1;0<=g&&c.push(g);m<d-1&&c.push(m);return c},_getAdjacentVertices:function(m,d){return[m,m+1]},_deleteMidpoints:function(m){var d=this._mpVertexMovers[m.segIndex],c=d.length-1,g=this._getAdjacentMidpoints(m.ptIndex,m.segLength).sort(),k,t=g[0];for(k=0;k<t;k++)--d[k].segLength;
for(k=t+1;k<d.length;k++){var y=d[k];--y.ptIndex;--y.segLength}if(1===g.length)d.splice(t,1)[0].destroy();else for(y=this._getAdjacentVertices(t,c),k=m.relatedGraphic.geometry.getPoint(m.segIndex,y[0]),y=m.relatedGraphic.geometry.getPoint(m.segIndex,y[1]),k=new b({x:(k.x+y.x)/2,y:(k.y+y.y)/2,spatialReference:k.spatialReference.toJson()}),m=new l(k,this._symbol2,this.graphic,m.segIndex,t,c,this,!0),d=d.splice(t,g.length,m),k=0;k<d.length;k++)d[k].destroy()},_updateRelatedGraphic:function(m,d,c,g,k,
t,y,K){m=d.geometry;y?m.insertPoint(g,k+1,a.fromJson(c.toJson())):K?m.removePoint(g,k):m.setPoint(g,k,a.fromJson(c.toJson()));d.setGeometry(m)}});n.PolygonVertexEditor=G(n,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(m){var d,c,g=m.rings,k=[];for(d=0;d<g.length;d++){var t=g[d],y=[];for(c=0;c<t.length-1;c++)y.push(m.getPoint(d,c));k.push(y)}return k},_getMidpointSegments:function(m){var d,c,g=m.rings,k=[],t=m.spatialReference;for(d=0;d<g.length;d++){var y=g[d],
K=[];for(c=0;c<y.length-1;c++){var C=m.getPoint(d,c),r=m.getPoint(d,c+1);C=new b({x:(C.x+r.x)/2,y:(C.y+r.y)/2,spatialReference:t.toJson()});K.push(C)}k.push(K)}return k},_getControlPoints:function(m,d,c,g,k){var t=this.map;this._isNew(m)?m=g:(m=g-1,m=0>m?(k+m)%k:m);g=(g+1)%k;k=t.toScreen(d.getPoint(c,m));d=t.toScreen(d.getPoint(c,g));return[k,d]},_getAdjacentMidpoints:function(m,d){var c=m-1;return[0>c?(d+c)%d:c,m]},_getAdjacentVertices:function(m,d){return[m,(m+1)%d]},_deleteMidpoints:function(m){var d=
m.ptIndex,c=this._mpVertexMovers[m.segIndex],g=c.length-1,k=this._getAdjacentMidpoints(d,m.segLength).sort();var t=k[0];var y=k[k.length-1];if(0===d){var K=this._getAdjacentVertices(g-1,g);d=m.relatedGraphic.geometry.getPoint(m.segIndex,K[0]);K=m.relatedGraphic.geometry.getPoint(m.segIndex,K[1]);d=new b({x:(d.x+K.x)/2,y:(d.y+K.y)/2,spatialReference:d.spatialReference.toJson()});m=new l(d,this._symbol2,this.graphic,m.segIndex,g-1,g,this,!0);c.splice(y,1,m)[0].destroy();c.splice(t,1)[0].destroy();for(k=
0;k<c.length-1;k++)t=c[k],--t.ptIndex,--t.segLength}else{K=this._getAdjacentVertices(t,g);d=m.relatedGraphic.geometry.getPoint(m.segIndex,K[0]);K=m.relatedGraphic.geometry.getPoint(m.segIndex,K[1]);d=new b({x:(d.x+K.x)/2,y:(d.y+K.y)/2,spatialReference:d.spatialReference.toJson()});m=new l(d,this._symbol2,this.graphic,m.segIndex,t,g,this,!0);y=c.splice(t,k.length,m);for(k=0;k<y.length;k++)y[k].destroy();for(k=0;k<t;k++)--c[k].segLength;for(k=t+1;k<c.length;k++)t=c[k],--t.ptIndex,--t.segLength}},_updateRelatedGraphic:function(m,
d,c,g,k,t,y,K){m=d.geometry;y?m.insertPoint(g,k+1,a.fromJson(c.toJson())):K?(m.removePoint(g,k),0===k&&m.setPoint(g,t-1,a.fromJson(m.getPoint(g,0).toJson()))):(m.setPoint(g,k,a.fromJson(c.toJson())),0===k&&m.setPoint(g,t,a.fromJson(c.toJson())));d.setGeometry(m)}});q("extend-esri")&&(B.setObject("toolbars._GraphicVertexEditor",n,e),B.setObject("toolbars._MultipointVertexEditor",n.MultipointVertexEditor,e),B.setObject("toolbars._PolylineVertexEditor",n.PolylineVertexEditor,e),B.setObject("toolbars._PolygonVertexEditor",
n.PolygonVertexEditor,e));return n})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c){a("dijit-legacy-requires")&&c(0,function(){G(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return A("dijit.Menu",d,{constructor:function(){this._bindings=
[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):B.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(g){return n.get(this._iframeContentDocument(g))||this._iframeContentDocument(g).__parent__||g.name&&document.frames[g.name]||null},_iframeContentDocument:function(g){return g.contentDocument||g.contentWindow&&g.contentWindow.document||
g.name&&document.frames[g.name]&&document.frames[g.name].document||null},bindDomNode:function(g){g=w.byId(g,this.ownerDocument);if("iframe"==g.tagName.toLowerCase()){var k=g;var t=this._iframeContentWindow(k);t=f.body(t.document)}else t=g==f.body(this.ownerDocument)?this.ownerDocument.documentElement:g;var y={node:g,iframe:k};q.set(g,"_dijitMenu"+this.id,this._bindings.push(y));var K=l.hitch(this,function(C){var r=this.selector,E=r?function(u){return b.selector(r,u)}:function(u){return u},F=this;
return[b(C,E(this.leftClickToOpen?"click":"contextmenu"),function(u){u.stopPropagation();u.preventDefault();(new Date).getTime()<F._lastKeyDown+500||F._scheduleOpen(this,k,{x:u.pageX,y:u.pageY},u.target)}),b(C,E("keydown"),function(u){if(93==u.keyCode||u.shiftKey&&u.keyCode==e.F10||F.leftClickToOpen&&u.keyCode==e.SPACE)u.stopPropagation(),u.preventDefault(),F._scheduleOpen(this,k,null,u.target),F._lastKeyDown=(new Date).getTime()})]});y.connects=t?K(t):[];k&&(y.onloadHandler=l.hitch(this,function(){var C=
this._iframeContentWindow(k);C=f.body(C.document);y.connects=K(C)}),k.addEventListener?k.addEventListener("load",y.onloadHandler,!1):k.attachEvent("onload",y.onloadHandler))},unBindDomNode:function(g){try{var k=w.byId(g,this.ownerDocument)}catch(C){return}g="_dijitMenu"+this.id;if(k&&q.has(k,g)){for(var t=q.get(k,g)-1,y=this._bindings[t],K;K=y.connects.pop();)K.remove();(K=y.iframe)&&(K.removeEventListener?K.removeEventListener("load",y.onloadHandler,!1):K.detachEvent("onload",y.onloadHandler));q.remove(k,
g);delete this._bindings[t]}},_scheduleOpen:function(g,k,t,y){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:y,delegatedTarget:g,iframe:k,coords:t})},1))},_openMyself:function(g){function k(){u.refocus&&D&&D.focus();m.close(u)}var t=g.target,y=g.iframe,K=g.coords,C=!K;this.currentTarget=g.delegatedTarget;if(K){if(y){g=h.position(y,!0);t=this._iframeContentWindow(y);t=h.docScroll(t.document);var r=p.getComputedStyle(y),E=p.toPixelValue,F=(a("ie")&&
a("quirks")?0:E(y,r.paddingLeft))+(a("ie")&&a("quirks")?E(y,r.borderLeftWidth):0);y=(a("ie")&&a("quirks")?0:E(y,r.paddingTop))+(a("ie")&&a("quirks")?E(y,r.borderTopWidth):0);K.x+=g.x+F-t.x;K.y+=g.y+y-t.y}}else K=h.position(t,!0),K.x+=10,K.y+=10;var u=this;y=this._focusManager.get("prevNode");g=this._focusManager.get("curNode");var D=!g||w.isDescendant(g,this.domNode)?y:g;m.open({popup:this,x:K.x,y:K.y,onExecute:k,onCancel:k,orient:this.isLeftToRight()?"L":"R"});this.focus();C||this.defer(function(){this._cleanUp(!0)});
this._onBlur=function(){this.inherited("_onBlur",arguments);m.close(this)}},destroy:function(){B.forEach(this._bindings,function(g){g&&this.unBindDomNode(g.node)},this);this.inherited(arguments)}})})},"dijit/popup":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main dojo/touch".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f,
n,m,d,c){function g(){this._popupWrapper&&(h.destroy(this._popupWrapper),delete this._popupWrapper)}A=A(null,{_stack:[],_beginZIndex:1E3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var k=this._firstAroundPosition,t=p.position(this._firstAroundNode,!0),y=t.x-k.x;k=t.y-k.y;if(y||k)for(this._firstAroundPosition=t,t=0;t<this._stack.length;t++){var K=this._stack[t].wrapper.style;K.top=parseFloat(K.top)+k+"px";"auto"==K.right?K.left=parseFloat(K.left)+y+"px":K.right=parseFloat(K.right)-
y+"px"}this._aroundMoveListener=setTimeout(a.hitch(this,"_repositionAll"),y||k?10:50)}},_createWrapper:function(k){var t=k._popupWrapper,y=k.domNode;t||(t=h.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":k["aria-label"]||k.label||k.name||k.id},k.ownerDocumentBody),t.appendChild(y),y=y.style,y.display="",y.visibility="",y.position="",y.top="0px",k._popupWrapper=t,B.after(k,"destroy",g,!0),"ontouchend"in document&&f(t,"touchend",function(K){/^(input|button|textarea)$/i.test(K.target.tagName)||
K.preventDefault()}),t.dojoClick=!0);return t},moveOffScreen:function(k){var t=this._createWrapper(k);k=p.isBodyLtr(k.ownerDocument);var y={visibility:"hidden",top:"-9999px",display:""};y[k?"left":"right"]="-9999px";y[k?"right":"left"]="auto";e.set(t,y);return t},hide:function(k){var t=this._createWrapper(k);e.set(t,{display:"none",height:"auto",overflowY:"visible",border:""});k=k.domNode;"_originalStyle"in k&&(k.style.cssText=k._originalStyle)},getTopPopup:function(){for(var k=this._stack,t=k.length-
1;0<t&&k[t].parent===k[t-1].widget;t--);return k[t]},open:function(k){for(var t=this._stack,y=k.popup,K=y.domNode,C=k.orient||["below","below-alt","above","above-alt"],r=k.parent?k.parent.isLeftToRight():p.isBodyLtr(y.ownerDocument),E=k.around,F=k.around&&k.around.id?k.around.id+"_dropdown":"popup_"+this._idGen++;t.length&&(!k.parent||!w.isDescendant(k.parent.domNode,t[t.length-1].widget.domNode));)this.close(t[t.length-1].widget);var u=this.moveOffScreen(y);y.startup&&!y._started&&y.startup();var D=
p.position(K);if("maxHeight"in k&&-1!=k.maxHeight)var z=k.maxHeight||Infinity;else{z=d.getEffectiveBox(this.ownerDocument);var M=E?p.position(E,!1):{y:k.y-(k.padding||0),h:2*(k.padding||0)};z=Math.floor(Math.max(M.y,z.h-(M.y+M.h)))}D.h>z&&(D=e.getComputedStyle(K),e.set(u,{overflowY:"scroll",height:z+"px",border:D.borderLeftWidth+" "+D.borderLeftStyle+" "+D.borderLeftColor}),K._originalStyle=K.style.cssText,K.style.border="none");q.set(u,{id:F,style:{zIndex:this._beginZIndex+t.length},"class":"dijitPopup "+
(y.baseClass||y["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:k.parent?k.parent.id:""});0==t.length&&E&&(this._firstAroundNode=E,this._firstAroundPosition=p.position(E,!0),this._aroundMoveListener=setTimeout(a.hitch(this,"_repositionAll"),50));l("config-bgIframe")&&!y.bgIframe&&(y.bgIframe=new m(u));F=y.orient?a.hitch(y,"orient"):null;C=E?n.around(u,E,C,r,F):n.at(u,k,"R"==C?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],k.padding,F);u.style.visibility="visible";K.style.visibility="visible";K=
[];K.push(f(u,"keydown",a.hitch(this,function(H){if(H.keyCode==b.ESCAPE&&k.onCancel)H.stopPropagation(),H.preventDefault(),k.onCancel();else if(H.keyCode==b.TAB&&(H.stopPropagation(),H.preventDefault(),(H=this.getTopPopup())&&H.onCancel))H.onCancel()})));y.onCancel&&k.onCancel&&K.push(y.on("cancel",k.onCancel));K.push(y.on(y.onExecute?"execute":"change",a.hitch(this,function(){var H=this.getTopPopup();if(H&&H.onExecute)H.onExecute()})));t.push({widget:y,wrapper:u,parent:k.parent,onExecute:k.onExecute,
onCancel:k.onCancel,onClose:k.onClose,handlers:K});if(y.onOpen)y.onOpen(C);return C},close:function(k){for(var t=this._stack;k&&G.some(t,function(E){return E.widget==k})||!k&&t.length;){var y=t.pop(),K=y.widget,C=y.onClose;K.bgIframe&&(K.bgIframe.destroy(),delete K.bgIframe);if(K.onClose)K.onClose();for(var r;r=y.handlers.pop();)r.remove();K&&K.domNode&&this.hide(K);C&&C()}0==t.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=
this._aroundMoveListener=null)}});return c.popup=new A})},"dijit/place":function(){define("dojo/_base/array dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/_base/window ./Viewport ./main".split(" "),function(G,B,A,w,q,h,p){function e(b,a,f,n){var m=h.getEffectiveBox(b.ownerDocument);b.parentNode&&"body"==String(b.parentNode.tagName).toLowerCase()||q.body(b.ownerDocument).appendChild(b);var d=null;G.some(a,function(k){var t=k.corner,y=k.pos,K=0,C={w:{L:m.l+m.w-y.x,R:y.x-m.l,M:m.w}[t.charAt(1)],
h:{T:m.t+m.h-y.y,B:y.y-m.t,M:m.h}[t.charAt(0)]},r=b.style;r.left=r.right="auto";f&&(K=f(b,k.aroundCorner,t,C,n),K="undefined"==typeof K?0:K);var E=b.style,F=E.display,u=E.visibility;"none"==E.display&&(E.visibility="hidden",E.display="");r=B.position(b);E.display=F;E.visibility=u;F={L:y.x,R:y.x-r.w,M:Math.max(m.l,Math.min(m.l+m.w,y.x+(r.w>>1))-r.w)}[t.charAt(1)];u={T:y.y,B:y.y-r.h,M:Math.max(m.t,Math.min(m.t+m.h,y.y+(r.h>>1))-r.h)}[t.charAt(0)];y=Math.max(m.l,F);E=Math.max(m.t,u);F=Math.min(m.l+m.w,
F+r.w)-y;u=Math.min(m.t+m.h,u+r.h)-E;K+=r.w-F+(r.h-u);if(null==d||K<d.overflow)d={corner:t,aroundCorner:k.aroundCorner,x:y,y:E,w:F,h:u,overflow:K,spaceAvailable:C};return!K});d.overflow&&f&&f(b,d.aroundCorner,d.corner,d.spaceAvailable,n);a=d.y;var c=d.x,g=q.body(b.ownerDocument);/relative|absolute/.test(A.get(g,"position"))&&(a-=A.get(g,"marginTop"),c-=A.get(g,"marginLeft"));g=b.style;g.top=a+"px";g.left=c+"px";g.right="auto";return d}var l={TL:"BR",TR:"BL",BL:"TR",BR:"TL"};return p.place={at:function(b,
a,f,n,m){f=G.map(f,function(d){var c={corner:d,aroundCorner:l[d],pos:{x:a.x,y:a.y}};n&&(c.pos.x+="L"==d.charAt(1)?n.x:-n.x,c.pos.y+="T"==d.charAt(0)?n.y:-n.y);return c});return e(b,f,m)},around:function(b,a,f,n,m){function d(D,z){u.push({aroundCorner:D,corner:z,pos:{x:{L:C,R:C+E,M:C+(E>>1)}[D.charAt(1)],y:{T:r,B:r+F,M:r+(F>>1)}[D.charAt(0)]}})}if("string"==typeof a||"offsetWidth"in a||"ownerSVGElement"in a){var c=B.position(a,!0);if(/^(above|below)/.test(f[0])){var g=B.getBorderExtents(a),k=a.firstChild?
B.getBorderExtents(a.firstChild):{t:0,l:0,b:0,r:0},t=B.getBorderExtents(b),y=b.firstChild?B.getBorderExtents(b.firstChild):{t:0,l:0,b:0,r:0};c.y+=Math.min(g.t+k.t,t.t+y.t);c.h-=Math.min(g.t+k.t,t.t+y.t)+Math.min(g.b+k.b,t.b+y.b)}}else c=a;if(a.parentNode)for(g="absolute"==A.getComputedStyle(a).position,a=a.parentNode;a&&1==a.nodeType&&"BODY"!=a.nodeName;){k=B.position(a,!0);t=A.getComputedStyle(a);/relative|absolute/.test(t.position)&&(g=!1);if(!g&&/hidden|auto|scroll/.test(t.overflow)){y=Math.min(c.y+
c.h,k.y+k.h);var K=Math.min(c.x+c.w,k.x+k.w);c.x=Math.max(c.x,k.x);c.y=Math.max(c.y,k.y);c.h=y-c.y;c.w=K-c.x}"absolute"==t.position&&(g=!0);a=a.parentNode}var C=c.x,r=c.y,E="w"in c?c.w:c.w=c.width,F="h"in c?c.h:(w.deprecated("place.around: dijit/place.__Rectangle: { x:"+C+", y:"+r+", height:"+c.height+", width:"+E+" } has been deprecated.  Please use { x:"+C+", y:"+r+", h:"+c.height+", w:"+E+" }","","2.0"),c.h=c.height),u=[];G.forEach(f,function(D){var z=n;switch(D){case "above-centered":d("TM","BM");
break;case "below-centered":d("BM","TM");break;case "after-centered":z=!z;case "before-centered":d(z?"ML":"MR",z?"MR":"ML");break;case "after":z=!z;case "before":d(z?"TL":"TR",z?"TR":"TL");d(z?"BL":"BR",z?"BR":"BL");break;case "below-alt":z=!z;case "below":d(z?"BL":"BR",z?"TL":"TR");d(z?"BR":"BL",z?"TR":"TL");break;case "above-alt":z=!z;case "above":d(z?"TL":"TR",z?"BL":"BR");d(z?"TR":"TL",z?"BR":"BL");break;default:d(D.aroundCorner,D.corner)}});b=e(b,u,m,{w:E,h:F});b.aroundNodePos=c;return b}}})},
"dijit/Viewport":function(){define(["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],function(G,B,A,w,q){var h=new G,p;A(function(){var e=q.getBox();h._rlh=B(window,"resize",function(){var b=q.getBox();if(e.h!=b.h||e.w!=b.w)e=b,h.emit("resize")});if(8==w("ie")){var l=screen.deviceXDPI;setInterval(function(){screen.deviceXDPI!=l&&(l=screen.deviceXDPI,h.emit("resize"))},500)}w("ios")&&(B(document,"focusin",function(b){p=b.target}),B(document,"focusout",function(b){p=null}))});h.getEffectiveBox=
function(e){e=q.getBox(e);var l=p&&p.tagName&&p.tagName.toLowerCase();w("ios")&&p&&!p.readOnly&&("textarea"==l||"input"==l&&/^(color|email|number|password|search|tel|text|url)$/.test(p.type))&&(e.h*=0==orientation||180==orientation?.66:.4,l=p.getBoundingClientRect(),e.h=Math.max(e.h,l.top+l.height));return e};return h})},"dijit/BackgroundIframe":function(){define("require ./main dojo/_base/config dojo/dom-construct dojo/dom-style dojo/_base/lang dojo/on dojo/sniff".split(" "),function(G,B,A,w,q,h,
p,e){e.add("config-bgIframe",(e("ie")||e("trident"))&&!/IEMobile\/10\.0/.test(navigator.userAgent));var l=new function(){var b=[];this.pop=function(){if(b.length){var a=b.pop();a.style.display=""}else 9>e("ie")?(a=A.dojoBlankHtmlUrl||G.toUrl("dojo/resources/blank.html")||'javascript:""',a=document.createElement("\x3ciframe src\x3d'"+a+"' role\x3d'presentation' style\x3d'position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity\x3d\"0\");'\x3e")):(a=w.create("iframe"),a.src='javascript:""',
a.className="dijitBackgroundIframe",a.setAttribute("role","presentation"),q.set(a,"opacity",.1)),a.tabIndex=-1;return a};this.push=function(a){a.style.display="none";b.push(a)}};B.BackgroundIframe=function(b){if(!b.id)throw Error("no id");if(e("config-bgIframe")){var a=this.iframe=l.pop();b.appendChild(a);7>e("ie")||e("quirks")?(this.resize(b),this._conn=p(b,"resize",h.hitch(this,"resize",b))):q.set(a,{width:"100%",height:"100%"})}};h.extend(B.BackgroundIframe,{resize:function(b){this.iframe&&q.set(this.iframe,
{width:b.offsetWidth+"px",height:b.offsetHeight+"px"})},destroy:function(){this._conn&&(this._conn.remove(),this._conn=null);this.iframe&&(this.iframe.parentNode.removeChild(this.iframe),l.push(this.iframe),delete this.iframe)}});return B.BackgroundIframe})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(G,B,A,w){return G("dijit.DropDownMenu",w,{templateString:A,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},
_onDownArrow:function(){this.focusNext()},_onRightArrow:function(q){this._moveToPopup(q);q.stopPropagation();q.preventDefault()},_onLeftArrow:function(q){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else q.stopPropagation(),q.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d){return B("dijit._MenuBase",[f,d,m,n],{selected:null,_setSelectedAttr:function(c){this.selected!=c&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),c&&c._setSelected(!0),this._set("selected",c))},activated:!1,_setActivatedAttr:function(c){q.toggle(this.domNode,"dijitMenuActive",c);q.toggle(this.domNode,"dijitMenuPassive",!c);this._set("activated",c)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(c){var g=a.byNode(c);return c.parentNode==this.containerNode&&g&&g.focus},postCreate:function(){var c=this,g="string"==typeof this.childSelector?this.childSelector:h.hitch(this,"childSelector");this.own(e(this.containerNode,e.selector(g,p.enter),function(){c.onItemHover(a.byNode(this))}),e(this.containerNode,e.selector(g,p.leave),function(){c.onItemUnhover(a.byNode(this))}),e(this.containerNode,e.selector(g,b),function(k){c.onItemClick(a.byNode(this),k);k.stopPropagation()}),
e(this.containerNode,e.selector(g,"focusin"),function(){c._onItemFocus(a.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(c,g,k,t){this.inherited(arguments);if(c&&(-1==t||c.popup&&1==t))this.onItemClick(c,g)},_keyboardSearchCompare:function(c,g){return c.shortcutKey?g==c.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(c){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
c);else(c=this._getTopMenu())&&c._isMenuBar&&c.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(c){this.activated?(this.set("selected",c),!c.popup||c.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(c)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(c,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=c;c._set("hovering",!0)},_onChildDeselect:function(c){this._stopPopupTimer();this.currentPopupItem==c&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;c._closePopup()},this.popupDelay))},onItemUnhover:function(c){this._hoveredChild==c&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);c._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var c=this;c.parentMenu;c=c.parentMenu);return c},onItemClick:function(c,g){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(c);if(c.disabled)return!1;c.popup?(this.set("selected",c),this.set("activated",!0),g=/^key/.test(g._origType||
g.type)||0==g.clientX&&0==g.clientY,this._openItemPopup(c,g)):(this.onExecute(),c._onClick?c._onClick(g):c.onClick(g))},_openItemPopup:function(c,g){if(c!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var k=c.popup;k.parentMenu=this;this.own(this._mouseoverHandle=e.once(k.domNode,"mouseover",h.hitch(this,"_onPopupHover")));var t=this;c._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){g&&
t.focusChild(c);t._cleanUp()},onExecute:h.hitch(this,"_cleanUp",!0),onClose:function(){t._mouseoverHandle&&(t._mouseoverHandle.remove(),delete t._mouseoverHandle)}},g);this.currentPopupItem=c}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(w.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(c){if(this._hoveredChild&&this._hoveredChild!=c)this.onItemUnhover(this._hoveredChild);this.set("selected",c)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(c){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);c&&this.set("selected",null)}})})},"dijit/_CssStateMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-class dojo/has dojo/_base/lang dojo/on dojo/domReady dojo/touch dojo/_base/window ./a11yclick ./registry".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f){B=B("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);G.forEach("disabled readOnly checked selected focused state hovering active _opened".split(" "),function(m){this.watch(m,h.hitch(this,"_setStateClass"))},this);for(var n in this.cssStateNodes||{})this._trackMouseState(this[n],this.cssStateNodes[n]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(n){if(!this.disabled)switch(n.type){case "mouseover":case "MSPointerOver":case "pointerover":this._set("hovering",
!0);this._set("active",this._mouseDown);break;case "mouseout":case "MSPointerOut":case "pointerout":this._set("hovering",!1);this._set("active",!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":this._set("active",!0);break;case "mouseup":case "dojotouchend":case "MSPointerUp":case "pointerup":case "keyup":this._set("active",!1)}},_setStateClass:function(){function n(t){m=m.concat(G.map(m,function(y){return y+t}),"dijit"+t)}var m=this.baseClass.split(" ");
this.isLeftToRight()||n("Rtl");var d="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&n(d);this.state&&n(this.state);this.selected&&n("Selected");this._opened&&n("Opened");this.disabled?n("Disabled"):this.readOnly?n("ReadOnly"):this.active?n("Active"):this.hovering&&n("Hover");this.focused&&n("Focused");d=this.stateNode||this.domNode;var c={};G.forEach(d.className.split(" "),function(t){c[t]=!0});"_stateClasses"in this&&G.forEach(this._stateClasses,function(t){delete c[t]});G.forEach(m,
function(t){c[t]=!0});var g=[],k;for(k in c)g.push(k);d.className=g.join(" ");this._stateClasses=m},_subnodeCssMouseEvent:function(n,m,d){function c(g){w.toggle(n,m+"Active",g)}if(!this.disabled&&!this.readOnly)switch(d.type){case "mouseover":case "MSPointerOver":case "pointerover":w.toggle(n,m+"Hover",!0);break;case "mouseout":case "MSPointerOut":case "pointerout":w.toggle(n,m+"Hover",!1);c(!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":c(!0);
break;case "mouseup":case "MSPointerUp":case "pointerup":case "dojotouchend":case "keyup":c(!1);break;case "focus":case "focusin":w.toggle(n,m+"Focused",!0);break;case "blur":case "focusout":w.toggle(n,m+"Focused",!1)}},_trackMouseState:function(n,m){n._cssState=m}});e(function(){function n(c,g,k){if(!k||!A.isDescendant(k,g))for(;g&&g!=k;g=g.parentNode)if(g._cssState){var t=f.getEnclosingWidget(g);t&&(g==t.domNode?t._cssMouseEvent(c):t._subnodeCssMouseEvent(g,g._cssState,c))}}var m=b.body(),d;p(m,
l.over,function(c){n(c,c.target,c.relatedTarget)});p(m,l.out,function(c){n(c,c.target,c.relatedTarget)});p(m,a.press,function(c){d=c.target;n(c,d)});p(m,a.release,function(c){n(c,d);d=null});p(m,"focusin, focusout",function(c){var g=c.target;if(g._cssState&&!g.getAttribute("widgetId")){var k=f.getEnclosingWidget(g);k&&k._subnodeCssMouseEvent(g,g._cssState,c)}})});return B})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(G,B,A,w,q,h,p,e,l,b){return B("dijit._KeyNavContainer",[l,b,e],{connectKeyNavHandlers:function(a,f){var n=this._keyNavCodes={},m=h.hitch(this,"focusPrev"),d=h.hitch(this,"focusNext");G.forEach(a,function(c){n[c]=m});G.forEach(f,function(c){n[c]=d});n[q.HOME]=h.hitch(this,"focusFirstChild");n[q.END]=h.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){w.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);G.forEach(this.getChildren(),
h.hitch(this,"_startupChild"))},addChild:function(a,f){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=
p.byNode(a))&&a.getParent()==this}})})},"dijit/_Container":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/_base/kernel"],function(G,B,A,w){return B("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode)},addChild:function(q,h){var p=this.containerNode;if(0<h){for(p=p.firstChild;0<h;)1==p.nodeType&&h--,p=p.nextSibling;p?h="before":(p=this.containerNode,h="last")}A.place(q.domNode,p,h);
this._started&&!q._started&&q.startup()},removeChild:function(q){"number"==typeof q&&(q=this.getChildren()[q]);q&&(q=q.domNode)&&q.parentNode&&q.parentNode.removeChild(q)},hasChildren:function(){return 0<this.getChildren().length},_getSiblingOfChild:function(q,h){var p=this.getChildren();q=G.indexOf(p,q);return p[q+h]},getIndexOfChild:function(q){return G.indexOf(this.getChildren(),q)}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),
function(G,B,A,w,q,h,p,e){return B("dijit._KeyNavMixin",e,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);A.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var l=this._keyNavCodes={};l[w.HOME]=q.hitch(this,"focusFirstChild");l[w.END]=q.hitch(this,"focusLastChild");l[this.isLeftToRight()?w.LEFT_ARROW:w.RIGHT_ARROW]=q.hitch(this,"_onLeftArrow");l[this.isLeftToRight()?w.RIGHT_ARROW:w.LEFT_ARROW]=q.hitch(this,"_onRightArrow");l[w.UP_ARROW]=q.hitch(this,
"_onUpArrow");l[w.DOWN_ARROW]=q.hitch(this,"_onDownArrow")}var b=this;l="string"==typeof this.childSelector?this.childSelector:q.hitch(this,"childSelector");this.own(h(this.domNode,"keypress",q.hitch(this,"_onContainerKeypress")),h(this.domNode,"keydown",q.hitch(this,"_onContainerKeydown")),h(this.domNode,"focus",q.hitch(this,"_onContainerFocus")),h(this.containerNode,h.selector(l,"focusin"),function(a){b._onChildFocus(p.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},
_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(l,b){l&&(this.focusedChild&&l!==this.focusedChild&&this._onChildBlur(this.focusedChild),
l.set("tabIndex",this.tabIndex),l.focus(b?"end":"start"))},_onContainerFocus:function(l){l.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){A.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(l){A.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(l){l&&l!=this.focusedChild&&
(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),l.set("tabIndex",this.tabIndex),this.lastFocused=l,this._set("focusedChild",l))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(l,b,a,f){l&&this.focusChild(l)},_keyboardSearchCompare:function(l,b){var a=l.domNode;l=(l.label||(a.focusNode?a.focusNode.label:"")||a.innerText||a.textContent||"").replace(/^\s+/,"").substr(0,b.length).toLowerCase();return b.length&&l==b?-1:0},_isFormElement:function(l){return"INPUT"===
l.tagName||"TEXTAREA"===l.tagName||"SELECT"===l.tagName||"BUTTON"===l.tagName},_onContainerKeydown:function(l){if(!this._isFormElement(document.activeElement)){var b=this._keyNavCodes[l.keyCode];b?(b(l,this.focusedChild),l.stopPropagation(),l.preventDefault(),this._searchString=""):l.keyCode!=w.SPACE||!this._searchTimer||l.ctrlKey||l.altKey||l.metaKey||(l.stopImmediatePropagation(),l.preventDefault(),this._keyboardSearch(l," "))}},_onContainerKeypress:function(l){this._isFormElement(document.activeElement)||
l.charCode<=w.SPACE||l.ctrlKey||l.altKey||l.metaKey||(l.preventDefault(),l.stopPropagation(),this._keyboardSearch(l,String.fromCharCode(l.charCode).toLowerCase()))},_keyboardSearch:function(l,b){var a=null,f,n=0;q.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=b;var m=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;f=this._searchString.substr(0,m);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);
var d=this.focusedChild||null;if(1==m||!d)if(d=this._getNextFocusableChild(d,1),!d)return;m=d;do{var c=this._keyboardSearchCompare(d,f);c&&0==n++&&(a=d);if(-1==c){n=-1;break}d=this._getNextFocusableChild(d,1)}while(d&&d!=m)})();this.onKeyboardSearch(a,l,f,n)},_onChildBlur:function(){},_getNextFocusableChild:function(l,b){var a=l;do{if(l)l=this._getNext(l,b);else if(l=this[0<b?"_getFirst":"_getLast"](),!l)break;if(null!=l&&l!=a&&l.isFocusable())return l}while(l!=a);return null},_getFirst:function(){return null},
_getLast:function(){return null},_getNext:function(l,b){if(l)for(l=l.domNode;l;)if((l=l[0>b?"previousSibling":"nextSibling"])&&"getAttribute"in l){var a=p.byNode(l);if(a)return a}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f){p=G("dijit.MenuItem"+(h("dojo-bidi")?
"_NoBidi":""),[e,l,b,a],{templateString:f,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(n){this._set("label",n);var m="";var d=n.search(/{\S}/);if(0<=d){m=n.charAt(d+1);var c=n.substr(0,d);n=n.substr(d+3);d=c+m+n;n=c+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+m+"\x3c/span\x3e"+n}else d=n;this.domNode.setAttribute("aria-label",d+" "+this.accelKey);this.containerNode.innerHTML=n;this._set("shortcutKey",m)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},
accelKey:"",disabled:!1,_fillContent:function(n){!n||"label"in this.params||this._set("label",n.innerHTML)},buildRendering:function(){this.inherited(arguments);A.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&A.set(this.accelKeyNode,"id",this.id+"_accel");B.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==h("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(n){}},_setSelected:function(n){w.toggle(this.domNode,"dijitMenuItemSelected",n)},setLabel:function(n){q.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.",
"","2.0");this.set("label",n)},setDisabled:function(n){q.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",n)},_setDisabledAttr:function(n){this.focusNode.setAttribute("aria-disabled",n?"true":"false");this._set("disabled",n)},_setAccelKeyAttr:function(n){this.accelKeyNode&&(this.accelKeyNode.style.display=n?"":"none",this.accelKeyNode.innerHTML=n,A.set(this.containerNode,"colSpan",n?"1":"2"));this._set("accelKey",n)}});h("dojo-bidi")&&
(p=G("dijit.MenuItem",p,{_setLabelAttr:function(n){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return p})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(G,B){return G("dijit._Contained",null,{_getSibling:function(A){var w=this.getParent();return w&&w._getSiblingOfChild&&w._getSiblingOfChild(this,"previous"==A?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},
getIndexInParent:function(){var A=this.getParent();return A&&A.getIndexOfChild?A.getIndexOfChild(this):-1}})})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f,n){G=G(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(m,d,c,g,k,
t,y,K){this.point=m;this.symbol=d;this.relatedGraphic=c;this.segIndex=g;this.ptIndex=k;this.segLength=t;this.editor=y;this.map=y.map;this._scratchGL=y.toolbar._scratchGL;this._placeholder=K||!1;this._type=c.geometry.type;this._init();this._enable()},refresh:function(m){if(m||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=
this.editor=this.map=this._scratchGL=null},_init:function(){var m=new a(this.point.toJson());m=new f(m,this.symbol);switch(this._type){case "multipoint":m._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(m)}this.graphic=m},_enable:function(){var m=this.graphic.getDojoShape();m&&(m._hasMover=!0,this._moveable=this._getMoveable(m),(m=m.getEventSource())&&q.set(m,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":
"move-v"]))},_disable:function(){var m=this._moveable;if(m){A.disconnect(this._startHandle);A.disconnect(this._firstHandle);A.disconnect(this._movingHandle);A.disconnect(this._stopHandle);var d=m.shape;d&&(d=d.getEventSource())&&q.set(d,"cursor","inherit");m.destroy();this._moveable=null}},_needRefresh:function(){var m=this.graphic.getDojoShape(),d=!1;if(m)switch(this._type){case "multipoint":var c=this.relatedGraphic.getDojoShape();c&&(c=c.children[this.ptIndex],m!==c&&(this.graphic._shape=c,d=!0));
break;case "polyline":case "polygon":d=!m._hasMover}return d},_getMoveable:function(m){m=new h(m,w("mac")&&w("ff")&&!b("esri-touch")&&{leftButtonOnly:!0});this._startHandle=A.connect(m,"onMoveStart",this,this._moveStartHandler);this._firstHandle=A.connect(m,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=A.connect(m,"onMoving",this,this._movingHandler);this._stopHandle=A.connect(m,"onMoveStop",this,this._moveStopHandler);return m},_getPtIndex:function(){return this.ptIndex+(this._placeholder?
1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(m){var d=this.map;d.snappingManager&&d.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();m.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(m){var d=
m.shape,c=this._getControlEdges(),g=this._scratchGL._div,k,t=[],y=m.host.shape._wrapOffsets[0]||0;for(k=0;k<c.length;k++){var K=c[k];K.x1+=y;K.x2+=y;t.push([g.createLine({x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2}).setStroke(this.editor._lineStroke),K.x1,K.y1,K.x2,K.y2])}d._lines=t;m.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(m,d,c){d=this.map;var g;b("esri-pointer")?g=d.navigationManager.pointerEvents._processTouchEvent(c,
c):c&&"pointermove"===c.type&&(g=l.prototype._processTouchEvent.call({map:d},c,c));g&&d.snappingManager&&d.snappingManager._onSnappingMouseMoveHandler(g);c=m.shape;m=c.getTransform();c=c._lines;for(g=0;g<c.length;g++)d=c[g],d[0].setShape({x1:d[1]+m.dx,y1:d[2]+m.dy,x2:d[3],y2:d[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),m)},_moveStopHandler:function(m){m=m.shape;var d=this.editor.toolbar,c=m.getTransform(),g=this.map,k=this.graphic,t=d._geo?n.geographicToWebMercator(k.geometry):
k.geometry;d._activateScrollWheel();var y,K=m._lines;if(K){for(y=0;y<K.length;y++)K[y][0].removeShape();m._lines=null}y=!1;K=!0;var C=this._getInfo();c&&(c.dx||c.dy)?this._placeholder&&(this._placeholder=!1,y=!0):K=!1;if(g.snappingManager)var r=g.snappingManager._snappingPoint;var E=[c,p.invert(this._startTx)];r=r||g.toMap(p.multiplyPoint(E,g.toScreen(t,!0)));g.snappingManager&&g.snappingManager._killOffSnapping();m.setTransform(null);k.setGeometry(d._geo?n.webMercatorToGeographic(r,!0):r);this.constructor.onMoveStop(this,
c);d.onVertexMoveStop(this.relatedGraphic,C,c);if(!K)d.onVertexClick(this.relatedGraphic,C);if(y)d.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var m=this.map,d=this.relatedGraphic.geometry,c=this.segIndex,g=this.ptIndex,k=this.segLength,t=this._scratchGL.getNavigationTransform(),y=t.dx;t=t.dy;var K=m.toScreen(this.graphic.geometry);m=K.x-y;K=K.y-t;var C=[];d=this.editor._getControlPoints(this,d,c,g,k);d[0]&&C.push({x1:m,y1:K,x2:d[0].x-y,y2:d[0].y-t});d[1]&&C.push({x1:m,
y1:K,x2:d[1].x-y,y2:d[1].y-t});return C}});b("extend-esri")&&B.setObject("toolbars.VertexMover",G,e);B.mixin(G,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return G})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(G,B,A,w,q,h,p,e,l,b){G=G(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(a,
f,n){this._graphic=a;this._map=f;this._toolbar=n;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(a){this._editBox?(A.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=A.connect(a.getLayer(),"onDblClick",this,function(f){this._map.navigationManager.setImmediateClick(!1);f.graphic==a&&(w.stop(f),A.disconnect(this._addEditBoxHandler),
this._addEditBoxHandler=null,this._addTextBox(a))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(A.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(a,f){if(!this._editBox){if(!a.symbol.text){a.symbol.text="Tempt text";a.setSymbol(a.symbol);var n=""}var m=this._createInputTextStyle(a,this._map);""!==n&&(n=f||a.symbol.text);this._editBox=h.create("input",
{type:"text",value:n});e.set(this._editBox,m);p.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=A.connect(this._editBox,"onkeyup",B.hitch(this,function(c){c.keyCode!=l.ENTER&&c.keyCode!==l.TAB||this._disable()}));this._editBoxBlurHandler=A.connect(this._editBox,"onblur",B.hitch(this,function(c){this._disable()}));a.symbol.text="";a.setSymbol(a.symbol);a.hide();var d=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=
this._map.on("zoom-start",B.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(c){e.set(d,{left:this._editBoxLeft+c.delta.x+"px",top:this._editBoxTop+c.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(e.get(d,"left"));this._editBoxTop=parseFloat(e.get(d,"top"))});this.onEditStart(a,this._editBox);this._toolbar.onTextEditStart(a,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(A.disconnect(this._editBoxBlurHandler),
this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(A.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(a,
f){f=a.getDojoShape().getTransformedBoundingBox();var n=a.getLayer();n=n.hasLocalNavigationTransform()?{dx:0,dy:0}:n.getNavigationTransform();var m=a.symbol.font;return{"font-family":m.family,"font-size":m.size+"px","font-style":m.style,"font-variant":m.variant,"font-weight":m.weight,left:f[0].x+n.dx+"px",top:f[0].y+n.dy+"px",width:Math.abs(f[0].x-f[1].x)/Math.cos(a.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var a=this._graphic.symbol;
a.text=this._editBox.value;this._graphic.setSymbol(a)}else this._graphic.getLayer().remove(this._graphic)}});q("extend-esri")&&B.setObject("toolbars.TextEditor",G,b);return G})},"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k,t,y,K,C,r,E,F,u,D,z,M,H,x,J,L,N,P,T,S,Z,da,Q,W){var aa=G([r,k,t],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:W,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,
_currentFeature:null,_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},_defaultRichTextPlugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),css:{label:"atiLabel",field:"atiField",textArea:"atiTextAreaField",richText:"atiRichTextField",attachmentEditor:"atiAttachmentEditor",
red:"atiRequiredField"},constructor:function(R,V){B.mixin(this,d.widgets.attributeInspector);R=R||{};R.featureLayer||R.layerInfos||console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(R);this._layerInfos=R.layerInfos||[{featureLayer:R.featureLayer,options:R.options||[]}];this._layerInfos=A.filter(this._layerInfos,function(ba){return!ba.disableAttributeUpdate});this._hideNavButtons=R.hideNavButtons||!1},postCreate:function(){if(A.every(this._layerInfos,
function(V){return V.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var R=this._layerInfos.length;A.forEach(this._layerInfos,function(V){V=V.featureLayer;if(V.loaded)R--;else var ba=w.connect(V,"onLoad",this,function(ha){w.disconnect(ba);ba=null;R--;R||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();A.forEach(this._aiConnects,w.disconnect);delete this._aiConnects;
this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(R,V){V&&(this._createOnlyFirstTime=!0);
this._updateSelection([R],V);this._updateUI()},onLayerSelectionChange:function(R,V,ba){this._createOnlyFirstTime=!1;this._featureIdx=ba===m.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){!this._selection||0>=this._selection.length||(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(R,V,ba,ha){},onLayerError:function(R,V,ba,ha){},onLayerEditsError:function(R,
V,ba,ha){},onLayerEditsComplete:function(R,V,ba,ha){ha=ha||[];if(ha.length){var qa=this._selection,va=R.featureLayer.objectIdField;A.forEach(ha,B.hitch(this,function(Ba){A.some(qa,B.hitch(this,function(Aa,X){if(Aa.attributes[va]!==Ba.objectId)return!1;this._selection.splice(X,1);return!0}))}))}V=V||[];V.length&&(this._selection=F.findFeatures(V,R.featureLayer),this._featureIdx=0);ha=this._numFeatures=(this._selection=F.sortFeaturesById(this._layerInfos,this._selection))?this._selection.length:0;if(V.length){if(V=
ha?this._selection[this._featureIdx]:null)ha=V.getLayer().getEditCapabilities(),ha.canCreate&&!ha.canUpdate||this._showFeature(V);this._updateUI()}ba=ba||[];if(ba.length){var sa=this._rollbackInfo;A.forEach(ba,function(Ba){var Aa=F.findFeatures(ba,R.featureLayer)[0];if(!Ba.success&&Aa.attributes[R.featureLayer.objectIdField]===Ba.objectId&&sa){var X=sa.field;Ba=sa.graphic.attributes[X.name];var ea=A.filter(this._currentLInfo.fieldInfos,function(ia){return ia.fieldName===X.name},this)[0].dijit;Aa.attributes[X.name]=
Ba;"esriFieldTypeDate"===X.type&&(Ba=new Date(Ba));this._setValue(ea,Ba)}},this)}this._rollbackInfo=null},onFieldValueChange:function(R,V){var ba=R.field,ha=R.dijit,qa=this._currentFeature,va=this._currentLInfo,sa=ba.name;R=this._isFieldRequired(ba,R);if(""===ha.displayedValue||"dijit.form.ValidationTextBox"!==ha.declaredClass||ha.isValid())if(""!==ha.displayedValue&&ha.displayedValue!==V&&ha.isValid&&!ha.isValid())this._setValue(ha,qa.attributes[ba.name]);else{var Ba=!("esriFieldTypeInteger"!==ba.type&&
"esriFieldTypeSmallInteger"!==ba.type&&"esriFieldTypeSingle"!==ba.type&&"esriFieldTypeDouble"!==ba.type);if(R&&(null===V||""===V||"undefined"===typeof V||Ba&&isNaN(V))){sa=qa.attributes[ba.name];if("esriFieldTypeDate"===ba.type&&(sa=new Date(sa),ha instanceof Array)){this._setValue(ha[0],sa);this._setValue(ha[1],sa);return}this._setValue(ha,sa)}else{if(Ba){if(isNaN(V)||""===V)V=null;Ba&&null!==V&&(V=Number(V))}"esriFieldTypeDate"===ba.type&&(ha instanceof Array?(V=ha[0].getValue(),ha=ha[1].getValue(),
V=V&&ha?new Date(V.getFullYear(),V.getMonth(),V.getDate(),ha.getHours(),ha.getMinutes(),ha.getSeconds(),ha.getMilliseconds()):V||ha||null):(V=ha.getValue(),ba.domain&&(V=Number(V))),V=V&&V.getTime?V.getTime():V&&V.toGregorian?V.toGregorian().getTime():V);if(this._currentFeature.attributes[ba.name]!==V){if(sa===va.typeIdField){var Aa=this._findFirst(va.types,"id",V);A.forEach(va.fieldInfos,function(X){(ba=X.field)&&ba.name!==va.typeIdField&&(X=X.dijit,this._setFieldDomain(X,Aa,ba)&&X&&(this._setValue(X,
qa.attributes[ba.name]+""),!1===X.isValid()&&this._setValue(X,null)))},this)}this.onAttributeChange(qa,sa,V)}}}else this._setValue(ha,qa.attributes[ba.name])},onDeleteBtn:function(R){this._deleteFeature()},onNextFeature:function(R){this._onNextFeature(1)},onPreviousFeature:function(R){this._onNextFeature(-1)},onFirstFeature:function(R){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(R){this._onNextFeature(this._numFeatures-1-this._featureIdx)},_initLayerInfos:function(){var R=this._layerInfos;
this._editorTrackingInfos={};A.forEach(R,this._initLayerInfo,this)},_initLayerInfo:function(R){var V=R.featureLayer,ba;this._userIds={};var ha=V.id;V.credential&&(this._userIds[ha]=V.credential.userId);R.userId&&(this._userIds[ha]=R.userId);this._connect(V,"onSelectionComplete",B.hitch(this,"onLayerSelectionChange",R));this._connect(V,"onSelectionClear",B.hitch(this,"onLayerSelectionClear",R));this._connect(V,"onEditsComplete",B.hitch(this,"onLayerEditsComplete",R));this._connect(V,"error",B.hitch(this,
"onLayerError",R));this._connect(V,"onUpdateEnd",B.hitch(this,"onLayerUpdateEnd",R));R.showAttachments=V.hasAttachments?a.isDefined(R.showAttachments)?R.showAttachments:!0:!1;R.hideFields=R.hideFields||[];R.htmlFields=R.htmlFields||[];R.isEditable=V.isEditable()?a.isDefined(R.isEditable)?R.isEditable:!0:!1;R.typeIdField=V.typeIdField;R.layerId=V.id;R.types=V.types;V.globalIdField&&((ba=this._findFirst(R.fieldInfos,"fieldName",V.globalIdField))||R.showGlobalID||R.hideFields.push(V.globalIdField));
(ha=this._findFirst(R.fieldInfos,"fieldName",V.objectIdField))||R.showObjectID||R.hideFields.push(V.objectIdField);var qa=this._getFields(R.featureLayer);if(qa){var va=R.fieldInfos||[];va=A.map(va,function(sa){return B.mixin({},sa)});va.length?R.fieldInfos=A.filter(A.map(va,B.hitch(this,function(sa){var Ba=sa.stringFieldOption||(this._isInFields(sa.fieldName,R.htmlFields)?aa.STRING_FIELD_OPTION_RICHTEXT:aa.STRING_FIELD_OPTION_TEXTBOX);return B.mixin(sa,{field:this._findFirst(qa,"name",sa.fieldName),
stringFieldOption:Ba})})),"return item.field;"):(qa=A.filter(qa,B.hitch(this,function(sa){return!this._isInFields(sa.name,R.hideFields)})),R.fieldInfos=A.map(qa,B.hitch(this,function(sa){var Ba=this._isInFields(sa.name,R.htmlFields)?aa.STRING_FIELD_OPTION_RICHTEXT:aa.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:sa.name,field:sa,stringFieldOption:Ba}})));R.showGlobalID&&!ba&&va.push(this._findFirst(qa,"name",V.globalIdField));R.showObjectID&&!ha&&va.push(this._findFirst(qa,"name",V.objectIdField));
ba=[];V.editFieldsInfo&&(V.editFieldsInfo.creatorField&&ba.push(V.editFieldsInfo.creatorField),V.editFieldsInfo.creationDateField&&ba.push(V.editFieldsInfo.creationDateField),V.editFieldsInfo.editorField&&ba.push(V.editFieldsInfo.editorField),V.editFieldsInfo.editDateField&&ba.push(V.editFieldsInfo.editDateField));this._editorTrackingInfos[V.id]=ba}},_createAttachmentEditor:function(){this._attachmentEditor=null;var R=A.filter(this._layerInfos,function(V){return V.showAttachments});R&&R.length&&(this._attachmentEditor=
new E({"class":this.css.attachmentEditor},this.attachmentEditor),this._attachmentEditor.startup())},_setCurrentLInfo:function(R){var V=this._currentLInfo?this._currentLInfo.featureLayer:null,ba=R.featureLayer;if(V&&V.id===ba.id&&!V.ownershipBasedAccessControlForFeatures&&(V=ba.getEditCapabilities(),!V.canCreate||V.canUpdate))return;this._currentLInfo=R;this._createTable()},_updateSelection:function(R,V){this._selection=R||[];A.forEach(this._layerInfos,this._getSelection,this);this._selection=F.sortFeaturesById(this._layerInfos,
this._selection);this._numFeatures=this._selection.length;this._showFeature(this._numFeatures?this._selection[this._featureIdx]:null,V)},_getSelection:function(R){R=R.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(R)},_updateUI:function(){var R=this._numFeatures,V=this._currentLInfo;this.layerName.innerHTML=V&&0!==R?V.featureLayer?V.featureLayer.name:"":this.NLS_noFeaturesSelected;e.set(this.attributeTable,"display",R?"":"none");e.set(this.editButtons,"display",R?"":"none");
e.set(this.navButtons,"display",!this._hideNavButtons&&1<R?"":"none");this.navMessage.innerHTML=a.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&e.set(this._attachmentEditor.domNode,"display",V&&V.showAttachments&&R?"":"none");e.set(this.deleteBtn.domNode,"display",V&&!1===V.showDeleteButton||!this._canDelete?"none":"");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(R){this._featureIdx+=
R;0>this._featureIdx?this._featureIdx=this._numFeatures-1:this._featureIdx>=this._numFeatures&&(this._featureIdx=0);R=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(R);this._updateUI();this.onNext(R)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(R,V){if(R){this._currentFeature=R;V=V?V:R.getLayer();var ba=V.getEditCapabilities({feature:R,userId:this._userIds[V.id]});this._canUpdate=ba.canUpdate;this._canDelete=ba.canDelete;if(ba=
this._getLInfoFromFeatureLayer(V)){this._setCurrentLInfo(ba);var ha=R.attributes,qa=this._findFirst(ba.types,"id",ha[ba.typeIdField]),va=null;A.forEach(ba.fieldInfos,function(sa){va=sa.field;var Ba=[];sa.dijit&&1<sa.dijit.length?A.forEach(sa.dijit,function(Aa){Ba.push(Aa)}):Ba.push(sa.dijit);A.forEach(Ba,B.hitch(this,function(Aa){if(Aa){var X=this._setFieldDomain(Aa,qa,va),ea=ha[va.name];ea=ea&&X&&X.codedValues&&X.codedValues.length?X.codedValues[ea]?X.codedValues[ea].name:ea:ea;a.isDefined(ea)||
(ea="");"dijit.form.DateTextBox"===Aa.declaredClass||"dijit.form.TimeTextBox"===Aa.declaredClass?ea=""===ea?null:new Date(ea):"dijit.form.FilteringSelect"===Aa.declaredClass&&(Aa._lastValueReported=null,ea=ha[va.name]+"");try{this._setValue(Aa,ea),"dijit.form.FilteringSelect"===Aa.declaredClass&&!1===Aa.isValid()&&this._setValue(Aa,null)}catch(ia){Aa.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&ba.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,
V);(R=V.getEditSummary(R))?(this.editorTrackingInfoDiv.innerHTML=R,f.show(this.editorTrackingInfoDiv)):f.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(R,V,ba){if(!R)return null;var ha=ba.domain;V&&V.domains&&V.domains[ba.name]&&!1===V.domains[ba.name]instanceof n&&(ha=V.domains[ba.name]);if(!ha)return null;ha.codedValues&&0<ha.codedValues.length?(R.set("store",this._toStore(A.map(ha.codedValues,function(qa){return{id:qa.code+"",name:qa.name}}))),this._setValue(R,ha.codedValues[0].code+
"")):(R.constraints={min:a.isDefined(ha.minValue)?ha.minValue:Number.MIN_VALUE,max:a.isDefined(ha.maxValue)?ha.maxValue:Number.MAX_VALUE},this._setValue(R,R.constraints.min));return ha},_setValue:function(R,V){R.set&&(R._onChangeActive=!1,R.set("value",V,!0),R._onChangeActive=!0)},_getFields:function(R){var V=R._getOutFields();if(!V)return null;R=R.fields;return"*"==V?R:A.filter(A.map(V,B.hitch(this,"_findFirst",R,"name")),a.isDefined)},_isInFields:function(R,V){return R&&(V||V.length)?A.some(V,function(ba){return ba.toLowerCase()===
R.toLowerCase()}):!1},_isFieldNullable:function(R,V){return!(!1===R.nullable||V.field&&!1===V.field.nullable)},_isFieldRequired:function(R,V){return!1!==R.editable&&!1!==V.isEditable&&!this._isFieldNullable(R,V)},_findFirst:function(R,V,ba){return(R=A.filter(R,function(ha){return ha.hasOwnProperty(V)&&ha[V]===ba}))&&R.length?R[0]:null},_getLInfoFromFeatureLayer:function(R){return this._findFirst(this._layerInfos,"layerId",R?R.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML=
"";this._attributes=l.create("table",{cellspacing:"0",cellpadding:"0"},this.attributeTable);var R=l.create("tbody",null,this._attributes),V=this._currentLInfo,ba=this._findFirst(V.types,"id",this._currentFeature.attributes[V.typeIdField]);A.forEach(V.fieldInfos,B.hitch(this,"_createField",ba,R),this);this._createOnlyFirstTime=!1},_createField:function(R,V,ba){var ha=this._currentLInfo,qa=ba.field;if(!this._isInFields(qa.name,ha.hideFields)&&!this._isInFields(qa.name,this._editorTrackingInfos[ha.featureLayer.id])){var va=
!1,sa;V=l.create("tr",null,V);var Ba=l.create("td",{innerHTML:ba.label||qa.alias||qa.name,"class":this.css.label,"data-fieldname":qa.name},V);this._isFieldRequired(qa,ba)&&l.create("span",{"class":this.css.red,innerHTML:" *"},Ba);V=l.create("td",null,V);if(ba.customField){l.place(ba.customField.domNode||ba.customField,l.create("div",null,V),"first");var Aa=ba.customField}else if(!1===ha.isEditable||!1===qa.editable||!1===ba.isEditable||"esriFieldTypeOID"===qa.type||"esriFieldTypeGlobalID"===qa.type||
!this._canUpdate&&!this._createOnlyFirstTime)va=!0;ha=ha.typeIdField&&qa.name.toLowerCase()==ha.typeIdField.toLowerCase();Ba=!!this._getDomainForField(qa,R);!Aa&&ha?Aa=this._createTypeField(qa,ba,V):!Aa&&Ba&&(Aa=this._createDomainField(qa,ba,R,V));if(!Aa)switch(qa.type){case "esriFieldTypeString":Aa=this._createStringField(qa,ba,V);break;case "esriFieldTypeDate":Aa=this._createDateField(qa,ba,V);ba.format&&ba.format.time&&(sa=this._createTimeField(qa,ba,V));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":Aa=
this._createIntField(qa,ba,V);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":Aa=this._createFltField(qa,ba,V);break;default:Aa=this._createStringField(qa,ba,V)}ba.tooltip&&ba.tooltip.length&&this._toolTips.push(new T({connectId:[Aa.id],label:ba.tooltip}));Aa.onChange=B.hitch(this,"onFieldValueChange",ba);Aa.set("disabled",va);sa?(ba.dijit=[Aa,sa],sa.onChange=B.hitch(this,"onFieldValueChange",ba),sa.set("disabled",va)):ba.dijit=Aa}},_createTypeField:function(R,V,ba){ba=l.create("div",
null,ba);var ha=R.domain;return ha&&"range"===ha.type&&ha.minValue===ha.maxValue?new N({"class":this.css.field,trim:!0,maxLength:R.length,name:R.alias||R.name,required:this._isFieldRequired(R,V)},ba):new H({"class":this.css.field,name:R.alias||R.name,required:this._isFieldRequired(R,V),store:this._toStore(A.map(this._currentLInfo.types,function(qa){return{id:qa.id,name:qa.name}})),searchAttr:"name"},ba)},_getDomainForField:function(R,V){var ba=R.domain;(R=R.name)&&V&&V.domains&&V.domains[R]&&!1===
V.domains[R]instanceof n&&(ba=V.domains[R]);return ba||null},_createDomainField:function(R,V,ba,ha){ba=this._getDomainForField(R,ba);ha=l.create("div",null,ha);return ba.codedValues?new H({"class":this.css.field,name:R.alias||R.name,searchAttr:"name",required:this._isFieldRequired(R,V)},ha):new x({"class":this.css.field},ha)},_createStringField:function(R,V,ba){ba=l.create("div",null,ba);var ha={trim:!0,maxLength:R.length,required:this._isFieldRequired(R,V)};if(V.stringFieldOption===aa.STRING_FIELD_OPTION_TEXTAREA)return ha["class"]=
this.css.field+" "+this.css.textArea,new L(ha,ba);if(V.stringFieldOption===aa.STRING_FIELD_OPTION_RICHTEXT)return ha["class"]=this.css.field+" "+this.css.richText,ha.height="100%",ha.width="100%",ha.plugins=V.richTextPlugins||this._defaultRichTextPlugins,ba=new y(ha,ba),ba.startup(),ba;var qa=this;ha.validator=function(va,sa){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return qa._isFieldNullable(R,V)||!(""===va||null===va)};return new N(ha,ba)},_createTimeField:function(R,V,ba){ba=l.create("div",
null,ba);R={"class":this.css.field,trim:!0,required:this._isFieldRequired(R,V),constraints:{formatLength:"medium"}};this._datePackage&&(R.datePackage=this._datePackage);return new P(R,ba)},_createDateField:function(R,V,ba){ba=l.create("div",null,ba);R={"class":this.css.field,trim:!0,required:this._isFieldRequired(R,V)};this._datePackage&&(R.datePackage=this._datePackage);return new D(R,ba)},_createIntField:function(R,V,ba){ba=l.create("div",null,ba);return new M({"class":this.css.field,constraints:"esriFieldTypeSmallInteger"===
R.type?{min:-32768,max:32767,places:0}:{places:0},trim:!0,invalidMessage:this.NLS_validationInt,required:this._isFieldRequired(R,V)},ba)},_createFltField:function(R,V,ba){ba=l.create("div",null,ba);return new M({"class":this.css.field,constraints:{max:Infinity,min:-Infinity,places:"0,20"},trim:!0,invalidMessage:this.NLS_validationFlt,required:this._isFieldRequired(R,V)},ba)},_toStore:function(R){return new S({data:{identifier:"id",label:"name",items:R}})},_connect:function(R,V,ba){this._aiConnects.push(w.connect(R,
V,ba))},_getDatePackage:function(R){return null===R.datePackage?null:R.datePackage?R.datePackage:"ar"===h.locale?"dojox.date.islamic":null},_destroyAttributeTable:function(){A.forEach(this._layerInfos,function(R){A.forEach(R.fieldInfos,function(V){var ba=V.dijit;if(ba){ba._onChangeHandle=null;if(V.customField)return;ba instanceof Array?A.forEach(ba,B.hitch(this,function(ha){ha.destroyRecursive?ha.destroyRecursive():ha.destroy&&ha.destroy();ha._onChangeHandle=null})):ba.destroyRecursive?ba.destroyRecursive():
ba.destroy&&ba.destroy()}V.dijit=null},this)},this);A.forEach(this._toolTips,function(R){R.destroy()});this._toolTips=[];this._attributes&&l.destroy(this._attributes)}});B.mixin(aa,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});p("extend-esri")&&B.setObject("dijit.AttributeInspector",aa,b);return aa})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k,t,y,K,C,r,E,F){function u(z){return new y({command:z.name})}function D(z){return new y({buttonClass:t,command:z.name})}A=A("dijit.Editor",E,{plugins:null,extraPlugins:null,constructor:function(){a.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",K]);this._plugins=
[];this._editInterval=1E3*this.editActionInterval;if(f("ie")||f("trident")||f("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new w;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);a.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=q.getLocalization("dijit._editor",
"commands",this.lang);f("webkit")&&l.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new c({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));B.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);p.add(this.iframe.parentNode,"dijitEditorIFrameContainer");p.add(this.iframe,"dijitEditorIFrame");h.set(this.iframe,"allowTransparency",
!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){B.forEach(this._plugins,function(z){z&&z.destroy&&z.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(z,M){var H=a.isString(z)?{name:z}:a.isFunction(z)?{ctor:z}:z;if(!H.setEditor){var x={args:H,plugin:null,editor:this};H.name&&(y.registry[H.name]?x.plugin=y.registry[H.name](H):m.publish(F._scopeName+".Editor.getPlugin",x));if(!x.plugin)try{var J=
H.ctor||a.getObject(H.name)||G(H.name);J&&(x.plugin=new J(H))}catch(L){throw Error(this.id+": cannot find plugin ["+H.name+"]");}if(!x.plugin)throw Error(this.id+": cannot find plugin ["+H.name+"]");z=x.plugin}1<arguments.length?this._plugins[M]=z:this._plugins.push(z);z.setEditor(this);a.isFunction(z.setToolbar)&&z.setToolbar(this.toolbar)},resize:function(z){z&&k.prototype.resize.apply(this,arguments)},layout:function(){var z=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+e.getPadBorderExtents(this.iframe.parentNode).h+
e.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=z+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(z){var M,H=this.document.body,x=H.clientWidth,J=H.clientHeight,L=H.clientLeft,N=H.offsetWidth,P=H.offsetHeight,T=H.offsetLeft;/^rtl$/i.test(H.dir||"")?x<N&&z.x>x&&z.x<N&&(M=!0):z.x<L&&z.x>T&&(M=!0);M||J<P&&z.y>J&&z.y<P&&(M=!0);M||(delete this._cursorToStart,delete this._savedSelection,"BODY"==z.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(z){this.customUndo&&this.endEditing(!0);"BODY"!=z.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(z){this._inEditing||(this._inEditing=!0,this._beginEditing(z));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(z){if(!this.customUndo||
"undo"!=z&&"redo"!=z){this.customUndo&&(this.endEditing(),this._beginEditing());var M=this.inherited(arguments);this.customUndo&&this._endEditing();return M}return this[z]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(z){try{var M=this.document.execCommand(z,!1,null);if(f("webkit")&&!M)throw{};}catch(H){M=n.substitute,alert(M(this.commands.systemShortcut,
[this.commands[z],M(this.commands[f("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[z]])])),M=!1}return M},queryCommandEnabled:function(z){return!this.customUndo||"undo"!=z&&"redo"!=z?this.inherited(arguments):"undo"==z?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(z){var M=z.mark,H=z.mark;z=z.isCollapsed;var x;if(H)if(9>f("ie")||9===f("ie")&&f("quirks"))if(a.isArray(H))M=[],B.forEach(H,function(N){M.push(r.getNode(N,this.editNode))},this),this.selection.moveToBookmark({mark:M,
isCollapsed:z});else{if(H.startContainer&&H.endContainer&&(x=r.getSelection(this.window))&&x.removeAllRanges){x.removeAllRanges();z=r.create(this.window);var J=r.getNode(H.startContainer,this.editNode);var L=r.getNode(H.endContainer,this.editNode);J&&L&&(z.setStart(J,H.startOffset),z.setEnd(L,H.endOffset),x.addRange(z))}}else(x=r.getSelection(this.window))&&x.removeAllRanges&&(x.removeAllRanges(),z=r.create(this.window),J=r.getNode(H.startContainer,this.editNode),L=r.getNode(H.endContainer,this.editNode),
J&&L&&(z.setStart(J,H.startOffset),z.setEnd(L,H.endOffset),x.addRange(z)))},_changeToStep:function(z,M){this.setValue(M.text);(z=M.bookmark)&&this._moveToBookmark(z)},undo:function(){var z=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var M=this._steps.pop();M&&0<this._steps.length&&(this.focus(),this._changeToStep(M,this._steps[this._steps.length-1]),this._undoedSteps.push(M),this.onDisplayChanged(),delete this._undoRedoActive,z=!0);delete this._undoRedoActive}return z},
redo:function(){var z=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var M=this._undoedSteps.pop();M&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],M),this._steps.push(M),this.onDisplayChanged(),z=!0);delete this._undoRedoActive}return z},endEditing:function(z){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(z),this._inEditing=!1)},_getBookmark:function(){var z=this.selection.getBookmark(),
M=[];if(z&&z.mark){var H=z.mark;if(9>f("ie")||9===f("ie")&&f("quirks")){var x=r.getSelection(this.window);if(a.isArray(H))B.forEach(z.mark,function(L){M.push(r.getIndex(L,this.editNode).o)},this),z.mark=M;else if(x){var J;x.rangeCount&&(J=x.getRangeAt(0));z.mark=J?J.cloneRange():this.selection.getBookmark()}}try{z.mark&&z.mark.startContainer&&(M=r.getIndex(z.mark.startContainer,this.editNode).o,z.mark={startContainer:M,startOffset:z.mark.startOffset,endContainer:z.mark.endContainer===z.mark.startContainer?
M:r.getIndex(z.mark.endContainer,this.editNode).o,endOffset:z.mark.endOffset})}catch(L){z.mark=null}}return z},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:C.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var z=C.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:z,bookmark:this._getBookmark()})},onKeyDown:function(z){f("ie")||this.iframe||z.keyCode!=b.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var M=
z.keyCode;if(z.ctrlKey&&!z.shiftKey&&!z.altKey){if(90==M||122==M){z.stopPropagation();z.preventDefault();this.undo();return}if(89==M||121==M){z.stopPropagation();z.preventDefault();this.redo();return}}this.inherited(arguments);switch(M){case b.ENTER:case b.BACKSPACE:case b.DELETE:this.beginEditing();break;case 88:case 86:if(z.ctrlKey&&!z.altKey&&!z.metaKey){this.endEditing();88==z.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!z.ctrlKey&&!z.altKey&&
!z.metaKey&&(z.keyCode<b.F1||z.keyCode>b.F15)){this.beginEditing();break}case b.ALT:this.endEditing();break;case b.UP_ARROW:case b.DOWN_ARROW:case b.LEFT_ARROW:case b.RIGHT_ARROW:case b.HOME:case b.END:case b.PAGE_UP:case b.PAGE_DOWN:this.endEditing(!0);case b.CTRL:case b.SHIFT:case b.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(z){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(z){this.customUndo?this.isClosed?this.setValue(z):(this.beginEditing(),z||(z="\x26#160;"),this.setValue(z),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(z){this.setValueDeferred.then(a.hitch(this,function(){!this.disabled&&z||!this._buttonEnabledPlugins&&z?
B.forEach(this._plugins,function(M){M.set("disabled",!0)}):this.disabled&&!z&&B.forEach(this._plugins,function(M){M.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&(l.set(this.document.body,"color",l.get(this.iframe,"color")),l.set(this.document.body,"background-color",l.get(this.iframe,"background-color")))}catch(z){}}});a.mixin(y.registry,{undo:u,redo:u,cut:u,copy:u,paste:u,insertOrderedList:u,insertUnorderedList:u,
indent:u,outdent:u,justifyCenter:u,justifyFull:u,justifyLeft:u,justifyRight:u,"delete":u,selectAll:u,removeFormat:u,unlink:u,insertHorizontalRule:u,bold:D,italic:D,underline:D,strikethrough:D,subscript:D,superscript:D,"|":function(){return new y({setEditor:function(z){this.editor=z;this.button=new g({ownerDocument:z.ownerDocument})}})}});return A})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(G,B,A,w,q,h,p,e){A("dijit-legacy-requires")&&q(0,function(){G(["dijit/ToolbarSeparator"])});return B("dijit.Toolbar",[h,e,p],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],
function(G,B,A,w){return G("dijit.ToolbarSeparator",[A,w],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',buildRendering:function(){this.inherited(arguments);B.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(G,B,A,
w,q,h,p,e,l){return h("dijit.layout._LayoutWidget",[B,A,w],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);p.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var b=this.getParent&&this.getParent();b&&b.isLayoutContainer||(this.resize(),this.own(q.on("resize",G.hitch(this,"resize"))))}},resize:function(b,a){var f=this.domNode;b&&e.setMarginBox(f,b);a=a||{};G.mixin(a,b||{});
"h"in a&&"w"in a||(a=G.mixin(e.getMarginBox(f),a));b=l.getComputedStyle(f);var n=e.getMarginExtents(f,b),m=e.getBorderExtents(f,b);a=this._borderBox={w:a.w-(n.w+m.w),h:a.h-(n.h+m.h)};n=e.getPadExtents(f,b);this._contentBox={l:l.toPixelValue(f,b.paddingLeft),t:l.toPixelValue(f,b.paddingTop),w:a.w-n.w,h:a.h-n.h};this.layout()},layout:function(){},_setupChild:function(b){p.add(b.domNode,this.baseClass+"-child "+(b.baseClass?this.baseClass+"-"+b.baseClass:""))},addChild:function(b,a){this.inherited(arguments);
this._started&&this._setupChild(b)},removeChild:function(b){p.remove(b.domNode,this.baseClass+"-child"+(b.baseClass?" "+this.baseClass+"-"+b.baseClass:""));this.inherited(arguments)}})})},"dijit/form/ToggleButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(G,B,A,w){return G("dijit.form.ToggleButton",[A,w],{baseClass:"dijitToggleButton",setChecked:function(q){B.deprecated("setChecked("+q+") is deprecated. Use set('checked',"+q+") instead.",
"","2.0");this.set("checked",q)}})})},"dijit/form/Button":function(){define("require dojo/_base/declare dojo/dom-class dojo/has dojo/_base/kernel dojo/_base/lang dojo/ready ./_FormWidget ./_ButtonMixin dojo/text!./templates/Button.html ../a11yclick".split(" "),function(G,B,A,w,q,h,p,e,l,b){w("dijit-legacy-requires")&&p(0,function(){G(["dijit/form/DropDownButton","dijit/form/ComboButton","dijit/form/ToggleButton"])});p=B("dijit.form.Button"+(w("dojo-bidi")?"_NoBidi":""),[e,l],{showLabel:!0,iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},baseClass:"dijitButton",templateString:b,_setValueAttr:"valueNode",_setNameAttr:function(a){this.valueNode&&this.valueNode.setAttribute("name",a)},postCreate:function(){this.inherited(arguments);this._setLabelFromContainer()},_setLabelFromContainer:function(){this.containerNode&&!this.label&&(this.label=h.trim(this.containerNode.innerHTML),this.onLabelSet())},_setShowLabelAttr:function(a){this.containerNode&&A.toggle(this.containerNode,"dijitDisplayNone",
!a);this._set("showLabel",a)},setLabel:function(a){q.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},onLabelSet:function(){this.inherited(arguments);this.showLabel||"title"in this.params||(this.titleNode.title=h.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});w("dojo-bidi")&&(p=B("dijit.form.Button",p,{onLabelSet:function(){this.inherited(arguments);this.titleNode.title&&this.applyTextDir(this.titleNode,
this.titleNode.title)},_setTextDirAttr:function(a){this._created&&this.textDir!=a&&(this._set("textDir",a),this._setLabelAttr(this.label))}}));return p})},"dijit/form/_FormWidget":function(){define("dojo/_base/declare dojo/sniff dojo/_base/kernel dojo/ready ../_Widget ../_CssStateMixin ../_TemplatedMixin ./_FormWidgetMixin".split(" "),function(G,B,A,w,q,h,p,e){B("dijit-legacy-requires")&&w(0,function(){require(["dijit/form/_FormValueWidget"])});return G("dijit.form._FormWidget",[q,p,h,e],{setDisabled:function(l){A.deprecated("setDisabled("+
l+") is deprecated. Use set('disabled',"+l+") instead.","","2.0");this.set("disabled",l)},setValue:function(l){A.deprecated("dijit.form._FormWidget:setValue("+l+") is deprecated.  Use set('value',"+l+") instead.","","2.0");this.set("value",l)},getValue:function(){A.deprecated(this.declaredClass+"::getValue() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},postMixInProperties:function(){this.nameAttrSetting=this.name&&!B("msapp")?'name\x3d"'+this.name.replace(/"/g,"\x26quot;")+
'"':"";this.inherited(arguments)}})})},"dijit/form/_FormWidgetMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff dojo/window ../a11y".split(" "),function(G,B,A,w,q,h,p,e,l,b){return B("dijit.form._FormWidgetMixin",null,{name:"",alt:"",value:"",type:"text","aria-label":"focusNode",tabIndex:"0",_setTabIndexAttr:"focusNode",disabled:!1,intermediateChanges:!1,scrollOnFocus:!0,_setIdAttr:"focusNode",_setDisabledAttr:function(a){this._set("disabled",
a);/^(button|input|select|textarea|optgroup|option|fieldset)$/i.test(this.focusNode.tagName)?(A.set(this.focusNode,"disabled",a),e("trident")&&"readOnly"in this&&A.set(this.focusNode,"readonly",a||this.readOnly)):this.focusNode.setAttribute("aria-disabled",a?"true":"false");this.valueNode&&A.set(this.valueNode,"disabled",a);a?(this._set("hovering",!1),this._set("active",!1),a="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"_setTabIndexAttr"in this?this._setTabIndexAttr:"focusNode",G.forEach(q.isArray(a)?
a:[a],function(f){f=this[f];e("webkit")||b.hasDefaultTabStop(f)?f.setAttribute("tabIndex","-1"):f.removeAttribute("tabIndex")},this)):""!=this.tabIndex&&this.set("tabIndex",this.tabIndex)},_onFocus:function(a){if("mouse"==a&&this.isFocusable())var f=this.own(p(this.focusNode,"focus",function(){m.remove();f.remove()}))[0],n=e("pointer-events")?"pointerup":e("MSPointer")?"MSPointerUp":e("touch-events")?"touchend, mouseup":"mouseup",m=this.own(p(this.ownerDocumentBody,n,q.hitch(this,function(d){m.remove();
f.remove();this.focused&&("touchend"==d.type?this.defer("focus"):this.focus())})))[0];this.scrollOnFocus&&this.defer(function(){l.scrollIntoView(this.domNode)});this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&"none"!=w.get(this.domNode,"display")},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(a){}},compare:function(a,f){return"number"==typeof a&&"number"==typeof f?isNaN(a)&&isNaN(f)?0:a-f:a>f?1:a<f?-1:0},onChange:function(){},
_onChangeActive:!1,_handleOnChange:function(a,f){void 0!=this._lastValueReported||null!==f&&this._onChangeActive||(this._resetValue=this._lastValueReported=a);this._pendingOnChange=this._pendingOnChange||typeof a!=typeof this._lastValueReported||0!=this.compare(a,this._lastValueReported);(this.intermediateChanges||f||void 0===f)&&this._pendingOnChange&&(this._lastValueReported=a,this._pendingOnChange=!1,this._onChangeActive&&(this._onChangeHandle&&this._onChangeHandle.remove(),this._onChangeHandle=
this.defer(function(){this._onChangeHandle=null;this.onChange(a)})))},create:function(){this.inherited(arguments);this._onChangeActive=!0},destroy:function(){this._onChangeHandle&&(this._onChangeHandle.remove(),this.onChange(this._lastValueReported));this.inherited(arguments)}})})},"dijit/form/_ButtonMixin":function(){define(["dojo/_base/declare","dojo/dom","dojo/has","../registry"],function(G,B,A,w){var q=G("dijit.form._ButtonMixin"+(A("dojo-bidi")?"_NoBidi":""),null,{label:"",type:"button",__onClick:function(h){h.stopPropagation();
h.preventDefault();this.disabled||this.valueNode.click(h);return!1},_onClick:function(h){if(this.disabled)return h.stopPropagation(),h.preventDefault(),!1;!1===this.onClick(h)&&h.preventDefault();var p=h.defaultPrevented;if(!p&&"submit"==this.type&&!(this.valueNode||this.focusNode).form)for(var e=this.domNode;e.parentNode;e=e.parentNode){var l=w.byNode(e);if(l&&"function"==typeof l._onSubmit){l._onSubmit(h);h.preventDefault();p=!0;break}}return!p},postCreate:function(){this.inherited(arguments);B.setSelectable(this.focusNode,
!1)},onClick:function(){return!0},_setLabelAttr:function(h){this._set("label",h);(this.containerNode||this.focusNode).innerHTML=h;this.onLabelSet()},onLabelSet:function(){}});A("dojo-bidi")&&(q=G("dijit.form._ButtonMixin",q,{onLabelSet:function(){this.inherited(arguments);this.applyTextDir(this.containerNode||this.focusNode)}}));return q})},"dijit/form/_ToggleButtonMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(G,B){return G("dijit.form._ToggleButtonMixin",null,{checked:!1,
_aria_attr:"aria-pressed",_onClick:function(A){var w=this.checked;this._set("checked",!w);var q=this.inherited(arguments);this.set("checked",q?this.checked:w);return q},_setCheckedAttr:function(A,w){this._set("checked",A);var q=this.focusNode||this.domNode;this._created&&B.get(q,"checked")!=!!A&&B.set(q,"checked",!!A);q.setAttribute(this._aria_attr,String(A));this._handleOnChange(A,w)},postCreate:function(){this.inherited(arguments);var A=this.focusNode||this.domNode;this.checked&&A.setAttribute("checked",
"checked");void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.checked)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(G,B,A,w,q){B=B("dijit._editor._Plugin",w,{constructor:function(h){this.params=h||{};A.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",
button:null,command:"",useDefaultCommand:!0,buttonClass:q,disabled:!1,getLabel:function(h){return this.editor.commands[h]},_initButton:function(){if(this.command.length){var h=this.getLabel(this.command),p=this.editor,e=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(h=A.mixin({label:h,ownerDocument:p.ownerDocument,dir:p.dir,lang:p.lang,showLabel:!1,iconClass:e,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete h.name,
this.button=new this.buttonClass(h))}this.get("disabled")&&this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(h,p,e){this.own(G.connect(h,p,this,e))},updateState:function(){var h=this.editor,p=this.command;if(h&&h.isLoaded&&p.length){var e=this.get("disabled");if(this.button)try{var l=h._implCommand(p);var b=!e&&(this[l]?this[l](p):h.queryCommandEnabled(p));this.enabled!==b&&
(this.enabled=b,this.button.set("disabled",!b));if(b&&"boolean"==typeof this.button.checked){var a=h.queryCommandState(p);this.checked!==a&&(this.checked=a,this.button.set("checked",h.queryCommandState(p)))}}catch(f){console.log(f)}}},setEditor:function(h){this.editor=h;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",A.hitch(this.editor,"execCommand",this.command,this.commandArg))):this.button.domNode.style.display=
"none");this.own(this.editor.on("NormalizedDisplayChanged",A.hitch(this,"updateState")))},setToolbar:function(h){this.button&&h.addChild(this.button)},set:function(h,p){if("object"===typeof h){for(var e in h)this.set(e,h[e]);return this}e=this._getAttrNames(h);if(this[e.s])var l=this[e.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(h,p);return l||this},get:function(h){var p=this._getAttrNames(h);return this[p.g]?this[p.g]():this[h]},_setDisabledAttr:function(h){this._set("disabled",
h);this.updateState()},_getAttrNames:function(h){var p=this._attrPairNames;if(p[h])return p[h];var e=h.charAt(0).toUpperCase()+h.substr(1);return p[h]={s:"_set"+e+"Attr",g:"_get"+e+"Attr"}},_set:function(h,p){this[h]=p}});B.registry={};return B})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),function(G,B,A,w,q,h,p,e,l,b,a){return G("dijit._editor.plugins.EnterKeyHandling",
l,{blockNodeForEnter:"BR",constructor:function(f){f&&("blockNodeForEnter"in f&&(f.blockNodeForEnter=f.blockNodeForEnter.toUpperCase()),w.mixin(this,f))},setEditor:function(f){if(this.editor!==f)if(this.editor=f,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,f.onLoadDeferred.then(w.hitch(this,function(m){this.own(q(f.document,"keydown",w.hitch(this,function(d){if(d.keyCode==A.ENTER){var c=w.mixin({},d);c.shiftKey=!0;this.handleEnterKey(c)||(d.stopPropagation(),d.preventDefault())}})));9<=h("ie")&&
10>=h("ie")&&this.own(q(f.document,"paste",w.hitch(this,function(d){setTimeout(w.hitch(this,function(){var c=this.editor.document.selection.createRange();c.move("character",-1);c.select();c.move("character",1);c.select()}),0)})));return m}));else if(this.blockNodeForEnter){var n=w.hitch(this,"handleEnterKey");f.addKeyHandler(13,0,0,n);f.addKeyHandler(13,0,1,n);this.own(this.editor.on("KeyPressed",w.hitch(this,"onKeyPressed")))}},onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var f=
this.editor.selection.getAncestorElement("LI");if(f){h("mozilla")&&"LI"==f.parentNode.parentNode.nodeName&&(f=f.parentNode.parentNode);var n=f.firstChild;!n||1!=n.nodeType||"UL"!=n.nodeName&&"OL"!=n.nodeName||(f.insertBefore(n.ownerDocument.createTextNode("\u00a0"),n),n=a.create(this.editor.window),n.setStart(f.firstChild,0),f=a.getSelection(this.editor.window,!0),f.removeAllRanges(),f.addRange(n))}else b.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter),(f=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?
(f.innerHTML=this.bogusHtmlContent,9>=h("ie")&&(f=this.editor.document.selection.createRange(),f.move("character",-1),f.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(f){var n,m=this.editor.document,
d;if(f.shiftKey){f=this.editor.selection.getParentElement();if(n=a.getAncestor(f,this.blockNodes)){if("LI"==n.tagName)return!0;f=a.getSelection(this.editor.window);var c=f.getRangeAt(0);c.collapsed||(c.deleteContents(),f=a.getSelection(this.editor.window),c=f.getRangeAt(0));if(a.atBeginningOfContainer(n,c.startContainer,c.startOffset)){var g=m.createElement("br");c=a.create(this.editor.window);n.insertBefore(g,n.firstChild);c.setStartAfter(g);f.removeAllRanges();f.addRange(c)}else if(a.atEndOfContainer(n,
c.startContainer,c.startOffset))c=a.create(this.editor.window),g=m.createElement("br"),n.appendChild(g),n.appendChild(m.createTextNode("\u00a0")),c.setStart(n.lastChild,0),f.removeAllRanges(),f.addRange(c);else{if((d=c.startContainer)&&3==d.nodeType){var k=d.nodeValue;var t=m.createTextNode(k.substring(0,c.startOffset));var y=m.createTextNode(k.substring(c.startOffset));n=m.createElement("br");""==y.nodeValue&&h("webkit")&&(y=m.createTextNode("\u00a0"));B.place(t,d,"after");B.place(n,t,"after");B.place(y,
n,"after");B.destroy(d);c=a.create(this.editor.window);c.setStart(y,0);f.removeAllRanges();f.addRange(c);return!1}return!0}}else f=a.getSelection(this.editor.window),f.rangeCount?(c=f.getRangeAt(0))&&c.startContainer&&(c.collapsed||(c.deleteContents(),f=a.getSelection(this.editor.window),c=f.getRangeAt(0)),(d=c.startContainer)&&3==d.nodeType?(n=c.startOffset,d.length<n&&(y=this._adjustNodeAndOffset(d,n),d=y.node,n=y.offset),k=d.nodeValue,t=m.createTextNode(k.substring(0,n)),y=m.createTextNode(k.substring(n)),
n=m.createElement("br"),y.length||(y=m.createTextNode("\u00a0")),t.length?B.place(t,d,"after"):t=d,B.place(n,t,"after"),B.place(y,n,"after"),B.destroy(d)):(0<=c.startOffset&&(g=d.childNodes[c.startOffset]),n=m.createElement("br"),y=m.createTextNode("\u00a0"),g?(B.place(n,g,"before"),B.place(y,n,"after")):(d.appendChild(n),d.appendChild(y))),c=a.create(this.editor.window),c.setStart(y,0),c.setEnd(y,y.length),f.removeAllRanges(),f.addRange(c),this.editor.selection.collapse(!0)):b.prototype.execCommand.call(this.editor,
"inserthtml","\x3cbr\x3e");return!1}var K=!0;f=a.getSelection(this.editor.window);c=f.getRangeAt(0);c.collapsed||(c.deleteContents(),f=a.getSelection(this.editor.window),c=f.getRangeAt(0));g=a.getBlockAncestor(c.endContainer,null,this.editor.editNode);var C=g.blockNode;if(this._checkListLater=C&&("LI"==C.nodeName||"LI"==C.parentNode.nodeName))return h("mozilla")&&(this._pressedEnterInBlock=C),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(C.innerHTML)&&
(C.innerHTML="",h("webkit")&&(c=a.create(this.editor.window),c.setStart(C,0),f.removeAllRanges(),f.addRange(c)),this._checkListLater=!1),!0;if(!g.blockNode||g.blockNode===this.editor.editNode){try{b.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(r){}g={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),blockContainer:this.editor.editNode};if(g.blockNode){if(g.blockNode!=this.editor.editNode&&!(g.blockNode.textContent||g.blockNode.innerHTML).replace(/^\s+|\s+$/g,
"").length)return this.removeTrailingBr(g.blockNode),!1}else g.blockNode=this.editor.editNode;f=a.getSelection(this.editor.window);c=f.getRangeAt(0)}C=m.createElement(this.blockNodeForEnter);C.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(g.blockNode);y=c.endOffset;K=c.endContainer;K.length<y&&(y=this._adjustNodeAndOffset(K,y),K=y.node,y=y.offset);if(a.atEndOfContainer(g.blockNode,K,y))g.blockNode===g.blockContainer?g.blockNode.appendChild(C):B.place(C,g.blockNode,"after"),K=!1,c=a.create(this.editor.window),
c.setStart(C,0),f.removeAllRanges(),f.addRange(c),this.editor.height&&e.scrollIntoView(C);else if(a.atBeginningOfContainer(g.blockNode,c.startContainer,c.startOffset))B.place(C,g.blockNode,g.blockNode===g.blockContainer?"first":"before"),C.nextSibling&&this.editor.height&&(c=a.create(this.editor.window),c.setStart(C.nextSibling,0),f.removeAllRanges(),f.addRange(c),e.scrollIntoView(C.nextSibling)),K=!1;else{g.blockNode===g.blockContainer?g.blockNode.appendChild(C):B.place(C,g.blockNode,"after");K=
!1;g.blockNode.style&&C.style&&g.blockNode.style.cssText&&(C.style.cssText=g.blockNode.style.cssText);if((d=c.startContainer)&&3==d.nodeType){y=c.endOffset;d.length<y&&(y=this._adjustNodeAndOffset(d,y),d=y.node,y=y.offset);k=d.nodeValue;t=m.createTextNode(k.substring(0,y));y=m.createTextNode(k.substring(y,k.length));B.place(t,d,"before");B.place(y,d,"after");B.destroy(d);for(c=t.parentNode;c!==g.blockNode;){k=m.createElement(c.tagName);c.style&&k.style&&c.style.cssText&&(k.style.cssText=c.style.cssText);
"FONT"===c.tagName&&(c.color&&(k.color=c.color),c.face&&(k.face=c.face),c.size&&(k.size=c.size));for(;y;)d=y.nextSibling,k.appendChild(y),y=d;B.place(k,c,"after");t=c;y=k;c=c.parentNode}if(1==y.nodeType||3==y.nodeType&&y.nodeValue)C.innerHTML="";for(t=y;y;)d=y.nextSibling,C.appendChild(y),y=d}c=a.create(this.editor.window);m=t;if("BR"!==this.blockNodeForEnter){for(;m;)n=m,m=d=m.firstChild;n&&n.parentNode?(C=n.parentNode,c.setStart(C,0),f.removeAllRanges(),f.addRange(c),this.editor.height&&e.scrollIntoView(C),
h("mozilla")&&(this._pressedEnterInBlock=g.blockNode)):K=!0}else c.setStart(C,0),f.removeAllRanges(),f.addRange(c),this.editor.height&&e.scrollIntoView(C),h("mozilla")&&(this._pressedEnterInBlock=g.blockNode)}return K},_adjustNodeAndOffset:function(f,n){for(;f.length<n&&f.nextSibling&&3==f.nextSibling.nodeType;)n-=f.length,f=f.nextSibling;return{node:f,offset:n}},removeTrailingBr:function(f){if(f=/P|DIV|LI/i.test(f.tagName)?f:this.editor.selection.getParentOfType(f,["P","DIV","LI"]))f.lastChild&&
(1<f.childNodes.length&&3==f.lastChild.nodeType&&/^[\s\xAD]*$/.test(f.lastChild.nodeValue)||"BR"==f.lastChild.tagName)&&B.destroy(f.lastChild),f.childNodes.length||(f.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k,t,y,K,C,r,E,F,u,D,z,M){var H=A("dijit._editor.RichText",[r,E],{constructor:function(x){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};x&&n.isString(x.value)&&(this.value=x.value);this.onLoadDeferred=new w},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[n.trim,n.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);g("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));g("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(g("ie")||g("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[n.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[n.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);t.publish(M._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var x=n.hitch(this,function(N,P){return function(){return!this.execCommand(N,P)}}),J={b:x("bold"),i:x("italic"),u:x("underline"),a:x("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:x("formatblock",
"h1"),2:x("formatblock","h2"),3:x("formatblock","h3"),4:x("formatblock","h4"),"\\":x("insertunorderedlist")};g("ie")||(J.Z=x("redo"));for(var L in J)this.addKeyHandler(L,!0,!1,J[L])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(H._editorCommandsLocalized)this._local2NativeFormatNames=H._local2NativeFormatNames,this._native2LocalFormatNames=H._native2LocalFormatNames;else{H._editorCommandsLocalized=!0;H._local2NativeFormatNames={};
H._native2LocalFormatNames={};this._local2NativeFormatNames=H._local2NativeFormatNames;this._native2LocalFormatNames=H._native2LocalFormatNames;for(var x="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),J="",L,N=0;L=x[N++];)J="l"!==L.charAt(1)?J+("\x3c"+L+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+L+"\x3e\x3cbr/\x3e"):J+("\x3c"+L+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+L+"\x3e\x3cbr/\x3e");var P=e.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:J});this.ownerDocumentBody.appendChild(P);
x=n.hitch(this,function(){for(var T=P.firstChild;T;)try{this.selection.selectElement(T.firstChild);var S=T.tagName.toLowerCase();this._local2NativeFormatNames[S]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[S]]=S;T=T.nextSibling.nextSibling}catch(Z){}e.destroy(P)});this.defer(x)}},open:function(x){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new w;this.isClosed||this.close();t.publish(M._scopeName+"._editor.RichText::open",
this);1===arguments.length&&x.nodeName&&(this.domNode=x);var J=this.domNode;if(n.isString(this.value)){var L=this.value;J.innerHTML=""}else if(J.nodeName&&"textarea"==J.nodeName.toLowerCase()){var N=this.textarea=J;this.name=N.name;L=N.value;J=this.domNode=this.ownerDocument.createElement("div");J.setAttribute("widgetId",this.id);N.removeAttribute("widgetId");J.cssText=N.cssText;J.className+=" "+N.className;e.place(J,N,"before");var P=n.hitch(this,function(){b.set(N,{display:"block",position:"absolute",
top:"-1000px"});if(g("ie")){var da=N.style;this.__overflow=da.overflow;da.overflow="hidden"}});g("ie")?this.defer(P,10):P();if(N.form){var T=N.value;this.reset=function(){this.getValue()!==T&&this.replaceValue(T)};m(N.form,"submit",n.hitch(this,function(){h.set(N,"disabled",this.disabled);N.value=this.getValue()}))}}else L=D.getChildrenHtml(J),J.innerHTML="";this.value=L;J.nodeName&&"LI"===J.nodeName&&(J.innerHTML=" \x3cbr\x3e");this.header=J.ownerDocument.createElement("div");J.appendChild(this.header);
this.editingArea=J.ownerDocument.createElement("div");J.appendChild(this.editingArea);this.footer=J.ownerDocument.createElement("div");J.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!B.useXDomain||B.allowXdRichTextSave)){if((L=q.byId(M._scopeName+"._editor.RichText.value"))&&""!==L.value){P=L.value.split(this._SEPARATOR);for(var S=0,Z;Z=P[S++];)if(Z=Z.split(this._NAME_CONTENT_SEP),Z[0]===this.name){this.value=Z[1];P=P.splice(S,1);L.value=P.join(this._SEPARATOR);
break}}H._globalSaveHandler||(H._globalSaveHandler={},y.addOnUnload(function(){for(var da in H._globalSaveHandler){var Q=H._globalSaveHandler[da];n.isFunction(Q)&&Q()}}));H._globalSaveHandler[this.id]=n.hitch(this,"_saveContent")}this.isClosed=!1;L=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");L.id=this.id+"_iframe";L.style.border="none";L.style.width="100%";this._layoutMode?L.style.height="100%":7<=g("ie")?(this.height&&(L.style.height=this.height),this.minHeight&&(L.style.minHeight=
this.minHeight)):L.style.height=this.height?this.height:this.minHeight;L.frameBorder=0;L._loadFunc=n.hitch(this,function(da){this.window=da;this.document=da.document;this.selection=new F.SelectionManager(da);g("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});P=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");P=11>g("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+P+"');document.close()":
"javascript: '"+P+"'";this.editingArea.appendChild(L);L.src=P;"LI"===J.nodeName&&(J.lastChild.style.marginTop="-1.2em");p.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var x=b.getComputedStyle(this.domNode);if(this["aria-label"])var J=this["aria-label"];else{var L=d('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||q.byId(this["aria-labelledby"],this.ownerDocument);L&&(J=L.textContent||L.innerHTML||"")}L="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(J?" aria-label\x3d'"+k.escape(J)+"'":"")+"\x3e\x3c/div\x3e";var N=[x.fontWeight,x.fontSize,x.fontFamily].join(" "),P=x.lineHeight;P=0<=P.indexOf("px")?parseFloat(P)/parseFloat(x.fontSize):0<=P.indexOf("em")?parseFloat(P):"normal";var T="",S=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(Z){Z=Z.replace(/^;/ig,"")+";";var da=Z.split(":")[0];if(da){da=n.trim(da);da=da.toLowerCase();var Q,W="";for(Q=0;Q<da.length;Q++){var aa=da.charAt(Q);switch(aa){case "-":Q++,aa=da.charAt(Q).toUpperCase();
default:W+=aa}}b.set(S.domNode,W,"")}T+=Z+";"});this.iframe.setAttribute("title",J);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||a.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",J?"\x3ctitle\x3e"+k.escape(J)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",N,";\n",this.height||g("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",P,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",g("ie")||g("trident")||g("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",J?" aria-label\x3d'"+k.escape(J)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+T+"'\x3e",L,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var x=[];this.styleSheets&&(x=this.styleSheets.split(";"),this.styleSheets=
"");x=x.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var J="",L=0,N,P=C.get(this.ownerDocument);N=x[L++];)N=(new K(P.location,N)).toString(),this.editingAreaStyleSheets.push(N),J+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+N+'"/\x3e';return J},addStyleSheet:function(x){var J=x.toString(),L=C.get(this.ownerDocument);if("."===J.charAt(0)||"/"!==J.charAt(0)&&!x.host)J=(new K(L.location,J)).toString();-1<G.indexOf(this.editingAreaStyleSheets,J)||(this.editingAreaStyleSheets.push(J),
this.onLoadDeferred.then(n.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(J);else{var N=this.document.getElementsByTagName("head")[0],P=this.document.createElement("link");P.rel="stylesheet";P.type="text/css";P.href=J;N.appendChild(P)}})))},removeStyleSheet:function(x){var J=x.toString(),L=C.get(this.ownerDocument);if("."===J.charAt(0)||"/"!==J.charAt(0)&&!x.host)J=(new K(L.location,J)).toString();x=G.indexOf(this.editingAreaStyleSheets,J);-1!==x&&(delete this.editingAreaStyleSheets[x],
d('link[href\x3d"'+J+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(x){x=!!x;this._set("disabled",x);if(this.isLoaded){var J=g("ie")&&(this.isLoaded||!this.focusOnLoad);J&&(this.editNode.unselectable="on");this.editNode.contentEditable=!x;this.editNode.tabIndex=x?"-1":this.tabIndex;J&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(g("mozilla")&&!x&&this._mozSettingProps){x=this._mozSettingProps;for(var L in x)if(x.hasOwnProperty(L))try{this.document.execCommand(L,
!1,x[L])}catch(N){}}this._disabledOK=!0}},onLoad:function(x){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=z.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var J=this;this.beforeIframeNode=e.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=e.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){J.editNode.focus()};this.focusNode=
this.editNode;var L=this.events.concat(this.captureEvents),N=this.iframe?this.document:this.editNode;this.own.apply(this,G.map(L,function(P){var T=P.toLowerCase().replace(/^on/,"");return m(N,T,n.hitch(this,P))},this));this.own(m(N,"mouseup",n.hitch(this,"onClick")));g("ie")&&(this.own(m(this.document,"mousedown",n.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);g("webkit")&&(this._webkitListener=this.own(m(this.document,"mouseup",n.hitch(this,"onDisplayChanged")))[0],this.own(m(this.document,
"mousedown",n.hitch(this,function(P){P=P.target;!P||P!==this.document.body&&P!==this.document||this.defer("placeCursorAtEnd")}))));if(g("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(P){}this.isLoaded=!0;this.set("disabled",this.disabled);L=n.hitch(this,function(){this.setValue(x);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&c(n.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(L):L()},onKeyDown:function(x){if(x.keyCode===f.SHIFT||x.keyCode===f.ALT||x.keyCode===f.META||x.keyCode===f.CTRL)return!0;x.keyCode===f.TAB&&this.isTabIndent&&(x.stopPropagation(),x.preventDefault(),this.queryCommandEnabled(x.shiftKey?"outdent":"indent")&&this.execCommand(x.shiftKey?"outdent":"indent"));if(x.keyCode==f.TAB&&!this.isTabIndent&&!x.ctrlKey&&!x.altKey)return x.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>g("ie")&&x.keyCode===f.BACKSPACE&&"Control"===this.document.selection.type&&(x.stopPropagation(),x.preventDefault(),this.execCommand("delete"));g("ff")&&(x.keyCode===f.PAGE_UP||x.keyCode===f.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&x.preventDefault();var J=this._keyHandlers[x.keyCode],L=arguments;J&&!x.altKey&&G.some(J,function(N){if(!(N.shift^x.shiftKey||N.ctrl^(x.ctrlKey||x.metaKey)))return N.handler.apply(this,L)||x.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(x){a.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",x)},_setValueAttr:function(x){this.setValue(x)},_setDisableSpellCheckAttr:function(x){this.document?h.set(this.document.body,"spellcheck",!x):this.onLoadDeferred.then(n.hitch(this,function(){h.set(this.document.body,"spellcheck",!x)}));this._set("disableSpellCheck",x)},addKeyHandler:function(x,J,L,N){"string"==
typeof x&&(x=x.toUpperCase().charCodeAt(0));n.isArray(this._keyHandlers[x])||(this._keyHandlers[x]=[]);this._keyHandlers[x].push({shift:L||!1,ctrl:J||!1,handler:N})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(x){this.onDisplayChanged(x)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(x){(g("ie")||g("trident"))&&this.defer(function(){z.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var J=this.getValue(!0);if(J!==this.value)this.onChange(J);
this._set("value",J)},_onFocus:function(x){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!g("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>g("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(x,J){x=x.toLowerCase();"formatblock"===x?g("safari")&&void 0===J&&(x="heading"):"hilitecolor"!==x||g("mozilla")||(x="backcolor");return x},_implCommand:function(x){return"_"+this._normalizeCommand(x)+"EnabledImpl"},_qcaCache:{},
queryCommandAvailable:function(x){var J=this._qcaCache[x];return void 0!==J?J:this._qcaCache[x]=this._queryCommandAvailable(x)},_queryCommandAvailable:function(x){switch(x.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return g("ie")||g("trident")||g("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!g("webkit");default:return!1}},execCommand:function(x,J){this.focused&&this.focus();x=this._normalizeCommand(x,J);if(void 0!==J){if("heading"===x)throw Error("unimplemented");"formatblock"===
x&&(g("ie")||g("trident"))&&(J="\x3c"+J+"\x3e")}var L="_"+x+"Impl";if(this[L])var N=this[L](J);else if((J=1<arguments.length?J:null)||"createlink"!==x)N=this.document.execCommand(x,!1,J);this.onDisplayChanged();return N},queryCommandEnabled:function(x){if(this.disabled||!this._disabledOK)return!1;x=this._normalizeCommand(x);var J=this._implCommand(x);return this[J]?this[J](x):this._browserQueryCommandEnabled(x)},queryCommandState:function(x){if(this.disabled||!this._disabledOK)return!1;x=this._normalizeCommand(x);
try{return this.document.queryCommandState(x)}catch(J){return!1}},queryCommandValue:function(x){if(this.disabled||!this._disabledOK)return!1;x=this._normalizeCommand(x);if(g("ie")&&"formatblock"===x)x=this._native2LocalFormatNames[this.document.queryCommandValue(x)];else if(g("mozilla")&&"hilitecolor"===x){try{var J=this.document.queryCommandValue("styleWithCSS")}catch(L){J=!1}this.document.execCommand("styleWithCSS",!1,!0);x=this.document.queryCommandValue(x);this.document.execCommand("styleWithCSS",
!1,J)}else x=this.document.queryCommandValue(x);return x},_sCall:function(x,J){return this.selection[x].apply(this.selection,J)},placeCursorAtStart:function(){this.focus();var x=!1;if(g("mozilla"))for(var J=this.editNode.firstChild;J;){if(3===J.nodeType){if(0<J.nodeValue.replace(/^\s+|\s+$/g,"").length){x=!0;this.selection.selectElement(J);break}}else if(1===J.nodeType){x=!0;var L=J.tagName?J.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(L)?this.selection.selectElement(J):
this.selection.selectElementChildren(J);break}J=J.nextSibling}else x=!0,this.selection.selectElementChildren(this.editNode);x&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var x=!1;if(g("mozilla"))for(var J=this.editNode.lastChild;J;){if(3===J.nodeType){if(0<J.nodeValue.replace(/^\s+|\s+$/g,"").length){x=!0;this.selection.selectElement(J);break}}else if(1===J.nodeType){x=!0;this.selection.selectElement(J.lastChild||J);break}J=J.previousSibling}else x=!0,this.selection.selectElementChildren(this.editNode);
x&&this.selection.collapse(!1)},getValue:function(x){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,x):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(x){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){x=this._preFilterContent(x);var J=this.isClosed?this.domNode:this.editNode;J.innerHTML=x;this._preDomFilterContent(J)}else this.textarea.value=x;this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(n.hitch(this,function(){this.setValue(x)}))},replaceValue:function(x){this.isClosed?this.setValue(x):this.window&&this.window.getSelection&&!g("mozilla")?this.setValue(x):this.window&&this.window.getSelection?(x=this._preFilterContent(x),this.execCommand("selectall"),this.execCommand("inserthtml",x),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(x);this._set("value",this.getValue(!0))},_preFilterContent:function(x){var J=
x;G.forEach(this.contentPreFilters,function(L){L&&(J=L(J))});return J},_preDomFilterContent:function(x){x=x||this.editNode;G.forEach(this.contentDomPreFilters,function(J){J&&n.isFunction(J)&&J(x)},this)},_postFilterContent:function(x,J){if(n.isString(x))var L=x;else x=x||this.editNode,this.contentDomPostFilters.length&&(J&&(x=n.clone(x)),G.forEach(this.contentDomPostFilters,function(N){x=N(x)})),L=D.getChildrenHtml(x);n.trim(L.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(L="");G.forEach(this.contentPostFilters,
function(N){L=N(L)});return L},_saveContent:function(){var x=q.byId(M._scopeName+"._editor.RichText.value");x&&(x.value&&(x.value+=this._SEPARATOR),x.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(x,J){x=x.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");J||(x=x.replace(/'/gm,"\x26#39;"));return x},getNodeHtml:function(x){a.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return D.getNodeHtml(x)},getNodeChildrenHtml:function(x){a.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return D.getChildrenHtml(x)},close:function(x){if(!this.isClosed){arguments.length||(x=!0);x&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);g("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var J=this.textarea.style;J.position="";J.left=J.top="";g("ie")&&(J.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;e.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;p.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);H._globalSaveHandler&&delete H._globalSaveHandler[this.id]},_removeMozBogus:function(x){return x.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(x){x=x.replace(/\sclass="webkit-block-placeholder"/gi,"");x=x.replace(/\sclass="apple-style-span"/gi,
"");return x=x.replace(/<meta charset="utf-8" \/>/gi,"")},_normalizeFontStyle:function(x){return x.replace(/<(\/)?strong([ >])/gi,"\x3c$1b$2").replace(/<(\/)?em([ >])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(x){return x.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(x){if(!x)return!1;
if(g("ie")||g("trident")||g("edge"))return this.focused&&!this.disabled;var J=9>g("ie")?this.document.selection.createRange():this.document;try{return J.queryCommandEnabled(x)}catch(L){return!1}},_createlinkEnabledImpl:function(){var x=!0;return x=g("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var x=!0;return x=g("mozilla")||g("webkit")||g("ie")||g("trident")||g("edge")?
this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var x=!0;return x=g("mozilla")||g("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var x=!0;g("webkit")?((x=this.window.getSelection())&&(x=x.toString()),x=!!x):x=this._browserQueryCommandEnabled("cut");return x},_copyEnabledImpl:function(){var x=!0;g("webkit")?((x=this.window.getSelection())&&(x=x.toString()),x=!!x):x=this._browserQueryCommandEnabled("copy");
return x},_pasteEnabledImpl:function(){var x=!0;return g("webkit")?!0:x=this._browserQueryCommandEnabled("paste")},_inserthorizontalruleImpl:function(x){return g("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,x)},_unlinkImpl:function(x){return this.queryCommandEnabled("unlink")&&(g("mozilla")||g("webkit"))?(x=this.selection.getAncestorElement("a"),this.selection.selectElement(x),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",
!1,x)},_hilitecolorImpl:function(x){if(!this._handleTextColorOrProperties("hilitecolor",x))if(g("mozilla")){this.document.execCommand("styleWithCSS",!1,!0);console.log("Executing color command.");var J=this.document.execCommand("hilitecolor",!1,x);this.document.execCommand("styleWithCSS",!1,!1)}else J=this.document.execCommand("hilitecolor",!1,x);return J},_backcolorImpl:function(x){g("ie")&&(x=x?x:null);var J=this._handleTextColorOrProperties("backcolor",x);J||(J=this.document.execCommand("backcolor",
!1,x));return J},_forecolorImpl:function(x){g("ie")&&(x=x?x:null);var J=!1;(J=this._handleTextColorOrProperties("forecolor",x))||(J=this.document.execCommand("forecolor",!1,x));return J},_inserthtmlImpl:function(x){x=this._preFilterContent(x);var J=!0;if(9>g("ie")){var L=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var N=L.item(0);L.length;)L.remove(L.item(0));N.outerHTML=x}else L.pasteHTML(x);L.select()}else if(8>g("trident")){var P=u.getSelection(this.window);
if(P&&P.rangeCount&&P.getRangeAt){L=P.getRangeAt(0);L.deleteContents();var T=e.create("div");T.innerHTML=x;for(N=this.document.createDocumentFragment();x=T.firstChild;)var S=N.appendChild(x);L.insertNode(N);S&&(L=L.cloneRange(),L.setStartAfter(S),L.collapse(!1),P.removeAllRanges(),P.addRange(L))}}else g("mozilla")&&!x.length?this.selection.remove():J=this.document.execCommand("inserthtml",!1,x);return J},_boldImpl:function(x){var J=!1;if(g("ie")||g("trident"))this._adaptIESelection(),J=this._adaptIEFormatAreaAndExec("bold");
J||(J=this.document.execCommand("bold",!1,x));return J},_italicImpl:function(x){var J=!1;if(g("ie")||g("trident"))this._adaptIESelection(),J=this._adaptIEFormatAreaAndExec("italic");J||(J=this.document.execCommand("italic",!1,x));return J},_underlineImpl:function(x){var J=!1;if(g("ie")||g("trident"))this._adaptIESelection(),J=this._adaptIEFormatAreaAndExec("underline");J||(J=this.document.execCommand("underline",!1,x));return J},_strikethroughImpl:function(x){var J=!1;if(g("ie")||g("trident"))this._adaptIESelection(),
J=this._adaptIEFormatAreaAndExec("strikethrough");J||(J=this.document.execCommand("strikethrough",!1,x));return J},_superscriptImpl:function(x){var J=!1;if(g("ie")||g("trident"))this._adaptIESelection(),J=this._adaptIEFormatAreaAndExec("superscript");J||(J=this.document.execCommand("superscript",!1,x));return J},_subscriptImpl:function(x){var J=!1;if(g("ie")||g("trident"))this._adaptIESelection(),J=this._adaptIEFormatAreaAndExec("subscript");J||(J=this.document.execCommand("subscript",!1,x));return J},
_fontnameImpl:function(x){if(g("ie")||g("trident"))var J=this._handleTextColorOrProperties("fontname",x);J||(J=this.document.execCommand("fontname",!1,x));return J},_fontsizeImpl:function(x){if(g("ie")||g("trident"))var J=this._handleTextColorOrProperties("fontsize",x);J||(J=this.document.execCommand("fontsize",!1,x));return J},_insertorderedlistImpl:function(x){var J=!1;if(g("ie")||g("trident")||g("edge"))J=this._adaptIEList("insertorderedlist",x);J||(J=this.document.execCommand("insertorderedlist",
!1,x));return J},_insertunorderedlistImpl:function(x){var J=!1;if(g("ie")||g("trident")||g("edge"))J=this._adaptIEList("insertunorderedlist",x);J||(J=this.document.execCommand("insertunorderedlist",!1,x));return J},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(x){var J=0;if(x&&x.childNodes){var L;for(L=0;L<x.childNodes.length;L++){var N=l.position(x.childNodes[L]);
J+=N.h}}return J},_isNodeEmpty:function(x,J){return 1===x.nodeType?0<x.childNodes.length?this._isNodeEmpty(x.childNodes[0],J):!0:3===x.nodeType?""===x.nodeValue.substring(J):!1},_removeStartingRangeFromRange:function(x,J){if(x.nextSibling)J.setStart(x.nextSibling,0);else{for(x=x.parentNode;x&&null==x.nextSibling;)x=x.parentNode;x&&J.setStart(x.nextSibling,0)}return J},_adaptIESelection:function(){var x=u.getSelection(this.window);if(x&&x.rangeCount&&!x.isCollapsed){for(var J=x.getRangeAt(0),L=J.startContainer,
N=J.startOffset;3===L.nodeType&&N>=L.length&&L.nextSibling;)N-=L.length,L=L.nextSibling;for(var P=null;this._isNodeEmpty(L,N)&&L!==P;)P=L,J=this._removeStartingRangeFromRange(L,J),L=J.startContainer,N=0;x.removeAllRanges();x.addRange(J)}},_adaptIEFormatAreaAndExec:function(x){var J=u.getSelection(this.window),L=this.document,N;if(x&&J&&J.isCollapsed){if(this.queryCommandValue(x)){x=this._tagNamesForCommand(x);var P=J.getRangeAt(0);var T=P.startContainer;if(3===T.nodeType){var S=P.endOffset;T.length<
S&&(S=this._adjustNodeAndOffset(Z,S),T=S.node,S=S.offset)}for(;T&&T!==this.editNode;){var Z=T.tagName?T.tagName.toLowerCase():"";if(-1<G.indexOf(x,Z)){var da=T;break}T=T.parentNode}if(da&&(Z=P.startContainer,x=L.createElement(da.tagName),e.place(x,da,"after"),Z&&3===Z.nodeType)){S=P.endOffset;Z.length<S&&(S=this._adjustNodeAndOffset(Z,S),Z=S.node,S=S.offset);T=Z.nodeValue;P=L.createTextNode(T.substring(0,S));var Q=T.substring(S,T.length);Q&&(N=L.createTextNode(Q));e.place(P,Z,"before");if(N){var W=
L.createElement("span");W.className="ieFormatBreakerSpan";e.place(W,Z,"after");e.place(N,W,"after");N=W}e.destroy(Z);S=P.parentNode;for(Z=[];S!==da;){T=S.tagName;P={tagName:T};Z.push(P);T=L.createElement(T);S.style&&T.style&&S.style.cssText&&(T.style.cssText=S.style.cssText,P.cssText=S.style.cssText);"FONT"===S.tagName&&(S.color&&(T.color=S.color,P.color=S.color),S.face&&(T.face=S.face,P.face=S.face),S.size&&(T.size=S.size,P.size=S.size));S.className&&(T.className=S.className,P.className=S.className);
if(N)for(;N;)P=N.nextSibling,T.appendChild(N),N=P;T.tagName==S.tagName?(W=L.createElement("span"),W.className="ieFormatBreakerSpan",e.place(W,S,"after"),e.place(T,W,"after")):e.place(T,S,"after");P=S;N=T;S=S.parentNode}if(N){if(1===N.nodeType||3===N.nodeType&&N.nodeValue)x.innerHTML="";for(;N;)P=N.nextSibling,x.appendChild(N),N=P}if(Z.length){P=Z.pop();N=L.createElement(P.tagName);P.cssText&&N.style&&(N.style.cssText=P.cssText);P.className&&(N.className=P.className);"FONT"===P.tagName&&(P.color&&
(N.color=P.color),P.face&&(N.face=P.face),P.size&&(N.size=P.size));for(e.place(N,x,"before");Z.length;)P=Z.pop(),da=L.createElement(P.tagName),P.cssText&&da.style&&(da.style.cssText=P.cssText),P.className&&(da.className=P.className),"FONT"===P.tagName&&(P.color&&(da.color=P.color),P.face&&(da.face=P.face),P.size&&(da.size=P.size)),N.appendChild(da),N=da;da=L.createTextNode(".");W.appendChild(da);N.appendChild(da)}else W=L.createElement("span"),W.className="ieFormatBreakerSpan",da=L.createTextNode("."),
W.appendChild(da),e.place(W,x,"before");N=u.create(this.window);N.setStart(da,0);N.setEnd(da,da.length);J.removeAllRanges();J.addRange(N);this.selection.collapse(!1);da.parentNode.innerHTML="";x.firstChild||e.destroy(x);return!0}return!1}P=J.getRangeAt(0);if((Z=P.startContainer)&&3===Z.nodeType)return S=P.startOffset,Z.length<S&&(S=this._adjustNodeAndOffset(Z,S),Z=S.node,S=S.offset),T=Z.nodeValue,P=L.createTextNode(T.substring(0,S)),Q=T.substring(S),""!==Q&&(N=L.createTextNode(T.substring(S))),W=
L.createElement("span"),da=L.createTextNode("."),W.appendChild(da),P.length?e.place(P,Z,"after"):P=Z,e.place(W,P,"after"),N&&e.place(N,W,"after"),e.destroy(Z),N=u.create(this.window),N.setStart(da,0),N.setEnd(da,da.length),J.removeAllRanges(),J.addRange(N),L.execCommand(x),e.place(W.firstChild,W,"before"),e.destroy(W),N.setStart(da,0),N.setEnd(da,da.length),J.removeAllRanges(),J.addRange(N),this.selection.collapse(!1),da.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(x){var J=u.getSelection(this.window);
if(J.isCollapsed&&J.rangeCount&&!this.queryCommandValue(x)){var L=J.getRangeAt(0),N=L.startContainer;if(N&&3==N.nodeType&&!L.startOffset)return L="ul","insertorderedlist"===x&&(L="ol"),x=this.document.createElement(L),L=e.create("li",null,x),e.place(x,N,"before"),L.appendChild(N),e.create("br",null,x,"after"),x=u.create(this.window),x.setStart(N,0),x.setEnd(N,N.length),J.removeAllRanges(),J.addRange(x),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(x,J){var L=u.getSelection(this.window),
N=this.document,P,T;J=J||null;if(x&&L&&L.isCollapsed&&L.rangeCount){var S=L.getRangeAt(0);if((P=S.startContainer)&&3===P.nodeType){var Z=S.startOffset;P.length<Z&&(S=this._adjustNodeAndOffset(P,Z),P=S.node,Z=S.offset);var da=P.nodeValue;S=N.createTextNode(da.substring(0,Z));""!==da.substring(Z)&&(T=N.createTextNode(da.substring(Z)));da=N.createElement("span");Z=N.createTextNode(".");da.appendChild(Z);N=N.createElement("span");da.appendChild(N);S.length?e.place(S,P,"after"):S=P;e.place(da,S,"after");
T&&e.place(T,da,"after");e.destroy(P);P=u.create(this.window);P.setStart(Z,0);P.setEnd(Z,Z.length);L.removeAllRanges();L.addRange(P);if(g("webkit")){L="color";if("hilitecolor"===x||"backcolor"===x)L="backgroundColor";b.set(da,L,J);this.selection.remove();e.destroy(N);da.innerHTML="\x26#160;";this.selection.selectElement(da);this.focus()}else this.execCommand(x,J),e.place(da.firstChild,da,"before"),e.destroy(da),P.setStart(Z,0),P.setEnd(Z,Z.length),L.removeAllRanges(),L.addRange(P),this.selection.collapse(!1),
Z.parentNode.removeChild(Z);return!0}}return!1},_adjustNodeAndOffset:function(x,J){for(;x.length<J&&x.nextSibling&&3===x.nextSibling.nodeType;)J-=x.length,x=x.nextSibling;return{node:x,offset:J}},_tagNamesForCommand:function(x){return"bold"===x?["b","strong"]:"italic"===x?["i","em"]:"strikethrough"===x?["s","strike"]:"superscript"===x?["sup"]:"subscript"===x?["sub"]:"underline"===x?["u"]:[]},_stripBreakerNodes:function(x){if(this.isLoaded)return d(".ieFormatBreakerSpan",x).forEach(function(J){for(;J.firstChild;)e.place(J.firstChild,
J,"before");e.destroy(J)}),x},_stripTrailingEmptyNodes:function(x){function J(L){return/^(p|div|br)$/i.test(L.nodeName)&&0==L.children.length&&/^[\s\xA0]*$/.test(L.textContent||L.innerText||"")||3===L.nodeType&&/^[\s\xA0]*$/.test(L.nodeValue)}for(;x.lastChild&&J(x.lastChild);)e.destroy(x.lastChild);return x},_setTextDirAttr:function(x){this._set("textDir",x);this.onLoadDeferred.then(n.hitch(this,function(){this.editNode.dir=x}))}});return H})},"dijit/selection":function(){define("dojo/_base/array dojo/dom dojo/_base/lang dojo/sniff dojo/_base/window dijit/focus".split(" "),
function(G,B,A,w,q,h){var p=function(l){var b=l.document;this.getType=function(){if(b.getSelection){var a="text";try{var f=l.getSelection()}catch(n){}f&&1==f.rangeCount&&(f=f.getRangeAt(0),f.startContainer==f.endContainer&&1==f.endOffset-f.startOffset&&3!=f.startContainer.nodeType&&(a="control"));return a}return b.selection.type.toLowerCase()};this.getSelectedText=function(){if(b.getSelection){var a=l.getSelection();return a?a.toString():""}return"control"==this.getType()?null:b.selection.createRange().text};
this.getSelectedHtml=function(){if(b.getSelection){var a=l.getSelection();if(a&&a.rangeCount){var f,n="";for(f=0;f<a.rangeCount;f++){var m=a.getRangeAt(f).cloneContents(),d=b.createElement("div");d.appendChild(m);n+=d.innerHTML}return n}return null}return"control"==this.getType()?null:b.selection.createRange().htmlText};this.getSelectedElement=function(){if("control"==this.getType()){if(b.getSelection){var a=l.getSelection();return a.anchorNode.childNodes[a.anchorOffset]}if((a=b.selection.createRange())&&
a.item)return b.selection.createRange().item(0)}return null};this.getParentElement=function(){if("control"==this.getType()){var a=this.getSelectedElement();if(a)return a.parentNode}else if(b.getSelection){if(a=b.getSelection()){for(a=a.anchorNode;a&&1!=a.nodeType;)a=a.parentNode;return a}}else return a=b.selection.createRange(),a.collapse(!0),a.parentElement();return null};this.hasAncestorElement=function(a){return null!=this.getAncestorElement.apply(this,arguments)};this.getAncestorElement=function(a){var f=
this.getSelectedElement()||this.getParentElement();return this.getParentOfType(f,arguments)};this.isTag=function(a,f){if(a&&a.tagName){a=a.tagName.toLowerCase();for(var n=0;n<f.length;n++){var m=String(f[n]).toLowerCase();if(a==m)return m}}return""};this.getParentOfType=function(a,f){for(;a;){if(this.isTag(a,f).length)return a;a=a.parentNode}return null};this.collapse=function(a){if(b.getSelection){var f=l.getSelection();f.removeAllRanges?a?f.collapseToStart():f.collapseToEnd():f.collapse(a)}else f=
b.selection.createRange(),f.collapse(a),f.select()};this.remove=function(){var a=b.selection;b.getSelection?(a=l.getSelection(),a.deleteFromDocument()):"none"!=a.type.toLowerCase()&&a.clear();return a};this.selectElementChildren=function(a,f){a=B.byId(a);if(b.getSelection)if(f=l.getSelection(),w("opera")){var n=f.rangeCount?f.getRangeAt(0):b.createRange();n.setStart(a,0);n.setEnd(a,3==a.nodeType?a.length:a.childNodes.length);f.addRange(n)}else f.selectAllChildren(a);else if(n=a.ownerDocument.body.createTextRange(),
n.moveToElementText(a),!f)try{n.select()}catch(m){}};this.selectElement=function(a,f){a=B.byId(a);if(b.getSelection){f=b.getSelection();var n=b.createRange();f.removeAllRanges&&(w("opera")&&f.getRangeAt(0)&&(n=f.getRangeAt(0)),n.selectNode(a),f.removeAllRanges(),f.addRange(n))}else try{var m=a.tagName?a.tagName.toLowerCase():"";n="img"===m||"table"===m?q.body(b).createControlRange():q.body(b).createRange();n.addElement(a);f||n.select()}catch(d){this.selectElementChildren(a,f)}};this.inSelection=function(a){if(a){var f;
if(b.getSelection){var n=l.getSelection();n&&0<n.rangeCount&&(f=n.getRangeAt(0));if(f&&f.compareBoundaryPoints&&b.createRange)try{var m=b.createRange();m.setStart(a,0);if(1===f.compareBoundaryPoints(f.START_TO_END,m))return!0}catch(d){}}else{f=b.selection.createRange();try{m=a.ownerDocument.body.createTextRange(),m.moveToElementText(a)}catch(d){}if(f&&m&&1===f.compareEndPoints("EndToStart",m))return!0}}return!1};this.getBookmark=function(){var a,f=b.selection,n=h.curNode;if(b.getSelection){if(f=l.getSelection())if(f.isCollapsed){if(a=
n?n.tagName:"")if(a=a.toLowerCase(),"textarea"==a||"input"==a&&(!n.type||"text"==n.type.toLowerCase()))return f={start:n.selectionStart,end:n.selectionEnd,node:n,pRange:!0},{isCollapsed:f.end<=f.start,mark:f};a={isCollapsed:!0};f.rangeCount&&(a.mark=f.getRangeAt(0).cloneRange())}else{var m=f.getRangeAt(0);a={isCollapsed:!1,mark:m.cloneRange()}}}else if(f){a=n?n.tagName:"";a=a.toLowerCase();if(n&&a&&("button"==a||"textarea"==a||"input"==a)){if(f.type&&"none"==f.type.toLowerCase())return{isCollapsed:!0,
mark:null};m=f.createRange();return{isCollapsed:m.text&&m.text.length?!1:!0,mark:{range:m,pRange:!0}}}a={};try{m=f.createRange(),a.isCollapsed=!("Text"==f.type?m.htmlText.length:m.length)}catch(d){return a.isCollapsed=!0,a}if("CONTROL"==f.type.toUpperCase())if(m.length)for(a.mark=[],f=0,n=m.length;f<n;)a.mark.push(m.item(f++));else a.isCollapsed=!0,a.mark=null;else a.mark=m.getBookmark()}else console.warn("No idea how to store the current selection for this browser!");return a};this.moveToBookmark=
function(a){if(a=a.mark)if(b.getSelection){var f=l.getSelection();f&&f.removeAllRanges?a.pRange?(f=a.node,f.selectionStart=a.start,f.selectionEnd=a.end):(f.removeAllRanges(),f.addRange(a)):console.warn("No idea how to restore selection for this browser!")}else if(b.selection&&a){if(a.pRange)var n=a.range;else A.isArray(a)?(n=b.body.createControlRange(),G.forEach(a,function(m){n.addElement(m)})):(n=b.body.createTextRange(),n.moveToBookmark(a));n.select()}};this.isCollapsed=function(){return this.getBookmark().isCollapsed}},
e=new p(window);e.SelectionManager=p;return e})},"dijit/_editor/range":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(G,B,A){var w={getIndex:function(p,e){for(var l=[],b=[],a=p,f,n;p!=e;){var m=0;for(f=p.parentNode;n=f.childNodes[m++];)if(n===p){--m;break}l.unshift(m);b.unshift(m-f.childNodes.length);p=f}if(0<l.length&&3==a.nodeType){for(n=a.previousSibling;n&&3==n.nodeType;)l[l.length-1]--,n=n.previousSibling;for(n=a.nextSibling;n&&3==n.nodeType;)b[b.length-
1]++,n=n.nextSibling}return{o:l,r:b}},getNode:function(p,e){if(!A.isArray(p)||0==p.length)return e;var l=e;G.every(p,function(b){if(0<=b&&b<l.childNodes.length)l=l.childNodes[b];else return l=null,!1;return!0});return l},getCommonAncestor:function(p,e,l){l=l||p.ownerDocument.body;var b=function(n){for(var m=[];n;)if(m.unshift(n),n!==l)n=n.parentNode;else break;return m};p=b(p);e=b(e);b=Math.min(p.length,e.length);for(var a=p[0],f=1;f<b;f++)if(p[f]===e[f])a=p[f];else break;return a},getAncestor:function(p,
e,l){for(l=l||p.ownerDocument.body;p&&p!==l;){var b=p.nodeName.toUpperCase();if(e.test(b))return p;p=p.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(p,e,l){l=l||p.ownerDocument.body;e=e||w.BlockTagNames;for(var b=null,a;p&&p!==l;){var f=p.nodeName.toUpperCase();!b&&e.test(f)&&(b=p);!a&&/^(?:BODY|TD|TH|CAPTION)$/.test(f)&&(a=p);p=p.parentNode}return{blockNode:b,blockContainer:a||p.ownerDocument.body}},atBeginningOfContainer:function(p,
e,l){var b=!1,a=0==l;a||3!=e.nodeType||/^[\s\xA0]+$/.test(e.nodeValue.substr(0,l))&&(a=!0);if(a)for(b=!0;e&&e!==p;){if(e.previousSibling){b=!1;break}e=e.parentNode}return b},atEndOfContainer:function(p,e,l){var b=!1,a=l==(e.length||e.childNodes.length);a||3!=e.nodeType||/^[\s\xA0]+$/.test(e.nodeValue.substr(l))&&(a=!0);if(a)for(b=!0;e&&e!==p;){if(e.nextSibling){b=!1;break}e=e.parentNode}return b},adjacentNoneTextNode:function(p,e){var l=p;p=0-p.length||0;for(e=e?"nextSibling":"previousSibling";l&&
3==l.nodeType;)p+=l.length,l=l[e];return[l,p]},create:function(p){p=p||window;return p.getSelection?p.document.createRange():new h},getSelection:function(p,e){if(p.getSelection)return p.getSelection();p=new q.selection(p);e||p._getCurrentSelection();return p}};if(!window.getSelection)var q=w.ie={cachedSelection:{},selection:function(p){this._ranges=[];this.addRange=function(e,l){this._ranges.push(e);l||e._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];
this.rangeCount=0};this.getRangeAt=function(e){return this._ranges[e]};this._getCurrentSelection=function(){this.removeAllRanges();var e=p.document.selection.createRange();e="CONTROL"==p.document.selection.type.toUpperCase()?new h(q.decomposeControlRange(e)):new h(q.decomposeTextRange(e));this.addRange(e,!0),this.isCollapsed=e.collapsed}},decomposeControlRange:function(p){var e=p.item(0),l=p.item(p.length-1);p=e.parentNode;var b=l.parentNode;e=w.getIndex(e,p).o[0];l=w.getIndex(l,b).o[0]+1;return[p,
e,b,l]},getEndPoint:function(p,e){var l=p.duplicate();l.collapse(!e);var b="EndTo"+(e?"End":"Start"),a=l.parentElement(),f;if(0<a.childNodes.length)G.every(a.childNodes,function(d,c){if(3!=d.nodeType)if(l.moveToElementText(d),0<l.compareEndPoints(b,p))if(f&&3==f.nodeType){n=f;var g=!0}else return n=a,m=c,!1;else{if(c==a.childNodes.length-1)return n=a,m=a.childNodes.length,!1}else c==a.childNodes.length-1&&(n=d,g=!0);if(g&&n)return n=(d=w.adjacentNoneTextNode(n)[0])?d.nextSibling:a.firstChild,c=w.adjacentNoneTextNode(n),
d=c[0],c=c[1],d?(l.moveToElementText(d),l.collapse(!1)):l.moveToElementText(a),l.setEndPoint(b,p),m=l.text.length-c,!1;f=d;return!0});else{var n=a;var m=0}e||1!=n.nodeType||m!=n.childNodes.length||(e=n.nextSibling)&&3==e.nodeType&&(n=e,m=0);return[n,m]},setEndPoint:function(p,e,l){p=p.duplicate();var b;if(3!=e.nodeType)if(0<l){if(b=e.childNodes[l-1])if(3==b.nodeType)e=b,l=b.length;else if(b.nextSibling&&3==b.nextSibling.nodeType)e=b.nextSibling,l=0;else{p.moveToElementText(b.nextSibling?b:e);var a=
b.parentNode;b=a.insertBefore(b.ownerDocument.createTextNode(" "),b.nextSibling);p.collapse(!1);a.removeChild(b)}}else p.moveToElementText(e),p.collapse(!0);3==e.nodeType&&(b=w.adjacentNoneTextNode(e),a=b[0],b=b[1],a?(p.moveToElementText(a),p.collapse(!1),"inherit"!=a.contentEditable&&b++):(p.moveToElementText(e.parentNode),p.collapse(!0),p.move("character",1),p.move("character",-1)),l+=b,0<l&&p.move("character",l)!=l&&console.error("Error when moving!"));return p},decomposeTextRange:function(p){var e=
q.getEndPoint(p),l=e[0],b=e[1],a=e[0];e=e[1];p.htmlText.length&&(p.htmlText==p.text?e=b+p.text.length:(e=q.getEndPoint(p,!0),a=e[0],e=e[1]));return[l,b,a,e]},setRange:function(p,e,l,b,a,f){e=q.setEndPoint(p,e,l);p.setEndPoint("StartToStart",e);if(!f)var n=q.setEndPoint(p,b,a);p.setEndPoint("EndToEnd",n||e);return p}},h=w.W3CRange=B(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=
null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=this.startContainer!==this.endContainer?w.getCommonAncestor(this.startContainer,this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(p,e){e=parseInt(e);if(this.startContainer!==p||this.startOffset!=e)delete this._cachedBookmark,this.startContainer=p,this.startOffset=
e,this.endContainer?this._updateInternal():this.setEnd(p,e)},setEnd:function(p,e){e=parseInt(e);if(this.endContainer!==p||this.endOffset!=e)delete this._cachedBookmark,this.endContainer=p,this.endOffset=e,this.startContainer?this._updateInternal():this.setStart(p,e)},setStartAfter:function(p,e){this._setPoint("setStart",p,e,1)},setStartBefore:function(p,e){this._setPoint("setStart",p,e,0)},setEndAfter:function(p,e){this._setPoint("setEnd",p,e,1)},setEndBefore:function(p,e){this._setPoint("setEnd",
p,e,0)},_setPoint:function(p,e,l,b){l=w.getIndex(e,e.parentNode).o;this[p](e.parentNode,l.pop()+b)},_getIERange:function(){var p=(this._body||this.endContainer.ownerDocument.body).createTextRange();q.setRange(p,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed);return p},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var p=this.startContainer,e=this._getIERange();3!==
p.nodeType||this.startOffset||this.setStartBefore(p);e.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var p=new h([this.startContainer,this.startOffset,this.endContainer,this.endOffset]);p._body=this._body;return p},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});A.setObject("dijit.range",w);return w})},"dijit/_editor/html":function(){define(["dojo/_base/array",
"dojo/_base/lang","dojo/sniff"],function(G,B,A){var w={};B.setObject("dijit._editor.html",w);var q=w.escapeXml=function(h,p){h=h.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");p||(h=h.replace(/'/gm,"\x26#39;"));return h};w.getNodeHtml=function(h){var p=[];w.getNodeHtmlHelper(h,p);return p.join("")};w.getNodeHtmlHelper=function(h,p){switch(h.nodeType){case 1:var e=h.nodeName.toLowerCase();if(!e||"/"==e.charAt(0))return"";p.push("\x3c",e);var l=
[],b={},a;if(A("dom-attributes-explicit")||A("dom-attributes-specified-flag"))for(var f=0;a=h.attributes[f++];){var n=a.name;"_dj"===n.substr(0,3)||A("dom-attributes-specified-flag")&&!a.specified||n in b||(a=a.value,("src"==n||"href"==n)&&h.getAttribute("_djrealurl")&&(a=h.getAttribute("_djrealurl")),8===A("ie")&&"style"===n&&(a=a.replace("HEIGHT:","height:").replace("WIDTH:","width:")),l.push([n,a]),b[n]=a)}else{var m=(/^input$|^img$/i.test(h.nodeName)?h:h.cloneNode(!1)).outerHTML;b=m.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi);
m=m.substr(0,m.indexOf("\x3e"));G.forEach(b,function(d){if(d){var c=d.indexOf("\x3d");if(0<c&&(d=d.substring(0,c),"_dj"!=d.substr(0,3)))if("src"!=d&&"href"!=d||!h.getAttribute("_djrealurl")){switch(d){case "style":var g=h.style.cssText.toLowerCase();break;case "class":g=h.className;break;case "width":if("img"===e){(c=/width=(\S+)/i.exec(m))&&(g=c[1]);break}case "height":if("img"===e){(c=/height=(\S+)/i.exec(m))&&(g=c[1]);break}default:g=h.getAttribute(d)}null!=g&&l.push([d,g.toString()])}else l.push([d,
h.getAttribute("_djrealurl")])}},this)}l.sort(function(d,c){return d[0]<c[0]?-1:d[0]==c[0]?0:1});for(b=0;a=l[b++];)p.push(" ",a[0],'\x3d"',"string"===typeof a[1]?q(a[1],!0):a[1],'"');switch(e){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":p.push(" /\x3e");break;case "script":p.push("\x3e",h.innerHTML,"\x3c/",e,"\x3e");break;default:p.push("\x3e"),h.hasChildNodes()&&w.getChildrenHtmlHelper(h,p),p.push("\x3c/",e,"\x3e")}break;case 4:case 3:p.push(q(h.nodeValue,
!0));break;case 8:p.push("\x3c!--",q(h.nodeValue,!0),"--\x3e");break;default:p.push("\x3c!-- Element not recognized - Type: ",h.nodeType," Name: ",h.nodeName,"--\x3e")}};w.getChildrenHtml=function(h){var p=[];w.getChildrenHtmlHelper(h,p);return p.join("")};w.getChildrenHtmlHelper=function(h,p){if(h)for(var e=h.childNodes||h,l=!A("ie")||e!==h,b,a=0;b=e[a++];)l&&b.parentNode!=h||w.getNodeHtmlHelper(b,p)};return w})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n){var m=A("dijit._editor.plugins.LinkDialog",a,{allowUnsafeHtml:!1,linkFilter:[[/</g,"\x26lt;"]],buttonClass:f,useDefaultCommand:!1,urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=h.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(c){G("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),h.hitch(this,function(g,k,t){var y=this;this.tag="insertImage"==this.command?"img":"a";g=h.delegate(g.getLocalization("dijit","common",this.lang),g.getLocalization("dijit._editor",
"LinkDialog",this.lang));var K=this.dropDown=this.button.dropDown=new k({title:g[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:h.hitch(this,"setValue"),onOpen:function(){y._onOpenDialog();k.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(h.hitch(y,"_onCloseDialog"),0)}});g.urlRegExp=this.urlRegExp;g.id=t.getUniqueId(this.editor.id);this._uniqueId=g.id;this._setContent(K.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
b.substitute(this.linkDialogTemplate,g));K.startup();this._urlInput=t.byId(this._uniqueId+"_urlInput");this._textInput=t.byId(this._uniqueId+"_textInput");this._setButton=t.byId(this._uniqueId+"_setButton");this.own(t.byId(this._uniqueId+"_cancelButton").on("click",h.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",h.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",h.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=h.hitch(this,function(){var C=this._urlInput.get("value");return this._urlRegExp.test(C)||this._emailRegExp.test(C)});this.own(p(K.domNode,"keydown",h.hitch(this,h.hitch(this,function(C){!C||C.keyCode!=q.ENTER||C.shiftKey||C.metaKey||C.ctrlKey||C.altKey||this._setButton.get("disabled")||(K.onExecute(),K.execute(K.get("value")))}))));c()}))},_checkAndFixInput:function(){var c=this,g=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var k=g,t=!1,y=!1;k&&1<k.length&&(k=h.trim(k),0!==k.indexOf("mailto:")&&(0<k.indexOf("/")?-1===k.indexOf("://")&&"/"!==k.charAt(0)&&k.indexOf("./")&&0!==k.indexOf("../")&&c._hostRxp.test(k)&&(t=!0):c._userAtRxp.test(k)&&(y=!0)));t&&c._urlInput.set("value","http://"+k);y&&c._urlInput.set("value","mailto:"+k);c._setButton.set("disabled",!c._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(h.hitch(this,
function(){this.own(p(this.editor.editNode,"mouseup",h.hitch(this,"_onMouseUp")));this.own(p(this.editor.editNode,"dblclick",h.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(c){this.dropDown.set({parserScope:"dojo",content:c})},_checkValues:function(c){c&&c.urlInput&&(c.urlInput=c.urlInput.replace(/"/g,"\x26quot;"));!this.allowUnsafeHtml&&c&&c.textInput&&("function"===typeof this.linkFilter?c.textInput=this.linkFilter(c.textInput):
B.forEach(this.linkFilter,function(g){c.textInput=c.textInput.replace(g[0],g[1])}));return c},_createlinkEnabledImpl:function(){return!0},setValue:function(c){this._onCloseDialog();if(9>e("ie")){var g=n.getSelection(this.editor.window).getRangeAt(0).endContainer;3===g.nodeType&&(g=g.parentNode);g&&g.nodeName&&g.nodeName.toLowerCase()!==this.tag&&(g=this.editor.selection.getSelectedElement(this.tag));g&&g.nodeName&&g.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(g),
this.editor.execCommand("unlink"))}c=this._checkValues(c);this.editor.execCommand("inserthtml",b.substitute(this.htmlTemplate,c));l("a",this.editor.document).forEach(function(k){k.innerHTML||w.has(k,"name")||k.parentNode.removeChild(k)},this)},_onCloseDialog:function(){this.editor.focused&&this.editor.focus()},_getCurrentValues:function(c){if(c&&c.tagName.toLowerCase()===this.tag){var g=c.getAttribute("_djrealurl")||c.getAttribute("href");var k=c.getAttribute("target")||"_self";var t=c.textContent||
c.innerText;this.editor.selection.selectElement(c,!0)}else t=this.editor.selection.getSelectedText();return{urlInput:g||"",textInput:t||"",targetSelect:k||""}},_onOpenDialog:function(){if(e("ie")){var c=n.getSelection(this.editor.window);if(c.rangeCount){var g=c.getRangeAt(0);var k=g.endContainer;3===k.nodeType&&(k=k.parentNode);k&&k.nodeName&&k.nodeName.toLowerCase()!==this.tag&&(k=this.editor.selection.getSelectedElement(this.tag));if(!k||k.nodeName&&k.nodeName.toLowerCase()!==this.tag)(c=this.editor.selection.getAncestorElement(this.tag))&&
c.nodeName&&c.nodeName.toLowerCase()==this.tag?(k=c,this.editor.selection.selectElement(k)):g.startContainer===g.endContainer&&(c=g.startContainer.firstChild)&&c.nodeName&&c.nodeName.toLowerCase()==this.tag&&(k=c,this.editor.selection.selectElement(k))}}else k=this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(k))},_onDblClick:function(c){if(c&&c.target&&(c=c.target,(c.tagName?c.tagName.toLowerCase():
"")===this.tag&&w.get(c,"href"))){var g=this.editor;this.editor.selection.selectElement(c);g.onDisplayChanged();g._updateTimer&&(g._updateTimer.remove(),delete g._updateTimer);g.onNormalizedDisplayChanged();var k=this.button;setTimeout(function(){k.set("disabled",!1);k.loadAndOpenDropDown().then(function(){k.dropDown.focus&&k.dropDown.focus()})},10)}},_onMouseUp:function(){if(e("ff")){var c=this.editor.selection.getAncestorElement(this.tag);if(c){var g=n.getSelection(this.editor.window).getRangeAt(0);
if(g.collapsed&&c.childNodes.length){var k=g.cloneRange();k.selectNodeContents(c.childNodes[c.childNodes.length-1]);k.setStart(c.childNodes[0],0);1!==g.compareBoundaryPoints(k.START_TO_START,k)?g.setStartBefore(c):-1!==g.compareBoundaryPoints(k.END_TO_START,k)&&g.setStartAfter(c)}}}}}),d=A("dijit._editor.plugins.ImgLinkDialog",[m],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(c){if(c&&c.tagName.toLowerCase()===this.tag){var g=c.getAttribute("_djrealurl")||c.getAttribute("src");var k=c.getAttribute("alt");this.editor.selection.selectElement(c,!0)}else k=this.editor.selection.getSelectedText();return{urlInput:g||"",textInput:k||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);
this.editor.onLoadDeferred.then(h.hitch(this,function(){this.own(p(this.editor.editNode,"mousedown",h.hitch(this,"_selectTag")))}))},_selectTag:function(c){c&&c.target&&(c=c.target,(c.tagName?c.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(c))},_checkValues:function(c){c&&c.urlInput&&(c.urlInput=c.urlInput.replace(/"/g,"\x26quot;"));c&&c.textInput&&(c.textInput=c.textInput.replace(/"/g,"\x26quot;"));return c},_onDblClick:function(c){if(c&&c.target&&(c=c.target,(c.tagName?
c.tagName.toLowerCase():"")===this.tag&&w.get(c,"src"))){var g=this.editor;this.editor.selection.selectElement(c);g.onDisplayChanged();g._updateTimer&&(g._updateTimer.remove(),delete g._updateTimer);g.onNormalizedDisplayChanged();var k=this.button;setTimeout(function(){k.set("disabled",!1);k.loadAndOpenDropDown().then(function(){k.dropDown.focus&&k.dropDown.focus()})},10)}}});a.registry.createLink=function(c){var g={command:"createLink",allowUnsafeHtml:"allowUnsafeHtml"in c?c.allowUnsafeHtml:!1};
"linkFilter"in c&&(g.linkFilter=c.linkFilter);return new m(g)};a.registry.insertImage=function(){return new d({command:"insertImage"})};m.ImgLinkDialog=d;return m})},"dijit/form/DropDownButton":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/query ../registry ../popup ./Button ../_Container ../_HasDropDown dojo/text!./templates/DropDownButton.html ../a11yclick".split(" "),function(G,B,A,w,q,h,p,e,l,b){return G("dijit.form.DropDownButton",[p,e,l],{baseClass:"dijitDropDownButton",
templateString:b,_fillContent:function(){var a=this.srcNodeRef,f=this.containerNode;if(a&&f)for(;a.hasChildNodes();){var n=a.firstChild;n.hasAttribute&&(n.hasAttribute("data-dojo-type")||n.hasAttribute("dojoType")||n.hasAttribute("data-"+B._scopeName+"-type")||n.hasAttribute(B._scopeName+"Type"))?(this.dropDownContainer=this.ownerDocument.createElement("div"),this.dropDownContainer.appendChild(n)):f.appendChild(n)}},startup:function(){this._started||(!this.dropDown&&this.dropDownContainer&&(this.dropDown=
q.byNode(this.dropDownContainer.firstChild),delete this.dropDownContainer),this.dropDown&&h.hide(this.dropDown),this.inherited(arguments))},isLoaded:function(){var a=this.dropDown;return!!a&&(!a.href||a.isLoaded)},loadDropDown:function(a){var f=this.dropDown,n=f.on("load",A.hitch(this,function(){n.remove();a()}));f.refresh()},isFocusable:function(){return this.inherited(arguments)&&!this._mouseDown}})})},"dijit/_HasDropDown":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on dojo/touch ./registry ./focus ./popup ./_FocusMixin".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c){return G("dijit._HasDropDown",c,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(g){this.disabled||this.readOnly||("MSPointerDown"!=g.type&&g.preventDefault(),this.own(a.once(this.ownerDocument,f.release,b.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(g){var k=
this.dropDown,t=!1;if(g&&this._opened){var y=h.position(this._buttonNode,!0);if(!(g.pageX>=y.x&&g.pageX<=y.x+y.w&&g.pageY>=y.y&&g.pageY<=y.y+y.h)){for(y=g.target;y&&!t;)q.contains(y,"dijitPopup")?t=!0:y=y.parentNode;if(t){y=g.target;if(k.onItemClick){for(var K;y&&!(K=n.byNode(y));)y=y.parentNode;if(K&&K.onClick&&K.getParent)K.getParent().onItemClick(K,g)}return}}}this._opened?k.focus&&(!1!==k.autoFocus||"mouseup"==g.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){k.focus();
delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(g){this._stopClickEvents&&(g.stopPropagation(),g.preventDefault())},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var g={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||
this.dropDownPosition[0]||"Down";q.add(this._arrowWrapperNode||this._buttonNode,"dijit"+g+"ArrowButton")},postCreate:function(){this.inherited(arguments);var g=this.focusNode||this.domNode;this.own(a(this._buttonNode,f.press,b.hitch(this,"_onDropDownMouseDown")),a(this._buttonNode,"click",b.hitch(this,"_onDropDownClick")),a(g,"keydown",b.hitch(this,"_onKey")),a(g,"keyup",b.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),
delete this.dropDown);this.inherited(arguments)},_onKey:function(g){if(!this.disabled&&!this.readOnly){var k=this.dropDown,t=g.target;k&&this._opened&&k.handleKey&&!1===k.handleKey(g)?(g.stopPropagation(),g.preventDefault()):k&&this._opened&&g.keyCode==l.ESCAPE?(this.closeDropDown(),g.stopPropagation(),g.preventDefault()):!this._opened&&(g.keyCode==l.DOWN_ARROW||(g.keyCode==l.ENTER||g.keyCode==l.SPACE&&(!this._searchTimer||g.ctrlKey||g.altKey||g.metaKey))&&("input"!==(t.tagName||"").toLowerCase()||
t.type&&"text"!==t.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,g.stopPropagation(),g.preventDefault())}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var g=this.dropDown;g&&g.focus&&this.defer(b.hitch(g,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(g){g()},loadAndOpenDropDown:function(){var g=new B,k=b.hitch(this,function(){this.openDropDown();g.resolve(this.dropDown)});
this.isLoaded()?k():this.loadDropDown(k);return g},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var g=this.dropDown,k=g.domNode,t=this._aroundNode||this.domNode,y=this,K=d.open({parent:this,popup:g,around:t,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){y.closeDropDown(!0)},onCancel:function(){y.closeDropDown(!0)},onClose:function(){w.set(y._popupStateNode,"popupActive",
!1);q.remove(y._popupStateNode,"dijitHasDropDownOpen");y._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&t.offsetWidth>g._popupWrapper.offsetWidth){t=t.offsetWidth-g._popupWrapper.offsetWidth;var C={w:g.domNode.offsetWidth+t};this._origStyle=k.style.cssText;b.isFunction(g.resize)?g.resize(C):h.setMarginBox(k,C);"R"==K.corner[1]&&(g._popupWrapper.style.left=g._popupWrapper.style.left.replace("px","")-t+"px")}w.set(this._popupStateNode,"popupActive","true");q.add(this._popupStateNode,"dijitHasDropDownOpen");
this._set("_opened",!0);this._popupStateNode.setAttribute("aria-expanded","true");this._popupStateNode.setAttribute("aria-owns",g.id);"presentation"===k.getAttribute("role")||k.getAttribute("aria-labelledby")||k.setAttribute("aria-labelledby",this.id);return K},closeDropDown:function(g){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer);this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),g&&this.focus&&this.focus(),d.close(this.dropDown),
this._opened=!1);this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})})},"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(G,B,A,w,q,h){var p=A("dijit._editor.plugins.TextColor",q,{buttonClass:h,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;this.inherited(arguments);var e=this;this.button.loadDropDown=
function(l){function b(a){e.button.dropDown=new a({dir:e.editor.dir,ownerDocument:e.editor.ownerDocument,value:e.value,onChange:function(f){e.editor.execCommand(e.command,f)},onExecute:function(){e.editor.execCommand(e.command,this.get("value"))}});l()}"string"==typeof e.colorPicker?G([e.colorPicker],b):b(e.colorPicker)}},updateState:function(){var e=this.editor,l=this.command;if(e&&e.isLoaded&&l.length){if(this.button){var b=this.get("disabled");this.button.set("disabled",b);if(b)return;try{var a=
e.queryCommandValue(l)||""}catch(f){a=""}}""==a&&(a="#000000");"transparent"==a&&(a="#ffffff");"string"==typeof a?-1<a.indexOf("rgb")&&(a=B.fromRgb(a).toHex()):(a=((a&255)<<16|a&65280|(a&16711680)>>>16).toString(16),a="#000000".slice(0,7-a.length)+a);this.value=a;(e=this.button.dropDown)&&e.get&&a!==e.get("value")&&e.set("value",a,!1)}}});q.registry.foreColor=function(e){return new p(e)};q.registry.hiliteColor=function(e){return new p(e)};return p})},"dojo/colors":function(){define(["./_base/kernel",
"./_base/lang","./_base/Color","./_base/array"],function(G,B,A,w){var q={};B.setObject("dojo.colors",q);var h=function(e,l,b){0>b&&++b;1<b&&--b;var a=6*b;return 1>a?e+(l-e)*a:1>2*b?l:2>3*b?e+(l-e)*(2/3-b)*6:e};G.colorFromRgb=A.fromRgb=function(e,l){var b=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(b){e=b[2].split(/\s*,\s*/);var a=e.length;b=b[1];if("rgb"==b&&3==a||"rgba"==b&&4==a)return b=e[0],"%"==b.charAt(b.length-1)?(b=w.map(e,function(m){return 2.56*parseFloat(m)}),4==a&&(b[3]=
e[3]),A.fromArray(b,l)):A.fromArray(e,l);if("hsl"==b&&3==a||"hsla"==b&&4==a){b=(parseFloat(e[0])%360+360)%360/360;var f=parseFloat(e[1])/100,n=parseFloat(e[2])/100;f=.5>=n?n*(f+1):n+f-n*f;n=2*n-f;b=[256*h(n,f,b+1/3),256*h(n,f,b),256*h(n,f,b-1/3),1];4==a&&(b[3]=e[3]);return A.fromArray(b,l)}}return null};var p=function(e,l,b){e=Number(e);return isNaN(e)?b:e<l?l:e>b?b:e};A.prototype.sanitize=function(){this.r=Math.round(p(this.r,0,255));this.g=Math.round(p(this.g,0,255));this.b=Math.round(p(this.b,
0,255));this.a=p(this.a,0,1);return this};q.makeGrey=A.makeGrey=function(e,l){return A.fromArray([e,e,e,l])};B.mixin(A.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,
20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,
191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,
205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,
0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,
238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],
tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return A})},"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g){G=G([b,a],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,templateString:c,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}' style\x3d'display: flex;'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;padding:0 2px;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},
_layerEditingCap:{},constructor:function(k,t){B.mixin(this,g.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);this._uploadField_connect=A.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=A.connect(this._uploadField,"onfocus",B.hitch(this,function(k){d.hide(this._attachmentError)}))},destroy:function(){w.forEach(this._aeConnects,A.disconnect);A.disconnect(this._uploadField_connect);A.disconnect(this._uploadFieldFocus_connect);
this.inherited(arguments)},showAttachments:function(k,t){this._attachmentList.innerHTML=this.NLS_none;this._uploadField.value="";w.forEach(this.domNode.children,function(y,K){d.show(y)});d.hide(this._attachmentError);k&&(this._featureLayer=k.getLayer()||t)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=
this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=this._featureLayer.getEditCapabilities({feature:k}).canUpdate,this._oid=k.attributes[this._featureLayer.objectIdField],this._getAttachments(k)):t&&t.getEditCapabilities()||(d.hide(this._uploadForm),w.forEach(this.domNode.children,function(y,K){d.hide(y)})))},_getAttachments:function(k){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,
B.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){d.hide(this._attachmentError);this._featureLayer&&this._featureLayer.addAttachment?(d.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,B.hitch(this,"_onAddAttachmentComplete"),B.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(k,t){this._tempUpload&&(d.show(this._attachmentProgress),t.addAttachment(k,this._tempUpload,B.hitch(this,"_onAddAttachmentComplete"),
B.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(k,t){d.show(this._attachmentProgress);this._featureLayer.deleteAttachments(k,[t],B.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(k){var t=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?
(t=this._listHtml+this._endHtml,this._uploadForm.style.display="none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(t=this._listHtml+this._endHtml);var y=this._attachmentList;k=w.map(k,B.hitch(this,function(K){return m.substitute({href:K.url,name:K.name,oid:K.objectId,attid:K.id},t)}));y.innerHTML=k.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(k){d.hide(this._attachmentProgress.domNode);var t=this._attachmentList,
y=this._uploadField,K=y.value,C=K.lastIndexOf("\\");-1<C&&(K=K.substring(C+1,K.length));K=K.replace(/ /g,"_");C=e.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()});var r=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(r=this._listHtml+this._endHtml);k=m.substitute({href:this._featureLayer._url.path+"/"+k.objectId+"/attachments/"+k.attachmentId+
(C?"?"+C:""),name:K,oid:k.objectId,attid:k.attachmentId},r);t.innerHTML=t.innerHTML==this.NLS_none?k:t.innerHTML+k;this._updateConnects();y.value=""},_onAddAttachmentError:function(k){d.hide(this._attachmentProgress.domNode);if(k){var t=this.NLS_error,y=this._attachmentError;m.isDefined(k.code)&&400===k.code&&(t=this.NLS_fileNotSupported);l.set(y,"innerHTML",t);d.show(y)}},_onDeleteAttachmentComplete:function(k){d.hide(this._attachmentProgress.domNode);var t=this._attachmentList;w.every(k,function(y){return y.success})&&
(q.query("#node_"+k[0].objectId+"_"+k[0].attachmentId).orphan(),t.children&&t.children.length||(t.innerHTML=this.NLS_none))},_updateConnects:function(){w.forEach(this._aeConnects,A.disconnect);q.query(".deleteAttachment").forEach(function(k){this._aeConnects.push(A.connect(k,"onclick",B.hitch(this,"_deleteAttachment",this._oid,k.id)))},this)}});h("extend-esri")&&B.setObject("dijit.editing.AttachmentEditor",G,n);return G})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(G,B,A,w,q,h,p,e){return B("dijit.ProgressBar",[h,p],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:e,_indeterminateHighContrastImagePath:G.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(l){var b="rtl"==l.toLowerCase();A.toggle(this.domNode,"dijitProgressBarRtl",b);A.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&b);this.inherited(arguments)},update:function(l){w.mixin(this,l||{});l=this.internalProgress;var b=this.domNode,a=1;this.indeterminate?b.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(a=Math.min(parseFloat(this.progress)/100,1),this.progress=a*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),a=this.maximum?this.progress/this.maximum:0),b.setAttribute("aria-valuenow",this.progress));b.setAttribute("aria-labelledby",this.labelNode.id);b.setAttribute("aria-valuemin",0);b.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(a);A.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);A.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());l.style.width=100*a+"%";this.onChange()},_setValueAttr:function(l){this._set("value",
l);Infinity==l?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:l})},_setLabelAttr:function(l){this._set("label",l);this.update()},_setIndeterminateAttr:function(l){this._set("indeterminate",l);this.update()},report:function(l){return this.label?this.label:this.indeterminate?"\x26#160;":q.format(l,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(G,B,A,w){var q={};q={findFeatures:function(h,p,e){var l=p.objectIdField;p=B.filter(p.graphics,function(b){return B.some(h,function(a){return b.attributes[l]===a.objectId})});if(e)e(p);else return p},getSelection:function(h){var p=[];B.forEach(h,function(e){e=e.getSelectedFeatures();B.forEach(e,function(l){p.push(l)})});return p},sortFeaturesById:function(h,p){var e=B.map(h,function(l){return l.featureLayer});p.sort(function(l,b){var a=l.getLayer(),f=b.getLayer();if(!a)return-1;if(!f)return 1;
var n=B.indexOf(e,a);f=B.indexOf(e,f);n-=f;n||(a=a.objectIdField,n=l.attributes[a]-b.attributes[a]);return n});return p}};A("extend-esri")&&G.setObject("dijit.editing.Util.LayerHelper",q,w);return q})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(G,B,A){return G("dijit.form.DateTextBox",A,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",popupClass:B,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g){var k=w("dijit.Calendar",[n,m,d],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(t){e.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",t)},_createMonthWidget:function(){return new k._MonthDropDownButton({id:this.id+"_mddb",
tabIndex:-1,onMonthSelect:b.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(a(this.domNode,"keydown",b.hitch(this,"_onKeyDown")),a(this.dateRowsNode,"mouseover",b.hitch(this,"_onDayMouseOver")),a(this.dateRowsNode,"mouseout",b.hitch(this,"_onDayMouseOut")),a(this.dateRowsNode,"mousedown",b.hitch(this,"_onDayMouseDown")),a(this.dateRowsNode,"mouseup",b.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(t){var y=
new this.dateClassObj(this.currentFocus);y.setDate(1);y.setMonth(t);t=this.dateModule.getDaysInMonth(y);var K=this.currentFocus.getDate();y.setDate(Math.min(K,t));this._setCurrentFocusAttr(y)},_onDayMouseOver:function(t){(t=h.contains(t.target,"dijitCalendarDateLabel")?t.target.parentNode:t.target)&&(t.dijitDateValue&&!h.contains(t,"dijitCalendarDisabledDate")||t==this.previousYearLabelNode||t==this.nextYearLabelNode)&&(h.add(t,"dijitCalendarHoveredDate"),this._currentNode=t)},_onDayMouseOut:function(t){!this._currentNode||
t.relatedTarget&&t.relatedTarget.parentNode==this._currentNode||(t="dijitCalendarHoveredDate",h.contains(this._currentNode,"dijitCalendarActiveDate")&&(t+=" dijitCalendarActiveDate"),h.remove(this._currentNode,t),this._currentNode=null)},_onDayMouseDown:function(t){(t=t.target.parentNode)&&t.dijitDateValue&&!h.contains(t,"dijitCalendarDisabledDate")&&(h.add(t,"dijitCalendarActiveDate"),this._currentNode=t)},_onDayMouseUp:function(t){(t=t.target.parentNode)&&t.dijitDateValue&&h.remove(t,"dijitCalendarActiveDate")},
handleKey:function(t){var y=-1,K=this.currentFocus;switch(t.keyCode){case l.RIGHT_ARROW:y=1;case l.LEFT_ARROW:var C="day";this.isLeftToRight()||(y*=-1);break;case l.DOWN_ARROW:y=1;case l.UP_ARROW:C="week";break;case l.PAGE_DOWN:y=1;case l.PAGE_UP:C=t.ctrlKey||t.altKey?"year":"month";break;case l.END:K=this.dateModule.add(K,"month",1),C="day";case l.HOME:K=new this.dateClassObj(K);K.setDate(1);break;default:return!0}C&&(K=this.dateModule.add(K,C,y));this._setCurrentFocusAttr(K);return!1},_onKeyDown:function(t){this.handleKey(t)||
(t.stopPropagation(),t.preventDefault())},onValueSelected:function(){},onChange:function(t){this.onValueSelected(t)},getClassForDate:function(){}});k._MonthDropDownButton=w("dijit.Calendar._MonthDropDownButton",g,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new k._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(t){var y=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,t);this.dropDown.set("months",
y);this.containerNode.innerHTML=(6==f("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+y[t.getMonth()]+"\x3c/div\x3e"}});k._MonthDropDown=w("dijit.Calendar._MonthDropDown",[m,c,d],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(t){this.domNode.innerHTML=
"";G.forEach(t,function(y,K){p.create("div",{className:"dijitCalendarMonthLabel",month:K,innerHTML:y},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(t){this.onChange(q.get(t.target,"month"))},onChange:function(){}});return k})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c){var g=B("dijit.CalendarLite",[m,d],{templateString:c,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(k){return k&&!isNaN(k)&&"object"==typeof k&&k.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var k=this._get("value");if(k&&!isNaN(k)){var t=
new this.dateClassObj(k);t.setHours(0,0,0,0);t.getDate()<k.getDate()&&(t=this.dateModule.add(t,"hour",1));return t}return null},_setValueAttr:function(k,t){"string"==typeof k&&(k=h.fromISOString(k));k=this._patchDate(k);if(this._isValidDate(k)&&!this.isDisabledDate(k,this.lang)){if(this._set("value",k),this.set("currentFocus",k),this._markSelectedDates([k]),this._created&&(t||"undefined"==typeof t))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(k){if(k||
0===k)k=new this.dateClassObj(k),k.setHours(1,0,0,0);return k},_setText:function(k,t){for(;k.firstChild;)k.removeChild(k.firstChild);k.appendChild(k.ownerDocument.createTextNode(t))},_populateGrid:function(){var k=new this.dateClassObj(this.currentFocus);k.setDate(1);k=this._patchDate(k);var t=k.getDay(),y=this.dateModule.getDaysInMonth(k),K=this.dateModule.getDaysInMonth(this.dateModule.add(k,"month",-1)),C=new this.dateClassObj,r=0<=this.dayOffset?this.dayOffset:A.getFirstDayOfWeek(this.lang);r>
t&&(r-=7);if(!this.summary){var E=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,k);this.gridNode.setAttribute("summary",E[k.getMonth()])}this._date2cell={};G.forEach(this.dateCells,function(F,u){var D=u+r,z=new this.dateClassObj(k),M="dijitCalendar",H=0;D<t?(D=K-t+D+1,H=-1,M+="Previous"):D>=t+y?(D=D-t-y+1,H=1,M+="Next"):(D=D-t+1,M+="Current");H&&(z=this.dateModule.add(z,"month",H));z.setDate(D);this.dateModule.compare(z,C,"date")||(M="dijitCalendarCurrentDate "+M);this.isDisabledDate(z,
this.lang)?(M="dijitCalendarDisabledDate "+M,F.setAttribute("aria-disabled","true")):(M="dijitCalendarEnabledDate "+M,F.removeAttribute("aria-disabled"),F.setAttribute("aria-selected","false"));(H=this.getClassForDate(z,this.lang))&&(M=H+" "+M);F.className=M+"Month dijitCalendarDateTemplate";M=z.valueOf();this._date2cell[M]=F;F.dijitDateValue=M;M=z.getDateLocalized?z.getDateLocalized(this.lang):z.getDate();this._setText(this.dateLabels[u],M);l.set(F,"aria-label",q.format(z,{selector:"date",formatLength:"long"}))},
this)},_populateControls:function(){var k=new this.dateClassObj(this.currentFocus);k.setDate(1);this.monthWidget.set("month",k);var t=k.getFullYear()-1,y=new this.dateClassObj;G.forEach(["previous","current","next"],function(K){y.setFullYear(t++);this._setText(this[K+"YearLabelNode"],this.dateLocaleModule.format(y,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(k){this.dateModule=k.datePackage?b.getObject(k.datePackage,
!1):w;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=k.datePackage?b.getObject(k.datePackage+".locale",!1):q},_createMonthWidget:function(){return g._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var k=this.dowTemplateString,t=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),y=0<=this.dayOffset?this.dayOffset:A.getFirstDayOfWeek(this.lang);this.dayCellsHtml=n.substitute([k,
k,k,k,k,k,k].join(""),{d:""},function(){return t[y++%7]});k=n.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[k,k,k,k,k,k].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);p.setSelectable(this.domNode,!1);k=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",k,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var k=b.hitch(this,function(t,
y,K){this[t].dojoClick=!0;return a(this[t],"click",b.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,y,K))}))});this.own(k("incrementMonth","month",1),k("decrementMonth","month",-1),k("nextYearLabelNode","year",1),k("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(k,t){var y=this.currentFocus,K=this._getNodeByDate(y);k=this._patchDate(k);this._set("currentFocus",k);this._date2cell&&0==this.dateModule.difference(y,k,"month")||(this._populateGrid(),
this._populateControls(),this._markSelectedDates([this.value]));k=this._getNodeByDate(k);k.setAttribute("tabIndex",this.tabIndex);(this.focused||t)&&k.focus();K&&K!=k&&(f("webkit")?K.setAttribute("tabIndex","-1"):K.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(k){k.stopPropagation();k.preventDefault();for(k=k.target;k&&!k.dijitDateValue&&0!==k.dijitDateValue;k=k.parentNode);k&&!e.contains(k,"dijitCalendarDisabledDate")&&this.set("value",
k.dijitDateValue)},_getNodeByDate:function(k){return(k=this._patchDate(k))&&this._date2cell?this._date2cell[k.valueOf()]:null},_markSelectedDates:function(k){function t(y,K){e.toggle(K,"dijitCalendarSelectedDate",y);K.setAttribute("aria-selected",y?"true":"false")}G.forEach(this._selectedCells||[],b.partial(t,!1));this._selectedCells=G.filter(G.map(k,this._getNodeByDate,this),function(y){return y});G.forEach(this._selectedCells,b.partial(t,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});
g._MonthWidget=B("dijit.CalendarLite._MonthWidget",m,{_setMonthAttr:function(k){var t=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,k),y=6==f("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+G.map(t,function(K){return"\x3cdiv\x3e"+K+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=y+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+t[k.getMonth()]+"\x3c/div\x3e"}});return g})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(G,B,A,w,q,h,p,e){new Date("X");return w("dijit.form._DateTimeTextBox",[h,p],{templateString:e,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:B.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(l,b){var a=this._isInvalidDate(l),f=this._isInvalidDate(b);if(a||f)return a&&f?0:a?-1:1;l=this.format(l,this._unboundedConstraints);b=this.format(b,this._unboundedConstraints);
a=this.parse(l,this._unboundedConstraints);f=this.parse(b,this._unboundedConstraints);return l==b?0:G.compare(a,f,this._selector)},autoWidth:!0,format:function(l,b){return l?this.dateLocaleModule.format(l,b):""},parse:function(l,b){return this.dateLocaleModule.parse(l,b)||(this._isEmpty(l)?null:void 0)},serialize:function(l,b){l.toGregorian&&(l=l.toGregorian());return A.toISOString(l,b)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(l){l=
l||{};this.dateModule=l.datePackage?q.getObject(l.datePackage,!1):G;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=l.datePackage?q.getObject(l.datePackage+".locale",!1):B;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(l){l.selector=this._selector;l.fullYear=!0;var b=A.fromISOString;"string"==typeof l.min&&(l.min=b(l.min),this.dateClassObj instanceof Date||(l.min=new this.dateClassObj(l.min)));"string"==typeof l.max&&(l.max=b(l.max),this.dateClassObj instanceof Date||(l.max=new this.dateClassObj(l.max)));this.inherited(arguments);this._unboundedConstraints=q.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(l){return!l||
isNaN(l)||"object"!=typeof l||l.toString()==this._invalidDate},_setValueAttr:function(l,b,a){void 0!==l&&("string"==typeof l&&(l=A.fromISOString(l)),this._isInvalidDate(l)&&(l=null),l instanceof Date&&!(this.dateClassObj instanceof Date)&&(l=new this.dateClassObj(l)));this.inherited(arguments,[l,b,a]);this.value instanceof Date&&(this.filterString="");!1!==b&&this.dropDown&&this.dropDown.set("value",l,!1)},_set:function(l,b){if("value"==l){b instanceof Date&&!(this.dateClassObj instanceof Date)&&
(b=new this.dateClassObj(b));var a=this._get("value");if(a instanceof this.dateClassObj&&0==this.compare(b,a))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(l){this._isInvalidDate(l)&&(l=new this.dateClassObj);this._set("dropDownDefaultValue",l)},openDropDown:function(l){this.dropDown&&this.dropDown.destroy();var b=q.isString(this.popupClass)?q.getObject(this.popupClass,!1):this.popupClass,a=this,f=this.get("value");this.dropDown=new b({onChange:function(n){a.set("value",
n,!0)},id:this.id+"_popup",dir:a.dir,lang:a.lang,value:f,textDir:a.textDir,currentFocus:this._isInvalidDate(f)?this.dropDownDefaultValue:f,constraints:a.constraints,filterString:a.filterString,datePackage:a.datePackage,isDisabledDate:function(n){return!a.rangeCheck(n,a.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(l,b){this._setValueAttr(this.parse(l,this.constraints),b,l)}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare",
"dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(G,B,A){return G("dijit.form.RangeBoundTextBox",A,{rangeMessage:"",rangeCheck:function(w,q){return("min"in q?0<=this.compare(w,q.min):!0)&&("max"in q?0>=this.compare(w,q.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var w=this.get("value");if(null==w)return!1;var q=!1;"min"in this.constraints&&(q=this.constraints.min,q=0>this.compare(w,"number"==typeof q&&
0<=q&&0!=w?0:q));!q&&"max"in this.constraints&&(q=this.constraints.max,q=0<this.compare(w,"number"!=typeof q||0<q?q:0));return q},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(w){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(w))},getErrorMessage:function(w){var q=this.get("value");return null==q||""===q||"number"==typeof q&&isNaN(q)||this.isInRange(w)?this.inherited(arguments):this.rangeMessage},
postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=B.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(G,B,A,w){return G("dijit.form.MappedTextBox",w,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(q){return q.toString?
q.toString():""},toString:function(){var q=this.filter(this.get("value"));return null!=q?"string"==typeof q?q:this.serialize(q,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=A.place("\x3cinput type\x3d'hidden'"+(this.name&&!B("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},
"dijit/form/ValidationTextBox":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/i18n ./TextBox ../Tooltip dojo/text!./templates/ValidationTextBox.html dojo/i18n!./nls/validate".split(" "),function(G,B,A,w,q,h,p){var e=G("dijit.form.ValidationTextBox",q,{templateString:p,required:!1,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},pattern:".*",regExp:"",regExpGen:function(){},state:"",tooltipPosition:[],_deprecateRegExp:function(l,
b){b!=e.prototype[l]&&(B.deprecated("ValidationTextBox id\x3d"+this.id+", set('"+l+"', ...) is deprecated.  Use set('pattern', ...) instead.","","2.0"),this.set("pattern",b))},_setRegExpGenAttr:function(l){this._deprecateRegExp("regExpGen",l);this._set("regExpGen",this._computeRegexp)},_setRegExpAttr:function(l){this._deprecateRegExp("regExp",l)},_setValueAttr:function(){this.inherited(arguments);this._refreshState()},validator:function(l,b){return(new RegExp("^(?:"+this._computeRegexp(b)+")"+(this.required?
"":"?")+"$")).test(l)&&(!this.required||!this._isEmpty(l))&&(this._isEmpty(l)||void 0!==this.parse(l,b))},_isValidSubset:function(){return 0==this.textbox.value.search(this._partialre)},isValid:function(){return this.validator(this.textbox.value,this.get("constraints"))},_isEmpty:function(l){return(this.trim?/^\s*$/:/^$/).test(l)},getErrorMessage:function(){var l="$_unset_$"==this.invalidMessage?this.messages.invalidMessage:this.invalidMessage?this.invalidMessage:this.promptMessage,b="$_unset_$"==
this.missingMessage?this.messages.missingMessage:this.missingMessage?this.missingMessage:l;return this.required&&this._isEmpty(this.textbox.value)?b:l},getPromptMessage:function(){return this.promptMessage},_maskValidSubsetError:!0,validate:function(l){var b="",a=this.disabled||this.isValid(l);a&&(this._maskValidSubsetError=!0);var f=this._isEmpty(this.textbox.value),n=!a&&l&&this._isValidSubset();this._set("state",a?"":((!this._hasBeenBlurred||l)&&f||n)&&(this._maskValidSubsetError||n&&!this._hasBeenBlurred&&
l)?"Incomplete":"Error");this.focusNode.setAttribute("aria-invalid","Error"==this.state?"true":"false");"Error"==this.state?(this._maskValidSubsetError=l&&n,b=this.getErrorMessage(l)):"Incomplete"==this.state?(b=this.getPromptMessage(l),this._maskValidSubsetError=!this._hasBeenBlurred||l):f&&(b=this.getPromptMessage(l));this.set("message",b);return a},displayMessage:function(l){l&&this.focused?h.show(l,this.domNode,this.tooltipPosition,!this.isLeftToRight()):h.hide(this.domNode)},_refreshState:function(){this._created&&
this.validate(this.focused);this.inherited(arguments)},constructor:function(l){this.constraints=A.clone(this.constraints);this.baseClass+=" dijitValidationTextBox"},startup:function(){this.inherited(arguments);this._refreshState()},_setConstraintsAttr:function(l){!l.locale&&this.lang&&(l.locale=this.lang);this._set("constraints",l);this._refreshState()},_setPatternAttr:function(l){this._set("pattern",l);this._refreshState()},_computeRegexp:function(l){var b=this.pattern;"function"==typeof b&&(b=b.call(this,
l));if(b!=this._lastRegExp){var a="";this._lastRegExp=b;".*"!=b&&b.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(f){switch(f.charAt(0)){case "{":case "+":case "?":case "*":case "^":case "$":case "|":case "(":a+=f;break;case ")":a+="|$)";break;default:a+="(?:"+f+"|$)"}});try{"".search(a)}catch(f){a=this.pattern,console.warn("RegExp error in "+this.declaredClass+": "+this.pattern)}this._partialre="^(?:"+a+")$"}return b},postMixInProperties:function(){this.inherited(arguments);this.messages=
w.getLocalization("dijit.form","validate",this.lang);this._setConstraintsAttr(this.constraints)},_setDisabledAttr:function(l){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(l){this._set("required",l);this.focusNode.setAttribute("aria-required",l);this._refreshState()},_setMessageAttr:function(l){this._set("message",l);this.displayMessage(l)},reset:function(){this._maskValidSubsetError=!0;this.inherited(arguments)},_onBlur:function(){this.displayMessage("");this.inherited(arguments)},
destroy:function(){h.hide(this.domNode);this.inherited(arguments)}});return e})},"dijit/form/TextBox":function(){define("dojo/_base/declare dojo/dom-construct dojo/dom-style dojo/_base/kernel dojo/_base/lang dojo/on dojo/sniff ./_FormValueWidget ./_TextBoxMixin dojo/text!./templates/TextBox.html ../main".split(" "),function(G,B,A,w,q,h,p,e,l,b,a){e=G("dijit.form.TextBox"+(p("dojo-bidi")?"_NoBidi":""),[e,l],{templateString:b,_singleNodeTemplate:'\x3cinput class\x3d"dijit dijitReset dijitLeft dijitInputField" data-dojo-attach-point\x3d"textbox,focusNode" autocomplete\x3d"off" type\x3d"${type}" ${!nameAttrSetting} /\x3e',
_buttonInputDisabled:p("ie")?"disabled":"",baseClass:"dijitTextBox",postMixInProperties:function(){var f=this.type.toLowerCase();if(this.templateString&&"input"==this.templateString.toLowerCase()||("hidden"==f||"file"==f)&&this.templateString==this.constructor.prototype.templateString)this.templateString=this._singleNodeTemplate;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);9>p("ie")&&this.defer(function(){try{var f=A.getComputedStyle(this.domNode);if(f){var n=f.fontFamily;
if(n){var m=this.domNode.getElementsByTagName("INPUT");if(m)for(f=0;f<m.length;f++)m[f].style.fontFamily=n}}}catch(d){}})},_setPlaceHolderAttr:function(f){this._set("placeHolder",f);this._phspan||(this._attachPoints.push("_phspan"),this._phspan=B.create("span",{className:"dijitPlaceHolder dijitInputField"},this.textbox,"after"),this.own(h(this._phspan,"mousedown",function(n){n.preventDefault()}),h(this._phspan,"touchend, pointerup, MSPointerUp",q.hitch(this,function(){this.focus()}))));this._phspan.innerHTML=
"";this._phspan.appendChild(this._phspan.ownerDocument.createTextNode(f));this._updatePlaceHolder()},_onInput:function(f){this.inherited(arguments);this._updatePlaceHolder()},_updatePlaceHolder:function(){this._phspan&&(this._phspan.style.display=this.placeHolder&&!this.textbox.value?"":"none")},_setValueAttr:function(f,n,m){this.inherited(arguments);this._updatePlaceHolder()},getDisplayedValue:function(){w.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use get('displayedValue') instead.",
"","2.0");return this.get("displayedValue")},setDisplayedValue:function(f){w.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");this.set("displayedValue",f)},_onBlur:function(f){this.disabled||(this.inherited(arguments),this._updatePlaceHolder(),p("mozilla")&&this.selectOnClick&&(this.textbox.selectionStart=this.textbox.selectionEnd=void 0))},_onFocus:function(f){this.disabled||this.readOnly||(this.inherited(arguments),this._updatePlaceHolder())}});
9>p("ie")&&(e.prototype._isTextSelected=function(){var f=this.ownerDocument.selection.createRange();return f.parentElement()==this.textbox&&0<f.text.length},a._setSelectionRange=l._setSelectionRange=function(f,n,m){f.createTextRange&&(f=f.createTextRange(),f.collapse(!0),f.moveStart("character",-99999),f.moveStart("character",n),f.moveEnd("character",m-n),f.select())});p("dojo-bidi")&&(e=G("dijit.form.TextBox",e,{_setPlaceHolderAttr:function(f){this.inherited(arguments);this.applyTextDir(this._phspan)}}));
return e})},"dijit/form/_FormValueWidget":function(){define(["dojo/_base/declare","dojo/sniff","./_FormWidget","./_FormValueMixin"],function(G,B,A,w){return G("dijit.form._FormValueWidget",[A,w],{_layoutHackIE7:function(){if(7==B("ie"))for(var q=this.domNode,h=q.parentNode,p=q.firstChild||q,e=p.style.filter,l=this;h&&0==h.clientHeight;)(function(){var b=l.connect(h,"onscroll",function(){l.disconnect(b);p.style.filter=(new Date).getMilliseconds();l.defer(function(){p.style.filter=e})})})(),h=h.parentNode}})})},
"dijit/form/_FormValueMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormWidgetMixin".split(" "),function(G,B,A,w,q,h,p){return G("dijit.form._FormValueMixin",p,{readOnly:!1,_setReadOnlyAttr:function(e){h("trident")&&"disabled"in this?B.set(this.focusNode,"readOnly",e||this.disabled):B.set(this.focusNode,"readOnly",e);this._set("readOnly",e)},postCreate:function(){this.inherited(arguments);void 0===this._resetValue&&(this._lastValueReported=
this._resetValue=this.value)},_setValueAttr:function(e,l){this._handleOnChange(e,l)},_handleOnChange:function(e,l){this._set("value",e);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,!1)},reset:function(){this._hasBeenBlurred=!1;this._setValueAttr(this._resetValue,!0)}})})},"dijit/form/_TextBoxMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/sniff dojo/keys dojo/_base/lang dojo/on ../main".split(" "),function(G,B,A,w,q,h,p,e){var l=
B("dijit.form._TextBoxMixin"+(w("dojo-bidi")?"_NoBidi":""),null,{trim:!1,uppercase:!1,lowercase:!1,propercase:!1,maxLength:"",selectOnClick:!1,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(b,a,f){if(void 0!==b){var n=this.filter(b);"string"!=typeof f&&(f=null===n||"number"==typeof n&&isNaN(n)?"":this.filter(this.format(n,this.constraints)),0!=this.compare(n,this.filter(this.parse(f,this.constraints)))&&(f=null))}null==
f||"number"==typeof f&&isNaN(f)||this.textbox.value==f||(this.textbox.value=f,this._set("displayedValue",this.get("displayedValue")));this.inherited(arguments,[n,a])},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},_setDisplayedValueAttr:function(b){null==b?b="":"string"!=typeof b&&(b=String(b));this.textbox.value=b;this._setValueAttr(this.get("value"),void 0);this._set("displayedValue",this.get("displayedValue"))},format:function(b){return null==b?"":b.toString?
b.toString():b},parse:function(b){return b},_refreshState:function(){},onInput:function(){},_onInput:function(b){this._lastInputEventValue=this.textbox.value;this._processInput(this._lastInputProducingEvent||b);delete this._lastInputProducingEvent;this.intermediateChanges&&this._handleOnChange(this.get("value"),!1)},_processInput:function(){this._refreshState();this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);
this.own(p(this.textbox,"keydown, keypress, paste, cut, compositionend",h.hitch(this,function(b){if("keydown"==b.type&&229!=b.keyCode){var a=b.keyCode;switch(a){case q.SHIFT:case q.ALT:case q.CTRL:case q.META:case q.CAPS_LOCK:case q.NUM_LOCK:case q.SCROLL_LOCK:return}if(!b.ctrlKey&&!b.metaKey&&!b.altKey){switch(a){case q.NUMPAD_0:case q.NUMPAD_1:case q.NUMPAD_2:case q.NUMPAD_3:case q.NUMPAD_4:case q.NUMPAD_5:case q.NUMPAD_6:case q.NUMPAD_7:case q.NUMPAD_8:case q.NUMPAD_9:case q.NUMPAD_MULTIPLY:case q.NUMPAD_PLUS:case q.NUMPAD_ENTER:case q.NUMPAD_MINUS:case q.NUMPAD_PERIOD:case q.NUMPAD_DIVIDE:return}if(65<=
a&&90>=a||48<=a&&57>=a||a==q.SPACE)return;a=!1;for(var f in q)if(q[f]===b.keyCode){a=!0;break}if(!a)return}}(a=32<=b.charCode?String.fromCharCode(b.charCode):b.charCode)||(a=65<=b.keyCode&&90>=b.keyCode||48<=b.keyCode&&57>=b.keyCode||b.keyCode==q.SPACE?String.fromCharCode(b.keyCode):b.keyCode);a||(a=229);if("keypress"==b.type){if("string"!=typeof a)return;if("a"<=a&&"z">=a||"A"<=a&&"Z">=a||"0"<=a&&"9">=a||" "===a)if(b.ctrlKey||b.metaKey||b.altKey)return}var n={faux:!0},m;for(m in b)/^(layer[XY]|returnValue|keyLocation)$/.test(m)||
(f=b[m],"function"!=typeof f&&"undefined"!=typeof f&&(n[m]=f));h.mixin(n,{charOrCode:a,_wasConsumed:!1,preventDefault:function(){n._wasConsumed=!0;b.preventDefault()},stopPropagation:function(){b.stopPropagation()}});this._lastInputProducingEvent=n;!1===this.onInput(n)&&(n.preventDefault(),n.stopPropagation());if(!n._wasConsumed&&9>=w("ie"))switch(b.keyCode){case q.TAB:case q.ESCAPE:case q.DOWN_ARROW:case q.UP_ARROW:case q.LEFT_ARROW:case q.RIGHT_ARROW:break;default:b.keyCode==q.ENTER&&"textarea"!=
this.textbox.tagName.toLowerCase()||this.defer(function(){this.textbox.value!==this._lastInputEventValue&&p.emit(this.textbox,"input",{bubbles:!0})})}})),p(this.textbox,"input",h.hitch(this,"_onInput")),p(this.domNode,"keypress",function(b){b.stopPropagation()}))},_blankValue:"",filter:function(b){if(null===b)return this._blankValue;if("string"!=typeof b)return b;this.trim&&(b=h.trim(b));this.uppercase&&(b=b.toUpperCase());this.lowercase&&(b=b.toLowerCase());this.propercase&&(b=b.replace(/[^\s]+/g,
function(a){return a.substring(0,1).toUpperCase()+a.substring(1)}));return b},_setBlurValue:function(){this._setValueAttr(this.get("value"),!0)},_onBlur:function(b){this.disabled||(this._setBlurValue(),this.inherited(arguments))},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd},_onFocus:function(b){this.disabled||this.readOnly||(this.selectOnClick&&"mouse"==b&&(this._selectOnClickHandle=p.once(this.domNode,"mouseup, touchend",h.hitch(this,function(a){this._isTextSelected()||
l.selectInputText(this.textbox)})),this.own(this._selectOnClickHandle),this.defer(function(){this._selectOnClickHandle&&(this._selectOnClickHandle.remove(),this._selectOnClickHandle=null)},500)),this.inherited(arguments),this._refreshState())},reset:function(){this.textbox.value="";this.inherited(arguments)}});w("dojo-bidi")&&(l=B("dijit.form._TextBoxMixin",l,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_setDisplayedValueAttr:function(){this.inherited(arguments);
this.applyTextDir(this.focusNode)},_onInput:function(){this.applyTextDir(this.focusNode);this.inherited(arguments)}}));l._setSelectionRange=e._setSelectionRange=function(b,a,f){b.setSelectionRange&&b.setSelectionRange(a,f)};l.selectInputText=e.selectInputText=function(b,a,f){b=A.byId(b);isNaN(a)&&(a=0);isNaN(f)&&(f=b.value?b.value.length:0);try{b.focus(),l._setSelectionRange(b,a,f)}catch(n){}};return l})},"dijit/Tooltip":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff ./_base/manager ./place ./_Widget ./_TemplatedMixin ./BackgroundIframe dojo/text!./templates/Tooltip.html ./main".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k){function t(){}var y=B("dijit._MasterTooltip",[m,d],{duration:f.defaultDuration,templateString:g,postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.bgIframe=new c(this.domNode);this.fadeIn=A.fadeIn({node:this.domNode,duration:this.duration,onEnd:e.hitch(this,"_onShow")});this.fadeOut=A.fadeOut({node:this.domNode,duration:this.duration,onEnd:e.hitch(this,"_onHide")})},show:function(C,r,E,F,u,D,z){if(!this.aroundNode||this.aroundNode!==
r||this.containerNode.innerHTML!=C)if("playing"==this.fadeOut.status())this._onDeck=arguments;else{this.containerNode.innerHTML=C;u&&this.set("textDir",u);this.containerNode.align=F?"right":"left";var M=n.around(this.domNode,r,E&&E.length?E:K.defaultPosition,!F,e.hitch(this,"orient")),H=M.aroundNodePos;"M"==M.corner.charAt(0)&&"M"==M.aroundCorner.charAt(0)?(this.connectorNode.style.top=H.y+(H.h-this.connectorNode.offsetHeight>>1)-M.y+"px",this.connectorNode.style.left=""):"M"==M.corner.charAt(1)&&
"M"==M.aroundCorner.charAt(1)?this.connectorNode.style.left=H.x+(H.w-this.connectorNode.offsetWidth>>1)-M.x+"px":(this.connectorNode.style.left="",this.connectorNode.style.top="");p.set(this.domNode,"opacity",0);this.fadeIn.play();this.isShowingNow=!0;this.aroundNode=r;this.onMouseEnter=D||t;this.onMouseLeave=z||t}},orient:function(C,r,E,F,u){this.connectorNode.style.top="";var D=F.h;F=F.w;C.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove",
"BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[r+"-"+E];this.domNode.style.width="auto";var z=h.position(this.domNode);if(a("ie")||a("trident"))z.w+=2;h.setMarginBox(this.domNode,{w:Math.min(Math.max(F,1),z.w)});"B"==E.charAt(0)&&"B"==r.charAt(0)?(C=h.position(C),r=this.connectorNode.offsetHeight,
C.h>D?(this.connectorNode.style.top=D-(u.h+r>>1)+"px",this.connectorNode.style.bottom=""):(this.connectorNode.style.bottom=Math.min(Math.max(u.h/2-r/2,0),C.h-r)+"px",this.connectorNode.style.top="")):(this.connectorNode.style.top="",this.connectorNode.style.bottom="");return Math.max(0,z.w-F)},_onShow:function(){a("ie")&&(this.domNode.style.filter="")},hide:function(C){this._onDeck&&this._onDeck[1]==C?this._onDeck=null:this.aroundNode===C&&(this.fadeIn.stop(),this.isShowingNow=!1,this.aroundNode=
null,this.fadeOut.play());this.onMouseEnter=this.onMouseLeave=t},_onHide:function(){this.domNode.style.cssText="";this.containerNode.innerHTML="";this._onDeck&&(this.show.apply(this,this._onDeck),this._onDeck=null)}});a("dojo-bidi")&&y.extend({_setAutoTextDir:function(C){this.applyTextDir(C);G.forEach(C.children,function(r){this._setAutoTextDir(r)},this)},_setTextDirAttr:function(C){this._set("textDir",C);"auto"==C?this._setAutoTextDir(this.containerNode):this.containerNode.dir=this.textDir}});k.showTooltip=
function(C,r,E,F,u,D,z){E&&(E=G.map(E,function(M){return{after:"after-centered",before:"before-centered"}[M]||M}));K._masterTT||(k._masterTT=K._masterTT=new y);return K._masterTT.show(C,r,E,F,u,D,z)};k.hideTooltip=function(C){return K._masterTT&&K._masterTT.hide(C)};var K=B("dijit.Tooltip",m,{label:"",showDelay:400,hideDelay:400,connectId:[],position:[],selector:"",_setConnectIdAttr:function(C){G.forEach(this._connections||[],function(r){G.forEach(r,function(E){E.remove()})},this);this._connectIds=
G.filter(e.isArrayLike(C)?C:C?[C]:[],function(r){return w.byId(r,this.ownerDocument)},this);this._connections=G.map(this._connectIds,function(r){r=w.byId(r,this.ownerDocument);var E=this.selector,F=E?function(D){return b.selector(E,D)}:function(D){return D},u=this;return[b(r,F(l.enter),function(){u._onHover(this)}),b(r,F("focusin"),function(){u._onHover(this)}),b(r,F(l.leave),e.hitch(u,"_onUnHover")),b(r,F("focusout"),e.hitch(u,"set","state","DORMANT"))]},this);this._set("connectId",C)},addTarget:function(C){C=
C.id||C;-1==G.indexOf(this._connectIds,C)&&this.set("connectId",this._connectIds.concat(C))},removeTarget:function(C){C=G.indexOf(this._connectIds,C.id||C);0<=C&&(this._connectIds.splice(C,1),this.set("connectId",this._connectIds))},buildRendering:function(){this.inherited(arguments);q.add(this.domNode,"dijitTooltipData")},startup:function(){this.inherited(arguments);var C=this.connectId;G.forEach(e.isArrayLike(C)?C:[C],this.addTarget,this)},getContent:function(C){return this.label||this.domNode.innerHTML},
state:"DORMANT",_setStateAttr:function(C){if(!(this.state==C||"SHOW TIMER"==C&&"SHOWING"==this.state||"HIDE TIMER"==C&&"DORMANT"==this.state)){this._hideTimer&&(this._hideTimer.remove(),delete this._hideTimer);this._showTimer&&(this._showTimer.remove(),delete this._showTimer);switch(C){case "DORMANT":this._connectNode&&(K.hide(this._connectNode),delete this._connectNode,this.onHide());break;case "SHOW TIMER":"SHOWING"!=this.state&&(this._showTimer=this.defer(function(){this.set("state","SHOWING")},
this.showDelay));break;case "SHOWING":var r=this.getContent(this._connectNode);if(!r){this.set("state","DORMANT");return}K.show(r,this._connectNode,this.position,!this.isLeftToRight(),this.textDir,e.hitch(this,"set","state","SHOWING"),e.hitch(this,"set","state","HIDE TIMER"));this.onShow(this._connectNode,this.position);break;case "HIDE TIMER":this._hideTimer=this.defer(function(){this.set("state","DORMANT")},this.hideDelay)}this._set("state",C)}},_onHover:function(C){this._connectNode&&C!=this._connectNode&&
this.set("state","DORMANT");this._connectNode=C;this.set("state","SHOW TIMER")},_onUnHover:function(C){this.set("state","HIDE TIMER")},open:function(C){this.set("state","DORMANT");this._connectNode=C;this.set("state","SHOWING")},close:function(){this.set("state","DORMANT")},onShow:function(){},onHide:function(){},destroy:function(){this.set("state","DORMANT");G.forEach(this._connections||[],function(C){G.forEach(C,function(r){r.remove()})},this);this.inherited(arguments)}});K._MasterTooltip=y;K.show=
k.showTooltip;K.hide=k.hideTooltip;K.defaultPosition=["after-centered","before-centered"];return K})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(G,B,A,w,q,h){var p=function(l){l=l||{};var b=A.getLocalization("dojo.cldr","number",A.normalizeLocale(l.locale)),a=l.pattern?l.pattern:b[(l.type||"decimal")+"Format"];l="number"==typeof l.places?l.places:"string"===typeof l.places&&0<l.places.length?
l.places.replace(/.*,/,""):-1!=a.indexOf(".")?a.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:b.decimal,places:l}},e=G("dijit.form.NumberTextBoxMixin",null,{pattern:function(l){return"("+(this.focused&&this.editOptions?this._regExpGenerator(B.delegate(l,this.editOptions))+"|":"")+this._regExpGenerator(l)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:q.format,_regExpGenerator:q.regexp,_decimalInfo:p(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},
_setConstraintsAttr:function(l){var b="number"==typeof l.places?l.places:0;b&&b++;"number"!=typeof l.max&&(l.max=9*Math.pow(10,15-b));"number"!=typeof l.min&&(l.min=-9*Math.pow(10,15-b));this.inherited(arguments,[l]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=p(l)},_onFocus:function(l){if(!this.disabled&&!this.readOnly){var b=this.get("value");"number"!=typeof b||isNaN(b)||(b=this.format(b,this.constraints),void 0!==b&&(this.textbox.value=
b,"mouse"!==l&&this.textbox.select()));this.inherited(arguments)}},format:function(l,b){var a=String(l);if("number"!=typeof l)return a;if(isNaN(l))return"";if(!("rangeCheck"in this&&this.rangeCheck(l,b))&&!1!==b.exponent&&/\de[-+]?\d/i.test(a))return a;this.editOptions&&this.focused&&(b=B.mixin({},b,this.editOptions));return this._formatter(l,b)},_parser:q.parse,parse:function(l,b){var a=B.mixin({},b,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=a.places){var f=a.places;
f="number"===typeof f?f:Number(f.split(",").pop());a.places="0,"+f}a=this._parser(l,a);this.editOptions&&this.focused&&isNaN(a)&&(a=this._parser(l,b));return a},_getDisplayedValueAttr:function(){var l=this.inherited(arguments);return isNaN(l)?this.textbox.value:l},filter:function(l){if(null==l||"string"==typeof l&&""==l)return NaN;"number"!=typeof l||isNaN(l)||0==l||(l=q.round(l,this._decimalInfo.places));return this.inherited(arguments,[l])},serialize:function(l,b){return"number"!=typeof l||isNaN(l)?
"":this.inherited(arguments)},_setBlurValue:function(){var l=B.hitch(B.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(l,!0)},_setValueAttr:function(l,b,a){if(void 0!==l&&void 0===a)if(a=String(l),"number"==typeof l)if(isNaN(l))a="";else{if("rangeCheck"in this&&this.rangeCheck(l,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(a))a=void 0}else l?l=void 0:(a="",l=NaN);this.inherited(arguments,[l,b,a])},_getValueAttr:function(){var l=this.inherited(arguments);if(isNaN(l)&&
""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+q._realNumberRegexp(B.delegate(this.constraints))+"$")).test(this.textbox.value))return l=Number(this.textbox.value),isNaN(l)?void 0:l}else return l},isValid:function(l){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var b=this.get("value");return!isNaN(b)&&this.rangeCheck(b,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?
!0:this.inherited(arguments):!1},_isValidSubset:function(){var l="number"==typeof this.constraints.min,b="number"==typeof this.constraints.max,a=this.get("value");if(isNaN(a)||!l&&!b)return this.inherited(arguments);var f=a|0,n=0>a,m=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),d=(this.maxLength||20)-this.textbox.value.length,c=m?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"";f=m?f+"."+c:f+"";d=w.rep("9",d);m=a;n?m=Number(f+d):a=Number(f+d);return!(l&&a<this.constraints.min||
b&&m>this.constraints.max)}});G=G("dijit.form.NumberTextBox",[h,e],{baseClass:"dijitTextBox dijitNumberTextBox"});G.Mixin=e;return G})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox","./ComboBoxMixin"],function(G,B,A,w,q){return G("dijit.form.FilteringSelect",[w,q],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},
_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(h,p,e,l){p&&p[this.searchAttr]!==this._lastQuery||!p&&h.length&&this.store.getIdentity(h[0])!=this._lastQuery||(h.length?this.set("item",h[0],l):this.set("value","",l||void 0===l&&!this.focused,this.textbox.value,null))},_openResultList:function(h,p,e){p[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},
_getValueField:function(){return"value"},_setValueAttr:function(h,p,e,l){this._onChangeActive||(p=null);if(void 0===l){if(null===h||""===h)if(h="",!B.isString(e)){this._setDisplayedValueAttr(e||"",p);return}var b=this;this._lastQuery=h;A(this.store.get(h),function(a){b._callbackSetLabel(a?[a]:[],void 0,void 0,p)})}else this.valueNode.value=h,this.inherited(arguments,[h,p,e,l])},_setItemAttr:function(h,p,e){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(h){return h.replace(/([\\\*\?])/g,
"\\$1")},_setDisplayedValueAttr:function(h,p){null==h&&(h="");if(!this._created){if(!("displayedValue"in this.params))return;p=!1}if(this.store){this.closeDropDown();var e=B.clone(this.query),l=this._getDisplayQueryString(h);if(this.store._oldAPI)var b=l;else b=this._patternToRegExp(l),b.toString=function(){return l};this._lastQuery=e[this.searchAttr]=b;this._lastDisplayedValue=this.textbox.value=h;this._set("displayedValue",h);var a=this,f={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};B.mixin(f,
this.fetchProperties);this._fetchHandle=this.store.query(e,f);A(this._fetchHandle,function(n){a._fetchHandle=null;a._callbackSetLabel(n||[],e,f,p)},function(n){a._fetchHandle=null;a._cancelingQuery||console.error("dijit.form.FilteringSelect: "+n.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(G,B,A,w,q,h,p,e,l){return G("dijit.form.ComboBoxMixin",[e,h],{dropDownClass:p,hasDownArrow:!0,templateString:l,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(b){this._set("hasDownArrow",b);this._buttonNode.style.display=b?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(b){b.get||w.mixin(b,{_oldAPI:!0,get:function(a){var f=new B;this.fetchItemByIdentity({identity:a,
onItem:function(n){f.resolve(n)},onError:function(n){f.reject(n)}});return f.promise},query:function(a,f){var n=new B(function(){m.abort&&m.abort()});n.total=new B;var m=this.fetch(w.mixin({query:a,onBegin:function(d){n.total.resolve(d)},onComplete:function(d){n.resolve(d)},onError:function(d){n.reject(d)}},f));return q(n)}});this._set("store",b)},postMixInProperties:function(){var b=this.params.store||this.store;b&&this._setStoreAttr(b);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var a=this.declaredClass;w.mixin(this.store,{getValue:function(f,n){A.deprecated(a+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return f[n]},getLabel:function(f){A.deprecated(a+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return f.name},fetch:function(f){A.deprecated(a+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
w.hitch(this,function(n){(new n({objectStore:this})).fetch(f)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(G,B,A,w,q,h,p,e,l,b,a){B=B("dijit.form._AutoCompleterMixin",a,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(f){var n=0;if("number"==typeof f.selectionStart)n=f.selectionStart;else if(e("ie")){var m=f.ownerDocument.selection.createRange().duplicate();f=f.createTextRange();m.move("character",0);f.move("character",0);try{f.setEndPoint("EndToEnd",m),n=String(f.text).replace(/\r/g,"").length}catch(d){}}return n},_setCaretPos:function(f,n){n=parseInt(n);b.selectInputText(f,n,n)},_setDisabledAttr:function(f){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",f?"true":"false")},_onKey:function(f){if(!(32<=f.charCode)){var n=f.charCode||f.keyCode;if(n!=w.ALT&&n!=w.CTRL&&n!=w.META&&n!=w.SHIFT){var m=this.dropDown,d=null;this._abortQuery();this.inherited(arguments);if(!(f.altKey||f.ctrlKey||f.metaKey))switch(this._opened&&(d=m.getHighlightedOption()),n){case w.PAGE_DOWN:case w.DOWN_ARROW:case w.PAGE_UP:case w.UP_ARROW:this._opened&&this._announceOption(d);f.stopPropagation();f.preventDefault();break;case w.ENTER:if(d){if(d==
m.nextButton){this._nextSearch(1);f.stopPropagation();f.preventDefault();break}else if(d==m.previousButton){this._nextSearch(-1);f.stopPropagation();f.preventDefault();break}f.stopPropagation();f.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case w.TAB:n=this.get("displayedValue");if(m&&(n==m._messages.previousMessage||n==m._messages.nextMessage))break;d&&this._selectOption(d);case w.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(f){var n=this.focusNode;b.selectInputText(n,n.value.length);var m=this.ignoreCase?"toLowerCase":"substr";0==f[m](0).indexOf(this.focusNode.value[m](0))?(m=this.autoComplete?this._getCaretPos(n):n.value.length,m+1>n.value.length&&(n.value=f,b.selectInputText(n,m))):(n.value=f,b.selectInputText(n))},_openResultList:function(f,n,m){var d=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();f.length||0!=m.start?(this._nextSearch=this.dropDown.onPage=q.hitch(this,
function(c){f.nextPage(-1!==c);this.focus()}),this.dropDown.createOptions(f,m,q.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in m?(m.direction?this.dropDown.highlightFirstOption():m.direction||this.dropDown.highlightLastOption(),d&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(n[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var f=this.get("displayedValue"),n=this.dropDown;!n||f!=n._messages.previousMessage&&f!=n._messages.nextMessage?"undefined"==typeof this.item?
(this.item=null,this.set("displayedValue",f)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(f,n,m){var d="";f&&(m||(m=this.store._oldAPI?this.store.getValue(f,this.searchAttr):f[this.searchAttr]),d=this._getValueField()!=this.searchAttr?this.store.getIdentity(f):m);this.set("value",d,n,m,f)},_announceOption:function(f){if(f){if(f==
this.dropDown.nextButton||f==this.dropDown.previousButton){var n=f.innerHTML;this.item=void 0;this.value=""}else{var m=this.dropDown.items[f.getAttribute("item")];n=(this.store._oldAPI?this.store.getValue(m,this.searchAttr):m[this.searchAttr]).toString();this.set("item",m,!1,n)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",A.get(f,"id"));this._autoCompleteText(n)}},_selectOption:function(f){this.closeDropDown();f&&
this._announceOption(f);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(f){if(!this.dropDown){var n=this.id+"_popup";this.dropDown=new (q.isString(this.dropDownClass)?q.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:q.hitch(this,
this._selectOption),id:n,dir:this.dir,textDir:this.textDir})}this._lastInput=f;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new l({},this.srcNodeRef),!("value"in this.params))){var f=this.item=this.store.fetchSelectedItem();if(f){var n=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(f,n):f[n]}}},postCreate:function(){var f=h('label[for\x3d"'+
this.id+'"]');f.length&&(f[0].id||(f[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",f[0].id));this.inherited(arguments);G.after(this,"onSearch",q.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(f){f=this.labelFunc(f,this.store);var n=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(f=this.doHighlight(f,this._lastInput),n="html");return{html:"html"==n,label:f}},doHighlight:function(f,n){var m=(this.ignoreCase?"i":"")+("all"==
this.highlightMatch?"g":""),d=this.queryExpr.indexOf("${0}");n=p.escapeString(n);return this._escapeHtml(f.replace(new RegExp((0==d?"^":"")+"("+n+")"+(d==this.queryExpr.length-4?"$":""),m),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(f){return f=String(f).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},
labelFunc:function(f,n){return(n._oldAPI?n.getValue(f,this.labelAttr||this.searchAttr):f[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(f,n,m,d){this._set("item",d||null);null==f&&(f="");this.inherited(arguments)}});e("dojo-bidi")&&B.extend({_setTextDirAttr:function(f){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",f)}});return B})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),
function(G,B,A,w,q,h){function p(e){return{id:e.value,value:e.value,name:A.trim(e.innerText||e.textContent||"")}}return G("dijit.form.DataList",q,{constructor:function(e,l){this.domNode=B.byId(l);A.mixin(this,e);this.id&&h.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:w("option",this.domNode).map(p)}])},destroy:function(){h.remove(this.id)},fetchSelectedItem:function(){var e=w("\x3e option[selected]",this.domNode)[0]||w("\x3e option",this.domNode)[0];return e&&p(e)}})})},
"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(G,B,A,w,q,h,p){return G("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(e){this._set("list",e)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(e){return new RegExp("^"+e.replace(/(\\.)|(\*)|(\?)|\W/g,function(l,b,a,f){return a?".*":
f?".":b?b:"\\"+l})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(e){if(!this.disabled&&
!this.readOnly){e=e.charOrCode;this._prev_key_backspace=!1;if(e===B.DELETE||e===B.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(e){this._abortQuery();var l=this,b=A.clone(this.query),a={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},f=q.substitute(this.queryExpr,
[e.replace(/([\\\*\?])/g,"\\$1")]),n=function(){var d=l._fetchHandle=l.store.query(b,a);l.disabled||l.readOnly||m!==l._lastQuery||h(d,function(c){l._fetchHandle=null;l.disabled||l.readOnly||m!==l._lastQuery||h(d.total,function(g){c.total=g;var k=l.pageSize;if(isNaN(k)||k>c.total)k=c.total;c.nextPage=function(t){a.direction=t=!1!==t;a.count=k;t?(a.start+=c.length,a.start>=c.total&&(a.count=0)):(a.start-=k,0>a.start&&(a.count=Math.max(k+a.start,0),a.start=0));0>=a.count?(c.length=0,l.onSearch(c,b,a)):
n()};l.onSearch(c,b,a)})},function(c){l._fetchHandle=null;l._cancelingQuery||console.error(l.declaredClass+" "+c.toString())})};A.mixin(a,this.fetchProperties);if(this.store._oldAPI)var m=f;else m=this._patternToRegExp(f),m.toString=function(){return f};this._lastQuery=b[this.searchAttr]=m;this._queryDeferHandle=this.defer(n,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var e=this.list;e&&(this.store=p.byId(e))}this.inherited(arguments)}})})},
"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(G,B,A,w,q,h,p,e){return G("dijit.form._ComboBoxMenu",[q,h,e,p],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(B.add(this.previousButton,"dijitMenuItemRtl"),B.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var l=this.ownerDocument.createElement("div");l.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");l.setAttribute("role","option");return l},onHover:function(l){B.add(l,"dijitMenuItemHover")},onUnhover:function(l){B.remove(l,
"dijitMenuItemHover")},onSelect:function(l){B.add(l,"dijitMenuItemSelected")},onDeselect:function(l){B.remove(l,"dijitMenuItemSelected")},_page:function(l){var b=0,a=this.domNode.scrollTop,f=A.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();b<f;){var n=this.getHighlightedOption();if(l){if(!n.previousSibling||"none"==n.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!n.nextSibling||"none"==n.nextSibling.style.display)break;this.selectNextNode()}n=
this.domNode.scrollTop;b+=(n-a)*(l?-1:1);a=n}},handleKey:function(l){switch(l.keyCode){case w.DOWN_ARROW:return this.selectNextNode(),!1;case w.PAGE_DOWN:return this._page(!1),!1;case w.UP_ARROW:return this.selectPreviousNode(),!1;case w.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(G,B,A,w,q){var h=B("dijit.form._ComboBoxMenuMixin"+
(w("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=q.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(p){this._set("value",p);this.onChange(p)},onClick:function(p){if(p==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(p==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(p)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(p,e){var l=this._createMenuItem();p=e(p);p.html?l.innerHTML=p.label:l.appendChild(l.ownerDocument.createTextNode(p.label));""==l.innerHTML&&(l.innerHTML="\x26#160;");return l},createOptions:function(p,e,l){this.items=p;this.previousButton.style.display=0==e.start?"none":"";A.set(this.previousButton,"id",this.id+
"_prev");G.forEach(p,function(a,f){a=this._createOption(a,l);a.setAttribute("item",f);A.set(a,"id",this.id+f);this.nextButton.parentNode.insertBefore(a,this.nextButton)},this);var b=!1;p.total&&!p.total.then&&-1!=p.total?e.start+e.count<p.total?b=!0:e.start+e.count>p.total&&e.count==p.length&&(b=!0):e.count==p.length&&(b=!0);this.nextButton.style.display=b?"":"none";A.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var p=this.containerNode;2<p.childNodes.length;)p.removeChild(p.childNodes[p.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});w("dojo-bidi")&&(h=B("dijit.form._ComboBoxMenuMixin",
h,{_createOption:function(){var p=this.inherited(arguments);this.applyTextDir(p);return p}}));return h})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(G,B,A,w){return G("dijit.form._ListMouseMixin",w,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(q,h){this._setSelectedAttr(h,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(h)})},_onMouseDown:function(q,h){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(h,!1)},_onMouseUp:function(q,h){this._isDragging=!1;var p=this.selected,e=this._hoveredNode;p&&h==p?this.defer(function(){this._onClick(q,
p)}):e&&this.defer(function(){this._onClick(q,e)})},_onMouseOut:function(q,h){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(q,h){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=h;this.onHover(h);this._isDragging&&this._setSelectedAttr(h,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(G,B,A){return G("dijit.form._ListBase",null,{selected:null,_listConnect:function(w,q){var h=this;return h.own(B(h.containerNode,B.selector(function(p,e,l){return p.parentNode==l},w),function(p){h[q](p,this)}))},selectFirstNode:function(){for(var w=this.containerNode.firstChild;w&&"none"==w.style.display;)w=w.nextSibling;this._setSelectedAttr(w,!0)},selectLastNode:function(){for(var w=this.containerNode.lastChild;w&&"none"==w.style.display;)w=w.previousSibling;this._setSelectedAttr(w,
!0)},selectNextNode:function(){var w=this.selected;if(w){for(w=w.nextSibling;w&&"none"==w.style.display;)w=w.nextSibling;w?this._setSelectedAttr(w,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var w=this.selected;if(w){for(w=w.previousSibling;w&&"none"==w.style.display;)w=w.previousSibling;w?this._setSelectedAttr(w,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(w,q){if(this.selected!=w){var h=this.selected;if(h)this.onDeselect(h);
w&&(q&&A.scrollIntoView(w),this.onSelect(w));this._set("selected",w)}else if(w)this.onSelect(w)}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(G,B,A,w){return G("dijit.form.NumberSpinner",[A,w.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(q,h){var p=this.constraints,e=isNaN(q),l=!isNaN(p.max),b=!isNaN(p.min);e&&0!=h&&(q=0<h?b?p.min:l?p.max:0:l?this.constraints.max:b?p.min:0);h=q+h;if(e||
isNaN(h))return q;l&&h>p.max&&(h=p.max);b&&h<p.min&&(h=p.min);return h},_onKeyDown:function(q){if(!(this.disabled||this.readOnly||q.keyCode!=B.HOME&&q.keyCode!=B.END||q.ctrlKey||q.altKey||q.metaKey||"undefined"==typeof this.get("value"))){var h=this.constraints[q.keyCode==B.HOME?"min":"max"];"number"==typeof h&&this._setValueAttr(h,!1);q.stopPropagation();q.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),
function(G,B,A,w,q,h,p,e,l,b){return G("dijit.form._Spinner",e,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:l,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(a){return a},_arrowPressed:function(a,f,n){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),f*n),!1),b.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=
null},_typematicCallback:function(a,f,n){var m=this.smallDelta;f==this.textbox&&(f=n.keyCode,m=f==B.PAGE_UP||f==B.PAGE_DOWN?this.largeDelta:this.smallDelta,f=f==B.UP_ARROW||f==B.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==a?this._arrowReleased(f):this._arrowPressed(f,f==this.upArrowNode?1:-1,m)},_wheelTimer:null,_mouseWheeled:function(a){if(this.focused){a.stopPropagation();a.preventDefault();var f=a.wheelDelta/120;Math.floor(f)!=f&&(f=0<a.wheelDelta?1:-1);a=a.detail?-1*a.detail:f;if(0!==a){var n=
this[0<a?"upArrowNode":"downArrowNode"];this._arrowPressed(n,a,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(n)},50)}}},_setConstraintsAttr:function(a){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):
this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(a,f){this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(h(this.domNode,q.wheel,A.hitch(this,"_mouseWheeled")),p.addListener(this.upArrowNode,this.textbox,{keyCode:B.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),p.addListener(this.downArrowNode,this.textbox,
{keyCode:B.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),p.addListener(this.upArrowNode,this.textbox,{keyCode:B.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),p.addListener(this.downArrowNode,this.textbox,{keyCode:B.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,
this.defaultTimeout,this.minimumTimeout))}})})},"dijit/typematic":function(){define("dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/on dojo/sniff ./main".split(" "),function(G,B,A,w,q,h){var p=h.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(0>this._currentTimeout?this._initialDelay:1<this._subsequentDelay?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);
this._timer=setTimeout(A.hitch(this,"_fireEventAndReload"),this._currentTimeout)},trigger:function(e,l,b,a,f,n,m,d){if(f!=this._obj){this.stop();this._initialDelay=m||500;this._subsequentDelay=n||.9;this._minDelay=d||10;this._obj=f;this._node=b;this._count=this._currentTimeout=-1;this._callback=A.hitch(l,a);this._evt={faux:!0};for(var c in e)"layerX"!=c&&"layerY"!=c&&(l=e[c],"function"!=typeof l&&"undefined"!=typeof l&&(this._evt[c]=l));this._fireEventAndReload()}},stop:function(){this._timer&&(clearTimeout(this._timer),
this._timer=null);this._obj&&(this._callback(-1,this._node,this._evt),this._obj=null)},addKeyListener:function(e,l,b,a,f,n,m){var d="keyCode"in l?"keyCode":"charCode"in l?"charCode":"charOrCode",c=[w(e,"keyCode"in l?"keydown":"charCode"in l?"keypress":B._keypress,A.hitch(this,function(g){g[d]!=l[d]||void 0!==l.ctrlKey&&l.ctrlKey!=g.ctrlKey||void 0!==l.altKey&&l.altKey!=g.altKey||void 0!==l.metaKey&&l.metaKey!=(g.metaKey||!1)||void 0!==l.shiftKey&&l.shiftKey!=g.shiftKey?p._obj==l&&p.stop():(g.stopPropagation(),
g.preventDefault(),p.trigger(g,b,e,a,l,f,n,m))})),w(e,"keyup",A.hitch(this,function(){p._obj==l&&p.stop()}))];return{remove:function(){G.forEach(c,function(g){g.remove()})}}},addMouseListener:function(e,l,b,a,f,n){var m=[w(e,"mousedown",A.hitch(this,function(d){d.preventDefault();p.trigger(d,l,e,b,e,a,f,n)})),w(e,"mouseup",A.hitch(this,function(d){this._obj&&d.preventDefault();p.stop()})),w(e,"mouseout",A.hitch(this,function(d){this._obj&&d.preventDefault();p.stop()})),w(e,"dblclick",A.hitch(this,
function(d){d.preventDefault();9>q("ie")&&(p.trigger(d,l,e,b,e,a,f,n),setTimeout(A.hitch(this,p.stop),50))}))];return{remove:function(){G.forEach(m,function(d){d.remove()})}}},addListener:function(e,l,b,a,f,n,m,d){var c=[this.addKeyListener(l,b,a,f,n,m,d),this.addMouseListener(e,a,f,n,m,d)];return{remove:function(){G.forEach(c,function(g){g.remove()})}}}};return p})},"dijit/form/SimpleTextarea":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/sniff","./TextBox"],function(G,B,A,w){return G("dijit.form.SimpleTextarea",
w,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"\x3ctextarea ${!nameAttrSetting} data-dojo-attach-point\x3d'focusNode,containerNode,textbox' autocomplete\x3d'off'\x3e\x3c/textarea\x3e",postMixInProperties:function(){!this.value&&this.srcNodeRef&&(this.value=this.srcNodeRef.value);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);A("ie")&&this.cols&&B.add(this.textbox,"dijitTextAreaCols")},filter:function(q){q&&(q=q.replace(/\r/g,""));return this.inherited(arguments)},
_onInput:function(q){if(this.maxLength){var h=parseInt(this.maxLength),p=this.textbox.value.replace(/\r/g,"");h=p.length-h;if(0<h){var e=this.textbox;if(e.selectionStart){var l=e.selectionStart,b=0;A("opera")&&(b=(this.textbox.value.substring(0,l).match(/\r/g)||[]).length);this.textbox.value=p.substring(0,l-h-b)+p.substring(l-b);e.setSelectionRange(l-h,l-h)}else this.ownerDocument.selection&&(e.focus(),p=this.ownerDocument.selection.createRange(),p.moveStart("character",-h),p.text="",p.select())}}this.inherited(arguments)}})})},
"dijit/form/TimeTextBox":function(){define("dojo/_base/declare dojo/keys dojo/query dojo/_base/lang ../_TimePicker ./_DateTimeTextBox".split(" "),function(G,B,A,w,q,h){return G("dijit.form.TimeTextBox",h,{baseClass:"dijitTextBox dijitComboBox dijitTimeTextBox",popupClass:q,_selector:"time",value:new Date(""),maxHeight:-1,openDropDown:function(p){this.inherited(arguments);var e=A(".dijitTimePickerItemSelected",this.dropDown.domNode),l=this.dropDown.domNode.parentNode;l.scrollTop=e[0]?e[0].offsetTop-
(l.clientHeight-e[0].clientHeight)/2:(l.scrollHeight-l.clientHeight)/2;this.dropDown.on("input",w.hitch(this,function(){this.set("value",this.dropDown.get("value"),!1)}))},_onInput:function(){this.inherited(arguments);var p=this.get("displayedValue");this.filterString=p&&!this.parse(p,this.constraints)?p.toLowerCase():"";this._opened&&this.closeDropDown();this.openDropDown()}})})},"dijit/_TimePicker":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/sniff dojo/query dojo/mouse dojo/on ./_WidgetBase ./form/_ListMouseMixin".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c){return q("dijit._TimePicker",[d,c],{baseClass:"dijitTimePicker",pickerMin:"T00:00:00",pickerMax:"T23:59:59",clickableIncrement:"T00:15:00",visibleIncrement:"T01:00:00",value:new Date,_visibleIncrement:2,_clickableIncrement:1,_totalIncrements:10,constraints:{},serialize:w.toISOString,buildRendering:function(){this.inherited(arguments);this.timeMenu=this.containerNode=this.domNode},setValue:function(g){e.deprecated("dijit._TimePicker:setValue() is deprecated.  Use set('value', ...) instead.",
"","2.0");this.set("value",g)},_setValueAttr:function(g){this._set("value",g);this._showText()},_setFilterStringAttr:function(g){this._set("filterString",g);this._showText()},isDisabledDate:function(){return!1},_getFilteredNodes:function(g,k,t,y){g=this.ownerDocument.createDocumentFragment();for(k=0;k<this._maxIncrement;k++)(t=this._createOption(k))&&g.appendChild(t);return g},_showText:function(){var g=w.fromISOString;this.domNode.innerHTML="";this._clickableIncrementDate=g(this.clickableIncrement);
this._visibleIncrementDate=g(this.visibleIncrement);var k=function(y){return 3600*y.getHours()+60*y.getMinutes()+y.getSeconds()},t=k(this._clickableIncrementDate);k=k(this._visibleIncrementDate);(this.value||this.currentFocus).getTime();this._refDate=g(this.pickerMin);this._refDate.setFullYear(1970,0,1);this._clickableIncrement=1;this._visibleIncrement=k/t;g=g(this.pickerMax);g.setFullYear(1970,0,1);g=.001*(g.getTime()-this._refDate.getTime());this._maxIncrement=Math.ceil((g+1)/t);t=this._getFilteredNodes();
!t.firstChild&&this.filterString?(this.filterString="",this._showText()):this.domNode.appendChild(t)},constructor:function(){this.constraints={}},postMixInProperties:function(){this.inherited(arguments);this._setConstraintsAttr(this.constraints)},_setConstraintsAttr:function(g){for(var k in{clickableIncrement:1,visibleIncrement:1,pickerMin:1,pickerMax:1})k in g&&(this[k]=g[k]);g.locale||(g.locale=this.lang)},_createOption:function(g){var k=new Date(this._refDate),t=this._clickableIncrementDate;k.setHours(k.getHours()+
t.getHours()*g,k.getMinutes()+t.getMinutes()*g,k.getSeconds()+t.getSeconds()*g);"time"==this.constraints.selector&&k.setFullYear(1970,0,1);var y=A.format(k,this.constraints);if(this.filterString&&0!==y.toLowerCase().indexOf(this.filterString))return null;t=this.ownerDocument.createElement("div");t.className=this.baseClass+"Item";t.date=k;t.idx=g;p.create("div",{"class":this.baseClass+"ItemInner",innerHTML:y},t);y=1>g%this._visibleIncrement&&-1<g%this._visibleIncrement;g=!y&&!(g%this._clickableIncrement);
y?t.className+=" "+this.baseClass+"Marker":g&&(t.className+=" "+this.baseClass+"Tick");this.isDisabledDate(k)&&(t.className+=" "+this.baseClass+"ItemDisabled");this.value&&!B.compare(this.value,k,this.constraints.selector)&&(t.selected=!0,t.className+=" "+this.baseClass+"ItemSelected",this._selectedDiv=t,y?t.className+=" "+this.baseClass+"MarkerSelected":g&&(t.className+=" "+this.baseClass+"TickSelected"),this._highlightOption(t,!0));return t},onOpen:function(){this.inherited(arguments);this.set("selected",
this._selectedDiv)},_onOptionSelected:function(g,k){(g=g.target.date||g.target.parentNode.date)&&!this.isDisabledDate(g)&&(this._set("value",g),this.emit("input"),k&&(this._highlighted_option=null,this.set("value",g),this.onChange(g)))},onChange:function(){},_highlightOption:function(g,k){if(g){if(k)this._highlighted_option&&this._highlightOption(this._highlighted_option,!1),this._highlighted_option=g;else{if(this._highlighted_option!==g)return;this._highlighted_option=null}h.toggle(g,this.baseClass+
"ItemHover",k);h.contains(g,this.baseClass+"Marker")?h.toggle(g,this.baseClass+"MarkerHover",k):h.toggle(g,this.baseClass+"TickHover",k)}},handleKey:function(g){if(g.keyCode==l.DOWN_ARROW)return this.selectNextNode(),this._onOptionSelected({target:this._highlighted_option},!1),g.stopPropagation(),g.preventDefault(),!1;if(g.keyCode==l.UP_ARROW)return this.selectPreviousNode(),this._onOptionSelected({target:this._highlighted_option},!1),g.stopPropagation(),g.preventDefault(),!1;if(g.keyCode==l.ENTER||
g.keyCode===l.TAB){if(!this._keyboardSelected&&g.keyCode===l.TAB)return!0;this._highlighted_option&&this._onOptionSelected({target:this._highlighted_option},!0);return g.keyCode===l.TAB}},onHover:function(g){this._highlightOption(g,!0)},onUnhover:function(g){this._highlightOption(g,!1)},onSelect:function(g){this._highlightOption(g,!0)},onDeselect:function(g){this._highlightOption(g,!1)},onClick:function(g){this._onOptionSelected({target:g},!0)}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),
function(G,B,A,w,q,h,p,e,l){A=A("dojo.data.ItemFileReadStore",[h],{constructor:function(b){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=b.url;this._jsonData=b.data;this.data=null;this._datatypeMap=b.typeMap||{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(a){return l.fromISOString(a)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName=
"_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==b.urlPreventCache&&(this.urlPreventCache=b.urlPreventCache?!0:!1);void 0!==b.hierarchical&&(this.hierarchical=b.hierarchical?!0:!1);b.clearOnClose&&(this.clearOnClose=!0);"failOk"in b&&(this.failOk=b.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(b){if(!this.isItem(b))throw Error(this.declaredClass+
": Invalid item argument.");},_assertIsAttribute:function(b){if("string"!==typeof b)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(b,a,f){b=this.getValues(b,a);return 0<b.length?b[0]:f},getValues:function(b,a){this._assertIsItem(b);this._assertIsAttribute(a);return(b[a]||[]).slice(0)},getAttributes:function(b){this._assertIsItem(b);var a=[],f;for(f in b)f!==this._storeRefPropName&&f!==this._itemNumPropName&&f!==this._rootItemPropName&&f!==this._reverseRefMap&&
a.push(f);return a},hasAttribute:function(b,a){this._assertIsItem(b);this._assertIsAttribute(a);return a in b},containsValue:function(b,a,f){var n=void 0;"string"===typeof f&&(n=p.patternToRegExp(f,!1));return this._containsValue(b,a,f,n)},_containsValue:function(b,a,f,n){return w.some(this.getValues(b,a),function(m){if(null!==m&&!B.isObject(m)&&n){if(m.toString().match(n))return!0}else if(f===m)return!0})},isItem:function(b){return b&&b[this._storeRefPropName]===this&&this._arrayOfAllItems[b[this._itemNumPropName]]===
b?!0:!1},isItemLoaded:function(b){return this.isItem(b)},loadItem:function(b){this._assertIsItem(b.item)},getFeatures:function(){return this._features},getLabel:function(b){if(this._labelAttr&&this.isItem(b))return this.getValue(b,this._labelAttr)},getLabelAttributes:function(b){return this._labelAttr?[this._labelAttr]:null},filter:function(b,a,f){var n=[];if(b.query){var m=b.queryOptions?b.queryOptions.ignoreCase:!1;var d={};for(t in b.query){var c=b.query[t];"string"===typeof c?d[t]=p.patternToRegExp(c,
m):c instanceof RegExp&&(d[t]=c)}for(m=0;m<a.length;++m){var g=!0,k=a[m];if(null===k)g=!1;else for(t in b.query)c=b.query[t],this._containsValue(k,t,c,d[t])||(g=!1);g&&n.push(k)}}else for(m=0;m<a.length;++m){var t=a[m];null!==t&&n.push(t)}f(n,b)},_fetchItems:function(b,a,f){var n=this;if(this._loadFinished)this.filter(b,this._getItemsArray(b.queryOptions),a);else if(this._jsonFileUrl!==this._ccUrl?(G.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),
this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:b,filter:B.hitch(n,"filter"),findCallback:B.hitch(n,a)});else{this._loadInProgress=!0;var m=q.get({url:n._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});m.addCallback(function(c){try{n._getItemsFromLoadedData(c),
n._loadFinished=!0,n._loadInProgress=!1,n.filter(b,n._getItemsArray(b.queryOptions),a),n._handleQueuedFetches()}catch(g){n._loadFinished=!0,n._loadInProgress=!1,f(g,b)}});m.addErrback(function(c){n._loadInProgress=!1;f(c,b)});var d=null;b.abort&&(d=b.abort);b.abort=function(){var c=m;c&&-1===c.fired&&(c.cancel(),c=null);d&&d.call(b)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,n.filter(b,this._getItemsArray(b.queryOptions),a)}catch(c){f(c,
b)}else f(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),b)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var b=0;b<this._queuedFetches.length;b++){var a=this._queuedFetches[b],f=a.args,n=a.filter;a=a.findCallback;n?n(f,this._getItemsArray(f.queryOptions),a):this.fetchItemByIdentity(f)}this._queuedFetches=[]}},_getItemsArray:function(b){return b&&b.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(b){this.clearOnClose&&
this._loadFinished&&!this._loadInProgress&&(""!=this._jsonFileUrl&&null!=this._jsonFileUrl||""!=this.url&&null!=this.url||null!=this.data||console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(b){function a(E){return null!==
E&&"object"===typeof E&&(!B.isArray(E)||n)&&!B.isFunction(E)&&(E.constructor==Object||B.isArray(E))&&"undefined"===typeof E._reference&&"undefined"===typeof E._type&&"undefined"===typeof E._value&&m.hierarchical}function f(E){m._arrayOfAllItems.push(E);for(var F in E){var u=E[F];if(u)if(B.isArray(u))for(var D=0;D<u.length;++D){var z=u[D];a(z)&&f(z)}else a(u)&&f(u)}}var n=!1,m=this;this._labelAttr=b.label;var d;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=b.items;for(d=0;d<this._arrayOfTopLevelItems.length;++d){var c=
this._arrayOfTopLevelItems[d];B.isArray(c)&&(n=!0);f(c);c[this._rootItemPropName]=!0}var g={},k;for(d=0;d<this._arrayOfAllItems.length;++d)for(k in c=this._arrayOfAllItems[d],c){if(k!==this._rootItemPropName){var t=c[k];null!==t?B.isArray(t)||(c[k]=[t]):c[k]=[null]}g[k]=k}for(;g[this._storeRefPropName];)this._storeRefPropName+="_";for(;g[this._itemNumPropName];)this._itemNumPropName+="_";for(;g[this._reverseRefMap];)this._reverseRefMap+="_";if(g=b.identifier)for(this._itemsByIdentity={},this._features["dojo.data.api.Identity"]=
g,d=0;d<this._arrayOfAllItems.length;++d)if(c=this._arrayOfAllItems[d],b=c[g],b=b[0],Object.hasOwnProperty.call(this._itemsByIdentity,b)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+g+"].  Value collided: ["+b+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+g+"].  Value collided: ["+
b+"]");}else this._itemsByIdentity[b]=c;else this._features["dojo.data.api.Identity"]=Number;for(d=0;d<this._arrayOfAllItems.length;++d)c=this._arrayOfAllItems[d],c[this._storeRefPropName]=this,c[this._itemNumPropName]=d;for(d=0;d<this._arrayOfAllItems.length;++d)for(k in c=this._arrayOfAllItems[d],c)for(b=c[k],g=0;g<b.length;++g)if(t=b[g],null!==t&&"object"==typeof t){if("_type"in t&&"_value"in t){var y=t._type,K=this._datatypeMap[y];if(K)if(B.isFunction(K))b[g]=new K(t._value);else if(B.isFunction(K.deserialize))b[g]=
K.deserialize(t._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+y+"'");}if(t._reference){t=t._reference;if(B.isObject(t))for(y=0;y<this._arrayOfAllItems.length;++y){K=this._arrayOfAllItems[y];var C=!0,r;for(r in t)K[r]!=t[r]&&(C=!1);C&&(b[g]=K)}else b[g]=this._getItemByIdentity(t);
this.referenceIntegrity&&(t=b[g],this.isItem(t)&&this._addReferenceToMap(t,c,k))}else this.isItem(t)&&this.referenceIntegrity&&this._addReferenceToMap(t,c,k)}},_addReferenceToMap:function(b,a,f){},getIdentity:function(b){var a=this._features["dojo.data.api.Identity"];return a===Number?b[this._itemNumPropName]:(b=b[a])?b[0]:null},fetchItemByIdentity:function(b){if(this._loadFinished){var a=this._getItemByIdentity(b.identity);if(b.onItem){var f=b.scope?b.scope:G.global;b.onItem.call(f,a)}}else{var n=
this;this._jsonFileUrl!==this._ccUrl?(G.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:b}):(this._loadInProgress=!0,f=q.get({url:n._jsonFileUrl,
handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),f.addCallback(function(m){var d=b.scope?b.scope:G.global;try{n._getItemsFromLoadedData(m),n._loadFinished=!0,n._loadInProgress=!1,a=n._getItemByIdentity(b.identity),b.onItem&&b.onItem.call(d,a),n._handleQueuedFetches()}catch(c){n._loadInProgress=!1,b.onError&&b.onError.call(d,c)}}),f.addErrback(function(m){n._loadInProgress=!1;b.onError&&b.onError.call(b.scope?b.scope:G.global,m)})):this._jsonData&&(n._getItemsFromLoadedData(n._jsonData),
n._jsonData=null,n._loadFinished=!0,a=n._getItemByIdentity(b.identity),b.onItem&&(f=b.scope?b.scope:G.global,b.onItem.call(f,a)))}},_getItemByIdentity:function(b){var a=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,b)&&(a=this._itemsByIdentity[b]):Object.hasOwnProperty.call(this._arrayOfAllItems,b)&&(a=this._arrayOfAllItems[b]);void 0===a&&(a=null);return a},getIdentityAttributes:function(b){b=this._features["dojo.data.api.Identity"];return b===Number?null:[b]},_forceLoad:function(){var b=
this;this._jsonFileUrl!==this._ccUrl?(G.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var a=q.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,
sync:!0});a.addCallback(function(f){try{if(!0!==b._loadInProgress&&!b._loadFinished)b._getItemsFromLoadedData(f),b._loadFinished=!0;else if(b._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(n){throw console.log(n),n;}});a.addErrback(function(f){throw f;})}else this._jsonData&&(b._getItemsFromLoadedData(b._jsonData),b._jsonData=null,b._loadFinished=!0)}});B.extend(A,e);return A})},"dojo/data/util/filter":function(){define(["../../_base/lang"],
function(G){var B={};G.setObject("dojo.data.util.filter",B);B.patternToRegExp=function(A,w){for(var q="^",h=null,p=0;p<A.length;p++)switch(h=A.charAt(p),h){case "\\":q+=h;p++;q+=A.charAt(p);break;case "*":q+=".*";break;case "?":q+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":q+="\\";default:q+=h}q+="$";return w?new RegExp(q,"mi"):new RegExp(q,"m")};return B})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang",
"../../_base/kernel","./sorter"],function(G,B,A){var w={};G.setObject("dojo.data.util.simpleFetch",w);w.errorHandler=function(q,h){h.onError&&h.onError.call(h.scope||B.global,q,h)};w.fetchHandler=function(q,h){var p=h.abort||null,e=!1,l=h.start?h.start:0,b=h.count&&Infinity!==h.count?l+h.count:q.length;h.abort=function(){e=!0;p&&p.call(h)};var a=h.scope||B.global;h.store||(h.store=this);h.onBegin&&h.onBegin.call(a,q.length,h);h.sort&&q.sort(A.createSortFunction(h.sort,this));if(h.onItem)for(var f=
l;f<q.length&&f<b;++f){var n=q[f];e||h.onItem.call(a,n,h)}h.onComplete&&!e&&(f=null,h.onItem||(f=q.slice(l,b)),h.onComplete.call(a,f,h))};w.fetch=function(q){q=q||{};q.store||(q.store=this);this._fetchItems(q,G.hitch(this,"fetchHandler"),G.hitch(this,"errorHandler"));return q};return w})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(G){var B={};G.setObject("dojo.data.util.sorter",B);B.basicComparator=function(A,w){var q=-1;null===A&&(A=void 0);null===w&&(w=void 0);if(A==
w)q=0;else if(A>w||null==A)q=1;return q};B.createSortFunction=function(A,w){function q(n,m,d,c){return function(g,k){g=c.getValue(g,n);k=c.getValue(k,n);return m*d(g,k)}}for(var h=[],p,e=w.comparatorMap,l=B.basicComparator,b=0;b<A.length;b++){p=A[b];var a=p.attribute;if(a){p=p.descending?-1:1;var f=l;e&&("string"!==typeof a&&"toString"in a&&(a=a.toString()),f=e[a]||l);h.push(q(a,p,f,w))}}return function(n,m){for(var d=0;d<h.length;){var c=h[d++](n,m);if(0!==c)return c}return 0}};return B})},"dojox/date/islamic":function(){define(["dojox/main",
"dojo/_base/lang","dojo/date","./islamic/Date"],function(G,B,A,w){var q=B.getObject("date.islamic",!0,G);q.getDaysInMonth=function(h){return h.getDaysInIslamicMonth(h.getMonth(),h.getFullYear())};q.compare=function(h,p,e){h instanceof w&&(h=h.toGregorian());p instanceof w&&(p=p.toGregorian());return A.compare.apply(null,arguments)};q.add=function(h,p,e){var l=new w(h);switch(p){case "day":l.setDate(h.getDate()+e);break;case "weekday":var b=h.getDay();if(5>b+e&&0<b+e)l.setDate(h.getDate()+e);else{var a=
p=0;5==b?(b=4,a=0<e?-1:1):6==b&&(b=4,a=0<e?-2:2);b=0<e?5-b-1:-b;var f=e-b,n=parseInt(f/5);0!=f%5&&(p=0<e?2:-2);p=p+7*n+f%5+b;l.setDate(h.getDate()+p+a)}break;case "year":l.setFullYear(h.getFullYear()+e);break;case "week":e*=7;l.setDate(h.getDate()+e);break;case "month":h=h.getMonth();l.setMonth(h+e);break;case "hour":l.setHours(h.getHours()+e);break;case "minute":l._addMinutes(e);break;case "second":l._addSeconds(e);break;case "millisecond":l._addMilliseconds(e)}return l};q.difference=function(h,
p,e){p=p||new w;e=e||"day";var l=p.getFullYear()-h.getFullYear(),b=1;switch(e){case "weekday":l=Math.round(q.difference(h,p,"day"));b=parseInt(q.difference(h,p,"week"));if(0==l%7)l=5*b;else{e=0;var a=h.getDay(),f=p.getDay();b=parseInt(l/7);p=l%7;h=new w(h);h.setDate(h.getDate()+7*b);h=h.getDay();if(0<l)switch(!0){case 5==a:e=-1;break;case 6==a:e=0;break;case 5==f:e=-1;break;case 6==f:e=-2;break;case 5<h+p:e=-2}else if(0>l)switch(!0){case 5==a:e=0;break;case 6==a:e=1;break;case 5==f:e=2;break;case 6==
f:e=1;break;case 0>h+p:e=2}l=l+e-2*b}b=l;break;case "year":b=l;break;case "month":e=p.toGregorian()>h.toGregorian()?p:h;a=p.toGregorian()>h.toGregorian()?h:p;b=e.getMonth();f=a.getMonth();if(0==l)b=e.getMonth()-a.getMonth();else for(b=12-f+b,l=a.getFullYear()+1,e=e.getFullYear(),l;l<e;l++)b+=12;p.toGregorian()<h.toGregorian()&&(b=-b);break;case "week":b=parseInt(q.difference(h,p,"day")/7);break;case "day":b/=24;case "hour":b/=60;case "minute":b/=60;case "second":b/=1E3;case "millisecond":b*=p.toGregorian().getTime()-
h.toGregorian().getTime()}return Math.round(b)};return q})},"dojox/main":function(){define(["dojo/_base/kernel"],function(G){return G.dojox})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(G,B,A){var w=B("dojox.date.islamic.Date",null,{_date:0,_month:0,_year:0,_hours:0,_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,constructor:function(){var q=arguments.length;q?1==q?(q=arguments[0],"number"==
typeof q&&(q=new Date(q)),q instanceof Date?this.fromGregorian(q):""==q?this._date=new Date(""):(this._year=q._year,this._month=q._month,this._date=q._date,this._hours=q._hours,this._minutes=q._minutes,this._seconds=q._seconds,this._milliseconds=q._milliseconds)):3<=q&&(this._year+=arguments[0],this._month+=arguments[1],this._date+=arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},
getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},setDate:function(q){q=parseInt(q);if(!(0<q&&q<=this.getDaysInIslamicMonth(this._month,this._year))){var h;if(0<q)for(h=this.getDaysInIslamicMonth(this._month,
this._year);q>h;q-=h,h=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,this._month-=12);else for(h=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=q;h=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),q+=h}this._date=q;return this},setFullYear:function(q){this._year=+q},setMonth:function(q){this._year+=
Math.floor(q/12);this._month=0<q?Math.floor(q%12):Math.floor((q%12+12)%12)},setHours:function(){var q=arguments.length,h=0;1<=q&&(h=parseInt(arguments[0]));2<=q&&(this._minutes=parseInt(arguments[1]));3<=q&&(this._seconds=parseInt(arguments[2]));4==q&&(this._milliseconds=parseInt(arguments[3]));for(;24<=h;)this._date++,q=this.getDaysInIslamicMonth(this._month,this._year),this._date>q&&(this._month++,12<=this._month&&(this._year++,this._month-=12),this._date-=q),h-=24;this._hours=h},_addMinutes:function(q){q+=
this._minutes;this.setMinutes(q);this.setHours(this._hours+parseInt(q/60));return this},_addSeconds:function(q){q+=this._seconds;this.setSeconds(q);this._addMinutes(parseInt(q/60));return this},_addMilliseconds:function(q){q+=this._milliseconds;this.setMilliseconds(q);this._addSeconds(parseInt(q/1E3));return this},setMinutes:function(q){this._minutes=q%60;return this},setSeconds:function(q){this._seconds=q%60;return this},setMilliseconds:function(q){this._milliseconds=q%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";
var q=new Date;q.setHours(this._hours);q.setMinutes(this._minutes);q.setSeconds(this._seconds);q.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+q.toTimeString()},toGregorian:function(){var q=this._year;q=Math.floor(this._date+Math.ceil(29.5*this._month)+354*(q-1)+Math.floor((3+11*q)/30)+this._ISLAMIC_EPOCH-1-.5)+.5;var h=q-this._GREGORIAN_EPOCH,p=Math.floor(h/146097),e=this._mod(h,146097);h=Math.floor(e/36524);var l=this._mod(e,36524);e=Math.floor(l/1461);
l=this._mod(l,1461);l=Math.floor(l/365);p=400*p+100*h+4*e+l;4!=h&&4!=l&&p++;h=q-(this._GREGORIAN_EPOCH+365*(p-1)+Math.floor((p-1)/4)-Math.floor((p-1)/100)+Math.floor((p-1)/400));e=this._GREGORIAN_EPOCH-1+365*(p-1)+Math.floor((p-1)/4)-Math.floor((p-1)/100)+Math.floor((p-1)/400)+Math.floor(739/12+(A.isLeapYear(new Date(p,3,1))?-1:-2)+1);e=q<e?0:A.isLeapYear(new Date(p,3,1))?1:2;h=Math.floor((12*(h+e)+373)/367);e=this._GREGORIAN_EPOCH-1+365*(p-1)+Math.floor((p-1)/4)-Math.floor((p-1)/100)+Math.floor((p-
1)/400)+Math.floor((367*h-362)/12+(2>=h?0:A.isLeapYear(new Date(p,h-1,1))?-1:-2)+1);return new Date(p,h-1,q-e+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(q){q=new Date(q);var h=q.getFullYear(),p=q.getMonth(),e=q.getDate();h=this._GREGORIAN_EPOCH-1+365*(h-1)+Math.floor((h-1)/4)+-Math.floor((h-1)/100)+Math.floor((h-1)/400)+Math.floor((367*(p+1)-362)/12+(2>=p+1?0:A.isLeapYear(q)?-1:-2)+e);h=Math.floor(h)+.5;h-=this._ISLAMIC_EPOCH;p=Math.floor((30*h+10646)/10631);
e=Math.ceil((h-29-this._yearStart(p))/29.5);e=Math.min(e,11);this._date=Math.ceil(h-this._monthStart(p,e))+1;this._month=e;this._year=p;this._hours=q.getHours();this._minutes=q.getMinutes();this._seconds=q.getSeconds();this._milliseconds=q.getMilliseconds();this._day=q.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},_yearStart:function(q){return 354*(q-1)+Math.floor((3+11*q)/30)},_monthStart:function(q,h){return Math.ceil(29.5*h)+354*(q-1)+Math.floor((3+11*q)/30)},_civilLeapYear:function(q){return 11>
(14+11*q)%30},getDaysInIslamicMonth:function(q,h){var p=0;p=29+(q+1)%2;11==q&&this._civilLeapYear(h)&&p++;return p},_mod:function(q,h){return q-h*Math.floor(q/h)}});w.getDaysInIslamicMonth=function(q){return(new w).getDaysInIslamicMonth(q.getMonth(),q.getFullYear())};return w})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),function(G,B,A,w,q,h,p,e,l){function b(d,
c,g,k,t){return t.replace(/([a-z])\1*/ig,function(y){var K=y.charAt(0);y=y.length;var C=["abbr","wide","narrow"];switch(K){case "G":var r=c.eraAbbr[0];break;case "y":r=String(d.getFullYear());break;case "M":r=d.getMonth();if(3>y){r+=1;var E=!0}else K=["months-format",C[y-3]].join("-"),r=c[K][r];break;case "d":r=d.getDate(!0);E=!0;break;case "E":r=d.getDay();3>y?(r+=1,E=!0):(K=["days-format",C[y-3]].join("-"),r=c[K][r]);break;case "a":r=12>d.getHours()?"am":"pm";r=c["dayPeriods-format-wide-"+r];break;
case "h":case "H":case "K":case "k":E=d.getHours();switch(K){case "h":r=E%12||12;break;case "H":r=E;break;case "K":r=E%12;break;case "k":r=E||24}E=!0;break;case "m":r=d.getMinutes();E=!0;break;case "s":r=d.getSeconds();E=!0;break;case "S":r=Math.round(d.getMilliseconds()*Math.pow(10,y-3));E=!0;break;case "z":if(r=w.getTimezoneName(d.toGregorian()))break;y=4;case "Z":r=d.toGregorian().getTimezoneOffset();r=[0>=r?"+":"-",p.pad(Math.floor(Math.abs(r)/60),2),p.pad(Math.abs(r)%60,2)];4==y&&(r.splice(0,
0,"GMT"),r.splice(3,0,":"));r=r.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+t);}E&&(r=p.pad(r,y));return r})}function a(d,c,g,k){var t=function(C){return C};c=c||t;g=g||t;k=k||t;var y=d.match(/(''|[^'])+/g),K="'"==d.charAt(0);A.forEach(y,function(C,r){C?(y[r]=(K?g:c)(C),K=!K):y[r]=""});return k(y.join(""))}function f(d,c,g,k){k=h.escapeString(k);q.normalizeLocale(g.locale);return k.replace(/([a-z])\1*/ig,function(t){var y=t.charAt(0);var K=
t.length,C="";g.strict?1<K&&(C="0{"+(K-1)+"}"):C="0?";switch(y){case "y":y="\\d+";break;case "M":y=2<K?"\\S+ ?\\S+":C+"[1-9]|1[0-2]";break;case "d":y="[12]\\d|"+C+"[1-9]|3[01]";break;case "E":y="\\S+";break;case "h":y=C+"[1-9]|1[0-2]";break;case "k":y=C+"\\d|1[01]";break;case "H":y=C+"\\d|1\\d|2[0-3]";break;case "K":y=C+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":y=C+"\\d|[0-5]\\d";break;case "S":y="\\d{"+K+"}";break;case "a":K=g.am||c["dayPeriods-format-wide-am"];C=g.pm||c["dayPeriods-format-wide-pm"];
g.strict?y=K+"|"+C:(y=K+"|"+C,K!=K.toLowerCase()&&(y+="|"+K.toLowerCase()),C!=C.toLowerCase()&&(y+="|"+C.toLowerCase()));break;default:y=".*"}d&&d.push(t);return"("+y+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var n=B.getObject("date.islamic.locale",!0,G);n.format=function(d,c){c=c||{};var g=q.normalizeLocale(c.locale),k=c.formatLength||"short",t=n._getIslamicBundle(g),y=[];g=B.hitch(this,b,d,t,g,c.fullYear);if("year"==c.selector)return d.getFullYear();"time"!=c.selector&&(d=c.datePattern||t["dateFormat-"+
k])&&y.push(a(d,g));"date"!=c.selector&&(c=c.timePattern||t["timeFormat-"+k])&&y.push(a(c,g));return y.join(" ")};n.regexp=function(d){return n._parseInfo(d).regexp};n._parseInfo=function(d){d=d||{};var c=q.normalizeLocale(d.locale);c=n._getIslamicBundle(c);var g=d.formatLength||"short",k=d.datePattern||c["dateFormat-"+g];g=d.timePattern||c["timeFormat-"+g];var t=[];return{regexp:a("date"==d.selector?k:"time"==d.selector?g:"undefined"==typeof g?k:k+" "+g,B.hitch(this,f,t,c,d)),tokens:t,bundle:c}};
n.parse=function(d,c){d=d.replace(/[\u200E\u200F\u202A\u202E]/g,"");c||(c={});var g=n._parseInfo(c),k=g.tokens,t=g.bundle;g=g.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,"");d=(new RegExp("^"+g+"$")).exec(d);q.normalizeLocale(c.locale);if(!d)return null;var y=[1389,0,1,0,0,0,0],K="",C=["abbr","wide","narrow"];A.every(d,function(r,E){if(!E)return!0;E=k[E-1];var F=E.length;switch(E.charAt(0)){case "y":y[0]=Number(r);break;case "M":if(2<F){if(E=t["months-format-"+C[F-3]].concat(),c.strict||(r=r.replace(".",
"").toLowerCase(),E=A.map(E,function(D){return D?D.replace(".","").toLowerCase():D})),r=A.indexOf(E,r),-1==r)return!1}else r--;y[1]=Number(r);break;case "D":y[1]=0;case "d":y[2]=Number(r);break;case "a":E=c.am||t["dayPeriods-format-wide-am"];F=c.pm||t["dayPeriods-format-wide-pm"];if(!c.strict){var u=/\./g;r=r.replace(u,"").toLowerCase();E=E.replace(u,"").toLowerCase();F=F.replace(u,"").toLowerCase()}if(c.strict&&r!=E&&r!=F)return!1;K=r==F?"p":r==E?"a":"";break;case "K":24==r&&(r=0);case "h":case "H":case "k":y[3]=
Number(r);break;case "m":y[4]=Number(r);break;case "s":y[5]=Number(r);break;case "S":y[6]=Number(r)}return!0});d=+y[3];"p"===K&&12>d?y[3]=d+12:"a"===K&&12==d&&(y[3]=0);return new e(y[0],y[1],y[2],y[3],y[4],y[5],y[6])};var m=[];n.addCustomFormats=function(d,c){m.push({pkg:d,name:c})};n._getIslamicBundle=function(d){var c={};A.forEach(m,function(g){g=q.getLocalization(g.pkg,g.name,d);c=B.mixin(c,g)},this);return c};n.addCustomFormats("dojo.cldr","islamic");n.getNames=function(d,c,g,k,t){k=n._getIslamicBundle(k);
d=[d,g,c];if("standAlone"==g){g=d.join("-");var y=k[g];1==y[0]&&(y=void 0)}d[1]="format";return(y||k[d.join("-")]).concat()};n.weekDays=n.getNames("days","wide","format");n.months=n.getNames("months","wide","format");return n})},"esri/dijit/editing/Add":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(G,B,A,w,q,h){B=B(h,{declaredClass:"esri.dijit.editing.Add",type:"edit",label:"Add Features",constructor:function(p){p=
p||{};p.featureLayer?(this._featureLayer=p.featureLayer,p.addedGraphics?this._addedGraphics=p.addedGraphics:console.error("In constructor of 'esri.dijit.editing.Add', no graphics provided")):console.error("In constructor of 'esri.dijit.editing.Add', featureLayer is not provided")},updateObjectIds:function(p,e){this.updateIds(this._featureLayer,this._addedGraphics,p,e)},performUndo:function(){return this._featureLayer.applyEdits(null,null,this._addedGraphics).then(A.hitch(this,function(){return{layer:this._featureLayer,
operation:this}}))},performRedo:function(){var p=G.map(this._addedGraphics,function(e){return e.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,null,null).then(A.hitch(this,function(e,l,b){e=G.map(e,function(a){return a.objectId});return{oldIds:p,addedIds:e,layer:this._featureLayer,operation:this}}))}});w("extend-esri")&&A.setObject("dijit.editing.Add",B,q);return B})},"esri/dijit/editing/EditOperationBase":function(){define(["dojo/_base/array",
"dojo/_base/declare","dojo/has","../../kernel","../../OperationBase"],function(G,B,A,w,q){B=B(q,{declaredClass:"esri.EditOperationBase",updateIds:function(h,p,e,l){G.forEach(p,function(b,a){var f=b[h.objectIdField];G.forEach(e,function(n,m){f===n&&(b[h.objectIdField]=l[m])})})}});A("extend-esri")&&(w.EditOperationBase=B);return B})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(G,B,A){G=G(null,{declaredClass:"esri.OperationBase",type:"not implemented",
label:"not implemented",constructor:function(w){w=w||{};w.label&&(this.label=w.label)},performUndo:function(){console.log("performUndo has not been implemented")},performRedo:function(){console.log("performRedo has not been implemented")}});B("extend-esri")&&(A.OperationBase=G);return G})},"esri/dijit/editing/Update":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(G,B,A,w,q,h,p){G=B(p,{declaredClass:"esri.dijit.editing.Update",
type:"edit",label:"Update Features",constructor:function(e){var l;e=e||{};if(e.featureLayer)if(this._featureLayer=e.featureLayer,e.preUpdatedGraphics){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(l=0;l<e.preUpdatedGraphics.length;l++)this._preUpdatedGraphicsGeometries.push(e.preUpdatedGraphics[l].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(e.preUpdatedGraphics[l].attributes);if(e.postUpdatedGraphics)for(this._postUpdatedGraphics=e.postUpdatedGraphics,
this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],l=0;l<e.postUpdatedGraphics.length;l++)e.postUpdatedGraphics[l].geometry?this._postUpdatedGraphicsGeometries.push(e.postUpdatedGraphics[l].geometry.toJson()):this._postUpdatedGraphicsGeometries.push(e.postUpdatedGraphics[l].geometry),this._postUpdatedGraphicsAttributes.push(A.clone(e.postUpdatedGraphics[l].attributes));else console.error("In constructor of 'esri.dijit.editing.Update', postUpdatedGraphics not provided")}else console.error("In constructor of 'esri.dijit.editing.Update', preUpdatedGraphics not provided");
else console.error("In constructor of 'esri.dijit.editing.Update', featureLayer not provided")},updateObjectIds:function(e,l){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,e,l);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,e,l)},performUndo:function(){var e;for(e=0;e<this._postUpdatedGraphics.length;e++)this._preUpdatedGraphicsGeometries[e]?this._postUpdatedGraphics[e].setGeometry(h.fromJson(this._preUpdatedGraphicsGeometries[e])):this._postUpdatedGraphics[e].setGeometry(this._preUpdatedGraphicsGeometries[e]),
this._postUpdatedGraphics[e].setAttributes(this._preUpdatedGraphicsAttributes[e]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(A.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var e;for(e=0;e<this._postUpdatedGraphics.length;e++)this._postUpdatedGraphicsGeometries[e]?this._postUpdatedGraphics[e].setGeometry(h.fromJson(this._postUpdatedGraphicsGeometries[e])):this._postUpdatedGraphics[e].setGeometry(this._postUpdatedGraphicsGeometries[e]),
this._postUpdatedGraphics[e].setAttributes(this._postUpdatedGraphicsAttributes[e]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(A.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});w("extend-esri")&&A.setObject("dijit.editing.Update",G,q);return G})},"esri/dijit/editing/Delete":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(G,B,A,w,q,h){B=B(h,{declaredClass:"esri.dijit.editing.Delete",
type:"edit",label:"Delete Features",constructor:function(p){p=p||{};p.featureLayer?(this._featureLayer=p.featureLayer,p.deletedGraphics?this._deletedGraphics=p.deletedGraphics:console.error("In constructor of 'esri.dijit.editing.Delete', no graphics provided")):console.error("In constructor of 'esri.dijit.editing.Delete', featureLayer is not provided")},updateObjectIds:function(p,e){this.updateIds(this._featureLayer,this._deletedGraphics,p,e)},performUndo:function(){var p=G.map(this._deletedGraphics,
function(e){return e.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,null,null).then(A.hitch(this,function(e,l,b){e=G.map(e,function(a){return a.objectId});return{oldIds:p,addedIds:e,layer:this._featureLayer,operation:this}}))},performRedo:function(){return this._featureLayer.applyEdits(null,null,this._deletedGraphics).then(A.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});w("extend-esri")&&A.setObject("dijit.editing.Delete",
B,q);return B})},"esri/dijit/editing/Cut":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(G,B,A,w,q,h,p){B=B(p,{declaredClass:"esri.dijit.editing.Cut",type:"edit",label:"Cut Features",constructor:function(e){var l;e=e||{};if(e.featureLayer)if(this._featureLayer=e.featureLayer,e.addedGraphics)if(this._addedGraphics=e.addedGraphics,e.preUpdatedGraphics){this._preUpdatedGraphicsGeometries=[];
this._preUpdatedGraphicsAttributes=[];for(l=0;l<e.preUpdatedGraphics.length;l++)this._preUpdatedGraphicsGeometries.push(e.preUpdatedGraphics[l].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(e.preUpdatedGraphics[l].attributes);if(e.postUpdatedGraphics)for(this._postUpdatedGraphics=e.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],l=0;l<e.postUpdatedGraphics.length;l++)this._postUpdatedGraphicsGeometries.push(e.postUpdatedGraphics[l].geometry.toJson()),
this._postUpdatedGraphicsAttributes.push(A.clone(e.postUpdatedGraphics[l].attributes));else console.error("In constructor of 'esri.dijit.editing.Cut', postUpdatedGraphics not provided")}else console.error("In constructor of 'esri.dijit.editing.Cut', preUpdatedGraphics not provided");else console.error("In constructor of 'esri.dijit.editing.Cut', addedGraphics for cut not provided");else console.error("In constructor of 'esri.dijit.editing.Cut', featureLayer not provided")},updateObjectIds:function(e,
l){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,e,l);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,e,l);this.updateIds(this._featureLayer,this._addedGraphics,e,l)},performUndo:function(){var e;for(e=0;e<this._postUpdatedGraphics.length;e++)this._postUpdatedGraphics[e].setGeometry(h.fromJson(this._preUpdatedGraphicsGeometries[e])),this._postUpdatedGraphics[e].setAttributes(this._preUpdatedGraphicsAttributes[e]);return this._featureLayer.applyEdits(null,
this._postUpdatedGraphics,this._addedGraphics).then(A.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var e;for(e=0;e<this._postUpdatedGraphics.length;e++)this._postUpdatedGraphics[e].setGeometry(h.fromJson(this._postUpdatedGraphicsGeometries[e])),this._postUpdatedGraphics[e].setAttributes(this._postUpdatedGraphicsAttributes[e]);var l=G.map(this._addedGraphics,function(b){return b.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,
this._postUpdatedGraphics,null).then(A.hitch(this,function(b,a,f){b=G.map(b,function(n){return n.objectId});return{oldIds:l,addedIds:b,layer:this._featureLayer,operation:this}}))}});w("extend-esri")&&A.setObject("dijit.editing.Cut",B,q);return B})},"esri/dijit/editing/Union":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(G,B,A,w,q,h,p){B=B(p,{declaredClass:"esri.dijit.editing.Union",type:"edit",
label:"Union Features",constructor:function(e){e=e||{};this._featureLayer=e.featureLayer;this._deletedGraphics=e.deletedGraphics;this._preUpdatedGraphics=e.preUpdatedGraphics;this._postUpdatedGraphics=e.postUpdatedGraphics;this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];this._postUpdatedGraphicsGeometries=[];this._postUpdatedGraphicsAttributes=[];var l;for(l=0;l<e.preUpdatedGraphics.length;l++)this._preUpdatedGraphicsGeometries.push(e.preUpdatedGraphics[l].geometry.toJson()),
this._preUpdatedGraphicsAttributes.push(e.preUpdatedGraphics[l].attributes);for(l=0;l<e.postUpdatedGraphics.length;l++)this._postUpdatedGraphicsGeometries.push(e.postUpdatedGraphics[l].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(A.clone(e.postUpdatedGraphics[l].attributes))},updateObjectIds:function(e,l){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,e,l);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,e,l);this.updateIds(this._featureLayer,
this._deletedGraphics,e,l)},performUndo:function(){var e;for(e=0;e<this._postUpdatedGraphics.length;e++)this._postUpdatedGraphics[e].setGeometry(h.fromJson(this._preUpdatedGraphicsGeometries[e])),this._postUpdatedGraphics[e].setAttributes(this._preUpdatedGraphicsAttributes[e]);var l=G.map(this._deletedGraphics,function(b){return b.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,this._postUpdatedGraphics,null).then(A.hitch(this,function(b,
a,f){b=G.map(b,function(n){return n.objectId});return{oldIds:l,addedIds:b,layer:this._featureLayer,operation:this}}))},performRedo:function(){var e;for(e=0;e<this._postUpdatedGraphics.length;e++)this._postUpdatedGraphics[e].setGeometry(h.fromJson(this._postUpdatedGraphicsGeometries[e])),this._postUpdatedGraphics[e].setAttributes(this._postUpdatedGraphicsAttributes[e]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._deletedGraphics).then(A.hitch(this,function(){return{layer:this._featureLayer,
operation:this}}))}});w("extend-esri")&&A.setObject("dijit.editing.Union",B,q);return B})},"esri/dijit/editing/toolbars/Drawing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/_CssStateMixin ../Util ./ToolbarBase ../tools/ButtonToolBase ../tools/Cut ../tools/Union ../tools/Reshape ../tools/Editing ../tools/EditingTools ../tools/Selection ../tools/SelectionTools ../../../kernel".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g){G=G([e,
h],{declaredClass:"esri.dijit.editing.toolbars.Drawing",onShowAttributeInspector:function(){},_activateTool:function(k,t){this._settings.editor._activeTool=k;"EDITING"!==k&&this._settings.templatePicker.clearSelection();"ATTRIBUTES"!==k&&this._settings.editor._hideAttributeInspector();"CLEAR"!==k&&this.inherited(arguments)},_initializeToolbar:function(){A.forEach(this._settings.layers,function(k){this._tbConnects.push(w.connect(k,"onSelectionComplete",this,"_updateUI"))},this)},activateEditing:function(k,
t){this._tools.EDITING._activateTool(k,t.geometryType);this._activeTool=this._tools.EDITING;this._activeTool.setChecked(!0)},_updateUI:function(){this._settings.undoManager&&(this._tools.UNDO.set("disabled",!1===this._settings.undoManager.canUndo),this._tools.REDO.set("disabled",!1===this._settings.undoManager.canRedo));this._selectedFeatures=p.getSelection(this._settings.layers);var k=this._selectedFeatures.length;this._tools.DELETE&&this._tools.DELETE.set("disabled",0>=k);this._tools.CLEAR&&this._tools.CLEAR.set("disabled",
0>=k);this._tools.ATTRIBUTES&&this._tools.ATTRIBUTES.set("disabled",0>=k);this._tools.UNION&&this._tools.UNION.set("disabled",2>k)},_toolFinished:function(k){if("ATTRIBUTES"===k&&this._selectedFeatures&&this._selectedFeatures.length)this.onShowAttributeInspector(this._selectedFeatures[0]);if("SELECT"===k||"CUT"===k||"RESHAPING"===k||"EDITING"===k)this._activeTool.deactivate(),this._activeTool.setChecked(!1),this._activeTool=null;if("DELETE"===k)this.onDelete();this._settings.editor._activeTool=null;
this._updateUI()},_createTools:function(){this._tools.SELECT=new d({settings:this._settings,onClick:B.hitch(this,"_activateTool","SELECT",!0),onFinished:B.hitch(this,"_toolFinished","SELECT")});this.addChild(this._tools.SELECT);this._tools.CLEAR=new l(B.mixin(c.selectClear,{settings:this._settings,onClick:B.hitch(this._settings.editor,"_clearSelection",!1)}));this.addChild(this._tools.CLEAR);this._createSeparator();this._tools.ATTRIBUTES=new l(B.mixin(m.attributes,{settings:this._settings,onClick:B.hitch(this,
"_toolFinished","ATTRIBUTES")}));this.addChild(this._tools.ATTRIBUTES);this._createSeparator();this._tools.EDITING=new n({settings:this._settings,onClick:B.hitch(this,"_activateTool","EDITING",!0),onApplyEdits:B.hitch(this,"onApplyEdits"),onFinished:B.hitch(this,"_toolFinished","EDITING")});this.addChild(this._tools.EDITING);this._tools.DELETE=new l(B.mixin(m.del,{settings:this._settings,onClick:B.hitch(this,"_toolFinished","DELETE")}));this.addChild(this._tools.DELETE);this._settings.toolbarOptions&&
((this._settings.toolbarOptions.cutVisible||this._settings.toolbarOptions.mergeVisible||this._settings.toolbarOptions.reshapeVisible)&&this._createSeparator(),this._settings.toolbarOptions.cutVisible&&(this._tools.CUT=new b({settings:this._settings,onFinished:B.hitch(this,"_toolFinished","CUT"),onClick:B.hitch(this,"_activateTool","CUT",!0),onApplyEdits:B.hitch(this,"onApplyEdits")}),this.addChild(this._tools.CUT)),this._settings.toolbarOptions.mergeVisible&&(this._tools.UNION=new a({settings:this._settings,
onFinished:B.hitch(this,"_toolFinished","UNION"),onApplyEdits:B.hitch(this,"onApplyEdits")}),this.addChild(this._tools.UNION)),this._settings.toolbarOptions.reshapeVisible&&(this._tools.RESHAPING=new f({settings:this._settings,onClick:B.hitch(this,"_activateTool","RESHAPING",!0),onFinished:B.hitch(this,"_toolFinished","RESHAPING"),onApplyEdits:B.hitch(this,"onApplyEdits")}),this.addChild(this._tools.RESHAPING)));this._settings.enableUndoRedo&&(this._createSeparator(),this._tools.UNDO=new l(B.mixin(m.undo,
{settings:this._settings,disabled:!0,onClick:B.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._undo()})})),this.addChild(this._tools.UNDO),this._tools.REDO=new l(B.mixin(m.redo,{settings:this._settings,disabled:!0,onClick:B.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._redo()})})),this.addChild(this._tools.REDO))}});q("extend-esri")&&B.setObject("dijit.editing.toolbars.Drawing",
G,g);return G})},"esri/dijit/editing/toolbars/ToolbarBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/Toolbar dijit/ToolbarSeparator ../../../kernel ../../../lang".split(" "),function(G,B,A,w,q,h,p,e,l){G=G([h],{declaredClass:"esri.dijit.editing.toolbars.ToolbarBase",_enabled:!0,graphicsAdded:function(){},drawEnd:function(){},onApplyEdits:function(){},onDelete:function(){},constructor:function(b,a){b&&b.settings&&(this._tools=[],this._tbConnects=
[],this._initialize(b.settings))},postCreate:function(){this._createTools();this.deactivate()},destroy:function(){var b,a=this._tools;for(b in a)a.hasOwnProperty(b)&&l.isDefined(this._tools[b])&&this._tools[b].destroy();A.forEach(this._tbConnects,w.disconnect);this.inherited(arguments)},activate:function(b){this._enabled=!0},deactivate:function(){var b;this._enabled=!1;this._geometryType=this._layer=null;var a=this._tools;for(b in a)a.hasOwnProperty(b)&&(this._tools[b].deactivate(),this._tools[b].setChecked(!1))},
isEnabled:function(){return this._enabled},setActiveSymbol:function(b){this._activeSymbol=b},_getSymbol:function(){},_createTools:function(){},_initialize:function(b){this._settings=b;this._toolbar=b.drawToolbar;this._editToolbar=b.editToolbar;this._initializeToolbar()},_activateTool:function(b,a){this._activeTool&&this._activeTool.deactivate();!0===a&&this._activeTool==this._tools[b]?(this._activeTool.setChecked(!1),this._activeTool=null):(this._activeTool=this._tools[b],this._activeTool.setChecked(!0),
this._activeTool.activate(null))},_createSeparator:function(){this.addChild(new p)}});q("extend-esri")&&B.setObject("dijit.editing.toolbars.ToolbarBase",G,e);return G})},"esri/dijit/editing/tools/ButtonToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/Button ./ToolBase ../../../kernel".split(" "),function(G,B,A,w,q,h){G=G([w,q],{declaredClass:"esri.dijit.editing.tools.ButtonToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},
destroy:function(){w.prototype.destroy.apply(this,arguments);q.prototype.destroy.apply(this,arguments)}});A("extend-esri")&&B.setObject("dijit.editing.tools.ButtonToolBase",G,h);return G})},"esri/dijit/editing/tools/ToolBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../../kernel","dojo/i18n!../../../nls/jsapi"],function(G,B,A,w,q){G=G(null,{declaredClass:"esri.dijit.editing.tools.ToolBase",_enabled:!0,showLabel:!1,constructor:function(h,p){h=h||{};B.mixin(this,h);this.label=
this._label?q.widgets.editor.tools[this._label]:"";this._settings=h.settings;this._toolbar=h.settings.drawToolbar;this._editToolbar=h.settings.editToolbar;this._initializeTool()},onFinished:function(){},onDrawEnd:function(){},onApplyEdits:function(){},postCreate:function(){this.deactivate();this.inherited(arguments)},destroy:function(){},activate:function(h){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this._enabled&&(this._checked=!0,this._layer=h,this._toolbar&&
this._drawType&&this._toolbar.activate(this._drawType))},deactivate:function(){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this.setChecked(!1);this._updateUI()},setEnabled:function(h){this._enabled=h;this._updateUI()},setChecked:function(h){this._checked=h},enable:function(h){this._updateUI()},isEnabled:function(){return this._enabled},getToolName:function(){return this._toolName},_initializeTool:function(){},_updateUI:function(){this.disabled=!this._enabled;
this.attr("iconClass",this._enabled?this._enabledIcon:this._disabledIcon)}});A("extend-esri")&&B.setObject("dijit.editing.tools.ToolBase",G,w);return G})},"esri/dijit/editing/tools/Cut":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/DeferredList ../../../graphicsUtils ../../../graphic ../../../tasks/query ../../../layers/FeatureLayer ../../../toolbars/draw ../Cut ./ToggleToolBase ../../../kernel".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f,
n,m){G=G([n],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:a.POLYLINE,_enabled:!0,_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(w.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);A.forEach(this._cutConnects,w.disconnect);this._cutConnects=[];this._edits=[]},_onDrawEnd:function(d){var c=this._cutLayers=
A.filter(this._settings.layers,function(k){return"esriGeometryPolygon"===k.geometryType||"esriGeometryPolyline"===k.geometryType&&k.visible&&k._isMapAtVisibleScale()});this._cutConnects=this._cutConnects.concat(A.map(c,B.hitch(this,function(k){return w.connect(k,"onEditsComplete",B.hitch(this,function(t,y,K){if(this._settings.undoRedoManager){var C=this._settings.undoRedoManager;A.forEach(this._edits,B.hitch(this,function(r){C.add(new f({featureLayer:r.layer,addedGraphics:r.adds,preUpdatedGraphics:r.preUpdates,
postUpdatedGraphics:r.updates}))}),this)}this.onFinished()}))})));var g=new l;g.geometry=d;A.forEach(c,function(k,t){this._settings.editor._selectionHelper.selectFeatures([k],g,b.SELECTION_NEW,B.hitch(this,"_cutFeatures",k,g))},this)},_cutFeatures:function(d,c,g){if(g&&g.length){this._edits=[];var k=[];k.push(this._settings.geometryService.cut(p.getGeometries(g),c.geometry,B.hitch(this,"_cutHandler",d,g)));(new h(k)).addCallback(B.hitch(this,function(){this.onApplyEdits(this._edits)}))}},_cutHandler:function(d,
c,g){var k=[],t=[],y=A.map(c,function(r){return new e(B.clone(r.toJson()))}),K,C;A.forEach(g.cutIndexes,function(r,E){K!=r?(K=r,t.push(c[r].setGeometry(g.geometries[E]))):(C=new e(g.geometries[E],null,B.mixin({},c[r].attributes),null),C.attributes[c[0].getLayer().objectIdField]=null,k.push(C))},this);this._edits.push({layer:d,adds:k,updates:t,preUpdates:y})}});q("extend-esri")&&B.setObject("dijit.editing.tools.Cut",G,m);return G})},"esri/dijit/editing/tools/ToggleToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/ToggleButton ./ToolBase ../../../kernel".split(" "),
function(G,B,A,w,q,h){G=G([w,q],{declaredClass:"esri.dijit.editing.tools.ToggleToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){w.prototype.destroy.apply(this,arguments);q.prototype.destroy.apply(this,arguments)},setChecked:function(p){w.prototype.setChecked.apply(this,arguments)}});A("extend-esri")&&B.setObject("dijit.editing.tools.ToggleToolBase",G,h);return G})},"esri/dijit/editing/tools/Union":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../graphicsUtils ../../../graphic ../../../toolbars/draw ../Union ./ButtonToolBase ../../../kernel".split(" "),
function(G,B,A,w,q,h,p,e,l,b){G=G([l],{declaredClass:"esri.dijit.editing.tools.Union",id:"btnFeatureUnion",_enabledIcon:"toolbarIcon unionIcon",_disabledIcon:"toolbarIcon unionIcon",_drawType:p.POLYLINE,_enabled:!0,_label:"NLS_unionLbl",_onClick:function(a){this._settings.editor._activeTool="UNION";a=A.filter(this._settings.layers,function(m){return"esriGeometryPolygon"===m.geometryType&&m.visible&&m._isMapAtVisibleScale()});var f=[],n=0;A.forEach(a,function(m,d){var c=m.getSelectedFeatures();2<=
c.length&&(n++,this._settings.geometryService.union(q.getGeometries(c),B.hitch(this,function(g){var k=c.shift(),t=[],y=[];t.push(new h(k.toJson()));y.push(k.setGeometry(g));f.push({layer:m,updates:y,deletes:c,preUpdates:t});n--;if(0>=n)this.onApplyEdits(f,B.hitch(this,function(){if(this._settings.undoRedoManager){var K=this._settings.undoRedoManager;A.forEach(this._edits,B.hitch(this,function(C){K.add(new e({featureLayer:C.layer,deletedGraphics:C.deletes,preUpdatedGraphics:C.preUpdates,postUpdatedGraphics:C.updates}))}),
this)}this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()}))})))},this)}});w("extend-esri")&&B.setObject("dijit.editing.tools.Union",G,b);return G})},"esri/dijit/editing/tools/Reshape":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has ../../../graphic ../../../layers/FeatureLayer ../../../tasks/query ../../../toolbars/draw ./ToggleToolBase ../../../kernel".split(" "),function(G,B,A,w,q,h,p,e,l,b,a){G=G([b],{declaredClass:"esri.dijit.editing.tools.Reshape",
id:"btnFeatureReshape",_enabledIcon:"toolbarIcon reshapeIcon",_disabledIcon:"toolbarIcon reshapeIcon",_drawType:l.POLYLINE,_enabled:!0,_label:"NLS_reshapeLbl",activate:function(){w.disconnect(this._rConnect);this._rConnect=w.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd");this.inherited(arguments)},deactivate:function(){this.inherited(arguments);w.disconnect(this._rConnect);delete this._rConnect},_onDrawEnd:function(f){var n=this._settings.layers,m=new e;m.geometry=f;f=this._reshapeLayers=A.filter(n,
function(d){return"esriGeometryPolygon"===d.geometryType||"esriGeometryPolyline"});this._settings.editor._selectionHelper.selectFeatures(f,m,p.SELECTION_NEW,B.hitch(this,"_reshape",m))},_reshape:function(f,n){if(1===n.length){var m=[],d=[],c=[],g=n[0],k=g.getLayer();this._settings.geometryService.reshape(g.geometry,f.geometry,B.hitch(this,function(t){"polyline"===t.type&&t.paths&&0===t.paths.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):"polygon"===t.type&&t.rings&&
0===t.rings.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):(c.push(new h(g.toJson())),d.push(g.setGeometry(t)),m.push({layer:k,updates:d,preUpdates:c}),this.onApplyEdits(m,B.hitch(this,function(){this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()})))}))}}});q("extend-esri")&&B.setObject("dijit.editing.tools.Reshape",G,a);return G})},"esri/dijit/editing/tools/Editing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../layers/FeatureTemplate ./Edit ./EditingTools ./DropDownToolBase ../../../kernel ../../../lang".split(" "),
function(G,B,A,w,q,h,p,e,l,b){G=G([e],{declaredClass:"esri.dijit.editing.tools.Editing",_enabled:!1,deactivate:function(){this._enabled&&(this._enabled=!1,this.inherited(arguments),this._settings.templatePicker.clearSelection())},onItemClicked:function(a,f){this.inherited(arguments);this._activeTool===this._tools.AUTOCOMPLETE&&(this._settings.editor._drawingTool=q.TOOL_AUTO_COMPLETE_POLYGON)},_activateTool:function(a,f){var n;this.enable(f);for(n in this._tools)this._tools.hasOwnProperty(n)&&(this.dropDown.removeChild(this._tools[n]),
!0===this._tools[n]._enabled&&this.dropDown.addChild(this._tools[n]));if(this._geometryType!==f||!1===this._activeTool._enabled)this._activeTool=this._tools[a.toUpperCase()];this._geometryType=f;this._activeTool.activate();this._activeTool.setChecked(!0);this._updateUI()},_initializeTool:function(a){this.inherited(arguments);this._initializeTools()},_initializeTools:function(){var a=this._settings.layers,f=this._settings.editor,n=!1,m=!1,d=!1,c=this._toolTypes=[],g;A.forEach(a,function(k){g=k.geometryType;
n=n||"esriGeometryPoint"===g;m=m||"esriGeometryPolyline"===g;d=d||"esriGeometryPolygon"===g;c=c.concat(A.map(this._getTemplatesFromLayer(k),B.hitch(this,function(t){return f._toDrawTool(t.drawingTool,k)})))},this);a=this._settings.createOptions;n&&this._toolTypes.push("point");m&&(this._toolTypes=this._toolTypes.concat(a.polylineDrawTools));d&&(this._toolTypes=this._toolTypes.concat(a.polygonDrawTools));this._toolTypes=this._toUnique(this._toolTypes.concat(c))},_toUnique:function(a){var f={};return A.filter(a,
function(n){return f[n]?!1:f[n]=!0})},_getTemplatesFromLayer:function(a){var f=a.templates||[];A.forEach(a.types,function(n){f=f.concat(n.templates)});return A.filter(f,b.isDefined)},_createTools:function(){A.forEach(this._toolTypes,this._createTool,this);this.inherited(arguments)},_createTool:function(a){var f=B.mixin(p[a],{settings:this._settings,onClick:B.hitch(this,"onItemClicked",p[a].id)});this._tools[a.toUpperCase()]=new h(f)}});w("extend-esri")&&B.setObject("dijit.editing.tools.Editing",G,
l);return G})},"esri/dijit/editing/tools/Edit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","./MenuItemBase","../../../kernel"],function(G,B,A,w,q){G=G([w],{declaredClass:"esri.dijit.editing.tools.Edit",enable:function(h){this._enabled=h===this._geomType;this.inherited(arguments)}});A("extend-esri")&&B.setObject("dijit.editing.tools.Edit",G,q);return G})},"esri/dijit/editing/tools/MenuItemBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/MenuItem ./ToolBase ../../../kernel".split(" "),
function(G,B,A,w,q,h){G=G([w,q],{declaredClass:"esri.dijit.editing.tools.MenuItemBase",destroy:function(){w.prototype.destroy.apply(this,arguments);q.prototype.destroy.apply(this,arguments)}});A("extend-esri")&&B.setObject("dijit.editing.tools.MenuItemBase",G,h);return G})},"esri/dijit/editing/tools/EditingTools":function(){define(["dojo/_base/lang","dojo/has","../../../toolbars/draw","../../../kernel"],function(G,B,A,w){A={point:{id:"esriPointTool",_enabledIcon:"toolbarIcon pointIcon",_disabledIcon:"toolbarIcon pointIconDisabled",
_drawType:A.POINT,_geomType:"esriGeometryPoint",_label:"NLS_pointLbl"},polyline:{id:"toolDrawFreehandPolyline",_enabledIcon:"toolbarIcon polylineIcon",_disabledIcon:"toolbarIcon polylineIconDisabled",_drawType:A.POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_polylineLbl"},freehandpolyline:{id:"toolDrawPolyline",_enabledIcon:"toolbarIcon freehandPolylineIcon",_disabledIcon:"toolbarIcon freehandPolylineIcon",_drawType:A.FREEHAND_POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_freehandPolylineLbl"},
polygon:{id:"toolDrawPolygon",_enabledIcon:"toolbarIcon polygonIcon",_disabledIcon:"toolbarIcon polygonIconDisabled",_drawType:A.POLYGON,_geomType:"esriGeometryPolygon",_label:"NLS_polygonLbl"},freehandpolygon:{id:"toolDrawFreehandPolygon",_enabledIcon:"toolbarIcon freehandPolygonIcon",_disabledIcon:"toolbarIcon freehandPolygonIconDisabled",_drawType:A.FREEHAND_POLYGON,_label:"NLS_freehandPolygonLbl",_geomType:"esriGeometryPolygon"},autocomplete:{id:"btnFeatureAutoComplete",_enabledIcon:"toolbarIcon autoCompleteIcon",
_disabledIcon:"toolbarIcon autoCompleteIcon",_drawType:A.POLYGON,_label:"NLS_autoCompleteLbl",_geomType:"esriGeometryPolygon"},rectangle:{id:"toolDrawRect",_enabledIcon:"toolbarIcon rectangleIcon",_disabledIcon:"toolbarIcon rectangleIcon",_drawType:A.RECTANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_rectangleLbl"},arrow:{id:"toolDrawArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:A.ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLbl"},uparrow:{id:"toolDrawArrowUp",
_enabledIcon:"toolbarIcon arrowUpIcon",_disabledIcon:"toolbarIcon arrowUpIcon",_drawType:A.UP_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowUpLbl"},downarrow:{id:"toolDrawDownArrow",_enabledIcon:"toolbarIcon arrowDownIcon",_disabledIcon:"toolbarIcon arrowDownIcon",_drawType:A.DOWN_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowDownLbl"},leftarrow:{id:"toolDrawLeftArrow",_enabledIcon:"toolbarIcon arrowLeftIcon",_disabledIcon:"toolbarIcon arrowLeftIcon",_drawType:A.LEFT_ARROW,_geomType:"esriGeometryPolygon",
_label:"NLS_arrowLeftLbl"},rightarrow:{id:"toolDrawRightArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:A.RIGHT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowRightLbl"},circle:{id:"toolDrawCircle",_enabledIcon:"toolbarIcon circleIcon",_disabledIcon:"toolbarIcon circleIcon",_drawType:A.CIRCLE,_geomType:"esriGeometryPolygon",_label:"NLS_circleLbl"},ellipse:{id:"toolDrawEllipse",_enabledIcon:"toolbarIcon ellipseIcon",_disabledIcon:"toolbarIcon ellipseIcon",
_drawType:A.ELLIPSE,_geomType:"esriGeometryPolygon",_label:"NLS_ellipseLbl"},triangle:{id:"toolDrawTriangle",_enabledIcon:"toolbarIcon triangleIcon",_disabledIcon:"toolbarIcon triangleIcon",_drawType:A.TRIANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_triangleLbl"},attributes:{id:"btnAttributes",_enabledIcon:"toolbarIcon attributesIcon",_disabledIcon:"toolbarIcon attributesIcon",_enabled:!1,_label:"NLS_attributesLbl"},del:{id:"btnDelete2",_enabledIcon:"toolbarIcon deleteFeatureIcon",_disabledIcon:"toolbarIcon deleteFeatureIcon",
_enabled:!1,_label:"NLS_deleteLbl"},undo:{id:"btnUndo",_enabledIcon:"dijitEditorIcon dijitEditorIconUndo",_disabledIcon:"dijitEditorIcon dijitEditorIconUndo",_enabled:!1,_label:"NLS_undoLbl"},redo:{id:"btnRedo",_enabledIcon:"dijitEditorIcon dijitEditorIconRedo",_disabledIcon:"dijitEditorIcon dijitEditorIconRedo",_enabled:!1,_label:"NLS_redoLbl"}};B("extend-esri")&&G.setObject("dijit.editing.tools.EditingTools",A,w);return A})},"esri/dijit/editing/tools/DropDownToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-style dijit/registry dijit/Menu dijit/form/ComboButton ./ToolBase ../../../kernel ../../../lang".split(" "),
function(G,B,A,w,q,h,p,e,l,b){G=G([p,e],{declaredClass:"esri.dijit.editing.tools.DropDownToolBase",_enabled:!1,_checked:!1,postCreate:function(){this._tools=[];this._createTools();this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){var a,f=this._tools;for(a in f)f.hasOwnProperty(a)&&b.isDefined(f[a])&&f[a].destroy();this.inherited(arguments)},_createTools:function(){var a,f=new h;this.dropDown=f;for(a in this._tools)this._tools.hasOwnProperty(a)&&f.addChild(this._tools[a]);
this._activeTool=f.getChildren()[0];this._updateUI()},activate:function(a){this.inherited(arguments);this._activeTool?this._activeTool.activate():this._activateDefaultTool()},deactivate:function(){this.inherited(arguments);this._activeTool&&this._activeTool.deactivate()},enable:function(a){for(var f in this._tools)this._tools.hasOwnProperty(f)&&this._tools[f].enable(a);this.setEnabled(!0);this.inherited(arguments)},setChecked:function(a){this._checked=a;this._updateUI()},_onDrawEnd:function(a){},
onLayerChange:function(a,f,n){this._activeTool=null;this._activeType=f;this._activeTemplate=n;this._activeLayer=a},onItemClicked:function(a,f){this._activeTool&&this._activeTool.deactivate();this._activeTool=q.byId(a);!1===this._checked?this._onClick():(this._updateUI(),this._activeTool&&(this._activeTool.activate(),this._activeTool.setChecked(!0)))},_onClick:function(a){!1!==this._enabled&&(this._checked=!this._checked,this.inherited(arguments))},_updateUI:function(){this.attr("disabled",!this._enabled);
w.set(this.focusNode,{outline:"none"});w.set(this.titleNode,{padding:"0px",border:"none"});this._checked?w.set(this.titleNode,{backgroundColor:"#D4DFF2",border:"1px solid #316AC5"}):w.set(this.titleNode,{backgroundColor:"",border:""});this._activeTool&&(this.attr("iconClass",this._checked?this._activeTool._enabledIcon:this._activeTool._disabledIcon),this.attr("label",this._activeTool.label))}});A("extend-esri")&&B.setObject("dijit.editing.tools.DropDownToolBase",G,l);return G})},"dijit/form/ComboButton":function(){define("dojo/_base/declare dojo/keys ../focus ./DropDownButton dojo/text!./templates/ComboButton.html ../a11yclick".split(" "),
function(G,B,A,w,q){return G("dijit.form.ComboButton",w,{templateString:q,_setIdAttr:"",_setTabIndexAttr:["focusNode","titleNode"],_setTitleAttr:"titleNode",optionsTitle:"",baseClass:"dijitComboButton",cssStateNodes:{buttonNode:"dijitButtonNode",titleNode:"dijitButtonContents",_popupStateNode:"dijitDownArrowButton"},_focusedNode:null,_onButtonKeyDown:function(h){h.keyCode==B[this.isLeftToRight()?"RIGHT_ARROW":"LEFT_ARROW"]&&(A.focus(this._popupStateNode),h.stopPropagation(),h.preventDefault())},_onArrowKeyDown:function(h){h.keyCode==
B[this.isLeftToRight()?"LEFT_ARROW":"RIGHT_ARROW"]&&(A.focus(this.titleNode),h.stopPropagation(),h.preventDefault())},focus:function(h){this.disabled||A.focus("start"==h?this.titleNode:this._popupStateNode)}})})},"esri/dijit/editing/tools/Selection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/SimpleFillSymbol ./Edit ./SelectionTools ./DropDownToolBase ../../../kernel".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n){G=G([f],{declaredClass:"esri.dijit.editing.tools.Selection",_enabled:!0,activate:function(){this.inherited(arguments);this._sConnect=w.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd")},deactivate:function(){this.inherited(arguments);w.disconnect(this._sConnect);delete this._sConnect},_initializeTool:function(){this._createSymbols();this._initializeLayers();this._toolTypes=["select","selectadd","selectremove"]},_onDrawEnd:function(m){this.inherited(arguments);
this._settings.editor._hideAttributeInspector();var d=this._settings.layers;this._selectMethod=this._activeTool._selectMethod;this._settings.editor._selectionHelper.selectFeaturesByGeometry(d,m,this._selectMethod,B.hitch(this,"onFinished"))},_createSymbols:function(){this._pointSelectionSymbol=new p(p.STYLE_CIRCLE,10,new e(e.STYLE_SOLID,new q([0,0,0]),1),new q([255,0,0,.5]));this._polylineSelectionSymbol=new e(e.STYLE_SOLID,new q([0,200,255]),2);this._polygonSelectionSymbol=new l(l.STYLE_SOLID,new e(e.STYLE_SOLID,
new q([0,0,0]),1),new q([0,200,255,.5]))},_initializeLayers:function(){A.forEach(this._settings.layers,this._setSelectionSymbol,this)},_setSelectionSymbol:function(m){var d=null;switch(m.geometryType){case "esriGeometryPoint":d=this._pointSelectionSymbol;break;case "esriGeometryPolyline":d=this._polylineSelectionSymbol;break;case "esriGeometryPolygon":d=this._polygonSelectionSymbol}m.setSelectionSymbol(m._selectionSymbol||d)},_createTools:function(){A.forEach(this._toolTypes,this._createTool,this);
this.inherited(arguments)},_createTool:function(m){var d=B.mixin(a[m],{settings:this._settings,onClick:B.hitch(this,"onItemClicked",a[m].id)});this._tools[m.toUpperCase()]=new b(d)}});h("extend-esri")&&B.setObject("dijit.editing.tools.Selection",G,n);return G})},"esri/dijit/editing/tools/SelectionTools":function(){define(["dojo/_base/lang","dojo/has","../../../layers/FeatureLayer","../../../toolbars/draw","../../../kernel"],function(G,B,A,w,q){A={select:{id:"btnNewSelection",_enabledIcon:"toolbarIcon newSelectionIcon",
_disabledIcon:"toolbarIcon newSelectionIcon",_drawType:w.EXTENT,_selectMethod:A.SELECTION_NEW,_label:"NLS_selectionNewLbl"},selectadd:{id:"btnAddToSelection",_enabledIcon:"toolbarIcon addToSelectionIcon",_disabledIcon:"toolbarIcon addToSelectionIcon",_drawType:w.EXTENT,_selectMethod:A.SELECTION_ADD,_label:"NLS_selectionAddLbl"},selectremove:{id:"btnSubtractFromSelection",_enabledIcon:"toolbarIcon removeFromSelectionIcon",_disabledIcon:"toolbarIcon removeFromSelectionIcon",_drawType:w.EXTENT,_selectMethod:A.SELECTION_SUBTRACT,
_label:"NLS_selectionRemoveLbl"},selectClear:{id:"btnClearSelection",_enabledIcon:"toolbarIcon clearSelectionIcon",_disabledIcon:"toolbarIcon clearSelectionIcon",_enabled:!1,_label:"NLS_selectionClearLbl"}};B("extend-esri")&&G.setObject("dijit.editing.tools.SelectionTools",A,q);return A})},"esri/dijit/editing/SelectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dojo/DeferredList ../../geometry/Extent ../../geometry/Point ../../geometry/ScreenPoint ../../layers/FeatureLayer ../../tasks/query ../../kernel".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f){G=G(null,{declaredClass:"esri.dijit.editing.SelectionHelper",constructor:function(n){this._settings=n||{};this._sConnects=[];this._mapServiceCount=0;this._map=this._settings.map;this._tolerance=this._settings.singleSelectionTolerance;this._initMapServiceInfos(this._settings.layers)},destroy:function(){for(var n in this._sConnects)this._sConnects.hasOwnProperty(n)&&A.disconnect(this._sConnects[n])},selectFeatures:function(n,m,d,c){d===b.SELECTION_NEW&&(this._resetMapServiceInfos(),
this.getSelection(n));var g=[];w.forEach(n,function(k){if(!0===k.visible&&!0===k._isMapAtVisibleScale()){var t=d;k._isSelOnly&&t===b.SELECTION_NEW&&(t=b.SELECTION_ADD);g.push(k.selectFeatures(m,t))}});(new h(g)).addCallback(B.hitch(this,function(k){var t=[];w.forEach(k,function(y,K){w.forEach(y[1],function(C){(C=n[K]._mode._getFeature(C.attributes[n[K].objectIdField])||null)&&t.push(C)},this)},this);this._mapServiceCount?((k=d===b.SELECTION_SUBTRACT)?(this._resetMapServiceInfos(),this._createLayerDefs(this._getLayerInfosFromSelection(n))):
this._createLayerDefs(this._getLayerInfosFromFeatures(t)),this._updateLayerDefs(this._mapServiceInfos,!1,!(t&&t.length||k),B.hitch(this,c,t))):c(t)}))},selectFeaturesByGeometry:function(n,m,d,c){var g=m;-1!==m.declaredClass.indexOf("Extent")&&m.xmax===m.xmin&&m.ymax===m.ymin&&(g=new e(m.xmax,m.ymax,m.spatialReference));g=-1!==g.declaredClass.indexOf("Point")?this._extentFromPoint(g):g;m=new a;m.geometry=g;this.selectFeatures(n,m,d,c)},clearSelection:function(n){w.forEach(this._nonSelOnlyLayers,function(d){d.clearSelection&&
d.clearSelection()});if(this._mapServiceCount){this._resetMapServiceInfos();var m=this._getLayerInfosFromSelection(this._settings.layers);w.some(m,function(d){return d.oids&&d.oids.length})&&(this._createLayerDefs(m),this._updateLayerDefs(this._mapServiceInfos,!0,n||!1))}},findMapService:function(n){var m=this._map,d=m.layerIds;n=n&&n._url&&n._url.path?n._url.path.toLowerCase():"";var c;for(c in d)if(d.hasOwnProperty(c)){var g=m.getLayer(d[c]);var k=g._url?g._url.path?g._url.path.toLowerCase().replace("mapserver",
"featureserver"):g._url.toLowerCase().replace("mapserver","featureserver"):"";if(n.substr(0,k.length)===k&&"esri.layers.ArcGISDynamicMapServiceLayer"===g.declaredClass)return g}},getSelection:function(n){var m=[];w.forEach(n,function(d){d._isSelOnly&&m.push(this._createLayerInfo(d))},this);w.forEach(m,function(d){var c=this._createMapServiceInfo(this.findMapService(d.layer));c&&(c.layerInfos[d.layer.layerId]=d)},this)},_initMapServiceInfos:function(n){this._nonSelOnlyLayers=[];this._mapServiceInfos=
[];w.forEach(n,function(m){var d=this.findMapService(m);d?(this._mapServiceCount++,this._createMapServiceInfo(d),d&&d.setDisableClientCaching(!0)):this._nonSelOnlyLayers.push(m)},this)},_createMapServiceInfo:function(n){if(!n)return null;var m=this._mapServiceInfos,d=m[n.id];d||(d=m[n.id]={mapService:n,layerInfos:[],layerDefs:B.mixin([],n.layerDefinitions||[]),origLayerDefs:B.mixin([],n.layerDefinitions||[])});return d},_resetMapServiceInfo:function(n){w.forEach(n.layerInfos,this._resetLayerInfo);
n.layerDefs=B.mixin([],n.origLayerDefs||[])},_resetMapServiceInfos:function(){var n=this._mapServiceInfos,m;for(m in n)n.hasOwnProperty(m)&&this._resetMapServiceInfo(n[m])},_createLayerInfo:function(n,m){var d=n.objectIdField;m=m?[]:n.getSelectedFeatures();return{layer:n,selectedFeatures:m||[],oids:w.map(m,function(c){return c.attributes[d]})}},_resetLayerInfo:function(n){n&&(n.selectedFeatures=[],n.oids=[])},_updateLayerDefs:function(n,m,d,c){for(var g in n)if(n.hasOwnProperty(g)){var k=n[g],t=k.mapService,
y=k.layerDefs=m?B.mixin([],k.origLayerDefs||[]):k.layerDefs;y?(d?c&&c():this._sConnects[t.id]=A.connect(t,"onUpdateEnd",B.hitch(this,"_onMapServiceUpdate",k,m,c)),t.setLayerDefinitions(y,d||!1)):c&&c()}},_onMapServiceUpdate:function(n,m,d){A.disconnect(this._sConnects[n.mapService.id]);w.forEach(n.layerInfos,function(c){if(m)c&&c.layer.clearSelection();else{var g=new a;g.objectIds=c?c.oids:[];g.objectIds.length&&c.layer.selectFeatures(g,b.SELECTION_SUBTRACT)}},this);m&&this._resetMapServiceInfo(n);
d&&d()},_createLayerDefs:function(n){w.forEach(n,function(m){var d=m.layer,c=this._createMapServiceInfo(this.findMapService(m.layer));if(c){c=c.layerDefs;var g=d.layerId,k='("'+d.objectIdField+'" NOT IN (',t=m.oids;t&&t.length&&(w.forEach(m.oids,function(y,K){t=!0;K&&(k+=",");k+="'"+y+"'"}),k+="))",c[g]=c.length&&c[g]&&c[g].length?c[g]+(" AND"+k):k)}},this)},_getLayerInfosFromFeatures:function(n){var m=[];w.forEach(n,function(c){var g=c.getLayer();g&&g._isSelOnly&&(m[g.id]||(m[g.id]=this._createLayerInfo(g,
!0)),m[g.id].selectedFeatures.push(c),m[g.id].oids.push(c.attributes[g.objectIdField]))},this);n=[];for(var d in m)m.hasOwnProperty(d)&&n.push(m[d]);return n},_getLayerInfosFromSelection:function(n){var m=[];w.forEach(n,function(d){d._isSelOnly&&m.push(this._createLayerInfo(d,!1))},this);return m},_extentFromPoint:function(n){var m=this._tolerance,d=this._map,c=d.toScreen(n);n=new l(c.x-m,c.y+m);m=new l(c.x+m,c.y-m);n=d.toMap(n);m=d.toMap(m);return new p(n.x,n.y,m.x,m.y,d.spatialReference)}});q("extend-esri")&&
B.setObject("dijit.editing.SelectionHelper",G,f);return G})},"esri/dijit/editing/TemplatePicker":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/_base/array dojo/_base/json dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/_Widget dijit/_Templated dojo/data/ItemFileReadStore dojox/grid/DataGrid dojox/gfx ../../layers/FeatureLayer ../../symbols/SimpleMarkerSymbol ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ./TemplatePickerItem ../../kernel ../../lang ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi dojo/text!./templates/TemplatePicker.html".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k,t,y,K,C,r,E,F,u,D,z,M,H,x){var J=G([M,d,c],{declaredClass:"esri.dijit.editing.TemplatePicker",widgetsInTemplate:!0,templateString:x,featureLayers:null,items:null,grouping:!0,showTooltip:!1,maxLabelLength:0,rows:4,_rows:0,columns:3,surfaceWidth:30,surfaceHeight:30,emptyMessage:"",useLegend:!0,legendCache:{},_uniqueId:{id:0},_assumedCellWidth:90,_initialAutoWidth:300,_initialAutoHeight:200,_ieTimer:150,constructor:function(L,N){L=L||{};L.items||L.featureLayers||
console.error("TemplatePicker: please provide 'featureLayers' or 'items' parameter in the constructor");this._dojo14x=4<=p.version.minor;this._itemWidgets={};L.featureLayers&&L.featureLayers.length&&(this._flChanged=1);this._nls=H.widgets.templatePicker;this.emptyMessage=L.emptyMessage||this._nls&&this._nls.creationDisabled||""},postMixInProperties:function(){this.inherited(arguments);this._preprocess()},startup:function(){this.inherited(arguments);if("auto"===this.rows&&"auto"===this.columns){var L=
n.getContentBox(this.domNode);L.w||(this.domNode.style.width=this._initialAutoWidth+"px");if(!L.h||1>=L.h)this.domNode.style.height=this._initialAutoHeight+"px";L=n.getContentBox(this.domNode);this._columns=Math.floor(L.w/this._assumedCellWidth)||1}this._applyGridPatches();this._setGridLayout();A.connect(this.grid,"onRowClick",this,this._rowClicked);this._setGridData();this._toggleTooltip();9>e("ie")&&(this._repaintItems=B.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},
destroy:function(){this.showTooltip=!1;this._toggleTooltip();this._clearLegendInfo();this.featureLayers=this.items=this.grid=this._flItems=this._itItems=this._groupRowIndices=this._selectedCell=this._selectedInfo=this._selectedItem=null;this.inherited(arguments)},getSelected:function(){return this._selectedCell?this._selectedItem:null},clearSelection:function(){var L=this._selectedCell,N=this._selectedInfo;L&&this._rowClicked({cellNode:L,rowIndex:N.selRow,cellIndex:N.selCol})},update:function(L){L=
"auto"===this.rows&&"auto"===this.columns&&L?!0:!1;var N=this.grid;if(L){var P=this.domNode;var T=p.query("#"+P.id+".templatePicker div.item")[0];P=n.getContentBox(P);T=(T=T&&T.parentNode)?w.coords(T).w:this._assumedCellWidth;this._columns=(this._columns=Math.floor((P.w-N.views.views[0].getScrollbarWidth())/T))||1}T=this._rows;this._preprocess();var S=this._rows;this._setGridLayout();this._setGridData();S!==T&&N.set("autoHeight",this._rows,!1);L?(N._resize({w:P.w,h:P.h}),N.viewsHeaderNode.style.display=
"none"):N.update();this._toggleTooltip();var Z=this,da=this.getSelected();da&&N.store.fetch({onComplete:function(Q){var W=(Q=Z._locate(da,Z._selectedInfo,Q))&&N.views.views[0].getCellNode(Q[0],Q[1]);W&&Z._rowClicked({cellNode:W,rowIndex:Q[0],cellIndex:Q[1]},!0)}});9>e("ie")&&setTimeout(this._repaintItems,this._ieTimer);L=this.featureLayers;P=this.items;L&&L.length||P&&P.length||!N||!this.emptyMessage||N.showMessage(this.emptyMessage)},_eventMap:{"selection-change":!0},onSelectionChange:function(){},
_setUseLegendAttr:function(L){var N=this.useLegend;this._started&&N===L||(L?this._flChanged=1:this._clearLegendInfo());this.useLegend=L},_setFeatureLayersAttr:function(L){var N=this.featureLayers;this._started&&N===L||(this._flChanged=1);this.featureLayers=L},_adjustRowsCols:function(L){if("auto"===this.rows&&"auto"===this.columns)this._started||(this._rows=!1,this._columns=null,this._autoWidth=!1);else{var N=0;this._rows=this.rows;this._columns=this.columns;"auto"===this.rows?(this.featureLayers?
this.grouping?(N=L.length,q.forEach(L,function(P){N+=Math.ceil(P.length/this.columns)},this)):(q.forEach(L,function(P){N+=P.length},this),N=Math.ceil(N/this.columns)):N=Math.ceil(L.length/this.columns),this._rows=N):"auto"===this.columns&&(this.featureLayers?this.grouping?N=3:(q.forEach(L,function(P){N+=P.length},this),N=Math.ceil(N/this.rows)):N=Math.ceil(L.length/this.rows),this._columns=N)}},_preprocess:function(){this.items&&(this.grouping=!1);this._autoWidth=!1;if("auto"===this.rows||"auto"===
this.columns)this._autoWidth=!0;if(this.featureLayers)if(this.useLegend&&this._flChanged&&(this._legendIndices=[],this._loadingIndices=[],this._legendSymbols={},this._ignoreLegends(),this._loadingLegends=[],clearTimeout(this._legendTimer),this._legendTimer=null,this._processSelectionLayers(),this._flChanged=0),q.every(this.featureLayers,function(P){return P.loaded})){this.featureLayers=q.filter(this.featureLayers,function(P){return!(P.hasZ&&!P.enableZDefaults)});var L=this._flItems=this._getItemsFromLayers(this.featureLayers);
this._adjustRowsCols(L)}else{var N=this.featureLayers.length;q.forEach(this.featureLayers,function(P){if(P.loaded)N--;else var T=A.connect(P,"onLoad",this,function(){A.disconnect(T);T=null;N--;N||this.update()})},this)}else L=this._itItems=this._getItemsFromItems(this.items),this._adjustRowsCols(L)},_processSelectionLayers:function(){var L,N,P,T,S,Z,da,Q={};q.forEach(this.featureLayers,function(W,aa){W.mode===y.MODE_SELECTION&&W._map&&W.url&&W._params.drawMode&&!W.source&&(N=B.trim(W._url.path).replace(/\/(MapServer|FeatureServer).*/ig,
"/MapServer").replace(/^https?:\/\//ig,"").toLowerCase(),P=Q[N]=Q[N]||{},T=P.featureLayers=P.featureLayers||{},Z=P.indices=P.indices||[],T[aa]=W,Z.push(aa),L=W._map)});L&&q.forEach(L.layerIds,function(W){(W=L.getLayer(W))&&W.url&&(W.getImageUrl||W.getTileUrl)&&W.loaded&&10.1<=W.version&&(N=B.trim(W._url.path).replace(/(\/MapServer).*/ig,"$1"),S=N.replace(/^https?:\/\//ig,"").toLowerCase(),Q[S]&&!Q[S].mapServiceUrl&&(P=Q[S],P.mapServiceUrl=N,P.mapServiceLayer=W,this._legendIndices=this._legendIndices.concat(P.indices),
da=this._fetchLegend({pickerInstance:this,info:P},S),da.then?(this._loadingIndices=this._loadingIndices.concat(P.indices),this._loadingLegends.push(da)):this._processLegendResponse(da,P)))},this)},_fetchLegend:function(L,N){var P=J.prototype,T=P.legendCache[N];T?T.then&&T._contexts.push(L):(T=P.legendCache[N]=z({url:L.info.mapServiceUrl+"/legend",content:{f:"json"},callbackParamName:"callback"}),T._contexts=[L],T.addBoth(function(S){if(!T.canceled){P.legendCache[N]=S;var Z=T._contexts;T._contexts=
null;q.forEach(Z,function(da){var Q=da.pickerInstance;da=da.info;if(!Q._destroyed){q.forEach(da.indices,function(aa){W=q.indexOf(Q._loadingIndices,aa);-1<W&&Q._loadingIndices.splice(W,1)});var W=q.indexOf(Q._loadingLegends,T);-1<W&&Q._loadingLegends.splice(W,1);Q._processLegendResponse(S,da)}})}}));return T},_clearLegendInfo:function(){clearTimeout(this._legendTimer);this._ignoreLegends();this._legendIndices=this._loadingIndices=this._legendSymbols=this._loadingLegends=this._legendTimer=null},_ignoreLegends:function(){this._loadingLegends&&
q.forEach(this._loadingLegends,function(L){var N=-1;q.some(L._contexts,function(P,T){P.pickerInstance===this&&(N=T);return-1<N},this);-1<N&&L._contexts.splice(N,1)},this)},_processLegendResponse:function(L,N){if(!L||L instanceof Error){var P;q.forEach(N.indices,function(S){P=q.indexOf(this._legendIndices,S);-1<P&&this._legendIndices.splice(P,1)},this)}else q.forEach(N.indices,function(S){var Z=N.featureLayers[S].layerId,da,Q=N.mapServiceUrl+"/"+Z+"/images/",W=N.mapServiceLayer._getToken(),aa,R;if(!this._legendSymbols[S]){var V=
null;q.some(L.layers,function(ha){ha.layerId==Z&&(V=ha);return!!V});if(V){var ba=this._legendSymbols[S]={};q.forEach(V.legend,function(ha){if((aa=ha.values)&&aa.length)for(da=0;da<aa.length;da++)ba[aa[da]]=ha;else ba.defaultSymbol=ha;(R=ha.url)&&!ha._fixed&&(ha._fixed=1,-1===R.search(/https?:/)&&(ha.url=Q+R),W&&-1!==ha.url.search(/https?:/)&&(ha.url+=(-1<ha.url.indexOf("?")?"\x26":"?")+"token\x3d"+W))})}}},this);var T=this;T._started&&!T._legendTimer&&(T._legendTimer=setTimeout(function(){clearTimeout(T._legendTimer);
T._legendTimer=null;T._destroyed||T.update()},0))},_applyGridPatches:function(){var L=this.grid,N=L.adaptWidth,P,T,S;L.adaptWidth=function(){P=this.views.views;for(T=0;S=P[T];T++)m.set(S.headerNode,"display","block");N.apply(this,arguments);for(T=0;S=P[T];T++)m.set(S.headerNode,"display","none")};if(this._dojo14x){if("auto"!==this.rows&&"auto"!==this.columns)var Z=A.connect(L,"_onFetchComplete",this,function(){A.disconnect(Z);this.grid.set("autoHeight",this._rows)});A.connect(L,"_onDelete",this,this._destroyItems);
A.connect(L,"_clearData",this,this._destroyItems);A.connect(L,"destroy",this,this._destroyItems);(L=L.focus)&&L.findAndFocusGridCell&&(L.findAndFocusGridCell=function(){return!1})}},_setGridLayout:function(){var L=function(Z){return function(da,Q){return this._cellGet(Z,da,Q)}},N=B.hitch(this,this._cellFormatter),P=[],T=this._columns,S;for(S=0;S<T;S++)P.push({field:"cell"+S,get:B.hitch(this,L(S)),formatter:N});L={cells:[P]};this.grouping&&(T={field:"groupName",colSpan:T,get:B.hitch(this,this._cellGetGroup),
formatter:B.hitch(this,this._cellGroupFormatter)},L.cells.push([T]));T=this.grid;N=k.prototype.rowsPerPage;T.set("rowsPerPage",this._rows>N?this._rows:N);T.set("structure",L)},_setGridData:function(){var L=[];if(this.grouping){this._groupRowIndices=[];var N,P,T=this._columns;q.forEach(this._flItems,function(Z,da){L.push({});da=0===da?0:N+P+1;this._groupRowIndices.push(da);N=da;P=Math.ceil(Z.length/T);L=L.concat(this._getStoreItems(Z))},this)}else this.featureLayers?(q.forEach(this._flItems,function(Z){L=
L.concat(Z)}),L=this._getStoreItems(L)):L=this._getStoreItems(this._itItems);var S=new g({data:{items:L}});this.grid.setStore(S)},_toggleTooltip:function(){if(this.showTooltip){if(!this.tooltip){this.tooltip=f.create("div",{"class":"esriMapTooltip"},this.domNode);this.tooltip.style.display="none";this.tooltip.style.position="fixed";var L=this.grid;this._mouseOverConnect=A.connect(L,"onCellMouseOver",this,this._cellMouseOver);this._mouseOutConnect=A.connect(L,"onCellMouseOut",this,this._cellMouseOut)}}else this.tooltip&&
(A.disconnect(this._mouseOverConnect),A.disconnect(this._mouseOutConnect),f.destroy(this.tooltip),this.tooltip=null)},_rowClicked:function(L,N){var P=L.cellNode,T=L.rowIndex;L=L.cellIndex;var S=this._getCellInfo(P,T,L);if(S){var Z=this.grid.store;if(!Z.getValue(S,"loadingCell")&&(this._selectedCell&&a.remove(this._selectedCell,"selectedItem"),P!==this._selectedCell?(a.add(P,"selectedItem"),this._selectedCell=P,this._selectedItem={featureLayer:Z.getValue(S,"layer"),type:Z.getValue(S,"type"),template:Z.getValue(S,
"template"),symbolInfo:Z.getValue(S,"symbolInfo"),item:this._getItem(S)},this._selectedInfo={selRow:T,selCol:L,index1:Z.getValue(S,"index1"),index2:Z.getValue(S,"index2"),index:Z.getValue(S,"index")}):this._selectedCell=this._selectedInfo=this._selectedItem=null,!N))this.onSelectionChange()}},_locate:function(L,N,P){var T=this.grid.store,S=Array(this._columns),Z,da=N.index1,Q=N.index2,W=N.index,aa=L.item;q.some(P,function(R,V){return q.some(S,function(ba,ha){return(ba=T.getValue(R,"cell"+ha))&&(aa?
W===T.getValue(ba,"index"):da===T.getValue(ba,"index1")&&Q===T.getValue(ba,"index2"))?(Z=[V,ha],!0):!1})});return Z},_getCellInfo:function(L,N,P){if(L)return L=this.grid,N=L.getItem(N),L.store.getValue(N,"cell"+P)},_getItem:function(L){var N=this.items;if(N)return N[this.grid.store.getValue(L,"index")]},_cellMouseOver:function(L){var N=this.tooltip,P=L.cellNode,T=this._getCellInfo(P,L.rowIndex,L.cellIndex);if(N&&T){var S=this.grid.store;L=S.getValue(T,"template");var Z=S.getValue(T,"type"),da=S.getValue(T,
"symbolInfo");S=S.getValue(T,"layer");L=(T=this._getItem(T))&&T.label+(T.description?": "+T.description:"")||L&&L.name+(L.description?": "+L.description:"")||Z&&Z.name||da&&da.label+(da.description?": "+da.description:"")||(S&&S.name+": ")+"Default";N.style.display="none";N.innerHTML=L;P=w.coords(P.firstChild);m.set(N,{left:P.x+"px",top:P.y+P.h+5+"px"});N.style.display=""}},_cellMouseOut:function(){var L=this.tooltip;L&&(L.style.display="none")},_destroyItems:function(){var L=this._itemWidgets,N;
for(N in L)L[N]&&(L[N].destroy(),delete L[N])},_repaintItems:function(){var L=this._itemWidgets,N;for(N in L){var P=L[N];P&&P._repaint(P._surface)}},_getStoreItems:function(L){var N=this._uniqueId;L=q.map(L,function(R){return B.mixin({surfaceId:"tpick-surface-"+N.id++},R)});for(var P=L.length,T=0,S={},Z=0,da,Q=[],W=!0,aa=this._columns;T<P;)W=!0,da="cell"+Z,S[da]=L[T],T++,Z++,0===Z%aa&&(W=!1,Q.push(S),S={},Z=0);W&&P&&Q.push(S);return Q},_getItemsFromLayers:function(L){var N=[];q.forEach(L,function(P,
T){N.push(this._getItemsFromLayer(P,T))},this);return N},_getItemsFromLayer:function(L,N){var P=[];if(this.useLegend&&-1<q.indexOf(this._loadingIndices,N))return[{label:this._nls&&this._nls.loading||"",symbol:null,layer:L,type:null,template:null,index1:N,index2:0,loadingCell:1}];var T=[];T=T.concat(L.templates);q.forEach(L.types,function(Q){var W=Q.templates;q.forEach(W,function(aa){aa._type_=Q});T=T.concat(W)});T=q.filter(T,D.isDefined);var S=L.renderer;if(S){var Z=S.declaredClass.replace("esri.renderer.",
"");if(0<T.length)q.forEach(T,function(Q){var W=Q.prototype;if(W){var aa;if(aa=this._isUnclassedRenderer(S)?S.infos[0].symbol:S.valueExpression?this._createSimpleSymbol(L):S.getSymbol(W)||this._createSimpleSymbol(L)){var R=null,V;if(!(9>b("ie"))&&Q.thumbnail&&Q.thumbnail.imageData)R=new C(Q.thumbnail);else if(this.useLegend&&-1<q.indexOf(this._legendIndices,N)){if(V=this._legendSymbols&&this._legendSymbols[N])switch(Z){case "SimpleRenderer":R=V.defaultSymbol;break;case "UniqueValueRenderer":q.some(S.infos,
function(ba){ba.symbol===aa&&(R=V[ba.value]);return!!R});break;case "ClassBreaksRenderer":q.some(S.infos,function(ba){ba.symbol===aa&&(R=V[ba.maxValue]);return!!R})}R&&(W=h.fromJson(h.toJson(C.defaultProps)),W.url=R.url,W.imageData=R.imageData,W.contentType=R.contentType,W.width=R.width,W.height=R.height,D.isDefined(W.width)&&D.isDefined(W.height)||(W.width=15,W.height=15),R=new C(W))}P.push({label:this._trimLabel(Q.name),symbol:R||aa,legendOverride:!!R,layer:L,type:Q._type_,template:Q,index1:N,index2:P.length})}else switch(Z){case "HeatmapRenderer":P.push({label:this._trimLabel(Q.name),
symbol:new K,legendOverride:!!R,layer:L,type:Q._type_,template:Q,index1:N,index2:P.length})}}delete Q._type_},this);else{var da=[];"TemporalRenderer"===Z&&(S=S.observationRenderer)&&(Z=S.declaredClass.replace("esri.renderer.",""));switch(Z){case "SimpleRenderer":da=[{symbol:S.symbol,label:S.label,description:S.description}];break;case "UniqueValueRenderer":case "ClassBreaksRenderer":da=S.infos}P=q.map(da,function(Q,W){return{label:this._trimLabel(Q.label),description:Q.description,symbolInfo:B.mixin({constructor:function(){}},
Q),symbol:Q.symbol,layer:L,index1:N,index2:W}},this)}}return P},_isUnclassedRenderer:function(L){return!!((L.hasVisualVariables("sizeInfo",!1)||L.hasVisualVariables("colorInfo",!1)||L.hasVisualVariables("opacityInfo",!1))&&L.addBreak&&L.infos&&1===L.infos.length)},_createSimpleSymbol:function(L){switch(L.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":var N=new K;break;case "esriGeometryPolyline":N=new E;break;case "esriGeometryPolygon":N=new r;break;default:L.hasXYFootprint&&
L.hasXYFootprint()&&(N=new r)}return N},_getItemsFromItems:function(L){return q.map(L,function(N,P){N=B.mixin({index:P},N);N.label=this._trimLabel(N.label);return N},this)},_trimLabel:function(L){var N=this.maxLabelLength;N&&L&&L.length>N&&(L=L.substr(0,N)+"...");return L||""},_cellGet:function(L,N,P){return P?this.grid.store.getValue(P,"cell"+L):""},_cellFormatter:function(L){if(L){var N=this._itemWidgets,P=this.grid.store,T=P.getValue(L,"surfaceId"),S=N[T];S||(S=N[T]=new F({id:T,label:P.getValue(L,
"label"),symbol:P.getValue(L,"symbol"),legendOverride:P.getValue(L,"legendOverride"),surfaceWidth:this.surfaceWidth,surfaceHeight:this.surfaceHeight,template:P.getValue(L,"template")}));return S||""}return""},_cellGetGroup:function(L,N){if(!this._groupRowIndices)return"";L=q.indexOf(this._groupRowIndices,L);return N&&-1!==L?(N=this.featureLayers[L])&&(this.groupLabelFunction?this.groupLabelFunction(N):N.name)||"":""},_cellGroupFormatter:function(L){return L?"\x3cdiv class\x3d'groupLabel'\x3e"+L+"\x3c/div\x3e":
""}});e("extend-esri")&&B.setObject("dijit.editing.TemplatePicker",J,u);return J})},"dojox/grid/DataGrid":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/json dojo/_base/sniff dojo/_base/declare ./_Grid ./DataSelection dojo/_base/html dojo/has dojo/has!dojo-bidi?./bidi/_BidiMixin".split(" "),function(G,B,A,w,q,h,p,e,l){var b=h("dojox.grid.DataGrid",p,{store:null,query:null,queryOptions:null,fetchText:"...",sortFields:null,updateDelay:1,items:null,_store_connects:null,_by_idty:null,
_by_idx:null,_cache:null,_pages:null,_pending_requests:null,_bop:-1,_eop:-1,_requests:0,rowCount:0,_isLoaded:!1,_isLoading:!1,keepSelection:!1,postCreate:function(){this._pages=[];this._store_connects=[];this._by_idty={};this._by_idx=[];this._cache=[];this._pending_requests={};this._setStore(this.store);this.inherited(arguments)},destroy:function(){this.selection.destroy();this.inherited(arguments)},createSelection:function(){this.selection=new e(this)},get:function(a,f){if(f&&"_item"==this.field&&
!this.fields)return f;if(f&&this.fields){var n=[],m=this.grid.store;B.forEach(this.fields,function(d){n=n.concat(m.getValues(f,d))});return n}return f||"string"!==typeof a?f?this.field?"_item"==this.field?f:this.grid.store.getValue(f,this.field):this.value:this.defaultValue:this.inherited(arguments)},_checkUpdateStatus:function(){if(0<this.updateDelay){var a=!1;this._endUpdateDelay&&(clearTimeout(this._endUpdateDelay),delete this._endUpdateDelay,a=!0);this.updating||(this.beginUpdate(),a=!0);if(a){var f=
this;this._endUpdateDelay=setTimeout(function(){delete f._endUpdateDelay;f.endUpdate()},this.updateDelay)}}},_onSet:function(a,f,n,m){this._checkUpdateStatus();a=this.getItemIndex(a);-1<a&&this.updateRow(a)},_createItem:function(a,f){f=this._hasIdentity?this.store.getIdentity(a):w.toJson(this.query)+":idx:"+f+":sort:"+w.toJson(this.getSortProps());return this._by_idty[f]={idty:f,item:a}},_addItem:function(a,f,n){this._by_idx[f]=this._createItem(a,f);n||this.updateRow(f)},_onNew:function(a,f){this._checkUpdateStatus();
f=this.get("rowCount");this._addingItem=!0;this.updateRowCount(f+1);this._addingItem=!1;this._addItem(a,f);this.showMessage()},_onDelete:function(a){this._checkUpdateStatus();a=this._getItemIndex(a,!0);if(0<=a){this._pages=[];this._eop=this._bop=-1;var f=this._by_idx[a];this._by_idx.splice(a,1);delete this._by_idty[f.idty];this.updateRowCount(this.get("rowCount")-1);0===this.get("rowCount")&&this.showMessage(this.noDataMessage)}this.selection.isSelected(a)&&(this.selection.deselect(a),this.selection.selected.splice(a,
1))},_onRevert:function(){this._refresh()},setStore:function(a,f,n){this._requestsPending(0)||(this._setQuery(f,n),this._setStore(a),this._refresh(!0))},setQuery:function(a,f){this._requestsPending(0)||(this._setQuery(a,f),this._refresh(!0))},setItems:function(a){this.items=a;this._setStore(this.store);this._refresh(!0)},_setQuery:function(a,f){this.query=a;this.queryOptions=f||this.queryOptions},_setStore:function(a){this.store&&this._store_connects&&B.forEach(this._store_connects,this.disconnect,
this);if(this.store=a){a=this.store.getFeatures();var f=[];this._canEdit=!!a["dojo.data.api.Write"]&&!!a["dojo.data.api.Identity"];this._hasIdentity=!!a["dojo.data.api.Identity"];a["dojo.data.api.Notification"]&&!this.items&&(f.push(this.connect(this.store,"onSet","_onSet")),f.push(this.connect(this.store,"onNew","_onNew")),f.push(this.connect(this.store,"onDelete","_onDelete")));this._canEdit&&f.push(this.connect(this.store,"revert","_onRevert"));this._store_connects=f}},_onFetchBegin:function(a,
f){this.scroller&&(this.rowCount!=a&&(f.isRender?(this.scroller.init(a,this.keepRows,this.rowsPerPage),this.rowCount=a,this._setAutoHeightAttr(this.autoHeight,!0),this._skipRowRenormalize=!0,this.prerender(),this._skipRowRenormalize=!1):this.updateRowCount(a)),a?this.showMessage():(this.views.render(),this._resize(),this.showMessage(this.noDataMessage),this.focus.initFocusView()))},_onFetchComplete:function(a,f){this.scroller&&(a&&0<a.length&&(B.forEach(a,function(n,m){this._addItem(n,f.start+m,!0)},
this),this.updateRows(f.start,a.length),f.isRender?(this.setScrollTop(0),this.postrender()):this._lastScrollTop&&this.setScrollTop(this._lastScrollTop),q("ie")&&l.setSelectable(this.domNode,this.selectable)),delete this._lastScrollTop,this._isLoaded||(this._isLoading=!1,this._isLoaded=!0),this._pending_requests[f.start]=!1)},_onFetchError:function(a,f){console.log(a);delete this._lastScrollTop;this._isLoaded||(this._isLoading=!1,this._isLoaded=!0,this.showMessage(this.errorMessage));this._pending_requests[f.start]=
!1;this.onFetchError(a,f)},onFetchError:function(a,f){},_fetch:function(a,f){a=a||0;if(this.store&&!this._pending_requests[a]){this._isLoaded||this._isLoading||(this._isLoading=!0,this.showMessage(this.loadingMessage));this._pending_requests[a]=!0;try{if(this.items){var n=this.items,m=this.store;this.rowsPerPage=n.length;var d={start:a,count:this.rowsPerPage,isRender:f};this._onFetchBegin(n.length,d);var c=0;B.forEach(n,function(k){m.isItemLoaded(k)||c++});if(0===c)this._onFetchComplete(n,d);else{var g=
function(k){c--;0===c&&this._onFetchComplete(n,d)};B.forEach(n,function(k){m.isItemLoaded(k)||m.loadItem({item:k,onItem:g,scope:this})},this)}}else this.store.fetch({start:a,count:this.rowsPerPage,query:this.query,sort:this.getSortProps(),queryOptions:this.queryOptions,isRender:f,onBegin:A.hitch(this,"_onFetchBegin"),onComplete:A.hitch(this,"_onFetchComplete"),onError:A.hitch(this,"_onFetchError")})}catch(k){this._onFetchError(k,{start:a,count:this.rowsPerPage})}}},_clearData:function(){this.updateRowCount(0);
this._by_idty={};this._by_idx=[];this._pages=[];this._bop=this._eop=-1;this._isLoading=this._isLoaded=!1},getItem:function(a){var f=this._by_idx[a];return!f||f&&!f.item?(this._preparePage(a),null):f.item},getItemIndex:function(a){return this._getItemIndex(a,!1)},_getItemIndex:function(a,f){if(!f&&!this.store.isItem(a))return-1;f=this._hasIdentity?this.store.getIdentity(a):null;for(var n=0,m=this._by_idx.length;n<m;n++){var d=this._by_idx[n];if(d&&(f&&d.idty==f||d.item===a))return n}return-1},filter:function(a,
f){this.query=a;f&&this._clearData();this._fetch()},_getItemAttr:function(a,f){return(a=this.getItem(a))?this.store.getValue(a,f):this.fetchText},_render:function(){this.domNode.parentNode&&(this.scroller.init(this.get("rowCount"),this.keepRows,this.rowsPerPage),this.prerender(),this._fetch(0,!0))},_requestsPending:function(a){return this._pending_requests[a]},_rowToPage:function(a){return this.rowsPerPage?Math.floor(a/this.rowsPerPage):a},_pageToRow:function(a){return this.rowsPerPage?this.rowsPerPage*
a:a},_preparePage:function(a){(a<this._bop||a>=this._eop)&&!this._addingItem&&(a=this._rowToPage(a),this._needPage(a),this._bop=a*this.rowsPerPage,this._eop=this._bop+(this.rowsPerPage||this.get("rowCount")))},_needPage:function(a){this._pages[a]||(this._pages[a]=!0,this._requestPage(a))},_requestPage:function(a){a=this._pageToRow(a);0<Math.min(this.rowsPerPage,this.get("rowCount")-a)&&(this._requests++,this._requestsPending(a)||setTimeout(A.hitch(this,"_fetch",a,!1),1))},getCellName:function(a){return a.field},
_refresh:function(a){this._clearData();this._fetch(0,a)},sort:function(){this.edit.apply();this._lastScrollTop=this.scrollTop;this._refresh()},canSort:function(){return!this._isLoading},getSortProps:function(){var a=this.getCell(this.getSortIndex());if(a){var f=a.sortDesc,n=!(0<this.sortInfo);return[{attribute:a.field,descending:"undefined"==typeof f?n:n?!f:f}]}return this.sortFields?this.sortFields:null},styleRowState:function(a){if(this.store&&this.store.getState){for(var f=this.store.getState(a.index),
n="",m=0,d=["inflight","error","inserting"],c;c=d[m];m++)if(f[c]){n=" dojoxGridRow-"+c;break}a.customClasses+=n}},onStyleRow:function(a){this.styleRowState(a);this.inherited(arguments)},canEdit:function(a,f){return this._canEdit},_copyAttr:function(a,f){a=this.getItem(a);return this.store.getValue(a,f)},doStartEdit:function(a,f){this._cache[f]||(this._cache[f]=this._copyAttr(f,a.field));this.onStartEdit(a,f)},doApplyCellEdit:function(a,f,n){this.store.fetchItemByIdentity({identity:this._by_idx[f].idty,
onItem:A.hitch(this,function(m){var d=this.store.getValue(m,n);"number"==typeof d?a=isNaN(a)?a:parseFloat(a):"boolean"==typeof d?a="true"==a?!0:"false"==a?!1:a:d instanceof Date&&(d=new Date(a),a=isNaN(d.getTime())?a:d);this.store.setValue(m,n,a);this.onApplyCellEdit(a,f,n)})})},doCancelEdit:function(a){this._cache[a]&&(this.updateRow(a),delete this._cache[a]);this.onCancelEdit.apply(this,arguments)},doApplyEdit:function(a,f){this.onApplyEdit(a)},removeSelectedRows:function(){if(this._canEdit){this.edit.apply();
var a=A.hitch(this,function(f){f.length&&(B.forEach(f,this.store.deleteItem,this.store),this.selection.clear())});this.allItemsSelected?this.store.fetch({query:this.query,queryOptions:this.queryOptions,onComplete:a}):a(this.selection.getSelected())}}});b.cell_markupFactory=function(a,f,n){var m=A.trim(l.attr(f,"field")||"");m&&(n.field=m);n.field=n.field||n.name;if(m=A.trim(l.attr(f,"fields")||""))n.fields=m.split(",");a&&a(f,n)};b.markupFactory=function(a,f,n,m){return p.markupFactory(a,f,n,A.partial(b.cell_markupFactory,
m))};return b})},"dojox/grid/_Grid":function(){define("dojo/_base/kernel ../main dojo/_base/declare ./_Events ./_Scroller ./_Layout ./_View ./_ViewManager ./_RowManager ./_FocusManager ./_EditManager ./Selection ./_RowSelector ./util dijit/_Widget dijit/_TemplatedMixin dijit/CheckedMenuItem dojo/text!./resources/_Grid.html dojo/string dojo/_base/array dojo/_base/lang dojo/_base/sniff dojox/html/metrics dojo/_base/html dojo/query dojo/dnd/common dojo/i18n!dijit/nls/loading".split(" "),function(G,B,
A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k,t,y,K,C,r,E,F){G.isCopyKey||(G.isCopyKey=G.dnd.getCopyKeyState);A=A("dojox.grid._Grid",[d,c,w],{templateString:k,classTag:"dojoxGrid",rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:!1,initialWidth:"",autoHeight:"",rowHeight:0,autoRender:!0,defaultHeight:"15em",height:"",structure:null,elasticView:-1,singleClickEdit:!1,selectionMode:"extended",rowSelector:"",columnReordering:!1,headerMenu:null,placeholderLabel:"GridColumns",selectable:!1,_click:null,loadingMessage:"\x3cspan class\x3d'dojoxGridLoading'\x3e${loadingState}\x3c/span\x3e",
errorMessage:"\x3cspan class\x3d'dojoxGridError'\x3e${errorState}\x3c/span\x3e",noDataMessage:"",escapeHTMLInData:!0,formatterScope:null,editable:!1,summary:"",_setSummaryAttr:"domNode",sortInfo:0,_placeholders:null,_layoutClass:h,buildRendering:function(){this.inherited(arguments);this.domNode.getAttribute("tabIndex")||(this.domNode.tabIndex="0");this.createScroller();this.createLayout();this.createViews();this.createManagers();this.createSelection();this.connect(this.selection,"onSelected","onSelected");
this.connect(this.selection,"onDeselected","onDeselected");this.connect(this.selection,"onChanged","onSelectionChanged");r.initOnFontResize();this.connect(r,"onFontResize","textSizeChanged");m.funnelEvents(this.domNode,this,"doKeyEvent",m.keyEvents);"none"!=this.selectionMode&&this.domNode.setAttribute("aria-multiselectable","single"==this.selectionMode?"false":"true");E.addClass(this.domNode,this.classTag);this.isLeftToRight()||E.addClass(this.domNode,this.classTag+"Rtl");0<this.rowHeight&&E.addClass(this.viewsNode,
this.classTag+"FixedRowHeight")},postMixInProperties:function(){this.inherited(arguments);var u=G.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=t.substitute(this.loadingMessage,u);this.errorMessage=t.substitute(this.errorMessage,u);this.srcNodeRef&&this.srcNodeRef.style.height&&(this.height=this.srcNodeRef.style.height);this._setAutoHeightAttr(this.autoHeight,!0);this.lastScrollTop=this.scrollTop=0},postCreate:function(){this._placeholders=[];this._setHeaderMenuAttr(this.headerMenu);
this._setStructureAttr(this.structure);this._click=[];this.inherited(arguments);this.domNode&&this.autoWidth&&this.initialWidth&&(this.domNode.style.width=this.initialWidth);this.domNode&&!this.editable&&E.attr(this.domNode,"aria-readonly","true")},destroy:function(){this.domNode.onReveal=null;this.domNode.onSizeChange=null;delete this._click;this.scroller&&(this.scroller.destroy(),delete this.scroller);this.edit.destroy();delete this.edit;this.views.destroyViews();this.focus&&(this.focus.destroy(),
delete this.focus);this.headerMenu&&this._placeholders.length&&(y.forEach(this._placeholders,function(u){u.unReplace(!0)}),this.headerMenu.unBindDomNode(this.viewsHeaderNode));this.inherited(arguments)},_setAutoHeightAttr:function(u,D){"string"==typeof u&&(u=u&&"false"!=u?"true"==u?!0:window.parseInt(u,10):!1);"number"==typeof u&&(isNaN(u)&&(u=!1),0>u?u=!0:0===u&&(u=!1));this.autoHeight=u;this._autoHeight="boolean"==typeof u?u:"number"==typeof u?u>=this.get("rowCount"):!1;this._started&&!D&&this.render()},
_getRowCountAttr:function(){return this.updating&&this.invalidated&&void 0!=this.invalidated.rowCount?this.invalidated.rowCount:this.rowCount},textSizeChanged:function(){this.render()},sizeChange:function(){this.update()},createManagers:function(){this.rows=new l(this);this.focus=new b(this);this.edit=new a(this)},createSelection:function(){this.selection=new f(this)},createScroller:function(){this.scroller=new q;this.scroller.grid=this;this.scroller.renderRow=K.hitch(this,"renderRow");this.scroller.removeRow=
K.hitch(this,"rowRemoved")},createLayout:function(){this.layout=new this._layoutClass(this);this.connect(this.layout,"moveColumn","onMoveColumn")},onMoveColumn:function(){this.update()},onResizeColumn:function(u){},createViews:function(){this.views=new e(this);this.views.createView=K.hitch(this,"createView")},createView:function(u,D){u=new (K.getObject(u))({grid:this,index:D});this.viewsNode.appendChild(u.domNode);this.viewsHeaderNode.appendChild(u.headerNode);this.views.addView(u);E.attr(this.domNode,
"align",this.isLeftToRight()?"left":"right");return u},buildViews:function(){for(var u=0,D;D=this.layout.structure[u];u++)this.createView(D.type||B._scopeName+".grid._View",u).setStructure(D);this.scroller.setContentNodes(this.views.getContentNodes())},_setStructureAttr:function(u){u&&K.isString(u)&&(G.deprecated("dojox.grid._Grid.set('structure', 'objVar')","use dojox.grid._Grid.set('structure', objVar) instead","2.0"),u=K.getObject(u));this.structure=u;if(!u)if(this.layout.structure)u=this.layout.structure;
else return;this.views.destroyViews();this.focus.focusView=null;u!==this.layout.structure&&this.layout.setStructure(u);this._structureChanged()},setStructure:function(u){G.deprecated("dojox.grid._Grid.setStructure(obj)","use dojox.grid._Grid.set('structure', obj) instead.","2.0");this._setStructureAttr(u)},getColumnTogglingItems:function(){var u=[];var D=y.map(this.layout.cells,function(z){z.menuItems||(z.menuItems=[]);var M=this,H=new g({label:z.name,checked:!z.hidden,_gridCell:z,onChange:function(x){if(M.layout.setColumnVisibility(this._gridCell.index,
x)){var J=this._gridCell.menuItems;1<J.length&&y.forEach(J,function(L){L!==this&&L.setAttribute("checked",x)},this);x=y.filter(M.layout.cells,function(L){1<L.menuItems.length?y.forEach(L.menuItems,"item.set('disabled', false);"):L.menuItems[0].set("disabled",!1);return!L.hidden});1==x.length&&y.forEach(x[0].menuItems,"item.set('disabled', true);")}},destroy:function(){var x=y.indexOf(this._gridCell.menuItems,this);this._gridCell.menuItems.splice(x,1);delete this._gridCell;g.prototype.destroy.apply(this,
arguments)}});z.menuItems.push(H);z.hidden||u.push(H);return H},this);1==u.length&&u[0].set("disabled",!0);return D},_setHeaderMenuAttr:function(u){this._placeholders&&this._placeholders.length&&(y.forEach(this._placeholders,function(D){D.unReplace(!0)}),this._placeholders=[]);this.headerMenu&&this.headerMenu.unBindDomNode(this.viewsHeaderNode);if(this.headerMenu=u)this.headerMenu.bindDomNode(this.viewsHeaderNode),this.headerMenu.getPlaceholders&&(this._placeholders=this.headerMenu.getPlaceholders(this.placeholderLabel))},
setHeaderMenu:function(u){G.deprecated("dojox.grid._Grid.setHeaderMenu(obj)","use dojox.grid._Grid.set('headerMenu', obj) instead.","2.0");this._setHeaderMenuAttr(u)},setupHeaderMenu:function(){this._placeholders&&this._placeholders.length&&y.forEach(this._placeholders,function(u){u._replaced&&u.unReplace(!0);u.replace(this.getColumnTogglingItems())},this)},_fetch:function(u){this.setScrollTop(0)},getItem:function(u){return null},showMessage:function(u){u?(this.messagesNode.innerHTML=u,this.messagesNode.style.display=
""):(this.messagesNode.innerHTML="",this.messagesNode.style.display="none")},_structureChanged:function(){this.buildViews();this.autoRender&&this._started&&this.render()},hasLayout:function(){return this.layout.cells.length},resize:function(u,D){this._pendingChangeSize=u;this._pendingResultSize=D;this.sizeChange()},_getPadBorder:function(){return this._padBorder=this._padBorder||E._getPadBorderExtents(this.domNode)},_getHeaderHeight:function(){var u=this.viewsHeaderNode.style,D="none"==u.display?
0:this.views.measureHeader();u.height=D+"px";this.views.normalizeHeaderNodeHeight();return D},_resize:function(u,D){u=u||this._pendingChangeSize;D=D||this._pendingResultSize;delete this._pendingChangeSize;delete this._pendingResultSize;if(this.domNode){var z=this.domNode.parentNode;if(z&&1==z.nodeType&&this.hasLayout()&&"hidden"!=z.style.visibility&&"none"!=z.style.display){var M=this._getPadBorder(),H=void 0;if(this._autoHeight)this.domNode.style.height="auto";else if("number"==typeof this.autoHeight){var x=
H=this._getHeaderHeight();x+=this.scroller.averageRowHeight*this.autoHeight;this.domNode.style.height=x+"px"}else this.domNode.clientHeight<=M.h&&(z==document.body?this.domNode.style.height=this.defaultHeight:this.height?this.domNode.style.height=this.height:this.fitTo="parent");D&&(u=D);!this._autoHeight&&u?(E.marginBox(this.domNode,u),this.height=this.domNode.style.height,delete this.fitTo):"parent"==this.fitTo&&(x=this._parentContentBoxHeight=0<this._parentContentBoxHeight?this._parentContentBoxHeight:
E._getContentBox(z).h,this.domNode.style.height=Math.max(0,x)+"px");u=y.some(this.views.views,function(J){return J.flexCells});this._autoHeight||0!==(x||E._getContentBox(this.domNode).h)?(this.viewsHeaderNode.style.display="block",u||void 0!==H||(H=this._getHeaderHeight())):this.viewsHeaderNode.style.display="none";u&&(H=void 0);this.adaptWidth();this.adaptHeight(H);this.postresize()}}},adaptWidth:function(){var u=!this.initialWidth&&this.autoWidth,D=u?0:this.domNode.clientWidth||this.domNode.offsetWidth-
this._getPadBorder().w;D=this.views.arrange(1,D);this.views.onEach("adaptWidth");u&&(this.domNode.style.width=D+"px")},adaptHeight:function(u){u=void 0===u?this._getHeaderHeight():u;var D=this._autoHeight?-1:Math.max(this.domNode.clientHeight-u,0)||0;this.views.onEach("setSize",[0,D]);this.views.onEach("adaptHeight");if(!this._autoHeight){var z=0,M=0,H=y.filter(this.views.views,function(x){(x=x.hasHScrollbar())?z++:M++;return!x});0<z&&0<M&&y.forEach(H,function(x){x.adaptHeight(!0)})}!0===this.autoHeight||
-1!=D||"number"==typeof this.autoHeight&&this.autoHeight>=this.get("rowCount")?this.scroller.windowHeight=D:this.scroller.windowHeight=Math.max(this.domNode.clientHeight-u,0)},startup:function(){this._started||(this.inherited(arguments),this.autoRender&&this.render())},render:function(){this.domNode&&this._started&&(this.hasLayout()?(this.update=this.defaultUpdate,this._render()):this.scroller.init(0,this.keepRows,this.rowsPerPage))},_render:function(){this.scroller.init(this.get("rowCount"),this.keepRows,
this.rowsPerPage);this.prerender();this.setScrollTop(0);this.postrender()},prerender:function(){this.keepRows=this._autoHeight?0:this.keepRows;this.scroller.setKeepInfo(this.keepRows);this.views.render();this._resize()},postrender:function(){this.postresize();this.focus.initFocusView();E.setSelectable(this.domNode,this.selectable)},postresize:function(){if(this._autoHeight){var u=Math.max(this.views.measureContent())+"px";this.viewsNode.style.height=u}},renderRow:function(u,D){this.views.renderRow(u,
D,this._skipRowRenormalize)},rowRemoved:function(u){this.views.rowRemoved(u)},invalidated:null,updating:!1,beginUpdate:function(){this.invalidated=[];this.updating=!0},endUpdate:function(){this.updating=!1;var u=this.invalidated,D;if(u.all)this.update();else if(void 0!=u.rowCount)this.updateRowCount(u.rowCount);else for(D in u)this.updateRow(Number(D));this.invalidated=[]},defaultUpdate:function(){this.domNode&&(this.updating?this.invalidated.all=!0:(this.lastScrollTop=this.scrollTop,this.prerender(),
this.scroller.invalidateNodes(),this.setScrollTop(this.lastScrollTop),this.postrender()))},update:function(){this.render()},updateRow:function(u){u=Number(u);this.updating?this.invalidated[u]=!0:(this.views.updateRow(u),this.scroller.rowHeightChanged(u))},updateRows:function(u,D){u=Number(u);D=Number(D);var z;if(this.updating)for(z=0;z<D;z++)this.invalidated[z+u]=!0;else{for(z=0;z<D;z++)this.views.updateRow(z+u,this._skipRowRenormalize);this.scroller.rowHeightChanged(u)}},updateRowCount:function(u){this.updating?
this.invalidated.rowCount=u:(this.rowCount=u,this._setAutoHeightAttr(this.autoHeight,!0),this.layout.cells.length&&this.scroller.updateRowCount(u),this.layout.cells.length&&this.setScrollTop(this.scrollTop),this._resize())},updateRowStyles:function(u){this.views.updateRowStyles(u)},getRowNode:function(u){if(!this.focus.focusView||this.focus.focusView instanceof n)for(var D=0,z;z=this.views.views[D];D++){if(!(z instanceof n))return z.rowNodes[u]}else return this.focus.focusView.rowNodes[u];return null},
rowHeightChanged:function(u){this.views.renormalizeRow(u);this.scroller.rowHeightChanged(u)},fastScroll:!0,delayScroll:!1,scrollRedrawThreshold:C("ie")?100:50,scrollTo:function(u){if(this.fastScroll){var D=Math.abs(this.lastScrollTop-u);this.lastScrollTop=u;if(D>this.scrollRedrawThreshold||this.delayScroll){this.delayScroll=!0;this.scrollTop=u;this.views.setScrollTop(u);this._pendingScroll&&window.clearTimeout(this._pendingScroll);var z=this;this._pendingScroll=window.setTimeout(function(){delete z._pendingScroll;
z.finishScrollJob()},200)}else this.setScrollTop(u)}else this.setScrollTop(u)},finishScrollJob:function(){this.delayScroll=!1;this.setScrollTop(this.scrollTop)},setScrollTop:function(u){this.scroller.scroll(this.views.setScrollTop(u))},scrollToRow:function(u){this.setScrollTop(this.scroller.findScrollTop(u)+1)},styleRowNode:function(u,D){D&&this.rows.styleRowNode(u,D)},_mouseOut:function(u){this.rows.setOverRow(-2)},getCell:function(u){return this.layout.cells[u]},setCellWidth:function(u,D){this.getCell(u).unitWidth=
D},getCellName:function(u){return"Cell "+u.index},canSort:function(u){},sort:function(){},getSortAsc:function(u){u=void 0==u?this.sortInfo:u;return 0<u},getSortIndex:function(u){u=void 0==u?this.sortInfo:u;return Math.abs(u)-1},setSortIndex:function(u,D){var z=u+1;void 0!=D?z*=D?1:-1:this.getSortIndex()==u&&(z=-this.sortInfo);this.setSortInfo(z)},setSortInfo:function(u){this.canSort(u)&&(this.sortInfo=u,this.sort(),this.update())},doKeyEvent:function(u){u.dispatch="do"+u.type;this.onKeyEvent(u)},
_dispatch:function(u,D){return u in this?this[u](D):!1},dispatchKeyEvent:function(u){this._dispatch(u.dispatch,u)},dispatchContentEvent:function(u){this.edit.dispatchEvent(u)||u.sourceView.dispatchContentEvent(u)||this._dispatch(u.dispatch,u)},dispatchHeaderEvent:function(u){u.sourceView.dispatchHeaderEvent(u)||this._dispatch("doheader"+u.type,u)},dokeydown:function(u){this.onKeyDown(u)},doclick:function(u){if(u.cellNode)this.onCellClick(u);else this.onRowClick(u)},dodblclick:function(u){if(u.cellNode)this.onCellDblClick(u);
else this.onRowDblClick(u)},docontextmenu:function(u){if(u.cellNode)this.onCellContextMenu(u);else this.onRowContextMenu(u)},doheaderclick:function(u){if(u.cellNode)this.onHeaderCellClick(u);else this.onHeaderClick(u)},doheaderdblclick:function(u){if(u.cellNode)this.onHeaderCellDblClick(u);else this.onHeaderDblClick(u)},doheadercontextmenu:function(u){if(u.cellNode)this.onHeaderCellContextMenu(u);else this.onHeaderContextMenu(u)},doStartEdit:function(u,D){this.onStartEdit(u,D)},doApplyCellEdit:function(u,
D,z){this.onApplyCellEdit(u,D,z)},doCancelEdit:function(u){this.onCancelEdit(u)},doApplyEdit:function(u){this.onApplyEdit(u)},addRow:function(){this.updateRowCount(this.get("rowCount")+1)},removeSelectedRows:function(){this.allItemsSelected?this.updateRowCount(0):this.updateRowCount(Math.max(0,this.get("rowCount")-this.selection.getSelected().length));this.selection.clear()}});A.markupFactory=function(u,D,z,M){var H=function(x){x=E.attr(x,"width")||"auto";"auto"!=x&&"em"!=x.slice(-2)&&"%"!=x.slice(-1)&&
(x=parseInt(x,10)+"px");return x};u.structure||"table"!=D.nodeName.toLowerCase()||(u.structure=F("\x3e colgroup",D).map(function(x){var J=E.attr(x,"span");J={noscroll:"true"==E.attr(x,"noscroll")?!0:!1,__span:J?parseInt(J,10):1,cells:[]};E.hasAttr(x,"width")&&(J.width=H(x));return J}),u.structure.length||u.structure.push({__span:Infinity,cells:[]}),F("thead \x3e tr",D).forEach(function(x,J){var L=0,N=0,P,T=null;F("\x3e th",x).map(function(S){T?L>=P+T.__span&&(N++,P+=T.__span,T=u.structure[N]):(P=
0,T=u.structure[0]);var Z={name:K.trim(E.attr(S,"name")||S.innerHTML),colSpan:parseInt(E.attr(S,"colspan")||1,10),type:K.trim(E.attr(S,"cellType")||""),id:K.trim(E.attr(S,"id")||"")};L+=Z.colSpan;var da=E.attr(S,"rowspan");da&&(Z.rowSpan=da);E.hasAttr(S,"width")&&(Z.width=H(S));E.hasAttr(S,"relWidth")&&(Z.relWidth=window.parseInt(E.attr(S,"relWidth"),10));E.hasAttr(S,"hidden")&&(Z.hidden="true"==E.attr(S,"hidden")||!0===E.attr(S,"hidden"));M&&M(S,Z);Z.type=Z.type?K.getObject(Z.type):B.grid.cells.Cell;
Z.type&&Z.type.markupFactory&&Z.type.markupFactory(S,Z);T.cells[J]||(T.cells[J]=[]);T.cells[J].push(Z)})}));return new z(u,D)};return A})},"dojox/grid/_Events":function(){define(["dojo/keys","dojo/dom-class","dojo/_base/declare","dojo/_base/event","dojo/_base/sniff"],function(G,B,A,w,q){return A("dojox.grid._Events",null,{cellOverClass:"dojoxGridCellOver",onKeyEvent:function(h){this.dispatchKeyEvent(h)},onContentEvent:function(h){this.dispatchContentEvent(h)},onHeaderEvent:function(h){this.dispatchHeaderEvent(h)},
onStyleRow:function(h){h.customClasses+=(h.odd?" dojoxGridRowOdd":"")+(h.selected?" dojoxGridRowSelected":"")+(h.over?" dojoxGridRowOver":"");this.focus.styleRow(h);this.edit.styleRow(h)},onKeyDown:function(h){if(!h.altKey&&!h.metaKey)switch(h.keyCode){case G.ESCAPE:this.edit.cancel();break;case G.ENTER:if(!this.edit.isEditing()){var p=this.focus.getHeaderIndex();if(0<=p){this.setSortIndex(p);break}else this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(h),h.shiftKey);w.stop(h)}h.shiftKey||
(p=this.edit.isEditing(),this.edit.apply(),p||this.edit.setEditCell(this.focus.cell,this.focus.rowIndex));this.edit.isEditing()||((this.focus.focusView||this.views.views[0]).content.decorateEvent(h),this.onRowClick(h),w.stop(h));break;case G.SPACE:this.edit.isEditing()||(p=this.focus.getHeaderIndex(),0<=p?this.setSortIndex(p):(this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(h),h.shiftKey),this.focus._focusifyCellNode(!0),this.focus.setFocusCell(this.focus.cell,this.focus.rowIndex),w.stop(h)));
break;case G.TAB:this.focus[h.shiftKey?"previousKey":"nextKey"](h);break;case G.LEFT_ARROW:case G.RIGHT_ARROW:if(!this.edit.isEditing()){var e=h.keyCode;w.stop(h);p=this.focus.getHeaderIndex();0<=p&&h.shiftKey&&h.ctrlKey?this.focus.colSizeAdjust(h,p,5*(e==G.LEFT_ARROW?-1:1)):(h=e==G.LEFT_ARROW?1:-1,this.isLeftToRight()&&(h*=-1),this.focus.move(0,h))}break;case G.UP_ARROW:this.edit.isEditing()||0===this.focus.rowIndex||(w.stop(h),this.focus.move(-1,0));break;case G.DOWN_ARROW:this.edit.isEditing()||
this.focus.rowIndex+1==this.rowCount||(w.stop(h),this.focus.move(1,0));break;case G.PAGE_UP:this.edit.isEditing()||0===this.focus.rowIndex||(w.stop(h),this.focus.rowIndex!=this.scroller.firstVisibleRow+1?this.focus.move(this.scroller.firstVisibleRow-this.focus.rowIndex,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex-1)),this.focus.move(this.scroller.firstVisibleRow-this.scroller.lastVisibleRow+1,0)));break;case G.PAGE_DOWN:this.edit.isEditing()||this.focus.rowIndex+1==this.rowCount||
(w.stop(h),this.focus.rowIndex!=this.scroller.lastVisibleRow-1?this.focus.move(this.scroller.lastVisibleRow-this.focus.rowIndex-1,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex+1)),this.focus.move(this.scroller.lastVisibleRow-this.scroller.firstVisibleRow-1,0)))}},onMouseOver:function(h){-1==h.rowIndex?this.onHeaderCellMouseOver(h):this.onCellMouseOver(h)},onMouseOut:function(h){-1==h.rowIndex?this.onHeaderCellMouseOut(h):this.onCellMouseOut(h)},onMouseDown:function(h){-1==
h.rowIndex?this.onHeaderCellMouseDown(h):this.onCellMouseDown(h)},onMouseOverRow:function(h){this.rows.isOver(h.rowIndex)||(this.rows.setOverRow(h.rowIndex),-1==h.rowIndex?this.onHeaderMouseOver(h):this.onRowMouseOver(h))},onMouseOutRow:function(h){if(this.rows.isOver(-1))this.onHeaderMouseOut(h);else this.rows.isOver(-2)||(this.rows.setOverRow(-2),this.onRowMouseOut(h))},onMouseDownRow:function(h){if(-1!=h.rowIndex)this.onRowMouseDown(h)},onCellMouseOver:function(h){h.cellNode&&B.add(h.cellNode,
this.cellOverClass)},onCellMouseOut:function(h){h.cellNode&&B.remove(h.cellNode,this.cellOverClass)},onCellMouseDown:function(h){},onCellClick:function(h){this._click[0]=this._click[1];this._click[1]=h;this.edit.isEditCell(h.rowIndex,h.cellIndex)||this.focus.setFocusCell(h.cell,h.rowIndex);1<this._click.length&&null==this._click[0]&&this._click.shift();this.onRowClick(h)},onCellDblClick:function(h){var p=1<this._click.length&&q("ie")?this._click[1]:1<this._click.length&&this._click[0].rowIndex!=this._click[1].rowIndex?
this._click[0]:h;this.focus.setFocusCell(p.cell,p.rowIndex);this.edit.setEditCell(p.cell,p.rowIndex);this.onRowDblClick(h)},onCellContextMenu:function(h){this.onRowContextMenu(h)},onCellFocus:function(h,p){this.edit.cellFocus(h,p)},onRowClick:function(h){this.edit.rowClick(h);this.selection.clickSelectEvent(h)},onRowDblClick:function(h){},onRowMouseOver:function(h){},onRowMouseOut:function(h){},onRowMouseDown:function(h){},onRowContextMenu:function(h){w.stop(h)},onHeaderMouseOver:function(h){},onHeaderMouseOut:function(h){},
onHeaderCellMouseOver:function(h){h.cellNode&&B.add(h.cellNode,this.cellOverClass)},onHeaderCellMouseOut:function(h){h.cellNode&&B.remove(h.cellNode,this.cellOverClass)},onHeaderCellMouseDown:function(h){},onHeaderClick:function(h){},onHeaderCellClick:function(h){this.setSortIndex(h.cell.index);this.onHeaderClick(h)},onHeaderDblClick:function(h){},onHeaderCellDblClick:function(h){this.onHeaderDblClick(h)},onHeaderCellContextMenu:function(h){this.onHeaderContextMenu(h)},onHeaderContextMenu:function(h){this.headerMenu||
w.stop(h)},onStartEdit:function(h,p){},onApplyCellEdit:function(h,p,e){},onCancelEdit:function(h){},onApplyEdit:function(h){},onCanSelect:function(h){return!0},onCanDeselect:function(h){return!0},onSelected:function(h){this.updateRowStyles(h)},onDeselected:function(h){this.updateRowStyles(h)},onSelectionChanged:function(){}})})},"dojox/grid/_Scroller":function(){define(["dijit/registry","dojo/_base/declare","dojo/_base/lang","./util","dojo/_base/html"],function(G,B,A,w,q){var h=function(e){e&&dojo.forEach(G.toArray(),
function(l){l.domNode&&q.isDescendant(l.domNode,e,!0)&&l.destroy()})},p=function(e,l){for(var b=[],a=0,f;f=e.childNodes[a];){a++;var n=q.byId(f);(n&&n.tagName?n.tagName.toLowerCase():"")==l&&b.push(f)}return b};return B("dojox.grid._Scroller",null,{constructor:function(e){this.setContentNodes(e);this.pageHeights=[];this.pageNodes=[];this.stack=[]},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,
lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(e,l,b){switch(arguments.length){case 3:this.rowsPerPage=b;case 2:this.keepRows=l;case 1:this.rowCount=e}this.defaultPageHeight=(0<this.grid.rowHeight?this.grid.rowHeight:this.defaultRowHeight)*this.rowsPerPage;this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);this.setKeepInfo(this.keepRows);this.invalidate();this.scrollboxNode&&(this.scrollboxNode.scrollTop=0,this.scroll(0),this.scrollboxNode.onscroll=A.hitch(this,
"onscroll"))},_getPageCount:function(e,l){return e?Math.ceil(e/l)||1:0},destroy:function(){this.invalidateNodes();delete this.contentNodes;delete this.contentNode;delete this.scrollboxNode},setKeepInfo:function(e){this.keepPages=(this.keepRows=e)?Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2):this.keepPages},setContentNodes:function(e){this.colCount=(this.contentNodes=e)?this.contentNodes.length:0;this.pageNodes=[];for(e=0;e<this.colCount;e++)this.pageNodes[e]=[]},getDefaultNodes:function(){return this.pageNodes[0]||
[]},invalidate:function(){this._invalidating=!0;this.invalidateNodes();this.pageHeights=[];this.height=this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0;this.resize();this._invalidating=!1},updateRowCount:function(e){this.invalidateNodes();this.rowCount=e;e=this.pageCount;0===e&&(this.height=1);this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);if(this.pageCount<e)for(--e;e>=this.pageCount;e--)this.height-=this.getPageHeight(e),delete this.pageHeights[e];
else this.pageCount>e&&(this.height+=this.defaultPageHeight*(this.pageCount-e-1)+this.calcLastPageHeight());this.resize()},pageExists:function(e){return!!this.getDefaultPageNode(e)},measurePage:function(e){return this.grid.rowHeight?((e+1)*this.rowsPerPage>this.rowCount?this.rowCount-e*this.rowsPerPage:this.rowsPerPage)*this.grid.rowHeight:(e=this.getDefaultPageNode(e))&&e.innerHTML?e.offsetHeight:void 0},positionPage:function(e,l){for(var b=0;b<this.colCount;b++)this.pageNodes[b][e].style.top=l+
"px"},repositionPages:function(e){for(var l=this.getDefaultNodes(),b=0,a=0;a<this.stack.length;a++)b=Math.max(this.stack[a],b);var f=(a=l[e])?this.getPageNodePosition(a)+this.getPageHeight(e):0;for(e+=1;e<=b;e++){if(a=l[e]){if(this.getPageNodePosition(a)==f)break;this.positionPage(e,f)}f+=this.getPageHeight(e)}},installPage:function(e){for(var l=0;l<this.colCount;l++)this.contentNodes[l].appendChild(this.pageNodes[l][e])},preparePage:function(e,l){l=l?this.popPage():null;for(var b=0;b<this.colCount;b++){var a=
this.pageNodes[b],f=null===l?this.createPageNode():this.invalidatePageNode(l,a);f.pageIndex=e;a[e]=f}},renderPage:function(e){var l=[],b;for(b=0;b<this.colCount;b++)l[b]=this.pageNodes[b][e];b=0;for(e*=this.rowsPerPage;b<this.rowsPerPage&&e<this.rowCount;b++,e++)this.renderRow(e,l)},removePage:function(e){var l=0;for(e*=this.rowsPerPage;l<this.rowsPerPage;l++,e++)this.removeRow(e)},destroyPage:function(e){for(var l=0;l<this.colCount;l++){var b=this.invalidatePageNode(e,this.pageNodes[l]);b&&q.destroy(b)}},
pacify:function(e){},pacifying:!1,pacifyTicks:200,setPacifying:function(e){this.pacifying!=e&&(this.pacifying=e,this.pacify(this.pacifying))},startPacify:function(){this.startPacifyTicks=(new Date).getTime()},doPacify:function(){var e=(new Date).getTime()-this.startPacifyTicks>this.pacifyTicks;this.setPacifying(!0);this.startPacify();return e},endPacify:function(){this.setPacifying(!1)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight);for(var e=0;e<this.colCount;e++)w.setStyleHeightPx(this.contentNodes[e],
Math.max(1,this.height));e=!this._invalidating;if(!e){var l=this.grid.get("autoHeight");"number"==typeof l&&l<=Math.min(this.rowsPerPage,this.rowCount)&&(e=!0)}e&&this.needPage(this.page,this.pageTop);e=this.page<this.pageCount-1?this.rowsPerPage:this.rowCount%this.rowsPerPage||this.rowsPerPage;l=this.getPageHeight(this.page);this.averageRowHeight=0<l&&0<e?l/e:0},calcLastPageHeight:function(){if(!this.pageCount)return 0;var e=(this.rowCount%this.rowsPerPage||this.rowsPerPage)*this.defaultRowHeight;
return this.pageHeights[this.pageCount-1]=e},updateContentHeight:function(e){this.height+=e;this.resize()},updatePageHeight:function(e,l,b){if(this.pageExists(e)){var a=this.getPageHeight(e),f=this.measurePage(e);void 0===f&&(f=a);this.pageHeights[e]=f;if(a!=f){this.updateContentHeight(f-a);var n=this.grid.get("autoHeight");"number"==typeof n&&n>this.rowCount||!0===n&&!l?b?(l=this.grid.viewsNode.style,l.height=parseInt(l.height)+f-a+"px",this.repositionPages(e)):this.grid.sizeChange():this.repositionPages(e)}return f}return 0},
rowHeightChanged:function(e,l){this.updatePageHeight(Math.floor(e/this.rowsPerPage),!1,l)},invalidateNodes:function(){for(;this.stack.length;)this.destroyPage(this.popPage())},createPageNode:function(){var e=document.createElement("div");q.attr(e,"role","presentation");e.style.position="absolute";e.style[this.grid.isLeftToRight()?"left":"right"]="0";return e},getPageHeight:function(e){e=this.pageHeights[e];return void 0!==e?e:this.defaultPageHeight},pushPage:function(e){return this.stack.push(e)},
popPage:function(){return this.stack.shift()},findPage:function(e){for(var l=0,b=0,a=0;l<this.pageCount&&!(a=this.getPageHeight(l),b+a>=e);l++,b+=a);this.page=l;this.pageTop=b},buildPage:function(e,l,b){this.preparePage(e,l);this.positionPage(e,b);this.installPage(e);this.renderPage(e);this.pushPage(e)},needPage:function(e,l){var b=this.getPageHeight(e);this.pageExists(e)?this.positionPage(e,l):(this.buildPage(e,!this.grid._autoHeight&&this.keepPages&&this.stack.length>=this.keepPages,l),b=this.updatePageHeight(e,
!0));return b},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop)},scroll:function(e){this.grid.scrollTop=e;if(this.colCount){this.startPacify();this.findPage(e);for(var l=this.height,b=this.getScrollBottom(e),a=this.page,f=this.pageTop;a<this.pageCount&&(0>b||f<b);a++)f+=this.needPage(a,f);this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,e);this.lastVisibleRow=this.getLastVisibleRow(a-1,f,b);l!=this.height&&this.repositionPages(a-1);this.endPacify()}},getScrollBottom:function(e){return 0<=
this.windowHeight?e+this.windowHeight:-1},processNodeEvent:function(e,l){for(var b=e.target;b&&b!=l&&b.parentNode&&b.parentNode.parentNode!=l;)b=b.parentNode;if(!b||!b.parentNode||b.parentNode.parentNode!=l)return!1;e.topRowIndex=b.parentNode.pageIndex*this.rowsPerPage;l=e.topRowIndex;a:{var a=0;for(var f,n=b.parentNode;f=n.childNodes[a++];)if(f==b){--a;break a}a=-1}e.rowIndex=l+a;e.rowTarget=b;return!0},processEvent:function(e){return this.processNodeEvent(e,this.contentNode)},renderRow:function(e,
l){},removeRow:function(e){},getDefaultPageNode:function(e){return this.getDefaultNodes()[e]},positionPageNode:function(e,l){},getPageNodePosition:function(e){return e.offsetTop},invalidatePageNode:function(e,l){var b=l[e];b&&(delete l[e],this.removePage(e,b),h(b),b.innerHTML="");return b},getPageRow:function(e){return e*this.rowsPerPage},getLastPageRow:function(e){return Math.min(this.rowCount,this.getPageRow(e+1))-1},getFirstVisibleRow:function(e,l,b){if(!this.pageExists(e))return 0;var a=this.getPageRow(e),
f=this.getDefaultNodes();e=p(f[e],"div");f=0;for(var n=e.length;f<n&&l<b;f++,a++)l+=e[f].offsetHeight;return a?a-1:a},getLastVisibleRow:function(e,l,b){if(!this.pageExists(e))return 0;var a=this.getDefaultNodes(),f=this.getLastPageRow(e);e=p(a[e],"div");for(a=e.length-1;0<=a&&l>b;a--,f--)l-=e[a].offsetHeight;return f+1},findTopRow:function(e){var l=this.getDefaultNodes();l=p(l[this.page],"div");for(var b=0,a=l.length,f=this.pageTop,n;b<a;b++)if(n=l[b].offsetHeight,f+=n,f>=e)return this.offset=n-(f-
e),b+this.page*this.rowsPerPage;return-1},findScrollTop:function(e){var l=Math.floor(e/this.rowsPerPage),b=0,a;for(a=0;a<l;a++)b+=this.getPageHeight(a);this.pageTop=b;this.page=l;this.needPage(l,this.pageTop);a=this.getDefaultNodes();var f=p(a[l],"div");l=e-this.rowsPerPage*l;a=0;for(e=f.length;a<e&&a<l;a++)b+=f[a].offsetHeight;return b},dummy:0})})},"dojox/grid/util":function(){define(["../main","dojo/_base/lang","dojo/dom","dojo/_base/sniff"],function(G,B,A,w){var q=B.getObject("grid.util",!0,G);
q.na="...";q.rowIndexTag="gridRowIndex";q.gridViewTag="gridView";q.fire=function(h,p,e){function l(d,c){if(null==d)return null;var g=c?"Width":"Height";return d["scroll"+g]>d["client"+g]?d:l(d.parentNode,c)}var b;if(w("webkit")&&"focus"==p){var a=h.domNode?h.domNode:h;if(b=l(a,!1))var f=b.scrollTop;if(a=l(a,!0))var n=a.scrollLeft}var m=h&&p&&h[p];h=m&&(e?m.apply(h,e):h[p]());w("webkit")&&"focus"==p&&(b&&(b.scrollTop=f),a&&(a.scrollLeft=n));return h};q.setStyleHeightPx=function(h,p){if(0<=p){var e=
h.style;p+="px";h&&e.height!=p&&(e.height=p)}};q.mouseEvents="mouseover mouseout mousedown mouseup click dblclick contextmenu".split(" ");q.keyEvents=["keyup","keydown","keypress"];q.funnelEvents=function(h,p,e,l){l=l?l:q.mouseEvents.concat(q.keyEvents);for(var b=0,a=l.length;b<a;b++)p.connect(h,"on"+l[b],e)};q.removeNode=function(h){(h=A.byId(h))&&h.parentNode&&h.parentNode.removeChild(h);return h};q.arrayCompare=function(h,p){for(var e=0,l=h.length;e<l;e++)if(h[e]!=p[e])return!1;return h.length==
p.length};q.arrayInsert=function(h,p,e){h.length<=p?h[p]=e:h.splice(p,0,e)};q.arrayRemove=function(h,p){h.splice(p,1)};q.arraySwap=function(h,p,e){var l=h[p];h[p]=h[e];h[e]=l};return q})},"dojox/grid/_Layout":function(){define("dojo/_base/kernel ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/dom-geometry ./cells ./_RowSelector".split(" "),function(G,B,A,w,q,h){return A("dojox.grid._Layout",null,{constructor:function(p){this.grid=p},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(p,
e,l,b,a){var f=this.structure[p].cells[0],n=this.structure[e].cells[0],m=null,d=m=0;p=0;for(var c;c=f[p];p++)if(c.index==l){m=p;break}m=f.splice(m,1)[0];m.view=this.grid.views.views[e];p=0;for(c=null;c=n[p];p++)if(c.index==b){d=p;break}a||(d+=1);n.splice(d,0,m);if(l=this.grid.getCell(this.grid.getSortIndex()))l._currentlySorted=this.grid.getSortAsc();this.cells=[];for(p=l=0;e=this.structure[p];p++)for(b=0;a=e.cells[b];b++)for(f=0;c=a[f];f++)c.index=l,this.cells.push(c),"_currentlySorted"in c&&(n=
l+1,n*=c._currentlySorted?1:-1,this.grid.sortInfo=n,delete c._currentlySorted),l++;w.forEach(this.cells,function(g){var k=g.markup[2].split(" ");parseInt(k[1].substring(5))!=g.index&&(k[1]='idx\x3d"'+g.index+'"',g.markup[2]=k.join(" "))});this.grid.setupHeaderMenu()},setColumnVisibility:function(p,e){p=this.cells[p];if(p.hidden==e){p.hidden=!e;e=p.view;var l=e.viewWidth;l&&"auto"!=l&&(e._togglingColumn=h.getMarginBox(p.getHeaderNode()).w||0);e.update();return!0}return!1},addCellDef:function(p,e,l){var b=
this,a=function(f){var n=0;1<f.colSpan?n=0:(n=f.width||b._defaultCellProps.width||b.defaultWidth,isNaN(n)||(n+="em"));return n};p={grid:this.grid,subrow:p,layoutIndex:e,index:this.cells.length};if(l&&l instanceof B.grid.cells._Base)return e=q.clone(l),p.unitWidth=a(e._props),e=q.mixin(e,this._defaultCellProps,l._props,p);e=l.type||l.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||B.grid.cells.Cell;q.isString(e)&&(e=q.getObject(e));p.unitWidth=a(l);return new e(q.mixin({},this._defaultCellProps,
l,p))},addRowDef:function(p,e){for(var l=[],b=0,a=0,f=!0,n=0,m;m=e[n];n++)m=this.addCellDef(p,n,m),l.push(m),this.cells.push(m),f&&m.relWidth?b+=m.relWidth:m.width&&(m=m.width,"string"==typeof m&&"%"==m.slice(-1)?a+=window.parseInt(m,10):"auto"==m&&(f=!1));b&&f&&w.forEach(l,function(d){d.relWidth&&(d.width=d.unitWidth=d.relWidth/b*(100-a)+"%")});return l},addRowsDef:function(p){var e=[];if(q.isArray(p))if(q.isArrayLike(p[0]))for(var l=0,b;p&&(b=p[l]);l++)e.push(this.addRowDef(l,b));else e.push(this.addRowDef(0,
p));return e},addViewDef:function(p){this._defaultCellProps=p.defaultCell||{};p.width&&"auto"==p.width&&delete p.width;return q.mixin({},p,{cells:this.addRowsDef(p.rows||p.cells)})},setStructure:function(p){this.fieldIndex=0;this.cells=[];var e=this.structure=[];if(this.grid.rowSelector){var l={type:B._scopeName+".grid._RowSelector"};if(q.isString(this.grid.rowSelector)){var b=this.grid.rowSelector;"false"==b?l=null:"true"!=b&&(l.width=b)}else this.grid.rowSelector||(l=null);l&&e.push(this.addViewDef(l))}var a=
function(d){return"name"in d||"field"in d||"get"in d};l=function(d){return q.isArray(d)&&(q.isArray(d[0])||a(d[0]))?!0:!1};b=function(d){return null!==d&&q.isObject(d)&&("cells"in d||"rows"in d||"type"in d&&!a(d))};if(q.isArrayLike(p)){for(var f=!1,n=0,m;m=p[n];n++)if(b(m)){f=!0;break}if(f)for(n=0;m=p[n];n++)l(m)?e.push(this.addViewDef({cells:m})):b(m)&&e.push(this.addViewDef(m));else e.push(this.addViewDef({cells:p}))}else b(p)&&e.push(this.addViewDef(p));this.cellCount=this.cells.length;this.grid.setupHeaderMenu()}})})},
"dojox/grid/cells":function(){define(["../main","./cells/_base"],function(G){return G.grid.cells})},"dojox/grid/cells/_base":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/event dojo/_base/connect dojo/_base/array dojo/_base/sniff dojo/dom dojo/dom-attr dojo/dom-construct dijit/_Widget ../util".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f){var n=B("dojox.grid._DeferredTextWidget",a,{deferred:null,_destroyOnRemove:!0,postCreate:function(){this.deferred&&this.deferred.addBoth(A.hitch(this,
function(k){this.domNode&&(this.domNode.innerHTML=k)}))}}),m=function(){setTimeout(A.hitch.apply(G,arguments),0)},d=B("dojox.grid.cells._Base",null,{styles:"",classes:"",editable:!1,alwaysEditing:!1,formatter:null,defaultValue:"...",value:null,hidden:!1,noresize:!1,draggable:!0,_valueProp:"value",_formatPending:!1,constructor:function(k){this._props=k||{};A.mixin(this,k);void 0===this.draggable&&(this.draggable=!0)},_defaultFormat:function(k,t){var y=this.grid.formatterScope||this,K=this.formatter;
K&&y&&"string"==typeof K&&(K=this.formatter=y[K]);k=k!=this.defaultValue&&K?K.apply(y,t):k;if("undefined"==typeof k)return this.defaultValue;k&&k.addBoth&&(k=new n({deferred:k},b.create("span",{innerHTML:this.defaultValue})));return k&&k.declaredClass&&k.startup?"\x3cdiv class\x3d'dojoxGridStubNode' linkWidget\x3d'"+k.id+"' cellIdx\x3d'"+this.index+"'\x3e"+this.defaultValue+"\x3c/div\x3e":k},format:function(k,t){var y=this.grid.edit.info;(t=this.get?this.get(k,t):this.value||this.defaultValue)&&t.replace&&
this.grid.escapeHTMLInData&&(t=t.replace(/&(?![a-z0-9]{1,8};)/ig,"\x26amp;").replace(/</g,"\x26lt;"));return this.editable&&(this.alwaysEditing||y.rowIndex==k&&y.cell==this)?this.formatEditing(y.value?y.value:t,k):this._defaultFormat(t,[t,k,this])},formatEditing:function(k,t){},getNode:function(k){return this.view.getCellNode(k,this.index)},getHeaderNode:function(){return this.view.getHeaderCellNode(this.index)},getEditNode:function(k){return(this.getNode(k)||0).firstChild||0},canResize:function(){var k=
this.unitWidth;return k&&"auto"!==k},isFlex:function(){var k=this.unitWidth;return k&&A.isString(k)&&("auto"==k||"%"==k.slice(-1))},applyEdit:function(k,t){this.getNode(t)&&this.grid.edit.applyCellEdit(k,this,t)},cancelEdit:function(k){this.grid.doCancelEdit(k)},_onEditBlur:function(k){this.grid.edit.isEditCell(k,this.index)&&this.grid.edit.apply()},registerOnBlur:function(k,t){this.commitOnBlur&&q.connect(k,"onblur",function(y){setTimeout(A.hitch(this,"_onEditBlur",t),250)})},needFormatNode:function(k,
t){this._formatPending=!0;m(this,"_formatNode",k,t)},cancelFormatNode:function(){this._formatPending=!1},_formatNode:function(k,t){this._formatPending&&(this._formatPending=!1,p("ie")||e.setSelectable(this.grid.domNode,!0),this.formatNode(this.getEditNode(t),k,t))},formatNode:function(k,t,y){p("ie")?m(this,"focus",y,k):this.focus(y,k)},dispatchEvent:function(k,t){if(k in this)return this[k](t)},getValue:function(k){return this.getEditNode(k)[this._valueProp]},setValue:function(k,t){(k=this.getEditNode(k))&&
(k[this._valueProp]=t)},focus:function(k,t){k=t||this.getEditNode(k);try{f.fire(k,"focus"),f.fire(k,"select")}catch(y){}},save:function(k){this.value=this.value||this.getValue(k)},restore:function(k){this.setValue(k,this.value)},_finish:function(k){e.setSelectable(this.grid.domNode,!1);this.cancelFormatNode()},apply:function(k){this.applyEdit(this.getValue(k),k);this._finish(k)},cancel:function(k){this.cancelEdit(k);this._finish(k)}});d.markupFactory=function(k,t){var y=A.trim(l.get(k,"formatter")||
"");y&&(t.formatter=A.getObject(y)||y);if(y=A.trim(l.get(k,"get")||""))t.get=A.getObject(y);y=function(K,C,r){var E=A.trim(l.get(k,K)||"");E&&(C[r||K]="false"!=E.toLowerCase())};y("sortDesc",t);y("editable",t);y("alwaysEditing",t);y("noresize",t);y("draggable",t);if(y=A.trim(l.get(k,"loadingText")||l.get(k,"defaultValue")||""))t.defaultValue=y;y=function(K,C,r){var E=A.trim(l.get(k,K)||"")||void 0;E&&(C[r||K]=E)};y("styles",t);y("headerStyles",t);y("cellStyles",t);y("classes",t);y("headerClasses",
t);y("cellClasses",t)};var c=d.Cell=B("dojox.grid.cells.Cell",d,{constructor:function(){this.keyFilter=this.keyFilter},keyFilter:null,formatEditing:function(k,t){this.needFormatNode(k,t);k&&k.replace&&(k=k.replace(/"/g,"\x26quot;"));return'\x3cinput class\x3d"dojoxGridInput" type\x3d"text" value\x3d"'+k+'"\x3e'},formatNode:function(k,t,y){this.inherited(arguments);this.registerOnBlur(k,y)},doKey:function(k){this.keyFilter&&-1==String.fromCharCode(k.charCode).search(this.keyFilter)&&w.stop(k)},_finish:function(k){this.inherited(arguments);
var t=this.getEditNode(k);try{f.fire(t,"blur")}catch(y){}}});c.markupFactory=function(k,t){d.markupFactory(k,t);if(k=A.trim(l.get(k,"keyFilter")||""))t.keyFilter=new RegExp(k)};(d.RowIndex=B("dojox.grid.cells.RowIndex",c,{name:"Row",postscript:function(){this.editable=!1},get:function(k){return k+1}})).markupFactory=function(k,t){c.markupFactory(k,t)};(d.Select=B("dojox.grid.cells.Select",c,{options:null,values:null,returnIndex:-1,constructor:function(k){this.values=this.values||this.options},formatEditing:function(k,
t){this.needFormatNode(k,t);t=['\x3cselect class\x3d"dojoxGridSelect"\x3e'];for(var y=0,K,C;void 0!==(K=this.options[y])&&void 0!==(C=this.values[y]);y++)C=C.replace?C.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):C,K=K.replace?K.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):K,t.push("\x3coption",k==C?" selected":"",' value\x3d"'+C+'"',"\x3e",K,"\x3c/option\x3e");t.push("\x3c/select\x3e");return t.join("")},_defaultFormat:function(k,t){var y=this.inherited(arguments);if(!this.formatter&&this.values&&
this.options){var K=h.indexOf(this.values,y);0<=K&&(y=this.options[K])}return y},getValue:function(k){var t=this.getEditNode(k);if(t)return k=t.selectedIndex,t=t.options[k],-1<this.returnIndex?k:t.value||t.innerHTML}})).markupFactory=function(k,t){c.markupFactory(k,t);var y=A.trim(l.get(k,"options")||"");if(y){var K=y.split(",");K[0]!=y&&(t.options=K)}if(k=A.trim(l.get(k,"values")||""))y=k.split(","),y[0]!=k&&(t.values=y)};var g=d.AlwaysEdit=B("dojox.grid.cells.AlwaysEdit",c,{alwaysEditing:!0,_formatNode:function(k,
t){this.formatNode(this.getEditNode(t),k,t)},applyStaticValue:function(k){var t=this.grid.edit;t.applyCellEdit(this.getValue(k),this,k);t.start(this,k,!0)}});g.markupFactory=function(k,t){c.markupFactory(k,t)};(d.Bool=B("dojox.grid.cells.Bool",g,{_valueProp:"checked",formatEditing:function(k,t){return'\x3cinput class\x3d"dojoxGridInput" type\x3d"checkbox"'+(k?' checked\x3d"checked"':"")+' style\x3d"width: auto" /\x3e'},doclick:function(k){"INPUT"==k.target.tagName&&this.applyStaticValue(k.rowIndex)}})).markupFactory=
function(k,t){g.markupFactory(k,t)};return d})},"dojox/grid/_RowSelector":function(){define(["dojo/_base/declare","./_View"],function(G,B){return G("dojox.grid._RowSelector",B,{defaultWidth:"2em",noscroll:!0,padBorderWidth:2,buildRendering:function(){this.inherited("buildRendering",arguments);this.scrollboxNode.style.overflow="hidden";this.headerNode.style.visibility="hidden"},getWidth:function(){return this.viewWidth||this.defaultWidth},buildRowContent:function(A,w){w.innerHTML='\x3ctable class\x3d"dojoxGridRowbarTable" style\x3d"width:'+
(this.contentWidth||0)+'px;height:1px;" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctr\x3e\x3ctd class\x3d"dojoxGridRowbarInner"\x3e\x26nbsp;\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e'},renderHeader:function(){},updateRow:function(){},resize:function(){this.adaptHeight()},adaptWidth:function(){!("contentWidth"in this)&&this.contentNode&&0<this.contentNode.offsetWidth&&(this.contentWidth=this.contentNode.offsetWidth-this.padBorderWidth)},doStyleRowNode:function(A,w){var q=
["dojoxGridRowbar dojoxGridNonNormalizedCell"];this.grid.rows.isOver(A)&&q.push("dojoxGridRowbarOver");this.grid.selection.isSelected(A)&&q.push("dojoxGridRowbarSelected");w.className=q.join(" ")},domouseover:function(A){this.grid.onMouseOverRow(A)},domouseout:function(A){if(!this.isIntraRowEvent(A))this.grid.onMouseOutRow(A)}})})},"dojox/grid/_View":function(){define("dojo dijit/registry ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/connect dojo/_base/sniff dojo/query dojo/_base/window dojo/text!./resources/View.html dojo/dnd/Source dijit/_Widget dijit/_TemplatedMixin dojox/html/metrics ./util dojo/_base/html ./_Builder dojo/dnd/Avatar dojo/dnd/Manager".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k,t,y){a=w("dojox.grid._View",[n,m],{defaultWidth:"18em",viewWidth:"",templateString:a,classTag:"dojoxGrid",marginBottom:0,rowPad:2,_togglingColumn:-1,_headerBuilderClass:k._HeaderBuilder,_contentBuilderClass:k._ContentBuilder,postMixInProperties:function(){this.rowNodes={}},postCreate:function(){this.connect(this.scrollboxNode,"onscroll","doscroll");c.funnelEvents(this.contentNode,this,"doContentEvent","mouseover mouseout click dblclick contextmenu mousedown".split(" "));
c.funnelEvents(this.headerNode,this,"doHeaderEvent","dblclick mouseover mouseout mousemove mousedown click contextmenu".split(" "));this.content=new this._contentBuilderClass(this);this.header=new this._headerBuilderClass(this);this.grid.isLeftToRight()||(this.headerNodeContainer.style.width="")},destroy:function(){g.destroy(this.headerNode);delete this.headerNode;for(var r in this.rowNodes)this._cleanupRowWidgets(this.rowNodes[r]),g.destroy(this.rowNodes[r]);this.rowNodes={};this.source&&this.source.destroy();
this.inherited(arguments)},focus:function(){e("ie")||e("webkit")||e("opera")?this.hiddenFocusNode.focus():this.scrollboxNode.focus()},setStructure:function(r){r=this.structure=r;r.width&&!isNaN(r.width)?this.viewWidth=r.width+"em":this.viewWidth=r.width||(r.noscroll?"auto":this.viewWidth);this._onBeforeRow=r.onBeforeRow||function(){};this._onAfterRow=r.onAfterRow||function(){};if(this.noscroll=r.noscroll)this.scrollboxNode.style.overflow="hidden";this.simpleStructure=1==r.cells.length;this.testFlexCells();
this.updateStructure()},_cleanupRowWidgets:function(r){r&&q.forEach(l("[widgetId]",r).map(B.byNode),function(E){E._destroyOnRemove?(E.destroy(),delete E):E.domNode&&E.domNode.parentNode&&E.domNode.parentNode.removeChild(E.domNode)})},onBeforeRow:function(r,E){this._onBeforeRow(r,E);0<=r&&this._cleanupRowWidgets(this.getRowNode(r))},onAfterRow:function(r,E,F){this._onAfterRow(r,E,F);var u=this.grid;q.forEach(l(".dojoxGridStubNode",F),function(D){if(D&&D.parentNode){var z=D.getAttribute("linkWidget"),
M=window.parseInt(g.attr(D,"cellIdx"),10);u.getCell(M);(z=B.byId(z))?(D.parentNode.replaceChild(z.domNode,D),z._started||z.startup(),G.destroy(D)):D.innerHTML=""}},this)},testFlexCells:function(){this.flexCells=!1;for(var r=0,E;E=this.structure.cells[r];r++)for(var F=0,u;u=E[F];F++)u.view=this,this.flexCells=this.flexCells||u.isFlex();return this.flexCells},updateStructure:function(){this.header.update();this.content.update()},getScrollbarWidth:function(){var r=this.hasVScrollbar(),E=g.style(this.scrollboxNode,
"overflow");this.noscroll||!E||"hidden"==E?r=!1:"scroll"==E&&(r=!0);return r?d.getScrollbar().w:0},getColumnsWidth:function(){var r=this.headerContentNode;return r&&r.firstChild?r.firstChild.offsetWidth||g.style(r.firstChild,"width"):0},setColumnsWidth:function(r){this.headerContentNode.firstChild.style.width=r+"px";this.viewWidth&&(this.viewWidth=r+"px")},getWidth:function(){return this.viewWidth||this.getColumnsWidth()+this.getScrollbarWidth()+"px"},getContentWidth:function(){return Math.max(0,
g._getContentBox(this.domNode).w-this.getScrollbarWidth())+"px"},render:function(){this.scrollboxNode.style.height="";this.renderHeader();0<=this._togglingColumn&&(this.setColumnsWidth(this.getColumnsWidth()-this._togglingColumn),this._togglingColumn=-1);var r=this.grid.layout.cells,E=h.hitch(this,function(u,D){!this.grid.isLeftToRight()&&(D=!D);D=D?-1:1;u=this.header.getCellNodeIndex(u)+D;for(var z=r[u];z&&z.getHeaderNode()&&"none"==z.getHeaderNode().style.display;)u+=D,z=r[u];return z?z.getHeaderNode():
null});if(this.grid.columnReordering&&this.simpleStructure){this.source&&this.source.destroy();this.bottomMarker&&g.destroy(this.bottomMarker);this.bottomMarker=g.byId("dojoxGrid_bottomMarker");this.topMarker&&g.destroy(this.topMarker);this.topMarker=g.byId("dojoxGrid_topMarker");this.bottomMarker||(this.bottomMarker=g.create("div",{id:"dojoxGrid_bottomMarker","class":"dojoxGridColPlaceBottom"},b.body()),this._hide(this.bottomMarker),this.topMarker=g.create("div",{id:"dojoxGrid_topMarker","class":"dojoxGridColPlaceTop"},
b.body()),this._hide(this.topMarker));this.arrowDim=g.contentBox(this.bottomMarker);var F=g.contentBox(this.headerContentNode.firstChild.rows[0]).h;this.source=new f(this.headerContentNode.firstChild.rows[0],{horizontal:!0,accept:["gridColumn_"+this.grid.id],viewIndex:this.index,generateText:!1,onMouseDown:h.hitch(this,function(u){this.header.decorateEvent(u);if((this.header.overRightResizeArea(u)||this.header.overLeftResizeArea(u))&&this.header.canResize(u)&&!this.header.moveable)this.header.beginColumnResize(u);
else{if(this.grid.headerMenu)this.grid.headerMenu.onCancel(!0);u.button===(9>e("ie")?1:0)&&f.prototype.onMouseDown.call(this.source,u)}}),onMouseOver:h.hitch(this,function(u){var D=this.source;D._getChildByEvent(u)&&f.prototype.onMouseOver.apply(D,arguments)}),_markTargetAnchor:h.hitch(this,function(u){var D=this.source;if(D.current!=D.targetAnchor||D.before!=u){D.targetAnchor&&E(D.targetAnchor,D.before)&&D._removeItemClass(E(D.targetAnchor,D.before),D.before?"After":"Before");f.prototype._markTargetAnchor.call(D,
u);var z=u?D.targetAnchor:E(D.targetAnchor,D.before);u=0;z||(z=D.targetAnchor,u=g.contentBox(z).w+this.arrowDim.w/2+2);z=g.position(z,!0);u=Math.floor(z.x-this.arrowDim.w/2+u);g.style(this.bottomMarker,"visibility","visible");g.style(this.topMarker,"visibility","visible");g.style(this.bottomMarker,{left:u+"px",top:F+z.y+"px"});g.style(this.topMarker,{left:u+"px",top:z.y-this.arrowDim.h+"px"});D.targetAnchor&&E(D.targetAnchor,D.before)&&D._addItemClass(E(D.targetAnchor,D.before),D.before?"After":"Before")}}),
_unmarkTargetAnchor:h.hitch(this,function(){var u=this.source;u.targetAnchor&&(u.targetAnchor&&E(u.targetAnchor,u.before)&&u._removeItemClass(E(u.targetAnchor,u.before),u.before?"After":"Before"),this._hide(this.bottomMarker),this._hide(this.topMarker),f.prototype._unmarkTargetAnchor.call(u))}),destroy:h.hitch(this,function(){p.disconnect(this._source_conn);p.unsubscribe(this._source_sub);f.prototype.destroy.call(this.source);this.bottomMarker&&(g.destroy(this.bottomMarker),delete this.bottomMarker);
this.topMarker&&(g.destroy(this.topMarker),delete this.topMarker)}),onDndCancel:h.hitch(this,function(){f.prototype.onDndCancel.call(this.source);this._hide(this.bottomMarker);this._hide(this.topMarker)})});this._source_conn=p.connect(this.source,"onDndDrop",this,"_onDndDrop");this._source_sub=p.subscribe("/dnd/drop/before",this,"_onDndDropBefore");this.source.startup()}},_hide:function(r){g.style(r,{top:"-10000px",visibility:"hidden"})},_onDndDropBefore:function(r,E,F){y.manager().target===this.source&&
(this.source._targetNode=this.source.targetAnchor,this.source._beforeTarget=this.source.before,E=this.grid.views.views,r=E[r.viewIndex],E=E[this.index],E!=r&&(r.convertColPctToFixed(),E.convertColPctToFixed()))},_onDndDrop:function(r,E,F){if(y.manager().target!==this.source)y.manager().source===this.source&&(this._removingColumn=!0);else{this._hide(this.bottomMarker);this._hide(this.topMarker);F=function(H){return H?g.attr(H,"idx"):null};var u=g.marginBox(E[0]).w;if(r.viewIndex!==this.index){var D=
this.grid.views.views,z=D[r.viewIndex];D=D[this.index];z.viewWidth&&"auto"!=z.viewWidth&&z.setColumnsWidth(z.getColumnsWidth()-u);D.viewWidth&&"auto"!=D.viewWidth&&D.setColumnsWidth(D.getColumnsWidth())}u=this.source._targetNode;z=this.source._beforeTarget;!this.grid.isLeftToRight()&&(z=!z);D=this.grid.layout;var M=this.index;delete this.source._targetNode;delete this.source._beforeTarget;D.moveColumn(r.viewIndex,M,F(E[0]),F(u),z)}},renderHeader:function(){this.headerContentNode.innerHTML=this.header.generateHtml(this._getHeaderContent);
this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);c.fire(this,"onAfterRow",[-1,this.structure.cells,this.headerContentNode])},_getHeaderContent:function(r){var E=r.name||r.grid.getCellName(r);/^\s+$/.test(E)&&(E="\x26nbsp;");var F=['\x3cdiv class\x3d"dojoxGridSortNode'];r.index!=r.grid.getSortIndex()?F.push('"\x3e'):F=F.concat([" ",0<r.grid.sortInfo?"dojoxGridSortUp":"dojoxGridSortDown",'"\x3e\x3cdiv class\x3d"dojoxGridArrowButtonChar"\x3e',
0<r.grid.sortInfo?"\x26#9650;":"\x26#9660;",'\x3c/div\x3e\x3cdiv class\x3d"dojoxGridArrowButtonNode" role\x3d"presentation"\x3e\x3c/div\x3e','\x3cdiv class\x3d"dojoxGridColCaption"\x3e']);F=F.concat([E,"\x3c/div\x3e\x3c/div\x3e"]);return F.join("")},resize:function(){this.adaptHeight();this.adaptWidth()},hasHScrollbar:function(r){var E=this._hasHScroll||!1;if(void 0==this._hasHScroll||r)this.noscroll?this._hasHScroll=!1:(r=g.style(this.scrollboxNode,"overflow"),this._hasHScroll="hidden"==r?!1:"scroll"==
r?!0:this.scrollboxNode.offsetWidth-this.getScrollbarWidth()<this.contentNode.offsetWidth);E!==this._hasHScroll&&this.grid.update();return this._hasHScroll},hasVScrollbar:function(r){var E=this._hasVScroll||!1;if(void 0==this._hasVScroll||r)this.noscroll?this._hasVScroll=!1:(r=g.style(this.scrollboxNode,"overflow"),this._hasVScroll="hidden"==r?!1:"scroll"==r?!0:this.scrollboxNode.scrollHeight>this.scrollboxNode.clientHeight);E!==this._hasVScroll&&this.grid.update();return this._hasVScroll},convertColPctToFixed:function(){var r=
!1;this.grid.initialWidth="";var E=l("th",this.headerContentNode),F=q.map(E,function(u,D){var z=u.style.width;g.attr(u,"vIdx",D);if(z&&"%"==z.slice(-1))r=!0;else if(z&&"px"==z.slice(-2))return window.parseInt(z,10);return g.contentBox(u).w});return r?(q.forEach(this.grid.layout.cells,function(u,D){if(u.view==this&&(u=u.view.getHeaderCellNode(u.index))&&g.hasAttr(u,"vIdx")){var z=window.parseInt(g.attr(u,"vIdx"));this.setColWidth(D,F[z]);g.removeAttr(u,"vIdx")}},this),!0):!1},adaptHeight:function(r){if(!this.grid._autoHeight){var E=
this.domNode.style.height&&parseInt(this.domNode.style.height.replace(/px/,""),10)||this.domNode.clientHeight;if(!r&&(r=this.noscroll))a:{for(var F=0;F<this.grid.views.views.length;++F)if(r=this.grid.views.views[F],r!==this&&r.hasHScrollbar()){r=!0;break a}r=!1}r&&(E-=d.getScrollbar().h);c.setStyleHeightPx(this.scrollboxNode,E)}this.hasVScrollbar(!0)},adaptWidth:function(){this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);var r=
this.scrollboxNode.offsetWidth-this.getScrollbarWidth();this._removingColumn?(r=Math.min(r,this.getColumnsWidth())+"px",this._removingColumn=!1):r=Math.max(r,this.getColumnsWidth())+"px";this.contentNode.style.width=r;this.hasHScrollbar(!0)},setSize:function(r,E){var F=this.domNode.style,u=this.headerNode.style;r&&(F.width=r,u.width=r);F.height=0<=E?E+"px":""},renderRow:function(r){var E=this.createRowNode(r);this.buildRow(r,E);return E},createRowNode:function(r){var E=document.createElement("div");
E.className=this.classTag+"Row";this instanceof A.grid._RowSelector?g.attr(E,"role","presentation"):(g.attr(E,"role","row"),"none"!=this.grid.selectionMode&&E.setAttribute("aria-selected","false"));E[c.gridViewTag]=this.id;E[c.rowIndexTag]=r;return this.rowNodes[r]=E},buildRow:function(r,E){this.buildRowContent(r,E);this.styleRow(r,E)},buildRowContent:function(r,E){E.innerHTML=this.content.generateHtml(r,r);this.flexCells&&this.contentWidth&&(E.firstChild.style.width=this.contentWidth);c.fire(this,
"onAfterRow",[r,this.structure.cells,E])},rowRemoved:function(r){0<=r&&this._cleanupRowWidgets(this.getRowNode(r));this.grid.edit.save(this,r);delete this.rowNodes[r]},getRowNode:function(r){return this.rowNodes[r]},getCellNode:function(r,E){if(r=this.getRowNode(r))return this.content.getCellNode(r,E)},getHeaderCellNode:function(r){if(this.headerContentNode)return this.header.getCellNode(this.headerContentNode,r)},styleRow:function(r,E){var F=void 0==E.style.cssText?E.getAttribute("style"):E.style.cssText;
E._style=F;this.styleRowNode(r,E)},styleRowNode:function(r,E){E&&this.doStyleRowNode(r,E)},doStyleRowNode:function(r,E){this.grid.styleRowNode(r,E)},updateRow:function(r){var E=this.getRowNode(r);E&&(E.style.height="",this.buildRow(r,E));return E},updateRowStyles:function(r){this.styleRowNode(r,this.getRowNode(r))},lastTop:0,firstScroll:0,_nativeScroll:!1,doscroll:function(r){if(13<=e("ff")||e("chrome"))this._nativeScroll=!0;r=this.grid.isLeftToRight();if(2>this.firstScroll){if(!r&&1==this.firstScroll||
r&&0===this.firstScroll){var E=g.marginBox(this.headerNodeContainer);e("ie")?this.headerNodeContainer.style.width=E.w+this.getScrollbarWidth()+"px":e("mozilla")&&(this.headerNodeContainer.style.width=E.w-this.getScrollbarWidth()+"px",this.scrollboxNode.scrollLeft=r?this.scrollboxNode.clientWidth-this.scrollboxNode.scrollWidth:this.scrollboxNode.scrollWidth-this.scrollboxNode.clientWidth)}this.firstScroll++}this.headerNode.scrollLeft=this.scrollboxNode.scrollLeft;r=this.scrollboxNode.scrollTop;r!==
this.lastTop&&this.grid.scrollTo(r);this._nativeScroll=!1},setScrollTop:function(r){this.lastTop=r;this._nativeScroll||(this.scrollboxNode.scrollTop=r);return this.scrollboxNode.scrollTop},doContentEvent:function(r){if(this.content.decorateEvent(r))this.grid.onContentEvent(r)},doHeaderEvent:function(r){if(this.header.decorateEvent(r))this.grid.onHeaderEvent(r)},dispatchContentEvent:function(r){return this.content.dispatchEvent(r)},dispatchHeaderEvent:function(r){return this.header.dispatchEvent(r)},
setColWidth:function(r,E){this.grid.setCellWidth(r,E+"px")},update:function(){if(this.domNode){this.content.update();this.grid.update();var r=this.scrollboxNode.scrollLeft;this.scrollboxNode.scrollLeft=r;this.headerNode.scrollLeft=r}}});var K=w("dojox.grid._GridAvatar",t,{construct:function(){var r=b.doc,E=r.createElement("table");E.cellPadding=E.cellSpacing="0";E.className="dojoxGridDndAvatar";E.style.position="absolute";E.style.zIndex=1999;E.style.margin="0px";var F=r.createElement("tbody"),u=r.createElement("tr"),
D=r.createElement("td"),z=r.createElement("td");u.className="dojoxGridDndAvatarItem";z.className="dojoxGridDndAvatarItemImage";z.style.width="16px";var M=this.manager.source;if(M.creator)M=M._normalizedCreator(M.getItem(this.manager.nodes[0].id).data,"avatar").node;else if(M=this.manager.nodes[0].cloneNode(!0),"tr"==M.tagName.toLowerCase()){var H=r.createElement("table");var x=r.createElement("tbody");x.appendChild(M);H.appendChild(x);M=H}else"th"==M.tagName.toLowerCase()&&(H=r.createElement("table"),
x=r.createElement("tbody"),r=r.createElement("tr"),H.cellPadding=H.cellSpacing="0",r.appendChild(M),x.appendChild(r),H.appendChild(x),M=H);M.id="";D.appendChild(M);u.appendChild(z);u.appendChild(D);g.style(u,"opacity",.9);F.appendChild(u);E.appendChild(F);this.node=E;E=y.manager();this.oldOffsetY=E.OFFSET_Y;E.OFFSET_Y=1},destroy:function(){y.manager().OFFSET_Y=this.oldOffsetY;this.inherited(arguments)}}),C=y.manager().makeAvatar;y.manager().makeAvatar=function(){return void 0===this.source.viewIndex||
g.hasClass(b.body(),"dijit_a11y")?C.call(y.manager()):new K(this)};return a})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f){A.isAsync||e(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var n=B("dojo.dnd.Source",a,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,
autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(m,d){w.mixin(this,w.mixin({},d));m=this.accept;if(m.length)for(this.accept={},d=0;d<m.length;++d)this.accept[m[d]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&q.add(this.node,"dojoDndSource");this.targetState="";this.accept&&q.add(this.node,"dojoDndTarget");this.horizontal&&q.add(this.node,"dojoDndHorizontal");this.topics=
[l.subscribe("/dnd/source/over",w.hitch(this,"onDndSourceOver")),l.subscribe("/dnd/start",w.hitch(this,"onDndStart")),l.subscribe("/dnd/drop",w.hitch(this,"onDndDrop")),l.subscribe("/dnd/cancel",w.hitch(this,"onDndCancel"))]},checkAcceptance:function(m,d){if(this==m)return!this.copyOnly||this.selfAccept;for(var c=0;c<d.length;++c){for(var g=m.getItem(d[c].id).type,k=!1,t=0;t<g.length;++t)if(g[t]in this.accept){k=!0;break}if(!k)return!1}return!0},copyState:function(m,d){if(m)return!0;2>arguments.length&&
(d=this==f.manager().target);if(d){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){n.superclass.destroy.call(this);G.forEach(this.topics,function(m){m.remove()});this.targetAnchor=null},onMouseMove:function(m){if(!this.isDragging||"Disabled"!=this.targetState){n.superclass.onMouseMove.call(this,m);var d=f.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(m.pageX-this._lastX)>this.delay||Math.abs(m.pageY-this._lastY)>this.delay)){var c=
this.getSelectedNodes();c.length&&d.startDrag(this,c,this.copyState(b.getCopyKeyState(m),!0))}this.isDragging&&(c=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=h.position(this.current,!0)),c=this.horizontal?m.pageX-this.targetBox.x<this.targetBox.w/2==h.isBodyLtr(this.current.ownerDocument):m.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||c!=this.before)&&(this._markTargetAnchor(c),d.canDrop(!this.current||d.source!=this||!(this.current.id in
this.selection)))}},onMouseDown:function(m){this.mouseDown||!this._legalMouseDown(m)||this.skipForm&&b.isFormElement(m)||(this.mouseDown=!0,this._lastX=m.pageX,this._lastY=m.pageY,n.superclass.onMouseDown.call(this,m))},onMouseUp:function(m){this.mouseDown&&(this.mouseDown=!1,n.superclass.onMouseUp.call(this,m))},onDndSourceOver:function(m){this!==m?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(m=f.manager(),m.canDrop("Disabled"!=this.targetState&&(!this.current||
m.source!=this||!(this.current.id in this.selection))))},onDndStart:function(m,d,c){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==m?c?"Copied":"Moved":"");d=this.accept&&this.checkAcceptance(m,d);this._changeState("Target",d?"":"Disabled");this==m&&f.manager().overSource(this);this.isDragging=!0},onDndDrop:function(m,d,c,g){if(this==g)this.onDrop(m,d,c);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=
!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(m,d,c){if(this!=m)this.onDropExternal(m,d,c);else this.onDropInternal(d,c)},onDropExternal:function(m,d,c){var g=this._normalizedCreator;this._normalizedCreator=this.creator?function(k,t){return g.call(this,m.getItem(k.id).data,t)}:c?function(k){var t=m.getItem(k.id);k=k.cloneNode(!0);k.id=b.getUniqueId();return{node:k,data:t.data,type:t.type}}:function(k){var t=m.getItem(k.id);m.delItem(k.id);
return{node:k,data:t.data,type:t.type}};this.selectNone();c||this.creator||m.selectNone();this.insertNodes(!0,d,this.before,this.current);!c&&this.creator&&m.deleteSelectedNodes();this._normalizedCreator=g},onDropInternal:function(m,d){var c=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(d)this._normalizedCreator=this.creator?function(g,k){return c.call(this,this.getItem(g.id).data,k)}:function(g){var k=this.getItem(g.id);g=g.cloneNode(!0);g.id=b.getUniqueId();return{node:g,
data:k.data,type:k.type}};else{if(!this.current)return;this._normalizedCreator=function(g){var k=this.getItem(g.id);return{node:g,data:k.data,type:k.type}}}this._removeSelection();this.insertNodes(!0,m,this.before,this.current);this._normalizedCreator=c}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){n.superclass.onOverEvent.call(this);f.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){n.superclass.onOutEvent.call(this);
f.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(m){if(this.current!=this.targetAnchor||this.before!=m)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=m,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(m){this._changeState("Source",m?"Copied":"Moved")},_legalMouseDown:function(m){if("touchstart"!=m.type&&!p.isLeft(m))return!1;if(!this.withHandles)return!0;for(m=m.target;m&&m!==this.node;m=m.parentNode){if(q.contains(m,"dojoDndHandle"))return!0;if(q.contains(m,"dojoDndItem")||q.contains(m,"dojoDndIgnore"))break}return!1}});return n})},"dojo/dnd/common":function(){define(["../sniff","../_base/kernel",
"../_base/lang","../dom"],function(G,B,A,w){var q=A.getObject("dojo.dnd",!0);q.getCopyKeyState=function(h){return h[G("mac")?"metaKey":"ctrlKey"]};q._uniqueId=0;q.getUniqueId=function(){do var h=B._scopeName+"Unique"+ ++q._uniqueId;while(w.byId(h));return h};q._empty={};q.isFormElement=function(h){h=h.target;3==h.nodeType&&(h=h.parentNode);return 0<=" a button textarea input select option ".indexOf(" "+h.tagName.toLowerCase()+" ")};return q})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f){var n=B("dojo.dnd.Selector",f,{constructor:function(m,d){d||(d={});this.singular=d.singular;this.autoSync=d.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(l(this.node,b.press,w.hitch(this,"onMouseDown")),l(this.node,b.release,w.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var m=new e,d=a._empty,c;for(c in this.selection)c in d||m.push(q.byId(c));return m},selectNone:function(){return this._removeSelection()._removeAnchor()},
selectAll:function(){this.forInItems(function(m,d){this._addItemClass(q.byId(d),"Selected");this.selection[d]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var m=a._empty,d;for(d in this.selection)if(!(d in m)){var c=q.byId(d);this.delItem(d);h.destroy(c)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(m,d){d=d||A.global;var c=this.selection,g=a._empty,k;for(k in c)k in g||m.call(d,this.getItem(k),k,this)},sync:function(){n.superclass.sync.call(this);
this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var m=[],d=a._empty,c;for(c in this.selection)c in d||this.getItem(c)||m.push(c);G.forEach(m,function(g){delete this.selection[g]},this);return this},insertNodes:function(m,d,c,g){var k=this._normalizedCreator;this._normalizedCreator=function(t,y){t=k.call(this,t,y);m?(this.anchor?this.anchor!=t.node&&(this._removeItemClass(t.node,"Anchor"),this._addItemClass(t.node,"Selected")):(this.anchor=t.node,this._removeItemClass(t.node,"Selected"),
this._addItemClass(this.anchor,"Anchor")),this.selection[t.node.id]=1):(this._removeItemClass(t.node,"Selected"),this._removeItemClass(t.node,"Anchor"));return t};n.superclass.insertNodes.call(this,d,c,g);this._normalizedCreator=k;return this},destroy:function(){n.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(m){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!a.getCopyKeyState(m)&&!m.shiftKey&&this.current.id in this.selection)this.simpleSelection=
!0,p.isLeft(m)&&(m.stopPropagation(),m.preventDefault());else{if(!this.singular&&m.shiftKey){a.getCopyKeyState(m)||this._removeSelection();var d=this.getAllNodes();if(d.length&&(this.anchor||(this.anchor=d[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var c=0,g;c<d.length&&(g=d[c],g!=this.anchor&&g!=this.current);++c);for(++c;c<d.length;++c){g=d[c];if(g==this.anchor||g==this.current)break;this._addItemClass(g,"Selected");this.selection[g.id]=
1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?a.getCopyKeyState(m)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):a.getCopyKeyState(m)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):
(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);m.stopPropagation();m.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&
(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=l(this.node,b.move,w.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var m=a._empty,d;for(d in this.selection)if(!(d in m)){var c=q.byId(d);c&&this._removeItemClass(c,"Selected")}this.selection=
{};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return n})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f,n,m){B=B("dojo.dnd.Container",l,{skipForm:!1,allowNested:!1,constructor:function(d,c){this.node=h.byId(d);
c||(c={});this.creator=c.creator||null;this.skipForm=c.skipForm;this.parent=c.dropParent&&h.byId(c.dropParent);this.map={};this.current=null;this.containerState="";p.add(this.node,"dojoDndContainer");c&&c._skipStartup||this.startup();this.events=[a(this.node,n.over,w.hitch(this,"onMouseOver")),a(this.node,n.out,w.hitch(this,"onMouseOut")),a(this.node,"dragstart",w.hitch(this,"onSelectStart")),a(this.node,"selectstart",w.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(d){return this.map[d]},
setItem:function(d,c){this.map[d]=c},delItem:function(d){delete this.map[d]},forInItems:function(d,c){c=c||A.global;var g=this.map,k=m._empty,t;for(t in g)t in k||d.call(c,g[t],t,this);return c},clearItems:function(){this.map={}},getAllNodes:function(){return f((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var d={};this.getAllNodes().forEach(function(c){if(c.id){var g=this.getItem(c.id);if(g){d[c.id]=g;return}}else c.id=m.getUniqueId();g=c.getAttribute("dndType");var k=
c.getAttribute("dndData");d[c.id]={data:k||c.innerHTML,type:g?g.split(/\s*,\s*/):["text"]}},this);this.map=d;return this},insertNodes:function(d,c,g){this.parent.firstChild?c?g||(g=this.parent.firstChild):g&&(g=g.nextSibling):g=null;if(g)for(c=0;c<d.length;++c){var k=this._normalizedCreator(d[c]);this.setItem(k.node.id,{data:k.data,type:k.type});g.parentNode.insertBefore(k.node,g)}else for(c=0;c<d.length;++c)k=this._normalizedCreator(d[c]),this.setItem(k.node.id,{data:k.data,type:k.type}),this.parent.appendChild(k.node);
return this},destroy:function(){G.forEach(this.events,function(d){d.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(d,c,g){d._skipStartup=!0;return new g(c,d)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var d=this.parent.getElementsByTagName("tbody");d&&d.length&&(this.parent=d[0])}this.defaultCreator=m._defaultCreator(this.parent);this.sync()},onMouseOver:function(d){for(var c=d.relatedTarget;c&&
c!=this.node;)try{c=c.parentNode}catch(g){c=null}c||(this._changeState("Container","Over"),this.onOverEvent());c=this._getChildByEvent(d);this.current!=c&&(this.current&&this._removeItemClass(this.current,"Over"),c&&this._addItemClass(c,"Over"),this.current=c)},onMouseOut:function(d){for(d=d.relatedTarget;d;){if(d==this.node)return;try{d=d.parentNode}catch(c){d=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(d){this.withHandles||
this.skipForm&&m.isFormElement(d)||(d.stopPropagation(),d.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(d,c){var g="dojoDnd"+d;d=d.toLowerCase()+"State";p.replace(this.node,g+c,g+this[d]);this[d]=c},_addItemClass:function(d,c){p.add(d,"dojoDndItem"+c)},_removeItemClass:function(d,c){p.remove(d,"dojoDndItem"+c)},_getChildByEvent:function(d){if(d=d.target)for(var c=d.parentNode;c;d=c,c=d.parentNode)if((c==this.parent||this.allowNested)&&p.contains(d,"dojoDndItem"))return d;
return null},_normalizedCreator:function(d,c){d=(this.creator||this.defaultCreator).call(this,d,c);w.isArray(d.type)||(d.type=["text"]);d.node.id||(d.node.id=m.getUniqueId());p.add(d.node,"dojoDndItem");return d}});m._createNode=function(d){return d?function(c){return e.create(d,{innerHTML:c})}:m._createSpan};m._createTrTd=function(d){var c=e.create("tr");e.create("td",{innerHTML:d},c);return c};m._createSpan=function(d){return e.create("span",{innerHTML:d})};m._defaultCreatorNodes={ul:"li",ol:"li",
div:"div",p:"div"};m._defaultCreator=function(d){d=d.tagName.toLowerCase();var c="tbody"==d||"thead"==d?m._createTrTd:m._createNode(m._defaultCreatorNodes[d]);return function(g,k){var t=g&&w.isObject(g);if(t&&g.tagName&&g.nodeType&&g.getAttribute){var y=g.getAttribute("dndData")||g.innerHTML;t=(t=g.getAttribute("dndType"))?t.split(/\s*,\s*/):["text"]}else y=t&&g.data?g.data:g,t=t&&g.type?g.type:["text"],g=("avatar"==k?m._createSpan:c)(String(y));g.id||(g.id=m.getUniqueId());return{node:g,data:y,type:t}}};
return B})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f,n,m){var d=B("dojo.dnd.Manager",[h],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:p("touch")?4:16,OFFSET_Y:p("touch")?4:16,overSource:function(c){this.avatar&&
(this.target=c&&"Disabled"!=c.targetState?c:null,this.canDropFlag=!!this.target,this.avatar.update());b.publish("/dnd/source/over",c)},outSource:function(c){this.avatar?this.target==c&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),b.publish("/dnd/source/over",null)):b.publish("/dnd/source/over",null)},startDrag:function(c,g,k){function t(y){y.preventDefault();y.stopPropagation()}n.autoScrollStart(w.doc);this.source=c;this.nodes=g;this.copy=!!k;this.avatar=this.makeAvatar();w.body().appendChild(this.avatar.node);
b.publish("/dnd/start",c,g,this.copy);this.events=[l(w.doc,a.move,A.hitch(this,"onMouseMove")),l(w.doc,a.release,A.hitch(this,"onMouseUp")),l(w.doc,"keydown",A.hitch(this,"onKeyDown")),l(w.doc,"keyup",A.hitch(this,"onKeyUp")),l(w.doc,"dragstart",t),l(w.body(),"selectstart",t)];c="dojoDnd"+(k?"Copy":"Move");q.add(w.body(),c)},canDrop:function(c){c=!(!this.target||!c);this.canDropFlag!=c&&(this.canDropFlag=c,this.avatar.update())},stopDrag:function(){q.remove(w.body(),["dojoDndCopy","dojoDndMove"]);
G.forEach(this.events,function(c){c.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new m(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(c){var g=this.avatar;g&&(n.autoScrollNodes(c),g=g.node.style,g.left=c.pageX+this.OFFSET_X+"px",g.top=c.pageY+this.OFFSET_Y+"px",g=!!this.source.copyState(f.getCopyKeyState(c)),this.copy!=g&&this._setCopyStatus(g));p("touch")&&c.preventDefault()},onMouseUp:function(c){if(this.avatar){if(this.target&&
this.canDropFlag){var g=!!this.source.copyState(f.getCopyKeyState(c));b.publish("/dnd/drop/before",this.source,this.nodes,g,this.target,c);b.publish("/dnd/drop",this.source,this.nodes,g,this.target,c)}else b.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(c){if(this.avatar)switch(c.keyCode){case e.CTRL:c=!!this.source.copyState(!0);this.copy!=c&&this._setCopyStatus(c);break;case e.ESCAPE:b.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(c){this.avatar&&c.keyCode==e.CTRL&&(c=
!!this.source.copyState(!1),this.copy!=c&&this._setCopyStatus(c))},_setCopyStatus:function(c){this.copy=c;this.source._markDndStatus(this.copy);this.updateAvatar();q.replace(w.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});f._manager=null;d.manager=f.manager=function(){f._manager||(f._manager=new d);return f._manager};return d})},"dojo/dnd/autoscroll":function(){define("../_base/lang ../sniff ../_base/window ../dom-geometry ../dom-style ../window".split(" "),function(G,
B,A,w,q,h){var p={};G.setObject("dojo.dnd.autoscroll",p);p.getViewport=h.getBox;p.V_TRIGGER_AUTOSCROLL=32;p.H_TRIGGER_AUTOSCROLL=32;p.V_AUTOSCROLL_VALUE=16;p.H_AUTOSCROLL_VALUE=16;var e,l=A.doc,b=Infinity,a=Infinity;p.autoScrollStart=function(f){l=f;e=h.getBox(l);f=A.body(l).parentNode;b=Math.max(f.scrollHeight-e.h,0);a=Math.max(f.scrollWidth-e.w,0)};p.autoScroll=function(f){var n=e||h.getBox(l),m=A.body(l).parentNode,d=0,c=0;f.clientX<p.H_TRIGGER_AUTOSCROLL?d=-p.H_AUTOSCROLL_VALUE:f.clientX>n.w-
p.H_TRIGGER_AUTOSCROLL&&(d=Math.min(p.H_AUTOSCROLL_VALUE,a-m.scrollLeft));f.clientY<p.V_TRIGGER_AUTOSCROLL?c=-p.V_AUTOSCROLL_VALUE:f.clientY>n.h-p.V_TRIGGER_AUTOSCROLL&&(c=Math.min(p.V_AUTOSCROLL_VALUE,b-m.scrollTop));window.scrollBy(d,c)};p._validNodes={div:1,p:1,td:1};p._validOverflow={auto:1,scroll:1};p.autoScrollNodes=function(f){for(var n,m,d,c,g,k=0,t=0,y=f.target;y;){if(1==y.nodeType&&y.tagName.toLowerCase()in p._validNodes){d=q.getComputedStyle(y);g=d.overflowX.toLowerCase()in p._validOverflow;
c=d.overflowY.toLowerCase()in p._validOverflow;if(g||c)n=w.getContentBox(y,d),m=w.position(y,!0);if(g){d=Math.min(p.H_TRIGGER_AUTOSCROLL,n.w/2);g=f.pageX-m.x;if(B("webkit")||B("opera"))g+=A.body().scrollLeft;k=0;0<g&&g<n.w&&(g<d?k=-d:g>n.w-d&&(k=d),y.scrollLeft+=k)}if(c){c=Math.min(p.V_TRIGGER_AUTOSCROLL,n.h/2);d=f.pageY-m.y;if(B("webkit")||B("opera"))d+=A.body().scrollTop;t=0;0<d&&d<n.h&&(d<c?t=-c:d>n.h-c&&(t=c),y.scrollTop+=t)}if(k||t)return}try{y=y.parentNode}catch(K){y=null}}p.autoScroll(f)};
return p})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(G,B,A,w,q,h,p,e){return G("dojo.dnd.Avatar",null,{constructor:function(l){this.manager=l;this.construct()},construct:function(){var l=h.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),b=this.manager.source,a=h.create("tbody",null,l),f=h.create("tr",null,a),n=h.create("td",null,f),m=
Math.min(5,this.manager.nodes.length),d=0;p("highcontrast")&&h.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},n);h.create("span",{innerHTML:b.generateText?this._generateText():""},n);for(w.set(f,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});d<m;++d){if(b.creator)var c=b._normalizedCreator(b.getItem(this.manager.nodes[d].id).data,"avatar").node;else c=this.manager.nodes[d].cloneNode(!0),"tr"==c.tagName.toLowerCase()&&(f=h.create("table"),h.create("tbody",null,f).appendChild(c),
c=f);c.id="";f=h.create("tr",null,a);n=h.create("td",null,f);n.appendChild(c);w.set(f,{"class":"dojoDndAvatarItem",style:{opacity:(9-d)/10}})}this.node=l},destroy:function(){h.destroy(this.node);this.node=!1},update:function(){q.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(p("highcontrast")){var l=A.byId("a11yIcon"),b="+";this.manager.canDropFlag&&!this.manager.copy?b="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(b="x"):b="o";l.innerHTML=b}e("tr.dojoDndAvatarHeader td span"+
(p("highcontrast")?" span":""),this.node).forEach(function(a){a.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dojox/html/metrics":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/sniff dojo/ready dojo/_base/unload dojo/_base/window dojo/dom-geometry".split(" "),function(G,B,A,w,q,h,p){var e=B.getObject("dojox.html.metrics",!0),l=B.getObject("dojox");e.getFontMeasurements=function(){var d=
{"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0};if(A("ie")){var c=h.doc.documentElement.style.fontSize||"";c||(h.doc.documentElement.style.fontSize="100%")}var g=h.doc.createElement("div"),k=g.style;k.position="absolute";k.left="-100px";k.top="0";k.width="30px";k.height="1000em";k.borderWidth="0";k.margin="0";k.padding="0";k.outline="0";k.lineHeight="1";k.overflow="hidden";h.body().appendChild(g);for(var t in d)k.fontSize=t,d[t]=
16*Math.round(12*g.offsetHeight/16)/12/1E3;A("ie")&&(h.doc.documentElement.style.fontSize=c);h.body().removeChild(g);g=null;return d};var b=null;e.getCachedFontMeasurements=function(d){if(d||!b)b=e.getFontMeasurements();return b};var a=null,f={};e.getTextBox=function(d,c,g){if(a)var k=a;else{k=a=h.doc.createElement("div");k.style.whiteSpace="nowrap";var t=h.doc.createElement("div");t.appendChild(k);var y=t.style;y.overflow="scroll";y.position="absolute";y.left="0px";y.top="-10000px";y.width="1px";
y.height="1px";y.visibility="hidden";y.borderWidth="0";y.margin="0";y.padding="0";y.outline="0";h.body().appendChild(t)}k.className="";y=k.style;y.borderWidth="0";y.margin="0";y.padding="0";y.outline="0";if(1<arguments.length&&c)for(var K in c)K in f||(y[K]=c[K]);2<arguments.length&&g&&(k.className=g);k.innerHTML=d;y=p.position(k);y.w=k.parentNode.scrollWidth;return y};var n=16,m=16;e.getScrollbar=function(){return{w:n,h:m}};e._fontResizeNode=null;e.initOnFontResize=function(d){var c=e._fontResizeNode=
h.doc.createElement("iframe");d=c.style;d.position="absolute";d.width="5em";d.height="10em";d.top="-10000px";d.display="none";A("ie")?c.onreadystatechange=function(){"complete"==c.contentWindow.document.readyState&&(c.onresize=c.contentWindow.parent[l._scopeName].html.metrics._fontresize)}:c.onload=function(){c.contentWindow.onresize=c.contentWindow.parent[l._scopeName].html.metrics._fontresize};c.setAttribute("src","javascript:'\x3chtml\x3e\x3chead\x3e\x3cscript\x3eif(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}\x3c/script\x3e\x3c/head\x3e\x3cbody\x3e\x3c/body\x3e\x3c/html\x3e'");
h.body().appendChild(c);e.initOnFontResize=function(){}};e.onFontResize=function(){};e._fontresize=function(){e.onFontResize()};q.addOnUnload(function(){var d=e._fontResizeNode;d&&(A("ie")&&d.onresize?d.onresize=null:d.contentWindow&&d.contentWindow.onresize&&(d.contentWindow.onresize=null),e._fontResizeNode=null)});w(function(){try{var d=h.doc.createElement("div");d.style.cssText="top:0;left:0;width:100px;height:100px;overflow:scroll;position:absolute;visibility:hidden;";h.body().appendChild(d);
n=d.offsetWidth-d.clientWidth;m=d.offsetHeight-d.clientHeight;h.body().removeChild(d);delete d}catch(c){}"fontSizeWatch"in G.config&&G.config.fontSizeWatch&&e.initOnFontResize()});return e})},"dojox/grid/_Builder":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/window dojo/_base/event dojo/_base/sniff dojo/_base/connect dojo/dnd/Moveable dojox/html/metrics ./util dojo/_base/html dojo/dom-geometry".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f){var n=G.grid,m=function(C){return 0<=
C.rowIndex?C.rowIndex:B.indexOf(C.parentNode.childNodes,C)},d=function(C,r){return C&&((C.rows||0)[r]||C.childNodes[r])},c=function(C){for(;C&&"TABLE"!=C.tagName;C=C.parentNode);return C},g=function(C){var r=C.toUpperCase();return function(E){return E.tagName!=r}},k=b.rowIndexTag,t=b.gridViewTag,y=n._Builder=A.extend(function(C){C&&(this.view=C,this.grid=C.grid)},{view:null,_table:'\x3ctable class\x3d"dojoxGridRowTable" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"',getTableArray:function(){var C=
[this._table];this.view.viewWidth&&C.push([' style\x3d"width:',this.view.viewWidth,';"'].join(""));C.push("\x3e");return C},generateCellMarkup:function(C,r,E,F){var u=[];if(F){var D=C.index!=C.grid.getSortIndex()?"":0<C.grid.sortInfo?'aria-sort\x3d"ascending"':'aria-sort\x3d"descending"';C.id||(C.id=this.grid.id+"Hdr"+C.index);D=['\x3cth tabIndex\x3d"-1" aria-readonly\x3d"true" role\x3d"columnheader"',D,' id\x3d"',C.id,'"']}else D=['\x3ctd tabIndex\x3d"-1" role\x3d"gridcell"',this.grid.editable&&
!C.editable?'aria-readonly\x3d"true"':""];C.colSpan&&D.push(' colspan\x3d"',C.colSpan,'"');C.rowSpan&&D.push(' rowspan\x3d"',C.rowSpan,'"');D.push(' class\x3d"dojoxGridCell ');C.classes&&D.push(C.classes," ");E&&D.push(E," ");u.push(D.join(""));u.push("");D=['" idx\x3d"',C.index,'" style\x3d"'];r&&";"!=r[r.length-1]&&(r+=";");D.push(C.styles,r||"",C.hidden?"display:none;":"");C.unitWidth&&D.push("width:",C.unitWidth,";");u.push(D.join(""));u.push("");D=['"'];C.attrs&&D.push(" ",C.attrs);D.push("\x3e");
u.push(D.join(""));u.push("");u.push(F?"\x3c/th\x3e":"\x3c/td\x3e");return u},isCellNode:function(C){return!(!C||C==w.doc||!a.attr(C,"idx"))},getCellNodeIndex:function(C){return C?Number(a.attr(C,"idx")):-1},getCellNode:function(C,r){for(var E=0,F;(F=d(C.firstChild,E))&&F.cells;E++)for(var u=0,D;D=F.cells[u];u++)if(this.getCellNodeIndex(D)==r)return D;return null},findCellTarget:function(C,r){for(;C&&(!this.isCellNode(C)||C.offsetParent&&t in C.offsetParent.parentNode&&C.offsetParent.parentNode[t]!=
this.view.id)&&C!=r;)C=C.parentNode;return C!=r?C:null},baseDecorateEvent:function(C){C.dispatch="do"+C.type;C.grid=this.grid;C.sourceView=this.view;C.cellNode=this.findCellTarget(C.target,C.rowNode);C.cellIndex=this.getCellNodeIndex(C.cellNode);C.cell=0<=C.cellIndex?this.grid.getCell(C.cellIndex):null},findTarget:function(C,r){for(;C&&C!=this.domNode&&(!(r in C)||t in C&&C[t]!=this.view.id);)C=C.parentNode;return C!=this.domNode?C:null},findRowTarget:function(C){return this.findTarget(C,k)},isIntraNodeEvent:function(C){try{return C.cellNode&&
C.relatedTarget&&a.isDescendant(C.relatedTarget,C.cellNode)}catch(r){return!1}},isIntraRowEvent:function(C){try{var r=C.relatedTarget&&this.findRowTarget(C.relatedTarget);return!r&&-1==C.rowIndex||r&&C.rowIndex==r.gridRowIndex}catch(E){return!1}},dispatchEvent:function(C){return C.dispatch in this?this[C.dispatch](C):!1},domouseover:function(C){C.cellNode&&C.cellNode!=this.lastOverCellNode&&(this.lastOverCellNode=C.cellNode,this.grid.onMouseOver(C));this.grid.onMouseOverRow(C)},domouseout:function(C){if(C.cellNode&&
C.cellNode==this.lastOverCellNode&&!this.isIntraNodeEvent(C,this.lastOverCellNode)&&(this.lastOverCellNode=null,this.grid.onMouseOut(C),!this.isIntraRowEvent(C)))this.grid.onMouseOutRow(C)},domousedown:function(C){if(C.cellNode)this.grid.onMouseDown(C);this.grid.onMouseDownRow(C)},_getTextDirStyle:function(C,r,E){return""}});G=n._ContentBuilder=A.extend(function(C){y.call(this,C)},y.prototype,{update:function(){this.prepareHtml()},prepareHtml:function(){for(var C=this.grid.get,r=this.view.structure.cells,
E=0,F;F=r[E];E++)for(var u=0,D;D=F[u];u++)D.get=D.get||void 0==D.value&&C,D.markup=this.generateCellMarkup(D,D.cellStyles,D.cellClasses,!1),!this.grid.editable&&D.editable&&(this.grid.editable=!0)},generateHtml:function(C,r){C=this.getTableArray();var E=this.view.structure.cells,F=this.grid.getItem(r);b.fire(this.view,"onBeforeRow",[r,E]);for(var u=0,D;D=E[u];u++)if(!D.hidden&&!D.header){C.push(D.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var z=0,M,H,x;M=D[z];z++){H=M.markup;
var J=M.customClasses=[];x=M.customStyles=[];H[5]=M.format(r,F);H[1]=J.join(" ");H[3]=x.join(";");(J=M.textDir||this.grid.textDir)&&(H[3]+=this._getTextDirStyle(J,M,r));C.push.apply(C,H)}C.push("\x3c/tr\x3e")}C.push("\x3c/table\x3e");return C.join("")},decorateEvent:function(C){C.rowNode=this.findRowTarget(C.target);if(!C.rowNode)return!1;C.rowIndex=C.rowNode[k];this.baseDecorateEvent(C);C.cell=this.grid.getCell(C.cellIndex);return!0}});var K=n._HeaderBuilder=A.extend(function(C){this.moveable=null;
y.call(this,C)},y.prototype,{_skipBogusClicks:!1,overResizeWidth:4,minColWidth:1,update:function(){this.tableMap?this.tableMap.mapRows(this.view.structure.cells):this.tableMap=new n._TableMap(this.view.structure.cells)},generateHtml:function(C,r){var E,F=this.getTableArray(),u=this.view.structure.cells;b.fire(this.view,"onBeforeRow",[-1,u]);for(var D=0,z;z=u[D];D++)if(!z.hidden){F.push(z.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var M=0,H,x;H=z[M];M++)H.customClasses=
[],H.customStyles=[],this.view.simpleStructure&&(H.draggable&&(H.headerClasses?-1==H.headerClasses.indexOf("dojoDndItem")&&(H.headerClasses+=" dojoDndItem"):H.headerClasses="dojoDndItem"),H.attrs?-1==H.attrs.indexOf("dndType\x3d'gridColumn_")&&(H.attrs+=" dndType\x3d'gridColumn_"+this.grid.id+"'"):H.attrs="dndType\x3d'gridColumn_"+this.grid.id+"'"),x=this.generateCellMarkup(H,H.headerStyles,H.headerClasses,!0),x[5]=void 0!=r?r:C(H),x[3]=H.customStyles.join(";"),(E=H.textDir||this.grid.textDir)&&(x[3]+=
this._getTextDirStyle(E,H,r)),x[1]=H.customClasses.join(" "),F.push(x.join(""));F.push("\x3c/tr\x3e")}F.push("\x3c/table\x3e");return F.join("")},getCellX:function(C){var r=g("th");for(var E=C.target;E&&r(E);E=E.parentNode);(r=E)?(r=f.position(r),C=C.clientX-r.x):C=C.layerX;return C},decorateEvent:function(C){this.baseDecorateEvent(C);C.rowIndex=-1;C.cellX=this.getCellX(C);return!0},prepareResize:function(C,r){do{var E=C.cellIndex;C.cellNode=E?C.cellNode.parentNode.cells[E+r]:null;C.cellIndex=C.cellNode?
this.getCellNodeIndex(C.cellNode):-1}while(C.cellNode&&"none"==C.cellNode.style.display);return!!C.cellNode},canResize:function(C){if(!C.cellNode||1<C.cellNode.colSpan)return!1;C=this.grid.getCell(C.cellIndex);return!C.noresize&&C.canResize()},overLeftResizeArea:function(C){if(a.hasClass(w.body(),"dojoDndMove"))return!1;if(h("ie")){var r=C.target;if(a.hasClass(r,"dojoxGridArrowButtonNode")||a.hasClass(r,"dojoxGridArrowButtonChar")||a.hasClass(r,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?
0<C.cellIndex&&0<C.cellX&&C.cellX<this.overResizeWidth&&this.prepareResize(C,-1):C.cellNode&&0<C.cellX&&C.cellX<this.overResizeWidth},overRightResizeArea:function(C){if(a.hasClass(w.body(),"dojoDndMove"))return!1;if(h("ie")){var r=C.target;if(a.hasClass(r,"dojoxGridArrowButtonNode")||a.hasClass(r,"dojoxGridArrowButtonChar")||a.hasClass(r,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?C.cellNode&&C.cellX>=C.cellNode.offsetWidth-this.overResizeWidth:0<C.cellIndex&&C.cellX>=C.cellNode.offsetWidth-
this.overResizeWidth&&this.prepareResize(C,-1)},domousemove:function(C){if(!this.moveable){var r=this.overRightResizeArea(C)?"dojoxGridColResize":this.overLeftResizeArea(C)?"dojoxGridColResize":"";r&&!this.canResize(C)&&(r="dojoxGridColNoResize");a.toggleClass(C.sourceView.headerNode,"dojoxGridColNoResize","dojoxGridColNoResize"==r);a.toggleClass(C.sourceView.headerNode,"dojoxGridColResize","dojoxGridColResize"==r);r&&q.stop(C)}},domousedown:function(C){this.moveable||((this.overRightResizeArea(C)||
this.overLeftResizeArea(C))&&this.canResize(C)?this.beginColumnResize(C):(this.grid.onMouseDown(C),this.grid.onMouseOverRow(C)))},doclick:function(C){return this._skipBogusClicks?(q.stop(C),!0):!1},colResizeSetup:function(C,r){var E=a.contentBox(C.sourceView.headerNode);if(r){this.lineDiv=document.createElement("div");r=a.position(C.sourceView.headerNode,!0);var F=a.contentBox(C.sourceView.domNode),u=C.pageX;!this.grid.isLeftToRight()&&8>h("ie")&&(u-=l.getScrollbar().w);a.style(this.lineDiv,{top:r.y+
"px",left:u+"px",height:F.h+E.h+"px"});a.addClass(this.lineDiv,"dojoxGridResizeColLine");this.lineDiv._origLeft=u;w.body().appendChild(this.lineDiv)}r=[];F=this.tableMap.findOverlappingNodes(C.cellNode);u=0;for(var D;D=F[u];u++)r.push({node:D,index:this.getCellNodeIndex(D),width:D.offsetWidth});F=C.sourceView;D=this.grid.isLeftToRight()?1:-1;var z=C.grid.views.views;u=[];for(var M=F.idx+D,H;H=z[M];M+=D)u.push({node:H.headerNode,left:window.parseInt(H.headerNode.style.left)});D=F.headerContentNode.firstChild;
return{scrollLeft:C.sourceView.headerNode.scrollLeft,view:F,node:C.cellNode,index:C.cellIndex,w:a.contentBox(C.cellNode).w,vw:E.w,table:D,tw:a.contentBox(D).w,spanners:r,followers:u}},beginColumnResize:function(C){this.moverDiv=document.createElement("div");a.style(this.moverDiv,{position:"absolute",left:0});w.body().appendChild(this.moverDiv);a.addClass(this.grid.domNode,"dojoxGridColumnResizing");var r=this.moveable=new e(this.moverDiv),E=this.colResizeSetup(C,!0);r.onMove=A.hitch(this,"doResizeColumn",
E);p.connect(r,"onMoveStop",A.hitch(this,function(){this.endResizeColumn(E);E.node.releaseCapture&&E.node.releaseCapture();this.moveable.destroy();delete this.moveable;this.moveable=null;a.removeClass(this.grid.domNode,"dojoxGridColumnResizing")}));C.cellNode.setCapture&&C.cellNode.setCapture();r.onMouseDown(C)},doResizeColumn:function(C,r,E){var F=E.l;F={deltaX:F,w:C.w+(this.grid.isLeftToRight()?F:-F),vw:C.vw+F,tw:C.tw+F};this.dragRecord={inDrag:C,mover:r,leftTop:E};F.w>=this.minColWidth&&(r?a.style(this.lineDiv,
"left",this.lineDiv._origLeft+F.deltaX+"px"):this.doResizeNow(C,F))},endResizeColumn:function(C){if(this.dragRecord){var r=this.dragRecord.leftTop;r=this.grid.isLeftToRight()?r.l:-r.l;r+=Math.max(C.w+r,this.minColWidth)-(C.w+r);h("webkit")&&C.spanners.length&&(r+=a._getPadBorderExtents(C.spanners[0].node).w);this.doResizeNow(C,{deltaX:r,w:C.w+r,vw:C.vw+r,tw:C.tw+r});delete this.dragRecord}a.destroy(this.lineDiv);a.destroy(this.moverDiv);a.destroy(this.moverDiv);delete this.moverDiv;this._skipBogusClicks=
!0;C.view.update();this._skipBogusClicks=!1;this.grid.onResizeColumn(C.index)},doResizeNow:function(C,r){C.view.convertColPctToFixed();if(C.view.flexCells&&!C.view.testFlexCells()){var E=c(C.node);E&&(E.style.width="")}var F;for(E=0;F=C.spanners[E];E++){var u=F.width+r.deltaX;0<u&&(F.node.style.width=u+"px",C.view.setColWidth(F.index,u))}if(this.grid.isLeftToRight()||!h("ie"))for(E=0;F=C.followers[E];E++)u=F.left+r.deltaX,F.node.style.left=u+"px";C.node.style.width=r.w+"px";C.view.setColWidth(C.index,
r.w);C.view.headerNode.style.width=r.vw+"px";C.view.setColumnsWidth(r.tw);this.grid.isLeftToRight()||(C.view.headerNode.scrollLeft=C.scrollLeft+r.deltaX)}});n._TableMap=A.extend(function(C){this.mapRows(C)},{map:null,mapRows:function(C){if(C.length){this.map=[];for(var r,E=0;r=C[E];E++)this.map[E]=[];for(E=0;r=C[E];E++)for(var F=0,u=0,D,z;D=r[F];F++){for(;this.map[E][u];)u++;this.map[E][u]={c:F,r:E};z=D.rowSpan||1;D=D.colSpan||1;for(var M=0;M<z;M++)for(var H=0;H<D;H++)this.map[E+M][u+H]=this.map[E][u];
u+=D}}},dumpMap:function(){for(var C=0,r;r=this.map[C];C++)for(var E=0;r[E];E++);},getMapCoords:function(C,r){for(var E=0,F;F=this.map[E];E++)for(var u=0,D;D=F[u];u++)if(D.c==r&&D.r==C)return{j:E,i:u};return{j:-1,i:-1}},getNode:function(C,r,E){return(C=C&&C.rows[r])&&C.cells[E]},_findOverlappingNodes:function(C,r,E){var F=[];r=this.getMapCoords(r,E);E=0;for(var u;u=this.map[E];E++)E!=r.j&&(u=(u=u[r.i])?this.getNode(C,u.r,u.c):null)&&F.push(u);return F},findOverlappingNodes:function(C){return this._findOverlappingNodes(c(C),
m(C.parentNode),0<=C.cellIndex?C.cellIndex:B.indexOf(C.parentNode.cells,C))}});return{_Builder:y,_HeaderBuilder:K,_ContentBuilder:G}})},"dojo/dnd/Moveable":function(){define("../_base/array ../_base/declare ../_base/lang ../dom ../dom-class ../Evented ../has ../on ../topic ../touch ./common ./Mover ../_base/window".split(" "),function(G,B,A,w,q,h,p,e,l,b,a,f,n){function m(g,k){"touchAction"in document.body.style?d="touchAction":"msTouchAction"in document.body.style&&(d="msTouchAction");c=function(t,
y){t.style[d]=y};c(g,k)}var d,c=function(){};p("touch-action")&&(c=m);return B("dojo.dnd.Moveable",[h],{handle:"",delay:0,skip:!1,constructor:function(g,k){this.node=w.byId(g);c(this.node,"none");k||(k={});this.handle=k.handle?w.byId(k.handle):null;this.handle||(this.handle=this.node);this.delay=0<k.delay?k.delay:0;this.skip=k.skip;this.mover=k.mover?k.mover:f;this.events=[e(this.handle,b.press,A.hitch(this,"onMouseDown")),e(this.handle,"dragstart",A.hitch(this,"onSelectStart")),e(this.handle,"selectstart",
A.hitch(this,"onSelectStart"))]},markupFactory:function(g,k,t){return new t(k,g)},destroy:function(){G.forEach(this.events,function(g){g.remove()});c(this.node,"");this.events=this.node=this.handle=null},onMouseDown:function(g){if(!this.skip||!a.isFormElement(g)){if(this.delay)this.events.push(e(this.handle,b.move,A.hitch(this,"onMouseMove")),e(this.handle.ownerDocument,b.release,A.hitch(this,"onMouseUp"))),this._lastX=g.pageX,this._lastY=g.pageY;else this.onDragDetected(g);g.stopPropagation();g.preventDefault()}},
onMouseMove:function(g){if(Math.abs(g.pageX-this._lastX)>this.delay||Math.abs(g.pageY-this._lastY)>this.delay)this.onMouseUp(g),this.onDragDetected(g);g.stopPropagation();g.preventDefault()},onMouseUp:function(g){for(var k=0;2>k;++k)this.events.pop().remove();g.stopPropagation();g.preventDefault()},onSelectStart:function(g){this.skip&&a.isFormElement(g)||(g.stopPropagation(),g.preventDefault())},onDragDetected:function(g){new this.mover(this.node,g,this)},onMoveStart:function(g){l.publish("/dnd/move/start",
g);q.add(n.body(),"dojoMove");q.add(this.node,"dojoMoveItem")},onMoveStop:function(g){l.publish("/dnd/move/stop",g);q.remove(n.body(),"dojoMove");q.remove(this.node,"dojoMoveItem")},onFirstMove:function(){},onMove:function(g,k){this.onMoving(g,k);var t=g.node.style;t.left=k.l+"px";t.top=k.t+"px";this.onMoved(g,k)},onMoving:function(){},onMoved:function(){}})})},"dojo/dnd/Mover":function(){define("../_base/array ../_base/declare ../_base/lang ../sniff ../_base/window ../dom ../dom-geometry ../dom-style ../Evented ../on ../touch ./common ./autoscroll".split(" "),
function(G,B,A,w,q,h,p,e,l,b,a,f,n){return B("dojo.dnd.Mover",[l],{constructor:function(m,d,c){function g(k){k.preventDefault();k.stopPropagation()}this.node=h.byId(m);this.marginBox={l:d.pageX,t:d.pageY};this.mouseButton=d.button;d=this.host=c;m=m.ownerDocument;this.events=[b(m,a.move,A.hitch(this,"onFirstMove")),b(m,a.move,A.hitch(this,"onMouseMove")),b(m,a.release,A.hitch(this,"onMouseUp")),b(m,"dragstart",g),b(m.body,"selectstart",g)];n.autoScrollStart(m);if(d&&d.onMoveStart)d.onMoveStart(this)},
onMouseMove:function(m){n.autoScroll(m);var d=this.marginBox;this.host.onMove(this,{l:d.l+m.pageX,t:d.t+m.pageY},m);m.preventDefault();m.stopPropagation()},onMouseUp:function(m){(w("webkit")&&w("mac")&&2==this.mouseButton?0==m.button:this.mouseButton==m.button)&&this.destroy();m.preventDefault();m.stopPropagation()},onFirstMove:function(m){var d=this.node.style,c=this.host;switch(d.position){case "relative":case "absolute":var g=Math.round(parseFloat(d.left))||0;d=Math.round(parseFloat(d.top))||0;
break;default:d.position="absolute";d=p.getMarginBox(this.node);g=q.doc.body;var k=e.getComputedStyle(g),t=p.getMarginBox(g,k);k=p.getContentBox(g,k);g=d.l-(k.l-t.l);d=d.t-(k.t-t.t)}this.marginBox.l=g-this.marginBox.l;this.marginBox.t=d-this.marginBox.t;if(c&&c.onFirstMove)c.onFirstMove(this,m);this.events.shift().remove()},destroy:function(){G.forEach(this.events,function(d){d.remove()});var m=this.host;if(m&&m.onMoveStop)m.onMoveStop(this);this.events=this.node=this.host=null}})})},"dojox/grid/_ViewManager":function(){define(["dojo/_base/declare",
"dojo/_base/sniff","dojo/dom-class"],function(G,B,A){return G("dojox.grid._ViewManager",null,{constructor:function(w){this.grid=w},defaultWidth:200,views:[],resize:function(){this.onEach("resize")},render:function(){this.onEach("render")},addView:function(w){w.idx=this.views.length;this.views.push(w)},destroyViews:function(){for(var w=0,q;q=this.views[w];w++)q.destroy();this.views=[]},getContentNodes:function(){for(var w=[],q=0,h;h=this.views[q];q++)w.push(h.contentNode);return w},forEach:function(w){for(var q=
0,h;h=this.views[q];q++)w(h,q)},onEach:function(w,q){q=q||[];for(var h=0,p;p=this.views[h];h++)w in p&&p[w].apply(p,q)},normalizeHeaderNodeHeight:function(){for(var w=[],q=0,h;h=this.views[q];q++)h.headerContentNode.firstChild&&w.push(h.headerContentNode);this.normalizeRowNodeHeights(w)},normalizeRowNodeHeights:function(w){var q=0,h=[];if(this.grid.rowHeight)q=this.grid.rowHeight;else{if(1>=w.length)return;for(var p=0,e;e=w[p];p++)A.contains(e,"dojoxGridNonNormalizedCell")||(h[p]=e.firstChild.offsetHeight,
q=Math.max(q,h[p]));q=0<=q?q:0;(B("mozilla")||8<B("ie"))&&q&&q++}for(p=0;e=w[p];p++)h[p]!=q&&(e.firstChild.style.height=q+"px")},resetHeaderNodeHeight:function(){for(var w=0,q;q=this.views[w];w++)if(q=q.headerContentNode.firstChild)q.style.height=""},renormalizeRow:function(w){for(var q=[],h=0,p,e;(p=this.views[h])&&(e=p.getRowNode(w));h++)e.firstChild.style.height="",q.push(e);this.normalizeRowNodeHeights(q)},getViewWidth:function(w){return this.views[w].getWidth()||this.defaultWidth},measureHeader:function(){this.resetHeaderNodeHeight();
this.forEach(function(q){q.headerContentNode.style.height=""});var w=0;this.forEach(function(q){w=Math.max(q.headerNode.offsetHeight,w)});return w},measureContent:function(){var w=0;this.forEach(function(q){w=Math.max(q.domNode.offsetHeight,w)});return w},findClient:function(w){w=this.grid.elasticView||-1;if(0>w)for(var q=1,h;h=this.views[q];q++)if(h.viewWidth){for(q=1;h=this.views[q];q++)if(!h.viewWidth){w=q;break}break}0>w&&(w=Math.floor(this.views.length/2));return w},arrange:function(w,q){var h,
p,e=this.views.length,l=this,b=0>=q?e:this.findClient(),a=function(m,d){var c=m.domNode.style,g=m.headerNode.style;l.grid.isLeftToRight()?(c.left=d+"px",g.left=d+"px"):(c.right=d+"px",4>B("ff")?g.right=d+m.getScrollbarWidth()+"px":g.right=d+"px",B("webkit")||"auto"==g.width||(g.width=parseInt(g.width,10)-m.getScrollbarWidth()+"px"));c.top="0px";g.top=0};for(h=0;(p=this.views[h])&&h<b;h++){var f=this.getViewWidth(h);p.setSize(f,0);a(p,w);f=p.headerContentNode&&p.headerContentNode.firstChild?p.getColumnsWidth()+
p.getScrollbarWidth():p.domNode.offsetWidth;w+=f}h++;for(var n=e-1;(p=this.views[n])&&h<=n;n--)f=this.getViewWidth(n),p.setSize(f,0),f=p.domNode.offsetWidth,q-=f,a(p,q);b<e&&(p=this.views[b],f=Math.max(1,q-w),p.setSize(f+"px",0),a(p,w));return w},renderRow:function(w,q,h){for(var p=[],e=0,l,b;(l=this.views[e])&&(b=q[e]);e++)l=l.renderRow(w),b.appendChild(l),p.push(l);h||this.normalizeRowNodeHeights(p)},rowRemoved:function(w){this.onEach("rowRemoved",[w])},updateRow:function(w,q){for(var h=0,p;p=this.views[h];h++)p.updateRow(w);
q||this.renormalizeRow(w)},updateRowStyles:function(w){this.onEach("updateRowStyles",[w])},setScrollTop:function(w){for(var q=w,h=0,p;p=this.views[h];h++)q=p.setScrollTop(w),B("ie")&&p.headerNode&&p.scrollboxNode&&(p.headerNode.scrollLeft=p.scrollboxNode.scrollLeft);return q},getFirstScrollingView:function(){for(var w=0,q;q=this.views[w];w++)if(q.hasHScrollbar()||q.hasVScrollbar())return q;return null}})})},"dojox/grid/_RowManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class"],
function(G,B,A){return G("dojox.grid._RowManager",null,{constructor:function(w){this.grid=w},linesToEms:2,overRow:-2,prepareStylingRow:function(w,q){return{index:w,node:q,odd:!!(w&1),selected:!!this.grid.selection.isSelected(w),over:this.isOver(w),customStyles:"",customClasses:"dojoxGridRow"}},styleRowNode:function(w,q){w=this.prepareStylingRow(w,q);this.grid.onStyleRow(w);this.applyStyles(w)},applyStyles:function(w){w.node.className=w.customClasses;var q=w.node.style.height,h=w.node,p=w.customStyles+
";"+(w.node._style||"");void 0==h.style.cssText?h.setAttribute("style",p):h.style.cssText=p;w.node.style.height=q},updateStyles:function(w){this.grid.updateRowStyles(w)},setOverRow:function(w){var q=this.overRow;this.overRow=w;q!=this.overRow&&(B.isString(q)||0<=q)&&this.updateStyles(q);this.updateStyles(this.overRow)},isOver:function(w){return this.overRow==w&&!A.contains(this.grid.domNode,"dojoxGridColumnResizing")}})})},"dojox/grid/_FocusManager":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/declare dojo/_base/connect dojo/_base/event dojo/_base/sniff dojo/query ./util dojo/_base/html".split(" "),
function(G,B,A,w,q,h,p,e,l){return A("dojox.grid._FocusManager",null,{constructor:function(b){this.grid=b;this.cell=null;this.rowIndex=-1;this._connects=[];this._headerConnects=[];this.headerMenu=this.grid.headerMenu;this._connects.push(w.connect(this.grid.domNode,"onfocus",this,"doFocus"));this._connects.push(w.connect(this.grid.domNode,"onblur",this,"doBlur"));this._connects.push(w.connect(this.grid.domNode,"mousedown",this,"_mouseDown"));this._connects.push(w.connect(this.grid.domNode,"mouseup",
this,"_mouseUp"));this._connects.push(w.connect(this.grid.domNode,"oncontextmenu",this,"doContextMenu"));this._connects.push(w.connect(this.grid.lastFocusNode,"onfocus",this,"doLastNodeFocus"));this._connects.push(w.connect(this.grid.lastFocusNode,"onblur",this,"doLastNodeBlur"));this._connects.push(w.connect(this.grid,"_onFetchComplete",this,"_delayedCellFocus"));this._connects.push(w.connect(this.grid,"postrender",this,"_delayedHeaderFocus"))},destroy:function(){G.forEach(this._connects,w.disconnect);
G.forEach(this._headerConnects,w.disconnect);delete this.grid;delete this.cell},_colHeadNode:null,_colHeadFocusIdx:null,_contextMenuBindNode:null,tabbingOut:!1,focusClass:"dojoxGridCellFocus",focusView:null,initFocusView:function(){this.focusView=this.grid.views.getFirstScrollingView()||this.focusView||this.grid.views.views[0];this._initColumnHeaders()},isFocusCell:function(b,a){return this.cell==b&&this.rowIndex==a},isLastFocusCell:function(){return this.cell?this.rowIndex==this.grid.rowCount-1&&
this.cell.index==this.grid.layout.cellCount-1:!1},isFirstFocusCell:function(){return this.cell?0===this.rowIndex&&0===this.cell.index:!1},isNoFocusCell:function(){return 0>this.rowIndex||!this.cell},isNavHeader:function(){return!!this._colHeadNode},getHeaderIndex:function(){return this._colHeadNode?G.indexOf(this._findHeaderCells(),this._colHeadNode):-1},_focusifyCellNode:function(b){var a=this.cell&&this.cell.getNode(this.rowIndex);if(a&&(l.toggleClass(a,this.focusClass,b),b)){b=this.scrollIntoView();
try{if(h("webkit")||!this.grid.edit.isEditing())e.fire(a,"focus"),b&&(this.cell.view.scrollboxNode.scrollLeft=b)}catch(f){}}},_delayedCellFocus:function(){if(!this.isNavHeader()&&this.grid.focused){var b=this.cell&&this.cell.getNode(this.rowIndex);if(b)try{this.grid.edit.isEditing()||(l.toggleClass(b,this.focusClass,!0),this._colHeadNode&&this.blurHeader(),e.fire(b,"focus"))}catch(a){}}},_delayedHeaderFocus:function(){this.isNavHeader()&&this.focusHeader()},_initColumnHeaders:function(){G.forEach(this._headerConnects,
w.disconnect);this._headerConnects=[];for(var b=this._findHeaderCells(),a=0;a<b.length;a++)this._headerConnects.push(w.connect(b[a],"onfocus",this,"doColHeaderFocus")),this._headerConnects.push(w.connect(b[a],"onblur",this,"doColHeaderBlur"))},_findHeaderCells:function(){for(var b=p("th",this.grid.viewsHeaderNode),a=[],f=0;f<b.length;f++){var n=b[f],m=l.hasAttr(n,"tabIndex"),d=l.attr(n,"tabIndex");m&&0>d&&a.push(n)}return a},_setActiveColHeader:function(b,a,f){this.grid.domNode.setAttribute("aria-activedescendant",
b.id);null!=f&&0<=f&&f!=a&&l.toggleClass(this._findHeaderCells()[f],this.focusClass,!1);l.toggleClass(b,this.focusClass,!0);this._colHeadNode=b;this._colHeadFocusIdx=a;this._scrollHeader(this._colHeadFocusIdx)},scrollIntoView:function(){var b=this.cell?this._scrollInfo(this.cell):null;if(!b||!b.s)return null;var a=this.grid.scroller.findScrollTop(this.rowIndex);b.n&&b.sr&&(b.n.offsetLeft+b.n.offsetWidth>b.sr.l+b.sr.w?b.s.scrollLeft=b.n.offsetLeft+b.n.offsetWidth-b.sr.w:b.n.offsetLeft<b.sr.l&&(b.s.scrollLeft=
b.n.offsetLeft));b.r&&b.sr&&(a+b.r.offsetHeight>b.sr.t+b.sr.h?this.grid.setScrollTop(a+b.r.offsetHeight-b.sr.h):a<b.sr.t&&this.grid.setScrollTop(a));return b.s.scrollLeft},_scrollInfo:function(b,a){if(b){var f=b.view.scrollboxNode,n={w:f.clientWidth,l:f.scrollLeft,t:f.scrollTop,h:f.clientHeight},m=b.view.getRowNode(this.rowIndex);return{c:b,s:f,sr:n,n:a?a:b.getNode(this.rowIndex),r:m}}return null},_scrollHeader:function(b){var a=null;if(this._colHeadNode){var f=this.grid.getCell(b);if(!f)return;a=
this._scrollInfo(f,f.getNode(0))}a&&a.s&&a.sr&&a.n&&(a.n.offsetLeft+a.n.offsetWidth>a.sr.l+a.sr.w?a.s.scrollLeft=a.n.offsetLeft+a.n.offsetWidth-a.sr.w:a.n.offsetLeft<a.sr.l?a.s.scrollLeft=a.n.offsetLeft:7>=h("ie")&&f&&f.view.headerNode&&(f.view.headerNode.scrollLeft=a.s.scrollLeft))},_isHeaderHidden:function(){var b=this.focusView;if(!b)for(var a=0,f;f=this.grid.views.views[a];a++)if(f.headerNode){b=f;break}return b&&"none"==l.getComputedStyle(b.headerNode).display},colSizeAdjust:function(b,a,f){var n=
this._findHeaderCells(),m=this.focusView;if(!m||!m.header.tableMap.map)for(var d=0,c;c=this.grid.views.views[d];d++)if(c.header.tableMap.map){m=c;break}d=n[a];!m||a==n.length-1&&0===a||(m.content.baseDecorateEvent(b),b.cellNode=d,b.cellIndex=m.content.getCellNodeIndex(b.cellNode),b.cell=0<=b.cellIndex?this.grid.getCell(b.cellIndex):null,m.header.canResize(b)&&(a={l:f},b=m.header.colResizeSetup(b,!1),m.header.doResizeColumn(b,null,a),m.update()))},styleRow:function(b){},setFocusIndex:function(b,a){this.setFocusCell(this.grid.getCell(a),
b)},setFocusCell:function(b,a){b&&!this.isFocusCell(b,a)&&(this.tabbingOut=!1,this._colHeadNode&&this.blurHeader(),this._colHeadNode=this._colHeadFocusIdx=null,this.focusGridView(),this._focusifyCellNode(!1),this.cell=b,this.rowIndex=a,this._focusifyCellNode(!0));if(h("opera"))setTimeout(B.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1);else this.grid.onCellFocus(this.cell,this.rowIndex)},next:function(){if(this.cell){var b=this.rowIndex,a=this.cell.index+1,f=this.grid.layout.cellCount-
1,n=this.grid.rowCount-1;a>f&&(a=0,b++);b>n&&(a=f,b=n);if(this.grid.edit.isEditing()&&(f=this.grid.getCell(a),!this.isLastFocusCell()&&(!f.editable||this.grid.canEdit&&!this.grid.canEdit(f,b)))){this.cell=f;this.rowIndex=b;this.next();return}this.setFocusIndex(b,a)}},previous:function(){if(this.cell){var b=this.rowIndex||0,a=(this.cell.index||0)-1;0>a&&(a=this.grid.layout.cellCount-1,b--);0>b&&(a=b=0);if(this.grid.edit.isEditing()){var f=this.grid.getCell(a);if(!this.isFirstFocusCell()&&!f.editable){this.cell=
f;this.rowIndex=b;this.previous();return}}this.setFocusIndex(b,a)}},move:function(b,a){var f=0>a?-1:1;if(this.isNavHeader()){b=this._findHeaderCells();var n=currentIdx=G.indexOf(b,this._colHeadNode);for(currentIdx+=a;0<=currentIdx&&currentIdx<b.length&&"none"==b[currentIdx].style.display;)currentIdx+=f;0<=currentIdx&&currentIdx<b.length&&this._setActiveColHeader(b[currentIdx],currentIdx,n)}else if(this.cell){var m=this.grid.scroller;n=this.rowIndex;var d=this.grid.rowCount-1,c=Math.min(d,Math.max(0,
n+b));b&&(0<b?c>m.getLastPageRow(m.page)&&this.grid.setScrollTop(this.grid.scrollTop+m.findScrollTop(c)-m.findScrollTop(n)):0>b&&c<=m.getPageRow(m.page)&&this.grid.setScrollTop(this.grid.scrollTop-m.findScrollTop(n)-m.findScrollTop(c)));m=this.grid.layout.cellCount-1;for(var g=this.cell.index,k=Math.min(m,Math.max(0,g+a)),t=this.grid.getCell(k);0<=k&&k<m&&t&&!0===t.hidden;)k+=f,t=this.grid.getCell(k);t&&!0!==t.hidden||(k=g);f=t.getNode(c);!f&&b?0<=c+b&&c+b<=d&&this.move(0<b?++b:--b,a):f&&"none"!==
l.style(f,"display")||!a?(this.setFocusIndex(c,k),b&&this.grid.updateRow(n)):0<=k+a&&k+a<=m&&this.move(b,0<a?++a:--a)}},previousKey:function(b){this.grid.edit.isEditing()?(q.stop(b),this.previous()):this.isNavHeader()||this._isHeaderHidden()?(this.tabOut(this.grid.domNode),null!=this._colHeadFocusIdx&&(l.toggleClass(this._findHeaderCells()[this._colHeadFocusIdx],this.focusClass,!1),this._colHeadFocusIdx=null),this._focusifyCellNode(!1)):(this.grid.domNode.focus(),q.stop(b))},nextKey:function(b){b.target===
this.grid.domNode&&null==this._colHeadFocusIdx?(this.focusHeader(),q.stop(b)):this.isNavHeader()?(this.blurHeader(),this.findAndFocusGridCell()||this.tabOut(this.grid.lastFocusNode),this._colHeadNode=this._colHeadFocusIdx=null):this.grid.edit.isEditing()?(q.stop(b),this.next()):this.tabOut(this.grid.lastFocusNode)},tabOut:function(b){this.tabbingOut=!0;b.focus()},focusGridView:function(){e.fire(this.focusView,"focus")},focusGrid:function(b){this.focusGridView();this._focusifyCellNode(!0)},findAndFocusGridCell:function(){var b=
!0,a=0===this.grid.rowCount;this.isNoFocusCell()&&!a?(a=0,this.grid.getCell(a).hidden&&(a=this.isNavHeader()?this._colHeadFocusIdx:0),this.setFocusIndex(0,a)):this.cell&&!a?(this.focusView&&!this.focusView.rowNodes[this.rowIndex]&&this.grid.scrollToRow(this.rowIndex),this.focusGrid()):b=!1;this._colHeadNode=this._colHeadFocusIdx=null;return b},focusHeader:function(){var b=this._findHeaderCells(),a=this._colHeadFocusIdx;this._isHeaderHidden()?this.findAndFocusGridCell():this._colHeadFocusIdx||(this.isNoFocusCell()?
this._colHeadFocusIdx=0:this._colHeadFocusIdx=this.cell.index);for(this._colHeadNode=b[this._colHeadFocusIdx];this._colHeadNode&&0<=this._colHeadFocusIdx&&this._colHeadFocusIdx<b.length&&"none"==this._colHeadNode.style.display;)this._colHeadFocusIdx++,this._colHeadNode=b[this._colHeadFocusIdx];this._colHeadNode&&"none"!=this._colHeadNode.style.display?(this.headerMenu&&this._contextMenuBindNode!=this.grid.domNode&&(this.headerMenu.unBindDomNode(this.grid.viewsHeaderNode),this.headerMenu.bindDomNode(this.grid.domNode),
this._contextMenuBindNode=this.grid.domNode),this._setActiveColHeader(this._colHeadNode,this._colHeadFocusIdx,a),this._scrollHeader(this._colHeadFocusIdx),this._focusifyCellNode(!1)):this.findAndFocusGridCell()},blurHeader:function(){l.removeClass(this._colHeadNode,this.focusClass);l.removeAttr(this.grid.domNode,"aria-activedescendant");if(this.headerMenu&&this._contextMenuBindNode==this.grid.domNode){var b=this.grid.viewsHeaderNode;this.headerMenu.unBindDomNode(this.grid.domNode);this.headerMenu.bindDomNode(b);
this._contextMenuBindNode=b}},doFocus:function(b){b&&b.target!=b.currentTarget?q.stop(b):this._clickFocus||(this.tabbingOut||this.focusHeader(),this.tabbingOut=!1,q.stop(b))},doBlur:function(b){q.stop(b)},doContextMenu:function(b){this.headerMenu||q.stop(b)},doLastNodeFocus:function(b){this.tabbingOut?this._focusifyCellNode(!1):0<this.grid.rowCount?(this.isNoFocusCell()&&this.setFocusIndex(0,0),this._focusifyCellNode(!0)):this.focusHeader();this.tabbingOut=!1;q.stop(b)},doLastNodeBlur:function(b){q.stop(b)},
doColHeaderFocus:function(b){this._setActiveColHeader(b.target,l.attr(b.target,"idx"),this._colHeadFocusIdx);this._scrollHeader(this.getHeaderIndex());q.stop(b)},doColHeaderBlur:function(b){l.toggleClass(b.target,this.focusClass,!1)},_mouseDown:function(b){this._clickFocus=dojo.some(this.grid.views.views,function(a){return a.scrollboxNode===b.target})},_mouseUp:function(b){this._clickFocus=!1}})})},"dojox/grid/_EditManager":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/connect dojo/_base/sniff ./util".split(" "),
function(G,B,A,w,q,h){return A("dojox.grid._EditManager",null,{constructor:function(p){this.grid=p;this.connections=q("ie")?[w.connect(document.body,"onfocus",G.hitch(this,"_boomerangFocus"))]:[];this.connections.push(w.connect(this.grid,"onBlur",this,"apply"));this.connections.push(w.connect(this.grid,"prerender",this,"_onPreRender"))},info:{},destroy:function(){B.forEach(this.connections,w.disconnect)},cellFocus:function(p,e){this.grid.singleClickEdit||this.isEditRow(e)?this.setEditCell(p,e):this.apply();
(this.isEditing()||p&&p.editable&&p.alwaysEditing)&&this._focusEditor(p,e)},rowClick:function(p){this.isEditing()&&!this.isEditRow(p.rowIndex)&&this.apply()},styleRow:function(p){p.index==this.info.rowIndex&&(p.customClasses+=" dojoxGridRowEditing")},dispatchEvent:function(p){var e=p.cell;return(e=e&&e.editable?e:0)&&e.dispatchEvent(p.dispatch,p)},isEditing:function(){return void 0!==this.info.rowIndex},isEditCell:function(p,e){return this.info.rowIndex===p&&this.info.cell.index==e},isEditRow:function(p){return this.info.rowIndex===
p},setEditCell:function(p,e){!this.isEditCell(e,p.index)&&this.grid.canEdit&&this.grid.canEdit(p,e)&&this.start(p,e,this.isEditRow(e)||p.editable)},_focusEditor:function(p,e){h.fire(p,"focus",[e])},focusEditor:function(){this.isEditing()&&this._focusEditor(this.info.cell,this.info.rowIndex)},_boomerangWindow:500,_shouldCatchBoomerang:function(){return this._catchBoomerang>(new Date).getTime()},_boomerangFocus:function(){this._shouldCatchBoomerang()&&(this.grid.focus.focusGrid(),this.focusEditor(),
this._catchBoomerang=0)},_doCatchBoomerang:function(){q("ie")&&(this._catchBoomerang=(new Date).getTime()+this._boomerangWindow)},start:function(p,e,l){this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.isEditing()&&!this.isEditRow(e)&&(this.applyRowEdit(),this.grid.updateRow(e)),l?(this.info={cell:p,rowIndex:e},this.grid.doStartEdit(p,e),this.grid.updateRow(e)):this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._focusEditor(p,e),this._doCatchBoomerang())},_editorDo:function(p){var e=
this.info.cell;if(e&&e.editable)e[p](this.info.rowIndex)},editorApply:function(){this._editorDo("apply")},editorCancel:function(){this._editorDo("cancel")},applyCellEdit:function(p,e,l){this.grid.canEdit(e,l)&&this.grid.doApplyCellEdit(p,l,e.field)},applyRowEdit:function(){this.grid.doApplyEdit(this.info.rowIndex,this.info.cell.field)},apply:function(){this.isEditing()&&this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.applyRowEdit(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),
this._doCatchBoomerang())},cancel:function(){this.isEditing()&&(this.grid.beginUpdate(),this.editorCancel(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},save:function(p,e){var l=this.info.cell;!this.isEditRow(p)||e&&l.view!=e||!l.editable||l.save(l,this.info.rowIndex)},restore:function(p,e){var l=this.info.cell;this.isEditRow(e)&&l.view==p&&l.editable&&l.restore(this.info.rowIndex)},_isValidInput:function(){var p=(this.info.cell||{}).widget;if(!p||!p.isValid)return!0;
p.focused=!0;return p.isValid(!0)},_onPreRender:function(){this.isEditing()&&(this.info.value=this.info.cell.getValue())}})})},"dojox/grid/Selection":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-attr"],function(G,B,A,w){return G("dojox.grid.Selection",null,{constructor:function(q){this.grid=q;this.selected=[];this.setMode(q.selectionMode)},mode:"extended",selected:null,updating:0,selectedIndex:-1,rangeStartIndex:-1,setMode:function(q){this.selected.length&&
this.deselectAll();this.mode="extended"!=q&&"multiple"!=q&&"single"!=q&&"none"!=q?"extended":q},onCanSelect:function(q){return this.grid.onCanSelect(q)},onCanDeselect:function(q){return this.grid.onCanDeselect(q)},onSelected:function(q){},onDeselected:function(q){},onChanging:function(){},onChanged:function(){},isSelected:function(q){return"none"==this.mode?!1:this.selected[q]},getFirstSelected:function(){if(!this.selected.length||"none"==this.mode)return-1;for(var q=0,h=this.selected.length;q<h;q++)if(this.selected[q])return q;
return-1},getNextSelected:function(q){if("none"==this.mode)return-1;q+=1;for(var h=this.selected.length;q<h;q++)if(this.selected[q])return q;return-1},getSelected:function(){for(var q=[],h=0,p=this.selected.length;h<p;h++)this.selected[h]&&q.push(h);return q},getSelectedCount:function(){for(var q=0,h=0;h<this.selected.length;h++)this.selected[h]&&q++;return q},_beginUpdate:function(){if(0===this.updating)this.onChanging();this.updating++},_endUpdate:function(){this.updating--;if(0===this.updating)this.onChanged()},
select:function(q){"none"!=this.mode&&("multiple"!=this.mode?(this.deselectAll(q),this.addToSelection(q)):this.toggleSelect(q))},addToSelection:function(q){if("none"!=this.mode)if(A.isArray(q))B.forEach(q,this.addToSelection,this);else if(q=Number(q),this.selected[q])this.selectedIndex=q;else if(!1!==this.onCanSelect(q)){this.selectedIndex=q;var h=this.grid.getRowNode(q);h&&w.set(h,"aria-selected","true");this._beginUpdate();this.selected[q]=!0;this.onSelected(q);this._endUpdate()}},deselect:function(q){if("none"!=
this.mode)if(A.isArray(q))B.forEach(q,this.deselect,this);else if(q=Number(q),this.selectedIndex==q&&(this.selectedIndex=-1),this.selected[q]&&!1!==this.onCanDeselect(q)){var h=this.grid.getRowNode(q);h&&w.set(h,"aria-selected","false");this._beginUpdate();delete this.selected[q];this.onDeselected(q);this._endUpdate()}},setSelected:function(q,h){this[h?"addToSelection":"deselect"](q)},toggleSelect:function(q){A.isArray(q)?B.forEach(q,this.toggleSelect,this):this.setSelected(q,!this.selected[q])},
_range:function(q,h,p){var e=0<=q?q:h;q=h;e>q&&(q=e,e=h);for(h=e;h<=q;h++)p(h)},selectRange:function(q,h){this._range(q,h,A.hitch(this,"addToSelection"))},deselectRange:function(q,h){this._range(q,h,A.hitch(this,"deselect"))},insert:function(q){this.selected.splice(q,0,!1);this.selectedIndex>=q&&this.selectedIndex++},remove:function(q){this.selected.splice(q,1);this.selectedIndex>=q&&this.selectedIndex--},deselectAll:function(q){for(var h in this.selected)h!=q&&!0===this.selected[h]&&this.deselect(h)},
clickSelect:function(q,h,p){if("none"!=this.mode){this._beginUpdate();if("extended"!=this.mode)this.select(q);else{if(!p||0>this.rangeStartIndex)this.rangeStartIndex=q;h||this.deselectAll(q);p?this.selectRange(this.rangeStartIndex,q):h?this.toggleSelect(q):this.addToSelection(q)}this._endUpdate()}},clickSelectEvent:function(q){this.clickSelect(q.rowIndex,dojo.isCopyKey(q),q.shiftKey)},clear:function(){this._beginUpdate();this.deselectAll();this._endUpdate()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare",
"dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(G,B,A,w){return G("dijit.CheckedMenuItem",A,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:w,checked:!1,_setCheckedAttr:function(q){this.domNode.setAttribute("aria-checked",q?"true":"false");this._set("checked",q)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(q){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));
this.onClick(q)}})})},"dojox/grid/DataSelection":function(){define(["dojo/_base/declare","./_SelectionPreserver","./Selection"],function(G,B,A){return G("dojox.grid.DataSelection",A,{constructor:function(w){w.keepSelection&&(this.preserver=new B(this))},destroy:function(){this.preserver&&this.preserver.destroy()},getFirstSelected:function(){var w=A.prototype.getFirstSelected.call(this);return-1==w?null:this.grid.getItem(w)},getNextSelected:function(w){w=this.grid.getItemIndex(w);w=A.prototype.getNextSelected.call(this,
w);return-1==w?null:this.grid.getItem(w)},getSelected:function(){for(var w=[],q=0,h=this.selected.length;q<h;q++)this.selected[q]&&w.push(this.grid.getItem(q));return w},addToSelection:function(w){if("none"!=this.mode){var q=null;q="number"==typeof w||"string"==typeof w?w:this.grid.getItemIndex(w);A.prototype.addToSelection.call(this,q)}},deselect:function(w){if("none"!=this.mode){var q=null;q="number"==typeof w||"string"==typeof w?w:this.grid.getItemIndex(w);A.prototype.deselect.call(this,q)}},deselectAll:function(w){var q=
null;w||"number"==typeof w?(q="number"==typeof w||"string"==typeof w?w:this.grid.getItemIndex(w),A.prototype.deselectAll.call(this,q)):this.inherited(arguments)}})})},"dojox/grid/_SelectionPreserver":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array"],function(G,B,A,w){return G("dojox.grid._SelectionPreserver",null,{constructor:function(q){this.selection=q;var h=this.grid=q.grid;this.reset();this._connects=[B.connect(h,"_setStore",this,"reset"),B.connect(h,
"_addItem",this,"_reSelectById"),B.connect(q,"onSelected",A.hitch(this,"_selectById",!0)),B.connect(q,"onDeselected",A.hitch(this,"_selectById",!1)),B.connect(q,"deselectAll",this,"reset")]},destroy:function(){this.reset();w.forEach(this._connects,B.disconnect);delete this._connects},reset:function(){this._selectedById={}},_reSelectById:function(q,h){q&&this.grid._hasIdentity&&(this.selection.selected[h]=this._selectedById[this.grid.store.getIdentity(q)])},_selectById:function(q,h){if("none"!=this.selection.mode&&
this.grid._hasIdentity){var p=h,e=this.grid;if("number"==typeof h||"string"==typeof h)p=(h=e._by_idx[h])&&h.item;p&&(this._selectedById[e.store.getIdentity(p)]=!!q);return p}}})})},"esri/dijit/editing/TemplatePickerItem":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/sniff dojo/dom-style dijit/_Widget dijit/_Templated dojox/gfx ../../symbols/jsonUtils ../../kernel".split(" "),function(G,B,A,w,q,h,p,e,l,b,a){G=G([p,e],{declaredClass:"esri.dijit.editing.TemplatePickerItem",
templateString:"\x3cdiv class\x3d'item' style\x3d'text-align: center;'\x3e\x3cdiv class\x3d'itemSymbol' dojoAttachPoint\x3d'_surfaceNode'\x3e\x3c/div\x3e\x3cdiv class\x3d'itemLabel'\x3e${label}\x3c/div\x3e\x3c/div\x3e",startup:function(){this._started||(this.inherited(arguments),this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template))},_draw:function(f,n,m,d,c){if(n&&"textsymbol"!==n.type){f=l.createSurface(f,m,d);if(9>w("ie")){var g=f.getEventSource();
h.set(g,"position","relative");h.set(g.parentNode,"position","relative")}n=!this.legendOverride&&this._getDrawingToolShape(n,c)||b.getShapeDescriptors(n);try{var k=f.createShape(n.defaultShape).setFill(n.fill).setStroke(n.stroke)}catch(K){f.clear();f.destroy();return}var t=k.getBoundingBox();n=t.width;c=t.height;g=-(t.x+n/2);t=-(t.y+c/2);var y=f.getDimensions();g={dx:g+y.width/2,dy:t+y.height/2};if(n>m||c>d)t=n/m>c/d,m=((t?m:d)-5)/(t?n:c),B.mixin(g,{xx:m,yy:m});k.applyTransform(g);return f}},_getDrawingToolShape:function(f,
n){switch(n?n.drawingTool||null:null){case "esriFeatureEditToolArrow":n={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolLeftArrow":n={type:"path",path:"M -15,1 L -8,8 L -8,5 L 10,5 L 10,-2 L -8,-2 L -8,-5 L -15,1 E"};break;case "esriFeatureEditToolRightArrow":n={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolUpArrow":n={type:"path",path:"M 1,-10 L 8,-3 L 5,-3 L 5,15 L -2,15 L -2,-3 L -5,-3 L 1,-10 E"};
break;case "esriFeatureEditToolDownArrow":n={type:"path",path:"M 1,15 L 8,8 L 5,8 L 5,-10 L -2,-10 L -2,8 L -5,8 L 1,15 E"};break;case "esriFeatureEditToolTriangle":n={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":n={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":n={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":n={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;case "esriFeatureEditToolFreehand":n=
"simplelinesymbol"===f.type||"cartographiclinesymbol"===f.type?{type:"path",path:"m -11, -7c-1.5,-3.75 7.25,-9.25 12.5,-7c5.25,2.25 6.75,9.75 3.75,12.75c-3,3 -3.25,2.5 -9.75,5.25c-6.5,2.75 -7.25,14.25 2,15.25c9.25,1 11.75,-4 13.25,-6.75c1.5,-2.75 3.5,-11.75 12,-6.5"}:{type:"path",path:"M 10,-13 c3.1,0.16667 4.42564,2.09743 2.76923,3.69231c-2.61025,2.87179 -5.61025,5.6718 -6.14358,6.20513c-0.66667,0.93333 -0.46667,1.2 -0.53333,1.93333c-0.00001,0.86666 0.6,1.66667 1.13334,2c1.03077,0.38462 2.8,0.93333 3.38974,1.70769c0.47693,0.42564 0.87693,0.75897 1.41026,1.75897c0.13333,1.06667 -0.46667,2.86667 -1.8,3.8c-0.73333,0.73333 -3.86667,2.66666 -4.86667,3.13333c-0.93333,0.8 -7.4,3.2 -7.6,3.06667c-1.06667,0.46667 -4.73333,1.13334 -5.2,1.26667c-1.6,0.33334 -4.6,0.4 -6.25128,0.05128c-1.41539,-0.18462 -2.34872,-2.31796 -1.41539,-4.45129c0.93333,-1.73333 1.86667,-3.13333 2.64615,-3.85641c1.28718,-1.47692 2.57437,-2.68204 3.88718,-3.54359c0.88718,-1.13845 1.8,-1.33333 2.26666,-2.45641c0.33334,-0.74359 0.37949,-1.7641 0.06667,-2.87692c-0.66666,-1.46666 -1.66666,-1.86666 -2.98975,-2.2c-1.27692,-0.26666 -2.12307,-0.64102 -3.27692,-1.46666c-0.66667,-1.00001 -1.01538,-3.01539 0.73333,-4.06667c1.73333,-1.2 3.6,-1.93333 4.93333,-2.2c1.33333,-0.46667 4.84104,-1.09743 5.84103,-1.23076c1.60001,-0.46667 6.02564,-0.50257 7.29231,-0.56924z"};
break;default:return null}return{defaultShape:n,fill:f.getFill(),stroke:f.getStroke()}},_repaint:function(f){f?(f.getStroke&&f.setStroke&&f.setStroke(f.getStroke()),f.getFill&&f.setFill&&f.setFill(f.getFill()),f.children&&B.isArray(f.children)&&A.forEach(f.children,this._repaint,this)):this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template)},destroy:function(){this._surface&&(this._surface.destroy(),delete this._surface);this.inherited(arguments)}});
w("extend-esri")&&B.setObject("dijit.editing.TemplatePickerItem",G,a);return G})},"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Button.html":'\x3cspan class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonNode"\r\n\t\tdata-dojo-attach-event\x3d"ondijitclick:__onClick" role\x3d"presentation"\r\n\t\t\x3e\x3cspan class\x3d"dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode,focusNode"\r\n\t\t\trole\x3d"button" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitToggleButtonIconChar"\x3e\x26#x25CF;\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tid\x3d"${id}_label"\r\n\t\t\t\tdata-dojo-attach-point\x3d"containerNode"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\x3e\x3c/span\r\n\t\x3e\x3c/span\r\n\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" class\x3d"dijitOffScreen"\r\n\t\tdata-dojo-attach-event\x3d"onclick:_onClick"\r\n\t\ttabIndex\x3d"-1" aria-hidden\x3d"true" data-dojo-attach-point\x3d"valueNode"\r\n/\x3e\x3c/span\x3e\r\n',
"url:dijit/form/templates/DropDownButton.html":'\x3cspan class\x3d"dijit dijitReset dijitInline"\r\n\t\x3e\x3cspan class\x3d\'dijitReset dijitInline dijitButtonNode\'\r\n\t\tdata-dojo-attach-event\x3d"ondijitclick:__onClick" data-dojo-attach-point\x3d"_buttonNode"\r\n\t\t\x3e\x3cspan class\x3d"dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"focusNode,titleNode,_arrowWrapperNode,_popupStateNode"\r\n\t\t\trole\x3d"button" aria-haspopup\x3d"true" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitIcon"\r\n\t\t\t\tdata-dojo-attach-point\x3d"iconNode"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tdata-dojo-attach-point\x3d"containerNode"\r\n\t\t\t\tid\x3d"${id}_label"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitArrowButtonInner"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitArrowButtonChar"\x3e\x26#9660;\x3c/span\r\n\t\t\x3e\x3c/span\r\n\t\x3e\x3c/span\r\n\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" class\x3d"dijitOffScreen" tabIndex\x3d"-1"\r\n\t\tdata-dojo-attach-event\x3d"onclick:_onClick" data-dojo-attach-point\x3d"valueNode" aria-hidden\x3d"true"\r\n/\x3e\x3c/span\x3e\r\n',
"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/form/templates/TextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/templates/Tooltip.html":'\x3cdiv class\x3d"dijitTooltip dijitTooltipLeft" id\x3d"dojoTooltip" data-dojo-attach-event\x3d"mouseenter:onMouseEnter,mouseleave:onMouseLeave"\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipConnector" data-dojo-attach-point\x3d"connectorNode"\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipContainer dijitTooltipContents" data-dojo-attach-point\x3d"containerNode" role\x3d\'alert\'\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/ValidationTextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/form/templates/ComboButton.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tcellspacing\x3d\'0\' cellpadding\x3d\'0\' role\x3d"presentation"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonNode" data-dojo-attach-point\x3d"buttonNode" data-dojo-attach-event\x3d"ondijitclick:__onClick,onkeydown:_onButtonKeyDown"\r\n\t\t\x3e\x3cdiv id\x3d"${id}_button" class\x3d"dijitReset dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode"\r\n\t\t\trole\x3d"button" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInline dijitIcon" data-dojo-attach-point\x3d"iconNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInline dijitButtonText" id\x3d"${id}_label" data-dojo-attach-point\x3d"containerNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd id\x3d"${id}_arrow" class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton\'\r\n\t\t\tdata-dojo-attach-point\x3d"_popupStateNode,focusNode,_buttonNode"\r\n\t\t\tdata-dojo-attach-event\x3d"onkeydown:_onArrowKeyDown"\r\n\t\t\ttitle\x3d"${optionsTitle}"\r\n\t\t\trole\x3d"button" aria-haspopup\x3d"true"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitArrowButtonInner" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitArrowButtonChar" role\x3d"presentation"\x3e\x26#9660;\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd style\x3d"display:none !important;"\r\n\t\t\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" data-dojo-attach-point\x3d"valueNode"\r\n\t\t\t\tclass\x3d"dijitOffScreen" aria-hidden\x3d"true" data-dojo-attach-event\x3d"onclick:_onClick"\r\n\t\t/\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dojox/grid/resources/View.html":'\x3cdiv class\x3d"dojoxGridView" role\x3d"presentation"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridHeader" dojoAttachPoint\x3d"headerNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"headerNodeContainer" style\x3d"width:9000em" role\x3d"presentation"\x3e\r\n\t\t\t\x3cdiv dojoAttachPoint\x3d"headerContentNode" role\x3d"row"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" dojoAttachPoint\x3d"hiddenFocusNode" aria-hidden\x3d"true" /\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" aria-hidden\x3d"true" /\x3e\r\n\t\x3cdiv class\x3d"dojoxGridScrollbox" dojoAttachPoint\x3d"scrollboxNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dojoxGridContent" dojoAttachPoint\x3d"contentNode" hidefocus\x3d"hidefocus" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dojox/grid/resources/_Grid.html":'\x3cdiv hidefocus\x3d"hidefocus" role\x3d"grid" dojoAttachEvent\x3d"onmouseout:_mouseOut"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterHeader" dojoAttachPoint\x3d"viewsHeaderNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterView" dojoAttachPoint\x3d"viewsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterMessages" style\x3d"display: none;" dojoAttachPoint\x3d"messagesNode"\x3e\x3c/div\x3e\r\n\t\x3cspan dojoAttachPoint\x3d"lastFocusNode" tabindex\x3d"0"\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/TemplatePicker.html":'\x3cdiv class\x3d"templatePicker"\x3e\r\n\r\n  \x3ctable dojoType\x3d"dojox.grid.DataGrid" noDataMessage\x3d"${emptyMessage}" selectionMode\x3d"none" autoHeight\x3d"${_rows}" autoWidth\x3d"${_autoWidth}"\r\n         query\x3d"{ query: \'*\' }" dojoAttachPoint\x3d"grid" class\x3d"grid"\x3e\r\n  \x3c/table\x3e\r\n  \r\n\x3c/div\x3e',"url:esri/dijit/editing/templates/Editor.html":'\x3cdiv class\x3d"esriEditor"\x3e\r\n    \x3cdiv class\x3d"esriTemplatePicker" dojoAttachPoint\x3d"templatePickerDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriDrawingToolbar" dojoAttachPoint\x3d"drawingToolbarDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"progressBar" dojoAttachPoint\x3d"progressBar" indeterminate\x3d"true" dojoType\x3d"dijit.ProgressBar" /\x3e\r\n\x3c/div\x3e',
"*now":function(G){G(['dojo/i18n!*preload*esri/dijit/editing/nls/Editor*["ar","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("esri/dijit/editing/Editor","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/DeferredList dojo/dom-class dojo/dom-construct dojo/string dijit/_Widget dijit/_Templated ../../domUtils ../../graphicsUtils ../../geometry/Polyline ../../geometry/Polygon ../../graphic ../../undoManager ../../tasks/query ../../layers/FeatureLayer ../../layers/FeatureTemplate ../../toolbars/draw ../../toolbars/edit ../AttributeInspector ./Util ./Add ./Update ./Delete ./Cut ./Union ./toolbars/Drawing ./SelectionHelper ./TemplatePicker ../../kernel ../../config dojo/i18n!../../nls/jsapi dojo/text!./templates/Editor.html dijit/ProgressBar dojo/NodeList-dom".split(" "),function(G,
B,A,w,q,h,p,e,l,b,a,f,n,m,d,c,g,k,t,y,K,C,r,E,F,u,D,z,M,H,x,J,L,N,P,T,S,Z){var da=G([f,n],{declaredClass:"esri.dijit.editing.Editor",widgetsInTemplate:!0,templateString:Z,onLoad:function(){},constructor:function(Q,W){Q=Q||{};Q.settings||console.error("Editor: please provide 'settings' parameter in the constructor");Q.settings.layerInfos||console.error("Editor: please provide 'layerInfos' parameter in the constructor");this._settings=Q.settings;this._eConnects=[]},startup:function(){this.inherited(arguments);
this._setDefaultOptions();this._settings.map.setInfoWindowOnClick(!1);var Q=this._settings.layerInfos;this.featureReductionEnabledLayers=[];A.forEach(Q,function(aa){aa=aa.featureLayer;aa.isFeatureReductionEnabled()&&(aa.disableFeatureReduction(),this.featureReductionEnabledLayers.push(aa))},this);if(A.every(Q,function(aa){return aa.featureLayer.loaded}))this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0;else{var W=Q.length;A.forEach(Q,function(aa){aa=aa.featureLayer;
if(aa.loaded)W--;else var R=w.connect(aa,"onLoad",this,function(V){w.disconnect(R);R=null;W--;W||(this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0)})},this)}this._reset();this._enableMapClickHandler()},stopEditing:function(Q){this._updateCurrentFeature(B.hitch(this,function(){this._clearSelection(!1);Q&&Q()}))},destroy:function(){this._settings.map.setInfoWindowOnClick(!0);this.drawingToolbar&&this.drawingToolbar.destroy();this.attributeInspector&&this.attributeInspector.destroy();
this.templatePicker&&this.templatePicker.destroy();this._selectionHelper&&this._selectionHelper.destroy();this._drawToolbar&&this._drawToolbar.deactivate();this._reset();this._disableMapClickHandler();A.forEach(this._eConnects,w.disconnect);w.disconnect(this._dtConnect);w.disconnect(this._templatePickerOnSelectionChangeEvent);this._layer=this._currentGraphic=this._activeType=this._activeTemplate=this._drawingTool=this._drawToolbar=this.editToolbar=this.drawingToolbar=this.attributeInspector=this.templatePicker=
this.undoManager=null;this._settings.map.infoWindow&&this._settings.map.infoWindow.clearFeatures&&this._settings.map.infoWindow.clearFeatures();A.forEach(this.featureReductionEnabledLayers,function(Q){Q.enableFeatureReduction()});this.inherited(arguments)},_setDefaultOptions:function(){this._drawToolbar=this._settings.drawToolbar||new r(this._settings.map);this._settings.drawToolbar=this._drawToolbar;this.editToolbar=this._settings.editToolbar||new E(this._settings.map,{textSymbolEditorHolder:this.domNode});
this._settings.editToolbar=this.editToolbar;this._settings.toolbarVisible=this._settings.toolbarVisible||!1;this._settings.toolbarOptions=B.mixin({reshapeVisible:!1,cutVisible:!1,mergeVisible:!1},this._settings.toolbarOptions);this._settings.createOptions=B.mixin({polylineDrawTools:[da.CREATE_TOOL_POLYLINE],polygonDrawTools:[da.CREATE_TOOL_POLYGON],editAttributesImmediately:!0},this._settings.createOptions);this._settings.singleSelectionTolerance=this._settings.singleSelectionTolerance||3;this._settings.maxUndoRedoOperations=
this._settings.maxUndoRedoOperations||10;this._settings.editor=this;this._usePopup=this._settings.usePopup=this._settings.map.infoWindow._setPagerCallbacks?!0:!1;this._datePackage=this._settings.datePackage;var Q=T.defaults;this._settings.geometryService=this._settings.geometryService||Q.geometryService;Q.geometryService=Q.geometryService||this._settings.geometryService},_initLayers:function(){this._settings.layers=[];this._settings.userIds={};this._settings.createOnlyLayer={};A.forEach(this._settings.layerInfos,
function(Q){if(Q.featureLayer&&Q.featureLayer.loaded){this._settings.layers.push(Q.featureLayer);var W=Q.featureLayer.id;Q.featureLayer.credential&&(this._settings.userIds[W]=Q.featureLayer.credential.userId);Q.userId&&(this._settings.userIds[W]=Q.userId);var aa=Q.featureLayer.getEditCapabilities();this._settings.createOnlyLayer[W]=aa.canCreate&&!aa.canUpdate?!0:!1;this._isTextSymbolPointLayer(Q.featureLayer)&&(Q.disableAttributeUpdate=!0)}},this)},_reset:function(){this._hideAttributeInspector();
this.editToolbar.deactivate();this._editVertices=!0;this._drawingTool=this._activeTemplate=this._activeType=this._currentGraphic=this._layer=null;this._attributeChanged=!1},_saveFeatureOnClient:function(Q){var W=this.templatePicker.getSelected();var aa=W.template?W.featureLayer.renderer.getSymbol(W.template.prototype):W.symbolInfo.symbol;this._tempGraphic=new k(Q,aa,null,null);this._tempGraphic.setAttributes(B.mixin({},W.template.prototype.attributes));aa=this._settings.map;aa.graphics.add(this._tempGraphic);
Q=this._findCenterPoint(Q);this._createAttributeInspector();aa.infoWindow.setTitle(W.featureLayer?W.featureLayer.name:S.widgets.attributeInspector.NLS_title);this.attributeInspector.showFeature(this._tempGraphic,W.featureLayer);this._showInfoWindow(Q,aa.getInfoWindowAnchor(Q));if(this._settings.createOnlyLayer[W.featureLayer.id]||this._settings.invalidTemplate)this._infoWindowHideEvent=w.connect(aa.infoWindow,"onHide",this,"_infoWindowHide");w.disconnect(this._templatePickerOnSelectionChangeEvent);
this.templatePicker.clearSelection();this._drawToolbar.deactivate();this._enableMapClickHandler();this.drawingToolbar&&this.drawingToolbar.deactivate();this._templatePickerOnSelectionChangeEvent=w.connect(this.templatePicker,"onSelectionChange",B.hitch(this,"_onCreateFeature"))},_saveAttributesOnClient:function(Q,W,aa){this._tempGraphic.attributes[W]="number"===typeof aa&&isNaN(aa)?null:aa},_infoWindowHide:function(){this._createFeature(this._tempGraphic.geometry,this._tempGraphic.attributes);w.disconnect(this._infoWindowHideEvent)},
_createFeature:function(Q,W){this._editClickPoint=this._findCenterPoint(Q);Q.rings?this._simplify(Q,B.hitch(this,function(aa){this._drawingTool!==C.TOOL_AUTO_COMPLETE_POLYGON?this._applyEdits([{layer:this._layer,adds:[this._createGraphic(aa,W)]}],B.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})):this._autoComplete(aa,B.hitch(this,function(R){R&&R.length&&this._applyEdits([{layer:this._layer,adds:A.map(R,
B.hitch(this,function(V){return this._createGraphic(V,W)}))}],function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})}))})):this._applyEdits([{layer:this._layer,adds:[this._createGraphic(Q,W)]}],B.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer);this._layer&&this._layer.renderer&&"heatmap"===this._layer.renderer.type&&this._layer.refresh()}))},
_chainAttachment:function(Q,W){this.attributeInspector&&this.attributeInspector._attachmentEditor&&this.attributeInspector._attachmentEditor._tempUpload&&this.attributeInspector._attachmentEditor._chainAttachment(Q,W)},_updateCurrentFeature:function(Q){var W=this._isModified();W?this._updateFeature(W,Q):Q&&Q(!1)},_updateFeature:function(Q,W,aa){var R=Q.geometry,V=Q.getLayer();V.hasZ&&!V.enableZDefaults||V.hasM&&!V.allowUpdateWithoutMValues||aa&&!this._isModified()?(aa=new k,aa.setAttributes(Q.attributes),
this._applyEdits([{layer:Q.getLayer(),updates:[aa]}],W)):R.rings?this._simplify(R,B.hitch(this,function(ba){this._applyEdits([{layer:Q.getLayer(),updates:[B.mixin(Q,{geometry:ba})]}],W)})):this._applyEdits([{layer:Q.getLayer(),updates:[Q]}],W)},_deleteFeature:function(Q,W){if(this._settings.invalidTemplate&&Q===this._tempGraphic)this._settings.map.graphics.remove(this._tempGraphic),this._hideAttributeInspector();else{var aa=[];Q?aa.push({layer:Q.getLayer(),deletes:[Q]}):(aa=A.map(A.filter(this._settings.layers,
function(R){return 0<R.getSelectedFeatures().length}),function(R){return{layer:R,deletes:R.getSelectedFeatures()}}))&&aa.length||!this._currentGraphic||aa.push({layer:this._layer,deletes:[this._currentGraphic]});this._applyEdits(aa,W)}},_stopEditing:function(Q,W,aa,R){m.hide(this.progressBar.domNode);this._settings.createOnlyLayer[Q.id]||this._undoRedoAdd();if(!0===Q._isSelOnly||1===Q.mode||6===Q.mode){if(W&&W.length){this.templatePicker.clearSelection();var V=new y;V.objectIds=[W[0].objectId];this._settings.createOnlyLayer[Q.id]||
this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):this._selectFeatures([Q],V,B.hitch(this,"_onEditFeature"))}}else(V=this._selectionHelper.findMapService(this._settings.map,Q))&&V.refresh(),W&&W.length&&(this.templatePicker.clearSelection(),this._settings.createOnlyLayer[Q.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):u.findFeatures(W,Q,B.hitch(this,"_onEditFeature")));R&&R.length&&(this._clearSelection(!0),this._undoRedo&&
(V=this._selectionHelper.findMapService(Q,this._settings.map))&&V.refresh());this._undoRedo&&aa&&aa.length&&((V=this._selectionHelper.findMapService(Q,this._settings.map))&&V.refresh(),this.attributeInspector.refresh(),this._undoRedo=!1);this.drawingToolbar&&this.drawingToolbar._updateUI();this._undoRedo=!1;this._settings.invalidTemplate=!1},_undoRedoAdd:function(){this._settings._isApplyEditsCall=!1;if(this._settings.undoManager){var Q=this._edits&&this._edits.length?this._edits[0]:null;if(Q){var W=
Q.adds||[],aa=Q.updates||[],R=Q.deletes||[],V=Q.preUpdates||[];Q={featureLayer:Q.layer};"CUT"===this._activeTool?W.length&&aa.length&&V.length&&this.undoManager.add(new H(B.mixin(Q,{preUpdatedGraphics:V,addedGraphics:W,postUpdatedGraphics:aa}))):"UNION"===this._activeTool?R.length&&aa.length&&V.length&&this.undoManager.add(new x(B.mixin(Q,{preUpdatedGraphics:V,deletedGraphics:R,postUpdatedGraphics:aa}))):W.length?this.undoManager.add(new D(B.mixin(Q,{addedGraphics:W}))):R.length?this.undoManager.add(new M(B.mixin(Q,
{deletedGraphics:R}))):aa.length&&(this._rollbackGraphic||V.length)&&this.undoManager.add(new z(B.mixin(Q,{preUpdatedGraphics:V.length?V:[this._rollbackGraphic],postUpdatedGraphics:aa})));this._rollbackGraphic=this._edits=null}}},_activateDrawToolbar:function(Q){this._layer=Q.featureLayer;this._activeType=Q.type;this._drawingTool=(this._activeTemplate=Q.template)?this._activeTemplate.drawingTool:null;this._drawTool=this._toDrawTool(this._drawingTool,Q.featureLayer);w.disconnect(this._dtConnect);var W=
this._layer.fields;this._settings.invalidTemplate=!1;if(this._activeTemplate&&this._activeTemplate.prototype){var aa=B.mixin({},this._activeTemplate.prototype.attributes);W=W.filter(function(R){return!1===R.nullable&&!0===R.editable});this._settings.invalidTemplate=W.some(function(R){R=aa[R.name];return null===R||void 0===R})}this._dtConnect=this._settings.createOnlyLayer[Q.featureLayer.id]||this._settings.invalidTemplate?w.connect(this._drawToolbar,"onDrawEnd",this,"_saveFeatureOnClient"):w.connect(this._drawToolbar,
"onDrawEnd",this,"_createFeature");this.editToolbar.deactivate();this._disableMapClickHandler();this.drawingToolbar?this.drawingToolbar.activateEditing(this._drawTool,this._layer):this._drawToolbar.activate(this._drawTool)},_activateEditToolbar:function(Q,W){var aa=Q.getLayer(),R=aa?aa.geometryType:null,V=this._isTextSymbolPoint(Q),ba=E.MOVE;"esriGeometryPoint"!==R&&!0===this._isNotesFeature(Q)?(ba=ba|E.ROTATE|E.SCALE,this._editVertices=!1):"esriGeometryPoint"!==R&&!0===this._editVertices?(ba=ba|
E.ROTATE|E.SCALE,this._editVertices=!1):V?(ba=ba|E.ROTATE|E.SCALE|E.EDIT_TEXT,this._editVertices=!1):(ba|=E.EDIT_VERTICES,this._editVertices=!0);this._attributeChanged=this._isModified();this._rollbackGraphic=new k(Q.toJson());R=aa.getEditCapabilities({feature:Q,userId:this._settings.userIds[aa.id]});var ha=A.filter(this._settings.layerInfos,function(qa){return qa.featureLayer.layerId===aa.layerId})[0];R.canUpdate&&!ha.disableGeometryUpdate&&R.canUpdateGeometry&&(this.editToolbar.activate(ba,Q),V&&
(this.editToolbar._textEditor._addTextBox(Q),this.editToolbar._textSymbolEditor&&this.editToolbar._textSymbolEditor.hide()));this._settings.map.infoWindow.isShowing||this._updateAttributeDisabled(Q)||(Q=W&&W.screenPoint||this._findCenterPoint(Q),this._showInfoWindow(Q,this._settings.map.getInfoWindowAnchor(Q)))},_createGraphic:function(Q,W){var aa=new k(Q,this._activeType&&this._activeType.symbol||this._layer.defaultSymbol,W);this._activeTemplate||W?aa.attributes=W||B.mixin({},this._activeTemplate.prototype.attributes):
(aa.attributes=aa.attributes||[],A.forEach(this._layer.fields,function(R){aa.attributes[R.name]=null},this));return aa},_connectEvents:function(){var Q=this._settings.layers;A.forEach(Q,function(W){this._connect(W,"onEditsComplete",B.hitch(this,"_stopEditing",W))},this);A.forEach(Q,function(W){this._connect(W,"onBeforeApplyEdits",B.hitch(this,function(){m.show(this.progressBar.domNode);this._settings._isApplyEditsCall=!0}))},this);this._connect(this.editToolbar,"onGraphicClick",B.hitch(this,"_activateEditToolbar"));
this._connect(this.editToolbar,"onGraphicFirstMove",B.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onVertexFirstMove",B.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onScaleStart",B.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onRotateStart",B.hitch(this,"_hideAttributeInspector"))},_connect:function(Q,W,aa){this._eConnects.push(w.connect(Q,W,aa))},_createWidgets:function(){this._selectionHelper=new L(this._settings);this._createTemplatePicker();
this._createAttributeInspector();this._createDrawingToolbar();this._createUndoRedoManager()},_createTemplatePicker:function(){if(this._settings.templatePicker)this.templatePicker=this._settings.templatePicker,m.hide(this.templatePickerDiv);else{var Q=A.filter(this._settings.layers,function(W){return W.getEditCapabilities().canCreate});this.templatePicker=new N({"class":"esriTemplatePicker",featureLayers:Q,showTooltip:!0,maxLabelLength:this._settings.typesCharacterLimit,columns:"auto",rows:"auto"},
this.templatePickerDiv);this.templatePicker.startup();this._settings.templatePicker=this.templatePicker}this._templatePickerOnSelectionChangeEvent=w.connect(this.templatePicker,"onSelectionChange",B.hitch(this,"_onCreateFeature"))},_createAttributeInspector:function(){var Q=this._settings.map;this._settings.attributeInspector?(this._customAttributeInspector=!0,this.attributeInspector=this._settings.attributeInspector):(this._customAttributeInspector=!1,this.attributeInspector=new F({layerInfos:this._settings.layerInfos,
hideNavButtons:this._usePopup,datePackage:this._datePackage},b.create("div")),this.attributeInspector.startup(),Q.infoWindow.setContent(this.attributeInspector.domNode),Q.infoWindow.setTitle(S.widgets.attributeInspector.NLS_title),Q.infoWindow.resize(350,375),q.query(".esriAttributeInspector .atiLayerName").style({display:"none"}));this._connect(this.attributeInspector,"onDelete",B.hitch(this,"_deleteFeature"));this._connect(this.attributeInspector,"onNext",B.hitch(this,function(W){this._updateCurrentFeature(B.hitch(this,
function(){this._attributeChanged=!1;this._onEditFeature(W)}))}));this._usePopup&&Q.infoWindow._setPagerCallbacks(this.attributeInspector,B.hitch(this.attributeInspector,"previous"),B.hitch(this.attributeInspector,"next"));this._connect(this.attributeInspector,"onAttributeChange",B.hitch(this,function(W,aa,R){if(this._settings.createOnlyLayer[this._layer.id]||this._settings.invalidTemplate)this._saveAttributesOnClient(W,aa,R);else{var V=W.getLayer();(V=A.filter(V.fields,function(ba){return ba.name===
aa})[0])&&""===R&&(R=null);this._rollbackGraphic=new k(B.clone(W.toJson()));this.attributeInspector._rollbackInfo={field:V,graphic:this._rollbackGraphic};this._currentGraphic.attributes[aa]="number"===typeof R&&isNaN(R)?null:R;this._currentGraphic.setAttributes(this._currentGraphic.attributes);this._updateFeature(this._currentGraphic,null,!0);this._attributeChanged=!1}}))},_createDrawingToolbar:function(){!0===this._settings.toolbarVisible&&(this.drawingToolbar=new J({"class":"esriDrawingToolbar",
drawToolbar:this._drawToolbar,editToolbar:this.editToolbar,settings:this._settings,onDelete:B.hitch(this,"_deleteFeature"),onApplyEdits:B.hitch(this,"_applyEdits"),onShowAttributeInspector:B.hitch(this,"_onEditFeature")},this.drawingToolbarDiv))},_createUndoRedoManager:function(){if(this._settings.enableUndoRedo||this._settings.undoManager)this._settings.enableUndoRedo=!0,this.undoManager=this._settings.undoManager,this.undoManager||(this.undoManager=this._settings.undoManager=new t({maxOperations:this._settings.maxUndoRedoOperations})),
this._connect(this.undoManager,"onUndoComplete",B.hitch(this,this._updateUndoRedoOperations)),this._connect(this.undoManager,"onRedoComplete",B.hitch(this,this._updateUndoRedoOperations)),this._connect(document,"onkeypress",B.hitch(this,function(Q){if(Q.metaKey||Q.ctrlKey)"z"===Q.charOrCode&&this._undo(),"y"===Q.charOrCode&&this._redo()}))},_updateUndoRedoOperations:function(Q){if(Q&&Q.addedIds){var W;for(W=0;W<this.undoManager.length;W++){var aa=this.undoManager.get(W);aa&&Q.layer===aa._featureLayer&&
aa.updateObjectIds(Q.oldIds,Q.addedIds)}}Q&&"Update Features"===Q.operation.label&&this.attributeInspector.refresh()},_enableMapClickHandler:function(){this._mapClickHandler=w.connect(this._settings.map,"onClick",B.hitch(this,function(Q){this._drawToolbar._geometryType||("SELECT"===this._activeTool?this._activeTool="":this._updateCurrentFeature(B.hitch(this,function(){this._reset();this._updateSelection(Q)})))}))},_disableMapClickHandler:function(){w.disconnect(this._mapClickHandler)},_onCreateFeature:function(){var Q=
this.templatePicker.getSelected();Q?this._updateCurrentFeature(B.hitch(this,function(){this._currentGraphic&&this._clearSelection(!1);this._reset();this._activateDrawToolbar(Q)})):(this._reset(),w.disconnect(this._dtConnect),this._drawToolbar.deactivate(),this._enableMapClickHandler(),this.drawingToolbar&&this.drawingToolbar.deactivate())},_isTextSymbolPoint:function(Q){if("point"===Q.geometry.type||"multipoint"===Q.geometry.type){var W=Q.getLayer(),aa=W.renderer;Q=Q.symbol||W._getSymbol(Q);!Q&&(aa.hasVisualVariables("sizeInfo",
!1)||aa.hasVisualVariables("colorInfo",!1)||aa.hasVisualVariables("opacityInfo",!1))&&aa.addBreak&&aa.infos&&1===aa.infos.length&&(Q=aa.infos[0].symbol||aa.defaultSymbol);if(Q&&"textsymbol"===Q.type)return!0}return!1},_isTextSymbolPointLayer:function(Q){return"esriGeometryPoint"===Q.geometryType&&Q.renderer&&Q.renderer._symbols&&Q.renderer._symbols[0]&&Q.renderer._symbols[0].symbol&&"textsymbol"===Q.renderer._symbols[0].symbol.type?!0:!1},_updateAttributeDisabled:function(Q){Q=Q.getLayer();if(!Q)return!1;
var W,aa=!1;for(W=0;W<this._settings.layerInfos.length;W++){var R=this._settings.layerInfos[W];if(R.featureLayer==Q){aa=R.disableAttributeUpdate;break}}return aa},_onEditFeature:function(Q,W){if(Q=(B.isArray(Q)?Q[0]:Q)||null){this._layer=Q.getLayer();if(!this._customAttributeInspector&&!this._updateAttributeDisabled(Q)){W=W||this._editClickPoint||this._findCenterPoint(Q);if(1<this._currentFeatureCount){var aa=this._popupFeatures.indexOf(Q);aa=a.substitute(S.widgets.popup.NLS_pagingInfo,{index:aa+
1,total:this._currentFeatureCount})}else aa=this._layer?this._layer.name:S.widgets.attributeInspector.NLS_title;this._settings.map.infoWindow.setTitle(aa);if(this.drawingToolbar||!this._settings.map.infoWindow.isShowing)this.attributeInspector.refresh(),this._showInfoWindow(W,this._settings.map.getInfoWindowAnchor(W));this._editClickPoint=null}Q!==this._currentGraphic&&(this._editVertices=!0,this._currentGraphic=Q,Q.getDojoShape()&&Q.getDojoShape().moveToFront(),W=this._layer.hasM,this._layer.hasZ&&
!this._layer.enableZDefaults||W&&!this._layer.allowUpdateWithoutMValues||this._activateEditToolbar(Q))}},_applyEdits:function(Q,W){Q=Q||[];if(!(0>=Q.length)){this._edits=this._oEdits=Q;var aa=[];A.forEach(Q,function(R){R.layer&&aa.push(R.layer.applyEdits(R.adds,R.updates,R.deletes))});0<aa.length&&(this._deferredsList=(new e(aa)).addCallback(B.hitch(this,function(){m.hide(this.progressBar.domNode);W&&W();var R=this._settings.map;R&&R.infoWindow.reposition&&R.infoWindow.isShowing&&R.infoWindow.reposition()})))}},
_undo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.undo())},_redo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.redo())},_simplify:function(Q,W){g.prototype.isSelfIntersecting(Q)?this._settings.geometryService.simplify([Q],function(aa){var R=aa&&aa.length?aa[0]:R;W&&W(R)}):W&&W(Q)},_autoComplete:function(Q,
W){var aa=this._getLayers("esriGeometryPolygon"),R=new y;R.geometry=Q;R.returnGeometry=!0;this._selectFeatures(aa,R,B.hitch(this,function(V){!V||0>=V.length?W&&W([Q]):this._settings.geometryService.autoComplete(d.getGeometries(V),this._toPolylines([R.geometry]),function(ba){W&&W(ba)})}))},_getLayers:function(Q){return A.filter(this._settings.layers,function(W){return W.geometryType===Q})},_selectFeatures:function(Q,W,aa,R){this._selectionHelper.selectFeatures(Q,W,R||K.SELECTION_NEW,aa)},_updateSelection:function(Q){var W=
Q.mapPoint,aa=Q.graphic,R=this._settings.layerInfos,V;this._selectionHelper.selectFeaturesByGeometry(this._settings.layers,W,K.SELECTION_NEW,B.hitch(this,function(ba){var ha=A.some(ba,B.hitch(this,function(va){return va==aa}));if(aa&&!ha)if(ha=aa.getLayer(),this._isValidLayer(ha)){var qa=new y;qa.objectIds=[aa.attributes[ha.objectIdField]];this._selectionHelper.selectFeatures([ha],qa,K.SELECTION_ADD,B.hitch(this,function(va){va&&va.length&&(va=va.concat(ba),V=u.sortFeaturesById(R,va),this._updatePopupButtons(V),
this._onEditFeature(V,W))}))}else ba&&ba.length?(V=u.sortFeaturesById(R,ba),this._updatePopupButtons(V),this._onEditFeature(V,W)):this._clearSelection();else ba&&ba.length?(V=u.sortFeaturesById(R,ba),this._updatePopupButtons(V),this._onEditFeature(V,W)):this._clearSelection()}));aa&&this._isTextSymbolPoint(aa)&&this._isValidLayer(aa.getLayer())&&this.editToolbar.activate(0|E.MOVE|E.ROTATE|E.SCALE|E.EDIT_TEXT,aa)},_updatePopupButtons:function(Q){if(this._usePopup&&Q){var W=Q.length;A.forEach([this._settings.map.infoWindow._prevFeatureButton,
this._settings.map.infoWindow._nextFeatureButton],B.hitch(this,function(R){1<W?l.remove(R,"hidden"):l.add(R,"hidden")}));var aa=1<W?"block":"none";q.query(".esriAttributeInspector .atiLayerName").style({display:aa});this._currentFeatureCount=W;this._popupFeatures=Q}else this._currentFeatureCount=this._popupFeatures=null},_clearSelection:function(Q){this._currentFeatureCount=0;this._popupFeatures=null;this._selectionHelper.clearSelection(Q||!1);this._reset()},_findCenterPoint:function(Q){Q=Q.geometry||
Q;switch(Q.type){case "point":var W=Q;break;case "polyline":W=Q.getPoint(0,Math.ceil(Q.paths[0].length/2));break;case "polygon":W=Q.rings.length-1,W=Q.getPoint(W,Q.rings[W].length-1)}return this._settings.map.toScreen(W)},_hideAttributeInspector:function(){!this._customAttributeInspector&&this._settings.map.infoWindow&&this._settings.map.infoWindow.hide()},_toPolylines:function(Q){return A.map(Q,function(W){var aa=new c(W.spatialReference);A.forEach(W.rings,function(R){aa.addPath(R)});return aa})},
_isNotesFeature:function(Q){var W=Q.getLayer(),aa=W?W.types||null:null;if(!aa)return!1;var R=Q.attributes[W.typeIdField],V;A.some(aa,function(ba){return ba.id===R?(V=ba.templates,!0):!1});return V?(Q=V[0]||null)?this._isShapeTool(Q.drawingTool)?!0:!1:!1:!1},_isValidLayer:function(Q){var W,aa=this._settings.layerInfos;for(W=0;W<aa.length;W++){var R=aa[W];if(Q.id==(R.featureLayer?R.featureLayer.id:R.layerId))return!0}return!1},_isShapeTool:function(Q){switch(Q){case C.TOOL_ARROW:return r.ARROW;case C.TOOL_LEFT_ARROW:return r.LEFT_ARROW;
case C.TOOL_RIGHT_ARROW:return r.RIGHT_ARROW;case C.TOOL_UP_ARROW:return r.UP_ARROW;case C.TOOL_DOWN_ARROW:return r.DOWN_ARROW;case C.TOOL_CIRCLE:return r.CIRCLE;case C.TOOL_ELLIPSE:return r.ELLIPSE;case C.TOOL_TRIANGLE:return r.TRIANGLE;case C.TOOL_RECTANGLE:return r.RECTANGLE;default:return null}},_toDrawTool:function(Q,W){W=W.geometryType;switch(Q){case C.TOOL_POINT:return r.POINT;case C.TOOL_ARROW:return r.ARROW;case C.TOOL_LEFT_ARROW:return r.LEFT_ARROW;case C.TOOL_RIGHT_ARROW:return r.RIGHT_ARROW;
case C.TOOL_UP_ARROW:return r.UP_ARROW;case C.TOOL_DOWN_ARROW:return r.DOWN_ARROW;case C.TOOL_CIRCLE:return r.CIRCLE;case C.TOOL_ELLIPSE:return r.ELLIPSE;case C.TOOL_TRIANGLE:return r.TRIANGLE;case C.TOOL_RECTANGLE:return r.RECTANGLE;case C.TOOL_LINE:return r.POLYLINE;case C.TOOL_POLYGON:return r.POLYGON;case C.TOOL_FREEHAND:return"esriGeometryPolyline"===W?r.FREEHAND_POLYLINE:r.FREEHAND_POLYGON;default:return Q=r.POINT,"esriGeometryPolyline"===W?(Q=r.POLYLINE,this._settings.createOptions.polylineDrawTools[0]===
da.CREATE_TOOL_FREEHAND_POLYLINE&&(Q=r.FREEHAND_POLYLINE)):"esriGeometryPolygon"===W&&(Q=r.POLYGON,this._settings.createOptions.polygonDrawTools[0]===da.CREATE_TOOL_FREEHAND_POLYGON&&(Q=r.FREEHAND_POLYGON)),Q}},_isModified:function(){var Q=this.editToolbar.getCurrentState();return(Q.isModified||this._attributeChanged)&&Q.graphic?Q.graphic:null},_showInfoWindow:function(Q,W){this._customAttributeInspector||this._settings.map.infoWindow.show(Q,W)}});B.mixin(da,{CREATE_TOOL_POLYLINE:"polyline",CREATE_TOOL_FREEHAND_POLYLINE:"freehandpolyline",
CREATE_TOOL_POLYGON:"polygon",CREATE_TOOL_FREEHAND_POLYGON:"freehandpolygon",CREATE_TOOL_AUTOCOMPLETE:"autocomplete",CREATE_TOOL_RECTANGLE:"rectangle",CREATE_TOOL_TRIANGLE:"triangle",CREATE_TOOL_CIRCLE:"circle",CREATE_TOOL_ELLIPSE:"ellipse",CREATE_TOOL_ARROW:"arrow",CREATE_TOOL_UP_ARROW:"uparrow",CREATE_TOOL_DOWN_ARROW:"downarrow",CREATE_TOOL_RIGHT_ARROW:"rightarrow",CREATE_TOOL_LEFT_ARROW:"leftarrow"});h("extend-esri")&&B.setObject("dijit.editing.Editor",da,P);return da});