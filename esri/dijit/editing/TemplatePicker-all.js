// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
/*
 @esri/arcgis-html-sanitizer - v2.7.0 - Wed Jul 14 2021 13:34:33 GMT-0400 (Eastern Daylight Time)
 Copyright (c) 2021 - Environmental Systems Research Institute, Inc.
 Apache-2.0

 js-xss
 Copyright (c) 2012-2017 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 http://ucdok.com
 MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details

 Lodash/isPlainObject
 Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
*/
require({cache:{"esri/layers/FeatureLayer":function(){define("require module dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/global dojo/promise/all ../sniff ../kernel ../lang ../request ../config ../deferredUtils ../promiseList ../SpatialReference ../urlUtils ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/jsonUtils ../support/expressionUtils ../arcadeProfiles/labelingProfile ../tasks/QueryTask ../tasks/query ../tasks/FeatureSet ../tasks/StatisticDefinition ../geometry/Extent ../geometry/jsonUtils ../geometry/normalizeUtils ../geometry/scaleUtils ./GraphicsLayer ./Field ./TimeInfo ./TimeReference ./FeatureType ./FeatureTemplate ./FeatureSubtype ./FeatureEditResult ./LabelClass ./support/domainUtils ./SnapshotMode ./OnDemandMode ./SelectionMode ./StreamMode ./GridLayout ./TrackManager ./HeatmapManager ./clustering/ClusterManager dojo/i18n!../nls/jsapi dojo/has!extend-esri?./agscommon".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a,b,k,g,p,B,J,A,h,x,z,e,t,y,H,E,G,O,L,N,T,R,Q,W,ba,da,fa,la,oa,ua,Ca,wa,Ja,Fa,Ea,Ia,Ma,U,X,Z,ea,ha,pa,ra,na,sa){var va=B.defaults,za=!!b("esri-pbf"),Aa=!!b("esri-featurelayer-pbf"),ia=F(la,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reSQLCurrentTimestamp:/current_timestamp|current_date|current_time/i,reHostedFS:/(https?:)?\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4E3,maxRecordCountForAuto:2E3,
maxVertexCountForAuto:25E4,generalizeForScale:4E3,_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error",
"info"]},constructor:function(l,C){this._preventInit||this._initFeatureLayer(l,C)},_initFeatureLayer:function(l,C){C=C||{};this._tileWidth=C.tileWidth||512;this._tileHeight=C.tileHeight||512;this.i18n=sa;this._featureReduction=this._featureReduction||C.featureReduction;this._featureReductionEnabled=null!=C.featureReductionEnabled?C.featureReductionEnabled:!0;this._featureUpdatesCheckEnabled=null!=C.featureUpdatesCheckEnabled?C.featureUpdatesCheckEnabled:!0;this.showLabels=null!=C.showLabels?C.showLabels:
!0;this._outFields=C.outFields;this._defnExpr=C.definitionExpression;this._loadCallback=C.loadCallback;this._trackIdField=C.trackIdField;this.objectIdField=C.objectIdField;var K=null!=C.resolution,P=null!=C.maxAllowableOffset;this._maxOffset=this._optMaxOffset=K||P?K?C.resolution:C.maxAllowableOffset:this.maxAllowableOffset;this.quantize=null!=C.quantize?C.quantize:!0;this._optEditable=C.editable;this._optAutoGen=C.autoGeneralize;this.editSummaryCallback=C.editSummaryCallback;this.userId=C.userId;
this.userIsAdmin=C.userIsAdmin;this.useMapTime=C.hasOwnProperty("useMapTime")?!!C.useMapTime:!0;this.source=C.source;this.gdbVersion=C.gdbVersion;this.orderByFields=C.orderByFields;this.maxPointCountForAuto=null!=C.maxPointCountForAuto?C.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=C.maxRecordCountForAuto?C.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=C.maxVertexCountForAuto?C.maxVertexCountForAuto:this.maxVertexCountForAuto;
this.generalizeForScale=null!=C.generalizeForScale?C.generalizeForScale:this.generalizeForScale;this.queryPagination=this._optQueryPagination=null!=C.queryPagination?C.queryPagination:!0;this.multipatchOption=C.multipatchOption;this.subtypeSublayerInfo=C.subtypeSublayerInfo;this._selectedFeatures={};this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();K=g.isDefined(C.mode)?C.mode:ia.MODE_ONDEMAND;this._isStream&&(K=ia.MODE_STREAM);this.mode=K;switch(K){case ia.MODE_SNAPSHOT:this.currentMode=
ia.MODE_SNAPSHOT;this._mode=new U(this);break;case ia.MODE_ONDEMAND:case ia.MODE_AUTO:this.currentMode=ia.MODE_ONDEMAND;this._mode=new X(this);this.latticeTiling=C.latticeTiling;break;case ia.MODE_SELECTION:this.currentMode=ia.MODE_SELECTION;this._mode=new Z(this);this._isSelOnly=!0;break;case ia.MODE_STREAM:this.currentMode=ia.MODE_STREAM,this._mode=new ea(this),this._isStream=!0}this._initLayer=v.hitch(this,this._initLayer);this._selectHandler=v.hitch(this,this._selectHandler);this._editable=!1;
if(v.isObject(l)&&l.layerDefinition)return this._collection=!0,this.mode=this._isStream?ia.MODE_STREAM:ia.MODE_SNAPSHOT,this._isStream||this._outFields||(this._outFields=["*"]),this._initLayer(l),this;this.source&&(l={source:this.source.toJson()},this._url.query=v.mixin(this._url.query,{layer:u.toJson(l)}));this.gdbVersion&&(this._url.query=v.mixin(this._url.query,{gdbVersion:this.gdbVersion}));this._task=new N(this.url,{source:this.source,gdbVersion:this.gdbVersion});l=this._url.path;this._fserver=
!1;-1!==l.search(/\/FeatureServer\//i)&&(this._fserver=!0);this._checkFeatureLimit();(C=C.resourceInfo)?this._initLayer(C):p({url:l,content:v.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},_initLayer:function(l,C){if(l||C){this._json=l;C=this.subtypeSublayerInfo;this._findCredential();if(this.credential&&this.credential.ssl||l&&l._ssl)this._useSSL(),this._task._useSSL();this._collection&&(this._isStream||
(this.currentMode=ia.MODE_SNAPSHOT,this._mode=new U(this)),this._featureSet=l.featureSet,this._nextId=l.nextObjectId,l=l.layerDefinition);this.version=l.currentVersion;this.version||(this.version="capabilities"in l||"drawingInfo"in l||"hasAttachments"in l||"htmlPopupType"in l||"relationships"in l||"timeInfo"in l||"typeIdField"in l||"types"in l?10:9.3);this.geometryType=l.geometryType;l.bandCount&&l.fields&&1<l.fields.length&&(this.geometryType="esriGeometryPolygon",this._isImageService=!0);"string"!==
typeof this.multipatchOption&&"esriGeometryMultiPatch"===this.geometryType&&(this.multipatchOption="xyFootprint");if(l.hasOwnProperty("capabilities")){var K=this.capabilities=l.capabilities;K&&-1!==K.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1}else this._collection||(this._editable=this._fserver);g.isDefined(this._optEditable)?(this._editable=this._optEditable,delete this._optEditable):"esriGeometryMultiPatch"===this.geometryType&&(this._editable=!1);this._isImageService&&
(this._editable=!1);this._json=u.toJson(this._json);this.isEditable()?this._setMaxOffset(null):this._canAutoGeneralize()&&(this._autoGeneralize=g.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===ia.MODE_ONDEMAND||this.mode===ia.MODE_AUTO,delete this._optAutoGen);K=l.effectiveMinScale||l.minScale;var P=l.effectiveMaxScale||l.maxScale;!this._hasMin&&K&&this.setMinScale(K);!this._hasMax&&P&&this.setMaxScale(P);this.layerId=l.id;this.name=C&&C.title||l.name;this.description=l.description;this.copyright=
l.copyrightText;this.type=l.type;this.displayField=l.displayField;this.defaultDefinitionExpression=l.definitionExpression||(l.isView?l.viewDefinitionQuery:l.definitionQuery);this.fullExtent=new W(l.extent);this.initialExtent=new W(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new h(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=l.defaultVisibility;this.editingInfo=l.editingInfo;this.supportsLastEditDate=!(!this.editingInfo||null==this.editingInfo.lastEditDate);
if("esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.hasM=l.hasM||!1;this.hasZ=l.hasZ||!1;this.indexedFields=l.indexedFields;this.indexes=l.indexes;this.maxRecordCount=l.maxRecordCount;this.canModifyLayer=l.canModifyLayer;this.supportsStatistics=l.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:l.supportsAdvancedQueries;this.supportsCalculate=l.supportsCalculate;this.supportsASyncCalculate=l.supportsASyncCalculate;
this.supportsAttachmentsByUploadId=l.supportsAttachmentsByUploadId;this.supportsCoordinatesQuantization=l.supportsCoordinatesQuantization;this.supportsQuantizationEditMode=l.supportsQuantizationEditMode;this.supportsFieldDescription=l.supportsFieldDescriptionProperty;this.supportsFormatPBF=l.supportedQueryFormats?-1!==m.map(l.supportedQueryFormats.toLowerCase().split(","),v.trim).indexOf("pbf"):!1;this.quantize=this.quantize&&this.supportsCoordinatesQuantization;this.hasLabels=l.hasLabels;this.canScaleSymbols=
l.canScaleSymbols;this.supportsRollbackOnFailureParameter=this.supportsRollbackOnFailure=l.supportsRollbackOnFailure;this.syncCanReturnChanges=l.syncCanReturnChanges;this.isDataVersioned=l.isDataVersioned;this.editFieldsInfo=l.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=l.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=l.relationships;this.allowGeometryUpdates=
g.isDefined(l.allowGeometryUpdates)?l.allowGeometryUpdates:!0;this.allowUpdateWithoutMValues=!!l.allowUpdateWithoutMValues;this.enableZDefaults=!!l.enableZDefaults;this.zDefault=g.isDefined(l.zDefault)?l.zDefault:null;this.advancedQueryCapabilities=l.advancedQueryCapabilities||{supportsStatistics:this.supportsStatistics,supportsOrderBy:this.supportsAdvancedQueries,supportsDistinct:this.supportsAdvancedQueries};this.geometryProperties=l.hasGeometryProperties&&l.geometryProperties||null;this.url&&(this.advancedQueryCapabilities.supportsPagination=
this.advancedQueryCapabilities.supportsPagination&&(this.reHostedFS.test(this.url)||10.3<this.version));this.queryPagination=this._optQueryPagination&&this.advancedQueryCapabilities.supportsPagination;this.useStandardizedQueries=l.useStandardizedQueries;this.tileMaxRecordCount=l.tileMaxRecordCount;this.standardMaxRecordCount=l.standardMaxRecordCount;if(K=l.dateFieldsTimeReference)this.dateFieldsTimeReference=new Ca(K);this._setMaxOffset(this._maxOffset,!0);this._isTable="Table"===this.type;P=l.fields;
this._createFields(P);if(!this.objectIdField){this.objectIdField=l.objectIdField;if(!this.objectIdField)for(P=l.fields,K=0;K<P.length;K++){var S=P[K];if("esriFieldTypeOID"===S.type){this.objectIdField=S.name;break}}this.objectIdField||this._isStream||console.debug("esri.layers.FeatureLayer: "+g.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!g.isDefined(this._nextId)){P=this.objectIdField;S=-1;if(this._collection&&P){var V=(K=this._featureSet)&&K.features,Y=V?V.length:0;for(K=
0;K<Y;K++){var aa=(aa=V[K].attributes)&&aa[P];aa>S&&(S=aa)}}this._nextId=S+1}this.globalIdField=l.globalIdField;if(K=this.typeIdField=l.typeIdField)if(K=!this._getField(K)&&this._getField(K,!0))this.typeIdField=K.name;this.visibilityField=l.visibilityField;if(P=l.defaultSymbol)this.defaultSymbol=y.fromJson(P);var ka=this.types=[],ca=l.types;S=(K=this.editFieldsInfo)&&K.creatorField;V=K&&K.editorField;aa=S||V;Y=[];if(ca)for(K=0;K<ca.length;K++){var qa=new wa(ca[K]);var ma=qa.templates;aa&&ma&&ma.length&&
(Y=Y.concat(ma));ka.push(qa)}ca=l.templates;qa=this.templates=[];if(ca)for(K=0;K<ca.length;K++)ka=new Ja(ca[K]),aa&&Y.push(ka),qa.push(ka);for(K=0;K<Y.length;K++)if(aa=v.getObject("prototype.attributes",!1,Y[K]))S&&delete aa[S],V&&delete aa[V];if(K=l.subtypeField)this.subtypeField=(K=this.getField(K))?K.name:null;this.defaultSubtypeCode=l.defaultSubtypeCode;this.subtypes=m.map(l.subtypes,function(ya){return new Fa(ya)});this._applySTSublayerInfo(C);if(C=l.timeInfo)this.timeInfo=new ua(C),this._startTimeField=
C.startTimeField,this._endTimeField=C.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?C.trackIdField=this._trackIdField:this._trackIdField=C.trackIdField;this.hasAttachments=!this._collection&&l.hasAttachments?!0:!1;this.htmlPopupType=l.htmlPopupType;C=l.drawingInfo;(K=C&&C.labelingInfo)&&!this.labelingInfo&&(this.labelingInfo=m.map(K,function(ya){return new Ia(ya)}),this._fixLabelExpr());if(!this.renderer)if(C&&C.renderer){var ja=C.renderer;this.setRenderer(G.fromJson(ja,
{geometryType:this.geometryType}));"classBreaks"===ja.type&&this.renderer.setMaxInclusive(!0);if(!this._collection){var ta=ja.type;K=[];ja=this.renderer;switch(ta){case "simple":K.push(ja.symbol);break;case "uniqueValue":case "classBreaks":K.push(ja.defaultSymbol),K=K.concat(m.map(ja.infos,function(ya){return ya.symbol}))}K=m.filter(K,g.isDefined);var xa=this._url.path+"/images/",Ba=this._getToken();m.forEach(K,function(ya){var Da=ya.url;Da&&(-1===Da.search(/https?:/)&&-1===Da.indexOf("data:")&&(ya.url=
xa+Da),Ba&&-1!==ya.url.search(/https?:/)&&(ya.url+="?token\x3d"+Ba))})}}else if(P)ca=this.types,0<ca.length?(ja=new E(this.defaultSymbol,this.typeIdField),m.forEach(ca,function(ya){ja.addValue(ya.id,ya.symbol)})):ja=new H(this.defaultSymbol),this.setRenderer(ja);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":ta=new z;break;case "esriGeometryPolyline":ta=new e;break;case "esriGeometryPolygon":ta=new t;break;default:this.hasXYFootprint()&&(ta=
new t)}this.setRenderer(ta?new H(ta):null)}ta=C&&C.transparency||0;!this.hasOwnProperty("opacity")&&0<ta&&(this.opacity=1-ta/100);(b("ie")||7<=b("trident")||b("safari"))&&this.isEditable()&&10.02>this.version&&(this._ts=!0);this.statistics=l.statistics;this._fixRendererFields();this._updateRequiredFieldsFromLabelingInfo();this._checkFields();this._updateCaps();var Ga=function(){null==this._maxOffset||this._isFractionalOffsetAllowed()||this._setMaxOffset(this._maxOffset);this.loaded=!0;this.setFeatureReduction(this.getFeatureReduction());
this.currentMode!==ia.MODE_SNAPSHOT&&(this.queryPagination=!1);this.onLoad(this);var ya=this._loadCallback;ya&&(delete this._loadCallback,ya(this))};l=[];this._collection?(ta=this._featureSet,this._featureSet=null,this._mode._drawFeatures(new R(ta)),this._fcAdded=!0):(l.push(this._forceIdentity()),this._limitPromise&&l.push(this._limitPromise));l.push(this._evalArcadeSupport());l.length?A(l).then(v.hitch(this,function(){Ga.call(this)})):Ga.call(this)}},_applySTSublayerInfo:function(l){l&&this.subtypeField&&
(this.subtypeCode=l.subtypeCode,this._applySTSublayerDefinitionExpression(l),this._filterSubtypes(l),this._applySTTemplates(l),this._applySTFieldOverrides(l))},_applySTSublayerDefinitionExpression:function(l){var C=[],K=this.getDefinitionExpression();K&&C.push(K);(l=l.layerDefinition&&l.layerDefinition.definitionExpression)&&C.push(l);1<C.length&&(C=m.map(C,function(P){return"("+P+")"}));this.setDefinitionExpression(C.length?C.join(" AND "):null)},_applySTTemplates:function(l){if(l=l.layerDefinition&&
l.layerDefinition.templates)this.templates=m.map(l,function(C){return new Ja(C)})},_filterSubtypes:function(){this.subtypes&&(this.subtypes=m.filter(this.subtypes,function(l){return l.code===this.subtypeCode},this))},_applySTFieldOverrides:function(l){var C=l.layerDefinition&&l.layerDefinition.fieldOverrides;if(C){this.fields=m.filter(this.fields,function(P){return m.some(C,function(S){return S.name===P.name})});var K=this.getSubtypeByCode(this.subtypeCode).domains;this.fields.forEach(function(P){var S=
m.filter(C,function(V){return V.name===P.name})[0];S.alias&&(P.alias=S.alias);if(!1===S.editable||P.name===this.subtypeField)P.editable=!1;K&&(S=K[P.name])&&"inherited"!==S.type&&(P.domain=Ma.fromJson(S.toJson()))},this)}},setShowLabels:function(l){var C=this.showLabels;this.showLabels=l;C!==this.showLabels&&(this._evalSurfaceType(),this.onShowLabelsChange())},onShowLabelsChange:function(){},onRendererChange:function(l){this.inherited(arguments);var C=this._map;this._ager=!!(l&&l.observationAger&&
l.observationRenderer);l&&"colors"in l&&"blurRadius"in l&&"maxPixelIntensity"in l?(this._evalSurfaceType(!0),"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&C&&(this._heatmapManager=new ra(this),this._heatmapManager.initialize(C))):this.renderer&&this.renderer.getRendererInfo?m.some(this.renderer.rendererInfos,function(S){return S.renderer&&"colors"in S.renderer&&"blurRadius"in S.renderer})||(this._heatmapManager=null):this._heatmapManager=null;this.timeInfo&&C&&(l&&(l.latestObservationRenderer||
l.trackRenderer)?this._trackManager||(this._trackManager=new pa(this),this._trackManager.initialize(C),this._childLayer=this._trackManager.container,this._mode._applyTimeFilter()):this._trackManager&&!this._isStream&&(this._trackManager.destroy(),this._trackManager=null));if(l){var K=[];C=m.filter([l,l.observationRenderer,l.latestObservationRenderer,l.trackRenderer],g.isDefined);var P=function(S){return null!=S&&"function"!=typeof S&&S};m.forEach(C,function(S){var V=P(S.attributeField),Y=P(S.attributeField2);
S=P(S.attributeField3);!1!==V&&K.push(V);!1!==Y&&K.push(Y);!1!==S&&K.push(S)});this._requiredFields=K}else this._requiredFields=[];this.loaded&&(this._fixRendererFields(),this._checkFields(this._requiredFields),this._collection&&(this._typesDirty=!0))},setFeatureReduction:function(l){l&&(l=v.mixin({},l),null!=l.clusterSize&&null==l.clusterRadius&&(l.clusterRadius=l.clusterSize),delete l.clusterSize);this.loaded?this._isFeatureReductionSupported(l)?this._featureReduction=l:(this._featureReduction=
null,l&&console.log("Clustering is not supported for this layer: "+this.url)):this._featureReduction=l;this._evalFeatureReduction(this._featureReduction)},hasFeatureReduction:function(){return!!this._featureReduction},getFeatureReduction:function(){var l=this._featureReduction;if(l){l=v.mixin({},l);var C=this._clusterManager;if(C=C&&C.aggregationInfo)l.clusterRadius=C.clusterRadius,l.infoTemplate=C.infoTemplate}return l},isFeatureReductionActive:function(){var l=this._clusterManager;return!!(l&&l.isClusteringEnabled()&&
l.isClusteringActive())},isFeatureReductionEnabled:function(){return this._featureReductionEnabled},enableFeatureReduction:function(){this._featureReductionEnabled||(this._featureReductionEnabled=!0,this._evalFeatureReduction(this._featureReduction))},disableFeatureReduction:function(){this._featureReductionEnabled&&(this._featureReductionEnabled=!1,this._evalFeatureReduction(this._featureReduction))},isFeatureReductionApplied:function(){return this.hasFeatureReduction()&&this.isFeatureReductionEnabled()&&
this._canCluster(this.getFeatureReduction())},getAggregateGraphics:function(){return this._clusterManager?this._clusterManager.getAggregateGraphics():[]},getChildGraphics:function(l){return this._clusterManager?this._clusterManager.getFeaturesInCluster(l):[]},getSingleGraphics:function(){return this._clusterManager?this._clusterManager.getSingleGraphics():[]},getFeatureReductionRenderer:function(){return this.isFeatureReductionActive()?this._clusterManager.getClusterRenderer():null},getFeatureReductionLayer:function(){return this._clusterManager?
this._clusterManager.container:null},getFeatureReductionField:function(l){var C,K=this._clusterManager?this._clusterManager.getClusterFields():null;l=l?l.toLowerCase():"";m.some(K,function(P){l===P.name.toLowerCase()&&(C=P);return!!C});return C},_isFeatureReductionSupported:function(l){return l&&"cluster"===l.type&&"esriGeometryPoint"===this.geometryType&&(this._collection||this._isStream||this._optQueryPagination&&this.advancedQueryCapabilities.supportsPagination)},_isReductionCompatibleRenderer:function(l){l=
l&&l.declaredClass||"";l=l.toLowerCase();return-1<l.indexOf("simplerenderer")||-1<l.indexOf("classbreaksrenderer")||-1<l.indexOf("uniquevaluerenderer")},_evalFeatureReduction:function(l){this.loaded&&this.getMap()&&(l=l||this.getFeatureReduction(),this._evalModeFromFReduction(l),l&&this.isFeatureReductionEnabled()?this._canCluster(l)?this._clusterManager?this._updateClusterManager(l):(this._clusterManager=this._createClusterManager(l),this.onFeatureReductionChange()):(console.log("Clustering is supported only for point layers where map spatial reference is WGS84 or Web Mercator"),
this._destroyClusterManager()):this._destroyClusterManager())},_canCluster:function(l){var C=this._map;if(!C)return!1;C=C.spatialReference;return this._isFeatureReductionSupported(l)&&this._isReductionCompatibleRenderer(this.renderer)&&(C.isWebMercator()||4326===C.wkid)},_createClusterManager:function(l){l=new na({layer:this,aggregationInfo:l});this._clusterHandles=[l.on("renderer-change",v.hitch(this,function(){this.onFeatureReductionRendererChange()}))];l.initialize(this._map);return l},_updateClusterManager:function(l){var C=
this._clusterManager;C&&C.setAggregationInfo(l)},_destroyClusterManager:function(l){m.forEach(this._clusterHandles,function(C){C.remove()});this._clusterHandles=null;this._clusterManager&&(this._clusterManager.destroy(l),this._clusterManager=null,this.onFeatureReductionChange())},redraw:function(){this.inherited(arguments);this._clusterManager&&this._clusterManager.redraw();this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(l){this.inherited(arguments);
var C=this._getRenderer();this._ager=!!(C&&C.observationAger&&C.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(C&&C.trackRenderer);l&&this._evalFeatureReduction()},_graphicVisibilityChanged:function(l){this._clusterManager?this._clusterManager.toggleFeatureVisibility(l):this._heatmapManager&&this._heatmapManager.redraw()},setWebGLFetchOptions:function(l){this._hasOnDemandDrillMode()&&(l=l||{},null!=l.maxDrillLevel&&(this._mode.maxDrillLevel=
l.maxDrillLevel),null!=l.maxRecordCountFactor&&(this._mode.maxRecordCountFactor=l.maxRecordCountFactor),null!=l.enablePBFQuery&&(this._mode.enablePBFQuery=l.enablePBFQuery))},_isWebGLCompatible:function(){return this.loaded&&!this.isEditable()&&!this.isFeatureReductionApplied()&&(!this.labelingInfo||!1===this.showLabels)&&!this._isGeometryOperationsUsed()&&this._isRendererSupportedInWebGL()&&this.supportsCoordinatesQuantization&&("esriGeometryPolygon"!==this.geometryType||this.advancedQueryCapabilities.supportsReturningGeometryCentroid)&&
this.currentMode===ia.MODE_ONDEMAND&&(!this._preSurfaceChangeState||this._preSurfaceChangeState.currentMode===ia.MODE_ONDEMAND)},_isRendererSupportedInWebGL:function(){if(!this.renderer)return!1;var l=this.renderer,C=l.declaredClass?l.declaredClass.toLowerCase():"";return(-1<C.indexOf("simplerenderer")||-1<C.indexOf("classbreaksrenderer")||-1<C.indexOf("uniquevaluerenderer"))&&this._hasWebGLCompatibleSymbols(l)&&this._hasWebGLCompatibleVVs(l)},_hasWebGLCompatibleSymbols:function(l){l=this._getAllSymbolsInRenderer(l);
return!(this._hasSLSWithMarker(l)||this._hasIncompatibleSMSStyles(l)||this._hasGIFMarker(l))},_hasWebGLCompatibleVVs:function(l){return!m.some(l&&l.visualVariables,function(C){var K=C.type;return("colorInfo"===K||"opacityInfo"===K)&&C.stops&&8<C.stops.length||"sizeInfo"===K&&(C.field||C.valueExpression&&"$view.scale"!==C.valueExpression||C.expression&&"view.scale"!==C.expression)&&C.stops&&6<C.stops.length?!0:!1})},_hasSLSWithMarker:function(l){return m.some(l,function(C){return C&&"simplelinesymbol"===
C.type&&!!C.marker})},_hasIncompatibleSMSStyles:function(l){var C=void 0===b("ie")&&7==b("trident");return m.some(l,function(K){return K&&"simplemarkersymbol"===K.type&&("triangle"===K.style||"path"===K.style&&C)})},_hasGIFMarker:function(l){var C=/\.gif$/,K=/^image\/gif$/;return m.some(l,function(P){return P&&"picturemarkersymbol"===P.type?C.test(P.url)||K.test(P.contentType):!1})},_getAllSymbolsInRenderer:function(l){var C=[];l&&(C.push(l.symbol),C.push(l.defaultSymbol),m.forEach(l.infos,function(K){C.push(K.symbol)}),
C=m.filter(C,function(K){return!!K}));return C},_setMap:function(l){var C=this.inherited(arguments),K=this._mode,P=this;K&&l.loaded&&K.initialize(l);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());this._addHandle=this.on("graphic-node-add",function(S){S=S.graphic.attributes;(S=P._selectedFeatures[S&&S[P.objectIdField]])&&S.attr("data-selected","")});return C},_unsetMap:function(l){this._suspendImpl(!0);this._destroyClusterManager(!1);
this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);D.disconnect(this._zoomConnect);D.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this.inherited("_unsetMap",arguments)},onAttach:function(){this._evalModeFromSurface()},onRefreshTick:function(){this.isFeatureUpdatesCheckActive()&&this._evalFeatureUpdates()},refresh:function(l){!this._needsRefresh&&l&&l.scheduled&&this.isFeatureUpdatesCheckActive()||(this._needsRefresh=!1,(l=this._mode)&&l.refresh())},setFeatureUpdatesCheckEnabled:function(l){this._featureUpdatesCheckEnabled=
l},isFeatureUpdatesCheckEnabled:function(){return!!this._featureUpdatesCheckEnabled},isFeatureUpdatesCheckActive:function(){return this.supportsLastEditDate&&this.isFeatureUpdatesCheckEnabled()&&!!this.refreshInterval&&!!v.getObject("onFeatureUpdatesResult.after",!1,this)},hasFeatureUpdates:function(){var l=new r;if(!this.supportsLastEditDate)return l.reject(Error("FeatureLayer does not support supportsLastEditDate")),l.promise;if(!this._fetchMetadataPromise||this._fetchMetadataPromise.isFulfilled())this._fetchMetadataPromise=
p({url:this._url.path,content:v.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(v.hitch(this,function(C){C=C.editingInfo.lastEditDate;var K=this.editingInfo.lastEditDate!==C;this.editingInfo.lastEditDate=C;return K}));this._fetchMetadataPromise.then(function(C){l.isFulfilled()||l.resolve(C)}).otherwise(function(C){l.isFulfilled()||l.reject(C)});return l.promise},hasXYFootprint:function(){return"esriGeometryMultiPatch"===this.geometryType&&"xyFootprint"===this.multipatchOption},
getOutFields:function(){return m.filter(this._getOutFields(),function(l){return"*"===l||!!this._getField(l)},this)},getField:function(l){return this._getField(l,!0)},isOutField:function(l){l=this.getField(l);if(!l)return!1;var C=this.getOutFields();return-1<m.indexOf(C,"*")||-1<m.indexOf(C,l.name)},getFieldLabel:function(l){var C=this.infoTemplate;C=C&&C.getFieldInfo&&C.getFieldInfo(l);l=v.isFunction(l)?null:this.getField(l);var K=C||l,P="";K&&(P=C&&C.label||l&&l.alias||K.name||K.fieldName);return P},
getDomain:function(l,C){var K,P,S=(C=C&&C.feature)&&this.typeIdField&&C.attributes&&C.attributes[this.typeIdField];null!=S&&m.some(this.types,function(V){return V.id==S?((K=V.domains&&V.domains[l])&&"inherited"===K.type&&(K=this._getLayerDomain(l),P=!0),!0):!1},this);P||K||(K=this._getLayerDomain(l));return K},_getLayerDomain:function(l){this._createFieldsIndex();var C=this._fieldsIndex;if(C)return C=C.caseSensitive,(C=C.get(l))?C.domain:null;var K;m.some(this.fields,function(P){P.name===l&&(K=P.domain);
return!!K});return K},getType:function(l){return this.getTypeById(l&&this.typeIdField&&l.attributes&&l.attributes[this.typeIdField])},getTypeById:function(l){var C;m.some(this.types,function(K){K.id==l&&(C=K);return!!C});return C},getSubtypeByCode:function(l){var C;m.some(this.subtypes,function(K){K.code==l&&(C=K);return!!C});return C},setEditable:function(l){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),
this;if(this._isImageService)return this;if(!this.loaded)return this._optEditable=l,this;var C=this._editable;this._editable=l;this._updateCaps();if(C!==l)this.onCapabilitiesChange();return this},getEditCapabilities:function(l){var C={canCreate:!1,canUpdate:!1,canDelete:!1,canUpdateGeometry:!1};if(!this.loaded||!this.isEditable())return C;var K=l&&l.feature;l=l&&l.userId||this.getUserId();var P=m.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],v.trim),S=(C=-1<m.indexOf(P,"editing"))&&
-1<m.indexOf(P,"create"),V=C&&-1<m.indexOf(P,"update");P=C&&-1<m.indexOf(P,"delete");var Y=this.ownershipBasedAccessControlForFeatures,aa=this.editFieldsInfo,ka=aa&&aa.creatorField;aa=aa&&aa.realm;K=(K=K&&K.attributes)&&ka?K[ka]:void 0;var ca=!!this.userIsAdmin;ka=!Y||ca||!(!Y.allowOthersToUpdate&&!Y.allowUpdateToOthers);var qa=!Y||ca||!(!Y.allowOthersToDelete&&!Y.allowDeleteToOthers),ma=!Y||ca||!Y.hasOwnProperty("allowAnonymousToUpdate")||Y.allowAnonymousToUpdate;Y=!Y||ca||!Y.hasOwnProperty("allowAnonymousToDelete")||
Y.allowAnonymousToDelete;l&&aa&&(l=l+"@"+aa);if(ca||C&&!(S||V||P))S=V=P=!0;C={canCreate:S,canUpdate:V,canDelete:P,canUpdateGeometry:ca||this.allowGeometryUpdates};l||(C.canUpdate=C.canUpdate&&ma,C.canDelete=C.canDelete&&Y);null===K?(C.canUpdate=C.canUpdate&&ka,C.canDelete=C.canDelete&&qa):""!==K&&K&&l.toLowerCase()!==K.toLowerCase()&&(C.canUpdate=C.canUpdate&&ka,C.canDelete=C.canDelete&&qa);return C},getUserId:function(){var l;this.loaded&&(l=this.credential&&this.credential.userId||this.userId||
"");return l},setUserIsAdmin:function(l){this.userIsAdmin=l},setEditSummaryCallback:function(l){this.editSummaryCallback=l},getEditSummary:function(l,C,K){K=g.isDefined(K)?K:(new Date).getTime();var P="";K=this.getEditInfo(l,C,K);(C=C&&C.callback||this.editSummaryCallback)&&(K=C(l,K)||"");if(v.isString(K))P=K;else{if(K){l=K.action;C=K.userId;var S=K.timeValue,V=0;l&&V++;C&&V++;g.isDefined(S)&&V++;1<V&&(P=("edit"===l?"edit":"create")+(C?"User":"")+(g.isDefined(S)?K.displayPattern:""))}P=P&&g.substitute(K,
this.i18n.layers.FeatureLayer[P])}return P},getEditInfo:function(l,C,K){if(this.loaded){K=g.isDefined(K)?K:(new Date).getTime();C=C&&C.action||"last";var P=this.editFieldsInfo,S=P&&P.creatorField,V=P&&P.creationDateField,Y=P&&P.editorField;P=P&&P.editDateField;Y=(l=l&&l.attributes)&&Y?l[Y]:void 0;P=l&&P?l[P]:null;S=this._getEditData(l&&S?l[S]:void 0,l&&V?l[V]:null,K);K=this._getEditData(Y,P,K);switch(C){case "creation":var aa=S;break;case "edit":aa=K;break;case "last":aa=K||S}aa&&(aa.action=aa===
K?"edit":"creation");return aa}},_getEditData:function(l,C,K){if(g.isDefined(C)){var P=K-C;var S=0>P?"Full":6E4>P?"Seconds":12E4>P?"Minute":36E5>P?"Minutes":72E5>P?"Hour":864E5>P?"Hours":6048E5>P?"WeekDay":"Full"}if(void 0!==l||S){var V=V||{};V.userId=l;S&&(l=w.format,K=new Date(C),V.minutes=Math.floor(P/6E4),V.hours=Math.floor(P/36E5),V.weekDay=l(K,{datePattern:"EEEE",selector:"date"}),V.formattedDate=l(K,{selector:"date"}),V.formattedTime=l(K,{selector:"time"}),V.displayPattern=S,V.timeValue=C)}return V},
isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},isQueryable:function(){var l=m.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],v.trim);return this._isStream||this.userIsAdmin||this._collection||-1!==m.indexOf(l,"query")||-1!==m.indexOf(l,"catalog")},setResolution:function(l){return this.setMaxAllowableOffset(l)},setMaxAllowableOffset:function(l){this.isEditable()||(this._optMaxOffset=l,this._setMaxOffset(l,!0));return this},_resetMaxAllowableOffset:function(){this.setMaxAllowableOffset(this._optMaxOffset);
this._prevScale=null;this._refreshMaxAllowableOffset()},_refreshMaxAllowableOffset:function(){this._calcMaxOffsetForAutoSnapshot();this._updateMaxOffset();this._needsRefresh=!1},getResolution:function(){return this.getMaxAllowableOffset()},getMaxAllowableOffset:function(){var l=this._quantizationParameters?this._quantizationParameters.tolerance:void 0;return null!=this._maxOffset?this._maxOffset:l},_setMaxOffset:function(l,C){if(null==l)return delete this._maxOffset,delete this._quantizationParameters,
this;this.quantize&&this.supportsCoordinatesQuantization?("esriGeometryPolyline"===this.geometryType?this._maxOffset=l:delete this._maxOffset,this._quantizationParameters=l?{mode:"view",originPosition:"upperLeft",tolerance:l,extent:this.fullExtent}:null):(this._isFractionalOffsetAllowed()&&C||(l=Math.floor(l)),isNaN(l)||0===l?delete this._maxOffset:this._maxOffset=l,delete this._quantizationParameters);return this},_isFractionalOffsetAllowed:function(){return null==this.version||10.1<=this.version||
navigator.languages&&this._isLangWithDot(navigator.languages[0])},_isLangWithDot:function(l){l=(l=l&&l.split("-"))&&l[0]&&l[0].toLowerCase();return-1!==m.indexOf(this._langsWithDot,l)},_langsWithDot:"ar en et fr he ja ko th vi zh".split(" "),setAutoGeneralize:function(l){this.loaded?this._canAutoGeneralize()&&((this._autoGeneralize=l)?(this._isAutoSnapshotMode()&&(this._prevScale=null),this._updateMaxOffset()):this._setMaxOffset(null)):this._optAutoGen=l;return this},_canAutoGeneralize:function(){return!this.isEditable()&&
this.mode!==ia.MODE_SNAPSHOT},setGDBVersion:function(l){this._collection||l===this.gdbVersion||!l&&!this.gdbVersion||(this.gdbVersion=l,this._task.gdbVersion=l,this._url.query=v.mixin(this._url.query,{gdbVersion:l}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange());return this},hasAllFeatures:function(){return this._mode?this._mode.hasAllFeatures():!0},hasUpdateError:function(){return this._mode?this._mode.hasUpdateError():!1},setDefinitionExpression:function(l){this._defnExpr=
l;this._hasPendingLimitQuery()||((l=this._checkFeatureLimit())?this._evalModeAndApplyDefnExpr(l):this._applyDefnExpr());return this},_applyDefnExpr:function(){var l=this._mode;l&&l.propertyChangeHandler(1)},_evalModeAndApplyDefnExpr:function(l){l.then(v.hitch(this,function(C){C&&(C instanceof Error||!C.modeChanged)&&this._applyDefnExpr()}))},getDefinitionExpression:function(){return this._defnExpr},hasDefinitionExpressionWithCurrentTimestamp:function(){return this.reSQLCurrentTimestamp.test(this.getDefinitionExpression())},
setTimeDefinition:function(l){this._isSnapshotMode()?(this._timeDefn=l,(l=this._mode)&&l.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+this.id+", Layer URL \x3d "+this.url);return this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(l,C){this._timeOffset=l;this._timeOffsetUnits=C;(l=this._mode)&&l.propertyChangeHandler(0);return this},setUseMapTime:function(l){this.useMapTime=
l;this._toggleTime(!this.suspended);(l=this._mode)&&l.propertyChangeHandler(0)},selectFeatures:function(l,C,K,P){C=C||ia.SELECTION_NEW;this._hasSelectionError=this._hasPartialSelectedFeatures=!1;l=this._getShallowClone(l);var S=this._map,V=this,Y=J._fixDfd(new r(J._dfdCanceller));l.outFields=this.getOutFields();l.returnGeometry=!0;l.multipatchOption=this.multipatchOption;S&&(l.outSpatialReference=new h(S.spatialReference.toJson()));if(!this._applyQueryFilters(l,!0)){var aa={features:[]};this._selectHandler(aa,
C,K,P,Y);return Y}if(S=this._canDoClientSideQuery(l))Y._pendingDfd=q(this._doQuery(l,S)),Y._pendingDfd.then(function(ca){aa={features:ca};V._selectHandler(aa,C,K,P,Y)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+this.invalidParams)],null,P,Y,!0),Y;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,P,Y,!0),Y;var ka=this;this._ts&&(l._ts=(new Date).getTime());S=this._canFetchPBFForQuery(l);this._enableEditModeQuantization(l,
S);(Y._pendingDfd=this._task.execute(l,null,null,S?{format:"pbf"}:null)).addCallbacks(function(ca){ka._selectHandler(ca,C,K,P,Y)},function(ca){ka._hasPartialSelectedFeatures=!0;ka._hasSelectionError=!0;ka._resolve([ca],null,P,Y,!0)})}return Y},getSelectedFeatures:function(){var l=this._selectedFeatures,C=[],K;for(K in l)l.hasOwnProperty(K)&&C.push(l[K]);return C},clearSelection:function(l){var C=this._selectedFeatures,K=this._mode,P;for(P in C)C.hasOwnProperty(P)&&(this._unSelectFeatureIIf(P,K),K._removeFeatureIIf(P));
this._selectedFeatures={};this._isSelOnly&&K._applyTimeFilter(!0);if(!l)this.onSelectionClear();return this},setSelectionSymbol:function(l){if(this._selectionSymbol=l){var C=this._selectedFeatures,K;for(K in C)C.hasOwnProperty(K)&&C[K].setSymbol(l)}return this},getSelectionSymbol:function(){return this._selectionSymbol},setLabelingInfo:function(l){l?(this.labelingInfo=l,this._fixLabelExpr()):delete this.labelingInfo;this._collection&&(this._typesDirty=!0);this._evalSurfaceType();this.onLabelingInfoChange()},
_fixLabelExpr:function(){var l=/\[([^\[\]]+)\]/ig,C,K=this,P=function(S,V){S=K._getField(V,!0);return"["+(S&&S.name||V)+"]"};m.forEach(this.labelingInfo,function(S){if(C=S.labelExpression)S.labelExpression=C.replace(l,P)})},_updateRequiredFieldsFromLabelingInfo:function(){var l=[];m.forEach(this.labelingInfo,function(C){var K=C.labelExpressionInfo;if(C.labelExpression){var P=/[\[\]]/ig;C=C.labelExpression.match(/\[[^\[\]]+\]/ig);(C=m.map(C,function(V){return V.replace(P,"")}))&&(l=l.concat(C))}if(K){if(K.value){var S=
/[\{\}]/ig;C=K.value.match(/\{[^\{\}]+\}/ig);(C=m.map(C,function(V){return V.replace(S,"")}))&&(l=l.concat(C))}K.expression&&(C=m.map(this.fields,function(V){return V.name},this),l=l.concat(O.extractFieldNames(K.expression,C)))}},this);l=m.map(l,function(C){var K=this.getField(C);return K?K.name:C},this);this._requiredFields&&(this._requiredFields=this._requiredFields.concat(l))},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(l,C,K,P,S,V){var Y=V.assembly,aa=V.dfd;this._applyNormalized(l,
Y&&Y[0]);this._applyNormalized(C,Y&&Y[1]);this.onBeforeApplyEdits(l,C,K);var ka={},ca=this.objectIdField;Y={f:"json"};var qa=!1;if(this._collection)V={},V.addResults=l?m.map(l,function(){qa=!0;return{objectId:this._nextId++,success:!0}},this):null,V.updateResults=C?m.map(C,function(ta){qa=!0;var xa=ta.attributes[ca];ka[xa]=ta;return{objectId:xa,success:!0}},this):null,V.deleteResults=K?m.map(K,function(ta){qa=!0;return{objectId:ta.attributes[ca],success:!0}},this):null,qa?this._editHandler(V,l,ka,
P,S,aa):this._resolve([V.addResults,V.updateResults,V.deleteResults],null,P,aa);else{l&&0<l.length&&(Y.adds=this._convertFeaturesToJson(l,0,1),qa=!0);if(C&&0<C.length){for(V=0;V<C.length;V++){var ma=C[V];ka[ma.attributes[ca]]=ma}Y.updates=this._convertFeaturesToJson(C,0,0,1);qa=!0}if(K&&0<K.length){C=[];for(V=0;V<K.length;V++)C.push(K[V].attributes[ca]);Y.deletes=C.join(",");qa=!0}if(qa){var ja=this;return p({url:this._url.path+"/applyEdits",content:v.mixin(Y,this._url.query),callbackParamName:"callback",
load:function(ta){ja._editHandler(ta,l,ka,P,S,aa)},error:function(ta){ja._resolve([ta],null,S,aa,!0)}},{usePost:!0})}this._resolve([],null,P,aa)}},queryFeatures:function(l,C,K,P){return this._query("execute","onQueryFeaturesComplete",l,C,K,P)},queryRelatedFeatures:function(l,C,K){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",l,C,K)},queryIds:function(l,C,K,P){return this._query("executeForIds","onQueryIdsComplete",l,C,K,P)},queryCount:function(l,C,K,P){return this._query("executeForCount",
"onQueryCountComplete",l,C,K,P)},queryExtent:function(l,C,K,P){return this._query("executeForExtent","onQueryExtentComplete",l,C,K,P)},queryAttachmentInfos:function(l,C,K){var P=this._url.path+"/"+l+"/attachments",S=new r(J._dfdCanceller),V=this;P=x.normalize(P);S._pendingDfd=p({url:P,content:v.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(Y){Y=Y.attachmentInfos;var aa;m.forEach(Y,function(ka){aa=f.objectToQuery({gdbVersion:V._url.query&&V._url.query.gdbVersion,layer:V._url.query&&
V._url.query.layer,token:V._getToken()});ka.url=P+"/"+ka.id+(aa?"?"+aa:"");ka.objectId=l});V._resolve([Y],"onQueryAttachmentInfosComplete",C,S)},error:function(Y){V._resolve([Y],null,K,S,!0)}});return S},addAttachment:function(l,C,K,P){return this._sendAttachment("add",l,C,K,P)},updateAttachment:function(l,C,K,P,S){K.appendChild(c.create("input",{type:"hidden",name:"attachmentId",value:C}));return this._sendAttachment("update",l,K,P,S)},deleteAttachments:function(l,C,K,P){var S=this._url.path+"/"+
l+"/deleteAttachments",V=new r(J._dfdCanceller),Y=this;C={f:"json",attachmentIds:C.join(",")};V._pendingDfd=p({url:S,content:v.mixin(C,this._url.query),callbackParamName:"callback",load:v.hitch(this,function(aa){aa=aa.deleteAttachmentResults;aa=m.map(aa,function(ka){ka=new Ea(ka);ka.attachmentId=ka.objectId;ka.objectId=l;return ka});Y._resolve([aa],"onDeleteAttachmentsComplete",K,V)}),error:function(aa){Y._resolve([aa],null,P,V,!0)}},{usePost:!0});return V},addType:function(l){var C=this.types;if(C){if(m.some(C,
function(K){return K.id==l.id?!0:!1}))return!1;C.push(l)}else this.types=[l];return this._typesDirty=!0},deleteType:function(l){if(this._collection){var C=this.types;if(C){var K=-1;m.some(C,function(P,S){return P.id==l?(K=S,!0):!1});if(-1<K)return this._typesDirty=!0,C.splice(K,1)[0]}}},toJson:function(){var l=this._cloneJson();if(l){l=l.layerDefinition?l:{layerDefinition:l};var C=l.layerDefinition,K=this._collection;this._updateLayerDefinition(C);var P=null;if(!K||this._fcAdded)P={geometryType:C.geometryType,
features:this._convertFeaturesToJson(this.graphics,!0)};l.featureSet=v.mixin({},l.featureSet||{},P);if(l.featureSet.transform){var S=l.featureSet.transform;delete l.featureSet.transform;P=new R(l.featureSet);P.quantize(S);l.featureSet=P.toJson()}K&&(l.nextObjectId=this._nextId,C.capabilities=this.capabilities);return l}},getLayerDefinition:function(){var l=this._cloneJson();(l=l?l.layerDefinition||l:null)&&this._updateLayerDefinition(l);return l},getFeatureCollectionLayer:function(l){var C=new r,
K=this.getLayerDefinition();if(!K)return C.reject(Error("layerDefinition not available")),C.promise;l=l||[];var P=new ia({layerDefinition:K,featureSet:{geometryType:K.geometryType,features:m.map(l,function(Y){return Y.toJson()})}}),S=P.on("load",function(){S.remove();V.remove();C.resolve(P)}),V=P.on("error",function(){P.loaded||(S.remove(),V.remove(),C.reject(P.loadError))});return C.promise},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},
onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},onLabelingInfoChange:function(){},onFeatureReductionRendererChange:function(){},
onFeatureReductionChange:function(){},onFeatureUpdatesResult:function(){},_cloneJson:function(){var l=this._json;return v.isString(l)?u.fromJson(l):v.clone(l)},_updateLayerDefinition:function(l){if(this._collection&&this._typesDirty){l.types=m.map(this.types||[],function(S){return S.toJson()});var C=this.renderer,K=this.labelingInfo,P=l.drawingInfo;!C&&!K||P||(P=l.drawingInfo={});P&&C&&-1===C.declaredClass.indexOf("TemporalRenderer")&&(P.renderer=C.toJson());K&&(P.labelingInfo=m.map(K,function(S){return S.toJson()}))}},
_evalFeatureUpdates:function(){if(!this._featureUpdatesPromise||this._featureUpdatesPromise.isFulfilled())this._featureUpdatesPromise=this.hasFeatureUpdates().otherwise(function(l){return!(l&&"cancel"===l.dojoType)}).always(v.hitch(this,function(l){this._featureUpdatesPromise=null;this.onFeatureUpdatesResult({hasUpdates:l})}))},_evalRefresh:function(l){(l.hasUpdates||this.hasDefinitionExpressionWithCurrentTimestamp())&&this.refresh()},_evalArcadeSupport:function(){var l=new r;setTimeout(v.hitch(this,
function(){this._initializeArcadeEngine().always(function(){l.resolve()})}),0);return l.promise},_initializeArcadeEngine:function(){var l=[],C=this.infoTemplate;C&&C.initializeArcadeEngine&&l.push(C.initializeArcadeEngine());(C=this.renderer)&&C.initializeArcadeEngine&&l.push(C.initializeArcadeEngine());var K=[];m.forEach(this.labelingInfo,function(P){(P=P.labelExpressionInfo)&&P.expression&&K.push(P.expression)});l.push(L.initialize(K));return A(l)},_isGeometryOperationsUsed:function(){var l=this.infoTemplate,
C=this.renderer,K=this.labelingInfo;return l&&l.hasGeometryOperations&&l.hasGeometryOperations()||C&&C.hasGeometryOperations&&C.hasGeometryOperations()||m.some(K,function(P){return O.hasGeometryOperations(P.labelExpressionInfo&&P.labelExpressionInfo.expression)})?!0:!1},_forceIdentity:function(){var l=new r,C=this,K=this._url&&this._url.path;var P=K&&K.toLowerCase().indexOf("/rest/services");var S=this.editFieldsInfo;S=S&&(S.creatorField||S.editorField);(this.userIsAdmin||S)&&!this._getToken()&&-1<
P&&k.id?(P=K.substring(0,P)+"/rest/info",p({url:P,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(V){if(V.owningSystemUrl)return k.id.checkSignInStatus(V.owningSystemUrl+"/sharing")}).then(function(V){if(V)return k.id.getCredential(K)}).then(function(V){V&&C._findCredential()}).always(function(){l.resolve()})):l.resolve();return l.promise},_isSnapshotMode:function(){return this._mode?this._mode.isInstanceOf(U):!1},_isOnDemandMode:function(){return this._mode?this._mode.isInstanceOf(X):
!1},_isAutoSnapshotMode:function(){return this._isAutoModeEnabled()&&this.currentMode===ia.MODE_SNAPSHOT},_getMaxFeaturesForAutoSnapshotMode:function(){var l=this.geometryType;if("esriGeometryPolyline"===l||"esriGeometryPolygon"===l||"esriGeometryMultipoint"===l||this.hasXYFootprint())var C=this.maxRecordCountForAuto;else"esriGeometryPoint"===l&&(C=this.maxPointCountForAuto);return C},getLastExceedsLimitResult:function(){return this._lastExceedsLimitResult},_canUseSnapshotMode:function(l){this._lastExceedsLimitResult=
l=(l=l&&l.features&&l.features[0])&&l.attributes&&l.attributes.exceedslimit;return!(this.mode!==ia.MODE_AUTO||this.isEditable()||0!==l||!(this._isPaginationAllowed()||this.maxRecordCount>=this._getMaxFeaturesForAutoSnapshotMode()))},_evalModeFromFLimit:function(l){this._canUseSnapshotMode(l)?this._enableAutoSnapshotMode():this._enableAutoOnDemandMode()},_enableAutoSnapshotMode:function(){var l=ia.MODE_SNAPSHOT;this.isFeatureReductionApplied()?this._updatePreFReductionState(l):this._preSurfaceChangeState?
(this._updatePreSurfaceChangeState(l),this._evalSurfaceType(!0)):this.currentMode!==l&&this._setFetchMode(ia.MODE_AUTO,l)},_enableAutoOnDemandMode:function(){var l=ia.MODE_ONDEMAND;this.isFeatureReductionApplied()?this._updatePreFReductionState(l):this._preSurfaceChangeState?this._updatePreSurfaceChangeState(l):this.currentMode!==l&&(this._setFetchMode(ia.MODE_AUTO,l),this._evalSurfaceType())},_evalModeFromFReduction:function(l){this.loaded&&(l&&this.isFeatureReductionEnabled()&&this._canCluster(l)?
this._enableFReductionMode():this._disableFReductionMode())},_enableFReductionMode:function(){this._evalSurfaceType(!0);if(!this._preFReductionState){var l=this.currentMode;l!==ia.MODE_SNAPSHOT&&l!==ia.MODE_STREAM&&l!==ia.MODE_SELECTION&&(this._preFReductionState={mode:this.mode,currentMode:this.currentMode},this._setFetchMode(this.mode===ia.MODE_AUTO?ia.MODE_AUTO:ia.MODE_SNAPSHOT,ia.MODE_SNAPSHOT))}},_disableFReductionMode:function(){var l=this._preFReductionState;this._preFReductionState=null;!l||
l.mode===this.mode&&l.currentMode===this.currentMode||(this._setFetchMode(l.mode,l.currentMode),this._evalSurfaceType())},_updatePreFReductionState:function(l){this._preFReductionState=this._preFReductionState||{};this._preFReductionState.mode=ia.MODE_AUTO;this._preFReductionState.currentMode=l},_evalModeFromSurface:function(){this.hasWebGLSurface()?this._enableWebGLSurfaceMode():this._disableWebGLSurfaceMode()},_enableWebGLSurfaceMode:function(){this._preSurfaceChangeState||(this._preSurfaceChangeState=
{mode:this.mode,currentMode:this.currentMode},this._setFetchMode(this.mode===ia.MODE_AUTO?ia.MODE_AUTO:ia.MODE_ONDEMAND,ia.MODE_ONDEMAND,this.webglDeps.OnDemandDrillMode))},_disableWebGLSurfaceMode:function(){var l=this._preSurfaceChangeState;l&&(this._preSurfaceChangeState=null,this._setFetchMode(l.mode,l.currentMode))},_updatePreSurfaceChangeState:function(l){this._preSurfaceChangeState=this._preSurfaceChangeState||{};this._preSurfaceChangeState.mode=ia.MODE_AUTO;this._preSurfaceChangeState.currentMode=
l},_setFetchMode:function(l,C,K){this.clearSelection();this._mode.suspend();this._mode.destroy();this.mode=l;this.currentMode=C;K=K||this._getModeConstructor(C);this._mode=new K(this);this.queryPagination=C===ia.MODE_ONDEMAND&&-1===K.prototype.declaredClass.toLowerCase().indexOf("ondemanddrillmode")?!1:this._isPaginationAllowed();(l=this.getMap())&&l.loaded&&(this._resetMaxAllowableOffset(),this._mode.initialize(l),this._mode.startup())},_isPaginationAllowed:function(){return!(!this._optQueryPagination||
this.loaded&&!this.advancedQueryCapabilities.supportsPagination)},_getModeConstructor:function(l){var C;l===ia.MODE_SNAPSHOT?C=U:l===ia.MODE_ONDEMAND&&(C=X);return C},_hasOnDemandDrillMode:function(){var l=this._mode;l=l&&l.declaredClass;return!!(l&&-1<l.toLowerCase().indexOf("ondemanddrillmode"))},_checkFeatureLimit:function(){this._limitPromise&&(this._limitPromise.cancel(),this._limitPromise=null);var l=this._queryLimit();l&&(this._lastExceedsLimitResult=null,this._limitPromise=l.then(v.hitch(this,
function(C){var K=this.currentMode;this._evalModeFromFLimit(C);return{modeChanged:this.currentMode!==K}})).always(v.hitch(this,function(C){this._limitPromise=null;return C})));return this._limitPromise},_hasPendingLimitQuery:function(){return!!this._exceedsLimitTimer},_queryLimit:function(){if(this._isAutoModeEnabled()){var l,C,K=new r(function(){clearTimeout(l);l=null;C&&!C.isFulfilled()&&C.cancel();C=null});this._exceedsLimitTimer=l=setTimeout(v.hitch(this,function(){this._exceedsLimitTimer=null;
var P=new T,S=new Q;S.statisticType="exceedslimit";S.maxPointCount=this.maxPointCountForAuto;S.maxRecordCount=this.maxRecordCountForAuto;S.maxVertexCount=this.maxVertexCountForAuto;S.outStatisticFieldName="exceedslimit";P.outStatistics=[S];C=this.queryFeatures(P).promise.then(function(V){K.resolve(V)}).otherwise(function(V){K.reject(V)})}),0);return K.promise}},_isAutoModeEnabled:function(){return this.mode===ia.MODE_AUTO&&this.reHostedFS.test(this.url)},_updateCaps:function(){var l=this._editable,
C=v.trim(this.capabilities||""),K=m.map(C?C.split(","):[],v.trim),P=m.map(C?C.toLowerCase().split(","):[],v.trim);C=m.indexOf(P,"editing");var S;P={Create:m.indexOf(P,"create"),Update:m.indexOf(P,"update"),Delete:m.indexOf(P,"delete")};if(l&&-1===C)K.push("Editing");else if(!l&&-1<C){l=[C];for(S in P)-1<P[S]&&l.push(P[S]);l.sort();for(S=l.length-1;0<=S;S--)K.splice(l[S],1)}this.capabilities=K.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);
this._suspendImpl()},_suspendImpl:function(l){this._toggleTime(!1);this._refreshHandle&&(this._refreshHandle.remove(),this._refreshHandle=null);var C=this._mode;C&&(C.suspend(),l&&C.destroy())},onResume:function(l){this.inherited(arguments);this._toggleTime(!0);this._refreshHandle=this.on("feature-updates-result",v.hitch(this,this._evalRefresh));var C=this._map,K=this._getRenderer();if(l.firstOccurrence){if(this._fixRendererFields(),this._updateRequiredFieldsFromLabelingInfo(),this._checkFields(),
this.clearSelection(),this._evalFeatureReduction(),this.timeInfo&&!this._trackManager&&(this._trackIdField||K&&(K.latestObservationRenderer||K.trackRenderer))&&(this._trackManager=new pa(this),this._trackManager.initialize(C),this._childLayer=this._trackManager.container),K&&"colors"in K&&"blurRadius"in K&&"maxPixelIntensity"in K&&"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&(this._heatmapManager=new ra(this),this._heatmapManager.initialize(C)),this._zoomConnect=D.connect(C,"onZoomEnd",
this,this._zoomEndHandler),this._refreshMaxAllowableOffset(),K=this._mode)K._init||K.initialize(C),K.startup()}else this._zoomEndHandler(),this._mode&&this._mode.resume()},_zoomEndHandler:function(){var l=this._map;this._updateMaxOffset();this._prevScale=l.getScale();!this.suspended&&this._needsRefresh&&this.refresh()},_updateMaxOffset:function(){var l=this._map;l&&l.loaded&&this._autoGeneralize&&(this._isAutoSnapshotMode()?(l=this.getMaxAllowableOffset(),this._setMaxOffset(this._getMaxOffsetForScale(),
!0),this._needsRefresh||(this._needsRefresh=l!=this.getMaxAllowableOffset())):this._setMaxOffset(l.extent.getWidth()/l.width,!l.extent.spatialReference.isWebMercator()))},_getMaxOffsetForScale:function(){if(this._map){var l=this._map.getScale(),C=this._calculatedScale,K=this._calcMaxOffset,P=this._prevScale;return l>=C&&(null==P||P<C)?K:l<C&&(null==P||P>=C)?null:this.getMaxAllowableOffset()}},_calcMaxOffsetForAutoSnapshot:function(){var l=this._map;if(l&&this._canAutoGeneralize()&&this._isAutoSnapshotMode()&&
this._autoGeneralize&&null==this.getMaxAllowableOffset()){var C=this.generalizeForScale;this._calculatedScale=C=this.maxScale?this.maxScale:this.minScale?Math.min(C,this.minScale):Math.min(C,fa.getScale(l,this.initialExtent));this._calcMaxOffset=l.extent.getWidth()/l.width/l.getScale()*C}else this._calculatedScale=this._calcMaxOffset=void 0},_toggleTime:function(l){var C=this._map;l&&this.timeInfo&&this.useMapTime&&C?(this._mapTimeExtent=C.timeExtent,this._timeConnect||(this._timeConnect=D.connect(C,
"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,D.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(l){this._mapTimeExtent=l;(l=this._mode)&&l.propertyChangeHandler(0)},_getOffsettedTE:function(l){var C=this._timeOffset,K=this._timeOffsetUnits;return l&&C&&K?l.offset(-1*C,K):l},_getTimeOverlap:function(l,C){return l&&C?l.intersection(C):l||C},_getTimeFilter:function(l){var C=this.getTimeDefinition();if(C){var K=this._getTimeOverlap(C,
null);if(!K)return[!1]}if(l){if(l=K?this._getTimeOverlap(l,K):l,!l)return[!1]}else l=K;return[!0,l]},_getAttributeFilter:function(l){var C=[],K=this.getDefinitionExpression();K&&C.push(K);l&&C.push(l);this.subtypeField&&this.subtypeCode&&C.push(this.subtypeField+" \x3d "+this.subtypeCode);1<C.length&&(C=m.map(C,function(P){return"("+P+")"}));return C.length?C.join(" AND "):null},_applyQueryFilters:function(l,C){l.where=this._getAttributeFilter(l.where);l.returnGeometry&&null==l.maxAllowableOffset&&
!l.quantizationParameters&&(l.maxAllowableOffset=this._maxOffset,l.quantizationParameters=this._quantizationParameters);C&&this.supportsAdvancedQueries&&(l.orderByFields=l.orderByFields||this.getOrderByFields());if(this.timeInfo)if(C=this._getTimeFilter(l.timeExtent),C[0])l.timeExtent=C[1];else return!1;return!0},_add:function(l){var C=this._selectionSymbol,K=l.attributes,P=this.visibilityField;C&&this._isSelOnly&&l.setSymbol(C);if(P&&K&&K.hasOwnProperty(P))l[K[P]?"show":"hide"]();return this.add.apply(this,
arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(l,C){var K=[],P=this._map,S;if((this._collection||!this._isTable&&P)&&!(l.text||l.where&&l.where!==this.getDefinitionExpression()||l.orderByFields&&l.orderByFields.length&&(S=this.getOrderByFields()||[])&&l.orderByFields.join()!==S.join()||l.outStatistics||l.returnDistinctValues)){S=this._isSnapshotMode();var V=this._isSelOnly;C=S?null:C?this._getExtentOfTiles(P.extent):P.extent;if(P=l.geometry){if(V||
l.spatialRelationship!==T.SPATIAL_REL_INTERSECTS||"extent"!==P.type||!S&&!C.contains(P))return;K.push(1)}if(C=l.objectIds)if(S)K.push(2);else{P=C.length;var Y=this._mode,aa=0,ka;for(ka=0;ka<P;ka++)Y._getFeature(C[ka])&&aa++;if(aa===P)K.push(2);else return}if(this.timeInfo)if(l=l.timeExtent,C=this._mapTimeExtent,S)l&&K.push(3);else if(V){if(l)return}else if(C)if(-1!==m.indexOf(K,2))l&&K.push(3);else if(-1!==m.indexOf(K,1))l==C&&K.push(3);else return;else if(0<K.length)l&&K.push(3);else if(l)return;
return 0<K.length?K:null}},_getAbsMid:function(l){return M.toAbsMid?M.toAbsMid(l):I.id.replace(/\/[^\/]*$/ig,"/")+l},_doQuery:function(l,C,K){var P=[],S=this.objectIdField,V=this,Y=new r,aa=new r,ka=this.graphics;if(-1!==m.indexOf(C,1)){var ca=this.spatialIndex||this._map&&this._map.spatialIndex,qa,ma=l.geometry._normalize(null,!0);null==ca&&va.autoSpatialIndexing?qa=(this._map||this).addPlugin(this._getAbsMid("../plugins/spatialIndex")).then(v.hitch(this,v.partial(this._getFromIndex,ma,ca)),function(ja){aa.resolve(v.hitch(this,
v.partial(this._filterByExtent,ka,ma)))}):ca&&(qa=this._getFromIndex(ma,ca));qa?qa.then(function(ja){for(var ta=0;ta<ja.length;ta++)ja[ta].results&&(P=P.concat(ja[ta].results));aa.resolve(P)}).otherwise(function(ja){aa.reject(ja)}):aa.resolve(this._filterByExtent(ka,ma))}else aa.resolve(ka);aa.then(function(ja){P=ja;if(-1!==m.indexOf(C,2)){var ta=l.objectIds;P=m.filter(P,function(xa){return-1<m.indexOf(ta,xa.attributes[S])})}-1!==m.indexOf(C,3)&&V.timeInfo&&(ja=l.timeExtent,P=V._filterByTime(P,ja.startTime,
ja.endTime).match);K&&(P=m.map(P,function(xa){return xa.attributes[S]},this));Y.resolve(P)});return Y},_getFromIndex:function(l,C){C=C||this.spatialIndex||this._map.spatialIndex;l instanceof Array||(l=[l]);var K=this.id;return a(m.map(l,function(P){return C.intersects(P,K)}))},_filterByExtent:function(l,C){for(var K=[],P=0,S=l.length;P<S;P++){var V=l[P],Y=V.geometry;Y&&(this.normalization&&C.length?(C[0].intersects(Y)||C[1].intersects(Y))&&K.push(V):C.intersects(Y)&&K.push(V))}return K},_filterByTime:function(l,
C,K){var P=this._startTimeField,S=this._endTimeField,V;this._twoTimeFields||(V=P||S);var Y=g.isDefined,aa=[],ka=[],ca,qa=l.length;C=C?C.getTime():-Infinity;K=K?K.getTime():Infinity;if(V)for(ca=0;ca<qa;ca++){var ma=l[ca];var ja=ma.attributes;P=ja[V];P>=C&&P<=K?aa.push(ma):ka.push(ma)}else for(ca=0;ca<qa;ca++)ma=l[ca],ja=ma.attributes,V=ja[P],ja=ja[S],V=Y(V)?V:-Infinity,ja=Y(ja)?ja:Infinity,V>=C&&V<=K||ja>=C&&ja<=K||C>=V&&K<=ja?aa.push(ma):ka.push(ma);return{match:aa,noMatch:ka}},_getSizeVariables:function(l){return l&&
m.filter(l.getVisualVariablesForType("sizeInfo",!1),function(C){return!(!C.field&&!C.valueExpression)})},_needClientSideSorting:function(l){return this._collection?!(!l||!l.length):m.some(l,function(C){return!!C.valueExpression})},_sortFeatures:function(l){var C=this.renderer,K=this._getSizeVariables(C);if(l&&1<l.length&&this._needClientSideSorting(K)){var P=K[0],S=this;l.sort(function(V,Y){V._layer||(V._layer=S);Y._layer||(Y._layer=S);V=C._getDataValue(V,P,"sizeInfo");Y=C._getDataValue(Y,P,"sizeInfo");
return null==V?-1:null==Y?1:Y-V})}return l},_resolve:function(l,C,K,P,S){C&&this[C].apply(this,l);K&&K.apply(null,l);P&&J._resDfd(P,l,S)},_getShallowClone:function(l){var C=new T,K;for(K in l)l.hasOwnProperty(K)&&(C[K]=l[K]);return C},_canFetchPBF:function(){return!!(za&&Aa&&this.supportsFormatPBF)},_canFetchPBFForQuery:function(l){return!(!this._canFetchPBF()||!this._isCacheHintEnabled(l)&&this._isAutoSnapshotMode()||!(l.quantizationParameters||!this.isEditable()&&this.supportsQuantizationEditMode)||
l.outStatistics)},_enableEditModeQuantization:function(l,C){l&&C&&!l.quantizationParameters&&(l.quantizationParameters={mode:"edit"})},_enableCacheHint:function(l,C){var K=this.advancedQueryCapabilities;K&&K.supportsQueryWithCacheHint?null==l.cacheHint&&(l.cacheHint=!0):K&&K.supportsQueryWithResultType&&this.reHostedFS.test(this.url)&&!l.resultType&&(l.resultType=C||"coherent")},_isCacheHintSupported:function(){var l=this.advancedQueryCapabilities;return l?!!(l.supportsQueryWithCacheHint||l.supportsQueryWithResultType&&
this.reHostedFS.test(this.url)):!1},_isCacheHintEnabled:function(l){var C=this.advancedQueryCapabilities;return l&&C?!!(C.supportsQueryWithCacheHint&&l.cacheHint||C.supportsQueryWithResultType&&this.reHostedFS.test(this.url)&&("coherent"===l.resultType||"tile"===l.resultType)):!1},_query:function(l,C,K,P,S,V){var Y=this,aa=this._map;V=V&&V.snapToTiles;var ka=new r(J._dfdCanceller),ca=K,qa,ma,ja;if("executeRelationshipQuery"!==l){ca=this._getShallowClone(K);var ta=this.getOutFields();ca.outFields||
(ca.outFields=ta);ca.outFields&&ca.outFields.length&&(ma=-1<m.indexOf(ta,"*")?!1:!m.every(ca.outFields,function(Ba){return-1<m.indexOf(ta,Ba)}));ca.returnGeometry=K.hasOwnProperty("returnGeometry")?K.returnGeometry:!K.outStatistics;ca.returnGeometry&&(ca.multipatchOption=this.multipatchOption,null!=ca.maxAllowableOffset||ca.quantizationParameters)&&(K=null!=ca.maxAllowableOffset?ca.maxAllowableOffset:ca.quantizationParameters.tolerance,null!=K&&K!==this.getMaxAllowableOffset()&&(ja=!0));aa&&(aa=aa&&
aa.spatialReference,(K=ca.outSpatialReference)?qa=!K.equals(aa):ca.outSpatialReference=new h(aa.toJson()));V&&(aa=ca.geometry)&&"extent"===aa.type&&(ca.geometry=this._getExtentOfTiles(aa),aa!==ca.geometry&&this._enableCacheHint(ca));if(!this._applyQueryFilters(ca,"execute"===l&&!ca.outStatistics)){switch(l){case "execute":var xa=new R({features:[]});break;case "executeForIds":xa=[];break;case "executeForCount":xa=0;break;case "executeForExtent":xa={}}this._resolve([xa],C,P,ka);return ka}if(V="executeForExtent"!==
l&&!qa&&!ma&&!ja&&this._canDoClientSideQuery(ca,V))return ka._pendingDfd=q(this._doQuery(ca,V,"executeForIds"===l||"executeForCount"===l)),ka._pendingDfd.then(function(Ba){switch(l){case "execute":xa=new R;xa.features=Ba;break;case "executeForIds":xa=Ba;break;case "executeForCount":xa=Ba.length}Y._resolve([xa],C,P,ka)}),ka}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,S,ka,!0),ka;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],
null,S,ka,!0),ka;this._ts&&(ca._ts=(new Date).getTime());V="execute"===l&&this._canFetchPBFForQuery(ca);this._enableEditModeQuantization(ca,V);(ka._pendingDfd=this._task[l](ca,null,null,V?{format:"pbf"}:null)).addCallbacks(function(Ba){var Ga=!!ca.outStatistics||qa||ma||ja;if("execute"===l||"executeRelationshipQuery"===l)if("execute"===l){var ya=Ba.features;var Da=ya.length;for(--Da;0<=Da;Da--)if(ya[Da]._layer=Y,!Ga&&!Y._isTable){var La=Y._mode._getFeature(ya[Da].attributes[Y.objectIdField]);La&&
ya.splice(Da,1,La)}}else for(La in Ba)if(Ba.hasOwnProperty(La))for(ya=Ba[La].features,Da=ya.length,--Da;0<=Da;Da--)ya[Da]._layer=Y;Y._resolve([Ba],C,P,ka)},function(Ba){Y._resolve([Ba],null,S,ka,!0)});return ka},_getExtentOfTiles:function(l){var C=this._isOnDemandMode()&&this._mode._gridLayer||ha.createFromFeatureLayer({layer:this}),K=this.getMap();K=K&&K.getTargetExtent(l);return C&&K&&C.getExtentOfIntersectingCells(K)||l},_convertFeaturesToJson:function(l,C,K,P){var S=[],V=this._selectionSymbol,
Y=this.visibilityField,aa,ka=this.objectIdField;this.loaded&&(K||P)&&(aa=m.filter(this.fields,function(xa){return!1===xa.editable&&(!P||xa.name!==ka)}));for(K=0;K<l.length;K++){var ca=l[K],qa={},ma=ca.geometry,ja=ca.attributes,ta=ca.symbol;!ma||P&&this.loaded&&!this.allowGeometryUpdates||(qa.geometry=ma.toJson());Y?(qa.attributes=ja=v.mixin({},ja),ja[Y]=ca.visible?1:0):ja&&(qa.attributes=v.mixin({},ja));qa.attributes&&aa&&aa.length&&m.forEach(aa,function(xa){delete qa.attributes[xa.name]});ta&&ta!==
V&&(qa.symbol=ta.toJson());S.push(qa)}return C?S:u.toJson(S)},_selectHandler:function(l,C,K,P,S){switch(C){case ia.SELECTION_NEW:this.clearSelection(!0);var V=!0;break;case ia.SELECTION_ADD:V=!0;break;case ia.SELECTION_SUBTRACT:V=!1}P=l.features;var Y=this._mode,aa=[],ka=this.objectIdField;if(V)for(V=0;V<P.length;V++){var ca=P[V];var qa=ca.attributes[ka];ca=Y._addFeatureIIf(qa,ca);aa.push(ca);this._selectFeatureIIf(qa,ca,Y)}else for(V=0;V<P.length;V++)ca=P[V],qa=ca.attributes[ka],this._unSelectFeatureIIf(qa,
Y),qa=Y._removeFeatureIIf(qa),aa.push(qa||ca);this._isSelOnly&&Y._applyTimeFilter(!0);this._isImageService&&10.7>this.version&&void 0===l.exceededTransferLimit&&(l.exceededTransferLimit=P.length===this.maxRecordCount);this._hasPartialSelectedFeatures=!!l.exceededTransferLimit;this._resolve([aa,C,l.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",K,S);if(l.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(l,C,K){var P=this._selectedFeatures,S=P[l];
S||(K._incRefCount(l),P[l]=C,this._isTable||(this._setSelectSymbol(C),C.attr("data-selected","")));return S||C},_unSelectFeatureIIf:function(l,C){var K=this._selectedFeatures[l];K&&(C._decRefCount(l),delete this._selectedFeatures[l],this._isTable||(this._setUnSelectSymbol(K),K.attr("data-selected")));return K},_setSelectSymbol:function(l){var C=this._selectionSymbol;C&&!this._isSelOnly&&l.setSymbol(C)},_setUnSelectSymbol:function(l){var C=this._selectionSymbol;C&&!this._isSelOnly&&C===l.symbol&&l.setSymbol(null,
!0)},_getOutFields:function(){var l=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._requiredFields).concat(this.dataAttributes);l=m.filter(l,function(K,P,S){return!!K&&m.indexOf(S,K)===P});var C=v.clone(this._outFields);if(C){if(-1!==m.indexOf(C,"*"))return C;m.forEach(l,function(K){-1===m.indexOf(C,K)&&C.push(K)});return C}return l},_checkFields:function(l){var C=l||this._getOutFields();m.forEach(C,function(K){"*"!==
K&&(this._getField(K)||console.debug("esri.layers.FeatureLayer: "+g.substitute({url:this.url,field:K},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);l||this._isTable||this._fserver||this._collection||this._isStream||m.some(this.fields,function(K){return K&&"esriFieldTypeGeometry"===K.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+g.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]"))},
_fixFieldCase:function(l,C,K){var P=l&&l[C],S;if(P&&!v.isFunction(P)){if(S=!this._getField(P)&&this._getField(P,!0))P=l[C]=S.name;K&&K.push(P)}return P},_fixRendererFields:function(){var l=this.renderer;this._orderBy=null;this._requiredFields=[];if(l&&0<this.fields.length){var C=[],K;l=m.filter([l,l.observationRenderer,l.latestObservationRenderer,l.trackRenderer],g.isDefined);var P=[].concat(l);m.forEach(l,function(S){m.forEach(S.rendererInfos,function(V){V.renderer&&P.push(V.renderer)})});m.forEach(P,
function(S){this._fixFieldCase(S,"attributeField",C);this._fixFieldCase(S,"attributeField2",C);this._fixFieldCase(S,"attributeField3",C);this._fixFieldCase(S.rotationInfo,"field",C);(K=this._fixFieldCase(S.sizeInfo,"field",C))&&!this._orderBy&&(this._orderBy=[K+" DESC"]);this._fixFieldCase(S.sizeInfo,"normalizationField",C);this._fixFieldCase(S.colorInfo,"field",C);this._fixFieldCase(S.colorInfo,"normalizationField",C);this._fixFieldCase(S.field,"field",C);this._fixFieldCase(S.opacityInfo,"field",
C);this._fixFieldCase(S.opacityInfo,"normalizationField",C);m.forEach(S.visualVariables,function(Y){K=this._fixFieldCase(Y,"field",C);"sizeInfo"===Y.type&&K&&!this._orderBy&&(this._orderBy=[K+" DESC"]);this._fixFieldCase(Y,"normalizationField",C)},this);var V=m.map(this.fields,function(Y){return Y.name},this);V=m.map(S.getFieldsUsedInExpressions(V),function(Y){var aa=this.getField(Y);return aa?aa.name:Y},this);C=C.concat(V);this._orderBy||!S.addBreak||v.isFunction(S.attributeField)||!S.backgroundFillSymbol&&
!this._hasSizeDiff(S)||(this._orderBy=[S.attributeField+" DESC"])},this);this._requiredFields=m.filter(C,g.isDefined)}},_hasSizeDiff:function(l){var C=Number.MAX_VALUE,K=-Number.MAX_VALUE,P,S;m.forEach(l.infos,function(V){if(S=V.symbol){P=0;switch(S.type){case "simplemarkersymbol":P=S.size;break;case "picturemarkersymbol":P=(S.width+S.height)/2;break;case "simplelinesymbol":case "cartographiclinesymbol":P=S.width;break;case "simplefillsymbol":case "picturefillsymbol":P=S.outline&&S.outline.width}P&&
(C=Math.min(C,P),K=Math.max(K,P))}});return C!==Number.MAX_VALUE&&K!==-Number.MAX_VALUE&&1<Math.abs(K-C)},getOrderByFields:function(){var l=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&l?m.filter(l,function(C){C=C.split(" ")[0];return!!this._getField(C,!0)},this):null},_createFields:function(l){var C=l?l.length:0,K,P=[];for(K=0;K<C;K++)P.push(new oa(l[K]));this.fields=P},_createFieldsIndex:function(){if(this._fieldsIndexDirty){var l=this.fields,C=l?l.length:0;if(50<C&&this._canUseFieldsIndex()){var K=
new Map;for(var P=new Map,S=0;S<C;S++){var V=l[S];K.set(V.name,V);P.set(V.name.toLowerCase(),V)}K={caseSensitive:K,caseInsensitive:P}}this._fieldsIndex=K;this._fieldsIndexDirty=!1}},_canUseFieldsIndex:function(){var l=d.Map;return!("function"!==typeof d.Proxy||"function"!==typeof d.Proxy.revocable||"function"!==typeof l||!l.prototype||"function"!==typeof l.prototype.set)},_getField:function(l,C){var K=this.fields;if(!K||0===K.length)return null;C&&(l=l.toLowerCase());this._createFieldsIndex();var P=
this._fieldsIndex;if(P)return P=C?P.caseInsensitive:P.caseSensitive,P.get(l);var S;m.some(K,function(V){var Y=!1;(Y=C?V&&V.name.toLowerCase()===l?!0:!1:V&&V.name===l?!0:!1)&&(S=V);return Y});return S},_getDateOpts:function(){this._dtOpts||(this._dtOpts={properties:m.map(m.filter(this.fields,function(l){return!(!l||"esriFieldTypeDate"!==l.type)}),function(l){return l.name})});return this._dtOpts},_applyNormalized:function(l,C){l&&C&&m.forEach(l,function(K,P){K&&C[P]&&K.setGeometry(C[P])})},_editHandler:function(l,
C,K,P,S,V){S=l.addResults;var Y=l.updateResults;l=l.deleteResults;var aa,ka=this.objectIdField,ca=this._mode,qa=this._isTable;var ma=this.editFieldsInfo;var ja=this.getOutFields()||[];var ta=ma&&ma.creatorField,xa=ma&&ma.creationDateField,Ba=ma&&ma.editorField,Ga=ma&&ma.editDateField;ma=ma&&ma.realm;-1===m.indexOf(ja,"*")&&(ta&&-1===m.indexOf(ja,ta)&&(ta=null),xa&&-1===m.indexOf(ja,xa)&&(xa=null),Ba&&-1===m.indexOf(ja,Ba)&&(Ba=null),Ga&&-1===m.indexOf(ja,Ga)&&(Ga=null));var ya=xa||Ga?(new Date).getTime():
null,Da=ta||Ba?this.getUserId():void 0;Da&&ma&&(Da=Da+"@"+ma);if(S){var La=this.globalIdField;for(ma=0;ma<S.length;ma++)if(S[ma]=new Ea(S[ma]),!qa){var Ka=S[ma];if(Ka.success){var Ha=Ka.objectId;ja=C[ma];(aa=ja._graphicsLayer)&&aa!==this&&aa.remove(ja);aa=ja.attributes||{};aa[ka]=Ha;Ha=Ka.globalId;La&&Ha&&(aa[La]=Ha);ta&&(aa[ta]=Da);Ba&&(aa[Ba]=Da);xa&&(aa[xa]=ya);Ga&&(aa[Ga]=ya);ja.setAttributes(aa);ca._init&&ca.drawFeature(ja)}}}if(Y)for(ma=0;ma<Y.length;ma++)if(Y[ma]=new Ea(Y[ma]),!qa&&(Ka=Y[ma],
Ka.success)){Ha=Ka.objectId;ja=K[Ha];if(C=ca._getFeature(Ha))C.geometry!==ja.geometry&&ja.geometry&&C.setGeometry(ba.fromJson(ja.geometry.toJson())),C.attributes!==ja.attributes&&ja.attributes&&C.setAttributes(v.mixin(C.attributes,ja.attributes)),this._repaint(C,Ha);ja=C||ja;aa=ja.attributes||{};Ba&&(aa[Ba]=Da);Ga&&(aa[Ga]=ya);ja.setAttributes(aa)}if(l){K=[];for(ma=0;ma<l.length;ma++)if(l[ma]=new Ea(l[ma]),!qa&&(Ka=l[ma],Ka.success&&(Ha=Ka.objectId,ja=ca._getFeature(Ha))))this._unSelectFeatureIIf(Ha,
ca)&&K.push(ja),ja._count=0,ca._removeFeatureIIf(Ha);if(0<K.length)this.onSelectionComplete(K,ia.SELECTION_SUBTRACT)}this._resolve([S,Y,l],"onEditsComplete",P,V)},_sendAttachment:function(l,C,K,P,S){var V=this;return p({url:this._url.path+"/"+C+"/"+("add"===l?"addAttachment":"updateAttachment"),form:K,content:v.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(Y){var aa="add"===l?"onAddAttachmentComplete":"onUpdateAttachmentComplete";
Y=new Ea(Y["add"===l?"addAttachmentResult":"updateAttachmentResult"]);Y.attachmentId=Y.objectId;Y.objectId=C;V._resolve([Y],aa,P);return Y}).addErrback(function(Y){V._resolve([Y],null,S,null,!0)})},_repaint:function(l,C,K){C=g.isDefined(C)?C:l.attributes[this.objectIdField];C in this._selectedFeatures&&this._selectionSymbol||l.setSymbol(l.symbol,K)},_getKind:function(l){var C=this._trackManager;return C?C.isLatestObservation(l)?1:0:0}});v.mixin(ia,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,
SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,MODE_AUTO:6,MODE_STREAM:7,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});da._createWrappers(ia);Object.defineProperty(ia.prototype,"graphics",{get:function(){return this._hasOnDemandDrillMode()?this._mode.graphics:this._graphicsVal},set:function(l){this._graphicsVal=l}});Object.defineProperty(ia.prototype,"name",{get:function(){return this.arcgisProps&&this.arcgisProps.title?
this.arcgisProps.title:this._name},set:function(l){this._name=l;this.loaded&&this.arcgisProps&&(this.arcgisProps.title=null)}});Object.defineProperty(ia.prototype,"fields",{get:function(){return this._fields},set:function(l){l&&this._canUseFieldsIndex()&&(l=new Proxy(l,{set:v.hitch(this,function(C,K,P){if(K)if("length"===K)this._fieldsIndexDirty=!0;else{var S=Number(K);"number"!==typeof S||isNaN(S)||(this._fieldsIndexDirty=!0)}C[K]=P;return!0})}));this._fields=l;this._fieldsIndexDirty=!0}});b("extend-esri")&&
v.setObject("layers.FeatureLayer",ia,k);return ia})},"esri/arcadeProfiles/labelingProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(M,I,F,D,v,m,u,r){M=new (M(null,{declaredClass:"esri.arcadeProfiles.LabelingProfile",defaults:{context:{vars:{$feature:"any"}}},initialize:function(w){var f=[];r.hasGeometryOperations(w)&&f.push(u.enableGeometryOperations());return v(f)},isAsync:function(w){return!1},
parse:function(w){return u.createSyntaxTree(w.expression)},compile:function(w){var f=I.clone(this.defaults.context);return w.syntaxTree?u.createFunction(w.syntaxTree,f):null},getEvalOptions:function(w){var f=w.feature;return{context:{vars:{$feature:f&&w.expression.hasVariable("$feature")?m.createFromGraphicLikeObject(f.geometry,f.attributes,w.layer):null},spatialReference:w.spatialReference}}}}));F("extend-esri")&&I.setObject("arcadeProfiles.labelingProfile",M,D);return M})},"esri/tasks/QueryTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/DeferredList ../kernel ../sniff ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a){var b=w("esri-pbf"),k=I(null,{url:null,query:null,requestOptions:null,pagination:null,pageSize:null,_fetchDfd:null,_startPage:null,_result:null,constructor:function(p){this._handleSuccess=F.hitch(this,this._handleSuccess);this._handleError=F.hitch(this,this._handleError);F.mixin(this,p);null==this.pagination&&(this.pagination=!1);null==this.pageSize&&(this.pageSize=1E3)},execute:function(){var p=new v(this._canceler);this._fetchDfd=p;this._result=null;this._sendRequest();
return p.promise},_canceler:function(p){var B=p._pendingRequest;if(!p.isFulfilled()&&B&&!B.isFulfilled()){B.cancel();var J=B.results&&B.results[1]}p._pendingRequest=null;return J},_sendRequest:function(p){var B=this.query;this.pagination&&(this._startPage=B.resultOffset=null==p?0:p,B.resultRecordCount=this.pageSize);p=this.requestOptions;this._fetchDfd._pendingRequest=f({url:this.url,content:B,handleAs:"pbf"===B.f?"arraybuffer":"json",callbackParamName:"callback",timeout:p&&p.timeout},p);this._fetchDfd._pendingRequest.then(this._handleSuccess).otherwise(this._handleError)},
_handleSuccess:function(p){this.pagination?(p.exceededTransferLimit&&this._sendRequest(this._startPage+this.pageSize),this._result?this._result.features=this._result.features.concat(p.features):this._result=p,this._fetchDfd.progress(p),p.exceededTransferLimit||this._fetchDfd.resolve(this._result)):(this._fetchDfd.progress(p),this._fetchDfd.resolve(p))},_handleError:function(p){this._fetchDfd.reject(p)}}),g=I(d,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],
"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(p,B){this._handler=F.hitch(this,this._handler);this._relationshipQueryHandler=F.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=F.hitch(this,this._executeForIdsHandler);this._countHandler=F.hitch(this,this._countHandler);this._extentHandler=F.hitch(this,this._extentHandler);this.source=B&&B.source;this.gdbVersion=B&&B.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",
c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"rawExecute",c:2,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onRawExecuteComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(p,B,J,A,h){var x=
h.assembly;p=this._encode(F.mixin({},this._url.query,{f:A&&A.format||"json"},p.toJson(x&&x[0])));var z=this._handler,e=this._errorHandler;this.source&&(A={source:this.source.toJson()},p.layer=m.toJson(A));this.gdbVersion&&(p.gdbVersion=this.gdbVersion);var t="pbf"===p.f;if(t){var y;b||(y="QueryTask.execute: 'pbf' format is not supported in your browser.");if(y)return p=new v,p.addErrback(function(H){e(H,J,h.dfd)}),p.reject(Error(y)),p}y=this.requestOptions;y=f({url:this._url.path+"/query",content:p,
callbackParamName:"callback",handleAs:t?"arraybuffer":"json",timeout:y&&y.timeout},y);p=[y];t&&p.push(g.loadPBFReader());(new u(p)).then(function(H){h.dfd.isFulfilled()||(H=H[0],H[0]?z(H[1],t,B,J,h.dfd):e(H[1],J,h.dfd))});return y},rawExecute:function(p,B,J){B=B||{};p=this._encode(F.mixin({},this._url.query,{f:B.format||"json"},p.toJson(J.assembly&&J.assembly[0])));this.source&&(p.layer=m.toJson({source:this.source.toJson()}));this.gdbVersion&&(p.gdbVersion=this.gdbVersion);return(new k({url:this._url.path+
"/query",query:p,requestOptions:this.requestOptions,pagination:B.pagination,pageSize:B.pageSize})).execute().then(null,null,function(A){J.dfd.progress(A)}).then(F.hitch(this,function(A){this._successHandler([A],"onRawExecuteComplete",null,J.dfd)})).otherwise(F.hitch(this,function(A){this._errorHandler(A,null,J.dfd)}))},executeRelationshipQuery:function(p,B,J){p=this._encode(F.mixin({},this._url.query,{f:"json"},p.toJson()));var A=this._relationshipQueryHandler,h=this._errorHandler;this.gdbVersion&&
(p.gdbVersion=this.gdbVersion);var x=new v(c._dfdCanceller),z=this.requestOptions,e=this._url.path;this.source&&void 0!==this.source.mapLayerId&&null!==this.source.mapLayerId&&e.endsWith("/dynamicLayer")&&(e=e.slice(0,-13),e=e+"/"+this.source.mapLayerId);x._pendingDfd=f({url:e+"/queryRelatedRecords",content:p,callbackParamName:"callback",timeout:z&&z.timeout,load:function(t,y){A(t,y,B,J,x)},error:function(t){h(t,J,x)}},z);return x},executeForIds:function(p,B,J,A){var h=A.assembly;p=this._encode(F.mixin({},
this._url.query,{f:"json",returnIdsOnly:!0},p.toJson(h&&h[0])));var x=this._executeForIdsHandler,z=this._errorHandler;this.source&&(h={source:this.source.toJson()},p.layer=m.toJson(h));this.gdbVersion&&(p.gdbVersion=this.gdbVersion);h=this.requestOptions;return f({url:this._url.path+"/query",content:p,callbackParamName:"callback",timeout:h&&h.timeout,load:function(e,t){x(e,t,B,J,A.dfd)},error:function(e){z(e,J,A.dfd)}},h)},executeForCount:function(p,B,J,A){var h=A.assembly;p=this._encode(F.mixin({},
this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},p.toJson(h&&h[0])));var x=this._countHandler,z=this._errorHandler;this.source&&(h={source:this.source.toJson()},p.layer=m.toJson(h));this.gdbVersion&&(p.gdbVersion=this.gdbVersion);h=this.requestOptions;return f({url:this._url.path+"/query",content:p,callbackParamName:"callback",timeout:h&&h.timeout,load:function(e,t){x(e,t,B,J,A.dfd)},error:function(e){z(e,J,A.dfd)}},h)},executeForExtent:function(p,B,J,A){var h=A.assembly;p=this._encode(F.mixin({},
this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},p.toJson(h&&h[0])));var x=this._extentHandler,z=this._errorHandler;this.source&&(h={source:this.source.toJson()},p.layer=m.toJson(h));this.gdbVersion&&(p.gdbVersion=this.gdbVersion);h=this.requestOptions;return f({url:this._url.path+"/query",content:p,callbackParamName:"callback",timeout:h&&h.timeout,load:function(e,t){x(e,t,B,J,A.dfd)},error:function(e){z(e,J,A.dfd)}},h)},_handler:function(p,B,J,A,h){try{p&&B&&(p=g.pbfDeps.optimizedFeatures.convertToFeatureSet(g.pbfDeps.pbfQueryUtils.parsePBFFeatureQuery(p)));
var x=new a(p);this._successHandler([x],"onComplete",J,h)}catch(z){this._errorHandler(z,A,h)}},_relationshipQueryHandler:function(p,B,J,A,h){try{var x=p.geometryType,z=p.spatialReference,e={};D.forEach(p.relatedRecordGroups,function(t){var y={};y.geometryType=x;y.spatialReference=z;y.features=t.relatedRecords;y=new a(y);if(null!=t.objectId)e[t.objectId]=y;else for(var H in t)t.hasOwnProperty(H)&&"relatedRecords"!==H&&(e[t[H]]=y)});this._successHandler([e],"onExecuteRelationshipQueryComplete",J,h)}catch(t){this._errorHandler(t,
A,h)}},_executeForIdsHandler:function(p,B,J,A,h){try{this._successHandler([p.objectIds],"onExecuteForIdsComplete",J,h)}catch(x){this._errorHandler(x,A,h)}},_countHandler:function(p,B,J,A,h){try{var x=p.features,z=p.objectIds;if(z)var e=z.length;else{if(x)throw Error("Unable to perform query. Please check your parameters.");e=p.count}this._successHandler([e],"onExecuteForCountComplete",J,h)}catch(t){this._errorHandler(t,A,h)}},_extentHandler:function(p,B,J,A,h){try{p.extent&&(p.extent=new n(p.extent)),
this._successHandler([p],"onExecuteForExtentComplete",J,h)}catch(x){this._errorHandler(x,A,h)}}});g.loadPBFReader=function(){var p=new v;g.pbfDeps?p.resolve():M(["./support/pbfDeps"],function(B){g.pbfDeps=B;p.isFulfilled()||p.resolve()});return p.promise};q._createWrappers(g);w("extend-esri")&&F.setObject("tasks.QueryTask",g,r);return g})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(M,I,F){M.DeferredList=function(D,v,m,u,r){var w=[];I.call(this);
var f=this;0!==D.length||v||this.resolve([0,[]]);var c=0;F.forEach(D,function(n,q){function d(a,b){w[q]=[a,b];c++;c===D.length&&f.resolve(w)}n.then(function(a){v?f.resolve([q,a]):d(!0,a)},function(a){m?f.reject(a):d(!1,a);if(u)return null;throw a;})})};M.DeferredList.prototype=new I;M.DeferredList.prototype.gatherResults=function(D){D=new M.DeferredList(D,!1,!0,!1);D.addCallback(function(v){var m=[];F.forEach(v,function(u){m.push(u[1])});return m});return D};return M.DeferredList})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),
function(M,I,F,D,v,m,u,r){M=M(r,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(w,f){w&&I.isString(w)&&(this._url=u.urlToObject(this.url=w));f&&f.requestOptions&&(this.requestOptions=f.requestOptions);this.normalization=!0;this._errorHandler=I.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var w=this._url,f=/^http:/i;this.url&&(this.url=this.url.replace(f,"https:"));w&&w.path&&(w.path=w.path.replace(f,"https:"))},
_encode:function(w,f,c){var n={},q;for(q in w)if("declaredClass"!==q){var d=w[q];var a=typeof d;if(null!==d&&void 0!==d&&"function"!==a)if(I.isArray(d)){n[q]=[];var b=d.length;for(a=0;a<b;a++)n[q][a]=this._encode(d[a])}else"object"===a?d.toJson&&(a=d.toJson(c&&c[q]),"esri.tasks.FeatureSet"===d.declaredClass&&a.spatialReference&&(a.sr=a.spatialReference,delete a.spatialReference),n[q]=f?a:F.toJson(a)):n[q]=d}return n},_successHandler:function(w,f,c,n){f&&this[f].apply(this,w);c&&c.apply(null,w);n&&
m._resDfd(n,w)},_errorHandler:function(w,f,c){this.onError(w);f&&f(w);c&&c.errback(w)},setNormalization:function(w){this.normalization=w},onError:function(){}});D("extend-esri")&&(v.Task=M);return M})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n){M=M(null,{declaredClass:"esri.tasks.FeatureSet",
constructor:function(q,d){if(q){I.mixin(this,q);var a=this.features=this.features||[],b=q.spatialReference;b=this.spatialReference=c.createInstance(r.simpleConstructor,b);var k=c.getGeometryType(q.geometryType);this.geometryType=q.geometryType;q.fields&&(this.fields=q.fields);q=c.supportsLazyUnquantization(this.geometryType);var g=c.unquantizeFunction(this.geometryType,this.transform),p=!!(d&&q&&g),B=k&&(p?k.accessorConstructor:k.simpleConstructor);F.forEach(a,function(J,A){var h=c.createInstance(u.simpleConstructor),
x=J.geometry;if(k&&x){var z=h.geometry=c.createInstance(B,p?null:x);z.setSpatialReference(x.spatialReference?c.createInstance(r.simpleConstructor,x.spatialReference):b);p&&z.setupLazyUnquantization(g,x)}h.symbol=J.symbol?n.fromJson(J.symbol):null;h.attributes=J.attributes;a[A]=h});p||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(q){var d={};this.displayFieldName&&(d.displayFieldName=this.displayFieldName);this.fields&&
(d.fields=this.fields);this.spatialReference?d.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(d.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(d.geometryType=c.getJsonType(this.features[0].geometry)),d.features=w._encodeGraphics(this.features,q));d.geometryType=d.geometryType||this.geometryType;d.exceededTransferLimit=this.exceededTransferLimit;d.transform=this.transform;return m.fixJson(d)},
_hydrate:function(){c.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(q){if(!this.geometryType)return this.transform=null,this;var d=q.translate[0],a=q.translate[1],b=q.scale[0],k=q.scale[1],g=this.features,p=function(h,x,z){var e,t=[];var y=0;for(e=h.length;y<e;y++){var H=h[y];if(0<y){var E=x(H[0]);H=z(H[1]);if(E!==G||H!==O){t.push([E-G,H-O]);var G=E;var O=H}}else G=x(H[0]),O=z(H[1]),t.push([G,O])}return 0<t.length?t:null},B=function(h,x,z){if("esriGeometryPoint"===
h)return function(e){e.x=x(e.x);e.y=z(e.y);return e};if("esriGeometryPolyline"===h||"esriGeometryPolygon"===h)return function(e){var t;var y=e.rings||e.paths;var H=[];var E=0;for(t=y.length;E<t;E++){var G=y[E];(G=p(G,x,z))&&H.push(G)}return 0<H.length?(e.rings?e.rings=H:e.paths=H,e):null};if("esriGeometryMultipoint"===h)return function(e){var t=p(e.points,x,z);return 0<t.length?(e.points=t,e):null};if("esriGeometryEnvelope"===h)return function(e){return e}}(this.geometryType,function(h){return Math.round((h-
d)/b)},function(h){return Math.round((a-h)/k)}),J;var A=0;for(J=g.length;A<J;A++)g[A].geometry&&(B(g[A].geometry)||g[A].setGeometry(null));this.transform=q;return this}});M.createGraphics=function(q){var d=q.geometryType,a=c.createInstance(r.simpleConstructor,q.spatialReference),b=c.getGeometryType(d).accessorConstructor,k=c.unquantizeFunction(d,q.transform);return F.map(q.features,function(g,p){p=c.createInstance(u.simpleConstructor);var B=g.geometry;if(B){var J=p.geometry=c.createInstance(b);J.setSpatialReference(a);
J.setupLazyUnquantization(k,B)}p.attributes=g.attributes;return p})};M.createPolygon=function(q,d,a){if(q){var b=c.createInstance(f.accessorConstructor);b.setSpatialReference(d);d=c.unquantizeFunction("esriGeometryPolygon",a);b.setupLazyUnquantization(d,q)}return b};D("extend-esri")&&I.setObject("tasks.FeatureSet",M,v);return M})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(M,I,F,D){M=M(null,{declaredClass:"esri.tasks.StatisticDefinition",
toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});F("extend-esri")&&I.setObject("tasks.StatisticDefinition",M,D);return M})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../symbols/jsonUtils ./FeatureTemplate ./support/domainUtils".split(" "),
function(M,I,F,D,v,m,u,r,w){M=M(null,{declaredClass:"esri.layers.FeatureType",constructor:function(f){if(f&&I.isObject(f)){this.id=f.id;this.name=f.name;var c=f.symbol;c&&(this.symbol=u.fromJson(c));c=f.domains;var n=this.domains={};for(q in c)c.hasOwnProperty(q)&&(n[q]=w.fromJson(c[q]));if(f=f.templates){var q=this.templates=[];for(c=0;c<f.length;c++)q.push(new r(f[c]))}}},toJson:function(){var f={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},c,n=this.domains,q=this.templates,
d=m.fixJson;if(n){var a=f.domains={};for(c in n)n.hasOwnProperty(c)&&(a[c]=n[c]&&n[c].toJson());d(a)}q&&(f.templates=F.map(q,function(b){return b.toJson()}));return d(f)}});D("extend-esri")&&I.setObject("layers.FeatureType",M,v);return M})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../graphic".split(" "),function(M,I,F,D,v,m){M=M(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(u){u&&I.isObject(u)&&(this.name=
u.name,this.description=u.description,this.drawingTool=u.drawingTool,this.thumbnail=u.thumbnail,u=u.prototype,this.prototype=new m(u.geometry,null,u.attributes))},toJson:function(){return v.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,thumbnail:v.fixJson(I.clone(this.thumbnail)),prototype:this.prototype&&this.prototype.toJson()})}});I.mixin(M,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",
TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});
F("extend-esri")&&I.setObject("layers.FeatureTemplate",M,D);return M})},"esri/layers/support/domainUtils":function(){define("dojo/_base/lang dojo/has ../../kernel ../RangeDomain ../CodedValueDomain ../InheritedDomain".split(" "),function(M,I,F,D,v,m){var u={fromJson:function(r){if(r)switch(r.type){case "range":var w=new D(r);break;case "codedValue":w=new v(r);break;case "inherited":w=new m(r)}return w}};I("extend-esri")&&M.setObject("layers.support.domainUtils",u,F);return u})},"esri/layers/FeatureSubtype":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./support/domainUtils".split(" "),
function(M,I,F,D,v,m){M=M(null,{declaredClass:"esri.layers.FeatureSubtype",constructor:function(u){if(u&&I.isObject(u)){this.code=u.code;this.name=u.name;this.defaultValues=u.defaultValues;u=u.domains;var r=this.domains={},w;for(w in u)u.hasOwnProperty(w)&&(r[w]=m.fromJson(u[w]))}},toJson:function(){var u=v.fixJson,r={code:this.code,name:this.name,defaultValues:u(I.clone(this.defaultValues))},w=this.domains;if(w){var f=r.domains={},c;for(c in w)w.hasOwnProperty(c)&&(f[c]=w[c]&&w[c].toJson());u(f)}return u(r)}});
F("extend-esri")&&I.setObject("layers.FeatureSubtype",M,D);return M})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(M,I,F,D){M=M(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(v){v&&I.isObject(v)&&(this.objectId=v.objectId,this.globalId=v.globalId,this.success=v.success,v.success||(v=v.error,this.error=Error(),this.error.code=v.code,this.error.message=v.description))}});F("extend-esri")&&I.setObject("layers.FeatureEditResult",
M,D);return M})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ../srUtils ../tasks/query ./RenderMode ./support/ParallelSnapshot".split(" "),function(M,I,F,D,v,m,u,r,w){M=M([r],{declaredClass:"esri.layers._SnapshotMode",maxFeatures:5E4,maxRecordCountFactor:1,scaleToTileFactor:1,_isSuspendedAtStartup:!1,_pendingRefresh:!1,constructor:function(f){this.featureLayer=f;this._featureMap={};this._hasUpdateError=this._hasPartialFeatures=
!1;this._drawFeatures=I.hitch(this,this._drawFeatures);this._queryErrorHandler=I.hitch(this,this._queryErrorHandler);this._handleSuccess=I.hitch(this,this._handleSuccess);this._handleError=I.hitch(this,this._handleError);this._handleProgress=I.hitch(this,this._handleProgress)},startup:function(){if(!this._started||this._isSuspendedAtStartup){this.inherited(arguments);var f=this.featureLayer,c=f.reHostedFS.test(f.url);this.pagination=f.queryPagination&&null!=f.maxRecordCount;this._cacheHintSupported=
f._isCacheHintSupported();this.scaleToTileFactor=this._getScaleToTileFactor();c&&this.pagination&&(this._parallelSnapshot=new w({layer:f,mode:this,queryTask:f._task}));this._isSuspendedAtStartup=f.suspended;this._startup()}},propertyChangeHandler:function(f){this._init&&(f?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},
destroy:function(){this._isSuspendedAtStartup=this._pendingRefresh=!1;this._cancelPendingRequest(this._pendingRequest);this._parallelSnapshot&&this._parallelSnapshot.destroy();this.inherited(arguments)},drawFeature:function(f){var c=f.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(c,f);this._incRefCount(c)},resume:function(){this._isSuspendedAtStartup||this._pendingRefresh?(this._isSuspendedAtStartup=!1,this._startup()):this.propertyChangeHandler(0)},refresh:function(){var f=this.featureLayer;
f._collection?(f._fireUpdateStart(),f._refresh(!0),f._fireUpdateEnd()):this._fetchAll()},hasAllFeatures:function(){return!this._hasPartialFeatures},hasUpdateError:function(){return this._hasUpdateError},canFetchPBF:function(f){return this.inherited(arguments)&&this.featureLayer._canFetchPBFForQuery(f)},_startup:function(){this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},_fetchAll:function(){var f=this.featureLayer;f._collection||f.suspended||!f.isQueryable()?this._pendingRefresh=
f.suspended:(this._pendingRefresh=!1,f._fireUpdateStart(),this._clearIIf(),this._hasUpdateError=this._hasPartialFeatures=!1,this._parallelSnapshot?this._parallelSnapshot.fetch().then(this._handleSuccess,this._handleError,this._handleProgress):this._sendRequest())},_handleSuccess:function(f){this._hasPartialFeatures=f.hasPartialFeatures;this._hasUpdateError=f.hasUpdateError;this.featureLayer._fireUpdateEnd(null)},_handleError:function(f){this._queryErrorHandler(f)},_handleProgress:function(f){f.isError?
this.featureLayer._errorHandler(f.error):this._addFeatures(f.features)},_getScaleToTileFactor:function(){var f=this.featureLayer.tileMaxRecordCount,c=this.featureLayer.maxRecordCount,n=1;null!=f&&null!=c&&(n=Number((f/c).toFixed(2)));return n},_getPageSize:function(f){var c=this.featureLayer.tileMaxRecordCount;c="tile"===f.resultType&&c?c:this.featureLayer.maxRecordCount;f.maxRecordCountFactor&&(c=Math.floor(c*f.maxRecordCountFactor));return c},_sendRequest:function(f){var c=this.featureLayer,n=this._createQueryInfo(),
q=n.query;this.pagination&&(this._pageSize=this._getPageSize(q),this._start=q.start=null==f?0:f,q.num=this._pageSize);this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);this._pendingRequest=c._task.execute(q,this._drawFeatures,this._queryErrorHandler,n.pbf?{format:"pbf"}:null)},_drawFeatures:function(f){this._pendingRequest=null;this.featureLayer._isImageService&&10.7>this.featureLayer.version&&void 0===f.exceededTransferLimit&&(f.exceededTransferLimit=f.features.length===this.featureLayer.maxRecordCount);
var c=this.featureLayer,n=f.exceededTransferLimit,q=n&&!c._collection;f=this._checkMaxLimit(f.features);var d=f.maxLimitReached;this._addFeatures(f.features);this.pagination&&q&&!d||(this._hasPartialFeatures=!!n,c._fireUpdateEnd(null,n?{queryLimitExceeded:!0}:null));q&&(this.pagination&&!d&&this._sendRequest(this._start+this._pageSize),c.onQueryLimitExceeded())},_queryErrorHandler:function(f){this._pendingRequest=null;this._hasUpdateError=this._hasPartialFeatures=!0;var c=this.featureLayer;c._errorHandler(f);
c._fireUpdateEnd(f)},_checkMaxLimit:function(f){var c=f?f.length:0,n=this.featureLayer.graphics.length+c,q=n>=this.maxFeatures;if(q){var d=n-this.maxFeatures;d&&f.splice(c-d,d)}return{maxLimitReached:q,featuresDiscarded:n>this.maxFeatures,features:f}},_createQueryInfo:function(){var f=this.featureLayer,c=new u;c.outFields=f.getOutFields();c.where=f._getAttributeFilter()||"1\x3d1";c.returnGeometry=!0;c.outSpatialReference=m.createSpatialReference(this.map.spatialReference.toJson());c.timeExtent=f.getTimeDefinition();
c.maxAllowableOffset=f._maxOffset;c.quantizationParameters=f._quantizationParameters;c.orderByFields=f.supportsAdvancedQueries?f.getOrderByFields():null;c.multipatchOption=f.multipatchOption;f._ts&&(c._ts=(new Date).getTime());this._cacheHintSupported&&f._enableCacheHint(c);var n=this.canFetchPBF(c);f._enableEditModeQuantization(c,n);this._applyMaxRecordCountFactor(c,n);return{query:c,pbf:n}},_applyMaxRecordCountFactor:function(f,c){var n=this.featureLayer.advancedQueryCapabilities;this.featureLayer._isCacheHintEnabled(f)&&
n&&n.supportsMaxRecordCountFactor&&("tile"!==f.resultType&&1<this.scaleToTileFactor&&(f.maxRecordCountFactor=this.scaleToTileFactor),c&&1<this.maxRecordCountFactor&&(f.maxRecordCountFactor=this.maxRecordCountFactor),5<f.maxRecordCountFactor&&(f.maxRecordCountFactor=5))},_addFeatures:function(f){var c=this.featureLayer,n=c.objectIdField,q=f.length,d=c._selectedFeatures,a=c.mode===c.constructor.MODE_AUTO;c._fireUpdateStart();c._sortFeatures(f);for(c=0;c<q;c++){var b=f[c];var k=b.attributes[n];var g=
this._addFeatureIIf(k,b);this._incRefCount(k);a&&g!==b&&d[k]&&(g.setGeometry(b.geometry),g.setAttributes(b.attributes))}this._applyTimeFilter(!0)}});F("extend-esri")&&I.setObject("layers._SnapshotMode",M,D);return M})},"esri/layers/RenderMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","../sniff","../kernel"],function(M,I,F,D,v){var m=!!D("esri-pbf"),u=!!D("esri-featurelayer-pbf");M=M(null,{declaredClass:"esri.layers._RenderMode",enablePBFQuery:m&&u,initialize:function(r){this.map=
r;this._init=!0},startup:function(){this._started=!0},propertyChangeHandler:function(r){},destroy:function(){this._init=this._started=!1},drawFeature:function(r){},suspend:function(){},resume:function(){},refresh:function(){},hasAllFeatures:function(){return!0},hasUpdateError:function(){return!1},canFetchPBF:function(r){return!(!this.featureLayer._canFetchPBF()||!this.enablePBFQuery)},_incRefCount:function(r){(r=this._featureMap[r])&&r._count++},_decRefCount:function(r){(r=this._featureMap[r])&&r._count--},
_getFeature:function(r){return this._featureMap[r]},_addFeatureIIf:function(r,w){var f=this._featureMap,c=f[r],n=this.featureLayer;c||(f[r]=w,n._add(w),w._count=0);return c||w},_removeFeatureIIf:function(r){var w=this._featureMap[r],f=this.featureLayer;if(w){if(w._count)return;delete this._featureMap[r];f._remove(w)}return w},_registerFeature:function(r,w){var f=this._featureMap,c=f[r];c?(c.attributes=w.attributes,c.geometry=w.geometry):(f[r]=w,w._count=0,w._layer=w._graphicsLayer=w._sourceLayer=
this.featureLayer);return c||w},_unregisterFeature:function(r){var w=this._featureMap,f=w[r];f&&!f._count&&(delete w[r],f._graphicsLayer=null)},_clearIIf:function(){var r=this.featureLayer;var w=r.graphics,f=r._selectedFeatures,c=r.getSelectedFeatures().length,n=r.objectIdField;if(c)for(r=w.length-1;0<=r;r--){c=w[r];var q=c.attributes[n];q in f?c._count=1:(c._count=0,this._removeFeatureIIf(q))}else r.clear(),this._featureMap={}},_cancelPendingRequest:function(r){if(r)try{r.cancel()}catch(w){}},_toggleVisibility:function(r){var w=
this.featureLayer,f=w.graphics,c=r?"show":"hide",n,q=f.length;r=r&&w._ager;for(n=0;n<q;n++){var d=f[n];d[c]();r&&w._repaint(d)}},_applyTimeFilter:function(r){var w=this.featureLayer;if(w.timeInfo&&!w.suspended){r||w._fireUpdateStart();var f=w._trackManager;f&&f.clearTracks();var c=w.getTimeDefinition(),n=w._getOffsettedTE(w._mapTimeExtent);n?(n=w._getTimeOverlap(c,n))?(c=w._filterByTime(w.graphics,n.startTime,n.endTime),f&&f.addFeatures(c.match),F.forEach(c.match,function(q){var d=q._shape;q.visible||
(q.show(),(d=q._shape)&&d._moveToFront());w._ager&&d&&w._repaint(q)}),F.forEach(c.noMatch,function(q){q.visible&&q.hide()})):this._toggleVisibility(!1):(f&&f.addFeatures(w.graphics),this._toggleVisibility(!0));f&&(f.moveLatestToFront(),f.drawTracks());r||w._fireUpdateEnd()}}});D("extend-esri")&&I.setObject("layers._RenderMode",M,v);return M})},"esri/layers/support/ParallelSnapshot":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/Deferred ../../kernel".split(" "),
function(M,I,F,D,v,m){M=M(null,{declaredClass:"esri.layers.support.ParallelSnapshot",layer:null,mode:null,queryTask:null,batchSize:5,_queryInfo:null,_fetchDfd:null,_startPage:null,_lastPage:null,_pageSize:null,_maxPages:null,_requests:null,constructor:function(u){I.mixin(this,u);this._requests={}},destroy:function(){this.cancel()},fetch:function(){var u=new v;this.cancel(!0);this._queryInfo=this.mode._createQueryInfo();this._pageSize=this.mode._getPageSize(this._queryInfo.query);this._maxPages=Math.ceil(this._getFeatureCount()/
this._pageSize);this._fetchDfd=u;this._sendRequests();return u.promise},cancel:function(u){this._cancelPendingRequests(u);this._reset()},_reset:function(){this._startPage=this._lastPage=null;this._requests={}},_getFeatureCount:function(){return this.layer.mode===this.layer.constructor.MODE_AUTO&&0===this.layer.getLastExceedsLimitResult()?this.layer._getMaxFeaturesForAutoSnapshotMode():this.mode.maxFeatures},_sendRequests:function(u){var r=this._queryInfo.query,w=this.queryTask,f=this._requests;u=
null==u?1:u;var c=u+this.batchSize-1;c>this._maxPages&&(c=this._maxPages);if(!(u>c))for(this._startPage=u,this._lastPage=c;u<=c;u++)r.start=(u-1)*this._pageSize,r.num=this._pageSize,f[u]=w.execute(r,null,null,this._queryInfo.pbf?{format:"pbf"}:null),f[u].then(I.hitch(this,this._handleSuccess,u)).otherwise(I.hitch(this,this._handleError,u))},_evalNextBatch:function(u){u===this._lastPage&&this._sendRequests(this._lastPage+1)},_handleSuccess:function(u,r){r.exceededTransferLimit||this._cancelLaterRequests(u,
!0);var w=this.mode._checkMaxLimit(r.features);this._fetchDfd.progress({features:w.features,isError:!1});w.maxLimitReached?((u=w.featuresDiscarded||this._hasRejectedRequests())||(u=!!this._getResult(this._getLastSuccessfulRequest()).exceededTransferLimit),this._resolveFetch(u)):(r.exceededTransferLimit&&this._evalNextBatch(u),this._evalResolution())},_handleError:function(u,r){var w=this._requests;w&&w[u]&&(1===u?this._rejectFetch(r):(this._evalNextBatch(u),this._fetchDfd.progress({error:r,isError:!0}),
this._evalResolution()))},_evalResolution:function(){this._hasPendingRequests()||this._resolveFetch(this._hasRejectedRequests())},_resolveFetch:function(u){var r=this._hasRejectedRequests();this.cancel(!0);this._fetchDfd.resolve({hasPartialFeatures:u,hasUpdateError:r})},_rejectFetch:function(u){this.cancel(!0);this._fetchDfd.reject(u)},_getResult:function(u){return u&&u.dfd.results[0]},_hasPendingRequests:function(){return!!this._getPendingRequests().length},_getPendingRequests:function(){var u=this._requests,
r,w=[];for(r in u){var f=u[r];f.isFulfilled()||w.push({pageId:Number(r),dfd:f})}return w},_getLastSuccessfulRequest:function(){var u=this._getResolvedRequests(),r=-Infinity,w;u=F.filter(u,function(f){return!!this._getResult(f).features.length||1===f.pageId},this);F.forEach(u,function(f){f.pageId>r&&(r=f.pageId,w=f)});return w},_getResolvedRequests:function(){var u=this._requests,r,w=[];for(r in u){var f=u[r];f.isResolved()&&w.push({pageId:Number(r),dfd:f})}return w},_hasRejectedRequests:function(){var u=
this._getRejectedRequests(),r=this._getLastSuccessfulRequest(),w=this._getResult(r);w&&!w.exceededTransferLimit&&(u=F.filter(u,function(f){return f.pageId<=r.pageId}));return!!u.length},_getRejectedRequests:function(){var u=this._requests,r,w=[];for(r in u){var f=u[r];f.isRejected()&&w.push({pageId:Number(r),dfd:f})}return w},_cancelPendingRequests:function(u){this._cancelRequests(this._getPendingRequests(),u)},_cancelLaterRequests:function(u,r){var w=F.filter(this._getPendingRequests(),function(f){return f.pageId>
u});this._cancelRequests(w,r)},_cancelRequests:function(u,r){var w=this.mode,f=this._requests;F.forEach(u,function(c){r&&delete f[c.pageId];w._cancelPendingRequest(c.dfd)})}});D("extend-esri")&&I.setObject("layers.support.ParallelSnapshot",M,m);return M})},"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../tasks/query ./RenderMode ./GridLayout".split(" "),function(M,I,F,D,v,m,u,r,w,f){M=M([w],
{declaredClass:"esri.layers._OnDemandMode",constructor:function(c){this.featureLayer=c;this._featureMap={}},initialize:function(c){this.inherited(arguments);this._cellMap={};this._gridLayer=f.createFromFeatureLayer({layer:this.featureLayer,map:c})},startup:function(){if(!this._started||this._isSuspendedAtStartup)this.inherited(arguments),this._ioQueue=[],this._isSuspendedAtStartup=this.featureLayer.suspended,this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(c){this._init&&
(2>c?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this._processIOQueue(!0);this.inherited(arguments)},drawFeature:function(c){var n=c.geometry,q=[];if(n){q=this._gridLayer.getCellsInExtent("point"===n.type?{xmin:n.x,ymin:n.y,xmax:n.x,ymax:n.y}:n.getExtent(),!1).cells;n=this._cellMap;var d,a=c.attributes[this.featureLayer.objectIdField];
for(d=0;d<q.length;d++){var b=q[d];var k=b.latticeID;var g=b.row;var p=b.col;k?b=n[k]=n[k]||b:(n[g]=n[g]||{},b=n[g][p]=n[g][p]||b);b.features=b.features||[];b.features.push(c);this._addFeatureIIf(a,c);this._incRefCount(a)}}},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},hasAllFeatures:function(){var c=!1,n=this._getCurrentCells(),q;for(q=0;q<n.length;q++)if(n[q].hasPartialFeatures){c=
!0;break}return!c},hasUpdateError:function(){var c=!1,n=this._getCurrentCells(),q;for(q=0;q<n.length;q++)if(n[q].hasUpdateError){c=!0;break}return c},canFetchPBF:function(c){return this.inherited(arguments)&&this.featureLayer._canFetchPBFForQuery(c)},_enableConnectors:function(){var c=this.map;this._zoomConnect=I.connect(c,"onZoomEnd",this,this._zoomHandler);this._panConnect=I.connect(c,"onPanEnd",this,this._panHandler);this._resizeConnect=I.connect(c,"onResize",this,this._panHandler)},_disableConnectors:function(){I.disconnect(this._zoomConnect);
I.disconnect(this._panConnect);I.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var c=this.featureLayer,n=this.map;!c.suspended&&c.isQueryable()&&(c._fireUpdateStart(),this._clearIIf(),(c=c._trackManager)&&c.clearTracks(),this._cellMap={},this._gridLayer.setResolution(n.extent),this._sendRequest())},_panHandler:function(c){if(this.featureLayer.isQueryable()){this.featureLayer._fireUpdateStart();var n=this.featureLayer._resized;c=n?c:null;n&&this._gridLayer.setMapState(c,
this.map.width,this.map.height);this._sendRequest(c)}},_sendRequest:function(c){this._exceeds=!1;var n=this.featureLayer,q=this.map;c=c||q.extent;q=this._gridLayer.getCellsInExtent(c,n.latticeTiling).cells;if(!n.isEditable()){var d=this._cellMap;q=D.filter(q,function(g){if(g.lattice){if(d[g.latticeID])return!1}else if(d[g.row]&&d[g.row][g.col])return!1;return!0})}this._pending=this._pending||0;var a;for(a=0;a<q.length;a++){var b=q[a],k=this._createQueryInfo(b);this._pending++;this._ioQueue.push(n._task.execute(k.query,
F.hitch(this,this._drawFeatures,b),F.hitch(this,this._queryErrorHandler,b),k.pbf?{format:"pbf"}:null))}this._removeOldCells(c);this._endCheck()},_drawFeatures:function(c,n){this.featureLayer._isImageService&&10.7>this.featureLayer.version&&void 0===n.exceededTransferLimit&&(n.exceededTransferLimit=n.features.length===this.featureLayer.maxRecordCount);c.hasPartialFeatures=!!n.exceededTransferLimit;c.hasUpdateError=!1;this._exceeds=this._exceeds||n.exceededTransferLimit;this._finalizeIO();var q=this.featureLayer,
d=this.map.extent,a=c.extent,b=c.row,k=c.col,g=q.objectIdField;n=n.features;var p=this._gridLayer,B=this._cellMap,J=c.latticeID;B=J?B[J]:B[b]&&B[b][k];if(c.resolution==p.resolution&&(J?J===p.getLatticeID(d):p.intersects(a,d)))if(B)q._sortFeatures(n),this._updateCell(B,n);else for(q._sortFeatures(n),c.features=n,this._addCellToCellMap(c),q=n.length,c=0;c<q;c++)d=n[c],a=d.attributes[g],this._addFeatureIIf(a,d),this._incRefCount(a);else B&&this._removeCell(b,k,J);this._endCheck()},_queryErrorHandler:function(c,
n){this._finalizeIO();c.hasPartialFeatures=!0;c.hasUpdateError=!0;this._addCellToCellMap(c);this.featureLayer._errorHandler(n);this._endCheck(n)},_finalizeIO:function(){this._pending--},_endCheck:function(c){if(0===this._pending){this._processIOQueue();var n=this.featureLayer,q=n._trackManager;q&&(q.clearTracks(),q.addFeatures(n.graphics),n._ager&&D.forEach(n.graphics,function(d){d._shape&&n._repaint(d)}),q.moveLatestToFront(),q.drawTracks());this.featureLayer._fireUpdateEnd(!!c&&Error("FeatureLayer: "+
(c.message||"an error occurred while updating the layer.")),this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)n.onQueryLimitExceeded()}},_processIOQueue:function(c){this._ioQueue=D.filter(this._ioQueue,function(n){return-1<n.fired?!1:!0});c&&D.forEach(this._ioQueue,this._cancelPendingRequest)},_createQueryInfo:function(c){var n=this.featureLayer,q=new r;q.outFields=n.getOutFields();q.where=n._getAttributeFilter();q.returnGeometry=!0;q.geometry=c.extent||c.lattice;n.latticeTiling&&c.extent&&
(q.spatialRelationship=r.SPATIAL_REL_CONTAINS);q.timeExtent=n._getOffsettedTE(n._mapTimeExtent);q.maxAllowableOffset=n._maxOffset;q.quantizationParameters=n._quantizationParameters;q.orderByFields=n.supportsAdvancedQueries?n.getOrderByFields():null;q.multipatchOption=n.multipatchOption;n._ts&&(q._ts=(new Date).getTime());(c=n.advancedQueryCapabilities)&&c.supportsQueryWithResultType&&(q.resultType="tile");c=this.canFetchPBF(q);n._enableEditModeQuantization(q,c);return{query:q,pbf:c}},_getCurrentCells:function(c){var n=
[];c=c||this._cellMap;for(var q in c)if(c.hasOwnProperty(q)){var d=c[q];d&&(d.hasOwnProperty("row")||d.hasOwnProperty("latticeID")?n.push(d):"object"===typeof d&&n.push.apply(n,this._getCurrentCells(d)))}return n},_addCellToCellMap:function(c){var n=this._cellMap;if(c.latticeID)n[c.latticeID]=c;else{var q=c.row,d=c.col;n[q]=n[q]||{};n[q][d]=c}},_removeOldCells:function(c){var n=this._cellMap,q=this._gridLayer,d,a;for(d in n)if(n[d]){var b=n[d],k=b.latticeID,g=0,p=0;if(k)g++,k!==q.getLatticeID(c)&&
(this._removeCell(null,null,k),p++);else for(a in b)b[a]&&(g++,q.intersects(b[a].extent,c)||(this._removeCell(d,a),p++));p===g&&delete n[d]}},_updateCell:function(c,n){var q=this.featureLayer,d=q.objectIdField;q=q._selectedFeatures;var a,b=n.length;c.features=c.features||[];for(a=0;a<b;a++){var k=n[a],g=k.attributes[d],p=this._addFeatureIIf(g,k);p===k?(this._incRefCount(g),c.features.push(p)):g in q||(p.setGeometry(k.geometry),p.setAttributes(k.attributes))}},_removeCell:function(c,n,q){var d=this._cellMap,
a=this.featureLayer,b=a.objectIdField,k=q?d[q]:d[c]&&d[c][n];if(k&&(q?delete d[q]:delete d[c][n],c=k.features))for(n=0;n<c.length;n++)q=c[n].attributes[b],this._decRefCount(q),q in a._selectedFeatures||this._removeFeatureIIf(q)}});v("extend-esri")&&F.setObject("layers._OnDemandMode",M,m);return M})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/normalizeUtils ../srUtils".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c){var n=M(null,{declaredClass:"esri.layers._GridLayout",constructor:function(q,d,a,b){this.origin=q;this.cellWidth=d.width;this.cellHeight=d.height;this.mapWidth=a.width;this.mapHeight=a.height;this.srInfo=b},setResolution:function(q){this.resolution=(q.xmax-q.xmin)/this.mapWidth;this.srInfo&&(q=Math.round(Math.round(2*this.srInfo.valid[1]/this.resolution)/this.cellWidth),this._frameStats=[q,0,q-1])},setMapState:function(q,d,a){this.mapWidth=d;this.mapHeight=a;this.setResolution(q)},
getCellCoordinates:function(q){var d=this.resolution,a=this.origin;return{row:Math.floor((a.y-q.y)/(this.cellHeight*d)),col:Math.floor((q.x-a.x)/(this.cellWidth*d))}},normalize:function(q){var d=this._frameStats;if(d){var a=d[0],b=d[1];d=d[2];q<b?(q%=a,q=q<b?q+a:q):q>d&&(q%=a)}return q},intersects:function(q,d){var a=this.srInfo;return a?F.some(d._getParts(a),function(b){return q.intersects(b.extent)}):q.intersects(d)},getCellExtent:function(q,d){var a=this.resolution,b=this.origin,k=this.cellWidth,
g=this.cellHeight;return new u(d*k*a+b.x,b.y-(q+1)*g*a,(d+1)*k*a+b.x,b.y-q*g*a,c.createSpatialReference(b.spatialReference.toJson()))},getLatticeID:function(q){var d=this.getCellCoordinates({x:q.xmin,y:q.ymax}),a=this.getCellCoordinates({x:q.xmax,y:q.ymin});q=d.row;var b=a.row;d=this.normalize(d.col);a=this.normalize(a.col);return q+"_"+b+"_"+d+"_"+a},sorter:function(q,d){return q<d?-1:1},getCellsInExtent:function(q,d){var a=this.getCellCoordinates({x:q.xmin,y:q.ymax}),b=this.getCellCoordinates({x:q.xmax,
y:q.ymin}),k=a.row,g=b.row;a=a.col;b=b.col;var p=[],B,J,A=[],h=[],x=[];for(B=k;B<=g;B++)for(J=a;J<=b;J++){var z=this.normalize(J);q=this.getCellExtent(B,z);F.some(p,function(y){return y.row===B&&y.col===z})||p.push({row:B,col:z,extent:q,resolution:this.resolution});d&&(A.push(q.xmin,q.xmax),h.push(q.ymin,q.ymax))}a=this.normalize(a);b=this.normalize(b);A.sort(this.sorter);h.sort(this.sorter);d=A.length;for(B=d-1;0<=B;B--)B<d-1&&A[B]===A[B+1]&&A.splice(B,1);d=h.length;for(B=d-1;0<=B;B--)B<d-1&&h[B]===
h[B+1]&&h.splice(B,1);if(A.length&&h.length){q=A[0];J=A[A.length-1];var e=h[0];var t=h[h.length-1];d=A.length;for(B=0;B<d;B++)x.push([[A[B],t],[A[B],e]]);d=h.length;for(B=0;B<d;B++)x.push([[q,h[B]],[J,h[B]]]);A=new r({paths:x,spatialReference:this.origin.spatialReference.toJson()});p.push({latticeID:k+"_"+g+"_"+a+"_"+b,lattice:A,resolution:this.resolution})}return{minRow:k,maxRow:g,minCol:a,maxCol:b,topRow:k,bottomRow:g,leftCol:a,rightCol:b,cells:p}},_findCell:function(q,d,a){var b;F.some(q,function(k){k.row===
d&&k.col===a&&(b=k);return!!b});return b},getExtentOfIntersectingCells:function(q){var d=this.getCellsInExtent(q),a=d&&d.cells;if(a&&a.length){var b=d.topRow,k=d.leftCol,g=0;F.forEach(a,function(A){A.row===b&&g++});var p=this._findCell(a,b,k).extent,B=this.srInfo;if(!B||g!==this._frameStats[0]&&k!==d.rightCol){var J=p.xmin;B=J+g*p.getWidth()}else J=B.valid[0],B=B.valid[1];d=this._findCell(a,d.bottomRow,k).extent.ymin;(q=(new u(J,d,B,p.ymax,q.spatialReference))._normalize(!1,!1))&&q.rings&&(q=new w(q),
q=f.getDenormalizedExtent(q));return q}}});n.createFromFeatureLayer=function(q){var d=q.layer;q=d.getMap()||q.map;var a=d._srInfo;(d=q&&q.loaded?new n(new m(a?a.valid[0]:q.extent.xmin,a?a.valid[1]:q.extent.ymax,q.spatialReference),{width:d._tileWidth,height:d._tileHeight},{width:q.width,height:q.height},a):null)&&d.setResolution(q.extent);return d};D("extend-esri")&&I.setObject("layers._GridLayout",n,v);return n})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/has","../kernel","./RenderMode"],function(M,I,F,D,v){M=M([v],{declaredClass:"esri.layers._SelectionMode",constructor:function(m){this.featureLayer=m;this._featureMap={}},propertyChangeHandler:function(m){this._init&&0===m&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)},hasAllFeatures:function(){return!this.featureLayer._hasPartialSelectedFeatures},hasUpdateError:function(){return this.featureLayer._hasSelectionError}});F("extend-esri")&&I.setObject("layers._SelectionMode",
M,D);return M})},"esri/layers/StreamMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/has ../kernel ../SpatialReference ../tasks/query ../tasks/QueryTask ../geometry/jsonUtils ./RenderMode".split(" "),function(M,I,F,D,v,m,u,r,w,f,c){M=M([c],{declaredClass:"esri.layers._StreamMode",constructor:function(n,q){this.featureLayer=n;this._featureMap={};this._setRefreshRate();this._drawBuffer={adds:[],updates:[]};this._timeoutId=null;this._flushDrawBuffer=I.hitch(this,
this._flushDrawBuffer);this._featuresByTime={};this._lastEndTimeCheck=null;this._maxFeatureAge=0;n.purgeOptions&&n.purgeOptions.age&&"number"===typeof n.purgeOptions.age&&(this._maxFeatureAge=1E3*Math.ceil(60*n.purgeOptions.age));this._drawFeatures=I.hitch(this,this._drawFeatures);this._queryErrorHandler=I.hitch(this,this._queryErrorHandler)},startup:function(){this._started||this.inherited(arguments)},propertyChangeHandler:function(n){this._init&&(0===n?this._applyTimeFilter():3===n?this._redrawAllTracks():
console.debug("StreamLayer: Stream Layer only supports changing map time or maximumTrackPoints. Layer id \x3d "+this.featureLayer.id))},destroy:function(){this.inherited(arguments);clearTimeout(this._timeoutId);this._featuresByTime=this._drawBuffer=this._featureMap=null},drawFeature:function(n){var q=this.featureLayer,d=q.objectIdField;this._timeoutId||(this._timeoutId=setTimeout(this._flushDrawBuffer,this._refreshRate));q._joinField&&this._getFeature(n.attributes[d])?this._drawBuffer.updates.push({oid:n.attributes[d],
updates:n}):this._drawBuffer.adds.push(n)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);var n=this.featureLayer;n&&(n._relatedUrl||n._keepLatestUrl?(n._fireUpdateStart(),n._refreshing=!0,n.disconnect(),n.clear(),n._relatedQueried=!1,n._keepLatestQueried=!1,n.connect()):(n._fireUpdateStart(),n.clear(),n._fireUpdateEnd()))},_drawFeatures:function(n,q){var d=this.featureLayer;d._create(n.features||[]);d._fireUpdateEnd(null,
q)},_applyTimeFilter:function(n){this.inherited(arguments);this._redrawAllTracks()},_removeFeatures:function(n){var q=this.featureLayer,d=q.objectIdField;n&&F.forEach(n,function(a){a=a.attributes[d];q._unSelectFeatureIIf(a,this);this._decRefCount(a);this._removeFeatureIIf(a)},this)},_addFeatures:function(n){var q=this.featureLayer,d=q._endTimeField,a=q._startTimeField,b,k=[],g=[],p=[];var B=q._trackManager;var J=q.objectIdField;if(B)for(b in n=B.addFeatures(n),n)n.hasOwnProperty(b)&&(k.push(b),n[b].adds&&
(g=g.concat(n[b].adds)),n[b].deletes&&(p=p.concat(n[b].deletes)));else g=n;F.forEach(g,function(A){var h=A.attributes[J];var x=d&&A.attributes[d];!x&&this._maxFeatureAge&&(x=a&&A.attributes[a]?A.attributes[a]+this._maxFeatureAge:Date.now()+this._maxFeatureAge);x&&(x=1E3*Math.ceil(x/1E3),this._featuresByTime[x]?this._featuresByTime[x].push(h):this._featuresByTime[x]=[h]);this._addFeatureIIf(h,A);this._incRefCount(h)},this);p.length&&this._removeFeatures(p);B&&B.refreshTracks(k)},_updateFeatures:function(n){var q=
this.featureLayer,d=[];var a=q._trackManager;var b=q._trackIdField;F.forEach(n,function(k){var g=k.updates;k=this._getFeature(k.oid);var p;if(k){g.geometry&&k.setGeometry(g.geometry);g=g.attributes||{};for(p in g)g.hasOwnProperty(p)&&(k.attributes[p]=g[p]);k.setAttributes(k.attributes);k.visible=this._checkFeatureTimeIntersects(k);a&&k.attributes[b]?d.push(k.attributes[b]):q._repaint(k,null,!0)}},this);d.length&&a.refreshTracks(d)},_redrawAllTracks:function(){var n=this.featureLayer._trackManager,
q;n&&(q=n.trimTracks())&&0<q.length&&(this._removeFeatures(q),n.refreshTracks())},_flushDrawBuffer:function(){clearTimeout(this._timeoutId);var n=this._drawBuffer,q=n.adds.splice(0,n.adds.length),d=n.updates.splice(0,n.updates.length);n=this.featureLayer;if(!n)return!1;n.updating||n._fireUpdateStart();this._addFeatures(q);this._updateFeatures(d);(q=this._getExpiredFeatures())&&q.length&&(this._removeFeatures(q),n._trackManager&&n._trackManager.removeFeatures(q));n._purge();n._fireUpdateEnd();this._timeoutId=
null},_clearDrawBuffer:function(){var n=this._timeoutId,q=this._drawBuffer,d=q.adds;q=q.updates;n&&clearTimeout(n);d.splice(0,d.length);q.splice(0,q.length);this._timeoutId=null},_clearTimeBin:function(){this._featuresByTime={};this._lastEndTimeCheck=1E3*Math.ceil(Date.now()/1E3)},_clearFeatureMap:function(){this._featureMap={}},_setRefreshRate:function(n){n=n||0===n?n:200;0>n&&(n=200);this._refreshRate=n},_checkFeatureTimeIntersects:function(n){var q=this.featureLayer,d=q.getMap();return(d=d?d.timeExtent:
null)&&q.timeInfo&&(q.timeInfo.startTimeField||q.timeInfo.endTimeField)?0<q._filterByTime([n],d.startTime,d.endTime).match.length:!0},_fetchArchive:function(n){var q=new D,d=this.featureLayer;this._pendingRequest&&this._cancelPendingRequest(this._pendingRequest);d._fireUpdateStart();if(n&&this.map){n=new w(n);var a=new r;var b=this.map;var k=d.getFilter()||{};var g=k.where||"1\x3d1";var p=k.geometry?f.fromJson(k.geometry):null;k=k.outFields?k.outFields.split(","):["*"];a.geometry=p;a.where=g;a.outFields=
k;a.returnGeometry=!0;a.outSpatialReference=new u(b.spatialReference.toJson());this._pendingRequest=n.execute(a).then(function(B){this._pendingRequest=null;var J=this._fixFieldNameCasing(d,B);B.features=J;this._drawFeatures(B);d._fireUpdateEnd();q.resolve()}.bind(this)).otherwise(function(B){this._pendingRequest=null;d._errorHandler(B);d._fireUpdateEnd(B);q.reject(B)}.bind(this))}else q.resolve();return q.promise},_queryErrorHandler:function(n){var q=this.featureLayer;q._errorHandler(n);q._fireUpdateEnd(n)},
_fixFieldNameCasing:function(n,q){var d=q.features||[],a=q.fields;if(!a||!d.length)return d;n=this._mapFieldNameDifferences(n.fields,a);a=[];for(var b,k=0,g=q.features.length;k<g;k++)q=d[k],b=this._swizzleResponseAttributes(q.attributes,n),a.push({geometry:q.geometry,attributes:b});return a},_mapFieldNameDifferences:function(n,q){var d=[],a={},b;var k=0;for(b=q.length;k<b;k++)d.push(q[k].name);k=0;for(b=n.length;k<b;k++){q=n[k].name;var g=this._checkForStreamFieldName(q,d);g&&(a[g]=q)}return a},_checkForStreamFieldName:function(n,
q){n=n.toLowerCase();for(var d,a=0,b=q.length;a<b;a++)if(q[a].toLowerCase()===n){d=q[a];break}return d},_swizzleResponseAttributes:function(n,q){var d={},a;for(a in n)if(n.hasOwnProperty(a)){var b=n[a];q.hasOwnProperty(a)?d[q[a]]=b:d[a]=b}return d},_getExpiredFeatures:function(){var n,q,d=[],a=[];if(!this.featureLayer._endTimeField&&!this._maxFeatureAge)return a;var b=1E3*Math.floor(this._lastEndTimeCheck/1E3);this._lastEndTimeCheck=n=1E3*Math.ceil(Date.now()/1E3);if(b&&b!==n)for(q=this._featuresByTime;b<=
n;b+=1E3)q[b]&&(d=d.concat(q[b]),delete q[b]);F.forEach(d,function(k){(k=this._getFeature(k))&&a.push(k)},this);return a}});v("extend-esri")&&I.setObject("layers._StreamMode",M,m);return M})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/dom-construct dojox/gfx ../kernel ../graphic ../geometry/Polyline ./GraphicsLayer".split(" "),function(M,I,F,D,v,m,u,r,w,f){var c=-1!==m.renderer.toLowerCase().indexOf("canvas");M=M(null,{declaredClass:"esri.layers._TrackManager",
constructor:function(n){this.layer=n;this.trackMap={};this.trackLineMap={}},initialize:function(n){this.map=n;n=this.layer;this.createTracklineContainer()&&(this._handles=[n.on("visibility-change",I.hitch(this,function(q){this.container.setVisibility(q.visible);this.container.evaluateSuspension()})),n.on("scale-range-change",I.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)}))])},createTracklineContainer:function(){var n=this.layer;if("esriGeometryPoint"!==
n.geometryType)return null;var q=this.map,d=n._getRenderer();d=d&&d.trackRenderer;var a=this.container=new f._GraphicsLayer({id:n.id+"_tracks",_child:!0,visible:n.visible,minScale:n.minScale,maxScale:n.maxScale});a.loaded=!0;a.onLoad(a);a._setMap(q,n._div);c||(q=a._div.getNode(),n=n._div.getNode(),q&&n&&v.place(q,n,"first"));a.setRenderer(d);return a},addFeatures:function(n){var q=this.trackMap,d=this.layer,a=d._trackIdField,b=[];F.forEach(n,function(B){var J=B.attributes[a];(q[J]=q[J]||[]).push(B);
-1===F.indexOf(b,J)&&b.push(J)});var k=d._startTimeField,g=d.objectIdField,p=function(B,J){var A=B.attributes[k],h=J.attributes[k];return A===h?B.attributes[g]<J.attributes[g]?-1:1:A<h?-1:1};F.forEach(b,function(B){q[B].sort(p)})},trimTracks:function(n){function q(g){for(g=d[g]||[];g.length>a;)b.push(g.shift())}var d=this.trackMap,a=this.layer.maximumTrackPoints||0,b=[],k;if(!a)return b;if(n)F.forEach(n,function(g){q(g)});else for(k in d)d.hasOwnProperty(k)&&q(k);return b},drawTracks:function(n){function q(B){var J=
k[B],A,h;var x=d.trackLineMap[B];a.remove(x);delete d.trackLineMap[B];x=null;if(!J||2>J.length)return!1;x=[];for(A=J.length-1;0<=A;A--)(h=J[A].geometry)&&x.push([h.x,h.y]);J={};J[p]=B;1<x.length&&(x=new r(new w({paths:[x],spatialReference:g}),null,J),a.add(x),d.trackLineMap[B]=x)}var d=this,a=this.container,b;if(a){var k=this.trackMap;var g=this.map.spatialReference;var p=this.layer._trackIdField;if(n)F.forEach(n,function(B){q(B)});else for(b in k)k.hasOwnProperty(b)&&q(b)}},refreshTracks:function(n){function q(p){var B;
d.drawTracks([p]);if(k&&k.latestObservationRenderer){p=a[p]||[];var J=p.length;for(B=0;B<J;B++)b._repaint(p[B],null,!0)}}var d=this,a=this.trackMap,b=this.layer,k=b._getRenderer(),g;if(n)F.forEach(n,function(p){q(p)});else for(g in a)a.hasOwnProperty(g)&&q(g);this.moveLatestToFront()},moveLatestToFront:function(n){F.forEach(this.getLatestObservations(n),function(q){var d=q._shape;d&&d._moveToFront();this._repaint(q,null,!0)},this.layer)},getLatestObservations:function(n){function q(g){g=b[g];return g[g.length-
1]}var d=[],a=this.layer._getRenderer(),b=this.trackMap,k;if(!a.latestObservationRenderer)return d;if(n)F.forEach(n,function(g){d.push(q(g))});else for(k in b)b.hasOwnProperty(k)&&d.push(q(k));return d},clearTracks:function(n){var q=this.getLatestObservations(n),d=this.container,a=this.trackMap,b;if(n)F.forEach(n,function(g){delete this.trackMap[g];d&&(k=this.trackLineMap[g],d.remove(k),delete this.trackLineMap[g])},this);else{if(d)for(b in a){var k=this.trackLineMap[b];d.remove(k)}this.trackMap=
{};this.trackLineMap={}}F.forEach(q,function(g){this._repaint(g,null,!0)},this.layer)},isLatestObservation:function(n){var q=this.trackMap[n.attributes[this.layer._trackIdField]];return q?q[q.length-1]===n:!1},destroy:function(){F.forEach(this._handles,function(q){q.remove()});var n=this.container;n&&(n.clear(),n._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}});D("extend-esri")&&I.setObject("layers._TrackManager",M,u);return M})},"esri/layers/HeatmapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/_base/array require ../kernel ../sniff ../geometry/Point ../geometry/webMercatorUtils ./MapImage ../renderers/HeatmapRenderer ../tasks/query dojo/_base/fx".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q){function d(){}function a(b){var k=b.layer;return{geometry:b.geometry,attributes:b.attributes,getLayer:function(){return k}}}M=M(null,{declaredClass:"esri.layers.HeatmapManager",heatmapRenderer:null,sourceLayer:null,imageLayer:null,useTiles:!0,useWorker:!1,map:null,constructor:function(b){this.sourceLayer=b;this._hndls=[]},initialize:function(b){this.map=b;var k=this.sourceLayer,g=k.renderer;k.setDrawMode(!1);this.imageLayer=b._getMapImageLyr();var p=this;this.heatmapRenderer=
g instanceof c?g:(g.getRendererInfoByZoom(b.getZoom())||g.getRendererInfoByScale(b.getScale())).renderer;this.redraw=this.redraw.bind(this);this.recalculateHeatmap=this.recalculateHeatmap.bind(this);this._removeRenderer=this._removeRenderer.bind(this);this._handleRendererChange=this._handleRendererChange.bind(this);this._rendererChangeHandle=this.sourceLayer.on("renderer-change",this._handleRendererChange);this._handleOpacityChange=this._handleOpacityChange.bind(this);this._reprojectFeature=this._reprojectFeature.bind(this);
v(["../workers/heatmapCalculator"],function(B){p._calculator=new B(I.mixin({width:p.map.width,height:p.map.height},p._getOptions()));p._setupRenderer();p.heatmapRenderer.getStats=B.calculateStats;p.heatmapRenderer.getHistogramData=B.getHistogramData})},destroy:function(){this._removeHandlers();this._rendererChangeHandle&&this._rendererChangeHandle.remove();this._rendererChangeHandle=this.sourceLayer=this.imageLayer=this.map=this.heatmapRenderer=this._hndls=null},_handleRendererChange:function(b){var k=
b.renderer,g=k instanceof c;this.heatmapRenderer?g?this.heatmapRenderer=k:this._removeRenderer(b):g&&(this.heatmapRenderer=k,this.sourceLayer&&this.map&&this._setupRenderer())},_handleOpacityChange:function(b){b=b.opacity;var k=this._getImageBySourceId(this.sourceLayer.id);k&&k.setOpacity(b)},_setupRenderer:function(){var b=this._hndls,k=this.sourceLayer,g=this.map,p=this;k._originalDraw=k._draw;k._draw=d;k._div.clear();clearTimeout(this._resetTimer);this._resetTimer=setTimeout(this._resetGraphics.bind(this),
250);b.push(k.on("update-end",this.redraw));b.push(k.on("suspend",function(B){(B=p._getImageBySourceId(p.sourceLayer.id))&&B.hide()}));b.push(k.on("resume",function(B){(B=p._getImageBySourceId(p.sourceLayer.id))&&B.show()}));b.push(F.after(k,"redraw",this.redraw));b.push(g.on("layer-remove",function(B){B.layer==k&&((B=p._getImageBySourceId(p.sourceLayer.id))&&p.imageLayer.removeImage(B),p._removeRenderer({target:k}))}));k._collection&&b.push(k.on("graphic-add",function(B){p._reprojectFeature(B.graphic);
p.redraw()}));1!==k.mode&&(b.push(g.on("resize, pan-end",this.redraw)),b.push(g.on("zoom-end",this.redraw)));b.push(k.on("opacity-change",this._handleOpacityChange));this.imageLayer.suspended&&this.imageLayer.resume();k.graphics&&k.graphics.length&&(k.graphics[0].geometry&&!g.spatialReference.equals(k.graphics[0].geometry.spatialReference)&&D.forEach(k.graphics,function(B){this._reprojectFeature(B)}.bind(this)),this.redraw())},redraw:function(){if(!this._drawTimer){var b=this;this._drawTimer=setTimeout(function(){clearTimeout(b._drawTimer);
b._drawTimer=null;b.sourceLayer._getRenderer().isInstanceOf(c)&&b.recalculateHeatmap()},16)}},_removeRenderer:function(b){var k=b.target;k._draw=k._originalDraw;delete k._originalDraw;k.setDrawMode(!0);this._removeHandlers();this._hndls=[];var g=this._getImageBySourceId(this.sourceLayer.id);g&&this.imageLayer.removeImage(g);clearTimeout(this._drawTimer);clearTimeout(this._resetTimer);this._drawTimer=this._resetTimer=null;k.renderer!=b.renderer&&k.renderer.getRendererInfo?this.heatmapRenderer=null:
(this.destroy(),k.renderer&&k.renderer.getRendererInfo&&k.redraw())},recalculateHeatmap:function(){this._calculator?this._doMainCalculation():this._calculatorClient&&this._doWorkerCalculation()},_reprojectFeature:function(b){if(b&&b.geometry){var k=b.geometry,g=this.map.spatialReference;g.equals(k.spatialReference)||(k=w.project(k,g),null==k?console.log("Unable to reproject features to map's spatial reference. Please convert feature geometry before adding to layer"):b.geometry=k)}},_doWorkerCalculation:function(){},
_doMainCalculation:function(){var b=this.sourceLayer,k=this.map,g=this.heatmapRenderer,p=this.map.extent,B=this.map.width,J=this.map.height,A=this._calculator,h=this,x=function(e){e=h._getScreenPoints(e.features,k,b);e=A.calculateImageData(I.mixin({screenPoints:e,mapinfo:{extent:[p.xmin,p.ymin,p.xmax,p.ymax],resolution:k.getResolution()},width:B,height:J},h._getOptions()));e=g.getSymbol(a({geometry:k.extent,attributes:{size:[B,J],imageData:e},layer:b}));e=new f({extent:k.extent,href:e.url,opacity:0,
sourceId:b.id});h._swapMapImages(e,h._getImageBySourceId(b.id));b.suspended&&e.hide()},z={geometry:k.extent,timeExtent:b.useMapTime?k.timeExtent:void 0,spatialRelationship:n.SPATIAL_REL_INTERSECTS};null!=b._canDoClientSideQuery(z)?b.queryFeatures(z,x):x({features:b.graphics})},_getScreenPoints:function(b,k,g){var p=[],B=b.length,J=0,A=0,h=new r(k.extent.xmin,k.extent.ymax,k.spatialReference),x=k.toScreen(h),z=x.x;x=x.y;var e=k.getResolution(),t;for((A=k.extent.getCacheValue("_parts"))&&(t=D.map(A,
function(H){return g._intersects(k,H.extent)[0]}));B--;)if(A=b[B],A.geometry&&A.visible){var y={x:Math.ceil((A.geometry.x-h.x)/e+z),y:Math.floor((h.y-A.geometry.y)/e-x),attributes:A.attributes};t&&(A=1<t.length&&y.x<-t[0]?t[1]:t[0],y.x+=A);p[J++]=y}return p},_getImageBySourceId:function(b){var k=this.imageLayer.getImages();k=D.filter(k,function(g){return g.sourceId==b});if(k.length)return k[k.length-1]},_swapMapImages:function(b,k){function g(){p.removeImage(k)}var p=this.imageLayer,B=this.sourceLayer.opacity;
p.addImage(b);q.anim(b._node,{opacity:B},null,null,function(){b.opacity=B});null!=k&&q.anim(k._node,{opacity:0},null,null,g)},_removeHandlers:function(){if(null!=this._hndls)for(var b=this._hndls.length;b--;)this._hndls[b].remove()},_getOptions:function(){var b=this.heatmapRenderer;return{blurRadius:b.blurRadius,gradient:b.gradient,maxPixelIntensity:b.maxPixelIntensity,minPixelIntensity:b.minPixelIntensity,field:b.field,fieldOffset:b.fieldOffset}},_resetGraphics:function(){clearTimeout(this._resetTimer);
this._resetTimer=null;for(var b=this.sourceLayer.graphics,k=b.length,g;k--;)g=b[k],g._shape=g._offsets=void 0}});u("extend-esri")&&I.setObject("layers.HeatmapManager",M,m);return M})},"esri/layers/clustering/ClusterManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../kernel ../../Evented ../../graphic ../../lang ../../Color ../../graphicsUtils ../../dijit/PopupTemplate ../../dijit/Legend/utils ../../renderers/ClassBreaksRenderer ../../symbols/SimpleMarkerSymbol ../support/attributeUtils ../GraphicsLayer ../Field ./GeohashAggregation ./statUtils dojo/i18n!../../nls/jsapi".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a,b,k,g,p,B){var J=B.layers.clusters,A=B.widgets.popup,h=J.numFeatures,x=Math.pow(2,53)-1;M=M(m,{declaredClass:"esri.layers.clustering.ClusterManager",layer:null,aggregationInfo:null,container:null,defaults:{clusterRadius:80,markerSymbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",style:"esriSLSSolid"}}},_initialized:!1,_map:null,_eventHandles:null,_clusterRadius:null,
_renderer:null,_statisticInfos:null,_fields:null,_infoTemplate:null,_clusterGenerator:null,_singleGraphics:null,constructor:function(z){this._eventHandles=[];this.layer=z.layer;this.setAggregationInfo(z.aggregationInfo)},initialize:function(z){this._initialized=!0;this._map=z;this._removeFromPopup(this.layer);this.container=this._createContainer();this._clusterGenerator=this._createClusterGenerator();this._initClusterGenerator();this._createLayerEventListeners();this._createMapEventListeners();this._createPopupEventListeners()},
destroy:function(z){this._clearSingleGraphics();this._removeClusterBoundary();this._destroyEventListeners();this._removeFromPopup(this.container);this._removeFromPopup(this.layer);this._resetClusterNav();this._destroyClusterGenerator(z);this._destroyContainer();this.layer=this.aggregationInfo=this._map=null},setAggregationInfo:function(z){this.aggregationInfo=z?I.mixin({},z):null;this._applyAggregationInfo()},getClusterRenderer:function(){return this._renderer},getClusterFields:function(){return this._fields||
[]},getFeaturesInCluster:function(z){z=z&&z.getAggregationInfo();return this._clusterGenerator?this._clusterGenerator.getFeaturesInCluster(z):[]},getAggregateGraphics:function(){return this.container?this.container.graphics.slice(0):[]},getSingleGraphics:function(){return this._singleGraphics?this._singleGraphics.slice(0):[]},redraw:function(){this.container&&this.container.redraw()},isClusteringEnabled:function(){return!(!this._clusterGenerator||!this._clusterGenerator.clustersEnabled)},isClusteringActive:function(){return!!(this._clusterGenerator&&
0<this._clusterGenerator.getNumFeatures())},toggleFeatureVisibility:function(z){this._clusterGenerator&&this._clusterGenerator.toggleFeatureVisibility(z)},_createContainer:function(){var z=this.layer,e=new b._GraphicsLayer({_child:!0,id:z.id+"_clusters",visible:z.visible,minScale:z.minScale,maxScale:z.maxScale,infoTemplate:this._infoTemplate});e.fields=this._fields;e.setRenderer(this._renderer);e.loaded=!0;e.onLoad(e);e._setMap(this._map,z._div);return z._childLayer=e},_destroyContainer:function(){var z=
this.container;z&&(z.clear(),z._unsetMap(this._map,this.layer._div),this.layer._childLayer=null);this.container=null},_createClusterGenerator:function(){return new g({map:this._map,layer:this.layer,clusterRadius:this._clusterRadius,statisticInfos:this._statisticInfos})},_initClusterGenerator:function(){var z=this._clusterGenerator;z.loaded?this._awaitClusterGenerator():this._eventHandles.push(z.on("load",I.hitch(this,function(){this._awaitClusterGenerator()})),z.on("load-error",I.hitch(this,function(e){console.log(e.error)})))},
_destroyClusterGenerator:function(z){this._clusterGenerator&&this._clusterGenerator.destroy(z);this._clusterGenerator=null},_awaitClusterGenerator:function(){var z=this._clusterGenerator;z.started?(this._applyRenderer(),this._initClusterUpdates()):this._eventHandles.push(z.on("start",I.hitch(this,function(){this._applyRenderer();this._initClusterUpdates()})))},_applyAggregationInfo:function(){this._applyClusterRadius();this._applyRenderer();this._clusterGenerator&&!this._clusterGenerator.isUpdateScheduled()&&
this.redraw()},_applyClusterRadius:function(){var z=this.aggregationInfo;this._clusterRadius=z&&z.clusterRadius||this.defaults.clusterRadius;this._clusterGenerator&&this._clusterGenerator.setClusterRadius(this._clusterRadius);this._computeClusterRadius()},_computeClusterRadius:function(){var z=this.aggregationInfo||{};z.clusterRadius=this._clusterRadius;this.aggregationInfo=z},_applyRenderer:function(){var z=this.container,e=this._getClusterRendererInfo(),t=this._compareStatInfos(this._statisticInfos,
e.statisticInfos);t&&(this._statisticInfos=e.statisticInfos,this._clusterGenerator&&(this._clusterGenerator.setStatisticInfos(F.map(this._statisticInfos,function(y){return{attributeInfo:y.attributeInfo,statisticType:y.statisticType}})),z&&F.forEach(z.graphics,function(y){this._applyClusterAttributes(y,y.getAggregationInfo())},this)));this._renderer=e.renderer;this._applyFields();this._applyInfoTemplate(!!t&&this._initialized);z&&(z.setRenderer(this._renderer),this.emit("renderer-change"))},_applyFields:function(){this._fields=
this._getFields(this._statisticInfos);this.container&&(this.container.fields=this._fields)},_applyInfoTemplate:function(z){var e=this.aggregationInfo,t=e&&e.disablePopup;this.layer.infoTemplate&&!t?(e=e&&e.infoTemplate||this._infoTemplate,z=z||!e?this._createInfoTemplate():this._updateInfoTemplate(e)):z=null;this._infoTemplate=z;this.container&&this.container.setInfoTemplate(this._infoTemplate);this._computeInfoTemplate()},_computeInfoTemplate:function(){var z=this.aggregationInfo||{};z.infoTemplate=
this._infoTemplate;this.aggregationInfo=z},_getClusterRendererInfo:function(){var z=this.layer&&this.layer.renderer;return z?this._createClusterRenderer(z):this._getDefaultClusterRenderer()},_getDefaultClusterRenderer:function(){var z=this._createContinuousCountRenderer();this._addSizeByCountVariable(z);return{renderer:z,statisticInfos:[]}},_createContinuousCountRenderer:function(z){var e=new q(null,"cluster_count");e.addBreak({minValue:-x,maxValue:x,symbol:z?new z.constructor(z.toJson()):new d(I.clone(this.defaults.markerSymbol))});
return e},_createClusterRenderer:function(z){if(!this._isSupportedRenderer(z))return this._getDefaultClusterRenderer();var e=[];if(this._isSimpleRenderer(z))var t=this._createContinuousCountRenderer(z.symbol);else{t=new z.constructor(z.toJson());var y=this._getRendererAttributeInfo(z);if(this._isCBRenderer(t)){var H=p.getClusterField(y,"avg");e.push(this._getStatInfo(y,"avg"));t.normalizationType=null;t.normalizationField=null;t.normalizationTotal=null}else this._isUVRenderer(t)&&(H=p.getClusterField(y,
"type"),e.push(this._getStatInfo(y,"type")));t.attributeField=H;t.setValueExpression(null);t.valueExpressionTitle=null;t.setVisualVariables(null);this._setRendererTitle(t,z)}z=this._getSupportedVariables(z);y=this._createClusterVariables(z.allVars,e);t.setVisualVariables(y);z.sizeVars.length||this._isCBSizeRenderer(t)||this._addSizeByCountVariable(t);return{renderer:t,statisticInfos:e}},_isSupportedRenderer:function(z){if(this._isSimpleRenderer(z))return!0;if(this._isCBRenderer(z)){var e=z.normalizationType;
return"function"===typeof z.attributeField||e&&"field"!==e?!1:!0}return this._isUVRenderer(z)?"function"===typeof z.attributeField||z.attributeField2?!1:!0:!1},_isSimpleRenderer:function(z){return-1<z.declaredClass.toLowerCase().indexOf("simplerenderer")},_isCBRenderer:function(z){return-1<z.declaredClass.toLowerCase().indexOf("classbreaksrenderer")},_isUVRenderer:function(z){return-1<z.declaredClass.toLowerCase().indexOf("uniquevaluerenderer")},_isCBSizeRenderer:function(z){var e=z.infos;if(!this._isCBRenderer(z)||
!e||2>e.length)return!1;var t=Infinity,y=-Infinity;F.forEach(e,function(H){if(H=H.symbol){var E=0;switch(H.type){case "simplemarkersymbol":E=H.size;break;case "picturemarkersymbol":E=(H.width+H.height)/2}t=Math.min(t,E);y=Math.max(y,E)}});return Infinity!==t&&-Infinity!==y&&t!==y},_getRendererAttributeInfo:function(z){var e=z.attributeField,t=e?this.layer.getField(e):null;return{field:e,attributeType:t&&"esriFieldTypeDate"===t.type?"date":null,rotationType:null,valueExpression:z.valueExpression,valueExpressionTitle:z.valueExpressionTitle,
normalizationField:z.normalizationField}},_setRendererTitle:function(z,e){z.legendOptions=I.clone(e.legendOptions);z.legendOptions&&z.legendOptions.title||(z.legendOptions=z.legendOptions||{},z.legendOptions.title=n.getRendererTitle(e,this.layer))},_getSupportedVariables:function(z){var e=z.getVisualVariablesForType("colorInfo",!1)||[],t=z.getVisualVariablesForType("sizeInfo",!1)||[],y=z.getVisualVariablesForType("opacityInfo",!1)||[];z=z.getVisualVariablesForType("rotationInfo",!1)||[];e=F.filter(e,
this._variableFilter);t=F.filter(t,this._variableFilter);y=F.filter(y,this._variableFilter);z=F.filter(z,this._variableFilter);return{sizeVars:t,allVars:e.concat(t).concat(y).concat(z)}},_variableFilter:function(z){return"function"!==typeof z.field&&!a.viewScaleRE.test(z.valueExpression)},_createClusterVariables:function(z,e){return F.map(z,function(t){return this._createVarForAvg(t,e)},this)},_createVarForAvg:function(z,e){var t=I.clone(z),y=this._getVariableAttributeInfo(z);t.field=p.getClusterField(y,
"avg");t.normalizationField=null;t.valueExpression=null;t.valueExpressionTitle=null;y=this._getStatInfo(y,"avg");this._addStatInfo(e,y);this._setVariableTitle(t,z);return t},_getVariableAttributeInfo:function(z){var e="rotationInfo"===z.type,t=e?"angle":null;e=e?z.rotationType:null;var y=z.legendOptions&&z.legendOptions.title,H=z.field,E=H?this.layer.getField(H):null;E&&"esriFieldTypeDate"===E.type&&(t="date");return{field:H,attributeType:t,rotationType:e,valueExpression:z.valueExpression,valueExpressionTitle:z.valueExpressionTitle||
z.valueExpression&&y,normalizationField:z.normalizationField}},_setVariableTitle:function(z,e){z.legendOptions&&z.legendOptions.title||(z.legendOptions=z.legendOptions||{},z.legendOptions.title=n.getVisualVariableTitle(e,this.layer))},_getStatInfo:function(z,e){return{statisticHash:p.getStatisticHash(z,e),attributeInfo:z,statisticType:e}},_addStatInfo:function(z,e){var t=this._findStatInfo(z,e);t?t.attributeInfo.valueExpressionTitle||(t.attributeInfo.valueExpressionTitle=e.attributeInfo.valueExpressionTitle):
z.push(e)},_findStatInfo:function(z,e){var t;F.some(z,function(y){y.statisticHash===e.statisticHash&&(t=y);return!!t});return t},_compareStatInfos:function(z,e){var t=F.filter(z,function(H){return!this._findStatInfo(e,H)},this),y=F.filter(e,function(H){return!this._findStatInfo(z,H)},this);return y.length||t.length?{added:y,removed:t}:null},_addSizeByCountVariable:function(z){var e=this._createSizeByCountVariable();e&&this._addVariable(z,e)},_getSizeByCountVariable:function(z){z=z.getVisualVariablesForType("sizeInfo",
!1)||[];return F.filter(z,function(e){return"cluster_count"===e.field})[0]},_updateSizeByCountVariable:function(){var z=this._renderer,e=this._getSizeByCountVariable(z);if(e){var t=this._createSizeByCountVariable();t&&this._replaceVariable(z,e,t)}},_createSizeByCountVariable:function(){var z=this._clusterGenerator;if(z){var e=z.getCurrentLodStats();if(e){var t=z.getNumFeatures();z=z.clusters;var y=e.min,H=e.max;1===e.count&&y===t||1===z.length&&z[0].count===t?(y=1,H=t):y&&y===H&&(H=2*y);t={type:"sizeInfo",
field:"cluster_count",valueUnit:"unknown",minSize:12,maxSize:50,minDataValue:y,maxDataValue:H,legendOptions:{title:h}}}}return t},_addVariable:function(z,e){var t=z.visualVariables||[];t.push(e);z.setVisualVariables(t)},_replaceVariable:function(z,e,t){var y=z.visualVariables;e=F.indexOf(y,e);-1<e&&y.splice(e,1);y.push(t);z.setVisualVariables(y)},_getFields:function(z){var e=[new k({name:"cluster_count",type:"esriFieldTypeInteger"})];F.forEach(z,function(t){var y=t.statisticType;t=t.attributeInfo;
var H;"avg"===y?H="date"===t.attributeType?"esriFieldTypeDate":"esriFieldTypeDouble":"type"===y&&(H=t.field?this.layer.getField(t.field).type:"esriFieldTypeString");e.push(new k({name:p.getClusterField(t,y),type:H}))},this);return e},_createInfoTemplate:function(){var z=this._statisticInfos,e=this._renderer,t=[{fieldName:"cluster_count",label:h,visible:!0,format:{digitSeparator:!0,places:0}}],y=[],H=[r.substitute({count:"{cluster_count}"},J.countSummary)],E=this._isUVRenderer(e)?e.infos:[];F.forEach(z,
function(G){var O=G.statisticType,L=G.attributeInfo,N=p.getClusterField(L,O),T=this._getFieldLabel(G);if("avg"===O){var R={fieldName:N,label:T,visible:!0,format:"date"===L.attributeType?{dateFormat:"shortDateShortTime"}:{digitSeparator:!0,places:1}};var Q=this._getFieldSummary(G,N)}else"type"===O&&(Q="expression/"+N,R={fieldName:Q,visible:!0},y.push({name:N,title:T,returnType:"string",expression:this._getExpression(E,N)}),Q=this._getFieldSummary(G,Q));R&&t.push(R);Q&&H.push(Q)},this);return this._createPopupTemplate({fieldInfos:t,
expressionInfos:y,description:H.join("\x3cbr/\x3e\x3cbr/\x3e")})},_updateInfoTemplate:function(z){var e=z.toJson(),t=this._isUVRenderer(this._renderer)?this._renderer.infos:[];F.forEach(this._statisticInfos,function(y){var H=y.statisticType;y=p.getClusterField(y.attributeInfo,H);"type"===H&&(H=this._findExpressionInfo(y,e))&&(H.expression=this._getExpression(t,y))},this);return this._createPopupTemplate(e)},_createPopupTemplate:function(z){var e=new c(z),t=e.title;e.setTitle(I.hitch(this,function(y){var H=
this._map&&this._map.infoWindow;if("esri.dijit.PopupMobile"!==(H&&H.declaredClass)||e.info.title)return t.call(e,y);y=(y=y.attributes)&&y.cluster_count;return null==y?"":r.substitute({count:y},J.countTitle)}));return e},_findExpressionInfo:function(z,e){var t;F.some(e.expressionInfos,function(y){y.name===z&&(t=y);return!!t});return t},_escapeDoubleQuotes:function(z){return z?z.replace(/"/g,'\\"'):""},_getExpression:function(z,e){return["var uvInfos \x3d ["+this._getObjects(z).join(", ")+"];",'var predominantType \x3d Text($feature["'+
e+'"]);','var label \x3d "'+this._escapeDoubleQuotes(J.predominantNoneValue)+'";',"for (var i \x3d 0; i \x3c Count(uvInfos); i++) {\nif (uvInfos[i].value \x3d\x3d predominantType) {\nlabel \x3d uvInfos[i].label;\nbreak;\n}\n}\nreturn label;"].join("\n")},_getObjects:function(z){return F.map(z,function(e){return'{"value": "'+String(e.value)+'","label": "'+this._escapeDoubleQuotes(String(e.label))+'"}'},this)},_getFieldLabel:function(z){var e=z.statisticType,t=z.attributeInfo,y=t.field;z=t.normalizationField;
var H="";if("avg"===e)var E=z?J.avgNormFieldLabel:J.avgFieldLabel;else"type"===e&&(E=J.predominantFieldLabel);E&&(e=t.valueExpression?t.valueExpressionTitle:this.layer.getFieldLabel(y),z=z&&this.layer.getFieldLabel(z),H=r.substitute({fieldLabel:e||"",normFieldLabel:z||""},E));return H},_getFieldSummary:function(z,e){var t=z.statisticType,y=z.attributeInfo,H=y.field;z=y.normalizationField;var E="";if("avg"===t)var G=z?J.avgNormFieldSummary:J.avgFieldSummary;else"type"===t&&(G=J.predominantFieldSummary);
G&&(t=y.valueExpression?y.valueExpressionTitle:this.layer.getFieldLabel(H),z=z&&this.layer.getFieldLabel(z),E=r.substitute({fieldLabel:t||"",normFieldLabel:z||"",fieldValue:"{"+e+"}"},G));return E},_removeFromPopup:function(z){var e=this._map.infoWindow,t=e.features;if(t&&t.length){var y=F.filter(t,function(H){return H.getLayer()!==z});y.length<t.length&&(y.length?e.setFeatures(y):(e.clearFeatures(),e.hide()))}},_resetClusterNav:function(){this._resetClusterNavPartial();this._popupClusterGraphic=
null},_resetClusterNavPartial:function(){this._map.infoWindow.removeActions&&this._map.infoWindow.removeActions(this._popupActions);this._hideSingleGraphic(this._popupSingleGraphic);this._popupSingleGraphic=null},_addClusterBoundary:function(z,e){(e=e.clusterFillSymbol)&&(e=new e.constructor(e.toJson()));z=new u(z,e);this._map.graphics.add(z);this._clusterBoundary=z},_removeClusterBoundary:function(){this._map.graphics.remove(this._clusterBoundary);this._clusterBoundary=null},_createBrowseFeaturesAction:function(){return this._map.infoWindow.addActions([{title:A.NLS_browseFeatures,
className:"browseFeatures",callback:I.hitch(this,function(z){z.preventDefault();z=this._map.infoWindow;var e=z.getSelectedFeature(),t=e.getChildGraphics(),y=z.getCurrentAnchor();z.setFeatures(t,{anchor:y});if(t=f.graphicsExtent(t))this._addClusterBoundary(t,z),z.show(this._getPopupLocation(t,y));this._popupClusterGraphic=e})}])[0]},_getPopupLocation:function(z,e){var t=z.getCenter();e=e.toLowerCase();-1<e.indexOf("top")?t.update(t.x,z.ymax):-1<e.indexOf("bottom")?t.update(t.x,z.ymin):-1<e.indexOf("left")?
t.update(z.xmin,t.y):t.update(z.xmax,t.y);return t},_createViewSummaryAction:function(){return this._map.infoWindow.addActions([{title:A.NLS_viewSummary,className:"viewSummary",callback:I.hitch(this,function(z){z.preventDefault();z=this._popupClusterGraphic;var e=this._map.infoWindow;e.setFeatures([z]);e.show(z.geometry);this._popupClusterGraphic=null})}])[0]},_initClusterUpdates:function(){this._updateSizeVariable();this._updateClusterGraphics();this._eventHandles.push(this._clusterGenerator.on("update-end",
I.hitch(this,function(z){(z.mapLevelChange||z.indexChange)&&this._updateSizeVariable();this._updateClusterGraphics()})),this._clusterGenerator.on("index-complete",I.hitch(this,function(){this._updateSizeVariable()})))},_updateClusterGraphics:function(){this._hideSingleGraphics();var z=[],e=[];F.forEach(this._clusterGenerator.clusters,function(t){var y=new u(t.centroid);y.setAggregationSourceLayer(this.layer);y.setAggregationInfo(t);this._applyClusterAttributes(y,t);1===t.count?(t=this._getSingleGraphic(y),
e.push(t)):z.push(y)},this);this._showSingleGraphics(e);this._addGraphics(z)},_addGraphics:function(z){var e=this.container;e.clear();F.forEach(z,function(t){e.add(t)})},_getSingleGraphic:function(z){var e=this._clusterGenerator.getCell(z.getAggregationInfo().primary).features[0],t=this.layer.renderer;t=t&&t.getSymbol(e);var y=this._getSizeByCountVariable(this._renderer);t&&y&&(z=y?this._renderer.getSize(z,{sizeInfo:y,shape:t.style,resolution:this._map.getResolutionInMeters(),scale:this._map.getScale()}):
null,e.setSize(z));return e},_showSingleGraphics:function(z){F.forEach(z,this._showSingleGraphic);this._singleGraphics=z},_hideSingleGraphics:function(){F.forEach(this._singleGraphics,function(z){z.setSize(null);this._hideSingleGraphic(z)},this);this._singleGraphics=null},_clearSingleGraphics:function(){F.forEach(this._singleGraphics,function(z){z.setSize(null)});this._singleGraphics=null},_showSingleGraphic:function(z){z&&z._resume()},_hideSingleGraphic:function(z){z&&z._suspend()},_updateSizeVariable:function(){this.isClusteringEnabled()&&
(this._updateSizeByCountVariable(),this.emit("renderer-change"))},_applyClusterAttributes:function(z,e){z.setAttributes(e.attributes)},_createLayerEventListeners:function(){var z=this.layer;this._eventHandles.push(z.on("visibility-change",I.hitch(this,function(e){this.container.setVisibility(e.visible)})),z.on("scale-range-change",I.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)})),z.on("renderer-change",I.hitch(this,function(){this._applyRenderer()})),
z.on("info-template-change",I.hitch(this,function(){this._applyInfoTemplate()})))},_createMapEventListeners:function(){this._eventHandles.push(this._map.on("zoom-start",I.hitch(this,function(){this._removeClusterBoundary();this._removeFromPopup(this.container);this._removeFromPopup(this.layer);this._resetClusterNav();this.container.clear();this._hideSingleGraphics()})))},_createPopupEventListeners:function(){var z=this._map.infoWindow;this._eventHandles.push(z.on("selection-change",I.hitch(this,function(){this._resetClusterNavPartial();
var e=this._map.infoWindow.getSelectedFeature(),t=e&&e.getLayer();if(t){var y;t===this.container?(this._removeClusterBoundary(),this._map.infoWindow.addActions&&(y=this._createBrowseFeaturesAction())):t===this.layer&&e._isSuspended()?(this._map.infoWindow.addActions&&(y=this._createViewSummaryAction()),this._popupSingleGraphic=e,this._showSingleGraphic(this._popupSingleGraphic)):this._removeClusterBoundary();this._popupActions=y?[y]:null}})),z.on("clear-features",I.hitch(this,function(e){this._resetClusterNav();
e.isIntermediate||this._removeClusterBoundary()})),z.on("hide",I.hitch(this,function(){this._popupSingleGraphic&&this._popupSingleGraphic._suspend();this._clusterBoundary&&this._clusterBoundary.hide()})),z.on("show",I.hitch(this,function(){this._popupSingleGraphic&&this._popupSingleGraphic._resume();this._clusterBoundary&&this._clusterBoundary.show()})))},_destroyEventListeners:function(){F.forEach(this._eventHandles,function(z){z.remove()})}});D("extend-esri")&&I.setObject("layers.clustering.ClusterManager",
M,v);return M})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(M,I,F,D,v,m,u,r){M=M([m,u],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(w,f){I.mixin(this,f);this.initialize(w,f)},getTitle:function(w){var f;this.info&&(f=this.titleHasRelatedFields||this.titleHasAsyncExpressions?"":this._getPopupValues(w,
this._fetchAttributes(w,null,this.getExpressionFieldsInTitle()),!0).title);return f||""},getContent:function(w){return this.info?(new r({template:this,graphic:w,chartTheme:this.chartTheme},D.create("div"))).domNode:""}});F("extend-esri")&&I.setObject("dijit.PopupTemplate",M,v);return M})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./promiseList ./ArcadeExpression ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./arcadeProfiles/popupProfile ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a,b,k,g,p,B,J,A){M=M(null,{declaredClass:"esri.PopupInfo",_reNewline:/(\n)/ig,_reExprField:/^\s*expression\//i,_reExprFieldPattern:/\{expression\/([^\}]+)\}/ig,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",_aggregatedFeaturesVariable:"$aggregatedfeatures",initialize:function(h,x){if(h){I.mixin(this,x);this.info=h;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var z=this._fieldLabels=
{},e=this._fieldsMap={};this.info.fieldInfos&&F.forEach(this.info.fieldInfos,function(t){var y=t.fieldName.toLowerCase(),H=this._isExpressionField(y)?this.getExpressionInfo(y):null;z[y]=H?H.title:t.label;e[y]=t},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix));this.titleHasAsyncExpressions=this._titleHasAsyncExpressions();this.contentHasAsyncExpressions=this._contentHasAyncExpressions()}},toJson:function(){return D.fromJson(D.toJson(this.info))},
getTitle:function(){},getContent:function(){},getFieldInfo:function(h){var x;F.some(this.info&&this.info.fieldInfos,function(z){z.fieldName===h&&(x=z);return!!x});return x},getExpressionInfo:function(h){if(h=this._getExprField(h)){h=h.toLowerCase();var x;F.some(this.info.expressionInfos,function(z){z.name.toLowerCase()===h&&(x=z);return!!x});return x}},getExpressionFieldsInTitle:function(){return this._getExprFieldsFromTemplatedString(this.info.title)},getExpressionFieldsInContent:function(){var h=
this._collectExprFieldsFromTemplatedString(this.info.description,[]);this.info.description||F.forEach(this.info.fieldInfos,function(x){x.visible&&this._collectExprField(x.fieldName,h)},this);F.forEach(this.info.mediaInfos,function(x){this._collectExprFieldsFromTemplatedString(x.title,h);this._collectExprFieldsFromTemplatedString(x.caption,h);if(x=x.value)this._collectExprFieldsFromTemplatedString(x.linkURL,h),this._collectExprFieldsFromTemplatedString(x.sourceURL,h),F.forEach(x.fields,function(z){this._collectExprField(z,
h)},this),this._collectExprField(x.normalizeField,h),this._collectExprField(x.tooltipField,h)},this);return h},getRequiredExpressionFields:function(){return this.getExpressionFieldsInTitle().concat(this.getExpressionFieldsInContent())},hasGeometryOperations:function(){return F.some(this._getArcadeExpressions(),function(h){return h.hasGeometryOperations()})},hasAsyncExpressions:function(){return F.some(this._getArcadeExpressions(),function(h){return h.async})},initializeArcadeEngine:function(){return B.initialize(this._getArcadeExpressions())},
getComponents:function(h,x){var z=this.info,e={initArcadeEngine:this.initializeArcadeEngine()};z.fieldInfos&&(z=F.filter(z.fieldInfos,function(t){return-1!==t.fieldName.indexOf(this._relatedFieldPrefix)},this))&&0<z.length&&(e.relatedInfo=this._getRelatedRecords({graphic:h,fieldsInfo:z}));this._needFullResolutionFeature(h)&&(e.fullResolutionFeature=this._getFullResolutionFeature(h));this._needAggregatedFeaturesLayer(h)&&(e.aggregatedFeaturesLayer=this._getAggregatedFeaturesLayer(h));return d(e).then(I.hitch(this,
function(t){var y=t.fullResolutionFeature,H=x&&x.evaluateAllExpressions,E=H?null:this.getRequiredExpressionFields();t=(H?this.hasAsyncExpressions():this._hasAsyncExpressions(E))?this._fetchAttributesAsync(h,y,E,t.aggregatedFeaturesLayer):this._fetchAttributes(h,y,E);return d([t]).then(I.hitch(this,function(G){return this._getPopupValues(h,G[0])}))}))},getAttachments:function(h){var x=h.getSourceLayer();h=h.attributes;if(this.info.showAttachments&&x&&x.hasAttachments&&x.objectIdField&&(h=h&&h[x.objectIdField]))return x.queryAttachmentInfos(h)},
_needAggregatedFeaturesLayer:function(h){return h.isAggregate()?F.some(this._getArcadeExpressions(),function(x){return x.hasVariable(this._aggregatedFeaturesVariable)},this):!1},_getAggregatedFeaturesLayer:function(h){return h.getAggregationSourceLayer().getFeatureCollectionLayer(h.getChildGraphics()).always(function(x){return x instanceof Error?null:x})},_needFullResolutionFeature:function(h){return(h=h.getSourceLayer())?"function"===typeof h.getMaxAllowableOffset&&0<h.getMaxAllowableOffset()&&this.hasGeometryOperations():
!1},_getFullResolutionFeature:function(h){var x=h.getSourceLayer(),z=x.objectIdField;h=(h=h.attributes)&&z&&h[z];if(null==h)return null;var e=new b;e.where=z+"\x3d"+h;e.maxAllowableOffset=0;e.outFields=[z];x._enableCacheHint(e);return x.queryFeatures(e).then(function(t){return t.features&&t.features[0]})},_isExpressionField:function(h){return this._reExprField.test(h)},_getExprField:function(h){return this._isExpressionField(h)?h.replace(this._reExprField,""):null},_collectExprField:function(h,x){(h=
this._getExprField(h))&&x.push(h);return x},_collectExprFieldsFromTemplatedString:function(h,x){h=this._getExprFieldsFromTemplatedString(h);h.length&&Array.prototype.push.apply(x,h);return x},_getExprFieldsFromTemplatedString:function(h){h=h?h.match(this._reExprFieldPattern):null;return F.map(h,function(x){return x.replace(this._reExprFieldPattern,"$1")},this)},_titleHasAsyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInTitle())},_contentHasAyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInContent())},
_hasAsyncExpressions:function(h){return F.some(h,function(x){x=this._exprCache[x];return!(!x||!x.async)},this)},_compileExpressions:function(h){var x={};F.forEach(h,function(z){var e=z.returnType&&z.returnType.toLowerCase();x[z.name]=new a({expression:z.expression,returnType:"number"===e?"number":"string",profile:B})});return x},_getArcadeExpressions:function(){var h=[],x;for(x in this._exprCache)h.push(this._exprCache[x]);return h},_fetchAttributesAsync:function(h,x,z,e){var t=this._fetchAttributes(h,
x,z,e);h={};for(var y in t)(x=t[y])&&x.then&&(h[y]=x);return d(h).then(I.hitch(this,function(H){for(var E in H){var G=H[E];t[E]=G instanceof Error?null:this._processArcadeResult(G)}return t}))},_processArcadeResult:function(h){"string"===typeof h&&(h=f.encode(h));return h},_fetchAttributes:function(h,x,z,e){var t=I.clone(h.attributes)||{},y=x&&x.geometry,H=this._exprPrefix,E=this._exprCache;z=z||F.map(this.info.expressionInfos,function(G){return G.name});F.forEach(z,function(G){var O=H+G;G=(G=E[G])?
h.evaluateExpression(G,this._getEvalOptions(G,h,y,e)):null;t[O]=this._processArcadeResult(G)},this);return t},_getEvalOptions:function(h,x,z,e){var t=h.hasGeometryOperations(),y=x.getSourceLayer(),H=y&&(y.getMap()||y.parentLayer&&y.parentLayer.getMap());e&&(e._map=H);h=B.getEvalOptions({expression:h,feature:x,layer:y,aggregatedFeaturesLayer:e,map:H,spatialReference:H&&H.spatialReference});x=h.context.vars.$feature;t=!(!t||!z);x&&t&&(x._geometry=z);h.skipCache=t;return h},_getPopupValues:function(h,
x,z){x=x||this._fetchAttributes(h);var e=this.info,t=h.getSourceLayer(),y=I.clone(x),H="",E="",G,O,L=t&&t._getDateOpts&&t._getDateOpts().properties;L=L&&L.slice(0);var N={dateFormat:{properties:L,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)},format:null};if(this._relatedInfo)for(Q in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(Q)){var T=this._relatedInfo[Q],R=this._relatedLayersInfo[Q];T&&(F.forEach(T.relatedFeatures,function(la){for(O in la.attributes)if(la.attributes.hasOwnProperty(O)&&
"esriRelCardinalityOneToOne"===R.relation.cardinality){var oa=this._toRelatedFieldName([R.relation.id,O]);x[oa]=y[oa]=la.attributes[O]}},this),F.forEach(T.relatedStatsFeatures,function(la){for(O in la.attributes)if(la.attributes.hasOwnProperty(O)){var oa=this._toRelatedFieldName([R.relation.id,O]);x[oa]=y[oa]=la.attributes[O]}},this))}for(G in y){var Q=this._fieldsMap[G.toLowerCase()];T=this._getLayerFieldInfo(t,G);Q&&T&&(Q.fieldName=T.name);y[G]=this._formatValue(y[G],G,N);L&&Q&&Q.format&&Q.format.dateFormat&&
(Q=F.indexOf(L,G),-1<Q&&L.splice(Q,1))}if(t)for(G in L=t.typeIdField,x)if(x.hasOwnProperty(G)&&-1===G.indexOf(this._relatedFieldPrefix)){var W=x[G];c.isDefined(W)&&(Q=this._getDomainName(t,h,G,W),c.isDefined(Q)?y[G]=Q:G===L&&(Q=this._getTypeName(t,h,W),c.isDefined(Q)&&(y[G]=Q)))}e.title&&(H=this._processFieldsInLinks(this._fixTokens(e.title,t),x),H=I.trim(this._removeEmptyHref(c.substitute(y,H,N)||"")));if(z)return{title:H};e.description&&(E=this._processFieldsInLinks(this._fixTokens(e.description,
t),x),E=I.trim(this._removeEmptyHref(c.substitute(y,E,N)||"")));if(e.fieldInfos){var ba=[];F.forEach(e.fieldInfos,function(la){(G=la.fieldName)&&la.visible&&ba.push([this._fieldLabels[G.toLowerCase()]||G,c.substitute(y,"${"+G+"}",N)||""])},this)}var da;if(e.mediaInfos){var fa=[];F.forEach(e.mediaInfos,function(la){da=0;W=la.value;switch(la.type){case "image":var oa=W.sourceURL;oa=oa&&I.trim(this._removeEmptyHref(c.substitute(x,this._fixTokens(oa,t))));da=!!oa;break;case "piechart":case "linechart":case "columnchart":case "barchart":oa=
W.normalizeField;W.fields=F.map(W.fields,function(Fa){return(ua=this._getLayerFieldInfo(t,Fa))?ua.name:Fa},this);if(oa){var ua=this._getLayerFieldInfo(t,oa);W.normalizeField=ua?ua.name:oa}da=F.some(W.fields,function(Fa){return c.isDefined(x[Fa])||-1!==Fa.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(da){la=I.clone(la);W=la.value;oa=la.title?this._processFieldsInLinks(this._fixTokens(la.title,t),x):"";var Ca=la.caption?this._processFieldsInLinks(this._fixTokens(la.caption,
t),x):"";la.title=oa?I.trim(this._removeEmptyHref(c.substitute(y,oa,N)||"")):"";la.caption=Ca?I.trim(this._removeEmptyHref(c.substitute(y,Ca,N)||"")):"";if("image"===la.type)W.sourceURL=c.substitute(x,this._fixTokens(W.sourceURL,t)),W.linkURL&&(W.linkURL=I.trim(c.substitute(x,this._fixTokens(W.linkURL,t))||""));else{var wa,Ja;F.forEach(W.fields,function(Fa,Ea){if(-1!==Fa.indexOf(this._relatedFieldPrefix))Ja=this._getRelatedChartInfos(Fa,W,x,N),Ja instanceof Array?W.fields=Ja:W.fields[Ea]=Ja;else{var Ia=
x[Fa];Ia=void 0===Ia?null:Ia;wa=x[W.normalizeField]||0;Ia&&wa&&(Ia/=wa);W.fields[Ea]={y:Ia,tooltip:(this._fieldLabels[Fa.toLowerCase()]||Fa)+":\x3cbr/\x3e"+this._formatValue(Ia,Fa,N,!!wa)}}},this)}fa.push(la)}},this)}return{title:H,description:E,hasDescription:!!e.description,fields:ba&&ba.length?ba:null,mediaInfos:fa&&fa.length?fa:null,formatted:y,editSummary:!1!==e.showLastEditInfo&&t&&t.getEditSummary?t.getEditSummary(h):""}},_getRelatedChartInfos:function(h,x,z,e){var t,y;var H=[];var E=this._fromRelatedFieldName(h);
var G=E[0];var O=this._relatedInfo[G];G=this._relatedLayersInfo[G];O&&F.forEach(O.relatedFeatures,function(L){L=L.attributes;var N;for(N in L)if(L.hasOwnProperty(N)&&N===E[1]){var T={};y=L[N];x.normalizeField&&(t=-1!==x.normalizeField.indexOf(this._relatedFieldPrefix)?L[this._fromRelatedFieldName(x.normalizeField)[1]]:z[x.normalizeField]);y&&t&&(y/=t);if(x.tooltipField)if(-1!==x.tooltipField.indexOf(this._relatedFieldPrefix)){var R=this._fromRelatedFieldName(x.tooltipField)[1],Q=c.isDefined(L[R])?
this._formatValue(L[R],x.tooltipField,e,!!t):R;T.tooltip=Q+":\x3cbr/\x3e"+this._formatValue(y,R,e,!!t)}else T.tooltip=(this._fieldLabels[h.toLowerCase()]||h)+":\x3cbr/\x3e"+this._formatValue(y,x.tooltipField,e,!!t);else T.tooltip=y;T.y=y;H.push(T)}},this);return"esriRelCardinalityOneToMany"===G.relation.cardinality||"esriRelCardinalityManyToMany"===G.relation.cardinality?H:H[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",
shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",
shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",longMonthDayYearShortTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longMonthDayYearShortTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longMonthDayYearLongTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",
longMonthDayYearLongTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",dayShortMonthYearShortTime:"(datePattern: 'd MMM y', timePattern: 'h:mm a', selector: 'date and time')",dayShortMonthYearShortTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm', selector: 'date and time')",dayShortMonthYearLongTime:"(datePattern: 'd MMM y', timePattern: 'h:mm:ss a', selector: 'date and time')",dayShortMonthYearLongTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm:ss', selector: 'date and time')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",longDateShortTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longDateShortTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longDateLongTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",longDateLongTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",
shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_dateFormatsJson:{shortDate:{datePattern:"M/d/y",selector:"date"},shortDateShortTime:{datePattern:"M/d/y",timePattern:"h:mm a",selector:"date and time"},shortDateShortTime24:{datePattern:"M/d/y",timePattern:"H:mm",selector:"date and time"},shortDateLongTime:{datePattern:"M/d/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLongTime24:{datePattern:"M/d/y",timePattern:"H:mm:ss",selector:"date and time"},
shortDateLE:{datePattern:"d/M/y",selector:"date"},shortDateLEShortTime:{datePattern:"d/M/y",timePattern:"h:mm a",selector:"date and time"},shortDateLEShortTime24:{datePattern:"d/M/y",timePattern:"H:mm",selector:"date and time"},shortDateLELongTime:{datePattern:"d/M/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLELongTime24:{datePattern:"d/M/y",timePattern:"H:mm:ss",selector:"date and time"},longMonthDayYear:{datePattern:"MMMM d, y",selector:"date"},longMonthDayYearShortTime:{datePattern:"MMMM d, y",
timePattern:"h:mm a",selector:"date and time"},longMonthDayYearShortTime24:{datePattern:"MMMM d, y",timePattern:"H:mm",selector:"date and time"},longMonthDayYearLongTime:{datePattern:"MMMM d, y",timePattern:"h:mm:ss a",selector:"date and time"},longMonthDayYearLongTime24:{datePattern:"MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},dayShortMonthYear:{datePattern:"d MMM y",selector:"date"},dayShortMonthYearShortTime:{datePattern:"d MMM y",timePattern:"h:mm a",selector:"date and time"},dayShortMonthYearShortTime24:{datePattern:"d MMM y",
timePattern:"H:mm",selector:"date and time"},dayShortMonthYearLongTime:{datePattern:"d MMM y",timePattern:"h:mm:ss a",selector:"date and time"},dayShortMonthYearLongTime24:{datePattern:"d MMM y",timePattern:"H:mm:ss",selector:"date and time"},longDate:{datePattern:"EEEE, MMMM d, y",selector:"date"},longDateShortTime:{datePattern:"EEEE, MMMM d, y",timePattern:"h:mm a",selector:"date and time"},longDateShortTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm",selector:"date and time"},longDateLongTime:{datePattern:"EEEE, MMMM d, y",
timePattern:"h:mm:ss a",selector:"date and time"},longDateLongTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},longMonthYear:{datePattern:"MMMM y",selector:"date"},shortMonthYear:{datePattern:"MMM y",selector:"date"},year:{datePattern:"y",selector:"date"}},_reHref:/href\s*=\s*(")([^"]+)"/ig,_reHrefApos:/href\s*=\s*(')([^']+)'/ig,_fixTokens:function(h,x){var z=this;return h.replace(/(\{([^\{\r\n]+)\})/g,function(e,t,y){e=z._getLayerFieldInfo(x,y);return"$"+(e?"{"+
e.name+"}":t)})},_encodeAttributes:function(h,x){h=I.clone(h)||{};var z,e;for(z in h)(e=h[z])&&"string"===typeof e&&(e=x?e:encodeURIComponent(e),e=e.replace(/'/g,"\x26apos;"),h[z]=e);return h},_processFieldsInLinks:function(h,x){var z=this._encodeAttributes(x),e=this._encodeAttributes(x,!0);x=I.hitch(this,this._addValuesToHref,x,z,e);h&&(h=h.replace(this._reHref,x).replace(this._reHrefApos,x));return h},_addValuesToHref:function(h,x,z,e,t,y){y=y&&I.trim(y);return e=c.substitute(y&&0===y.indexOf("${")?
"'"===t?z:h:x,e)},_getLayerFieldInfo:function(h,x){return h&&h.getField?h.getField(x):null},_formatValue:function(h,x,z,e){var t=this._fieldsMap[x.toLowerCase()],y=t&&t.format;x=-1!==F.indexOf(z.dateFormat.properties,x);var H="number"===typeof h&&!x&&(!y||!y.dateFormat);if(!c.isDefined(h)||!t||!c.isDefined(y))return this._applyFormatting(h,H);t=y.hasOwnProperty("places")||y.hasOwnProperty("digitSeparator");var E=y.hasOwnProperty("digitSeparator")?y.digitSeparator:!0;if(t&&!x)var G={formatType:"NumberFormat",
places:c.isDefined(y.places)&&(!e||0<y.places)?Number(y.places):Infinity};else if(y.dateFormat)G=I.mixin({formatType:"DateFormat",utcOffset:this.utcOffset},this._dateFormatsJson[y.dateFormat]||this._dateFormatsJson.shortDateShortTime);else return this._applyFormatting(h,H);var O=this._applyFormatFunctions(h,G,z);t&&-1<h.constructor.toString().indexOf("Array")&&(O="",F.forEach(h,I.hitch(this,function(L,N){N&&(O+=" ");O+=this._applyFormatFunctions(L,G,z)})));t&&!E&&A.group&&(O=O.replace(new RegExp("\\"+
A.group,"g"),""));x&&(O='\x3cspan class\x3d"esriDateValue"\x3e'+O+"\x3c/span\x3e");return this._applyFormatting(O,H)},_applyFormatFunctions:function(h,x,z){x&&z&&(z.format={myKey:x});h=c.substitute({myKey:h},"${myKey}",z)||"";x&&z&&(z.format=null);return h},_applyFormatting:function(h,x){return x?this._forceLTR(h):this._applyPreWrap(h)},_forceLTR:function(h){var x=r("ie");return x&&10>=x?h:"\x3cspan class\x3d'esriNumericValue'\x3e"+h+"\x3c/span\x3e"},_applyPreWrap:function(h){return"string"===typeof h?
h.replace(this._reNewline,"\x3cspan class\x3d'charNewLine'\x3e$1\x3c/span\x3e"):h},_insertOffset:function(h){h&&(h=c.isDefined(this.utcOffset)?h.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):h);return h},_getDomainName:function(h,x,z,e){return(h=h.getDomain&&h.getDomain(z,{feature:x}))&&h.codedValues?h.getName(e):null},_getTypeName:function(h,x,z){return(h=h.getType&&h.getType(x))&&h.name},_getRelatedRecords:function(h){var x=h.graphic,z;this._relatedLayersInfoPromise||(this._relatedLayersInfoPromise=
this._getRelatedLayersInfo(h).then(I.hitch(this,function(e){for(z in e)e.hasOwnProperty(z)&&e[z]&&(this._relatedLayersInfo[z].relatedLayerInfo=e[z])})));return this._relatedLayersInfoPromise.then(I.hitch(this,function(){return this._queryRelatedLayers(x)})).then(I.hitch(this,function(e){this._setRelatedRecords(x,e);return e}))},_getRelatedLayersInfo:function(h){var x=h.fieldsInfo,z,e={};var t=h.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});F.forEach(x,function(y){var H;
var E=this._fromRelatedFieldName(y.fieldName);var G=E[0];E=E[1];if(G&&(!this._relatedLayersInfo[G]&&t&&t.relationships&&(F.some(t.relationships,function(L){if(L.id==G)return H=L,!0}),H&&(this._relatedLayersInfo[G]={relation:H,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[G]&&(this._relatedLayersInfo[G].relatedFields.push(E),y.statisticType))){var O=new p;O.statisticType=y.statisticType;O.onStatisticField=E;O.outStatisticFieldName=E;this._relatedLayersInfo[G].outStatistics.push(O)}},
this);for(z in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(z)&&this._relatedLayersInfo[z]&&(h=this._relatedLayersInfo[z].relation,h=t.url.replace(/[0-9]+$/,h.relatedTableId),this._relatedLayersInfo[z].relatedLayerUrl=h,e[z]=q({url:h,content:{f:"json"},callbackParamName:"callback"}));return w(e)},_queryRelatedLayers:function(h){var x={},z;for(z in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(z)&&(x[z]=this._queryRelatedLayer({graphic:h,relatedInfo:this._relatedLayersInfo[z]}));
return w(x)},_queryRelatedLayer:function(h){var x,z;var e=h.graphic;var t=e.getSourceLayer();var y=t.url.match(/[0-9]+$/g)[0];var H=h.relatedInfo;var E=H.relatedLayerInfo;var G=H.relatedLayerUrl;var O=H.relation;h=F.filter(E.relationships,function(W){return W.relatedTableId===parseInt(y,10)});1===h.length?x=h[0]:1<h.length&&F.some(h,function(W){W.id===O.id&&(x=W);return!!x});if(x){var L=new b;F.some(E.fields,function(W){if(W.name===x.keyField)return z=-1!==F.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger",
"esriFieldTypeSingle","esriFieldTypeDouble"],W.type)?"number":"string",!0});if(x.relationshipTableId&&x.keyFieldInRelationshipTable){var N=new u;this._queryRelatedRecords(e,x).then(I.hitch(this,function(W){var ba;(ba=W[e.attributes[t.objectIdField]])?(W=F.map(ba.features,function(da){return da.attributes[E.objectIdField]},this),H.outStatistics&&0<H.outStatistics.length&&E.supportsStatistics&&(R=new b,R.where=this._chunkWhereInClause(E.objectIdField,W,1E3),R.outFields=L.outFields,R.outStatistics=H.outStatistics),
R&&(Q=new k(G),Q.execute(R).then(I.hitch(this,function(da){var fa=[];fa.push(ba);fa.push(da);N.resolve(fa)})))):N.resolve()}))}else{var T="string"===z?x.keyField+"\x3d'"+e.attributes[O.keyField]+"'":x.keyField+"\x3d"+e.attributes[O.keyField];L.where=T;L.outFields=H.relatedFields;if(H.outStatistics&&0<H.outStatistics.length&&E.supportsStatistics){var R=new b;R.where=L.where;R.outFields=L.outFields;R.outStatistics=H.outStatistics}var Q=new k(G);T=[];T.push(Q.execute(L));R&&T.push(Q.execute(R))}}return T?
w(T):N?N.promise:void 0},_setRelatedRecords:function(h,x){this._relatedInfo=[];for(var z in x)x.hasOwnProperty(z)&&x[z]&&(h=x[z],this._relatedInfo[z]={},this._relatedInfo[z].relatedFeatures=h[0].features,c.isDefined(h[1])&&(this._relatedInfo[z].relatedStatsFeatures=h[1].features))},_handlerErrorResponse:function(h,x){h.reject(x)},_fromRelatedFieldName:function(h){var x=[];-1!==h.indexOf(this._relatedFieldPrefix)&&(h=h.split("/"),x=h.slice(1));return x},_toRelatedFieldName:function(h){var x="";h&&
0<h.length&&(x=this._relatedFieldPrefix+h[0]+"/"+h[1]);return x},_queryRelatedRecords:function(h,x){var z=h.getSourceLayer(),e=new g;e.outFields=["*"];e.relationshipId=x.id;e.objectIds=[h.attributes[z.objectIdField]];return z.queryRelatedFeatures(e)},_removeEmptyHref:function(h){return h.replace(/href=(""|'')/gi,"")},_chunkWhereInClause:function(h,x,z){for(var e=0,t=[];e<x.length;)t.push(h+" IN ("+x.slice(e,z+e)+")"),e+=z;return t.join(" OR ")}});m("extend-esri")&&(n.PopupInfo=n.PopupInfoTemplate=
M);return M})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(M){var I=M.getObject("dojox.html.entities",!0),F=function(v,m){if(m._encCache&&m._encCache.regexp&&m._encCache.mapper&&m.length==m._encCache.length){var u=m._encCache.mapper;var r=m._encCache.regexp}else{u={};r=["["];var w;for(w=0;w<m.length;w++)u[m[w][0]]="\x26"+m[w][1]+";",r.push(m[w][0]);r.push("]");r=new RegExp(r.join(""),"g");m._encCache={mapper:u,regexp:r,length:m.length}}return v=v.replace(r,function(f){return u[f]})},
D=function(v,m){if(m._decCache&&m._decCache.regexp&&m._decCache.mapper&&m.length==m._decCache.length){var u=m._decCache.mapper;var r=m._decCache.regexp}else{u={};r=["("];var w;for(w=0;w<m.length;w++){var f="\x26"+m[w][1]+";";w&&r.push("|");u[f]=m[w][0];r.push(f)}r.push(")");r=new RegExp(r.join(""),"g");m._decCache={mapper:u,regexp:r,length:m.length}}return v=v.replace(r,function(c){return u[c]})};I.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];I.latin=[["\u00a1",
"iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],
["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],
["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],
["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a",
"Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be",
"xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191",
"uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229",
"cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663",
"clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030",
"permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];I.encode=function(v,m){v&&(m?v=F(v,m):(v=F(v,I.html),v=F(v,I.latin)));return v};I.decode=function(v,m){v&&(m?v=D(v,m):(v=D(v,I.html),v=D(v,I.latin)));return v};return I})},"esri/ArcadeExpression":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./layers/support/attributeUtils ./support/expressionUtils".split(" "),function(M,I,F,D,v,m){M=M(null,{declaredClass:"esri.ArcadeExpression",expression:null,profile:null,returnType:null,
async:null,id:null,syntaxTree:null,_traits:null,_attributeDef:null,_attributeCache:null,_compiled:!1,constructor:function(u){I.mixin(this,u);this.returnType=this.returnType||"string";this.id=v.getAttributeId(this.expression);this._setSyntaxTree(this.profile.parse(this));this.async=this.async||this.profile.isAsync(this)},hasGeometryOperations:function(){var u=this._traits.geometryOperations;void 0===u&&(u=this._traits.geometryOperations=m.hasGeometryOperations(this.syntaxTree));return u},hasFeatureSetOperations:function(){var u=
this._traits.featureSetOperations;void 0===u&&(u=this._traits.featureSetOperations=m.hasFeatureSetOperations(this.syntaxTree));return u},hasVariable:function(u){var r=this._traits.variables;void 0===r[u]&&(r[u]=m.hasVariable(this.syntaxTree,u));return r[u]},hasFunction:function(u){var r=this._traits.functions;void 0===r[u]&&(r[u]=m.hasFunction(this.syntaxTree,u));return r[u]},evaluate:function(u){this._compile();var r=this._attributeCache.compiledFunc;return this.async?m.executeAsyncFunction(r,u):
m.executeFunction(r,u)},_setSyntaxTree:function(u){this.syntaxTree=u;this._compiled=!1;this._traits={variables:{},functions:{}};this._createLegacyValueObjects()},_createLegacyValueObjects:function(){this._attributeDef={valueExpression:this.expression};this._attributeCache={attributeInfo:this._attributeDef,isNumeric:"number"===this.returnType,idSource:this.expression,id:this.id,hasExpr:!0,compiledFunc:null,syntaxTree:this.syntaxTree,isScaleDriven:!1,dependsOnView:this.hasVariable("$view"),dependsOnGeometry:this.hasGeometryOperations(),
isJSFunc:!1}},_compile:function(){this._compiled||(this._attributeCache.compiledFunc=this.profile.compile(this),this._compiled=!0)}});F("extend-esri")&&(D.ArcadeExpression=M);return M})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(M,I,F,D,v){M=M(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,
orderByFields:null,toJson:function(){var m={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},u=this.objectIds,r=this.outFields,w=this.outSpatialReference,f=this.orderByFields;u&&(m.objectIds=u.join(","));r&&(m.outFields=r.join(","));w&&(m.outSR=w.wkid||F.toJson(w.toJson()));f&&(m.orderByFields=f.join(","));m._ts=this._ts;return m}});D("extend-esri")&&
I.setObject("tasks.RelationshipQuery",M,v);return M})},"esri/arcadeProfiles/popupProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(M,I,F,D,v,m,u,r){M=new (M(null,{declaredClass:"esri.arcadeProfiles.PopupProfile",defaults:{globals:{featureSet:["$layer","$datastore","$map","$aggregatedfeatures"],async:["$layer","$datastore","$map","$aggregatedfeatures"]},context:{vars:{$feature:"any",
$layer:"any",$datastore:"any",$map:"any",$aggregatedfeatures:"any"}}},initialize:function(w){var f=[];r.hasGeometryOperations(w)&&f.push(u.enableGeometryOperations());(r.hasFeatureSetOperations(w)||r.hasVariables(w,this.defaults.globals.featureSet))&&f.push(u.enableFeatureSetOperations());r.isAsync(w)&&f.push(u.enableAsyncOperations());return v(f)},isAsync:function(w){w=[w];return r.hasFeatureSetOperations(w)||r.hasVariables(w,this.defaults.globals.async)},parse:function(w){return u.createSyntaxTree(w.expression)},
compile:function(w){var f=I.clone(this.defaults.context);f.useAsync=w.async;return w.syntaxTree?u.createFunction(w.syntaxTree,f):null},getEvalOptions:function(w){var f=w.expression,c=w.feature,n=w.layer,q=w.aggregatedFeaturesLayer,d=w.map;w=w.spatialReference;c=c&&f.hasVariable("$feature")?m.createFromGraphicLikeObject(c.geometry,c.attributes,n):null;var a,b;if(n){var k={spatialReference:w};f.hasVariable("$layer")&&(a=n.getMap()?u.createFeatureSetFromLayer(n,k):u.createFeatureSetFromLayerUrl(n.url,
k));if(f.hasVariable("$datastore"))var g=(g=r.getServiceUrl(n.url))?u.createFeatureSetCollectionFromServiceUrl(g,k):null;f.hasVariable("$aggregatedfeatures")&&q&&(b=q.getMap()?u.createFeatureSetFromLayer(q,k):null)}f=d&&f.hasVariable("$map")?u.createFeatureSetCollectionFromMap(d):null;return{context:{vars:{$feature:c,$layer:a,$datastore:g,$map:f,$aggregatedfeatures:b},spatialReference:w}}}}));F("extend-esri")&&I.setObject("arcadeProfiles.popupProfile",M,D);return M})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style ../libs/sanitizer/Sanitizer dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a,b,k,g,p,B,J,A){var h=0,x=A.widgets.popup,z=A.widgets.templatePicker;I=I([J,b,k],{declaredClass:"esri.dijit._PopupRenderer",_sanitizer:new d({whiteList:{span:["class"],dd:[],dl:[],dt:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],sub:[],sup:[],animate:[],animatetransform:[],circle:[],clippath:[],defs:[],ellipse:[],g:[],image:[],line:[],lineargradient:[],marker:[],mask:[],path:[],pattern:[],polygon:[],polyline:[],radialgradient:[],rect:[],stop:[],svg:[],"switch":[],symbol:[],
text:[],textpath:[],tspan:[],use:[]}},!0),constructor:function(){this._nls=D.mixin({},x)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'statusSection hidden' dojoAttachPoint\x3d'_status'\x3e\x3c/div\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this._showStatus(z.loading);this._contentDfd=this.template.getComponents(this.graphic).then(D.hitch(this,this._handleComponentsSuccess)).otherwise(D.hitch(this,this._handleComponentsError))},destroy:function(){this._contentDfd&&this._contentDfd.cancel();this._attachmentsDfd&&this._attachmentsDfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._contentDfd=this._attachmentsDfd=null;this.inherited(arguments)},
_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var e=this._mediaInfos,t=e.length,y=this.domNode,H=this._prevMedia,E=this._nextMedia;if(1<t){var G=0,O=0;v.forEach(e,function(L){"image"===L.type?G++:-1!==L.type.indexOf("chart")&&O++});G&&(f.set(this._imageCount,"innerHTML",G),m.query(".summary .image",
y).removeClass("hidden"));O&&(f.set(this._chartCount,"innerHTML",O),m.query(".summary .chart",y).removeClass("hidden"))}else m.query(".summary",y).addClass("hidden"),c.add(H,"hidden"),c.add(E,"hidden");e=this._mediaPtr;0===e?c.add(H,"hidden"):c.remove(H,"hidden");e===t-1?c.add(E,"hidden"):c.remove(E,"hidden");this._destroyFrame()},_displayMedia:function(){var e=this._mediaInfos[this._mediaPtr],t=e.title,y=e.caption,H=m.query(".mediaSection .hzLine",this.domNode)[0];f.set(this._mediaTitle,"innerHTML",
this._sanitizer.sanitize(t));c[t?"remove":"add"](this._mediaTitle,"hidden");f.set(this._mediaCaption,"innerHTML",this._sanitizer.sanitize(y));c[y?"remove":"add"](this._mediaCaption,"hidden");c[t&&y?"remove":"add"](H,"hidden");this._rid=null;if("image"===e.type)this._showImage(e);else{var E=this;t=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"];y=e.value.theme||this.chartTheme;D.isString(y)&&(y=y.replace(/\./gi,"/"),-1===y.indexOf("/")&&(y="dojox/charting/themes/"+y));y||(y="./Rainbow");
t.push(y);try{var G=this._rid=h++;M(t,function(O,L,N){G===E._rid&&(E._rid=null,E._showChart(e.type,e.value,O,L,N))})}catch(O){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(e){return(e=e&&D.trim(e).toLowerCase())&&(0===e.indexOf("mailto:")||0===e.indexOf("tel:"))},_showImage:function(e){c.add(this._mediaFrame,"image");var t=q.get(this._gallery,"height"),y=e.value,H=a.decode(y.linkURL);y=a.decode(y.sourceURL);var E;H&&(E=n.create("a",{href:H,target:this._preventNewTab(H)?
"":"_blank"},this._mediaFrame));H=e.refreshInterval?this._addURLParameter(y,"timestamp",Date.now()):y;n.create("img",{className:"esriPopupMediaImage",src:H},E||this._mediaFrame);var G=m.query(".esriPopupMediaImage",this._mediaFrame)[0];this._imageLoadHandle=F.connect(G,"onload",this,function(){this._clearImageHandles();this._imageLoaded(G,t);this._initImageRefresh(e)})},_addURLParameter:function(e,t,y){var H=-1===e.indexOf("?")?"?":"\x26";return e+H+t+"\x3d"+y},_initImageRefresh:function(e){if(e.refreshInterval){var t=
6E4*e.refreshInterval;this._imageRefreshHandle=setTimeout(D.hitch(this,function(){this._destroyFrame();this._showImage(e)}),t)}},_clearImageHandles:function(){F.disconnect(this._imageLoadHandle);this._imageLoadHandle=null;clearTimeout(this._imageRefreshHandle);this._imageRefreshHandle=null},_showChart:function(e,t,y,H,E){c.remove(this._mediaFrame,"image");y=this._chart=new y(n.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});E&&y.setTheme(E);switch(e){case "piechart":y.addPlot("default",
{type:"Pie",labels:!1});y.addSeries("Series A",t.fields);break;case "linechart":y.addPlot("default",{type:"Markers"});y.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});y.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});v.forEach(t.fields,function(G,O){G.x=O+1});y.addSeries("Series A",t.fields);break;case "columnchart":y.addPlot("default",{type:"Columns",gap:3});y.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});y.addSeries("Series A",t.fields);break;
case "barchart":y.addPlot("default",{type:"Bars",gap:3}),y.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),y.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),y.addSeries("Series A",t.fields)}this._action=new H(y);y.render()},_destroyFrame:function(){this._rid=null;this._clearImageHandles();this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);f.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(e,
t){var y=e.height;y<t&&q.set(e,"marginTop",Math.round((t-y)/2)+"px")},_attListHandler:function(e,t){if(e===this._attachmentsDfd){this._attachmentsDfd=null;var y="";t instanceof Error||!t||!t.length||v.forEach(t,function(H){y+="\x3cli\x3e";y+="\x3ca href\x3d'"+B.addProxy(H.url)+"' target\x3d'_blank'\x3e"+(H.name||"[No name]")+"\x3c/a\x3e";y+="\x3c/li\x3e"});f.set(this._attachmentsList,"innerHTML",y||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_createLinkIfURI:function(e,t){var y=B.getURIInfo(e);
if(y){var H=e.match(y.pattern);e=H&&H[2];H=a.decode(H[1]);n.create("a",{target:"_blank",href:H,title:H,innerHTML:this._sanitizer.sanitize(p.substitute({appName:y.appName,hierPart:e},y.label))},t)}else f.set(t,"innerHTML",this._sanitizer.sanitize(e))},_showStatus:function(e){f.set(this._status,"innerHTML",e);c.remove(this._status,"hidden");m.query(".mainSection",this.domNode).addClass("hidden")},_hideStatus:function(){f.set(this._status,"innerHTML","");c.add(this._status,"hidden");m.query(".mainSection",
this.domNode).removeClass("hidden")},_handleComponentsSuccess:function(e){if(e){this._hideStatus();var t=this.showTitle?e.title:"",y=e.description,H=e.fields,E=e.mediaInfos,G=this.domNode,O=this._nls,L=this,N=this.template,T=this.graphic;this._prevMedia.title=O.NLS_prevMedia;this._nextMedia.title=O.NLS_nextMedia;f.set(this._title,"innerHTML",this._sanitizer.sanitize(t));t||c.add(this._title,"hidden");if(!e.hasDescription&&H&&(y="",H=v.map(H,function(Q){var W=n.create("tr",{vAlign:"top"});n.create("td",
{className:"attrName",innerHTML:this._sanitizer.sanitize(Q[0])},W);var ba=n.create("td",{className:"attrValue"},W);this._createLinkIfURI(Q[1],ba);return W},this),H.length)){var R=n.create("table",{className:"attrTable",cellPadding:"0px",cellSpacing:"0px"});v.forEach(H,function(Q){R.appendChild(Q)})}R?(this._description.appendChild(R),y=!0):f.set(this._description,"innerHTML",this._sanitizer.sanitize(y));y||c.add(this._description,"hidden");m.query("a",this._description).forEach(function(Q){L._preventNewTab(Q.href)?
"_blank"===Q.target&&f.remove(Q,"target"):f.set(Q,"target","_blank")});t&&y?m.query(".mainSection .hzLine",G).removeClass("hidden"):t||y?m.query(".mainSection .hzLine",G).addClass("hidden"):m.query(".mainSection",G).addClass("hidden");if(t=this._attachmentsDfd=N.getAttachments(T))t.addBoth(D.hitch(this,this._attListHandler,t)),f.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+O.NLS_searching+"...\x3c/li\x3e"),m.query(".attachmentsSection",G).removeClass("hidden");E&&E.length&&(m.query(".mediaSection",
G).removeClass("hidden"),w.setSelectable(this._mediaFrame,!1),this._mediaInfos=E,this._mediaPtr=0,this._updateUI(),this._displayMedia());e.editSummary&&(f.set(this._editSummary,"innerHTML",this._sanitizer.sanitize(e.editSummary)),E&&E.length&&c.remove(this._mediaBreak,"hidden"),c.remove(this._editSummarySection,"hidden"));this.emit("content-update")}else this._showStatus(x.NLS_noInfo)},_handleComponentsError:function(e){e&&"cancel"===e.dojoType||(console.log("PopupRenderer: error loading template",
e),this._showStatus(x.NLS_noInfo))}});u("extend-esri")&&D.setObject("dijit._PopupRenderer",I,g);return I})},"esri/libs/sanitizer/Sanitizer":function(){!function(M,I){"object"==typeof exports&&"undefined"!=typeof module?module.exports=I():"function"==typeof define&&define.amd?define(I):(M="undefined"!=typeof globalThis?globalThis:M||self).Sanitizer=I()}(this,function(){function M(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,
animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,
"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,
"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,
"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,
"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,
"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,
"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,
"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,
"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,
rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,
"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,
"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}}function I(U){var X=U||{},Z={},ea;for(ea in X)Z[ea]=X[ea];(U=Z).whiteList=U.whiteList||H.whiteList;U.onAttr=U.onAttr||H.onAttr;U.onIgnoreAttr=
U.onIgnoreAttr||H.onIgnoreAttr;U.safeAttrValue=U.safeAttrValue||H.safeAttrValue;this.options=U}function F(U){return U.replace(T,"\x26lt;").replace(R,"\x26gt;")}function D(U){return U.replace(Q,"\x26quot;")}function v(U){return U.replace(W,'"')}function m(U){return U.replace(ba,function(X,Z){return"x"===Z[0]||"X"===Z[0]?String.fromCharCode(parseInt(Z.substr(1),16)):String.fromCharCode(parseInt(Z,10))})}function u(U){return U.replace(da,":").replace(fa," ")}function r(U){for(var X="",Z=0,ea=U.length;Z<
ea;Z++)X+=32>U.charCodeAt(Z)?" ":U.charAt(Z);return L.trim(X)}function w(U){return U=r(U=u(U=m(U=v(U))))}function f(U){return U=F(U=D(U))}function c(U,X){for(;X<U.length;X++){var Z=U[X];if(" "!==Z)return"\x3d"===Z?X:-1}}function n(U,X){for(;0<X;X--){var Z=U[X];if(" "!==Z)return"\x3d"===Z?X:-1}}function q(U){return'"'===U[0]&&'"'===U[U.length-1]||"'"===U[0]&&"'"===U[U.length-1]?U.substr(1,U.length-2):U}function d(U){var X=U||{},Z={},ea;for(ea in X)Z[ea]=X[ea];(U=Z).stripIgnoreTag&&(U.onIgnoreTag&&
console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),U.onIgnoreTag=Ea.onIgnoreTagStripAll);U.whiteList=U.whiteList||Ea.whiteList;U.onTag=U.onTag||Ea.onTag;U.onTagAttr=U.onTagAttr||Ea.onTagAttr;U.onIgnoreTag=U.onIgnoreTag||Ea.onIgnoreTag;U.onIgnoreTagAttr=U.onIgnoreTagAttr||Ea.onIgnoreTagAttr;U.safeAttrValue=U.safeAttrValue||Ea.safeAttrValue;U.escapeHtml=U.escapeHtml||Ea.escapeHtml;this.options=U;!1===U.css?this.cssFilter=!1:(U.css=U.css||{},this.cssFilter=
new Fa(U.css))}var a,b,k=Object.prototype,g=Function.prototype.toString,p=k.hasOwnProperty,B=g.call(Object),J=k.toString,A=(a=Object.getPrototypeOf,b=Object,function(U){return a(b(U))}),h=function(U){var X;if(!(X=!U||"object"!=typeof U||"[object Object]"!=J.call(U))&&(X=!1,null!=U&&"function"!=typeof U.toString))try{X=!!(U+"")}catch(Z){}if(X)return!1;U=A(U);if(null===U)return!0;U=p.call(U,"constructor")&&U.constructor;return"function"==typeof U&&U instanceof U&&g.call(U)==B},x={exports:{}},z={};k=
{exports:{}};var e={},t=/javascript\s*:/gim;e.whiteList=M();e.getDefaultWhiteList=M;e.onAttr=function(U,X,Z){};e.onIgnoreAttr=function(U,X,Z){};e.safeAttrValue=function(U,X){return t.test(X)?"":X};var y={indexOf:function(U,X){var Z;if(Array.prototype.indexOf)return U.indexOf(X);var ea=0;for(Z=U.length;ea<Z;ea++)if(U[ea]===X)return ea;return-1},forEach:function(U,X,Z){var ea;if(Array.prototype.forEach)return U.forEach(X,Z);var ha=0;for(ea=U.length;ha<ea;ha++)X.call(Z,U[ha],ha,U)},trim:function(U){return String.prototype.trim?
U.trim():U.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(U){return String.prototype.trimRight?U.trimRight():U.replace(/(\s*$)/g,"")}},H=e,E=function(U,X){function Z(){if(!ha){var va=y.trim(U.slice(pa,ra)),za=va.indexOf(":");if(-1!==za){var Aa=y.trim(va.slice(0,za));za=y.trim(va.slice(za+1));Aa&&(va=X(pa,na.length,Aa,za,va))&&(na+=va+"; ")}}pa=ra+1}";"!==(U=y.trimRight(U))[U.length-1]&&(U+=";");for(var ea=U.length,ha=!1,pa=0,ra=0,na="";ra<ea;ra++){var sa=U[ra];if("/"===sa&&"*"===U[ra+1]){sa=U.indexOf("*/",
ra+2);if(-1===sa)break;pa=(ra=sa+1)+1;ha=!1}else"("===sa?ha=!0:")"===sa?ha=!1:";"===sa?ha||Z():"\n"===sa&&Z()}return y.trim(na)};I.prototype.process=function(U){if(!(U=(U=U||"").toString()))return"";var X=this.options,Z=X.whiteList,ea=X.onAttr,ha=X.onIgnoreAttr,pa=X.safeAttrValue;return E(U,function(ra,na,sa,va,za){var Aa=Z[sa],ia=!1;if(!0===Aa?ia=Aa:"function"==typeof Aa?ia=Aa(va):Aa instanceof RegExp&&(ia=Aa.test(va)),!0!==ia&&(ia=!1),va=pa(sa,va)){var l;ra={position:na,sourcePosition:ra,source:za,
isWhite:ia};return ia?null==(l=ea(sa,va,ra))?sa+":"+va:l:null==(l=ha(sa,va,ra))?void 0:l}})};!function(U,X){for(var Z in(X=U.exports=function(ea,ha){return(new I(ha)).process(ea)}).FilterCSS=I,e)X[Z]=e[Z]}(k,k.exports);var G={indexOf:function(U,X){var Z;if(Array.prototype.indexOf)return U.indexOf(X);var ea=0;for(Z=U.length;ea<Z;ea++)if(U[ea]===X)return ea;return-1},forEach:function(U,X,Z){var ea;if(Array.prototype.forEach)return U.forEach(X,Z);var ha=0;for(ea=U.length;ha<ea;ha++)X.call(Z,U[ha],ha,
U)},trim:function(U){return String.prototype.trim?U.trim():U.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(U){return(U=/\s|\n|\t/.exec(U))?U.index:-1}},O=k.exports.getDefaultWhiteList,L=G,N=new k.exports.FilterCSS,T=/</g,R=/>/g,Q=/"/g,W=/&quot;/g,ba=/&#([a-zA-Z0-9]*);?/gim,da=/&colon;?/gim,fa=/&newline;?/gim,la=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,oa=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,ua=/u\s*r\s*l\s*\(.*/gi,Ca=/\x3c!--[\s\S]*?--\x3e/g;
z.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:"autoplay controls crossorigin loop muted preload src".split(" "),b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],
h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:"autoplay controls crossorigin loop muted playsinline poster preload src height width".split(" ")};
z.getDefaultWhiteList=function(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:"autoplay controls crossorigin loop muted preload src".split(" "),b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color",
"size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],
tt:[],u:[],ul:[],video:"autoplay controls crossorigin loop muted playsinline poster preload src height width".split(" ")}};z.onTag=function(U,X,Z){};z.onIgnoreTag=function(U,X,Z){};z.onTagAttr=function(U,X,Z){};z.onIgnoreTagAttr=function(U,X,Z){};z.safeAttrValue=function(U,X,Z,ea){if(Z=w(Z),"href"===X||"src"===X){if("#"===(Z=L.trim(Z)))return"#";if("http://"!==Z.substr(0,7)&&"https://"!==Z.substr(0,8)&&"mailto:"!==Z.substr(0,7)&&"tel:"!==Z.substr(0,4)&&"data:image/"!==Z.substr(0,11)&&"ftp://"!==Z.substr(0,
6)&&"./"!==Z.substr(0,2)&&"../"!==Z.substr(0,3)&&"#"!==Z[0]&&"/"!==Z[0])return""}else if("background"===X){if(la.lastIndex=0,la.test(Z))return""}else if("style"===X){if((oa.lastIndex=0,oa.test(Z))||(ua.lastIndex=0,ua.test(Z)&&(la.lastIndex=0,la.test(Z))))return"";!1!==ea&&(Z=(ea=ea||N).process(Z))}return Z=f(Z)};z.escapeHtml=F;z.escapeQuote=D;z.unescapeQuote=v;z.escapeHtmlEntities=m;z.escapeDangerHtml5Entities=u;z.clearNonPrintableCharacter=r;z.friendlyAttrValue=w;z.escapeAttrValue=f;z.onIgnoreTagStripAll=
function(){return""};z.StripTagBody=function(U,X){"function"!=typeof X&&(X=function(){});var Z=!Array.isArray(U),ea=[],ha=!1;return{onIgnoreTag:function(pa,ra,na){return Z||-1!==L.indexOf(U,pa)?na.isClosing?(ea.push([!1!==ha?ha:na.position,na.position+10]),ha=!1,"[/removed]"):(ha||(ha=na.position),"[removed]"):X(pa,ra,na)},remove:function(pa){var ra="",na=0;return L.forEach(ea,function(sa){ra+=pa.slice(na,sa[0]);na=sa[1]}),ra+=pa.slice(na)}}};z.stripCommentTag=function(U){return U.replace(Ca,"")};
z.stripBlankChar=function(U){U=U.split("");return(U=U.filter(function(X){X=X.charCodeAt(0);return 127!==X&&(!(31>=X)||10===X||13===X)})).join("")};z.cssFilter=N;z.getDefaultCSSWhiteList=O;var wa={},Ja=/[^a-zA-Z0-9_:\.\-]/gim;wa.parseTag=function(U,X,Z){var ea="",ha=0,pa=!1,ra=!1,na=0,sa=U.length,va="",za="";na=0;a:for(;na<sa;na++)if(za=U.charAt(na),!1===pa)"\x3c"===za&&(pa=na);else if(!1===ra)if("\x3c"===za)ea+=Z(U.slice(ha,na)),ha=pa=na;else if("\x3e"===za)ea+=Z(U.slice(ha,pa)),ha=za=U.slice(pa,
na+1),va=G.spaceIndex(ha),ha=-1===va?ha.slice(1,-1):ha.slice(1,va+1),va=("/"===(ha=G.trim(ha).toLowerCase()).slice(0,1)&&(ha=ha.slice(1)),"/"===ha.slice(-1)&&(ha=ha.slice(0,-1)),ha),ea+=X(pa,ea.length,va,za,"\x3c/"===za.slice(0,2)),ha=na+1,pa=!1;else{if('"'===za||"'"===za){va=1;for(var Aa=U.charAt(na-va);""===Aa.trim()||"\x3d"===Aa;){if("\x3d"===Aa){ra=za;continue a}Aa=U.charAt(na-++va)}}}else za===ra&&(ra=!1);return ha<U.length&&(ea+=Z(U.substr(ha))),ea};wa.parseAttr=function(U,X){function Z(va,
za){1>(va=(va=G.trim(va)).replace(Ja,"").toLowerCase()).length||(va=X(va,za||""))&&ha.push(va)}for(var ea=0,ha=[],pa=!1,ra=U.length,na=0;na<ra;na++){var sa=U.charAt(na);if(!1!==pa||"\x3d"!==sa)if(!1===pa||na!==ea||'"'!==sa&&"'"!==sa||"\x3d"!==U.charAt(na-1))/\s|\n|\t/.test(sa)&&((U=U.replace(/\s|\n|\t/g," "),!1===pa)?-1===(sa=c(U,na))?(Z(G.trim(U.slice(ea,na))),pa=!1,ea=na+1):na=sa-1:-1===(sa=n(U,na-1))&&(Z(pa,q(G.trim(U.slice(ea,na)))),pa=!1,ea=na+1));else{if(-1===(sa=U.indexOf(sa,na+1)))break;Z(pa,
G.trim(U.slice(ea+1,sa)));pa=!1;ea=(na=sa)+1}else pa=U.slice(ea,na),ea=na+1}return ea<U.length&&(!1===pa?Z(U.slice(ea)):Z(pa,q(G.trim(U.slice(ea))))),G.trim(ha.join(" "))};var Fa=k.exports.FilterCSS,Ea=z,Ia=wa.parseTag,Ma=wa.parseAttr;d.prototype.process=function(U){if(!(U=(U=U||"").toString()))return"";var X=this.options,Z=X.whiteList,ea=X.onTag,ha=X.onIgnoreTag,pa=X.onTagAttr,ra=X.onIgnoreTagAttr,na=X.safeAttrValue,sa=X.escapeHtml,va=this.cssFilter;X.stripBlankChar&&(U=Ea.stripBlankChar(U));X.allowCommentTag||
(U=Ea.stripCommentTag(U));var za=!1;X.stripIgnoreTagBody&&(za=Ea.StripTagBody(X.stripIgnoreTagBody,ha),ha=za.onIgnoreTag);U=Ia(U,function(Aa,ia,l,C,K){ia={sourcePosition:Aa,position:ia,isClosing:K,isWhite:Z.hasOwnProperty(l)};if(null!=(Aa=ea(l,C,ia)))return Aa;if(ia.isWhite){if(ia.isClosing)return"\x3c/"+l+"\x3e";Aa=function(S){var V=G.spaceIndex(S);if(-1===V)return{html:"",closing:"/"===S[S.length-2]};V="/"===(S=G.trim(S.slice(V+1,-1)))[S.length-1];return V&&(S=G.trim(S.slice(0,-1))),{html:S,closing:V}}(C);
var P=Z[l];ia=Ma(Aa.html,function(S,V){var Y,aa=-1!==G.indexOf(P,S);return null==(Y=pa(l,S,V,aa))?aa?(V=na(l,S,V,va))?S+'\x3d"'+V+'"':S:null==(Y=ra(l,S,V,aa))?void 0:Y:Y});C="\x3c"+l;return ia&&(C+=" "+ia),Aa.closing&&(C+=" /"),C+="\x3e"}return null==(Aa=ha(l,C,ia))?sa(C):Aa},sa);return za&&(U=za.remove(U)),U};return function(U,X){function Z(pa,ra){return(new ea(ra)).process(pa)}var ea=d,ha;for(ha in(X=U.exports=Z).filterXSS=Z,X.FilterXSS=ea,z)X[ha]=z[ha];for(ha in wa)X[ha]=wa[ha];"undefined"!=typeof self&&
"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=U.exports)}(x,x.exports),function(){function U(X,Z){var ea,ha=this;this.arcgisWhiteList={a:["href","target","style"],abbr:["title"],img:"src width height border alt style".split(" "),video:"autoplay controls height loop muted poster preload width".split(" "),audio:["autoplay","controls","loop","muted","preload"],source:["media","src","type"],span:["style"],table:"width height cellpadding cellspacing border style".split(" "),
div:["style","align"],font:["size","color","style","face"],tr:["height","valign","align","style"],td:"height width valign align colspan rowspan nowrap style".split(" "),th:"height width valign align colspan rowspan nowrap style".split(" "),p:["style"],b:[],strong:[],i:[],em:[],u:[],br:[],li:[],ul:[],ol:[],hr:[],tbody:[]};this.allowedProtocols="http https mailto iform tel flow lfmobile arcgis-navigator arcgis-appstudio-player arcgis-survey123 arcgis-collector arcgis-workforce arcgis-explorer arcgis-trek2there mspbi comgooglemaps pdfefile pdfehttp pdfehttps boxapp boxemm awb awbs gropen radarscope".split(" ");
this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(pa,ra,na,sa){return"a"===pa&&"href"===ra||("img"===pa||"source"===pa)&&"src"===ra?ha.sanitizeUrl(na):x.exports.safeAttrValue(pa,ra,na,sa)}};X&&!Z?ea=X:X&&Z?(ea=Object.create(this.arcgisFilterOptions),Object.keys(X).forEach(function(pa){"whiteList"===pa?ea.whiteList=ha._extendObjectOfArrays([ha.arcgisWhiteList,X.whiteList||{}]):ea[pa]=X[pa]})):(ea=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList;this.xssFilterOptions=
ea;this._xssFilter=new x.exports.FilterXSS(ea)}return U.prototype.sanitize=function(X,Z){switch(void 0===Z&&(Z={}),typeof X){case "number":return isNaN(X)||!isFinite(X)?null:X;case "boolean":return X;case "string":return this._xssFilter.process(X);case "object":return this._iterateOverObject(X,Z);default:if(!Z.allowUndefined||void 0!==X)return null}},U.prototype.sanitizeUrl=function(X){var Z=this._trim(X.substring(0,X.indexOf(":")));return"/"===X||"#"===X||"#"===X[0]||-1<this.allowedProtocols.indexOf(Z.toLowerCase())?
x.exports.escapeAttrValue(X):""},U.prototype.sanitizeHTMLAttribute=function(X,Z,ea,ha){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(X,Z,ea,ha):x.exports.safeAttrValue(X,Z,ea,ha)},U.prototype.validate=function(X,Z){void 0===Z&&(Z={});Z=this.sanitize(X,Z);return{isValid:X===Z,sanitized:Z}},U.prototype._extendObjectOfArrays=function(X){var Z={};return X.forEach(function(ea){Object.keys(ea).forEach(function(ha){Array.isArray(ea[ha])&&Array.isArray(Z[ha])?
Z[ha]=Z[ha].concat(ea[ha]):Z[ha]=ea[ha]})}),Z},U.prototype._iterateOverObject=function(X,Z){var ea=this;void 0===Z&&(Z={});try{var ha=!1,pa=void 0;if(Array.isArray(X))pa=X.reduce(function(ra,na){var sa=ea.validate(na,Z);return sa.isValid?ra.concat([na]):(ha=!0,ra.concat([sa.sanitized]))},[]);else{if(!h(X))return Z.allowUndefined&&void 0===X?void 0:null;pa=Object.keys(X).reduce(function(ra,na){var sa=X[na],va=ea.validate(sa,Z);return va.isValid?ra[na]=sa:(ha=!0,ra[na]=va.sanitized),ra},{})}return ha?
pa:X}catch(ra){return null}},U.prototype._trim=function(X){return String.prototype.trim?X.trim():X.replace(/(^\s*)|(\s*$)/g,"")},U}()})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n,q){function d(){}function a(b){return function(k,g,p,B){return k&&"string"==
typeof g&&k[g]==d?k.on(g.substring(2).toLowerCase(),u.hitch(p,B)):b.apply(F,arguments)}}M.around(F,"connect",a);m.connect&&M.around(m,"connect",a);M=D("dijit._Widget",[c,n,q],{onClick:d,onDblClick:d,onKeyDown:d,onKeyPress:d,onKeyUp:d,onMouseDown:d,onMouseMove:d,onMouseOut:d,onMouseOver:d,onMouseLeave:d,onMouseEnter:d,onMouseUp:d,constructor:function(b){this._toConnect={};for(var k in b)this[k]===d&&(this._toConnect[k.replace(/^on/,"").toLowerCase()]=b[k],delete b[k])},postCreate:function(){this.inherited(arguments);
for(var b in this._toConnect)this.on(b,this._toConnect[b]);delete this._toConnect},on:function(b,k){return this[this._onMap(b)]===d?F.connect(this.domNode,b.toLowerCase(),this,k):this.inherited(arguments)},_setFocusedAttr:function(b){this._focused=b;this._set("focused",b)},setAttribute:function(b,k){m.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(b,k)},attr:function(b,k){return 2<=arguments.length||"object"===typeof b?this.set.apply(this,
arguments):this.get(b)},getDescendants:function(){m.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?r("[widgetId]",this.containerNode).map(f.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});v("dijit-legacy-requires")&&w(0,function(){require(["dijit/_base"])});return M})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a,b,k,g,p,B,J,A,h){function x(e){return function(t){r[t?"set":"remove"](this.domNode,e,t);this._set(e,t)}}q.add("dijit-legacy-requires",!d.isAsync);q.add("dojo-bidi",!1);q("dijit-legacy-requires")&&k(0,function(){M(["dijit/_base/manager"])});var z={};D=m("dijit._WidgetBase",[g,J],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:x("lang"),dir:"",_setDirAttr:x("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(e){this._set("ownerDocument",e)},attributeMap:{},_blankGif:D.blankGif||M.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var e=this.constructor;if(!e._setterAttrs){var t=e.prototype,y=e._setterAttrs=[];e=e._onMap={};for(var H in t.attributeMap)y.push(H);for(H in t)/^on/.test(H)&&(e[H.substring(2).toLowerCase()]=H),/^_set[A-Z](.*)Attr$/.test(H)&&(H=H.charAt(4).toLowerCase()+
H.substr(5,H.length-9),t.attributeMap&&H in t.attributeMap||y.push(H))}},postscript:function(e,t){this.create(e,t)},create:function(e,t){this._introspect();this.srcNodeRef=u.byId(t);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);e&&(this.params=e,a.mixin(this,e));this.postMixInProperties();this.id||(this.id=h.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=
this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=B.body(this.ownerDocument);h.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();if((e=this.srcNodeRef)&&e.parentNode&&this.domNode!==e){e.parentNode.replaceChild(this.domNode,e);var y=!0}this.domNode.setAttribute("widgetId",this.id)}this.postCreate();y&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var e={},t;for(t in this.params||{})e[t]=this._get(t);I.forEach(this.constructor._setterAttrs,
function(y){if(!(y in e)){var H=this._get(y);H&&this.set(y,H)}},this);for(t in e)this.set(t,e[t])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var e=this.baseClass.split(" ");this.isLeftToRight()||(e=e.concat(I.map(e,function(t){return t+"Rtl"})));w.add(this.domNode,e)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,I.forEach(this.getChildren(),function(e){e._started||
e._destroyed||!a.isFunction(e.startup)||(e.startup(),e._started=!0)}))},destroyRecursive:function(e){this._beingDestroyed=!0;this.destroyDescendants(e);this.destroy(e)},destroy:function(e){function t(y){y.destroyRecursive?y.destroyRecursive(e):y.destroy&&y.destroy(e)}this._beingDestroyed=!0;this.uninitialize();I.forEach(this._connects,a.hitch(this,"disconnect"));I.forEach(this._supportingWidgets,t);this.domNode&&I.forEach(h.findWidgets(this.domNode,this.containerNode),t);this.destroyRendering(e);
h.remove(this.id);this._destroyed=!0},destroyRendering:function(e){this.bgIframe&&(this.bgIframe.destroy(e),delete this.bgIframe);this.domNode&&(e?r.remove(this.domNode,"widgetId"):f.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(e||f.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(e){I.forEach(this.getChildren(),function(t){t.destroyRecursive&&t.destroyRecursive(e)})},uninitialize:function(){return!1},_setStyleAttr:function(e){var t=this.domNode;a.isObject(e)?
n.set(t,e):t.style.cssText=t.style.cssText?t.style.cssText+("; "+e):e;this._set("style",e)},_attrToDom:function(e,t,y){y=3<=arguments.length?y:this.attributeMap[e];I.forEach(a.isArray(y)?y:[y],function(H){var E=this[H.node||H||"domNode"];switch(H.type||"attribute"){case "attribute":a.isFunction(t)&&(t=a.hitch(this,t));H=H.attribute?H.attribute:/^on[A-Z][a-zA-Z]*$/.test(e)?e.toLowerCase():e;E.tagName?r.set(E,H,t):E.set(H,t);break;case "innerText":E.innerHTML="";E.appendChild(this.ownerDocument.createTextNode(t));
break;case "textContent":E.textContent=t;break;case "innerHTML":E.innerHTML=t;break;case "class":w.replace(E,t,this[e]);break;case "toggleClass":w.toggle(E,H.className||e,t)}},this)},get:function(e){var t=this._getAttrNames(e);return this[t.g]?this[t.g]():this._get(e)},set:function(e,t){if("object"===typeof e){for(var y in e)this.set(y,e[y]);return this}y=this._getAttrNames(e);var H=this[y.s];if(a.isFunction(H))var E=H.apply(this,Array.prototype.slice.call(arguments,1));else{H=this.focusNode&&!a.isFunction(this.focusNode)?
"focusNode":"domNode";var G=this[H]&&this[H].tagName,O;if((O=G)&&!(O=z[G])){O=this[H];var L={};for(N in O)L[N.toLowerCase()]=!0;O=z[G]=L}var N=O;y=e in this.attributeMap?this.attributeMap[e]:y.s in this?this[y.s]:N&&y.l in N&&"function"!=typeof t||/^aria-|^data-|^role$/.test(e)?H:null;null!=y&&this._attrToDom(e,t,y);this._set(e,t)}return E||this},_attrPairNames:{},_getAttrNames:function(e){var t=this._attrPairNames;if(t[e])return t[e];var y=e.replace(/^[a-z]|-[a-zA-Z]/g,function(H){return H.charAt(H.length-
1).toUpperCase()});return t[e]={n:e+"Node",s:"_set"+y+"Attr",g:"_get"+y+"Attr",l:y.toLowerCase()}},_set:function(e,t){var y=this[e];this[e]=t;!this._created||y===t||y!==y&&t!==t||(this._watchCallbacks&&this._watchCallbacks(e,y,t),this.emit("attrmodified-"+e,{detail:{prevValue:y,newValue:t}}))},_get:function(e){return this[e]},emit:function(e,t,y){t=t||{};void 0===t.bubbles&&(t.bubbles=!0);void 0===t.cancelable&&(t.cancelable=!0);t.detail||(t.detail={});t.detail.widget=this;var H,E=this["on"+e];E&&
(H=E.apply(this,y?y:[t]));this._started&&!this._beingDestroyed&&b.emit(this.domNode,e.toLowerCase(),t);return H},on:function(e,t){var y=this._onMap(e);return y?F.after(this,y,t,!0):this.own(b(this.domNode,e,t))[0]},_onMap:function(e){var t=this.constructor,y=t._onMap;if(!y){y=t._onMap={};for(var H in t.prototype)/^on/.test(H)&&(y[H.replace(/^on/,"").toLowerCase()]=H)}return y["string"==typeof e&&e.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},
getChildren:function(){return this.containerNode?h.findWidgets(this.containerNode):[]},getParent:function(){return h.getEnclosingWidget(this.domNode.parentNode)},connect:function(e,t,y){return this.own(v.connect(e,t,this,y))[0]},disconnect:function(e){e.remove()},subscribe:function(e,t){return this.own(p.subscribe(e,a.hitch(this,t)))[0]},unsubscribe:function(e){e.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():c.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&
"none"!=n.get(this.domNode,"display")},placeAt:function(e,t){var y=!e.tagName&&h.byId(e);!y||!y.addChild||t&&"number"!==typeof t?(e=y&&"domNode"in y?y.containerNode&&!/after|before|replace/.test(t||"")?y.containerNode:y.domNode:u.byId(e,this.ownerDocument),f.place(this.domNode,e,t),!this._started&&(this.getParent()||{})._started&&this.startup()):y.addChild(this,t);return this},defer:function(e,t){var y=setTimeout(a.hitch(this,function(){y&&(y=null,this._destroyed||a.hitch(this,e)())}),t||0);return{remove:function(){y&&
(clearTimeout(y),y=null);return null}}}});q("dojo-bidi")&&D.extend(A);return D})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(M,I,F){return F("dijit.Destroyable",null,{destroy:function(D){this._destroyed=!0},own:function(){var D=["destroyRecursive","destroy","remove"];M.forEach(arguments,function(v){function m(){u.remove();M.forEach(r,function(f){f.remove()})}var u=I.before(this,"destroy",function(f){v[w](f)}),r=[];if(v.then){var w="cancel";
v.then(m,m)}else M.forEach(D,function(f){"function"===typeof v[f]&&(w||(w=f),r.push(I.after(v,f,m,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(M,I,F,D,v,m){M=D("dijit._OnDijitClickMixin",null,{connect:function(u,r,w){return this.inherited(arguments,[u,"ondijitclick"==r?m:r,w])}});M.a11yclick=m;return M})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase",
"dojo/_base/declare","dojo/_base/lang"],function(M,I,F,D){D.extend(I,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return F("dijit._FocusMixin",null,{_focusManager:M})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(M,I,F,D){F(function(){I("highcontrast")&&M.add(D.body(),"dijit_a11y")});return I})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(M,I,F,D,v,m,u){v.add("highcontrast",function(){var r=u.doc.createElement("div");try{r.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(I.blankGif||M.toUrl("./resources/blank.gif"))+'");';u.body().appendChild(r);var w=D.getComputedStyle(r),f=w.backgroundImage;return w.borderTopColor==w.borderRightColor||f&&("none"==f||"url(invalid-url:)"==f)}catch(c){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
c.toString()),!1}finally{8>=v("ie")?r.outerHTML="":u.body().removeChild(r)}});m(function(){v("highcontrast")&&F.add(u.body(),"dj_a11y")});return v})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(M,I,F,D,v,m,u){m.extend(M,{waiRole:"",waiState:""});return v("dijit._Templated",[I,F],{constructor:function(){u.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(r,w){var f=this.inherited(arguments),c=w(r,"waiRole");c&&r.setAttribute("role",c);(c=w(r,"waiState"))&&D.forEach(c.split(/\s*,\s*/),function(n){-1!=n.indexOf("-")&&(n=n.split("-"),r.setAttribute("aria-"+n[0],n[1]))});return f}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(M,I,F,D,v,m,u,r){var w=I("dijit._TemplatedMixin",r,{templateString:null,
templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(f){var c=this.declaredClass,n=this;return u.substitute(f,this,function(q,d){"!"==d.charAt(0)&&(q=D.getObject(d.substr(1),!1,n));if("undefined"==typeof q)throw Error(c+" template:"+d);return null==q?"":"!"==d.charAt(0)?q:this._escapeValue(""+q)},this)},_escapeValue:function(f){return f.replace(/["'<>&]/g,function(c){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[c]})},buildRendering:function(){if(!this._rendered){this.templateString||
(this.templateString=M(this.templatePath,{sanitize:!0}));var f=w.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument);if(D.isString(f)){var c=F.toDom(this._stringRepl(f),this.ownerDocument);if(1!=c.nodeType)throw Error("Invalid template: "+f);}else c=f.cloneNode(!0);this.domNode=c}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(f){var c=this.containerNode;if(f&&c)for(;f.hasChildNodes();)c.appendChild(f.firstChild)}});
w._templateCache={};w.getCachedTemplate=function(f,c,n){var q=w._templateCache,d=f,a=q[d];if(a){try{if(!a.ownerDocument||a.ownerDocument==(n||document))return a}catch(b){}F.destroy(a)}f=u.trim(f);if(c||f.match(/\$\{([^\}]+)\}/g))return q[d]=f;c=F.toDom(f,n);if(1!=c.nodeType)throw Error("Invalid template: "+f);return q[d]=c};m("ie")&&v(window,"unload",function(){var f=w._templateCache,c;for(c in f){var n=f[c];"object"==typeof n&&F.destroy(n);delete f[c]}});return w})},"dojo/cache":function(){define(["./_base/kernel",
"./text"],function(M){return M.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(M,I,F,D,v,m,u,r,w){var f=v.delegate(r,{mouseenter:m.enter,mouseleave:m.leave,keypress:F._keypress}),c;F=D("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);
this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(n){for(var q=n;;)if(1==q.nodeType&&(this._processTemplateNode(q,function(d,a){return d.getAttribute(a)},this._attach)||this.searchContainerNode)&&q.firstChild)q=q.firstChild;else{if(q==n)break;for(;!q.nextSibling;)if(q=q.parentNode,q==n)return;q=q.nextSibling}},_processTemplateNode:function(n,q,d){var a=!0,b=this.attachScope||this,k=q(n,"dojoAttachPoint")||q(n,"data-dojo-attach-point");if(k)for(var g=k.split(/\s*,\s*/);k=
g.shift();)v.isArray(b[k])?b[k].push(n):b[k]=n,a="containerNode"!=k,this._attachPoints.push(k);if(q=q(n,"dojoAttachEvent")||q(n,"data-dojo-attach-event"))for(k=q.split(/\s*,\s*/),g=v.trim;q=k.shift();)if(q){var p=null;-1!=q.indexOf(":")?(p=q.split(":"),q=g(p[0]),p=g(p[1])):q=g(q);p||(p=q);this._attachEvents.push(d(n,q,v.hitch(b,p)))}return a},_attach:function(n,q,d){q=q.replace(/^on/,"").toLowerCase();q="dijitclick"==q?c||(c=M("./a11yclick")):f[q]||q;return u(n,q,d)},_detachTemplateNodes:function(){var n=
this.attachScope||this;I.forEach(this._attachPoints,function(q){delete n[q]});this._attachPoints=[];I.forEach(this._attachEvents,function(q){q.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});v.extend(w,{dojoAttachEvent:"",dojoAttachPoint:""});return F})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(M,I,F,D,v){return F("dijit._WidgetsInTemplateMixin",
null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var m=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);v.parse(m,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(D.hitch(this,function(u){this._startupWidgets=u;for(var r=0;r<u.length;r++)this._processTemplateNode(u[r],
function(w,f){return w[f]},function(w,f,c){return f in w?w.connect(w,f,c):w.on(f,c,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(m,u,r){return u(m,"dojoType")||u(m,"data-dojo-type")?
!0:this.inherited(arguments)},startup:function(){M.forEach(this._startupWidgets,function(m){m&&!m._started&&m.startup&&m.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a,b){function k(A){return eval("("+A+")")}function g(A){var h=
A._nameCaseMap,x=A.prototype;if(!h||h._extendCnt<B){h=A._nameCaseMap={};for(var z in x)"_"!==z.charAt(0)&&(h[z.toLowerCase()]=z);h._extendCnt=B}return h}function p(A,h){h||(h=M);var x=h._dojoParserCtorMap||(h._dojoParserCtorMap={}),z=A.join();if(!x[z]){for(var e=[],t=0,y=A.length;t<y;t++){var H=A[t];e[e.length]=x[H]=x[H]||F.getObject(H)||~H.indexOf("/")&&h(H)}A=e.shift();x[z]=e.length?A.createSubclass?A.createSubclass(e):A.extend.apply(A,e):A}return x[z]}new Date("X");var B=0;w.after(F,"extend",function(){B++},
!0);var J={_clearCache:function(){B++;_ctorMap={}},_functionFromScript:function(A,h){var x="",z="",e=A.getAttribute(h+"args")||A.getAttribute("args");h=A.getAttribute("with");e=(e||"").split(/\s*,\s*/);h&&h.length&&D.forEach(h.split(/\s*,\s*/),function(t){x+="with("+t+"){";z+="}"});return new Function(e,x+A.innerHTML+z)},instantiate:function(A,h,x){h=h||{};x=x||{};var z=(x.scope||I._scopeName)+"Type",e="data-"+(x.scope||I._scopeName)+"-",t=e+"type",y=e+"mixins",H=[];D.forEach(A,function(E){var G=
z in h?h[z]:E.getAttribute(t)||E.getAttribute(z);if(G){var O=E.getAttribute(y);G=O?[G].concat(O.split(/\s*,\s*/)):[G];H.push({node:E,types:G})}});return this._instantiate(H,h,x)},_instantiate:function(A,h,x,z){function e(t){h._started||x.noStart||D.forEach(t,function(y){"function"!==typeof y.startup||y._started||y.startup()});return t}A=D.map(A,function(t){var y=t.ctor||p(t.types,x.contextRequire);if(!y)throw Error("Unable to resolve constructor for: '"+t.types.join()+"'");return this.construct(y,
t.node,h,x,t.scripts,t.inherited)},this);return z?f(A).then(e):e(A)},construct:function(A,h,x,z,e,t){function y(ua){R&&F.setObject(R,ua);for(N=0;N<da.length;N++)w[da[N].advice||"after"](ua,da[N].method,F.hitch(ua,da[N].func),!0);for(N=0;N<fa.length;N++)fa[N].call(ua);for(N=0;N<la.length;N++)ua.watch(la[N].prop,la[N].func);for(N=0;N<oa.length;N++)a(ua,oa[N].event,oa[N].func);return ua}var H=A&&A.prototype;z=z||{};var E={};z.defaults&&F.mixin(E,z.defaults);t&&F.mixin(E,t);if(q("dom-attributes-explicit"))var G=
h.attributes;else q("dom-attributes-specified-flag")?G=D.filter(h.attributes,function(ua){return ua.specified}):(t=(/^input$|^img$/i.test(h.nodeName)?h:h.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),G=D.map(t.split(/\s+/),function(ua){var Ca=ua.toLowerCase();return{name:ua,value:"LI"==h.nodeName&&"value"==ua||"enctype"==Ca?h.getAttribute(Ca):h.getAttributeNode(Ca).value}}));var O=z.scope||I._scopeName;t="data-"+O+"-";
var L={};"dojo"!==O&&(L[t+"props"]="data-dojo-props",L[t+"type"]="data-dojo-type",L[t+"mixins"]="data-dojo-mixins",L[O+"type"]="dojotype",L[t+"id"]="data-dojo-id");var N=0,T;O=[];for(var R,Q;T=G[N++];){var W=T.name,ba=W.toLowerCase();T=T.value;switch(L[ba]||ba){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":Q=T;break;case "data-dojo-id":case "jsid":R=T;break;case "data-dojo-attach-point":case "dojoattachpoint":E.dojoAttachPoint=T;break;case "data-dojo-attach-event":case "dojoattachevent":E.dojoAttachEvent=
T;break;case "class":E["class"]=h.className;break;case "style":E.style=h.style&&h.style.cssText;break;default:if(W in H||(W=g(A)[ba]||W),W in H)switch(typeof H[W]){case "string":E[W]=T;break;case "number":E[W]=T.length?Number(T):NaN;break;case "boolean":E[W]="false"!=T.toLowerCase();break;case "function":""===T||-1!=T.search(/[^\w\.]+/i)?E[W]=new Function(T):E[W]=F.getObject(T,!1)||new Function(T);O.push(W);break;default:ba=H[W],E[W]=ba&&"length"in ba?T?T.split(/\s*,\s*/):[]:ba instanceof Date?""==
T?new Date(""):"now"==T?new Date:c.fromISOString(T):ba instanceof r?I.baseUrl+T:k(T)}else E[W]=T}}for(G=0;G<O.length;G++)L=O[G].toLowerCase(),h.removeAttribute(L),h[L]=null;if(Q)try{Q=k.call(z.propsThis,"{"+Q+"}"),F.mixin(E,Q)}catch(ua){throw Error(ua.toString()+" in data-dojo-props\x3d'"+Q+"'");}F.mixin(E,x);e||(e=A&&(A._noScript||H._noScript)?[]:d("\x3e script[type^\x3d'dojo/']",h));var da=[],fa=[],la=[],oa=[];if(e)for(N=0;N<e.length;N++)L=e[N],h.removeChild(L),x=L.getAttribute(t+"event")||L.getAttribute("event"),
z=L.getAttribute(t+"prop"),Q=L.getAttribute(t+"method"),O=L.getAttribute(t+"advice"),G=L.getAttribute("type"),L=this._functionFromScript(L,t),x?"dojo/connect"==G?da.push({method:x,func:L}):"dojo/on"==G?oa.push({event:x,func:L}):E[x]=L:"dojo/aspect"==G?da.push({method:Q,advice:O,func:L}):"dojo/watch"==G?la.push({prop:z,func:L}):fa.push(L);A=(e=A.markupFactory||H.markupFactory)?e(E,h,A):new A(E,h);return A.then?A.then(y):y(A)},scan:function(A,h){function x(ba){if(!ba.inherited){ba.inherited={};var da=
ba.node,fa=x(ba.parent);da={dir:da.getAttribute("dir")||fa.dir,lang:da.getAttribute("lang")||fa.lang,textDir:da.getAttribute(G)||fa.textDir};for(var la in da)da[la]&&(ba.inherited[la]=da[la])}return ba.inherited}var z=[],e=[],t={},y=(h.scope||I._scopeName)+"Type",H="data-"+(h.scope||I._scopeName)+"-",E=H+"type",G=H+"textdir";H+="mixins";var O=A.firstChild,L=h.inherited;if(!L){L=function la(da,fa){return da.getAttribute&&da.getAttribute(fa)||da.parentNode&&la(da.parentNode,fa)};L={dir:L(A,"dir"),lang:L(A,
"lang"),textDir:L(A,G)};for(var N in L)L[N]||delete L[N]}N={inherited:L};for(var T,R;;)if(O)if(1!=O.nodeType)O=O.nextSibling;else if(T&&"script"==O.nodeName.toLowerCase())(L=O.getAttribute("type"))&&/^dojo\/\w/i.test(L)&&T.push(O),O=O.nextSibling;else if(R)O=O.nextSibling;else if(L=O.getAttribute(E)||O.getAttribute(y),A=O.firstChild,L||A&&(3!=A.nodeType||A.nextSibling)){R=null;if(L){var Q=O.getAttribute(H);T=Q?[L].concat(Q.split(/\s*,\s*/)):[L];try{R=p(T,h.contextRequire)}catch(ba){}R||D.forEach(T,
function(ba){~ba.indexOf("/")&&!t[ba]&&(t[ba]=!0,e[e.length]=ba)});Q=R&&!R.prototype._noScript?[]:null;N={types:T,ctor:R,parent:N,node:O,scripts:Q};N.inherited=x(N);z.push(N)}else N={node:O,scripts:T,parent:N};T=Q;R=O.stopParser||R&&R.prototype.stopParser&&!h.template;O=A}else O=O.nextSibling;else{if(!N||!N.node)break;O=N.node.nextSibling;R=!1;N=N.parent;T=N.scripts}var W=new n;e.length?(q("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+e.join(", ")),(h.contextRequire||
M)(e,function(){W.resolve(D.filter(z,function(ba){if(!ba.ctor)try{ba.ctor=p(ba.types,h.contextRequire)}catch(la){}for(var da=ba.parent;da&&!da.types;)da=da.parent;var fa=ba.ctor&&ba.ctor.prototype;ba.instantiateChildren=!(fa&&fa.stopParser&&!h.template);ba.instantiate=!da||da.instantiate&&da.instantiateChildren;return ba.instantiate}))})):W.resolve(z);return W.promise},_require:function(A,h){A=k("{"+A.innerHTML+"}");var x=[],z=[],e=new n;h=h&&h.contextRequire||M;for(var t in A)x.push(t),z.push(A[t]);
h(z,function(){for(var y=0;y<x.length;y++)F.setObject(x[y],arguments[y]);e.resolve(arguments)});return e.promise},_scanAmd:function(A,h){var x=new n,z=x.promise;x.resolve(!0);var e=this;d("script[type\x3d'dojo/require']",A).forEach(function(t){z=z.then(function(){return e._require(t,h)});t.parentNode.removeChild(t)});return z},parse:function(A,h){!A||"string"==typeof A||"nodeType"in A||(h=A,A=h.rootNode);var x=A?m.byId(A):u.body();h=h||{};var z=h.template?{template:!0}:{},e=[],t=this;A=this._scanAmd(x,
h).then(function(){return t.scan(x,h)}).then(function(y){return t._instantiate(y,z,h,!0)}).then(function(y){return e=e.concat(y)}).otherwise(function(y){console.error("dojo/parser::parse() error",y);throw y;});F.mixin(e,A);return e}};I.parser=J;v.parseOnLoad&&b(100,J,"parse");return J})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(M,I){var F={};M.setObject("dojo.date.stamp",F);F.fromISOString=function(D,v){F._isoRegExp||(F._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);
var m=F._isoRegExp.exec(D);D=null;if(m){m.shift();m[1]&&m[1]--;m[6]&&(m[6]*=1E3);v&&(v=new Date(v),I.forEach(I.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(w){return v["get"+w]()}),function(w,f){m[f]=m[f]||w}));D=new Date(m[0]||1970,m[1]||0,m[2]||1,m[3]||0,m[4]||0,m[5]||0,m[6]||0);100>m[0]&&D.setFullYear(m[0]||1970);var u=0,r=m[7]&&m[7].charAt(0);"Z"!=r&&(u=60*(m[8]||0)+(Number(m[9])||0),"-"!=r&&(u*=-1));r&&(u-=D.getTimezoneOffset());u&&D.setTime(D.getTime()+6E4*
u)}return D};F.toISOString=function(D,v){var m=function(f){return 10>f?"0"+f:f};v=v||{};var u=[],r=v.zulu?"getUTC":"get",w="";"time"!=v.selector&&(w=D[r+"FullYear"](),w=["0000".substr((w+"").length)+w,m(D[r+"Month"]()+1),m(D[r+"Date"]())].join("-"));u.push(w);"date"!=v.selector&&(w=[m(D[r+"Hours"]()),m(D[r+"Minutes"]()),m(D[r+"Seconds"]())].join(":"),r=D[r+"Milliseconds"](),v.milliseconds&&(w+="."+(100>r?"0":"")+m(r)),v.zulu?w+="Z":"time"!=v.selector&&(D=D.getTimezoneOffset(),v=Math.abs(D),w+=(0<
D?"-":"+")+m(Math.floor(v/60))+":"+m(v%60)),u.push(w));return u.join("T")};return F})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(M,I,F,D,v,m){return M([m,v],{_onMap:function(u){var r=this.constructor._onMap;r&&r.FINAL||(delete this.constructor._onMap,r=this.registerConnectEvents(),r.FINAL=!0);u=u.toLowerCase();if(r[u])var w=this[r[u].method];else u=this._onCamelCase(u),this[u]&&(w=u);return w},
on:function(u,r){var w=this._onMap(u),f=u.replace(/\-/g,""),c="on"+f in this.domNode;return w||!c?this.inherited(arguments):this.own(D(this.domNode,f,r))[0]},emit:function(u,r,w){var f,c=u.toLowerCase(),n=this.constructor._onMap||this.registerConnectEvents();var q=this[this._onMap(c)];r=r||{};r.target||(r.target=this);if(q&&n&&n[c]){this._onObj2Arr(function(){f=Array.prototype.slice.call(arguments)},n[c].argKeys)(r);var d=I.mixin({},arguments);d[2]=f;d[0]=n[c].name.replace(/^on/,"")}return this.inherited(d||
arguments)}})})},"esri/dijit/Legend/utils":function(){define(["dojo/_base/lang","../../lang","dojo/i18n!../../nls/jsapi"],function(M,I,F){var D=F.widgets.legend;return{getVisualVariableTitle:function(v,m){var u=v.field,r=v.normalizationField,w=!1,f=!1,c=!1;u=M.isFunction(u)?null:u;r=M.isFunction(r)?null:r;if(v.legendOptions&&v.legendOptions.title)var n=v.legendOptions.title;else if(v.valueExpressionTitle)n=v.valueExpressionTitle;else{if(m.renderer&&m.renderer.authoringInfo&&m.renderer.authoringInfo.visualVariables){var q=
m.renderer.authoringInfo.visualVariables;for(v=0;v<q.length;v++){var d=q[v];if("colorInfo"===d.type&&"ratio"===d.style){w=!0;break}else if("colorInfo"===d.type&&"percent"===d.style){f=!0;break}else if("colorInfo"===d.type&&"percentTotal"===d.style){c=!0;break}}}(w=c&&"showRatioPercentTotal"||f&&"showRatioPercent"||w&&"showRatio"||r&&"showNormField"||u&&"showField"||null)&&(n=I.substitute({field:u&&m.getFieldLabel(u),normField:r&&m.getFieldLabel(r)},"showField"===w?"${field}":D[w]))}return n},getRendererTitle:function(v,
m){if(v){if("esri.renderer.ClassBreaksRenderer"===v.declaredClass){var u=v.attributeField;var r=v.normalizationField;var w="percent-of-total"===v.normalizationType}u=M.isFunction(u)?null:u;r=M.isFunction(r)?null:r;if(v.legendOptions&&v.legendOptions.title)var f=v.legendOptions.title;else v.valueExpressionTitle?f=v.valueExpressionTitle:(v=r&&"showNormField"||(w?"showNormPct":null)||u&&"showField"||null)&&(f=I.substitute({field:u&&m.getFieldLabel(u),normField:r&&m.getFieldLabel(r)},"showField"===v?
"${field}":D[v]))}return f}}})},"esri/layers/clustering/GeohashAggregation":function(){define("dojo/has dojo/_base/declare dojo/_base/lang dojo/_base/array ../../kernel ../../Evented ../../geometry/Point ../../geometry/Extent ../../geometry/mathUtils ../../support/expressionUtils ../../core/timerUtils ../support/attributeUtils ./geohashUtils ./statUtils".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n,q,d){I=I(m,{loaded:!1,started:!1,map:null,layer:null,lod:null,tolerance:null,clusterMode:null,clusterRadius:null,
sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0,clusters:null,clustersEnabled:!0,statisticInfos:null,defaults:{lod:1,tolerance:0,clusterMode:"auto",clusterRadius:80,sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0},_eventHandles:null,_updateHandle:null,_indexHandle:null,_cellIndex:null,_globalIndex:null,_perfProfile:null,_indexUpdated:!1,_cellSizeScaleFactor:1.5,_extentScaleFactor:1.25,_maxGeohashLength:12,_minClusterRadius:15,_levelChange:!0,_clusterFieldPrefix:"cluster_",
_mapLevelChange:!1,constructor:function(a){this._update=F.hitch(this,this._update);this._indexFeatures=F.hitch(this,this._indexFeatures);this._eventHandles=[];this._globalIndex={numFeatures:null,fullExtent:null,lodStats:null};this._perfProfile={lastIndex:{total:null,numFeatures:0},lastUpdate:{cells:null,clusters:null,total:null}};this.clusters=[];this.map=a.map;this.layer=a.layer;this.setLod(a.lod);this.setTolerance(a.tolerance);this.setClusterMode(a.clusterMode);this.setClusterRadius(a.clusterRadius);
this.setSortEnabled(a.sortEnabled);this.setFilterEnabled(a.filterEnabled);this.setBufferEnabled(a.bufferEnabled);this.setUpdateEnabled(a.updateEnabled);this.setStatisticInfos(a.statisticInfos);this._load();this.loaded?this._startup():this._eventHandles.push(this.on("load",F.hitch(this,this._startup)))},destroy:function(a){this._displayFeatures(!0,a);D.forEach(this._eventHandles,function(b){b.remove()});c.clearTimeout(this._updateHandle);c.clearTimeout(this._indexHandle);this._cellIndex=this._globalIndex=
this._eventHandles=this._updateHandle=this._indexHandle=this.map=this.layer=this.clusters=null},setLod:function(a){var b=this.lod;this.lod=a||this.defaults.lod;b!==this.lod&&this.update()},setTolerance:function(a){var b=this.tolerance;this.tolerance=a||this.defaults.tolerance;b!==this.tolerance&&this.update()},setClusterMode:function(a){var b=this.clusterMode;this.clusterMode=a||this.defaults.clusterMode;this._evalClusterParams();b!==this.clusterMode&&this.update()},setClusterRadius:function(a){var b=
this.clusterRadius;this.clusterRadius=null!=a?a:this.defaults.clusterRadius;this._evalClusterParams();b!==this.clusterRadius&&this.update()},setSortEnabled:function(a){var b=this.sortEnabled;this.sortEnabled=null!=a?!!a:this.defaults.sortEnabled;b!==this.sortEnabled&&this.update()},setFilterEnabled:function(a){var b=this.filterEnabled;this.filterEnabled=null!=a?!!a:this.defaults.filterEnabled;b!==this.filterEnabled&&this.update()},setBufferEnabled:function(a){var b=this.bufferEnabled;this.bufferEnabled=
null!=a?!!a:this.defaults.bufferEnabled;b!==this.bufferEnabled&&this.update()},setUpdateEnabled:function(a){var b=this.updateEnabled;(this.updateEnabled=null!=a?!!a:this.defaults.updateEnabled)&&b!==this.updateEnabled&&(this._mapLevelChange=!0,this.update())},setStatisticInfos:function(a){this.statisticInfos=a||[];this.loaded&&this._applyStatInfos(this.statisticInfos)},update:function(){this.loaded&&null==this._updateHandle&&(this._updateHandle=c.setTimeout(this._update,c.priority.HIGH))},isUpdateScheduled:function(){return null!=
this._updateHandle},index:function(){this.loaded&&null==this._indexHandle&&(this._indexHandle=c.setTimeout(this._indexFeatures,c.priority.HIGH))},getCell:function(a){return this._cellIndex[a.length][a]},getCluster:function(a){var b;D.some(this.clusters,function(k){-1<D.indexOf(k.geohashes,a)&&(b=k);return!!b});return b},getCellsInCluster:function(a){var b=[];D.forEach(a&&a.geohashes,function(k){(k=this.getCell(k))&&b.push(k)},this);return b},getFeaturesInCluster:function(a){var b=[];a=this.getCellsInCluster(a);
D.forEach(a,function(k){Array.prototype.push.apply(b,k.features)});return b},toggleFeatureVisibility:function(a){this.index()},getCurrentLodStats:function(){var a=this._globalIndex.lodStats;return a&&a[this.lod]},getNumFeatures:function(){return this._globalIndex.numFeatures},getFullExtent:function(){var a=this._globalIndex.fullExtent;return a&&Infinity!==a.xmin?new r(a):null},_load:function(){this._displayFeatures(!1);this._checkLoadStatus();this.map.loaded||this._eventHandles.push(this.map.on("load",
F.hitch(this,this._checkLoadStatus)));this.layer.loaded||this._eventHandles.push(this.layer.on("load",F.hitch(this,this._checkLoadStatus)))},_checkLoadStatus:function(){if(this.map.loaded&&this.layer.loaded){if("esriGeometryPoint"!==this.layer.geometryType)var a=Error("GeohashAggregation is supported only for points");else{var b=this.map.spatialReference;b.isWebMercator()||4326===b.wkid||(a=Error("GeohashAggregation is supported only when map spatial reference is WGS84 or WebMercator"))}a?(this.loadError=
a,this.emit("load-error",{error:a})):(this.loaded=!0,this.emit("load"))}},_startup:function(){this._evalUpdateStatus();this.index();this._processExtentChange();this._eventHandles.push(this.layer.on("update-end",F.hitch(this,this.index)),this.layer.on("edits-complete",F.hitch(this,this.index)),this.layer.on("graphics-clear",F.hitch(this,this.index)),this.layer.on("suspend",F.hitch(this,this._evalUpdateStatus)),this.layer.on("resume",F.hitch(this,this._evalUpdateStatus)),this.map.on("extent-change",
F.hitch(this,this._processExtentChange)))},_evalUpdateStatus:function(){this.setUpdateEnabled(!this.layer.suspended)},_processExtentChange:function(a){this._mapLevelChange=!(!a||!a.levelChange);this._evalClusterParams();this.update()},_update:function(){this._updateHandle=null;if(this.updateEnabled){this.emit("update-start");if(this.clustersEnabled){var a=this.map.geographicExtent;if(a){var b=this._getIntersectingCells(a);a=this._getClusters(b.cells,a);this.clusters=a.clusters;this._applyStatInfosToClusters();
b=b.profile;a=a.profile;var k=b.total+a.total;b.total=this._getElapsedTime(b.total);a.total=this._getElapsedTime(a.total);var g=this._perfProfile.lastUpdate={};g.cells=b;g.clusters=a;g.total=this._getElapsedTime(k)}}else this.clusters=[],this._perfProfile.lastUpdate=null;b=this._indexUpdated;this._indexUpdated=!1;a=this._mapLevelChange;this._mapLevelChange=!1;this.emit("update-end",{levelChange:this._levelChange,mapLevelChange:a,indexChange:b})}},_displayFeatures:function(a,b){var k=this.layer;a=
!a;k.suspendGraphics(a);!1!==b&&(a?k.clearNodes():k.redraw())},_indexFeatures:function(){this._indexHandle=null;var a=this._getTime();this._initializeIndexing();var b=0,k=this._globalIndex.fullExtent;D.forEach(this.layer.graphics,function(B){if(B.visible){var J=B.geometry,A=this._getLngLat(J);if(A){var h=J.getCacheValue("_geohash");void 0===h&&(h=q.pointToGeohash(A),J.setCacheValue("_geohash",h||null))}h&&(this._addGeohashToIndex(h,B,A),b++,this._updateExtent(k,A))}},this);this._applyStatInfosToIndex();
this._globalIndex.numFeatures=b;for(var g=this._globalIndex.lodStats,p=1;p<=this._maxGeohashLength;p++)g[p]=this._getLODStats(p,b);this._perfProfile.lastIndex.total=this._getElapsedTime(a,this._getTime());this._perfProfile.lastIndex.numFeatures=b;this._indexUpdated=!0;this.emit("index-complete");this.started||(this.started=!0,this.emit("start"));this.update()},_initializeIndexing:function(){this._globalIndex={numFeatures:0,fullExtent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},lodStats:{}};
for(var a=this._cellIndex=[],b=1;b<=this._maxGeohashLength;b++)a[b]={}},_getLngLat:function(a){if(a){var b=a.getLongitude();a=a.getLatitude();a=null!=b&&null!=a?{x:b,y:a}:null}return a},_addGeohashToIndex:function(a,b,k){for(var g=this._cellIndex,p="",B=0;B<this._maxGeohashLength;B++){p+=a[B];var J=g[p.length],A=J[p];A||(A=J[p]={count:0,centroid:{x:null,y:null},extent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},features:[],geohash:p,statistics:null});this._updateItem(A,1,k,!0);A.features.push(b)}},
_getLODStats:function(a,b){var k=this._cellIndex[a],g=0,p=Infinity,B=-Infinity,J=null,A;for(A in k){var h=k[A];g++;h.count<p&&(p=h.count);h.count>B&&(B=h.count)}0<g&&(J=Number((b/g).toFixed(2)));return{lod:a,count:g,min:Infinity===p?null:p,max:-Infinity===B?null:B,avg:J}},_evalClusterParams:function(){if(this.loaded&&"auto"===this.clusterMode){var a=this._getClusterParams(this.map.getResolutionInMeters(),this.clusterRadius,this._minClusterRadius);this._levelChange=this.lod!==a.lod;this.lod=a.lod;
this.tolerance=a.tolerance}},_getClusterParams:function(a,b,k){b<k&&(b=k);a=Math.ceil(a*b);b=this._getClosestLODRange(a).max;do k=this._getCellSize(b),(k=a>=this._cellSizeScaleFactor*k||1===k)||(b+=1);while(!k);k=a/this._getCellSize(b);return{lod:b,tolerance:a,multiplier:Number(k.toFixed(2))}},_getClosestLODRange:function(a){for(var b,k=this._maxGeohashLength;1<=k;k--)if(this._getCellSize(k)>=a){b=k;break}null==b&&(b=1);a=b+1;a>this._maxGeohashLength&&(a=this._maxGeohashLength);return{min:b,max:a}},
_getCellSize:function(a){a=q.getCellSizeInMeters(a);return Math.ceil(Math.min(a.width,a.height))},_sorter:function(a,b){var k=a.centroid,g=b.centroid;return a.count>b.count?-1:a.count<b.count?1:k.x>g.x?-1:k.x<g.x?1:0},_getIntersectingCells:function(a){var b=this._getTime();this.bufferEnabled&&(a=a.expand(this._extentScaleFactor));var k=q.getIntersecting(a,this.lod,this.bufferEnabled?this.tolerance:0);a=this._getTime();var g=[],p=this.tolerance,B=this.sortEnabled;D.forEach(k,function(J){(J=this.getCell(J))&&
g.push(J)},this);p&&B&&g.sort(this._sorter);k=this._getTime();return{cells:g,profile:{findCells:this._getElapsedTime(b,a),scanAndSortCells:this._getElapsedTime(a,k),total:k-b}}},_getClusters:function(a,b){var k=this._getTime(),g=[],p={},B={findCells:0};D.forEach(a,function(J,A){(J=this._createCluster(J,p,B))&&g.push(J)},this);this._markIntersecting(g,b);this.filterEnabled&&(g=this._getIntersectingClusters(g));a=this._getTime();return{clusters:g,profile:{findCellsInCluster:this._getElapsedTime(B.findCells),
total:a-k}}},_markIntersecting:function(a,b){var k=b.normalize();D.forEach(a,function(g){var p=g.centroid.x,B=g.centroid.y;g.isIntersecting=D.some(k,function(J){return p>=J.xmin&&p<=J.xmax&&B>=J.ymin&&B<=J.ymax})})},_getIntersectingClusters:function(a){return D.filter(a,function(b){return b.isIntersecting})},_createCluster:function(a,b,k){if(!b[a.geohash]){var g=[{cell:a,distance:0}];if(this.tolerance){var p=this._getTime(),B=q.getNeighborsWithinDistance(a.centroid,this.lod,this.tolerance);k.findCells+=
this._getTime()-p;D.forEach(B,function(J){if(J!==a.geohash&&(J=this.getCell(J))){var A=this._calculateDistance(a.centroid,J.centroid);A<=this.tolerance&&g.push({cell:J,distance:A})}},this)}return this._mergeCells(g,b)}},_calculateDistance:function(a,b){return w.getLength(q.geographicToWebMercator(a),q.geographicToWebMercator(b))},_mergeCells:function(a,b){var k=this._initializeCluster({},a[0].cell.geohash);D.forEach(a,function(g){var p=g.cell,B=p.geohash;g=g.distance;var J=b[B];if(J)if(g<J.distance)this._removeCellFromCluster(B,
b);else return;b[B]={cluster:k,distance:g};this._updateItem(k,p.count,p.centroid);k.geohashes.push(B)},this);return k},_removeCellFromCluster:function(a,b){var k=b[a].cluster;delete b[a];a=D.indexOf(k.geohashes,a);-1<a&&k.geohashes.splice(a,1);this._reevaluateCluster(k)},_reevaluateCluster:function(a){var b=a.geohashes;a=this._initializeCluster(a,a.primary);D.forEach(b,function(k){var g=this.getCell(k);g&&(this._updateItem(a,g.count,g.centroid),a.geohashes.push(k))},this)},_initializeCluster:function(a,
b){a.count=0;a.centroid=new u(null,null);a.geohashes=[];a.primary=b;a.statistics=null;return a},_applyStatInfos:function(a){a=this._getValidStatInfos(a);this._applyStatInfosToIndex(a);this._applyStatInfosToClusters(a)},_getValidStatInfos:function(a){var b=[];D.forEach(a,function(k){var g=k.attributeInfo;k=k.statisticType;var p="angle"===g.attributeType;if(d.isSupportedStatisticType(k)&&(!p||"avg"===k)){var B="arithmetic"===g.rotationType;b.push({attributeCache:n.createAttributeCache(g,"type"===k),
identifier:d.getStatisticId(g,k),statFunctions:d.getStatisticFunctions(k),isAngular:p,isDate:"date"===g.attributeType,isArithmetic:B})}});return b},_applyStatInfosToIndex:function(a){a=a||this._getValidStatInfos(this.statisticInfos);var b=this._cellIndex;if(b)for(var k=1;k<=this._maxGeohashLength;k++){var g=b[k],p;for(p in g)this._applyStatInfosToCell(g[p],a)}},_applyStatInfosToCell:function(a,b){var k=this._initializeStats(a,b);D.forEach(a.features,function(g){this._calcFeatureStats(g,b,k)},this);
this._summarizeStats(a,k,b)},_calcFeatureStats:function(a,b,k){a.attributes&&D.forEach(b,function(g){var p=k[g.identifier],B=g.attributeCache;B=B?a._getDataValue(B.attributeInfo,B,f):null;g.statFunctions.updateCellStat(p,B,g)})},_applyStatInfosToClusters:function(a){a=a||this._getValidStatInfos(this.statisticInfos);var b=this._clusterFieldPrefix;D.forEach(this.clusters,function(k){var g=this._initializeStats(k,a);D.forEach(this.getCellsInCluster(k),function(p){this._calcCellStats(p,a,g)},this);this._summarizeStats(k,
g,a,b);k.attributes[b+"id"]=k.primary},this)},_calcCellStats:function(a,b,k){var g=a.statistics;D.forEach(b,function(p){var B=p.identifier;p.statFunctions.updateClusterStat(k[B],g[B],p)})},_initializeStats:function(a,b){var k=a.statistics={};D.forEach(b,function(g){k[g.identifier]=g.statFunctions.initialize(g)});return k},_summarizeStats:function(a,b,k,g){var p=a.attributes={};g=g||"";p[g+"count"]=a.count;D.forEach(k,function(B){var J=this._getStatFieldName(B,g);p[J]=B.statFunctions.summarize(b[B.identifier],
B)},this)},_getStatFieldName:function(a,b){return(b||"")+a.identifier},_updateItem:function(a,b,k,g){var p=k.y,B=a.centroid,J=a.count;B.x=(J*B.x+b*k.x)/(J+b);B.y=(J*B.y+b*p)/(J+b);a.count+=b;g&&this._updateExtent(a.extent,k)},_updateExtent:function(a,b){var k=b.x;b=b.y;k<a.xmin&&(a.xmin=k);k>a.xmax&&(a.xmax=k);b<a.ymin&&(a.ymin=b);b>a.ymax&&(a.ymax=b)},_getTime:function(){return window.performance?window.performance.now():(new Date).getTime()},_getElapsedTime:function(a,b){a=null!=a&&null!=b?b-a:
a;if(null!=a){var k="millisecond";1E3<=a&&(a/=1E3,k="second",60<=a&&(a/=60,k="minute"));k={value:Number(a.toFixed(2)),unit:k}}return k}});M("extend-esri")&&F.setObject("layers.clustering.GeohashAggregation",I,v);return I})},"esri/core/timerUtils":function(){define([],function(){function M(m){var u,r=m.length;for(u=0;u<r;u++)m[u]()}var I={LOW:1,HIGH:2},F,D={};D[I.LOW]=[];D[I.HIGH]=[];var v=function(){clearTimeout(F);F=null;var m=D[I.HIGH];D[I.HIGH]=[];M(m);m=D[I.LOW];D[I.LOW]=[];M(m)};return{priority:I,
callbackQueue:D,setTimeout:function(m,u){m=[u,D[u].push(m)-1];F||(F=setTimeout(v,0));return m},clearTimeout:function(m){m&&D[m[0]].splice(m[1],1)}}})},"esri/layers/clustering/geohashUtils":function(){define("dojo/has dojo/string dojo/_base/lang dojo/_base/array ../../kernel ../../geometry/Point ../../geometry/Extent ../../SpatialReference ../../geometry/webMercatorUtils".split(" "),function(M,I,F,D,v,m,u,r,w){function f(E){var G=E.spatialReference;if(!G)return{x:E.x,y:E.y};var O=G.isWebMercator(),
L;4326===G.wkid?L={x:E.x,y:E.y}:O&&(L={x:E.getLongitude(),y:E.getLatitude()});return L}function c(E){var G=E.spatialReference,O=!(!G||!G.isWebMercator()),L;G&&4326===G.wkid?L=new u(E.toJson()):O&&(L=w.webMercatorToGeographic(E,!0));return L}function n(E,G){G.x=m.prototype._normalizeX(E.x,r.prototype._info[4326]);G.y=E.y;return G}function q(E){E=y.decimals[E].toString(2);return I.pad(E,y.bitsPerBase32Char,"0")}function d(E,G){G=G.slice();G.splice(1,0,0);for(var O=G[0],L=G[2],N=0;N<E.length;N++){Number(E[N])?
G[0]=G[1]:G[2]=G[1];var T=G[1]=(G[0]+G[2])/2;O=G[0];L=G[2]}return{value:T,min:O,max:L}}function a(E,G,O){var L=[];G=G.slice();G.splice(1,0,0);for(var N=G[0],T=G[2],R=0;R<O;R++)E>=G[1]?(G[0]=G[1],N=1):(G[2]=G[1],N=0),G[1]=(G[0]+G[2])/2,L.push(N),N=G[0],T=G[2];return{value:L.join(""),min:N,max:T}}function b(E){var G=E*y.bitsPerBase32Char;0===G%2?E=G/=2:(E=(G+1)/2,G-=E);return{lon:E,lat:G}}function k(E){var G=0;E=E.split("").reverse().join("");for(var O=0;O<E.length;O++)G+=Number(E[O])*Math.pow(2,O);
return y.base32[G]}function g(E,G){var O={x:E.xmin,y:E.ymax},L={x:E.xmax,y:E.ymin},N={x:E.xmax,y:E.ymax};return{sw:H.pointToGeohash({x:E.xmin,y:E.ymin},G),nw:H.pointToGeohash(O,G),se:H.pointToGeohash(L,G),ne:H.pointToGeohash(N,G)}}function p(E,G,O,L,N){var T=E;do N[T]||(N[T]=!0,L.push(T)),(E=T===G)||(T=t(T,O));while(!E)}function B(E,G,O,L){var N=g(E,G);E=[];p(N.sw,N.nw,"n",E,{});G=[];p(N.se,N.ne,"n",G,{});for(N=0;N<E.length;N++)p(E[N],G[N],"e",O,L)}function J(E){return D.filter(E,function(G){return 180===
G.xmax?!0:!1})[0]}function A(E){return D.filter(E,function(G){return-180===G.xmin?!0:!1})[0]}function h(E,G,O,L){var N=H.geographicToWebMercator(E);E={x:N.x-G,y:N.y-G};G=H.webMercatorToGeographic({x:N.x+G,y:N.y+G},!0);E=H.webMercatorToGeographic(E,!0);return new u(null!=O?O:E.x,E.y,null!=L?L:G.x,G.y)}function x(E,G,O,L){E=g(E,G);var N,T;"min"===L?T=180:"max"===L&&(N=-180);var R=N;L=T;var Q=H.geohashToCell(E.sw).extent;G=H.geohashToCell(E.ne).extent;E=null!=R?R:Q.xmin;Q=Q.ymin;L=null!=L?L:G.xmax;G=
G.ymax;E=h({x:E,y:Q},O,N,T);O=h({x:L,y:G},O,N,T);return new u(E.xmin,E.ymin,O.xmax,O.ymax)}function z(E,G,O){var L=E,N=0;do N++,(E=L===G)||(L=t(L,O));while(!E);return N}function e(E,G){E=g(E,G);G=z(E.nw,E.ne,"e");return{rows:z(E.nw,E.sw,"s"),cols:G}}function t(E,G){var O=E.length%2,L=E.slice(-1),N=y.decimals[L];E=E.slice(0,-1);-1!=y.borders[G][O].indexOf(L)&&E&&(E=t(E,G));return E+y.neighbors[G][O][N]}var y={base32:"0123456789bcdefghjkmnpqrstuvwxyz",decimals:function(){for(var E={},G=0;32>G;G++)E["0123456789bcdefghjkmnpqrstuvwxyz"[G]]=
G;return E}(),neighbors:{n:[null,"238967debc01fg45kmstqrwxuvhjyznp"],s:[null,"bc01fg45238967deuvhjyznpkmstqrwx"],e:[null,"14365h7k9dcfesgujnmqp0r2twvyx8zb"],w:[null,"p0r21436x8zb9dcf5h7kjnmqesgutwvy"]},borders:{n:[null,"bcfguvyz"],s:[null,"0145hjnp"],e:[null,"prxz"],w:[null,"028b"]},bitsPerBase32Char:5,maxGeohashLength:12,longitudeRange:[-180,180],latitudeRange:[-90,90]};y.neighbors.n[0]="14365h7k9dcfesgujnmqp0r2twvyx8zb";y.neighbors.s[0]="p0r21436x8zb9dcf5h7kjnmqesgutwvy";y.neighbors.e[0]="238967debc01fg45kmstqrwxuvhjyznp";
y.neighbors.w[0]="bc01fg45238967deuvhjyznpkmstqrwx";y.borders.n[0]="prxz";y.borders.s[0]="028b";y.borders.e[0]="bcfguvyz";y.borders.w[0]="0145hjnp";var H={geographicToWebMercator:function(E){E=m.lngLatToXY(E.x,E.y);return{x:E[0],y:E[1]}},webMercatorToGeographic:function(E,G){E=m.xyToLngLat(E.x,E.y,G);return{x:E[0],y:E[1]}},geohashToCell:function(E){var G;var O=[];for(G=0;G<E.length;G++)O.push(q(E[G]));O=O.join("");G=[];for(var L=[],N=0;N<O.length;N++)0===N%2?G.push(O[N]):L.push(O[N]);G=G.join("");
L=L.join("");G=[G,L];O=d(G[0],y.longitudeRange);L=d(G[1],y.latitudeRange);G=O.value;return{point:{x:G,y:L.value},extent:{xmin:O.min,xmax:O.max,ymin:L.min,ymax:L.max},geohash:E}},pointToCell:function(E,G){G=G||y.maxGeohashLength;if(E=f(E)){E=n(E,E);var O=b(G);G=a(E.x,y.longitudeRange,O.lon);var L=a(E.y,y.latitudeRange,O.lat);O=G.value;var N=L.value;G={xmin:G.min,xmax:G.max,ymin:L.min,ymax:L.max};L=[];for(var T=Math.ceil((O.length+N.length)/y.bitsPerBase32Char),R=0,Q=0,W=0;W<T*y.bitsPerBase32Char;W++){var ba=
0===W%2?O[R++]:N[Q++];null==ba&&(ba=0);L.push(ba)}O=L.join("");N=y.bitsPerBase32Char;L=O.length/N;T=[];for(R=0;R<L;R++)Q=O.substr(R*N,N),T.push(k(Q));O=T.join("");return{point:E,extent:G,geohash:O}}},geohashToPoint:function(E){return H.geohashToCell(E).point},pointToGeohash:function(E,G){return(E=H.pointToCell(E,G))&&E.geohash},getCells:function(E){return D.map(E,function(G){return H.geohashToCell(G)})},getCellSize:function(E){var G=y.longitudeRange,O=y.latitudeRange;G=Math.abs(G[1]-G[0]);O=Math.abs(O[1]-
O[0]);E=b(E||1);return{width:G/Math.pow(2,E.lon),height:O/Math.pow(2,E.lat)}},getCellSizeInMeters:function(E){E=H.getCellSize(E);var G=w.metersPerDegree;E.width*=G;E.height*=G;return E},getIntersecting:function(E,G,O){G=G||1;O=O||0;var L=[],N=c(E);if(N){O&&(N=H.expandExtent(E,G,O));E=N.normalize();var T={};D.forEach(E,function(R){B(R,G,L,T)})}return L},countIntersecting:function(E,G,O){G=G||1;O=O||0;var L=0,N=c(E);if(N){O&&(N=H.expandExtent(E,G,O));E=N.normalize();if(2===E.length){L=J(E);N=A(E);O=
e(L,G);var T=e(N,G);E=O.rows;O=O.cols+T.cols;L={x:L.xmin,y:L.ymax};N={x:N.xmax,y:N.ymax};L=n(L,{});N=n(N,{});L=H.pointToGeohash(L,G);G=H.pointToGeohash(N,G);L===G&&O--;G={rows:E,cols:O}}else G=e(E[0],G);L=G.cols*G.rows}return L},getChildren:function(E){E=E||"";var G=[],O;for(O in y.decimals)G.push(E+O);return G},getNeighbors:function(E){var G=t(E,"n"),O=t(E,"s");return[G,t(G,"e"),t(G,"w"),O,t(O,"e"),t(O,"w"),t(E,"e"),t(E,"w")]},getExtentFromDistance:function(E,G){G=G||1E3;var O;(E=f(E))&&(O=h(E,G));
return O},expandExtent:function(E,G,O){G=G||1;O=O||0;if(E=c(E)){if(O){E=E.normalize();if(2===E.length){var L=O;O=J(E);E=A(E);O=x(O,G,L,"min");E=x(E,G,L,"max");360<=O.getWidth()+E.getWidth()?(G=-180,E=180):(G=O.xmin,E=E.xmax);return new u(G,O.ymin,E,O.ymax)}return x(E[0],G,O)}return E}},getNeighborsWithinDistance:function(E,G,O){O=O||1E3;G=G||1;var L=[];if(E=f(E)){O=h(E,O).normalize();var N={};D.forEach(O,function(T){B(T,G,L,N)})}return L}};M("extend-esri")&&F.setObject("layers.clustering.geohashUtils",
H,v);return H})},"esri/layers/clustering/statUtils":function(){define(["dojo/_base/lang","../support/attributeUtils"],function(M,I){function F(m){return"number"===typeof m&&!isNaN(m)&&Infinity!==m&&-Infinity!==m}var D={sum:{initialize:function(){return{count:0,sum:null}},updateCellStat:function(m,u){F(u)&&(m.count++,m.sum+=u)},updateClusterStat:function(m,u){u.count&&(m.count+=u.count,m.sum+=u.sum)},summarize:function(m){return m.sum}},avg:{initialize:function(m){return{count:0,sum:null,avg:null,
sum_cosine:null,sum_sine:null}},updateCellStat:function(m,u,r){F(u)&&(m.count++,r.isAngular?(r.isArithmetic||(u=-1*u+90),m.sum_cosine+=Math.cos(u*Math.PI/180),m.sum_sine+=Math.sin(u*Math.PI/180)):m.sum+=u)},updateClusterStat:function(m,u,r){u.count&&(m.count+=u.count,r.isAngular?(m.sum_cosine+=u.sum_cosine,m.sum_sine+=u.sum_sine):m.sum+=u.sum)},summarize:function(m,u){if(0<m.count){var r=m.count;u.isAngular?(r=180*Math.atan2(m.sum_sine/r,m.sum_cosine/r)/Math.PI,u.isArithmetic||(r=-1*(r-90)),m.avg=
0>r?r+360:r):(m.avg=m.sum/r,u.isDate&&(m.avg=Math.ceil(m.avg)))}return m.avg}},type:{initialize:function(){return{uvInfos:{}}},updateCellStat:function(m,u){if(null==u||""===u||"string"===typeof u&&""===M.trim(u))u=null;m=m.uvInfos;null==m[u]?m[u]={count:1,value:u}:m[u].count++},updateClusterStat:function(m,u){m=m.uvInfos;u=u.uvInfos;for(var r in u){var w=u[r];null==m[r]?m[r]={count:w.count,value:w.value}:m[r].count+=w.count}},summarize:function(m){m=m.uvInfos;var u,r=-Infinity;for(u in m){var w=m[u];
if(w.count>r){r=w.count;var f=w.value}else w.count===r&&(f=null)}return f}}},v={isSupportedStatisticType:function(m){return D.hasOwnProperty(m)},getStatisticFunctions:function(m){return D[m]},getStatisticId:function(m,u){var r=I.getAttributeIdSource(m);m=r&&I.getAttributeId(r)||m.field;return u+"_"+m},getClusterField:function(m,u){return"cluster_"+v.getStatisticId(m,u)},getStatisticHash:function(m,u){u=[v.getStatisticId(m,u)];m.attributeType&&u.push(m.attributeType.toLowerCase());m.rotationType&&
u.push(m.rotationType.toLowerCase());return u.join("_")}};return v})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a,b,k,g,p,B,J,A,h,x,z,e){var t=M(a,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(y,H){this.markerSymbol=new b(b.STYLE_SOLID,10,new k(k.STYLE_SOLID,new v([255,0,0]),2),new v([0,0,0,.25]));this.lineSymbol=new k(k.STYLE_SOLID,new v([255,0,0]),2);this.fillSymbol=new g(g.STYLE_SOLID,new k(k.STYLE_SOLID,new v([255,0,0]),2),new v([0,0,0,.25]));this._points=[];this._mouse=!u("esri-touch")&&!u("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=I.mixin(I.mixin({},this._defaultOptions),H||{});if(r("ios")||r("android"))this._options.showTooltips=!1;this._onKeyDownHandler=I.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=I.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=I.hitch(this,this._onMouseUpHandler);this._onClickHandler=I.hitch(this,this._onClickHandler);this._onMouseMoveHandler=I.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=I.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=I.hitch(this,this._onDblClickHandler);this._updateTooltip=I.hitch(this,this._updateTooltip);this._hideTooltip=I.hitch(this,this._hideTooltip);this._redrawGraphic=I.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(y){this.respectDrawingVertexOrder=y},setMarkerSymbol:function(y){this.markerSymbol=y},setLineSymbol:function(y){this.lineSymbol=y},
setFillSymbol:function(y){this.fillSymbol=y},activate:function(y,H){this._geometryType&&this.deactivate();var E=this.map,G=D.connect,O=t;this._options=I.mixin(I.mixin({},this._options),H||{});E.navigationManager.setImmediateClick(!1);switch(y){case O.ARROW:case O.LEFT_ARROW:case O.RIGHT_ARROW:case O.UP_ARROW:case O.DOWN_ARROW:case O.TRIANGLE:case O.CIRCLE:case O.ELLIPSE:case O.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=G(E,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=G(E,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=G(E,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=G(E,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=G(E,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=G(E,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=G(E,"onMouseDragEnd",this._onMouseUpHandler));u("esri-touch")&&(this._onMouseDownHandler2_connect=
G(E,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=G(E,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=G(E,"onSwipeEnd",this._onMouseUpHandler));break;case O.POINT:this._onClickHandler_connect=G(E,"onClick",this._onClickHandler);break;case O.LINE:case O.EXTENT:case O.FREEHAND_POLYLINE:case O.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=G(E,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=
G(E,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=G(E,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=G(E,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=G(E,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=G(E,"onMouseDragEnd",this._onMouseUpHandler));u("esri-touch")&&(this._onMouseDownHandler2_connect=G(E,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=G(E,"onSwipeMove",
this._onMouseDragHandler),this._onMouseUpHandler2_connect=G(E,"onSwipeEnd",this._onMouseUpHandler));break;case O.POLYLINE:case O.POLYGON:case O.MULTI_POINT:E.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=G(E,"onClick",this._onClickHandler);this._onDblClickHandler_connect=G(E,"onDblClick",this._onDblClickHandler);this._dblClickZoom=E.isDoubleClickZoom;E.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+y);return}this._onKeyDown_connect=G(E,"onKeyDown",
this._onKeyDownHandler);this._redrawConnect=G(E,"onExtentChange",this._redrawGraphic);this._geometryType=y;this._toggleTooltip(!0);E.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(E.snappingManager._startSelectionLayerQuery(),E.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var y=this.map;this._clear();var H=D.disconnect;H(this._onMouseMoveHandler_connect);H(this._onMouseDownHandler_connect);H(this._onMouseDragHandler_connect);
H(this._onMouseUpHandler_connect);H(this._onMouseDownHandler2_connect);H(this._onMouseDragHandler2_connect);H(this._onMouseUpHandler2_connect);H(this._onClickHandler_connect);H(this._onDblClickHandler_connect);H(this._onKeyDown_connect);H(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=this._onMouseUpHandler2_connect=this._onClickHandler_connect=
this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;y.snappingManager&&(y.snappingManager._stopSelectionLayerQuery(),y.snappingManager._killOffSnapping());switch(this._geometryType){case t.CIRCLE:case t.ELLIPSE:case t.TRIANGLE:case t.ARROW:case t.LEFT_ARROW:case t.RIGHT_ARROW:case t.UP_ARROW:case t.DOWN_ARROW:case t.RECTANGLE:case t.LINE:case t.EXTENT:case t.FREEHAND_POLYLINE:case t.FREEHAND_POLYGON:this._activateMapTools(!0,!1,!1,!0);break;case t.POLYLINE:case t.POLYGON:case t.MULTI_POINT:this._dblClickZoom&&
y.enableDoubleClickZoom()}H=this._geometryType;this._geometryType=null;y.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(H)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._graphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},finishDrawing:function(){var y=this._points,H=this.map.spatialReference,E=t;y=y.slice(0,y.length);switch(this._geometryType){case E.POLYLINE:if(!this._graphic||2>
y.length)return;var G=new A(H);G.addPath([].concat(y));break;case E.POLYGON:if(!this._graphic||3>y.length)return;G=new h(H);y=[].concat(y,[y[0].offset(0,0)]);h.prototype.isClockwise(y)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),y.reverse());G.addRing(y);break;case E.MULTI_POINT:G=new x(H),F.forEach(y,function(O){G.addPoint(O)})}D.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);
this._drawEnd(G)},_drawEnd:function(y){if(y){var H=this.map.spatialReference,E;this.onDrawEnd(y);H&&(H.isWebMercator()?E=J.webMercatorToGeographic(y,!0):4326===H.wkid&&(E=B.fromJson(y.toJson())));this.onDrawComplete({geometry:y,geographicGeometry:E})}},_normalizeRect:function(y,H,E){var G=y.x;y=y.y;var O=H.x;H=H.y;return{x:Math.min(G,O),y:Math.max(y,H),width:Math.abs(G-O),height:Math.abs(y-H),spatialReference:E}},_onMouseDownHandler:function(y){this._dragged=!1;if(this.map.snappingManager)var H=this.map.snappingManager._snappingPoint;
var E=H||y.mapPoint,G=t;H=this.map;var O=H.spatialReference;this._points.push(E.offset(0,0));switch(this._geometryType){case G.LINE:this._graphic=H.graphics.add(new p(new A({paths:[[[E.x,E.y],[E.x,E.y]]],spatialReference:O}),this.lineSymbol),!0);H.snappingManager&&H.snappingManager._setGraphic(this._graphic);break;case G.FREEHAND_POLYLINE:this._oldPoint=y.screenPoint;E=new A(O);E.addPath(this._points);this._graphic=H.graphics.add(new p(E,this.lineSymbol),!0);H.snappingManager&&H.snappingManager._setGraphic(this._graphic);
break;case G.CIRCLE:case G.ELLIPSE:case G.TRIANGLE:case G.ARROW:case G.LEFT_ARROW:case G.RIGHT_ARROW:case G.UP_ARROW:case G.DOWN_ARROW:case G.RECTANGLE:case G.FREEHAND_POLYGON:this._oldPoint=y.screenPoint,E=new h(O),E.addRing(this._points),this._graphic=H.graphics.add(new p(E,this.fillSymbol),!0),H.snappingManager&&H.snappingManager._setGraphic(this._graphic)}u("esri-touch")&&y.preventDefault();if(1===this._points.length)this.onDrawStart()},_onMouseMoveHandler:function(y){if(this.map.snappingManager)var H=
this.map.snappingManager._snappingPoint;y=H||y.mapPoint;H=this._graphic.geometry;switch(this._geometryType){case t.POLYLINE:case t.POLYGON:var E=this._points.length,G=!!H.getPoint(0,E);y=y.offset(0,0);G?H.setPoint(0,E,y):H.insertPoint(0,E,y);this._graphic.setGeometry(H)}},_onMouseDragHandler:function(y){if(this._graphic||this._points.length)if(u("esri-touch")&&!this._points.length)y.preventDefault();else{this._dragged=!0;if(this.map.snappingManager)var H=this.map.snappingManager._snappingPoint;var E=
this._points[0],G=H||y.mapPoint,O=this.map,L=O.spatialReference;H=this._graphic;var N=t,T=O.toScreen(E),R=O.toScreen(G),Q=[];Q=R.x-T.x;R=R.y-T.y;var W=Math.sqrt(Q*Q+R*R);switch(this._geometryType){case N.CIRCLE:this._hideTooltip();H.geometry=h.createCircle({center:T,r:W,numberOfPoints:60,map:O});H.setGeometry(H.geometry);break;case N.ELLIPSE:this._hideTooltip();H.geometry=h.createEllipse({center:T,longAxis:Q,shortAxis:R,numberOfPoints:60,map:O});H.setGeometry(H.geometry);break;case N.TRIANGLE:this._hideTooltip();
Q=[[0,-W],[.8660254037844386*W,.5*W],[-.8660254037844386*W,.5*W],[0,-W]];H.geometry=this._toPolygon(Q,T.x,T.y);H.setGeometry(H.geometry);break;case N.ARROW:this._hideTooltip();E=R/W;O=Q/W;G=.25*O*W;L=.25*W/(R/Q);W*=.25*E;Q=[[Q,R],[Q-G*(1+24/L),R+24*O-W],[Q-G*(1+12/L),R+12*O-W],[-12*E,12*O],[12*E,-12*O],[Q-G*(1-12/L),R-12*O-W],[Q-G*(1-24/L),R-24*O-W],[Q,R]];H.geometry=this._toPolygon(Q,T.x,T.y);H.setGeometry(H.geometry);break;case N.LEFT_ARROW:this._hideTooltip();Q=0>=Q?[[Q,0],[.75*Q,R],[.75*Q,.5*
R],[0,.5*R],[0,-.5*R],[.75*Q,-.5*R],[.75*Q,-R],[Q,0]]:[[0,0],[.25*Q,R],[.25*Q,.5*R],[Q,.5*R],[Q,-.5*R],[.25*Q,-.5*R],[.25*Q,-R],[0,0]];H.geometry=this._toPolygon(Q,T.x,T.y);H.setGeometry(H.geometry);break;case N.RIGHT_ARROW:this._hideTooltip();Q=0<=Q?[[Q,0],[.75*Q,R],[.75*Q,.5*R],[0,.5*R],[0,-.5*R],[.75*Q,-.5*R],[.75*Q,-R],[Q,0]]:[[0,0],[.25*Q,R],[.25*Q,.5*R],[Q,.5*R],[Q,-.5*R],[.25*Q,-.5*R],[.25*Q,-R],[0,0]];H.geometry=this._toPolygon(Q,T.x,T.y);H.setGeometry(H.geometry);break;case N.UP_ARROW:this._hideTooltip();
Q=0>=R?[[0,R],[-Q,.75*R],[-.5*Q,.75*R],[-.5*Q,0],[.5*Q,0],[.5*Q,.75*R],[Q,.75*R],[0,R]]:[[0,0],[-Q,.25*R],[-.5*Q,.25*R],[-.5*Q,R],[.5*Q,R],[.5*Q,.25*R],[Q,.25*R],[0,0]];H.geometry=this._toPolygon(Q,T.x,T.y);H.setGeometry(H.geometry);break;case N.DOWN_ARROW:this._hideTooltip();Q=0<=R?[[0,R],[-Q,.75*R],[-.5*Q,.75*R],[-.5*Q,0],[.5*Q,0],[.5*Q,.75*R],[Q,.75*R],[0,R]]:[[0,0],[-Q,.25*R],[-.5*Q,.25*R],[-.5*Q,R],[.5*Q,R],[.5*Q,.25*R],[Q,.25*R],[0,0]];H.geometry=this._toPolygon(Q,T.x,T.y);H.setGeometry(H.geometry);
break;case N.RECTANGLE:this._hideTooltip();Q=[[0,0],[Q,0],[Q,R],[0,R],[0,0]];H.geometry=this._toPolygon(Q,T.x,T.y);H.setGeometry(H.geometry);break;case N.LINE:H.setGeometry(I.mixin(H.geometry,{paths:[[[E.x,E.y],[G.x,G.y]]]}));break;case N.EXTENT:H&&O.graphics.remove(H,!0);H=new z(this._normalizeRect(E,G,L));H._originOnly=!0;this._graphic=O.graphics.add(new p(H,this.fillSymbol),!0);O.snappingManager&&O.snappingManager._setGraphic(this._graphic);break;case N.FREEHAND_POLYLINE:this._hideTooltip();if(!1===
this._canDrawFreehandPoint(y)){u("esri-touch")&&y.preventDefault();return}this._points.push(y.mapPoint.offset(0,0));H.geometry._insertPoints([G.offset(0,0)],0);H.setGeometry(H.geometry);break;case N.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(y)){u("esri-touch")&&y.preventDefault();return}this._points.push(y.mapPoint.offset(0,0));H.geometry._insertPoints([G.offset(0,0)],0);H.setGeometry(H.geometry)}u("esri-touch")&&y.preventDefault()}},_canDrawFreehandPoint:function(y){if(!this._oldPoint)return!1;
var H=this._oldPoint.x-y.screenPoint.x,E=this._oldPoint.y-y.screenPoint.y,G=this._options.tolerance;if((0>H?-1*H:H)<G&&(0>E?-1*E:E)<G)return!1;H=new Date;if(H-this._startTime<this._options.drawTime)return!1;this._startTime=H;this._oldPoint=y.screenPoint;return!0},_onMouseUpHandler:function(y){if(this._dragged&&this._graphic){0===this._points.length&&this._points.push(y.mapPoint.offset(0,0));if(this.map.snappingManager)var H=this.map.snappingManager._snappingPoint;var E=this._points[0];H=H||y.mapPoint;
var G=this.map.spatialReference,O=t;switch(this._geometryType){case O.CIRCLE:case O.ELLIPSE:case O.TRIANGLE:case O.ARROW:case O.LEFT_ARROW:case O.RIGHT_ARROW:case O.UP_ARROW:case O.DOWN_ARROW:case O.RECTANGLE:var L=this._graphic.geometry;break;case O.LINE:L=new A({paths:[[[E.x,E.y],[H.x,H.y]]],spatialReference:G});break;case O.EXTENT:L=(new z(this._normalizeRect(E,H,G))).getExtent();break;case O.FREEHAND_POLYLINE:L=new A(G);L.addPath([].concat(this._points,[H.offset(0,0)]));break;case O.FREEHAND_POLYGON:L=
new h(G),E=[].concat(this._points,[H.offset(0,0),this._points[0].offset(0,0)]),h.prototype.isClockwise(E)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),E.reverse()),L.addRing(E)}u("esri-touch")&&y.preventDefault();this._clear();this._drawEnd(L)}else this._clear()},_isPointToPointTool:function(y){switch(y){case t.POLYLINE:case t.POLYGON:case t.MULTI_POINT:return!0;default:return!1}},_onClickHandler:function(y){if(this.map.snappingManager)var H=
this.map.snappingManager._snappingPoint;H=H||y.mapPoint;y=this.map;var E=y.toScreen(H),G=t;if(this._isPointToPointTool(this._geometryType)){var O=this._points[this._points.length-1];if(H&&O&&H.x===O.x&&H.y===O.y)return;this._points.push(H.offset(0,0))}switch(this._geometryType){case G.POINT:this.onDrawStart();this._drawEnd(H.offset(0,0));this._setTooltipMessage(0);break;case G.POLYLINE:1===this._points.length?(H=new A(y.spatialReference),H.addPath(this._points),this._graphic=y.graphics.add(new p(H,
this.lineSymbol),!0),y.snappingManager&&y.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=D.connect(y,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,H.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol));break;case G.POLYGON:1===this._points.length?(H=new h(y.spatialReference),H.addRing(this._points),this._graphic=y.graphics.add(new p(H,this.fillSymbol),
!0),y.snappingManager&&y.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=D.connect(y,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,H.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol));break;case G.MULTI_POINT:H=this._points;1===H.length?(E=new x(y.spatialReference),E.addPoint(H[H.length-1]),this._graphic=y.graphics.add(new p(E,this.markerSymbol),
!0),y.snappingManager&&y.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(H[H.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case G.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],E.x,E.y);break;case G.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],E.x,E.y);break;case G.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,
12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],E.x,E.y);break;case G.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],E.x,E.y);break;case G.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],E.x,E.y);break;case G.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],E.x,E.y);break;case G.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],E.x-48,E.y+48);break;case G.CIRCLE:this._clear();
this.onDrawStart();this._drawEnd(h.createCircle({center:E,r:48,numberOfPoints:60,map:y}));break;case G.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(h.createEllipse({center:E,longAxis:48,shortAxis:24,numberOfPoints:60,map:y}))}this._setTooltipMessage(this._points.length)},_addShape:function(y,H,E){this._setTooltipMessage(0);this._clear();this.onDrawStart();this._drawEnd(this._toPolygon(y,H,E))},_toPolygon:function(y,H,E){var G=this.map,O=new h(G.spatialReference);O.addRing(F.map(y,function(L){return G.toMap({x:L[0]+
H,y:L[1]+E})}));return O},_onDblClickHandler:function(y){var H=this._points,E=this.map.spatialReference,G=t;u("esri-touch")&&H.push(y.mapPoint);var O=H[H.length-1],L=H[H.length-2];H=O&&L&&O.x===L.x&&O.y===L.y?H.slice(0,H.length-1):H.slice(0,H.length);switch(this._geometryType){case G.POLYLINE:if(!this._graphic||2>H.length){D.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(y);return}var N=new A(E);N.addPath([].concat(H));break;case G.POLYGON:if(!this._graphic||3>H.length)return;
N=new h(E);y=[].concat(H,[H[0].offset(0,0)]);h.prototype.isClockwise(y)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),y.reverse());N.addRing(y);break;case G.MULTI_POINT:N=new x(E),F.forEach(H,function(T){N.addPoint(T)})}D.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(N)},_onKeyDownHandler:function(y){y.keyCode===w.ESCAPE&&(D.disconnect(this._onMouseMoveHandler_connect),
this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(y){this._options.showTooltips&&(y?this._tooltip||(this._tooltip=f.create("div",{"class":"esriMapTooltip"},this.map.container),n.isBodyLtr()||c.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=D.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=D.connect(this.map,
"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=D.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(D.disconnect(this._onTooltipMouseEnterHandler_connect),D.disconnect(this._onTooltipMouseLeaveHandler_connect),D.disconnect(this._onTooltipMouseMoveHandler_connect),f.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var y=this._tooltip;y&&(y.style.display="none")},_setTooltipMessage:function(y){var H=this._tooltip;if(H){var E="";switch(this._geometryType){case t.POINT:E=
e.toolbars.draw.addPoint;break;case t.ARROW:case t.LEFT_ARROW:case t.RIGHT_ARROW:case t.UP_ARROW:case t.DOWN_ARROW:case t.TRIANGLE:case t.RECTANGLE:case t.CIRCLE:case t.ELLIPSE:E=e.toolbars.draw.addShape;break;case t.LINE:case t.EXTENT:case t.FREEHAND_POLYLINE:case t.FREEHAND_POLYGON:E=e.toolbars.draw.freehand;break;case t.POLYLINE:case t.POLYGON:E=e.toolbars.draw.start;1===y?E=e.toolbars.draw.resume:2<=y&&(E=e.toolbars.draw.complete);break;case t.MULTI_POINT:E=e.toolbars.draw.addMultipoint,1<=y&&
(E=e.toolbars.draw.finish)}H.innerHTML=E}},_updateTooltip:function(y){var H=this._tooltip;if(H){if(y.clientX||y.pageY){var E=y.clientX;y=y.clientY}else E=y.clientX+m.body().scrollLeft-m.body().clientLeft,y=y.clientY+m.body().scrollTop-m.body().clientTop;H.style.display="none";c.set(H,{left:E+this._options.tooltipOffset+"px",top:y+"px"});H.style.display=""}},_redrawGraphic:function(y,H,E,G){(E||this.map.wrapAround180)&&(y=this._graphic)&&y.setGeometry(y.geometry)},onActivate:function(){},onDeactivate:function(){},
onDrawComplete:function(){},onDrawStart:function(){},onDrawEnd:function(){}});I.mixin(t,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});u("extend-esri")&&I.setObject("toolbars.Draw",t,q);return t})},
"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(M,I,F,D,v){M=M([v],{declaredClass:"esri.toolbars._Toolbar",constructor:function(m){this.map=m},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(m,u,r,w){var f=this.map;m&&(this._mapNavState=
{isDoubleClickZoom:f.isDoubleClickZoom,isClickRecenter:f.isClickRecenter,isPan:f.isPan,isRubberBandZoom:f.isRubberBandZoom,isKeyboardNavigation:f.isKeyboardNavigation,isScrollWheelZoom:f.isScrollWheelZoom},f.disableDoubleClickZoom(),f.disableClickRecenter(),f.disablePan(),f.disableRubberBandZoom(),f.disableKeyboardNavigation());u&&f.hideZoomSlider();r&&f.hidePanArrows();w&&f.graphics.disableMouseEvents()},_activateMapTools:function(m,u,r,w){var f=this.map,c=this._mapNavState;m&&c&&(c.isDoubleClickZoom&&
f.enableDoubleClickZoom(),c.isClickRecenter&&f.enableClickRecenter(),c.isPan&&f.enablePan(),c.isRubberBandZoom&&f.enableRubberBandZoom(),c.isKeyboardNavigation&&f.enableKeyboardNavigation(),c.isScrollWheelZoom&&f.enableScrollWheelZoom());u&&f.showZoomSlider();r&&f.showPanArrows();w&&f.graphics.enableMouseEvents()},_deactivateScrollWheel:function(){var m=this.map;this._scrollWheelState={isScrollWheelZoom:m.isScrollWheelZoom,isScrollWheelPan:m.isScrollWheelPan};m.disableScrollWheelZoom();m.disableScrollWheelPan()},
_activateScrollWheel:function(){var m=this.map,u=this._scrollWheelState;u&&(u.isScrollWheelZoom&&m.enableScrollWheelZoom(),u.isScrollWheelPan&&m.enableScrollWheelPan())}});F("extend-esri")&&I.setObject("toolbars._Toolbar",M,D);return M})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a,b,k,g,p,B,J){var A=I(q,{declaredClass:"esri.toolbars.Edit",constructor:function(h,x){this._map=h;this._tool=0;if(this._map.loaded)this._scratchGL=h.graphics;else var z=D.connect(this._map,"onLoad",this,function(){D.disconnect(z);z=null;this._scratchGL=this._map.graphics});h=u("esri-mobile");this._defaultOptions=F.mixin({vertexSymbol:new g(g.STYLE_CIRCLE,h?20:12,new p(p.STYLE_SOLID,new m([0,0,0,.5]),1),new m([128,128,128])),ghostVertexSymbol:new g(g.STYLE_CIRCLE,
h?18:10,new p(p.STYLE_SOLID,new m([0,0,0,.5]),1),new m([255,255,255,.75])),ghostLineSymbol:new p(p.STYLE_DOT,new m([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:h?24:16,boxLineSymbol:new p(p.STYLE_DASH,new m([64,64,64]),1),boxHandleSymbol:new g(g.STYLE_SQUARE,h?16:9,new p(p.STYLE_SOLID,new m([0,0,0,.5]),1),new m([255,255,255,.75])),textAnchorSymbol:new g(g.STYLE_CIRCLE,10,null,new m([255,0,0]))},x||{})},activate:function(h,x,z){this.deactivate();this._graphic=x;this._options=
F.mixin(F.mixin({},this._defaultOptions),z||{});var e=A.MOVE;z=A.EDIT_VERTICES;var t=A.SCALE,y=A.ROTATE,H=A.EDIT_TEXT,E=!1,G=!1,O=!1,L=this._map,N=L.spatialReference,T=x.geometry.spatialReference;this._geo=!(!N||!T||N.equals(T)||!N.isWebMercator()||4326!==T.wkid);this._isTextPoint=this._prepareTextSymbolEditing(x,h);(h&e)===e&&(E=this._enableMove(x));e=(h&t)===t;y=(h&y)===y;if(e||y)O=this._enableBoxEditing(x,e,y);(h&z)===z&&(G=this._enableVertexEditing(x));(h&H)===H&&this._enableTextEditing(x);if(!(E||
G||O))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=h)this._mapPanEndHandle=D.connect(L,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=D.connect(L,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,x);L.snappingManager&&(E||G)&&L.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var h=this._tool,x=this._graphic;if(h){var z=
!!this._modified;this._clear();D.disconnect(this._mapPanEndHandle);D.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(h,x,{isModified:z});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(h,x){},onDeactivate:function(h,x,z){},
onGraphicMoveStart:function(h){},onGraphicFirstMove:function(h){this._modified=!0},onGraphicMove:function(h,x){},onGraphicMoveStop:function(h,x){},onGraphicClick:function(h,x){},onVertexMoveStart:function(h,x){},onVertexFirstMove:function(h,x){this._modified=!0},onVertexMove:function(h,x,z){},onVertexMoveStop:function(h,x,z){},onVertexAdd:function(h,x){this._modified=!0},onVertexClick:function(h,x){},onVertexMouseOver:function(h,x){},onVertexMouseOut:function(h,x){},onVertexDelete:function(h,x){this._modified=
!0},onTextEditStart:function(h,x){},onTextEditEnd:function(h){},onScaleStart:function(h){},onScaleFirstMove:function(h){this._modified=!0},onScale:function(h,x){},onScaleStop:function(h,x){},onRotateStart:function(h){},onRotateFirstMove:function(h){this._modified=!0},onRotate:function(h,x){},onRotateStop:function(h,x){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(h,x){if("point"===h.geometry.type||"multipoint"===h.geometry.type){var z=h.getLayer(),e=z.renderer;z=h.symbol||z._getSymbol(h);!z&&(e.hasVisualVariables("sizeInfo",!1)||e.hasVisualVariables("colorInfo",!1)||e.hasVisualVariables("opacityInfo",!1))&&e.addBreak&&
e.infos&&1===e.infos.length&&(z=e.infos[0].symbol||e.defaultSymbol);if(z&&"textsymbol"===z.type){if((x&A.SCALE)===A.SCALE||(x&A.ROTATE)===A.ROTATE||(x&A.EDIT_TEXT)===A.EDIT_TEXT){h.setSymbol(new B(z.toJson()));var t=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(h),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){t._boxEditor&&t._boxEditor.refresh()})):
M(["../dijit/SymbolEditor"],function(y){if(!t._textSymbolEditor){var H=t._options.textSymbolEditorHolder?r.create("div",null,t._options.textSymbolEditorHolder):r.create("div",null,t._map.root);t._textSymbolEditor=new y({graphic:h},H);y=t._textSymbolEditor.domNode.parentNode.id;w.set(t._textSymbolEditor.domNode,{position:"map_root"===y?"absolute":"relative",left:"map_root"===y?t._map.width/2-100+"px":"5px",top:"20px","z-index":50});t._textSymbolEditor.startup();t._textSymbolEditor.createForm(h);t._textSymbolEditor.show();
t._textSymbolEditor.on("symbol-change",function(){t._boxEditor&&t._boxEditor.refresh()})}})}if((x&A.MOVE)===A.MOVE||(x&A.ROTATE)===A.ROTATE||(x&A.SCALE)===A.SCALE)this._textAnchor=new J(h.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(h){var x=this._map;switch(h.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new a(h,x,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(h){var x=
this._map;switch(h.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=b.create(h,x,this),!0}return!1},_enableBoxEditing:function(h,x,z){var e=this._map,t=h.geometry.type;return"polyline"===t||"polygon"===t||this._isTextPoint?(this._boxEditor=new d(h,e,this,x,z,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(h){return this._isTextPoint?(this._textEditor=new k(h,this._map,this),D.connect(this._textEditor,"onEditStart",F.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var h=this._graphicMover;h&&(h.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var h=this._vertexEditor;h&&(h.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var h=this._boxEditor;h&&(h.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(h,x,z){z&&this._refreshMoveables()},_refreshMoveables:function(h){var x=v.filter([this._graphicMover,this._vertexEditor,this._boxEditor],c.isDefined);v.forEach(x,function(z){z.refresh(h)})},_beginOperation:function(h){v.forEach(this._getAffectedTools(h),function(x){x.suspend()})},_endOperation:function(h){v.forEach(this._getAffectedTools(h),function(x){x.resume()})},_getAffectedTools:function(h){var x=[];switch(h){case "MOVE":x=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":x=[this._boxEditor];break;case "BOX":x=[this._vertexEditor]}return x=v.filter(x,c.isDefined)}});F.mixin(A,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});u("extend-esri")&&F.setObject("toolbars.Edit",A,f);return A})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a,b,k){M=M(null,{declaredClass:"esri.toolbars._Box",constructor:function(g,p,B,J,A,h,x){this._graphic=g;this._map=p;this._toolbar=B;this._scale=J;this._rotate=A;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=h;g=B._options;this._markerSymbol=g.boxHandleSymbol;this._lineSymbol=g.boxLineSymbol;this._moveStartHandler=I.hitch(this,this._moveStartHandler);this._firstMoveHandler=I.hitch(this,this._firstMoveHandler);
this._moveStopHandler=I.hitch(this,this._moveStopHandler);this._moveHandler=I.hitch(this,this._moveHandler);this._isTextPoint=x;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){F.forEach(this._getAllGraphics(),function(g){g.hide()})},resume:function(){F.forEach(this._getAllGraphics(),function(g){g.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
F.forEach(this._connects,D.disconnect);var g=this._toolbar._scratchGL;this._anchors&&F.forEach(this._anchors,function(p){g.remove(p.graphic);(p=p.moveable)&&p.destroy()});this._box&&g.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var g=this._map,p=this._toolbar._scratchGL,B=this._getBoxCoords(),J=new q(g.spatialReference),A=I.clone(F.filter(B,function(h,x){return 8!==x&&0===x%2}));A[0]&&A.push([A[0][0],A[0][1]]);J.addPath(A);this._rotate&&
J.addPath([B[1],B[8]]);this._box?this._box.setGeometry(J):(this._box=new k(J,this._lineSymbol),p.add(this._box));this._anchors?F.forEach(this._anchors,function(h,x){this._scale||(x=8);var z=new n(B[x],g.spatialReference);h.graphic.setGeometry(z);z=h.moveable;var e=h.graphic.getDojoShape();e&&(z?e!==z.shape&&(z.destroy(),h.moveable=this._getMoveable(h.graphic,x)):h.moveable=this._getMoveable(h.graphic,x))},this):(this._anchors=[],this._connects=[],F.forEach(B,function(h,x){!this._scale&&8>x||(h=new n(h,
g.spatialReference),h=new k(h,this._markerSymbol),this._isTextPoint&&1===x%2&&h.hide(),p.add(h),this._anchors.push({graphic:h,moveable:this._getMoveable(h,x)}))},this))}else this._cleanUp()},_getBoxCoords:function(g){var p=this._map,B=[],J,A,h;if(this._isTextPoint){var x=this._graphic.getNode().getBoundingClientRect();var z=p.__container.getBoundingClientRect();x=[{x:x.left-z.left,y:x.top-z.top},{x:x.right-z.left,y:x.top-z.top},{x:x.right-z.left,y:x.bottom-z.top},{x:x.left-z.left,y:x.bottom-z.top}]}else x=
this._getTransformedBoundingBox(this._graphic);F.forEach(x,function(e,t,y){J=e;(A=y[t+1])||(A=y[0]);h={x:(J.x+A.x)/2,y:(J.y+A.y)/2};g||(J=p.toMap(J),h=p.toMap(h));B.push([J.x,J.y]);B.push([h.x,h.y])});this._rotate&&(x=I.clone(B[1]),x=g?{x:x[0],y:x[1]}:p.toScreen({x:x[0],y:x[1],spatialReference:p.spatialReference}),x.y-=this._toolbar._options.rotateHandleOffset,g||(x=p.toMap(x)),B.push([x.x,x.y]));return B},_getTransformedBoundingBox:function(g){var p=this._map,B=g.geometry.getExtent(),J=g.geometry.spatialReference;
g=new n(B.xmin,B.ymax,J);B=new n(B.xmax,B.ymin,J);g=p.toScreen(g);B=p.toScreen(B);return[{x:g.x,y:g.y},{x:B.x,y:g.y},{x:B.x,y:B.y},{x:g.x,y:B.y}]},_getAllGraphics:function(){var g=[this._box];this._anchors&&F.forEach(this._anchors,function(p){g.push(p.graphic)});return g=F.filter(g,c.isDefined)},_getMoveable:function(g,p){var B=g.getDojoShape();if(B)return g=new r(B),g._index=p,this._connects.push(D.connect(g,"onMoveStart",this._moveStartHandler)),this._connects.push(D.connect(g,"onFirstMove",this._firstMoveHandler)),
this._connects.push(D.connect(g,"onMoveStop",this._moveStopHandler)),g.onMove=this._moveHandler,(B=B.getEventSource())&&u.set(B,"cursor",this._toolbar._cursors["box"+p]),g},_moveStartHandler:function(g){this._toolbar["on"+(8===g.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(g){this._toolbar._deactivateScrollWheel();var p=g.host._index,B=this._wrapOffset=g.host.shape._wrapOffsets[0]||0,J=this._graphic.getLayer().getNavigationTransform();g=F.map(this._getBoxCoords(!0),
function(h){return{x:h[0]+B,y:h[1]}});var A=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:g[1].x,y:g[3].y};this._centerCoord=w.multiplyPoint(w.invert(J),A);if(8===p)A=w.multiplyPoint(w.invert(J),g[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,A)),this._startLine=[this._centerCoord,A],this._moveLine=I.clone(this._startLine);else if(A=w.multiplyPoint(w.invert(J),g[p]),J=w.multiplyPoint(w.invert(J),g[(p+4)%8]),this._isTextPoint&&(this._centerCoord=
this._deNormalizePoint(this._centerCoord,A)),this._firstMoverToAnchor=Math.sqrt((A.x-this._centerCoord.x)*(A.x-this._centerCoord.x)+(A.y-this._centerCoord.y)*(A.y-this._centerCoord.y)),this._startBox=J,this._startBox.width=g[4].x-g[0].x,this._startBox.height=g[4].y-g[0].y,this._moveBox=I.clone(this._startBox),this._xfactor=A.x>J.x?1:-1,this._yfactor=A.y>J.y?1:-1,1===p||5===p)this._xfactor=0;else if(3===p||7===p)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===p?this._rotateEvent:
this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(g,p){g=g.host._index;var B=this._defaultEventArgs;B.angle=0;B.scaleX=1;B.scaleY=1;if(8===g){var J=this._startLine;var A=this._moveLine;var h=A[1];h.x+=p.dx;h.y+=p.dy;p=this._getAngle(J,A);this._isTextPoint&&(p+=this._graphic.symbol.angle);A=w.rotategAt(p,J[0]);this._graphic.getDojoShape().setTransform(A);B.transform=A;B.angle=p;B.around=J[0]}else{J=this._startBox;A=this._moveBox;A.width+=p.dx*this._xfactor;A.height+=p.dy*this._yfactor;
this._uniformScaling||this._isTextPoint?(J=A.x+this._xfactor*A.width,A=A.y+this._yfactor*A.height,J=Math.sqrt((J-this._centerCoord.x)*(J-this._centerCoord.x)+(A-this._centerCoord.y)*(A-this._centerCoord.y)),this._scaleRatio=p=h=J/this._firstMoverToAnchor,J=this._centerCoord):(p=A.width/J.width,h=A.height/J.height,J={x:J.x,y:J.y});if(isNaN(p)||Infinity===p||-Infinity===p)p=1;if(isNaN(h)||Infinity===h||-Infinity===h)h=1;A=w.scaleAt(p,h,J);if(this._isTextPoint){var x=w.rotategAt(this._graphic.symbol.angle,
J);this._graphic.getDojoShape().setTransform([x,A])}else this._graphic.getDojoShape().setTransform(A);B.transform=A;B.scaleX=p;B.scaleY=h;B.around=J}this._toolbar["on"+(8===g?this._rotateEvent:this._scaleEvent)](this._graphic,B)},_moveStopHandler:function(g){this._toolbar._activateScrollWheel();var p=this._graphic,B=this._toolbar,J=B._geo?a.geographicToWebMercator(p.geometry):p.geometry,A=J.spatialReference,h=p.getDojoShape(),x=h.getTransform(),z=p.getLayer().getNavigationTransform();this._isTextPoint?
(p=this._graphic.symbol,8===g.host._index?p.angle+=this._getAngle(this._startLine,this._moveLine):p.font.setSize(Math.round(p.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(p)):(J=J.toJson(),this._updateSegments(J.paths||J.rings,x,z,A),h.setTransform(null),J=b.fromJson(J),p.setGeometry(B._geo?a.webMercatorToGeographic(J,!0):J));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;B._endOperation("BOX");this._defaultEventArgs.transform=
x;B["on"+(8===g.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(g,p,B,J){var A=this._map,h=this._wrapOffset||0;F.forEach(g,function(x){F.forEach(x,function(z){this._updatePoint(z,J,h,w,A,B,p)},this)},this)},_updatePoint:function(g,p,B,J,A,h,x){p=A.toScreen({x:g[0],y:g[1],spatialReference:p},!0);p.x+=B;p=J.multiplyPoint([h,x,J.invert(h)],p);p.x-=B;B=A.toMap(p);g[0]=B.x;g[1]=B.y},_getAngle:function(g,p){return 180*Math.atan2(p[0].y-
p[1].y,p[0].x-p[1].x)/Math.PI-180*Math.atan2(g[0].y-g[1].y,g[0].x-g[1].x)/Math.PI},_deNormalizePoint:function(g,p){var B=this._map._getFrameWidth();if(-1===B)return g;for(g={x:g.x,y:g.y};Math.abs(g.x-p.x)>=B;)g.x=g.x<p.x?g.x+B:g.x-B;var J=Math.abs(g.x-p.x);Math.abs(g.x-p.x+B)<J?g.x+=B:Math.abs(g.x-p.x-B)<J&&(g.x-=B);return g}});m("extend-esri")&&I.setObject("toolbars._Box",M,f);return M})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(M,I,F,D,v,m,u,r,w,f){return I("dojox.gfx.Moveable",null,{constructor:function(c,n){this.shape=c;this.delay=n&&0<n.delay?n.delay:0;this.mover=n&&n.mover?n.mover:w;this.leftButtonOnly=n&&n.leftButtonOnly;this.events=[this.shape.on(m.press,M.hitch(this,"onMouseDown"))]},destroy:function(){F.forEach(this.events,function(c){c.remove()});this.events=this.shape=null},onMouseDown:function(c){this.delay?(this.events.push(this.shape.on(m.move,M.hitch(this,"onMouseMove")),this.shape.on(m.release,M.hitch(this,
"onMouseUp"))),this._lastX=c.clientX,this._lastY=c.clientY):this.leftButtonOnly&&!f.isLeft(c)||new this.mover(this.shape,c,this);D.stop(c)},onMouseMove:function(c){var n=c.clientY;if(Math.abs(c.clientX-this._lastX)>this.delay||Math.abs(n-this._lastY)>this.delay)this.onMouseUp(c),new this.mover(this.shape,c,this);D.stop(c)},onMouseUp:function(c){this.events.pop().remove()},onMoveStart:function(c){v.publish("/gfx/move/start",c);u.add(r.body(),"dojoMove")},onMoveStop:function(c){v.publish("/gfx/move/stop",
c);u.remove(r.body(),"dojoMove")},onFirstMove:function(c){},onMove:function(c,n,q){this.onMoving(c,n,q);this.shape.applyLeftTransform(n);this.onMoved(c,n)},onMoving:function(c,n){},onMoved:function(c,n){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(M,I,F,D,v,m){return F("dojox.gfx.Mover",null,{constructor:function(u,r,w){this.shape=u;this.lastX=r.clientX;this.lastY=r.clientY;u=this.host=w;r=
document;w=D(r,v.move,M.hitch(this,"onFirstMove"));this.events=[D(r,v.move,M.hitch(this,"onMouseMove")),D(r,v.release,M.hitch(this,"destroy")),D(r,"dragstart",M.hitch(m,"stop")),D(r,"selectstart",M.hitch(m,"stop")),w];if(u&&u.onMoveStart)u.onMoveStart(this)},onMouseMove:function(u){var r=u.clientX,w=u.clientY;this.host.onMove(this,{dx:r-this.lastX,dy:w-this.lastY},u);this.lastX=r;this.lastY=w;m.stop(u)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){I.forEach(this.events,
function(r){r.remove()});var u=this.host;if(u&&u.onMoveStop)u.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n,q,d){var a=M(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(b,k,g,p){this.graphic=b;this.map=k;this.toolbar=g;this.tempPt=p;this._enableGraphicMover();this._moved=!1},refresh:function(b){var k=this.graphic.getDojoShape();!k||!b&&k._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var b=this.graphic,k=b.getDojoShape();k&&(k._hostGraphic=b,this._moveable=new m(k,{mover:a.Mover}),this._moveStartHandle=
F.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=F.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=F.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=F.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(b=k.getEventSource())&&v.set(b,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var b=this._moveable;if(b){F.disconnect(this._moveStartHandle);F.disconnect(this._firstMoveHandle);
F.disconnect(this._movingHandle);F.disconnect(this._moveStopHandle);var k=b.shape;k&&(k._hostGraphic=null,(k=k.getEventSource())&&v.set(k,"cursor","inherit"));b.destroy()}this._moveable=null},_moveStartHandler:function(){var b=this.graphic,k=this.map;this._startTx=b.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&k.snappingManager&&k.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(b)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(b,k,g){b=b.shape.getTransform();k=this.map;var p;c("esri-pointer")?p=k.navigationManager.pointerEvents._processTouchEvent(g,g):g&&"pointermove"===g.type&&(p=f.prototype._processTouchEvent.call({map:k},g,g));p&&k.snappingManager&&k.snappingManager._onSnappingMouseMoveHandler(p);this.tempPt&&this.tempPt.getDojoShape().setTransform(b);this.toolbar.onGraphicMove(this.graphic,b)},_moveStopHandler:function(b){var k=this.graphic,g=this.toolbar,p=this.map,B=g._geo?n.geographicToWebMercator(k.geometry):
k.geometry,J=B.type,A=k.getDojoShape(),h=A.getTransform();if(D.toJson(h)!==D.toJson(this._startTx)){this._moved=!0;switch(J){case "point":J=[h,r.invert(this._startTx)];if(p.snappingManager)var x=p.snappingManager._snappingPoint;B=x||p.toMap(r.multiplyPoint(J,p.toScreen(B,!0)));p.snappingManager&&p.snappingManager._killOffSnapping();break;case "polyline":B=this._updatePolyGeometry(B,B.paths,h);break;case "polygon":B=this._updatePolyGeometry(B,B.rings,h)}A.setTransform(null);k.setGeometry(g._geo?n.webMercatorToGeographic(B,
!0):B);this.tempPt&&this.tempPt.setGeometry(new d(k.geometry.toJson()))}else this._moved=!1;g._endOperation("MOVE");g.onGraphicMoveStop(k,h);this._moved||(b=b.__e,p=this.map.position,b=new q(b.pageX-p.x,b.pageY-p.y),g.onGraphicClick(k,{screenPoint:b,mapPoint:this.map.toMap(b)}))},_updatePolyGeometry:function(b,k,g){var p=this.map,B=b.getPoint(0,0);p=p.toMap(p.toScreen(B).offset(g.dx,g.dy));g=p.x-B.x;B=p.y-B.y;var J;for(p=0;p<k.length;p++){var A=k[p];for(J=0;J<A.length;J++){var h=b.getPoint(p,J);b.setPoint(p,
J,h.offset(g,B))}}return b}});a.Mover=M(u,{declaredClass:"esri.toolbars._Mover",constructor:function(b,k,g){this.__e=k}});c("extend-esri")&&(I.setObject("toolbars._GraphicMover",a,w),I.setObject("toolbars._Mover",a.Mover,w));return a})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(M,
I,F,D,v,m,u,r,w,f,c,n){var q=M(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(d,a,b){this.graphic=d;this.map=a;this.toolbar=b;d=b._options;this._symbol1=d.vertexSymbol;this._symbol2=d.ghostVertexSymbol;a=d.ghostLineSymbol;this._lineStroke={style:a.style,width:a.width,color:a.color};this._canDel=d.allowDeleteVertices;this._canAdd=d.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(d){d?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=F.connect(w,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=F.connect(w,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var d=this._getGraphicsLayer();this._mouseOverHandle=F.connect(d,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=F.connect(d,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new m({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),d=this._ctxDelete=new u({label:n.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
F.connect(d,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(d),this._ctxMenu.startup())},_removeControllers:function(){F.disconnect(this._firstMoveHandle);F.disconnect(this._moveStopHandle);F.disconnect(this._mouseOverHandle);F.disconnect(this._mouseOutHandle);F.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(d,a,b){var k,g,p=this.graphic,B=[];for(k=0;k<d.length;k++){var J=d[k],A=[];for(g=0;g<J.length;g++)A.push(new w(J[g],a,p,k,g,J.length,this,b));B.push(A)}return B},_remove:function(d){d&&D.forEach(d,function(a){D.forEach(a,function(b){b.destroy()})})},_refresh:function(d){d&&D.forEach(d,function(a){D.forEach(a,function(b){b.refresh()})})},_isNew:function(d){return-1===D.indexOf(this._vertexMovers[d.segIndex],d)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(d){d=this._selectedMover;this._updateRelatedGraphic(d,d.relatedGraphic,d.graphic.geometry,d.segIndex,d.ptIndex,d.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(d);this._deleteVertex(d);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(d){d=d.graphic;var a=this._findMover(d);a&&(this.toolbar.onVertexMouseOver(this.graphic,a._getInfo()),a._placeholder||(this._selectedMover=a,this._canDel&&this._bindCtxNode(d.getDojoShape().getNode())))},_mouseOutHandler:function(d){if(d=
this._findMover(d.graphic))this.toolbar.onVertexMouseOut(this.graphic,d._getInfo())},_bindCtxNode:function(d){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(d);this._bindNode=d},_unbindCtxNode:function(){var d=this._bindNode;d&&this._ctxMenu.unBindDomNode(d)},_findMover:function(d){var a=[];var b=this._mpVertexMovers;D.forEach(this._vertexMovers,function(g){a=a.concat(g)});b&&D.forEach(b,function(g){a=a.concat(g)});
for(b=0;b<a.length;b++){var k=a[b];if(k.graphic===d)return k}},_firstMoveHandler:function(d){!this._isNew(d)&&this._canAdd&&this._hideRelatedMidpoints(d);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(d,a){var b=this._isNew(d);a&&(a.dx||a.dy)?(this._updateRelatedGraphic(d,d.relatedGraphic,d.graphic.geometry,d.segIndex,d.ptIndex,d.segLength,b),this._canAdd&&(b?this._addMidpoints(d):(this._repositionRelatedMidpoints(d),this._showRelatedMidpoints(d))),this.toolbar._endOperation("VERTICES")):
!b&&this._canAdd&&this._showRelatedMidpoints(d)},_showRelatedMidpoints:function(d){var a=this._getAdjacentMidpoints(d.ptIndex,d.segLength),b=this._mpVertexMovers[d.segIndex];for(d=0;d<a.length;d++){var k=b[a[d]];k.graphic.show();k.refresh()}},_hideRelatedMidpoints:function(d){var a=this._getAdjacentMidpoints(d.ptIndex,d.segLength),b=this._mpVertexMovers[d.segIndex];for(d=0;d<a.length;d++)b[a[d]].graphic.hide()},_repositionRelatedMidpoints:function(d){var a,b=this._getAdjacentMidpoints(d.ptIndex,d.segLength),
k=this._mpVertexMovers[d.segIndex];for(a=0;a<b.length;a++){var g=this._getAdjacentVertices(b[a],d.segLength),p=d.relatedGraphic.geometry.getPoint(d.segIndex,g[0]);g=d.relatedGraphic.geometry.getPoint(d.segIndex,g[1]);p=new f({x:(p.x+g.x)/2,y:(p.y+g.y)/2,spatialReference:p.spatialReference.toJson()});k[b[a]].graphic.setGeometry(p)}},_addMidpoints:function(d){var a=d.segIndex,b=d.ptIndex,k=d.segLength,g=b+1,p,B=k+1;this._mpVertexMovers[a].splice(b,1);var J=this._vertexMovers[a];for(p=0;p<g;p++)J[p].segLength+=
1;for(p=g;p<J.length;p++)J[p].ptIndex+=1,J[p].segLength+=1;d.ptIndex=g;d.segLength=J.length+1;J.splice(g,0,d);d.graphic.setSymbol(this._symbol1);J=this._mpVertexMovers[a];for(p=0;p<b;p++)J[p].segLength+=1;for(p=b;p<k-1;p++)J[p].ptIndex+=1,J[p].segLength+=1;g=this._getAdjacentVertices(b,B);a=this._getAdjacentVertices(b+1,B);k=d.relatedGraphic.geometry.getPoint(d.segIndex,g[0]);p=d.relatedGraphic.geometry.getPoint(d.segIndex,g[1]);g=new f({x:(k.x+p.x)/2,y:(k.y+p.y)/2,spatialReference:k.spatialReference.toJson()});
k=d.relatedGraphic.geometry.getPoint(d.segIndex,a[0]);p=d.relatedGraphic.geometry.getPoint(d.segIndex,a[1]);a=new f({x:(k.x+p.x)/2,y:(k.y+p.y)/2,spatialReference:k.spatialReference.toJson()});k=new w(g,this._symbol2,this.graphic,d.segIndex,b,B,this,!0);d=new w(a,this._symbol2,this.graphic,d.segIndex,b+1,B,this,!0);J.splice(b,0,k,d)},_deleteVertex:function(d){var a,b=d.ptIndex,k=this._vertexMovers[d.segIndex];for(a=0;a<b;a++)--k[a].segLength;for(a=b+1;a<k.length;a++){var g=k[a];--g.ptIndex;--g.segLength}k.splice(b,
1);a=d._getInfo();d.destroy();this.toolbar.onVertexDelete(this.graphic,a)}});I.mixin(q,{create:function(d,a,b){switch(d.geometry.type){case "multipoint":return new q.MultipointVertexEditor(d,a,b);case "polyline":return new q.PolylineVertexEditor(d,a,b);case "polygon":return new q.PolygonVertexEditor(d,a,b)}}});q.MultipointVertexEditor=M(q,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=F.connect(w,"onMoveStart",this,this._moveStartHandler);
F.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);F.disconnect(this._moveStartHandle)},_getSegments:function(d){var a=d.points,b=[],k=d.spatialReference;for(d=0;d<a.length;d++){var g=a[d];b.push(new f({x:g[0],y:g[1],spatialReference:k.toJson()}))}return[b]},_getMidpointSegments:function(d){return[]},_getControlPoints:function(d,a,b,k,g){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(d){var a=d.graphic;if(d=this._findMover(d))this.toolbar.onVertexMouseOver(a,
d._getInfo()),this._selectedMover=d,this._canDel&&this._bindCtxNode(d.graphic.getDojoShape().getNode())},_mouseOutHandler:function(d){var a=d.graphic;if(d=this._findMover(d))this.toolbar.onVertexMouseOut(a,d._getInfo())},_findMover:function(d){var a=[].concat(this._vertexMovers[0]),b=d.target;for(d=0;d<a.length;d++){var k=a[d];if(k.graphic.getDojoShape().getNode()===b)return k}},_moveStartHandler:function(d){var a=d.ptIndex,b=d.segLength-1,k=d.relatedGraphic.geometry.points;d=k.splice(a,1);k.push(d[0]);
k=this._vertexMovers[0];for(d=b;d>a;d--)--k[d].ptIndex;d=k.splice(a,1);k.push(d[0]);d[0].ptIndex=b},_moveStopHandler:function(d){this._updateRelatedGraphic(d,d.relatedGraphic,d.graphic.geometry,d.segIndex,d.ptIndex,d.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(d,a,b,k,g,p,B,J){d=a.geometry;J?d.removePoint(g):d.setPoint(g,b);a.setGeometry(d)},_deleteMidpoints:function(d){}});q.PolylineVertexEditor=M(q,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(d){var a,b,k=d.paths,g=[];for(a=0;a<k.length;a++){var p=k[a],B=[];for(b=0;b<p.length;b++)B.push(d.getPoint(a,b));g.push(B)}return g},_getMidpointSegments:function(d){var a,b,k=d.paths,g=[],p=d.spatialReference;for(a=0;a<k.length;a++){var B=k[a],J=[];for(b=0;b<B.length-1;b++){var A=d.getPoint(a,b),h=d.getPoint(a,b+1);A=new f({x:(A.x+h.x)/2,y:(A.y+h.y)/2,spatialReference:p.toJson()});J.push(A)}g.push(J)}return g},_getControlPoints:function(d,a,b,k,g){var p=this.map,B,J;this._isNew(d)?
(d=k,k+=1,0<=d&&(B=p.toScreen(a.getPoint(b,d))),k<=g&&(J=p.toScreen(a.getPoint(b,k)))):(d=k-1,k+=1,0<=d&&(B=p.toScreen(a.getPoint(b,d))),k<g&&(J=p.toScreen(a.getPoint(b,k))));return[B,J]},_getAdjacentMidpoints:function(d,a){var b=[],k=d-1;0<=k&&b.push(k);d<a-1&&b.push(d);return b},_getAdjacentVertices:function(d,a){return[d,d+1]},_deleteMidpoints:function(d){var a=this._mpVertexMovers[d.segIndex],b=a.length-1,k=this._getAdjacentMidpoints(d.ptIndex,d.segLength).sort(),g,p=k[0];for(g=0;g<p;g++)--a[g].segLength;
for(g=p+1;g<a.length;g++){var B=a[g];--B.ptIndex;--B.segLength}if(1===k.length)a.splice(p,1)[0].destroy();else for(B=this._getAdjacentVertices(p,b),g=d.relatedGraphic.geometry.getPoint(d.segIndex,B[0]),B=d.relatedGraphic.geometry.getPoint(d.segIndex,B[1]),g=new f({x:(g.x+B.x)/2,y:(g.y+B.y)/2,spatialReference:g.spatialReference.toJson()}),d=new w(g,this._symbol2,this.graphic,d.segIndex,p,b,this,!0),a=a.splice(p,k.length,d),g=0;g<a.length;g++)a[g].destroy()},_updateRelatedGraphic:function(d,a,b,k,g,
p,B,J){d=a.geometry;B?d.insertPoint(k,g+1,c.fromJson(b.toJson())):J?d.removePoint(k,g):d.setPoint(k,g,c.fromJson(b.toJson()));a.setGeometry(d)}});q.PolygonVertexEditor=M(q,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(d){var a,b,k=d.rings,g=[];for(a=0;a<k.length;a++){var p=k[a],B=[];for(b=0;b<p.length-1;b++)B.push(d.getPoint(a,b));g.push(B)}return g},_getMidpointSegments:function(d){var a,b,k=d.rings,g=[],p=d.spatialReference;for(a=0;a<k.length;a++){var B=k[a],
J=[];for(b=0;b<B.length-1;b++){var A=d.getPoint(a,b),h=d.getPoint(a,b+1);A=new f({x:(A.x+h.x)/2,y:(A.y+h.y)/2,spatialReference:p.toJson()});J.push(A)}g.push(J)}return g},_getControlPoints:function(d,a,b,k,g){var p=this.map;this._isNew(d)?d=k:(d=k-1,d=0>d?(g+d)%g:d);k=(k+1)%g;g=p.toScreen(a.getPoint(b,d));a=p.toScreen(a.getPoint(b,k));return[g,a]},_getAdjacentMidpoints:function(d,a){var b=d-1;return[0>b?(a+b)%a:b,d]},_getAdjacentVertices:function(d,a){return[d,(d+1)%a]},_deleteMidpoints:function(d){var a=
d.ptIndex,b=this._mpVertexMovers[d.segIndex],k=b.length-1,g=this._getAdjacentMidpoints(a,d.segLength).sort();var p=g[0];var B=g[g.length-1];if(0===a){var J=this._getAdjacentVertices(k-1,k);a=d.relatedGraphic.geometry.getPoint(d.segIndex,J[0]);J=d.relatedGraphic.geometry.getPoint(d.segIndex,J[1]);a=new f({x:(a.x+J.x)/2,y:(a.y+J.y)/2,spatialReference:a.spatialReference.toJson()});d=new w(a,this._symbol2,this.graphic,d.segIndex,k-1,k,this,!0);b.splice(B,1,d)[0].destroy();b.splice(p,1)[0].destroy();for(g=
0;g<b.length-1;g++)p=b[g],--p.ptIndex,--p.segLength}else{J=this._getAdjacentVertices(p,k);a=d.relatedGraphic.geometry.getPoint(d.segIndex,J[0]);J=d.relatedGraphic.geometry.getPoint(d.segIndex,J[1]);a=new f({x:(a.x+J.x)/2,y:(a.y+J.y)/2,spatialReference:a.spatialReference.toJson()});d=new w(a,this._symbol2,this.graphic,d.segIndex,p,k,this,!0);B=b.splice(p,g.length,d);for(g=0;g<B.length;g++)B[g].destroy();for(g=0;g<p;g++)--b[g].segLength;for(g=p+1;g<b.length;g++)p=b[g],--p.ptIndex,--p.segLength}},_updateRelatedGraphic:function(d,
a,b,k,g,p,B,J){d=a.geometry;B?d.insertPoint(k,g+1,c.fromJson(b.toJson())):J?(d.removePoint(k,g),0===g&&d.setPoint(k,p-1,c.fromJson(d.getPoint(k,0).toJson()))):(d.setPoint(k,g,c.fromJson(b.toJson())),0===g&&d.setPoint(k,p,c.fromJson(b.toJson())));a.setGeometry(d)}});v("extend-esri")&&(I.setObject("toolbars._GraphicVertexEditor",q,r),I.setObject("toolbars._MultipointVertexEditor",q.MultipointVertexEditor,r),I.setObject("toolbars._PolylineVertexEditor",q.PolylineVertexEditor,r),I.setObject("toolbars._PolygonVertexEditor",
q.PolygonVertexEditor,r));return q})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a,b){c("dijit-legacy-requires")&&b(0,function(){M(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return F("dijit.Menu",a,{constructor:function(){this._bindings=
[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):I.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(k){return q.get(this._iframeContentDocument(k))||this._iframeContentDocument(k).__parent__||k.name&&document.frames[k.name]||null},_iframeContentDocument:function(k){return k.contentDocument||k.contentWindow&&k.contentWindow.document||
k.name&&document.frames[k.name]&&document.frames[k.name].document||null},bindDomNode:function(k){k=D.byId(k,this.ownerDocument);if("iframe"==k.tagName.toLowerCase()){var g=k;var p=this._iframeContentWindow(g);p=n.body(p.document)}else p=k==n.body(this.ownerDocument)?this.ownerDocument.documentElement:k;var B={node:k,iframe:g};v.set(k,"_dijitMenu"+this.id,this._bindings.push(B));var J=w.hitch(this,function(A){var h=this.selector,x=h?function(e){return f.selector(h,e)}:function(e){return e},z=this;
return[f(A,x(this.leftClickToOpen?"click":"contextmenu"),function(e){e.stopPropagation();e.preventDefault();(new Date).getTime()<z._lastKeyDown+500||z._scheduleOpen(this,g,{x:e.pageX,y:e.pageY},e.target)}),f(A,x("keydown"),function(e){if(93==e.keyCode||e.shiftKey&&e.keyCode==r.F10||z.leftClickToOpen&&e.keyCode==r.SPACE)e.stopPropagation(),e.preventDefault(),z._scheduleOpen(this,g,null,e.target),z._lastKeyDown=(new Date).getTime()})]});B.connects=p?J(p):[];g&&(B.onloadHandler=w.hitch(this,function(){var A=
this._iframeContentWindow(g);A=n.body(A.document);B.connects=J(A)}),g.addEventListener?g.addEventListener("load",B.onloadHandler,!1):g.attachEvent("onload",B.onloadHandler))},unBindDomNode:function(k){try{var g=D.byId(k,this.ownerDocument)}catch(A){return}k="_dijitMenu"+this.id;if(g&&v.has(g,k)){for(var p=v.get(g,k)-1,B=this._bindings[p],J;J=B.connects.pop();)J.remove();(J=B.iframe)&&(J.removeEventListener?J.removeEventListener("load",B.onloadHandler,!1):J.detachEvent("onload",B.onloadHandler));v.remove(g,
k);delete this._bindings[p]}},_scheduleOpen:function(k,g,p,B){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:B,delegatedTarget:k,iframe:g,coords:p})},1))},_openMyself:function(k){function g(){e.refocus&&t&&t.focus();d.close(e)}var p=k.target,B=k.iframe,J=k.coords,A=!J;this.currentTarget=k.delegatedTarget;if(J){if(B){k=m.position(B,!0);p=this._iframeContentWindow(B);p=m.docScroll(p.document);var h=u.getComputedStyle(B),x=u.toPixelValue,z=(c("ie")&&
c("quirks")?0:x(B,h.paddingLeft))+(c("ie")&&c("quirks")?x(B,h.borderLeftWidth):0);B=(c("ie")&&c("quirks")?0:x(B,h.paddingTop))+(c("ie")&&c("quirks")?x(B,h.borderTopWidth):0);J.x+=k.x+z-p.x;J.y+=k.y+B-p.y}}else J=m.position(p,!0),J.x+=10,J.y+=10;var e=this;B=this._focusManager.get("prevNode");k=this._focusManager.get("curNode");var t=!k||D.isDescendant(k,this.domNode)?B:k;d.open({popup:this,x:J.x,y:J.y,onExecute:g,onCancel:g,orient:this.isLeftToRight()?"L":"R"});this.focus();A||this.defer(function(){this._cleanUp(!0)});
this._onBlur=function(){this.inherited("_onBlur",arguments);d.close(this)}},destroy:function(){I.forEach(this._bindings,function(k){k&&this.unBindDomNode(k.node)},this);this.inherited(arguments)}})})},"dijit/popup":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main dojo/touch".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n,
q,d,a,b){function k(){this._popupWrapper&&(m.destroy(this._popupWrapper),delete this._popupWrapper)}F=F(null,{_stack:[],_beginZIndex:1E3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var g=this._firstAroundPosition,p=u.position(this._firstAroundNode,!0),B=p.x-g.x;g=p.y-g.y;if(B||g)for(this._firstAroundPosition=p,p=0;p<this._stack.length;p++){var J=this._stack[p].wrapper.style;J.top=parseFloat(J.top)+g+"px";"auto"==J.right?J.left=parseFloat(J.left)+B+"px":J.right=parseFloat(J.right)-
B+"px"}this._aroundMoveListener=setTimeout(c.hitch(this,"_repositionAll"),B||g?10:50)}},_createWrapper:function(g){var p=g._popupWrapper,B=g.domNode;p||(p=m.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":g["aria-label"]||g.label||g.name||g.id},g.ownerDocumentBody),p.appendChild(B),B=B.style,B.display="",B.visibility="",B.position="",B.top="0px",g._popupWrapper=p,I.after(g,"destroy",k,!0),"ontouchend"in document&&n(p,"touchend",function(J){/^(input|button|textarea)$/i.test(J.target.tagName)||
J.preventDefault()}),p.dojoClick=!0);return p},moveOffScreen:function(g){var p=this._createWrapper(g);g=u.isBodyLtr(g.ownerDocument);var B={visibility:"hidden",top:"-9999px",display:""};B[g?"left":"right"]="-9999px";B[g?"right":"left"]="auto";r.set(p,B);return p},hide:function(g){var p=this._createWrapper(g);r.set(p,{display:"none",height:"auto",overflowY:"visible",border:""});g=g.domNode;"_originalStyle"in g&&(g.style.cssText=g._originalStyle)},getTopPopup:function(){for(var g=this._stack,p=g.length-
1;0<p&&g[p].parent===g[p-1].widget;p--);return g[p]},open:function(g){for(var p=this._stack,B=g.popup,J=B.domNode,A=g.orient||["below","below-alt","above","above-alt"],h=g.parent?g.parent.isLeftToRight():u.isBodyLtr(B.ownerDocument),x=g.around,z=g.around&&g.around.id?g.around.id+"_dropdown":"popup_"+this._idGen++;p.length&&(!g.parent||!D.isDescendant(g.parent.domNode,p[p.length-1].widget.domNode));)this.close(p[p.length-1].widget);var e=this.moveOffScreen(B);B.startup&&!B._started&&B.startup();var t=
u.position(J);if("maxHeight"in g&&-1!=g.maxHeight)var y=g.maxHeight||Infinity;else{y=a.getEffectiveBox(this.ownerDocument);var H=x?u.position(x,!1):{y:g.y-(g.padding||0),h:2*(g.padding||0)};y=Math.floor(Math.max(H.y,y.h-(H.y+H.h)))}t.h>y&&(t=r.getComputedStyle(J),r.set(e,{overflowY:"scroll",height:y+"px",border:t.borderLeftWidth+" "+t.borderLeftStyle+" "+t.borderLeftColor}),J._originalStyle=J.style.cssText,J.style.border="none");v.set(e,{id:z,style:{zIndex:this._beginZIndex+p.length},"class":"dijitPopup "+
(B.baseClass||B["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:g.parent?g.parent.id:""});0==p.length&&x&&(this._firstAroundNode=x,this._firstAroundPosition=u.position(x,!0),this._aroundMoveListener=setTimeout(c.hitch(this,"_repositionAll"),50));w("config-bgIframe")&&!B.bgIframe&&(B.bgIframe=new d(e));z=B.orient?c.hitch(B,"orient"):null;A=x?q.around(e,x,A,h,z):q.at(e,g,"R"==A?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],g.padding,z);e.style.visibility="visible";J.style.visibility="visible";J=
[];J.push(n(e,"keydown",c.hitch(this,function(E){if(E.keyCode==f.ESCAPE&&g.onCancel)E.stopPropagation(),E.preventDefault(),g.onCancel();else if(E.keyCode==f.TAB&&(E.stopPropagation(),E.preventDefault(),(E=this.getTopPopup())&&E.onCancel))E.onCancel()})));B.onCancel&&g.onCancel&&J.push(B.on("cancel",g.onCancel));J.push(B.on(B.onExecute?"execute":"change",c.hitch(this,function(){var E=this.getTopPopup();if(E&&E.onExecute)E.onExecute()})));p.push({widget:B,wrapper:e,parent:g.parent,onExecute:g.onExecute,
onCancel:g.onCancel,onClose:g.onClose,handlers:J});if(B.onOpen)B.onOpen(A);return A},close:function(g){for(var p=this._stack;g&&M.some(p,function(x){return x.widget==g})||!g&&p.length;){var B=p.pop(),J=B.widget,A=B.onClose;J.bgIframe&&(J.bgIframe.destroy(),delete J.bgIframe);if(J.onClose)J.onClose();for(var h;h=B.handlers.pop();)h.remove();J&&J.domNode&&this.hide(J);A&&A()}0==p.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=
this._aroundMoveListener=null)}});return b.popup=new F})},"dijit/place":function(){define("dojo/_base/array dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/_base/window ./Viewport ./main".split(" "),function(M,I,F,D,v,m,u){function r(f,c,n,q){var d=m.getEffectiveBox(f.ownerDocument);f.parentNode&&"body"==String(f.parentNode.tagName).toLowerCase()||v.body(f.ownerDocument).appendChild(f);var a=null;M.some(c,function(g){var p=g.corner,B=g.pos,J=0,A={w:{L:d.l+d.w-B.x,R:B.x-d.l,M:d.w}[p.charAt(1)],
h:{T:d.t+d.h-B.y,B:B.y-d.t,M:d.h}[p.charAt(0)]},h=f.style;h.left=h.right="auto";n&&(J=n(f,g.aroundCorner,p,A,q),J="undefined"==typeof J?0:J);var x=f.style,z=x.display,e=x.visibility;"none"==x.display&&(x.visibility="hidden",x.display="");h=I.position(f);x.display=z;x.visibility=e;z={L:B.x,R:B.x-h.w,M:Math.max(d.l,Math.min(d.l+d.w,B.x+(h.w>>1))-h.w)}[p.charAt(1)];e={T:B.y,B:B.y-h.h,M:Math.max(d.t,Math.min(d.t+d.h,B.y+(h.h>>1))-h.h)}[p.charAt(0)];B=Math.max(d.l,z);x=Math.max(d.t,e);z=Math.min(d.l+d.w,
z+h.w)-B;e=Math.min(d.t+d.h,e+h.h)-x;J+=h.w-z+(h.h-e);if(null==a||J<a.overflow)a={corner:p,aroundCorner:g.aroundCorner,x:B,y:x,w:z,h:e,overflow:J,spaceAvailable:A};return!J});a.overflow&&n&&n(f,a.aroundCorner,a.corner,a.spaceAvailable,q);c=a.y;var b=a.x,k=v.body(f.ownerDocument);/relative|absolute/.test(F.get(k,"position"))&&(c-=F.get(k,"marginTop"),b-=F.get(k,"marginLeft"));k=f.style;k.top=c+"px";k.left=b+"px";k.right="auto";return a}var w={TL:"BR",TR:"BL",BL:"TR",BR:"TL"};return u.place={at:function(f,
c,n,q,d){n=M.map(n,function(a){var b={corner:a,aroundCorner:w[a],pos:{x:c.x,y:c.y}};q&&(b.pos.x+="L"==a.charAt(1)?q.x:-q.x,b.pos.y+="T"==a.charAt(0)?q.y:-q.y);return b});return r(f,n,d)},around:function(f,c,n,q,d){function a(t,y){e.push({aroundCorner:t,corner:y,pos:{x:{L:A,R:A+x,M:A+(x>>1)}[t.charAt(1)],y:{T:h,B:h+z,M:h+(z>>1)}[t.charAt(0)]}})}if("string"==typeof c||"offsetWidth"in c||"ownerSVGElement"in c){var b=I.position(c,!0);if(/^(above|below)/.test(n[0])){var k=I.getBorderExtents(c),g=c.firstChild?
I.getBorderExtents(c.firstChild):{t:0,l:0,b:0,r:0},p=I.getBorderExtents(f),B=f.firstChild?I.getBorderExtents(f.firstChild):{t:0,l:0,b:0,r:0};b.y+=Math.min(k.t+g.t,p.t+B.t);b.h-=Math.min(k.t+g.t,p.t+B.t)+Math.min(k.b+g.b,p.b+B.b)}}else b=c;if(c.parentNode)for(k="absolute"==F.getComputedStyle(c).position,c=c.parentNode;c&&1==c.nodeType&&"BODY"!=c.nodeName;){g=I.position(c,!0);p=F.getComputedStyle(c);/relative|absolute/.test(p.position)&&(k=!1);if(!k&&/hidden|auto|scroll/.test(p.overflow)){B=Math.min(b.y+
b.h,g.y+g.h);var J=Math.min(b.x+b.w,g.x+g.w);b.x=Math.max(b.x,g.x);b.y=Math.max(b.y,g.y);b.h=B-b.y;b.w=J-b.x}"absolute"==p.position&&(k=!0);c=c.parentNode}var A=b.x,h=b.y,x="w"in b?b.w:b.w=b.width,z="h"in b?b.h:(D.deprecated("place.around: dijit/place.__Rectangle: { x:"+A+", y:"+h+", height:"+b.height+", width:"+x+" } has been deprecated.  Please use { x:"+A+", y:"+h+", h:"+b.height+", w:"+x+" }","","2.0"),b.h=b.height),e=[];M.forEach(n,function(t){var y=q;switch(t){case "above-centered":a("TM","BM");
break;case "below-centered":a("BM","TM");break;case "after-centered":y=!y;case "before-centered":a(y?"ML":"MR",y?"MR":"ML");break;case "after":y=!y;case "before":a(y?"TL":"TR",y?"TR":"TL");a(y?"BL":"BR",y?"BR":"BL");break;case "below-alt":y=!y;case "below":a(y?"BL":"BR",y?"TL":"TR");a(y?"BR":"BL",y?"TR":"TL");break;case "above-alt":y=!y;case "above":a(y?"TL":"TR",y?"BL":"BR");a(y?"TR":"TL",y?"BR":"BL");break;default:a(t.aroundCorner,t.corner)}});f=r(f,e,d,{w:x,h:z});f.aroundNodePos=b;return f}}})},
"dijit/Viewport":function(){define(["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],function(M,I,F,D,v){var m=new M,u;F(function(){var r=v.getBox();m._rlh=I(window,"resize",function(){var f=v.getBox();if(r.h!=f.h||r.w!=f.w)r=f,m.emit("resize")});if(8==D("ie")){var w=screen.deviceXDPI;setInterval(function(){screen.deviceXDPI!=w&&(w=screen.deviceXDPI,m.emit("resize"))},500)}D("ios")&&(I(document,"focusin",function(f){u=f.target}),I(document,"focusout",function(f){u=null}))});m.getEffectiveBox=
function(r){r=v.getBox(r);var w=u&&u.tagName&&u.tagName.toLowerCase();D("ios")&&u&&!u.readOnly&&("textarea"==w||"input"==w&&/^(color|email|number|password|search|tel|text|url)$/.test(u.type))&&(r.h*=0==orientation||180==orientation?.66:.4,w=u.getBoundingClientRect(),r.h=Math.max(r.h,w.top+w.height));return r};return m})},"dijit/BackgroundIframe":function(){define("require ./main dojo/_base/config dojo/dom-construct dojo/dom-style dojo/_base/lang dojo/on dojo/sniff".split(" "),function(M,I,F,D,v,m,
u,r){r.add("config-bgIframe",(r("ie")||r("trident"))&&!/IEMobile\/10\.0/.test(navigator.userAgent));var w=new function(){var f=[];this.pop=function(){if(f.length){var c=f.pop();c.style.display=""}else 9>r("ie")?(c=F.dojoBlankHtmlUrl||M.toUrl("dojo/resources/blank.html")||'javascript:""',c=document.createElement("\x3ciframe src\x3d'"+c+"' role\x3d'presentation' style\x3d'position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity\x3d\"0\");'\x3e")):(c=D.create("iframe"),c.src='javascript:""',
c.className="dijitBackgroundIframe",c.setAttribute("role","presentation"),v.set(c,"opacity",.1)),c.tabIndex=-1;return c};this.push=function(c){c.style.display="none";f.push(c)}};I.BackgroundIframe=function(f){if(!f.id)throw Error("no id");if(r("config-bgIframe")){var c=this.iframe=w.pop();f.appendChild(c);7>r("ie")||r("quirks")?(this.resize(f),this._conn=u(f,"resize",m.hitch(this,"resize",f))):v.set(c,{width:"100%",height:"100%"})}};m.extend(I.BackgroundIframe,{resize:function(f){this.iframe&&v.set(this.iframe,
{width:f.offsetWidth+"px",height:f.offsetHeight+"px"})},destroy:function(){this._conn&&(this._conn.remove(),this._conn=null);this.iframe&&(this.iframe.parentNode.removeChild(this.iframe),w.push(this.iframe),delete this.iframe)}});return I.BackgroundIframe})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(M,I,F,D){return M("dijit.DropDownMenu",D,{templateString:F,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},
_onDownArrow:function(){this.focusNext()},_onRightArrow:function(v){this._moveToPopup(v);v.stopPropagation();v.preventDefault()},_onLeftArrow:function(v){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else v.stopPropagation(),v.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a){return I("dijit._MenuBase",[n,a,d,q],{selected:null,_setSelectedAttr:function(b){this.selected!=b&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),b&&b._setSelected(!0),this._set("selected",b))},activated:!1,_setActivatedAttr:function(b){v.toggle(this.domNode,"dijitMenuActive",b);v.toggle(this.domNode,"dijitMenuPassive",!b);this._set("activated",b)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(b){var k=c.byNode(b);return b.parentNode==this.containerNode&&k&&k.focus},postCreate:function(){var b=this,k="string"==typeof this.childSelector?this.childSelector:m.hitch(this,"childSelector");this.own(r(this.containerNode,r.selector(k,u.enter),function(){b.onItemHover(c.byNode(this))}),r(this.containerNode,r.selector(k,u.leave),function(){b.onItemUnhover(c.byNode(this))}),r(this.containerNode,r.selector(k,f),function(g){b.onItemClick(c.byNode(this),g);g.stopPropagation()}),
r(this.containerNode,r.selector(k,"focusin"),function(){b._onItemFocus(c.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(b,k,g,p){this.inherited(arguments);if(b&&(-1==p||b.popup&&1==p))this.onItemClick(b,k)},_keyboardSearchCompare:function(b,k){return b.shortcutKey?k==b.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(b){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
b);else(b=this._getTopMenu())&&b._isMenuBar&&b.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(b){this.activated?(this.set("selected",b),!b.popup||b.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(b)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(b,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=b;b._set("hovering",!0)},_onChildDeselect:function(b){this._stopPopupTimer();this.currentPopupItem==b&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;b._closePopup()},this.popupDelay))},onItemUnhover:function(b){this._hoveredChild==b&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);b._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var b=this;b.parentMenu;b=b.parentMenu);return b},onItemClick:function(b,k){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(b);if(b.disabled)return!1;b.popup?(this.set("selected",b),this.set("activated",!0),k=/^key/.test(k._origType||
k.type)||0==k.clientX&&0==k.clientY,this._openItemPopup(b,k)):(this.onExecute(),b._onClick?b._onClick(k):b.onClick(k))},_openItemPopup:function(b,k){if(b!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var g=b.popup;g.parentMenu=this;this.own(this._mouseoverHandle=r.once(g.domNode,"mouseover",m.hitch(this,"_onPopupHover")));var p=this;b._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){k&&
p.focusChild(b);p._cleanUp()},onExecute:m.hitch(this,"_cleanUp",!0),onClose:function(){p._mouseoverHandle&&(p._mouseoverHandle.remove(),delete p._mouseoverHandle)}},k);this.currentPopupItem=b}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(D.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(b){if(this._hoveredChild&&this._hoveredChild!=b)this.onItemUnhover(this._hoveredChild);this.set("selected",b)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(b){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);b&&this.set("selected",null)}})})},"dijit/_CssStateMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-class dojo/has dojo/_base/lang dojo/on dojo/domReady dojo/touch dojo/_base/window ./a11yclick ./registry".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n){I=I("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);M.forEach("disabled readOnly checked selected focused state hovering active _opened".split(" "),function(d){this.watch(d,m.hitch(this,"_setStateClass"))},this);for(var q in this.cssStateNodes||{})this._trackMouseState(this[q],this.cssStateNodes[q]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(q){if(!this.disabled)switch(q.type){case "mouseover":case "MSPointerOver":case "pointerover":this._set("hovering",
!0);this._set("active",this._mouseDown);break;case "mouseout":case "MSPointerOut":case "pointerout":this._set("hovering",!1);this._set("active",!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":this._set("active",!0);break;case "mouseup":case "dojotouchend":case "MSPointerUp":case "pointerup":case "keyup":this._set("active",!1)}},_setStateClass:function(){function q(p){d=d.concat(M.map(d,function(B){return B+p}),"dijit"+p)}var d=this.baseClass.split(" ");
this.isLeftToRight()||q("Rtl");var a="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&q(a);this.state&&q(this.state);this.selected&&q("Selected");this._opened&&q("Opened");this.disabled?q("Disabled"):this.readOnly?q("ReadOnly"):this.active?q("Active"):this.hovering&&q("Hover");this.focused&&q("Focused");a=this.stateNode||this.domNode;var b={};M.forEach(a.className.split(" "),function(p){b[p]=!0});"_stateClasses"in this&&M.forEach(this._stateClasses,function(p){delete b[p]});M.forEach(d,
function(p){b[p]=!0});var k=[],g;for(g in b)k.push(g);a.className=k.join(" ");this._stateClasses=d},_subnodeCssMouseEvent:function(q,d,a){function b(k){D.toggle(q,d+"Active",k)}if(!this.disabled&&!this.readOnly)switch(a.type){case "mouseover":case "MSPointerOver":case "pointerover":D.toggle(q,d+"Hover",!0);break;case "mouseout":case "MSPointerOut":case "pointerout":D.toggle(q,d+"Hover",!1);b(!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":b(!0);
break;case "mouseup":case "MSPointerUp":case "pointerup":case "dojotouchend":case "keyup":b(!1);break;case "focus":case "focusin":D.toggle(q,d+"Focused",!0);break;case "blur":case "focusout":D.toggle(q,d+"Focused",!1)}},_trackMouseState:function(q,d){q._cssState=d}});r(function(){function q(b,k,g){if(!g||!F.isDescendant(g,k))for(;k&&k!=g;k=k.parentNode)if(k._cssState){var p=n.getEnclosingWidget(k);p&&(k==p.domNode?p._cssMouseEvent(b):p._subnodeCssMouseEvent(k,k._cssState,b))}}var d=f.body(),a;u(d,
w.over,function(b){q(b,b.target,b.relatedTarget)});u(d,w.out,function(b){q(b,b.target,b.relatedTarget)});u(d,c.press,function(b){a=b.target;q(b,a)});u(d,c.release,function(b){q(b,a);a=null});u(d,"focusin, focusout",function(b){var k=b.target;if(k._cssState&&!k.getAttribute("widgetId")){var g=n.getEnclosingWidget(k);g&&g._subnodeCssMouseEvent(k,k._cssState,b)}})});return I})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(M,I,F,D,v,m,u,r,w,f){return I("dijit._KeyNavContainer",[w,f,r],{connectKeyNavHandlers:function(c,n){var q=this._keyNavCodes={},d=m.hitch(this,"focusPrev"),a=m.hitch(this,"focusNext");M.forEach(c,function(b){q[b]=d});M.forEach(n,function(b){q[b]=a});q[v.HOME]=m.hitch(this,"focusFirstChild");q[v.END]=m.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){D.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);M.forEach(this.getChildren(),
m.hitch(this,"_startupChild"))},addChild:function(c,n){this.inherited(arguments);this._startupChild(c)},_startupChild:function(c){c.set("tabIndex","-1")},_getFirst:function(){var c=this.getChildren();return c.length?c[0]:null},_getLast:function(){var c=this.getChildren();return c.length?c[c.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(c){return(c=
u.byNode(c))&&c.getParent()==this}})})},"dijit/_Container":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/_base/kernel"],function(M,I,F,D){return I("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode)},addChild:function(v,m){var u=this.containerNode;if(0<m){for(u=u.firstChild;0<m;)1==u.nodeType&&m--,u=u.nextSibling;u?m="before":(u=this.containerNode,m="last")}F.place(v.domNode,u,m);
this._started&&!v._started&&v.startup()},removeChild:function(v){"number"==typeof v&&(v=this.getChildren()[v]);v&&(v=v.domNode)&&v.parentNode&&v.parentNode.removeChild(v)},hasChildren:function(){return 0<this.getChildren().length},_getSiblingOfChild:function(v,m){var u=this.getChildren();v=M.indexOf(u,v);return u[v+m]},getIndexOfChild:function(v){return M.indexOf(this.getChildren(),v)}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),
function(M,I,F,D,v,m,u,r){return I("dijit._KeyNavMixin",r,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);F.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var w=this._keyNavCodes={};w[D.HOME]=v.hitch(this,"focusFirstChild");w[D.END]=v.hitch(this,"focusLastChild");w[this.isLeftToRight()?D.LEFT_ARROW:D.RIGHT_ARROW]=v.hitch(this,"_onLeftArrow");w[this.isLeftToRight()?D.RIGHT_ARROW:D.LEFT_ARROW]=v.hitch(this,"_onRightArrow");w[D.UP_ARROW]=v.hitch(this,
"_onUpArrow");w[D.DOWN_ARROW]=v.hitch(this,"_onDownArrow")}var f=this;w="string"==typeof this.childSelector?this.childSelector:v.hitch(this,"childSelector");this.own(m(this.domNode,"keypress",v.hitch(this,"_onContainerKeypress")),m(this.domNode,"keydown",v.hitch(this,"_onContainerKeydown")),m(this.domNode,"focus",v.hitch(this,"_onContainerFocus")),m(this.containerNode,m.selector(w,"focusin"),function(c){f._onChildFocus(u.getEnclosingWidget(this),c)}))},_onLeftArrow:function(){},_onRightArrow:function(){},
_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(w,f){w&&(this.focusedChild&&w!==this.focusedChild&&this._onChildBlur(this.focusedChild),
w.set("tabIndex",this.tabIndex),w.focus(f?"end":"start"))},_onContainerFocus:function(w){w.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){F.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(w){F.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(w){w&&w!=this.focusedChild&&
(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),w.set("tabIndex",this.tabIndex),this.lastFocused=w,this._set("focusedChild",w))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(w,f,c,n){w&&this.focusChild(w)},_keyboardSearchCompare:function(w,f){var c=w.domNode;w=(w.label||(c.focusNode?c.focusNode.label:"")||c.innerText||c.textContent||"").replace(/^\s+/,"").substr(0,f.length).toLowerCase();return f.length&&w==f?-1:0},_isFormElement:function(w){return"INPUT"===
w.tagName||"TEXTAREA"===w.tagName||"SELECT"===w.tagName||"BUTTON"===w.tagName},_onContainerKeydown:function(w){if(!this._isFormElement(document.activeElement)){var f=this._keyNavCodes[w.keyCode];f?(f(w,this.focusedChild),w.stopPropagation(),w.preventDefault(),this._searchString=""):w.keyCode!=D.SPACE||!this._searchTimer||w.ctrlKey||w.altKey||w.metaKey||(w.stopImmediatePropagation(),w.preventDefault(),this._keyboardSearch(w," "))}},_onContainerKeypress:function(w){this._isFormElement(document.activeElement)||
w.charCode<=D.SPACE||w.ctrlKey||w.altKey||w.metaKey||(w.preventDefault(),w.stopPropagation(),this._keyboardSearch(w,String.fromCharCode(w.charCode).toLowerCase()))},_keyboardSearch:function(w,f){var c=null,n,q=0;v.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=f;var d=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;n=this._searchString.substr(0,d);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);
var a=this.focusedChild||null;if(1==d||!a)if(a=this._getNextFocusableChild(a,1),!a)return;d=a;do{var b=this._keyboardSearchCompare(a,n);b&&0==q++&&(c=a);if(-1==b){q=-1;break}a=this._getNextFocusableChild(a,1)}while(a&&a!=d)})();this.onKeyboardSearch(c,w,n,q)},_onChildBlur:function(){},_getNextFocusableChild:function(w,f){var c=w;do{if(w)w=this._getNext(w,f);else if(w=this[0<f?"_getFirst":"_getLast"](),!w)break;if(null!=w&&w!=c&&w.isFocusable())return w}while(w!=c);return null},_getFirst:function(){return null},
_getLast:function(){return null},_getNext:function(w,f){if(w)for(w=w.domNode;w;)if((w=w[0>f?"previousSibling":"nextSibling"])&&"getAttribute"in w){var c=u.byNode(w);if(c)return c}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n){u=M("dijit.MenuItem"+(m("dojo-bidi")?
"_NoBidi":""),[r,w,f,c],{templateString:n,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(q){this._set("label",q);var d="";var a=q.search(/{\S}/);if(0<=a){d=q.charAt(a+1);var b=q.substr(0,a);q=q.substr(a+3);a=b+d+q;q=b+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+d+"\x3c/span\x3e"+q}else a=q;this.domNode.setAttribute("aria-label",a+" "+this.accelKey);this.containerNode.innerHTML=q;this._set("shortcutKey",d)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},
accelKey:"",disabled:!1,_fillContent:function(q){!q||"label"in this.params||this._set("label",q.innerHTML)},buildRendering:function(){this.inherited(arguments);F.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&F.set(this.accelKeyNode,"id",this.id+"_accel");I.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==m("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(q){}},_setSelected:function(q){D.toggle(this.domNode,"dijitMenuItemSelected",q)},setLabel:function(q){v.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.",
"","2.0");this.set("label",q)},setDisabled:function(q){v.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",q)},_setDisabledAttr:function(q){this.focusNode.setAttribute("aria-disabled",q?"true":"false");this._set("disabled",q)},_setAccelKeyAttr:function(q){this.accelKeyNode&&(this.accelKeyNode.style.display=q?"":"none",this.accelKeyNode.innerHTML=q,F.set(this.containerNode,"colSpan",q?"1":"2"));this._set("accelKey",q)}});m("dojo-bidi")&&
(u=M("dijit.MenuItem",u,{_setLabelAttr:function(q){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return u})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(M,I){return M("dijit._Contained",null,{_getSibling:function(F){var D=this.getParent();return D&&D._getSiblingOfChild&&D._getSiblingOfChild(this,"previous"==F?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},
getIndexInParent:function(){var F=this.getParent();return F&&F.getIndexOfChild?F.getIndexOfChild(this):-1}})})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n,q){M=M(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(d,a,b,k,g,
p,B,J){this.point=d;this.symbol=a;this.relatedGraphic=b;this.segIndex=k;this.ptIndex=g;this.segLength=p;this.editor=B;this.map=B.map;this._scratchGL=B.toolbar._scratchGL;this._placeholder=J||!1;this._type=b.geometry.type;this._init();this._enable()},refresh:function(d){if(d||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=
this.editor=this.map=this._scratchGL=null},_init:function(){var d=new c(this.point.toJson());d=new n(d,this.symbol);switch(this._type){case "multipoint":d._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(d)}this.graphic=d},_enable:function(){var d=this.graphic.getDojoShape();d&&(d._hasMover=!0,this._moveable=this._getMoveable(d),(d=d.getEventSource())&&v.set(d,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":
"move-v"]))},_disable:function(){var d=this._moveable;if(d){F.disconnect(this._startHandle);F.disconnect(this._firstHandle);F.disconnect(this._movingHandle);F.disconnect(this._stopHandle);var a=d.shape;a&&(a=a.getEventSource())&&v.set(a,"cursor","inherit");d.destroy();this._moveable=null}},_needRefresh:function(){var d=this.graphic.getDojoShape(),a=!1;if(d)switch(this._type){case "multipoint":var b=this.relatedGraphic.getDojoShape();b&&(b=b.children[this.ptIndex],d!==b&&(this.graphic._shape=b,a=!0));
break;case "polyline":case "polygon":a=!d._hasMover}return a},_getMoveable:function(d){d=new m(d,D("mac")&&D("ff")&&!f("esri-touch")&&{leftButtonOnly:!0});this._startHandle=F.connect(d,"onMoveStart",this,this._moveStartHandler);this._firstHandle=F.connect(d,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=F.connect(d,"onMoving",this,this._movingHandler);this._stopHandle=F.connect(d,"onMoveStop",this,this._moveStopHandler);return d},_getPtIndex:function(){return this.ptIndex+(this._placeholder?
1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(d){var a=this.map;a.snappingManager&&a.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();d.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(d){var a=
d.shape,b=this._getControlEdges(),k=this._scratchGL._div,g,p=[],B=d.host.shape._wrapOffsets[0]||0;for(g=0;g<b.length;g++){var J=b[g];J.x1+=B;J.x2+=B;p.push([k.createLine({x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2}).setStroke(this.editor._lineStroke),J.x1,J.y1,J.x2,J.y2])}a._lines=p;d.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(d,a,b){a=this.map;var k;f("esri-pointer")?k=a.navigationManager.pointerEvents._processTouchEvent(b,
b):b&&"pointermove"===b.type&&(k=w.prototype._processTouchEvent.call({map:a},b,b));k&&a.snappingManager&&a.snappingManager._onSnappingMouseMoveHandler(k);b=d.shape;d=b.getTransform();b=b._lines;for(k=0;k<b.length;k++)a=b[k],a[0].setShape({x1:a[1]+d.dx,y1:a[2]+d.dy,x2:a[3],y2:a[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),d)},_moveStopHandler:function(d){d=d.shape;var a=this.editor.toolbar,b=d.getTransform(),k=this.map,g=this.graphic,p=a._geo?q.geographicToWebMercator(g.geometry):
g.geometry;a._activateScrollWheel();var B,J=d._lines;if(J){for(B=0;B<J.length;B++)J[B][0].removeShape();d._lines=null}B=!1;J=!0;var A=this._getInfo();b&&(b.dx||b.dy)?this._placeholder&&(this._placeholder=!1,B=!0):J=!1;if(k.snappingManager)var h=k.snappingManager._snappingPoint;var x=[b,u.invert(this._startTx)];h=h||k.toMap(u.multiplyPoint(x,k.toScreen(p,!0)));k.snappingManager&&k.snappingManager._killOffSnapping();d.setTransform(null);g.setGeometry(a._geo?q.webMercatorToGeographic(h,!0):h);this.constructor.onMoveStop(this,
b);a.onVertexMoveStop(this.relatedGraphic,A,b);if(!J)a.onVertexClick(this.relatedGraphic,A);if(B)a.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var d=this.map,a=this.relatedGraphic.geometry,b=this.segIndex,k=this.ptIndex,g=this.segLength,p=this._scratchGL.getNavigationTransform(),B=p.dx;p=p.dy;var J=d.toScreen(this.graphic.geometry);d=J.x-B;J=J.y-p;var A=[];a=this.editor._getControlPoints(this,a,b,k,g);a[0]&&A.push({x1:d,y1:J,x2:a[0].x-B,y2:a[0].y-p});a[1]&&A.push({x1:d,
y1:J,x2:a[1].x-B,y2:a[1].y-p});return A}});f("extend-esri")&&I.setObject("toolbars.VertexMover",M,r);I.mixin(M,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return M})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(M,I,F,D,v,m,u,r,w,f){M=M(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(c,
n,q){this._graphic=c;this._map=n;this._toolbar=q;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(c){this._editBox?(F.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=F.connect(c.getLayer(),"onDblClick",this,function(n){this._map.navigationManager.setImmediateClick(!1);n.graphic==c&&(D.stop(n),F.disconnect(this._addEditBoxHandler),
this._addEditBoxHandler=null,this._addTextBox(c))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(F.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(c,n){if(!this._editBox){if(!c.symbol.text){c.symbol.text="Tempt text";c.setSymbol(c.symbol);var q=""}var d=this._createInputTextStyle(c,this._map);""!==q&&(q=n||c.symbol.text);this._editBox=m.create("input",
{type:"text",value:q});r.set(this._editBox,d);u.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=F.connect(this._editBox,"onkeyup",I.hitch(this,function(b){b.keyCode!=w.ENTER&&b.keyCode!==w.TAB||this._disable()}));this._editBoxBlurHandler=F.connect(this._editBox,"onblur",I.hitch(this,function(b){this._disable()}));c.symbol.text="";c.setSymbol(c.symbol);c.hide();var a=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=
this._map.on("zoom-start",I.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(b){r.set(a,{left:this._editBoxLeft+b.delta.x+"px",top:this._editBoxTop+b.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(r.get(a,"left"));this._editBoxTop=parseFloat(r.get(a,"top"))});this.onEditStart(c,this._editBox);this._toolbar.onTextEditStart(c,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(F.disconnect(this._editBoxBlurHandler),
this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(F.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(c,
n){n=c.getDojoShape().getTransformedBoundingBox();var q=c.getLayer();q=q.hasLocalNavigationTransform()?{dx:0,dy:0}:q.getNavigationTransform();var d=c.symbol.font;return{"font-family":d.family,"font-size":d.size+"px","font-style":d.style,"font-variant":d.variant,"font-weight":d.weight,left:n[0].x+q.dx+"px",top:n[0].y+q.dy+"px",width:Math.abs(n[0].x-n[1].x)/Math.cos(c.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var c=this._graphic.symbol;
c.text=this._editBox.value;this._graphic.setSymbol(c)}else this._graphic.getLayer().remove(this._graphic)}});v("extend-esri")&&I.setObject("toolbars.TextEditor",M,f);return M})},"esri/dijit/editing/TemplatePicker":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/_base/array dojo/_base/json dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/_Widget dijit/_Templated dojo/data/ItemFileReadStore dojox/grid/DataGrid dojox/gfx ../../layers/FeatureLayer ../../symbols/SimpleMarkerSymbol ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ./TemplatePickerItem ../../kernel ../../lang ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi dojo/text!./templates/TemplatePicker.html".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a,b,k,g,p,B,J,A,h,x,z,e,t,y,H,E,G){var O=M([H,a,b],{declaredClass:"esri.dijit.editing.TemplatePicker",widgetsInTemplate:!0,templateString:G,featureLayers:null,items:null,grouping:!0,showTooltip:!1,maxLabelLength:0,rows:4,_rows:0,columns:3,surfaceWidth:30,surfaceHeight:30,emptyMessage:"",useLegend:!0,legendCache:{},_uniqueId:{id:0},_assumedCellWidth:90,_initialAutoWidth:300,_initialAutoHeight:200,_ieTimer:150,constructor:function(L,N){L=L||{};L.items||L.featureLayers||
console.error("TemplatePicker: please provide 'featureLayers' or 'items' parameter in the constructor");this._dojo14x=4<=u.version.minor;this._itemWidgets={};L.featureLayers&&L.featureLayers.length&&(this._flChanged=1);this._nls=E.widgets.templatePicker;this.emptyMessage=L.emptyMessage||this._nls&&this._nls.creationDisabled||""},postMixInProperties:function(){this.inherited(arguments);this._preprocess()},startup:function(){this.inherited(arguments);if("auto"===this.rows&&"auto"===this.columns){var L=
q.getContentBox(this.domNode);L.w||(this.domNode.style.width=this._initialAutoWidth+"px");if(!L.h||1>=L.h)this.domNode.style.height=this._initialAutoHeight+"px";L=q.getContentBox(this.domNode);this._columns=Math.floor(L.w/this._assumedCellWidth)||1}this._applyGridPatches();this._setGridLayout();F.connect(this.grid,"onRowClick",this,this._rowClicked);this._setGridData();this._toggleTooltip();9>r("ie")&&(this._repaintItems=I.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},
destroy:function(){this.showTooltip=!1;this._toggleTooltip();this._clearLegendInfo();this.featureLayers=this.items=this.grid=this._flItems=this._itItems=this._groupRowIndices=this._selectedCell=this._selectedInfo=this._selectedItem=null;this.inherited(arguments)},getSelected:function(){return this._selectedCell?this._selectedItem:null},clearSelection:function(){var L=this._selectedCell,N=this._selectedInfo;L&&this._rowClicked({cellNode:L,rowIndex:N.selRow,cellIndex:N.selCol})},update:function(L){L=
"auto"===this.rows&&"auto"===this.columns&&L?!0:!1;var N=this.grid;if(L){var T=this.domNode;var R=u.query("#"+T.id+".templatePicker div.item")[0];T=q.getContentBox(T);R=(R=R&&R.parentNode)?D.coords(R).w:this._assumedCellWidth;this._columns=(this._columns=Math.floor((T.w-N.views.views[0].getScrollbarWidth())/R))||1}R=this._rows;this._preprocess();var Q=this._rows;this._setGridLayout();this._setGridData();Q!==R&&N.set("autoHeight",this._rows,!1);L?(N._resize({w:T.w,h:T.h}),N.viewsHeaderNode.style.display=
"none"):N.update();this._toggleTooltip();var W=this,ba=this.getSelected();ba&&N.store.fetch({onComplete:function(da){var fa=(da=W._locate(ba,W._selectedInfo,da))&&N.views.views[0].getCellNode(da[0],da[1]);fa&&W._rowClicked({cellNode:fa,rowIndex:da[0],cellIndex:da[1]},!0)}});9>r("ie")&&setTimeout(this._repaintItems,this._ieTimer);L=this.featureLayers;T=this.items;L&&L.length||T&&T.length||!N||!this.emptyMessage||N.showMessage(this.emptyMessage)},_eventMap:{"selection-change":!0},onSelectionChange:function(){},
_setUseLegendAttr:function(L){var N=this.useLegend;this._started&&N===L||(L?this._flChanged=1:this._clearLegendInfo());this.useLegend=L},_setFeatureLayersAttr:function(L){var N=this.featureLayers;this._started&&N===L||(this._flChanged=1);this.featureLayers=L},_adjustRowsCols:function(L){if("auto"===this.rows&&"auto"===this.columns)this._started||(this._rows=!1,this._columns=null,this._autoWidth=!1);else{var N=0;this._rows=this.rows;this._columns=this.columns;"auto"===this.rows?(this.featureLayers?
this.grouping?(N=L.length,v.forEach(L,function(T){N+=Math.ceil(T.length/this.columns)},this)):(v.forEach(L,function(T){N+=T.length},this),N=Math.ceil(N/this.columns)):N=Math.ceil(L.length/this.columns),this._rows=N):"auto"===this.columns&&(this.featureLayers?this.grouping?N=3:(v.forEach(L,function(T){N+=T.length},this),N=Math.ceil(N/this.rows)):N=Math.ceil(L.length/this.rows),this._columns=N)}},_preprocess:function(){this.items&&(this.grouping=!1);this._autoWidth=!1;if("auto"===this.rows||"auto"===
this.columns)this._autoWidth=!0;if(this.featureLayers)if(this.useLegend&&this._flChanged&&(this._legendIndices=[],this._loadingIndices=[],this._legendSymbols={},this._ignoreLegends(),this._loadingLegends=[],clearTimeout(this._legendTimer),this._legendTimer=null,this._processSelectionLayers(),this._flChanged=0),v.every(this.featureLayers,function(T){return T.loaded})){this.featureLayers=v.filter(this.featureLayers,function(T){return!(T.hasZ&&!T.enableZDefaults)});var L=this._flItems=this._getItemsFromLayers(this.featureLayers);
this._adjustRowsCols(L)}else{var N=this.featureLayers.length;v.forEach(this.featureLayers,function(T){if(T.loaded)N--;else var R=F.connect(T,"onLoad",this,function(){F.disconnect(R);R=null;N--;N||this.update()})},this)}else L=this._itItems=this._getItemsFromItems(this.items),this._adjustRowsCols(L)},_processSelectionLayers:function(){var L,N,T,R,Q,W,ba,da={};v.forEach(this.featureLayers,function(fa,la){fa.mode===B.MODE_SELECTION&&fa._map&&fa.url&&fa._params.drawMode&&!fa.source&&(N=I.trim(fa._url.path).replace(/\/(MapServer|FeatureServer).*/ig,
"/MapServer").replace(/^https?:\/\//ig,"").toLowerCase(),T=da[N]=da[N]||{},R=T.featureLayers=T.featureLayers||{},W=T.indices=T.indices||[],R[la]=fa,W.push(la),L=fa._map)});L&&v.forEach(L.layerIds,function(fa){(fa=L.getLayer(fa))&&fa.url&&(fa.getImageUrl||fa.getTileUrl)&&fa.loaded&&10.1<=fa.version&&(N=I.trim(fa._url.path).replace(/(\/MapServer).*/ig,"$1"),Q=N.replace(/^https?:\/\//ig,"").toLowerCase(),da[Q]&&!da[Q].mapServiceUrl&&(T=da[Q],T.mapServiceUrl=N,T.mapServiceLayer=fa,this._legendIndices=
this._legendIndices.concat(T.indices),ba=this._fetchLegend({pickerInstance:this,info:T},Q),ba.then?(this._loadingIndices=this._loadingIndices.concat(T.indices),this._loadingLegends.push(ba)):this._processLegendResponse(ba,T)))},this)},_fetchLegend:function(L,N){var T=O.prototype,R=T.legendCache[N];R?R.then&&R._contexts.push(L):(R=T.legendCache[N]=y({url:L.info.mapServiceUrl+"/legend",content:{f:"json"},callbackParamName:"callback"}),R._contexts=[L],R.addBoth(function(Q){if(!R.canceled){T.legendCache[N]=
Q;var W=R._contexts;R._contexts=null;v.forEach(W,function(ba){var da=ba.pickerInstance;ba=ba.info;if(!da._destroyed){v.forEach(ba.indices,function(la){fa=v.indexOf(da._loadingIndices,la);-1<fa&&da._loadingIndices.splice(fa,1)});var fa=v.indexOf(da._loadingLegends,R);-1<fa&&da._loadingLegends.splice(fa,1);da._processLegendResponse(Q,ba)}})}}));return R},_clearLegendInfo:function(){clearTimeout(this._legendTimer);this._ignoreLegends();this._legendIndices=this._loadingIndices=this._legendSymbols=this._loadingLegends=
this._legendTimer=null},_ignoreLegends:function(){this._loadingLegends&&v.forEach(this._loadingLegends,function(L){var N=-1;v.some(L._contexts,function(T,R){T.pickerInstance===this&&(N=R);return-1<N},this);-1<N&&L._contexts.splice(N,1)},this)},_processLegendResponse:function(L,N){if(!L||L instanceof Error){var T;v.forEach(N.indices,function(Q){T=v.indexOf(this._legendIndices,Q);-1<T&&this._legendIndices.splice(T,1)},this)}else v.forEach(N.indices,function(Q){var W=N.featureLayers[Q].layerId,ba,da=
N.mapServiceUrl+"/"+W+"/images/",fa=N.mapServiceLayer._getToken(),la,oa;if(!this._legendSymbols[Q]){var ua=null;v.some(L.layers,function(wa){wa.layerId==W&&(ua=wa);return!!ua});if(ua){var Ca=this._legendSymbols[Q]={};v.forEach(ua.legend,function(wa){if((la=wa.values)&&la.length)for(ba=0;ba<la.length;ba++)Ca[la[ba]]=wa;else Ca.defaultSymbol=wa;(oa=wa.url)&&!wa._fixed&&(wa._fixed=1,-1===oa.search(/https?:/)&&(wa.url=da+oa),fa&&-1!==wa.url.search(/https?:/)&&(wa.url+=(-1<wa.url.indexOf("?")?"\x26":"?")+
"token\x3d"+fa))})}}},this);var R=this;R._started&&!R._legendTimer&&(R._legendTimer=setTimeout(function(){clearTimeout(R._legendTimer);R._legendTimer=null;R._destroyed||R.update()},0))},_applyGridPatches:function(){var L=this.grid,N=L.adaptWidth,T,R,Q;L.adaptWidth=function(){T=this.views.views;for(R=0;Q=T[R];R++)d.set(Q.headerNode,"display","block");N.apply(this,arguments);for(R=0;Q=T[R];R++)d.set(Q.headerNode,"display","none")};if(this._dojo14x){if("auto"!==this.rows&&"auto"!==this.columns)var W=
F.connect(L,"_onFetchComplete",this,function(){F.disconnect(W);this.grid.set("autoHeight",this._rows)});F.connect(L,"_onDelete",this,this._destroyItems);F.connect(L,"_clearData",this,this._destroyItems);F.connect(L,"destroy",this,this._destroyItems);(L=L.focus)&&L.findAndFocusGridCell&&(L.findAndFocusGridCell=function(){return!1})}},_setGridLayout:function(){var L=function(W){return function(ba,da){return this._cellGet(W,ba,da)}},N=I.hitch(this,this._cellFormatter),T=[],R=this._columns,Q;for(Q=0;Q<
R;Q++)T.push({field:"cell"+Q,get:I.hitch(this,L(Q)),formatter:N});L={cells:[T]};this.grouping&&(R={field:"groupName",colSpan:R,get:I.hitch(this,this._cellGetGroup),formatter:I.hitch(this,this._cellGroupFormatter)},L.cells.push([R]));R=this.grid;N=g.prototype.rowsPerPage;R.set("rowsPerPage",this._rows>N?this._rows:N);R.set("structure",L)},_setGridData:function(){var L=[];if(this.grouping){this._groupRowIndices=[];var N,T,R=this._columns;v.forEach(this._flItems,function(W,ba){L.push({});ba=0===ba?0:
N+T+1;this._groupRowIndices.push(ba);N=ba;T=Math.ceil(W.length/R);L=L.concat(this._getStoreItems(W))},this)}else this.featureLayers?(v.forEach(this._flItems,function(W){L=L.concat(W)}),L=this._getStoreItems(L)):L=this._getStoreItems(this._itItems);var Q=new k({data:{items:L}});this.grid.setStore(Q)},_toggleTooltip:function(){if(this.showTooltip){if(!this.tooltip){this.tooltip=n.create("div",{"class":"esriMapTooltip"},this.domNode);this.tooltip.style.display="none";this.tooltip.style.position="fixed";
var L=this.grid;this._mouseOverConnect=F.connect(L,"onCellMouseOver",this,this._cellMouseOver);this._mouseOutConnect=F.connect(L,"onCellMouseOut",this,this._cellMouseOut)}}else this.tooltip&&(F.disconnect(this._mouseOverConnect),F.disconnect(this._mouseOutConnect),n.destroy(this.tooltip),this.tooltip=null)},_rowClicked:function(L,N){var T=L.cellNode,R=L.rowIndex;L=L.cellIndex;var Q=this._getCellInfo(T,R,L);if(Q){var W=this.grid.store;if(!W.getValue(Q,"loadingCell")&&(this._selectedCell&&c.remove(this._selectedCell,
"selectedItem"),T!==this._selectedCell?(c.add(T,"selectedItem"),this._selectedCell=T,this._selectedItem={featureLayer:W.getValue(Q,"layer"),type:W.getValue(Q,"type"),template:W.getValue(Q,"template"),symbolInfo:W.getValue(Q,"symbolInfo"),item:this._getItem(Q)},this._selectedInfo={selRow:R,selCol:L,index1:W.getValue(Q,"index1"),index2:W.getValue(Q,"index2"),index:W.getValue(Q,"index")}):this._selectedCell=this._selectedInfo=this._selectedItem=null,!N))this.onSelectionChange()}},_locate:function(L,
N,T){var R=this.grid.store,Q=Array(this._columns),W,ba=N.index1,da=N.index2,fa=N.index,la=L.item;v.some(T,function(oa,ua){return v.some(Q,function(Ca,wa){return(Ca=R.getValue(oa,"cell"+wa))&&(la?fa===R.getValue(Ca,"index"):ba===R.getValue(Ca,"index1")&&da===R.getValue(Ca,"index2"))?(W=[ua,wa],!0):!1})});return W},_getCellInfo:function(L,N,T){if(L)return L=this.grid,N=L.getItem(N),L.store.getValue(N,"cell"+T)},_getItem:function(L){var N=this.items;if(N)return N[this.grid.store.getValue(L,"index")]},
_cellMouseOver:function(L){var N=this.tooltip,T=L.cellNode,R=this._getCellInfo(T,L.rowIndex,L.cellIndex);if(N&&R){var Q=this.grid.store;L=Q.getValue(R,"template");var W=Q.getValue(R,"type"),ba=Q.getValue(R,"symbolInfo");Q=Q.getValue(R,"layer");L=(R=this._getItem(R))&&R.label+(R.description?": "+R.description:"")||L&&L.name+(L.description?": "+L.description:"")||W&&W.name||ba&&ba.label+(ba.description?": "+ba.description:"")||(Q&&Q.name+": ")+"Default";N.style.display="none";N.innerHTML=L;T=D.coords(T.firstChild);
d.set(N,{left:T.x+"px",top:T.y+T.h+5+"px"});N.style.display=""}},_cellMouseOut:function(){var L=this.tooltip;L&&(L.style.display="none")},_destroyItems:function(){var L=this._itemWidgets,N;for(N in L)L[N]&&(L[N].destroy(),delete L[N])},_repaintItems:function(){var L=this._itemWidgets,N;for(N in L){var T=L[N];T&&T._repaint(T._surface)}},_getStoreItems:function(L){var N=this._uniqueId;L=v.map(L,function(oa){return I.mixin({surfaceId:"tpick-surface-"+N.id++},oa)});for(var T=L.length,R=0,Q={},W=0,ba,
da=[],fa=!0,la=this._columns;R<T;)fa=!0,ba="cell"+W,Q[ba]=L[R],R++,W++,0===W%la&&(fa=!1,da.push(Q),Q={},W=0);fa&&T&&da.push(Q);return da},_getItemsFromLayers:function(L){var N=[];v.forEach(L,function(T,R){N.push(this._getItemsFromLayer(T,R))},this);return N},_getItemsFromLayer:function(L,N){var T=[];if(this.useLegend&&-1<v.indexOf(this._loadingIndices,N))return[{label:this._nls&&this._nls.loading||"",symbol:null,layer:L,type:null,template:null,index1:N,index2:0,loadingCell:1}];var R=[];R=R.concat(L.templates);
v.forEach(L.types,function(da){var fa=da.templates;v.forEach(fa,function(la){la._type_=da});R=R.concat(fa)});R=v.filter(R,t.isDefined);var Q=L.renderer;if(Q){var W=Q.declaredClass.replace("esri.renderer.","");if(0<R.length)v.forEach(R,function(da){var fa=da.prototype;if(fa){var la;if(la=this._isUnclassedRenderer(Q)?Q.infos[0].symbol:Q.valueExpression?this._createSimpleSymbol(L):Q.getSymbol(fa)||this._createSimpleSymbol(L)){var oa=null,ua;if(!(9>f("ie"))&&da.thumbnail&&da.thumbnail.imageData)oa=new A(da.thumbnail);
else if(this.useLegend&&-1<v.indexOf(this._legendIndices,N)){if(ua=this._legendSymbols&&this._legendSymbols[N])switch(W){case "SimpleRenderer":oa=ua.defaultSymbol;break;case "UniqueValueRenderer":v.some(Q.infos,function(Ca){Ca.symbol===la&&(oa=ua[Ca.value]);return!!oa});break;case "ClassBreaksRenderer":v.some(Q.infos,function(Ca){Ca.symbol===la&&(oa=ua[Ca.maxValue]);return!!oa})}oa&&(fa=m.fromJson(m.toJson(A.defaultProps)),fa.url=oa.url,fa.imageData=oa.imageData,fa.contentType=oa.contentType,fa.width=
oa.width,fa.height=oa.height,t.isDefined(fa.width)&&t.isDefined(fa.height)||(fa.width=15,fa.height=15),oa=new A(fa))}T.push({label:this._trimLabel(da.name),symbol:oa||la,legendOverride:!!oa,layer:L,type:da._type_,template:da,index1:N,index2:T.length})}else switch(W){case "HeatmapRenderer":T.push({label:this._trimLabel(da.name),symbol:new J,legendOverride:!!oa,layer:L,type:da._type_,template:da,index1:N,index2:T.length})}}delete da._type_},this);else{var ba=[];"TemporalRenderer"===W&&(Q=Q.observationRenderer)&&
(W=Q.declaredClass.replace("esri.renderer.",""));switch(W){case "SimpleRenderer":ba=[{symbol:Q.symbol,label:Q.label,description:Q.description}];break;case "UniqueValueRenderer":case "ClassBreaksRenderer":ba=Q.infos}T=v.map(ba,function(da,fa){return{label:this._trimLabel(da.label),description:da.description,symbolInfo:I.mixin({constructor:function(){}},da),symbol:da.symbol,layer:L,index1:N,index2:fa}},this)}}return T},_isUnclassedRenderer:function(L){return!!((L.hasVisualVariables("sizeInfo",!1)||
L.hasVisualVariables("colorInfo",!1)||L.hasVisualVariables("opacityInfo",!1))&&L.addBreak&&L.infos&&1===L.infos.length)},_createSimpleSymbol:function(L){switch(L.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":var N=new J;break;case "esriGeometryPolyline":N=new x;break;case "esriGeometryPolygon":N=new h;break;default:L.hasXYFootprint&&L.hasXYFootprint()&&(N=new h)}return N},_getItemsFromItems:function(L){return v.map(L,function(N,T){N=I.mixin({index:T},N);N.label=this._trimLabel(N.label);
return N},this)},_trimLabel:function(L){var N=this.maxLabelLength;N&&L&&L.length>N&&(L=L.substr(0,N)+"...");return L||""},_cellGet:function(L,N,T){return T?this.grid.store.getValue(T,"cell"+L):""},_cellFormatter:function(L){if(L){var N=this._itemWidgets,T=this.grid.store,R=T.getValue(L,"surfaceId"),Q=N[R];Q||(Q=N[R]=new z({id:R,label:T.getValue(L,"label"),symbol:T.getValue(L,"symbol"),legendOverride:T.getValue(L,"legendOverride"),surfaceWidth:this.surfaceWidth,surfaceHeight:this.surfaceHeight,template:T.getValue(L,
"template")}));return Q||""}return""},_cellGetGroup:function(L,N){if(!this._groupRowIndices)return"";L=v.indexOf(this._groupRowIndices,L);return N&&-1!==L?(N=this.featureLayers[L])&&(this.groupLabelFunction?this.groupLabelFunction(N):N.name)||"":""},_cellGroupFormatter:function(L){return L?"\x3cdiv class\x3d'groupLabel'\x3e"+L+"\x3c/div\x3e":""}});r("extend-esri")&&I.setObject("dijit.editing.TemplatePicker",O,e);return O})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),
function(M,I,F,D,v,m,u,r,w){F=F("dojo.data.ItemFileReadStore",[m],{constructor:function(f){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=f.url;this._jsonData=f.data;this.data=null;this._datatypeMap=f.typeMap||{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(c){return w.fromISOString(c)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName=
"_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==f.urlPreventCache&&(this.urlPreventCache=f.urlPreventCache?!0:!1);void 0!==f.hierarchical&&(this.hierarchical=f.hierarchical?!0:!1);f.clearOnClose&&(this.clearOnClose=!0);"failOk"in f&&(this.failOk=f.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(f){if(!this.isItem(f))throw Error(this.declaredClass+
": Invalid item argument.");},_assertIsAttribute:function(f){if("string"!==typeof f)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(f,c,n){f=this.getValues(f,c);return 0<f.length?f[0]:n},getValues:function(f,c){this._assertIsItem(f);this._assertIsAttribute(c);return(f[c]||[]).slice(0)},getAttributes:function(f){this._assertIsItem(f);var c=[],n;for(n in f)n!==this._storeRefPropName&&n!==this._itemNumPropName&&n!==this._rootItemPropName&&n!==this._reverseRefMap&&
c.push(n);return c},hasAttribute:function(f,c){this._assertIsItem(f);this._assertIsAttribute(c);return c in f},containsValue:function(f,c,n){var q=void 0;"string"===typeof n&&(q=u.patternToRegExp(n,!1));return this._containsValue(f,c,n,q)},_containsValue:function(f,c,n,q){return D.some(this.getValues(f,c),function(d){if(null!==d&&!I.isObject(d)&&q){if(d.toString().match(q))return!0}else if(n===d)return!0})},isItem:function(f){return f&&f[this._storeRefPropName]===this&&this._arrayOfAllItems[f[this._itemNumPropName]]===
f?!0:!1},isItemLoaded:function(f){return this.isItem(f)},loadItem:function(f){this._assertIsItem(f.item)},getFeatures:function(){return this._features},getLabel:function(f){if(this._labelAttr&&this.isItem(f))return this.getValue(f,this._labelAttr)},getLabelAttributes:function(f){return this._labelAttr?[this._labelAttr]:null},filter:function(f,c,n){var q=[];if(f.query){var d=f.queryOptions?f.queryOptions.ignoreCase:!1;var a={};for(p in f.query){var b=f.query[p];"string"===typeof b?a[p]=u.patternToRegExp(b,
d):b instanceof RegExp&&(a[p]=b)}for(d=0;d<c.length;++d){var k=!0,g=c[d];if(null===g)k=!1;else for(p in f.query)b=f.query[p],this._containsValue(g,p,b,a[p])||(k=!1);k&&q.push(g)}}else for(d=0;d<c.length;++d){var p=c[d];null!==p&&q.push(p)}n(q,f)},_fetchItems:function(f,c,n){var q=this;if(this._loadFinished)this.filter(f,this._getItemsArray(f.queryOptions),c);else if(this._jsonFileUrl!==this._ccUrl?(M.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),
this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:f,filter:I.hitch(q,"filter"),findCallback:I.hitch(q,c)});else{this._loadInProgress=!0;var d=v.get({url:q._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});d.addCallback(function(b){try{q._getItemsFromLoadedData(b),
q._loadFinished=!0,q._loadInProgress=!1,q.filter(f,q._getItemsArray(f.queryOptions),c),q._handleQueuedFetches()}catch(k){q._loadFinished=!0,q._loadInProgress=!1,n(k,f)}});d.addErrback(function(b){q._loadInProgress=!1;n(b,f)});var a=null;f.abort&&(a=f.abort);f.abort=function(){var b=d;b&&-1===b.fired&&(b.cancel(),b=null);a&&a.call(f)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,q.filter(f,this._getItemsArray(f.queryOptions),c)}catch(b){n(b,
f)}else n(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),f)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var f=0;f<this._queuedFetches.length;f++){var c=this._queuedFetches[f],n=c.args,q=c.filter;c=c.findCallback;q?q(n,this._getItemsArray(n.queryOptions),c):this.fetchItemByIdentity(n)}this._queuedFetches=[]}},_getItemsArray:function(f){return f&&f.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(f){this.clearOnClose&&
this._loadFinished&&!this._loadInProgress&&(""!=this._jsonFileUrl&&null!=this._jsonFileUrl||""!=this.url&&null!=this.url||null!=this.data||console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(f){function c(x){return null!==
x&&"object"===typeof x&&(!I.isArray(x)||q)&&!I.isFunction(x)&&(x.constructor==Object||I.isArray(x))&&"undefined"===typeof x._reference&&"undefined"===typeof x._type&&"undefined"===typeof x._value&&d.hierarchical}function n(x){d._arrayOfAllItems.push(x);for(var z in x){var e=x[z];if(e)if(I.isArray(e))for(var t=0;t<e.length;++t){var y=e[t];c(y)&&n(y)}else c(e)&&n(e)}}var q=!1,d=this;this._labelAttr=f.label;var a;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=f.items;for(a=0;a<this._arrayOfTopLevelItems.length;++a){var b=
this._arrayOfTopLevelItems[a];I.isArray(b)&&(q=!0);n(b);b[this._rootItemPropName]=!0}var k={},g;for(a=0;a<this._arrayOfAllItems.length;++a)for(g in b=this._arrayOfAllItems[a],b){if(g!==this._rootItemPropName){var p=b[g];null!==p?I.isArray(p)||(b[g]=[p]):b[g]=[null]}k[g]=g}for(;k[this._storeRefPropName];)this._storeRefPropName+="_";for(;k[this._itemNumPropName];)this._itemNumPropName+="_";for(;k[this._reverseRefMap];)this._reverseRefMap+="_";if(k=f.identifier)for(this._itemsByIdentity={},this._features["dojo.data.api.Identity"]=
k,a=0;a<this._arrayOfAllItems.length;++a)if(b=this._arrayOfAllItems[a],f=b[k],f=f[0],Object.hasOwnProperty.call(this._itemsByIdentity,f)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+k+"].  Value collided: ["+f+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+k+"].  Value collided: ["+
f+"]");}else this._itemsByIdentity[f]=b;else this._features["dojo.data.api.Identity"]=Number;for(a=0;a<this._arrayOfAllItems.length;++a)b=this._arrayOfAllItems[a],b[this._storeRefPropName]=this,b[this._itemNumPropName]=a;for(a=0;a<this._arrayOfAllItems.length;++a)for(g in b=this._arrayOfAllItems[a],b)for(f=b[g],k=0;k<f.length;++k)if(p=f[k],null!==p&&"object"==typeof p){if("_type"in p&&"_value"in p){var B=p._type,J=this._datatypeMap[B];if(J)if(I.isFunction(J))f[k]=new J(p._value);else if(I.isFunction(J.deserialize))f[k]=
J.deserialize(p._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+B+"'");}if(p._reference){p=p._reference;if(I.isObject(p))for(B=0;B<this._arrayOfAllItems.length;++B){J=this._arrayOfAllItems[B];var A=!0,h;for(h in p)J[h]!=p[h]&&(A=!1);A&&(f[k]=J)}else f[k]=this._getItemByIdentity(p);
this.referenceIntegrity&&(p=f[k],this.isItem(p)&&this._addReferenceToMap(p,b,g))}else this.isItem(p)&&this.referenceIntegrity&&this._addReferenceToMap(p,b,g)}},_addReferenceToMap:function(f,c,n){},getIdentity:function(f){var c=this._features["dojo.data.api.Identity"];return c===Number?f[this._itemNumPropName]:(f=f[c])?f[0]:null},fetchItemByIdentity:function(f){if(this._loadFinished){var c=this._getItemByIdentity(f.identity);if(f.onItem){var n=f.scope?f.scope:M.global;f.onItem.call(n,c)}}else{var q=
this;this._jsonFileUrl!==this._ccUrl?(M.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:f}):(this._loadInProgress=!0,n=v.get({url:q._jsonFileUrl,
handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),n.addCallback(function(d){var a=f.scope?f.scope:M.global;try{q._getItemsFromLoadedData(d),q._loadFinished=!0,q._loadInProgress=!1,c=q._getItemByIdentity(f.identity),f.onItem&&f.onItem.call(a,c),q._handleQueuedFetches()}catch(b){q._loadInProgress=!1,f.onError&&f.onError.call(a,b)}}),n.addErrback(function(d){q._loadInProgress=!1;f.onError&&f.onError.call(f.scope?f.scope:M.global,d)})):this._jsonData&&(q._getItemsFromLoadedData(q._jsonData),
q._jsonData=null,q._loadFinished=!0,c=q._getItemByIdentity(f.identity),f.onItem&&(n=f.scope?f.scope:M.global,f.onItem.call(n,c)))}},_getItemByIdentity:function(f){var c=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,f)&&(c=this._itemsByIdentity[f]):Object.hasOwnProperty.call(this._arrayOfAllItems,f)&&(c=this._arrayOfAllItems[f]);void 0===c&&(c=null);return c},getIdentityAttributes:function(f){f=this._features["dojo.data.api.Identity"];return f===Number?null:[f]},_forceLoad:function(){var f=
this;this._jsonFileUrl!==this._ccUrl?(M.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var c=v.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,
sync:!0});c.addCallback(function(n){try{if(!0!==f._loadInProgress&&!f._loadFinished)f._getItemsFromLoadedData(n),f._loadFinished=!0;else if(f._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(q){throw console.log(q),q;}});c.addErrback(function(n){throw n;})}else this._jsonData&&(f._getItemsFromLoadedData(f._jsonData),f._jsonData=null,f._loadFinished=!0)}});I.extend(F,r);return F})},"dojo/data/util/filter":function(){define(["../../_base/lang"],
function(M){var I={};M.setObject("dojo.data.util.filter",I);I.patternToRegExp=function(F,D){for(var v="^",m=null,u=0;u<F.length;u++)switch(m=F.charAt(u),m){case "\\":v+=m;u++;v+=F.charAt(u);break;case "*":v+=".*";break;case "?":v+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":v+="\\";default:v+=m}v+="$";return D?new RegExp(v,"mi"):new RegExp(v,"m")};return I})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang",
"../../_base/kernel","./sorter"],function(M,I,F){var D={};M.setObject("dojo.data.util.simpleFetch",D);D.errorHandler=function(v,m){m.onError&&m.onError.call(m.scope||I.global,v,m)};D.fetchHandler=function(v,m){var u=m.abort||null,r=!1,w=m.start?m.start:0,f=m.count&&Infinity!==m.count?w+m.count:v.length;m.abort=function(){r=!0;u&&u.call(m)};var c=m.scope||I.global;m.store||(m.store=this);m.onBegin&&m.onBegin.call(c,v.length,m);m.sort&&v.sort(F.createSortFunction(m.sort,this));if(m.onItem)for(var n=
w;n<v.length&&n<f;++n){var q=v[n];r||m.onItem.call(c,q,m)}m.onComplete&&!r&&(n=null,m.onItem||(n=v.slice(w,f)),m.onComplete.call(c,n,m))};D.fetch=function(v){v=v||{};v.store||(v.store=this);this._fetchItems(v,M.hitch(this,"fetchHandler"),M.hitch(this,"errorHandler"));return v};return D})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(M){var I={};M.setObject("dojo.data.util.sorter",I);I.basicComparator=function(F,D){var v=-1;null===F&&(F=void 0);null===D&&(D=void 0);if(F==
D)v=0;else if(F>D||null==F)v=1;return v};I.createSortFunction=function(F,D){function v(q,d,a,b){return function(k,g){k=b.getValue(k,q);g=b.getValue(g,q);return d*a(k,g)}}for(var m=[],u,r=D.comparatorMap,w=I.basicComparator,f=0;f<F.length;f++){u=F[f];var c=u.attribute;if(c){u=u.descending?-1:1;var n=w;r&&("string"!==typeof c&&"toString"in c&&(c=c.toString()),n=r[c]||w);m.push(v(c,u,n,D))}}return function(q,d){for(var a=0;a<m.length;){var b=m[a++](q,d);if(0!==b)return b}return 0}};return I})},"dojox/grid/DataGrid":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/json dojo/_base/sniff dojo/_base/declare ./_Grid ./DataSelection dojo/_base/html dojo/has dojo/has!dojo-bidi?./bidi/_BidiMixin".split(" "),
function(M,I,F,D,v,m,u,r,w){var f=m("dojox.grid.DataGrid",u,{store:null,query:null,queryOptions:null,fetchText:"...",sortFields:null,updateDelay:1,items:null,_store_connects:null,_by_idty:null,_by_idx:null,_cache:null,_pages:null,_pending_requests:null,_bop:-1,_eop:-1,_requests:0,rowCount:0,_isLoaded:!1,_isLoading:!1,keepSelection:!1,postCreate:function(){this._pages=[];this._store_connects=[];this._by_idty={};this._by_idx=[];this._cache=[];this._pending_requests={};this._setStore(this.store);this.inherited(arguments)},
destroy:function(){this.selection.destroy();this.inherited(arguments)},createSelection:function(){this.selection=new r(this)},get:function(c,n){if(n&&"_item"==this.field&&!this.fields)return n;if(n&&this.fields){var q=[],d=this.grid.store;I.forEach(this.fields,function(a){q=q.concat(d.getValues(n,a))});return q}return n||"string"!==typeof c?n?this.field?"_item"==this.field?n:this.grid.store.getValue(n,this.field):this.value:this.defaultValue:this.inherited(arguments)},_checkUpdateStatus:function(){if(0<
this.updateDelay){var c=!1;this._endUpdateDelay&&(clearTimeout(this._endUpdateDelay),delete this._endUpdateDelay,c=!0);this.updating||(this.beginUpdate(),c=!0);if(c){var n=this;this._endUpdateDelay=setTimeout(function(){delete n._endUpdateDelay;n.endUpdate()},this.updateDelay)}}},_onSet:function(c,n,q,d){this._checkUpdateStatus();c=this.getItemIndex(c);-1<c&&this.updateRow(c)},_createItem:function(c,n){n=this._hasIdentity?this.store.getIdentity(c):D.toJson(this.query)+":idx:"+n+":sort:"+D.toJson(this.getSortProps());
return this._by_idty[n]={idty:n,item:c}},_addItem:function(c,n,q){this._by_idx[n]=this._createItem(c,n);q||this.updateRow(n)},_onNew:function(c,n){this._checkUpdateStatus();n=this.get("rowCount");this._addingItem=!0;this.updateRowCount(n+1);this._addingItem=!1;this._addItem(c,n);this.showMessage()},_onDelete:function(c){this._checkUpdateStatus();c=this._getItemIndex(c,!0);if(0<=c){this._pages=[];this._eop=this._bop=-1;var n=this._by_idx[c];this._by_idx.splice(c,1);delete this._by_idty[n.idty];this.updateRowCount(this.get("rowCount")-
1);0===this.get("rowCount")&&this.showMessage(this.noDataMessage)}this.selection.isSelected(c)&&(this.selection.deselect(c),this.selection.selected.splice(c,1))},_onRevert:function(){this._refresh()},setStore:function(c,n,q){this._requestsPending(0)||(this._setQuery(n,q),this._setStore(c),this._refresh(!0))},setQuery:function(c,n){this._requestsPending(0)||(this._setQuery(c,n),this._refresh(!0))},setItems:function(c){this.items=c;this._setStore(this.store);this._refresh(!0)},_setQuery:function(c,
n){this.query=c;this.queryOptions=n||this.queryOptions},_setStore:function(c){this.store&&this._store_connects&&I.forEach(this._store_connects,this.disconnect,this);if(this.store=c){c=this.store.getFeatures();var n=[];this._canEdit=!!c["dojo.data.api.Write"]&&!!c["dojo.data.api.Identity"];this._hasIdentity=!!c["dojo.data.api.Identity"];c["dojo.data.api.Notification"]&&!this.items&&(n.push(this.connect(this.store,"onSet","_onSet")),n.push(this.connect(this.store,"onNew","_onNew")),n.push(this.connect(this.store,
"onDelete","_onDelete")));this._canEdit&&n.push(this.connect(this.store,"revert","_onRevert"));this._store_connects=n}},_onFetchBegin:function(c,n){this.scroller&&(this.rowCount!=c&&(n.isRender?(this.scroller.init(c,this.keepRows,this.rowsPerPage),this.rowCount=c,this._setAutoHeightAttr(this.autoHeight,!0),this._skipRowRenormalize=!0,this.prerender(),this._skipRowRenormalize=!1):this.updateRowCount(c)),c?this.showMessage():(this.views.render(),this._resize(),this.showMessage(this.noDataMessage),this.focus.initFocusView()))},
_onFetchComplete:function(c,n){this.scroller&&(c&&0<c.length&&(I.forEach(c,function(q,d){this._addItem(q,n.start+d,!0)},this),this.updateRows(n.start,c.length),n.isRender?(this.setScrollTop(0),this.postrender()):this._lastScrollTop&&this.setScrollTop(this._lastScrollTop),v("ie")&&w.setSelectable(this.domNode,this.selectable)),delete this._lastScrollTop,this._isLoaded||(this._isLoading=!1,this._isLoaded=!0),this._pending_requests[n.start]=!1)},_onFetchError:function(c,n){console.log(c);delete this._lastScrollTop;
this._isLoaded||(this._isLoading=!1,this._isLoaded=!0,this.showMessage(this.errorMessage));this._pending_requests[n.start]=!1;this.onFetchError(c,n)},onFetchError:function(c,n){},_fetch:function(c,n){c=c||0;if(this.store&&!this._pending_requests[c]){this._isLoaded||this._isLoading||(this._isLoading=!0,this.showMessage(this.loadingMessage));this._pending_requests[c]=!0;try{if(this.items){var q=this.items,d=this.store;this.rowsPerPage=q.length;var a={start:c,count:this.rowsPerPage,isRender:n};this._onFetchBegin(q.length,
a);var b=0;I.forEach(q,function(g){d.isItemLoaded(g)||b++});if(0===b)this._onFetchComplete(q,a);else{var k=function(g){b--;0===b&&this._onFetchComplete(q,a)};I.forEach(q,function(g){d.isItemLoaded(g)||d.loadItem({item:g,onItem:k,scope:this})},this)}}else this.store.fetch({start:c,count:this.rowsPerPage,query:this.query,sort:this.getSortProps(),queryOptions:this.queryOptions,isRender:n,onBegin:F.hitch(this,"_onFetchBegin"),onComplete:F.hitch(this,"_onFetchComplete"),onError:F.hitch(this,"_onFetchError")})}catch(g){this._onFetchError(g,
{start:c,count:this.rowsPerPage})}}},_clearData:function(){this.updateRowCount(0);this._by_idty={};this._by_idx=[];this._pages=[];this._bop=this._eop=-1;this._isLoading=this._isLoaded=!1},getItem:function(c){var n=this._by_idx[c];return!n||n&&!n.item?(this._preparePage(c),null):n.item},getItemIndex:function(c){return this._getItemIndex(c,!1)},_getItemIndex:function(c,n){if(!n&&!this.store.isItem(c))return-1;n=this._hasIdentity?this.store.getIdentity(c):null;for(var q=0,d=this._by_idx.length;q<d;q++){var a=
this._by_idx[q];if(a&&(n&&a.idty==n||a.item===c))return q}return-1},filter:function(c,n){this.query=c;n&&this._clearData();this._fetch()},_getItemAttr:function(c,n){return(c=this.getItem(c))?this.store.getValue(c,n):this.fetchText},_render:function(){this.domNode.parentNode&&(this.scroller.init(this.get("rowCount"),this.keepRows,this.rowsPerPage),this.prerender(),this._fetch(0,!0))},_requestsPending:function(c){return this._pending_requests[c]},_rowToPage:function(c){return this.rowsPerPage?Math.floor(c/
this.rowsPerPage):c},_pageToRow:function(c){return this.rowsPerPage?this.rowsPerPage*c:c},_preparePage:function(c){(c<this._bop||c>=this._eop)&&!this._addingItem&&(c=this._rowToPage(c),this._needPage(c),this._bop=c*this.rowsPerPage,this._eop=this._bop+(this.rowsPerPage||this.get("rowCount")))},_needPage:function(c){this._pages[c]||(this._pages[c]=!0,this._requestPage(c))},_requestPage:function(c){c=this._pageToRow(c);0<Math.min(this.rowsPerPage,this.get("rowCount")-c)&&(this._requests++,this._requestsPending(c)||
setTimeout(F.hitch(this,"_fetch",c,!1),1))},getCellName:function(c){return c.field},_refresh:function(c){this._clearData();this._fetch(0,c)},sort:function(){this.edit.apply();this._lastScrollTop=this.scrollTop;this._refresh()},canSort:function(){return!this._isLoading},getSortProps:function(){var c=this.getCell(this.getSortIndex());if(c){var n=c.sortDesc,q=!(0<this.sortInfo);return[{attribute:c.field,descending:"undefined"==typeof n?q:q?!n:n}]}return this.sortFields?this.sortFields:null},styleRowState:function(c){if(this.store&&
this.store.getState){for(var n=this.store.getState(c.index),q="",d=0,a=["inflight","error","inserting"],b;b=a[d];d++)if(n[b]){q=" dojoxGridRow-"+b;break}c.customClasses+=q}},onStyleRow:function(c){this.styleRowState(c);this.inherited(arguments)},canEdit:function(c,n){return this._canEdit},_copyAttr:function(c,n){c=this.getItem(c);return this.store.getValue(c,n)},doStartEdit:function(c,n){this._cache[n]||(this._cache[n]=this._copyAttr(n,c.field));this.onStartEdit(c,n)},doApplyCellEdit:function(c,n,
q){this.store.fetchItemByIdentity({identity:this._by_idx[n].idty,onItem:F.hitch(this,function(d){var a=this.store.getValue(d,q);"number"==typeof a?c=isNaN(c)?c:parseFloat(c):"boolean"==typeof a?c="true"==c?!0:"false"==c?!1:c:a instanceof Date&&(a=new Date(c),c=isNaN(a.getTime())?c:a);this.store.setValue(d,q,c);this.onApplyCellEdit(c,n,q)})})},doCancelEdit:function(c){this._cache[c]&&(this.updateRow(c),delete this._cache[c]);this.onCancelEdit.apply(this,arguments)},doApplyEdit:function(c,n){this.onApplyEdit(c)},
removeSelectedRows:function(){if(this._canEdit){this.edit.apply();var c=F.hitch(this,function(n){n.length&&(I.forEach(n,this.store.deleteItem,this.store),this.selection.clear())});this.allItemsSelected?this.store.fetch({query:this.query,queryOptions:this.queryOptions,onComplete:c}):c(this.selection.getSelected())}}});f.cell_markupFactory=function(c,n,q){var d=F.trim(w.attr(n,"field")||"");d&&(q.field=d);q.field=q.field||q.name;if(d=F.trim(w.attr(n,"fields")||""))q.fields=d.split(",");c&&c(n,q)};f.markupFactory=
function(c,n,q,d){return u.markupFactory(c,n,q,F.partial(f.cell_markupFactory,d))};return f})},"dojox/main":function(){define(["dojo/_base/kernel"],function(M){return M.dojox})},"dojox/grid/_Grid":function(){define("dojo/_base/kernel ../main dojo/_base/declare ./_Events ./_Scroller ./_Layout ./_View ./_ViewManager ./_RowManager ./_FocusManager ./_EditManager ./Selection ./_RowSelector ./util dijit/_Widget dijit/_TemplatedMixin dijit/CheckedMenuItem dojo/text!./resources/_Grid.html dojo/string dojo/_base/array dojo/_base/lang dojo/_base/sniff dojox/html/metrics dojo/_base/html dojo/query dojo/dnd/common dojo/i18n!dijit/nls/loading".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a,b,k,g,p,B,J,A,h,x,z){M.isCopyKey||(M.isCopyKey=M.dnd.getCopyKeyState);F=F("dojox.grid._Grid",[a,b,D],{templateString:g,classTag:"dojoxGrid",rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:!1,initialWidth:"",autoHeight:"",rowHeight:0,autoRender:!0,defaultHeight:"15em",height:"",structure:null,elasticView:-1,singleClickEdit:!1,selectionMode:"extended",rowSelector:"",columnReordering:!1,headerMenu:null,placeholderLabel:"GridColumns",selectable:!1,_click:null,loadingMessage:"\x3cspan class\x3d'dojoxGridLoading'\x3e${loadingState}\x3c/span\x3e",
errorMessage:"\x3cspan class\x3d'dojoxGridError'\x3e${errorState}\x3c/span\x3e",noDataMessage:"",escapeHTMLInData:!0,formatterScope:null,editable:!1,summary:"",_setSummaryAttr:"domNode",sortInfo:0,_placeholders:null,_layoutClass:m,buildRendering:function(){this.inherited(arguments);this.domNode.getAttribute("tabIndex")||(this.domNode.tabIndex="0");this.createScroller();this.createLayout();this.createViews();this.createManagers();this.createSelection();this.connect(this.selection,"onSelected","onSelected");
this.connect(this.selection,"onDeselected","onDeselected");this.connect(this.selection,"onChanged","onSelectionChanged");h.initOnFontResize();this.connect(h,"onFontResize","textSizeChanged");d.funnelEvents(this.domNode,this,"doKeyEvent",d.keyEvents);"none"!=this.selectionMode&&this.domNode.setAttribute("aria-multiselectable","single"==this.selectionMode?"false":"true");x.addClass(this.domNode,this.classTag);this.isLeftToRight()||x.addClass(this.domNode,this.classTag+"Rtl");0<this.rowHeight&&x.addClass(this.viewsNode,
this.classTag+"FixedRowHeight")},postMixInProperties:function(){this.inherited(arguments);var e=M.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=p.substitute(this.loadingMessage,e);this.errorMessage=p.substitute(this.errorMessage,e);this.srcNodeRef&&this.srcNodeRef.style.height&&(this.height=this.srcNodeRef.style.height);this._setAutoHeightAttr(this.autoHeight,!0);this.lastScrollTop=this.scrollTop=0},postCreate:function(){this._placeholders=[];this._setHeaderMenuAttr(this.headerMenu);
this._setStructureAttr(this.structure);this._click=[];this.inherited(arguments);this.domNode&&this.autoWidth&&this.initialWidth&&(this.domNode.style.width=this.initialWidth);this.domNode&&!this.editable&&x.attr(this.domNode,"aria-readonly","true")},destroy:function(){this.domNode.onReveal=null;this.domNode.onSizeChange=null;delete this._click;this.scroller&&(this.scroller.destroy(),delete this.scroller);this.edit.destroy();delete this.edit;this.views.destroyViews();this.focus&&(this.focus.destroy(),
delete this.focus);this.headerMenu&&this._placeholders.length&&(B.forEach(this._placeholders,function(e){e.unReplace(!0)}),this.headerMenu.unBindDomNode(this.viewsHeaderNode));this.inherited(arguments)},_setAutoHeightAttr:function(e,t){"string"==typeof e&&(e=e&&"false"!=e?"true"==e?!0:window.parseInt(e,10):!1);"number"==typeof e&&(isNaN(e)&&(e=!1),0>e?e=!0:0===e&&(e=!1));this.autoHeight=e;this._autoHeight="boolean"==typeof e?e:"number"==typeof e?e>=this.get("rowCount"):!1;this._started&&!t&&this.render()},
_getRowCountAttr:function(){return this.updating&&this.invalidated&&void 0!=this.invalidated.rowCount?this.invalidated.rowCount:this.rowCount},textSizeChanged:function(){this.render()},sizeChange:function(){this.update()},createManagers:function(){this.rows=new w(this);this.focus=new f(this);this.edit=new c(this)},createSelection:function(){this.selection=new n(this)},createScroller:function(){this.scroller=new v;this.scroller.grid=this;this.scroller.renderRow=J.hitch(this,"renderRow");this.scroller.removeRow=
J.hitch(this,"rowRemoved")},createLayout:function(){this.layout=new this._layoutClass(this);this.connect(this.layout,"moveColumn","onMoveColumn")},onMoveColumn:function(){this.update()},onResizeColumn:function(e){},createViews:function(){this.views=new r(this);this.views.createView=J.hitch(this,"createView")},createView:function(e,t){e=new (J.getObject(e))({grid:this,index:t});this.viewsNode.appendChild(e.domNode);this.viewsHeaderNode.appendChild(e.headerNode);this.views.addView(e);x.attr(this.domNode,
"align",this.isLeftToRight()?"left":"right");return e},buildViews:function(){for(var e=0,t;t=this.layout.structure[e];e++)this.createView(t.type||I._scopeName+".grid._View",e).setStructure(t);this.scroller.setContentNodes(this.views.getContentNodes())},_setStructureAttr:function(e){e&&J.isString(e)&&(M.deprecated("dojox.grid._Grid.set('structure', 'objVar')","use dojox.grid._Grid.set('structure', objVar) instead","2.0"),e=J.getObject(e));this.structure=e;if(!e)if(this.layout.structure)e=this.layout.structure;
else return;this.views.destroyViews();this.focus.focusView=null;e!==this.layout.structure&&this.layout.setStructure(e);this._structureChanged()},setStructure:function(e){M.deprecated("dojox.grid._Grid.setStructure(obj)","use dojox.grid._Grid.set('structure', obj) instead.","2.0");this._setStructureAttr(e)},getColumnTogglingItems:function(){var e=[];var t=B.map(this.layout.cells,function(y){y.menuItems||(y.menuItems=[]);var H=this,E=new k({label:y.name,checked:!y.hidden,_gridCell:y,onChange:function(G){if(H.layout.setColumnVisibility(this._gridCell.index,
G)){var O=this._gridCell.menuItems;1<O.length&&B.forEach(O,function(L){L!==this&&L.setAttribute("checked",G)},this);G=B.filter(H.layout.cells,function(L){1<L.menuItems.length?B.forEach(L.menuItems,"item.set('disabled', false);"):L.menuItems[0].set("disabled",!1);return!L.hidden});1==G.length&&B.forEach(G[0].menuItems,"item.set('disabled', true);")}},destroy:function(){var G=B.indexOf(this._gridCell.menuItems,this);this._gridCell.menuItems.splice(G,1);delete this._gridCell;k.prototype.destroy.apply(this,
arguments)}});y.menuItems.push(E);y.hidden||e.push(E);return E},this);1==e.length&&e[0].set("disabled",!0);return t},_setHeaderMenuAttr:function(e){this._placeholders&&this._placeholders.length&&(B.forEach(this._placeholders,function(t){t.unReplace(!0)}),this._placeholders=[]);this.headerMenu&&this.headerMenu.unBindDomNode(this.viewsHeaderNode);if(this.headerMenu=e)this.headerMenu.bindDomNode(this.viewsHeaderNode),this.headerMenu.getPlaceholders&&(this._placeholders=this.headerMenu.getPlaceholders(this.placeholderLabel))},
setHeaderMenu:function(e){M.deprecated("dojox.grid._Grid.setHeaderMenu(obj)","use dojox.grid._Grid.set('headerMenu', obj) instead.","2.0");this._setHeaderMenuAttr(e)},setupHeaderMenu:function(){this._placeholders&&this._placeholders.length&&B.forEach(this._placeholders,function(e){e._replaced&&e.unReplace(!0);e.replace(this.getColumnTogglingItems())},this)},_fetch:function(e){this.setScrollTop(0)},getItem:function(e){return null},showMessage:function(e){e?(this.messagesNode.innerHTML=e,this.messagesNode.style.display=
""):(this.messagesNode.innerHTML="",this.messagesNode.style.display="none")},_structureChanged:function(){this.buildViews();this.autoRender&&this._started&&this.render()},hasLayout:function(){return this.layout.cells.length},resize:function(e,t){this._pendingChangeSize=e;this._pendingResultSize=t;this.sizeChange()},_getPadBorder:function(){return this._padBorder=this._padBorder||x._getPadBorderExtents(this.domNode)},_getHeaderHeight:function(){var e=this.viewsHeaderNode.style,t="none"==e.display?
0:this.views.measureHeader();e.height=t+"px";this.views.normalizeHeaderNodeHeight();return t},_resize:function(e,t){e=e||this._pendingChangeSize;t=t||this._pendingResultSize;delete this._pendingChangeSize;delete this._pendingResultSize;if(this.domNode){var y=this.domNode.parentNode;if(y&&1==y.nodeType&&this.hasLayout()&&"hidden"!=y.style.visibility&&"none"!=y.style.display){var H=this._getPadBorder(),E=void 0;if(this._autoHeight)this.domNode.style.height="auto";else if("number"==typeof this.autoHeight){var G=
E=this._getHeaderHeight();G+=this.scroller.averageRowHeight*this.autoHeight;this.domNode.style.height=G+"px"}else this.domNode.clientHeight<=H.h&&(y==document.body?this.domNode.style.height=this.defaultHeight:this.height?this.domNode.style.height=this.height:this.fitTo="parent");t&&(e=t);!this._autoHeight&&e?(x.marginBox(this.domNode,e),this.height=this.domNode.style.height,delete this.fitTo):"parent"==this.fitTo&&(G=this._parentContentBoxHeight=0<this._parentContentBoxHeight?this._parentContentBoxHeight:
x._getContentBox(y).h,this.domNode.style.height=Math.max(0,G)+"px");e=B.some(this.views.views,function(O){return O.flexCells});this._autoHeight||0!==(G||x._getContentBox(this.domNode).h)?(this.viewsHeaderNode.style.display="block",e||void 0!==E||(E=this._getHeaderHeight())):this.viewsHeaderNode.style.display="none";e&&(E=void 0);this.adaptWidth();this.adaptHeight(E);this.postresize()}}},adaptWidth:function(){var e=!this.initialWidth&&this.autoWidth,t=e?0:this.domNode.clientWidth||this.domNode.offsetWidth-
this._getPadBorder().w;t=this.views.arrange(1,t);this.views.onEach("adaptWidth");e&&(this.domNode.style.width=t+"px")},adaptHeight:function(e){e=void 0===e?this._getHeaderHeight():e;var t=this._autoHeight?-1:Math.max(this.domNode.clientHeight-e,0)||0;this.views.onEach("setSize",[0,t]);this.views.onEach("adaptHeight");if(!this._autoHeight){var y=0,H=0,E=B.filter(this.views.views,function(G){(G=G.hasHScrollbar())?y++:H++;return!G});0<y&&0<H&&B.forEach(E,function(G){G.adaptHeight(!0)})}!0===this.autoHeight||
-1!=t||"number"==typeof this.autoHeight&&this.autoHeight>=this.get("rowCount")?this.scroller.windowHeight=t:this.scroller.windowHeight=Math.max(this.domNode.clientHeight-e,0)},startup:function(){this._started||(this.inherited(arguments),this.autoRender&&this.render())},render:function(){this.domNode&&this._started&&(this.hasLayout()?(this.update=this.defaultUpdate,this._render()):this.scroller.init(0,this.keepRows,this.rowsPerPage))},_render:function(){this.scroller.init(this.get("rowCount"),this.keepRows,
this.rowsPerPage);this.prerender();this.setScrollTop(0);this.postrender()},prerender:function(){this.keepRows=this._autoHeight?0:this.keepRows;this.scroller.setKeepInfo(this.keepRows);this.views.render();this._resize()},postrender:function(){this.postresize();this.focus.initFocusView();x.setSelectable(this.domNode,this.selectable)},postresize:function(){if(this._autoHeight){var e=Math.max(this.views.measureContent())+"px";this.viewsNode.style.height=e}},renderRow:function(e,t){this.views.renderRow(e,
t,this._skipRowRenormalize)},rowRemoved:function(e){this.views.rowRemoved(e)},invalidated:null,updating:!1,beginUpdate:function(){this.invalidated=[];this.updating=!0},endUpdate:function(){this.updating=!1;var e=this.invalidated,t;if(e.all)this.update();else if(void 0!=e.rowCount)this.updateRowCount(e.rowCount);else for(t in e)this.updateRow(Number(t));this.invalidated=[]},defaultUpdate:function(){this.domNode&&(this.updating?this.invalidated.all=!0:(this.lastScrollTop=this.scrollTop,this.prerender(),
this.scroller.invalidateNodes(),this.setScrollTop(this.lastScrollTop),this.postrender()))},update:function(){this.render()},updateRow:function(e){e=Number(e);this.updating?this.invalidated[e]=!0:(this.views.updateRow(e),this.scroller.rowHeightChanged(e))},updateRows:function(e,t){e=Number(e);t=Number(t);var y;if(this.updating)for(y=0;y<t;y++)this.invalidated[y+e]=!0;else{for(y=0;y<t;y++)this.views.updateRow(y+e,this._skipRowRenormalize);this.scroller.rowHeightChanged(e)}},updateRowCount:function(e){this.updating?
this.invalidated.rowCount=e:(this.rowCount=e,this._setAutoHeightAttr(this.autoHeight,!0),this.layout.cells.length&&this.scroller.updateRowCount(e),this.layout.cells.length&&this.setScrollTop(this.scrollTop),this._resize())},updateRowStyles:function(e){this.views.updateRowStyles(e)},getRowNode:function(e){if(!this.focus.focusView||this.focus.focusView instanceof q)for(var t=0,y;y=this.views.views[t];t++){if(!(y instanceof q))return y.rowNodes[e]}else return this.focus.focusView.rowNodes[e];return null},
rowHeightChanged:function(e){this.views.renormalizeRow(e);this.scroller.rowHeightChanged(e)},fastScroll:!0,delayScroll:!1,scrollRedrawThreshold:A("ie")?100:50,scrollTo:function(e){if(this.fastScroll){var t=Math.abs(this.lastScrollTop-e);this.lastScrollTop=e;if(t>this.scrollRedrawThreshold||this.delayScroll){this.delayScroll=!0;this.scrollTop=e;this.views.setScrollTop(e);this._pendingScroll&&window.clearTimeout(this._pendingScroll);var y=this;this._pendingScroll=window.setTimeout(function(){delete y._pendingScroll;
y.finishScrollJob()},200)}else this.setScrollTop(e)}else this.setScrollTop(e)},finishScrollJob:function(){this.delayScroll=!1;this.setScrollTop(this.scrollTop)},setScrollTop:function(e){this.scroller.scroll(this.views.setScrollTop(e))},scrollToRow:function(e){this.setScrollTop(this.scroller.findScrollTop(e)+1)},styleRowNode:function(e,t){t&&this.rows.styleRowNode(e,t)},_mouseOut:function(e){this.rows.setOverRow(-2)},getCell:function(e){return this.layout.cells[e]},setCellWidth:function(e,t){this.getCell(e).unitWidth=
t},getCellName:function(e){return"Cell "+e.index},canSort:function(e){},sort:function(){},getSortAsc:function(e){e=void 0==e?this.sortInfo:e;return 0<e},getSortIndex:function(e){e=void 0==e?this.sortInfo:e;return Math.abs(e)-1},setSortIndex:function(e,t){var y=e+1;void 0!=t?y*=t?1:-1:this.getSortIndex()==e&&(y=-this.sortInfo);this.setSortInfo(y)},setSortInfo:function(e){this.canSort(e)&&(this.sortInfo=e,this.sort(),this.update())},doKeyEvent:function(e){e.dispatch="do"+e.type;this.onKeyEvent(e)},
_dispatch:function(e,t){return e in this?this[e](t):!1},dispatchKeyEvent:function(e){this._dispatch(e.dispatch,e)},dispatchContentEvent:function(e){this.edit.dispatchEvent(e)||e.sourceView.dispatchContentEvent(e)||this._dispatch(e.dispatch,e)},dispatchHeaderEvent:function(e){e.sourceView.dispatchHeaderEvent(e)||this._dispatch("doheader"+e.type,e)},dokeydown:function(e){this.onKeyDown(e)},doclick:function(e){if(e.cellNode)this.onCellClick(e);else this.onRowClick(e)},dodblclick:function(e){if(e.cellNode)this.onCellDblClick(e);
else this.onRowDblClick(e)},docontextmenu:function(e){if(e.cellNode)this.onCellContextMenu(e);else this.onRowContextMenu(e)},doheaderclick:function(e){if(e.cellNode)this.onHeaderCellClick(e);else this.onHeaderClick(e)},doheaderdblclick:function(e){if(e.cellNode)this.onHeaderCellDblClick(e);else this.onHeaderDblClick(e)},doheadercontextmenu:function(e){if(e.cellNode)this.onHeaderCellContextMenu(e);else this.onHeaderContextMenu(e)},doStartEdit:function(e,t){this.onStartEdit(e,t)},doApplyCellEdit:function(e,
t,y){this.onApplyCellEdit(e,t,y)},doCancelEdit:function(e){this.onCancelEdit(e)},doApplyEdit:function(e){this.onApplyEdit(e)},addRow:function(){this.updateRowCount(this.get("rowCount")+1)},removeSelectedRows:function(){this.allItemsSelected?this.updateRowCount(0):this.updateRowCount(Math.max(0,this.get("rowCount")-this.selection.getSelected().length));this.selection.clear()}});F.markupFactory=function(e,t,y,H){var E=function(G){G=x.attr(G,"width")||"auto";"auto"!=G&&"em"!=G.slice(-2)&&"%"!=G.slice(-1)&&
(G=parseInt(G,10)+"px");return G};e.structure||"table"!=t.nodeName.toLowerCase()||(e.structure=z("\x3e colgroup",t).map(function(G){var O=x.attr(G,"span");O={noscroll:"true"==x.attr(G,"noscroll")?!0:!1,__span:O?parseInt(O,10):1,cells:[]};x.hasAttr(G,"width")&&(O.width=E(G));return O}),e.structure.length||e.structure.push({__span:Infinity,cells:[]}),z("thead \x3e tr",t).forEach(function(G,O){var L=0,N=0,T,R=null;z("\x3e th",G).map(function(Q){R?L>=T+R.__span&&(N++,T+=R.__span,R=e.structure[N]):(T=
0,R=e.structure[0]);var W={name:J.trim(x.attr(Q,"name")||Q.innerHTML),colSpan:parseInt(x.attr(Q,"colspan")||1,10),type:J.trim(x.attr(Q,"cellType")||""),id:J.trim(x.attr(Q,"id")||"")};L+=W.colSpan;var ba=x.attr(Q,"rowspan");ba&&(W.rowSpan=ba);x.hasAttr(Q,"width")&&(W.width=E(Q));x.hasAttr(Q,"relWidth")&&(W.relWidth=window.parseInt(x.attr(Q,"relWidth"),10));x.hasAttr(Q,"hidden")&&(W.hidden="true"==x.attr(Q,"hidden")||!0===x.attr(Q,"hidden"));H&&H(Q,W);W.type=W.type?J.getObject(W.type):I.grid.cells.Cell;
W.type&&W.type.markupFactory&&W.type.markupFactory(Q,W);R.cells[O]||(R.cells[O]=[]);R.cells[O].push(W)})}));return new y(e,t)};return F})},"dojox/grid/_Events":function(){define(["dojo/keys","dojo/dom-class","dojo/_base/declare","dojo/_base/event","dojo/_base/sniff"],function(M,I,F,D,v){return F("dojox.grid._Events",null,{cellOverClass:"dojoxGridCellOver",onKeyEvent:function(m){this.dispatchKeyEvent(m)},onContentEvent:function(m){this.dispatchContentEvent(m)},onHeaderEvent:function(m){this.dispatchHeaderEvent(m)},
onStyleRow:function(m){m.customClasses+=(m.odd?" dojoxGridRowOdd":"")+(m.selected?" dojoxGridRowSelected":"")+(m.over?" dojoxGridRowOver":"");this.focus.styleRow(m);this.edit.styleRow(m)},onKeyDown:function(m){if(!m.altKey&&!m.metaKey)switch(m.keyCode){case M.ESCAPE:this.edit.cancel();break;case M.ENTER:if(!this.edit.isEditing()){var u=this.focus.getHeaderIndex();if(0<=u){this.setSortIndex(u);break}else this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(m),m.shiftKey);D.stop(m)}m.shiftKey||
(u=this.edit.isEditing(),this.edit.apply(),u||this.edit.setEditCell(this.focus.cell,this.focus.rowIndex));this.edit.isEditing()||((this.focus.focusView||this.views.views[0]).content.decorateEvent(m),this.onRowClick(m),D.stop(m));break;case M.SPACE:this.edit.isEditing()||(u=this.focus.getHeaderIndex(),0<=u?this.setSortIndex(u):(this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(m),m.shiftKey),this.focus._focusifyCellNode(!0),this.focus.setFocusCell(this.focus.cell,this.focus.rowIndex),D.stop(m)));
break;case M.TAB:this.focus[m.shiftKey?"previousKey":"nextKey"](m);break;case M.LEFT_ARROW:case M.RIGHT_ARROW:if(!this.edit.isEditing()){var r=m.keyCode;D.stop(m);u=this.focus.getHeaderIndex();0<=u&&m.shiftKey&&m.ctrlKey?this.focus.colSizeAdjust(m,u,5*(r==M.LEFT_ARROW?-1:1)):(m=r==M.LEFT_ARROW?1:-1,this.isLeftToRight()&&(m*=-1),this.focus.move(0,m))}break;case M.UP_ARROW:this.edit.isEditing()||0===this.focus.rowIndex||(D.stop(m),this.focus.move(-1,0));break;case M.DOWN_ARROW:this.edit.isEditing()||
this.focus.rowIndex+1==this.rowCount||(D.stop(m),this.focus.move(1,0));break;case M.PAGE_UP:this.edit.isEditing()||0===this.focus.rowIndex||(D.stop(m),this.focus.rowIndex!=this.scroller.firstVisibleRow+1?this.focus.move(this.scroller.firstVisibleRow-this.focus.rowIndex,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex-1)),this.focus.move(this.scroller.firstVisibleRow-this.scroller.lastVisibleRow+1,0)));break;case M.PAGE_DOWN:this.edit.isEditing()||this.focus.rowIndex+1==this.rowCount||
(D.stop(m),this.focus.rowIndex!=this.scroller.lastVisibleRow-1?this.focus.move(this.scroller.lastVisibleRow-this.focus.rowIndex-1,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex+1)),this.focus.move(this.scroller.lastVisibleRow-this.scroller.firstVisibleRow-1,0)))}},onMouseOver:function(m){-1==m.rowIndex?this.onHeaderCellMouseOver(m):this.onCellMouseOver(m)},onMouseOut:function(m){-1==m.rowIndex?this.onHeaderCellMouseOut(m):this.onCellMouseOut(m)},onMouseDown:function(m){-1==
m.rowIndex?this.onHeaderCellMouseDown(m):this.onCellMouseDown(m)},onMouseOverRow:function(m){this.rows.isOver(m.rowIndex)||(this.rows.setOverRow(m.rowIndex),-1==m.rowIndex?this.onHeaderMouseOver(m):this.onRowMouseOver(m))},onMouseOutRow:function(m){if(this.rows.isOver(-1))this.onHeaderMouseOut(m);else this.rows.isOver(-2)||(this.rows.setOverRow(-2),this.onRowMouseOut(m))},onMouseDownRow:function(m){if(-1!=m.rowIndex)this.onRowMouseDown(m)},onCellMouseOver:function(m){m.cellNode&&I.add(m.cellNode,
this.cellOverClass)},onCellMouseOut:function(m){m.cellNode&&I.remove(m.cellNode,this.cellOverClass)},onCellMouseDown:function(m){},onCellClick:function(m){this._click[0]=this._click[1];this._click[1]=m;this.edit.isEditCell(m.rowIndex,m.cellIndex)||this.focus.setFocusCell(m.cell,m.rowIndex);1<this._click.length&&null==this._click[0]&&this._click.shift();this.onRowClick(m)},onCellDblClick:function(m){var u=1<this._click.length&&v("ie")?this._click[1]:1<this._click.length&&this._click[0].rowIndex!=this._click[1].rowIndex?
this._click[0]:m;this.focus.setFocusCell(u.cell,u.rowIndex);this.edit.setEditCell(u.cell,u.rowIndex);this.onRowDblClick(m)},onCellContextMenu:function(m){this.onRowContextMenu(m)},onCellFocus:function(m,u){this.edit.cellFocus(m,u)},onRowClick:function(m){this.edit.rowClick(m);this.selection.clickSelectEvent(m)},onRowDblClick:function(m){},onRowMouseOver:function(m){},onRowMouseOut:function(m){},onRowMouseDown:function(m){},onRowContextMenu:function(m){D.stop(m)},onHeaderMouseOver:function(m){},onHeaderMouseOut:function(m){},
onHeaderCellMouseOver:function(m){m.cellNode&&I.add(m.cellNode,this.cellOverClass)},onHeaderCellMouseOut:function(m){m.cellNode&&I.remove(m.cellNode,this.cellOverClass)},onHeaderCellMouseDown:function(m){},onHeaderClick:function(m){},onHeaderCellClick:function(m){this.setSortIndex(m.cell.index);this.onHeaderClick(m)},onHeaderDblClick:function(m){},onHeaderCellDblClick:function(m){this.onHeaderDblClick(m)},onHeaderCellContextMenu:function(m){this.onHeaderContextMenu(m)},onHeaderContextMenu:function(m){this.headerMenu||
D.stop(m)},onStartEdit:function(m,u){},onApplyCellEdit:function(m,u,r){},onCancelEdit:function(m){},onApplyEdit:function(m){},onCanSelect:function(m){return!0},onCanDeselect:function(m){return!0},onSelected:function(m){this.updateRowStyles(m)},onDeselected:function(m){this.updateRowStyles(m)},onSelectionChanged:function(){}})})},"dojox/grid/_Scroller":function(){define(["dijit/registry","dojo/_base/declare","dojo/_base/lang","./util","dojo/_base/html"],function(M,I,F,D,v){var m=function(r){r&&dojo.forEach(M.toArray(),
function(w){w.domNode&&v.isDescendant(w.domNode,r,!0)&&w.destroy()})},u=function(r,w){for(var f=[],c=0,n;n=r.childNodes[c];){c++;var q=v.byId(n);(q&&q.tagName?q.tagName.toLowerCase():"")==w&&f.push(n)}return f};return I("dojox.grid._Scroller",null,{constructor:function(r){this.setContentNodes(r);this.pageHeights=[];this.pageNodes=[];this.stack=[]},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,
lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(r,w,f){switch(arguments.length){case 3:this.rowsPerPage=f;case 2:this.keepRows=w;case 1:this.rowCount=r}this.defaultPageHeight=(0<this.grid.rowHeight?this.grid.rowHeight:this.defaultRowHeight)*this.rowsPerPage;this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);this.setKeepInfo(this.keepRows);this.invalidate();this.scrollboxNode&&(this.scrollboxNode.scrollTop=0,this.scroll(0),this.scrollboxNode.onscroll=F.hitch(this,
"onscroll"))},_getPageCount:function(r,w){return r?Math.ceil(r/w)||1:0},destroy:function(){this.invalidateNodes();delete this.contentNodes;delete this.contentNode;delete this.scrollboxNode},setKeepInfo:function(r){this.keepPages=(this.keepRows=r)?Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2):this.keepPages},setContentNodes:function(r){this.colCount=(this.contentNodes=r)?this.contentNodes.length:0;this.pageNodes=[];for(r=0;r<this.colCount;r++)this.pageNodes[r]=[]},getDefaultNodes:function(){return this.pageNodes[0]||
[]},invalidate:function(){this._invalidating=!0;this.invalidateNodes();this.pageHeights=[];this.height=this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0;this.resize();this._invalidating=!1},updateRowCount:function(r){this.invalidateNodes();this.rowCount=r;r=this.pageCount;0===r&&(this.height=1);this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);if(this.pageCount<r)for(--r;r>=this.pageCount;r--)this.height-=this.getPageHeight(r),delete this.pageHeights[r];
else this.pageCount>r&&(this.height+=this.defaultPageHeight*(this.pageCount-r-1)+this.calcLastPageHeight());this.resize()},pageExists:function(r){return!!this.getDefaultPageNode(r)},measurePage:function(r){return this.grid.rowHeight?((r+1)*this.rowsPerPage>this.rowCount?this.rowCount-r*this.rowsPerPage:this.rowsPerPage)*this.grid.rowHeight:(r=this.getDefaultPageNode(r))&&r.innerHTML?r.offsetHeight:void 0},positionPage:function(r,w){for(var f=0;f<this.colCount;f++)this.pageNodes[f][r].style.top=w+
"px"},repositionPages:function(r){for(var w=this.getDefaultNodes(),f=0,c=0;c<this.stack.length;c++)f=Math.max(this.stack[c],f);var n=(c=w[r])?this.getPageNodePosition(c)+this.getPageHeight(r):0;for(r+=1;r<=f;r++){if(c=w[r]){if(this.getPageNodePosition(c)==n)break;this.positionPage(r,n)}n+=this.getPageHeight(r)}},installPage:function(r){for(var w=0;w<this.colCount;w++)this.contentNodes[w].appendChild(this.pageNodes[w][r])},preparePage:function(r,w){w=w?this.popPage():null;for(var f=0;f<this.colCount;f++){var c=
this.pageNodes[f],n=null===w?this.createPageNode():this.invalidatePageNode(w,c);n.pageIndex=r;c[r]=n}},renderPage:function(r){var w=[],f;for(f=0;f<this.colCount;f++)w[f]=this.pageNodes[f][r];f=0;for(r*=this.rowsPerPage;f<this.rowsPerPage&&r<this.rowCount;f++,r++)this.renderRow(r,w)},removePage:function(r){var w=0;for(r*=this.rowsPerPage;w<this.rowsPerPage;w++,r++)this.removeRow(r)},destroyPage:function(r){for(var w=0;w<this.colCount;w++){var f=this.invalidatePageNode(r,this.pageNodes[w]);f&&v.destroy(f)}},
pacify:function(r){},pacifying:!1,pacifyTicks:200,setPacifying:function(r){this.pacifying!=r&&(this.pacifying=r,this.pacify(this.pacifying))},startPacify:function(){this.startPacifyTicks=(new Date).getTime()},doPacify:function(){var r=(new Date).getTime()-this.startPacifyTicks>this.pacifyTicks;this.setPacifying(!0);this.startPacify();return r},endPacify:function(){this.setPacifying(!1)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight);for(var r=0;r<this.colCount;r++)D.setStyleHeightPx(this.contentNodes[r],
Math.max(1,this.height));r=!this._invalidating;if(!r){var w=this.grid.get("autoHeight");"number"==typeof w&&w<=Math.min(this.rowsPerPage,this.rowCount)&&(r=!0)}r&&this.needPage(this.page,this.pageTop);r=this.page<this.pageCount-1?this.rowsPerPage:this.rowCount%this.rowsPerPage||this.rowsPerPage;w=this.getPageHeight(this.page);this.averageRowHeight=0<w&&0<r?w/r:0},calcLastPageHeight:function(){if(!this.pageCount)return 0;var r=(this.rowCount%this.rowsPerPage||this.rowsPerPage)*this.defaultRowHeight;
return this.pageHeights[this.pageCount-1]=r},updateContentHeight:function(r){this.height+=r;this.resize()},updatePageHeight:function(r,w,f){if(this.pageExists(r)){var c=this.getPageHeight(r),n=this.measurePage(r);void 0===n&&(n=c);this.pageHeights[r]=n;if(c!=n){this.updateContentHeight(n-c);var q=this.grid.get("autoHeight");"number"==typeof q&&q>this.rowCount||!0===q&&!w?f?(w=this.grid.viewsNode.style,w.height=parseInt(w.height)+n-c+"px",this.repositionPages(r)):this.grid.sizeChange():this.repositionPages(r)}return n}return 0},
rowHeightChanged:function(r,w){this.updatePageHeight(Math.floor(r/this.rowsPerPage),!1,w)},invalidateNodes:function(){for(;this.stack.length;)this.destroyPage(this.popPage())},createPageNode:function(){var r=document.createElement("div");v.attr(r,"role","presentation");r.style.position="absolute";r.style[this.grid.isLeftToRight()?"left":"right"]="0";return r},getPageHeight:function(r){r=this.pageHeights[r];return void 0!==r?r:this.defaultPageHeight},pushPage:function(r){return this.stack.push(r)},
popPage:function(){return this.stack.shift()},findPage:function(r){for(var w=0,f=0,c=0;w<this.pageCount&&!(c=this.getPageHeight(w),f+c>=r);w++,f+=c);this.page=w;this.pageTop=f},buildPage:function(r,w,f){this.preparePage(r,w);this.positionPage(r,f);this.installPage(r);this.renderPage(r);this.pushPage(r)},needPage:function(r,w){var f=this.getPageHeight(r);this.pageExists(r)?this.positionPage(r,w):(this.buildPage(r,!this.grid._autoHeight&&this.keepPages&&this.stack.length>=this.keepPages,w),f=this.updatePageHeight(r,
!0));return f},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop)},scroll:function(r){this.grid.scrollTop=r;if(this.colCount){this.startPacify();this.findPage(r);for(var w=this.height,f=this.getScrollBottom(r),c=this.page,n=this.pageTop;c<this.pageCount&&(0>f||n<f);c++)n+=this.needPage(c,n);this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,r);this.lastVisibleRow=this.getLastVisibleRow(c-1,n,f);w!=this.height&&this.repositionPages(c-1);this.endPacify()}},getScrollBottom:function(r){return 0<=
this.windowHeight?r+this.windowHeight:-1},processNodeEvent:function(r,w){for(var f=r.target;f&&f!=w&&f.parentNode&&f.parentNode.parentNode!=w;)f=f.parentNode;if(!f||!f.parentNode||f.parentNode.parentNode!=w)return!1;r.topRowIndex=f.parentNode.pageIndex*this.rowsPerPage;w=r.topRowIndex;a:{var c=0;for(var n,q=f.parentNode;n=q.childNodes[c++];)if(n==f){--c;break a}c=-1}r.rowIndex=w+c;r.rowTarget=f;return!0},processEvent:function(r){return this.processNodeEvent(r,this.contentNode)},renderRow:function(r,
w){},removeRow:function(r){},getDefaultPageNode:function(r){return this.getDefaultNodes()[r]},positionPageNode:function(r,w){},getPageNodePosition:function(r){return r.offsetTop},invalidatePageNode:function(r,w){var f=w[r];f&&(delete w[r],this.removePage(r,f),m(f),f.innerHTML="");return f},getPageRow:function(r){return r*this.rowsPerPage},getLastPageRow:function(r){return Math.min(this.rowCount,this.getPageRow(r+1))-1},getFirstVisibleRow:function(r,w,f){if(!this.pageExists(r))return 0;var c=this.getPageRow(r),
n=this.getDefaultNodes();r=u(n[r],"div");n=0;for(var q=r.length;n<q&&w<f;n++,c++)w+=r[n].offsetHeight;return c?c-1:c},getLastVisibleRow:function(r,w,f){if(!this.pageExists(r))return 0;var c=this.getDefaultNodes(),n=this.getLastPageRow(r);r=u(c[r],"div");for(c=r.length-1;0<=c&&w>f;c--,n--)w-=r[c].offsetHeight;return n+1},findTopRow:function(r){var w=this.getDefaultNodes();w=u(w[this.page],"div");for(var f=0,c=w.length,n=this.pageTop,q;f<c;f++)if(q=w[f].offsetHeight,n+=q,n>=r)return this.offset=q-(n-
r),f+this.page*this.rowsPerPage;return-1},findScrollTop:function(r){var w=Math.floor(r/this.rowsPerPage),f=0,c;for(c=0;c<w;c++)f+=this.getPageHeight(c);this.pageTop=f;this.page=w;this.needPage(w,this.pageTop);c=this.getDefaultNodes();var n=u(c[w],"div");w=r-this.rowsPerPage*w;c=0;for(r=n.length;c<r&&c<w;c++)f+=n[c].offsetHeight;return f},dummy:0})})},"dojox/grid/util":function(){define(["../main","dojo/_base/lang","dojo/dom","dojo/_base/sniff"],function(M,I,F,D){var v=I.getObject("grid.util",!0,M);
v.na="...";v.rowIndexTag="gridRowIndex";v.gridViewTag="gridView";v.fire=function(m,u,r){function w(a,b){if(null==a)return null;var k=b?"Width":"Height";return a["scroll"+k]>a["client"+k]?a:w(a.parentNode,b)}var f;if(D("webkit")&&"focus"==u){var c=m.domNode?m.domNode:m;if(f=w(c,!1))var n=f.scrollTop;if(c=w(c,!0))var q=c.scrollLeft}var d=m&&u&&m[u];m=d&&(r?d.apply(m,r):m[u]());D("webkit")&&"focus"==u&&(f&&(f.scrollTop=n),c&&(c.scrollLeft=q));return m};v.setStyleHeightPx=function(m,u){if(0<=u){var r=
m.style;u+="px";m&&r.height!=u&&(r.height=u)}};v.mouseEvents="mouseover mouseout mousedown mouseup click dblclick contextmenu".split(" ");v.keyEvents=["keyup","keydown","keypress"];v.funnelEvents=function(m,u,r,w){w=w?w:v.mouseEvents.concat(v.keyEvents);for(var f=0,c=w.length;f<c;f++)u.connect(m,"on"+w[f],r)};v.removeNode=function(m){(m=F.byId(m))&&m.parentNode&&m.parentNode.removeChild(m);return m};v.arrayCompare=function(m,u){for(var r=0,w=m.length;r<w;r++)if(m[r]!=u[r])return!1;return m.length==
u.length};v.arrayInsert=function(m,u,r){m.length<=u?m[u]=r:m.splice(u,0,r)};v.arrayRemove=function(m,u){m.splice(u,1)};v.arraySwap=function(m,u,r){var w=m[u];m[u]=m[r];m[r]=w};return v})},"dojox/grid/_Layout":function(){define("dojo/_base/kernel ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/dom-geometry ./cells ./_RowSelector".split(" "),function(M,I,F,D,v,m){return F("dojox.grid._Layout",null,{constructor:function(u){this.grid=u},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(u,
r,w,f,c){var n=this.structure[u].cells[0],q=this.structure[r].cells[0],d=null,a=d=0;u=0;for(var b;b=n[u];u++)if(b.index==w){d=u;break}d=n.splice(d,1)[0];d.view=this.grid.views.views[r];u=0;for(b=null;b=q[u];u++)if(b.index==f){a=u;break}c||(a+=1);q.splice(a,0,d);if(w=this.grid.getCell(this.grid.getSortIndex()))w._currentlySorted=this.grid.getSortAsc();this.cells=[];for(u=w=0;r=this.structure[u];u++)for(f=0;c=r.cells[f];f++)for(n=0;b=c[n];n++)b.index=w,this.cells.push(b),"_currentlySorted"in b&&(q=
w+1,q*=b._currentlySorted?1:-1,this.grid.sortInfo=q,delete b._currentlySorted),w++;D.forEach(this.cells,function(k){var g=k.markup[2].split(" ");parseInt(g[1].substring(5))!=k.index&&(g[1]='idx\x3d"'+k.index+'"',k.markup[2]=g.join(" "))});this.grid.setupHeaderMenu()},setColumnVisibility:function(u,r){u=this.cells[u];if(u.hidden==r){u.hidden=!r;r=u.view;var w=r.viewWidth;w&&"auto"!=w&&(r._togglingColumn=m.getMarginBox(u.getHeaderNode()).w||0);r.update();return!0}return!1},addCellDef:function(u,r,w){var f=
this,c=function(n){var q=0;1<n.colSpan?q=0:(q=n.width||f._defaultCellProps.width||f.defaultWidth,isNaN(q)||(q+="em"));return q};u={grid:this.grid,subrow:u,layoutIndex:r,index:this.cells.length};if(w&&w instanceof I.grid.cells._Base)return r=v.clone(w),u.unitWidth=c(r._props),r=v.mixin(r,this._defaultCellProps,w._props,u);r=w.type||w.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||I.grid.cells.Cell;v.isString(r)&&(r=v.getObject(r));u.unitWidth=c(w);return new r(v.mixin({},this._defaultCellProps,
w,u))},addRowDef:function(u,r){for(var w=[],f=0,c=0,n=!0,q=0,d;d=r[q];q++)d=this.addCellDef(u,q,d),w.push(d),this.cells.push(d),n&&d.relWidth?f+=d.relWidth:d.width&&(d=d.width,"string"==typeof d&&"%"==d.slice(-1)?c+=window.parseInt(d,10):"auto"==d&&(n=!1));f&&n&&D.forEach(w,function(a){a.relWidth&&(a.width=a.unitWidth=a.relWidth/f*(100-c)+"%")});return w},addRowsDef:function(u){var r=[];if(v.isArray(u))if(v.isArrayLike(u[0]))for(var w=0,f;u&&(f=u[w]);w++)r.push(this.addRowDef(w,f));else r.push(this.addRowDef(0,
u));return r},addViewDef:function(u){this._defaultCellProps=u.defaultCell||{};u.width&&"auto"==u.width&&delete u.width;return v.mixin({},u,{cells:this.addRowsDef(u.rows||u.cells)})},setStructure:function(u){this.fieldIndex=0;this.cells=[];var r=this.structure=[];if(this.grid.rowSelector){var w={type:I._scopeName+".grid._RowSelector"};if(v.isString(this.grid.rowSelector)){var f=this.grid.rowSelector;"false"==f?w=null:"true"!=f&&(w.width=f)}else this.grid.rowSelector||(w=null);w&&r.push(this.addViewDef(w))}var c=
function(a){return"name"in a||"field"in a||"get"in a};w=function(a){return v.isArray(a)&&(v.isArray(a[0])||c(a[0]))?!0:!1};f=function(a){return null!==a&&v.isObject(a)&&("cells"in a||"rows"in a||"type"in a&&!c(a))};if(v.isArrayLike(u)){for(var n=!1,q=0,d;d=u[q];q++)if(f(d)){n=!0;break}if(n)for(q=0;d=u[q];q++)w(d)?r.push(this.addViewDef({cells:d})):f(d)&&r.push(this.addViewDef(d));else r.push(this.addViewDef({cells:u}))}else f(u)&&r.push(this.addViewDef(u));this.cellCount=this.cells.length;this.grid.setupHeaderMenu()}})})},
"dojox/grid/cells":function(){define(["../main","./cells/_base"],function(M){return M.grid.cells})},"dojox/grid/cells/_base":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/event dojo/_base/connect dojo/_base/array dojo/_base/sniff dojo/dom dojo/dom-attr dojo/dom-construct dijit/_Widget ../util".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n){var q=I("dojox.grid._DeferredTextWidget",c,{deferred:null,_destroyOnRemove:!0,postCreate:function(){this.deferred&&this.deferred.addBoth(F.hitch(this,
function(g){this.domNode&&(this.domNode.innerHTML=g)}))}}),d=function(){setTimeout(F.hitch.apply(M,arguments),0)},a=I("dojox.grid.cells._Base",null,{styles:"",classes:"",editable:!1,alwaysEditing:!1,formatter:null,defaultValue:"...",value:null,hidden:!1,noresize:!1,draggable:!0,_valueProp:"value",_formatPending:!1,constructor:function(g){this._props=g||{};F.mixin(this,g);void 0===this.draggable&&(this.draggable=!0)},_defaultFormat:function(g,p){var B=this.grid.formatterScope||this,J=this.formatter;
J&&B&&"string"==typeof J&&(J=this.formatter=B[J]);g=g!=this.defaultValue&&J?J.apply(B,p):g;if("undefined"==typeof g)return this.defaultValue;g&&g.addBoth&&(g=new q({deferred:g},f.create("span",{innerHTML:this.defaultValue})));return g&&g.declaredClass&&g.startup?"\x3cdiv class\x3d'dojoxGridStubNode' linkWidget\x3d'"+g.id+"' cellIdx\x3d'"+this.index+"'\x3e"+this.defaultValue+"\x3c/div\x3e":g},format:function(g,p){var B=this.grid.edit.info;(p=this.get?this.get(g,p):this.value||this.defaultValue)&&p.replace&&
this.grid.escapeHTMLInData&&(p=p.replace(/&(?![a-z0-9]{1,8};)/ig,"\x26amp;").replace(/</g,"\x26lt;"));return this.editable&&(this.alwaysEditing||B.rowIndex==g&&B.cell==this)?this.formatEditing(B.value?B.value:p,g):this._defaultFormat(p,[p,g,this])},formatEditing:function(g,p){},getNode:function(g){return this.view.getCellNode(g,this.index)},getHeaderNode:function(){return this.view.getHeaderCellNode(this.index)},getEditNode:function(g){return(this.getNode(g)||0).firstChild||0},canResize:function(){var g=
this.unitWidth;return g&&"auto"!==g},isFlex:function(){var g=this.unitWidth;return g&&F.isString(g)&&("auto"==g||"%"==g.slice(-1))},applyEdit:function(g,p){this.getNode(p)&&this.grid.edit.applyCellEdit(g,this,p)},cancelEdit:function(g){this.grid.doCancelEdit(g)},_onEditBlur:function(g){this.grid.edit.isEditCell(g,this.index)&&this.grid.edit.apply()},registerOnBlur:function(g,p){this.commitOnBlur&&v.connect(g,"onblur",function(B){setTimeout(F.hitch(this,"_onEditBlur",p),250)})},needFormatNode:function(g,
p){this._formatPending=!0;d(this,"_formatNode",g,p)},cancelFormatNode:function(){this._formatPending=!1},_formatNode:function(g,p){this._formatPending&&(this._formatPending=!1,u("ie")||r.setSelectable(this.grid.domNode,!0),this.formatNode(this.getEditNode(p),g,p))},formatNode:function(g,p,B){u("ie")?d(this,"focus",B,g):this.focus(B,g)},dispatchEvent:function(g,p){if(g in this)return this[g](p)},getValue:function(g){return this.getEditNode(g)[this._valueProp]},setValue:function(g,p){(g=this.getEditNode(g))&&
(g[this._valueProp]=p)},focus:function(g,p){g=p||this.getEditNode(g);try{n.fire(g,"focus"),n.fire(g,"select")}catch(B){}},save:function(g){this.value=this.value||this.getValue(g)},restore:function(g){this.setValue(g,this.value)},_finish:function(g){r.setSelectable(this.grid.domNode,!1);this.cancelFormatNode()},apply:function(g){this.applyEdit(this.getValue(g),g);this._finish(g)},cancel:function(g){this.cancelEdit(g);this._finish(g)}});a.markupFactory=function(g,p){var B=F.trim(w.get(g,"formatter")||
"");B&&(p.formatter=F.getObject(B)||B);if(B=F.trim(w.get(g,"get")||""))p.get=F.getObject(B);B=function(J,A,h){var x=F.trim(w.get(g,J)||"");x&&(A[h||J]="false"!=x.toLowerCase())};B("sortDesc",p);B("editable",p);B("alwaysEditing",p);B("noresize",p);B("draggable",p);if(B=F.trim(w.get(g,"loadingText")||w.get(g,"defaultValue")||""))p.defaultValue=B;B=function(J,A,h){var x=F.trim(w.get(g,J)||"")||void 0;x&&(A[h||J]=x)};B("styles",p);B("headerStyles",p);B("cellStyles",p);B("classes",p);B("headerClasses",
p);B("cellClasses",p)};var b=a.Cell=I("dojox.grid.cells.Cell",a,{constructor:function(){this.keyFilter=this.keyFilter},keyFilter:null,formatEditing:function(g,p){this.needFormatNode(g,p);g&&g.replace&&(g=g.replace(/"/g,"\x26quot;"));return'\x3cinput class\x3d"dojoxGridInput" type\x3d"text" value\x3d"'+g+'"\x3e'},formatNode:function(g,p,B){this.inherited(arguments);this.registerOnBlur(g,B)},doKey:function(g){this.keyFilter&&-1==String.fromCharCode(g.charCode).search(this.keyFilter)&&D.stop(g)},_finish:function(g){this.inherited(arguments);
var p=this.getEditNode(g);try{n.fire(p,"blur")}catch(B){}}});b.markupFactory=function(g,p){a.markupFactory(g,p);if(g=F.trim(w.get(g,"keyFilter")||""))p.keyFilter=new RegExp(g)};(a.RowIndex=I("dojox.grid.cells.RowIndex",b,{name:"Row",postscript:function(){this.editable=!1},get:function(g){return g+1}})).markupFactory=function(g,p){b.markupFactory(g,p)};(a.Select=I("dojox.grid.cells.Select",b,{options:null,values:null,returnIndex:-1,constructor:function(g){this.values=this.values||this.options},formatEditing:function(g,
p){this.needFormatNode(g,p);p=['\x3cselect class\x3d"dojoxGridSelect"\x3e'];for(var B=0,J,A;void 0!==(J=this.options[B])&&void 0!==(A=this.values[B]);B++)A=A.replace?A.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):A,J=J.replace?J.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):J,p.push("\x3coption",g==A?" selected":"",' value\x3d"'+A+'"',"\x3e",J,"\x3c/option\x3e");p.push("\x3c/select\x3e");return p.join("")},_defaultFormat:function(g,p){var B=this.inherited(arguments);if(!this.formatter&&this.values&&
this.options){var J=m.indexOf(this.values,B);0<=J&&(B=this.options[J])}return B},getValue:function(g){var p=this.getEditNode(g);if(p)return g=p.selectedIndex,p=p.options[g],-1<this.returnIndex?g:p.value||p.innerHTML}})).markupFactory=function(g,p){b.markupFactory(g,p);var B=F.trim(w.get(g,"options")||"");if(B){var J=B.split(",");J[0]!=B&&(p.options=J)}if(g=F.trim(w.get(g,"values")||""))B=g.split(","),B[0]!=g&&(p.values=B)};var k=a.AlwaysEdit=I("dojox.grid.cells.AlwaysEdit",b,{alwaysEditing:!0,_formatNode:function(g,
p){this.formatNode(this.getEditNode(p),g,p)},applyStaticValue:function(g){var p=this.grid.edit;p.applyCellEdit(this.getValue(g),this,g);p.start(this,g,!0)}});k.markupFactory=function(g,p){b.markupFactory(g,p)};(a.Bool=I("dojox.grid.cells.Bool",k,{_valueProp:"checked",formatEditing:function(g,p){return'\x3cinput class\x3d"dojoxGridInput" type\x3d"checkbox"'+(g?' checked\x3d"checked"':"")+' style\x3d"width: auto" /\x3e'},doclick:function(g){"INPUT"==g.target.tagName&&this.applyStaticValue(g.rowIndex)}})).markupFactory=
function(g,p){k.markupFactory(g,p)};return a})},"dojox/grid/_RowSelector":function(){define(["dojo/_base/declare","./_View"],function(M,I){return M("dojox.grid._RowSelector",I,{defaultWidth:"2em",noscroll:!0,padBorderWidth:2,buildRendering:function(){this.inherited("buildRendering",arguments);this.scrollboxNode.style.overflow="hidden";this.headerNode.style.visibility="hidden"},getWidth:function(){return this.viewWidth||this.defaultWidth},buildRowContent:function(F,D){D.innerHTML='\x3ctable class\x3d"dojoxGridRowbarTable" style\x3d"width:'+
(this.contentWidth||0)+'px;height:1px;" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctr\x3e\x3ctd class\x3d"dojoxGridRowbarInner"\x3e\x26nbsp;\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e'},renderHeader:function(){},updateRow:function(){},resize:function(){this.adaptHeight()},adaptWidth:function(){!("contentWidth"in this)&&this.contentNode&&0<this.contentNode.offsetWidth&&(this.contentWidth=this.contentNode.offsetWidth-this.padBorderWidth)},doStyleRowNode:function(F,D){var v=
["dojoxGridRowbar dojoxGridNonNormalizedCell"];this.grid.rows.isOver(F)&&v.push("dojoxGridRowbarOver");this.grid.selection.isSelected(F)&&v.push("dojoxGridRowbarSelected");D.className=v.join(" ")},domouseover:function(F){this.grid.onMouseOverRow(F)},domouseout:function(F){if(!this.isIntraRowEvent(F))this.grid.onMouseOutRow(F)}})})},"dojox/grid/_View":function(){define("dojo dijit/registry ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/connect dojo/_base/sniff dojo/query dojo/_base/window dojo/text!./resources/View.html dojo/dnd/Source dijit/_Widget dijit/_TemplatedMixin dojox/html/metrics ./util dojo/_base/html ./_Builder dojo/dnd/Avatar dojo/dnd/Manager".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q,d,a,b,k,g,p,B){c=D("dojox.grid._View",[q,d],{defaultWidth:"18em",viewWidth:"",templateString:c,classTag:"dojoxGrid",marginBottom:0,rowPad:2,_togglingColumn:-1,_headerBuilderClass:g._HeaderBuilder,_contentBuilderClass:g._ContentBuilder,postMixInProperties:function(){this.rowNodes={}},postCreate:function(){this.connect(this.scrollboxNode,"onscroll","doscroll");b.funnelEvents(this.contentNode,this,"doContentEvent","mouseover mouseout click dblclick contextmenu mousedown".split(" "));
b.funnelEvents(this.headerNode,this,"doHeaderEvent","dblclick mouseover mouseout mousemove mousedown click contextmenu".split(" "));this.content=new this._contentBuilderClass(this);this.header=new this._headerBuilderClass(this);this.grid.isLeftToRight()||(this.headerNodeContainer.style.width="")},destroy:function(){k.destroy(this.headerNode);delete this.headerNode;for(var h in this.rowNodes)this._cleanupRowWidgets(this.rowNodes[h]),k.destroy(this.rowNodes[h]);this.rowNodes={};this.source&&this.source.destroy();
this.inherited(arguments)},focus:function(){r("ie")||r("webkit")||r("opera")?this.hiddenFocusNode.focus():this.scrollboxNode.focus()},setStructure:function(h){h=this.structure=h;h.width&&!isNaN(h.width)?this.viewWidth=h.width+"em":this.viewWidth=h.width||(h.noscroll?"auto":this.viewWidth);this._onBeforeRow=h.onBeforeRow||function(){};this._onAfterRow=h.onAfterRow||function(){};if(this.noscroll=h.noscroll)this.scrollboxNode.style.overflow="hidden";this.simpleStructure=1==h.cells.length;this.testFlexCells();
this.updateStructure()},_cleanupRowWidgets:function(h){h&&v.forEach(w("[widgetId]",h).map(I.byNode),function(x){x._destroyOnRemove?(x.destroy(),delete x):x.domNode&&x.domNode.parentNode&&x.domNode.parentNode.removeChild(x.domNode)})},onBeforeRow:function(h,x){this._onBeforeRow(h,x);0<=h&&this._cleanupRowWidgets(this.getRowNode(h))},onAfterRow:function(h,x,z){this._onAfterRow(h,x,z);var e=this.grid;v.forEach(w(".dojoxGridStubNode",z),function(t){if(t&&t.parentNode){var y=t.getAttribute("linkWidget"),
H=window.parseInt(k.attr(t,"cellIdx"),10);e.getCell(H);(y=I.byId(y))?(t.parentNode.replaceChild(y.domNode,t),y._started||y.startup(),M.destroy(t)):t.innerHTML=""}},this)},testFlexCells:function(){this.flexCells=!1;for(var h=0,x;x=this.structure.cells[h];h++)for(var z=0,e;e=x[z];z++)e.view=this,this.flexCells=this.flexCells||e.isFlex();return this.flexCells},updateStructure:function(){this.header.update();this.content.update()},getScrollbarWidth:function(){var h=this.hasVScrollbar(),x=k.style(this.scrollboxNode,
"overflow");this.noscroll||!x||"hidden"==x?h=!1:"scroll"==x&&(h=!0);return h?a.getScrollbar().w:0},getColumnsWidth:function(){var h=this.headerContentNode;return h&&h.firstChild?h.firstChild.offsetWidth||k.style(h.firstChild,"width"):0},setColumnsWidth:function(h){this.headerContentNode.firstChild.style.width=h+"px";this.viewWidth&&(this.viewWidth=h+"px")},getWidth:function(){return this.viewWidth||this.getColumnsWidth()+this.getScrollbarWidth()+"px"},getContentWidth:function(){return Math.max(0,
k._getContentBox(this.domNode).w-this.getScrollbarWidth())+"px"},render:function(){this.scrollboxNode.style.height="";this.renderHeader();0<=this._togglingColumn&&(this.setColumnsWidth(this.getColumnsWidth()-this._togglingColumn),this._togglingColumn=-1);var h=this.grid.layout.cells,x=m.hitch(this,function(e,t){!this.grid.isLeftToRight()&&(t=!t);t=t?-1:1;e=this.header.getCellNodeIndex(e)+t;for(var y=h[e];y&&y.getHeaderNode()&&"none"==y.getHeaderNode().style.display;)e+=t,y=h[e];return y?y.getHeaderNode():
null});if(this.grid.columnReordering&&this.simpleStructure){this.source&&this.source.destroy();this.bottomMarker&&k.destroy(this.bottomMarker);this.bottomMarker=k.byId("dojoxGrid_bottomMarker");this.topMarker&&k.destroy(this.topMarker);this.topMarker=k.byId("dojoxGrid_topMarker");this.bottomMarker||(this.bottomMarker=k.create("div",{id:"dojoxGrid_bottomMarker","class":"dojoxGridColPlaceBottom"},f.body()),this._hide(this.bottomMarker),this.topMarker=k.create("div",{id:"dojoxGrid_topMarker","class":"dojoxGridColPlaceTop"},
f.body()),this._hide(this.topMarker));this.arrowDim=k.contentBox(this.bottomMarker);var z=k.contentBox(this.headerContentNode.firstChild.rows[0]).h;this.source=new n(this.headerContentNode.firstChild.rows[0],{horizontal:!0,accept:["gridColumn_"+this.grid.id],viewIndex:this.index,generateText:!1,onMouseDown:m.hitch(this,function(e){this.header.decorateEvent(e);if((this.header.overRightResizeArea(e)||this.header.overLeftResizeArea(e))&&this.header.canResize(e)&&!this.header.moveable)this.header.beginColumnResize(e);
else{if(this.grid.headerMenu)this.grid.headerMenu.onCancel(!0);e.button===(9>r("ie")?1:0)&&n.prototype.onMouseDown.call(this.source,e)}}),onMouseOver:m.hitch(this,function(e){var t=this.source;t._getChildByEvent(e)&&n.prototype.onMouseOver.apply(t,arguments)}),_markTargetAnchor:m.hitch(this,function(e){var t=this.source;if(t.current!=t.targetAnchor||t.before!=e){t.targetAnchor&&x(t.targetAnchor,t.before)&&t._removeItemClass(x(t.targetAnchor,t.before),t.before?"After":"Before");n.prototype._markTargetAnchor.call(t,
e);var y=e?t.targetAnchor:x(t.targetAnchor,t.before);e=0;y||(y=t.targetAnchor,e=k.contentBox(y).w+this.arrowDim.w/2+2);y=k.position(y,!0);e=Math.floor(y.x-this.arrowDim.w/2+e);k.style(this.bottomMarker,"visibility","visible");k.style(this.topMarker,"visibility","visible");k.style(this.bottomMarker,{left:e+"px",top:z+y.y+"px"});k.style(this.topMarker,{left:e+"px",top:y.y-this.arrowDim.h+"px"});t.targetAnchor&&x(t.targetAnchor,t.before)&&t._addItemClass(x(t.targetAnchor,t.before),t.before?"After":"Before")}}),
_unmarkTargetAnchor:m.hitch(this,function(){var e=this.source;e.targetAnchor&&(e.targetAnchor&&x(e.targetAnchor,e.before)&&e._removeItemClass(x(e.targetAnchor,e.before),e.before?"After":"Before"),this._hide(this.bottomMarker),this._hide(this.topMarker),n.prototype._unmarkTargetAnchor.call(e))}),destroy:m.hitch(this,function(){u.disconnect(this._source_conn);u.unsubscribe(this._source_sub);n.prototype.destroy.call(this.source);this.bottomMarker&&(k.destroy(this.bottomMarker),delete this.bottomMarker);
this.topMarker&&(k.destroy(this.topMarker),delete this.topMarker)}),onDndCancel:m.hitch(this,function(){n.prototype.onDndCancel.call(this.source);this._hide(this.bottomMarker);this._hide(this.topMarker)})});this._source_conn=u.connect(this.source,"onDndDrop",this,"_onDndDrop");this._source_sub=u.subscribe("/dnd/drop/before",this,"_onDndDropBefore");this.source.startup()}},_hide:function(h){k.style(h,{top:"-10000px",visibility:"hidden"})},_onDndDropBefore:function(h,x,z){B.manager().target===this.source&&
(this.source._targetNode=this.source.targetAnchor,this.source._beforeTarget=this.source.before,x=this.grid.views.views,h=x[h.viewIndex],x=x[this.index],x!=h&&(h.convertColPctToFixed(),x.convertColPctToFixed()))},_onDndDrop:function(h,x,z){if(B.manager().target!==this.source)B.manager().source===this.source&&(this._removingColumn=!0);else{this._hide(this.bottomMarker);this._hide(this.topMarker);z=function(E){return E?k.attr(E,"idx"):null};var e=k.marginBox(x[0]).w;if(h.viewIndex!==this.index){var t=
this.grid.views.views,y=t[h.viewIndex];t=t[this.index];y.viewWidth&&"auto"!=y.viewWidth&&y.setColumnsWidth(y.getColumnsWidth()-e);t.viewWidth&&"auto"!=t.viewWidth&&t.setColumnsWidth(t.getColumnsWidth())}e=this.source._targetNode;y=this.source._beforeTarget;!this.grid.isLeftToRight()&&(y=!y);t=this.grid.layout;var H=this.index;delete this.source._targetNode;delete this.source._beforeTarget;t.moveColumn(h.viewIndex,H,z(x[0]),z(e),y)}},renderHeader:function(){this.headerContentNode.innerHTML=this.header.generateHtml(this._getHeaderContent);
this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);b.fire(this,"onAfterRow",[-1,this.structure.cells,this.headerContentNode])},_getHeaderContent:function(h){var x=h.name||h.grid.getCellName(h);/^\s+$/.test(x)&&(x="\x26nbsp;");var z=['\x3cdiv class\x3d"dojoxGridSortNode'];h.index!=h.grid.getSortIndex()?z.push('"\x3e'):z=z.concat([" ",0<h.grid.sortInfo?"dojoxGridSortUp":"dojoxGridSortDown",'"\x3e\x3cdiv class\x3d"dojoxGridArrowButtonChar"\x3e',
0<h.grid.sortInfo?"\x26#9650;":"\x26#9660;",'\x3c/div\x3e\x3cdiv class\x3d"dojoxGridArrowButtonNode" role\x3d"presentation"\x3e\x3c/div\x3e','\x3cdiv class\x3d"dojoxGridColCaption"\x3e']);z=z.concat([x,"\x3c/div\x3e\x3c/div\x3e"]);return z.join("")},resize:function(){this.adaptHeight();this.adaptWidth()},hasHScrollbar:function(h){var x=this._hasHScroll||!1;if(void 0==this._hasHScroll||h)this.noscroll?this._hasHScroll=!1:(h=k.style(this.scrollboxNode,"overflow"),this._hasHScroll="hidden"==h?!1:"scroll"==
h?!0:this.scrollboxNode.offsetWidth-this.getScrollbarWidth()<this.contentNode.offsetWidth);x!==this._hasHScroll&&this.grid.update();return this._hasHScroll},hasVScrollbar:function(h){var x=this._hasVScroll||!1;if(void 0==this._hasVScroll||h)this.noscroll?this._hasVScroll=!1:(h=k.style(this.scrollboxNode,"overflow"),this._hasVScroll="hidden"==h?!1:"scroll"==h?!0:this.scrollboxNode.scrollHeight>this.scrollboxNode.clientHeight);x!==this._hasVScroll&&this.grid.update();return this._hasVScroll},convertColPctToFixed:function(){var h=
!1;this.grid.initialWidth="";var x=w("th",this.headerContentNode),z=v.map(x,function(e,t){var y=e.style.width;k.attr(e,"vIdx",t);if(y&&"%"==y.slice(-1))h=!0;else if(y&&"px"==y.slice(-2))return window.parseInt(y,10);return k.contentBox(e).w});return h?(v.forEach(this.grid.layout.cells,function(e,t){if(e.view==this&&(e=e.view.getHeaderCellNode(e.index))&&k.hasAttr(e,"vIdx")){var y=window.parseInt(k.attr(e,"vIdx"));this.setColWidth(t,z[y]);k.removeAttr(e,"vIdx")}},this),!0):!1},adaptHeight:function(h){if(!this.grid._autoHeight){var x=
this.domNode.style.height&&parseInt(this.domNode.style.height.replace(/px/,""),10)||this.domNode.clientHeight;if(!h&&(h=this.noscroll))a:{for(var z=0;z<this.grid.views.views.length;++z)if(h=this.grid.views.views[z],h!==this&&h.hasHScrollbar()){h=!0;break a}h=!1}h&&(x-=a.getScrollbar().h);b.setStyleHeightPx(this.scrollboxNode,x)}this.hasVScrollbar(!0)},adaptWidth:function(){this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);var h=
this.scrollboxNode.offsetWidth-this.getScrollbarWidth();this._removingColumn?(h=Math.min(h,this.getColumnsWidth())+"px",this._removingColumn=!1):h=Math.max(h,this.getColumnsWidth())+"px";this.contentNode.style.width=h;this.hasHScrollbar(!0)},setSize:function(h,x){var z=this.domNode.style,e=this.headerNode.style;h&&(z.width=h,e.width=h);z.height=0<=x?x+"px":""},renderRow:function(h){var x=this.createRowNode(h);this.buildRow(h,x);return x},createRowNode:function(h){var x=document.createElement("div");
x.className=this.classTag+"Row";this instanceof F.grid._RowSelector?k.attr(x,"role","presentation"):(k.attr(x,"role","row"),"none"!=this.grid.selectionMode&&x.setAttribute("aria-selected","false"));x[b.gridViewTag]=this.id;x[b.rowIndexTag]=h;return this.rowNodes[h]=x},buildRow:function(h,x){this.buildRowContent(h,x);this.styleRow(h,x)},buildRowContent:function(h,x){x.innerHTML=this.content.generateHtml(h,h);this.flexCells&&this.contentWidth&&(x.firstChild.style.width=this.contentWidth);b.fire(this,
"onAfterRow",[h,this.structure.cells,x])},rowRemoved:function(h){0<=h&&this._cleanupRowWidgets(this.getRowNode(h));this.grid.edit.save(this,h);delete this.rowNodes[h]},getRowNode:function(h){return this.rowNodes[h]},getCellNode:function(h,x){if(h=this.getRowNode(h))return this.content.getCellNode(h,x)},getHeaderCellNode:function(h){if(this.headerContentNode)return this.header.getCellNode(this.headerContentNode,h)},styleRow:function(h,x){var z=void 0==x.style.cssText?x.getAttribute("style"):x.style.cssText;
x._style=z;this.styleRowNode(h,x)},styleRowNode:function(h,x){x&&this.doStyleRowNode(h,x)},doStyleRowNode:function(h,x){this.grid.styleRowNode(h,x)},updateRow:function(h){var x=this.getRowNode(h);x&&(x.style.height="",this.buildRow(h,x));return x},updateRowStyles:function(h){this.styleRowNode(h,this.getRowNode(h))},lastTop:0,firstScroll:0,_nativeScroll:!1,doscroll:function(h){if(13<=r("ff")||r("chrome"))this._nativeScroll=!0;h=this.grid.isLeftToRight();if(2>this.firstScroll){if(!h&&1==this.firstScroll||
h&&0===this.firstScroll){var x=k.marginBox(this.headerNodeContainer);r("ie")?this.headerNodeContainer.style.width=x.w+this.getScrollbarWidth()+"px":r("mozilla")&&(this.headerNodeContainer.style.width=x.w-this.getScrollbarWidth()+"px",this.scrollboxNode.scrollLeft=h?this.scrollboxNode.clientWidth-this.scrollboxNode.scrollWidth:this.scrollboxNode.scrollWidth-this.scrollboxNode.clientWidth)}this.firstScroll++}this.headerNode.scrollLeft=this.scrollboxNode.scrollLeft;h=this.scrollboxNode.scrollTop;h!==
this.lastTop&&this.grid.scrollTo(h);this._nativeScroll=!1},setScrollTop:function(h){this.lastTop=h;this._nativeScroll||(this.scrollboxNode.scrollTop=h);return this.scrollboxNode.scrollTop},doContentEvent:function(h){if(this.content.decorateEvent(h))this.grid.onContentEvent(h)},doHeaderEvent:function(h){if(this.header.decorateEvent(h))this.grid.onHeaderEvent(h)},dispatchContentEvent:function(h){return this.content.dispatchEvent(h)},dispatchHeaderEvent:function(h){return this.header.dispatchEvent(h)},
setColWidth:function(h,x){this.grid.setCellWidth(h,x+"px")},update:function(){if(this.domNode){this.content.update();this.grid.update();var h=this.scrollboxNode.scrollLeft;this.scrollboxNode.scrollLeft=h;this.headerNode.scrollLeft=h}}});var J=D("dojox.grid._GridAvatar",p,{construct:function(){var h=f.doc,x=h.createElement("table");x.cellPadding=x.cellSpacing="0";x.className="dojoxGridDndAvatar";x.style.position="absolute";x.style.zIndex=1999;x.style.margin="0px";var z=h.createElement("tbody"),e=h.createElement("tr"),
t=h.createElement("td"),y=h.createElement("td");e.className="dojoxGridDndAvatarItem";y.className="dojoxGridDndAvatarItemImage";y.style.width="16px";var H=this.manager.source;if(H.creator)H=H._normalizedCreator(H.getItem(this.manager.nodes[0].id).data,"avatar").node;else if(H=this.manager.nodes[0].cloneNode(!0),"tr"==H.tagName.toLowerCase()){var E=h.createElement("table");var G=h.createElement("tbody");G.appendChild(H);E.appendChild(G);H=E}else"th"==H.tagName.toLowerCase()&&(E=h.createElement("table"),
G=h.createElement("tbody"),h=h.createElement("tr"),E.cellPadding=E.cellSpacing="0",h.appendChild(H),G.appendChild(h),E.appendChild(G),H=E);H.id="";t.appendChild(H);e.appendChild(y);e.appendChild(t);k.style(e,"opacity",.9);z.appendChild(e);x.appendChild(z);this.node=x;x=B.manager();this.oldOffsetY=x.OFFSET_Y;x.OFFSET_Y=1},destroy:function(){B.manager().OFFSET_Y=this.oldOffsetY;this.inherited(arguments)}}),A=B.manager().makeAvatar;B.manager().makeAvatar=function(){return void 0===this.source.viewIndex||
k.hasClass(f.body(),"dijit_a11y")?A.call(B.manager()):new J(this)};return c})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n){F.isAsync||r(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var q=I("dojo.dnd.Source",c,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,
autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(d,a){D.mixin(this,D.mixin({},a));d=this.accept;if(d.length)for(this.accept={},a=0;a<d.length;++a)this.accept[d[a]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&v.add(this.node,"dojoDndSource");this.targetState="";this.accept&&v.add(this.node,"dojoDndTarget");this.horizontal&&v.add(this.node,"dojoDndHorizontal");this.topics=
[w.subscribe("/dnd/source/over",D.hitch(this,"onDndSourceOver")),w.subscribe("/dnd/start",D.hitch(this,"onDndStart")),w.subscribe("/dnd/drop",D.hitch(this,"onDndDrop")),w.subscribe("/dnd/cancel",D.hitch(this,"onDndCancel"))]},checkAcceptance:function(d,a){if(this==d)return!this.copyOnly||this.selfAccept;for(var b=0;b<a.length;++b){for(var k=d.getItem(a[b].id).type,g=!1,p=0;p<k.length;++p)if(k[p]in this.accept){g=!0;break}if(!g)return!1}return!0},copyState:function(d,a){if(d)return!0;2>arguments.length&&
(a=this==n.manager().target);if(a){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){q.superclass.destroy.call(this);M.forEach(this.topics,function(d){d.remove()});this.targetAnchor=null},onMouseMove:function(d){if(!this.isDragging||"Disabled"!=this.targetState){q.superclass.onMouseMove.call(this,d);var a=n.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(d.pageX-this._lastX)>this.delay||Math.abs(d.pageY-this._lastY)>this.delay)){var b=
this.getSelectedNodes();b.length&&a.startDrag(this,b,this.copyState(f.getCopyKeyState(d),!0))}this.isDragging&&(b=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=m.position(this.current,!0)),b=this.horizontal?d.pageX-this.targetBox.x<this.targetBox.w/2==m.isBodyLtr(this.current.ownerDocument):d.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||b!=this.before)&&(this._markTargetAnchor(b),a.canDrop(!this.current||a.source!=this||!(this.current.id in
this.selection)))}},onMouseDown:function(d){this.mouseDown||!this._legalMouseDown(d)||this.skipForm&&f.isFormElement(d)||(this.mouseDown=!0,this._lastX=d.pageX,this._lastY=d.pageY,q.superclass.onMouseDown.call(this,d))},onMouseUp:function(d){this.mouseDown&&(this.mouseDown=!1,q.superclass.onMouseUp.call(this,d))},onDndSourceOver:function(d){this!==d?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(d=n.manager(),d.canDrop("Disabled"!=this.targetState&&(!this.current||
d.source!=this||!(this.current.id in this.selection))))},onDndStart:function(d,a,b){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==d?b?"Copied":"Moved":"");a=this.accept&&this.checkAcceptance(d,a);this._changeState("Target",a?"":"Disabled");this==d&&n.manager().overSource(this);this.isDragging=!0},onDndDrop:function(d,a,b,k){if(this==k)this.onDrop(d,a,b);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=
!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(d,a,b){if(this!=d)this.onDropExternal(d,a,b);else this.onDropInternal(a,b)},onDropExternal:function(d,a,b){var k=this._normalizedCreator;this._normalizedCreator=this.creator?function(g,p){return k.call(this,d.getItem(g.id).data,p)}:b?function(g){var p=d.getItem(g.id);g=g.cloneNode(!0);g.id=f.getUniqueId();return{node:g,data:p.data,type:p.type}}:function(g){var p=d.getItem(g.id);d.delItem(g.id);
return{node:g,data:p.data,type:p.type}};this.selectNone();b||this.creator||d.selectNone();this.insertNodes(!0,a,this.before,this.current);!b&&this.creator&&d.deleteSelectedNodes();this._normalizedCreator=k},onDropInternal:function(d,a){var b=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(a)this._normalizedCreator=this.creator?function(k,g){return b.call(this,this.getItem(k.id).data,g)}:function(k){var g=this.getItem(k.id);k=k.cloneNode(!0);k.id=f.getUniqueId();return{node:k,
data:g.data,type:g.type}};else{if(!this.current)return;this._normalizedCreator=function(k){var g=this.getItem(k.id);return{node:k,data:g.data,type:g.type}}}this._removeSelection();this.insertNodes(!0,d,this.before,this.current);this._normalizedCreator=b}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){q.superclass.onOverEvent.call(this);n.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){q.superclass.onOutEvent.call(this);
n.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(d){if(this.current!=this.targetAnchor||this.before!=d)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=d,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(d){this._changeState("Source",d?"Copied":"Moved")},_legalMouseDown:function(d){if("touchstart"!=d.type&&!u.isLeft(d))return!1;if(!this.withHandles)return!0;for(d=d.target;d&&d!==this.node;d=d.parentNode){if(v.contains(d,"dojoDndHandle"))return!0;if(v.contains(d,"dojoDndItem")||v.contains(d,"dojoDndIgnore"))break}return!1}});return q})},"dojo/dnd/common":function(){define(["../sniff","../_base/kernel",
"../_base/lang","../dom"],function(M,I,F,D){var v=F.getObject("dojo.dnd",!0);v.getCopyKeyState=function(m){return m[M("mac")?"metaKey":"ctrlKey"]};v._uniqueId=0;v.getUniqueId=function(){do var m=I._scopeName+"Unique"+ ++v._uniqueId;while(D.byId(m));return m};v._empty={};v.isFormElement=function(m){m=m.target;3==m.nodeType&&(m=m.parentNode);return 0<=" a button textarea input select option ".indexOf(" "+m.tagName.toLowerCase()+" ")};return v})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n){var q=I("dojo.dnd.Selector",n,{constructor:function(d,a){a||(a={});this.singular=a.singular;this.autoSync=a.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(w(this.node,f.press,D.hitch(this,"onMouseDown")),w(this.node,f.release,D.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var d=new r,a=c._empty,b;for(b in this.selection)b in a||d.push(v.byId(b));return d},selectNone:function(){return this._removeSelection()._removeAnchor()},
selectAll:function(){this.forInItems(function(d,a){this._addItemClass(v.byId(a),"Selected");this.selection[a]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var d=c._empty,a;for(a in this.selection)if(!(a in d)){var b=v.byId(a);this.delItem(a);m.destroy(b)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(d,a){a=a||F.global;var b=this.selection,k=c._empty,g;for(g in b)g in k||d.call(a,this.getItem(g),g,this)},sync:function(){q.superclass.sync.call(this);
this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var d=[],a=c._empty,b;for(b in this.selection)b in a||this.getItem(b)||d.push(b);M.forEach(d,function(k){delete this.selection[k]},this);return this},insertNodes:function(d,a,b,k){var g=this._normalizedCreator;this._normalizedCreator=function(p,B){p=g.call(this,p,B);d?(this.anchor?this.anchor!=p.node&&(this._removeItemClass(p.node,"Anchor"),this._addItemClass(p.node,"Selected")):(this.anchor=p.node,this._removeItemClass(p.node,"Selected"),
this._addItemClass(this.anchor,"Anchor")),this.selection[p.node.id]=1):(this._removeItemClass(p.node,"Selected"),this._removeItemClass(p.node,"Anchor"));return p};q.superclass.insertNodes.call(this,a,b,k);this._normalizedCreator=g;return this},destroy:function(){q.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(d){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!c.getCopyKeyState(d)&&!d.shiftKey&&this.current.id in this.selection)this.simpleSelection=
!0,u.isLeft(d)&&(d.stopPropagation(),d.preventDefault());else{if(!this.singular&&d.shiftKey){c.getCopyKeyState(d)||this._removeSelection();var a=this.getAllNodes();if(a.length&&(this.anchor||(this.anchor=a[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var b=0,k;b<a.length&&(k=a[b],k!=this.anchor&&k!=this.current);++b);for(++b;b<a.length;++b){k=a[b];if(k==this.anchor||k==this.current)break;this._addItemClass(k,"Selected");this.selection[k.id]=
1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?c.getCopyKeyState(d)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):c.getCopyKeyState(d)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):
(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);d.stopPropagation();d.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&
(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=w(this.node,f.move,D.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var d=c._empty,a;for(a in this.selection)if(!(a in d)){var b=v.byId(a);b&&this._removeItemClass(b,"Selected")}this.selection=
{};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return q})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n,q,d){I=I("dojo.dnd.Container",w,{skipForm:!1,allowNested:!1,constructor:function(a,b){this.node=m.byId(a);
b||(b={});this.creator=b.creator||null;this.skipForm=b.skipForm;this.parent=b.dropParent&&m.byId(b.dropParent);this.map={};this.current=null;this.containerState="";u.add(this.node,"dojoDndContainer");b&&b._skipStartup||this.startup();this.events=[c(this.node,q.over,D.hitch(this,"onMouseOver")),c(this.node,q.out,D.hitch(this,"onMouseOut")),c(this.node,"dragstart",D.hitch(this,"onSelectStart")),c(this.node,"selectstart",D.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},
setItem:function(a,b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(a,b){b=b||F.global;var k=this.map,g=d._empty,p;for(p in k)p in g||a.call(b,k[p],p,this);return b},clearItems:function(){this.map={}},getAllNodes:function(){return n((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(b){if(b.id){var k=this.getItem(b.id);if(k){a[b.id]=k;return}}else b.id=d.getUniqueId();k=b.getAttribute("dndType");var g=
b.getAttribute("dndData");a[b.id]={data:g||b.innerHTML,type:k?k.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,b,k){this.parent.firstChild?b?k||(k=this.parent.firstChild):k&&(k=k.nextSibling):k=null;if(k)for(b=0;b<a.length;++b){var g=this._normalizedCreator(a[b]);this.setItem(g.node.id,{data:g.data,type:g.type});k.parentNode.insertBefore(g.node,k)}else for(b=0;b<a.length;++b)g=this._normalizedCreator(a[b]),this.setItem(g.node.id,{data:g.data,type:g.type}),this.parent.appendChild(g.node);
return this},destroy:function(){M.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,b,k){a._skipStartup=!0;return new k(b,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=a[0])}this.defaultCreator=d._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&
b!=this.node;)try{b=b.parentNode}catch(k){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(b){a=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){this.withHandles||
this.skipForm&&d.isFormElement(a)||(a.stopPropagation(),a.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,b){var k="dojoDnd"+a;a=a.toLowerCase()+"State";u.replace(this.node,k+b,k+this[a]);this[a]=b},_addItemClass:function(a,b){u.add(a,"dojoDndItem"+b)},_removeItemClass:function(a,b){u.remove(a,"dojoDndItem"+b)},_getChildByEvent:function(a){if(a=a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&u.contains(a,"dojoDndItem"))return a;
return null},_normalizedCreator:function(a,b){a=(this.creator||this.defaultCreator).call(this,a,b);D.isArray(a.type)||(a.type=["text"]);a.node.id||(a.node.id=d.getUniqueId());u.add(a.node,"dojoDndItem");return a}});d._createNode=function(a){return a?function(b){return r.create(a,{innerHTML:b})}:d._createSpan};d._createTrTd=function(a){var b=r.create("tr");r.create("td",{innerHTML:a},b);return b};d._createSpan=function(a){return r.create("span",{innerHTML:a})};d._defaultCreatorNodes={ul:"li",ol:"li",
div:"div",p:"div"};d._defaultCreator=function(a){a=a.tagName.toLowerCase();var b="tbody"==a||"thead"==a?d._createTrTd:d._createNode(d._defaultCreatorNodes[a]);return function(k,g){var p=k&&D.isObject(k);if(p&&k.tagName&&k.nodeType&&k.getAttribute){var B=k.getAttribute("dndData")||k.innerHTML;p=(p=k.getAttribute("dndType"))?p.split(/\s*,\s*/):["text"]}else B=p&&k.data?k.data:k,p=p&&k.type?k.type:["text"],k=("avatar"==g?d._createSpan:b)(String(B));k.id||(k.id=d.getUniqueId());return{node:k,data:B,type:p}}};
return I})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n,q,d){var a=I("dojo.dnd.Manager",[m],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:u("touch")?4:16,OFFSET_Y:u("touch")?4:16,overSource:function(b){this.avatar&&
(this.target=b&&"Disabled"!=b.targetState?b:null,this.canDropFlag=!!this.target,this.avatar.update());f.publish("/dnd/source/over",b)},outSource:function(b){this.avatar?this.target==b&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),f.publish("/dnd/source/over",null)):f.publish("/dnd/source/over",null)},startDrag:function(b,k,g){function p(B){B.preventDefault();B.stopPropagation()}q.autoScrollStart(D.doc);this.source=b;this.nodes=k;this.copy=!!g;this.avatar=this.makeAvatar();D.body().appendChild(this.avatar.node);
f.publish("/dnd/start",b,k,this.copy);this.events=[w(D.doc,c.move,F.hitch(this,"onMouseMove")),w(D.doc,c.release,F.hitch(this,"onMouseUp")),w(D.doc,"keydown",F.hitch(this,"onKeyDown")),w(D.doc,"keyup",F.hitch(this,"onKeyUp")),w(D.doc,"dragstart",p),w(D.body(),"selectstart",p)];b="dojoDnd"+(g?"Copy":"Move");v.add(D.body(),b)},canDrop:function(b){b=!(!this.target||!b);this.canDropFlag!=b&&(this.canDropFlag=b,this.avatar.update())},stopDrag:function(){v.remove(D.body(),["dojoDndCopy","dojoDndMove"]);
M.forEach(this.events,function(b){b.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new d(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(b){var k=this.avatar;k&&(q.autoScrollNodes(b),k=k.node.style,k.left=b.pageX+this.OFFSET_X+"px",k.top=b.pageY+this.OFFSET_Y+"px",k=!!this.source.copyState(n.getCopyKeyState(b)),this.copy!=k&&this._setCopyStatus(k));u("touch")&&b.preventDefault()},onMouseUp:function(b){if(this.avatar){if(this.target&&
this.canDropFlag){var k=!!this.source.copyState(n.getCopyKeyState(b));f.publish("/dnd/drop/before",this.source,this.nodes,k,this.target,b);f.publish("/dnd/drop",this.source,this.nodes,k,this.target,b)}else f.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(b){if(this.avatar)switch(b.keyCode){case r.CTRL:b=!!this.source.copyState(!0);this.copy!=b&&this._setCopyStatus(b);break;case r.ESCAPE:f.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(b){this.avatar&&b.keyCode==r.CTRL&&(b=
!!this.source.copyState(!1),this.copy!=b&&this._setCopyStatus(b))},_setCopyStatus:function(b){this.copy=b;this.source._markDndStatus(this.copy);this.updateAvatar();v.replace(D.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});n._manager=null;a.manager=n.manager=function(){n._manager||(n._manager=new a);return n._manager};return a})},"dojo/dnd/autoscroll":function(){define("../_base/lang ../sniff ../_base/window ../dom-geometry ../dom-style ../window".split(" "),function(M,
I,F,D,v,m){var u={};M.setObject("dojo.dnd.autoscroll",u);u.getViewport=m.getBox;u.V_TRIGGER_AUTOSCROLL=32;u.H_TRIGGER_AUTOSCROLL=32;u.V_AUTOSCROLL_VALUE=16;u.H_AUTOSCROLL_VALUE=16;var r,w=F.doc,f=Infinity,c=Infinity;u.autoScrollStart=function(n){w=n;r=m.getBox(w);n=F.body(w).parentNode;f=Math.max(n.scrollHeight-r.h,0);c=Math.max(n.scrollWidth-r.w,0)};u.autoScroll=function(n){var q=r||m.getBox(w),d=F.body(w).parentNode,a=0,b=0;n.clientX<u.H_TRIGGER_AUTOSCROLL?a=-u.H_AUTOSCROLL_VALUE:n.clientX>q.w-
u.H_TRIGGER_AUTOSCROLL&&(a=Math.min(u.H_AUTOSCROLL_VALUE,c-d.scrollLeft));n.clientY<u.V_TRIGGER_AUTOSCROLL?b=-u.V_AUTOSCROLL_VALUE:n.clientY>q.h-u.V_TRIGGER_AUTOSCROLL&&(b=Math.min(u.V_AUTOSCROLL_VALUE,f-d.scrollTop));window.scrollBy(a,b)};u._validNodes={div:1,p:1,td:1};u._validOverflow={auto:1,scroll:1};u.autoScrollNodes=function(n){for(var q,d,a,b,k,g=0,p=0,B=n.target;B;){if(1==B.nodeType&&B.tagName.toLowerCase()in u._validNodes){a=v.getComputedStyle(B);k=a.overflowX.toLowerCase()in u._validOverflow;
b=a.overflowY.toLowerCase()in u._validOverflow;if(k||b)q=D.getContentBox(B,a),d=D.position(B,!0);if(k){a=Math.min(u.H_TRIGGER_AUTOSCROLL,q.w/2);k=n.pageX-d.x;if(I("webkit")||I("opera"))k+=F.body().scrollLeft;g=0;0<k&&k<q.w&&(k<a?g=-a:k>q.w-a&&(g=a),B.scrollLeft+=g)}if(b){b=Math.min(u.V_TRIGGER_AUTOSCROLL,q.h/2);a=n.pageY-d.y;if(I("webkit")||I("opera"))a+=F.body().scrollTop;p=0;0<a&&a<q.h&&(a<b?p=-b:a>q.h-b&&(p=b),B.scrollTop+=p)}if(g||p)return}try{B=B.parentNode}catch(J){B=null}}u.autoScroll(n)};
return u})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(M,I,F,D,v,m,u,r){return M("dojo.dnd.Avatar",null,{constructor:function(w){this.manager=w;this.construct()},construct:function(){var w=m.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),f=this.manager.source,c=m.create("tbody",null,w),n=m.create("tr",null,c),q=m.create("td",null,n),d=
Math.min(5,this.manager.nodes.length),a=0;u("highcontrast")&&m.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},q);m.create("span",{innerHTML:f.generateText?this._generateText():""},q);for(D.set(n,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});a<d;++a){if(f.creator)var b=f._normalizedCreator(f.getItem(this.manager.nodes[a].id).data,"avatar").node;else b=this.manager.nodes[a].cloneNode(!0),"tr"==b.tagName.toLowerCase()&&(n=m.create("table"),m.create("tbody",null,n).appendChild(b),
b=n);b.id="";n=m.create("tr",null,c);q=m.create("td",null,n);q.appendChild(b);D.set(n,{"class":"dojoDndAvatarItem",style:{opacity:(9-a)/10}})}this.node=w},destroy:function(){m.destroy(this.node);this.node=!1},update:function(){v.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(u("highcontrast")){var w=F.byId("a11yIcon"),f="+";this.manager.canDropFlag&&!this.manager.copy?f="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(f="x"):f="o";w.innerHTML=f}r("tr.dojoDndAvatarHeader td span"+
(u("highcontrast")?" span":""),this.node).forEach(function(c){c.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dojox/html/metrics":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/sniff dojo/ready dojo/_base/unload dojo/_base/window dojo/dom-geometry".split(" "),function(M,I,F,D,v,m,u){var r=I.getObject("dojox.html.metrics",!0),w=I.getObject("dojox");r.getFontMeasurements=function(){var a=
{"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0};if(F("ie")){var b=m.doc.documentElement.style.fontSize||"";b||(m.doc.documentElement.style.fontSize="100%")}var k=m.doc.createElement("div"),g=k.style;g.position="absolute";g.left="-100px";g.top="0";g.width="30px";g.height="1000em";g.borderWidth="0";g.margin="0";g.padding="0";g.outline="0";g.lineHeight="1";g.overflow="hidden";m.body().appendChild(k);for(var p in a)g.fontSize=p,a[p]=
16*Math.round(12*k.offsetHeight/16)/12/1E3;F("ie")&&(m.doc.documentElement.style.fontSize=b);m.body().removeChild(k);k=null;return a};var f=null;r.getCachedFontMeasurements=function(a){if(a||!f)f=r.getFontMeasurements();return f};var c=null,n={};r.getTextBox=function(a,b,k){if(c)var g=c;else{g=c=m.doc.createElement("div");g.style.whiteSpace="nowrap";var p=m.doc.createElement("div");p.appendChild(g);var B=p.style;B.overflow="scroll";B.position="absolute";B.left="0px";B.top="-10000px";B.width="1px";
B.height="1px";B.visibility="hidden";B.borderWidth="0";B.margin="0";B.padding="0";B.outline="0";m.body().appendChild(p)}g.className="";B=g.style;B.borderWidth="0";B.margin="0";B.padding="0";B.outline="0";if(1<arguments.length&&b)for(var J in b)J in n||(B[J]=b[J]);2<arguments.length&&k&&(g.className=k);g.innerHTML=a;B=u.position(g);B.w=g.parentNode.scrollWidth;return B};var q=16,d=16;r.getScrollbar=function(){return{w:q,h:d}};r._fontResizeNode=null;r.initOnFontResize=function(a){var b=r._fontResizeNode=
m.doc.createElement("iframe");a=b.style;a.position="absolute";a.width="5em";a.height="10em";a.top="-10000px";a.display="none";F("ie")?b.onreadystatechange=function(){"complete"==b.contentWindow.document.readyState&&(b.onresize=b.contentWindow.parent[w._scopeName].html.metrics._fontresize)}:b.onload=function(){b.contentWindow.onresize=b.contentWindow.parent[w._scopeName].html.metrics._fontresize};b.setAttribute("src","javascript:'\x3chtml\x3e\x3chead\x3e\x3cscript\x3eif(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}\x3c/script\x3e\x3c/head\x3e\x3cbody\x3e\x3c/body\x3e\x3c/html\x3e'");
m.body().appendChild(b);r.initOnFontResize=function(){}};r.onFontResize=function(){};r._fontresize=function(){r.onFontResize()};v.addOnUnload(function(){var a=r._fontResizeNode;a&&(F("ie")&&a.onresize?a.onresize=null:a.contentWindow&&a.contentWindow.onresize&&(a.contentWindow.onresize=null),r._fontResizeNode=null)});D(function(){try{var a=m.doc.createElement("div");a.style.cssText="top:0;left:0;width:100px;height:100px;overflow:scroll;position:absolute;visibility:hidden;";m.body().appendChild(a);
q=a.offsetWidth-a.clientWidth;d=a.offsetHeight-a.clientHeight;m.body().removeChild(a);delete a}catch(b){}"fontSizeWatch"in M.config&&M.config.fontSizeWatch&&r.initOnFontResize()});return r})},"dojox/grid/_Builder":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/window dojo/_base/event dojo/_base/sniff dojo/_base/connect dojo/dnd/Moveable dojox/html/metrics ./util dojo/_base/html dojo/dom-geometry".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n){var q=M.grid,d=function(A){return 0<=
A.rowIndex?A.rowIndex:I.indexOf(A.parentNode.childNodes,A)},a=function(A,h){return A&&((A.rows||0)[h]||A.childNodes[h])},b=function(A){for(;A&&"TABLE"!=A.tagName;A=A.parentNode);return A},k=function(A){var h=A.toUpperCase();return function(x){return x.tagName!=h}},g=f.rowIndexTag,p=f.gridViewTag,B=q._Builder=F.extend(function(A){A&&(this.view=A,this.grid=A.grid)},{view:null,_table:'\x3ctable class\x3d"dojoxGridRowTable" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"',getTableArray:function(){var A=
[this._table];this.view.viewWidth&&A.push([' style\x3d"width:',this.view.viewWidth,';"'].join(""));A.push("\x3e");return A},generateCellMarkup:function(A,h,x,z){var e=[];if(z){var t=A.index!=A.grid.getSortIndex()?"":0<A.grid.sortInfo?'aria-sort\x3d"ascending"':'aria-sort\x3d"descending"';A.id||(A.id=this.grid.id+"Hdr"+A.index);t=['\x3cth tabIndex\x3d"-1" aria-readonly\x3d"true" role\x3d"columnheader"',t,' id\x3d"',A.id,'"']}else t=['\x3ctd tabIndex\x3d"-1" role\x3d"gridcell"',this.grid.editable&&
!A.editable?'aria-readonly\x3d"true"':""];A.colSpan&&t.push(' colspan\x3d"',A.colSpan,'"');A.rowSpan&&t.push(' rowspan\x3d"',A.rowSpan,'"');t.push(' class\x3d"dojoxGridCell ');A.classes&&t.push(A.classes," ");x&&t.push(x," ");e.push(t.join(""));e.push("");t=['" idx\x3d"',A.index,'" style\x3d"'];h&&";"!=h[h.length-1]&&(h+=";");t.push(A.styles,h||"",A.hidden?"display:none;":"");A.unitWidth&&t.push("width:",A.unitWidth,";");e.push(t.join(""));e.push("");t=['"'];A.attrs&&t.push(" ",A.attrs);t.push("\x3e");
e.push(t.join(""));e.push("");e.push(z?"\x3c/th\x3e":"\x3c/td\x3e");return e},isCellNode:function(A){return!(!A||A==D.doc||!c.attr(A,"idx"))},getCellNodeIndex:function(A){return A?Number(c.attr(A,"idx")):-1},getCellNode:function(A,h){for(var x=0,z;(z=a(A.firstChild,x))&&z.cells;x++)for(var e=0,t;t=z.cells[e];e++)if(this.getCellNodeIndex(t)==h)return t;return null},findCellTarget:function(A,h){for(;A&&(!this.isCellNode(A)||A.offsetParent&&p in A.offsetParent.parentNode&&A.offsetParent.parentNode[p]!=
this.view.id)&&A!=h;)A=A.parentNode;return A!=h?A:null},baseDecorateEvent:function(A){A.dispatch="do"+A.type;A.grid=this.grid;A.sourceView=this.view;A.cellNode=this.findCellTarget(A.target,A.rowNode);A.cellIndex=this.getCellNodeIndex(A.cellNode);A.cell=0<=A.cellIndex?this.grid.getCell(A.cellIndex):null},findTarget:function(A,h){for(;A&&A!=this.domNode&&(!(h in A)||p in A&&A[p]!=this.view.id);)A=A.parentNode;return A!=this.domNode?A:null},findRowTarget:function(A){return this.findTarget(A,g)},isIntraNodeEvent:function(A){try{return A.cellNode&&
A.relatedTarget&&c.isDescendant(A.relatedTarget,A.cellNode)}catch(h){return!1}},isIntraRowEvent:function(A){try{var h=A.relatedTarget&&this.findRowTarget(A.relatedTarget);return!h&&-1==A.rowIndex||h&&A.rowIndex==h.gridRowIndex}catch(x){return!1}},dispatchEvent:function(A){return A.dispatch in this?this[A.dispatch](A):!1},domouseover:function(A){A.cellNode&&A.cellNode!=this.lastOverCellNode&&(this.lastOverCellNode=A.cellNode,this.grid.onMouseOver(A));this.grid.onMouseOverRow(A)},domouseout:function(A){if(A.cellNode&&
A.cellNode==this.lastOverCellNode&&!this.isIntraNodeEvent(A,this.lastOverCellNode)&&(this.lastOverCellNode=null,this.grid.onMouseOut(A),!this.isIntraRowEvent(A)))this.grid.onMouseOutRow(A)},domousedown:function(A){if(A.cellNode)this.grid.onMouseDown(A);this.grid.onMouseDownRow(A)},_getTextDirStyle:function(A,h,x){return""}});M=q._ContentBuilder=F.extend(function(A){B.call(this,A)},B.prototype,{update:function(){this.prepareHtml()},prepareHtml:function(){for(var A=this.grid.get,h=this.view.structure.cells,
x=0,z;z=h[x];x++)for(var e=0,t;t=z[e];e++)t.get=t.get||void 0==t.value&&A,t.markup=this.generateCellMarkup(t,t.cellStyles,t.cellClasses,!1),!this.grid.editable&&t.editable&&(this.grid.editable=!0)},generateHtml:function(A,h){A=this.getTableArray();var x=this.view.structure.cells,z=this.grid.getItem(h);f.fire(this.view,"onBeforeRow",[h,x]);for(var e=0,t;t=x[e];e++)if(!t.hidden&&!t.header){A.push(t.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var y=0,H,E,G;H=t[y];y++){E=H.markup;
var O=H.customClasses=[];G=H.customStyles=[];E[5]=H.format(h,z);E[1]=O.join(" ");E[3]=G.join(";");(O=H.textDir||this.grid.textDir)&&(E[3]+=this._getTextDirStyle(O,H,h));A.push.apply(A,E)}A.push("\x3c/tr\x3e")}A.push("\x3c/table\x3e");return A.join("")},decorateEvent:function(A){A.rowNode=this.findRowTarget(A.target);if(!A.rowNode)return!1;A.rowIndex=A.rowNode[g];this.baseDecorateEvent(A);A.cell=this.grid.getCell(A.cellIndex);return!0}});var J=q._HeaderBuilder=F.extend(function(A){this.moveable=null;
B.call(this,A)},B.prototype,{_skipBogusClicks:!1,overResizeWidth:4,minColWidth:1,update:function(){this.tableMap?this.tableMap.mapRows(this.view.structure.cells):this.tableMap=new q._TableMap(this.view.structure.cells)},generateHtml:function(A,h){var x,z=this.getTableArray(),e=this.view.structure.cells;f.fire(this.view,"onBeforeRow",[-1,e]);for(var t=0,y;y=e[t];t++)if(!y.hidden){z.push(y.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var H=0,E,G;E=y[H];H++)E.customClasses=
[],E.customStyles=[],this.view.simpleStructure&&(E.draggable&&(E.headerClasses?-1==E.headerClasses.indexOf("dojoDndItem")&&(E.headerClasses+=" dojoDndItem"):E.headerClasses="dojoDndItem"),E.attrs?-1==E.attrs.indexOf("dndType\x3d'gridColumn_")&&(E.attrs+=" dndType\x3d'gridColumn_"+this.grid.id+"'"):E.attrs="dndType\x3d'gridColumn_"+this.grid.id+"'"),G=this.generateCellMarkup(E,E.headerStyles,E.headerClasses,!0),G[5]=void 0!=h?h:A(E),G[3]=E.customStyles.join(";"),(x=E.textDir||this.grid.textDir)&&(G[3]+=
this._getTextDirStyle(x,E,h)),G[1]=E.customClasses.join(" "),z.push(G.join(""));z.push("\x3c/tr\x3e")}z.push("\x3c/table\x3e");return z.join("")},getCellX:function(A){var h=k("th");for(var x=A.target;x&&h(x);x=x.parentNode);(h=x)?(h=n.position(h),A=A.clientX-h.x):A=A.layerX;return A},decorateEvent:function(A){this.baseDecorateEvent(A);A.rowIndex=-1;A.cellX=this.getCellX(A);return!0},prepareResize:function(A,h){do{var x=A.cellIndex;A.cellNode=x?A.cellNode.parentNode.cells[x+h]:null;A.cellIndex=A.cellNode?
this.getCellNodeIndex(A.cellNode):-1}while(A.cellNode&&"none"==A.cellNode.style.display);return!!A.cellNode},canResize:function(A){if(!A.cellNode||1<A.cellNode.colSpan)return!1;A=this.grid.getCell(A.cellIndex);return!A.noresize&&A.canResize()},overLeftResizeArea:function(A){if(c.hasClass(D.body(),"dojoDndMove"))return!1;if(m("ie")){var h=A.target;if(c.hasClass(h,"dojoxGridArrowButtonNode")||c.hasClass(h,"dojoxGridArrowButtonChar")||c.hasClass(h,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?
0<A.cellIndex&&0<A.cellX&&A.cellX<this.overResizeWidth&&this.prepareResize(A,-1):A.cellNode&&0<A.cellX&&A.cellX<this.overResizeWidth},overRightResizeArea:function(A){if(c.hasClass(D.body(),"dojoDndMove"))return!1;if(m("ie")){var h=A.target;if(c.hasClass(h,"dojoxGridArrowButtonNode")||c.hasClass(h,"dojoxGridArrowButtonChar")||c.hasClass(h,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?A.cellNode&&A.cellX>=A.cellNode.offsetWidth-this.overResizeWidth:0<A.cellIndex&&A.cellX>=A.cellNode.offsetWidth-
this.overResizeWidth&&this.prepareResize(A,-1)},domousemove:function(A){if(!this.moveable){var h=this.overRightResizeArea(A)?"dojoxGridColResize":this.overLeftResizeArea(A)?"dojoxGridColResize":"";h&&!this.canResize(A)&&(h="dojoxGridColNoResize");c.toggleClass(A.sourceView.headerNode,"dojoxGridColNoResize","dojoxGridColNoResize"==h);c.toggleClass(A.sourceView.headerNode,"dojoxGridColResize","dojoxGridColResize"==h);h&&v.stop(A)}},domousedown:function(A){this.moveable||((this.overRightResizeArea(A)||
this.overLeftResizeArea(A))&&this.canResize(A)?this.beginColumnResize(A):(this.grid.onMouseDown(A),this.grid.onMouseOverRow(A)))},doclick:function(A){return this._skipBogusClicks?(v.stop(A),!0):!1},colResizeSetup:function(A,h){var x=c.contentBox(A.sourceView.headerNode);if(h){this.lineDiv=document.createElement("div");h=c.position(A.sourceView.headerNode,!0);var z=c.contentBox(A.sourceView.domNode),e=A.pageX;!this.grid.isLeftToRight()&&8>m("ie")&&(e-=w.getScrollbar().w);c.style(this.lineDiv,{top:h.y+
"px",left:e+"px",height:z.h+x.h+"px"});c.addClass(this.lineDiv,"dojoxGridResizeColLine");this.lineDiv._origLeft=e;D.body().appendChild(this.lineDiv)}h=[];z=this.tableMap.findOverlappingNodes(A.cellNode);e=0;for(var t;t=z[e];e++)h.push({node:t,index:this.getCellNodeIndex(t),width:t.offsetWidth});z=A.sourceView;t=this.grid.isLeftToRight()?1:-1;var y=A.grid.views.views;e=[];for(var H=z.idx+t,E;E=y[H];H+=t)e.push({node:E.headerNode,left:window.parseInt(E.headerNode.style.left)});t=z.headerContentNode.firstChild;
return{scrollLeft:A.sourceView.headerNode.scrollLeft,view:z,node:A.cellNode,index:A.cellIndex,w:c.contentBox(A.cellNode).w,vw:x.w,table:t,tw:c.contentBox(t).w,spanners:h,followers:e}},beginColumnResize:function(A){this.moverDiv=document.createElement("div");c.style(this.moverDiv,{position:"absolute",left:0});D.body().appendChild(this.moverDiv);c.addClass(this.grid.domNode,"dojoxGridColumnResizing");var h=this.moveable=new r(this.moverDiv),x=this.colResizeSetup(A,!0);h.onMove=F.hitch(this,"doResizeColumn",
x);u.connect(h,"onMoveStop",F.hitch(this,function(){this.endResizeColumn(x);x.node.releaseCapture&&x.node.releaseCapture();this.moveable.destroy();delete this.moveable;this.moveable=null;c.removeClass(this.grid.domNode,"dojoxGridColumnResizing")}));A.cellNode.setCapture&&A.cellNode.setCapture();h.onMouseDown(A)},doResizeColumn:function(A,h,x){var z=x.l;z={deltaX:z,w:A.w+(this.grid.isLeftToRight()?z:-z),vw:A.vw+z,tw:A.tw+z};this.dragRecord={inDrag:A,mover:h,leftTop:x};z.w>=this.minColWidth&&(h?c.style(this.lineDiv,
"left",this.lineDiv._origLeft+z.deltaX+"px"):this.doResizeNow(A,z))},endResizeColumn:function(A){if(this.dragRecord){var h=this.dragRecord.leftTop;h=this.grid.isLeftToRight()?h.l:-h.l;h+=Math.max(A.w+h,this.minColWidth)-(A.w+h);m("webkit")&&A.spanners.length&&(h+=c._getPadBorderExtents(A.spanners[0].node).w);this.doResizeNow(A,{deltaX:h,w:A.w+h,vw:A.vw+h,tw:A.tw+h});delete this.dragRecord}c.destroy(this.lineDiv);c.destroy(this.moverDiv);c.destroy(this.moverDiv);delete this.moverDiv;this._skipBogusClicks=
!0;A.view.update();this._skipBogusClicks=!1;this.grid.onResizeColumn(A.index)},doResizeNow:function(A,h){A.view.convertColPctToFixed();if(A.view.flexCells&&!A.view.testFlexCells()){var x=b(A.node);x&&(x.style.width="")}var z;for(x=0;z=A.spanners[x];x++){var e=z.width+h.deltaX;0<e&&(z.node.style.width=e+"px",A.view.setColWidth(z.index,e))}if(this.grid.isLeftToRight()||!m("ie"))for(x=0;z=A.followers[x];x++)e=z.left+h.deltaX,z.node.style.left=e+"px";A.node.style.width=h.w+"px";A.view.setColWidth(A.index,
h.w);A.view.headerNode.style.width=h.vw+"px";A.view.setColumnsWidth(h.tw);this.grid.isLeftToRight()||(A.view.headerNode.scrollLeft=A.scrollLeft+h.deltaX)}});q._TableMap=F.extend(function(A){this.mapRows(A)},{map:null,mapRows:function(A){if(A.length){this.map=[];for(var h,x=0;h=A[x];x++)this.map[x]=[];for(x=0;h=A[x];x++)for(var z=0,e=0,t,y;t=h[z];z++){for(;this.map[x][e];)e++;this.map[x][e]={c:z,r:x};y=t.rowSpan||1;t=t.colSpan||1;for(var H=0;H<y;H++)for(var E=0;E<t;E++)this.map[x+H][e+E]=this.map[x][e];
e+=t}}},dumpMap:function(){for(var A=0,h;h=this.map[A];A++)for(var x=0;h[x];x++);},getMapCoords:function(A,h){for(var x=0,z;z=this.map[x];x++)for(var e=0,t;t=z[e];e++)if(t.c==h&&t.r==A)return{j:x,i:e};return{j:-1,i:-1}},getNode:function(A,h,x){return(A=A&&A.rows[h])&&A.cells[x]},_findOverlappingNodes:function(A,h,x){var z=[];h=this.getMapCoords(h,x);x=0;for(var e;e=this.map[x];x++)x!=h.j&&(e=(e=e[h.i])?this.getNode(A,e.r,e.c):null)&&z.push(e);return z},findOverlappingNodes:function(A){return this._findOverlappingNodes(b(A),
d(A.parentNode),0<=A.cellIndex?A.cellIndex:I.indexOf(A.parentNode.cells,A))}});return{_Builder:B,_HeaderBuilder:J,_ContentBuilder:M}})},"dojo/dnd/Moveable":function(){define("../_base/array ../_base/declare ../_base/lang ../dom ../dom-class ../Evented ../has ../on ../topic ../touch ./common ./Mover ../_base/window".split(" "),function(M,I,F,D,v,m,u,r,w,f,c,n,q){function d(k,g){"touchAction"in document.body.style?a="touchAction":"msTouchAction"in document.body.style&&(a="msTouchAction");b=function(p,
B){p.style[a]=B};b(k,g)}var a,b=function(){};u("touch-action")&&(b=d);return I("dojo.dnd.Moveable",[m],{handle:"",delay:0,skip:!1,constructor:function(k,g){this.node=D.byId(k);b(this.node,"none");g||(g={});this.handle=g.handle?D.byId(g.handle):null;this.handle||(this.handle=this.node);this.delay=0<g.delay?g.delay:0;this.skip=g.skip;this.mover=g.mover?g.mover:n;this.events=[r(this.handle,f.press,F.hitch(this,"onMouseDown")),r(this.handle,"dragstart",F.hitch(this,"onSelectStart")),r(this.handle,"selectstart",
F.hitch(this,"onSelectStart"))]},markupFactory:function(k,g,p){return new p(g,k)},destroy:function(){M.forEach(this.events,function(k){k.remove()});b(this.node,"");this.events=this.node=this.handle=null},onMouseDown:function(k){if(!this.skip||!c.isFormElement(k)){if(this.delay)this.events.push(r(this.handle,f.move,F.hitch(this,"onMouseMove")),r(this.handle.ownerDocument,f.release,F.hitch(this,"onMouseUp"))),this._lastX=k.pageX,this._lastY=k.pageY;else this.onDragDetected(k);k.stopPropagation();k.preventDefault()}},
onMouseMove:function(k){if(Math.abs(k.pageX-this._lastX)>this.delay||Math.abs(k.pageY-this._lastY)>this.delay)this.onMouseUp(k),this.onDragDetected(k);k.stopPropagation();k.preventDefault()},onMouseUp:function(k){for(var g=0;2>g;++g)this.events.pop().remove();k.stopPropagation();k.preventDefault()},onSelectStart:function(k){this.skip&&c.isFormElement(k)||(k.stopPropagation(),k.preventDefault())},onDragDetected:function(k){new this.mover(this.node,k,this)},onMoveStart:function(k){w.publish("/dnd/move/start",
k);v.add(q.body(),"dojoMove");v.add(this.node,"dojoMoveItem")},onMoveStop:function(k){w.publish("/dnd/move/stop",k);v.remove(q.body(),"dojoMove");v.remove(this.node,"dojoMoveItem")},onFirstMove:function(){},onMove:function(k,g){this.onMoving(k,g);var p=k.node.style;p.left=g.l+"px";p.top=g.t+"px";this.onMoved(k,g)},onMoving:function(){},onMoved:function(){}})})},"dojo/dnd/Mover":function(){define("../_base/array ../_base/declare ../_base/lang ../sniff ../_base/window ../dom ../dom-geometry ../dom-style ../Evented ../on ../touch ./common ./autoscroll".split(" "),
function(M,I,F,D,v,m,u,r,w,f,c,n,q){return I("dojo.dnd.Mover",[w],{constructor:function(d,a,b){function k(g){g.preventDefault();g.stopPropagation()}this.node=m.byId(d);this.marginBox={l:a.pageX,t:a.pageY};this.mouseButton=a.button;a=this.host=b;d=d.ownerDocument;this.events=[f(d,c.move,F.hitch(this,"onFirstMove")),f(d,c.move,F.hitch(this,"onMouseMove")),f(d,c.release,F.hitch(this,"onMouseUp")),f(d,"dragstart",k),f(d.body,"selectstart",k)];q.autoScrollStart(d);if(a&&a.onMoveStart)a.onMoveStart(this)},
onMouseMove:function(d){q.autoScroll(d);var a=this.marginBox;this.host.onMove(this,{l:a.l+d.pageX,t:a.t+d.pageY},d);d.preventDefault();d.stopPropagation()},onMouseUp:function(d){(D("webkit")&&D("mac")&&2==this.mouseButton?0==d.button:this.mouseButton==d.button)&&this.destroy();d.preventDefault();d.stopPropagation()},onFirstMove:function(d){var a=this.node.style,b=this.host;switch(a.position){case "relative":case "absolute":var k=Math.round(parseFloat(a.left))||0;a=Math.round(parseFloat(a.top))||0;
break;default:a.position="absolute";a=u.getMarginBox(this.node);k=v.doc.body;var g=r.getComputedStyle(k),p=u.getMarginBox(k,g);g=u.getContentBox(k,g);k=a.l-(g.l-p.l);a=a.t-(g.t-p.t)}this.marginBox.l=k-this.marginBox.l;this.marginBox.t=a-this.marginBox.t;if(b&&b.onFirstMove)b.onFirstMove(this,d);this.events.shift().remove()},destroy:function(){M.forEach(this.events,function(a){a.remove()});var d=this.host;if(d&&d.onMoveStop)d.onMoveStop(this);this.events=this.node=this.host=null}})})},"dojox/grid/_ViewManager":function(){define(["dojo/_base/declare",
"dojo/_base/sniff","dojo/dom-class"],function(M,I,F){return M("dojox.grid._ViewManager",null,{constructor:function(D){this.grid=D},defaultWidth:200,views:[],resize:function(){this.onEach("resize")},render:function(){this.onEach("render")},addView:function(D){D.idx=this.views.length;this.views.push(D)},destroyViews:function(){for(var D=0,v;v=this.views[D];D++)v.destroy();this.views=[]},getContentNodes:function(){for(var D=[],v=0,m;m=this.views[v];v++)D.push(m.contentNode);return D},forEach:function(D){for(var v=
0,m;m=this.views[v];v++)D(m,v)},onEach:function(D,v){v=v||[];for(var m=0,u;u=this.views[m];m++)D in u&&u[D].apply(u,v)},normalizeHeaderNodeHeight:function(){for(var D=[],v=0,m;m=this.views[v];v++)m.headerContentNode.firstChild&&D.push(m.headerContentNode);this.normalizeRowNodeHeights(D)},normalizeRowNodeHeights:function(D){var v=0,m=[];if(this.grid.rowHeight)v=this.grid.rowHeight;else{if(1>=D.length)return;for(var u=0,r;r=D[u];u++)F.contains(r,"dojoxGridNonNormalizedCell")||(m[u]=r.firstChild.offsetHeight,
v=Math.max(v,m[u]));v=0<=v?v:0;(I("mozilla")||8<I("ie"))&&v&&v++}for(u=0;r=D[u];u++)m[u]!=v&&(r.firstChild.style.height=v+"px")},resetHeaderNodeHeight:function(){for(var D=0,v;v=this.views[D];D++)if(v=v.headerContentNode.firstChild)v.style.height=""},renormalizeRow:function(D){for(var v=[],m=0,u,r;(u=this.views[m])&&(r=u.getRowNode(D));m++)r.firstChild.style.height="",v.push(r);this.normalizeRowNodeHeights(v)},getViewWidth:function(D){return this.views[D].getWidth()||this.defaultWidth},measureHeader:function(){this.resetHeaderNodeHeight();
this.forEach(function(v){v.headerContentNode.style.height=""});var D=0;this.forEach(function(v){D=Math.max(v.headerNode.offsetHeight,D)});return D},measureContent:function(){var D=0;this.forEach(function(v){D=Math.max(v.domNode.offsetHeight,D)});return D},findClient:function(D){D=this.grid.elasticView||-1;if(0>D)for(var v=1,m;m=this.views[v];v++)if(m.viewWidth){for(v=1;m=this.views[v];v++)if(!m.viewWidth){D=v;break}break}0>D&&(D=Math.floor(this.views.length/2));return D},arrange:function(D,v){var m,
u,r=this.views.length,w=this,f=0>=v?r:this.findClient(),c=function(d,a){var b=d.domNode.style,k=d.headerNode.style;w.grid.isLeftToRight()?(b.left=a+"px",k.left=a+"px"):(b.right=a+"px",4>I("ff")?k.right=a+d.getScrollbarWidth()+"px":k.right=a+"px",I("webkit")||"auto"==k.width||(k.width=parseInt(k.width,10)-d.getScrollbarWidth()+"px"));b.top="0px";k.top=0};for(m=0;(u=this.views[m])&&m<f;m++){var n=this.getViewWidth(m);u.setSize(n,0);c(u,D);n=u.headerContentNode&&u.headerContentNode.firstChild?u.getColumnsWidth()+
u.getScrollbarWidth():u.domNode.offsetWidth;D+=n}m++;for(var q=r-1;(u=this.views[q])&&m<=q;q--)n=this.getViewWidth(q),u.setSize(n,0),n=u.domNode.offsetWidth,v-=n,c(u,v);f<r&&(u=this.views[f],n=Math.max(1,v-D),u.setSize(n+"px",0),c(u,D));return D},renderRow:function(D,v,m){for(var u=[],r=0,w,f;(w=this.views[r])&&(f=v[r]);r++)w=w.renderRow(D),f.appendChild(w),u.push(w);m||this.normalizeRowNodeHeights(u)},rowRemoved:function(D){this.onEach("rowRemoved",[D])},updateRow:function(D,v){for(var m=0,u;u=this.views[m];m++)u.updateRow(D);
v||this.renormalizeRow(D)},updateRowStyles:function(D){this.onEach("updateRowStyles",[D])},setScrollTop:function(D){for(var v=D,m=0,u;u=this.views[m];m++)v=u.setScrollTop(D),I("ie")&&u.headerNode&&u.scrollboxNode&&(u.headerNode.scrollLeft=u.scrollboxNode.scrollLeft);return v},getFirstScrollingView:function(){for(var D=0,v;v=this.views[D];D++)if(v.hasHScrollbar()||v.hasVScrollbar())return v;return null}})})},"dojox/grid/_RowManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class"],
function(M,I,F){return M("dojox.grid._RowManager",null,{constructor:function(D){this.grid=D},linesToEms:2,overRow:-2,prepareStylingRow:function(D,v){return{index:D,node:v,odd:!!(D&1),selected:!!this.grid.selection.isSelected(D),over:this.isOver(D),customStyles:"",customClasses:"dojoxGridRow"}},styleRowNode:function(D,v){D=this.prepareStylingRow(D,v);this.grid.onStyleRow(D);this.applyStyles(D)},applyStyles:function(D){D.node.className=D.customClasses;var v=D.node.style.height,m=D.node,u=D.customStyles+
";"+(D.node._style||"");void 0==m.style.cssText?m.setAttribute("style",u):m.style.cssText=u;D.node.style.height=v},updateStyles:function(D){this.grid.updateRowStyles(D)},setOverRow:function(D){var v=this.overRow;this.overRow=D;v!=this.overRow&&(I.isString(v)||0<=v)&&this.updateStyles(v);this.updateStyles(this.overRow)},isOver:function(D){return this.overRow==D&&!F.contains(this.grid.domNode,"dojoxGridColumnResizing")}})})},"dojox/grid/_FocusManager":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/declare dojo/_base/connect dojo/_base/event dojo/_base/sniff dojo/query ./util dojo/_base/html".split(" "),
function(M,I,F,D,v,m,u,r,w){return F("dojox.grid._FocusManager",null,{constructor:function(f){this.grid=f;this.cell=null;this.rowIndex=-1;this._connects=[];this._headerConnects=[];this.headerMenu=this.grid.headerMenu;this._connects.push(D.connect(this.grid.domNode,"onfocus",this,"doFocus"));this._connects.push(D.connect(this.grid.domNode,"onblur",this,"doBlur"));this._connects.push(D.connect(this.grid.domNode,"mousedown",this,"_mouseDown"));this._connects.push(D.connect(this.grid.domNode,"mouseup",
this,"_mouseUp"));this._connects.push(D.connect(this.grid.domNode,"oncontextmenu",this,"doContextMenu"));this._connects.push(D.connect(this.grid.lastFocusNode,"onfocus",this,"doLastNodeFocus"));this._connects.push(D.connect(this.grid.lastFocusNode,"onblur",this,"doLastNodeBlur"));this._connects.push(D.connect(this.grid,"_onFetchComplete",this,"_delayedCellFocus"));this._connects.push(D.connect(this.grid,"postrender",this,"_delayedHeaderFocus"))},destroy:function(){M.forEach(this._connects,D.disconnect);
M.forEach(this._headerConnects,D.disconnect);delete this.grid;delete this.cell},_colHeadNode:null,_colHeadFocusIdx:null,_contextMenuBindNode:null,tabbingOut:!1,focusClass:"dojoxGridCellFocus",focusView:null,initFocusView:function(){this.focusView=this.grid.views.getFirstScrollingView()||this.focusView||this.grid.views.views[0];this._initColumnHeaders()},isFocusCell:function(f,c){return this.cell==f&&this.rowIndex==c},isLastFocusCell:function(){return this.cell?this.rowIndex==this.grid.rowCount-1&&
this.cell.index==this.grid.layout.cellCount-1:!1},isFirstFocusCell:function(){return this.cell?0===this.rowIndex&&0===this.cell.index:!1},isNoFocusCell:function(){return 0>this.rowIndex||!this.cell},isNavHeader:function(){return!!this._colHeadNode},getHeaderIndex:function(){return this._colHeadNode?M.indexOf(this._findHeaderCells(),this._colHeadNode):-1},_focusifyCellNode:function(f){var c=this.cell&&this.cell.getNode(this.rowIndex);if(c&&(w.toggleClass(c,this.focusClass,f),f)){f=this.scrollIntoView();
try{if(m("webkit")||!this.grid.edit.isEditing())r.fire(c,"focus"),f&&(this.cell.view.scrollboxNode.scrollLeft=f)}catch(n){}}},_delayedCellFocus:function(){if(!this.isNavHeader()&&this.grid.focused){var f=this.cell&&this.cell.getNode(this.rowIndex);if(f)try{this.grid.edit.isEditing()||(w.toggleClass(f,this.focusClass,!0),this._colHeadNode&&this.blurHeader(),r.fire(f,"focus"))}catch(c){}}},_delayedHeaderFocus:function(){this.isNavHeader()&&this.focusHeader()},_initColumnHeaders:function(){M.forEach(this._headerConnects,
D.disconnect);this._headerConnects=[];for(var f=this._findHeaderCells(),c=0;c<f.length;c++)this._headerConnects.push(D.connect(f[c],"onfocus",this,"doColHeaderFocus")),this._headerConnects.push(D.connect(f[c],"onblur",this,"doColHeaderBlur"))},_findHeaderCells:function(){for(var f=u("th",this.grid.viewsHeaderNode),c=[],n=0;n<f.length;n++){var q=f[n],d=w.hasAttr(q,"tabIndex"),a=w.attr(q,"tabIndex");d&&0>a&&c.push(q)}return c},_setActiveColHeader:function(f,c,n){this.grid.domNode.setAttribute("aria-activedescendant",
f.id);null!=n&&0<=n&&n!=c&&w.toggleClass(this._findHeaderCells()[n],this.focusClass,!1);w.toggleClass(f,this.focusClass,!0);this._colHeadNode=f;this._colHeadFocusIdx=c;this._scrollHeader(this._colHeadFocusIdx)},scrollIntoView:function(){var f=this.cell?this._scrollInfo(this.cell):null;if(!f||!f.s)return null;var c=this.grid.scroller.findScrollTop(this.rowIndex);f.n&&f.sr&&(f.n.offsetLeft+f.n.offsetWidth>f.sr.l+f.sr.w?f.s.scrollLeft=f.n.offsetLeft+f.n.offsetWidth-f.sr.w:f.n.offsetLeft<f.sr.l&&(f.s.scrollLeft=
f.n.offsetLeft));f.r&&f.sr&&(c+f.r.offsetHeight>f.sr.t+f.sr.h?this.grid.setScrollTop(c+f.r.offsetHeight-f.sr.h):c<f.sr.t&&this.grid.setScrollTop(c));return f.s.scrollLeft},_scrollInfo:function(f,c){if(f){var n=f.view.scrollboxNode,q={w:n.clientWidth,l:n.scrollLeft,t:n.scrollTop,h:n.clientHeight},d=f.view.getRowNode(this.rowIndex);return{c:f,s:n,sr:q,n:c?c:f.getNode(this.rowIndex),r:d}}return null},_scrollHeader:function(f){var c=null;if(this._colHeadNode){var n=this.grid.getCell(f);if(!n)return;c=
this._scrollInfo(n,n.getNode(0))}c&&c.s&&c.sr&&c.n&&(c.n.offsetLeft+c.n.offsetWidth>c.sr.l+c.sr.w?c.s.scrollLeft=c.n.offsetLeft+c.n.offsetWidth-c.sr.w:c.n.offsetLeft<c.sr.l?c.s.scrollLeft=c.n.offsetLeft:7>=m("ie")&&n&&n.view.headerNode&&(n.view.headerNode.scrollLeft=c.s.scrollLeft))},_isHeaderHidden:function(){var f=this.focusView;if(!f)for(var c=0,n;n=this.grid.views.views[c];c++)if(n.headerNode){f=n;break}return f&&"none"==w.getComputedStyle(f.headerNode).display},colSizeAdjust:function(f,c,n){var q=
this._findHeaderCells(),d=this.focusView;if(!d||!d.header.tableMap.map)for(var a=0,b;b=this.grid.views.views[a];a++)if(b.header.tableMap.map){d=b;break}a=q[c];!d||c==q.length-1&&0===c||(d.content.baseDecorateEvent(f),f.cellNode=a,f.cellIndex=d.content.getCellNodeIndex(f.cellNode),f.cell=0<=f.cellIndex?this.grid.getCell(f.cellIndex):null,d.header.canResize(f)&&(c={l:n},f=d.header.colResizeSetup(f,!1),d.header.doResizeColumn(f,null,c),d.update()))},styleRow:function(f){},setFocusIndex:function(f,c){this.setFocusCell(this.grid.getCell(c),
f)},setFocusCell:function(f,c){f&&!this.isFocusCell(f,c)&&(this.tabbingOut=!1,this._colHeadNode&&this.blurHeader(),this._colHeadNode=this._colHeadFocusIdx=null,this.focusGridView(),this._focusifyCellNode(!1),this.cell=f,this.rowIndex=c,this._focusifyCellNode(!0));if(m("opera"))setTimeout(I.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1);else this.grid.onCellFocus(this.cell,this.rowIndex)},next:function(){if(this.cell){var f=this.rowIndex,c=this.cell.index+1,n=this.grid.layout.cellCount-
1,q=this.grid.rowCount-1;c>n&&(c=0,f++);f>q&&(c=n,f=q);if(this.grid.edit.isEditing()&&(n=this.grid.getCell(c),!this.isLastFocusCell()&&(!n.editable||this.grid.canEdit&&!this.grid.canEdit(n,f)))){this.cell=n;this.rowIndex=f;this.next();return}this.setFocusIndex(f,c)}},previous:function(){if(this.cell){var f=this.rowIndex||0,c=(this.cell.index||0)-1;0>c&&(c=this.grid.layout.cellCount-1,f--);0>f&&(c=f=0);if(this.grid.edit.isEditing()){var n=this.grid.getCell(c);if(!this.isFirstFocusCell()&&!n.editable){this.cell=
n;this.rowIndex=f;this.previous();return}}this.setFocusIndex(f,c)}},move:function(f,c){var n=0>c?-1:1;if(this.isNavHeader()){f=this._findHeaderCells();var q=currentIdx=M.indexOf(f,this._colHeadNode);for(currentIdx+=c;0<=currentIdx&&currentIdx<f.length&&"none"==f[currentIdx].style.display;)currentIdx+=n;0<=currentIdx&&currentIdx<f.length&&this._setActiveColHeader(f[currentIdx],currentIdx,q)}else if(this.cell){var d=this.grid.scroller;q=this.rowIndex;var a=this.grid.rowCount-1,b=Math.min(a,Math.max(0,
q+f));f&&(0<f?b>d.getLastPageRow(d.page)&&this.grid.setScrollTop(this.grid.scrollTop+d.findScrollTop(b)-d.findScrollTop(q)):0>f&&b<=d.getPageRow(d.page)&&this.grid.setScrollTop(this.grid.scrollTop-d.findScrollTop(q)-d.findScrollTop(b)));d=this.grid.layout.cellCount-1;for(var k=this.cell.index,g=Math.min(d,Math.max(0,k+c)),p=this.grid.getCell(g);0<=g&&g<d&&p&&!0===p.hidden;)g+=n,p=this.grid.getCell(g);p&&!0!==p.hidden||(g=k);n=p.getNode(b);!n&&f?0<=b+f&&b+f<=a&&this.move(0<f?++f:--f,c):n&&"none"!==
w.style(n,"display")||!c?(this.setFocusIndex(b,g),f&&this.grid.updateRow(q)):0<=g+c&&g+c<=d&&this.move(f,0<c?++c:--c)}},previousKey:function(f){this.grid.edit.isEditing()?(v.stop(f),this.previous()):this.isNavHeader()||this._isHeaderHidden()?(this.tabOut(this.grid.domNode),null!=this._colHeadFocusIdx&&(w.toggleClass(this._findHeaderCells()[this._colHeadFocusIdx],this.focusClass,!1),this._colHeadFocusIdx=null),this._focusifyCellNode(!1)):(this.grid.domNode.focus(),v.stop(f))},nextKey:function(f){f.target===
this.grid.domNode&&null==this._colHeadFocusIdx?(this.focusHeader(),v.stop(f)):this.isNavHeader()?(this.blurHeader(),this.findAndFocusGridCell()||this.tabOut(this.grid.lastFocusNode),this._colHeadNode=this._colHeadFocusIdx=null):this.grid.edit.isEditing()?(v.stop(f),this.next()):this.tabOut(this.grid.lastFocusNode)},tabOut:function(f){this.tabbingOut=!0;f.focus()},focusGridView:function(){r.fire(this.focusView,"focus")},focusGrid:function(f){this.focusGridView();this._focusifyCellNode(!0)},findAndFocusGridCell:function(){var f=
!0,c=0===this.grid.rowCount;this.isNoFocusCell()&&!c?(c=0,this.grid.getCell(c).hidden&&(c=this.isNavHeader()?this._colHeadFocusIdx:0),this.setFocusIndex(0,c)):this.cell&&!c?(this.focusView&&!this.focusView.rowNodes[this.rowIndex]&&this.grid.scrollToRow(this.rowIndex),this.focusGrid()):f=!1;this._colHeadNode=this._colHeadFocusIdx=null;return f},focusHeader:function(){var f=this._findHeaderCells(),c=this._colHeadFocusIdx;this._isHeaderHidden()?this.findAndFocusGridCell():this._colHeadFocusIdx||(this.isNoFocusCell()?
this._colHeadFocusIdx=0:this._colHeadFocusIdx=this.cell.index);for(this._colHeadNode=f[this._colHeadFocusIdx];this._colHeadNode&&0<=this._colHeadFocusIdx&&this._colHeadFocusIdx<f.length&&"none"==this._colHeadNode.style.display;)this._colHeadFocusIdx++,this._colHeadNode=f[this._colHeadFocusIdx];this._colHeadNode&&"none"!=this._colHeadNode.style.display?(this.headerMenu&&this._contextMenuBindNode!=this.grid.domNode&&(this.headerMenu.unBindDomNode(this.grid.viewsHeaderNode),this.headerMenu.bindDomNode(this.grid.domNode),
this._contextMenuBindNode=this.grid.domNode),this._setActiveColHeader(this._colHeadNode,this._colHeadFocusIdx,c),this._scrollHeader(this._colHeadFocusIdx),this._focusifyCellNode(!1)):this.findAndFocusGridCell()},blurHeader:function(){w.removeClass(this._colHeadNode,this.focusClass);w.removeAttr(this.grid.domNode,"aria-activedescendant");if(this.headerMenu&&this._contextMenuBindNode==this.grid.domNode){var f=this.grid.viewsHeaderNode;this.headerMenu.unBindDomNode(this.grid.domNode);this.headerMenu.bindDomNode(f);
this._contextMenuBindNode=f}},doFocus:function(f){f&&f.target!=f.currentTarget?v.stop(f):this._clickFocus||(this.tabbingOut||this.focusHeader(),this.tabbingOut=!1,v.stop(f))},doBlur:function(f){v.stop(f)},doContextMenu:function(f){this.headerMenu||v.stop(f)},doLastNodeFocus:function(f){this.tabbingOut?this._focusifyCellNode(!1):0<this.grid.rowCount?(this.isNoFocusCell()&&this.setFocusIndex(0,0),this._focusifyCellNode(!0)):this.focusHeader();this.tabbingOut=!1;v.stop(f)},doLastNodeBlur:function(f){v.stop(f)},
doColHeaderFocus:function(f){this._setActiveColHeader(f.target,w.attr(f.target,"idx"),this._colHeadFocusIdx);this._scrollHeader(this.getHeaderIndex());v.stop(f)},doColHeaderBlur:function(f){w.toggleClass(f.target,this.focusClass,!1)},_mouseDown:function(f){this._clickFocus=dojo.some(this.grid.views.views,function(c){return c.scrollboxNode===f.target})},_mouseUp:function(f){this._clickFocus=!1}})})},"dojox/grid/_EditManager":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/connect dojo/_base/sniff ./util".split(" "),
function(M,I,F,D,v,m){return F("dojox.grid._EditManager",null,{constructor:function(u){this.grid=u;this.connections=v("ie")?[D.connect(document.body,"onfocus",M.hitch(this,"_boomerangFocus"))]:[];this.connections.push(D.connect(this.grid,"onBlur",this,"apply"));this.connections.push(D.connect(this.grid,"prerender",this,"_onPreRender"))},info:{},destroy:function(){I.forEach(this.connections,D.disconnect)},cellFocus:function(u,r){this.grid.singleClickEdit||this.isEditRow(r)?this.setEditCell(u,r):this.apply();
(this.isEditing()||u&&u.editable&&u.alwaysEditing)&&this._focusEditor(u,r)},rowClick:function(u){this.isEditing()&&!this.isEditRow(u.rowIndex)&&this.apply()},styleRow:function(u){u.index==this.info.rowIndex&&(u.customClasses+=" dojoxGridRowEditing")},dispatchEvent:function(u){var r=u.cell;return(r=r&&r.editable?r:0)&&r.dispatchEvent(u.dispatch,u)},isEditing:function(){return void 0!==this.info.rowIndex},isEditCell:function(u,r){return this.info.rowIndex===u&&this.info.cell.index==r},isEditRow:function(u){return this.info.rowIndex===
u},setEditCell:function(u,r){!this.isEditCell(r,u.index)&&this.grid.canEdit&&this.grid.canEdit(u,r)&&this.start(u,r,this.isEditRow(r)||u.editable)},_focusEditor:function(u,r){m.fire(u,"focus",[r])},focusEditor:function(){this.isEditing()&&this._focusEditor(this.info.cell,this.info.rowIndex)},_boomerangWindow:500,_shouldCatchBoomerang:function(){return this._catchBoomerang>(new Date).getTime()},_boomerangFocus:function(){this._shouldCatchBoomerang()&&(this.grid.focus.focusGrid(),this.focusEditor(),
this._catchBoomerang=0)},_doCatchBoomerang:function(){v("ie")&&(this._catchBoomerang=(new Date).getTime()+this._boomerangWindow)},start:function(u,r,w){this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.isEditing()&&!this.isEditRow(r)&&(this.applyRowEdit(),this.grid.updateRow(r)),w?(this.info={cell:u,rowIndex:r},this.grid.doStartEdit(u,r),this.grid.updateRow(r)):this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._focusEditor(u,r),this._doCatchBoomerang())},_editorDo:function(u){var r=
this.info.cell;if(r&&r.editable)r[u](this.info.rowIndex)},editorApply:function(){this._editorDo("apply")},editorCancel:function(){this._editorDo("cancel")},applyCellEdit:function(u,r,w){this.grid.canEdit(r,w)&&this.grid.doApplyCellEdit(u,w,r.field)},applyRowEdit:function(){this.grid.doApplyEdit(this.info.rowIndex,this.info.cell.field)},apply:function(){this.isEditing()&&this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.applyRowEdit(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),
this._doCatchBoomerang())},cancel:function(){this.isEditing()&&(this.grid.beginUpdate(),this.editorCancel(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},save:function(u,r){var w=this.info.cell;!this.isEditRow(u)||r&&w.view!=r||!w.editable||w.save(w,this.info.rowIndex)},restore:function(u,r){var w=this.info.cell;this.isEditRow(r)&&w.view==u&&w.editable&&w.restore(this.info.rowIndex)},_isValidInput:function(){var u=(this.info.cell||{}).widget;if(!u||!u.isValid)return!0;
u.focused=!0;return u.isValid(!0)},_onPreRender:function(){this.isEditing()&&(this.info.value=this.info.cell.getValue())}})})},"dojox/grid/Selection":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-attr"],function(M,I,F,D){return M("dojox.grid.Selection",null,{constructor:function(v){this.grid=v;this.selected=[];this.setMode(v.selectionMode)},mode:"extended",selected:null,updating:0,selectedIndex:-1,rangeStartIndex:-1,setMode:function(v){this.selected.length&&
this.deselectAll();this.mode="extended"!=v&&"multiple"!=v&&"single"!=v&&"none"!=v?"extended":v},onCanSelect:function(v){return this.grid.onCanSelect(v)},onCanDeselect:function(v){return this.grid.onCanDeselect(v)},onSelected:function(v){},onDeselected:function(v){},onChanging:function(){},onChanged:function(){},isSelected:function(v){return"none"==this.mode?!1:this.selected[v]},getFirstSelected:function(){if(!this.selected.length||"none"==this.mode)return-1;for(var v=0,m=this.selected.length;v<m;v++)if(this.selected[v])return v;
return-1},getNextSelected:function(v){if("none"==this.mode)return-1;v+=1;for(var m=this.selected.length;v<m;v++)if(this.selected[v])return v;return-1},getSelected:function(){for(var v=[],m=0,u=this.selected.length;m<u;m++)this.selected[m]&&v.push(m);return v},getSelectedCount:function(){for(var v=0,m=0;m<this.selected.length;m++)this.selected[m]&&v++;return v},_beginUpdate:function(){if(0===this.updating)this.onChanging();this.updating++},_endUpdate:function(){this.updating--;if(0===this.updating)this.onChanged()},
select:function(v){"none"!=this.mode&&("multiple"!=this.mode?(this.deselectAll(v),this.addToSelection(v)):this.toggleSelect(v))},addToSelection:function(v){if("none"!=this.mode)if(F.isArray(v))I.forEach(v,this.addToSelection,this);else if(v=Number(v),this.selected[v])this.selectedIndex=v;else if(!1!==this.onCanSelect(v)){this.selectedIndex=v;var m=this.grid.getRowNode(v);m&&D.set(m,"aria-selected","true");this._beginUpdate();this.selected[v]=!0;this.onSelected(v);this._endUpdate()}},deselect:function(v){if("none"!=
this.mode)if(F.isArray(v))I.forEach(v,this.deselect,this);else if(v=Number(v),this.selectedIndex==v&&(this.selectedIndex=-1),this.selected[v]&&!1!==this.onCanDeselect(v)){var m=this.grid.getRowNode(v);m&&D.set(m,"aria-selected","false");this._beginUpdate();delete this.selected[v];this.onDeselected(v);this._endUpdate()}},setSelected:function(v,m){this[m?"addToSelection":"deselect"](v)},toggleSelect:function(v){F.isArray(v)?I.forEach(v,this.toggleSelect,this):this.setSelected(v,!this.selected[v])},
_range:function(v,m,u){var r=0<=v?v:m;v=m;r>v&&(v=r,r=m);for(m=r;m<=v;m++)u(m)},selectRange:function(v,m){this._range(v,m,F.hitch(this,"addToSelection"))},deselectRange:function(v,m){this._range(v,m,F.hitch(this,"deselect"))},insert:function(v){this.selected.splice(v,0,!1);this.selectedIndex>=v&&this.selectedIndex++},remove:function(v){this.selected.splice(v,1);this.selectedIndex>=v&&this.selectedIndex--},deselectAll:function(v){for(var m in this.selected)m!=v&&!0===this.selected[m]&&this.deselect(m)},
clickSelect:function(v,m,u){if("none"!=this.mode){this._beginUpdate();if("extended"!=this.mode)this.select(v);else{if(!u||0>this.rangeStartIndex)this.rangeStartIndex=v;m||this.deselectAll(v);u?this.selectRange(this.rangeStartIndex,v):m?this.toggleSelect(v):this.addToSelection(v)}this._endUpdate()}},clickSelectEvent:function(v){this.clickSelect(v.rowIndex,dojo.isCopyKey(v),v.shiftKey)},clear:function(){this._beginUpdate();this.deselectAll();this._endUpdate()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare",
"dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(M,I,F,D){return M("dijit.CheckedMenuItem",F,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:D,checked:!1,_setCheckedAttr:function(v){this.domNode.setAttribute("aria-checked",v?"true":"false");this._set("checked",v)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(v){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));
this.onClick(v)}})})},"dojox/grid/DataSelection":function(){define(["dojo/_base/declare","./_SelectionPreserver","./Selection"],function(M,I,F){return M("dojox.grid.DataSelection",F,{constructor:function(D){D.keepSelection&&(this.preserver=new I(this))},destroy:function(){this.preserver&&this.preserver.destroy()},getFirstSelected:function(){var D=F.prototype.getFirstSelected.call(this);return-1==D?null:this.grid.getItem(D)},getNextSelected:function(D){D=this.grid.getItemIndex(D);D=F.prototype.getNextSelected.call(this,
D);return-1==D?null:this.grid.getItem(D)},getSelected:function(){for(var D=[],v=0,m=this.selected.length;v<m;v++)this.selected[v]&&D.push(this.grid.getItem(v));return D},addToSelection:function(D){if("none"!=this.mode){var v=null;v="number"==typeof D||"string"==typeof D?D:this.grid.getItemIndex(D);F.prototype.addToSelection.call(this,v)}},deselect:function(D){if("none"!=this.mode){var v=null;v="number"==typeof D||"string"==typeof D?D:this.grid.getItemIndex(D);F.prototype.deselect.call(this,v)}},deselectAll:function(D){var v=
null;D||"number"==typeof D?(v="number"==typeof D||"string"==typeof D?D:this.grid.getItemIndex(D),F.prototype.deselectAll.call(this,v)):this.inherited(arguments)}})})},"dojox/grid/_SelectionPreserver":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array"],function(M,I,F,D){return M("dojox.grid._SelectionPreserver",null,{constructor:function(v){this.selection=v;var m=this.grid=v.grid;this.reset();this._connects=[I.connect(m,"_setStore",this,"reset"),I.connect(m,
"_addItem",this,"_reSelectById"),I.connect(v,"onSelected",F.hitch(this,"_selectById",!0)),I.connect(v,"onDeselected",F.hitch(this,"_selectById",!1)),I.connect(v,"deselectAll",this,"reset")]},destroy:function(){this.reset();D.forEach(this._connects,I.disconnect);delete this._connects},reset:function(){this._selectedById={}},_reSelectById:function(v,m){v&&this.grid._hasIdentity&&(this.selection.selected[m]=this._selectedById[this.grid.store.getIdentity(v)])},_selectById:function(v,m){if("none"!=this.selection.mode&&
this.grid._hasIdentity){var u=m,r=this.grid;if("number"==typeof m||"string"==typeof m)u=(m=r._by_idx[m])&&m.item;u&&(this._selectedById[r.store.getIdentity(u)]=!!v);return u}}})})},"esri/dijit/editing/TemplatePickerItem":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/sniff dojo/dom-style dijit/_Widget dijit/_Templated dojox/gfx ../../symbols/jsonUtils ../../kernel".split(" "),function(M,I,F,D,v,m,u,r,w,f,c){M=M([u,r],{declaredClass:"esri.dijit.editing.TemplatePickerItem",
templateString:"\x3cdiv class\x3d'item' style\x3d'text-align: center;'\x3e\x3cdiv class\x3d'itemSymbol' dojoAttachPoint\x3d'_surfaceNode'\x3e\x3c/div\x3e\x3cdiv class\x3d'itemLabel'\x3e${label}\x3c/div\x3e\x3c/div\x3e",startup:function(){this._started||(this.inherited(arguments),this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template))},_draw:function(n,q,d,a,b){if(q&&"textsymbol"!==q.type){n=w.createSurface(n,d,a);if(9>D("ie")){var k=n.getEventSource();
m.set(k,"position","relative");m.set(k.parentNode,"position","relative")}q=!this.legendOverride&&this._getDrawingToolShape(q,b)||f.getShapeDescriptors(q);try{var g=n.createShape(q.defaultShape).setFill(q.fill).setStroke(q.stroke)}catch(J){n.clear();n.destroy();return}var p=g.getBoundingBox();q=p.width;b=p.height;k=-(p.x+q/2);p=-(p.y+b/2);var B=n.getDimensions();k={dx:k+B.width/2,dy:p+B.height/2};if(q>d||b>a)p=q/d>b/a,d=((p?d:a)-5)/(p?q:b),I.mixin(k,{xx:d,yy:d});g.applyTransform(k);return n}},_getDrawingToolShape:function(n,
q){switch(q?q.drawingTool||null:null){case "esriFeatureEditToolArrow":q={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolLeftArrow":q={type:"path",path:"M -15,1 L -8,8 L -8,5 L 10,5 L 10,-2 L -8,-2 L -8,-5 L -15,1 E"};break;case "esriFeatureEditToolRightArrow":q={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolUpArrow":q={type:"path",path:"M 1,-10 L 8,-3 L 5,-3 L 5,15 L -2,15 L -2,-3 L -5,-3 L 1,-10 E"};
break;case "esriFeatureEditToolDownArrow":q={type:"path",path:"M 1,15 L 8,8 L 5,8 L 5,-10 L -2,-10 L -2,8 L -5,8 L 1,15 E"};break;case "esriFeatureEditToolTriangle":q={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":q={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":q={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":q={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;case "esriFeatureEditToolFreehand":q=
"simplelinesymbol"===n.type||"cartographiclinesymbol"===n.type?{type:"path",path:"m -11, -7c-1.5,-3.75 7.25,-9.25 12.5,-7c5.25,2.25 6.75,9.75 3.75,12.75c-3,3 -3.25,2.5 -9.75,5.25c-6.5,2.75 -7.25,14.25 2,15.25c9.25,1 11.75,-4 13.25,-6.75c1.5,-2.75 3.5,-11.75 12,-6.5"}:{type:"path",path:"M 10,-13 c3.1,0.16667 4.42564,2.09743 2.76923,3.69231c-2.61025,2.87179 -5.61025,5.6718 -6.14358,6.20513c-0.66667,0.93333 -0.46667,1.2 -0.53333,1.93333c-0.00001,0.86666 0.6,1.66667 1.13334,2c1.03077,0.38462 2.8,0.93333 3.38974,1.70769c0.47693,0.42564 0.87693,0.75897 1.41026,1.75897c0.13333,1.06667 -0.46667,2.86667 -1.8,3.8c-0.73333,0.73333 -3.86667,2.66666 -4.86667,3.13333c-0.93333,0.8 -7.4,3.2 -7.6,3.06667c-1.06667,0.46667 -4.73333,1.13334 -5.2,1.26667c-1.6,0.33334 -4.6,0.4 -6.25128,0.05128c-1.41539,-0.18462 -2.34872,-2.31796 -1.41539,-4.45129c0.93333,-1.73333 1.86667,-3.13333 2.64615,-3.85641c1.28718,-1.47692 2.57437,-2.68204 3.88718,-3.54359c0.88718,-1.13845 1.8,-1.33333 2.26666,-2.45641c0.33334,-0.74359 0.37949,-1.7641 0.06667,-2.87692c-0.66666,-1.46666 -1.66666,-1.86666 -2.98975,-2.2c-1.27692,-0.26666 -2.12307,-0.64102 -3.27692,-1.46666c-0.66667,-1.00001 -1.01538,-3.01539 0.73333,-4.06667c1.73333,-1.2 3.6,-1.93333 4.93333,-2.2c1.33333,-0.46667 4.84104,-1.09743 5.84103,-1.23076c1.60001,-0.46667 6.02564,-0.50257 7.29231,-0.56924z"};
break;default:return null}return{defaultShape:q,fill:n.getFill(),stroke:n.getStroke()}},_repaint:function(n){n?(n.getStroke&&n.setStroke&&n.setStroke(n.getStroke()),n.getFill&&n.setFill&&n.setFill(n.getFill()),n.children&&I.isArray(n.children)&&F.forEach(n.children,this._repaint,this)):this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template)},destroy:function(){this._surface&&(this._surface.destroy(),delete this._surface);this.inherited(arguments)}});
D("extend-esri")&&I.setObject("dijit.editing.TemplatePickerItem",M,c);return M})},"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dojox/grid/resources/View.html":'\x3cdiv class\x3d"dojoxGridView" role\x3d"presentation"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridHeader" dojoAttachPoint\x3d"headerNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"headerNodeContainer" style\x3d"width:9000em" role\x3d"presentation"\x3e\r\n\t\t\t\x3cdiv dojoAttachPoint\x3d"headerContentNode" role\x3d"row"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" dojoAttachPoint\x3d"hiddenFocusNode" aria-hidden\x3d"true" /\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" aria-hidden\x3d"true" /\x3e\r\n\t\x3cdiv class\x3d"dojoxGridScrollbox" dojoAttachPoint\x3d"scrollboxNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dojoxGridContent" dojoAttachPoint\x3d"contentNode" hidefocus\x3d"hidefocus" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dojox/grid/resources/_Grid.html":'\x3cdiv hidefocus\x3d"hidefocus" role\x3d"grid" dojoAttachEvent\x3d"onmouseout:_mouseOut"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterHeader" dojoAttachPoint\x3d"viewsHeaderNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterView" dojoAttachPoint\x3d"viewsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterMessages" style\x3d"display: none;" dojoAttachPoint\x3d"messagesNode"\x3e\x3c/div\x3e\r\n\t\x3cspan dojoAttachPoint\x3d"lastFocusNode" tabindex\x3d"0"\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/TemplatePicker.html":'\x3cdiv class\x3d"templatePicker"\x3e\r\n\r\n  \x3ctable dojoType\x3d"dojox.grid.DataGrid" noDataMessage\x3d"${emptyMessage}" selectionMode\x3d"none" autoHeight\x3d"${_rows}" autoWidth\x3d"${_autoWidth}"\r\n         query\x3d"{ query: \'*\' }" dojoAttachPoint\x3d"grid" class\x3d"grid"\x3e\r\n  \x3c/table\x3e\r\n  \r\n\x3c/div\x3e',"*now":function(M){M(['dojo/i18n!*preload*esri/dijit/editing/nls/TemplatePicker-all*["ar","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},
"*noref":1}});define("esri/dijit/editing/TemplatePicker-all",["../../layers/FeatureLayer","../../toolbars/draw","../../toolbars/edit","./TemplatePicker"],function(M,I,F,D){return{}});